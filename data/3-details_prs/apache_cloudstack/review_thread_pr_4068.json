{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDE1ODY0NjEw", "number": 4068, "reviewThreads": {"totalCount": 26, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xNVQxNjozMToyM1rOD88FuA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xMVQyMToxMDo1NlrOEXYheA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjY1MjI1NjU2OnYy", "diffSide": "RIGHT", "path": "scripts/vm/hypervisor/xenserver/vmops", "isResolved": true, "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xNVQxNjozMToyM1rOGWL3BQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0zMFQwNDozNToyN1rOGqrWgQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNTkxNjE2NQ==", "bodyText": "I suggest you check if this needs to be done for xenserver; the xenserver scripts run only xenserver host (even though they are part of cloudstack-common; cloudstack copies these scripts to XenServer/XCP-ng hosts where they get executed, not on mgmt server). @shwstppr", "url": "https://github.com/apache/cloudstack/pull/4068#discussion_r425916165", "createdAt": "2020-05-15T16:31:23Z", "author": {"login": "rhtyd"}, "path": "scripts/vm/hypervisor/xenserver/vmops", "diffHunk": "@@ -162,7 +162,7 @@ def setLinkLocalIP(session, args):\n \n         if result.lower().strip() == \"bridge\":\n             try:\n-                cmd = [\"brctl\", \"addbr\", brName]\n+                cmd = [\"ip\", \"link\", \"add\", \"name\", brName, \"type\", \"bridge\"]", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "6b6f69542e4cf5f5d6725ff8b94876566dc36fc9"}, "originalPosition": 5}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NjI3MzkwMA==", "bodyText": "Has this been resolve/attended @shwstppr ?", "url": "https://github.com/apache/cloudstack/pull/4068#discussion_r446273900", "createdAt": "2020-06-26T16:04:23Z", "author": {"login": "andrijapanicsb"}, "path": "scripts/vm/hypervisor/xenserver/vmops", "diffHunk": "@@ -162,7 +162,7 @@ def setLinkLocalIP(session, args):\n \n         if result.lower().strip() == \"bridge\":\n             try:\n-                cmd = [\"brctl\", \"addbr\", brName]\n+                cmd = [\"ip\", \"link\", \"add\", \"name\", brName, \"type\", \"bridge\"]", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNTkxNjE2NQ=="}, "originalCommit": {"oid": "6b6f69542e4cf5f5d6725ff8b94876566dc36fc9"}, "originalPosition": 5}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NzQwMzY0OQ==", "bodyText": "Though both work. I've reverted the change", "url": "https://github.com/apache/cloudstack/pull/4068#discussion_r447403649", "createdAt": "2020-06-30T04:35:27Z", "author": {"login": "shwstppr"}, "path": "scripts/vm/hypervisor/xenserver/vmops", "diffHunk": "@@ -162,7 +162,7 @@ def setLinkLocalIP(session, args):\n \n         if result.lower().strip() == \"bridge\":\n             try:\n-                cmd = [\"brctl\", \"addbr\", brName]\n+                cmd = [\"ip\", \"link\", \"add\", \"name\", brName, \"type\", \"bridge\"]", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNTkxNjE2NQ=="}, "originalCommit": {"oid": "6b6f69542e4cf5f5d6725ff8b94876566dc36fc9"}, "originalPosition": 5}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjY2OTUyMDQ1OnYy", "diffSide": "RIGHT", "path": "python/bindir/cloud-grab-dependent-library-versions", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yMVQxMjo1MDo1MFrOGYxlSA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xMVQwNjowODoyOVrOGiPsvQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyODYzMTM2OA==", "bodyText": "On depLibraries (line 21) I think that it would be necessary also to add python3.\ndepLibraries = ['python', 'pythom3', ...]", "url": "https://github.com/apache/cloudstack/pull/4068#discussion_r428631368", "createdAt": "2020-05-21T12:50:50Z", "author": {"login": "GabrielBrascher"}, "path": "python/bindir/cloud-grab-dependent-library-versions", "diffHunk": "@@ -27,7 +27,7 @@ def runCmd(cmds):\n     stdout, stderr = process.communicate()\n     if process.returncode != 0:\n         raise Exception(stderr)\n-    return stdout\n+    return stdout.decode('utf-8')", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "cd6b0aa027bf81a6a3e88dcb38ee343c349398a5"}, "originalPosition": 11}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzODU2MTk4MQ==", "bodyText": "@GabrielBrascher centos8 has python2 as python2 python3 as python36 and centos7 has python2 as python and python3 as python3 so I've added condition for that in the script.\nThough I'm not sure where that script is used. Could see it getting installed\n41a69cb", "url": "https://github.com/apache/cloudstack/pull/4068#discussion_r438561981", "createdAt": "2020-06-11T06:08:29Z", "author": {"login": "shwstppr"}, "path": "python/bindir/cloud-grab-dependent-library-versions", "diffHunk": "@@ -27,7 +27,7 @@ def runCmd(cmds):\n     stdout, stderr = process.communicate()\n     if process.returncode != 0:\n         raise Exception(stderr)\n-    return stdout\n+    return stdout.decode('utf-8')", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyODYzMTM2OA=="}, "originalCommit": {"oid": "cd6b0aa027bf81a6a3e88dcb38ee343c349398a5"}, "originalPosition": 11}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjY4ODkyMDIyOnYy", "diffSide": "RIGHT", "path": "engine/schema/src/main/resources/META-INF/db/schema-41400to41500.sql", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yOFQwOTo0MjozN1rOGbtjtw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yOFQwOTo0MjozN1rOGbtjtw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMTcxMTE1OQ==", "bodyText": "@davidjumani this was proposed only as a workaround, please explore a proper fix (why we see update_time related sql exceptions on freshly deployed env, i.e. zone with ssvm/cpvm launching).", "url": "https://github.com/apache/cloudstack/pull/4068#discussion_r431711159", "createdAt": "2020-05-28T09:42:37Z", "author": {"login": "rhtyd"}, "path": "engine/schema/src/main/resources/META-INF/db/schema-41400to41500.sql", "diffHunk": "@@ -18,3 +18,6 @@\n --;\n -- Schema upgrade from 4.14.0.0 to 4.15.0.0\n --;\n+\n+-- mysql8 nics table fix for newer distributions\n+ALTER TABLE nics MODIFY COLUMN update_time timestamp NULL;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "2439c19b7d1b838af3efd8769f40fa096df1f2dd"}, "originalPosition": 6}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjczMjc1NTA1OnYy", "diffSide": "RIGHT", "path": "scripts/storage/qcow2/managesnapshot.sh", "isResolved": false, "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xMVQwOTo0Njo1NlrOGiWPVQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0wNlQxMDowMjowN1rOG8s-RA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzODY2OTE0MQ==", "bodyText": "@davidjumani @shwstppr can you explain this change and how it is used - is this for the snapshot failure fix?", "url": "https://github.com/apache/cloudstack/pull/4068#discussion_r438669141", "createdAt": "2020-06-11T09:46:56Z", "author": {"login": "rhtyd"}, "path": "scripts/storage/qcow2/managesnapshot.sh", "diffHunk": "@@ -187,6 +187,7 @@ backup_snapshot() {\n   local snapshotname=\"$2\"\n   local destPath=$3\n   local destName=$4\n+  local forceShareFlag=\"-U\"", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "41a69cb3d985b55f76d1f47b51aae34b60e61763"}, "originalPosition": 4}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzODY4MzQwNg==", "bodyText": "@rhtyd  qemu-img with QEMU 2.1 is not able to read QCOW2 file when it is already have a read lock by another process (libvirt). Due to this, both Ubuntu and CentOS8 fail to snapshot a running VM.\nFor a running VM and volume snapshot, as per code (and my understanding), we create an external snapshot for VM using libvirt, then this script is used to read, convert (to a new file) and backup that snapshot to secondary storage using qemu-img. Since we are not making any change as such in original QCOW2 disk file, we can open it shared open (-U) flag which will prevent regression from CentOS7 or distros with older QEMU.\nI've added checks in code avoid any failures if -U is not supported", "url": "https://github.com/apache/cloudstack/pull/4068#discussion_r438683406", "createdAt": "2020-06-11T10:13:44Z", "author": {"login": "shwstppr"}, "path": "scripts/storage/qcow2/managesnapshot.sh", "diffHunk": "@@ -187,6 +187,7 @@ backup_snapshot() {\n   local snapshotname=\"$2\"\n   local destPath=$3\n   local destName=$4\n+  local forceShareFlag=\"-U\"", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzODY2OTE0MQ=="}, "originalCommit": {"oid": "41a69cb3d985b55f76d1f47b51aae34b60e61763"}, "originalPosition": 4}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NjMwNDU4MA==", "bodyText": "qemu 2.10 I believe, which also means when using qemu-kvm-ev 2.10+ on i.e. CentOS7+NFS3 PRimary Storage - is fixed!", "url": "https://github.com/apache/cloudstack/pull/4068#discussion_r466304580", "createdAt": "2020-08-06T10:02:07Z", "author": {"login": "andrijapanicsb"}, "path": "scripts/storage/qcow2/managesnapshot.sh", "diffHunk": "@@ -187,6 +187,7 @@ backup_snapshot() {\n   local snapshotname=\"$2\"\n   local destPath=$3\n   local destName=$4\n+  local forceShareFlag=\"-U\"", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzODY2OTE0MQ=="}, "originalCommit": {"oid": "41a69cb3d985b55f76d1f47b51aae34b60e61763"}, "originalPosition": 4}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjczMjc1ODI5OnYy", "diffSide": "RIGHT", "path": "python/lib/cloudutils/test.py", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xMVQwOTo0Nzo0N1rOGiWRUA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xMVQxMDo1NzoxOVrOGiYXKg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzODY2OTY0OA==", "bodyText": "@davidjumani @shwstppr This looks like a new file, if this was for testing while developing the feature and is unecessary (not tied or run with travis/trillia) - remove it please.", "url": "https://github.com/apache/cloudstack/pull/4068#discussion_r438669648", "createdAt": "2020-06-11T09:47:47Z", "author": {"login": "rhtyd"}, "path": "python/lib/cloudutils/test.py", "diffHunk": "@@ -0,0 +1,11 @@\n+#!/usr/bin/env python3\n+\n+from .utilities import bash\n+import logging\n+\n+cmd = bash(\"route -n|awk \\'/^0.0.0.0/ {print $2,$8}\\'\")\n+if not cmd.isSuccess():\n+    logging.debug(\"Failed to get default route\")\n+    raise CloudRuntimeException(\"Failed to get default route\")\n+\n+result = cmd.getStdout().split(\" \")", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "41a69cb3d985b55f76d1f47b51aae34b60e61763"}, "originalPosition": 11}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzODcwMzkxNA==", "bodyText": "removed", "url": "https://github.com/apache/cloudstack/pull/4068#discussion_r438703914", "createdAt": "2020-06-11T10:57:19Z", "author": {"login": "shwstppr"}, "path": "python/lib/cloudutils/test.py", "diffHunk": "@@ -0,0 +1,11 @@\n+#!/usr/bin/env python3\n+\n+from .utilities import bash\n+import logging\n+\n+cmd = bash(\"route -n|awk \\'/^0.0.0.0/ {print $2,$8}\\'\")\n+if not cmd.isSuccess():\n+    logging.debug(\"Failed to get default route\")\n+    raise CloudRuntimeException(\"Failed to get default route\")\n+\n+result = cmd.getStdout().split(\" \")", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzODY2OTY0OA=="}, "originalCommit": {"oid": "41a69cb3d985b55f76d1f47b51aae34b60e61763"}, "originalPosition": 11}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjczMjc1ODkzOnYy", "diffSide": "RIGHT", "path": "python/lib/cloudutils/syscfg.py", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xMVQwOTo0Nzo1NlrOGiWRpw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xMVQxMDo1NzowNlrOGiYWtQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzODY2OTczNQ==", "bodyText": "Remove comment", "url": "https://github.com/apache/cloudstack/pull/4068#discussion_r438669735", "createdAt": "2020-06-11T09:47:56Z", "author": {"login": "rhtyd"}, "path": "python/lib/cloudutils/syscfg.py", "diffHunk": "@@ -193,6 +200,17 @@ def __init__(self, glbEnv):\n                          nfsConfig(self),\n                          cloudAgentConfig(self)]\n \n+#it covers RHEL8", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "41a69cb3d985b55f76d1f47b51aae34b60e61763"}, "originalPosition": 52}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzODcwMzc5Nw==", "bodyText": "@rhtyd was just following the norm in the file which has a comment for rest of the distro :). Will remove if needed", "url": "https://github.com/apache/cloudstack/pull/4068#discussion_r438703797", "createdAt": "2020-06-11T10:57:06Z", "author": {"login": "shwstppr"}, "path": "python/lib/cloudutils/syscfg.py", "diffHunk": "@@ -193,6 +200,17 @@ def __init__(self, glbEnv):\n                          nfsConfig(self),\n                          cloudAgentConfig(self)]\n \n+#it covers RHEL8", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzODY2OTczNQ=="}, "originalCommit": {"oid": "41a69cb3d985b55f76d1f47b51aae34b60e61763"}, "originalPosition": 52}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjczMjc2MTA2OnYy", "diffSide": "RIGHT", "path": "python/lib/cloudutils/syscfg.py", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xMVQwOTo0ODozMlrOGiWS_Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xMVQxMDowNjoxNlrOGiW35Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzODY3MDA3Nw==", "bodyText": "Perhaps refactor the name? Unless this will handle for EL8 as well.", "url": "https://github.com/apache/cloudstack/pull/4068#discussion_r438670077", "createdAt": "2020-06-11T09:48:32Z", "author": {"login": "rhtyd"}, "path": "python/lib/cloudutils/syscfg.py", "diffHunk": "@@ -144,9 +146,14 @@ def __init__(self, env):\n \n class sysConfigAgentRedhat7Base(sysConfigAgent):\n     def __init__(self, env):\n-        self.svo = serviceOpsRedhat7()\n+        self.svo = serviceOpsRedhat7Later()", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "41a69cb3d985b55f76d1f47b51aae34b60e61763"}, "originalPosition": 37}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzODY3OTUyNQ==", "bodyText": "Yes this will handle EL8 as well, therefore, the name change", "url": "https://github.com/apache/cloudstack/pull/4068#discussion_r438679525", "createdAt": "2020-06-11T10:06:16Z", "author": {"login": "shwstppr"}, "path": "python/lib/cloudutils/syscfg.py", "diffHunk": "@@ -144,9 +146,14 @@ def __init__(self, env):\n \n class sysConfigAgentRedhat7Base(sysConfigAgent):\n     def __init__(self, env):\n-        self.svo = serviceOpsRedhat7()\n+        self.svo = serviceOpsRedhat7Later()", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzODY3MDA3Nw=="}, "originalCommit": {"oid": "41a69cb3d985b55f76d1f47b51aae34b60e61763"}, "originalPosition": 37}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjczMjc2MTkwOnYy", "diffSide": "RIGHT", "path": "python/lib/cloudutils/serviceConfig.py", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xMVQwOTo0ODo0OVrOGiWTmQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xMVQwOTo0ODo0OVrOGiWTmQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzODY3MDIzMw==", "bodyText": "This LGTM for newer Ubuntus", "url": "https://github.com/apache/cloudstack/pull/4068#discussion_r438670233", "createdAt": "2020-06-11T09:48:49Z", "author": {"login": "rhtyd"}, "path": "python/lib/cloudutils/serviceConfig.py", "diffHunk": "@@ -566,6 +572,12 @@ def setupLiveMigration(self):\n         elif os.path.exists(\"/etc/default/libvirtd\"):\n             cfo = configFileOps(\"/etc/default/libvirtd\", self)\n             cfo.replace_or_add_line(\"libvirtd_opts=\",\"libvirtd_opts='-l'\")\n+            if os.path.exists(\"/lib/systemd/system/libvirtd.socket\"):", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "41a69cb3d985b55f76d1f47b51aae34b60e61763"}, "originalPosition": 110}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjczMjc2MzYyOnYy", "diffSide": "RIGHT", "path": "python/lib/cloudutils/serviceConfig.py", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xMVQwOTo0OToyNFrOGiWUwA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xMVQxMDo1NTo1MlrOGiYUlg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzODY3MDUyOA==", "bodyText": "@davidjumani @shwstppr Check if this is true for distros applicable? Usually systemctl restart network works", "url": "https://github.com/apache/cloudstack/pull/4068#discussion_r438670528", "createdAt": "2020-06-11T09:49:24Z", "author": {"login": "rhtyd"}, "path": "python/lib/cloudutils/serviceConfig.py", "diffHunk": "@@ -343,7 +349,7 @@ def config(self):\n             cfo.addEntry(\"NOZEROCONF\", \"yes\")\n             cfo.save()\n \n-            if not bash(\"service network restart\").isSuccess():\n+            if not bash(\"systemctl restart NetworkManager.service\").isSuccess():", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "41a69cb3d985b55f76d1f47b51aae34b60e61763"}, "originalPosition": 102}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzODcwMzI1NA==", "bodyText": "@rhtyd systemctl restart network doesn't works on CentOS 8,\n[root@srvr1 ~]# hostnamectl\n   Static hostname: localhost.localdomain\nTransient hostname: srvr1.cloud.priv\n         Icon name: computer-vm\n           Chassis: vm\n        Machine ID: 5319303eb7f24b7b9ff80b20b150cc0c\n           Boot ID: 520c83f640bc4635880b23ba6f765497\n    Virtualization: kvm\n  Operating System: CentOS Linux 8 (Core)\n       CPE OS Name: cpe:/o:centos:centos:8\n            Kernel: Linux 4.18.0-147.8.1.el8_1.x86_64\n      Architecture: x86-64\n[root@srvr1 ~]# systemctl restart network\nFailed to restart network.service: Unit network.service not found.\n[root@srvr1 ~]# systemctl restart NetworkManager\n[root@srvr1 ~]# exit\n\nThis code to add bridge is not really used as we create bridge prior to installation as per docs. However, I've modified the above change to allow backward compatibility", "url": "https://github.com/apache/cloudstack/pull/4068#discussion_r438703254", "createdAt": "2020-06-11T10:55:52Z", "author": {"login": "shwstppr"}, "path": "python/lib/cloudutils/serviceConfig.py", "diffHunk": "@@ -343,7 +349,7 @@ def config(self):\n             cfo.addEntry(\"NOZEROCONF\", \"yes\")\n             cfo.save()\n \n-            if not bash(\"service network restart\").isSuccess():\n+            if not bash(\"systemctl restart NetworkManager.service\").isSuccess():", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzODY3MDUyOA=="}, "originalCommit": {"oid": "41a69cb3d985b55f76d1f47b51aae34b60e61763"}, "originalPosition": 102}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjczMjc2NDk5OnYy", "diffSide": "RIGHT", "path": "python/lib/cloudutils/serviceConfig.py", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xMVQwOTo0OTo1NFrOGiWVqg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xMVQxMDozNDoyNlrOGiXuCw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzODY3MDc2Mg==", "bodyText": "@shwstppr @davidjumani have we tested RHEL 8, or just extrapolating?", "url": "https://github.com/apache/cloudstack/pull/4068#discussion_r438670762", "createdAt": "2020-06-11T09:49:54Z", "author": {"login": "rhtyd"}, "path": "python/lib/cloudutils/serviceConfig.py", "diffHunk": "@@ -14,38 +14,44 @@\n # KIND, either express or implied.  See the License for the\n # specific language governing permissions and limitations\n # under the License.\n-from utilities import writeProgressBar, bash\n-from cloudException import CloudRuntimeException, CloudInternalException, formatExceptionInfo\n+from .utilities import writeProgressBar, bash\n+from .cloudException import CloudRuntimeException, CloudInternalException, formatExceptionInfo\n import logging\n-from networkConfig import networkConfig\n+from .networkConfig import networkConfig\n import re\n-from configFileOps import configFileOps\n+from .configFileOps import configFileOps\n import os\n import shutil\n \n # exit() error constants\n Unknown = 0\n CentOS6 = 1\n CentOS7 = 2\n-Ubuntu = 3\n-RHEL6 = 4\n-RHEL7 = 5\n+CentOS8 = 3\n+Ubuntu = 4\n+RHEL6 = 5\n+RHEL7 = 6\n+RHEL8 = 7\n distro = None\n \n #=================== DISTRIBUTION DETECTION =================\n if os.path.exists(\"/etc/centos-release\"):\n-    version = file(\"/etc/centos-release\").readline()\n+    version = open(\"/etc/centos-release\").readline()\n     if version.find(\"CentOS release 6\") != -1:\n       distro = CentOS6\n     elif version.find(\"CentOS Linux release 7\") != -1:\n       distro = CentOS7\n+    elif version.find(\"CentOS Linux release 8\") != -1:\n+      distro = CentOS8\n elif os.path.exists(\"/etc/redhat-release\"):\n-    version = file(\"/etc/redhat-release\").readline()\n+    version = open(\"/etc/redhat-release\").readline()\n     if version.find(\"Red Hat Enterprise Linux Server release 6\") != -1:\n       distro = RHEL6\n     elif version.find(\"Red Hat Enterprise Linux Server 7\") != -1:\n       distro = RHEL7\n-elif os.path.exists(\"/etc/lsb-release\") and \"Ubuntu\" in file(\"/etc/lsb-release\").read(-1): distro = Ubuntu\n+    elif version.find(\"Red Hat Enterprise Linux Server 8\") != -1:", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "41a69cb3d985b55f76d1f47b51aae34b60e61763"}, "originalPosition": 49}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzODY5MzM4Nw==", "bodyText": "@rhtyd extrapolating cc @davidjumani", "url": "https://github.com/apache/cloudstack/pull/4068#discussion_r438693387", "createdAt": "2020-06-11T10:34:26Z", "author": {"login": "shwstppr"}, "path": "python/lib/cloudutils/serviceConfig.py", "diffHunk": "@@ -14,38 +14,44 @@\n # KIND, either express or implied.  See the License for the\n # specific language governing permissions and limitations\n # under the License.\n-from utilities import writeProgressBar, bash\n-from cloudException import CloudRuntimeException, CloudInternalException, formatExceptionInfo\n+from .utilities import writeProgressBar, bash\n+from .cloudException import CloudRuntimeException, CloudInternalException, formatExceptionInfo\n import logging\n-from networkConfig import networkConfig\n+from .networkConfig import networkConfig\n import re\n-from configFileOps import configFileOps\n+from .configFileOps import configFileOps\n import os\n import shutil\n \n # exit() error constants\n Unknown = 0\n CentOS6 = 1\n CentOS7 = 2\n-Ubuntu = 3\n-RHEL6 = 4\n-RHEL7 = 5\n+CentOS8 = 3\n+Ubuntu = 4\n+RHEL6 = 5\n+RHEL7 = 6\n+RHEL8 = 7\n distro = None\n \n #=================== DISTRIBUTION DETECTION =================\n if os.path.exists(\"/etc/centos-release\"):\n-    version = file(\"/etc/centos-release\").readline()\n+    version = open(\"/etc/centos-release\").readline()\n     if version.find(\"CentOS release 6\") != -1:\n       distro = CentOS6\n     elif version.find(\"CentOS Linux release 7\") != -1:\n       distro = CentOS7\n+    elif version.find(\"CentOS Linux release 8\") != -1:\n+      distro = CentOS8\n elif os.path.exists(\"/etc/redhat-release\"):\n-    version = file(\"/etc/redhat-release\").readline()\n+    version = open(\"/etc/redhat-release\").readline()\n     if version.find(\"Red Hat Enterprise Linux Server release 6\") != -1:\n       distro = RHEL6\n     elif version.find(\"Red Hat Enterprise Linux Server 7\") != -1:\n       distro = RHEL7\n-elif os.path.exists(\"/etc/lsb-release\") and \"Ubuntu\" in file(\"/etc/lsb-release\").read(-1): distro = Ubuntu\n+    elif version.find(\"Red Hat Enterprise Linux Server 8\") != -1:", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzODY3MDc2Mg=="}, "originalCommit": {"oid": "41a69cb3d985b55f76d1f47b51aae34b60e61763"}, "originalPosition": 49}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjczMjc2NjM4OnYy", "diffSide": "RIGHT", "path": "python/lib/cloudutils/serviceConfig.py", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xMVQwOTo1MDoxN1rOGiWWeQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xMVQxMDozMzoyNFrOGiXsNA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzODY3MDk2OQ==", "bodyText": "Does changing these constants cause any error?", "url": "https://github.com/apache/cloudstack/pull/4068#discussion_r438670969", "createdAt": "2020-06-11T09:50:17Z", "author": {"login": "rhtyd"}, "path": "python/lib/cloudutils/serviceConfig.py", "diffHunk": "@@ -14,38 +14,44 @@\n # KIND, either express or implied.  See the License for the\n # specific language governing permissions and limitations\n # under the License.\n-from utilities import writeProgressBar, bash\n-from cloudException import CloudRuntimeException, CloudInternalException, formatExceptionInfo\n+from .utilities import writeProgressBar, bash\n+from .cloudException import CloudRuntimeException, CloudInternalException, formatExceptionInfo\n import logging\n-from networkConfig import networkConfig\n+from .networkConfig import networkConfig\n import re\n-from configFileOps import configFileOps\n+from .configFileOps import configFileOps\n import os\n import shutil\n \n # exit() error constants\n Unknown = 0\n CentOS6 = 1\n CentOS7 = 2\n-Ubuntu = 3\n-RHEL6 = 4\n-RHEL7 = 5\n+CentOS8 = 3", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "41a69cb3d985b55f76d1f47b51aae34b60e61763"}, "originalPosition": 24}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzODY5MjkxNg==", "bodyText": "@rhtyd have checked the code, as per my understanding, value for these constants is used within this file only at line 533 cc @davidjumani", "url": "https://github.com/apache/cloudstack/pull/4068#discussion_r438692916", "createdAt": "2020-06-11T10:33:24Z", "author": {"login": "shwstppr"}, "path": "python/lib/cloudutils/serviceConfig.py", "diffHunk": "@@ -14,38 +14,44 @@\n # KIND, either express or implied.  See the License for the\n # specific language governing permissions and limitations\n # under the License.\n-from utilities import writeProgressBar, bash\n-from cloudException import CloudRuntimeException, CloudInternalException, formatExceptionInfo\n+from .utilities import writeProgressBar, bash\n+from .cloudException import CloudRuntimeException, CloudInternalException, formatExceptionInfo\n import logging\n-from networkConfig import networkConfig\n+from .networkConfig import networkConfig\n import re\n-from configFileOps import configFileOps\n+from .configFileOps import configFileOps\n import os\n import shutil\n \n # exit() error constants\n Unknown = 0\n CentOS6 = 1\n CentOS7 = 2\n-Ubuntu = 3\n-RHEL6 = 4\n-RHEL7 = 5\n+CentOS8 = 3", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzODY3MDk2OQ=="}, "originalCommit": {"oid": "41a69cb3d985b55f76d1f47b51aae34b60e61763"}, "originalPosition": 24}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjc3NTk3MTk4OnYy", "diffSide": "RIGHT", "path": "packaging/centos7/cloud.spec", "isResolved": false, "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yNVQxMjoyNzoxMlrOGo4UDA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0zMFQwNDozNDowN1rOGqrVEA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NTUxODg2MA==", "bodyText": "@rhtyd do we need to delete these .whl files after install?", "url": "https://github.com/apache/cloudstack/pull/4068#discussion_r445518860", "createdAt": "2020-06-25T12:27:12Z", "author": {"login": "shwstppr"}, "path": "packaging/centos7/cloud.spec", "diffHunk": "@@ -279,6 +280,11 @@ install -D server/target/conf/cloudstack-sudoers ${RPM_BUILD_ROOT}%{_sysconfdir}\n touch ${RPM_BUILD_ROOT}%{_localstatedir}/run/%{name}-management.pid\n #install -D server/target/conf/cloudstack-catalina.logrotate ${RPM_BUILD_ROOT}%{_sysconfdir}/logrotate.d/%{name}-catalina\n \n+# Package mysql-connector-python\n+wget -P ${RPM_BUILD_ROOT}%{_datadir}/%{name}-management/setup/wheel https://files.pythonhosted.org/packages/ee/ff/48bde5c0f013094d729fe4b0316ba2a24774b3ff1c52d924a8a4cb04078a/six-1.15.0-py2.py3-none-any.whl\n+wget -P ${RPM_BUILD_ROOT}%{_datadir}/%{name}-management/setup/wheel https://files.pythonhosted.org/packages/28/05/9867ef8eafd12265267bee138fa2c46ebf34a276ea4cbe184cba4c606e8b/protobuf-3.12.2-cp36-cp36m-manylinux1_x86_64.whl\n+wget -P ${RPM_BUILD_ROOT}%{_datadir}/%{name}-management/setup/wheel https://files.pythonhosted.org/packages/d1/53/4cf90d2fe81b9cdb55dc180951bcec44ea8685665f1bdb1412501dc362dd/mysql_connector_python-8.0.20-cp36-cp36m-manylinux1_x86_64.whl\n+", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "663162356c0c497f533028e9dd16a935abe67e34"}, "originalPosition": 76}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NTUyNjMwNw==", "bodyText": "What is the risk of those files not being available during compiling packages and causing issues?", "url": "https://github.com/apache/cloudstack/pull/4068#discussion_r445526307", "createdAt": "2020-06-25T12:40:42Z", "author": {"login": "andrijapanicsb"}, "path": "packaging/centos7/cloud.spec", "diffHunk": "@@ -279,6 +280,11 @@ install -D server/target/conf/cloudstack-sudoers ${RPM_BUILD_ROOT}%{_sysconfdir}\n touch ${RPM_BUILD_ROOT}%{_localstatedir}/run/%{name}-management.pid\n #install -D server/target/conf/cloudstack-catalina.logrotate ${RPM_BUILD_ROOT}%{_sysconfdir}/logrotate.d/%{name}-catalina\n \n+# Package mysql-connector-python\n+wget -P ${RPM_BUILD_ROOT}%{_datadir}/%{name}-management/setup/wheel https://files.pythonhosted.org/packages/ee/ff/48bde5c0f013094d729fe4b0316ba2a24774b3ff1c52d924a8a4cb04078a/six-1.15.0-py2.py3-none-any.whl\n+wget -P ${RPM_BUILD_ROOT}%{_datadir}/%{name}-management/setup/wheel https://files.pythonhosted.org/packages/28/05/9867ef8eafd12265267bee138fa2c46ebf34a276ea4cbe184cba4c606e8b/protobuf-3.12.2-cp36-cp36m-manylinux1_x86_64.whl\n+wget -P ${RPM_BUILD_ROOT}%{_datadir}/%{name}-management/setup/wheel https://files.pythonhosted.org/packages/d1/53/4cf90d2fe81b9cdb55dc180951bcec44ea8685665f1bdb1412501dc362dd/mysql_connector_python-8.0.20-cp36-cp36m-manylinux1_x86_64.whl\n+", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NTUxODg2MA=="}, "originalCommit": {"oid": "663162356c0c497f533028e9dd16a935abe67e34"}, "originalPosition": 76}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NzQwMzI4MA==", "bodyText": "@andrijapanicsb discussed regarding this. We will have to change links once they become unavailable else we won't be able to package python-mysql-connector and it will have to be installed from mysql repo", "url": "https://github.com/apache/cloudstack/pull/4068#discussion_r447403280", "createdAt": "2020-06-30T04:34:07Z", "author": {"login": "shwstppr"}, "path": "packaging/centos7/cloud.spec", "diffHunk": "@@ -279,6 +280,11 @@ install -D server/target/conf/cloudstack-sudoers ${RPM_BUILD_ROOT}%{_sysconfdir}\n touch ${RPM_BUILD_ROOT}%{_localstatedir}/run/%{name}-management.pid\n #install -D server/target/conf/cloudstack-catalina.logrotate ${RPM_BUILD_ROOT}%{_sysconfdir}/logrotate.d/%{name}-catalina\n \n+# Package mysql-connector-python\n+wget -P ${RPM_BUILD_ROOT}%{_datadir}/%{name}-management/setup/wheel https://files.pythonhosted.org/packages/ee/ff/48bde5c0f013094d729fe4b0316ba2a24774b3ff1c52d924a8a4cb04078a/six-1.15.0-py2.py3-none-any.whl\n+wget -P ${RPM_BUILD_ROOT}%{_datadir}/%{name}-management/setup/wheel https://files.pythonhosted.org/packages/28/05/9867ef8eafd12265267bee138fa2c46ebf34a276ea4cbe184cba4c606e8b/protobuf-3.12.2-cp36-cp36m-manylinux1_x86_64.whl\n+wget -P ${RPM_BUILD_ROOT}%{_datadir}/%{name}-management/setup/wheel https://files.pythonhosted.org/packages/d1/53/4cf90d2fe81b9cdb55dc180951bcec44ea8685665f1bdb1412501dc362dd/mysql_connector_python-8.0.20-cp36-cp36m-manylinux1_x86_64.whl\n+", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NTUxODg2MA=="}, "originalCommit": {"oid": "663162356c0c497f533028e9dd16a935abe67e34"}, "originalPosition": 76}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjc3OTQzOTQwOnYy", "diffSide": "RIGHT", "path": "packaging/systemd/cloudstack-management.service", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yNlQwOTozMToxMVrOGpaRnA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yNlQwOTozMToxMVrOGpaRnA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NjA3NTI5Mg==", "bodyText": "For reference https://serverfault.com/a/890085", "url": "https://github.com/apache/cloudstack/pull/4068#discussion_r446075292", "createdAt": "2020-06-26T09:31:11Z", "author": {"login": "shwstppr"}, "path": "packaging/systemd/cloudstack-management.service", "diffHunk": "@@ -35,6 +35,7 @@ EnvironmentFile=/etc/default/cloudstack-management\n WorkingDirectory=/var/log/cloudstack/management\n PIDFile=/var/run/cloudstack-management.pid\n ExecStart=/usr/bin/java $JAVA_DEBUG $JAVA_OPTS -cp $CLASSPATH $BOOTSTRAP_CLASS\n+SuccessExitStatus=143", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "cd5d5698099d704d481dabd39fcc82981f29d53d"}, "originalPosition": 4}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjc4MDYzOTM2OnYy", "diffSide": "RIGHT", "path": "debian/rules", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yNlQxNTo1NToxMFrOGpmFPQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0zMFQwNDozNzowMVrOGqrYEg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NjI2ODczMw==", "bodyText": "Does this needs update?", "url": "https://github.com/apache/cloudstack/pull/4068#discussion_r446268733", "createdAt": "2020-06-26T15:55:10Z", "author": {"login": "andrijapanicsb"}, "path": "debian/rules", "diffHunk": "@@ -6,7 +6,8 @@ SYSCONFDIR = \"/etc\"\n DESTDIR = \"debian/tmp\"\n \n %:\n-\tdh $@ --with python2,systemd\n+\t# TODO : Make it work with python2 also", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "098768710c6800e364f8ee7f991f1923a4d1700a"}, "originalPosition": 5}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NzQwNDA1MA==", "bodyText": "Addressed by David's commit @andrijapanicsb", "url": "https://github.com/apache/cloudstack/pull/4068#discussion_r447404050", "createdAt": "2020-06-30T04:37:01Z", "author": {"login": "shwstppr"}, "path": "debian/rules", "diffHunk": "@@ -6,7 +6,8 @@ SYSCONFDIR = \"/etc\"\n DESTDIR = \"debian/tmp\"\n \n %:\n-\tdh $@ --with python2,systemd\n+\t# TODO : Make it work with python2 also", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NjI2ODczMw=="}, "originalCommit": {"oid": "098768710c6800e364f8ee7f991f1923a4d1700a"}, "originalPosition": 5}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjg4OTQ3NDIzOnYy", "diffSide": "RIGHT", "path": "agent/bindir/libvirtqemuhook.in", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0zMFQwNzoyNzo1MFrOG5XNKw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0zMFQwNzoyNzo1MFrOG5XNKw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MjgwMjIxOQ==", "bodyText": "why is this needed @davidjumani ?", "url": "https://github.com/apache/cloudstack/pull/4068#discussion_r462802219", "createdAt": "2020-07-30T07:27:50Z", "author": {"login": "DaanHoogland"}, "path": "agent/bindir/libvirtqemuhook.in", "diffHunk": "@@ -76,7 +76,7 @@ def handleMigrateBegin():\n                 continue\n             newBrName = \"br\" + phyDev + \"-\" + vlanId\n             source.setAttribute(\"bridge\", newBrName)\n-        print(domain.toxml())\n+        print((domain.toxml()))", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "8dec6a83ebe35cb0e2428d3595975ff16c4e4f86"}, "originalPosition": 20}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjg4OTQ5OTI2OnYy", "diffSide": "RIGHT", "path": "scripts/vm/hypervisor/vmware/discover_networks.py", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0zMFQwNzozNTo1NVrOG5XcoA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0zMFQwNzozNTo1NVrOG5XcoA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MjgwNjE3Ng==", "bodyText": "why not remove this line?", "url": "https://github.com/apache/cloudstack/pull/4068#discussion_r462806176", "createdAt": "2020-07-30T07:35:55Z", "author": {"login": "DaanHoogland"}, "path": "scripts/vm/hypervisor/vmware/discover_networks.py", "diffHunk": "@@ -16,7 +16,7 @@\n # specific language governing permissions and limitations\n # under the License.\n \n-from __future__ import print_function\n+", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "8dec6a83ebe35cb0e2428d3595975ff16c4e4f86"}, "originalPosition": 5}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjg4OTUxMjMxOnYy", "diffSide": "RIGHT", "path": "test/integration/smoke/test_vm_life_cycle.py", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0zMFQwNzozOTozNlrOG5XkZQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0zMFQwNzozOTozNlrOG5XkZQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MjgwODE2NQ==", "bodyText": "meaning if xenserver try again?", "url": "https://github.com/apache/cloudstack/pull/4068#discussion_r462808165", "createdAt": "2020-07-30T07:39:36Z", "author": {"login": "DaanHoogland"}, "path": "test/integration/smoke/test_vm_life_cycle.py", "diffHunk": "@@ -850,11 +875,19 @@ def setUpClass(cls):\n             0].__dict__\n         cls.management_ip = cls.config.__dict__[\"mgtSvr\"][0].__dict__[\"mgtSvrIp\"]\n \n-        template = get_template(\n-            cls.apiclient,\n-            cls.zone.id,\n-            cls.services[\"ostype\"]\n-        )\n+        template = FAILED\n+        if cls.hypervisor.lower() in [\"xenserver\"]:\n+            template = get_test_template(\n+                cls.apiclient,\n+                cls.zone.id,\n+                cls.hypervisor\n+            )\n+        if template == FAILED:", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "8dec6a83ebe35cb0e2428d3595975ff16c4e4f86"}, "originalPosition": 186}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjg4OTUxNDExOnYy", "diffSide": "RIGHT", "path": "test/integration/smoke/test_vm_life_cycle.py", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0zMFQwNzo0MDoxMVrOG5Xlkw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0zMFQwNzo0MDoxMVrOG5Xlkw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MjgwODQ2Nw==", "bodyText": "same code as above make a method?", "url": "https://github.com/apache/cloudstack/pull/4068#discussion_r462808467", "createdAt": "2020-07-30T07:40:11Z", "author": {"login": "DaanHoogland"}, "path": "test/integration/smoke/test_vm_life_cycle.py", "diffHunk": "@@ -1122,11 +1155,19 @@ def setUpClass(cls):\n             0].__dict__\n         cls.management_ip = cls.config.__dict__[\"mgtSvr\"][0].__dict__[\"mgtSvrIp\"]\n \n-        template = get_template(\n-            cls.apiclient,\n-            cls.zone.id,\n-            cls.services[\"ostype\"]\n-        )\n+        template = FAILED\n+        if cls.hypervisor.lower() in [\"xenserver\"]:\n+            template = get_test_template(\n+                cls.apiclient,\n+                cls.zone.id,\n+                cls.hypervisor\n+            )\n+        if template == FAILED:", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "8dec6a83ebe35cb0e2428d3595975ff16c4e4f86"}, "originalPosition": 211}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjg4OTUxNDUyOnYy", "diffSide": "RIGHT", "path": "test/integration/smoke/test_vm_life_cycle.py", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0zMFQwNzo0MDoxOVrOG5Xl1w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0zMFQwNzo0MDoxOVrOG5Xl1w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MjgwODUzNQ==", "bodyText": "3rd", "url": "https://github.com/apache/cloudstack/pull/4068#discussion_r462808535", "createdAt": "2020-07-30T07:40:19Z", "author": {"login": "DaanHoogland"}, "path": "test/integration/smoke/test_vm_life_cycle.py", "diffHunk": "@@ -1334,11 +1375,19 @@ def setUpClass(cls):\n             0].__dict__\n         cls.management_ip = cls.config.__dict__[\"mgtSvr\"][0].__dict__[\"mgtSvrIp\"]\n \n-        template = get_template(\n-            cls.apiclient,\n-            cls.zone.id,\n-            cls.services[\"ostype\"]\n-        )\n+        template = FAILED\n+        if cls.hypervisor.lower() in [\"xenserver\"]:\n+            template = get_test_template(\n+                cls.apiclient,\n+                cls.zone.id,\n+                cls.hypervisor\n+            )\n+        if template == FAILED:", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "8dec6a83ebe35cb0e2428d3595975ff16c4e4f86"}, "originalPosition": 236}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjg4OTUxNTY0OnYy", "diffSide": "RIGHT", "path": "test/integration/smoke/test_vm_life_cycle.py", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0zMFQwNzo0MDo0MVrOG5XmiA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0zMFQwNzo0MDo0MVrOG5XmiA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MjgwODcxMg==", "bodyText": "4th now it really starts paying off", "url": "https://github.com/apache/cloudstack/pull/4068#discussion_r462808712", "createdAt": "2020-07-30T07:40:41Z", "author": {"login": "DaanHoogland"}, "path": "test/integration/smoke/test_vm_life_cycle.py", "diffHunk": "@@ -1533,13 +1582,20 @@ def setUpClass(cls):\n         cls.domain = get_domain(cls.apiclient)\n         cls.zone = get_zone(cls.apiclient, cls.testClient.getZoneForTests())\n         cls.services['mode'] = cls.zone.networktype\n-\n-        cls.template = get_template(\n-            cls.apiclient,\n-            cls.zone.id,\n-            cls.services[\"ostype\"],\n-            hypervisor=cls.hypervisor.lower()\n-        )\n+        template = FAILED\n+        if cls.hypervisor.lower() in [\"xenserver\"]:\n+            cls.template = get_test_template(\n+                cls.apiclient,\n+                cls.zone.id,\n+                cls.hypervisor\n+            )\n+        if cls.template == FAILED:", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "8dec6a83ebe35cb0e2428d3595975ff16c4e4f86"}, "originalPosition": 263}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjg4OTUxNzM4OnYy", "diffSide": "RIGHT", "path": "test/integration/smoke/test_vm_snapshots.py", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0zMFQwNzo0MTowOVrOG5Xnjg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0zMFQwNzo0MTowOVrOG5Xnjg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MjgwODk3NA==", "bodyText": "and the same code in a different file...", "url": "https://github.com/apache/cloudstack/pull/4068#discussion_r462808974", "createdAt": "2020-07-30T07:41:09Z", "author": {"login": "DaanHoogland"}, "path": "test/integration/smoke/test_vm_snapshots.py", "diffHunk": "@@ -50,11 +51,19 @@ def setUpClass(cls):\n         cls.domain = get_domain(cls.apiclient)\n         cls.zone = get_zone(cls.apiclient, testClient.getZoneForTests())\n \n-        template = get_template(\n-            cls.apiclient,\n-            cls.zone.id,\n-            cls.services[\"ostype\"]\n-        )\n+        template = FAILED\n+        if cls.hypervisor.lower() in [\"xenserver\"]:\n+            template = get_test_template(\n+                cls.apiclient,\n+                cls.zone.id,\n+                cls.hypervisor\n+            )\n+        if template == FAILED:", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "8dec6a83ebe35cb0e2428d3595975ff16c4e4f86"}, "originalPosition": 24}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjg4OTUxNzkxOnYy", "diffSide": "RIGHT", "path": "test/integration/smoke/test_vm_snapshots.py", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0zMFQwNzo0MToyMVrOG5Xn3w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0zMFQwNzo0MToyMVrOG5Xn3w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MjgwOTA1NQ==", "bodyText": "6", "url": "https://github.com/apache/cloudstack/pull/4068#discussion_r462809055", "createdAt": "2020-07-30T07:41:21Z", "author": {"login": "DaanHoogland"}, "path": "test/integration/smoke/test_vm_snapshots.py", "diffHunk": "@@ -316,11 +325,20 @@ def setUpClass(cls):\n                 cls.testClient.getZoneForTests()\n             )\n             cls.services[\"small\"][\"zoneid\"] = cls.zone.id\n-            cls.template = get_template(\n-                cls.api_client,\n-                cls.zone.id,\n-                cls.services[\"ostype\"]\n-            )\n+\n+            cls.template = FAILED\n+            if cls.hypervisor.lower() in [\"xenserver\"]:\n+                cls.template = get_test_template(\n+                    cls.api_client,\n+                    cls.zone.id,\n+                    cls.hypervisor\n+                )\n+            if cls.template == FAILED:", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "8dec6a83ebe35cb0e2428d3595975ff16c4e4f86"}, "originalPosition": 59}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjg4OTUxOTM3OnYy", "diffSide": "RIGHT", "path": "test/integration/smoke/test_volumes.py", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0zMFQwNzo0MTo0NFrOG5Xoxg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0zMFQwNzo0MTo0NFrOG5Xoxg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MjgwOTI4Ng==", "bodyText": "3rd file #7", "url": "https://github.com/apache/cloudstack/pull/4068#discussion_r462809286", "createdAt": "2020-07-30T07:41:44Z", "author": {"login": "DaanHoogland"}, "path": "test/integration/smoke/test_volumes.py", "diffHunk": "@@ -83,11 +84,20 @@ def setUpClass(cls):\n                                     cls.services[\"disk_offering\"],\n                                     custom=True\n                                     )\n-        template = get_template(\n-                            cls.apiclient,\n-                            cls.zone.id,\n-                            cls.services[\"ostype\"]\n-                            )\n+\n+        template = FAILED\n+        if cls.hypervisor.lower() in [\"xenserver\"]:\n+            template = get_test_template(\n+                cls.apiclient,\n+                cls.zone.id,\n+                cls.hypervisor\n+            )\n+        if template == FAILED:", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "8dec6a83ebe35cb0e2428d3595975ff16c4e4f86"}, "originalPosition": 28}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjg4OTUyMDM2OnYy", "diffSide": "RIGHT", "path": "test/integration/smoke/test_volumes.py", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0zMFQwNzo0MjowMFrOG5XpYw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0zMFQwNzo0MjowMFrOG5XpYw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MjgwOTQ0Mw==", "bodyText": "you get the message by now", "url": "https://github.com/apache/cloudstack/pull/4068#discussion_r462809443", "createdAt": "2020-07-30T07:42:00Z", "author": {"login": "DaanHoogland"}, "path": "test/integration/smoke/test_volumes.py", "diffHunk": "@@ -302,17 +312,25 @@ def setUpClass(cls):\n                                     custom=True\n                                     )\n \n-        template = get_template(\n-                            cls.apiclient,\n-                            cls.zone.id,\n-                            cls.services[\"ostype\"]\n-                            )\n-        if template == FAILED:\n+        cls.template = FAILED\n+        if cls.hypervisor.lower() in [\"xenserver\"]:\n+            cls.template = get_test_template(\n+                cls.apiclient,\n+                cls.zone.id,\n+                cls.hypervisor\n+            )\n+        if cls.template == FAILED:", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "8dec6a83ebe35cb0e2428d3595975ff16c4e4f86"}, "originalPosition": 54}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjkxMjU2MTcwOnYy", "diffSide": "RIGHT", "path": "setup/db/create-database-simulator.sql", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0wNlQxMDowMzo1NVrOG8tB9Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0wN1QwNDoyMTowNlrOG9L98Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NjMwNTUyNQ==", "bodyText": "@shwstppr I assume a password for this user is set elsewhere?", "url": "https://github.com/apache/cloudstack/pull/4068#discussion_r466305525", "createdAt": "2020-08-06T10:03:55Z", "author": {"login": "andrijapanicsb"}, "path": "setup/db/create-database-simulator.sql", "diffHunk": "@@ -20,8 +20,8 @@ DROP DATABASE IF EXISTS `simulator`;\n \n CREATE DATABASE `simulator`;\n \n-GRANT ALL ON simulator.* to cloud@`localhost` identified by 'cloud';\n-GRANT ALL ON simulator.* to cloud@`%` identified by 'cloud';\n+GRANT ALL ON simulator.* to cloud@`localhost`;\n+GRANT ALL ON simulator.* to cloud@`%`;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "38c07f34282bd27b1eac355c1d513a05eb283768"}, "originalPosition": 7}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NjgxMjQwMQ==", "bodyText": "@andrijapanicsb User cloud with the password will already be created in create-database.sql b895cf9#diff-ca79fa3d84677eec693e98f41aca3a0eR58-R59", "url": "https://github.com/apache/cloudstack/pull/4068#discussion_r466812401", "createdAt": "2020-08-07T04:21:06Z", "author": {"login": "shwstppr"}, "path": "setup/db/create-database-simulator.sql", "diffHunk": "@@ -20,8 +20,8 @@ DROP DATABASE IF EXISTS `simulator`;\n \n CREATE DATABASE `simulator`;\n \n-GRANT ALL ON simulator.* to cloud@`localhost` identified by 'cloud';\n-GRANT ALL ON simulator.* to cloud@`%` identified by 'cloud';\n+GRANT ALL ON simulator.* to cloud@`localhost`;\n+GRANT ALL ON simulator.* to cloud@`%`;", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NjMwNTUyNQ=="}, "originalCommit": {"oid": "38c07f34282bd27b1eac355c1d513a05eb283768"}, "originalPosition": 7}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjkyOTU0NDg4OnYy", "diffSide": "RIGHT", "path": "agent/bindir/rolling-maintenance.in", "isResolved": false, "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xMVQyMToxMDo1NlrOG_JX4Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xMlQwNzo0NjowN1rOG_Vtow==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2ODg2NzA0MQ==", "bodyText": "On line 79 and 83/84 - the error is thrown  \"Unexpected error on systemd service: write() argument must be str, not bytes\".\nThis needs to be fixed, and also, the output given in the API and also inside the rolling-maintenance.log (on the KVM host) is prepended with letter b, and appended with    \\n", "url": "https://github.com/apache/cloudstack/pull/4068#discussion_r468867041", "createdAt": "2020-08-11T21:10:56Z", "author": {"login": "andrijapanicsb"}, "path": "agent/bindir/rolling-maintenance.in", "diffHunk": "@@ -1,4 +1,4 @@\n-#!/usr/bin/python\n+#!/usr/bin/python3", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "38c07f34282bd27b1eac355c1d513a05eb283768"}, "originalPosition": 2}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2ODg2ODA2MQ==", "bodyText": "i.e. 20:50:23,239 rolling-maintenance INFO b'preflight stage' (from the log)\nor\n\"output\": \"b'This is Maintenance Stage'\\n\", (from the API output)", "url": "https://github.com/apache/cloudstack/pull/4068#discussion_r468868061", "createdAt": "2020-08-11T21:13:08Z", "author": {"login": "andrijapanicsb"}, "path": "agent/bindir/rolling-maintenance.in", "diffHunk": "@@ -1,4 +1,4 @@\n-#!/usr/bin/python\n+#!/usr/bin/python3", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2ODg2NzA0MQ=="}, "originalCommit": {"oid": "38c07f34282bd27b1eac355c1d513a05eb283768"}, "originalPosition": 2}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2OTA2OTIxOQ==", "bodyText": "Latest commit should solve this", "url": "https://github.com/apache/cloudstack/pull/4068#discussion_r469069219", "createdAt": "2020-08-12T07:46:07Z", "author": {"login": "shwstppr"}, "path": "agent/bindir/rolling-maintenance.in", "diffHunk": "@@ -1,4 +1,4 @@\n-#!/usr/bin/python\n+#!/usr/bin/python3", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2ODg2NzA0MQ=="}, "originalCommit": {"oid": "38c07f34282bd27b1eac355c1d513a05eb283768"}, "originalPosition": 2}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3891, "cost": 1, "resetAt": "2021-11-12T11:18:39Z"}}}