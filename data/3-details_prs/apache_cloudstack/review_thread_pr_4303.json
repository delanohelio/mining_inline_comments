{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDc4NjQ5NjEy", "number": 4303, "reviewThreads": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0wNFQwODoxMjo1NFrOEgSY1g==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0wNFQwODoxMzo1NVrOEgSaVg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzAyMjkxMTU4OnYy", "diffSide": "RIGHT", "path": "scripts/vm/network/security_group.py", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0wNFQwODoxMjo1NFrOHNEGcw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0wNFQwODo0MToxOVrOHNFCHg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MzQ2MDcyMw==", "bodyText": "Maybe better to change this to:\nif not rules:\nThat captures the None and empty string case right away.", "url": "https://github.com/apache/cloudstack/pull/4303#discussion_r483460723", "createdAt": "2020-09-04T08:12:54Z", "author": {"login": "wido"}, "path": "scripts/vm/network/security_group.py", "diffHunk": "@@ -510,7 +510,7 @@ def check_default_network_rules(vm_name, vm_id, vm_ip, vm_ip6, vm_mac, vif, brna\n         rules = execute(\"iptables-save |grep -w %s |grep -w %s |grep -w %s\" % (brfw, vif, vmchain_default))\n     except:\n         rules = None\n-    if rules is None or rules is \"\":\n+    if rules is None or rules == \"\":", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "76f0e3fa1a295f27d15d87751bd3fd148ea0f1c3"}, "originalPosition": 14}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MzQ3NTk5OA==", "bodyText": "good, thanks @wido", "url": "https://github.com/apache/cloudstack/pull/4303#discussion_r483475998", "createdAt": "2020-09-04T08:41:19Z", "author": {"login": "weizhouapache"}, "path": "scripts/vm/network/security_group.py", "diffHunk": "@@ -510,7 +510,7 @@ def check_default_network_rules(vm_name, vm_id, vm_ip, vm_ip6, vm_mac, vif, brna\n         rules = execute(\"iptables-save |grep -w %s |grep -w %s |grep -w %s\" % (brfw, vif, vmchain_default))\n     except:\n         rules = None\n-    if rules is None or rules is \"\":\n+    if rules is None or rules == \"\":", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MzQ2MDcyMw=="}, "originalCommit": {"oid": "76f0e3fa1a295f27d15d87751bd3fd148ea0f1c3"}, "originalPosition": 14}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzAyMjkxNTQyOnYy", "diffSide": "RIGHT", "path": "scripts/vm/network/security_group.py", "isResolved": false, "comments": {"totalCount": 5, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0wNFQwODoxMzo1NVrOHNEIrA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wMS0xOVQwMTo0MzoxOVrOIV7afQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MzQ2MTI5Mg==", "bodyText": "Do we know what changed in Ubuntu 20.04? As the '-o' flag should make it stable to use on the CLI", "url": "https://github.com/apache/cloudstack/pull/4303#discussion_r483461292", "createdAt": "2020-09-04T08:13:55Z", "author": {"login": "wido"}, "path": "scripts/vm/network/security_group.py", "diffHunk": "@@ -185,7 +185,7 @@ def destroy_network_rules_for_nic(vm_name, vm_ip, vm_mac, vif, sec_ips):\n         logging.debug(\"Ignoring failure to delete ebtable rules for vm: \" + vm_name)\n \n def get_bridge_physdev(brname):\n-    physdev = execute(\"bridge -o link show | awk '/master %s / && !/^[0-9]+: vnet/ {print $2}' | head -1\" % brname)\n+    physdev = execute(\"bridge -o link show | awk '/master %s / && !/^[0-9]+: vnet/ {print $2}' | head -1 | cut -d ':' -f1\" % brname)", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "76f0e3fa1a295f27d15d87751bd3fd148ea0f1c3"}, "originalPosition": 5}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MzQ3NjgzNw==", "bodyText": "@wido here is an example\nin ubuntu 16.04\nroot@node42:~# bridge -o link show\n2: eth0 state UP : <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 master cloudbr0 state forwarding priority 32 cost 100\n\nin ubuntu 20.04\nroot@node62:~# bridge -o link show\n2: ens3: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 master cloudbr0 state forwarding priority 32 cost 100", "url": "https://github.com/apache/cloudstack/pull/4303#discussion_r483476837", "createdAt": "2020-09-04T08:42:49Z", "author": {"login": "weizhouapache"}, "path": "scripts/vm/network/security_group.py", "diffHunk": "@@ -185,7 +185,7 @@ def destroy_network_rules_for_nic(vm_name, vm_ip, vm_mac, vif, sec_ips):\n         logging.debug(\"Ignoring failure to delete ebtable rules for vm: \" + vm_name)\n \n def get_bridge_physdev(brname):\n-    physdev = execute(\"bridge -o link show | awk '/master %s / && !/^[0-9]+: vnet/ {print $2}' | head -1\" % brname)\n+    physdev = execute(\"bridge -o link show | awk '/master %s / && !/^[0-9]+: vnet/ {print $2}' | head -1 | cut -d ':' -f1\" % brname)", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MzQ2MTI5Mg=="}, "originalCommit": {"oid": "76f0e3fa1a295f27d15d87751bd3fd148ea0f1c3"}, "originalPosition": 5}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MzU0NjMwMA==", "bodyText": "Should we use ip (iproute2) instead of old tools?", "url": "https://github.com/apache/cloudstack/pull/4303#discussion_r483546300", "createdAt": "2020-09-04T11:01:22Z", "author": {"login": "rhtyd"}, "path": "scripts/vm/network/security_group.py", "diffHunk": "@@ -185,7 +185,7 @@ def destroy_network_rules_for_nic(vm_name, vm_ip, vm_mac, vif, sec_ips):\n         logging.debug(\"Ignoring failure to delete ebtable rules for vm: \" + vm_name)\n \n def get_bridge_physdev(brname):\n-    physdev = execute(\"bridge -o link show | awk '/master %s / && !/^[0-9]+: vnet/ {print $2}' | head -1\" % brname)\n+    physdev = execute(\"bridge -o link show | awk '/master %s / && !/^[0-9]+: vnet/ {print $2}' | head -1 | cut -d ':' -f1\" % brname)", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MzQ2MTI5Mg=="}, "originalCommit": {"oid": "76f0e3fa1a295f27d15d87751bd3fd148ea0f1c3"}, "originalPosition": 5}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MzU2MDQ1NQ==", "bodyText": "bridge is a part of iproute2. The old tool is called 'brctl'", "url": "https://github.com/apache/cloudstack/pull/4303#discussion_r483560455", "createdAt": "2020-09-04T11:34:55Z", "author": {"login": "wido"}, "path": "scripts/vm/network/security_group.py", "diffHunk": "@@ -185,7 +185,7 @@ def destroy_network_rules_for_nic(vm_name, vm_ip, vm_mac, vif, sec_ips):\n         logging.debug(\"Ignoring failure to delete ebtable rules for vm: \" + vm_name)\n \n def get_bridge_physdev(brname):\n-    physdev = execute(\"bridge -o link show | awk '/master %s / && !/^[0-9]+: vnet/ {print $2}' | head -1\" % brname)\n+    physdev = execute(\"bridge -o link show | awk '/master %s / && !/^[0-9]+: vnet/ {print $2}' | head -1 | cut -d ':' -f1\" % brname)", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MzQ2MTI5Mg=="}, "originalCommit": {"oid": "76f0e3fa1a295f27d15d87751bd3fd148ea0f1c3"}, "originalPosition": 5}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1OTg2NDQ0NQ==", "bodyText": "there is the trick to use ls /sys/class/net to get the exact interface names", "url": "https://github.com/apache/cloudstack/pull/4303#discussion_r559864445", "createdAt": "2021-01-19T01:43:19Z", "author": {"login": "abdelouahabb"}, "path": "scripts/vm/network/security_group.py", "diffHunk": "@@ -185,7 +185,7 @@ def destroy_network_rules_for_nic(vm_name, vm_ip, vm_mac, vif, sec_ips):\n         logging.debug(\"Ignoring failure to delete ebtable rules for vm: \" + vm_name)\n \n def get_bridge_physdev(brname):\n-    physdev = execute(\"bridge -o link show | awk '/master %s / && !/^[0-9]+: vnet/ {print $2}' | head -1\" % brname)\n+    physdev = execute(\"bridge -o link show | awk '/master %s / && !/^[0-9]+: vnet/ {print $2}' | head -1 | cut -d ':' -f1\" % brname)", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MzQ2MTI5Mg=="}, "originalCommit": {"oid": "76f0e3fa1a295f27d15d87751bd3fd148ea0f1c3"}, "originalPosition": 5}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3809, "cost": 1, "resetAt": "2021-11-12T11:18:39Z"}}}