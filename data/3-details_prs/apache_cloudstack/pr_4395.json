{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTAxMjgzNzE0", "number": 4395, "title": "support for data migration of incremental snaps on xen", "bodyText": "Description\nPR attempts to fix and enhance the following:\n\nOn Xen, there are instances when the child snapshot is basically only a database entry with the file path pointing to the parent snapshot - handle this scenario such that a new entry is created for such incremental snapshots and delete the snapshot from source datastore during data migration\nWrt scaling down of SSVM, revised the logic to prevent quick scaling down of the SSVMs\n\nTypes of changes\n\n\n Breaking change (fix or feature that would cause existing functionality to change)\n New feature (non-breaking change which adds functionality)\n Bug fix (non-breaking change which fixes an issue)\n Enhancement (improves an existing feature and functionality)\n Cleanup (Code refactoring and cleanup, that may add test cases)\n\nScreenshots (if appropriate):\nHow Has This Been Tested?\n\nConducted tests on xen of files\nTests on xen for snapshots with child snaps having install path same as that as parent snapshot\n\nBefore Migration:\n-----------------------\n\nMariaDB [cloud]> select * from snapshot_store_ref where store_role = 'Image' and volume_id =11 and state <> 'Destroyed' order by parent_snapshot_id\\G\n*************************** 1. row ***************************\n                id: 497\n          store_id: 1\n       snapshot_id: 63\n           created: 2020-10-10 07:00:08\n      last_updated: NULL\n            job_id: NULL\n        store_role: Image\n              size: 52428800\n     physical_size: 52531712\nparent_snapshot_id: 0\n      install_path: snapshots/2/11/d05a2c2f-6885-4932-b5a0-d11f82129a48.vhd\n             state: Ready\n      update_count: 2\n           ref_cnt: 0\n           updated: 2020-10-10 13:25:24\n         volume_id: 11\n*************************** 2. row ***************************\n                id: 375\n          store_id: 1\n       snapshot_id: 67\n           created: 2020-10-10 07:00:09\n      last_updated: NULL\n            job_id: NULL\n        store_role: Image\n              size: 52428800\n     physical_size: 0\nparent_snapshot_id: 63\n      install_path: snapshots/2/11/d05a2c2f-6885-4932-b5a0-d11f82129a48.vhd\n             state: Ready\n      update_count: 2\n           ref_cnt: 0\n           updated: 2020-10-08 06:54:57\n         volume_id: 11\n*************************** 3. row ***************************\n                id: 381\n          store_id: 1\n       snapshot_id: 70\n           created: 2020-10-10 07:00:11\n      last_updated: NULL\n            job_id: NULL\n        store_role: Image\n              size: 52428800\n     physical_size: 0\nparent_snapshot_id: 67\n      install_path: snapshots/2/11/d05a2c2f-6885-4932-b5a0-d11f82129a48.vhd\n             state: Ready\n      update_count: 2\n           ref_cnt: 0\n           updated: 2020-10-08 06:55:14\n         volume_id: 11\n*************************** 4. row ***************************\n                id: 472\n          store_id: 1\n       snapshot_id: 74\n           created: 2020-10-10 07:32:57\n      last_updated: NULL\n            job_id: NULL\n        store_role: Image\n              size: 52428800\n     physical_size: 0\nparent_snapshot_id: 70\n      install_path: snapshots/2/11/d05a2c2f-6885-4932-b5a0-d11f82129a48.vhd\n             state: Ready\n      update_count: 2\n           ref_cnt: 0\n           updated: 2020-10-10 07:32:57\n         volume_id: 11\n\nAfter migration:\n---------------\n\nMariaDB [cloud]> select * from snapshot_store_ref where store_role = 'Image' and volume_id =11 and state <> 'Destroyed' order by parent_snapshot_id\\G\n*************************** 1. row ***************************\n                id: 510\n          store_id: 5\n       snapshot_id: 63\n           created: 2020-10-10 07:00:08\n      last_updated: NULL\n            job_id: NULL\n        store_role: Image\n              size: 52428800\n     physical_size: 52531712\nparent_snapshot_id: 0\n      install_path: snapshots/2/11/d05a2c2f-6885-4932-b5a0-d11f82129a48.vhd\n             state: Ready\n      update_count: 2\n           ref_cnt: 0\n           updated: 2020-10-12 04:11:10\n         volume_id: 11\n*************************** 2. row ***************************\n                id: 375\n          store_id: 5\n       snapshot_id: 67\n           created: 2020-10-10 07:00:09\n      last_updated: NULL\n            job_id: NULL\n        store_role: Image\n              size: 52428800\n     physical_size: 0\nparent_snapshot_id: 63\n      install_path: snapshots/2/11/d05a2c2f-6885-4932-b5a0-d11f82129a48.vhd\n             state: Ready\n      update_count: 2\n           ref_cnt: 0\n           updated: 2020-10-08 06:54:57\n         volume_id: 11\n*************************** 3. row ***************************\n                id: 381\n          store_id: 5\n       snapshot_id: 70\n           created: 2020-10-10 07:00:11\n      last_updated: NULL\n            job_id: NULL\n        store_role: Image\n              size: 52428800\n     physical_size: 0\nparent_snapshot_id: 67\n      install_path: snapshots/2/11/d05a2c2f-6885-4932-b5a0-d11f82129a48.vhd\n             state: Ready\n      update_count: 2\n           ref_cnt: 0\n           updated: 2020-10-08 06:55:14\n         volume_id: 11\n*************************** 4. row ***************************\n                id: 472\n          store_id: 5\n       snapshot_id: 74\n           created: 2020-10-10 07:32:57\n      last_updated: NULL\n            job_id: NULL\n        store_role: Image\n              size: 52428800\n     physical_size: 0\nparent_snapshot_id: 70\n      install_path: snapshots/2/11/d05a2c2f-6885-4932-b5a0-d11f82129a48.vhd\n             state: Ready\n      update_count: 2\n           ref_cnt: 0\n           updated: 2020-10-10 07:32:57\n         volume_id: 11\n\n\n\nTested on xen, vmware and KVM\nTests for SSVM scale down:\nUpdated following global setting values:\nsecstorage.capacity.standby: 4\nsecstorage.session.max: 10\n\nAdded 7 entries to the cmd_exec_log table, to simulate scaling up operation - Successfully scaled - the new SSVM spawned continues to exist until the number of cmds drops below threshold\nDeleted entries from cmd_exec_log table, such that only 4 entries were present in the table - successfully triggered scale down - as the total number of cmds in the table has dropped below half the defined max limit (10/2 = 5)\nSimulated another scale up operation by adding entries to the cmd_exec log table, added entries to the second (new) SSVM however the total number of commands in the table is below threshold - does NOT scale down SSVM as a command is running on it - as expected", "createdAt": "2020-10-12T04:15:22Z", "url": "https://github.com/apache/cloudstack/pull/4395", "merged": true, "mergeCommit": {"oid": "0d487fc8c93037dc8625e7d811a0fb458825e9c3"}, "closed": true, "closedAt": "2020-10-17T20:45:11Z", "author": {"login": "Pearl1594"}, "timelineItems": {"totalCount": 17, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdR2P4VAH2gAyNTAxMjgzNzE0Ojg5Y2M1NWFmMzVjOTE5OWE5ODNiYTMyYmYzNjg4ZWU2ZjVjYTVlZDk=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdS_ac5gH2gAyNTAxMjgzNzE0OjczMzJjZTU2NGQ0OWI3MzkyOGJmMWNlMmM4MTcwOTllYTI0NmFmNjQ=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "89cc55af35c9199a983ba32bf3688ee6f5ca5ed9", "author": {"user": null}, "url": "https://github.com/apache/cloudstack/commit/89cc55af35c9199a983ba32bf3688ee6f5ca5ed9", "committedDate": "2020-10-12T16:06:10Z", "message": "support for handling incremental snaps (on DB entries) on xen"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "3ca756b65f9c2b7ea19303cc0c66e78a9a51d970", "author": {"user": null}, "url": "https://github.com/apache/cloudstack/commit/3ca756b65f9c2b7ea19303cc0c66e78a9a51d970", "committedDate": "2020-10-11T15:49:10Z", "message": "support for handling incremental snaps (on DB entries) on xen"}, "afterCommit": {"oid": "89cc55af35c9199a983ba32bf3688ee6f5ca5ed9", "author": {"user": null}, "url": "https://github.com/apache/cloudstack/commit/89cc55af35c9199a983ba32bf3688ee6f5ca5ed9", "committedDate": "2020-10-12T16:06:10Z", "message": "support for handling incremental snaps (on DB entries) on xen"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTA4OTYzMzc4", "url": "https://github.com/apache/cloudstack/pull/4395#pullrequestreview-508963378", "createdAt": "2020-10-15T05:39:18Z", "commit": {"oid": "89cc55af35c9199a983ba32bf3688ee6f5ca5ed9"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTA5MTUwNTEx", "url": "https://github.com/apache/cloudstack/pull/4395#pullrequestreview-509150511", "createdAt": "2020-10-15T08:43:24Z", "commit": {"oid": "89cc55af35c9199a983ba32bf3688ee6f5ca5ed9"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xNVQwODo0MzoyNFrOHh8Pcg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xNVQwODo0MzoyNFrOHh8Pcg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNTM1MjA1MA==", "bodyText": "@Pearl1594 better use if-else / switch-case. The control will come here even when destData is of type SnapshotInfo. If this method is being called for any other destData instance, better add a debug log for unsupported instance.", "url": "https://github.com/apache/cloudstack/pull/4395#discussion_r505352050", "createdAt": "2020-10-15T08:43:24Z", "author": {"login": "sureshanaparti"}, "path": "engine/storage/image/src/main/java/org/apache/cloudstack/storage/image/SecondaryStorageServiceImpl.java", "diffHunk": "@@ -198,6 +204,39 @@ protected Void migrateDataCallBack(AsyncCallbackDispatcher<SecondaryStorageServi\n         return null;\n     }\n \n+    private void updateDataObject(DataObject srcData, DataObject destData) {\n+        if (destData instanceof SnapshotInfo) {\n+            SnapshotDataStoreVO snapshotStore = snapshotStoreDao.findBySourceSnapshot(srcData.getId(), DataStoreRole.Image);\n+            SnapshotDataStoreVO destSnapshotStore = snapshotStoreDao.findBySnapshot(srcData.getId(), DataStoreRole.Image);\n+            if (snapshotStore != null && destSnapshotStore != null) {\n+                destSnapshotStore.setPhysicalSize(snapshotStore.getPhysicalSize());\n+                destSnapshotStore.setCreated(snapshotStore.getCreated());\n+                if (snapshotStore.getParentSnapshotId() != destSnapshotStore.getParentSnapshotId()) {\n+                    destSnapshotStore.setParentSnapshotId(snapshotStore.getParentSnapshotId());\n+                }\n+                snapshotStoreDao.update(destSnapshotStore.getId(), destSnapshotStore);\n+            }\n+        }\n+\n+        if (destData instanceof VolumeInfo) {\n+            VolumeDataStoreVO srcVolume = volumeDataStoreDao.findByStoreVolume(srcData.getDataStore().getId(), srcData.getId());\n+            VolumeDataStoreVO destVolume = volumeDataStoreDao.findByStoreVolume(destData.getDataStore().getId(), destData.getId());\n+            if (srcVolume != null && destVolume != null) {\n+                destVolume.setPhysicalSize(srcVolume.getPhysicalSize());\n+                destVolume.setCreated(srcVolume.getCreated());\n+                volumeDataStoreDao.update(destVolume.getId(), destVolume);\n+            }\n+        }\n+\n+        if (destData instanceof TemplateInfo) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "89cc55af35c9199a983ba32bf3688ee6f5ca5ed9"}, "originalPosition": 94}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTA5MTYwMTYy", "url": "https://github.com/apache/cloudstack/pull/4395#pullrequestreview-509160162", "createdAt": "2020-10-15T08:54:31Z", "commit": {"oid": "89cc55af35c9199a983ba32bf3688ee6f5ca5ed9"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xNVQwODo1NDozMlrOHh9LCQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xNVQwODo1NDozMlrOHh9LCQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNTM2NzMwNQ==", "bodyText": "@Pearl1594 seems epId is no longer required for the check here. Can check with empty epIds ?  for end point, can use the first item from this list?", "url": "https://github.com/apache/cloudstack/pull/4395#discussion_r505367305", "createdAt": "2020-10-15T08:54:32Z", "author": {"login": "sureshanaparti"}, "path": "engine/storage/src/main/java/org/apache/cloudstack/storage/image/BaseImageStoreDriverImpl.java", "diffHunk": "@@ -391,12 +391,16 @@ public void copyAsync(DataObject srcdata, DataObject destData, AsyncCompletionCa\n     private Answer sendToLeastBusyEndpoint(List<EndPoint> eps, CopyCommand cmd) {\n         Answer answer = null;\n         EndPoint endPoint = null;\n-        Long epId = ssvmWithLeastMigrateJobs();\n+        List<Long> epIds = ssvmWithLeastMigrateJobs();\n+        Long epId = null;\n+        if (!epIds.isEmpty()) {\n+            epId = epIds.get(0);\n+        }\n         if (epId == null) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "89cc55af35c9199a983ba32bf3688ee6f5ca5ed9"}, "originalPosition": 10}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTA5MzEwMDQw", "url": "https://github.com/apache/cloudstack/pull/4395#pullrequestreview-509310040", "createdAt": "2020-10-15T12:11:41Z", "commit": {"oid": "89cc55af35c9199a983ba32bf3688ee6f5ca5ed9"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTA5MzM0Mzky", "url": "https://github.com/apache/cloudstack/pull/4395#pullrequestreview-509334392", "createdAt": "2020-10-15T12:42:14Z", "commit": {"oid": "dd4dce59ca87234ad98ffc893d3e5c2a2a0361a2"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xNVQxMjo0MjoxNFrOHiF0YA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xNVQxMjo0MjoxNFrOHiF0YA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNTUwODk2MA==", "bodyText": "maybe rephrase to \"no src file given/to work with\" or something?", "url": "https://github.com/apache/cloudstack/pull/4395#discussion_r505508960", "createdAt": "2020-10-15T12:42:14Z", "author": {"login": "DaanHoogland"}, "path": "services/secondary-storage/server/src/main/java/org/apache/cloudstack/storage/resource/NfsSecondaryStorageResource.java", "diffHunk": "@@ -1300,16 +1300,16 @@ protected Answer copyFromNfsToNfs(CopyCommand cmd) {\n         try {\n             File srcFile = new File(getDir(srcStore.getUrl(), _nfsVersion), srcData.getPath());\n             File destFile = new File(getDir(destStore.getUrl(), _nfsVersion), destData.getPath());\n-            ImageFormat format = getTemplateFormat(srcFile.getName());\n \n             if (srcFile == null) {\n-                return new CopyCmdAnswer(\"Can't find src file:\" + srcFile);\n+                return new CopyCmdAnswer(\"Can't find src file\");", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "dd4dce59ca87234ad98ffc893d3e5c2a2a0361a2"}, "originalPosition": 8}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTA5MzM1Mjk4", "url": "https://github.com/apache/cloudstack/pull/4395#pullrequestreview-509335298", "createdAt": "2020-10-15T12:43:16Z", "commit": {"oid": "dd4dce59ca87234ad98ffc893d3e5c2a2a0361a2"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xNVQxMjo0MzoxNlrOHiF3Bw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xNVQxMjo0MzoxNlrOHiF3Bw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNTUwOTYzOQ==", "bodyText": "is this supposed to be **!**isDir()? or isDir() plain?", "url": "https://github.com/apache/cloudstack/pull/4395#discussion_r505509639", "createdAt": "2020-10-15T12:43:16Z", "author": {"login": "DaanHoogland"}, "path": "services/secondary-storage/server/src/main/java/org/apache/cloudstack/storage/resource/NfsSecondaryStorageResource.java", "diffHunk": "@@ -1300,16 +1300,16 @@ protected Answer copyFromNfsToNfs(CopyCommand cmd) {\n         try {\n             File srcFile = new File(getDir(srcStore.getUrl(), _nfsVersion), srcData.getPath());\n             File destFile = new File(getDir(destStore.getUrl(), _nfsVersion), destData.getPath());\n-            ImageFormat format = getTemplateFormat(srcFile.getName());\n \n             if (srcFile == null) {\n-                return new CopyCmdAnswer(\"Can't find src file:\" + srcFile);\n+                return new CopyCmdAnswer(\"Can't find src file\");\n             }\n+            ImageFormat format = getTemplateFormat(srcFile.getName());\n             if (srcData instanceof TemplateObjectTO || srcData instanceof VolumeObjectTO) {\n                 File srcDir = null;\n                 if (srcFile.isFile() || srcFile.getName().contains(\".\")) {\n                     srcDir = new File(srcFile.getParent());\n-                } else if (!srcFile.isFile() && !srcFile.isDirectory()) {\n+                } else if (!srcFile.isDirectory()) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "dd4dce59ca87234ad98ffc893d3e5c2a2a0361a2"}, "originalPosition": 16}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "dd4dce59ca87234ad98ffc893d3e5c2a2a0361a2", "author": {"user": null}, "url": "https://github.com/apache/cloudstack/commit/dd4dce59ca87234ad98ffc893d3e5c2a2a0361a2", "committedDate": "2020-10-15T12:25:22Z", "message": "Addressed comments"}, "afterCommit": {"oid": "b2eb29f86cf5ff8563bd8475b412c89cbc0ce20e", "author": {"user": null}, "url": "https://github.com/apache/cloudstack/commit/b2eb29f86cf5ff8563bd8475b412c89cbc0ce20e", "committedDate": "2020-10-16T03:39:29Z", "message": "Addressed comments"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "b2eb29f86cf5ff8563bd8475b412c89cbc0ce20e", "author": {"user": null}, "url": "https://github.com/apache/cloudstack/commit/b2eb29f86cf5ff8563bd8475b412c89cbc0ce20e", "committedDate": "2020-10-16T03:39:29Z", "message": "Addressed comments"}, "afterCommit": {"oid": "196e205eb06d0b3ebb3dad36c48cc506b5659abc", "author": {"user": null}, "url": "https://github.com/apache/cloudstack/commit/196e205eb06d0b3ebb3dad36c48cc506b5659abc", "committedDate": "2020-10-16T03:52:23Z", "message": "Addressed comments"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTEwMDEzNzU4", "url": "https://github.com/apache/cloudstack/pull/4395#pullrequestreview-510013758", "createdAt": "2020-10-16T04:27:30Z", "commit": {"oid": "196e205eb06d0b3ebb3dad36c48cc506b5659abc"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xNlQwNDoyNzozMFrOHimgWA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xNlQwNDoyNzozMFrOHimgWA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNjA0NDUwNA==", "bodyText": "adding path and datastore id to the log might help in debugging", "url": "https://github.com/apache/cloudstack/pull/4395#discussion_r506044504", "createdAt": "2020-10-16T04:27:30Z", "author": {"login": "sureshanaparti"}, "path": "services/secondary-storage/server/src/main/java/org/apache/cloudstack/storage/resource/NfsSecondaryStorageResource.java", "diffHunk": "@@ -1300,15 +1300,17 @@ protected Answer copyFromNfsToNfs(CopyCommand cmd) {\n         try {\n             File srcFile = new File(getDir(srcStore.getUrl(), _nfsVersion), srcData.getPath());\n             File destFile = new File(getDir(destStore.getUrl(), _nfsVersion), destData.getPath());\n-            ImageFormat format = getTemplateFormat(srcFile.getName());\n \n             if (srcFile == null) {\n-                return new CopyCmdAnswer(\"Can't find src file:\" + srcFile);\n+                return new CopyCmdAnswer(\"Can't find source file to initiate file transfer\");", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "196e205eb06d0b3ebb3dad36c48cc506b5659abc"}, "originalPosition": 8}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTEwMDIwMDcw", "url": "https://github.com/apache/cloudstack/pull/4395#pullrequestreview-510020070", "createdAt": "2020-10-16T04:30:11Z", "commit": {"oid": "196e205eb06d0b3ebb3dad36c48cc506b5659abc"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xNlQwNDozMDoxMVrOHimiow==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xNlQwNDozMDoxMVrOHimiow==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNjA0NTA5MQ==", "bodyText": "check if this causes any regression", "url": "https://github.com/apache/cloudstack/pull/4395#discussion_r506045091", "createdAt": "2020-10-16T04:30:11Z", "author": {"login": "sureshanaparti"}, "path": "services/secondary-storage/server/src/main/java/org/apache/cloudstack/storage/resource/NfsSecondaryStorageResource.java", "diffHunk": "@@ -1351,7 +1353,7 @@ protected Answer copyFromNfsToNfs(CopyCommand cmd) {\n                 if (srcFile.isFile()) {\n                     newVol.setPath(destData.getPath() + File.separator + srcFile.getName());\n                 } else {\n-                    newVol.setPath(destData.getPath());\n+                    newVol.setPath(srcData.getPath());", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "196e205eb06d0b3ebb3dad36c48cc506b5659abc"}, "originalPosition": 25}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "64bca0ec2249faad7ac58f4eb881e68d55aa99fe", "author": {"user": null}, "url": "https://github.com/apache/cloudstack/commit/64bca0ec2249faad7ac58f4eb881e68d55aa99fe", "committedDate": "2020-10-16T04:34:19Z", "message": "Addressed comments"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "196e205eb06d0b3ebb3dad36c48cc506b5659abc", "author": {"user": null}, "url": "https://github.com/apache/cloudstack/commit/196e205eb06d0b3ebb3dad36c48cc506b5659abc", "committedDate": "2020-10-16T03:52:23Z", "message": "Addressed comments"}, "afterCommit": {"oid": "64bca0ec2249faad7ac58f4eb881e68d55aa99fe", "author": {"user": null}, "url": "https://github.com/apache/cloudstack/commit/64bca0ec2249faad7ac58f4eb881e68d55aa99fe", "committedDate": "2020-10-16T04:34:19Z", "message": "Addressed comments"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTEwMDk4ODQ3", "url": "https://github.com/apache/cloudstack/pull/4395#pullrequestreview-510098847", "createdAt": "2020-10-16T05:14:26Z", "commit": {"oid": "64bca0ec2249faad7ac58f4eb881e68d55aa99fe"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xNlQwNToxNDoyNlrOHinN3A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xNlQwNToxNDoyNlrOHinN3A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNjA1NjE1Ng==", "bodyText": "make sure spaces are properly aligned on the log code, rest changes LGTM", "url": "https://github.com/apache/cloudstack/pull/4395#discussion_r506056156", "createdAt": "2020-10-16T05:14:26Z", "author": {"login": "sureshanaparti"}, "path": "services/secondary-storage/server/src/main/java/org/apache/cloudstack/storage/resource/NfsSecondaryStorageResource.java", "diffHunk": "@@ -1300,15 +1300,17 @@ protected Answer copyFromNfsToNfs(CopyCommand cmd) {\n         try {\n             File srcFile = new File(getDir(srcStore.getUrl(), _nfsVersion), srcData.getPath());\n             File destFile = new File(getDir(destStore.getUrl(), _nfsVersion), destData.getPath());\n-            ImageFormat format = getTemplateFormat(srcFile.getName());\n \n             if (srcFile == null) {\n-                return new CopyCmdAnswer(\"Can't find src file:\" + srcFile);\n+                return new CopyCmdAnswer(\"Can't find source file at path: \"+ srcData.getPath() +\"on datastore: \"+ srcDataStore.getUuid() +\" to initiate file transfer\");", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "64bca0ec2249faad7ac58f4eb881e68d55aa99fe"}, "originalPosition": 8}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTEwMDk5MjE5", "url": "https://github.com/apache/cloudstack/pull/4395#pullrequestreview-510099219", "createdAt": "2020-10-16T05:14:33Z", "commit": {"oid": "64bca0ec2249faad7ac58f4eb881e68d55aa99fe"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "7332ce564d49b73928bf1ce2c817099ea246af64", "author": {"user": {"login": "Pearl1594", "name": "Pearl Dsilva"}}, "url": "https://github.com/apache/cloudstack/commit/7332ce564d49b73928bf1ce2c817099ea246af64", "committedDate": "2020-10-16T05:20:47Z", "message": "Update NfsSecondaryStorageResource.java\n\nadjusted space in comment/ log"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4676, "cost": 1, "resetAt": "2021-10-28T17:48:14Z"}}}