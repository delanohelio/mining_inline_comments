{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDk4ODMzODEy", "number": 4387, "title": "Fix JsonSyntaxException when creating API command response #4355 ", "bodyText": "Description\n\nAdded missing \\\" (from \"*****\" to \"*****\\\"\") at obfuscatePassword method from AsyncJobManagerImpl.java#L485\n\n  \n    \n      cloudstack/framework/jobs/src/main/java/org/apache/cloudstack/framework/jobs/impl/AsyncJobManagerImpl.java\n    \n    \n         Line 485\n      in\n      0f3f2a0\n    \n    \n    \n    \n\n        \n          \n           result = resp[0] + pattern + psswd.replace(psswd.substring(2, psswd.length() - 1), \"*****\") + \",\" + resp[1].split(\",\", 2)[1]; \n        \n    \n  \n\n\nThe lack of \" caused a JsonSyntaxException exception when the host response had a password (e.g. if the host has out of band enabled e.g. IPMI or Redfish).\n\n\n\n\nFixes: #4355\nTypes of changes\n\n\n Breaking change (fix or feature that would cause existing functionality to change)\n New feature (non-breaking change which adds functionality)\n Bug fix (non-breaking change which fixes an issue)\n Enhancement (improves an existing feature and functionality)\n Cleanup (Code refactoring and cleanup, that may add test cases)\n\n\nHow Has This Been Tested?\n\n\n\n\nJUnit test\nmanual tests", "createdAt": "2020-10-06T21:02:58Z", "url": "https://github.com/apache/cloudstack/pull/4387", "merged": true, "mergeCommit": {"oid": "1ba6a49fa484241833d75350ca5d6975c9d67952"}, "closed": true, "closedAt": "2020-10-20T11:19:56Z", "author": {"login": "GabrielBrascher"}, "timelineItems": {"totalCount": 6, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdP-k6gAH2gAyNDk4ODMzODEyOmJkMjc1ODAzNzc1ZGQwZTQ4MTNhYzM3MDFjNzU2ODc2ZmJjYjZhZGY=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdUW8dOAFqTUxMjU5ODYwMQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "bd275803775dd0e4813ac3701c756876fbcb6adf", "author": {"user": {"login": "GabrielBrascher", "name": "Gabriel Beims Br\u00e4scher"}}, "url": "https://github.com/apache/cloudstack/commit/bd275803775dd0e4813ac3701c756876fbcb6adf", "committedDate": "2020-10-06T20:40:32Z", "message": "Add missing \\\" on obfuscatePassword"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b04b08beffb1b218b70c837055044cce6aeabb7b", "author": {"user": {"login": "GabrielBrascher", "name": "Gabriel Beims Br\u00e4scher"}}, "url": "https://github.com/apache/cloudstack/commit/b04b08beffb1b218b70c837055044cce6aeabb7b", "committedDate": "2020-10-06T20:48:16Z", "message": "Add tests for AsyncJobManagerImpl.obfuscatePassword"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTA0MTA3NTI4", "url": "https://github.com/apache/cloudstack/pull/4387#pullrequestreview-504107528", "createdAt": "2020-10-07T17:25:58Z", "commit": {"oid": "b04b08beffb1b218b70c837055044cce6aeabb7b"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTA4MTk3MzM1", "url": "https://github.com/apache/cloudstack/pull/4387#pullrequestreview-508197335", "createdAt": "2020-10-14T10:13:32Z", "commit": {"oid": "b04b08beffb1b218b70c837055044cce6aeabb7b"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xNFQxMDoxMzozMlrOHhMB0Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xNFQxMDoxMzozMlrOHhMB0Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNDU2MjEyOQ==", "bodyText": "Why not complete replace with the ****?", "url": "https://github.com/apache/cloudstack/pull/4387#discussion_r504562129", "createdAt": "2020-10-14T10:13:32Z", "author": {"login": "rhtyd"}, "path": "framework/jobs/src/main/java/org/apache/cloudstack/framework/jobs/impl/AsyncJobManagerImpl.java", "diffHunk": "@@ -475,14 +475,14 @@ public AsyncJob queryJob(final long jobId, final boolean updatePollTime) {\n         return job;\n     }\n \n-    private String obfuscatePassword(String result, boolean hidePassword) {\n+    public String obfuscatePassword(String result, boolean hidePassword) {\n         if (hidePassword) {\n             String pattern = \"\\\"password\\\":\";\n             if (result != null) {\n                 if (result.contains(pattern)) {\n                     String[] resp = result.split(pattern);\n                     String psswd = resp[1].toString().split(\",\")[0];\n-                    result = resp[0] + pattern + psswd.replace(psswd.substring(2, psswd.length() - 1), \"*****\") + \",\" + resp[1].split(\",\", 2)[1];\n+                    result = resp[0] + pattern + psswd.replace(psswd.substring(2, psswd.length() - 1), \"*****\\\"\") + \",\" + resp[1].split(\",\", 2)[1];", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b04b08beffb1b218b70c837055044cce6aeabb7b"}, "originalPosition": 13}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "7ef2f274bfc6d0eabd9bb3402dc40bfdbfda688f", "author": {"user": {"login": "GabrielBrascher", "name": "Gabriel Beims Br\u00e4scher"}}, "url": "https://github.com/apache/cloudstack/commit/7ef2f274bfc6d0eabd9bb3402dc40bfdbfda688f", "committedDate": "2020-10-14T20:54:31Z", "message": "fix for \"password},\""}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTEyNTk4NjAx", "url": "https://github.com/apache/cloudstack/pull/4387#pullrequestreview-512598601", "createdAt": "2020-10-20T11:19:40Z", "commit": {"oid": "7ef2f274bfc6d0eabd9bb3402dc40bfdbfda688f"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4661, "cost": 1, "resetAt": "2021-10-28T17:48:14Z"}}}