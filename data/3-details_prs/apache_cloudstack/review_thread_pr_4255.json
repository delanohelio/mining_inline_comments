{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDY1NTgyODA4", "number": 4255, "reviewThreads": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xMlQxNjo0NTowN1rOEXtfWQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xMlQxNjo0NTowN1rOEXtfWQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjkzMjk4MDA5OnYy", "diffSide": "RIGHT", "path": "server/src/main/java/com/cloud/server/ManagementServerImpl.java", "isResolved": true, "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xMlQxNjo0NTowN1rOG_pwkQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xMlQxOTo0NjoxOVrOG_v9Wg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2OTM5NzY0OQ==", "bodyText": "I think that it would be better to implement this via the VLAN Search Builder instead of adding the proposed search builder. Here are a few points of why I think it would be better:\n\nAll removed zones should have its networks removed anyway, therefore VLANs of a removed zone are marked as removed as well;\nthis could also prevent issues of selecting IP addresses of removed VLANs on an existing Zone;\nand, at the end, it reduces costs of one extra join.\n\nCurrently lines 1984 - 1986:\nfinal SearchBuilder<VlanVO> vlanSearch = _vlanDao.createSearchBuilder();\nvlanSearch.and(\"vlanType\", vlanSearch.entity().getVlanType(), SearchCriteria.Op.EQ);\nsb.join(\"vlanSearch\", vlanSearch, sb.entity().getVlanId(), vlanSearch.entity().getId(), JoinBuilder.JoinType.INNER);\n\nChanging current VLAN search builder adding a verification \"WHERE removed IS NULL\":\nfinal SearchBuilder<VlanVO> vlanSearch = _vlanDao.createSearchBuilder();\nvlanSearch.and(\"vlanType\", vlanSearch.entity().getVlanType(), SearchCriteria.Op.EQ);\nvlanSearch.and(\"removed\", vlanSearch.entity().getRemoved(), SearchCriteria.Op.NULL);\nsb.join(\"vlanSearch\", vlanSearch, sb.entity().getVlanId(), vlanSearch.entity().getId(), JoinBuilder.JoinType.INNER);SearchCriteria.Op.NULL);", "url": "https://github.com/apache/cloudstack/pull/4255#discussion_r469397649", "createdAt": "2020-08-12T16:45:07Z", "author": {"login": "GabrielBrascher"}, "path": "server/src/main/java/com/cloud/server/ManagementServerImpl.java", "diffHunk": "@@ -1985,6 +1985,10 @@ private boolean hasSuitablePoolsForVolume(final VolumeVO volume, final Host host\n         vlanSearch.and(\"vlanType\", vlanSearch.entity().getVlanType(), SearchCriteria.Op.EQ);\n         sb.join(\"vlanSearch\", vlanSearch, sb.entity().getVlanId(), vlanSearch.entity().getId(), JoinBuilder.JoinType.INNER);\n \n+        SearchBuilder<DataCenterVO> zoneSearchBuilder = _dcDao.createSearchBuilder();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "6dc40f7b1467c2ba53f9baff0dcae69be681bbe2"}, "originalPosition": 4}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2OTQyODg1OQ==", "bodyText": "I did not see that. thanks for the hint\nwork like a charm adding this removed filter for Vlan Search.", "url": "https://github.com/apache/cloudstack/pull/4255#discussion_r469428859", "createdAt": "2020-08-12T17:37:35Z", "author": {"login": "RodrigoDLopez"}, "path": "server/src/main/java/com/cloud/server/ManagementServerImpl.java", "diffHunk": "@@ -1985,6 +1985,10 @@ private boolean hasSuitablePoolsForVolume(final VolumeVO volume, final Host host\n         vlanSearch.and(\"vlanType\", vlanSearch.entity().getVlanType(), SearchCriteria.Op.EQ);\n         sb.join(\"vlanSearch\", vlanSearch, sb.entity().getVlanId(), vlanSearch.entity().getId(), JoinBuilder.JoinType.INNER);\n \n+        SearchBuilder<DataCenterVO> zoneSearchBuilder = _dcDao.createSearchBuilder();", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2OTM5NzY0OQ=="}, "originalCommit": {"oid": "6dc40f7b1467c2ba53f9baff0dcae69be681bbe2"}, "originalPosition": 4}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2OTQ5OTIyNg==", "bodyText": "That's great! \ud83d\ude42", "url": "https://github.com/apache/cloudstack/pull/4255#discussion_r469499226", "createdAt": "2020-08-12T19:46:19Z", "author": {"login": "GabrielBrascher"}, "path": "server/src/main/java/com/cloud/server/ManagementServerImpl.java", "diffHunk": "@@ -1985,6 +1985,10 @@ private boolean hasSuitablePoolsForVolume(final VolumeVO volume, final Host host\n         vlanSearch.and(\"vlanType\", vlanSearch.entity().getVlanType(), SearchCriteria.Op.EQ);\n         sb.join(\"vlanSearch\", vlanSearch, sb.entity().getVlanId(), vlanSearch.entity().getId(), JoinBuilder.JoinType.INNER);\n \n+        SearchBuilder<DataCenterVO> zoneSearchBuilder = _dcDao.createSearchBuilder();", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2OTM5NzY0OQ=="}, "originalCommit": {"oid": "6dc40f7b1467c2ba53f9baff0dcae69be681bbe2"}, "originalPosition": 4}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3776, "cost": 1, "resetAt": "2021-11-12T11:18:39Z"}}}