{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0Mzk1ODk5MjE1", "number": 4001, "title": "server: Dedicated hosts should be 'Not Suitable' while find host for m migration", "bodyText": "Description\n\nWhile migrate a vm, in the popup, the host dedicated to other accounts/domains are also 'Suitable\" for migration, which is obviously wrong.\nThe same issue happens with api findHostsForMigration\n\n\n\n\n\nTypes of changes\n\n\n Breaking change (fix or feature that would cause existing functionality to change)\n New feature (non-breaking change which adds functionality)\n Bug fix (non-breaking change which fixes an issue)\n Enhancement (improves an existing feature and functionality)\n Cleanup (Code refactoring and cleanup, that may add test cases)\n\nScreenshots (if appropriate):\nHow Has This Been Tested?\n\n\n\nwith this PR, the hosts dedicated to other domains/accounts are marked as 'Not Suitable'.", "createdAt": "2020-03-30T20:59:11Z", "url": "https://github.com/apache/cloudstack/pull/4001", "merged": true, "mergeCommit": {"oid": "4da374b6b404d401d6a1f39d4df45e72fcabbbf8"}, "closed": true, "closedAt": "2020-07-04T05:31:42Z", "author": {"login": "ustcweizhou"}, "timelineItems": {"totalCount": 6, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcS0-j9gBqjMxODA0NzYxNzc=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcn5pkHgFqTQyNDIwODc5Ng==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "57e80f7ece64e6ef6f33497d3ee3013547bf2110", "author": {"user": {"login": "ustcweizhou", "name": "Wei Zhou"}}, "url": "https://github.com/apache/cloudstack/commit/57e80f7ece64e6ef6f33497d3ee3013547bf2110", "committedDate": "2020-03-30T20:38:30Z", "message": "server: Dedicated hosts should be 'Not Suitable' while find host for vm migration"}, "afterCommit": {"oid": "3624cdebfe9938a5450d6322480987093f6d4598", "author": {"user": {"login": "ustcweizhou", "name": "Wei Zhou"}}, "url": "https://github.com/apache/cloudstack/commit/3624cdebfe9938a5450d6322480987093f6d4598", "committedDate": "2020-03-30T20:59:47Z", "message": "server: Dedicated hosts should be 'Not Suitable' while find host for vm migration"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzg1OTI0NzA3", "url": "https://github.com/apache/cloudstack/pull/4001#pullrequestreview-385924707", "createdAt": "2020-04-01T20:28:02Z", "commit": {"oid": "3624cdebfe9938a5450d6322480987093f6d4598"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wMVQyMDoyODowM1rOF_RYIg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wMVQyMDoyODowM1rOF_RYIg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMTg4OTMxNA==", "bodyText": "can you put this in a separate method?", "url": "https://github.com/apache/cloudstack/pull/4001#discussion_r401889314", "createdAt": "2020-04-01T20:28:03Z", "author": {"login": "DaanHoogland"}, "path": "plugins/affinity-group-processors/explicit-dedication/src/main/java/org/apache/cloudstack/affinity/ExplicitDedicationProcessor.java", "diffHunk": "@@ -92,6 +92,17 @@ public void process(VirtualMachineProfile vmProfile, DeploymentPlan plan, Exclud\n         DataCenter dc = _dcDao.findById(vm.getDataCenterId());\n         List<DedicatedResourceVO> resourceList = new ArrayList<DedicatedResourceVO>();\n \n+        List<DedicatedResourceVO> dedicatedHosts = _dedicatedDao.listAll();\n+        for (DedicatedResourceVO host : dedicatedHosts) {\n+            // Hosts dedicated to different domain/account are not suitable for migration\n+            if (host.getAccountId() != null && vm.getAccountId() != host.getAccountId()) {\n+                avoid.addHost(host.getHostId());\n+            }\n+            if (host.getDomainId() != null && vm.getDomainId() != host.getDomainId()) {\n+                avoid.addHost(host.getHostId());\n+            }\n+        }", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "3624cdebfe9938a5450d6322480987093f6d4598"}, "originalPosition": 13}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "9785c2afdf7e927ae23b2de0d75b8b61f6e99c8f", "author": {"user": {"login": "ustcweizhou", "name": "Wei Zhou"}}, "url": "https://github.com/apache/cloudstack/commit/9785c2afdf7e927ae23b2de0d75b8b61f6e99c8f", "committedDate": "2020-04-08T06:50:39Z", "message": "server: Dedicated hosts should be 'Not Suitable' while find hosts for vm migration"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "f7bc13a9480ef51eab7c89866d8d46e4f92d1051", "author": {"user": {"login": "ustcweizhou", "name": "Wei Zhou"}}, "url": "https://github.com/apache/cloudstack/commit/f7bc13a9480ef51eab7c89866d8d46e4f92d1051", "committedDate": "2020-04-06T19:47:38Z", "message": "server: code optimization for PR #4001"}, "afterCommit": {"oid": "9785c2afdf7e927ae23b2de0d75b8b61f6e99c8f", "author": {"user": {"login": "ustcweizhou", "name": "Wei Zhou"}}, "url": "https://github.com/apache/cloudstack/commit/9785c2afdf7e927ae23b2de0d75b8b61f6e99c8f", "committedDate": "2020-04-08T06:50:39Z", "message": "server: Dedicated hosts should be 'Not Suitable' while find hosts for vm migration"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDI0MDYwMDE4", "url": "https://github.com/apache/cloudstack/pull/4001#pullrequestreview-424060018", "createdAt": "2020-06-04T02:30:30Z", "commit": {"oid": "9785c2afdf7e927ae23b2de0d75b8b61f6e99c8f"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDI0MjA4Nzk2", "url": "https://github.com/apache/cloudstack/pull/4001#pullrequestreview-424208796", "createdAt": "2020-06-04T08:19:07Z", "commit": {"oid": "9785c2afdf7e927ae23b2de0d75b8b61f6e99c8f"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4155, "cost": 1, "resetAt": "2021-10-28T17:48:14Z"}}}