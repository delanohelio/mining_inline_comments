{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDAwMTQ0MjAw", "number": 4021, "title": "Boot into hardware setup menu on Vmware", "bodyText": "Description\n\nallow VMs to be started into BIOS on Vmware. This is implemented in the reboot, start and deploy APIs for user VMs.\nRelated Primate PR: apache/cloudstack-primate#313\n\n\n\n\n\nTypes of changes\n\n\n Breaking change (fix or feature that would cause existing functionality to change)\n New feature (non-breaking change which adds functionality)\n Bug fix (non-breaking change which fixes an issue)\n Enhancement (improves an existing feature and functionality)\n Cleanup (Code refactoring and cleanup, that may add test cases)\n\nScreenshots (if appropriate):\n\n\n\nA primate PR has been created with number 313\nHow Has This Been Tested?\n\n\n\n\nthis has been manually verified by means of API/old-UI/primate and checking if the boot menu would then be visible or not depending on the flag passed.", "createdAt": "2020-04-07T09:19:06Z", "url": "https://github.com/apache/cloudstack/pull/4021", "merged": true, "mergeCommit": {"oid": "0795cd430b46f2001cbb902d705dd130c6f5dd7d"}, "closed": true, "closedAt": "2020-06-11T11:47:21Z", "author": {"login": "DaanHoogland"}, "timelineItems": {"totalCount": 47, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcVS6cQgBqjMyMDk3MzgwOTQ=", "endCursor": "Y3Vyc29yOnYyOpPPAAABctvVJxgFqTQzNDg0MjU3Mg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "982edf08e98a5dfd2d91404d2321aa716a6da7db", "author": {"user": {"login": "DaanHoogland", "name": "dahn"}}, "url": "https://github.com/apache/cloudstack/commit/982edf08e98a5dfd2d91404d2321aa716a6da7db", "committedDate": "2020-04-07T09:24:37Z", "message": "rat"}, "afterCommit": {"oid": "ab510a3c7bd3ff294764eca2bc5769a4464fe76e", "author": {"user": {"login": "DaanHoogland", "name": "dahn"}}, "url": "https://github.com/apache/cloudstack/commit/ab510a3c7bd3ff294764eca2bc5769a4464fe76e", "committedDate": "2020-04-07T13:00:14Z", "message": "rat"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "bb70865fbbe5aad7f2f4bf8dd5913e19052f968c", "author": {"user": {"login": "DaanHoogland", "name": "dahn"}}, "url": "https://github.com/apache/cloudstack/commit/bb70865fbbe5aad7f2f4bf8dd5913e19052f968c", "committedDate": "2020-04-07T13:05:51Z", "message": "imports"}, "afterCommit": {"oid": "7b4f5c99b5a377475df8f6fe4b94bdcf92b51e73", "author": {"user": {"login": "DaanHoogland", "name": "dahn"}}, "url": "https://github.com/apache/cloudstack/commit/7b4f5c99b5a377475df8f6fe4b94bdcf92b51e73", "committedDate": "2020-04-07T14:03:29Z", "message": "factor out implement method"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "7b4f5c99b5a377475df8f6fe4b94bdcf92b51e73", "author": {"user": {"login": "DaanHoogland", "name": "dahn"}}, "url": "https://github.com/apache/cloudstack/commit/7b4f5c99b5a377475df8f6fe4b94bdcf92b51e73", "committedDate": "2020-04-07T14:03:29Z", "message": "factor out implement method"}, "afterCommit": {"oid": "8f68612827c315fea179e5c193cf5c022a777ad9", "author": {"user": {"login": "DaanHoogland", "name": "dahn"}}, "url": "https://github.com/apache/cloudstack/commit/8f68612827c315fea179e5c193cf5c022a777ad9", "committedDate": "2020-04-07T15:07:35Z", "message": "factor out implement method"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "8f68612827c315fea179e5c193cf5c022a777ad9", "author": {"user": {"login": "DaanHoogland", "name": "dahn"}}, "url": "https://github.com/apache/cloudstack/commit/8f68612827c315fea179e5c193cf5c022a777ad9", "committedDate": "2020-04-07T15:07:35Z", "message": "factor out implement method"}, "afterCommit": {"oid": "447a96c7a9d998a08c636d5856f292c61bfc4225", "author": {"user": {"login": "DaanHoogland", "name": "dahn"}}, "url": "https://github.com/apache/cloudstack/commit/447a96c7a9d998a08c636d5856f292c61bfc4225", "committedDate": "2020-04-08T09:18:16Z", "message": "factor out implement method"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "447a96c7a9d998a08c636d5856f292c61bfc4225", "author": {"user": {"login": "DaanHoogland", "name": "dahn"}}, "url": "https://github.com/apache/cloudstack/commit/447a96c7a9d998a08c636d5856f292c61bfc4225", "committedDate": "2020-04-08T09:18:16Z", "message": "factor out implement method"}, "afterCommit": {"oid": "7e333a2c3cf8780b38088809b44107cb5558b863", "author": {"user": {"login": "DaanHoogland", "name": "dahn"}}, "url": "https://github.com/apache/cloudstack/commit/7e333a2c3cf8780b38088809b44107cb5558b863", "committedDate": "2020-04-08T12:39:52Z", "message": "factor out implement method"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "b785e0b631ac57c22dd969f4db93035eacd2b56b", "author": {"user": null}, "url": "https://github.com/apache/cloudstack/commit/b785e0b631ac57c22dd969f4db93035eacd2b56b", "committedDate": "2020-04-15T10:52:14Z", "message": "enterSetup as boolean (part 2)"}, "afterCommit": {"oid": "af483ca1029a3d2eb6f61a15859c3b939a104818", "author": {"user": null}, "url": "https://github.com/apache/cloudstack/commit/af483ca1029a3d2eb6f61a15859c3b939a104818", "committedDate": "2020-04-15T10:55:54Z", "message": "enterSetup as boolean (part 2)"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDAzNzkwNDYy", "url": "https://github.com/apache/cloudstack/pull/4021#pullrequestreview-403790462", "createdAt": "2020-04-30T18:52:44Z", "commit": {"oid": "3041b0d891d3847786b523d9e7a9e26b9f083e79"}, "state": "COMMENTED", "comments": {"totalCount": 9, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0zMFQxODo1Mjo0NFrOGO2InQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0zMFQxOTozNToyMFrOGO3gog==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxODIyMDE4OQ==", "bodyText": "Minor style fix: missing space after the '='", "url": "https://github.com/apache/cloudstack/pull/4021#discussion_r418220189", "createdAt": "2020-04-30T18:52:44Z", "author": {"login": "nvazquez"}, "path": "api/src/main/java/org/apache/cloudstack/api/ApiConstants.java", "diffHunk": "@@ -806,6 +806,7 @@\n \n     public static final String BOOT_TYPE =\"boottype\";\n     public static final String BOOT_MODE =\"bootmode\";\n+    public static final String BOOT_INTO_SETUP =\"bootintosetup\";", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "3041b0d891d3847786b523d9e7a9e26b9f083e79"}, "originalPosition": 4}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxODIyMjY2MA==", "bodyText": "The null check was removed, can you include it inside this if clause?", "url": "https://github.com/apache/cloudstack/pull/4021#discussion_r418222660", "createdAt": "2020-04-30T18:57:01Z", "author": {"login": "nvazquez"}, "path": "api/src/main/java/org/apache/cloudstack/api/command/user/vm/DeployVMCmd.java", "diffHunk": "@@ -281,15 +284,14 @@ public Long getDomainId() {\n                 }\n             }\n         }\n-        if(getBootType() != null){ // export to get\n-            if(getBootType() == ApiConstants.BootType.UEFI) {\n-                customparameterMap.put(getBootType().toString(), getBootMode().toString());\n-            }\n+        if (ApiConstants.BootType.UEFI.equals(getBootType())) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "3041b0d891d3847786b523d9e7a9e26b9f083e79"}, "originalPosition": 26}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxODIyNzExNw==", "bodyText": "Minor improvement request: what about removing the boolean variable and init the string buffer empty, so at this point instead of asking for the boolean flag you could check if the generated string is not empty, in that case log it", "url": "https://github.com/apache/cloudstack/pull/4021#discussion_r418227117", "createdAt": "2020-04-30T19:05:17Z", "author": {"login": "nvazquez"}, "path": "engine/orchestration/src/main/java/com/cloud/vm/VirtualMachineManagerImpl.java", "diffHunk": "@@ -1315,6 +1324,30 @@ public void orchestrateStart(final String vmUuid, final Map<VirtualMachineProfil\n         }\n     }\n \n+    private void logBootModeParameters(Map<VirtualMachineProfile.Param, Object> params) {\n+        StringBuffer msgBuf = new StringBuffer(\"Uefi params \");\n+        boolean log = false;\n+        if (params.get(VirtualMachineProfile.Param.UefiFlag) != null) {\n+            msgBuf.append(String.format(\"UefiFlag: %s \", params.get(VirtualMachineProfile.Param.UefiFlag)));\n+            log = true;\n+        }\n+        if (params.get(VirtualMachineProfile.Param.BootType) != null) {\n+            msgBuf.append(String.format(\"Boot Type: %s \", params.get(VirtualMachineProfile.Param.BootType)));\n+            log = true;\n+        }\n+        if (params.get(VirtualMachineProfile.Param.BootMode) != null) {\n+            msgBuf.append(String.format(\"Boot Mode: %s \", params.get(VirtualMachineProfile.Param.BootMode)));\n+            log = true;\n+        }\n+        if (params.get(VirtualMachineProfile.Param.BootIntoSetup) != null) {\n+            msgBuf.append(String.format(\"Boot into Setup: %s \", params.get(VirtualMachineProfile.Param.BootIntoSetup)));\n+            log = true;\n+        }\n+        if (log) {\n+            s_logger.info(msgBuf.toString());", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "3041b0d891d3847786b523d9e7a9e26b9f083e79"}, "originalPosition": 69}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxODIzMjg5NQ==", "bodyText": "Missing space", "url": "https://github.com/apache/cloudstack/pull/4021#discussion_r418232895", "createdAt": "2020-04-30T19:15:59Z", "author": {"login": "nvazquez"}, "path": "plugins/hypervisors/vmware/src/main/java/com/cloud/hypervisor/vmware/resource/VmwareResource.java", "diffHunk": "@@ -1723,10 +1723,13 @@ protected StartAnswer execute(StartCommand cmd) {\n         String dataDiskController = vmSpec.getDetails().get(VmDetailConstants.DATA_DISK_CONTROLLER);\n         String rootDiskController = vmSpec.getDetails().get(VmDetailConstants.ROOT_DISK_CONTROLLER);\n         DiskTO rootDiskTO = null;\n-        String bootMode = \"bios\";\n+        String bootMode = null;\n         if (vmSpec.getDetails().containsKey(VmDetailConstants.BOOT_MODE)) {\n             bootMode = vmSpec.getDetails().get(VmDetailConstants.BOOT_MODE);\n         }\n+        if(null == bootMode) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "3041b0d891d3847786b523d9e7a9e26b9f083e79"}, "originalPosition": 9}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxODIzNTgzOA==", "bodyText": "We are swallowing the exception here, should we try to stop the process instead?", "url": "https://github.com/apache/cloudstack/pull/4021#discussion_r418235838", "createdAt": "2020-04-30T19:21:38Z", "author": {"login": "nvazquez"}, "path": "plugins/hypervisors/vmware/src/main/java/com/cloud/hypervisor/vmware/resource/VmwareResource.java", "diffHunk": "@@ -3950,6 +3970,25 @@ protected Answer execute(RebootCommand cmd) {\n         }\n     }\n \n+    private void checkAndSetEnableSetupConfig(VirtualMachineMO vmMo, VirtualMachineTO virtualMachine) {\n+        if (virtualMachine.isEnterHardwareSetup()) {\n+            VirtualMachineBootOptions bootOptions = new VirtualMachineBootOptions();\n+            VirtualMachineConfigSpec vmConfigSpec = new VirtualMachineConfigSpec();\n+            if (s_logger.isDebugEnabled()) {\n+                s_logger.debug(String.format(\"configuring VM '%s' to reboot into hardware setup menu.\",virtualMachine.getName()));\n+            }\n+            bootOptions.setEnterBIOSSetup(virtualMachine.isEnterHardwareSetup());\n+            vmConfigSpec.setBootOptions(bootOptions);\n+            try {\n+                if (!vmMo.configureVm(vmConfigSpec)) {\n+                    throw new Exception(\"Failed to configure VM to boot into hardware setup menu: \" + vmMo.getName());\n+                }\n+            } catch (Exception e) {\n+                s_logger.error(String.format(\"failed to reconfigure VM '%s' to boot into hardware setup menu\",virtualMachine.getName()),e);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "3041b0d891d3847786b523d9e7a9e26b9f083e79"}, "originalPosition": 89}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxODIzNjY3OA==", "bodyText": "Space", "url": "https://github.com/apache/cloudstack/pull/4021#discussion_r418236678", "createdAt": "2020-04-30T19:23:18Z", "author": {"login": "nvazquez"}, "path": "server/src/main/java/com/cloud/vm/UserVmManagerImpl.java", "diffHunk": "@@ -969,8 +973,18 @@ private UserVm rebootVirtualMachine(long userId, long vmId) throws InsufficientC\n             } catch (Exception ex){\n                 throw new CloudRuntimeException(\"Router start failed due to\" + ex);\n             }finally {\n-                s_logger.info(\"Rebooting vm \" + vm.getInstanceName());\n-                _itMgr.reboot(vm.getUuid(), null);\n+                if (s_logger.isInfoEnabled()) {\n+                    s_logger.info(String.format(\"Rebooting vm %s%s.\", vm.getInstanceName(), enterSetup? \" entering hardware setup menu\" : \" as is\"));\n+                }\n+                Map<VirtualMachineProfile.Param,Object> params = null;\n+                if(enterSetup) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "3041b0d891d3847786b523d9e7a9e26b9f083e79"}, "originalPosition": 43}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxODIzNzY4MQ==", "bodyText": "For readability can you change it to: enterSetup != null && hypervisor != Vmware?", "url": "https://github.com/apache/cloudstack/pull/4021#discussion_r418237681", "createdAt": "2020-04-30T19:25:09Z", "author": {"login": "nvazquez"}, "path": "server/src/main/java/com/cloud/vm/UserVmManagerImpl.java", "diffHunk": "@@ -2866,7 +2892,11 @@ public UserVm rebootVirtualMachine(RebootVMCmd cmd) throws InsufficientCapacityE\n             throw new InvalidParameterValueException(\"Unable to find service offering: \" + serviceOfferingId + \" corresponding to the vm\");\n         }\n \n-        UserVm userVm = rebootVirtualMachine(CallContext.current().getCallingUserId(), vmId);\n+        Boolean enterSetup = cmd.getBootIntoSetup();\n+        if (! (enterSetup == null || HypervisorType.VMware.equals(vmInstance.getHypervisorType()))) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "3041b0d891d3847786b523d9e7a9e26b9f083e79"}, "originalPosition": 81}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxODI0MDg4Mg==", "bodyText": "Why not using the @Inject annotation?", "url": "https://github.com/apache/cloudstack/pull/4021#discussion_r418240882", "createdAt": "2020-04-30T19:31:28Z", "author": {"login": "nvazquez"}, "path": "plugins/hypervisors/vmware/src/main/java/com/cloud/hypervisor/guru/VMwareGuru.java", "diffHunk": "@@ -172,326 +157,59 @@\n public class VMwareGuru extends HypervisorGuruBase implements HypervisorGuru, Configurable {\n     private static final Logger s_logger = Logger.getLogger(VMwareGuru.class);\n \n-    @Inject\n-    private NetworkDao _networkDao;\n-    @Inject\n-    private GuestOSDao _guestOsDao;\n-    @Inject\n-    private GuestOSHypervisorDao _guestOsHypervisorDao;\n-    @Inject\n-    private HostDao _hostDao;\n-    @Inject\n-    private HostDetailsDao _hostDetailsDao;\n-    @Inject\n-    private ClusterDetailsDao _clusterDetailsDao;\n-    @Inject\n-    private CommandExecLogDao _cmdExecLogDao;\n-    @Inject\n-    private VmwareManager _vmwareMgr;\n-    @Inject\n-    private SecondaryStorageVmManager _secStorageMgr;\n-    @Inject\n-    private NetworkModel _networkMgr;\n-    @Inject\n-    private NicDao _nicDao;\n-    @Inject\n-    private DomainRouterDao _domainRouterDao;\n-    @Inject\n-    private PhysicalNetworkTrafficTypeDao _physicalNetworkTrafficTypeDao;\n-    @Inject\n-    private VMInstanceDao _vmDao;\n-    @Inject\n-    private VirtualMachineManager vmManager;\n-    @Inject\n-    private ClusterManager _clusterMgr;\n-    @Inject\n-    VolumeDao _volumeDao;\n-    @Inject\n-    ResourceLimitService _resourceLimitService;\n-    @Inject\n-    PrimaryDataStoreDao _storagePoolDao;\n-    @Inject\n-    VolumeDataFactory _volFactory;\n-    @Inject\n-    private VmwareDatacenterDao vmwareDatacenterDao;\n-    @Inject\n-    private VmwareDatacenterZoneMapDao vmwareDatacenterZoneMapDao;\n-    @Inject\n-    private ServiceOfferingDao serviceOfferingDao;\n-    @Inject\n-    private VMTemplatePoolDao templateStoragePoolDao;\n-    @Inject\n-    private VMTemplateDao vmTemplateDao;\n-    @Inject\n-    private UserVmDao userVmDao;\n-    @Inject\n-    private DiskOfferingDao diskOfferingDao;\n-    @Inject\n-    private PhysicalNetworkDao physicalNetworkDao;\n-    @Inject\n-    private TemplateOVFPropertiesDao templateOVFPropertiesDao;\n+\n+    private VmwareVmImplementer vmwareVmImplementer;\n+\n+    @Inject NetworkDao _networkDao;\n+    @Inject GuestOSDao _guestOsDao;\n+    @Inject HostDao _hostDao;\n+    @Inject HostDetailsDao _hostDetailsDao;\n+    @Inject ClusterDetailsDao _clusterDetailsDao;\n+    @Inject CommandExecLogDao _cmdExecLogDao;\n+    @Inject VmwareManager _vmwareMgr;\n+    @Inject SecondaryStorageVmManager _secStorageMgr;\n+    @Inject NicDao _nicDao;\n+    @Inject PhysicalNetworkTrafficTypeDao _physicalNetworkTrafficTypeDao;\n+    @Inject VMInstanceDao _vmDao;\n+    @Inject VirtualMachineManager vmManager;\n+    @Inject ClusterManager _clusterMgr;\n+    @Inject VolumeDao _volumeDao;\n+    @Inject ResourceLimitService _resourceLimitService;\n+    @Inject PrimaryDataStoreDao _storagePoolDao;\n+    @Inject VolumeDataFactory _volFactory;\n+    @Inject VmwareDatacenterDao vmwareDatacenterDao;\n+    @Inject VmwareDatacenterZoneMapDao vmwareDatacenterZoneMapDao;\n+    @Inject ServiceOfferingDao serviceOfferingDao;\n+    @Inject VMTemplatePoolDao templateStoragePoolDao;\n+    @Inject VMTemplateDao vmTemplateDao;\n+    @Inject UserVmDao userVmDao;\n+    @Inject DiskOfferingDao diskOfferingDao;\n+    @Inject PhysicalNetworkDao physicalNetworkDao;\n \n     protected VMwareGuru() {\n         super();\n     }\n \n     public static final ConfigKey<Boolean> VmwareReserveCpu = new ConfigKey<Boolean>(Boolean.class, \"vmware.reserve.cpu\", \"Advanced\", \"false\",\n-        \"Specify whether or not to reserve CPU when deploying an instance.\", true, ConfigKey.Scope.Cluster,\n-        null);\n+            \"Specify whether or not to reserve CPU when deploying an instance.\", true, ConfigKey.Scope.Cluster, null);\n \n     public static final ConfigKey<Boolean> VmwareReserveMemory = new ConfigKey<Boolean>(Boolean.class, \"vmware.reserve.mem\", \"Advanced\", \"false\",\n-        \"Specify whether or not to reserve memory when deploying an instance.\", true,\n-        ConfigKey.Scope.Cluster, null);\n+            \"Specify whether or not to reserve memory when deploying an instance.\", true, ConfigKey.Scope.Cluster, null);\n \n     protected ConfigKey<Boolean> VmwareEnableNestedVirtualization = new ConfigKey<Boolean>(Boolean.class, \"vmware.nested.virtualization\", \"Advanced\", \"false\",\n             \"When set to true this will enable nested virtualization when this is supported by the hypervisor\", true, ConfigKey.Scope.Global, null);\n \n     protected ConfigKey<Boolean> VmwareEnableNestedVirtualizationPerVM = new ConfigKey<Boolean>(Boolean.class, \"vmware.nested.virtualization.perVM\", \"Advanced\", \"false\",\n             \"When set to true this will enable nested virtualization per vm\", true, ConfigKey.Scope.Global, null);\n \n-    @Override\n-    public HypervisorType getHypervisorType() {\n+    @Override public HypervisorType getHypervisorType() {\n         return HypervisorType.VMware;\n     }\n \n-    @Override\n-    public VirtualMachineTO implement(VirtualMachineProfile vm) {\n-        VirtualMachineTO to = toVirtualMachineTO(vm);\n-        to.setBootloader(BootloaderType.HVM);\n-\n-        Map<String, String> details = to.getDetails();\n-        if (details == null)\n-            details = new HashMap<String, String>();\n-\n-        Type vmType = vm.getType();\n-        boolean userVm = !(vmType.equals(VirtualMachine.Type.DomainRouter) || vmType.equals(VirtualMachine.Type.ConsoleProxy)\n-                || vmType.equals(VirtualMachine.Type.SecondaryStorageVm));\n-\n-        String nicDeviceType = details.get(VmDetailConstants.NIC_ADAPTER);\n-        if (!userVm) {\n-\n-            if (nicDeviceType == null) {\n-                details.put(VmDetailConstants.NIC_ADAPTER, _vmwareMgr.getSystemVMDefaultNicAdapterType());\n-            } else {\n-                try {\n-                    VirtualEthernetCardType.valueOf(nicDeviceType);\n-                } catch (Exception e) {\n-                    s_logger.warn(\"Invalid NIC device type \" + nicDeviceType + \" is specified in VM details, switch to default E1000\");\n-                    details.put(VmDetailConstants.NIC_ADAPTER, VirtualEthernetCardType.E1000.toString());\n-                }\n-            }\n-        } else {\n-            // for user-VM, use E1000 as default\n-            if (nicDeviceType == null) {\n-                details.put(VmDetailConstants.NIC_ADAPTER, VirtualEthernetCardType.E1000.toString());\n-            } else {\n-                try {\n-                    VirtualEthernetCardType.valueOf(nicDeviceType);\n-                } catch (Exception e) {\n-                    s_logger.warn(\"Invalid NIC device type \" + nicDeviceType + \" is specified in VM details, switch to default E1000\");\n-                    details.put(VmDetailConstants.NIC_ADAPTER, VirtualEthernetCardType.E1000.toString());\n-                }\n-            }\n-        }\n-\n-        details.put(VmDetailConstants.BOOT_MODE, to.getBootMode());\n-        String diskDeviceType = details.get(VmDetailConstants.ROOT_DISK_CONTROLLER);\n-        if (userVm) {\n-            if (diskDeviceType == null) {\n-                details.put(VmDetailConstants.ROOT_DISK_CONTROLLER, _vmwareMgr.getRootDiskController());\n-            }\n-        }\n-        String diskController = details.get(VmDetailConstants.DATA_DISK_CONTROLLER);\n-        if (userVm) {\n-            if (diskController == null) {\n-                details.put(VmDetailConstants.DATA_DISK_CONTROLLER, DiskControllerType.lsilogic.toString());\n-            }\n-        }\n-\n-        if (vm.getType() == VirtualMachine.Type.NetScalerVm) {\n-            details.put(VmDetailConstants.ROOT_DISK_CONTROLLER, \"scsi\");\n-        }\n-\n-        List<NicProfile> nicProfiles = vm.getNics();\n-\n-        for (NicProfile nicProfile : nicProfiles) {\n-            if (nicProfile.getTrafficType() == TrafficType.Guest) {\n-                if (_networkMgr.isProviderSupportServiceInNetwork(nicProfile.getNetworkId(), Service.Firewall, Provider.CiscoVnmc)) {\n-                    details.put(\"ConfigureVServiceInNexus\", Boolean.TRUE.toString());\n-                }\n-                break;\n-            }\n-        }\n-\n-        long clusterId = getClusterId(vm.getId());\n-        details.put(VmwareReserveCpu.key(), VmwareReserveCpu.valueIn(clusterId).toString());\n-        details.put(VmwareReserveMemory.key(), VmwareReserveMemory.valueIn(clusterId).toString());\n-        to.setDetails(details);\n-\n-        if (vmType.equals(VirtualMachine.Type.DomainRouter)) {\n-\n-            NicProfile publicNicProfile = null;\n-            for (NicProfile nicProfile : nicProfiles) {\n-                if (nicProfile.getTrafficType() == TrafficType.Public) {\n-                    publicNicProfile = nicProfile;\n-                    break;\n-                }\n-            }\n-\n-            if (publicNicProfile != null) {\n-                NicTO[] nics = to.getNics();\n-\n-                // reserve extra NICs\n-                NicTO[] expandedNics = new NicTO[nics.length + _vmwareMgr.getRouterExtraPublicNics()];\n-                int i = 0;\n-                int deviceId = -1;\n-                for (i = 0; i < nics.length; i++) {\n-                    expandedNics[i] = nics[i];\n-                    if (nics[i].getDeviceId() > deviceId)\n-                        deviceId = nics[i].getDeviceId();\n-                }\n-                deviceId++;\n-\n-                long networkId = publicNicProfile.getNetworkId();\n-                NetworkVO network = _networkDao.findById(networkId);\n-\n-                for (; i < nics.length + _vmwareMgr.getRouterExtraPublicNics(); i++) {\n-                    NicTO nicTo = new NicTO();\n-\n-                    nicTo.setDeviceId(deviceId++);\n-                    nicTo.setBroadcastType(publicNicProfile.getBroadcastType());\n-                    nicTo.setType(publicNicProfile.getTrafficType());\n-                    nicTo.setIp(\"0.0.0.0\");\n-                    nicTo.setNetmask(\"255.255.255.255\");\n-\n-                    try {\n-                        String mac = _networkMgr.getNextAvailableMacAddressInNetwork(networkId);\n-                        nicTo.setMac(mac);\n-                    } catch (InsufficientAddressCapacityException e) {\n-                        throw new CloudRuntimeException(\"unable to allocate mac address on network: \" + networkId);\n-                    }\n-                    nicTo.setDns1(publicNicProfile.getIPv4Dns1());\n-                    nicTo.setDns2(publicNicProfile.getIPv4Dns2());\n-                    if (publicNicProfile.getIPv4Gateway() != null) {\n-                        nicTo.setGateway(publicNicProfile.getIPv4Gateway());\n-                    } else {\n-                        nicTo.setGateway(network.getGateway());\n-                    }\n-                    nicTo.setDefaultNic(false);\n-                    nicTo.setBroadcastUri(publicNicProfile.getBroadCastUri());\n-                    nicTo.setIsolationuri(publicNicProfile.getIsolationUri());\n-\n-                    Integer networkRate = _networkMgr.getNetworkRate(network.getId(), null);\n-                    nicTo.setNetworkRateMbps(networkRate);\n-\n-                    expandedNics[i] = nicTo;\n-                }\n-\n-                to.setNics(expandedNics);\n-\n-                VirtualMachine router = vm.getVirtualMachine();\n-                DomainRouterVO routerVO = _domainRouterDao.findById(router.getId());\n-                if (routerVO != null && routerVO.getIsRedundantRouter()) {\n-                    Long peerRouterId = _nicDao.getPeerRouterId(publicNicProfile.getMacAddress(), router.getId());\n-                    DomainRouterVO peerRouterVO = null;\n-                    if (peerRouterId != null) {\n-                        peerRouterVO = _domainRouterDao.findById(peerRouterId);\n-                        if (peerRouterVO != null) {\n-                            details.put(\"PeerRouterInstanceName\", peerRouterVO.getInstanceName());\n-                        }\n-                    }\n-                }\n-            }\n-\n-            StringBuffer sbMacSequence = new StringBuffer();\n-            for (NicTO nicTo : sortNicsByDeviceId(to.getNics())) {\n-                sbMacSequence.append(nicTo.getMac()).append(\"|\");\n-            }\n-            if (!sbMacSequence.toString().isEmpty()) {\n-                sbMacSequence.deleteCharAt(sbMacSequence.length() - 1);\n-                String bootArgs = to.getBootArgs();\n-                to.setBootArgs(bootArgs + \" nic_macs=\" + sbMacSequence.toString());\n-            }\n-\n-        }\n-\n-        // Don't do this if the virtual machine is one of the special types\n-        // Should only be done on user machines\n-        if (userVm) {\n-            configureNestedVirtualization(details, to);\n-        }\n-        // Determine the VM's OS description\n-        GuestOSVO guestOS = _guestOsDao.findByIdIncludingRemoved(vm.getVirtualMachine().getGuestOSId());\n-        to.setOs(guestOS.getDisplayName());\n-        to.setHostName(vm.getHostName());\n-        HostVO host = _hostDao.findById(vm.getVirtualMachine().getHostId());\n-        GuestOSHypervisorVO guestOsMapping = null;\n-        if (host != null) {\n-            guestOsMapping = _guestOsHypervisorDao.findByOsIdAndHypervisor(guestOS.getId(), getHypervisorType().toString(), host.getHypervisorVersion());\n-        }\n-        if (guestOsMapping == null || host == null) {\n-            to.setPlatformEmulator(null);\n-        } else {\n-            to.setPlatformEmulator(guestOsMapping.getGuestOsName());\n-        }\n-\n-        List<OVFPropertyTO> ovfProperties = new ArrayList<>();\n-        for (String detailKey : details.keySet()) {\n-            if (detailKey.startsWith(ApiConstants.OVF_PROPERTIES)) {\n-                String ovfPropKey = detailKey.replace(ApiConstants.OVF_PROPERTIES + \"-\", \"\");\n-                TemplateOVFPropertyVO templateOVFPropertyVO = templateOVFPropertiesDao.findByTemplateAndKey(vm.getTemplateId(), ovfPropKey);\n-                if (templateOVFPropertyVO == null) {\n-                    s_logger.warn(String.format(\"OVF property %s not found on template, discarding\", ovfPropKey));\n-                    continue;\n-                }\n-                String ovfValue = details.get(detailKey);\n-                boolean isPassword = templateOVFPropertyVO.isPassword();\n-                OVFPropertyTO propertyTO = new OVFPropertyTO(ovfPropKey, ovfValue, isPassword);\n-                ovfProperties.add(propertyTO);\n-            }\n-        }\n-\n-        if (CollectionUtils.isNotEmpty(ovfProperties)) {\n-            removeOvfPropertiesFromDetails(ovfProperties, details);\n-            String templateInstallPath = null;\n-            List<DiskTO> rootDiskList = vm.getDisks().stream().filter(x -> x.getType() == Volume.Type.ROOT).collect(Collectors.toList());\n-            if (rootDiskList.size() != 1) {\n-                throw new CloudRuntimeException(\"Did not find only one root disk for VM \" + vm.getHostName());\n-            }\n-\n-            DiskTO rootDiskTO = rootDiskList.get(0);\n-            DataStoreTO dataStore = rootDiskTO.getData().getDataStore();\n-            StoragePoolVO storagePoolVO = _storagePoolDao.findByUuid(dataStore.getUuid());\n-            long dataCenterId = storagePoolVO.getDataCenterId();\n-            List<StoragePoolVO> pools = _storagePoolDao.listByDataCenterId(dataCenterId);\n-            for (StoragePoolVO pool : pools) {\n-                VMTemplateStoragePoolVO ref = templateStoragePoolDao.findByPoolTemplate(pool.getId(), vm.getTemplateId());\n-                if (ref != null && ref.getDownloadState() == VMTemplateStorageResourceAssoc.Status.DOWNLOADED) {\n-                    templateInstallPath = ref.getInstallPath();\n-                    break;\n-                }\n-            }\n+    @Override public VirtualMachineTO implement(VirtualMachineProfile vm) {\n+        vmwareVmImplementer = ComponentContext.inject(new VmwareVmImplementer(this));", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "3041b0d891d3847786b523d9e7a9e26b9f083e79"}, "originalPosition": 425}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxODI0MjcyMg==", "bodyText": "Just format stuff: these annotations have been moved to the same line as the method's firm all over the class", "url": "https://github.com/apache/cloudstack/pull/4021#discussion_r418242722", "createdAt": "2020-04-30T19:35:20Z", "author": {"login": "nvazquez"}, "path": "plugins/hypervisors/vmware/src/main/java/com/cloud/hypervisor/guru/VMwareGuru.java", "diffHunk": "@@ -686,8 +400,7 @@ public int compare(NicTO arg0, NicTO arg1) {\n         return new Pair<Boolean, Long>(Boolean.FALSE, new Long(hostId));\n     }\n \n-    @Override\n-    public boolean trackVmHostChange() {\n+    @Override public boolean trackVmHostChange() {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "3041b0d891d3847786b523d9e7a9e26b9f083e79"}, "originalPosition": 551}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDA1ODMwNjI4", "url": "https://github.com/apache/cloudstack/pull/4021#pullrequestreview-405830628", "createdAt": "2020-05-05T14:14:29Z", "commit": {"oid": "146f57b069d796cda9024721ff52f5cf0c48e443"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDA2NzkwMTY2", "url": "https://github.com/apache/cloudstack/pull/4021#pullrequestreview-406790166", "createdAt": "2020-05-06T16:35:29Z", "commit": {"oid": "734535c573dd3167a0bf8ec2f314b369a9a7a155"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDI0MDU4MDY3", "url": "https://github.com/apache/cloudstack/pull/4021#pullrequestreview-424058067", "createdAt": "2020-06-04T02:24:00Z", "commit": {"oid": "734535c573dd3167a0bf8ec2f314b369a9a7a155"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wNFQwMjoyNDowMFrOGezmWQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wNFQwMjoyNDowMFrOGezmWQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNDk1NTg2NQ==", "bodyText": "@DaanHoogland Is hardware setup same as boot setup?", "url": "https://github.com/apache/cloudstack/pull/4021#discussion_r434955865", "createdAt": "2020-06-04T02:24:00Z", "author": {"login": "rhtyd"}, "path": "api/src/main/java/com/cloud/agent/api/to/VirtualMachineTO.java", "diffHunk": "@@ -65,6 +65,7 @@\n     String uuid;\n     String bootType;\n     String bootMode;\n+    boolean enterHardwareSetup;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "734535c573dd3167a0bf8ec2f314b369a9a7a155"}, "originalPosition": 4}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDI0MDU4MjM2", "url": "https://github.com/apache/cloudstack/pull/4021#pullrequestreview-424058236", "createdAt": "2020-06-04T02:24:27Z", "commit": {"oid": "734535c573dd3167a0bf8ec2f314b369a9a7a155"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a9f46d3eab0e17e1c5d89ec420c3f99ad31d31a8", "author": {"user": {"login": "DaanHoogland", "name": "dahn"}}, "url": "https://github.com/apache/cloudstack/commit/a9f46d3eab0e17e1c5d89ec420c3f99ad31d31a8", "committedDate": "2020-06-04T07:35:34Z", "message": "fixes and comments addressed"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "edb227f3e2b81f0d3b2b39962b11f2743d59a4ae", "author": {"user": {"login": "DaanHoogland", "name": "dahn"}}, "url": "https://github.com/apache/cloudstack/commit/edb227f3e2b81f0d3b2b39962b11f2743d59a4ae", "committedDate": "2020-06-04T07:35:34Z", "message": "add boolean flag boot into bios"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "00488efebbddb812cc8bf04409079faddfbff7ca", "author": {"user": {"login": "DaanHoogland", "name": "dahn"}}, "url": "https://github.com/apache/cloudstack/commit/00488efebbddb812cc8bf04409079faddfbff7ca", "committedDate": "2020-06-04T07:35:34Z", "message": "new parameter and since attributes"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "07643360a767497c3a70a9363bf5d3ac6773ee7b", "author": {"user": {"login": "DaanHoogland", "name": "dahn"}}, "url": "https://github.com/apache/cloudstack/commit/07643360a767497c3a70a9363bf5d3ac6773ee7b", "committedDate": "2020-06-04T07:35:34Z", "message": "acception boot into bios paramter"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "76076c2575f1669bf4eb36954b74580fc693de86", "author": {"user": {"login": "DaanHoogland", "name": "dahn"}}, "url": "https://github.com/apache/cloudstack/commit/76076c2575f1669bf4eb36954b74580fc693de86", "committedDate": "2020-06-04T07:35:34Z", "message": "factor out implement method"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f5c970fe507283f1b424183d3bcc1f931af05003", "author": {"user": null}, "url": "https://github.com/apache/cloudstack/commit/f5c970fe507283f1b424183d3bcc1f931af05003", "committedDate": "2020-06-04T07:35:34Z", "message": "enable setup on vm bootoptions"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "29334c2ccbdc6fcf8ccc08cb769c25f391796751", "author": {"user": {"login": "DaanHoogland", "name": "dahn"}}, "url": "https://github.com/apache/cloudstack/commit/29334c2ccbdc6fcf8ccc08cb769c25f391796751", "committedDate": "2020-06-04T07:35:34Z", "message": "(re)boot into bios full stack?"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "72b1392c600c6d916ff5d7deed2979cc560622a6", "author": {"user": {"login": "DaanHoogland", "name": "dahn"}}, "url": "https://github.com/apache/cloudstack/commit/72b1392c600c6d916ff5d7deed2979cc560622a6", "committedDate": "2020-06-04T07:35:34Z", "message": "enterSetup as boolean (part 1)"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "274f2e33e3eb4137884160992ad0a894d25e6ce7", "author": {"user": null}, "url": "https://github.com/apache/cloudstack/commit/274f2e33e3eb4137884160992ad0a894d25e6ce7", "committedDate": "2020-06-04T07:35:34Z", "message": "enterSetup as boolean (part 2)"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "d7590a8a99edfb40782d15da2f2edc8241fd7e76", "author": {"user": null}, "url": "https://github.com/apache/cloudstack/commit/d7590a8a99edfb40782d15da2f2edc8241fd7e76", "committedDate": "2020-06-04T07:35:34Z", "message": "ui fields (unconditionally)"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ab01d482dee4b7b95fd53aeb7600dce277253f57", "author": {"user": null}, "url": "https://github.com/apache/cloudstack/commit/ab01d482dee4b7b95fd53aeb7600dce277253f57", "committedDate": "2020-06-04T07:35:34Z", "message": "trace value of param before and after job queue"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "4183ed69b0915820236c27ab375ec1aea54684d2", "author": {"user": null}, "url": "https://github.com/apache/cloudstack/commit/4183ed69b0915820236c27ab375ec1aea54684d2", "committedDate": "2020-06-04T07:35:34Z", "message": "guard log against npe"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "92c367a13e290e4e156f4a462c4d8a905383062a", "author": {"user": null}, "url": "https://github.com/apache/cloudstack/commit/92c367a13e290e4e156f4a462c4d8a905383062a", "committedDate": "2020-06-04T07:35:34Z", "message": "pass parameter on start of existing VM"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a050733c68bb5614e7d9dc4150905d4b3db167b9", "author": {"user": null}, "url": "https://github.com/apache/cloudstack/commit/a050733c68bb5614e7d9dc4150905d4b3db167b9", "committedDate": "2020-06-04T07:35:34Z", "message": "moving parameter for passing down"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b42624fd6326a56e94095cbef0712615cdd39a35", "author": {"user": null}, "url": "https://github.com/apache/cloudstack/commit/b42624fd6326a56e94095cbef0712615cdd39a35", "committedDate": "2020-06-04T07:35:34Z", "message": "log-trace"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "96b1d123be8cd88059638294716f8b6c29075341", "author": {"user": {"login": "DaanHoogland", "name": "dahn"}}, "url": "https://github.com/apache/cloudstack/commit/96b1d123be8cd88059638294716f8b6c29075341", "committedDate": "2020-06-04T07:35:34Z", "message": "just retrieve param, not param of param"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "4786e33b9ba66994de516f739824aa8118f97614", "author": {"user": {"login": "DaanHoogland", "name": "dahn"}}, "url": "https://github.com/apache/cloudstack/commit/4786e33b9ba66994de516f739824aa8118f97614", "committedDate": "2020-06-04T07:35:34Z", "message": "more trace"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "5f4301e535a05fccb2200e004fe0403072d30e51", "author": {"user": null}, "url": "https://github.com/apache/cloudstack/commit/5f4301e535a05fccb2200e004fe0403072d30e51", "committedDate": "2020-06-04T07:35:34Z", "message": "tracerest"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "fbc674b37858610dd2b65b8bdf8e46e87508d191", "author": {"user": null}, "url": "https://github.com/apache/cloudstack/commit/fbc674b37858610dd2b65b8bdf8e46e87508d191", "committedDate": "2020-06-04T07:35:34Z", "message": "enable BIOS setup only on vmware"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "d6354bb496989af5dd6dca223d84b371b81036e7", "author": {"user": null}, "url": "https://github.com/apache/cloudstack/commit/d6354bb496989af5dd6dca223d84b371b81036e7", "committedDate": "2020-06-04T07:35:34Z", "message": "log and passthrough param on startVM"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "d3b530434b2640137e079ace37d4ef61340c4280", "author": {"user": null}, "url": "https://github.com/apache/cloudstack/commit/d3b530434b2640137e079ace37d4ef61340c4280", "committedDate": "2020-06-04T07:35:34Z", "message": "barf if bootintobios on non-vmware"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "69824727e3f09bba84cb71664b868c334ef2fb6e", "author": {"user": {"login": "DaanHoogland", "name": "dahn"}}, "url": "https://github.com/apache/cloudstack/commit/69824727e3f09bba84cb71664b868c334ef2fb6e", "committedDate": "2020-06-04T07:35:34Z", "message": "import"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a6e81d78059d8439a4400015bfb85db83a8be367", "author": {"user": {"login": "DaanHoogland", "name": "dahn"}}, "url": "https://github.com/apache/cloudstack/commit/a6e81d78059d8439a4400015bfb85db83a8be367", "committedDate": "2020-06-04T07:35:34Z", "message": "silly unmnecessary npe"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a596cfe007c1e18625869dadaec492a7e05b7fe1", "author": {"user": null}, "url": "https://github.com/apache/cloudstack/commit/a596cfe007c1e18625869dadaec492a7e05b7fe1", "committedDate": "2020-06-04T07:35:34Z", "message": "trace parameter adding"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "d42e7d489408abd7c8c1b9cb404036082d9f12ae", "author": {"user": null}, "url": "https://github.com/apache/cloudstack/commit/d42e7d489408abd7c8c1b9cb404036082d9f12ae", "committedDate": "2020-06-04T07:35:35Z", "message": "keep result for next pass"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "1229e0528c8d2051537046a2c4610fa8123ee8a4", "author": {"user": null}, "url": "https://github.com/apache/cloudstack/commit/1229e0528c8d2051537046a2c4610fa8123ee8a4", "committedDate": "2020-06-04T07:35:35Z", "message": "boot into setup (not necessarily BIOS)"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b4d97dd8d4249d846f57d794047f4351f4d5380f", "author": {"user": {"login": "DaanHoogland", "name": "dahn"}}, "url": "https://github.com/apache/cloudstack/commit/b4d97dd8d4249d846f57d794047f4351f4d5380f", "committedDate": "2020-06-04T07:35:35Z", "message": "readability comments aplied"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "5325bc399308465540b8103fd68f02c98b3d586d", "author": {"user": null}, "url": "https://github.com/apache/cloudstack/commit/5325bc399308465540b8103fd68f02c98b3d586d", "committedDate": "2020-06-04T07:35:35Z", "message": "don't reboot if setup requested but not set"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "357dccd2c4e7836143463b1f9646332389023f83", "author": {"user": null}, "url": "https://github.com/apache/cloudstack/commit/357dccd2c4e7836143463b1f9646332389023f83", "committedDate": "2020-06-04T07:35:35Z", "message": "inject implementer"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ba9e85371f47e560d71c7a9643a9745b83461b09", "author": {"user": null}, "url": "https://github.com/apache/cloudstack/commit/ba9e85371f47e560d71c7a9643a9745b83461b09", "committedDate": "2020-06-04T07:35:35Z", "message": "no name in bean"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "5cb7a2b4d6c913acf1bb379f370856e330800b22", "author": {"user": {"login": "DaanHoogland", "name": "dahn"}}, "url": "https://github.com/apache/cloudstack/commit/5cb7a2b4d6c913acf1bb379f370856e330800b22", "committedDate": "2020-06-04T07:35:35Z", "message": "further modularisation"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "448cd2e1b4cd2cdf539f11cf6cb73d8e7cc8f0e8", "author": {"user": null}, "url": "https://github.com/apache/cloudstack/commit/448cd2e1b4cd2cdf539f11cf6cb73d8e7cc8f0e8", "committedDate": "2020-06-04T07:35:35Z", "message": "nested virtualisation flags available in unit tests and prod"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "69db80a2f72e80214eae141d3d7b169b040dec94", "author": {"user": null}, "url": "https://github.com/apache/cloudstack/commit/69db80a2f72e80214eae141d3d7b169b040dec94", "committedDate": "2020-06-04T07:35:35Z", "message": "log name not nics"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "734535c573dd3167a0bf8ec2f314b369a9a7a155", "author": {"user": null}, "url": "https://github.com/apache/cloudstack/commit/734535c573dd3167a0bf8ec2f314b369a9a7a155", "committedDate": "2020-05-06T12:48:10Z", "message": "log name not nics"}, "afterCommit": {"oid": "69db80a2f72e80214eae141d3d7b169b040dec94", "author": {"user": null}, "url": "https://github.com/apache/cloudstack/commit/69db80a2f72e80214eae141d3d7b169b040dec94", "committedDate": "2020-06-04T07:35:35Z", "message": "log name not nics"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDI4NjU5MTQ2", "url": "https://github.com/apache/cloudstack/pull/4021#pullrequestreview-428659146", "createdAt": "2020-06-11T07:30:39Z", "commit": {"oid": "69db80a2f72e80214eae141d3d7b169b040dec94"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDM0ODQyNTcy", "url": "https://github.com/apache/cloudstack/pull/4021#pullrequestreview-434842572", "createdAt": "2020-06-22T11:41:18Z", "commit": {"oid": "69db80a2f72e80214eae141d3d7b169b040dec94"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yMlQxMTo0MToxOFrOGm9AYw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yMlQxMTo0MToxOFrOGm9AYw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MzQ5ODU5NQ==", "bodyText": "I don't like this message, missing capital \"B\" and in general I don't like it... can we reword it to  \"...not supported for ....\" or similar?", "url": "https://github.com/apache/cloudstack/pull/4021#discussion_r443498595", "createdAt": "2020-06-22T11:41:18Z", "author": {"login": "andrijapanicsb"}, "path": "server/src/main/java/com/cloud/vm/UserVmManagerImpl.java", "diffHunk": "@@ -2866,7 +2892,11 @@ public UserVm rebootVirtualMachine(RebootVMCmd cmd) throws InsufficientCapacityE\n             throw new InvalidParameterValueException(\"Unable to find service offering: \" + serviceOfferingId + \" corresponding to the vm\");\n         }\n \n-        UserVm userVm = rebootVirtualMachine(CallContext.current().getCallingUserId(), vmId);\n+        Boolean enterSetup = cmd.getBootIntoSetup();\n+        if (enterSetup != null && !HypervisorType.VMware.equals(vmInstance.getHypervisorType())) {\n+            throw new InvalidParameterValueException(\"booting into a hardware setup menu does not make sense on \" + vmInstance.getHypervisorType());", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "69db80a2f72e80214eae141d3d7b169b040dec94"}, "originalPosition": 82}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4191, "cost": 1, "resetAt": "2021-10-28T17:48:14Z"}}}