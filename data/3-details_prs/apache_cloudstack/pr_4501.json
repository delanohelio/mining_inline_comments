{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTI2MTk1Nzc4", "number": 4501, "title": "Disallowing udp for lb rules for haproxy", "bodyText": "Description\nSince CloudStack uses HAproxy as a load balancer which doesn't support udp, adding checks to prevent udp from being passed as the protocol\nhaproxy/haproxy#62\nTypes of changes\n\n Breaking change (fix or feature that would cause existing functionality to change)\n New feature (non-breaking change which adds functionality)\n Bug fix (non-breaking change which fixes an issue)\n Enhancement (improves an existing feature and functionality)\n Cleanup (Code refactoring and cleanup, that may add test cases)\n\nFeature/Enhancement Scale or Bug Severity\nFeature/Enhancement Scale\n\n Major\n Minor\n\nBug Severity\n\n BLOCKER\n Critical\n Major\n Minor\n Trivial\n\nHow Has This Been Tested?\n(localhost) \ud83d\udc31 > create loadbalancerrule publicipid=afe66a42-2ebc-476b-bf5f-8954fcc42f32 protocol=udp publicport=80 privateport=80 algorithm=roundrobin name=test\n\ud83d\ude48 Error: (HTTP 431, error code 9999) LB service provider cannot support this rule", "createdAt": "2020-11-24T05:57:10Z", "url": "https://github.com/apache/cloudstack/pull/4501", "merged": true, "mergeCommit": {"oid": "7f5eb6463e57e3807504a1e49961991db441063f"}, "closed": true, "closedAt": "2020-12-02T08:29:03Z", "author": {"login": "davidjumani"}, "timelineItems": {"totalCount": 12, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdfjQGYgH2gAyNTI2MTk1Nzc4OmE1ZjQzMDE0YzlkZGVkMDFkMTk5ZDU1YTg0ZmQ2Y2RjNGQxMGM5MGI=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdiKQQYAFqTU0MjU5NDI1NQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "a5f43014c9dded01d199d55a84fd6cdc4d10c90b", "author": {"user": {"login": "davidjumani", "name": null}}, "url": "https://github.com/apache/cloudstack/commit/a5f43014c9dded01d199d55a84fd6cdc4d10c90b", "committedDate": "2020-11-24T05:53:09Z", "message": "Disallowing udp for lb rules"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTM3MzI0NTEy", "url": "https://github.com/apache/cloudstack/pull/4501#pullrequestreview-537324512", "createdAt": "2020-11-24T09:59:25Z", "commit": {"oid": "a5f43014c9dded01d199d55a84fd6cdc4d10c90b"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTM4MjY4Nzk1", "url": "https://github.com/apache/cloudstack/pull/4501#pullrequestreview-538268795", "createdAt": "2020-11-25T08:48:01Z", "commit": {"oid": "a5f43014c9dded01d199d55a84fd6cdc4d10c90b"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0yNVQwODo0ODowMVrOH5ouIw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0yNVQwODo0ODowMVrOH5ouIw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMDE5ODA1MQ==", "bodyText": "@davidjumani as far as I remember, 'ssl' is also a valid protocol", "url": "https://github.com/apache/cloudstack/pull/4501#discussion_r530198051", "createdAt": "2020-11-25T08:48:01Z", "author": {"login": "weizhouapache"}, "path": "api/src/main/java/org/apache/cloudstack/api/command/user/loadbalancer/CreateLoadBalancerRuleCmd.java", "diffHunk": "@@ -255,6 +255,12 @@ public Boolean getOpenFirewall() {\n     }\n \n     public String getLbProtocol() {\n+        if (lbProtocol != null) {\n+            lbProtocol = lbProtocol.toLowerCase();\n+            if (!lbProtocol.equals(NetUtils.TCP_PROTO) && !lbProtocol.equals(NetUtils.TCP_PROXY_PROTO)) {\n+                throw new InvalidParameterValueException(\"Invalid protocool. Supported protocols are tcp and tcp-proxy\");", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "a5f43014c9dded01d199d55a84fd6cdc4d10c90b"}, "originalPosition": 16}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTM4MjcwMTY5", "url": "https://github.com/apache/cloudstack/pull/4501#pullrequestreview-538270169", "createdAt": "2020-11-25T08:49:46Z", "commit": {"oid": "a5f43014c9dded01d199d55a84fd6cdc4d10c90b"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0yNVQwODo0OTo0NlrOH5oyjQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0yNVQwODo0OTo0NlrOH5oyjQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMDE5OTE4MQ==", "bodyText": "@davidjumani might 'udp' be supportd by some lb hardware devices ?", "url": "https://github.com/apache/cloudstack/pull/4501#discussion_r530199181", "createdAt": "2020-11-25T08:49:46Z", "author": {"login": "weizhouapache"}, "path": "api/src/main/java/org/apache/cloudstack/api/command/user/loadbalancer/CreateLoadBalancerRuleCmd.java", "diffHunk": "@@ -114,7 +114,7 @@\n         + \"rule will be created for. Required when public Ip address is not associated with any Guest network yet (VPC case)\")\n     private Long networkId;\n \n-    @Parameter(name = ApiConstants.PROTOCOL, type = CommandType.STRING, description = \"The protocol for the LB such as tcp, udp or tcp-proxy.\")\n+    @Parameter(name = ApiConstants.PROTOCOL, type = CommandType.STRING, description = \"The protocol for the LB such as tcp or tcp-proxy.\")\n     private String lbProtocol;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "a5f43014c9dded01d199d55a84fd6cdc4d10c90b"}, "originalPosition": 6}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e23537bac50f9fbf038c5d966e0506fac5713082", "author": {"user": {"login": "davidjumani", "name": null}}, "url": "https://github.com/apache/cloudstack/commit/e23537bac50f9fbf038c5d966e0506fac5713082", "committedDate": "2020-11-26T08:53:19Z", "message": "Revert \"Disallowing udp for lb rules\"\n\nThis reverts commit a5f43014c9dded01d199d55a84fd6cdc4d10c90b."}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "d6b98ce1b465b62fcbe499c3fe7ca5bff0fdc9ad", "author": {"user": {"login": "davidjumani", "name": null}}, "url": "https://github.com/apache/cloudstack/commit/d6b98ce1b465b62fcbe499c3fe7ca5bff0fdc9ad", "committedDate": "2020-11-26T09:05:29Z", "message": "Adding check for udp rules for haproxy"}, "afterCommit": {"oid": "cf37c9577699868287e1e937cbad9f5cb31c07cc", "author": {"user": {"login": "davidjumani", "name": null}}, "url": "https://github.com/apache/cloudstack/commit/cf37c9577699868287e1e937cbad9f5cb31c07cc", "committedDate": "2020-11-26T09:06:54Z", "message": "Adding check for udp rules for haproxy"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "cf37c9577699868287e1e937cbad9f5cb31c07cc", "author": {"user": {"login": "davidjumani", "name": null}}, "url": "https://github.com/apache/cloudstack/commit/cf37c9577699868287e1e937cbad9f5cb31c07cc", "committedDate": "2020-11-26T09:06:54Z", "message": "Adding check for udp rules for haproxy"}, "afterCommit": {"oid": "bb1d68044049919dfeff93083b9c84c7779025a3", "author": {"user": {"login": "davidjumani", "name": null}}, "url": "https://github.com/apache/cloudstack/commit/bb1d68044049919dfeff93083b9c84c7779025a3", "committedDate": "2020-11-26T09:07:19Z", "message": "Adding check for udp rules for haproxy"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "9fee66d2481cc7e153bafff21b3c9c44b857224a", "author": {"user": {"login": "davidjumani", "name": null}}, "url": "https://github.com/apache/cloudstack/commit/9fee66d2481cc7e153bafff21b3c9c44b857224a", "committedDate": "2020-11-26T09:08:27Z", "message": "Adding check for udp rules for haproxy"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "bb1d68044049919dfeff93083b9c84c7779025a3", "author": {"user": {"login": "davidjumani", "name": null}}, "url": "https://github.com/apache/cloudstack/commit/bb1d68044049919dfeff93083b9c84c7779025a3", "committedDate": "2020-11-26T09:07:19Z", "message": "Adding check for udp rules for haproxy"}, "afterCommit": {"oid": "9fee66d2481cc7e153bafff21b3c9c44b857224a", "author": {"user": {"login": "davidjumani", "name": null}}, "url": "https://github.com/apache/cloudstack/commit/9fee66d2481cc7e153bafff21b3c9c44b857224a", "committedDate": "2020-11-26T09:08:27Z", "message": "Adding check for udp rules for haproxy"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTM5NzYxMDgy", "url": "https://github.com/apache/cloudstack/pull/4501#pullrequestreview-539761082", "createdAt": "2020-11-27T07:42:08Z", "commit": {"oid": "9fee66d2481cc7e153bafff21b3c9c44b857224a"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "7227685fb53f824ccb632647f39e033e4d192707", "author": {"user": {"login": "davidjumani", "name": null}}, "url": "https://github.com/apache/cloudstack/commit/7227685fb53f824ccb632647f39e033e4d192707", "committedDate": "2020-11-30T05:12:31Z", "message": "Adding defensive check"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTQyNTk0MjU1", "url": "https://github.com/apache/cloudstack/pull/4501#pullrequestreview-542594255", "createdAt": "2020-12-02T08:27:28Z", "commit": {"oid": "7227685fb53f824ccb632647f39e033e4d192707"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4838, "cost": 1, "resetAt": "2021-10-28T17:48:14Z"}}}