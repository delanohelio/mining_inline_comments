{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDgxNTc5Njc3", "number": 4307, "reviewThreads": {"totalCount": 89, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yOVQxMzoxMTo1MVrOEoiuKA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0yNFQwNToxOToxMVrOE8hdhw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzEwOTQ3MzY4OnYy", "diffSide": "RIGHT", "path": "api/src/main/java/org/apache/cloudstack/api/command/user/template/ListTemplatesCmd.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yOVQxMzoxMTo1MVrOHZsaag==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yOVQxMzoxMTo1MVrOHZsaag==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NjcwNDEwNg==", "bodyText": "add a since = \"4.15\"", "url": "https://github.com/apache/cloudstack/pull/4307#discussion_r496704106", "createdAt": "2020-09-29T13:11:51Z", "author": {"login": "DaanHoogland"}, "path": "api/src/main/java/org/apache/cloudstack/api/command/user/template/ListTemplatesCmd.java", "diffHunk": "@@ -82,10 +86,35 @@\n     @Parameter(name = ApiConstants.PARENT_TEMPLATE_ID, type = CommandType.UUID, entityType = TemplateResponse.class, description = \"list datadisk templates by parent template id\", since = \"4.4\")\n     private Long parentTemplateId;\n \n+    @Parameter(name = ApiConstants.DETAILS,", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "0a2823b80cb5cd1838a7e6ec3cd690619c2c17e8"}, "originalPosition": 17}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzEwOTUyMzIxOnYy", "diffSide": "RIGHT", "path": "api/src/main/java/org/apache/cloudstack/api/response/TemplateResponse.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yOVQxMzoyMjo1N1rOHZs5Dw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yOVQxMzoyMjo1N1rOHZs5Dw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NjcxMTk1MQ==", "bodyText": "add since = \"4.15\"", "url": "https://github.com/apache/cloudstack/pull/4307#discussion_r496711951", "createdAt": "2020-09-29T13:22:57Z", "author": {"login": "DaanHoogland"}, "path": "api/src/main/java/org/apache/cloudstack/api/response/TemplateResponse.java", "diffHunk": "@@ -194,12 +195,22 @@\n     @Param(description = \"KVM Only: true if template is directly downloaded to Primary Storage bypassing Secondary Storage\")\n     private Boolean directDownload;\n \n+    @SerializedName(ApiConstants.DEPLOY_AS_IS)\n+    @Param(description = \"VMware only: true if template is deployed without orchestrating disks and networks but \\\"as-is\\\" defined in the template.\")", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "0a2823b80cb5cd1838a7e6ec3cd690619c2c17e8"}, "originalPosition": 67}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzEwOTUyMzk2OnYy", "diffSide": "RIGHT", "path": "api/src/main/java/org/apache/cloudstack/api/response/TemplateResponse.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yOVQxMzoyMzowNlrOHZs5cw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yOVQxMzoyMzowNlrOHZs5cw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NjcxMjA1MQ==", "bodyText": "add since = \"4.15\"", "url": "https://github.com/apache/cloudstack/pull/4307#discussion_r496712051", "createdAt": "2020-09-29T13:23:06Z", "author": {"login": "DaanHoogland"}, "path": "api/src/main/java/org/apache/cloudstack/api/response/TemplateResponse.java", "diffHunk": "@@ -194,12 +195,22 @@\n     @Param(description = \"KVM Only: true if template is directly downloaded to Primary Storage bypassing Secondary Storage\")\n     private Boolean directDownload;\n \n+    @SerializedName(ApiConstants.DEPLOY_AS_IS)\n+    @Param(description = \"VMware only: true if template is deployed without orchestrating disks and networks but \\\"as-is\\\" defined in the template.\")\n+    private Boolean deployAsIs;\n+\n+    @SerializedName(ApiConstants.DEPLOY_AS_IS_DETAILS)\n+    @Param(description = \"VMware only: additional key/value details tied with deploy-as-is template\")", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "0a2823b80cb5cd1838a7e6ec3cd690619c2c17e8"}, "originalPosition": 71}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzEwOTU0OTUzOnYy", "diffSide": "RIGHT", "path": "core/src/main/java/com/cloud/agent/api/ValidateVcenterDetailsCommand.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yOVQxMzoyODoyM1rOHZtJJQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yOVQxMzoyODoyM1rOHZtJJQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NjcxNjA2OQ==", "bodyText": "new class should be in org.apache.cloudstack", "url": "https://github.com/apache/cloudstack/pull/4307#discussion_r496716069", "createdAt": "2020-09-29T13:28:23Z", "author": {"login": "DaanHoogland"}, "path": "core/src/main/java/com/cloud/agent/api/ValidateVcenterDetailsCommand.java", "diffHunk": "@@ -0,0 +1,40 @@\n+// Licensed to the Apache Software Foundation (ASF) under one\n+// or more contributor license agreements.  See the NOTICE file\n+// distributed with this work for additional information\n+// regarding copyright ownership.  The ASF licenses this file\n+// to you under the Apache License, Version 2.0 (the\n+// \"License\"); you may not use this file except in compliance\n+// with the License.  You may obtain a copy of the License at\n+//\n+//   http://www.apache.org/licenses/LICENSE-2.0\n+//\n+// Unless required by applicable law or agreed to in writing,\n+// software distributed under the License is distributed on an\n+// \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n+// KIND, either express or implied.  See the License for the\n+// specific language governing permissions and limitations\n+// under the License.\n+\n+package com.cloud.agent.api;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "0a2823b80cb5cd1838a7e6ec3cd690619c2c17e8"}, "originalPosition": 18}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzEwOTU1MTIwOnYy", "diffSide": "RIGHT", "path": "api/src/main/java/com/cloud/agent/api/to/DeployAsIsInfoTO.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yOVQxMzoyODo0NFrOHZtKLA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yOVQxMzoyODo0NFrOHZtKLA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NjcxNjMzMg==", "bodyText": "new class should be in org.apache.cloudstack", "url": "https://github.com/apache/cloudstack/pull/4307#discussion_r496716332", "createdAt": "2020-09-29T13:28:44Z", "author": {"login": "DaanHoogland"}, "path": "api/src/main/java/com/cloud/agent/api/to/DeployAsIsInfoTO.java", "diffHunk": "@@ -0,0 +1,58 @@\n+// Licensed to the Apache Software Foundation (ASF) under one\n+// or more contributor license agreements.  See the NOTICE file\n+// distributed with this work for additional information\n+// regarding copyright ownership.  The ASF licenses this file\n+// to you under the Apache License, Version 2.0 (the\n+// \"License\"); you may not use this file except in compliance\n+// with the License.  You may obtain a copy of the License at\n+//\n+//   http://www.apache.org/licenses/LICENSE-2.0\n+//\n+// Unless required by applicable law or agreed to in writing,\n+// software distributed under the License is distributed on an\n+// \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n+// KIND, either express or implied.  See the License for the\n+// specific language governing permissions and limitations\n+// under the License.\n+package com.cloud.agent.api.to;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "0a2823b80cb5cd1838a7e6ec3cd690619c2c17e8"}, "originalPosition": 17}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzEwOTU1NDA2OnYy", "diffSide": "RIGHT", "path": "api/src/main/java/com/cloud/agent/api/to/deployasis/OVFEulaSectionTO.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yOVQxMzoyOToxOFrOHZtL9Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yOVQxMzoyOToxOFrOHZtL9Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NjcxNjc4OQ==", "bodyText": "new class should be in org.apache.cloudstack", "url": "https://github.com/apache/cloudstack/pull/4307#discussion_r496716789", "createdAt": "2020-09-29T13:29:18Z", "author": {"login": "DaanHoogland"}, "path": "api/src/main/java/com/cloud/agent/api/to/deployasis/OVFEulaSectionTO.java", "diffHunk": "@@ -0,0 +1,49 @@\n+//\n+// Licensed to the Apache Software Foundation (ASF) under one\n+// or more contributor license agreements.  See the NOTICE file\n+// distributed with this work for additional information\n+// regarding copyright ownership.  The ASF licenses this file\n+// to you under the Apache License, Version 2.0 (the\n+// \"License\"); you may not use this file except in compliance\n+// with the License.  You may obtain a copy of the License at\n+//\n+//   http://www.apache.org/licenses/LICENSE-2.0\n+//\n+// Unless required by applicable law or agreed to in writing,\n+// software distributed under the License is distributed on an\n+// \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n+// KIND, either express or implied.  See the License for the\n+// specific language governing permissions and limitations\n+// under the License.\n+//\n+package com.cloud.agent.api.to.deployasis;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "0a2823b80cb5cd1838a7e6ec3cd690619c2c17e8"}, "originalPosition": 19}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzEwOTU1NDg1OnYy", "diffSide": "RIGHT", "path": "api/src/main/java/com/cloud/agent/api/to/deployasis/OVFConfigurationTO.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yOVQxMzoyOToyOFrOHZtMaA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yOVQxMzoyOToyOFrOHZtMaA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NjcxNjkwNA==", "bodyText": "new class should be in org.apache.cloudstack", "url": "https://github.com/apache/cloudstack/pull/4307#discussion_r496716904", "createdAt": "2020-09-29T13:29:28Z", "author": {"login": "DaanHoogland"}, "path": "api/src/main/java/com/cloud/agent/api/to/deployasis/OVFConfigurationTO.java", "diffHunk": "@@ -0,0 +1,61 @@\n+//\n+// Licensed to the Apache Software Foundation (ASF) under one\n+// or more contributor license agreements.  See the NOTICE file\n+// distributed with this work for additional information\n+// regarding copyright ownership.  The ASF licenses this file\n+// to you under the Apache License, Version 2.0 (the\n+// \"License\"); you may not use this file except in compliance\n+// with the License.  You may obtain a copy of the License at\n+//\n+//   http://www.apache.org/licenses/LICENSE-2.0\n+//\n+// Unless required by applicable law or agreed to in writing,\n+// software distributed under the License is distributed on an\n+// \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n+// KIND, either express or implied.  See the License for the\n+// specific language governing permissions and limitations\n+// under the License.\n+//\n+package com.cloud.agent.api.to.deployasis;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "0a2823b80cb5cd1838a7e6ec3cd690619c2c17e8"}, "originalPosition": 19}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzEwOTU1NjQ5OnYy", "diffSide": "RIGHT", "path": "api/src/main/java/com/cloud/agent/api/to/deployasis/OVFNetworkTO.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yOVQxMzoyOTo0NFrOHZtNYg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yOVQxMzoyOTo0NFrOHZtNYg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NjcxNzE1NA==", "bodyText": "new class should be in org.apache.cloudstack", "url": "https://github.com/apache/cloudstack/pull/4307#discussion_r496717154", "createdAt": "2020-09-29T13:29:44Z", "author": {"login": "DaanHoogland"}, "path": "api/src/main/java/com/cloud/agent/api/to/deployasis/OVFNetworkTO.java", "diffHunk": "@@ -0,0 +1,124 @@\n+// Licensed to the Apache Software Foundation (ASF) under one\n+// or more contributor license agreements.  See the NOTICE file\n+// distributed with this work for additional information\n+// regarding copyright ownership.  The ASF licenses this file\n+// to you under the Apache License, Version 2.0 (the\n+// \"License\"); you may not use this file except in compliance\n+// with the License.  You may obtain a copy of the License at\n+//\n+//   http://www.apache.org/licenses/LICENSE-2.0\n+//\n+// Unless required by applicable law or agreed to in writing,\n+// software distributed under the License is distributed on an\n+// \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n+// KIND, either express or implied.  See the License for the\n+// specific language governing permissions and limitations\n+// under the License.\n+package com.cloud.agent.api.to.deployasis;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "0a2823b80cb5cd1838a7e6ec3cd690619c2c17e8"}, "originalPosition": 17}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzEwOTU2NDgzOnYy", "diffSide": "RIGHT", "path": "api/src/main/java/com/cloud/agent/api/to/deployasis/OVFConfigurationTO.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yOVQxMzozMToyM1rOHZtSZQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yOVQxMzozMToyM1rOHZtSZQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NjcxODQzNw==", "bodyText": "small javadoc ?\n\n  \n    \n  \n    \n\n  \n  This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters. Learn more about bidirectional Unicode characters\n\n\n  \n\n\n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            public class OVFConfigurationTO implements TemplateDeployAsIsInformationTO {\n          \n          \n            \n            /**\n          \n          \n            \n             * contains lists of configurations items, parsed from the OVF\n          \n          \n            \n             */\n          \n          \n            \n            public class OVFConfigurationTO implements TemplateDeployAsIsInformationTO {", "url": "https://github.com/apache/cloudstack/pull/4307#discussion_r496718437", "createdAt": "2020-09-29T13:31:23Z", "author": {"login": "DaanHoogland"}, "path": "api/src/main/java/com/cloud/agent/api/to/deployasis/OVFConfigurationTO.java", "diffHunk": "@@ -0,0 +1,61 @@\n+//\n+// Licensed to the Apache Software Foundation (ASF) under one\n+// or more contributor license agreements.  See the NOTICE file\n+// distributed with this work for additional information\n+// regarding copyright ownership.  The ASF licenses this file\n+// to you under the Apache License, Version 2.0 (the\n+// \"License\"); you may not use this file except in compliance\n+// with the License.  You may obtain a copy of the License at\n+//\n+//   http://www.apache.org/licenses/LICENSE-2.0\n+//\n+// Unless required by applicable law or agreed to in writing,\n+// software distributed under the License is distributed on an\n+// \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n+// KIND, either express or implied.  See the License for the\n+// specific language governing permissions and limitations\n+// under the License.\n+//\n+package com.cloud.agent.api.to.deployasis;\n+\n+import java.util.List;\n+\n+public class OVFConfigurationTO implements TemplateDeployAsIsInformationTO {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "0a2823b80cb5cd1838a7e6ec3cd690619c2c17e8"}, "originalPosition": 23}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzEwOTU2OTE5OnYy", "diffSide": "RIGHT", "path": "api/src/main/java/com/cloud/agent/api/to/deployasis/OVFEulaSectionTO.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yOVQxMzozMjoyMlrOHZtVCg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yOVQxMzozMjoyMlrOHZtVCg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NjcxOTExNA==", "bodyText": "\ud83d\udc4d \ud83c\udf89", "url": "https://github.com/apache/cloudstack/pull/4307#discussion_r496719114", "createdAt": "2020-09-29T13:32:22Z", "author": {"login": "DaanHoogland"}, "path": "api/src/main/java/com/cloud/agent/api/to/deployasis/OVFEulaSectionTO.java", "diffHunk": "@@ -0,0 +1,49 @@\n+//\n+// Licensed to the Apache Software Foundation (ASF) under one\n+// or more contributor license agreements.  See the NOTICE file\n+// distributed with this work for additional information\n+// regarding copyright ownership.  The ASF licenses this file\n+// to you under the Apache License, Version 2.0 (the\n+// \"License\"); you may not use this file except in compliance\n+// with the License.  You may obtain a copy of the License at\n+//\n+//   http://www.apache.org/licenses/LICENSE-2.0\n+//\n+// Unless required by applicable law or agreed to in writing,\n+// software distributed under the License is distributed on an\n+// \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n+// KIND, either express or implied.  See the License for the\n+// specific language governing permissions and limitations\n+// under the License.\n+//\n+package com.cloud.agent.api.to.deployasis;\n+\n+import com.cloud.agent.api.LogLevel;\n+\n+/**", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "0a2823b80cb5cd1838a7e6ec3cd690619c2c17e8"}, "originalPosition": 23}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzEwOTU3MDM0OnYy", "diffSide": "RIGHT", "path": "api/src/main/java/com/cloud/agent/api/to/OVFInformationTO.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yOVQxMzozMjozOFrOHZtVzQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yOVQxMzozMjozOFrOHZtVzQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NjcxOTMwOQ==", "bodyText": "new class should be in org.apache.cloudstack", "url": "https://github.com/apache/cloudstack/pull/4307#discussion_r496719309", "createdAt": "2020-09-29T13:32:38Z", "author": {"login": "DaanHoogland"}, "path": "api/src/main/java/com/cloud/agent/api/to/OVFInformationTO.java", "diffHunk": "@@ -0,0 +1,95 @@\n+//\n+// Licensed to the Apache Software Foundation (ASF) under one\n+// or more contributor license agreements.  See the NOTICE file\n+// distributed with this work for additional information\n+// regarding copyright ownership.  The ASF licenses this file\n+// to you under the Apache License, Version 2.0 (the\n+// \"License\"); you may not use this file except in compliance\n+// with the License.  You may obtain a copy of the License at\n+//\n+//   http://www.apache.org/licenses/LICENSE-2.0\n+//\n+// Unless required by applicable law or agreed to in writing,\n+// software distributed under the License is distributed on an\n+// \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n+// KIND, either express or implied.  See the License for the\n+// specific language governing permissions and limitations\n+// under the License.\n+//\n+package com.cloud.agent.api.to;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "0a2823b80cb5cd1838a7e6ec3cd690619c2c17e8"}, "originalPosition": 19}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzEwOTU3MTYxOnYy", "diffSide": "RIGHT", "path": "api/src/main/java/com/cloud/agent/api/to/OVFInformationTO.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yOVQxMzozMjo1NFrOHZtWhw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yOVQxMzozMjo1NFrOHZtWhw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NjcxOTQ5NQ==", "bodyText": "small javadoc?", "url": "https://github.com/apache/cloudstack/pull/4307#discussion_r496719495", "createdAt": "2020-09-29T13:32:54Z", "author": {"login": "DaanHoogland"}, "path": "api/src/main/java/com/cloud/agent/api/to/OVFInformationTO.java", "diffHunk": "@@ -0,0 +1,95 @@\n+//\n+// Licensed to the Apache Software Foundation (ASF) under one\n+// or more contributor license agreements.  See the NOTICE file\n+// distributed with this work for additional information\n+// regarding copyright ownership.  The ASF licenses this file\n+// to you under the Apache License, Version 2.0 (the\n+// \"License\"); you may not use this file except in compliance\n+// with the License.  You may obtain a copy of the License at\n+//\n+//   http://www.apache.org/licenses/LICENSE-2.0\n+//\n+// Unless required by applicable law or agreed to in writing,\n+// software distributed under the License is distributed on an\n+// \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n+// KIND, either express or implied.  See the License for the\n+// specific language governing permissions and limitations\n+// under the License.\n+//\n+package com.cloud.agent.api.to;\n+\n+import com.cloud.agent.api.LogLevel;\n+import com.cloud.agent.api.to.deployasis.OVFEulaSectionTO;\n+import com.cloud.agent.api.to.deployasis.OVFNetworkTO;\n+import com.cloud.agent.api.to.deployasis.OVFPropertyTO;\n+import com.cloud.agent.api.to.deployasis.OVFVirtualHardwareSectionTO;\n+import com.cloud.utils.Pair;\n+\n+import java.util.List;\n+\n+public class OVFInformationTO {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "0a2823b80cb5cd1838a7e6ec3cd690619c2c17e8"}, "originalPosition": 30}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzEwOTU3NTYyOnYy", "diffSide": "RIGHT", "path": "api/src/main/java/com/cloud/agent/api/to/DeployAsIsInfoTO.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yOVQxMzozMzo0NFrOHZtZHw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yOVQxMzozMzo0NFrOHZtZHw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NjcyMDE1OQ==", "bodyText": "javadoc, what on earth is an DeployAsIsInfoTO?", "url": "https://github.com/apache/cloudstack/pull/4307#discussion_r496720159", "createdAt": "2020-09-29T13:33:44Z", "author": {"login": "DaanHoogland"}, "path": "api/src/main/java/com/cloud/agent/api/to/DeployAsIsInfoTO.java", "diffHunk": "@@ -0,0 +1,58 @@\n+// Licensed to the Apache Software Foundation (ASF) under one\n+// or more contributor license agreements.  See the NOTICE file\n+// distributed with this work for additional information\n+// regarding copyright ownership.  The ASF licenses this file\n+// to you under the Apache License, Version 2.0 (the\n+// \"License\"); you may not use this file except in compliance\n+// with the License.  You may obtain a copy of the License at\n+//\n+//   http://www.apache.org/licenses/LICENSE-2.0\n+//\n+// Unless required by applicable law or agreed to in writing,\n+// software distributed under the License is distributed on an\n+// \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n+// KIND, either express or implied.  See the License for the\n+// specific language governing permissions and limitations\n+// under the License.\n+package com.cloud.agent.api.to;\n+\n+import com.cloud.agent.api.LogLevel;\n+\n+import java.util.HashMap;\n+import java.util.Map;\n+\n+public class DeployAsIsInfoTO {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "0a2823b80cb5cd1838a7e6ec3cd690619c2c17e8"}, "originalPosition": 24}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzEwOTU4MTIyOnYy", "diffSide": "RIGHT", "path": "api/src/main/java/com/cloud/agent/api/to/deployasis/OVFVirtualHardwareItemTO.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yOVQxMzozNDo1M1rOHZtcjQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yOVQxMzozNDo1M1rOHZtcjQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NjcyMTAzNw==", "bodyText": "please change to javadoc, adding two or three words? nothing special", "url": "https://github.com/apache/cloudstack/pull/4307#discussion_r496721037", "createdAt": "2020-09-29T13:34:53Z", "author": {"login": "DaanHoogland"}, "path": "api/src/main/java/com/cloud/agent/api/to/deployasis/OVFVirtualHardwareItemTO.java", "diffHunk": "@@ -0,0 +1,365 @@\n+// Licensed to the Apache Software Foundation (ASF) under one\n+// or more contributor license agreements.  See the NOTICE file\n+// distributed with this work for additional information\n+// regarding copyright ownership.  The ASF licenses this file\n+// to you under the Apache License, Version 2.0 (the\n+// \"License\"); you may not use this file except in compliance\n+// with the License.  You may obtain a copy of the License at\n+//\n+//   http://www.apache.org/licenses/LICENSE-2.0\n+//\n+// Unless required by applicable law or agreed to in writing,\n+// software distributed under the License is distributed on an\n+// \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n+// KIND, either express or implied.  See the License for the\n+// specific language governing permissions and limitations\n+// under the License.\n+package com.cloud.agent.api.to.deployasis;\n+\n+// From: https://schemas.dmtf.org/wbem/wscim/1/cim-schema/2/CIM_ResourceAllocationSettingData.xsd", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "0a2823b80cb5cd1838a7e6ec3cd690619c2c17e8"}, "originalPosition": 19}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzEwOTU4NDEwOnYy", "diffSide": "RIGHT", "path": "api/src/main/java/com/cloud/agent/api/to/deployasis/OVFVirtualHardwareItemTO.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yOVQxMzozNToyOFrOHZteWQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yOVQxMzozNToyOFrOHZteWQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NjcyMTQ5Nw==", "bodyText": "new class should be in org.apache.cloudstack", "url": "https://github.com/apache/cloudstack/pull/4307#discussion_r496721497", "createdAt": "2020-09-29T13:35:28Z", "author": {"login": "DaanHoogland"}, "path": "api/src/main/java/com/cloud/agent/api/to/deployasis/OVFVirtualHardwareItemTO.java", "diffHunk": "@@ -0,0 +1,365 @@\n+// Licensed to the Apache Software Foundation (ASF) under one\n+// or more contributor license agreements.  See the NOTICE file\n+// distributed with this work for additional information\n+// regarding copyright ownership.  The ASF licenses this file\n+// to you under the Apache License, Version 2.0 (the\n+// \"License\"); you may not use this file except in compliance\n+// with the License.  You may obtain a copy of the License at\n+//\n+//   http://www.apache.org/licenses/LICENSE-2.0\n+//\n+// Unless required by applicable law or agreed to in writing,\n+// software distributed under the License is distributed on an\n+// \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n+// KIND, either express or implied.  See the License for the\n+// specific language governing permissions and limitations\n+// under the License.\n+package com.cloud.agent.api.to.deployasis;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "0a2823b80cb5cd1838a7e6ec3cd690619c2c17e8"}, "originalPosition": 17}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzEwOTU4NTczOnYy", "diffSide": "RIGHT", "path": "api/src/main/java/com/cloud/agent/api/to/deployasis/TemplateDeployAsIsInformationTO.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yOVQxMzozNTo0OVrOHZtfaQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yOVQxMzozNTo0OVrOHZtfaQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NjcyMTc2OQ==", "bodyText": "new class should be in org.apache.cloudstack", "url": "https://github.com/apache/cloudstack/pull/4307#discussion_r496721769", "createdAt": "2020-09-29T13:35:49Z", "author": {"login": "DaanHoogland"}, "path": "api/src/main/java/com/cloud/agent/api/to/deployasis/TemplateDeployAsIsInformationTO.java", "diffHunk": "@@ -0,0 +1,24 @@\n+//\n+// Licensed to the Apache Software Foundation (ASF) under one\n+// or more contributor license agreements.  See the NOTICE file\n+// distributed with this work for additional information\n+// regarding copyright ownership.  The ASF licenses this file\n+// to you under the Apache License, Version 2.0 (the\n+// \"License\"); you may not use this file except in compliance\n+// with the License.  You may obtain a copy of the License at\n+//\n+//   http://www.apache.org/licenses/LICENSE-2.0\n+//\n+// Unless required by applicable law or agreed to in writing,\n+// software distributed under the License is distributed on an\n+// \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n+// KIND, either express or implied.  See the License for the\n+// specific language governing permissions and limitations\n+// under the License.\n+//\n+package com.cloud.agent.api.to.deployasis;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "0a2823b80cb5cd1838a7e6ec3cd690619c2c17e8"}, "originalPosition": 19}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzEwOTU4NzI0OnYy", "diffSide": "RIGHT", "path": "api/src/main/java/com/cloud/agent/api/to/deployasis/TemplateDeployAsIsInformationTO.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yOVQxMzozNjowN1rOHZtgWg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yOVQxMzozNjowN1rOHZtgWg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NjcyMjAxMA==", "bodyText": "what is this needed for?", "url": "https://github.com/apache/cloudstack/pull/4307#discussion_r496722010", "createdAt": "2020-09-29T13:36:07Z", "author": {"login": "DaanHoogland"}, "path": "api/src/main/java/com/cloud/agent/api/to/deployasis/TemplateDeployAsIsInformationTO.java", "diffHunk": "@@ -0,0 +1,24 @@\n+//\n+// Licensed to the Apache Software Foundation (ASF) under one\n+// or more contributor license agreements.  See the NOTICE file\n+// distributed with this work for additional information\n+// regarding copyright ownership.  The ASF licenses this file\n+// to you under the Apache License, Version 2.0 (the\n+// \"License\"); you may not use this file except in compliance\n+// with the License.  You may obtain a copy of the License at\n+//\n+//   http://www.apache.org/licenses/LICENSE-2.0\n+//\n+// Unless required by applicable law or agreed to in writing,\n+// software distributed under the License is distributed on an\n+// \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n+// KIND, either express or implied.  See the License for the\n+// specific language governing permissions and limitations\n+// under the License.\n+//\n+package com.cloud.agent.api.to.deployasis;\n+\n+import java.io.Serializable;\n+\n+public interface TemplateDeployAsIsInformationTO extends Serializable {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "0a2823b80cb5cd1838a7e6ec3cd690619c2c17e8"}, "originalPosition": 23}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzEwOTU4ODQwOnYy", "diffSide": "RIGHT", "path": "api/src/main/java/com/cloud/agent/api/to/deployasis/OVFVirtualHardwareSectionTO.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yOVQxMzozNjoyMVrOHZthHw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yOVQxMzozNjoyMVrOHZthHw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NjcyMjIwNw==", "bodyText": "new class should be in org.apache.cloudstack", "url": "https://github.com/apache/cloudstack/pull/4307#discussion_r496722207", "createdAt": "2020-09-29T13:36:21Z", "author": {"login": "DaanHoogland"}, "path": "api/src/main/java/com/cloud/agent/api/to/deployasis/OVFVirtualHardwareSectionTO.java", "diffHunk": "@@ -0,0 +1,50 @@\n+//\n+// Licensed to the Apache Software Foundation (ASF) under one\n+// or more contributor license agreements.  See the NOTICE file\n+// distributed with this work for additional information\n+// regarding copyright ownership.  The ASF licenses this file\n+// to you under the Apache License, Version 2.0 (the\n+// \"License\"); you may not use this file except in compliance\n+// with the License.  You may obtain a copy of the License at\n+//\n+//   http://www.apache.org/licenses/LICENSE-2.0\n+//\n+// Unless required by applicable law or agreed to in writing,\n+// software distributed under the License is distributed on an\n+// \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n+// KIND, either express or implied.  See the License for the\n+// specific language governing permissions and limitations\n+// under the License.\n+//\n+package com.cloud.agent.api.to.deployasis;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "0a2823b80cb5cd1838a7e6ec3cd690619c2c17e8"}, "originalPosition": 19}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzEwOTU5MDk0OnYy", "diffSide": "RIGHT", "path": "api/src/main/java/com/cloud/agent/api/to/deployasis/OVFVirtualHardwareSectionTO.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yOVQxMzozNjo1MFrOHZtipg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yOVQxMzozNzozOVrOHZtk-w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NjcyMjU5OA==", "bodyText": "good name ==> no javadoc needed", "url": "https://github.com/apache/cloudstack/pull/4307#discussion_r496722598", "createdAt": "2020-09-29T13:36:50Z", "author": {"login": "DaanHoogland"}, "path": "api/src/main/java/com/cloud/agent/api/to/deployasis/OVFVirtualHardwareSectionTO.java", "diffHunk": "@@ -0,0 +1,50 @@\n+//\n+// Licensed to the Apache Software Foundation (ASF) under one\n+// or more contributor license agreements.  See the NOTICE file\n+// distributed with this work for additional information\n+// regarding copyright ownership.  The ASF licenses this file\n+// to you under the Apache License, Version 2.0 (the\n+// \"License\"); you may not use this file except in compliance\n+// with the License.  You may obtain a copy of the License at\n+//\n+//   http://www.apache.org/licenses/LICENSE-2.0\n+//\n+// Unless required by applicable law or agreed to in writing,\n+// software distributed under the License is distributed on an\n+// \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n+// KIND, either express or implied.  See the License for the\n+// specific language governing permissions and limitations\n+// under the License.\n+//\n+package com.cloud.agent.api.to.deployasis;\n+\n+import java.util.List;\n+\n+public class OVFVirtualHardwareSectionTO implements TemplateDeployAsIsInformationTO {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "0a2823b80cb5cd1838a7e6ec3cd690619c2c17e8"}, "originalPosition": 23}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NjcyMzE5NQ==", "bodyText": "though it has contents that might need explanation to the new...", "url": "https://github.com/apache/cloudstack/pull/4307#discussion_r496723195", "createdAt": "2020-09-29T13:37:39Z", "author": {"login": "DaanHoogland"}, "path": "api/src/main/java/com/cloud/agent/api/to/deployasis/OVFVirtualHardwareSectionTO.java", "diffHunk": "@@ -0,0 +1,50 @@\n+//\n+// Licensed to the Apache Software Foundation (ASF) under one\n+// or more contributor license agreements.  See the NOTICE file\n+// distributed with this work for additional information\n+// regarding copyright ownership.  The ASF licenses this file\n+// to you under the Apache License, Version 2.0 (the\n+// \"License\"); you may not use this file except in compliance\n+// with the License.  You may obtain a copy of the License at\n+//\n+//   http://www.apache.org/licenses/LICENSE-2.0\n+//\n+// Unless required by applicable law or agreed to in writing,\n+// software distributed under the License is distributed on an\n+// \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n+// KIND, either express or implied.  See the License for the\n+// specific language governing permissions and limitations\n+// under the License.\n+//\n+package com.cloud.agent.api.to.deployasis;\n+\n+import java.util.List;\n+\n+public class OVFVirtualHardwareSectionTO implements TemplateDeployAsIsInformationTO {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NjcyMjU5OA=="}, "originalCommit": {"oid": "0a2823b80cb5cd1838a7e6ec3cd690619c2c17e8"}, "originalPosition": 23}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzEwOTYwMjU0OnYy", "diffSide": "RIGHT", "path": "core/src/main/java/com/cloud/agent/api/ValidateVcenterDetailsCommand.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yOVQxMzozOToxN1rOHZtqFA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yOVQxMzozOToxN1rOHZtqFA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NjcyNDUwMA==", "bodyText": "what is it for?", "url": "https://github.com/apache/cloudstack/pull/4307#discussion_r496724500", "createdAt": "2020-09-29T13:39:17Z", "author": {"login": "DaanHoogland"}, "path": "core/src/main/java/com/cloud/agent/api/ValidateVcenterDetailsCommand.java", "diffHunk": "@@ -0,0 +1,40 @@\n+// Licensed to the Apache Software Foundation (ASF) under one\n+// or more contributor license agreements.  See the NOTICE file\n+// distributed with this work for additional information\n+// regarding copyright ownership.  The ASF licenses this file\n+// to you under the Apache License, Version 2.0 (the\n+// \"License\"); you may not use this file except in compliance\n+// with the License.  You may obtain a copy of the License at\n+//\n+//   http://www.apache.org/licenses/LICENSE-2.0\n+//\n+// Unless required by applicable law or agreed to in writing,\n+// software distributed under the License is distributed on an\n+// \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n+// KIND, either express or implied.  See the License for the\n+// specific language governing permissions and limitations\n+// under the License.\n+\n+package com.cloud.agent.api;\n+\n+public class ValidateVcenterDetailsCommand extends Command {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "0a2823b80cb5cd1838a7e6ec3cd690619c2c17e8"}, "originalPosition": 20}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzEwOTY0NjA1OnYy", "diffSide": "RIGHT", "path": "core/src/main/java/org/apache/cloudstack/storage/command/CheckDataStoreStoragePolicyComplainceCommand.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yOVQxMzo0Nzo1NVrOHZuFaQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yOVQxMzo0Nzo1NVrOHZuFaQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NjczMTQ5Nw==", "bodyText": "short javadoc with descrition of this command-answer pattern? at least what is returned under what condition? just by the name it might be a boolean or a List<StoragePolicy> that is expected.", "url": "https://github.com/apache/cloudstack/pull/4307#discussion_r496731497", "createdAt": "2020-09-29T13:47:55Z", "author": {"login": "DaanHoogland"}, "path": "core/src/main/java/org/apache/cloudstack/storage/command/CheckDataStoreStoragePolicyComplainceCommand.java", "diffHunk": "@@ -0,0 +1,61 @@\n+//\n+// Licensed to the Apache Software Foundation (ASF) under one\n+// or more contributor license agreements.  See the NOTICE file\n+// distributed with this work for additional information\n+// regarding copyright ownership.  The ASF licenses this file\n+// to you under the Apache License, Version 2.0 (the\n+// \"License\"); you may not use this file except in compliance\n+// with the License.  You may obtain a copy of the License at\n+//\n+//   http://www.apache.org/licenses/LICENSE-2.0\n+//\n+// Unless required by applicable law or agreed to in writing,\n+// software distributed under the License is distributed on an\n+// \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n+// KIND, either express or implied.  See the License for the\n+// specific language governing permissions and limitations\n+// under the License.\n+//\n+\n+package org.apache.cloudstack.storage.command;\n+\n+import com.cloud.agent.api.to.StorageFilerTO;\n+\n+public class CheckDataStoreStoragePolicyComplainceCommand extends StorageSubSystemCommand {\n+\n+    String storagePolicyId;\n+    private StorageFilerTO storagePool;\n+\n+    public CheckDataStoreStoragePolicyComplainceCommand(String storagePolicyId, StorageFilerTO storagePool) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "0a2823b80cb5cd1838a7e6ec3cd690619c2c17e8"}, "originalPosition": 29}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzEwOTY1MTE4OnYy", "diffSide": "RIGHT", "path": "core/src/test/java/com/cloud/agent/api/storage/DownloadAnswerTest.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yOVQxMzo0ODo0OVrOHZuIlg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yOVQxMzo0ODo0OVrOHZuIlg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NjczMjMxMA==", "bodyText": "new class should be in org.apache.cloudstack", "url": "https://github.com/apache/cloudstack/pull/4307#discussion_r496732310", "createdAt": "2020-09-29T13:48:49Z", "author": {"login": "DaanHoogland"}, "path": "core/src/test/java/com/cloud/agent/api/storage/DownloadAnswerTest.java", "diffHunk": "@@ -0,0 +1,62 @@\n+// Licensed to the Apache Software Foundation (ASF) under one\n+// or more contributor license agreements.  See the NOTICE file\n+// distributed with this work for additional information\n+// regarding copyright ownership.  The ASF licenses this file\n+// to you under the Apache License, Version 2.0 (the\n+// \"License\"); you may not use this file except in compliance\n+// with the License.  You may obtain a copy of the License at\n+//\n+//   http://www.apache.org/licenses/LICENSE-2.0\n+//\n+// Unless required by applicable law or agreed to in writing,\n+// software distributed under the License is distributed on an\n+// \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n+// KIND, either express or implied.  See the License for the\n+// specific language governing permissions and limitations\n+// under the License.\n+package com.cloud.agent.api.storage;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "0a2823b80cb5cd1838a7e6ec3cd690619c2c17e8"}, "originalPosition": 17}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzEwOTY2MDUxOnYy", "diffSide": "RIGHT", "path": "engine/api/src/main/java/org/apache/cloudstack/engine/orchestration/service/VolumeOrchestrationService.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yOVQxMzo1MDo0OVrOHZuOng==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yOVQxMzo1MDo0OVrOHZuOng==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NjczMzg1NA==", "bodyText": "\ud83d\udc4d", "url": "https://github.com/apache/cloudstack/pull/4307#discussion_r496733854", "createdAt": "2020-09-29T13:50:49Z", "author": {"login": "DaanHoogland"}, "path": "engine/api/src/main/java/org/apache/cloudstack/engine/orchestration/service/VolumeOrchestrationService.java", "diffHunk": "@@ -117,8 +120,11 @@ DiskProfile allocateRawVolume(Type type, String name, DiskOffering offering, Lon\n \n     boolean canVmRestartOnAnotherServer(long vmId);\n \n-    DiskProfile allocateTemplatedVolume(Type type, String name, DiskOffering offering, Long rootDisksize, Long minIops, Long maxIops, VirtualMachineTemplate template, VirtualMachine vm,\n-        Account owner);\n+    /**", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "0a2823b80cb5cd1838a7e6ec3cd690619c2c17e8"}, "originalPosition": 23}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzEwOTcwMjUwOnYy", "diffSide": "RIGHT", "path": "engine/api/src/main/java/org/apache/cloudstack/engine/subsystem/api/storage/TemplateDataFactory.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yOVQxMzo1ODo0MlrOHZunzw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yOVQxMzo1ODo0MlrOHZunzw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5Njc0MDMwMw==", "bodyText": "i would like a javadoc about what this string entails", "url": "https://github.com/apache/cloudstack/pull/4307#discussion_r496740303", "createdAt": "2020-09-29T13:58:42Z", "author": {"login": "DaanHoogland"}, "path": "engine/api/src/main/java/org/apache/cloudstack/engine/subsystem/api/storage/TemplateDataFactory.java", "diffHunk": "@@ -27,7 +27,7 @@\n \n     TemplateInfo getReadyTemplateOnImageStore(long templateId, Long zoneId);\n \n-    TemplateInfo getTemplate(DataObject obj, DataStore store);\n+    TemplateInfo getTemplate(DataObject obj, DataStore store, String configuration);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "0a2823b80cb5cd1838a7e6ec3cd690619c2c17e8"}, "originalPosition": 5}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzEwOTcxMzM1OnYy", "diffSide": "RIGHT", "path": "engine/api/src/main/java/org/apache/cloudstack/engine/subsystem/api/storage/TemplateService.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yOVQxNDowMDo0NlrOHZuudw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yOVQxNDowMDo0NlrOHZuudw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5Njc0MjAwNw==", "bodyText": "here the string is configurationId instead of configuration. would be nice to javadoc the difference", "url": "https://github.com/apache/cloudstack/pull/4307#discussion_r496742007", "createdAt": "2020-09-29T14:00:46Z", "author": {"login": "DaanHoogland"}, "path": "engine/api/src/main/java/org/apache/cloudstack/engine/subsystem/api/storage/TemplateService.java", "diffHunk": "@@ -72,4 +75,6 @@ public TemplateInfo getTemplate() {\n     void associateCrosszoneTemplatesToZone(long dcId);\n \n     AsyncCallFuture<TemplateApiResult> createDatadiskTemplateAsync(TemplateInfo parentTemplate, TemplateInfo dataDiskTemplate, String path, String diskId, long fileSize, boolean bootable);\n+\n+    List<DatadiskTO> getTemplateDatadisksOnImageStore(TemplateInfo templateInfo, String configurationId);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "0a2823b80cb5cd1838a7e6ec3cd690619c2c17e8"}, "originalPosition": 31}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzEwOTczOTI1OnYy", "diffSide": "RIGHT", "path": "engine/orchestration/src/main/java/com/cloud/vm/VirtualMachineManagerImpl.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yOVQxNDowNjoxMFrOHZu-zw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yOVQxNDowNjoxMFrOHZu-zw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5Njc0NjE5MQ==", "bodyText": "this comment could be the method-name of a member being called here.\nlong templateId should be scope protected to avoid confusion in this 114! line method.", "url": "https://github.com/apache/cloudstack/pull/4307#discussion_r496746191", "createdAt": "2020-09-29T14:06:10Z", "author": {"login": "DaanHoogland"}, "path": "engine/orchestration/src/main/java/com/cloud/vm/VirtualMachineManagerImpl.java", "diffHunk": "@@ -592,6 +597,13 @@ protected void advanceExpunge(VMInstanceVO vm) throws ResourceUnavailableExcepti\n         //remove the overcommit details from the uservm details\n         userVmDetailsDao.removeDetails(vm.getId());\n \n+        // Remove details if VM deploy as-is", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "0a2823b80cb5cd1838a7e6ec3cd690619c2c17e8"}, "originalPosition": 39}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzEwOTc2NTQ5OnYy", "diffSide": "RIGHT", "path": "engine/orchestration/src/main/java/org/apache/cloudstack/engine/orchestration/NetworkOrchestrator.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yOVQxNDoxMTozN1rOHZvPRA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yOVQxNDoxMTozN1rOHZvPRA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5Njc1MDQwNA==", "bodyText": "fromat request\n\n  \n    \n  \n    \n\n  \n  This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters. Learn more about bidirectional Unicode characters\n\n\n  \n\n\n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                public void allocate(final VirtualMachineProfile vm, final LinkedHashMap<? extends Network, List<? extends NicProfile>> networks, final Map<String, Map<Integer, String>> extraDhcpOptions) throws InsufficientCapacityException,\n          \n          \n            \n                public void allocate(final VirtualMachineProfile vm, final LinkedHashMap<? extends Network, List<? extends NicProfile>> networks, final Map<String, Map<Integer, String>> extraDhcpOptions)\n          \n          \n            \n                    throws InsufficientCapacityException, ConcurrentOperationException {\n          \n      \n    \n    \n  \n\nbut of course delete the next line (github sugestions are almost smart enough for this.", "url": "https://github.com/apache/cloudstack/pull/4307#discussion_r496750404", "createdAt": "2020-09-29T14:11:37Z", "author": {"login": "DaanHoogland"}, "path": "engine/orchestration/src/main/java/org/apache/cloudstack/engine/orchestration/NetworkOrchestrator.java", "diffHunk": "@@ -747,87 +751,168 @@ public void doInTransactionWithoutResult(final TransactionStatus status) {\n     @Override\n     @DB\n     public void allocate(final VirtualMachineProfile vm, final LinkedHashMap<? extends Network, List<? extends NicProfile>> networks, final Map<String, Map<Integer, String>> extraDhcpOptions) throws InsufficientCapacityException,", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "0a2823b80cb5cd1838a7e6ec3cd690619c2c17e8"}, "originalPosition": 85}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzEwOTc3NjU1OnYy", "diffSide": "RIGHT", "path": "engine/orchestration/src/main/java/org/apache/cloudstack/engine/orchestration/NetworkOrchestrator.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yOVQxNDoxMzo1MFrOHZvWOA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yOVQxNDoxMzo1MFrOHZvWOA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5Njc1MjE4NA==", "bodyText": "This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters. Learn more about bidirectional Unicode characters\n\n\n  \n\n\n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                        ConcurrentOperationException {\n          \n      \n    \n    \n  \n\nbut only in combination with above", "url": "https://github.com/apache/cloudstack/pull/4307#discussion_r496752184", "createdAt": "2020-09-29T14:13:50Z", "author": {"login": "DaanHoogland"}, "path": "engine/orchestration/src/main/java/org/apache/cloudstack/engine/orchestration/NetworkOrchestrator.java", "diffHunk": "@@ -747,87 +751,168 @@ public void doInTransactionWithoutResult(final TransactionStatus status) {\n     @Override\n     @DB\n     public void allocate(final VirtualMachineProfile vm, final LinkedHashMap<? extends Network, List<? extends NicProfile>> networks, final Map<String, Map<Integer, String>> extraDhcpOptions) throws InsufficientCapacityException,\n-    ConcurrentOperationException {\n+            ConcurrentOperationException {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "0a2823b80cb5cd1838a7e6ec3cd690619c2c17e8"}, "originalPosition": 87}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzEwOTc5Mzg0OnYy", "diffSide": "RIGHT", "path": "engine/orchestration/src/main/java/org/apache/cloudstack/engine/orchestration/NetworkOrchestrator.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yOVQxNDoxNjo1OFrOHZvgiA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yOVQxNDoxNjo1OFrOHZvgiA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5Njc1NDgyNA==", "bodyText": "method name?", "url": "https://github.com/apache/cloudstack/pull/4307#discussion_r496754824", "createdAt": "2020-09-29T14:16:58Z", "author": {"login": "DaanHoogland"}, "path": "engine/orchestration/src/main/java/org/apache/cloudstack/engine/orchestration/NetworkOrchestrator.java", "diffHunk": "@@ -747,87 +751,168 @@ public void doInTransactionWithoutResult(final TransactionStatus status) {\n     @Override\n     @DB\n     public void allocate(final VirtualMachineProfile vm, final LinkedHashMap<? extends Network, List<? extends NicProfile>> networks, final Map<String, Map<Integer, String>> extraDhcpOptions) throws InsufficientCapacityException,\n-    ConcurrentOperationException {\n+            ConcurrentOperationException {\n \n         Transaction.execute(new TransactionCallbackWithExceptionNoReturn<InsufficientCapacityException>() {\n             @Override\n             public void doInTransactionWithoutResult(final TransactionStatus status) throws InsufficientCapacityException {\n-                int deviceId = 0;\n-                int size = 0;\n-                for (final Network ntwk : networks.keySet()) {\n-                    final List<? extends NicProfile> profiles = networks.get(ntwk);\n-                    if (profiles != null && !profiles.isEmpty()) {\n-                        size = size + profiles.size();\n-                    } else {\n-                        size = size + 1;\n-                    }\n+                if (s_logger.isTraceEnabled()) {\n+                    s_logger.trace(String.format(\"allocating networks for %s(template %s); %d networks\",vm.getInstanceName(), vm.getTemplate().getUuid(), networks.size()));\n                 }\n+                int deviceId = 0;\n+                int size;\n+                size = determineNumberOfNicsRequired();\n \n                 final boolean[] deviceIds = new boolean[size];\n                 Arrays.fill(deviceIds, false);\n \n+                List<Pair<Network, NicProfile>> profilesList = getOrderedNetworkNicProfileMapping(networks);\n                 final List<NicProfile> nics = new ArrayList<NicProfile>(size);\n                 NicProfile defaultNic = null;\n+                Network nextNetwork = null;\n+                for (Pair <Network, NicProfile> networkNicPair : profilesList) {\n+                    nextNetwork = networkNicPair.first();\n+                    Pair<NicProfile, Integer> newDeviceInfo = addRequestedNicToNicListWithDeviceNumberAndRetrieveDefaultDevice(networkNicPair.second(), deviceIds, deviceId, nextNetwork, nics, defaultNic);\n+                    defaultNic = newDeviceInfo.first();\n+                    deviceId = newDeviceInfo.second();\n+                }\n+                createExtraNics(size, nics, nextNetwork);\n+\n+                if (nics.size() == 1) {\n+                    nics.get(0).setDefaultNic(true);\n+                }\n+            }\n+\n+            /**\n+             * private transaction method to check and add devices to the nic list and update the info\n+             */\n+            Pair<NicProfile,Integer> addRequestedNicToNicListWithDeviceNumberAndRetrieveDefaultDevice(NicProfile requested, boolean[] deviceIds, int deviceId, Network nextNetwork, List<NicProfile> nics, NicProfile defaultNic)\n+                    throws InsufficientAddressCapacityException, InsufficientVirtualNetworkCapacityException {\n+                Pair<NicProfile, Integer> rc = new Pair<>(null,null);\n+                Boolean isDefaultNic = false;\n+                if (vm != null && requested != null && requested.isDefaultNic()) {\n+                    isDefaultNic = true;\n+                }\n+\n+                while (deviceIds[deviceId] && deviceId < deviceIds.length) {\n+                    deviceId++;\n+                }\n+\n+                final Pair<NicProfile, Integer> vmNicPair = allocateNic(requested, nextNetwork, isDefaultNic, deviceId, vm);\n+                NicProfile vmNic = null;\n+                if (vmNicPair != null) {\n+                    vmNic = vmNicPair.first();\n+                    if (vmNic == null) {\n+                        return rc;\n+                    }\n+                    deviceId = vmNicPair.second();\n+                }\n+\n+                final int devId = vmNic.getDeviceId();\n+                if (devId >= deviceIds.length) {\n+                    throw new IllegalArgumentException(\"Device id for nic is too large: \" + vmNic);\n+                }\n+                if (deviceIds[devId]) {\n+                    throw new IllegalArgumentException(\"Conflicting device id for two different nics: \" + vmNic);\n+                }\n+\n+                deviceIds[devId] = true;\n \n+                if (vmNic.isDefaultNic()) {\n+                    if (defaultNic != null) {\n+                        throw new IllegalArgumentException(\"You cannot specify two nics as default nics: nic 1 = \" + defaultNic + \"; nic 2 = \" + vmNic);\n+                    }\n+                    defaultNic = vmNic;\n+                }\n+\n+                nics.add(vmNic);\n+                vm.addNic(vmNic);\n+                saveExtraDhcpOptions(nextNetwork.getUuid(), vmNic.getId(), extraDhcpOptions);\n+                rc.first(defaultNic);\n+                rc.second(deviceId);\n+                return rc;\n+            }\n+\n+            /**\n+             * private transaction method to get oredered list of Network and NicProfile pair\n+             * @return ordered list of Network and NicProfile pair\n+             * @param networks the map od networks to nic profiles list\n+             */\n+            private List<Pair<Network, NicProfile>> getOrderedNetworkNicProfileMapping(final LinkedHashMap<? extends Network, List<? extends NicProfile>> networks) {\n+                List<Pair<Network, NicProfile>> profilesList = new ArrayList<>();\n                 for (final Map.Entry<? extends Network, List<? extends NicProfile>> network : networks.entrySet()) {\n-                    final Network config = network.getKey();\n                     List<? extends NicProfile> requestedProfiles = network.getValue();\n                     if (requestedProfiles == null) {\n                         requestedProfiles = new ArrayList<NicProfile>();\n                     }\n                     if (requestedProfiles.isEmpty()) {\n                         requestedProfiles.add(null);\n                     }\n-\n                     for (final NicProfile requested : requestedProfiles) {\n-                        Boolean isDefaultNic = false;\n-                        if (vm != null && requested != null && requested.isDefaultNic()) {\n-                            isDefaultNic = true;\n-                        }\n-\n-                        while (deviceIds[deviceId] && deviceId < deviceIds.length) {\n-                            deviceId++;\n-                        }\n-\n-                        final Pair<NicProfile, Integer> vmNicPair = allocateNic(requested, config, isDefaultNic, deviceId, vm);\n-                        NicProfile vmNic = null;\n-                        if (vmNicPair != null) {\n-                            vmNic = vmNicPair.first();\n-                            if (vmNic == null) {\n-                                continue;\n-                            }\n-                            deviceId = vmNicPair.second();\n-                        }\n-\n-                        final int devId = vmNic.getDeviceId();\n-                        if (devId >= deviceIds.length) {\n-                            throw new IllegalArgumentException(\"Device id for nic is too large: \" + vmNic);\n-                        }\n-                        if (deviceIds[devId]) {\n-                            throw new IllegalArgumentException(\"Conflicting device id for two different nics: \" + vmNic);\n+                        profilesList.add(new Pair<Network, NicProfile>(network.getKey(), requested));\n+                    }\n+                }\n+                profilesList.sort(new Comparator<Pair<Network, NicProfile>>() {\n+                    @Override\n+                    public int compare(Pair<Network, NicProfile> pair1, Pair<Network, NicProfile> pair2) {\n+                        int profile1Order = Integer.MAX_VALUE;\n+                        int profile2Order = Integer.MAX_VALUE;\n+                        if (pair1 != null && pair1.second() != null && pair1.second().getOrderIndex() != null) {\n+                            profile1Order = pair1.second().getOrderIndex();\n                         }\n-\n-                        deviceIds[devId] = true;\n-\n-                        if (vmNic.isDefaultNic()) {\n-                            if (defaultNic != null) {\n-                                throw new IllegalArgumentException(\"You cannot specify two nics as default nics: nic 1 = \" + defaultNic + \"; nic 2 = \" + vmNic);\n-                            }\n-                            defaultNic = vmNic;\n+                        if (pair2 != null && pair2.second() != null && pair2.second().getOrderIndex() != null) {\n+                            profile2Order = pair2.second().getOrderIndex();\n                         }\n+                        return profile1Order - profile2Order;\n+                    }\n+                });\n+                return profilesList;\n+            }\n \n-                        nics.add(vmNic);\n-                        vm.addNic(vmNic);\n-                        saveExtraDhcpOptions(config.getUuid(), vmNic.getId(), extraDhcpOptions);\n+            /**\n+             * private transaction method to run over the objects and determine nic requirements\n+             * @return the total numer of nics required\n+             */\n+            private int determineNumberOfNicsRequired() {\n+                int size = 0;\n+                for (final Network ntwk : networks.keySet()) {\n+                    final List<? extends NicProfile> profiles = networks.get(ntwk);\n+                    if (profiles != null && !profiles.isEmpty()) {\n+                        size = size + profiles.size();\n+                    } else {\n+                        size = size + 1;\n                     }\n                 }\n+\n+                List<OVFNetworkTO> netprereqs = templateDeployAsIsDetailsDao.listNetworkRequirementsByTemplateId(vm.getTemplate().getId());\n+                if (size < netprereqs.size()) {\n+                    size = netprereqs.size();\n+                }\n+                return size;\n+            }\n+\n+            /**\n+             * private transaction method to add nics as required\n+             * @param size the number needed\n+             * @param nics the list of nics present\n+             * @param finalNetwork the network to add the nics to\n+             * @throws InsufficientVirtualNetworkCapacityException great\n+             * @throws InsufficientAddressCapacityException also magnificent, as the name sugests\n+             */\n+            private void createExtraNics(int size, List<NicProfile> nics, Network finalNetwork) throws InsufficientVirtualNetworkCapacityException, InsufficientAddressCapacityException {\n                 if (nics.size() != size) {\n                     s_logger.warn(\"Number of nics \" + nics.size() + \" doesn't match number of requested nics \" + size);\n-                    throw new CloudRuntimeException(\"Number of nics \" + nics.size() + \" doesn't match number of requested networks \" + size);\n-                }\n-\n-                if (nics.size() == 1) {\n-                    nics.get(0).setDefaultNic(true);\n+                    if (nics.size() > size) {\n+                        throw new CloudRuntimeException(\"Number of nics \" + nics.size() + \" doesn't match number of requested networks \" + size);\n+                    } else {\n+                        if (finalNetwork == null) {\n+                            throw new CloudRuntimeException(String.format(\"can not assign network to %d remaining required NICs\", size - nics.size()));\n+                        }\n+                        // create extra", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "0a2823b80cb5cd1838a7e6ec3cd690619c2c17e8"}, "originalPosition": 296}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzEwOTgwNjk1OnYy", "diffSide": "RIGHT", "path": "engine/orchestration/src/main/java/org/apache/cloudstack/engine/orchestration/NetworkOrchestrator.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yOVQxNDoxOTozNFrOHZvo9A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yOVQxNDoxOTozNFrOHZvo9A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5Njc1Njk4MA==", "bodyText": "\ud83d\udc4d this is the kind of formatting i'd  like to see for all methods (i.e. throws on a new line if the signature is (too) long", "url": "https://github.com/apache/cloudstack/pull/4307#discussion_r496756980", "createdAt": "2020-09-29T14:19:34Z", "author": {"login": "DaanHoogland"}, "path": "engine/orchestration/src/main/java/org/apache/cloudstack/engine/orchestration/NetworkOrchestrator.java", "diffHunk": "@@ -747,87 +751,168 @@ public void doInTransactionWithoutResult(final TransactionStatus status) {\n     @Override\n     @DB\n     public void allocate(final VirtualMachineProfile vm, final LinkedHashMap<? extends Network, List<? extends NicProfile>> networks, final Map<String, Map<Integer, String>> extraDhcpOptions) throws InsufficientCapacityException,\n-    ConcurrentOperationException {\n+            ConcurrentOperationException {\n \n         Transaction.execute(new TransactionCallbackWithExceptionNoReturn<InsufficientCapacityException>() {\n             @Override\n             public void doInTransactionWithoutResult(final TransactionStatus status) throws InsufficientCapacityException {\n-                int deviceId = 0;\n-                int size = 0;\n-                for (final Network ntwk : networks.keySet()) {\n-                    final List<? extends NicProfile> profiles = networks.get(ntwk);\n-                    if (profiles != null && !profiles.isEmpty()) {\n-                        size = size + profiles.size();\n-                    } else {\n-                        size = size + 1;\n-                    }\n+                if (s_logger.isTraceEnabled()) {\n+                    s_logger.trace(String.format(\"allocating networks for %s(template %s); %d networks\",vm.getInstanceName(), vm.getTemplate().getUuid(), networks.size()));\n                 }\n+                int deviceId = 0;\n+                int size;\n+                size = determineNumberOfNicsRequired();\n \n                 final boolean[] deviceIds = new boolean[size];\n                 Arrays.fill(deviceIds, false);\n \n+                List<Pair<Network, NicProfile>> profilesList = getOrderedNetworkNicProfileMapping(networks);\n                 final List<NicProfile> nics = new ArrayList<NicProfile>(size);\n                 NicProfile defaultNic = null;\n+                Network nextNetwork = null;\n+                for (Pair <Network, NicProfile> networkNicPair : profilesList) {\n+                    nextNetwork = networkNicPair.first();\n+                    Pair<NicProfile, Integer> newDeviceInfo = addRequestedNicToNicListWithDeviceNumberAndRetrieveDefaultDevice(networkNicPair.second(), deviceIds, deviceId, nextNetwork, nics, defaultNic);\n+                    defaultNic = newDeviceInfo.first();\n+                    deviceId = newDeviceInfo.second();\n+                }\n+                createExtraNics(size, nics, nextNetwork);\n+\n+                if (nics.size() == 1) {\n+                    nics.get(0).setDefaultNic(true);\n+                }\n+            }\n+\n+            /**\n+             * private transaction method to check and add devices to the nic list and update the info\n+             */\n+            Pair<NicProfile,Integer> addRequestedNicToNicListWithDeviceNumberAndRetrieveDefaultDevice(NicProfile requested, boolean[] deviceIds, int deviceId, Network nextNetwork, List<NicProfile> nics, NicProfile defaultNic)\n+                    throws InsufficientAddressCapacityException, InsufficientVirtualNetworkCapacityException {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "0a2823b80cb5cd1838a7e6ec3cd690619c2c17e8"}, "originalPosition": 132}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzEwOTgxMjAxOnYy", "diffSide": "RIGHT", "path": "engine/orchestration/src/main/java/org/apache/cloudstack/engine/orchestration/NetworkOrchestrator.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yOVQxNDoyMDozMFrOHZvr6A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yOVQxNDoyMDozMFrOHZvr6A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5Njc1NzczNg==", "bodyText": "with throws?", "url": "https://github.com/apache/cloudstack/pull/4307#discussion_r496757736", "createdAt": "2020-09-29T14:20:30Z", "author": {"login": "DaanHoogland"}, "path": "engine/orchestration/src/main/java/org/apache/cloudstack/engine/orchestration/NetworkOrchestrator.java", "diffHunk": "@@ -1085,7 +1170,7 @@ boolean isNetworkImplemented(final NetworkVO network) {\n     }\n \n     Pair<NetworkGuru, NetworkVO> implementNetwork(final long networkId, final DeployDestination dest, final ReservationContext context, final boolean isRouter) throws ConcurrentOperationException,\n-    ResourceUnavailableException, InsufficientCapacityException {\n+            ResourceUnavailableException, InsufficientCapacityException {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "0a2823b80cb5cd1838a7e6ec3cd690619c2c17e8"}, "originalPosition": 309}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzEwOTgxMzA5OnYy", "diffSide": "RIGHT", "path": "engine/orchestration/src/main/java/org/apache/cloudstack/engine/orchestration/NetworkOrchestrator.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yOVQxNDoyMDo0MlrOHZvskQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yOVQxNDoyMDo0MlrOHZvskQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5Njc1NzkwNQ==", "bodyText": "with throws?", "url": "https://github.com/apache/cloudstack/pull/4307#discussion_r496757905", "createdAt": "2020-09-29T14:20:42Z", "author": {"login": "DaanHoogland"}, "path": "engine/orchestration/src/main/java/org/apache/cloudstack/engine/orchestration/NetworkOrchestrator.java", "diffHunk": "@@ -1105,7 +1190,7 @@ boolean isNetworkImplemented(final NetworkVO network) {\n     @Override\n     @DB\n     public Pair<NetworkGuru, NetworkVO> implementNetwork(final long networkId, final DeployDestination dest, final ReservationContext context) throws ConcurrentOperationException,\n-    ResourceUnavailableException, InsufficientCapacityException {\n+            ResourceUnavailableException, InsufficientCapacityException {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "0a2823b80cb5cd1838a7e6ec3cd690619c2c17e8"}, "originalPosition": 318}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzEwOTgyMzkwOnYy", "diffSide": "RIGHT", "path": "engine/orchestration/src/main/java/org/apache/cloudstack/engine/orchestration/NetworkOrchestrator.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yOVQxNDoyMjo1MlrOHZvzcQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yOVQxNDoyMjo1MlrOHZvzcQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5Njc1OTY2NQ==", "bodyText": "with throws?", "url": "https://github.com/apache/cloudstack/pull/4307#discussion_r496759665", "createdAt": "2020-09-29T14:22:52Z", "author": {"login": "DaanHoogland"}, "path": "engine/orchestration/src/main/java/org/apache/cloudstack/engine/orchestration/NetworkOrchestrator.java", "diffHunk": "@@ -1661,7 +1746,7 @@ public void doInTransactionWithoutResult(final TransactionStatus status) {\n \n     @Override\n     public void prepare(final VirtualMachineProfile vmProfile, final DeployDestination dest, final ReservationContext context) throws InsufficientCapacityException, ConcurrentOperationException,\n-    ResourceUnavailableException {\n+            ResourceUnavailableException {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "0a2823b80cb5cd1838a7e6ec3cd690619c2c17e8"}, "originalPosition": 368}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzEwOTgzNTI0OnYy", "diffSide": "RIGHT", "path": "engine/orchestration/src/main/java/org/apache/cloudstack/engine/orchestration/NetworkOrchestrator.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yOVQxNDoyNTowOFrOHZv6kQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yOVQxNDoyNTowOFrOHZv6kQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5Njc2MTQ4OQ==", "bodyText": "throws", "url": "https://github.com/apache/cloudstack/pull/4307#discussion_r496761489", "createdAt": "2020-09-29T14:25:08Z", "author": {"login": "DaanHoogland"}, "path": "engine/orchestration/src/main/java/org/apache/cloudstack/engine/orchestration/NetworkOrchestrator.java", "diffHunk": "@@ -3033,7 +3118,7 @@ public void reallyRun() {\n \n     @Override\n     public boolean startNetwork(final long networkId, final DeployDestination dest, final ReservationContext context) throws ConcurrentOperationException, ResourceUnavailableException,\n-    InsufficientCapacityException {\n+            InsufficientCapacityException {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "0a2823b80cb5cd1838a7e6ec3cd690619c2c17e8"}, "originalPosition": 414}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzEwOTg0MDA2OnYy", "diffSide": "RIGHT", "path": "engine/orchestration/src/main/java/org/apache/cloudstack/engine/orchestration/NetworkOrchestrator.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yOVQxNDoyNjowMFrOHZv9rw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yOVQxNDoyNjowMFrOHZv9rw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5Njc2MjI4Nw==", "bodyText": "and this one (with throws)", "url": "https://github.com/apache/cloudstack/pull/4307#discussion_r496762287", "createdAt": "2020-09-29T14:26:00Z", "author": {"login": "DaanHoogland"}, "path": "engine/orchestration/src/main/java/org/apache/cloudstack/engine/orchestration/NetworkOrchestrator.java", "diffHunk": "@@ -3056,7 +3141,7 @@ public boolean startNetwork(final long networkId, final DeployDestination dest,\n \n     @Override\n     public boolean restartNetwork(final Long networkId, final Account callerAccount, final User callerUser, final boolean cleanup) throws ConcurrentOperationException, ResourceUnavailableException,\n-    InsufficientCapacityException {\n+            InsufficientCapacityException {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "0a2823b80cb5cd1838a7e6ec3cd690619c2c17e8"}, "originalPosition": 423}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzExMDA4NzQ2OnYy", "diffSide": "RIGHT", "path": "engine/orchestration/src/main/java/org/apache/cloudstack/engine/orchestration/VolumeOrchestrator.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yOVQxNToxNTozM1rOHZyZPQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yOVQxNToxNTozM1rOHZyZPQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NjgwMjEwOQ==", "bodyText": "newline:\n\n  \n    \n  \n    \n\n  \n  This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters. Learn more about bidirectional Unicode characters\n\n\n  \n\n\n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                }\n          \n          \n            \n                }", "url": "https://github.com/apache/cloudstack/pull/4307#discussion_r496802109", "createdAt": "2020-09-29T15:15:33Z", "author": {"login": "DaanHoogland"}, "path": "engine/orchestration/src/main/java/org/apache/cloudstack/engine/orchestration/VolumeOrchestrator.java", "diffHunk": "@@ -296,6 +315,34 @@ public StoragePool findStoragePool(DiskProfile dskCh, DataCenter dc, Pod pod, Lo\n         return null;\n     }\n \n+    @Override\n+    public StoragePool findChildDataStoreInDataStoreCluster(DataCenter dc, Pod pod, Long clusterId, Long hostId, VirtualMachine vm, Long datastoreClusterId) {\n+        Long podId = null;\n+        if (pod != null) {\n+            podId = pod.getId();\n+        } else if (clusterId != null) {\n+            Cluster cluster = _entityMgr.findById(Cluster.class, clusterId);\n+            if (cluster != null) {\n+                podId = cluster.getPodId();\n+            }\n+        }\n+        List<StoragePoolVO> childDatastores = _storagePoolDao.listChildStoragePoolsInDatastoreCluster(datastoreClusterId);\n+        List<StoragePool> suitablePools = new ArrayList<StoragePool>();\n+\n+        for (StoragePoolVO childDatastore: childDatastores)\n+            suitablePools.add((StoragePool)dataStoreMgr.getDataStore(childDatastore.getId(), DataStoreRole.Primary));\n+\n+        VirtualMachineProfile profile = new VirtualMachineProfileImpl(vm);\n+        for (StoragePoolAllocator allocator : _storagePoolAllocators) {\n+            DataCenterDeployment plan = new DataCenterDeployment(dc.getId(), podId, clusterId, hostId, null, null);\n+            final List<StoragePool> poolList = allocator.reorderPools(suitablePools, profile, plan);\n+\n+            if (poolList != null && !poolList.isEmpty()) {\n+                return (StoragePool)dataStoreMgr.getDataStore(poolList.get(0).getId(), DataStoreRole.Primary);\n+            }\n+        }\n+        return null;\n+    }", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "0a2823b80cb5cd1838a7e6ec3cd690619c2c17e8"}, "originalPosition": 96}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzExMDEwNzgzOnYy", "diffSide": "RIGHT", "path": "engine/orchestration/src/main/java/org/apache/cloudstack/engine/orchestration/VolumeOrchestrator.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yOVQxNToxOTo0NlrOHZyluw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yOVQxNToxOTo0NlrOHZyluw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NjgwNTMwNw==", "bodyText": "This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters. Learn more about bidirectional Unicode characters\n\n\n  \n\n\n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            }\n          \n          \n            \n            }", "url": "https://github.com/apache/cloudstack/pull/4307#discussion_r496805307", "createdAt": "2020-09-29T15:19:46Z", "author": {"login": "DaanHoogland"}, "path": "engine/orchestration/src/main/java/org/apache/cloudstack/engine/orchestration/VolumeOrchestrator.java", "diffHunk": "@@ -1704,4 +1801,4 @@ public void doInTransactionWithoutResult(TransactionStatus status) {\n             }\n         });\n     }\n-}\n+}", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "0a2823b80cb5cd1838a7e6ec3cd690619c2c17e8"}, "originalPosition": 271}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzExMDExNDM3OnYy", "diffSide": "RIGHT", "path": "engine/schema/src/main/java/com/cloud/dc/VsphereStoragePolicyVO.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yOVQxNToyMDo0M1rOHZyppg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yOVQxNToyMDo0M1rOHZyppg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NjgwNjMxMA==", "bodyText": "new classes should be in org.apache.cloudstack", "url": "https://github.com/apache/cloudstack/pull/4307#discussion_r496806310", "createdAt": "2020-09-29T15:20:43Z", "author": {"login": "DaanHoogland"}, "path": "engine/schema/src/main/java/com/cloud/dc/VsphereStoragePolicyVO.java", "diffHunk": "@@ -0,0 +1,126 @@\n+// Licensed to the Apache Software Foundation (ASF) under one\n+// or more contributor license agreements.  See the NOTICE file\n+// distributed with this work for additional information\n+// regarding copyright ownership.  The ASF licenses this file\n+// to you under the Apache License, Version 2.0 (the\n+// \"License\"); you may not use this file except in compliance\n+// with the License.  You may obtain a copy of the License at\n+//\n+//   http://www.apache.org/licenses/LICENSE-2.0\n+//\n+// Unless required by applicable law or agreed to in writing,\n+// software distributed under the License is distributed on an\n+// \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n+// KIND, either express or implied.  See the License for the\n+// specific language governing permissions and limitations\n+// under the License.\n+package com.cloud.dc;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "0a2823b80cb5cd1838a7e6ec3cd690619c2c17e8"}, "originalPosition": 17}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzExMDExODgzOnYy", "diffSide": "RIGHT", "path": "engine/schema/src/main/java/com/cloud/dc/dao/VsphereStoragePolicyDao.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yOVQxNToyMToyM1rOHZysbw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yOVQxNToyMToyM1rOHZysbw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NjgwNzAyMw==", "bodyText": "new classes should be in org.apache.cloudstack", "url": "https://github.com/apache/cloudstack/pull/4307#discussion_r496807023", "createdAt": "2020-09-29T15:21:23Z", "author": {"login": "DaanHoogland"}, "path": "engine/schema/src/main/java/com/cloud/dc/dao/VsphereStoragePolicyDao.java", "diffHunk": "@@ -14,18 +14,17 @@\n // KIND, either express or implied.  See the License for the\n // specific language governing permissions and limitations\n // under the License.\n+package com.cloud.dc.dao;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "0a2823b80cb5cd1838a7e6ec3cd690619c2c17e8"}, "originalPosition": 4}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzExMDEyMjI4OnYy", "diffSide": "RIGHT", "path": "engine/schema/src/main/java/com/cloud/dc/dao/VsphereStoragePolicyDaoImpl.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yOVQxNToyMTo1NVrOHZyujg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yOVQxNToyMTo1NVrOHZyujg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NjgwNzU2Ng==", "bodyText": "new classes should be in org.apache.cloudstack", "url": "https://github.com/apache/cloudstack/pull/4307#discussion_r496807566", "createdAt": "2020-09-29T15:21:55Z", "author": {"login": "DaanHoogland"}, "path": "engine/schema/src/main/java/com/cloud/dc/dao/VsphereStoragePolicyDaoImpl.java", "diffHunk": "@@ -0,0 +1,64 @@\n+// Licensed to the Apache Software Foundation (ASF) under one\n+// or more contributor license agreements.  See the NOTICE file\n+// distributed with this work for additional information\n+// regarding copyright ownership.  The ASF licenses this file\n+// to you under the Apache License, Version 2.0 (the\n+// \"License\"); you may not use this file except in compliance\n+// with the License.  You may obtain a copy of the License at\n+//\n+//   http://www.apache.org/licenses/LICENSE-2.0\n+//\n+// Unless required by applicable law or agreed to in writing,\n+// software distributed under the License is distributed on an\n+// \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n+// KIND, either express or implied.  See the License for the\n+// specific language governing permissions and limitations\n+// under the License.\n+package com.cloud.dc.dao;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "0a2823b80cb5cd1838a7e6ec3cd690619c2c17e8"}, "originalPosition": 17}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzExMDEyODg1OnYy", "diffSide": "RIGHT", "path": "engine/schema/src/main/java/com/cloud/deployasis/TemplateDeployAsIsDetailVO.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yOVQxNToyMjo1N1rOHZyyhA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yOVQxNToyMjo1N1rOHZyyhA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NjgwODU4MA==", "bodyText": "new classes should be in org.apache.cloudstack", "url": "https://github.com/apache/cloudstack/pull/4307#discussion_r496808580", "createdAt": "2020-09-29T15:22:57Z", "author": {"login": "DaanHoogland"}, "path": "engine/schema/src/main/java/com/cloud/deployasis/TemplateDeployAsIsDetailVO.java", "diffHunk": "@@ -0,0 +1,94 @@\n+// Licensed to the Apache Software Foundation (ASF) under one\n+// or more contributor license agreements.  See the NOTICE file\n+// distributed with this work for additional information\n+// regarding copyright ownership.  The ASF licenses this file\n+// to you under the Apache License, Version 2.0 (the\n+// \"License\"); you may not use this file except in compliance\n+// with the License.  You may obtain a copy of the License at\n+//\n+//   http://www.apache.org/licenses/LICENSE-2.0\n+//\n+// Unless required by applicable law or agreed to in writing,\n+// software distributed under the License is distributed on an\n+// \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n+// KIND, either express or implied.  See the License for the\n+// specific language governing permissions and limitations\n+// under the License.\n+package com.cloud.deployasis;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "0a2823b80cb5cd1838a7e6ec3cd690619c2c17e8"}, "originalPosition": 17}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzExMDEzMTgxOnYy", "diffSide": "RIGHT", "path": "engine/schema/src/main/java/com/cloud/deployasis/UserVmDeployAsIsDetailVO.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yOVQxNToyMzoyM1rOHZy0YQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yOVQxNToyMzoyM1rOHZy0YQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NjgwOTA1Nw==", "bodyText": "new classes should be in org.apache.cloudstack", "url": "https://github.com/apache/cloudstack/pull/4307#discussion_r496809057", "createdAt": "2020-09-29T15:23:23Z", "author": {"login": "DaanHoogland"}, "path": "engine/schema/src/main/java/com/cloud/deployasis/UserVmDeployAsIsDetailVO.java", "diffHunk": "@@ -0,0 +1,94 @@\n+// Licensed to the Apache Software Foundation (ASF) under one\n+// or more contributor license agreements.  See the NOTICE file\n+// distributed with this work for additional information\n+// regarding copyright ownership.  The ASF licenses this file\n+// to you under the Apache License, Version 2.0 (the\n+// \"License\"); you may not use this file except in compliance\n+// with the License.  You may obtain a copy of the License at\n+//\n+//   http://www.apache.org/licenses/LICENSE-2.0\n+//\n+// Unless required by applicable law or agreed to in writing,\n+// software distributed under the License is distributed on an\n+// \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n+// KIND, either express or implied.  See the License for the\n+// specific language governing permissions and limitations\n+// under the License.\n+package com.cloud.deployasis;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "0a2823b80cb5cd1838a7e6ec3cd690619c2c17e8"}, "originalPosition": 17}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzExMDEzNDEzOnYy", "diffSide": "RIGHT", "path": "engine/schema/src/main/java/com/cloud/deployasis/dao/TemplateDeployAsIsDetailsDao.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yOVQxNToyMzo0MFrOHZy1rg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yOVQxNToyMzo0MFrOHZy1rg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NjgwOTM5MA==", "bodyText": "new classes should be in org.apache.cloudstack", "url": "https://github.com/apache/cloudstack/pull/4307#discussion_r496809390", "createdAt": "2020-09-29T15:23:40Z", "author": {"login": "DaanHoogland"}, "path": "engine/schema/src/main/java/com/cloud/deployasis/dao/TemplateDeployAsIsDetailsDao.java", "diffHunk": "@@ -0,0 +1,32 @@\n+// Licensed to the Apache Software Foundation (ASF) under one\n+// or more contributor license agreements.  See the NOTICE file\n+// distributed with this work for additional information\n+// regarding copyright ownership.  The ASF licenses this file\n+// to you under the Apache License, Version 2.0 (the\n+// \"License\"); you may not use this file except in compliance\n+// with the License.  You may obtain a copy of the License at\n+//\n+//   http://www.apache.org/licenses/LICENSE-2.0\n+//\n+// Unless required by applicable law or agreed to in writing,\n+// software distributed under the License is distributed on an\n+// \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n+// KIND, either express or implied.  See the License for the\n+// specific language governing permissions and limitations\n+// under the License.\n+package com.cloud.deployasis.dao;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "0a2823b80cb5cd1838a7e6ec3cd690619c2c17e8"}, "originalPosition": 17}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzExMDEzNTYyOnYy", "diffSide": "RIGHT", "path": "engine/schema/src/main/java/com/cloud/deployasis/dao/TemplateDeployAsIsDetailsDaoImpl.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yOVQxNToyMzo1NFrOHZy2ig==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yOVQxNToyMzo1NFrOHZy2ig==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NjgwOTYxMA==", "bodyText": "new classes should be in org.apache.cloudstack", "url": "https://github.com/apache/cloudstack/pull/4307#discussion_r496809610", "createdAt": "2020-09-29T15:23:54Z", "author": {"login": "DaanHoogland"}, "path": "engine/schema/src/main/java/com/cloud/deployasis/dao/TemplateDeployAsIsDetailsDaoImpl.java", "diffHunk": "@@ -0,0 +1,83 @@\n+// Licensed to the Apache Software Foundation (ASF) under one\n+// or more contributor license agreements.  See the NOTICE file\n+// distributed with this work for additional information\n+// regarding copyright ownership.  The ASF licenses this file\n+// to you under the Apache License, Version 2.0 (the\n+// \"License\"); you may not use this file except in compliance\n+// with the License.  You may obtain a copy of the License at\n+//\n+//   http://www.apache.org/licenses/LICENSE-2.0\n+//\n+// Unless required by applicable law or agreed to in writing,\n+// software distributed under the License is distributed on an\n+// \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n+// KIND, either express or implied.  See the License for the\n+// specific language governing permissions and limitations\n+// under the License.\n+package com.cloud.deployasis.dao;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "0a2823b80cb5cd1838a7e6ec3cd690619c2c17e8"}, "originalPosition": 17}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzExMDEzODYyOnYy", "diffSide": "RIGHT", "path": "engine/schema/src/main/java/com/cloud/deployasis/dao/UserVmDeployAsIsDetailsDao.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yOVQxNToyNDoxN1rOHZy4Nw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yOVQxNToyNDoxN1rOHZy4Nw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NjgxMDAzOQ==", "bodyText": "new classes should be in org.apache.cloudstack", "url": "https://github.com/apache/cloudstack/pull/4307#discussion_r496810039", "createdAt": "2020-09-29T15:24:17Z", "author": {"login": "DaanHoogland"}, "path": "engine/schema/src/main/java/com/cloud/deployasis/dao/UserVmDeployAsIsDetailsDao.java", "diffHunk": "@@ -0,0 +1,24 @@\n+// Licensed to the Apache Software Foundation (ASF) under one\n+// or more contributor license agreements.  See the NOTICE file\n+// distributed with this work for additional information\n+// regarding copyright ownership.  The ASF licenses this file\n+// to you under the Apache License, Version 2.0 (the\n+// \"License\"); you may not use this file except in compliance\n+// with the License.  You may obtain a copy of the License at\n+//\n+//   http://www.apache.org/licenses/LICENSE-2.0\n+//\n+// Unless required by applicable law or agreed to in writing,\n+// software distributed under the License is distributed on an\n+// \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n+// KIND, either express or implied.  See the License for the\n+// specific language governing permissions and limitations\n+// under the License.\n+package com.cloud.deployasis.dao;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "0a2823b80cb5cd1838a7e6ec3cd690619c2c17e8"}, "originalPosition": 17}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzExMDE0MDMyOnYy", "diffSide": "RIGHT", "path": "engine/schema/src/main/java/com/cloud/deployasis/dao/UserVmDeployAsIsDetailsDaoImpl.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yOVQxNToyNDozM1rOHZy5PQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yOVQxNToyNDozM1rOHZy5PQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NjgxMDMwMQ==", "bodyText": "new classes should be in org.apache.cloudstack", "url": "https://github.com/apache/cloudstack/pull/4307#discussion_r496810301", "createdAt": "2020-09-29T15:24:33Z", "author": {"login": "DaanHoogland"}, "path": "engine/schema/src/main/java/com/cloud/deployasis/dao/UserVmDeployAsIsDetailsDaoImpl.java", "diffHunk": "@@ -0,0 +1,30 @@\n+// Licensed to the Apache Software Foundation (ASF) under one\n+// or more contributor license agreements.  See the NOTICE file\n+// distributed with this work for additional information\n+// regarding copyright ownership.  The ASF licenses this file\n+// to you under the Apache License, Version 2.0 (the\n+// \"License\"); you may not use this file except in compliance\n+// with the License.  You may obtain a copy of the License at\n+//\n+//   http://www.apache.org/licenses/LICENSE-2.0\n+//\n+// Unless required by applicable law or agreed to in writing,\n+// software distributed under the License is distributed on an\n+// \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n+// KIND, either express or implied.  See the License for the\n+// specific language governing permissions and limitations\n+// under the License.\n+package com.cloud.deployasis.dao;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "0a2823b80cb5cd1838a7e6ec3cd690619c2c17e8"}, "originalPosition": 17}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzExMDE1NjQ2OnYy", "diffSide": "RIGHT", "path": "engine/schema/src/main/java/com/cloud/storage/VMTemplateStoragePoolVO.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yOVQxNToyNjo0OFrOHZzCtA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yOVQxNToyNjo0OFrOHZzCtA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NjgxMjcyNA==", "bodyText": "why this difference in name? what do either mean?", "url": "https://github.com/apache/cloudstack/pull/4307#discussion_r496812724", "createdAt": "2020-09-29T15:26:48Z", "author": {"login": "DaanHoogland"}, "path": "engine/schema/src/main/java/com/cloud/storage/VMTemplateStoragePoolVO.java", "diffHunk": "@@ -168,17 +171,18 @@ public Status getDownloadState() {\n         return downloadState;\n     }\n \n-    public VMTemplateStoragePoolVO(long poolId, long templateId) {\n+    public VMTemplateStoragePoolVO(long poolId, long templateId, String configuration) {\n         super();\n         this.poolId = poolId;\n         this.templateId = templateId;\n         this.downloadState = Status.NOT_DOWNLOADED;\n         this.state = ObjectInDataStoreStateMachine.State.Allocated;\n         this.markedForGC = false;\n+        this.deploymentOption = configuration;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "0a2823b80cb5cd1838a7e6ec3cd690619c2c17e8"}, "originalPosition": 22}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzExMDE3NjEwOnYy", "diffSide": "RIGHT", "path": "engine/schema/src/main/java/com/cloud/storage/dao/VMTemplateDetailsDaoImpl.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yOVQxNToyOTo0M1rOHZzO1Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yOVQxNToyOTo0M1rOHZzO1Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NjgxNTgyOQ==", "bodyText": "This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters. Learn more about bidirectional Unicode characters\n\n\n  \n\n\n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            }\n          \n          \n            \n            }", "url": "https://github.com/apache/cloudstack/pull/4307#discussion_r496815829", "createdAt": "2020-09-29T15:29:43Z", "author": {"login": "DaanHoogland"}, "path": "engine/schema/src/main/java/com/cloud/storage/dao/VMTemplateDetailsDaoImpl.java", "diffHunk": "@@ -30,4 +30,4 @@\n     public void addDetail(long resourceId, String key, String value, boolean display) {\n         super.addDetail(new VMTemplateDetailVO(resourceId, key, value, display));\n     }\n-}\n+}", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "0a2823b80cb5cd1838a7e6ec3cd690619c2c17e8"}, "originalPosition": 5}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzExMDIwNzA0OnYy", "diffSide": "RIGHT", "path": "engine/schema/src/main/resources/META-INF/db/schema-41400to41500.sql", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yOVQxNTozNDoxMlrOHZzh0A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yOVQxNTozNDoxMlrOHZzh0A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NjgyMDY4OA==", "bodyText": "why are these part of this PR?", "url": "https://github.com/apache/cloudstack/pull/4307#discussion_r496820688", "createdAt": "2020-09-29T15:34:12Z", "author": {"login": "DaanHoogland"}, "path": "engine/schema/src/main/resources/META-INF/db/schema-41400to41500.sql", "diffHunk": "@@ -220,3 +516,22 @@ ALTER VIEW `cloud`.`image_store_view` AS\n         `cloud`.`data_center` ON image_store.data_center_id = data_center.id\n             left join\n         `cloud`.`image_store_details` ON image_store_details.store_id = image_store.id;\n+\n+-- OVF configured OS while registering deploy-as-is templates Linux 3.x Kernel OS\n+INSERT IGNORE INTO `cloud`.`guest_os` (id, uuid, category_id, display_name, created) VALUES (305, UUID(), 11, 'OVF Configured OS', now());\n+INSERT IGNORE INTO `cloud`.`guest_os` (id, uuid, category_id, display_name, created) VALUES (306, UUID(), 2, 'Linux 3.x Kernel (64 bit)', now());\n+INSERT IGNORE INTO `cloud`.`guest_os` (id, uuid, category_id, display_name, created) VALUES (307, UUID(), 2, 'Linux 3.x Kernel (32 bit)', now());\n+\n+INSERT IGNORE INTO `cloud`.`guest_os_hypervisor` (uuid, hypervisor_type, hypervisor_version, guest_os_name, guest_os_id, created, is_user_defined) VALUES (UUID(), 'VMware', '6.0', 'other3xLinux64Guest', 306, now(), 0);\n+INSERT IGNORE INTO `cloud`.`guest_os_hypervisor` (uuid, hypervisor_type, hypervisor_version, guest_os_name, guest_os_id, created, is_user_defined) VALUES (UUID(), 'VMware', '6.5', 'other3xLinux64Guest', 306, now(), 0);\n+INSERT IGNORE INTO `cloud`.`guest_os_hypervisor` (uuid, hypervisor_type, hypervisor_version, guest_os_name, guest_os_id, created, is_user_defined) VALUES (UUID(), 'VMware', '6.7', 'other3xLinux64Guest', 306, now(), 0);\n+INSERT IGNORE INTO `cloud`.`guest_os_hypervisor` (uuid, hypervisor_type, hypervisor_version, guest_os_name, guest_os_id, created, is_user_defined) VALUES (UUID(), 'VMware', '6.7.1', 'other3xLinux64Guest', 306, now(), 0);\n+INSERT IGNORE INTO `cloud`.`guest_os_hypervisor` (uuid, hypervisor_type, hypervisor_version, guest_os_name, guest_os_id, created, is_user_defined) VALUES (UUID(), 'VMware', '6.7.2', 'other3xLinux64Guest', 306, now(), 0);\n+INSERT IGNORE INTO `cloud`.`guest_os_hypervisor` (uuid, hypervisor_type, hypervisor_version, guest_os_name, guest_os_id, created, is_user_defined) VALUES (UUID(), 'VMware', '6.7.3', 'other3xLinux64Guest', 306, now(), 0);\n+\n+INSERT IGNORE INTO `cloud`.`guest_os_hypervisor` (uuid, hypervisor_type, hypervisor_version, guest_os_name, guest_os_id, created, is_user_defined) VALUES (UUID(), 'VMware', '6.0', 'other3xLinuxGuest', 307, now(), 0);\n+INSERT IGNORE INTO `cloud`.`guest_os_hypervisor` (uuid, hypervisor_type, hypervisor_version, guest_os_name, guest_os_id, created, is_user_defined) VALUES (UUID(), 'VMware', '6.5', 'other3xLinuxGuest', 307, now(), 0);\n+INSERT IGNORE INTO `cloud`.`guest_os_hypervisor` (uuid, hypervisor_type, hypervisor_version, guest_os_name, guest_os_id, created, is_user_defined) VALUES (UUID(), 'VMware', '6.7', 'other3xLinuxGuest', 307, now(), 0);\n+INSERT IGNORE INTO `cloud`.`guest_os_hypervisor` (uuid, hypervisor_type, hypervisor_version, guest_os_name, guest_os_id, created, is_user_defined) VALUES (UUID(), 'VMware', '6.7.1', 'other3xLinuxGuest', 307, now(), 0);\n+INSERT IGNORE INTO `cloud`.`guest_os_hypervisor` (uuid, hypervisor_type, hypervisor_version, guest_os_name, guest_os_id, created, is_user_defined) VALUES (UUID(), 'VMware', '6.7.2', 'other3xLinuxGuest', 307, now(), 0);\n+INSERT IGNORE INTO `cloud`.`guest_os_hypervisor` (uuid, hypervisor_type, hypervisor_version, guest_os_name, guest_os_id, created, is_user_defined) VALUES (UUID(), 'VMware', '6.7.3', 'other3xLinuxGuest', 307, now(), 0);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "0a2823b80cb5cd1838a7e6ec3cd690619c2c17e8"}, "originalPosition": 325}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzExMDIyOTY3OnYy", "diffSide": "RIGHT", "path": "engine/storage/image/src/main/java/org/apache/cloudstack/storage/image/TemplateServiceImpl.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yOVQxNTozNzoyNFrOHZzvfQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yOVQxNTozNzoyNFrOHZzvfQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NjgyNDE4OQ==", "bodyText": "This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters. Learn more about bidirectional Unicode characters\n\n\n  \n\n\n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            }\n          \n          \n            \n            }", "url": "https://github.com/apache/cloudstack/pull/4307#discussion_r496824189", "createdAt": "2020-09-29T15:37:24Z", "author": {"login": "DaanHoogland"}, "path": "engine/storage/image/src/main/java/org/apache/cloudstack/storage/image/TemplateServiceImpl.java", "diffHunk": "@@ -1280,4 +1290,4 @@ protected Void createDatadiskTemplateCallback(AsyncCallbackDispatcher<TemplateSe\n         future.complete(dataDiskTemplateResult);\n         return null;\n     }\n-}\n+}", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "0a2823b80cb5cd1838a7e6ec3cd690619c2c17e8"}, "originalPosition": 156}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzExMDMxNzMwOnYy", "diffSide": "LEFT", "path": "engine/storage/src/main/java/org/apache/cloudstack/storage/image/BaseImageStoreDriverImpl.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yOVQxNTo1MDowMVrOHZ0kbQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yOVQxNTo1MDowMVrOHZ0kbQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NjgzNzc0MQ==", "bodyText": "kind of surprising that the BaseImageStoreDriverImpl would be able to copy anything anymore in a PR that is Vmware specific... Why is this?", "url": "https://github.com/apache/cloudstack/pull/4307#discussion_r496837741", "createdAt": "2020-09-29T15:50:01Z", "author": {"login": "DaanHoogland"}, "path": "engine/storage/src/main/java/org/apache/cloudstack/storage/image/BaseImageStoreDriverImpl.java", "diffHunk": "@@ -413,25 +383,16 @@ private Answer sendToLeastBusyEndpoint(List<EndPoint> eps, CopyCommand cmd) {\n             return answer;\n         }  catch (AgentUnavailableException e) {\n             errMsg = e.toString();\n-            s_logger.debug(\"Failed to send command, due to Agent:\" + endPoint.getId() + \", \" + e.toString());\n+            LOGGER.debug(\"Failed to send command, due to Agent:\" + endPoint.getId() + \", \" + e.toString());\n         } catch (OperationTimedoutException e) {\n             errMsg = e.toString();\n-            s_logger.debug(\"Failed to send command, due to Agent:\" + endPoint.getId() + \", \" + e.toString());\n+            LOGGER.debug(\"Failed to send command, due to Agent:\" + endPoint.getId() + \", \" + e.toString());\n         }\n         throw new CloudRuntimeException(\"Failed to send command, due to Agent:\" + endPoint.getId() + \", \" + errMsg);\n     }\n \n     @Override\n     public boolean canCopy(DataObject srcData, DataObject destData) {\n-        DataStore srcStore = srcData.getDataStore();\n-        DataStore destStore = destData.getDataStore();\n-        if ((srcData.getDataStore().getTO() instanceof NfsTO && destData.getDataStore().getTO() instanceof NfsTO) &&\n-                (srcStore.getRole() == DataStoreRole.Image && destStore.getRole() == DataStoreRole.Image) &&\n-                ((srcData.getType() == DataObjectType.TEMPLATE && destData.getType() == DataObjectType.TEMPLATE) ||\n-                (srcData.getType() == DataObjectType.SNAPSHOT && destData.getType() == DataObjectType.SNAPSHOT) ||\n-                (srcData.getType() == DataObjectType.VOLUME && destData.getType() == DataObjectType.VOLUME))) {\n-            return true;\n-        }", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "0a2823b80cb5cd1838a7e6ec3cd690619c2c17e8"}, "originalPosition": 271}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzExMDMzNzQ5OnYy", "diffSide": "RIGHT", "path": "engine/storage/src/main/java/org/apache/cloudstack/storage/image/deployasis/DeployAsIsHelper.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yOVQxNTo1MzowNlrOHZ0w4Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yOVQxNTo1MzowNlrOHZ0w4Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5Njg0MDkyOQ==", "bodyText": "can we have some javadoc here? these are helper functions for use in... (storage drivers/network orchestrators/Virtualmachien orchestrators) ?", "url": "https://github.com/apache/cloudstack/pull/4307#discussion_r496840929", "createdAt": "2020-09-29T15:53:06Z", "author": {"login": "DaanHoogland"}, "path": "engine/storage/src/main/java/org/apache/cloudstack/storage/image/deployasis/DeployAsIsHelper.java", "diffHunk": "@@ -0,0 +1,34 @@\n+// Licensed to the Apache Software Foundation (ASF) under one\n+// or more contributor license agreements.  See the NOTICE file\n+// distributed with this work for additional information\n+// regarding copyright ownership.  The ASF licenses this file\n+// to you under the Apache License, Version 2.0 (the\n+// \"License\"); you may not use this file except in compliance\n+// with the License.  You may obtain a copy of the License at\n+//\n+//   http://www.apache.org/licenses/LICENSE-2.0\n+//\n+// Unless required by applicable law or agreed to in writing,\n+// software distributed under the License is distributed on an\n+// \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n+// KIND, either express or implied.  See the License for the\n+// specific language governing permissions and limitations\n+// under the License.\n+package org.apache.cloudstack.storage.image.deployasis;\n+\n+import com.cloud.agent.api.storage.DownloadAnswer;\n+import com.cloud.agent.api.to.NicTO;\n+import com.cloud.vm.VirtualMachineProfile;\n+\n+import java.util.Map;\n+\n+public interface DeployAsIsHelper {\n+\n+    void persistTemplateDeployAsIsDetails(long templateId, DownloadAnswer answer);\n+    Map<String, String> getVirtualMachineDeployAsIsProperties(VirtualMachineProfile vmId);\n+\n+    String getAllocatedVirtualMachineTemplatePath(VirtualMachineProfile vm, String configuration, String destStoragePool);\n+    String getAllocatedVirtualMachineDestinationStoragePool(VirtualMachineProfile vm);\n+\n+    Map<Integer, String> getAllocatedVirtualMachineNicsAdapterMapping(VirtualMachineProfile vm, NicTO[] nics);\n+}", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "0a2823b80cb5cd1838a7e6ec3cd690619c2c17e8"}, "originalPosition": 34}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzExMDM3ODIyOnYy", "diffSide": "RIGHT", "path": "vmware-base/src/main/java/com/cloud/hypervisor/vmware/util/VcenterSessionHandler.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yOVQxNTo1ODo1NlrOHZ1JYg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yOVQxNTo1ODo1NlrOHZ1JYg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5Njg0NzIwMg==", "bodyText": "new classes should go in org.apache.cloudstack", "url": "https://github.com/apache/cloudstack/pull/4307#discussion_r496847202", "createdAt": "2020-09-29T15:58:56Z", "author": {"login": "DaanHoogland"}, "path": "vmware-base/src/main/java/com/cloud/hypervisor/vmware/util/VcenterSessionHandler.java", "diffHunk": "@@ -0,0 +1,88 @@\n+// Licensed to the Apache Software Foundation (ASF) under one\n+// or more contributor license agreements.  See the NOTICE file\n+// distributed with this work for additional information\n+// regarding copyright ownership.  The ASF licenses this file\n+// to you under the Apache License, Version 2.0 (the\n+// \"License\"); you may not use this file except in compliance\n+// with the License.  You may obtain a copy of the License at\n+//\n+//   http://www.apache.org/licenses/LICENSE-2.0\n+//\n+// Unless required by applicable law or agreed to in writing,\n+// software distributed under the License is distributed on an\n+// \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n+// KIND, either express or implied.  See the License for the\n+// specific language governing permissions and limitations\n+// under the License.\n+package com.cloud.hypervisor.vmware.util;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "0a2823b80cb5cd1838a7e6ec3cd690619c2c17e8"}, "originalPosition": 17}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzExMDY2NDgyOnYy", "diffSide": "RIGHT", "path": "engine/storage/src/main/java/org/apache/cloudstack/storage/volume/datastore/PrimaryDataStoreHelper.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yOVQxNjo1MDo0OVrOHZ33tg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yOVQxNjo1MDo0OVrOHZ33tg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5Njg5MTgzMA==", "bodyText": "new method doSomeChildClusterStuff(ScopeType scopeType, ...)", "url": "https://github.com/apache/cloudstack/pull/4307#discussion_r496891830", "createdAt": "2020-09-29T16:50:49Z", "author": {"login": "DaanHoogland"}, "path": "engine/storage/src/main/java/org/apache/cloudstack/storage/volume/datastore/PrimaryDataStoreHelper.java", "diffHunk": "@@ -161,6 +161,13 @@ public DataStore attachCluster(DataStore store) {\n         pool.setScope(ScopeType.CLUSTER);\n         pool.setStatus(StoragePoolStatus.Up);\n         this.dataStoreDao.update(pool.getId(), pool);\n+        if(pool.getPoolType() == StoragePoolType.DatastoreCluster && pool.getParent() == 0) {\n+            List<StoragePoolVO> childDatastores = dataStoreDao.listChildStoragePoolsInDatastoreCluster(pool.getId());\n+            for (StoragePoolVO child : childDatastores) {\n+                child.setScope(ScopeType.CLUSTER);\n+                this.dataStoreDao.update(child.getId(), child);\n+            }\n+        }", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "0a2823b80cb5cd1838a7e6ec3cd690619c2c17e8"}, "originalPosition": 10}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzExMDY3NDQxOnYy", "diffSide": "RIGHT", "path": "engine/storage/src/main/java/org/apache/cloudstack/storage/volume/datastore/PrimaryDataStoreHelper.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yOVQxNjo1MzowMVrOHZ39WA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yOVQxNjo1MzowMVrOHZ39WA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5Njg5MzI3Mg==", "bodyText": "call of doSomeChildClusterStuff(ScopeType.ZONE, ...)", "url": "https://github.com/apache/cloudstack/pull/4307#discussion_r496893272", "createdAt": "2020-09-29T16:53:01Z", "author": {"login": "DaanHoogland"}, "path": "engine/storage/src/main/java/org/apache/cloudstack/storage/volume/datastore/PrimaryDataStoreHelper.java", "diffHunk": "@@ -178,6 +185,13 @@ public DataStore attachZone(DataStore store, HypervisorType hypervisor) {\n         pool.setHypervisor(hypervisor);\n         pool.setStatus(StoragePoolStatus.Up);\n         this.dataStoreDao.update(pool.getId(), pool);\n+        if(pool.getPoolType() == StoragePoolType.DatastoreCluster && pool.getParent() == 0) {\n+            List<StoragePoolVO> childDatastores = dataStoreDao.listChildStoragePoolsInDatastoreCluster(pool.getId());\n+            for (StoragePoolVO child : childDatastores) {\n+                child.setScope(ScopeType.ZONE);\n+                this.dataStoreDao.update(child.getId(), child);\n+            }\n+        }", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "0a2823b80cb5cd1838a7e6ec3cd690619c2c17e8"}, "originalPosition": 24}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzExMDY5NDg5OnYy", "diffSide": "RIGHT", "path": "engine/storage/volume/src/main/java/org/apache/cloudstack/storage/volume/VolumeServiceImpl.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yOVQxNjo1ODoyMVrOHZ4KXA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yOVQxNjo1ODoyMVrOHZ4KXA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5Njg5NjYwNA==", "bodyText": "This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters. Learn more about bidirectional Unicode characters\n\n\n  \n\n\n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            }\n          \n          \n            \n            }", "url": "https://github.com/apache/cloudstack/pull/4307#discussion_r496896604", "createdAt": "2020-09-29T16:58:21Z", "author": {"login": "DaanHoogland"}, "path": "engine/storage/volume/src/main/java/org/apache/cloudstack/storage/volume/VolumeServiceImpl.java", "diffHunk": "@@ -2125,4 +2132,4 @@ public void unmanageVolume(long volumeId) {\n             volDao.remove(vol.getId());\n         }\n     }\n-}\n+}", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "0a2823b80cb5cd1838a7e6ec3cd690619c2c17e8"}, "originalPosition": 227}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzExMDcwODkzOnYy", "diffSide": "RIGHT", "path": "vmware-base/src/main/java/com/cloud/hypervisor/vmware/mo/VirtualStorageObjectManagerMO.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yOVQxNzowMjowOFrOHZ4TcA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yOVQxNzowMjowOFrOHZ4TcA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5Njg5ODkyOA==", "bodyText": "new classes should go in org.apache.cloudstack", "url": "https://github.com/apache/cloudstack/pull/4307#discussion_r496898928", "createdAt": "2020-09-29T17:02:08Z", "author": {"login": "DaanHoogland"}, "path": "vmware-base/src/main/java/com/cloud/hypervisor/vmware/mo/VirtualStorageObjectManagerMO.java", "diffHunk": "@@ -0,0 +1,94 @@\n+// Licensed to the Apache Software Foundation (ASF) under one\n+// or more contributor license agreements.  See the NOTICE file\n+// distributed with this work for additional information\n+// regarding copyright ownership.  The ASF licenses this file\n+// to you under the Apache License, Version 2.0 (the\n+// \"License\"); you may not use this file except in compliance\n+// with the License.  You may obtain a copy of the License at\n+//\n+//   http://www.apache.org/licenses/LICENSE-2.0\n+//\n+// Unless required by applicable law or agreed to in writing,\n+// software distributed under the License is distributed on an\n+// \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n+// KIND, either express or implied.  See the License for the\n+// specific language governing permissions and limitations\n+// under the License.\n+package com.cloud.hypervisor.vmware.mo;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "0a2823b80cb5cd1838a7e6ec3cd690619c2c17e8"}, "originalPosition": 17}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzExMDcxOTI4OnYy", "diffSide": "RIGHT", "path": "vmware-base/src/main/java/com/cloud/hypervisor/vmware/mo/StoragepodMO.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yOVQxNzowNTowN1rOHZ4aJA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yOVQxNzowNTowN1rOHZ4aJA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NjkwMDY0NA==", "bodyText": "new classes should go in org.apache.cloudstack", "url": "https://github.com/apache/cloudstack/pull/4307#discussion_r496900644", "createdAt": "2020-09-29T17:05:07Z", "author": {"login": "DaanHoogland"}, "path": "vmware-base/src/main/java/com/cloud/hypervisor/vmware/mo/StoragepodMO.java", "diffHunk": "@@ -0,0 +1,48 @@\n+// Licensed to the Apache Software Foundation (ASF) under one\n+// or more contributor license agreements.  See the NOTICE file\n+// distributed with this work for additional information\n+// regarding copyright ownership.  The ASF licenses this file\n+// to you under the Apache License, Version 2.0 (the\n+// \"License\"); you may not use this file except in compliance\n+// with the License.  You may obtain a copy of the License at\n+//\n+//   http://www.apache.org/licenses/LICENSE-2.0\n+//\n+// Unless required by applicable law or agreed to in writing,\n+// software distributed under the License is distributed on an\n+// \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n+// KIND, either express or implied.  See the License for the\n+// specific language governing permissions and limitations\n+// under the License.\n+\n+package com.cloud.hypervisor.vmware.mo;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "0a2823b80cb5cd1838a7e6ec3cd690619c2c17e8"}, "originalPosition": 18}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzExMDcyMjAwOnYy", "diffSide": "RIGHT", "path": "vmware-base/src/main/java/com/cloud/hypervisor/vmware/mo/PbmProfileManagerMO.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yOVQxNzowNTo1M1rOHZ4b8g==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yOVQxNzowNTo1M1rOHZ4b8g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NjkwMTEwNg==", "bodyText": "new classes should go in org.apache.cloudstack", "url": "https://github.com/apache/cloudstack/pull/4307#discussion_r496901106", "createdAt": "2020-09-29T17:05:53Z", "author": {"login": "DaanHoogland"}, "path": "vmware-base/src/main/java/com/cloud/hypervisor/vmware/mo/PbmProfileManagerMO.java", "diffHunk": "@@ -0,0 +1,94 @@\n+// Licensed to the Apache Software Foundation (ASF) under one\n+// or more contributor license agreements.  See the NOTICE file\n+// distributed with this work for additional information\n+// regarding copyright ownership.  The ASF licenses this file\n+// to you under the Apache License, Version 2.0 (the\n+// \"License\"); you may not use this file except in compliance\n+// with the License.  You may obtain a copy of the License at\n+//\n+//   http://www.apache.org/licenses/LICENSE-2.0\n+//\n+// Unless required by applicable law or agreed to in writing,\n+// software distributed under the License is distributed on an\n+// \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n+// KIND, either express or implied.  See the License for the\n+// specific language governing permissions and limitations\n+// under the License.\n+package com.cloud.hypervisor.vmware.mo;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "0a2823b80cb5cd1838a7e6ec3cd690619c2c17e8"}, "originalPosition": 17}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzExMDcyNDg3OnYy", "diffSide": "RIGHT", "path": "vmware-base/src/main/java/com/cloud/hypervisor/vmware/mo/PbmPlacementSolverMO.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yOVQxNzowNjo0MlrOHZ4dvg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yOVQxNzowNjo0MlrOHZ4dvg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NjkwMTU2Ng==", "bodyText": "new classes should go in org.apache.cloudstack", "url": "https://github.com/apache/cloudstack/pull/4307#discussion_r496901566", "createdAt": "2020-09-29T17:06:42Z", "author": {"login": "DaanHoogland"}, "path": "vmware-base/src/main/java/com/cloud/hypervisor/vmware/mo/PbmPlacementSolverMO.java", "diffHunk": "@@ -0,0 +1,68 @@\n+// Licensed to the Apache Software Foundation (ASF) under one\n+// or more contributor license agreements.  See the NOTICE file\n+// distributed with this work for additional information\n+// regarding copyright ownership.  The ASF licenses this file\n+// to you under the Apache License, Version 2.0 (the\n+// \"License\"); you may not use this file except in compliance\n+// with the License.  You may obtain a copy of the License at\n+//\n+//   http://www.apache.org/licenses/LICENSE-2.0\n+//\n+// Unless required by applicable law or agreed to in writing,\n+// software distributed under the License is distributed on an\n+// \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n+// KIND, either express or implied.  See the License for the\n+// specific language governing permissions and limitations\n+// under the License.\n+package com.cloud.hypervisor.vmware.mo;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "0a2823b80cb5cd1838a7e6ec3cd690619c2c17e8"}, "originalPosition": 17}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzExMDczMDE4OnYy", "diffSide": "RIGHT", "path": "vmware-base/src/main/java/com/cloud/hypervisor/vmware/mo/HypervisorHostHelper.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yOVQxNzowODowMlrOHZ4g5g==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yOVQxNzowODowMlrOHZ4g5g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NjkwMjM3NA==", "bodyText": "\ud83d\udc4d", "url": "https://github.com/apache/cloudstack/pull/4307#discussion_r496902374", "createdAt": "2020-09-29T17:08:02Z", "author": {"login": "DaanHoogland"}, "path": "vmware-base/src/main/java/com/cloud/hypervisor/vmware/mo/HypervisorHostHelper.java", "diffHunk": "@@ -1704,6 +1736,11 @@ public static String resolveHostNameInUrl(DatacenterMO dcMo, String url) {\n         return url;\n     }\n \n+    /**", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "0a2823b80cb5cd1838a7e6ec3cd690619c2c17e8"}, "originalPosition": 97}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzExMDczMTU5OnYy", "diffSide": "RIGHT", "path": "vmware-base/src/main/java/com/cloud/hypervisor/vmware/mo/HypervisorHostHelper.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yOVQxNzowODoyNlrOHZ4h0g==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yOVQxNzowODoyNlrOHZ4h0g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NjkwMjYxMA==", "bodyText": "\ud83d\udc4d", "url": "https://github.com/apache/cloudstack/pull/4307#discussion_r496902610", "createdAt": "2020-09-29T17:08:26Z", "author": {"login": "DaanHoogland"}, "path": "vmware-base/src/main/java/com/cloud/hypervisor/vmware/mo/HypervisorHostHelper.java", "diffHunk": "@@ -1738,33 +1775,47 @@ public static String removeOVFNetwork(final String ovfString)  {\n         return ovfString;\n     }\n \n+    /**", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "0a2823b80cb5cd1838a7e6ec3cd690619c2c17e8"}, "originalPosition": 109}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzExMDczMjUwOnYy", "diffSide": "RIGHT", "path": "vmware-base/src/main/java/com/cloud/hypervisor/vmware/mo/HypervisorHostHelper.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yOVQxNzowODo0MFrOHZ4iXg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yOVQxNzowODo0MFrOHZ4iXg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NjkwMjc1MA==", "bodyText": "This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters. Learn more about bidirectional Unicode characters\n\n\n  \n\n\n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                 * @throws Exception shoud be a VmwareResourceException\n          \n          \n            \n                 * @throws CloudRuntimeException should be a VmwareResourceException\n          \n          \n            \n                 * @throws IOException if ovfFilePath not valid?", "url": "https://github.com/apache/cloudstack/pull/4307#discussion_r496902750", "createdAt": "2020-09-29T17:08:40Z", "author": {"login": "DaanHoogland"}, "path": "vmware-base/src/main/java/com/cloud/hypervisor/vmware/mo/HypervisorHostHelper.java", "diffHunk": "@@ -1738,33 +1775,47 @@ public static String removeOVFNetwork(final String ovfString)  {\n         return ovfString;\n     }\n \n+    /**\n+     * deploys a new VM from a ovf spec. It ignores network, defaults locale to 'US'\n+     * @throws Exception shoud be a VmwareResourceException", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "0a2823b80cb5cd1838a7e6ec3cd690619c2c17e8"}, "originalPosition": 111}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzExMDc0OTE1OnYy", "diffSide": "RIGHT", "path": "vmware-base/src/main/java/com/cloud/hypervisor/vmware/mo/HypervisorHostHelper.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yOVQxNzoxMjo1N1rOHZ4scQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yOVQxNzoxMjo1N1rOHZ4scQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NjkwNTMyOQ==", "bodyText": "factorred out in new method?", "url": "https://github.com/apache/cloudstack/pull/4307#discussion_r496905329", "createdAt": "2020-09-29T17:12:57Z", "author": {"login": "DaanHoogland"}, "path": "vmware-base/src/main/java/com/cloud/hypervisor/vmware/mo/HypervisorHostHelper.java", "diffHunk": "@@ -1738,33 +1775,47 @@ public static String removeOVFNetwork(final String ovfString)  {\n         return ovfString;\n     }\n \n+    /**\n+     * deploys a new VM from a ovf spec. It ignores network, defaults locale to 'US'\n+     * @throws Exception shoud be a VmwareResourceException\n+     */\n     public static void importVmFromOVF(VmwareHypervisorHost host, String ovfFilePath, String vmName, DatastoreMO dsMo, String diskOption, ManagedObjectReference morRp,\n-            ManagedObjectReference morHost) throws Exception {\n+                                       ManagedObjectReference morHost, String configurationId) throws CloudRuntimeException, IOException {\n \n         assert (morRp != null);\n \n         OvfCreateImportSpecParams importSpecParams = new OvfCreateImportSpecParams();\n         importSpecParams.setHostSystem(morHost);\n         importSpecParams.setLocale(\"US\");\n         importSpecParams.setEntityName(vmName);\n-        importSpecParams.setDeploymentOption(\"\");\n+        String deploymentOption = StringUtils.isNotBlank(configurationId) ? configurationId : \"\";\n+        importSpecParams.setDeploymentOption(deploymentOption);\n         importSpecParams.setDiskProvisioning(diskOption); // diskOption: thin, thick, etc\n \n         String ovfDescriptor = removeOVFNetwork(HttpNfcLeaseMO.readOvfContent(ovfFilePath));\n         VmwareContext context = host.getContext();\n-        OvfCreateImportSpecResult ovfImportResult =\n-                context.getService().createImportSpec(context.getServiceContent().getOvfManager(), ovfDescriptor, morRp, dsMo.getMor(), importSpecParams);\n-\n+        OvfCreateImportSpecResult ovfImportResult = null;\n+        try {\n+            ovfImportResult = context.getService().createImportSpec(context.getServiceContent().getOvfManager(), ovfDescriptor, morRp, dsMo.getMor(), importSpecParams);\n+        } catch (ConcurrentAccessFaultMsg\n+                | FileFaultFaultMsg\n+                | InvalidDatastoreFaultMsg\n+                | InvalidStateFaultMsg\n+                | RuntimeFaultFaultMsg\n+                | TaskInProgressFaultMsg\n+                | VmConfigFaultFaultMsg error) {\n+            throw new CloudRuntimeException(\"ImportSpec creation failed\", error);\n+        }", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "0a2823b80cb5cd1838a7e6ec3cd690619c2c17e8"}, "originalPosition": 144}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzExMDc1MTc2OnYy", "diffSide": "RIGHT", "path": "vmware-base/src/main/java/com/cloud/hypervisor/vmware/mo/HypervisorHostHelper.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yOVQxNzoxMzo0MVrOHZ4uGQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yOVQxNzoxMzo0MVrOHZ4uGQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NjkwNTc1Mw==", "bodyText": "factor in new method", "url": "https://github.com/apache/cloudstack/pull/4307#discussion_r496905753", "createdAt": "2020-09-29T17:13:41Z", "author": {"login": "DaanHoogland"}, "path": "vmware-base/src/main/java/com/cloud/hypervisor/vmware/mo/HypervisorHostHelper.java", "diffHunk": "@@ -1773,22 +1824,55 @@ public static void importVmFromOVF(VmwareHypervisorHost host, String ovfFilePath\n             }\n         }\n \n-        DatacenterMO dcMo = new DatacenterMO(context, host.getHyperHostDatacenter());\n-        ManagedObjectReference morLease = context.getService().importVApp(morRp, ovfImportResult.getImportSpec(), dcMo.getVmFolder(), morHost);\n+        DatacenterMO dcMo = null;\n+        try {\n+            dcMo = new DatacenterMO(context, host.getHyperHostDatacenter());\n+        } catch (Exception e) {\n+            throw new CloudRuntimeException(String.format(\"no datacenter for host '%s' available in context\", context.getServerAddress()), e);\n+        }", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "0a2823b80cb5cd1838a7e6ec3cd690619c2c17e8"}, "originalPosition": 171}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzExMDc1MjY3OnYy", "diffSide": "RIGHT", "path": "vmware-base/src/main/java/com/cloud/hypervisor/vmware/mo/HypervisorHostHelper.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yOVQxNzoxMzo1OFrOHZ4urg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yOVQxNzoxMzo1OFrOHZ4urg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NjkwNTkwMg==", "bodyText": "factor in new method", "url": "https://github.com/apache/cloudstack/pull/4307#discussion_r496905902", "createdAt": "2020-09-29T17:13:58Z", "author": {"login": "DaanHoogland"}, "path": "vmware-base/src/main/java/com/cloud/hypervisor/vmware/mo/HypervisorHostHelper.java", "diffHunk": "@@ -1773,22 +1824,55 @@ public static void importVmFromOVF(VmwareHypervisorHost host, String ovfFilePath\n             }\n         }\n \n-        DatacenterMO dcMo = new DatacenterMO(context, host.getHyperHostDatacenter());\n-        ManagedObjectReference morLease = context.getService().importVApp(morRp, ovfImportResult.getImportSpec(), dcMo.getVmFolder(), morHost);\n+        DatacenterMO dcMo = null;\n+        try {\n+            dcMo = new DatacenterMO(context, host.getHyperHostDatacenter());\n+        } catch (Exception e) {\n+            throw new CloudRuntimeException(String.format(\"no datacenter for host '%s' available in context\", context.getServerAddress()), e);\n+        }\n+        ManagedObjectReference folderMO = null;\n+        try {\n+            folderMO = dcMo.getVmFolder();\n+        } catch (Exception e) {\n+            throw new CloudRuntimeException(\"no management handle for VmFolder\", e);\n+        }", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "0a2823b80cb5cd1838a7e6ec3cd690619c2c17e8"}, "originalPosition": 177}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzExMDc1MzY4OnYy", "diffSide": "RIGHT", "path": "vmware-base/src/main/java/com/cloud/hypervisor/vmware/mo/HypervisorHostHelper.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yOVQxNzoxNDoxMlrOHZ4vPg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yOVQxNzoxNDoxMlrOHZ4vPg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NjkwNjA0Ng==", "bodyText": "new method", "url": "https://github.com/apache/cloudstack/pull/4307#discussion_r496906046", "createdAt": "2020-09-29T17:14:12Z", "author": {"login": "DaanHoogland"}, "path": "vmware-base/src/main/java/com/cloud/hypervisor/vmware/mo/HypervisorHostHelper.java", "diffHunk": "@@ -1773,22 +1824,55 @@ public static void importVmFromOVF(VmwareHypervisorHost host, String ovfFilePath\n             }\n         }\n \n-        DatacenterMO dcMo = new DatacenterMO(context, host.getHyperHostDatacenter());\n-        ManagedObjectReference morLease = context.getService().importVApp(morRp, ovfImportResult.getImportSpec(), dcMo.getVmFolder(), morHost);\n+        DatacenterMO dcMo = null;\n+        try {\n+            dcMo = new DatacenterMO(context, host.getHyperHostDatacenter());\n+        } catch (Exception e) {\n+            throw new CloudRuntimeException(String.format(\"no datacenter for host '%s' available in context\", context.getServerAddress()), e);\n+        }\n+        ManagedObjectReference folderMO = null;\n+        try {\n+            folderMO = dcMo.getVmFolder();\n+        } catch (Exception e) {\n+            throw new CloudRuntimeException(\"no management handle for VmFolder\", e);\n+        }\n+        ManagedObjectReference morLease = null;\n+        try {\n+            morLease = context.getService().importVApp(morRp, ovfImportResult.getImportSpec(), folderMO, morHost);\n+        } catch (DuplicateNameFaultMsg\n+                | FileFaultFaultMsg\n+                | InsufficientResourcesFaultFaultMsg\n+                | InvalidDatastoreFaultMsg\n+                | InvalidNameFaultMsg\n+                | OutOfBoundsFaultMsg\n+                | RuntimeFaultFaultMsg\n+                | VmConfigFaultFaultMsg fault) {\n+            throw new CloudRuntimeException(\"import vApp failed\",fault);\n+        }", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "0a2823b80cb5cd1838a7e6ec3cd690619c2c17e8"}, "originalPosition": 190}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzExMDc1NDczOnYy", "diffSide": "RIGHT", "path": "vmware-base/src/main/java/com/cloud/hypervisor/vmware/mo/HypervisorHostHelper.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yOVQxNzoxNDoyN1rOHZ4v8w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yOVQxNzoxNDoyN1rOHZ4v8w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NjkwNjIyNw==", "bodyText": "new method", "url": "https://github.com/apache/cloudstack/pull/4307#discussion_r496906227", "createdAt": "2020-09-29T17:14:27Z", "author": {"login": "DaanHoogland"}, "path": "vmware-base/src/main/java/com/cloud/hypervisor/vmware/mo/HypervisorHostHelper.java", "diffHunk": "@@ -1773,22 +1824,55 @@ public static void importVmFromOVF(VmwareHypervisorHost host, String ovfFilePath\n             }\n         }\n \n-        DatacenterMO dcMo = new DatacenterMO(context, host.getHyperHostDatacenter());\n-        ManagedObjectReference morLease = context.getService().importVApp(morRp, ovfImportResult.getImportSpec(), dcMo.getVmFolder(), morHost);\n+        DatacenterMO dcMo = null;\n+        try {\n+            dcMo = new DatacenterMO(context, host.getHyperHostDatacenter());\n+        } catch (Exception e) {\n+            throw new CloudRuntimeException(String.format(\"no datacenter for host '%s' available in context\", context.getServerAddress()), e);\n+        }\n+        ManagedObjectReference folderMO = null;\n+        try {\n+            folderMO = dcMo.getVmFolder();\n+        } catch (Exception e) {\n+            throw new CloudRuntimeException(\"no management handle for VmFolder\", e);\n+        }\n+        ManagedObjectReference morLease = null;\n+        try {\n+            morLease = context.getService().importVApp(morRp, ovfImportResult.getImportSpec(), folderMO, morHost);\n+        } catch (DuplicateNameFaultMsg\n+                | FileFaultFaultMsg\n+                | InsufficientResourcesFaultFaultMsg\n+                | InvalidDatastoreFaultMsg\n+                | InvalidNameFaultMsg\n+                | OutOfBoundsFaultMsg\n+                | RuntimeFaultFaultMsg\n+                | VmConfigFaultFaultMsg fault) {\n+            throw new CloudRuntimeException(\"import vApp failed\",fault);\n+        }\n         if (morLease == null) {\n             String msg = \"importVApp() failed. ovfFilePath: \" + ovfFilePath + \", vmName: \" + vmName + \", diskOption: \" + diskOption;\n             s_logger.error(msg);\n-            throw new Exception(msg);\n+            throw new CloudRuntimeException(msg);\n         }\n         boolean importSuccess = true;\n         final HttpNfcLeaseMO leaseMo = new HttpNfcLeaseMO(context, morLease);\n-        HttpNfcLeaseState state = leaseMo.waitState(new HttpNfcLeaseState[] {HttpNfcLeaseState.READY, HttpNfcLeaseState.ERROR});\n+        HttpNfcLeaseState state = null;\n+        try {\n+            state = leaseMo.waitState(new HttpNfcLeaseState[] {HttpNfcLeaseState.READY, HttpNfcLeaseState.ERROR});\n+        } catch (Exception e) {\n+            throw new CloudRuntimeException(\"exception while waiting for leaseMO\", e);\n+        }", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "0a2823b80cb5cd1838a7e6ec3cd690619c2c17e8"}, "originalPosition": 205}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzExMDc1NTk4OnYy", "diffSide": "RIGHT", "path": "vmware-base/src/main/java/com/cloud/hypervisor/vmware/mo/HypervisorHostHelper.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yOVQxNzoxNDo0M1rOHZ4wqg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yOVQxNzoxNDo0M1rOHZ4wqg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NjkwNjQxMA==", "bodyText": "new method", "url": "https://github.com/apache/cloudstack/pull/4307#discussion_r496906410", "createdAt": "2020-09-29T17:14:43Z", "author": {"login": "DaanHoogland"}, "path": "vmware-base/src/main/java/com/cloud/hypervisor/vmware/mo/HypervisorHostHelper.java", "diffHunk": "@@ -1773,22 +1824,55 @@ public static void importVmFromOVF(VmwareHypervisorHost host, String ovfFilePath\n             }\n         }\n \n-        DatacenterMO dcMo = new DatacenterMO(context, host.getHyperHostDatacenter());\n-        ManagedObjectReference morLease = context.getService().importVApp(morRp, ovfImportResult.getImportSpec(), dcMo.getVmFolder(), morHost);\n+        DatacenterMO dcMo = null;\n+        try {\n+            dcMo = new DatacenterMO(context, host.getHyperHostDatacenter());\n+        } catch (Exception e) {\n+            throw new CloudRuntimeException(String.format(\"no datacenter for host '%s' available in context\", context.getServerAddress()), e);\n+        }\n+        ManagedObjectReference folderMO = null;\n+        try {\n+            folderMO = dcMo.getVmFolder();\n+        } catch (Exception e) {\n+            throw new CloudRuntimeException(\"no management handle for VmFolder\", e);\n+        }\n+        ManagedObjectReference morLease = null;\n+        try {\n+            morLease = context.getService().importVApp(morRp, ovfImportResult.getImportSpec(), folderMO, morHost);\n+        } catch (DuplicateNameFaultMsg\n+                | FileFaultFaultMsg\n+                | InsufficientResourcesFaultFaultMsg\n+                | InvalidDatastoreFaultMsg\n+                | InvalidNameFaultMsg\n+                | OutOfBoundsFaultMsg\n+                | RuntimeFaultFaultMsg\n+                | VmConfigFaultFaultMsg fault) {\n+            throw new CloudRuntimeException(\"import vApp failed\",fault);\n+        }\n         if (morLease == null) {\n             String msg = \"importVApp() failed. ovfFilePath: \" + ovfFilePath + \", vmName: \" + vmName + \", diskOption: \" + diskOption;\n             s_logger.error(msg);\n-            throw new Exception(msg);\n+            throw new CloudRuntimeException(msg);\n         }\n         boolean importSuccess = true;\n         final HttpNfcLeaseMO leaseMo = new HttpNfcLeaseMO(context, morLease);\n-        HttpNfcLeaseState state = leaseMo.waitState(new HttpNfcLeaseState[] {HttpNfcLeaseState.READY, HttpNfcLeaseState.ERROR});\n+        HttpNfcLeaseState state = null;\n+        try {\n+            state = leaseMo.waitState(new HttpNfcLeaseState[] {HttpNfcLeaseState.READY, HttpNfcLeaseState.ERROR});\n+        } catch (Exception e) {\n+            throw new CloudRuntimeException(\"exception while waiting for leaseMO\", e);\n+        }\n         try {\n             if (state == HttpNfcLeaseState.READY) {\n                 final long totalBytes = HttpNfcLeaseMO.calcTotalBytes(ovfImportResult);\n                 File ovfFile = new File(ovfFilePath);\n \n-                HttpNfcLeaseInfo httpNfcLeaseInfo = leaseMo.getLeaseInfo();\n+                HttpNfcLeaseInfo httpNfcLeaseInfo = null;\n+                try {\n+                    httpNfcLeaseInfo = leaseMo.getLeaseInfo();\n+                } catch (Exception e) {\n+                    throw new CloudRuntimeException(\"error waiting for lease info\", e);\n+                }", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "0a2823b80cb5cd1838a7e6ec3cd690619c2c17e8"}, "originalPosition": 217}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzExMDc1OTc5OnYy", "diffSide": "RIGHT", "path": "vmware-base/src/main/java/com/cloud/hypervisor/vmware/mo/HypervisorHostHelper.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yOVQxNzoxNTo0NlrOHZ4zCg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yOVQxNzoxNTo0NlrOHZ4zCg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NjkwNzAxOA==", "bodyText": "cleanup/finalize method", "url": "https://github.com/apache/cloudstack/pull/4307#discussion_r496907018", "createdAt": "2020-09-29T17:15:46Z", "author": {"login": "DaanHoogland"}, "path": "vmware-base/src/main/java/com/cloud/hypervisor/vmware/mo/HypervisorHostHelper.java", "diffHunk": "@@ -1818,31 +1903,44 @@ public void action(Long param) {\n                     String erroMsg = \"File upload task failed to complete due to: \" + e.getMessage();\n                     s_logger.error(erroMsg);\n                     importSuccess = false; // Set flag to cleanup the stale template left due to failed import operation, if any\n-                    throw new Exception(erroMsg, e);\n+                    throw new CloudRuntimeException(erroMsg, e);\n                 } catch (Throwable th) {\n                     String errorMsg = \"throwable caught during file upload task: \" + th.getMessage();\n                     s_logger.error(errorMsg);\n                     importSuccess = false; // Set flag to cleanup the stale template left due to failed import operation, if any\n-                    throw new Exception(errorMsg, th);\n+                    throw new CloudRuntimeException(errorMsg, th);\n                 } finally {\n                     progressReporter.close();\n                 }\n                 if (bytesAlreadyWritten == totalBytes) {\n-                    leaseMo.updateLeaseProgress(100);\n+                    try {\n+                        leaseMo.updateLeaseProgress(100);\n+                    } catch (Exception e) {\n+                        throw new CloudRuntimeException(\"error while waiting for lease update\", e);\n+                    }\n                 }\n             } else if (state == HttpNfcLeaseState.ERROR) {\n-                LocalizedMethodFault error = leaseMo.getLeaseError();\n+                LocalizedMethodFault error = null;\n+                try {\n+                    error = leaseMo.getLeaseError();\n+                } catch (Exception e) {\n+                    throw new CloudRuntimeException(\"error getting lease error\", e);\n+                }\n                 MethodFault fault = error.getFault();\n                 String erroMsg = \"Object creation on vCenter failed due to: Exception: \" + fault.getClass().getName() + \", message: \" + error.getLocalizedMessage();\n                 s_logger.error(erroMsg);\n-                throw new Exception(erroMsg);\n+                throw new CloudRuntimeException(erroMsg);\n             }\n         } finally {\n-            if (!importSuccess) {\n-                s_logger.error(\"Aborting the lease on \" + vmName + \" after import operation failed.\");\n-                leaseMo.abortLease();\n-            } else {\n-                leaseMo.completeLease();\n+            try {\n+                if (!importSuccess) {\n+                    s_logger.error(\"Aborting the lease on \" + vmName + \" after import operation failed.\");\n+                    leaseMo.abortLease();\n+                } else {\n+                    leaseMo.completeLease();\n+                }", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "0a2823b80cb5cd1838a7e6ec3cd690619c2c17e8"}, "originalPosition": 278}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzExMDc4MTY4OnYy", "diffSide": "RIGHT", "path": "plugins/hypervisors/vmware/src/main/java/com/cloud/hypervisor/vmware/resource/VmwareResource.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yOVQxNzoyMTo1MVrOHZ5A-g==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yOVQxNzoyMTo1MVrOHZ5A-g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NjkxMDU4Ng==", "bodyText": "internal project code in open source version. please remove/reformulate this comment.", "url": "https://github.com/apache/cloudstack/pull/4307#discussion_r496910586", "createdAt": "2020-09-29T17:21:51Z", "author": {"login": "DaanHoogland"}, "path": "plugins/hypervisors/vmware/src/main/java/com/cloud/hypervisor/vmware/resource/VmwareResource.java", "diffHunk": "@@ -745,20 +752,38 @@ private Answer execute(ResizeVolumeCommand cmd) {\n             } else if (newSize == oldSize) {\n                 return new ResizeVolumeAnswer(cmd, true, \"success\", newSize * ResourceType.bytesToKiB);\n             }\n+            /*\n+            // FR41 this is yet to fix", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "0a2823b80cb5cd1838a7e6ec3cd690619c2c17e8"}, "originalPosition": 88}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzExMDc4Mjk0OnYy", "diffSide": "RIGHT", "path": "plugins/hypervisors/vmware/src/main/java/com/cloud/hypervisor/vmware/resource/VmwareResource.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yOVQxNzoyMjoxM1rOHZ5Bxw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yOVQxNzoyMjoxM1rOHZ5Bxw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NjkxMDc5MQ==", "bodyText": "code in comment please remove", "url": "https://github.com/apache/cloudstack/pull/4307#discussion_r496910791", "createdAt": "2020-09-29T17:22:13Z", "author": {"login": "DaanHoogland"}, "path": "plugins/hypervisors/vmware/src/main/java/com/cloud/hypervisor/vmware/resource/VmwareResource.java", "diffHunk": "@@ -745,20 +752,38 @@ private Answer execute(ResizeVolumeCommand cmd) {\n             } else if (newSize == oldSize) {\n                 return new ResizeVolumeAnswer(cmd, true, \"success\", newSize * ResourceType.bytesToKiB);\n             }\n+            /*\n+            // FR41 this is yet to fix\n+            ManagedObjectReference morDS1 = HypervisorHostHelper.findDatastoreWithBackwardsCompatibility(hyperHost, cmd.getPoolUuid());\n+            DatastoreMO dsMo1 = new DatastoreMO(hyperHost.getContext(), morDS1);\n+            vmdkDataStorePath = VmwareStorageLayoutHelper.getLegacyDatastorePathFromVmdkFileName(dsMo1, path + VMDK_EXTENSION);\n+            DatastoreFile dsFile1 = new DatastoreFile(vmdkDataStorePath);\n+\n+            s_logger.debug(\"vDiskid does not exist for volume \" + vmdkDataStorePath + \" registering the disk now\");\n+            VirtualStorageObjectManagerMO vStorageObjectManagerMO = new VirtualStorageObjectManagerMO(getServiceContext());\n+            try {\n+                VStorageObject vStorageObject = vStorageObjectManagerMO.registerVirtualDisk(dsFile1, null, dsMo1.getOwnerDatacenter().second());\n+                VStorageObjectConfigInfo diskConfigInfo = vStorageObject.getConfig();\n+                ID vdiskId = diskConfigInfo.getId();\n+            } catch (Throwable e) {\n+                if (e instanceof AlreadyExistsFaultMsg) {\n+\n+                }\n+            }*/", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "0a2823b80cb5cd1838a7e6ec3cd690619c2c17e8"}, "originalPosition": 104}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzExMDgxNjcxOnYy", "diffSide": "RIGHT", "path": "plugins/hypervisors/vmware/src/main/java/com/cloud/storage/resource/VmwareStorageProcessor.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yOVQxNzozMDoyM1rOHZ5W4Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yOVQxNzozMDoyM1rOHZ5W4Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NjkxNjE5Mw==", "bodyText": "long method, can you split it?", "url": "https://github.com/apache/cloudstack/pull/4307#discussion_r496916193", "createdAt": "2020-09-29T17:30:23Z", "author": {"login": "DaanHoogland"}, "path": "plugins/hypervisors/vmware/src/main/java/com/cloud/storage/resource/VmwareStorageProcessor.java", "diffHunk": "@@ -891,6 +886,92 @@ public Answer cloneVolumeFromBaseTemplate(CopyCommand cmd) {\n         }\n     }\n \n+    private String cloneVMwithVMname(VmwareContext context, VmwareHypervisorHost hyperHost, TemplateObjectTO template,\n+                                     VirtualMachineMO vmTemplate, VolumeObjectTO volume, DatacenterMO dcMo, DatastoreMO dsMo) throws Exception {\n+        ManagedObjectReference morDatastore = dsMo.getMor();\n+        ManagedObjectReference morPool = hyperHost.getHyperHostOwnerResourcePool();\n+        ManagedObjectReference morCluster = hyperHost.getHyperHostCluster();\n+        if (template.getSize() != null) {\n+            _fullCloneFlag = volume.getSize() > template.getSize() ? true : _fullCloneFlag;\n+        }\n+        if (!_fullCloneFlag) {\n+            createVMLinkedClone(vmTemplate, dcMo, volume.getVmName(), morDatastore, morPool);\n+        } else {\n+            createVMFullClone(vmTemplate, dcMo, dsMo, volume.getVmName(), morDatastore, morPool);\n+        }\n+\n+        VirtualMachineMO vmMo = new ClusterMO(context, morCluster).findVmOnHyperHost(volume.getVmName());\n+        assert (vmMo != null);\n+\n+        return vmMo.getVmdkFileBaseNames().get(0);\n+    }\n+\n+    private String createVMFolderWithVMName(VmwareContext context, VmwareHypervisorHost hyperHost, TemplateObjectTO template,", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "0a2823b80cb5cd1838a7e6ec3cd690619c2c17e8"}, "originalPosition": 327}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzExMDgyMDk5OnYy", "diffSide": "RIGHT", "path": "plugins/hypervisors/vmware/src/main/java/com/cloud/storage/resource/VmwareStorageProcessor.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yOVQxNzozMToyMlrOHZ5ZcQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yOVQxNzozMToyMlrOHZ5ZcQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NjkxNjg0OQ==", "bodyText": "internal project code in open source version, please remove.", "url": "https://github.com/apache/cloudstack/pull/4307#discussion_r496916849", "createdAt": "2020-09-29T17:31:22Z", "author": {"login": "DaanHoogland"}, "path": "plugins/hypervisors/vmware/src/main/java/com/cloud/storage/resource/VmwareStorageProcessor.java", "diffHunk": "@@ -1124,6 +1203,12 @@ private void postCreatePrivateTemplate(String installFullPath, long templateId,\n                 throw new Exception(msg);\n             }\n \n+            DatacenterMO dcMo = new DatacenterMO(context, hyperHost.getHyperHostDatacenter());\n+            ManagedObjectReference morPool = hyperHost.getHyperHostOwnerResourcePool();\n+            vmMo.createFullCloneWithSpecificDisk(templateUniqueName, dcMo.getVmFolder(), morPool, VmwareHelper.getDiskDeviceDatastore(volumeDeviceInfo.first()), volumeDeviceInfo);\n+            clonedVm = dcMo.findVm(templateUniqueName);\n+\n+            /* FR41 THIS IS OLD way of creating template using snapshot", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "0a2823b80cb5cd1838a7e6ec3cd690619c2c17e8"}, "originalPosition": 454}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzExMDgyMjc2OnYy", "diffSide": "RIGHT", "path": "plugins/hypervisors/vmware/src/main/java/com/cloud/storage/resource/VmwareStorageProcessor.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yOVQxNzozMTo1M1rOHZ5aoA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yOVQxNzozMTo1M1rOHZ5aoA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NjkxNzE1Mg==", "bodyText": "code in comment, please remove.", "url": "https://github.com/apache/cloudstack/pull/4307#discussion_r496917152", "createdAt": "2020-09-29T17:31:53Z", "author": {"login": "DaanHoogland"}, "path": "plugins/hypervisors/vmware/src/main/java/com/cloud/storage/resource/VmwareStorageProcessor.java", "diffHunk": "@@ -1134,7 +1219,7 @@ private void postCreatePrivateTemplate(String installFullPath, long templateId,\n             Pair<VirtualMachineMO, String[]> cloneResult =\n                     vmMo.cloneFromCurrentSnapshot(workerVmName, 0, 4, volumeDeviceInfo.second(), VmwareHelper.getDiskDeviceDatastore(volumeDeviceInfo.first()));\n             clonedVm = cloneResult.first();\n-\n+            * */", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "0a2823b80cb5cd1838a7e6ec3cd690619c2c17e8"}, "originalPosition": 463}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzExMDgyNjkwOnYy", "diffSide": "RIGHT", "path": "plugins/hypervisors/vmware/src/main/java/com/cloud/storage/resource/VmwareStorageProcessor.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yOVQxNzozMzowMlrOHZ5dRQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yOVQxNzozMzowMlrOHZ5dRQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NjkxNzgyOQ==", "bodyText": "is this comment still valid? not by hte looks of the code below.", "url": "https://github.com/apache/cloudstack/pull/4307#discussion_r496917829", "createdAt": "2020-09-29T17:33:02Z", "author": {"login": "DaanHoogland"}, "path": "plugins/hypervisors/vmware/src/main/java/com/cloud/storage/resource/VmwareStorageProcessor.java", "diffHunk": "@@ -1720,13 +1801,19 @@ public Answer createTemplateFromSnapshot(CopyCommand cmd) {\n             String disks[] = vmMo.getCurrentSnapshotDiskChainDatastorePaths(diskDevice);\n             if (clonedWorkerVMNeeded) {\n                 // 4 MB is the minimum requirement for VM memory in VMware", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "0a2823b80cb5cd1838a7e6ec3cd690619c2c17e8"}, "originalPosition": 512}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzExMDg2NjE1OnYy", "diffSide": "RIGHT", "path": "plugins/hypervisors/vmware/src/main/java/org/apache/cloudstack/api/command/admin/zone/ImportVsphereStoragePoliciesCmd.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yOVQxNzo0MzoyNlrOHZ511g==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yOVQxNzo0MzoyNlrOHZ511g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NjkyNDExOA==", "bodyText": "This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters. Learn more about bidirectional Unicode characters\n\n\n  \n\n\n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            @APICommand(name = ImportVsphereStoragePoliciesCmd.APINAME, description = \"Import vSphere storage policies\",\n          \n          \n            \n                    responseObject = VsphereStoragePoliciesResponse.class,\n          \n          \n            \n                    requestHasSensitiveInfo = false, responseHasSensitiveInfo = false,\n          \n          \n            \n                    authorized = {RoleType.Admin})\n          \n          \n            \n            @APICommand(name = ImportVsphereStoragePoliciesCmd.APINAME, description = \"Import vSphere storage policies\",\n          \n          \n            \n                    responseObject = VsphereStoragePoliciesResponse.class,\n          \n          \n            \n                    requestHasSensitiveInfo = false, responseHasSensitiveInfo = false,\n          \n          \n            \n                    since = \"4.15\", authorized = {RoleType.Admin})", "url": "https://github.com/apache/cloudstack/pull/4307#discussion_r496924118", "createdAt": "2020-09-29T17:43:26Z", "author": {"login": "DaanHoogland"}, "path": "plugins/hypervisors/vmware/src/main/java/org/apache/cloudstack/api/command/admin/zone/ImportVsphereStoragePoliciesCmd.java", "diffHunk": "@@ -0,0 +1,111 @@\n+// Licensed to the Apache Software Foundation (ASF) under one\n+// or more contributor license agreements.  See the NOTICE file\n+// distributed with this work for additional information\n+// regarding copyright ownership.  The ASF licenses this file\n+// to you under the Apache License, Version 2.0 (the\n+// \"License\"); you may not use this file except in compliance\n+// with the License.  You may obtain a copy of the License at\n+//\n+//   http://www.apache.org/licenses/LICENSE-2.0\n+//\n+// Unless required by applicable law or agreed to in writing,\n+// software distributed under the License is distributed on an\n+// \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n+// KIND, either express or implied.  See the License for the\n+// specific language governing permissions and limitations\n+// under the License.\n+\n+package org.apache.cloudstack.api.command.admin.zone;\n+\n+import com.cloud.dc.DataCenter;\n+import com.cloud.dc.VsphereStoragePolicy;\n+import com.cloud.exception.ConcurrentOperationException;\n+import com.cloud.exception.InsufficientCapacityException;\n+import com.cloud.exception.NetworkRuleConflictException;\n+import com.cloud.exception.ResourceAllocationException;\n+import com.cloud.exception.ResourceUnavailableException;\n+import com.cloud.hypervisor.vmware.VmwareDatacenterService;\n+\n+import org.apache.cloudstack.acl.RoleType;\n+import org.apache.cloudstack.api.APICommand;\n+import org.apache.cloudstack.api.ApiConstants;\n+import org.apache.cloudstack.api.ApiErrorCode;\n+import org.apache.cloudstack.api.BaseCmd;\n+import org.apache.cloudstack.api.Parameter;\n+import org.apache.cloudstack.api.ServerApiException;\n+import org.apache.cloudstack.api.response.VsphereStoragePoliciesResponse;\n+import org.apache.cloudstack.api.response.ListResponse;\n+import org.apache.cloudstack.api.response.ZoneResponse;\n+import org.apache.cloudstack.context.CallContext;\n+import org.apache.log4j.Logger;\n+\n+import javax.inject.Inject;\n+import java.util.ArrayList;\n+import java.util.List;\n+\n+@APICommand(name = ImportVsphereStoragePoliciesCmd.APINAME, description = \"Import vSphere storage policies\",\n+        responseObject = VsphereStoragePoliciesResponse.class,\n+        requestHasSensitiveInfo = false, responseHasSensitiveInfo = false,\n+        authorized = {RoleType.Admin})", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "0a2823b80cb5cd1838a7e6ec3cd690619c2c17e8"}, "originalPosition": 49}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzExMDg3Mjg3OnYy", "diffSide": "RIGHT", "path": "plugins/hypervisors/vmware/src/main/java/org/apache/cloudstack/api/command/admin/zone/ListVsphereStoragePoliciesCmd.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yOVQxNzo0NTowNlrOHZ558Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yOVQxNzo0NTowNlrOHZ558Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NjkyNTE2OQ==", "bodyText": "This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters. Learn more about bidirectional Unicode characters\n\n\n  \n\n\n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            @APICommand(name = ListVsphereStoragePoliciesCmd.APINAME, description = \"List vSphere storage policies\",\n          \n          \n            \n                    responseObject = VsphereStoragePoliciesResponse.class,\n          \n          \n            \n                    requestHasSensitiveInfo = false, responseHasSensitiveInfo = false,\n          \n          \n            \n                    authorized = {RoleType.Admin})\n          \n          \n            \n            public class ListVsphereStoragePoliciesCmd extends BaseCmd {\n          \n          \n            \n            @APICommand(name = ListVsphereStoragePoliciesCmd.APINAME, description = \"List vSphere storage policies\",\n          \n          \n            \n                    responseObject = VsphereStoragePoliciesResponse.class,\n          \n          \n            \n                    requestHasSensitiveInfo = false, responseHasSensitiveInfo = false,\n          \n          \n            \n                    since = \"4.15\", authorized = {RoleType.Admin})\n          \n          \n            \n            public class ListVsphereStoragePoliciesCmd extends BaseCmd {", "url": "https://github.com/apache/cloudstack/pull/4307#discussion_r496925169", "createdAt": "2020-09-29T17:45:06Z", "author": {"login": "DaanHoogland"}, "path": "plugins/hypervisors/vmware/src/main/java/org/apache/cloudstack/api/command/admin/zone/ListVsphereStoragePoliciesCmd.java", "diffHunk": "@@ -0,0 +1,109 @@\n+// Licensed to the Apache Software Foundation (ASF) under one\n+// or more contributor license agreements.  See the NOTICE file\n+// distributed with this work for additional information\n+// regarding copyright ownership.  The ASF licenses this file\n+// to you under the Apache License, Version 2.0 (the\n+// \"License\"); you may not use this file except in compliance\n+// with the License.  You may obtain a copy of the License at\n+//\n+//   http://www.apache.org/licenses/LICENSE-2.0\n+//\n+// Unless required by applicable law or agreed to in writing,\n+// software distributed under the License is distributed on an\n+// \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n+// KIND, either express or implied.  See the License for the\n+// specific language governing permissions and limitations\n+// under the License.\n+\n+package org.apache.cloudstack.api.command.admin.zone;\n+\n+import com.cloud.dc.DataCenter;\n+import com.cloud.dc.VsphereStoragePolicy;\n+import com.cloud.exception.ConcurrentOperationException;\n+import com.cloud.exception.InsufficientCapacityException;\n+import com.cloud.exception.NetworkRuleConflictException;\n+import com.cloud.exception.ResourceAllocationException;\n+import com.cloud.exception.ResourceUnavailableException;\n+import com.cloud.hypervisor.vmware.VmwareDatacenterService;\n+import org.apache.cloudstack.acl.RoleType;\n+import org.apache.cloudstack.api.APICommand;\n+import org.apache.cloudstack.api.ApiConstants;\n+import org.apache.cloudstack.api.ApiErrorCode;\n+import org.apache.cloudstack.api.BaseCmd;\n+import org.apache.cloudstack.api.Parameter;\n+import org.apache.cloudstack.api.ServerApiException;\n+import org.apache.cloudstack.api.response.ListResponse;\n+import org.apache.cloudstack.api.response.VsphereStoragePoliciesResponse;\n+import org.apache.cloudstack.api.response.ZoneResponse;\n+import org.apache.cloudstack.context.CallContext;\n+import org.apache.log4j.Logger;\n+\n+import javax.inject.Inject;\n+import java.util.ArrayList;\n+import java.util.List;\n+\n+@APICommand(name = ListVsphereStoragePoliciesCmd.APINAME, description = \"List vSphere storage policies\",\n+        responseObject = VsphereStoragePoliciesResponse.class,\n+        requestHasSensitiveInfo = false, responseHasSensitiveInfo = false,\n+        authorized = {RoleType.Admin})\n+public class ListVsphereStoragePoliciesCmd extends BaseCmd {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "0a2823b80cb5cd1838a7e6ec3cd690619c2c17e8"}, "originalPosition": 49}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzExMTA2OTU3OnYy", "diffSide": "RIGHT", "path": "utils/src/test/java/com/cloud/utils/compression/CompressionUtilTest.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yOVQxODozODozNFrOHZ70fg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yOVQxODozODozNFrOHZ70fg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5Njk1NjU0Mg==", "bodyText": "new classes should go in org.apache.cloudstack", "url": "https://github.com/apache/cloudstack/pull/4307#discussion_r496956542", "createdAt": "2020-09-29T18:38:34Z", "author": {"login": "DaanHoogland"}, "path": "utils/src/test/java/com/cloud/utils/compression/CompressionUtilTest.java", "diffHunk": "@@ -0,0 +1,128 @@\n+//\n+// Licensed to the Apache Software Foundation (ASF) under one\n+// or more contributor license agreements.  See the NOTICE file\n+// distributed with this work for additional information\n+// regarding copyright ownership.  The ASF licenses this file\n+// to you under the Apache License, Version 2.0 (the\n+// \"License\"); you may not use this file except in compliance\n+// with the License.  You may obtain a copy of the License at\n+//\n+//   http://www.apache.org/licenses/LICENSE-2.0\n+//\n+// Unless required by applicable law or agreed to in writing,\n+// software distributed under the License is distributed on an\n+// \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n+// KIND, either express or implied.  See the License for the\n+// specific language governing permissions and limitations\n+// under the License.\n+//\n+package com.cloud.utils.compression;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "0a2823b80cb5cd1838a7e6ec3cd690619c2c17e8"}, "originalPosition": 19}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzExMTA3NTU4OnYy", "diffSide": "RIGHT", "path": "utils/src/main/java/com/cloud/utils/compression/CompressionUtil.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yOVQxODo0MDoxMVrOHZ74Hw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yOVQxODo0MDoxMVrOHZ74Hw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5Njk1NzQ3MQ==", "bodyText": "new classes should go in org.apache.cloudstack", "url": "https://github.com/apache/cloudstack/pull/4307#discussion_r496957471", "createdAt": "2020-09-29T18:40:11Z", "author": {"login": "DaanHoogland"}, "path": "utils/src/main/java/com/cloud/utils/compression/CompressionUtil.java", "diffHunk": "@@ -0,0 +1,58 @@\n+//\n+// Licensed to the Apache Software Foundation (ASF) under one\n+// or more contributor license agreements.  See the NOTICE file\n+// distributed with this work for additional information\n+// regarding copyright ownership.  The ASF licenses this file\n+// to you under the Apache License, Version 2.0 (the\n+// \"License\"); you may not use this file except in compliance\n+// with the License.  You may obtain a copy of the License at\n+//\n+//   http://www.apache.org/licenses/LICENSE-2.0\n+//\n+// Unless required by applicable law or agreed to in writing,\n+// software distributed under the License is distributed on an\n+// \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n+// KIND, either express or implied.  See the License for the\n+// specific language governing permissions and limitations\n+// under the License.\n+//\n+package com.cloud.utils.compression;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "0a2823b80cb5cd1838a7e6ec3cd690619c2c17e8"}, "originalPosition": 19}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzExMTEzOTE5OnYy", "diffSide": "RIGHT", "path": "server/src/main/java/com/cloud/storage/StorageManagerImpl.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yOVQxODo1ODowNVrOHZ8fuQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yOVQxODo1ODowNVrOHZ8fuQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5Njk2NzYwOQ==", "bodyText": "separate method", "url": "https://github.com/apache/cloudstack/pull/4307#discussion_r496967609", "createdAt": "2020-09-29T18:58:05Z", "author": {"login": "DaanHoogland"}, "path": "server/src/main/java/com/cloud/storage/StorageManagerImpl.java", "diffHunk": "@@ -1498,6 +1610,16 @@ public PrimaryDataStoreInfo cancelPrimaryStorageForMaintenance(CancelPrimaryStor\n         DataStoreProvider provider = _dataStoreProviderMgr.getDataStoreProvider(primaryStorage.getStorageProviderName());\n         DataStoreLifeCycle lifeCycle = provider.getDataStoreLifeCycle();\n         DataStore store = _dataStoreMgr.getDataStore(primaryStorage.getId(), DataStoreRole.Primary);\n+        if (primaryStorage.getPoolType() == StoragePoolType.DatastoreCluster) {\n+            primaryStorage.setStatus(StoragePoolStatus.Up);\n+            _storagePoolDao.update(primaryStorage.getId(), primaryStorage);\n+            //FR41 need to handle when one of the primary stores is unable to cancel the maintenance mode\n+            List<StoragePoolVO> childDatastores = _storagePoolDao.listChildStoragePoolsInDatastoreCluster(primaryStorageId);\n+            for (StoragePoolVO childDatastore : childDatastores) {\n+                DataStore childStore = _dataStoreMgr.getDataStore(childDatastore.getId(), DataStoreRole.Primary);\n+                lifeCycle.cancelMaintain(childStore);\n+            }\n+        }", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "0a2823b80cb5cd1838a7e6ec3cd690619c2c17e8"}, "originalPosition": 217}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzE4ODY1MzA4OnYy", "diffSide": "RIGHT", "path": "test/integration/smoke/test_storage_policy.py", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yMVQwNjozOTozOFrOHlcW0w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yMVQwNjozOTozOFrOHlcW0w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwOTAyMzk1NQ==", "bodyText": "this will not be cleaned, needs to be something like below\n\n  \n    \n  \n    \n\n  \n  This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters. Learn more about bidirectional Unicode characters\n\n\n  \n\n\n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                    cls.cleanup = [cls.network_offering]\n          \n          \n            \n                    cls._cleanup.append(cls.network_offering)", "url": "https://github.com/apache/cloudstack/pull/4307#discussion_r509023955", "createdAt": "2020-10-21T06:39:38Z", "author": {"login": "DaanHoogland"}, "path": "test/integration/smoke/test_storage_policy.py", "diffHunk": "@@ -0,0 +1,263 @@\n+# Licensed to the Apache Software Foundation (ASF) under one\n+# or more contributor license agreements.  See the NOTICE file\n+# distributed with this work for additional information\n+# regarding copyright ownership.  The ASF licenses this file\n+# to you under the Apache License, Version 2.0 (the\n+# \"License\"); you may not use this file except in compliance\n+# with the License.  You may obtain a copy of the License at\n+#\n+#   http://www.apache.org/licenses/LICENSE-2.0\n+#\n+# Unless required by applicable law or agreed to in writing,\n+# software distributed under the License is distributed on an\n+# \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n+# KIND, either express or implied.  See the License for the\n+# specific language governing permissions and limitations\n+# under the License.\n+\n+\"\"\" Test for VMWare storage policies\n+\"\"\"\n+# Import Local Modules\n+from nose.plugins.attrib import attr\n+from marvin.cloudstackTestCase import cloudstackTestCase\n+from marvin.lib.utils import cleanup_resources\n+from marvin.lib.base import (Account,\n+                             VirtualMachine,\n+                             ServiceOffering,\n+                             NetworkOffering,\n+                             Network,\n+                             Volume,\n+                             DiskOffering)\n+from marvin.lib.common import (get_zone,\n+                               get_domain,\n+                               get_test_template)\n+from marvin.codes import PASS\n+from marvin.cloudstackAPI import (importVsphereStoragePolicies)\n+from marvin.cloudstackAPI import (listVsphereStoragePolicies)\n+\n+\n+class TestVMWareStoragePolicies(cloudstackTestCase):\n+\n+    @classmethod\n+    def setUpClass(cls):\n+\n+        cls.testClient = super(TestVMWareStoragePolicies, cls).getClsTestClient()\n+        cls.apiclient = cls.testClient.getApiClient()\n+\n+        cls.testdata = cls.testClient.getParsedTestDataConfig()\n+        # Get Zone, Domain and templates\n+        cls.domain = get_domain(cls.apiclient)\n+        cls.zone = get_zone(cls.apiclient, cls.testClient.getZoneForTests())\n+        cls._cleanup = []\n+        cls.hypervisor = cls.testClient.getHypervisorInfo()\n+        cls.network_offering = NetworkOffering.create(\n+            cls.apiclient,\n+            cls.testdata[\"l2-network_offering\"],\n+        )\n+        cls.network_offering.update(cls.apiclient, state='Enabled')\n+        cls.template = get_test_template(\n+            cls.apiclient,\n+            cls.zone.id,\n+            cls.hypervisor,\n+        )\n+        cls.cleanup = [cls.network_offering]", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ce236e94ea71f3f0795fd0a2b8de8ba9000cb435"}, "originalPosition": 63}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzE4ODY1Njg3OnYy", "diffSide": "RIGHT", "path": "test/integration/smoke/test_storage_policy.py", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yMVQwNjo0MDozN1rOHlcY8g==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yMVQwNjo0MDozN1rOHlcY8g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwOTAyNDQ5OA==", "bodyText": "This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters. Learn more about bidirectional Unicode characters\n\n\n  \n\n\n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                        cleanup_resources(cls.apiclient, cls.cleanup)\n          \n          \n            \n                        cleanup_resources(cls.apiclient, reverved(cls._cleanup))", "url": "https://github.com/apache/cloudstack/pull/4307#discussion_r509024498", "createdAt": "2020-10-21T06:40:37Z", "author": {"login": "DaanHoogland"}, "path": "test/integration/smoke/test_storage_policy.py", "diffHunk": "@@ -0,0 +1,263 @@\n+# Licensed to the Apache Software Foundation (ASF) under one\n+# or more contributor license agreements.  See the NOTICE file\n+# distributed with this work for additional information\n+# regarding copyright ownership.  The ASF licenses this file\n+# to you under the Apache License, Version 2.0 (the\n+# \"License\"); you may not use this file except in compliance\n+# with the License.  You may obtain a copy of the License at\n+#\n+#   http://www.apache.org/licenses/LICENSE-2.0\n+#\n+# Unless required by applicable law or agreed to in writing,\n+# software distributed under the License is distributed on an\n+# \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n+# KIND, either express or implied.  See the License for the\n+# specific language governing permissions and limitations\n+# under the License.\n+\n+\"\"\" Test for VMWare storage policies\n+\"\"\"\n+# Import Local Modules\n+from nose.plugins.attrib import attr\n+from marvin.cloudstackTestCase import cloudstackTestCase\n+from marvin.lib.utils import cleanup_resources\n+from marvin.lib.base import (Account,\n+                             VirtualMachine,\n+                             ServiceOffering,\n+                             NetworkOffering,\n+                             Network,\n+                             Volume,\n+                             DiskOffering)\n+from marvin.lib.common import (get_zone,\n+                               get_domain,\n+                               get_test_template)\n+from marvin.codes import PASS\n+from marvin.cloudstackAPI import (importVsphereStoragePolicies)\n+from marvin.cloudstackAPI import (listVsphereStoragePolicies)\n+\n+\n+class TestVMWareStoragePolicies(cloudstackTestCase):\n+\n+    @classmethod\n+    def setUpClass(cls):\n+\n+        cls.testClient = super(TestVMWareStoragePolicies, cls).getClsTestClient()\n+        cls.apiclient = cls.testClient.getApiClient()\n+\n+        cls.testdata = cls.testClient.getParsedTestDataConfig()\n+        # Get Zone, Domain and templates\n+        cls.domain = get_domain(cls.apiclient)\n+        cls.zone = get_zone(cls.apiclient, cls.testClient.getZoneForTests())\n+        cls._cleanup = []\n+        cls.hypervisor = cls.testClient.getHypervisorInfo()\n+        cls.network_offering = NetworkOffering.create(\n+            cls.apiclient,\n+            cls.testdata[\"l2-network_offering\"],\n+        )\n+        cls.network_offering.update(cls.apiclient, state='Enabled')\n+        cls.template = get_test_template(\n+            cls.apiclient,\n+            cls.zone.id,\n+            cls.hypervisor,\n+        )\n+        cls.cleanup = [cls.network_offering]\n+        return\n+\n+    @classmethod\n+    def tearDownClass(cls):\n+        try:\n+            cleanup_resources(cls.apiclient, cls.cleanup)", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ce236e94ea71f3f0795fd0a2b8de8ba9000cb435"}, "originalPosition": 69}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzE4ODY2MDA3OnYy", "diffSide": "RIGHT", "path": "test/integration/smoke/test_storage_policy.py", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yMVQwNjo0MTozNlrOHlca2Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yMVQwNjo0MTozNlrOHlca2Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwOTAyNDk4NQ==", "bodyText": "would be a good habbit to use\n\n  \n    \n  \n    \n\n  \n  This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters. Learn more about bidirectional Unicode characters\n\n\n  \n\n\n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                    self.cleanup = [self.account]\n          \n          \n            \n                    self.cleanup = []\n          \n          \n            \n                    self.cleanup.append(self.account)", "url": "https://github.com/apache/cloudstack/pull/4307#discussion_r509024985", "createdAt": "2020-10-21T06:41:36Z", "author": {"login": "DaanHoogland"}, "path": "test/integration/smoke/test_storage_policy.py", "diffHunk": "@@ -0,0 +1,263 @@\n+# Licensed to the Apache Software Foundation (ASF) under one\n+# or more contributor license agreements.  See the NOTICE file\n+# distributed with this work for additional information\n+# regarding copyright ownership.  The ASF licenses this file\n+# to you under the Apache License, Version 2.0 (the\n+# \"License\"); you may not use this file except in compliance\n+# with the License.  You may obtain a copy of the License at\n+#\n+#   http://www.apache.org/licenses/LICENSE-2.0\n+#\n+# Unless required by applicable law or agreed to in writing,\n+# software distributed under the License is distributed on an\n+# \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n+# KIND, either express or implied.  See the License for the\n+# specific language governing permissions and limitations\n+# under the License.\n+\n+\"\"\" Test for VMWare storage policies\n+\"\"\"\n+# Import Local Modules\n+from nose.plugins.attrib import attr\n+from marvin.cloudstackTestCase import cloudstackTestCase\n+from marvin.lib.utils import cleanup_resources\n+from marvin.lib.base import (Account,\n+                             VirtualMachine,\n+                             ServiceOffering,\n+                             NetworkOffering,\n+                             Network,\n+                             Volume,\n+                             DiskOffering)\n+from marvin.lib.common import (get_zone,\n+                               get_domain,\n+                               get_test_template)\n+from marvin.codes import PASS\n+from marvin.cloudstackAPI import (importVsphereStoragePolicies)\n+from marvin.cloudstackAPI import (listVsphereStoragePolicies)\n+\n+\n+class TestVMWareStoragePolicies(cloudstackTestCase):\n+\n+    @classmethod\n+    def setUpClass(cls):\n+\n+        cls.testClient = super(TestVMWareStoragePolicies, cls).getClsTestClient()\n+        cls.apiclient = cls.testClient.getApiClient()\n+\n+        cls.testdata = cls.testClient.getParsedTestDataConfig()\n+        # Get Zone, Domain and templates\n+        cls.domain = get_domain(cls.apiclient)\n+        cls.zone = get_zone(cls.apiclient, cls.testClient.getZoneForTests())\n+        cls._cleanup = []\n+        cls.hypervisor = cls.testClient.getHypervisorInfo()\n+        cls.network_offering = NetworkOffering.create(\n+            cls.apiclient,\n+            cls.testdata[\"l2-network_offering\"],\n+        )\n+        cls.network_offering.update(cls.apiclient, state='Enabled')\n+        cls.template = get_test_template(\n+            cls.apiclient,\n+            cls.zone.id,\n+            cls.hypervisor,\n+        )\n+        cls.cleanup = [cls.network_offering]\n+        return\n+\n+    @classmethod\n+    def tearDownClass(cls):\n+        try:\n+            cleanup_resources(cls.apiclient, cls.cleanup)\n+        except Exception as e:\n+            raise Exception(\"Warning: Exception during cleanup : %s\" % e)\n+\n+    def setUp(self):\n+\n+        self.dbclient = self.testClient.getDbConnection()\n+        self.hypervisor = self.testClient.getHypervisorInfo()\n+        self.testdata[\"virtual_machine\"][\"zoneid\"] = self.zone.id\n+        self.testdata[\"virtual_machine\"][\"template\"] = self.template.id\n+        self.account = Account.create(\n+            self.apiclient,\n+            self.testdata[\"account\"],\n+            domainid=self.domain.id\n+        )\n+        self.cleanup = [self.account]", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ce236e94ea71f3f0795fd0a2b8de8ba9000cb435"}, "originalPosition": 84}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzE4ODY2MzIzOnYy", "diffSide": "RIGHT", "path": "test/integration/smoke/test_storage_policy.py", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yMVQwNjo0MjozM1rOHlccsA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yMVQwNjo0MjozM1rOHlccsA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwOTAyNTQ1Ng==", "bodyText": "also a good habit;\n\n  \n    \n  \n    \n\n  \n  This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters. Learn more about bidirectional Unicode characters\n\n\n  \n\n\n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                        cleanup_resources(self.apiclient, self.cleanup)\n          \n          \n            \n                        cleanup_resources(self.apiclient, reversed(self.cleanup))", "url": "https://github.com/apache/cloudstack/pull/4307#discussion_r509025456", "createdAt": "2020-10-21T06:42:33Z", "author": {"login": "DaanHoogland"}, "path": "test/integration/smoke/test_storage_policy.py", "diffHunk": "@@ -0,0 +1,263 @@\n+# Licensed to the Apache Software Foundation (ASF) under one\n+# or more contributor license agreements.  See the NOTICE file\n+# distributed with this work for additional information\n+# regarding copyright ownership.  The ASF licenses this file\n+# to you under the Apache License, Version 2.0 (the\n+# \"License\"); you may not use this file except in compliance\n+# with the License.  You may obtain a copy of the License at\n+#\n+#   http://www.apache.org/licenses/LICENSE-2.0\n+#\n+# Unless required by applicable law or agreed to in writing,\n+# software distributed under the License is distributed on an\n+# \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n+# KIND, either express or implied.  See the License for the\n+# specific language governing permissions and limitations\n+# under the License.\n+\n+\"\"\" Test for VMWare storage policies\n+\"\"\"\n+# Import Local Modules\n+from nose.plugins.attrib import attr\n+from marvin.cloudstackTestCase import cloudstackTestCase\n+from marvin.lib.utils import cleanup_resources\n+from marvin.lib.base import (Account,\n+                             VirtualMachine,\n+                             ServiceOffering,\n+                             NetworkOffering,\n+                             Network,\n+                             Volume,\n+                             DiskOffering)\n+from marvin.lib.common import (get_zone,\n+                               get_domain,\n+                               get_test_template)\n+from marvin.codes import PASS\n+from marvin.cloudstackAPI import (importVsphereStoragePolicies)\n+from marvin.cloudstackAPI import (listVsphereStoragePolicies)\n+\n+\n+class TestVMWareStoragePolicies(cloudstackTestCase):\n+\n+    @classmethod\n+    def setUpClass(cls):\n+\n+        cls.testClient = super(TestVMWareStoragePolicies, cls).getClsTestClient()\n+        cls.apiclient = cls.testClient.getApiClient()\n+\n+        cls.testdata = cls.testClient.getParsedTestDataConfig()\n+        # Get Zone, Domain and templates\n+        cls.domain = get_domain(cls.apiclient)\n+        cls.zone = get_zone(cls.apiclient, cls.testClient.getZoneForTests())\n+        cls._cleanup = []\n+        cls.hypervisor = cls.testClient.getHypervisorInfo()\n+        cls.network_offering = NetworkOffering.create(\n+            cls.apiclient,\n+            cls.testdata[\"l2-network_offering\"],\n+        )\n+        cls.network_offering.update(cls.apiclient, state='Enabled')\n+        cls.template = get_test_template(\n+            cls.apiclient,\n+            cls.zone.id,\n+            cls.hypervisor,\n+        )\n+        cls.cleanup = [cls.network_offering]\n+        return\n+\n+    @classmethod\n+    def tearDownClass(cls):\n+        try:\n+            cleanup_resources(cls.apiclient, cls.cleanup)\n+        except Exception as e:\n+            raise Exception(\"Warning: Exception during cleanup : %s\" % e)\n+\n+    def setUp(self):\n+\n+        self.dbclient = self.testClient.getDbConnection()\n+        self.hypervisor = self.testClient.getHypervisorInfo()\n+        self.testdata[\"virtual_machine\"][\"zoneid\"] = self.zone.id\n+        self.testdata[\"virtual_machine\"][\"template\"] = self.template.id\n+        self.account = Account.create(\n+            self.apiclient,\n+            self.testdata[\"account\"],\n+            domainid=self.domain.id\n+        )\n+        self.cleanup = [self.account]\n+        return\n+\n+    def tearDown(self):\n+        try:\n+            self.debug(\"Cleaning up the resources\")\n+            cleanup_resources(self.apiclient, self.cleanup)", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ce236e94ea71f3f0795fd0a2b8de8ba9000cb435"}, "originalPosition": 90}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzE4ODY2NTUzOnYy", "diffSide": "RIGHT", "path": "test/integration/smoke/test_storage_policy.py", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yMVQwNjo0MzoyMlrOHlceIg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yMVQwNjo0MzoyMlrOHlceIg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwOTAyNTgyNg==", "bodyText": "This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters. Learn more about bidirectional Unicode characters\n\n\n  \n\n\n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                    cmd = create\n          \n          \n            \n                    cmd = create", "url": "https://github.com/apache/cloudstack/pull/4307#discussion_r509025826", "createdAt": "2020-10-21T06:43:22Z", "author": {"login": "DaanHoogland"}, "path": "test/integration/smoke/test_storage_policy.py", "diffHunk": "@@ -0,0 +1,263 @@\n+# Licensed to the Apache Software Foundation (ASF) under one\n+# or more contributor license agreements.  See the NOTICE file\n+# distributed with this work for additional information\n+# regarding copyright ownership.  The ASF licenses this file\n+# to you under the Apache License, Version 2.0 (the\n+# \"License\"); you may not use this file except in compliance\n+# with the License.  You may obtain a copy of the License at\n+#\n+#   http://www.apache.org/licenses/LICENSE-2.0\n+#\n+# Unless required by applicable law or agreed to in writing,\n+# software distributed under the License is distributed on an\n+# \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n+# KIND, either express or implied.  See the License for the\n+# specific language governing permissions and limitations\n+# under the License.\n+\n+\"\"\" Test for VMWare storage policies\n+\"\"\"\n+# Import Local Modules\n+from nose.plugins.attrib import attr\n+from marvin.cloudstackTestCase import cloudstackTestCase\n+from marvin.lib.utils import cleanup_resources\n+from marvin.lib.base import (Account,\n+                             VirtualMachine,\n+                             ServiceOffering,\n+                             NetworkOffering,\n+                             Network,\n+                             Volume,\n+                             DiskOffering)\n+from marvin.lib.common import (get_zone,\n+                               get_domain,\n+                               get_test_template)\n+from marvin.codes import PASS\n+from marvin.cloudstackAPI import (importVsphereStoragePolicies)\n+from marvin.cloudstackAPI import (listVsphereStoragePolicies)\n+\n+\n+class TestVMWareStoragePolicies(cloudstackTestCase):\n+\n+    @classmethod\n+    def setUpClass(cls):\n+\n+        cls.testClient = super(TestVMWareStoragePolicies, cls).getClsTestClient()\n+        cls.apiclient = cls.testClient.getApiClient()\n+\n+        cls.testdata = cls.testClient.getParsedTestDataConfig()\n+        # Get Zone, Domain and templates\n+        cls.domain = get_domain(cls.apiclient)\n+        cls.zone = get_zone(cls.apiclient, cls.testClient.getZoneForTests())\n+        cls._cleanup = []\n+        cls.hypervisor = cls.testClient.getHypervisorInfo()\n+        cls.network_offering = NetworkOffering.create(\n+            cls.apiclient,\n+            cls.testdata[\"l2-network_offering\"],\n+        )\n+        cls.network_offering.update(cls.apiclient, state='Enabled')\n+        cls.template = get_test_template(\n+            cls.apiclient,\n+            cls.zone.id,\n+            cls.hypervisor,\n+        )\n+        cls.cleanup = [cls.network_offering]\n+        return\n+\n+    @classmethod\n+    def tearDownClass(cls):\n+        try:\n+            cleanup_resources(cls.apiclient, cls.cleanup)\n+        except Exception as e:\n+            raise Exception(\"Warning: Exception during cleanup : %s\" % e)\n+\n+    def setUp(self):\n+\n+        self.dbclient = self.testClient.getDbConnection()\n+        self.hypervisor = self.testClient.getHypervisorInfo()\n+        self.testdata[\"virtual_machine\"][\"zoneid\"] = self.zone.id\n+        self.testdata[\"virtual_machine\"][\"template\"] = self.template.id\n+        self.account = Account.create(\n+            self.apiclient,\n+            self.testdata[\"account\"],\n+            domainid=self.domain.id\n+        )\n+        self.cleanup = [self.account]\n+        return\n+\n+    def tearDown(self):\n+        try:\n+            self.debug(\"Cleaning up the resources\")\n+            cleanup_resources(self.apiclient, self.cleanup)\n+            self.debug(\"Cleanup complete!\")\n+        except Exception as e:\n+            self.debug(\"Warning! Exception in tearDown: %s\" % e)\n+\n+    def import_vmware_storage_policies(self, apiclient):\n+        cmd = importVsphereStoragePolicies.importVsphereStoragePoliciesCmd()\n+        cmd.zoneid = self.zone.id\n+        return apiclient.importVsphereStoragePolicies(cmd)\n+\n+    def list_storage_policies(self, apiclient):\n+        cmd = listVsphereStoragePolicies.listVsphereStoragePoliciesCmd()\n+        cmd.zoneid = self.zone.id\n+        return apiclient.listVsphereStoragePolicies(cmd)\n+\n+    def create_volume(self, apiclient):\n+        cmd = create", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ce236e94ea71f3f0795fd0a2b8de8ba9000cb435"}, "originalPosition": 106}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzE4ODY2Njk2OnYy", "diffSide": "RIGHT", "path": "test/integration/smoke/test_storage_policy.py", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yMVQwNjo0Mzo1OFrOHlcfEA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yMVQwNjo0Mzo1OFrOHlcfEA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwOTAyNjA2NA==", "bodyText": "isn't a tag for vmware in order?", "url": "https://github.com/apache/cloudstack/pull/4307#discussion_r509026064", "createdAt": "2020-10-21T06:43:58Z", "author": {"login": "DaanHoogland"}, "path": "test/integration/smoke/test_storage_policy.py", "diffHunk": "@@ -0,0 +1,263 @@\n+# Licensed to the Apache Software Foundation (ASF) under one\n+# or more contributor license agreements.  See the NOTICE file\n+# distributed with this work for additional information\n+# regarding copyright ownership.  The ASF licenses this file\n+# to you under the Apache License, Version 2.0 (the\n+# \"License\"); you may not use this file except in compliance\n+# with the License.  You may obtain a copy of the License at\n+#\n+#   http://www.apache.org/licenses/LICENSE-2.0\n+#\n+# Unless required by applicable law or agreed to in writing,\n+# software distributed under the License is distributed on an\n+# \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n+# KIND, either express or implied.  See the License for the\n+# specific language governing permissions and limitations\n+# under the License.\n+\n+\"\"\" Test for VMWare storage policies\n+\"\"\"\n+# Import Local Modules\n+from nose.plugins.attrib import attr\n+from marvin.cloudstackTestCase import cloudstackTestCase\n+from marvin.lib.utils import cleanup_resources\n+from marvin.lib.base import (Account,\n+                             VirtualMachine,\n+                             ServiceOffering,\n+                             NetworkOffering,\n+                             Network,\n+                             Volume,\n+                             DiskOffering)\n+from marvin.lib.common import (get_zone,\n+                               get_domain,\n+                               get_test_template)\n+from marvin.codes import PASS\n+from marvin.cloudstackAPI import (importVsphereStoragePolicies)\n+from marvin.cloudstackAPI import (listVsphereStoragePolicies)\n+\n+\n+class TestVMWareStoragePolicies(cloudstackTestCase):\n+\n+    @classmethod\n+    def setUpClass(cls):\n+\n+        cls.testClient = super(TestVMWareStoragePolicies, cls).getClsTestClient()\n+        cls.apiclient = cls.testClient.getApiClient()\n+\n+        cls.testdata = cls.testClient.getParsedTestDataConfig()\n+        # Get Zone, Domain and templates\n+        cls.domain = get_domain(cls.apiclient)\n+        cls.zone = get_zone(cls.apiclient, cls.testClient.getZoneForTests())\n+        cls._cleanup = []\n+        cls.hypervisor = cls.testClient.getHypervisorInfo()\n+        cls.network_offering = NetworkOffering.create(\n+            cls.apiclient,\n+            cls.testdata[\"l2-network_offering\"],\n+        )\n+        cls.network_offering.update(cls.apiclient, state='Enabled')\n+        cls.template = get_test_template(\n+            cls.apiclient,\n+            cls.zone.id,\n+            cls.hypervisor,\n+        )\n+        cls.cleanup = [cls.network_offering]\n+        return\n+\n+    @classmethod\n+    def tearDownClass(cls):\n+        try:\n+            cleanup_resources(cls.apiclient, cls.cleanup)\n+        except Exception as e:\n+            raise Exception(\"Warning: Exception during cleanup : %s\" % e)\n+\n+    def setUp(self):\n+\n+        self.dbclient = self.testClient.getDbConnection()\n+        self.hypervisor = self.testClient.getHypervisorInfo()\n+        self.testdata[\"virtual_machine\"][\"zoneid\"] = self.zone.id\n+        self.testdata[\"virtual_machine\"][\"template\"] = self.template.id\n+        self.account = Account.create(\n+            self.apiclient,\n+            self.testdata[\"account\"],\n+            domainid=self.domain.id\n+        )\n+        self.cleanup = [self.account]\n+        return\n+\n+    def tearDown(self):\n+        try:\n+            self.debug(\"Cleaning up the resources\")\n+            cleanup_resources(self.apiclient, self.cleanup)\n+            self.debug(\"Cleanup complete!\")\n+        except Exception as e:\n+            self.debug(\"Warning! Exception in tearDown: %s\" % e)\n+\n+    def import_vmware_storage_policies(self, apiclient):\n+        cmd = importVsphereStoragePolicies.importVsphereStoragePoliciesCmd()\n+        cmd.zoneid = self.zone.id\n+        return apiclient.importVsphereStoragePolicies(cmd)\n+\n+    def list_storage_policies(self, apiclient):\n+        cmd = listVsphereStoragePolicies.listVsphereStoragePoliciesCmd()\n+        cmd.zoneid = self.zone.id\n+        return apiclient.listVsphereStoragePolicies(cmd)\n+\n+    def create_volume(self, apiclient):\n+        cmd = create\n+    @attr(\n+        tags=[", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ce236e94ea71f3f0795fd0a2b8de8ba9000cb435"}, "originalPosition": 108}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzE4ODY3MzIxOnYy", "diffSide": "RIGHT", "path": "test/integration/smoke/test_storage_policy.py", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yMVQwNjo0NTo1OVrOHlcisA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yMVQwNjo0NTo1OVrOHlcisA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwOTAyNjk5Mg==", "bodyText": "sensible comments, but I would like to see this be partitioned into methods of which the names reflect these comments. this method is long and thus rather hard to understand. also it is hard to check if it does what it says on the tin, certainly after a few rounds of maintenance.", "url": "https://github.com/apache/cloudstack/pull/4307#discussion_r509026992", "createdAt": "2020-10-21T06:45:59Z", "author": {"login": "DaanHoogland"}, "path": "test/integration/smoke/test_storage_policy.py", "diffHunk": "@@ -0,0 +1,263 @@\n+# Licensed to the Apache Software Foundation (ASF) under one\n+# or more contributor license agreements.  See the NOTICE file\n+# distributed with this work for additional information\n+# regarding copyright ownership.  The ASF licenses this file\n+# to you under the Apache License, Version 2.0 (the\n+# \"License\"); you may not use this file except in compliance\n+# with the License.  You may obtain a copy of the License at\n+#\n+#   http://www.apache.org/licenses/LICENSE-2.0\n+#\n+# Unless required by applicable law or agreed to in writing,\n+# software distributed under the License is distributed on an\n+# \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n+# KIND, either express or implied.  See the License for the\n+# specific language governing permissions and limitations\n+# under the License.\n+\n+\"\"\" Test for VMWare storage policies\n+\"\"\"\n+# Import Local Modules\n+from nose.plugins.attrib import attr\n+from marvin.cloudstackTestCase import cloudstackTestCase\n+from marvin.lib.utils import cleanup_resources\n+from marvin.lib.base import (Account,\n+                             VirtualMachine,\n+                             ServiceOffering,\n+                             NetworkOffering,\n+                             Network,\n+                             Volume,\n+                             DiskOffering)\n+from marvin.lib.common import (get_zone,\n+                               get_domain,\n+                               get_test_template)\n+from marvin.codes import PASS\n+from marvin.cloudstackAPI import (importVsphereStoragePolicies)\n+from marvin.cloudstackAPI import (listVsphereStoragePolicies)\n+\n+\n+class TestVMWareStoragePolicies(cloudstackTestCase):\n+\n+    @classmethod\n+    def setUpClass(cls):\n+\n+        cls.testClient = super(TestVMWareStoragePolicies, cls).getClsTestClient()\n+        cls.apiclient = cls.testClient.getApiClient()\n+\n+        cls.testdata = cls.testClient.getParsedTestDataConfig()\n+        # Get Zone, Domain and templates\n+        cls.domain = get_domain(cls.apiclient)\n+        cls.zone = get_zone(cls.apiclient, cls.testClient.getZoneForTests())\n+        cls._cleanup = []\n+        cls.hypervisor = cls.testClient.getHypervisorInfo()\n+        cls.network_offering = NetworkOffering.create(\n+            cls.apiclient,\n+            cls.testdata[\"l2-network_offering\"],\n+        )\n+        cls.network_offering.update(cls.apiclient, state='Enabled')\n+        cls.template = get_test_template(\n+            cls.apiclient,\n+            cls.zone.id,\n+            cls.hypervisor,\n+        )\n+        cls.cleanup = [cls.network_offering]\n+        return\n+\n+    @classmethod\n+    def tearDownClass(cls):\n+        try:\n+            cleanup_resources(cls.apiclient, cls.cleanup)\n+        except Exception as e:\n+            raise Exception(\"Warning: Exception during cleanup : %s\" % e)\n+\n+    def setUp(self):\n+\n+        self.dbclient = self.testClient.getDbConnection()\n+        self.hypervisor = self.testClient.getHypervisorInfo()\n+        self.testdata[\"virtual_machine\"][\"zoneid\"] = self.zone.id\n+        self.testdata[\"virtual_machine\"][\"template\"] = self.template.id\n+        self.account = Account.create(\n+            self.apiclient,\n+            self.testdata[\"account\"],\n+            domainid=self.domain.id\n+        )\n+        self.cleanup = [self.account]\n+        return\n+\n+    def tearDown(self):\n+        try:\n+            self.debug(\"Cleaning up the resources\")\n+            cleanup_resources(self.apiclient, self.cleanup)\n+            self.debug(\"Cleanup complete!\")\n+        except Exception as e:\n+            self.debug(\"Warning! Exception in tearDown: %s\" % e)\n+\n+    def import_vmware_storage_policies(self, apiclient):\n+        cmd = importVsphereStoragePolicies.importVsphereStoragePoliciesCmd()\n+        cmd.zoneid = self.zone.id\n+        return apiclient.importVsphereStoragePolicies(cmd)\n+\n+    def list_storage_policies(self, apiclient):\n+        cmd = listVsphereStoragePolicies.listVsphereStoragePoliciesCmd()\n+        cmd.zoneid = self.zone.id\n+        return apiclient.listVsphereStoragePolicies(cmd)\n+\n+    def create_volume(self, apiclient):\n+        cmd = create\n+    @attr(\n+        tags=[\n+            \"advanced\",\n+            \"eip\",\n+            \"advancedns\",\n+            \"basic\",\n+            \"sg\"],\n+        required_hardware=\"true\")\n+    def test_01_import_storage_policies(self):\n+        \"\"\"Test VMWare storage policies\n+        \"\"\"\n+\n+        # Validate the following:\n+        # 1. Import VMWare storage policies - the command should return non-zero result\n+        # 2. List current VMWare storage policies - the command should return non-zero result\n+        # 3. Create service offering with first of the imported policies\n+        # 4. Create disk offering with first of the imported policies\n+        # 5. Create VM using the already created service offering\n+        # 6. Create volume using the already created disk offering\n+        # 7. Attach this volume to our VM\n+        # 8. Detach the volume from our VM", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ce236e94ea71f3f0795fd0a2b8de8ba9000cb435"}, "originalPosition": 127}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzMxODk4MjQ3OnYy", "diffSide": "RIGHT", "path": "server/src/main/java/com/cloud/vm/UserVmManagerImpl.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0yNFQwNToxOToxMVrOH4sW1g==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0yNFQwNToxOToxMVrOH4sW1g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyOTIwOTA0Ng==", "bodyText": "these changes are reverted in the PR #4493 , as the data disks (which are not to be deleted) are being detached on destroy VM, which is breaking the existing behavior.", "url": "https://github.com/apache/cloudstack/pull/4307#discussion_r529209046", "createdAt": "2020-11-24T05:19:11Z", "author": {"login": "sureshanaparti"}, "path": "server/src/main/java/com/cloud/vm/UserVmManagerImpl.java", "diffHunk": "@@ -2899,14 +2899,20 @@ public UserVm destroyVm(DestroyVMCmd cmd) throws ResourceUnavailableException, C\n         }\n         s_logger.debug(\"Found no ongoing snapshots on volume of type ROOT, for the vm with id \" + vmId);\n \n-        List<VolumeVO> volumes = getVolumesFromIds(cmd);\n+        List<VolumeVO> volumesToBeDeleted = getVolumesFromIds(cmd);\n \n-        checkForUnattachedVolumes(vmId, volumes);\n-        validateVolumes(volumes);\n+        checkForUnattachedVolumes(vmId, volumesToBeDeleted);\n+        validateVolumes(volumesToBeDeleted);\n \n         stopVirtualMachine(vmId, VmDestroyForcestop.value());\n \n-        detachVolumesFromVm(volumes);\n+        if (vm.getHypervisorType() == HypervisorType.VMware) {\n+            List<VolumeVO> allVolumes = _volsDao.findByInstance(vm.getId());\n+            allVolumes.removeIf(vol -> vol.getVolumeType() == Volume.Type.ROOT);\n+            detachVolumesFromVm(allVolumes);\n+        } else {\n+            detachVolumesFromVm(volumesToBeDeleted);\n+        }", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "75019442f6b484ec331622ec579de361257d083d"}, "originalPosition": 98}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3825, "cost": 1, "resetAt": "2021-11-12T11:18:39Z"}}}