{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTA0NjMxMTU3", "number": 4409, "title": "Enhance UpdateDiskOfferingCmd", "bodyText": "This PR adds the ability to update the following disk offering fields\n\ncache-mode,\nIOPS (Read/Write) Rate, IOPS (Read/Write) Rate Max, IOPS (Read/Write) Rate Max Length\nBytes (Read/Write) Rate,  Bytes (Read/Write) Rate Max, Bytes (Read/Write) Rate Max Length\n\nDescription\n\n\n\n\n\n\nTypes of changes\n\n\n Breaking change (fix or feature that would cause existing functionality to change)\n New feature (non-breaking change which adds functionality)\n Bug fix (non-breaking change which fixes an issue)\n Enhancement (improves an existing feature and functionality)\n Cleanup (Code refactoring and cleanup, that may add test cases)\n\nHow Has This Been Tested?\n\n\n\n\nExecute multiple API requests updating different combinations with the included (13) parameters.\nAssert that all parameters got updated on DB accordingly.\nEnsure that IOPS/Bytes validations are properly done, e.g. expected Exceptions such as Bytes Write rate (5000) cannot be greater than Bytes Write maximum rate (3000).", "createdAt": "2020-10-16T06:50:35Z", "url": "https://github.com/apache/cloudstack/pull/4409", "merged": true, "mergeCommit": {"oid": "f4f35a8995a044446883e8e41c5a5de014e27581"}, "closed": true, "closedAt": "2020-10-24T11:00:12Z", "author": {"login": "GabrielBrascher"}, "timelineItems": {"totalCount": 8, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdTICAtABqjM4ODY5NDQxNzQ=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdU8q5ogFqTUxNDQyNDQwNw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "e21701a52f7e60f24756a9b307ee5bce3c710d6e", "author": {"user": {"login": "GabrielBrascher", "name": "Gabriel Beims Br\u00e4scher"}}, "url": "https://github.com/apache/cloudstack/commit/e21701a52f7e60f24756a9b307ee5bce3c710d6e", "committedDate": "2020-10-16T05:38:06Z", "message": "Update disk offering cache-mode\n\n- cache-mode,\n- IOPS (Read/Write) Rate / IOPS (Read/Write) Rate Max / IOPS (Read/Write) Rate Max Length\n  Bytes (Read/Write) Rate /\n- Bytes (Read/Write) Rate Max / Bytes (Read/Write) Rate Max Length"}, "afterCommit": {"oid": "b984042e88984bbdea19bc9d647fad2e88ca026b", "author": {"user": {"login": "GabrielBrascher", "name": "Gabriel Beims Br\u00e4scher"}}, "url": "https://github.com/apache/cloudstack/commit/b984042e88984bbdea19bc9d647fad2e88ca026b", "committedDate": "2020-10-16T15:20:57Z", "message": "Enhance update disk offering\n\n- cache-mode\n- IOPS (Read/Write) Rate, IOPS (Read/Write) Rate Max, IOPS (Read/Write) Rate Max Length\n  Bytes (Read/Write) Rate,\n- Bytes (Read/Write) Rate Max, Bytes (Read/Write) Rate Max Length"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "b984042e88984bbdea19bc9d647fad2e88ca026b", "author": {"user": {"login": "GabrielBrascher", "name": "Gabriel Beims Br\u00e4scher"}}, "url": "https://github.com/apache/cloudstack/commit/b984042e88984bbdea19bc9d647fad2e88ca026b", "committedDate": "2020-10-16T15:20:57Z", "message": "Enhance update disk offering\n\n- cache-mode\n- IOPS (Read/Write) Rate, IOPS (Read/Write) Rate Max, IOPS (Read/Write) Rate Max Length\n  Bytes (Read/Write) Rate,\n- Bytes (Read/Write) Rate Max, Bytes (Read/Write) Rate Max Length"}, "afterCommit": {"oid": "3efd00d4bbb67bd2e9a487c1fe3e8f7bbcd7362b", "author": {"user": {"login": "GabrielBrascher", "name": "Gabriel Beims Br\u00e4scher"}}, "url": "https://github.com/apache/cloudstack/commit/3efd00d4bbb67bd2e9a487c1fe3e8f7bbcd7362b", "committedDate": "2020-10-16T15:24:40Z", "message": "Enhance update disk offering\n\n- cache-mode\n- IOPS (Read/Write) Rate, IOPS (Read/Write) Rate Max, IOPS (Read/Write) Rate Max Length\n  Bytes (Read/Write) Rate,\n- Bytes (Read/Write) Rate Max, Bytes (Read/Write) Rate Max Length"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTEwNjcxNDgy", "url": "https://github.com/apache/cloudstack/pull/4409#pullrequestreview-510671482", "createdAt": "2020-10-16T17:33:02Z", "commit": {"oid": "3efd00d4bbb67bd2e9a487c1fe3e8f7bbcd7362b"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xNlQxNzozMzowM1rOHjJx5g==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xNlQxNzozMzo1NVrOHjJ0WQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNjYyMjQzOA==", "bodyText": "I believe your test is incorrect.\nYou need an assertion here.", "url": "https://github.com/apache/cloudstack/pull/4409#discussion_r506622438", "createdAt": "2020-10-16T17:33:03Z", "author": {"login": "RodrigoDLopez"}, "path": "server/src/test/java/com/cloud/configuration/ConfigurationManagerTest.java", "diffHunk": "@@ -946,17 +946,32 @@ public void validateMaximumIopsAndBytesLengthTestDefaultLengthConfigs() {\n \n     @Test\n     public void shouldUpdateDiskOfferingTests(){\n-        Assert.assertTrue(configurationMgr.shouldUpdateDiskOffering(Mockito.anyString(), Mockito.anyString(), Mockito.anyInt(), Mockito.anyBoolean(), Mockito.anyString()));\n-        Assert.assertTrue(configurationMgr.shouldUpdateDiskOffering(Mockito.anyString(), nullable(String.class), nullable(Integer.class), nullable(Boolean.class), nullable(String.class)));\n-        Assert.assertTrue(configurationMgr.shouldUpdateDiskOffering(nullable(String.class), Mockito.anyString(), nullable(Integer.class), nullable(Boolean.class), nullable(String.class)));\n-        Assert.assertTrue(configurationMgr.shouldUpdateDiskOffering(nullable(String.class), nullable(String.class), Mockito.anyInt(), nullable(Boolean.class), nullable(String.class)));\n-        Assert.assertTrue(configurationMgr.shouldUpdateDiskOffering(nullable(String.class), nullable(String.class), nullable(int.class), Mockito.anyBoolean(), nullable(String.class)));\n-        Assert.assertTrue(configurationMgr.shouldUpdateDiskOffering(nullable(String.class), nullable(String.class), nullable(int.class), nullable(Boolean.class), Mockito.anyString()));\n+        Assert.assertTrue(configurationMgr.shouldUpdateDiskOffering(Mockito.anyString(), Mockito.anyString(), Mockito.anyInt(), Mockito.anyBoolean(), Mockito.anyString(), Mockito.anyString()));\n+        Assert.assertTrue(configurationMgr.shouldUpdateDiskOffering(Mockito.anyString(), nullable(String.class), nullable(Integer.class), nullable(Boolean.class), nullable(String.class), nullable(String.class)));\n+        Assert.assertTrue(configurationMgr.shouldUpdateDiskOffering(nullable(String.class), Mockito.anyString(), nullable(Integer.class), nullable(Boolean.class), nullable(String.class), nullable(String.class)));\n+        Assert.assertTrue(configurationMgr.shouldUpdateDiskOffering(nullable(String.class), nullable(String.class), Mockito.anyInt(), nullable(Boolean.class), nullable(String.class), nullable(String.class)));\n+        Assert.assertTrue(configurationMgr.shouldUpdateDiskOffering(nullable(String.class), nullable(String.class), nullable(int.class), Mockito.anyBoolean(), nullable(String.class), nullable(String.class)));\n+        Assert.assertTrue(configurationMgr.shouldUpdateDiskOffering(nullable(String.class), nullable(String.class), nullable(int.class), nullable(Boolean.class), Mockito.anyString(), Mockito.anyString()));\n     }\n \n     @Test\n     public void shouldUpdateDiskOfferingTestFalse(){\n-        Assert.assertFalse(configurationMgr.shouldUpdateDiskOffering(null, null, null, null, null));\n+        Assert.assertFalse(configurationMgr.shouldUpdateDiskOffering(null, null, null, null, null, null));\n+    }\n+\n+    @Test\n+    public void shouldUpdateIopsRateParametersTestFalse() {\n+        configurationMgr.shouldUpdateIopsRateParameters(null, null, null, null, null, null);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "3efd00d4bbb67bd2e9a487c1fe3e8f7bbcd7362b"}, "originalPosition": 26}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNjYyMzA2NQ==", "bodyText": "those change will not impact into edit diskoffering tags", "url": "https://github.com/apache/cloudstack/pull/4409#discussion_r506623065", "createdAt": "2020-10-16T17:33:55Z", "author": {"login": "RodrigoDLopez"}, "path": "server/src/main/java/com/cloud/configuration/ConfigurationManagerImpl.java", "diffHunk": "@@ -3273,8 +3280,17 @@ protected void updateDiskOfferingTagsIfIsNotNull(String tags, DiskOfferingVO dis\n      * Check if it needs to update any parameter when updateDiskoffering is called\n      * Verify if name or displayText are not blank, tags is not null, sortkey and displayDiskOffering is not null\n      */\n-    protected boolean shouldUpdateDiskOffering(String name, String displayText, Integer sortKey, Boolean displayDiskOffering, String tags) {\n-        return StringUtils.isNotBlank(name) || StringUtils.isNotBlank(displayText) || tags != null || sortKey != null || displayDiskOffering != null;\n+    protected boolean shouldUpdateDiskOffering(String name, String displayText, Integer sortKey, Boolean displayDiskOffering, String tags, String cacheMode) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "3efd00d4bbb67bd2e9a487c1fe3e8f7bbcd7362b"}, "originalPosition": 201}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "65322095f5e4d91ac8967e7c248675b98d5439e6", "author": {"user": {"login": "GabrielBrascher", "name": "Gabriel Beims Br\u00e4scher"}}, "url": "https://github.com/apache/cloudstack/commit/65322095f5e4d91ac8967e7c248675b98d5439e6", "committedDate": "2020-10-16T19:35:28Z", "message": "Enhance update disk offering\n\n- cache-mode\n- IOPS (Read/Write) Rate, IOPS (Read/Write) Rate Max, IOPS (Read/Write) Rate Max Length\n  Bytes (Read/Write) Rate,\n- Bytes (Read/Write) Rate Max, Bytes (Read/Write) Rate Max Length"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "3efd00d4bbb67bd2e9a487c1fe3e8f7bbcd7362b", "author": {"user": {"login": "GabrielBrascher", "name": "Gabriel Beims Br\u00e4scher"}}, "url": "https://github.com/apache/cloudstack/commit/3efd00d4bbb67bd2e9a487c1fe3e8f7bbcd7362b", "committedDate": "2020-10-16T15:24:40Z", "message": "Enhance update disk offering\n\n- cache-mode\n- IOPS (Read/Write) Rate, IOPS (Read/Write) Rate Max, IOPS (Read/Write) Rate Max Length\n  Bytes (Read/Write) Rate,\n- Bytes (Read/Write) Rate Max, Bytes (Read/Write) Rate Max Length"}, "afterCommit": {"oid": "65322095f5e4d91ac8967e7c248675b98d5439e6", "author": {"user": {"login": "GabrielBrascher", "name": "Gabriel Beims Br\u00e4scher"}}, "url": "https://github.com/apache/cloudstack/commit/65322095f5e4d91ac8967e7c248675b98d5439e6", "committedDate": "2020-10-16T19:35:28Z", "message": "Enhance update disk offering\n\n- cache-mode\n- IOPS (Read/Write) Rate, IOPS (Read/Write) Rate Max, IOPS (Read/Write) Rate Max Length\n  Bytes (Read/Write) Rate,\n- Bytes (Read/Write) Rate Max, Bytes (Read/Write) Rate Max Length"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTExNDY5MTMw", "url": "https://github.com/apache/cloudstack/pull/4409#pullrequestreview-511469130", "createdAt": "2020-10-19T07:15:16Z", "commit": {"oid": "65322095f5e4d91ac8967e7c248675b98d5439e6"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "92ae54fa7bd81a755a8dc971ed9ef6f76253dfc6", "author": {"user": {"login": "GabrielBrascher", "name": "Gabriel Beims Br\u00e4scher"}}, "url": "https://github.com/apache/cloudstack/commit/92ae54fa7bd81a755a8dc971ed9ef6f76253dfc6", "committedDate": "2020-10-19T13:26:27Z", "message": "Add shouldUpdateBytesRate Tests"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTE0NDI0NDA3", "url": "https://github.com/apache/cloudstack/pull/4409#pullrequestreview-514424407", "createdAt": "2020-10-22T07:16:53Z", "commit": {"oid": "92ae54fa7bd81a755a8dc971ed9ef6f76253dfc6"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4703, "cost": 1, "resetAt": "2021-10-28T17:48:14Z"}}}