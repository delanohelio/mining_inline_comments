{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDUwODcxMjYx", "number": 4215, "title": "Enable account settings to be visible under domain settings", "bodyText": "Description\n\nAll the account settings can't be configured under domain\nlevel settings right now.\nBy default, if account setting is not configured then\nits value will be taken from global setting.\nAdd a global setting \"enable.account.settings.for.domain\"\nso that if its enabled then all the account level settings\nwill be visible under domain levelsettings also.\nIf account level setting is configured then that value will\nbe considered else it will take domain scope value. If\ndomain scope value is not configured then it will pick\nit up from global setting.\nIf domain level setting is not configured then by default\nthe value will be taken from global setting\nAdd another global setting \"enable.domain.settings.for.child.domain\"\nso that when its true, if a value for domain setting is not\nconfigured then its parent domain value is considered until\nit reaches ROOT domain. If no value is configured till ROOT\ndomain then global setting value will be taken.\nAlso display all the settings configured under the domain level\nin list domains api response\n\n\n\n\n\nTypes of changes\n\n\n Breaking change (fix or feature that would cause existing functionality to change)\n New feature (non-breaking change which adds functionality)\n Bug fix (non-breaking change which fixes an issue)\n Enhancement (improves an existing feature and functionality)\n Cleanup (Code refactoring and cleanup, that may add test cases)\n\nScreenshots (if appropriate):\nHow Has This Been Tested?\n\n\n\nThis has been tested both from UI and cloudmonkey api\nCretae a domain relationship like\nROOT -> test1 -> test11\nsetting \"enable.account.settings.for.domain\" to false\nThe below output should not display config value\nlocal) mgt01 > list configurations accountid=1431e-347c-4bae-a2ec-7c892cb name=router.service.offering\n{\n  \"configuration\": [\n    {\n      \"category\": \"Advanced\",\n      \"description\": \"Uuid of the service offering used by virtual routers; if NULL - system offering will be used\",\n      \"isdynamic\": true,\n      \"name\": \"router.service.offering\",\n      \"scope\": \"account\",\n      \"value\": \"\"\n    }\n  ],\n  \"count\": 1\n}\n\nAfter setting enable.account.settings.for.domain to true and set global value to f2d9-3803-4af-b84-96a369\nThe value should be of global setting value\n(local) mgt01 > list configurations accountid=188b431e-347c-4bae-a2ec-7c8f1e4792cb name=router.service.offering\n{\n  \"configuration\": [\n    {\n      \"category\": \"Advanced\",\n      \"description\": \"Uuid of the service offering used by virtual routers; if NULL - system offering will be used\",\n      \"isdynamic\": true,\n      \"name\": \"router.service.offering\",\n      \"scope\": \"account\",\n      \"value\": \"f2d9-3803-4aef-b84-93ee69\" <<<<<<<<<<<<< displays global value \n    }\n  ],\n  \"count\": 1\n}\n\nAssign different value for router.service.offering to domain test1 which is parent of test11\nset the value of router.service.offering of domain \"test1\" to fca42701-6d28-4bc4-8c14-896d0878d07e\n(local) mgt01 > list configurations name=router.service.offering domainid=e3a8ea3a-2318-4e81-99b3-8392513b80b0\n{\n  \"configuration\": [\n    {\n      \"category\": \"Advanced\",\n      \"description\": \"Uuid of the service offering used by virtual routers; if NULL - system offering will be used\",\n      \"isdynamic\": true,\n      \"name\": \"router.service.offering\",\n      \"scope\": \"domain\",\n      \"value\": \"fca42701-6d28-4bc4-8c14-896d0878d07e\" <<<<<<<<<<<<< different value compared to global setting\n    }\n  ],\n  \"count\": 1\n} \n\nsetting \"enable.account.settings.for.domain\" to true\nThe value should still point to global setting\n(local) mgt01 > list configurations name=router.service.offering accountid=188b431e-347c-4bae-a2ec-7c8f1e4792cb\n{\n  \"configuration\": [\n    {\n      \"category\": \"Advanced\",\n      \"description\": \"Uuid of the service offering used by virtual routers; if NULL - system offering will be used\",\n      \"isdynamic\": true,\n      \"name\": \"router.service.offering\",\n      \"scope\": \"account\",\n      \"value\": \"f2c5d7d9-3803-4aef-b884-9652f0a3ee69\"\n    }\n  ],\n  \"count\": 1\n}\n\nNow change the value of enable.domain.settings.for.child.domain to true\nIt should be display the value of test1 domain instead of global setting\n(local) mgt01 > list configurations name=router.service.offering accountid=188b431e-347c-4bae-a2ec-7c8f1e4792cb\n{\n  \"configuration\": [\n    {\n      \"category\": \"Advanced\",\n      \"description\": \"Uuid of the service offering used by virtual routers; if NULL - system offering will be used\",\n      \"isdynamic\": true,\n      \"name\": \"router.service.offering\",\n      \"scope\": \"account\",\n      \"value\": \"fca42701-6d28-4bc4-8c14-896d0878d07e\" <<<<<<<<<<<<< value assigned to test1 domain\n    }\n  ],\n  \"count\": 1\n}\n\nAll the settings enabled under domain will be displayed in list domains response\n(local) mgt01 > list domains id=04dfd1c6-c28e-11ea-9a43-0617bc003377\n{\n  \"count\": 1,\n  \"domain\": [\n    {\n      \"cpuavailable\": \"Unlimited\",\n      \"cpulimit\": \"Unlimited\",\n      \"cputotal\": 1,\n      \"domaindetails\": {\n        \"vmsnapshot.expire.interval\": \"30\"\n      },\n\nRunning integration test cases\nnosetests --with-marvin --marvin-config=<config file> test_enable_account_settings_for_domain.py\n\nDisable account settings for domain ... === TestName: test_01_disable_account_settings_for_domain | Status : SUCCESS ===\nok\nEnable account settings for domain ... === TestName: test_02_enable_account_settings_for_domain | Status : SUCCESS ===\nok\nEnable account settings for domain ... === TestName: test_03_enable_account_settings_for_domain | Status : SUCCESS ===\nok\n\n----------------------------------------------------------------------\nRan 3 tests in 10.193s\n\nOK", "createdAt": "2020-07-17T07:38:19Z", "url": "https://github.com/apache/cloudstack/pull/4215", "merged": true, "mergeCommit": {"oid": "dcc02e0fbb8bfdc264cde06024f00fa724da8885"}, "closed": true, "closedAt": "2021-09-29T08:29:20Z", "author": {"login": "ravening"}, "timelineItems": {"totalCount": 11, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdW8tZ4ABqjM5MzA5NzI5OTQ=", "endCursor": "Y3Vyc29yOnYyOpPPAAABfDBDK-gFqTc2NjI1MzEyNg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "c702e6ff46af4ea1f87b07c0725b381c54c0fb4b", "author": {"user": {"login": "ravening", "name": "Rakesh"}}, "url": "https://github.com/apache/cloudstack/commit/c702e6ff46af4ea1f87b07c0725b381c54c0fb4b", "committedDate": "2020-07-17T07:20:07Z", "message": "Enable account settings to be visible under domain settings\n\nAll the account settings can't be configured under domain\nlevel settings right now.\nBy default, if account setting is not configured then\nits value will be taken from global setting.\nAdd a global setting \"enable.account.settings.for.domain\"\nso that if its enabled then all the account level settings\nwill be visible under domain levelsettings also.\nIf account level setting is configured then that value will\nbe considered else it will take domain scope value. If\ndomain scope value is not configured then it will pick\nit up from global setting.\n\nIf domain level setting is not configured then by default\nthe value will be taken from global setting\nAdd another global setting \"enable.domain.settings.for.child.domain\"\nso that when its true, if a value for domain setting is not\nconfigured then its parent domain value is considered until\nit reaches ROOT domain. If no value is configured till ROOT\ndomain then global setting value will be taken.\n\nAlso display all the settings configured under the domain level\nin list domains api response"}, "afterCommit": {"oid": "b4a3f92c428b6e68600df482cc6df5a3acc1ea3b", "author": {"user": {"login": "ravening", "name": "Rakesh"}}, "url": "https://github.com/apache/cloudstack/commit/b4a3f92c428b6e68600df482cc6df5a3acc1ea3b", "committedDate": "2020-10-28T12:21:10Z", "message": "Enable account settings to be visible under domain settings\n\nAll the account settings can't be configured under domain\nlevel settings right now.\nBy default, if account setting is not configured then\nits value will be taken from global setting.\nAdd a global setting \"enable.account.settings.for.domain\"\nso that if its enabled then all the account level settings\nwill be visible under domain levelsettings also.\nIf account level setting is configured then that value will\nbe considered else it will take domain scope value. If\ndomain scope value is not configured then it will pick\nit up from global setting.\n\nIf domain level setting is not configured then by default\nthe value will be taken from global setting\nAdd another global setting \"enable.domain.settings.for.child.domain\"\nso that when its true, if a value for domain setting is not\nconfigured then its parent domain value is considered until\nit reaches ROOT domain. If no value is configured till ROOT\ndomain then global setting value will be taken.\n\nAlso display all the settings configured under the domain level\nin list domains api response"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "b4a3f92c428b6e68600df482cc6df5a3acc1ea3b", "author": {"user": {"login": "ravening", "name": "Rakesh"}}, "url": "https://github.com/apache/cloudstack/commit/b4a3f92c428b6e68600df482cc6df5a3acc1ea3b", "committedDate": "2020-10-28T12:21:10Z", "message": "Enable account settings to be visible under domain settings\n\nAll the account settings can't be configured under domain\nlevel settings right now.\nBy default, if account setting is not configured then\nits value will be taken from global setting.\nAdd a global setting \"enable.account.settings.for.domain\"\nso that if its enabled then all the account level settings\nwill be visible under domain levelsettings also.\nIf account level setting is configured then that value will\nbe considered else it will take domain scope value. If\ndomain scope value is not configured then it will pick\nit up from global setting.\n\nIf domain level setting is not configured then by default\nthe value will be taken from global setting\nAdd another global setting \"enable.domain.settings.for.child.domain\"\nso that when its true, if a value for domain setting is not\nconfigured then its parent domain value is considered until\nit reaches ROOT domain. If no value is configured till ROOT\ndomain then global setting value will be taken.\n\nAlso display all the settings configured under the domain level\nin list domains api response"}, "afterCommit": {"oid": "32e3d082325b8a9ba36e6affce269aa8942a33ee", "author": {"user": {"login": "ravening", "name": "Rakesh"}}, "url": "https://github.com/apache/cloudstack/commit/32e3d082325b8a9ba36e6affce269aa8942a33ee", "committedDate": "2020-12-10T15:34:02Z", "message": "Fix NPE while deleting domain"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "32e3d082325b8a9ba36e6affce269aa8942a33ee", "author": {"user": {"login": "ravening", "name": "Rakesh"}}, "url": "https://github.com/apache/cloudstack/commit/32e3d082325b8a9ba36e6affce269aa8942a33ee", "committedDate": "2020-12-10T15:34:02Z", "message": "Fix NPE while deleting domain"}, "afterCommit": {"oid": "065782e1e6a167015e5d87633a5f29970a0dd50c", "author": {"user": {"login": "ravening", "name": "Rakesh"}}, "url": "https://github.com/apache/cloudstack/commit/065782e1e6a167015e5d87633a5f29970a0dd50c", "committedDate": "2021-03-23T13:20:58Z", "message": "Enable account settings to be visible under domain settings\n\nAll the account settings can't be configured under domain\nlevel settings right now.\nBy default, if account setting is not configured then\nits value will be taken from global setting.\nAdd a global setting \"enable.account.settings.for.domain\"\nso that if its enabled then all the account level settings\nwill be visible under domain levelsettings also.\nIf account level setting is configured then that value will\nbe considered else it will take domain scope value. If\ndomain scope value is not configured then it will pick\nit up from global setting.\n\nIf domain level setting is not configured then by default\nthe value will be taken from global setting\nAdd another global setting \"enable.domain.settings.for.child.domain\"\nso that when its true, if a value for domain setting is not\nconfigured then its parent domain value is considered until\nit reaches ROOT domain. If no value is configured till ROOT\ndomain then global setting value will be taken.\n\nAlso display all the settings configured under the domain level\nin list domains api response"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "065782e1e6a167015e5d87633a5f29970a0dd50c", "author": {"user": {"login": "ravening", "name": "Rakesh"}}, "url": "https://github.com/apache/cloudstack/commit/065782e1e6a167015e5d87633a5f29970a0dd50c", "committedDate": "2021-03-23T13:20:58Z", "message": "Enable account settings to be visible under domain settings\n\nAll the account settings can't be configured under domain\nlevel settings right now.\nBy default, if account setting is not configured then\nits value will be taken from global setting.\nAdd a global setting \"enable.account.settings.for.domain\"\nso that if its enabled then all the account level settings\nwill be visible under domain levelsettings also.\nIf account level setting is configured then that value will\nbe considered else it will take domain scope value. If\ndomain scope value is not configured then it will pick\nit up from global setting.\n\nIf domain level setting is not configured then by default\nthe value will be taken from global setting\nAdd another global setting \"enable.domain.settings.for.child.domain\"\nso that when its true, if a value for domain setting is not\nconfigured then its parent domain value is considered until\nit reaches ROOT domain. If no value is configured till ROOT\ndomain then global setting value will be taken.\n\nAlso display all the settings configured under the domain level\nin list domains api response"}, "afterCommit": {"oid": "1ed663777c4824297de76561f4b3fccdc029d270", "author": {"user": {"login": "ravening", "name": "Rakesh"}}, "url": "https://github.com/apache/cloudstack/commit/1ed663777c4824297de76561f4b3fccdc029d270", "committedDate": "2021-03-23T13:25:06Z", "message": "Enable account settings to be visible under domain settings\n\nAll the account settings can't be configured under domain\nlevel settings right now.\nBy default, if account setting is not configured then\nits value will be taken from global setting.\nAdd a global setting \"enable.account.settings.for.domain\"\nso that if its enabled then all the account level settings\nwill be visible under domain levelsettings also.\nIf account level setting is configured then that value will\nbe considered else it will take domain scope value. If\ndomain scope value is not configured then it will pick\nit up from global setting.\n\nIf domain level setting is not configured then by default\nthe value will be taken from global setting\nAdd another global setting \"enable.domain.settings.for.child.domain\"\nso that when its true, if a value for domain setting is not\nconfigured then its parent domain value is considered until\nit reaches ROOT domain. If no value is configured till ROOT\ndomain then global setting value will be taken.\n\nAlso display all the settings configured under the domain level\nin list domains api response"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NjIyMjA2NDM5", "url": "https://github.com/apache/cloudstack/pull/4215#pullrequestreview-622206439", "createdAt": "2021-03-26T14:30:12Z", "commit": {"oid": "1ed663777c4824297de76561f4b3fccdc029d270"}, "state": "APPROVED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wMy0yNlQxNDozMDoxM1rOI-b5cg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wMy0yNlQxNDozNDoyNlrOI-cFxA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDYwMjMzOTY5OA==", "bodyText": "naming convention for static final dictates as above ALL_CAPS_WITH_UNDERSCORES", "url": "https://github.com/apache/cloudstack/pull/4215#discussion_r602339698", "createdAt": "2021-03-26T14:30:13Z", "author": {"login": "DaanHoogland"}, "path": "server/src/main/java/com/cloud/configuration/ConfigurationManagerImpl.java", "diffHunk": "@@ -6485,6 +6492,7 @@ public String getConfigComponentName() {\n     @Override\n     public ConfigKey<?>[] getConfigKeys() {\n         return new ConfigKey<?>[] {SystemVMUseLocalStorage, IOPS_MAX_READ_LENGTH, IOPS_MAX_WRITE_LENGTH,\n-                BYTES_MAX_READ_LENGTH, BYTES_MAX_WRITE_LENGTH, ADD_HOST_ON_SERVICE_RESTART_KVM, SET_HOST_DOWN_TO_MAINTENANCE};\n+                BYTES_MAX_READ_LENGTH, BYTES_MAX_WRITE_LENGTH, ADD_HOST_ON_SERVICE_RESTART_KVM, SET_HOST_DOWN_TO_MAINTENANCE,\n+                EnableAccountSettingsForDomain, EnableDomainSettingsForChildDomain};", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "1ed663777c4824297de76561f4b3fccdc029d270"}, "originalPosition": 29}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDYwMjM0Mjg1Mg==", "bodyText": "this string should probably come from some static final as now it is encoded twice (at least)", "url": "https://github.com/apache/cloudstack/pull/4215#discussion_r602342852", "createdAt": "2021-03-26T14:34:26Z", "author": {"login": "DaanHoogland"}, "path": "engine/schema/src/main/java/com/cloud/domain/dao/DomainDetailsDaoImpl.java", "diffHunk": "@@ -98,7 +107,24 @@ public Scope getScope() {\n \n     @Override\n     public String getConfigValue(long id, ConfigKey<?> key) {\n-        DomainDetailVO vo = findDetail(id, key.key());\n+        DomainDetailVO vo = null;\n+        String enableDomainSettingsForChildDomain = _configDao.getValue(\"enable.domain.settings.for.child.domain\");", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "1ed663777c4824297de76561f4b3fccdc029d270"}, "originalPosition": 34}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "1ed663777c4824297de76561f4b3fccdc029d270", "author": {"user": {"login": "ravening", "name": "Rakesh"}}, "url": "https://github.com/apache/cloudstack/commit/1ed663777c4824297de76561f4b3fccdc029d270", "committedDate": "2021-03-23T13:25:06Z", "message": "Enable account settings to be visible under domain settings\n\nAll the account settings can't be configured under domain\nlevel settings right now.\nBy default, if account setting is not configured then\nits value will be taken from global setting.\nAdd a global setting \"enable.account.settings.for.domain\"\nso that if its enabled then all the account level settings\nwill be visible under domain levelsettings also.\nIf account level setting is configured then that value will\nbe considered else it will take domain scope value. If\ndomain scope value is not configured then it will pick\nit up from global setting.\n\nIf domain level setting is not configured then by default\nthe value will be taken from global setting\nAdd another global setting \"enable.domain.settings.for.child.domain\"\nso that when its true, if a value for domain setting is not\nconfigured then its parent domain value is considered until\nit reaches ROOT domain. If no value is configured till ROOT\ndomain then global setting value will be taken.\n\nAlso display all the settings configured under the domain level\nin list domains api response"}, "afterCommit": {"oid": "0ea04656f4671fab45ff2a9d78add341916fac1c", "author": {"user": {"login": "ravening", "name": "Rakesh"}}, "url": "https://github.com/apache/cloudstack/commit/0ea04656f4671fab45ff2a9d78add341916fac1c", "committedDate": "2021-09-08T08:12:25Z", "message": "Enable account settings to be visible under domain settings\n\nAll the account settings can't be configured under domain\nlevel settings right now.\nBy default, if account setting is not configured then\nits value will be taken from global setting.\nAdd a global setting \"enable.account.settings.for.domain\"\nso that if its enabled then all the account level settings\nwill be visible under domain levelsettings also.\nIf account level setting is configured then that value will\nbe considered else it will take domain scope value. If\ndomain scope value is not configured then it will pick\nit up from global setting.\n\nIf domain level setting is not configured then by default\nthe value will be taken from global setting\nAdd another global setting \"enable.domain.settings.for.child.domain\"\nso that when its true, if a value for domain setting is not\nconfigured then its parent domain value is considered until\nit reaches ROOT domain. If no value is configured till ROOT\ndomain then global setting value will be taken.\n\nAlso display all the settings configured under the domain level\nin list domains api response"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "50f4a8a77f8105b608db9c471c0046575fd695a5", "author": {"user": {"login": "ravening", "name": "Rakesh"}}, "url": "https://github.com/apache/cloudstack/commit/50f4a8a77f8105b608db9c471c0046575fd695a5", "committedDate": "2021-09-20T11:18:20Z", "message": "Enable account settings to be visible under domain settings\n\nAll the account settings can't be configured under domain\nlevel settings right now.\nBy default, if account setting is not configured then\nits value will be taken from global setting.\nAdd a global setting \"enable.account.settings.for.domain\"\nso that if its enabled then all the account level settings\nwill be visible under domain levelsettings also.\nIf account level setting is configured then that value will\nbe considered else it will take domain scope value. If\ndomain scope value is not configured then it will pick\nit up from global setting.\n\nIf domain level setting is not configured then by default\nthe value will be taken from global setting\nAdd another global setting \"enable.domain.settings.for.child.domain\"\nso that when its true, if a value for domain setting is not\nconfigured then its parent domain value is considered until\nit reaches ROOT domain. If no value is configured till ROOT\ndomain then global setting value will be taken.\n\nAlso display all the settings configured under the domain level\nin list domains api response"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "bca8556e3ebe27fcaedb11c83384fa8499e586dd", "author": {"user": null}, "url": "https://github.com/apache/cloudstack/commit/bca8556e3ebe27fcaedb11c83384fa8499e586dd", "committedDate": "2021-09-20T11:18:22Z", "message": "rename variables"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "3f33af45c23d2b0bd8b7f604cf2f080d327efc83", "author": {"user": null}, "url": "https://github.com/apache/cloudstack/commit/3f33af45c23d2b0bd8b7f604cf2f080d327efc83", "committedDate": "2021-09-08T08:28:41Z", "message": "rename variables"}, "afterCommit": {"oid": "bca8556e3ebe27fcaedb11c83384fa8499e586dd", "author": {"user": null}, "url": "https://github.com/apache/cloudstack/commit/bca8556e3ebe27fcaedb11c83384fa8499e586dd", "committedDate": "2021-09-20T11:18:22Z", "message": "rename variables"}}, {"__typename": "PullRequestReview", "id": "PRR_kwDOAJTq2M4tiwQs", "url": "https://github.com/apache/cloudstack/pull/4215#pullrequestreview-764085292", "createdAt": "2021-09-27T10:10:04Z", "commit": {"oid": "bca8556e3ebe27fcaedb11c83384fa8499e586dd"}, "state": "COMMENTED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "PRR_kwDOAJTq2M4trBhG", "url": "https://github.com/apache/cloudstack/pull/4215#pullrequestreview-766253126", "createdAt": "2021-09-29T06:34:41Z", "commit": {"oid": "bca8556e3ebe27fcaedb11c83384fa8499e586dd"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3959, "cost": 1, "resetAt": "2021-10-28T17:48:14Z"}}}