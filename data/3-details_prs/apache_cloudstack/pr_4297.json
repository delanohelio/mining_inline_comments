{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDc2MTIyNzU0", "number": 4297, "title": "Incorrect md5sums for systemVM templates results in failure to download templates to other image stores", "bodyText": "Description\nIncorrect checksums for systemVM template along the 4.13.1 to 4.14 upgrade path, causes failure in downloading/ syncing the systemVM templates on other / newly added image stores\nSteps to reproduce\n\nDeploy a 4.14 setup - with a single image store\nOnce the env is up and running, add another image store\nWhen the template sync happens on the newly added image store, the systemVM template fails the checksum verification\n\n*************************** 4. row ***************************\n                  id: 23\n            store_id: 2\n         template_id: 3\n             created: 2020-07-13 10:07:49\n        last_updated: 2020-07-13 10:08:22\n              job_id: 099eeb3a-c980-4dc6-8e00-28203c59feef\n        download_pct: 100\n                size: 0\n          store_role: Image\n       physical_size: 0\n      download_state: DOWNLOAD_IN_PROGRESS\n           error_str: Download success, starting install \n          local_path: /mnt/SecStorage/32ea45f5-76bb-3b1f-ac10-6aa9939f771f/template/tmpl/1/3/dnld5468597899343935001tmp_\n        install_path: template/tmpl/1/3\n                 url: NULL\n               state: Creating\n           destroyed: 0\n             is_copy: 0\n        update_count: 1\n             ref_cnt: 0\n             updated: 2020-07-13 10:07:49\ndownload_url_created: NULL\n        download_url: NULL\n4 rows in set (0.00 sec)\n\n\n*************************** 4. row ***************************\n                  id: 23\n            store_id: 2\n         template_id: 3\n             created: 2020-07-13 10:07:49\n        last_updated: 2020-07-13 10:08:43\n              job_id: 099eeb3a-c980-4dc6-8e00-28203c59feef\n        download_pct: 100\n                size: 0\n          store_role: Image\n       physical_size: 0\n      download_state: DOWNLOAD_ERROR\n           error_str: Failed post download script: checksum \"{MD5}4978e6e6140d167556f201496549a498\" didn't match the given value, \"{MD5}d15ed159be32151b07e3211caf9cb802\"\n          local_path: /mnt/SecStorage/32ea45f5-76bb-3b1f-ac10-6aa9939f771f/template/tmpl/1/3/dnld5468597899343935001tmp_\n        install_path: template/tmpl/1/3\n                 url: NULL\n               state: Allocated\n           destroyed: 0\n             is_copy: 0\n        update_count: 2\n             ref_cnt: 0\n             updated: 2020-07-13 10:08:43\ndownload_url_created: NULL\n        download_url: NULL\n4 rows in set (0.00 sec)\n\n\nTypes of changes\n\n\n Breaking change (fix or feature that would cause existing functionality to change)\n New feature (non-breaking change which adds functionality)\n Bug fix (non-breaking change which fixes an issue)\n Enhancement (improves an existing feature and functionality)\n Cleanup (Code refactoring and cleanup, that may add test cases)", "createdAt": "2020-08-31T07:36:20Z", "url": "https://github.com/apache/cloudstack/pull/4297", "merged": true, "mergeCommit": {"oid": "37c7a2b8512fbb9539c284e087b0d07f4f41b23b"}, "closed": true, "closedAt": "2020-09-09T10:27:50Z", "author": {"login": "Pearl1594"}, "timelineItems": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdENnVsAH2gAyNDc2MTIyNzU0OjY5ZWI2MWJiY2EwZGZiZWVjZThlZDkzODQ4OWMwNWIzNmEzYzk2MDQ=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdGqMF0AFqTQ4MzcxNDgxNA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "69eb61bbca0dfbeece8ed938489c05b36a3c9604", "author": {"user": null}, "url": "https://github.com/apache/cloudstack/commit/69eb61bbca0dfbeece8ed938489c05b36a3c9604", "committedDate": "2020-08-31T07:24:40Z", "message": "Incorrect md5sums for systemVM templates results in failure to download templates to other image stores"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDc5NTE0NDE0", "url": "https://github.com/apache/cloudstack/pull/4297#pullrequestreview-479514414", "createdAt": "2020-09-01T08:29:55Z", "commit": {"oid": "69eb61bbca0dfbeece8ed938489c05b36a3c9604"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0wMVQwODoyOTo1NVrOHKrwnw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0wMVQwODoyOTo1NVrOHKrwnw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MDk2NDc2Nw==", "bodyText": "LGTM based on http://download.cloudstack.org/systemvm/4.14/md5sum.txt\ncf58913fb5cc830749760895dc9f406f  systemvmtemplate-4.14.0-hyperv.vhd.zip\n4978e6e6140d167556f201496549a498  systemvmtemplate-4.14.0-kvm.qcow2.bz2\n3b8df36a9dc8b87ae3892da61d8e2679  systemvmtemplate-4.14.0-ovm.raw.bz2\n33cad72f858aef11c95df486b0f21938  systemvmtemplate-4.14.0-vmware.ova\n2e3078de2ccce760d537e06fd9b4c7c7  systemvmtemplate-4.14.0-xen.vhd.bz2", "url": "https://github.com/apache/cloudstack/pull/4297#discussion_r480964767", "createdAt": "2020-09-01T08:29:55Z", "author": {"login": "rhtyd"}, "path": "engine/schema/src/main/java/com/cloud/upgrade/dao/Upgrade41310to41400.java", "diffHunk": "@@ -136,12 +136,12 @@ private void updateSystemVmTemplates(final Connection conn) {\n \n         final Map<Hypervisor.HypervisorType, String> newTemplateChecksum = new HashMap<Hypervisor.HypervisorType, String>() {\n             {\n-                put(Hypervisor.HypervisorType.KVM, \"d15ed159be32151b07e3211caf9cb802\");\n-                put(Hypervisor.HypervisorType.XenServer, \"fcaf1abc9aa62e7ed75f62b3092a01a2\");\n-                put(Hypervisor.HypervisorType.VMware, \"eb39f8b5a556dfc93c6be23ae45f34e1\");\n-                put(Hypervisor.HypervisorType.Hyperv, \"b4e91c14958e0fca9470695b0be05f99\");\n-                put(Hypervisor.HypervisorType.LXC, \"d15ed159be32151b07e3211caf9cb802\");\n-                put(Hypervisor.HypervisorType.Ovm3, \"1f97f4beb30af8cda886f1e977514704\");\n+                put(Hypervisor.HypervisorType.KVM, \"4978e6e6140d167556f201496549a498\");\n+                put(Hypervisor.HypervisorType.XenServer, \"2e3078de2ccce760d537e06fd9b4c7c7\");\n+                put(Hypervisor.HypervisorType.VMware, \"33cad72f858aef11c95df486b0f21938\");\n+                put(Hypervisor.HypervisorType.Hyperv, \"cf58913fb5cc830749760895dc9f406f\");\n+                put(Hypervisor.HypervisorType.LXC, \"4978e6e6140d167556f201496549a498\");\n+                put(Hypervisor.HypervisorType.Ovm3, \"3b8df36a9dc8b87ae3892da61d8e2679\");", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "69eb61bbca0dfbeece8ed938489c05b36a3c9604"}, "originalPosition": 15}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDc5NTE0NTQw", "url": "https://github.com/apache/cloudstack/pull/4297#pullrequestreview-479514540", "createdAt": "2020-09-01T08:30:04Z", "commit": {"oid": "69eb61bbca0dfbeece8ed938489c05b36a3c9604"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDgzNzE0ODE0", "url": "https://github.com/apache/cloudstack/pull/4297#pullrequestreview-483714814", "createdAt": "2020-09-07T21:50:00Z", "commit": {"oid": "69eb61bbca0dfbeece8ed938489c05b36a3c9604"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4093, "cost": 1, "resetAt": "2021-10-28T17:48:14Z"}}}