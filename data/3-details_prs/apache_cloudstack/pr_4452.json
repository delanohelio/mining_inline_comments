{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTE2NjkyNTU0", "number": 4452, "title": "Consider other conditions while listing templates with id", "bodyText": "Description\n\nMany of the searching conditions are not considered when\ntemplate id is passed but they are considered only when\ntemplate id is not passed. Move other conditions out of else\npart so that they will be considered when id is passed.\n\n\n\n\n\nTypes of changes\n\n\n Breaking change (fix or feature that would cause existing functionality to change)\n New feature (non-breaking change which adds functionality)\n Bug fix (non-breaking change which fixes an issue)\n Enhancement (improves an existing feature and functionality)\n Cleanup (Code refactoring and cleanup, that may add test cases)\n\nScreenshots (if appropriate):\nHow Has This Been Tested?\n\n\n\nWithout changes\n(local) mgt01 > list templates templatefilter=all filter=id,hypervisor, id=\"45be18c7-c0fd-11ea-ba74-067606003392\"\n{\n  \"count\": 1,\n  \"template\": [\n    {\n      \"hypervisor\": \"KVM\",\n      \"id\": \"45be18c7-c0fd-11ea-ba74-067606003392\"\n    }\n  ]\n}\n(local) mgt01 >\n(local) mgt01 >\n(local) mgt01 > list templates templatefilter=all filter=id,hypervisor, id=\"45be18c7-c0fd-11ea-ba74-067606003392\" hypervisor=XenServer\n{\n  \"count\": 1,\n  \"template\": [\n    {\n      \"hypervisor\": \"KVM\",\n      \"id\": \"45be18c7-c0fd-11ea-ba74-067606003392\"\n    }\n  ]\n}\n\nWith changes\n(local) mgt01 > list templates templatefilter=all filter=id,hypervisor id=\"d9411172-3832-4fc9-a771-39514e0a9faa\" hypervisor=KVM\n{\n  \"count\": 1,\n  \"template\": [\n    {\n      \"hypervisor\": \"KVM\",\n      \"id\": \"d9411172-3832-4fc9-a771-39514e0a9faa\"\n    }\n  ]\n}\n(local) mgt01 > list templates templatefilter=all filter=id,hypervisor id=\"d9411172-3832-4fc9-a771-39514e0a9faa\" hypervisor=XenServer\n(local) mgt01 >", "createdAt": "2020-11-06T11:44:35Z", "url": "https://github.com/apache/cloudstack/pull/4452", "merged": true, "mergeCommit": {"oid": "2f5ed9eee4ce7297660fd93185c09a70ce2b466c"}, "closed": true, "closedAt": "2020-11-17T19:03:49Z", "author": {"login": "ravening"}, "timelineItems": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdZ1WMSgH2gAyNTE2NjkyNTU0OjM4OGYzMmY2YmIxMDE1YzhhMWM1MzJjYmZjZWUzYjlkZDQ3YjVjNjI=", "endCursor": "Y3Vyc29yOnYyOpPPAAABddVNBSAFqTUzMjExODUxMQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "388f32f6bb1015c8a1c532cbfcee3b9dd47b5c62", "author": {"user": {"login": "ravening", "name": "Rakesh"}}, "url": "https://github.com/apache/cloudstack/commit/388f32f6bb1015c8a1c532cbfcee3b9dd47b5c62", "committedDate": "2020-11-06T11:34:33Z", "message": "Consider other conditions while listing templates with id\n\nMany of the searching conditions are not considered when\ntemplate id is passed but they are considered only when\ntemplate id is not passed. Move other conditions out of else\npart so that they will be considered when id is passed."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTI1MjM3MDE1", "url": "https://github.com/apache/cloudstack/pull/4452#pullrequestreview-525237015", "createdAt": "2020-11-06T15:06:37Z", "commit": {"oid": "388f32f6bb1015c8a1c532cbfcee3b9dd47b5c62"}, "state": "APPROVED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wNlQxNTowNjozN1rOHuxrIQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wNlQxNTowODowOFrOHuxu9g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxODgxMDQwMQ==", "bodyText": "\ud83d\udc4d", "url": "https://github.com/apache/cloudstack/pull/4452#discussion_r518810401", "createdAt": "2020-11-06T15:06:37Z", "author": {"login": "DaanHoogland"}, "path": "server/src/main/java/com/cloud/api/query/QueryManagerImpl.java", "diffHunk": "@@ -3434,11 +3434,6 @@ else if (!template.isPublicTemplate() && caller.getType() != Account.ACCOUNT_TYP\n                 domain = _domainDao.findById(Domain.ROOT_DOMAIN);\n             }\n \n-            // List<HypervisorType> hypers = null;\n-            // if (!isIso) {\n-            // hypers = _resourceMgr.listAvailHypervisorInZone(null, null);\n-            // }\n-", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "388f32f6bb1015c8a1c532cbfcee3b9dd47b5c62"}, "originalPosition": 8}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxODgxMTM4Mg==", "bodyText": "can you make it a method and put the call ...", "url": "https://github.com/apache/cloudstack/pull/4452#discussion_r518811382", "createdAt": "2020-11-06T15:08:08Z", "author": {"login": "DaanHoogland"}, "path": "server/src/main/java/com/cloud/api/query/QueryManagerImpl.java", "diffHunk": "@@ -3486,17 +3481,6 @@ else if (!template.isPublicTemplate() && caller.getType() != Account.ACCOUNT_TYP\n                 }\n             }\n \n-            if (!isIso) {\n-                // add hypervisor criteria for template case\n-                if (hypers != null && !hypers.isEmpty()) {\n-                    String[] relatedHypers = new String[hypers.size()];\n-                    for (int i = 0; i < hypers.size(); i++) {\n-                        relatedHypers[i] = hypers.get(i).toString();\n-                    }\n-                    sc.addAnd(\"hypervisorType\", SearchCriteria.Op.IN, relatedHypers);\n-                }\n-            }\n-", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "388f32f6bb1015c8a1c532cbfcee3b9dd47b5c62"}, "originalPosition": 26}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "1a47099e5f2c0dc00ee2f6ab3a30bbe14b1a2435", "author": {"user": {"login": "ravening", "name": "Rakesh"}}, "url": "https://github.com/apache/cloudstack/commit/1a47099e5f2c0dc00ee2f6ab3a30bbe14b1a2435", "committedDate": "2020-11-06T15:26:21Z", "message": "Move to functions"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTMyMTE4NTEx", "url": "https://github.com/apache/cloudstack/pull/4452#pullrequestreview-532118511", "createdAt": "2020-11-17T08:23:16Z", "commit": {"oid": "1a47099e5f2c0dc00ee2f6ab3a30bbe14b1a2435"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4774, "cost": 1, "resetAt": "2021-10-28T17:48:14Z"}}}