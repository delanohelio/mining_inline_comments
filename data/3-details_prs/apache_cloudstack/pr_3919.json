{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0MzgxMzYxMjEz", "number": 3919, "title": "Handle EOFException during VR Health Check", "bodyText": "Description\nVR health check throws EOFException due to malformed/Invalid JSON.\nAddresses issue: #3893\nTypes of changes\n\n\n Breaking change (fix or feature that would cause existing functionality to change)\n New feature (non-breaking change which adds functionality)\n Bug fix (non-breaking change which fixes an issue)\n Enhancement (improves an existing feature and functionality)\n Cleanup (Code refactoring and cleanup, that may add test cases)", "createdAt": "2020-02-28T12:16:03Z", "url": "https://github.com/apache/cloudstack/pull/3919", "merged": true, "mergeCommit": {"oid": "44d28f19942450074a2935c3871f55a9f8a60842"}, "closed": true, "closedAt": "2020-03-06T08:00:54Z", "author": {"login": "Pearl1594"}, "timelineItems": {"totalCount": 12, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcIu3KtAH2gAyMzgxMzYxMjEzOjZmOTcyOGNkN2VjMDU4NDMzMDMzMTFhZGY4YzZjN2RjNTg0MTU1OTM=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcKnHOjgFqTM2OTM2NzA2Mw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "6f9728cd7ec05843303311adf8c6c7dc58415593", "author": {"user": null}, "url": "https://github.com/apache/cloudstack/commit/6f9728cd7ec05843303311adf8c6c7dc58415593", "committedDate": "2020-02-28T12:13:22Z", "message": "Handle EOFException during VR Health Check"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzY2NTA1MjQw", "url": "https://github.com/apache/cloudstack/pull/3919#pullrequestreview-366505240", "createdAt": "2020-02-28T16:01:07Z", "commit": {"oid": "6f9728cd7ec05843303311adf8c6c7dc58415593"}, "state": "COMMENTED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e6af6c9f360a16920a2edb6ce9bb68a8c5345513", "author": {"user": null}, "url": "https://github.com/apache/cloudstack/commit/e6af6c9f360a16920a2edb6ce9bb68a8c5345513", "committedDate": "2020-03-01T18:00:54Z", "message": "Handled EOF exception with VR health check"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzY3MDA4MjYz", "url": "https://github.com/apache/cloudstack/pull/3919#pullrequestreview-367008263", "createdAt": "2020-03-02T08:11:56Z", "commit": {"oid": "e6af6c9f360a16920a2edb6ce9bb68a8c5345513"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wMlQwODoxMTo1NlrOFwWfJw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wMlQwODoxMTo1NlrOFwWfJw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NjI0NDM5MQ==", "bodyText": "@Pearl1594 what's this magic number?", "url": "https://github.com/apache/cloudstack/pull/3919#discussion_r386244391", "createdAt": "2020-03-02T08:11:56Z", "author": {"login": "rhtyd"}, "path": "utils/src/main/java/com/cloud/utils/ssh/SshHelper.java", "diffHunk": "@@ -184,12 +185,11 @@ public static void scpTo(String host, int port, String user, File pemKeyFile, St\n \n             sess.execCommand(command);\n \n-            InputStream stdout = sess.getStdout();\n-            InputStream stderr = sess.getStderr();\n-\n-            byte[] buffer = new byte[8192];\n-            StringBuffer sbResult = new StringBuffer();\n+            StreamGobbler stdout = new StreamGobbler(sess.getStdout());\n+            StreamGobbler stderr = new StreamGobbler(sess.getStderr());\n \n+            byte[] buffer = new byte[16384];\n+            StringBuffer sbResult = new StringBuffer(214748364);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "e6af6c9f360a16920a2edb6ce9bb68a8c5345513"}, "originalPosition": 21}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzY3MTEwODQy", "url": "https://github.com/apache/cloudstack/pull/3919#pullrequestreview-367110842", "createdAt": "2020-03-02T10:57:43Z", "commit": {"oid": "e6af6c9f360a16920a2edb6ce9bb68a8c5345513"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "3ce9af87ed9eef867e306c411003aa7b86c2ccd6", "author": {"user": null}, "url": "https://github.com/apache/cloudstack/commit/3ce9af87ed9eef867e306c411003aa7b86c2ccd6", "committedDate": "2020-03-03T11:07:52Z", "message": "Handle EOF Exception"}, "afterCommit": {"oid": "5e769bcff8a13c0588bdfdca1fa1ce4e86a6cee2", "author": {"user": null}, "url": "https://github.com/apache/cloudstack/commit/5e769bcff8a13c0588bdfdca1fa1ce4e86a6cee2", "committedDate": "2020-03-03T11:21:38Z", "message": "Handle EOF Exception"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "5e769bcff8a13c0588bdfdca1fa1ce4e86a6cee2", "author": {"user": null}, "url": "https://github.com/apache/cloudstack/commit/5e769bcff8a13c0588bdfdca1fa1ce4e86a6cee2", "committedDate": "2020-03-03T11:21:38Z", "message": "Handle EOF Exception"}, "afterCommit": {"oid": "d94aa9ecc30bea11bd2ff1aa7e9d9a9349551d0c", "author": {"user": null}, "url": "https://github.com/apache/cloudstack/commit/d94aa9ecc30bea11bd2ff1aa7e9d9a9349551d0c", "committedDate": "2020-03-03T11:24:18Z", "message": "Handle EOF Exception"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzY3OTAzNzEx", "url": "https://github.com/apache/cloudstack/pull/3919#pullrequestreview-367903711", "createdAt": "2020-03-03T11:32:31Z", "commit": {"oid": "d94aa9ecc30bea11bd2ff1aa7e9d9a9349551d0c"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wM1QxMTozMjozMVrOFxCMuA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wM1QxMTozMjozMVrOFxCMuA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4Njk2MDU2OA==", "bodyText": "@Pearl1594 instead of > 0 we probably want to check for readbytes != -1. For example: (comments only for your understanding)\ncurrentReadBytes = stdout.read(buffer);\nwhile (currentReadBytes >= 0) { // or check for != -1\n  sbResult.append(new String(buffer, 0, currentReadBytes));\n  currentReadBytes = stdout.read(buffer); // read() will return -1 on eof/complete\n}\n\nThe other option is to use a more modern java-way to use BufferedReader for example like:\n BufferedReader bufferedStdOut = new BufferedReader(stdout);\n.... use", "url": "https://github.com/apache/cloudstack/pull/3919#discussion_r386960568", "createdAt": "2020-03-03T11:32:31Z", "author": {"login": "rhtyd"}, "path": "utils/src/main/java/com/cloud/utils/ssh/SshHelper.java", "diffHunk": "@@ -207,22 +206,18 @@ public static void scpTo(String host, int port, String user, File pemKeyFile, St\n                     if (canEndTheSshConnection(waitResultTimeoutInMs, sess, conditions)) {\n                         break;\n                     }\n-\n                 }\n \n-                while (stdout.available() > 0) {\n-                    currentReadBytes = stdout.read(buffer);\n-                    sbResult.append(new String(buffer, 0, currentReadBytes));\n+               while((currentReadBytes = stdout.read(buffer)) > 0) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d94aa9ecc30bea11bd2ff1aa7e9d9a9349551d0c"}, "originalPosition": 18}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "4d4031722d6cfeb9d9899cfb8445c094f150bda8", "author": {"user": null}, "url": "https://github.com/apache/cloudstack/commit/4d4031722d6cfeb9d9899cfb8445c094f150bda8", "committedDate": "2020-03-03T12:00:25Z", "message": "Handle EOF Exception"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "d94aa9ecc30bea11bd2ff1aa7e9d9a9349551d0c", "author": {"user": null}, "url": "https://github.com/apache/cloudstack/commit/d94aa9ecc30bea11bd2ff1aa7e9d9a9349551d0c", "committedDate": "2020-03-03T11:24:18Z", "message": "Handle EOF Exception"}, "afterCommit": {"oid": "4d4031722d6cfeb9d9899cfb8445c094f150bda8", "author": {"user": null}, "url": "https://github.com/apache/cloudstack/commit/4d4031722d6cfeb9d9899cfb8445c094f150bda8", "committedDate": "2020-03-03T12:00:25Z", "message": "Handle EOF Exception"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzY4NTQ2MTE1", "url": "https://github.com/apache/cloudstack/pull/3919#pullrequestreview-368546115", "createdAt": "2020-03-04T07:12:26Z", "commit": {"oid": "4d4031722d6cfeb9d9899cfb8445c094f150bda8"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzY5MzY3MDYz", "url": "https://github.com/apache/cloudstack/pull/3919#pullrequestreview-369367063", "createdAt": "2020-03-05T08:19:32Z", "commit": {"oid": "4d4031722d6cfeb9d9899cfb8445c094f150bda8"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4448, "cost": 1, "resetAt": "2021-10-28T17:48:14Z"}}}