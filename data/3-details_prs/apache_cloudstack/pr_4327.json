{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDg2NzI5Njgz", "number": 4327, "title": "Re-enable IP address usage hiding", "bodyText": "Description\nWith this commit, listUsageRecords filters out usages made on IP addresses on networks with \"Hide IP Address Usage\". This was previously introduced in #3235.\nThis requires a DB schema change, to introduce a flag is_hidden in table cloud_usage.cloud_usage.\nCf. #4193\nTypes of changes\n\n\n Breaking change (fix or feature that would cause existing functionality to change)\n New feature (non-breaking change which adds functionality)\n Bug fix (non-breaking change which fixes an issue)\n Enhancement (improves an existing feature and functionality)\n Cleanup (Code refactoring and cleanup, that may add test cases)\n\nHow Has This Been Tested?\nMultiple IP addresses have been created.\n\nThose on shared networks without \"Hide IP Address Usage\" generate usages normally;\nThose on shared networks with \"Hide IP Address Usage\" generate usages with flag is_hidden, and are not returned by the API.", "createdAt": "2020-09-14T16:11:14Z", "url": "https://github.com/apache/cloudstack/pull/4327", "merged": true, "mergeCommit": {"oid": "5f8289ffe90fd829493bf4e0d23c64ef50313627"}, "closed": true, "closedAt": "2020-11-07T09:42:45Z", "author": {"login": "olivierlemasle"}, "timelineItems": {"totalCount": 7, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdMBvGwgBqjM4MDM0MjE2MzA=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdaHkufgFqTUyNTYzODcxNA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "5874150e72752c36a3fb146bc7c69b10224a0f4e", "author": {"user": {"login": "olivierlemasle", "name": "Olivier Lemasle"}}, "url": "https://github.com/apache/cloudstack/commit/5874150e72752c36a3fb146bc7c69b10224a0f4e", "committedDate": "2020-09-24T14:02:28Z", "message": "Merge branch 'master' into hide_ip_address_usages"}, "afterCommit": {"oid": "a28dad560f96e87bddb0b57d2e19fd058ac9eff1", "author": {"user": {"login": "olivierlemasle", "name": "Olivier Lemasle"}}, "url": "https://github.com/apache/cloudstack/commit/a28dad560f96e87bddb0b57d2e19fd058ac9eff1", "committedDate": "2020-09-24T14:05:29Z", "message": "Merge branch 'master' into hide_ip_address_usages"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "a28dad560f96e87bddb0b57d2e19fd058ac9eff1", "author": {"user": {"login": "olivierlemasle", "name": "Olivier Lemasle"}}, "url": "https://github.com/apache/cloudstack/commit/a28dad560f96e87bddb0b57d2e19fd058ac9eff1", "committedDate": "2020-09-24T14:05:29Z", "message": "Merge branch 'master' into hide_ip_address_usages"}, "afterCommit": {"oid": "dfa2184f8407176647db6fa9b9fb706a931dae93", "author": {"user": {"login": "olivierlemasle", "name": "Olivier Lemasle"}}, "url": "https://github.com/apache/cloudstack/commit/dfa2184f8407176647db6fa9b9fb706a931dae93", "committedDate": "2020-10-30T10:51:56Z", "message": "network: Re-enable IP address usage hiding\n\nWith this commit, listUsageRecords filters out usages made on\nIP addresses on networks with \"Hide IP Address Usage\". This was\npreviously introduced in #3235.\n\nThis requires a DB schema change, to introduce a flag is_hidden\nin table cloud_usage.cloud_usage."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTIwNjQ2OTYx", "url": "https://github.com/apache/cloudstack/pull/4327#pullrequestreview-520646961", "createdAt": "2020-10-30T13:05:56Z", "commit": {"oid": "dfa2184f8407176647db6fa9b9fb706a931dae93"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTI1MDA1ODEz", "url": "https://github.com/apache/cloudstack/pull/4327#pullrequestreview-525005813", "createdAt": "2020-11-06T09:55:29Z", "commit": {"oid": "dfa2184f8407176647db6fa9b9fb706a931dae93"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wNlQwOTo1NTozMFrOHunXSA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wNlQwOTo1NTozMFrOHunXSA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxODY0MTQ4MA==", "bodyText": "if it shouldn't happen, isn't it really an exception?", "url": "https://github.com/apache/cloudstack/pull/4327#discussion_r518641480", "createdAt": "2020-11-06T09:55:30Z", "author": {"login": "DaanHoogland"}, "path": "server/src/main/java/com/cloud/network/IpAddressManagerImpl.java", "diffHunk": "@@ -2238,4 +2245,18 @@ public boolean isIpEqualsGatewayOrNetworkOfferingsEmpty(Network network, String\n         }\n         return false;\n     }\n+\n+    @Override\n+    public boolean isUsageHidden(IPAddressVO ip) {\n+        Long networkId = ip.getAssociatedWithNetworkId();\n+        if (networkId == null) {\n+            networkId = ip.getSourceNetworkId();\n+        }\n+        if (networkId == null) {\n+            // Should not happen", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "dfa2184f8407176647db6fa9b9fb706a931dae93"}, "originalPosition": 66}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "db65fbdc36180d45a1e0705b7848be1dc99c0431", "author": {"user": {"login": "olivierlemasle", "name": "Olivier Lemasle"}}, "url": "https://github.com/apache/cloudstack/commit/db65fbdc36180d45a1e0705b7848be1dc99c0431", "committedDate": "2020-11-06T10:44:43Z", "message": "network: Re-enable IP address usage hiding\n\nWith this commit, listUsageRecords filters out usages made on\nIP addresses on networks with \"Hide IP Address Usage\". This was\npreviously introduced in #3235.\n\nThis requires a DB schema change, to introduce a flag is_hidden\nin table cloud_usage.cloud_usage."}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "dfa2184f8407176647db6fa9b9fb706a931dae93", "author": {"user": {"login": "olivierlemasle", "name": "Olivier Lemasle"}}, "url": "https://github.com/apache/cloudstack/commit/dfa2184f8407176647db6fa9b9fb706a931dae93", "committedDate": "2020-10-30T10:51:56Z", "message": "network: Re-enable IP address usage hiding\n\nWith this commit, listUsageRecords filters out usages made on\nIP addresses on networks with \"Hide IP Address Usage\". This was\npreviously introduced in #3235.\n\nThis requires a DB schema change, to introduce a flag is_hidden\nin table cloud_usage.cloud_usage."}, "afterCommit": {"oid": "db65fbdc36180d45a1e0705b7848be1dc99c0431", "author": {"user": {"login": "olivierlemasle", "name": "Olivier Lemasle"}}, "url": "https://github.com/apache/cloudstack/commit/db65fbdc36180d45a1e0705b7848be1dc99c0431", "committedDate": "2020-11-06T10:44:43Z", "message": "network: Re-enable IP address usage hiding\n\nWith this commit, listUsageRecords filters out usages made on\nIP addresses on networks with \"Hide IP Address Usage\". This was\npreviously introduced in #3235.\n\nThis requires a DB schema change, to introduce a flag is_hidden\nin table cloud_usage.cloud_usage."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTI1NjM4NzE0", "url": "https://github.com/apache/cloudstack/pull/4327#pullrequestreview-525638714", "createdAt": "2020-11-07T08:48:43Z", "commit": {"oid": "db65fbdc36180d45a1e0705b7848be1dc99c0431"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4861, "cost": 1, "resetAt": "2021-10-28T17:48:14Z"}}}