{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0MzcwNzQ4ODA3", "number": 3862, "reviewThreads": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xOVQyMDoxNjozOFrODhNQ8Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xOVQyMDoxNjozOFrODhNQ8Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjM2MTQ2OTI5OnYy", "diffSide": "RIGHT", "path": "server/src/main/java/com/cloud/network/router/CommandSetupHelper.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xOVQyMDoxNjozOFrOFr2ITA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yMFQwOTozNzowNlrOFsMTHg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MTUxOTk0OA==", "bodyText": "@ravening you missed one check here\n-            } else {\n+            } else if (router.getPublicIpAddress() != null) {", "url": "https://github.com/apache/cloudstack/pull/3862#discussion_r381519948", "createdAt": "2020-02-19T20:16:38Z", "author": {"login": "weizhouapache"}, "path": "server/src/main/java/com/cloud/network/router/CommandSetupHelper.java", "diffHunk": "@@ -1024,18 +1026,21 @@ private VmDataCommand generateVmDataCommand(final VirtualRouter router, final St\n         cmd.addVmData(\"userdata\", \"user-data\", userData);\n         cmd.addVmData(\"metadata\", \"service-offering\", StringUtils.unicodeEscape(serviceOffering));\n         cmd.addVmData(\"metadata\", \"availability-zone\", StringUtils.unicodeEscape(zoneName));\n-        cmd.addVmData(\"metadata\", \"local-ipv4\", guestIpAddress);\n+        cmd.addVmData(\"metadata\", \"local-ipv4\", vmPrivateIpAddress);\n         cmd.addVmData(\"metadata\", \"local-hostname\", StringUtils.unicodeEscape(vmName));\n-        if (dcVo.getNetworkType() == NetworkType.Basic) {\n-            cmd.addVmData(\"metadata\", \"public-ipv4\", guestIpAddress);\n+\n+        Network network = _networkDao.findById(guestNetworkId);\n+        if (dcVo.getNetworkType() == NetworkType.Basic || network.getGuestType() == Network.GuestType.Shared) {\n+            cmd.addVmData(\"metadata\", \"public-ipv4\", vmPrivateIpAddress);\n             cmd.addVmData(\"metadata\", \"public-hostname\", StringUtils.unicodeEscape(vmName));\n         } else {\n-            if (router.getPublicIpAddress() == null) {\n-                cmd.addVmData(\"metadata\", \"public-ipv4\", guestIpAddress);\n+            if (publicIpAddress != null) {\n+                cmd.addVmData(\"metadata\", \"public-ipv4\", publicIpAddress);\n+                cmd.addVmData(\"metadata\", \"public-hostname\", publicIpAddress);\n             } else {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b131cf1961414170c793fb09f050477d8d83340f"}, "originalPosition": 42}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MTg4MzE2Ng==", "bodyText": "Made necessary changes", "url": "https://github.com/apache/cloudstack/pull/3862#discussion_r381883166", "createdAt": "2020-02-20T09:37:06Z", "author": {"login": "ravening"}, "path": "server/src/main/java/com/cloud/network/router/CommandSetupHelper.java", "diffHunk": "@@ -1024,18 +1026,21 @@ private VmDataCommand generateVmDataCommand(final VirtualRouter router, final St\n         cmd.addVmData(\"userdata\", \"user-data\", userData);\n         cmd.addVmData(\"metadata\", \"service-offering\", StringUtils.unicodeEscape(serviceOffering));\n         cmd.addVmData(\"metadata\", \"availability-zone\", StringUtils.unicodeEscape(zoneName));\n-        cmd.addVmData(\"metadata\", \"local-ipv4\", guestIpAddress);\n+        cmd.addVmData(\"metadata\", \"local-ipv4\", vmPrivateIpAddress);\n         cmd.addVmData(\"metadata\", \"local-hostname\", StringUtils.unicodeEscape(vmName));\n-        if (dcVo.getNetworkType() == NetworkType.Basic) {\n-            cmd.addVmData(\"metadata\", \"public-ipv4\", guestIpAddress);\n+\n+        Network network = _networkDao.findById(guestNetworkId);\n+        if (dcVo.getNetworkType() == NetworkType.Basic || network.getGuestType() == Network.GuestType.Shared) {\n+            cmd.addVmData(\"metadata\", \"public-ipv4\", vmPrivateIpAddress);\n             cmd.addVmData(\"metadata\", \"public-hostname\", StringUtils.unicodeEscape(vmName));\n         } else {\n-            if (router.getPublicIpAddress() == null) {\n-                cmd.addVmData(\"metadata\", \"public-ipv4\", guestIpAddress);\n+            if (publicIpAddress != null) {\n+                cmd.addVmData(\"metadata\", \"public-ipv4\", publicIpAddress);\n+                cmd.addVmData(\"metadata\", \"public-hostname\", publicIpAddress);\n             } else {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MTUxOTk0OA=="}, "originalCommit": {"oid": "b131cf1961414170c793fb09f050477d8d83340f"}, "originalPosition": 42}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4021, "cost": 1, "resetAt": "2021-11-12T11:18:39Z"}}}