{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTE5Nzc1OTYw", "number": 4467, "title": "vpc: fix ips on wrong interfaces after rebooting vpc vrs", "bodyText": "Description\n\n\n\n\n\n\nWhen vpc tiers are added/removed and public ips in different range is added/removed, the nics in VPC VRs are added/removed, it leads to inconsecutive device in VPC VRs.\nWhen we reboot the VR, (or VR is rebooted by some other reasons like HA), the ips in VPC VRs might be assigned to wrong interfaces.\nTypes of changes\n\n\n Breaking change (fix or feature that would cause existing functionality to change)\n New feature (non-breaking change which adds functionality)\n Bug fix (non-breaking change which fixes an issue)\n Enhancement (improves an existing feature and functionality)\n Cleanup (Code refactoring and cleanup, that may add test cases)\n\nScreenshots (if appropriate):\nHow Has This Been Tested?", "createdAt": "2020-11-12T10:17:30Z", "url": "https://github.com/apache/cloudstack/pull/4467", "merged": true, "mergeCommit": {"oid": "75fdb07387eaaf07365a612f9035cbd98d98cb1b"}, "closed": true, "closedAt": "2020-11-20T15:32:53Z", "author": {"login": "ustcweizhou"}, "timelineItems": {"totalCount": 8, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdbusx0AH2gAyNTE5Nzc1OTYwOjUyMmY0ZWJhYzJiYzE0ZTE3Y2RmNGE2MmRkMmFmNDdhODQ1NzM2MWM=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdd2r6ygFqTUzMzk2MjA5Mg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "522f4ebac2bc14e17cdf4a62dd2af47a8457361c", "author": {"user": {"login": "ustcweizhou", "name": "Wei Zhou"}}, "url": "https://github.com/apache/cloudstack/commit/522f4ebac2bc14e17cdf4a62dd2af47a8457361c", "committedDate": "2020-11-12T08:57:44Z", "message": "vpc: fix ips on wrong interfaces after rebooting vpc vrs"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTI4OTcyNTA5", "url": "https://github.com/apache/cloudstack/pull/4467#pullrequestreview-528972509", "createdAt": "2020-11-12T10:57:59Z", "commit": {"oid": "522f4ebac2bc14e17cdf4a62dd2af47a8457361c"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xMlQxMDo1Nzo1OVrOHx1cpA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xMlQxMDo1Nzo1OVrOHx1cpA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMjAxNzk1Ng==", "bodyText": "method name is not clear, Either define & use separate methods (for \"updating nic device id\" and \"getting nic with device id\"), or change the name appropriately.", "url": "https://github.com/apache/cloudstack/pull/4467#discussion_r522017956", "createdAt": "2020-11-12T10:57:59Z", "author": {"login": "sureshanaparti"}, "path": "server/src/main/java/com/cloud/network/router/VpcVirtualNetworkApplianceManagerImpl.java", "diffHunk": "@@ -834,4 +837,11 @@ public boolean postStateTransitionEvent(final StateMachine2.Transition<State, Vi\n         // once from VpcVirtualNetworkApplianceManagerImpl and once from VirtualNetworkApplianceManagerImpl itself\n         return true;\n     }\n+\n+    private Nic getNicWithUpdatedDeviceId(final long nicId, int deviceId) {\n+        NicVO nic = _nicDao.findById(nicId);\n+        nic.setDeviceId(deviceId);\n+        _nicDao.update(nic.getId(), nic);\n+        return nic;\n+    }", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "522f4ebac2bc14e17cdf4a62dd2af47a8457361c"}, "originalPosition": 38}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "eba9c867b8ff6473d7eec9aa7fa997fe0576f743", "author": {"user": {"login": "ustcweizhou", "name": "Wei Zhou"}}, "url": "https://github.com/apache/cloudstack/commit/eba9c867b8ff6473d7eec9aa7fa997fe0576f743", "committedDate": "2020-11-13T12:49:04Z", "message": " #4467: Rename to updateNicWithDeviceId"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTMwNTY1NTky", "url": "https://github.com/apache/cloudstack/pull/4467#pullrequestreview-530565592", "createdAt": "2020-11-14T09:15:15Z", "commit": {"oid": "eba9c867b8ff6473d7eec9aa7fa997fe0576f743"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f6038166c5c1a46fe383a9ee059ae397d948baff", "author": {"user": {"login": "ustcweizhou", "name": "Wei Zhou"}}, "url": "https://github.com/apache/cloudstack/commit/f6038166c5c1a46fe383a9ee059ae397d948baff", "committedDate": "2020-11-17T20:28:00Z", "message": "CLSTACK-8923 vr: Force a restart of keepalived if conntrackd is not running or configuration has changed"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTMzMTUzMTA0", "url": "https://github.com/apache/cloudstack/pull/4467#pullrequestreview-533153104", "createdAt": "2020-11-18T07:07:56Z", "commit": {"oid": "f6038166c5c1a46fe383a9ee059ae397d948baff"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTMzMjMyOTc2", "url": "https://github.com/apache/cloudstack/pull/4467#pullrequestreview-533232976", "createdAt": "2020-11-18T09:05:54Z", "commit": {"oid": "f6038166c5c1a46fe383a9ee059ae397d948baff"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTMzOTYyMDky", "url": "https://github.com/apache/cloudstack/pull/4467#pullrequestreview-533962092", "createdAt": "2020-11-18T23:23:53Z", "commit": {"oid": "f6038166c5c1a46fe383a9ee059ae397d948baff"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4796, "cost": 1, "resetAt": "2021-10-28T17:48:14Z"}}}