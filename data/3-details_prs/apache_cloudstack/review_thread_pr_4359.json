{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDk1ODM0NjYz", "number": 4359, "reviewThreads": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xMlQxNzowMDoxMVrOEstfBQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yOFQxMDo0NDowNFrOEywGKg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzE1MzE4MDIxOnYy", "diffSide": "RIGHT", "path": "server/src/main/java/com/cloud/server/ManagementServerImpl.java", "isResolved": true, "comments": {"totalCount": 16, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xMlQxNzowMDoxMVrOHgGgXQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yMFQwNjoxODoyMFrOHksNQg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMzQyMzA2OQ==", "bodyText": "username from the command object can be null or empty ?", "url": "https://github.com/apache/cloudstack/pull/4359#discussion_r503423069", "createdAt": "2020-10-12T17:00:11Z", "author": {"login": "sureshanaparti"}, "path": "server/src/main/java/com/cloud/server/ManagementServerImpl.java", "diffHunk": "@@ -3938,7 +3938,12 @@ public void doInTransactionWithoutResult(final TransactionStatus status) {\n                     }\n                     // update password for this host\n                     final DetailVO nv = _detailsDao.findDetail(h.getId(), ApiConstants.USERNAME);\n-                    if (nv.getValue().equals(command.getUsername())) {\n+                    if (nv == null) {\n+                        final DetailVO nvu = new DetailVO(h.getId(), ApiConstants.USERNAME, command.getUsername());", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "549dd14de57e19edeb6862e1286e673ed05033e1"}, "originalPosition": 6}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMzc1MDExNQ==", "bodyText": "@sureshanaparti username and password are mandatory parameters.. They cant be null\n(local) \ud83d\udc31 > update hostpassword hostid=50c8-b73a-4eaf-bbab-7a70\n\ud83d\udca9 Missing required parameters:  password, username", "url": "https://github.com/apache/cloudstack/pull/4359#discussion_r503750115", "createdAt": "2020-10-13T08:08:31Z", "author": {"login": "ravening"}, "path": "server/src/main/java/com/cloud/server/ManagementServerImpl.java", "diffHunk": "@@ -3938,7 +3938,12 @@ public void doInTransactionWithoutResult(final TransactionStatus status) {\n                     }\n                     // update password for this host\n                     final DetailVO nv = _detailsDao.findDetail(h.getId(), ApiConstants.USERNAME);\n-                    if (nv.getValue().equals(command.getUsername())) {\n+                    if (nv == null) {\n+                        final DetailVO nvu = new DetailVO(h.getId(), ApiConstants.USERNAME, command.getUsername());", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMzQyMzA2OQ=="}, "originalCommit": {"oid": "549dd14de57e19edeb6862e1286e673ed05033e1"}, "originalPosition": 6}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMzkxODYwMQ==", "bodyText": "@ravening empty \"\" (or) \"   \" username string ?", "url": "https://github.com/apache/cloudstack/pull/4359#discussion_r503918601", "createdAt": "2020-10-13T12:42:56Z", "author": {"login": "sureshanaparti"}, "path": "server/src/main/java/com/cloud/server/ManagementServerImpl.java", "diffHunk": "@@ -3938,7 +3938,12 @@ public void doInTransactionWithoutResult(final TransactionStatus status) {\n                     }\n                     // update password for this host\n                     final DetailVO nv = _detailsDao.findDetail(h.getId(), ApiConstants.USERNAME);\n-                    if (nv.getValue().equals(command.getUsername())) {\n+                    if (nv == null) {\n+                        final DetailVO nvu = new DetailVO(h.getId(), ApiConstants.USERNAME, command.getUsername());", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMzQyMzA2OQ=="}, "originalCommit": {"oid": "549dd14de57e19edeb6862e1286e673ed05033e1"}, "originalPosition": 6}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMzkyMDQ5NA==", "bodyText": "@ravening empty \"\" (or) \"   \" username string ?\n\n@sureshanaparti those are non null values", "url": "https://github.com/apache/cloudstack/pull/4359#discussion_r503920494", "createdAt": "2020-10-13T12:45:46Z", "author": {"login": "ravening"}, "path": "server/src/main/java/com/cloud/server/ManagementServerImpl.java", "diffHunk": "@@ -3938,7 +3938,12 @@ public void doInTransactionWithoutResult(final TransactionStatus status) {\n                     }\n                     // update password for this host\n                     final DetailVO nv = _detailsDao.findDetail(h.getId(), ApiConstants.USERNAME);\n-                    if (nv.getValue().equals(command.getUsername())) {\n+                    if (nv == null) {\n+                        final DetailVO nvu = new DetailVO(h.getId(), ApiConstants.USERNAME, command.getUsername());", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMzQyMzA2OQ=="}, "originalCommit": {"oid": "549dd14de57e19edeb6862e1286e673ed05033e1"}, "originalPosition": 6}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNjEyODE4Ng==", "bodyText": "@sureshanaparti  Even if I dont pass username, I dont get NPE\n update hostpassword hostid=50436ac8-b73a-4eaf-bbab-7adbd9a50870 password=cloudstack username=\n\ud83d\ude48 Error: (HTTP 431, error code 4350) The username is not same for the hosts..", "url": "https://github.com/apache/cloudstack/pull/4359#discussion_r506128186", "createdAt": "2020-10-16T07:37:20Z", "author": {"login": "ravening"}, "path": "server/src/main/java/com/cloud/server/ManagementServerImpl.java", "diffHunk": "@@ -3938,7 +3938,12 @@ public void doInTransactionWithoutResult(final TransactionStatus status) {\n                     }\n                     // update password for this host\n                     final DetailVO nv = _detailsDao.findDetail(h.getId(), ApiConstants.USERNAME);\n-                    if (nv.getValue().equals(command.getUsername())) {\n+                    if (nv == null) {\n+                        final DetailVO nvu = new DetailVO(h.getId(), ApiConstants.USERNAME, command.getUsername());", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMzQyMzA2OQ=="}, "originalCommit": {"oid": "549dd14de57e19edeb6862e1286e673ed05033e1"}, "originalPosition": 6}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNjE3NTQ5NQ==", "bodyText": "@ravening username is not null, but empty string, so can you add check for that ? Ex: \"StringUtils.isBlank(command.getUsername())\"", "url": "https://github.com/apache/cloudstack/pull/4359#discussion_r506175495", "createdAt": "2020-10-16T08:37:27Z", "author": {"login": "sureshanaparti"}, "path": "server/src/main/java/com/cloud/server/ManagementServerImpl.java", "diffHunk": "@@ -3938,7 +3938,12 @@ public void doInTransactionWithoutResult(final TransactionStatus status) {\n                     }\n                     // update password for this host\n                     final DetailVO nv = _detailsDao.findDetail(h.getId(), ApiConstants.USERNAME);\n-                    if (nv.getValue().equals(command.getUsername())) {\n+                    if (nv == null) {\n+                        final DetailVO nvu = new DetailVO(h.getId(), ApiConstants.USERNAME, command.getUsername());", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMzQyMzA2OQ=="}, "originalCommit": {"oid": "549dd14de57e19edeb6862e1286e673ed05033e1"}, "originalPosition": 6}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNjE3NzU2Nw==", "bodyText": "@ravening username is not null, but empty string, so can you add check for that ? Ex: \"StringUtils.isBlank(command.getUsername())\"\n\n@sureshanaparti but why? For some hosts, username and password can be empty string", "url": "https://github.com/apache/cloudstack/pull/4359#discussion_r506177567", "createdAt": "2020-10-16T08:40:14Z", "author": {"login": "ravening"}, "path": "server/src/main/java/com/cloud/server/ManagementServerImpl.java", "diffHunk": "@@ -3938,7 +3938,12 @@ public void doInTransactionWithoutResult(final TransactionStatus status) {\n                     }\n                     // update password for this host\n                     final DetailVO nv = _detailsDao.findDetail(h.getId(), ApiConstants.USERNAME);\n-                    if (nv.getValue().equals(command.getUsername())) {\n+                    if (nv == null) {\n+                        final DetailVO nvu = new DetailVO(h.getId(), ApiConstants.USERNAME, command.getUsername());", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMzQyMzA2OQ=="}, "originalCommit": {"oid": "549dd14de57e19edeb6862e1286e673ed05033e1"}, "originalPosition": 6}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNjIyNTQ2NQ==", "bodyText": "@ravening if you pass username, then it shouldn't be empty, password can be empty. can you confirm if username  is persisted with empty value in the host_details table?", "url": "https://github.com/apache/cloudstack/pull/4359#discussion_r506225465", "createdAt": "2020-10-16T09:38:36Z", "author": {"login": "sureshanaparti"}, "path": "server/src/main/java/com/cloud/server/ManagementServerImpl.java", "diffHunk": "@@ -3938,7 +3938,12 @@ public void doInTransactionWithoutResult(final TransactionStatus status) {\n                     }\n                     // update password for this host\n                     final DetailVO nv = _detailsDao.findDetail(h.getId(), ApiConstants.USERNAME);\n-                    if (nv.getValue().equals(command.getUsername())) {\n+                    if (nv == null) {\n+                        final DetailVO nvu = new DetailVO(h.getId(), ApiConstants.USERNAME, command.getUsername());", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMzQyMzA2OQ=="}, "originalCommit": {"oid": "549dd14de57e19edeb6862e1286e673ed05033e1"}, "originalPosition": 6}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNjIzMTY3OA==", "bodyText": "@sureshanaparti\n(local) \ud83d\udc31 > update hostpassword hostid=50436ac8-b73a-4eaf-bbab-7adbd9a50870 password=cloudstack username=\"  \"\n\ud83d\ude48 Error: (HTTP 431, error code 4350) The username is not same for the hosts..\n(local) \ud83d\udc31 >\n(local) \ud83d\udc31 > update hostpassword hostid=50436ac8-b73a-4eaf-bbab-7adbd9a50870 password=cloudstack username=\"\"\n\ud83d\ude48 Error: (HTTP 431, error code 4350) The username is not same for the hosts..\n(local) \ud83d\udc31 >", "url": "https://github.com/apache/cloudstack/pull/4359#discussion_r506231678", "createdAt": "2020-10-16T09:46:05Z", "author": {"login": "ravening"}, "path": "server/src/main/java/com/cloud/server/ManagementServerImpl.java", "diffHunk": "@@ -3938,7 +3938,12 @@ public void doInTransactionWithoutResult(final TransactionStatus status) {\n                     }\n                     // update password for this host\n                     final DetailVO nv = _detailsDao.findDetail(h.getId(), ApiConstants.USERNAME);\n-                    if (nv.getValue().equals(command.getUsername())) {\n+                    if (nv == null) {\n+                        final DetailVO nvu = new DetailVO(h.getId(), ApiConstants.USERNAME, command.getUsername());", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMzQyMzA2OQ=="}, "originalCommit": {"oid": "549dd14de57e19edeb6862e1286e673ed05033e1"}, "originalPosition": 6}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNjI1MzEwNg==", "bodyText": "@ravening can you test your changes when \"nv == null\" with above username and share the persisted records in the host_details table?", "url": "https://github.com/apache/cloudstack/pull/4359#discussion_r506253106", "createdAt": "2020-10-16T10:07:27Z", "author": {"login": "sureshanaparti"}, "path": "server/src/main/java/com/cloud/server/ManagementServerImpl.java", "diffHunk": "@@ -3938,7 +3938,12 @@ public void doInTransactionWithoutResult(final TransactionStatus status) {\n                     }\n                     // update password for this host\n                     final DetailVO nv = _detailsDao.findDetail(h.getId(), ApiConstants.USERNAME);\n-                    if (nv.getValue().equals(command.getUsername())) {\n+                    if (nv == null) {\n+                        final DetailVO nvu = new DetailVO(h.getId(), ApiConstants.USERNAME, command.getUsername());", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMzQyMzA2OQ=="}, "originalCommit": {"oid": "549dd14de57e19edeb6862e1286e673ed05033e1"}, "originalPosition": 6}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNjI2ODQ0OA==", "bodyText": "@sureshanaparti\n(local) \ud83d\udc31 > update hostpassword hostid=f16d5515-8c53-4873-b395-dc439f5c67d6 password=cloudstack username=\" \"\n{\n  \"success\": true\n}\n\nthis is when nv is null", "url": "https://github.com/apache/cloudstack/pull/4359#discussion_r506268448", "createdAt": "2020-10-16T10:27:47Z", "author": {"login": "ravening"}, "path": "server/src/main/java/com/cloud/server/ManagementServerImpl.java", "diffHunk": "@@ -3938,7 +3938,12 @@ public void doInTransactionWithoutResult(final TransactionStatus status) {\n                     }\n                     // update password for this host\n                     final DetailVO nv = _detailsDao.findDetail(h.getId(), ApiConstants.USERNAME);\n-                    if (nv.getValue().equals(command.getUsername())) {\n+                    if (nv == null) {\n+                        final DetailVO nvu = new DetailVO(h.getId(), ApiConstants.USERNAME, command.getUsername());", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMzQyMzA2OQ=="}, "originalCommit": {"oid": "549dd14de57e19edeb6862e1286e673ed05033e1"}, "originalPosition": 6}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNjI3MzMzNA==", "bodyText": "can you share the entries in host_details table of that test?", "url": "https://github.com/apache/cloudstack/pull/4359#discussion_r506273334", "createdAt": "2020-10-16T10:33:25Z", "author": {"login": "sureshanaparti"}, "path": "server/src/main/java/com/cloud/server/ManagementServerImpl.java", "diffHunk": "@@ -3938,7 +3938,12 @@ public void doInTransactionWithoutResult(final TransactionStatus status) {\n                     }\n                     // update password for this host\n                     final DetailVO nv = _detailsDao.findDetail(h.getId(), ApiConstants.USERNAME);\n-                    if (nv.getValue().equals(command.getUsername())) {\n+                    if (nv == null) {\n+                        final DetailVO nvu = new DetailVO(h.getId(), ApiConstants.USERNAME, command.getUsername());", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMzQyMzA2OQ=="}, "originalCommit": {"oid": "549dd14de57e19edeb6862e1286e673ed05033e1"}, "originalPosition": 6}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNjYxNjA4NQ==", "bodyText": "can you share the entries in host_details table of that test?\n\nI think it's not going anywhere further. Can you let me know what exactly you are looking for?", "url": "https://github.com/apache/cloudstack/pull/4359#discussion_r506616085", "createdAt": "2020-10-16T17:21:30Z", "author": {"login": "ravening"}, "path": "server/src/main/java/com/cloud/server/ManagementServerImpl.java", "diffHunk": "@@ -3938,7 +3938,12 @@ public void doInTransactionWithoutResult(final TransactionStatus status) {\n                     }\n                     // update password for this host\n                     final DetailVO nv = _detailsDao.findDetail(h.getId(), ApiConstants.USERNAME);\n-                    if (nv.getValue().equals(command.getUsername())) {\n+                    if (nv == null) {\n+                        final DetailVO nvu = new DetailVO(h.getId(), ApiConstants.USERNAME, command.getUsername());", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMzQyMzA2OQ=="}, "originalCommit": {"oid": "549dd14de57e19edeb6862e1286e673ed05033e1"}, "originalPosition": 6}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNjYyODEyMQ==", "bodyText": "can you share the entries in host_details table of that test?\n\n@sureshanaparti  the last result I pasted was tested when host_details entry were removed for that host", "url": "https://github.com/apache/cloudstack/pull/4359#discussion_r506628121", "createdAt": "2020-10-16T17:41:58Z", "author": {"login": "ravening"}, "path": "server/src/main/java/com/cloud/server/ManagementServerImpl.java", "diffHunk": "@@ -3938,7 +3938,12 @@ public void doInTransactionWithoutResult(final TransactionStatus status) {\n                     }\n                     // update password for this host\n                     final DetailVO nv = _detailsDao.findDetail(h.getId(), ApiConstants.USERNAME);\n-                    if (nv.getValue().equals(command.getUsername())) {\n+                    if (nv == null) {\n+                        final DetailVO nvu = new DetailVO(h.getId(), ApiConstants.USERNAME, command.getUsername());", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMzQyMzA2OQ=="}, "originalCommit": {"oid": "549dd14de57e19edeb6862e1286e673ed05033e1"}, "originalPosition": 6}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwODE5OTY5MA==", "bodyText": "@ravening No point in saving password with username empty. Hope you got it. Wanted to confirm the same based on the entries persisted in host_details table for your test. Can you share these? Thanks.", "url": "https://github.com/apache/cloudstack/pull/4359#discussion_r508199690", "createdAt": "2020-10-20T04:18:29Z", "author": {"login": "sureshanaparti"}, "path": "server/src/main/java/com/cloud/server/ManagementServerImpl.java", "diffHunk": "@@ -3938,7 +3938,12 @@ public void doInTransactionWithoutResult(final TransactionStatus status) {\n                     }\n                     // update password for this host\n                     final DetailVO nv = _detailsDao.findDetail(h.getId(), ApiConstants.USERNAME);\n-                    if (nv.getValue().equals(command.getUsername())) {\n+                    if (nv == null) {\n+                        final DetailVO nvu = new DetailVO(h.getId(), ApiConstants.USERNAME, command.getUsername());", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMzQyMzA2OQ=="}, "originalCommit": {"oid": "549dd14de57e19edeb6862e1286e673ed05033e1"}, "originalPosition": 6}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwODIzNTA3NA==", "bodyText": "@sureshanaparti @ravening we had the issue in the past that Removed kvm host is added back to cloudstack when cloudstack-agent is started. in that case, there is no username/password saved in host_details for the host (because the entries are removed from db when host is removed, but not added back).", "url": "https://github.com/apache/cloudstack/pull/4359#discussion_r508235074", "createdAt": "2020-10-20T06:18:20Z", "author": {"login": "weizhouapache"}, "path": "server/src/main/java/com/cloud/server/ManagementServerImpl.java", "diffHunk": "@@ -3938,7 +3938,12 @@ public void doInTransactionWithoutResult(final TransactionStatus status) {\n                     }\n                     // update password for this host\n                     final DetailVO nv = _detailsDao.findDetail(h.getId(), ApiConstants.USERNAME);\n-                    if (nv.getValue().equals(command.getUsername())) {\n+                    if (nv == null) {\n+                        final DetailVO nvu = new DetailVO(h.getId(), ApiConstants.USERNAME, command.getUsername());", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMzQyMzA2OQ=="}, "originalCommit": {"oid": "549dd14de57e19edeb6862e1286e673ed05033e1"}, "originalPosition": 6}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzE1MzE4MzU3OnYy", "diffSide": "RIGHT", "path": "server/src/main/java/com/cloud/server/ManagementServerImpl.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xMlQxNzowMToxNVrOHgGiUg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yOFQxMDozOToyMVrOHpj2ZA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMzQyMzU3MA==", "bodyText": "cmd.getUsername() can be null or empty here, please check.", "url": "https://github.com/apache/cloudstack/pull/4359#discussion_r503423570", "createdAt": "2020-10-12T17:01:15Z", "author": {"login": "sureshanaparti"}, "path": "server/src/main/java/com/cloud/server/ManagementServerImpl.java", "diffHunk": "@@ -3994,7 +3999,12 @@ public void doInTransactionWithoutResult(final TransactionStatus status) {\n                 }\n                 // update password for this host\n                 final DetailVO nv = _detailsDao.findDetail(host.getId(), ApiConstants.USERNAME);\n-                if (nv.getValue().equals(cmd.getUsername())) {\n+                if (nv == null) {\n+                    final DetailVO nvu = new DetailVO(host.getId(), ApiConstants.USERNAME, cmd.getUsername());", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "549dd14de57e19edeb6862e1286e673ed05033e1"}, "originalPosition": 20}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMzM0MTAyOA==", "bodyText": "@ravening Username null or empty fix is not addressed here. Please check.", "url": "https://github.com/apache/cloudstack/pull/4359#discussion_r513341028", "createdAt": "2020-10-28T10:39:21Z", "author": {"login": "sureshanaparti"}, "path": "server/src/main/java/com/cloud/server/ManagementServerImpl.java", "diffHunk": "@@ -3994,7 +3999,12 @@ public void doInTransactionWithoutResult(final TransactionStatus status) {\n                 }\n                 // update password for this host\n                 final DetailVO nv = _detailsDao.findDetail(host.getId(), ApiConstants.USERNAME);\n-                if (nv.getValue().equals(cmd.getUsername())) {\n+                if (nv == null) {\n+                    final DetailVO nvu = new DetailVO(host.getId(), ApiConstants.USERNAME, cmd.getUsername());", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMzQyMzU3MA=="}, "originalCommit": {"oid": "549dd14de57e19edeb6862e1286e673ed05033e1"}, "originalPosition": 20}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzE5NTQwMTM0OnYy", "diffSide": "RIGHT", "path": "server/src/main/java/com/cloud/server/ManagementServerImpl.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yMlQxMjoxNTozOVrOHmewJA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yMlQxMzowMzo1NVrOHmgr3w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMDExMTc4MA==", "bodyText": "@ravening should we use 'userNameWithoutSpaces' instead of cmd.getUserName() ?", "url": "https://github.com/apache/cloudstack/pull/4359#discussion_r510111780", "createdAt": "2020-10-22T12:15:39Z", "author": {"login": "weizhouapache"}, "path": "server/src/main/java/com/cloud/server/ManagementServerImpl.java", "diffHunk": "@@ -3938,7 +3943,12 @@ public void doInTransactionWithoutResult(final TransactionStatus status) {\n                     }\n                     // update password for this host\n                     final DetailVO nv = _detailsDao.findDetail(h.getId(), ApiConstants.USERNAME);\n-                    if (nv.getValue().equals(command.getUsername())) {\n+                    if (nv == null) {\n+                        final DetailVO nvu = new DetailVO(h.getId(), ApiConstants.USERNAME, command.getUsername());", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "e26bc423ef85fa3656b69cbb7ce3da823c6048d2"}, "originalPosition": 18}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMDE0MzQ1NQ==", "bodyText": "yes correct. probably i missed it. will change that", "url": "https://github.com/apache/cloudstack/pull/4359#discussion_r510143455", "createdAt": "2020-10-22T13:03:55Z", "author": {"login": "ravening"}, "path": "server/src/main/java/com/cloud/server/ManagementServerImpl.java", "diffHunk": "@@ -3938,7 +3943,12 @@ public void doInTransactionWithoutResult(final TransactionStatus status) {\n                     }\n                     // update password for this host\n                     final DetailVO nv = _detailsDao.findDetail(h.getId(), ApiConstants.USERNAME);\n-                    if (nv.getValue().equals(command.getUsername())) {\n+                    if (nv == null) {\n+                        final DetailVO nvu = new DetailVO(h.getId(), ApiConstants.USERNAME, command.getUsername());", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMDExMTc4MA=="}, "originalCommit": {"oid": "e26bc423ef85fa3656b69cbb7ce3da823c6048d2"}, "originalPosition": 18}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzIxNjUyMjY2OnYy", "diffSide": "RIGHT", "path": "server/src/main/java/com/cloud/server/ManagementServerImpl.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yOFQxMDo0NDowNFrOHpkBiw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yOFQxMTozOTo1NFrOHpl9RQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMzM0Mzg4Mw==", "bodyText": "@ravening  Username null or empty fix is missing here.", "url": "https://github.com/apache/cloudstack/pull/4359#discussion_r513343883", "createdAt": "2020-10-28T10:44:04Z", "author": {"login": "sureshanaparti"}, "path": "server/src/main/java/com/cloud/server/ManagementServerImpl.java", "diffHunk": "@@ -3994,7 +4004,12 @@ public void doInTransactionWithoutResult(final TransactionStatus status) {\n                 }\n                 // update password for this host\n                 final DetailVO nv = _detailsDao.findDetail(host.getId(), ApiConstants.USERNAME);\n-                if (nv.getValue().equals(cmd.getUsername())) {\n+                if (nv == null) {\n+                    final DetailVO nvu = new DetailVO(host.getId(), ApiConstants.USERNAME, cmd.getUsername());", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "e26bc423ef85fa3656b69cbb7ce3da823c6048d2"}, "originalPosition": 32}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMzM3NTU1Nw==", "bodyText": "@sureshanaparti fixed it", "url": "https://github.com/apache/cloudstack/pull/4359#discussion_r513375557", "createdAt": "2020-10-28T11:39:54Z", "author": {"login": "ravening"}, "path": "server/src/main/java/com/cloud/server/ManagementServerImpl.java", "diffHunk": "@@ -3994,7 +4004,12 @@ public void doInTransactionWithoutResult(final TransactionStatus status) {\n                 }\n                 // update password for this host\n                 final DetailVO nv = _detailsDao.findDetail(host.getId(), ApiConstants.USERNAME);\n-                if (nv.getValue().equals(cmd.getUsername())) {\n+                if (nv == null) {\n+                    final DetailVO nvu = new DetailVO(host.getId(), ApiConstants.USERNAME, cmd.getUsername());", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMzM0Mzg4Mw=="}, "originalCommit": {"oid": "e26bc423ef85fa3656b69cbb7ce3da823c6048d2"}, "originalPosition": 32}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4200, "cost": 1, "resetAt": "2021-11-12T11:18:39Z"}}}