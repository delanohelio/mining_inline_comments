{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDQyMTg2MjM3", "number": 4190, "title": "Broadcast URI not set to vxlan, but vlan (Fix #3040)", "bodyText": "Description\n\nThis PR sets properly Broadcast URI to vxlan://vxlan_id when the physical network is of VXLAN.\nFixes: #3040\nDescription of issue #3040:\n\nAdvanced Network zone with VXLAN is created. When creating a guest network and setting the VNI this is set for the network:\nbroadcast_uri: vlan://1000\nisolation_uri: vlan://1000\nSTEPS TO REPRODUCE\nCreate a Advanced Zone with VXLAN\nCreate a guest network\nSee that broadcast is set to vlan and not vxlan\n\n\nTypes of changes\n\n\n Breaking change (fix or feature that would cause existing functionality to change)\n New feature (non-breaking change which adds functionality)\n Bug fix (non-breaking change which fixes an issue)\n Enhancement (improves an existing feature and functionality)\n Cleanup (Code refactoring and cleanup, that may add test cases)\n\nScreenshots (if appropriate):\nPrior to the fix:\n\nAfter the fix:\n\nHow Has This Been Tested?\n\n\n\n\nCreate a Advanced Zone with VXLAN\nCreate a guest network\nSee that broadcast uri is set to vxlan", "createdAt": "2020-06-30T17:25:31Z", "url": "https://github.com/apache/cloudstack/pull/4190", "merged": true, "mergeCommit": {"oid": "d6152b37adcdbe64b66fde05c7aa53ebe0b17240"}, "closed": true, "closedAt": "2020-09-24T05:39:51Z", "author": {"login": "GabrielBrascher"}, "timelineItems": {"totalCount": 7, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcwZpLVgH2gAyNDQyMTg2MjM3OjJjM2E0MWM3YTYzZGZkMWRkMjcxNTc4ZWFjZWMyNjQ0MmVlMDM5Zjk=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdLCIs5gH2gAyNDQyMTg2MjM3OjEzMzE0ZDNhYmIxOTRkM2I3YzAyMjQyZmMyYzAxNmNjNjFiOWExYzE=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "2c3a41c7a63dfd1dd271578eacec26442ee039f9", "author": {"user": {"login": "GabrielBrascher", "name": "Gabriel Beims Br\u00e4scher"}}, "url": "https://github.com/apache/cloudstack/commit/2c3a41c7a63dfd1dd271578eacec26442ee039f9", "committedDate": "2020-06-30T18:07:03Z", "message": "Fix issue #3040: Broadcast URI not set to vxlan, but vlan"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "0f9efed4cbcf541a24d30d85adadf07bfc04b24f", "author": {"user": {"login": "GabrielBrascher", "name": "Gabriel Beims Br\u00e4scher"}}, "url": "https://github.com/apache/cloudstack/commit/0f9efed4cbcf541a24d30d85adadf07bfc04b24f", "committedDate": "2020-06-30T17:00:02Z", "message": "Fix issue #3040: Broadcast URI not set to vxlan, but vlan"}, "afterCommit": {"oid": "2c3a41c7a63dfd1dd271578eacec26442ee039f9", "author": {"user": {"login": "GabrielBrascher", "name": "Gabriel Beims Br\u00e4scher"}}, "url": "https://github.com/apache/cloudstack/commit/2c3a41c7a63dfd1dd271578eacec26442ee039f9", "committedDate": "2020-06-30T18:07:03Z", "message": "Fix issue #3040: Broadcast URI not set to vxlan, but vlan"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDQwODM5OTQx", "url": "https://github.com/apache/cloudstack/pull/4190#pullrequestreview-440839941", "createdAt": "2020-07-01T12:52:35Z", "commit": {"oid": "2c3a41c7a63dfd1dd271578eacec26442ee039f9"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wMVQxMjo1MjozNVrOGrkl0A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wMVQxMjo1MjozNVrOGrkl0A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0ODM0MTQ1Ng==", "bodyText": "I got wondering if there could be more than one isolation method on a network. Considering that this is a List of isolation methods. I assume that to get into a VLAN conditional (the ones that this method is called) there will be only one isolation method, either VLAN or VXLAN.", "url": "https://github.com/apache/cloudstack/pull/4190#discussion_r448341456", "createdAt": "2020-07-01T12:52:35Z", "author": {"login": "GabrielBrascher"}, "path": "engine/orchestration/src/main/java/org/apache/cloudstack/engine/orchestration/NetworkOrchestrator.java", "diffHunk": "@@ -2475,6 +2475,21 @@ public Network doInTransaction(final TransactionStatus status) {\n         return network;\n     }\n \n+    /**\n+     * Encodes VLAN/VXLAN ID into a Broadcast URI according to the isolation method from the Physical Network.\n+     * @return Broadcast URI, e.g. 'vlan://vlan_ID' or 'vxlan://vlxan_ID'\n+     */\n+    protected URI encodeVlanIdIntoBroadcastUri(String vlanId, PhysicalNetwork pNtwk) {\n+        if(StringUtils.isNotBlank(pNtwk.getIsolationMethods().get(0))) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "2c3a41c7a63dfd1dd271578eacec26442ee039f9"}, "originalPosition": 27}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDg0OTEyNTgx", "url": "https://github.com/apache/cloudstack/pull/4190#pullrequestreview-484912581", "createdAt": "2020-09-09T11:29:45Z", "commit": {"oid": "2c3a41c7a63dfd1dd271578eacec26442ee039f9"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDg0OTgzODQ4", "url": "https://github.com/apache/cloudstack/pull/4190#pullrequestreview-484983848", "createdAt": "2020-09-09T13:02:45Z", "commit": {"oid": "2c3a41c7a63dfd1dd271578eacec26442ee039f9"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDg1NDYxNTk3", "url": "https://github.com/apache/cloudstack/pull/4190#pullrequestreview-485461597", "createdAt": "2020-09-09T23:08:37Z", "commit": {"oid": "2c3a41c7a63dfd1dd271578eacec26442ee039f9"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0wOVQyMzowODozN1rOHPdQ7A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0wOVQyMzowODozN1rOHPdQ7A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NTk3MDE1Ng==", "bodyText": "@GabrielBrascher Should we check if pNtwk is null? This could potentially cause a NPE; and the getIsolationMethods() is also a valid list with at least one item", "url": "https://github.com/apache/cloudstack/pull/4190#discussion_r485970156", "createdAt": "2020-09-09T23:08:37Z", "author": {"login": "rhtyd"}, "path": "engine/orchestration/src/main/java/org/apache/cloudstack/engine/orchestration/NetworkOrchestrator.java", "diffHunk": "@@ -2475,6 +2475,21 @@ public Network doInTransaction(final TransactionStatus status) {\n         return network;\n     }\n \n+    /**\n+     * Encodes VLAN/VXLAN ID into a Broadcast URI according to the isolation method from the Physical Network.\n+     * @return Broadcast URI, e.g. 'vlan://vlan_ID' or 'vxlan://vlxan_ID'\n+     */\n+    protected URI encodeVlanIdIntoBroadcastUri(String vlanId, PhysicalNetwork pNtwk) {\n+        if(StringUtils.isNotBlank(pNtwk.getIsolationMethods().get(0))) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "2c3a41c7a63dfd1dd271578eacec26442ee039f9"}, "originalPosition": 27}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "13314d3abb194d3b7c02242fc2c016cc61b9a1c1", "author": {"user": {"login": "GabrielBrascher", "name": "Gabriel Beims Br\u00e4scher"}}, "url": "https://github.com/apache/cloudstack/commit/13314d3abb194d3b7c02242fc2c016cc61b9a1c1", "committedDate": "2020-09-21T11:59:43Z", "message": "Add PhysicalNetwork null validation on encodeVlanIdIntoBroadcastUri"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3912, "cost": 1, "resetAt": "2021-10-28T17:48:14Z"}}}