{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0MzgzMDIzNzU2", "number": 3925, "title": "Add cache mode param properly", "bodyText": "Description\n\nRight now for the createDiskOffering  indicates that the cacheMode parameter comes back in the response but there is no equivalent parameter in the request.\nThe following changes have been added:\n\n\"cacheMode\" field has been added to the createServiceOffering endpoint\n\"cacheMode\" field has been added to the createDiskOffering endpoint\n\"cacheMode\" field will be returned in the listServiceOfferings and listDiskOfferings endpoints.\n\n\n\n\n\n\nTypes of changes\n\n\n Breaking change (fix or feature that would cause existing functionality to change)\n New feature (non-breaking change which adds functionality)\n Bug fix (non-breaking change which fixes an issue)\n Enhancement (improves an existing feature and functionality)\n Cleanup (Code refactoring and cleanup, that may add test cases)\n\nScreenshots (if appropriate):\n\n\n\n\nHow Has This Been Tested?\n\nWrote a python test for testing the creation of service offering with each one of the valid cache mode types : none, writeback and writethrough.\nWrote a python test for testing the creation of service offering with invalid cache mode type.\ntest_service_offerings_results.txt\ntest_service_offerings_runinfo.txt\nWrote a python test for testing the creation of disk offering with each one of the valid cache mode types : none, writeback and writethrough.\nWrote a python test for testing the creation of disk offering with invalid cache mode type.\ntest_disk_offerings_runinfo.txt\ntest_disk_offerings_results.txt", "createdAt": "2020-03-03T15:40:41Z", "url": "https://github.com/apache/cloudstack/pull/3925", "merged": true, "mergeCommit": {"oid": "d549f3bdc8e70400c3c0330ab97afc9df5efc0ea"}, "closed": true, "closedAt": "2020-03-09T12:17:22Z", "author": {"login": "radu-todirica"}, "timelineItems": {"totalCount": 9, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcKSiCwAFqTM2ODU2NDg4MA==", "endCursor": "Y3Vyc29yOnYyOpPPAAABcK-2k1gFqTM3MDI3MTcwMw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzY4NTY0ODgw", "url": "https://github.com/apache/cloudstack/pull/3925#pullrequestreview-368564880", "createdAt": "2020-03-04T07:57:01Z", "commit": {"oid": "4521c0023c856d43db238b1a49771e6a3d91d633"}, "state": "COMMENTED", "comments": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wNFQwNzo1NzowMlrOFxjCjQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wNFQwODoxOTozNFrOFxjlkw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NzQ5ODYzNw==", "bodyText": "\"since\" on the return @param as attribute but not on the request @parameter in the API. Probably C&P as i don't think you are planning this for the 4.4 branch! please adjust and expand (or remove)", "url": "https://github.com/apache/cloudstack/pull/3925#discussion_r387498637", "createdAt": "2020-03-04T07:57:02Z", "author": {"login": "DaanHoogland"}, "path": "api/src/main/java/org/apache/cloudstack/api/response/ServiceOfferingResponse.java", "diffHunk": "@@ -192,6 +192,10 @@\n     @Param(description = \"is true if the offering is customized\", since = \"4.3.0\")\n     private Boolean isCustomized;\n \n+    @SerializedName(\"cacheMode\")\n+    @Param(description = \"the cache mode to use for this disk offering. none, writeback or writethrough\", since = \"4.4\")", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "4521c0023c856d43db238b1a49771e6a3d91d633"}, "originalPosition": 5}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NzUwMDg5Ng==", "bodyText": "can you put this in its own method.", "url": "https://github.com/apache/cloudstack/pull/3925#discussion_r387500896", "createdAt": "2020-03-04T08:02:57Z", "author": {"login": "DaanHoogland"}, "path": "server/src/main/java/com/cloud/configuration/ConfigurationManagerImpl.java", "diffHunk": "@@ -2936,6 +2948,11 @@ public DiskOffering createDiskOffering(final CreateDiskOfferingCmd cmd) {\n             throw new InvalidParameterValueException(\"Disksize is not allowed for a customized disk offering\");\n         }\n \n+        // check if valid cache_mode parameter\n+        if(cmd.getCacheMode() != null && !Enums.getIfPresent(DiskOffering.DiskCacheMode.class, cmd.getCacheMode().toUpperCase()).isPresent()){\n+            throw new InvalidParameterValueException(\"Please specify a valid cache mode parameter\");\n+        }\n+", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "4521c0023c856d43db238b1a49771e6a3d91d633"}, "originalPosition": 75}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NzUwNzIzOA==", "bodyText": "Why this renumbering/renaming? It can break statistic analysis of test breakage or comparison. Why not add them to the end with new numbers?", "url": "https://github.com/apache/cloudstack/pull/3925#discussion_r387507238", "createdAt": "2020-03-04T08:18:45Z", "author": {"login": "DaanHoogland"}, "path": "test/integration/smoke/test_disk_offerings.py", "diffHunk": "@@ -90,9 +90,81 @@ def test_01_create_disk_offering(self):\n                         )\n         return\n \n+    @attr(tags=[\"advanced\", \"basic\", \"eip\", \"sg\", \"advancedns\", \"smoke\"], required_hardware=\"false\")\n+    def test_02_create_disk_offering_with_cache_mode_type(self):", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "4521c0023c856d43db238b1a49771e6a3d91d633"}, "originalPosition": 5}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NzUwNzYwMw==", "bodyText": "again, why not add as test_03 and test_04?", "url": "https://github.com/apache/cloudstack/pull/3925#discussion_r387507603", "createdAt": "2020-03-04T08:19:34Z", "author": {"login": "DaanHoogland"}, "path": "test/integration/smoke/test_service_offerings.py", "diffHunk": "@@ -129,6 +129,110 @@ def test_01_create_service_offering(self):\n             \"Check name in createServiceOffering\"\n         )\n         return\n+\n+    @attr(\n+        tags=[\n+            \"advanced\",\n+            \"advancedns\",\n+            \"smoke\",\n+            \"basic\",\n+            \"eip\",\n+            \"sg\"],\n+        required_hardware=\"false\")\n+    def test_02_create_service_offering_with_cache_mode_type(self):", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "4521c0023c856d43db238b1a49771e6a3d91d633"}, "originalPosition": 14}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "459c3486b5fda7f8635e9840c6ba30bed5d8c8b0", "author": {"user": {"login": "radu-todirica", "name": "Radu Todirica"}}, "url": "https://github.com/apache/cloudstack/commit/459c3486b5fda7f8635e9840c6ba30bed5d8c8b0", "committedDate": "2020-03-04T13:08:57Z", "message": "Refactor the code"}, "afterCommit": {"oid": "ec4d15ef182c2f099f455c1a0dc3cbe2dc6d80e8", "author": {"user": {"login": "radu-todirica", "name": "Radu Todirica"}}, "url": "https://github.com/apache/cloudstack/commit/ec4d15ef182c2f099f455c1a0dc3cbe2dc6d80e8", "committedDate": "2020-03-04T13:11:42Z", "message": "Add cache mode param\nAdded integration tests for the cache mode changes"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzY4OTU2MDY1", "url": "https://github.com/apache/cloudstack/pull/3925#pullrequestreview-368956065", "createdAt": "2020-03-04T17:00:01Z", "commit": {"oid": "ec4d15ef182c2f099f455c1a0dc3cbe2dc6d80e8"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wNFQxNzowMDowMVrOFx1png==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wNFQxNzowMDowMVrOFx1png==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NzgwMzU1MA==", "bodyText": "@radu-todirica why no since attribute here? no biggy, just wondering if you forgot.", "url": "https://github.com/apache/cloudstack/pull/3925#discussion_r387803550", "createdAt": "2020-03-04T17:00:01Z", "author": {"login": "DaanHoogland"}, "path": "api/src/main/java/org/apache/cloudstack/api/command/admin/offering/CreateDiskOfferingCmd.java", "diffHunk": "@@ -144,6 +144,9 @@\n             description = \"Hypervisor snapshot reserve space as a percent of a volume (for managed storage using Xen or VMware)\")\n     private Integer hypervisorSnapshotReserve;\n \n+    @Parameter(name = ApiConstants.CACHE_MODE, type = CommandType.STRING, required = false, description = \"the cache mode to use for this disk offering. none, writeback or writethrough\")", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ec4d15ef182c2f099f455c1a0dc3cbe2dc6d80e8"}, "originalPosition": 4}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzY4OTU2OTY3", "url": "https://github.com/apache/cloudstack/pull/3925#pullrequestreview-368956967", "createdAt": "2020-03-04T17:01:10Z", "commit": {"oid": "ec4d15ef182c2f099f455c1a0dc3cbe2dc6d80e8"}, "state": "COMMENTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wNFQxNzowMToxMVrOFx1sXw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wNFQxNzowMTozN1rOFx1tWw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NzgwNDI1NQ==", "bodyText": "I think it is better to call the method validateCachMode(String cacheMode) and include this code as it is duplicated below in lines 2951 - 2955:\nvoid validateCachMode(String cacheMode){\n    if( cacheMode != null &&\n        !Enums.getIfPresent(DiskOffering.DiskCacheMode.class,\n                            cacheMode.toUpperCase()).isPresent() {\n        throw new InvalidParameterValueException(\"Please specify a valid cache mode parameter\");\n    }\n}", "url": "https://github.com/apache/cloudstack/pull/3925#discussion_r387804255", "createdAt": "2020-03-04T17:01:11Z", "author": {"login": "DaanHoogland"}, "path": "server/src/main/java/com/cloud/configuration/ConfigurationManagerImpl.java", "diffHunk": "@@ -2318,6 +2319,11 @@ public ServiceOffering createServiceOffering(final CreateServiceOfferingCmd cmd)\n             }\n         }\n \n+        // check if valid cache_mode parameter\n+        if(isCacheModeInvalid(cmd.getCacheMode())){\n+            throw new InvalidParameterValueException(\"Please specify a valid cache mode parameter\");\n+        }\n+", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ec4d15ef182c2f099f455c1a0dc3cbe2dc6d80e8"}, "originalPosition": 16}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NzgwNDUwNw==", "bodyText": "duplicate of 2322 - 2326", "url": "https://github.com/apache/cloudstack/pull/3925#discussion_r387804507", "createdAt": "2020-03-04T17:01:37Z", "author": {"login": "DaanHoogland"}, "path": "server/src/main/java/com/cloud/configuration/ConfigurationManagerImpl.java", "diffHunk": "@@ -2936,6 +2948,11 @@ public DiskOffering createDiskOffering(final CreateDiskOfferingCmd cmd) {\n             throw new InvalidParameterValueException(\"Disksize is not allowed for a customized disk offering\");\n         }\n \n+        // check if valid cache_mode parameter\n+        if(isCacheModeInvalid(cmd.getCacheMode())){\n+            throw new InvalidParameterValueException(\"Please specify a valid cache mode parameter\");\n+        }\n+", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ec4d15ef182c2f099f455c1a0dc3cbe2dc6d80e8"}, "originalPosition": 75}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzY4OTIzMDI2", "url": "https://github.com/apache/cloudstack/pull/3925#pullrequestreview-368923026", "createdAt": "2020-03-04T16:21:03Z", "commit": {"oid": "ec4d15ef182c2f099f455c1a0dc3cbe2dc6d80e8"}, "state": "COMMENTED", "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wNFQxNjoyMTowM1rOFx0F7w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wNFQxODoxNjoxNlrOFx4OeQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4Nzc3ODAzMQ==", "bodyText": "since = \"4.14\" if merged in time for 4.14 releasing", "url": "https://github.com/apache/cloudstack/pull/3925#discussion_r387778031", "createdAt": "2020-03-04T16:21:03Z", "author": {"login": "GabrielBrascher"}, "path": "api/src/main/java/org/apache/cloudstack/api/command/admin/offering/CreateServiceOfferingCmd.java", "diffHunk": "@@ -178,6 +178,13 @@\n             since = \"4.4\")\n     private Integer hypervisorSnapshotReserve;\n \n+    @Parameter(name = ApiConstants.CACHE_MODE,\n+            type = CommandType.STRING,\n+            required = false,\n+            description = \"the cache mode to use for this disk offering. none, writeback or writethrough\",\n+            since = \"4.13\")", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ec4d15ef182c2f099f455c1a0dc3cbe2dc6d80e8"}, "originalPosition": 8}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4Nzc3ODk5MQ==", "bodyText": "Change to 4.14?", "url": "https://github.com/apache/cloudstack/pull/3925#discussion_r387778991", "createdAt": "2020-03-04T16:22:19Z", "author": {"login": "GabrielBrascher"}, "path": "api/src/main/java/org/apache/cloudstack/api/response/ServiceOfferingResponse.java", "diffHunk": "@@ -192,6 +192,10 @@\n     @Param(description = \"is true if the offering is customized\", since = \"4.3.0\")\n     private Boolean isCustomized;\n \n+    @SerializedName(\"cacheMode\")\n+    @Param(description = \"the cache mode to use for this disk offering. none, writeback or writethrough\", since = \"4.13.0\")", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ec4d15ef182c2f099f455c1a0dc3cbe2dc6d80e8"}, "originalPosition": 5}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4Nzg0NTc1Mw==", "bodyText": "Can you please add more information on the log? Example: String.format(\"Invalid cache mode (%s), specify a valid cache mode parameter\", cmd.getCacheMode())", "url": "https://github.com/apache/cloudstack/pull/3925#discussion_r387845753", "createdAt": "2020-03-04T18:16:16Z", "author": {"login": "GabrielBrascher"}, "path": "server/src/main/java/com/cloud/configuration/ConfigurationManagerImpl.java", "diffHunk": "@@ -2936,6 +2948,11 @@ public DiskOffering createDiskOffering(final CreateDiskOfferingCmd cmd) {\n             throw new InvalidParameterValueException(\"Disksize is not allowed for a customized disk offering\");\n         }\n \n+        // check if valid cache_mode parameter\n+        if(isCacheModeInvalid(cmd.getCacheMode())){\n+            throw new InvalidParameterValueException(\"Please specify a valid cache mode parameter\");", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ec4d15ef182c2f099f455c1a0dc3cbe2dc6d80e8"}, "originalPosition": 73}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "8afdde8c133bf817dc1b0ff40bf8dba042f86c72", "author": {"user": {"login": "radu-todirica", "name": "Radu Todirica"}}, "url": "https://github.com/apache/cloudstack/commit/8afdde8c133bf817dc1b0ff40bf8dba042f86c72", "committedDate": "2020-03-05T12:23:02Z", "message": "Add cache mode param\nAdded integration tests for the cache mode changes"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "978953a37dd137aaf9b847c5b18f31af3591861d", "author": {"user": {"login": "radu-todirica", "name": "Radu Todirica"}}, "url": "https://github.com/apache/cloudstack/commit/978953a37dd137aaf9b847c5b18f31af3591861d", "committedDate": "2020-03-05T12:19:00Z", "message": "Refactor the code"}, "afterCommit": {"oid": "8afdde8c133bf817dc1b0ff40bf8dba042f86c72", "author": {"user": {"login": "radu-todirica", "name": "Radu Todirica"}}, "url": "https://github.com/apache/cloudstack/commit/8afdde8c133bf817dc1b0ff40bf8dba042f86c72", "committedDate": "2020-03-05T12:23:02Z", "message": "Add cache mode param\nAdded integration tests for the cache mode changes"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzY5NTM4MjEz", "url": "https://github.com/apache/cloudstack/pull/3925#pullrequestreview-369538213", "createdAt": "2020-03-05T12:46:21Z", "commit": {"oid": "8afdde8c133bf817dc1b0ff40bf8dba042f86c72"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzcwMjcxNzAz", "url": "https://github.com/apache/cloudstack/pull/3925#pullrequestreview-370271703", "createdAt": "2020-03-06T11:59:03Z", "commit": {"oid": "8afdde8c133bf817dc1b0ff40bf8dba042f86c72"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4453, "cost": 1, "resetAt": "2021-10-28T17:48:14Z"}}}