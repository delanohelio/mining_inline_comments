{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTQzNjgyNTcz", "number": 4555, "title": "VMware: Fix template upload from local", "bodyText": "Description\nThis PR fixes the template upload from local on VMware\nTypes of changes\n\n Breaking change (fix or feature that would cause existing functionality to change)\n New feature (non-breaking change which adds functionality)\n Bug fix (non-breaking change which fixes an issue)\n Enhancement (improves an existing feature and functionality)\n Cleanup (Code refactoring and cleanup, that may add test cases)\n\nFeature/Enhancement Scale or Bug Severity\nFeature/Enhancement Scale\n\n Major\n Minor\n\nBug Severity\n\n BLOCKER\n Critical\n Major\n Minor\n Trivial\n\nScreenshots (if appropriate):\n\nHow Has This Been Tested?\nGo to Images -> Templates -> Upload from local\nSelect a template on VMware and upload it", "createdAt": "2020-12-21T19:33:50Z", "url": "https://github.com/apache/cloudstack/pull/4555", "merged": true, "mergeCommit": {"oid": "4617be458387421bbbfc120c1f054c9939ba52eb"}, "closed": true, "closedAt": "2020-12-23T09:43:40Z", "author": {"login": "nvazquez"}, "timelineItems": {"totalCount": 8, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdoW8CvAH2gAyNTQzNjgyNTczOjlhMGFkMDJlNmFjZGY2MmM2NGY2ZmIxY2NjYWE1NTlkMjNiNTBjNDM=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdotcGzAH2gAyNTQzNjgyNTczOjEzNjc3ZTQwNDQ2N2U2ODYxODM0ZDUzYmMzNjQ3MWNjMGYwYjM1MWM=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "9a0ad02e6acdf62c64f6fb1cccaa559d23b50c43", "author": {"user": {"login": "nvazquez", "name": "Nicolas Vazquez"}}, "url": "https://github.com/apache/cloudstack/commit/9a0ad02e6acdf62c64f6fb1cccaa559d23b50c43", "committedDate": "2020-12-21T14:37:42Z", "message": "Fix template upload from local"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTU2ODQyNDYw", "url": "https://github.com/apache/cloudstack/pull/4555#pullrequestreview-556842460", "createdAt": "2020-12-22T06:15:17Z", "commit": {"oid": "9a0ad02e6acdf62c64f6fb1cccaa559d23b50c43"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0yMlQwNjoxNToxN1rOIJvquw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0yMlQwNjoxNToxN1rOIJvquw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NzA4OTA4Mw==", "bodyText": "Should we simply ignore for VMware, even if ostypeid is provided?", "url": "https://github.com/apache/cloudstack/pull/4555#discussion_r547089083", "createdAt": "2020-12-22T06:15:17Z", "author": {"login": "rhtyd"}, "path": "api/src/main/java/org/apache/cloudstack/api/command/user/template/GetUploadParamsForTemplateCmd.java", "diffHunk": "@@ -168,6 +170,12 @@ private void validateRequest() {\n         if (getZoneId() <= 0) {\n             throw new ServerApiException(ApiErrorCode.PARAM_ERROR, \"invalid zoneid\");\n         }\n+        if (!hypervisor.equalsIgnoreCase(Hypervisor.HypervisorType.VMware.toString()) && osTypeId == null) {\n+            throw new ServerApiException(ApiErrorCode.PARAM_ERROR, \"Missing parameter ostypeid\");\n+        }\n+        if (hypervisor.equalsIgnoreCase(Hypervisor.HypervisorType.VMware.toString()) && osTypeId != null) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "9a0ad02e6acdf62c64f6fb1cccaa559d23b50c43"}, "originalPosition": 25}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTU2ODQyNzEy", "url": "https://github.com/apache/cloudstack/pull/4555#pullrequestreview-556842712", "createdAt": "2020-12-22T06:16:04Z", "commit": {"oid": "9a0ad02e6acdf62c64f6fb1cccaa559d23b50c43"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTU2ODUyMDc3", "url": "https://github.com/apache/cloudstack/pull/4555#pullrequestreview-556852077", "createdAt": "2020-12-22T06:42:37Z", "commit": {"oid": "9a0ad02e6acdf62c64f6fb1cccaa559d23b50c43"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTU2ODU2Nzk2", "url": "https://github.com/apache/cloudstack/pull/4555#pullrequestreview-556856796", "createdAt": "2020-12-22T06:54:34Z", "commit": {"oid": "9a0ad02e6acdf62c64f6fb1cccaa559d23b50c43"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c747c9b985010b45543ba6c1f05727eb4c9f0e73", "author": {"user": {"login": "nvazquez", "name": "Nicolas Vazquez"}}, "url": "https://github.com/apache/cloudstack/commit/c747c9b985010b45543ba6c1f05727eb4c9f0e73", "committedDate": "2020-12-22T15:52:14Z", "message": "Update the guest OS from the OVF file after upload is completed"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTU3MTg1MTIz", "url": "https://github.com/apache/cloudstack/pull/4555#pullrequestreview-557185123", "createdAt": "2020-12-22T15:59:21Z", "commit": {"oid": "c747c9b985010b45543ba6c1f05727eb4c9f0e73"}, "state": "APPROVED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0yMlQxNTo1OToyMlrOIKAIow==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0yMlQxNTo1OToyMlrOIKAIow==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NzM1ODg4Mw==", "bodyText": "very significant review comment:\n\n  \n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                 * Roll back actions in case of unexpected erros\n          \n          \n            \n                 * Roll back actions in case of unexpected errors", "url": "https://github.com/apache/cloudstack/pull/4555#discussion_r547358883", "createdAt": "2020-12-22T15:59:22Z", "author": {"login": "DaanHoogland"}, "path": "engine/storage/src/main/java/org/apache/cloudstack/storage/image/deployasis/DeployAsIsHelperImpl.java", "diffHunk": "@@ -175,14 +168,27 @@ private void handleGuestOsFromOVFDescriptor(long templateId, String guestOsType,\n \n         if (CollectionUtils.isNotEmpty(guestOsMappings)) {\n             GuestOSHypervisorVO mapping = guestOsMappings.get(0);\n-            long guestOsId = mapping.getGuestOsId();\n-            LOGGER.info(\"Updating deploy-as-is template guest OS to \" + guestOsType);\n-            updateTemplateGuestOsId(template, guestOsId);\n+            return mapping.getGuestOsId();\n         } else {\n             throw new CloudRuntimeException(\"Did not find a guest OS with type \" + guestOsType);\n         }\n     }\n \n+    /**\n+     * Handle the guest OS read from the OVF and try to match it to an existing guest OS in DB.\n+     * If the guest OS cannot be mapped to an existing guest OS in DB, then create it and create support for hypervisor versions.\n+     * Roll back actions in case of unexpected erros", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c747c9b985010b45543ba6c1f05727eb4c9f0e73"}, "originalPosition": 68}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "13677e404467e6861834d53bc36471cc0f0b351c", "author": {"user": {"login": "nvazquez", "name": "Nicolas Vazquez"}}, "url": "https://github.com/apache/cloudstack/commit/13677e404467e6861834d53bc36471cc0f0b351c", "committedDate": "2020-12-22T16:50:38Z", "message": "Update engine/storage/src/main/java/org/apache/cloudstack/storage/image/deployasis/DeployAsIsHelperImpl.java\n\nCo-authored-by: dahn <daan.hoogland@gmail.com>"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4632, "cost": 1, "resetAt": "2021-10-28T17:48:14Z"}}}