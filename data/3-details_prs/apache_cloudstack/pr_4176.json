{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDM5MzMzOTY2", "number": 4176, "title": "server: Purge all cookies on logout, set /client path on login", "bodyText": "This will purge all the cookies on logout including multiple sessionkey\ncookies if passed. On login, this will restrict sessionkey cookie\n(httponly) to the /client path like the JSESSIONID cookie.\nFixes #4136\nTypes of changes\n\n\n Breaking change (fix or feature that would cause existing functionality to change)\n New feature (non-breaking change which adds functionality)\n Bug fix (non-breaking change which fixes an issue)\n Enhancement (improves an existing feature and functionality)\n Cleanup (Code refactoring and cleanup, that may add test cases)\n\nNeeds manual testing", "createdAt": "2020-06-24T17:02:34Z", "url": "https://github.com/apache/cloudstack/pull/4176", "merged": true, "mergeCommit": {"oid": "139aa13e6ab6af1a871094cdae7607f00291d6e8"}, "closed": true, "closedAt": "2020-07-08T02:33:51Z", "author": {"login": "rhtyd"}, "timelineItems": {"totalCount": 8, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcudEdbgH2gAyNDM5MzMzOTY2OjU3ZTNmY2Y0MTcwYjRjYjdiMTQ3ZDdiMzVhMDI5NDVhMTlhMGY0YWU=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcymssFAH2gAyNDM5MzMzOTY2OjY2MDVkMDE1MjY1Y2RmODM3MTdmM2ZiZTliNGM5NmI0ZDA0MDA4MWE=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "57e3fcf4170b4cb7b147d7b35a02945a19a0f4ae", "author": {"user": {"login": "rhtyd", "name": "Rohit Yadav"}}, "url": "https://github.com/apache/cloudstack/commit/57e3fcf4170b4cb7b147d7b35a02945a19a0f4ae", "committedDate": "2020-06-24T16:58:43Z", "message": "server: Purge all cookies on logout, set /client path on login\n\nThis will purge all the cookies on logout including multiple sessionkey\ncookies if passed. On login, this will restrict sessionkey cookie\n(httponly) to the /client path like the JSESSIONID cookie.\n\nFixes #4136\n\nSigned-off-by: Rohit Yadav <rohit.yadav@shapeblue.com>"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDM2ODQwOTUz", "url": "https://github.com/apache/cloudstack/pull/4176#pullrequestreview-436840953", "createdAt": "2020-06-24T17:04:28Z", "commit": {"oid": "57e3fcf4170b4cb7b147d7b35a02945a19a0f4ae"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yNFQxNzowNDoyOFrOGobPVQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yNFQxNzowNDoyOFrOGobPVQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NTA0MjUxNw==", "bodyText": "We need to check if this is necessary or not", "url": "https://github.com/apache/cloudstack/pull/4176#discussion_r445042517", "createdAt": "2020-06-24T17:04:28Z", "author": {"login": "rhtyd"}, "path": "server/src/main/java/com/cloud/api/ApiServlet.java", "diffHunk": "@@ -213,7 +213,7 @@ void processRequestInContext(final HttpServletRequest req, final HttpServletResp\n                     try {\n                         responseString = apiAuthenticator.authenticate(command, params, session, remoteAddress, responseType, auditTrailSb, req, resp);\n                         if (session != null && session.getAttribute(ApiConstants.SESSIONKEY) != null) {\n-                            resp.addHeader(\"SET-COOKIE\", String.format(\"%s=%s;HttpOnly\", ApiConstants.SESSIONKEY, session.getAttribute(ApiConstants.SESSIONKEY)));\n+                            resp.addHeader(\"SET-COOKIE\", String.format(\"%s=%s;HttpOnly;Path=/client\", ApiConstants.SESSIONKEY, session.getAttribute(ApiConstants.SESSIONKEY)));", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "57e3fcf4170b4cb7b147d7b35a02945a19a0f4ae"}, "originalPosition": 5}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDM2ODkwMjA5", "url": "https://github.com/apache/cloudstack/pull/4176#pullrequestreview-436890209", "createdAt": "2020-06-24T18:11:31Z", "commit": {"oid": "57e3fcf4170b4cb7b147d7b35a02945a19a0f4ae"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yNFQxODoxMTozMVrOGodiHw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yNFQxODoxMTozMVrOGodiHw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NTA4MDA5NQ==", "bodyText": "@rhtyd missing brace", "url": "https://github.com/apache/cloudstack/pull/4176#discussion_r445080095", "createdAt": "2020-06-24T18:11:31Z", "author": {"login": "shwstppr"}, "path": "server/src/main/java/com/cloud/api/ApiServlet.java", "diffHunk": "@@ -238,9 +238,14 @@ void processRequestInContext(final HttpServletRequest req, final HttpServletResp\n                             } catch (final IllegalStateException ignored) {\n                             }\n                         }\n-                        Cookie sessionKeyCookie = new Cookie(ApiConstants.SESSIONKEY, \"\");\n-                        sessionKeyCookie.setMaxAge(0);\n-                        resp.addCookie(sessionKeyCookie);\n+                        final Cookie[] cookies = req.getCookies();\n+                        if (cookies != null)", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "57e3fcf4170b4cb7b147d7b35a02945a19a0f4ae"}, "originalPosition": 17}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "15be473e6c256b3fc8d1088638be2242e67d3fa0", "author": {"user": {"login": "rhtyd", "name": "Rohit Yadav"}}, "url": "https://github.com/apache/cloudstack/commit/15be473e6c256b3fc8d1088638be2242e67d3fa0", "committedDate": "2020-06-24T18:29:23Z", "message": "Add brace"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "d629eb15bbd76f6b485aa11674947a8575be44b1", "author": {"user": {"login": "rhtyd", "name": "Rohit Yadav"}}, "url": "https://github.com/apache/cloudstack/commit/d629eb15bbd76f6b485aa11674947a8575be44b1", "committedDate": "2020-06-25T15:14:17Z", "message": "set cookie path to webapp context path"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDM4MjQ5MTA5", "url": "https://github.com/apache/cloudstack/pull/4176#pullrequestreview-438249109", "createdAt": "2020-06-26T12:21:39Z", "commit": {"oid": "d629eb15bbd76f6b485aa11674947a8575be44b1"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b7e88bcb9f336c595c0a8cb80603b10c9997317c", "author": {"user": {"login": "rhtyd", "name": "Rohit Yadav"}}, "url": "https://github.com/apache/cloudstack/commit/b7e88bcb9f336c595c0a8cb80603b10c9997317c", "committedDate": "2020-07-04T05:12:14Z", "message": "Update ApiServlet.java"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "6605d015265cdf83717f3fbe9b4c96b4d040081a", "author": {"user": null}, "url": "https://github.com/apache/cloudstack/commit/6605d015265cdf83717f3fbe9b4c96b4d040081a", "committedDate": "2020-07-07T14:27:30Z", "message": "Change sessionkey cookie path"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3894, "cost": 1, "resetAt": "2021-10-28T17:48:14Z"}}}