{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0Mzg5MDI3OTkx", "number": 3967, "reviewThreads": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yNlQyMDoxNjo0MlrODr0Tyg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yNlQyMDoyMDozNlrODr0ZEQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjQ3MjcyMzk0OnYy", "diffSide": "RIGHT", "path": "server/src/main/java/com/cloud/servlet/ConsoleProxyServlet.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yNlQyMDoxNjo0MlrOF8YuCA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yN1QwNjoxMDowMVrOF8kRhw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5ODg2Mzg4MA==", "bodyText": "Why not using vnc.html which provides more functionalities? Briefly tested invoking it and got this extra functionalities:", "url": "https://github.com/apache/cloudstack/pull/3967#discussion_r398863880", "createdAt": "2020-03-26T20:16:42Z", "author": {"login": "nvazquez"}, "path": "server/src/main/java/com/cloud/servlet/ConsoleProxyServlet.java", "diffHunk": "@@ -478,7 +481,12 @@ private String composeConsoleAccessUrl(String rootUrl, VirtualMachine vm, HostVO\n             param.setClientTunnelSession(parsedHostInfo.third());\n         }\n \n-        sb.append(\"/ajax?token=\" + encryptor.encryptObject(ConsoleProxyClientParam.class, param));\n+        if (param.getHypervHost() != null || !ConsoleProxyManager.NoVncConsoleDefault.value()) {\n+            sb.append(\"/ajax?token=\" + encryptor.encryptObject(ConsoleProxyClientParam.class, param));\n+        } else {\n+            sb.append(\"/resource/noVNC/vnc_lite.html?port=\" + ConsoleProxyManager.DEFAULT_NOVNC_PORT + \"&token=\"", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f246c4301a75e2e4050c09d3423dabfb7b603730"}, "originalPosition": 32}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5OTA1MzE5MQ==", "bodyText": "Wanted a simpler, minimalist UI, can add this when we get multi lingual keyboard working", "url": "https://github.com/apache/cloudstack/pull/3967#discussion_r399053191", "createdAt": "2020-03-27T06:10:01Z", "author": {"login": "davidjumani"}, "path": "server/src/main/java/com/cloud/servlet/ConsoleProxyServlet.java", "diffHunk": "@@ -478,7 +481,12 @@ private String composeConsoleAccessUrl(String rootUrl, VirtualMachine vm, HostVO\n             param.setClientTunnelSession(parsedHostInfo.third());\n         }\n \n-        sb.append(\"/ajax?token=\" + encryptor.encryptObject(ConsoleProxyClientParam.class, param));\n+        if (param.getHypervHost() != null || !ConsoleProxyManager.NoVncConsoleDefault.value()) {\n+            sb.append(\"/ajax?token=\" + encryptor.encryptObject(ConsoleProxyClientParam.class, param));\n+        } else {\n+            sb.append(\"/resource/noVNC/vnc_lite.html?port=\" + ConsoleProxyManager.DEFAULT_NOVNC_PORT + \"&token=\"", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5ODg2Mzg4MA=="}, "originalCommit": {"oid": "f246c4301a75e2e4050c09d3423dabfb7b603730"}, "originalPosition": 32}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjQ3MjczNzQ1OnYy", "diffSide": "RIGHT", "path": "server/src/main/java/com/cloud/consoleproxy/ConsoleProxyManager.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yNlQyMDoyMDozNlrOF8Y2iQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yN1QwNjowODo1MVrOF8kQUg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5ODg2NjA1Nw==", "bodyText": "I think it should be disabled by default at least until all hypervisors tested working properly", "url": "https://github.com/apache/cloudstack/pull/3967#discussion_r398866057", "createdAt": "2020-03-26T20:20:36Z", "author": {"login": "nvazquez"}, "path": "server/src/main/java/com/cloud/consoleproxy/ConsoleProxyManager.java", "diffHunk": "@@ -31,9 +33,14 @@\n     public static final int DEFAULT_PROXY_URL_PORT = 80;\n     public static final int DEFAULT_PROXY_SESSION_TIMEOUT = 300000;        // 5 minutes\n \n+    public static final int DEFAULT_NOVNC_PORT = 8080;\n+\n     public static final String ALERT_SUBJECT = \"proxy-alert\";\n     public static final String CERTIFICATE_NAME = \"CPVMCertificate\";\n \n+    public static final ConfigKey<Boolean> NoVncConsoleDefault = new ConfigKey<Boolean>(\"Advanced\", Boolean.class, \"novnc.console.default\", \"true\",\n+        \"If true, noVNC console will be default console for virtual machines\", true);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f246c4301a75e2e4050c09d3423dabfb7b603730"}, "originalPosition": 19}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5OTA1Mjg4Mg==", "bodyText": "I've tested it on KVM, VMware and Xen and it works fine!", "url": "https://github.com/apache/cloudstack/pull/3967#discussion_r399052882", "createdAt": "2020-03-27T06:08:51Z", "author": {"login": "davidjumani"}, "path": "server/src/main/java/com/cloud/consoleproxy/ConsoleProxyManager.java", "diffHunk": "@@ -31,9 +33,14 @@\n     public static final int DEFAULT_PROXY_URL_PORT = 80;\n     public static final int DEFAULT_PROXY_SESSION_TIMEOUT = 300000;        // 5 minutes\n \n+    public static final int DEFAULT_NOVNC_PORT = 8080;\n+\n     public static final String ALERT_SUBJECT = \"proxy-alert\";\n     public static final String CERTIFICATE_NAME = \"CPVMCertificate\";\n \n+    public static final ConfigKey<Boolean> NoVncConsoleDefault = new ConfigKey<Boolean>(\"Advanced\", Boolean.class, \"novnc.console.default\", \"true\",\n+        \"If true, noVNC console will be default console for virtual machines\", true);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5ODg2NjA1Nw=="}, "originalCommit": {"oid": "f246c4301a75e2e4050c09d3423dabfb7b603730"}, "originalPosition": 19}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3970, "cost": 1, "resetAt": "2021-11-12T11:18:39Z"}}}