{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0Mzk2MTY5Mjc0", "number": 4004, "title": "Fixed null pointer and deployment issue on Xenserver with L2 Guest network with configDrive", "bodyText": "Description\n\nThis PR fixes an issue where an instance fails to deploy due to a null pointer when using an L2 Guest Network with DefaultL2NetworkOfferingConfigDrive on Xenserver. It also fixes migrating an instance to another host.\n\n\n\n\n\nTypes of changes\n\n\n Breaking change (fix or feature that would cause existing functionality to change)\n New feature (non-breaking change which adds functionality)\n Bug fix (non-breaking change which fixes an issue)\n Enhancement (improves an existing feature and functionality)\n Cleanup (Code refactoring and cleanup, that may add test cases)\n\nScreenshots (if appropriate):\nHow Has This Been Tested?\n\n\n\nThis has been tested by:\n\nCreating an L2 Guest network, using DefaultL2NetworkOfferingConfigDrive as the network offering.\nDeploying an instance using the L2 Guest network created.\nMigrating the instance away from the host and back", "createdAt": "2020-03-31T08:39:08Z", "url": "https://github.com/apache/cloudstack/pull/4004", "merged": true, "mergeCommit": {"oid": "97f21c1835765c42e237aa3a8c61e296a8f82dd0"}, "closed": true, "closedAt": "2020-06-23T06:51:51Z", "author": {"login": "Spaceman1984"}, "timelineItems": {"totalCount": 13, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcS-tQgAH2gAyMzk2MTY5Mjc0OjY4MzNkOGIxZDBmOTFjNzhjNTA5ZGNjZDA2Mzc4OGM2NmU4YjVkY2M=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcrbOPYgFqTQzMDM3MjA3OQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "6833d8b1d0f91c78c509dccd063788c66e8b5dcc", "author": {"user": {"login": "Spaceman1984", "name": null}}, "url": "https://github.com/apache/cloudstack/commit/6833d8b1d0f91c78c509dccd063788c66e8b5dcc", "committedDate": "2020-03-31T08:20:16Z", "message": "Fixed null pointer and deployment issue on configDrive network"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzkxNzQ2NzM2", "url": "https://github.com/apache/cloudstack/pull/4004#pullrequestreview-391746736", "createdAt": "2020-04-11T08:11:06Z", "commit": {"oid": "6833d8b1d0f91c78c509dccd063788c66e8b5dcc"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0xMVQwODoxMTowNlrOGELY1Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0xMVQwODoxMTowNlrOGELY1Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNzAzNDA2OQ==", "bodyText": "maybe give the 3 a constant with descriptive name", "url": "https://github.com/apache/cloudstack/pull/4004#discussion_r407034069", "createdAt": "2020-04-11T08:11:06Z", "author": {"login": "DaanHoogland"}, "path": "plugins/hypervisors/xenserver/src/main/java/com/cloud/hypervisor/xenserver/resource/CitrixResourceBase.java", "diffHunk": "@@ -1156,7 +1156,7 @@ public VBD createVbd(final Connection conn, final DiskTO volume, final String vm\n         if (volume.getType() == Volume.Type.ISO) {\n             vbdr.mode = Types.VbdMode.RO;\n             vbdr.type = Types.VbdType.CD;\n-            vbdr.userdevice = \"3\";\n+            vbdr.userdevice = String.valueOf(3 + isoCount);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "6833d8b1d0f91c78c509dccd063788c66e8b5dcc"}, "originalPosition": 14}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "412694c5676f5b5d0e6667826e832d6bcab5a662", "author": {"user": {"login": "Spaceman1984", "name": null}}, "url": "https://github.com/apache/cloudstack/commit/412694c5676f5b5d0e6667826e832d6bcab5a662", "committedDate": "2020-04-17T08:07:37Z", "message": "Review changes - Created const value for user device id and refactored disk prepare method."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "0c2773c82f85c9c0169eefa4c409c078ff7b4fcc", "author": {"user": {"login": "Spaceman1984", "name": null}}, "url": "https://github.com/apache/cloudstack/commit/0c2773c82f85c9c0169eefa4c409c078ff7b4fcc", "committedDate": "2020-04-20T09:57:45Z", "message": "Fixed vm with configdrive migration error"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzk2NDk0OTk1", "url": "https://github.com/apache/cloudstack/pull/4004#pullrequestreview-396494995", "createdAt": "2020-04-20T14:15:28Z", "commit": {"oid": "0c2773c82f85c9c0169eefa4c409c078ff7b4fcc"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yMFQxNDoxNToyOFrOGIWsuQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yMFQxNDoxNToyOFrOGIWsuQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMTQxMzY4OQ==", "bodyText": "\u00bfcan you create a final (static) field for this?", "url": "https://github.com/apache/cloudstack/pull/4004#discussion_r411413689", "createdAt": "2020-04-20T14:15:28Z", "author": {"login": "DaanHoogland"}, "path": "plugins/hypervisors/xenserver/src/main/java/com/cloud/hypervisor/xenserver/resource/CitrixResourceBase.java", "diffHunk": "@@ -5542,7 +5544,7 @@ public boolean attachConfigDriveToMigratedVm(Connection conn, String vmName, Str\n             s_logger.debug(\"Attaching config drive iso device for the VM \" + vmName + \" In host \" + ipAddr);\n             Set<VM> vms = VM.getByNameLabel(conn, vmName);\n \n-            SR sr = getSRByNameLabel(conn, _configDriveSRName + ipAddr);\n+            SR sr = getSRByNameLabel(conn, vmName + \"-ISO\");", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "0c2773c82f85c9c0169eefa4c409c078ff7b4fcc"}, "originalPosition": 41}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ea077bcfb221f0d42342615a91e6418c4249ecc2", "author": {"user": {"login": "Spaceman1984", "name": null}}, "url": "https://github.com/apache/cloudstack/commit/ea077bcfb221f0d42342615a91e6418c4249ecc2", "committedDate": "2020-05-04T08:20:22Z", "message": "Fixed iso not attaching after migration"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f1779e3653b69d192e128d989e09d76d4b1ed021", "author": {"user": {"login": "Spaceman1984", "name": null}}, "url": "https://github.com/apache/cloudstack/commit/f1779e3653b69d192e128d989e09d76d4b1ed021", "committedDate": "2020-05-04T08:26:09Z", "message": "Added static string"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "cbbaad89991c667d58cfb3a8e46079d725146273", "author": {"user": {"login": "Spaceman1984", "name": null}}, "url": "https://github.com/apache/cloudstack/commit/cbbaad89991c667d58cfb3a8e46079d725146273", "committedDate": "2020-05-04T08:42:00Z", "message": "Added static string"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDE0MjA1ODAw", "url": "https://github.com/apache/cloudstack/pull/4004#pullrequestreview-414205800", "createdAt": "2020-05-19T08:15:01Z", "commit": {"oid": "cbbaad89991c667d58cfb3a8e46079d725146273"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDE2NDI5MTQz", "url": "https://github.com/apache/cloudstack/pull/4004#pullrequestreview-416429143", "createdAt": "2020-05-21T19:29:12Z", "commit": {"oid": "cbbaad89991c667d58cfb3a8e46079d725146273"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yMVQxOToyOToxM1rOGY_54g==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yMVQxOToyOToxM1rOGY_54g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyODg2NjAxOA==", "bodyText": "can you explain? I don't see it being used anywhere", "url": "https://github.com/apache/cloudstack/pull/4004#discussion_r428866018", "createdAt": "2020-05-21T19:29:13Z", "author": {"login": "DaanHoogland"}, "path": "server/src/main/java/com/cloud/network/element/ConfigDriveNetworkElement.java", "diffHunk": "@@ -478,7 +476,7 @@ private boolean deleteConfigDriveIso(final VirtualMachine vm) throws ResourceUna\n         return true;\n     }\n \n-    private void addConfigDriveDisk(final VirtualMachineProfile profile, final DataStore dataStore) throws ResourceUnavailableException {\n+    public static void addConfigDriveDisk(final VirtualMachineProfile profile, final DataStore dataStore) throws ResourceUnavailableException {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "cbbaad89991c667d58cfb3a8e46079d725146273"}, "originalPosition": 29}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDE4MTM0MTQ0", "url": "https://github.com/apache/cloudstack/pull/4004#pullrequestreview-418134144", "createdAt": "2020-05-26T09:40:36Z", "commit": {"oid": "cbbaad89991c667d58cfb3a8e46079d725146273"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "1f5df355fc02a8e43ed7567b5311c56d16fda86e", "author": {"user": {"login": "Spaceman1984", "name": null}}, "url": "https://github.com/apache/cloudstack/commit/1f5df355fc02a8e43ed7567b5311c56d16fda86e", "committedDate": "2020-06-02T07:24:02Z", "message": "Removed public modifier"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDMwMzcyMDc5", "url": "https://github.com/apache/cloudstack/pull/4004#pullrequestreview-430372079", "createdAt": "2020-06-15T07:07:49Z", "commit": {"oid": "1f5df355fc02a8e43ed7567b5311c56d16fda86e"}, "state": "COMMENTED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4166, "cost": 1, "resetAt": "2021-10-28T17:48:14Z"}}}