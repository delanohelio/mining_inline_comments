{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTQ0MDE3MTY3", "number": 4557, "title": "Fixed instance creation failure on dvswitch when using vlan id 4095", "bodyText": "Description\nWhen creating an instance on a guest network where the vlan id has been set to 4095, the instance fails to start.\nThis PR sets the vlan id and range on the created port group to allow the instance to be created.\n\n\n\n\n\n\nFixes #4358\n\n\n\n\nTypes of changes\n\n Breaking change (fix or feature that would cause existing functionality to change)\n New feature (non-breaking change which adds functionality)\n Bug fix (non-breaking change which fixes an issue)\n Enhancement (improves an existing feature and functionality)\n Cleanup (Code refactoring and cleanup, that may add test cases)\n\nFeature/Enhancement Scale or Bug Severity\nBug Severity\n\n BLOCKER\n Critical\n Major\n Minor\n Trivial\n\nScreenshots (if appropriate):\nHow Has This Been Tested?\n\n\n\nThis has been tested by creating a guest network and setting the vlan id to 4095 and creating an instance using the specific network.", "createdAt": "2020-12-22T10:13:00Z", "url": "https://github.com/apache/cloudstack/pull/4557", "merged": true, "mergeCommit": {"oid": "ec4d83da4df78c48e7065a912b724ef389708068"}, "closed": true, "closedAt": "2021-01-12T07:53:17Z", "author": {"login": "Spaceman1984"}, "timelineItems": {"totalCount": 8, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdonuDEAH2gAyNTQ0MDE3MTY3OjBlMmY5YWUxNDdlYjM0NWU3MTM3OTAwN2M0MDk2OTAyZDc4NWU2ZDM=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdtvg9dAFqTU2MzI3ODQ2Ng==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "0e2f9ae147eb345e71379007c4096902d785e6d3", "author": {"user": {"login": "Spaceman1984", "name": null}}, "url": "https://github.com/apache/cloudstack/commit/0e2f9ae147eb345e71379007c4096902d785e6d3", "committedDate": "2020-12-22T10:10:48Z", "message": "Fixed instance creation failure on dvswitch when using vlan id 4095"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTU2OTgzNzMw", "url": "https://github.com/apache/cloudstack/pull/4557#pullrequestreview-556983730", "createdAt": "2020-12-22T10:40:15Z", "commit": {"oid": "0e2f9ae147eb345e71379007c4096902d785e6d3"}, "state": "COMMENTED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTU2OTg1OTYy", "url": "https://github.com/apache/cloudstack/pull/4557#pullrequestreview-556985962", "createdAt": "2020-12-22T10:44:14Z", "commit": {"oid": "0e2f9ae147eb345e71379007c4096902d785e6d3"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTU2OTk0NDUz", "url": "https://github.com/apache/cloudstack/pull/4557#pullrequestreview-556994453", "createdAt": "2020-12-22T10:58:50Z", "commit": {"oid": "0e2f9ae147eb345e71379007c4096902d785e6d3"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "1b48ee2d470ae4a95e9adca68bbb9de59024b2f6", "author": {"user": {"login": "Spaceman1984", "name": null}}, "url": "https://github.com/apache/cloudstack/commit/1b48ee2d470ae4a95e9adca68bbb9de59024b2f6", "committedDate": "2020-12-22T11:13:25Z", "message": "Null pointer"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTU3MDE4MDk3", "url": "https://github.com/apache/cloudstack/pull/4557#pullrequestreview-557018097", "createdAt": "2020-12-22T11:40:53Z", "commit": {"oid": "1b48ee2d470ae4a95e9adca68bbb9de59024b2f6"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTU3MTE3NTA5", "url": "https://github.com/apache/cloudstack/pull/4557#pullrequestreview-557117509", "createdAt": "2020-12-22T14:28:03Z", "commit": {"oid": "1b48ee2d470ae4a95e9adca68bbb9de59024b2f6"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0yMlQxNDoyODowM1rOIJ9BDQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0yMlQxNDoyODowM1rOIJ9BDQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NzMwNzc4OQ==", "bodyText": "so if (vlanId == 4095) we set the range and  vlanId but if (vlanId == null) we don't care about the set range. is this intentional?", "url": "https://github.com/apache/cloudstack/pull/4557#discussion_r547307789", "createdAt": "2020-12-22T14:28:03Z", "author": {"login": "DaanHoogland"}, "path": "vmware-base/src/main/java/com/cloud/hypervisor/vmware/mo/HypervisorHostHelper.java", "diffHunk": "@@ -1073,6 +1073,10 @@ public static VMwareDVSPvlanConfigSpec createDVPortPvlanConfigSpec(int vlanId, i\n     }\n \n     public static VmwareDistributedVirtualSwitchVlanSpec createDVPortVlanSpec(Integer vlanId, String vlanRange) {\n+        if (vlanId != null && vlanId == 4095){\n+            vlanId = null;\n+            vlanRange = \"0-4094\";\n+        }", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "1b48ee2d470ae4a95e9adca68bbb9de59024b2f6"}, "originalPosition": 7}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTYzMjc4NDY2", "url": "https://github.com/apache/cloudstack/pull/4557#pullrequestreview-563278466", "createdAt": "2021-01-07T08:05:21Z", "commit": {"oid": "1b48ee2d470ae4a95e9adca68bbb9de59024b2f6"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wMS0wN1QwODowNToyMlrOIPikuw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wMS0wN1QwODowNToyMlrOIPikuw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1MzE2NjAxMQ==", "bodyText": "@Spaceman1984 Have you tested this?\nthis method createDVPortVlanSpec() is called only when vlanId is null, so if check here is always 'false' and the underlying code never executes. Please check and try to fix this in the appropriate top level method in the call stack.", "url": "https://github.com/apache/cloudstack/pull/4557#discussion_r553166011", "createdAt": "2021-01-07T08:05:22Z", "author": {"login": "sureshanaparti"}, "path": "vmware-base/src/main/java/com/cloud/hypervisor/vmware/mo/HypervisorHostHelper.java", "diffHunk": "@@ -1073,6 +1073,10 @@ public static VMwareDVSPvlanConfigSpec createDVPortPvlanConfigSpec(int vlanId, i\n     }\n \n     public static VmwareDistributedVirtualSwitchVlanSpec createDVPortVlanSpec(Integer vlanId, String vlanRange) {\n+        if (vlanId != null && vlanId == 4095){", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "1b48ee2d470ae4a95e9adca68bbb9de59024b2f6"}, "originalPosition": 4}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4637, "cost": 1, "resetAt": "2021-10-28T17:48:14Z"}}}