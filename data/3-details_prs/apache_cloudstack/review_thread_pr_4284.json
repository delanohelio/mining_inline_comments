{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDczMjcwNzI1", "number": 4284, "reviewThreads": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yNlQwNjo1MzozN1rOEccABA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yNlQwNjo1MzozN1rOEccABA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjk4MjU0MzQwOnYy", "diffSide": "RIGHT", "path": "engine/orchestration/src/main/java/com/cloud/vm/VirtualMachineManagerImpl.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yNlQwNjo1MzozN1rOHG-RsA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yNlQwNjo1Njo1M1rOHG-Xig==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NzA3Mzg0MA==", "bodyText": "@Spaceman1984 should we update the power state after guru finalises the stop? What is there is an exception then the power state will be off while VM may actually be running?", "url": "https://github.com/apache/cloudstack/pull/4284#discussion_r477073840", "createdAt": "2020-08-26T06:53:37Z", "author": {"login": "rhtyd"}, "path": "engine/orchestration/src/main/java/com/cloud/vm/VirtualMachineManagerImpl.java", "diffHunk": "@@ -1657,6 +1657,10 @@ protected boolean sendStop(final VirtualMachineGuru guru, final VirtualMachinePr\n                     return false;\n                 }\n \n+                final UserVmVO userVm = _userVmDao.findById(vm.getId());\n+                userVm.setPowerState(PowerState.PowerOff);\n+                _userVmDao.update(userVm.getId(), userVm);\n+\n                 guru.finalizeStop(profile, answer);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "a2d2fa0edfe023a9847f05d985e0f753d2931e80"}, "originalPosition": 8}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NzA3NTMzOA==", "bodyText": "np @rhtyd, I'll move it down.", "url": "https://github.com/apache/cloudstack/pull/4284#discussion_r477075338", "createdAt": "2020-08-26T06:56:53Z", "author": {"login": "Spaceman1984"}, "path": "engine/orchestration/src/main/java/com/cloud/vm/VirtualMachineManagerImpl.java", "diffHunk": "@@ -1657,6 +1657,10 @@ protected boolean sendStop(final VirtualMachineGuru guru, final VirtualMachinePr\n                     return false;\n                 }\n \n+                final UserVmVO userVm = _userVmDao.findById(vm.getId());\n+                userVm.setPowerState(PowerState.PowerOff);\n+                _userVmDao.update(userVm.getId(), userVm);\n+\n                 guru.finalizeStop(profile, answer);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NzA3Mzg0MA=="}, "originalCommit": {"oid": "a2d2fa0edfe023a9847f05d985e0f753d2931e80"}, "originalPosition": 8}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3797, "cost": 1, "resetAt": "2021-11-12T11:18:39Z"}}}