{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0MzcwNzc0MTkw", "number": 3864, "title": "Ignore site to site vpn status check on internallbvm", "bodyText": "Description\n\nWhen the state of the site to site vpn changes, the check\nis done on all the virtual routers including the internal\nload balancing vm as well. It is not needed to check the\nstate for internal load balancing vm\n\n\n\n\n\nTypes of changes\n\n\n Breaking change (fix or feature that would cause existing functionality to change)\n New feature (non-breaking change which adds functionality)\n Bug fix (non-breaking change which fixes an issue)\n Enhancement (improves an existing feature and functionality)\n Cleanup (Code refactoring and cleanup, that may add test cases)\n\nScreenshots (if appropriate):\nHow Has This Been Tested?\n\n\n\nSteps to reprodcue the issue\n1 . Create two VPC's. Configure VPN customer gateway and VPN connection. The steps are clearly explained here\n2 . Now navigate to networks section in main cloudstack ui. In the drop down menu select VPC. Click configure on one of the VPC\n3 . Click on \"Create Network\" and create a tier with \"DefaultisolatedNetworkOfferingForVPCNetworksWithInternalLB\" network offering\n4 . Once the tier is created click on \"Internal LB\" tab.\n5 . In the right side, click on \"Add Internal LB\" button\n6 . Enter the input according to your needs and press OK\n7 . Once the Internal LB is created, click on it and select the \"Assigned VM's\" tab.\n8 . Click on \"Assign VM's\" button and select the VM's which are present in this tier. If none are present then create vm's.\n9 . This will create a new type of router \"internallb\" which can be listed using the cloudmonkey command \"list internalloadbalancervms\" whose name starts with b-\n10 . Change the state of any VPN connection in this VPC and observe the logs for the keyword \"Site-to-site Vpn Connection to  on router b-<>-VM\"\nExpected result:\nA log mesasge mentioned in the step 10 will be displayed in /var/log/cloudstack/management/management-server.log\nActual result:\nThe above log should not be displayed.", "createdAt": "2020-02-04T11:02:37Z", "url": "https://github.com/apache/cloudstack/pull/3864", "merged": true, "mergeCommit": {"oid": "bbe2bf1a6ef6728132a92bb3b586795f068a403d"}, "closed": true, "closedAt": "2020-02-18T08:33:31Z", "author": {"login": "ravening"}, "timelineItems": {"totalCount": 8, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcBA4UHgFqTM1Mjk0NDQyNQ==", "endCursor": "Y3Vyc29yOnYyOpPPAAABcDmUT9AFqTM1NzQ0NzYwNQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzUyOTQ0NDI1", "url": "https://github.com/apache/cloudstack/pull/3864#pullrequestreview-352944425", "createdAt": "2020-02-04T12:41:30Z", "commit": {"oid": "164f9847d63435eb30e7c543958c419cb64328d9"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0wNFQxMjo0MTozMFrOFlSqtw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0wNFQxMjo0MTozMFrOFlSqtw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NDY0NzQ3OQ==", "bodyText": "Could it cause regressions for anything others: LB, INTERNAL_LB_VM, NETSCALER_VM cc @weizhouapache @DaanHoogland", "url": "https://github.com/apache/cloudstack/pull/3864#discussion_r374647479", "createdAt": "2020-02-04T12:41:30Z", "author": {"login": "rhtyd"}, "path": "server/src/main/java/com/cloud/network/router/VirtualNetworkApplianceManagerImpl.java", "diffHunk": "@@ -885,6 +885,10 @@ public void doInTransactionWithoutResult(final TransactionStatus status) {\n     @DB\n     protected void updateSite2SiteVpnConnectionState(final List<DomainRouterVO> routers) {\n         for (final DomainRouterVO router : routers) {\n+            if (router.getRole() != Role.VIRTUAL_ROUTER) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "164f9847d63435eb30e7c543958c419cb64328d9"}, "originalPosition": 4}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzUyOTkyNjQ5", "url": "https://github.com/apache/cloudstack/pull/3864#pullrequestreview-352992649", "createdAt": "2020-02-04T13:57:27Z", "commit": {"oid": "164f9847d63435eb30e7c543958c419cb64328d9"}, "state": "APPROVED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0wNFQxMzo1NzoyOFrOFlU40A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0wNFQxMzo1NzoyOFrOFlU40A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NDY4Mzg1Ng==", "bodyText": "@rhtyd as far as I know, site2site vpn can only be applied on vpc vrs, so this should be ok.", "url": "https://github.com/apache/cloudstack/pull/3864#discussion_r374683856", "createdAt": "2020-02-04T13:57:28Z", "author": {"login": "weizhouapache"}, "path": "server/src/main/java/com/cloud/network/router/VirtualNetworkApplianceManagerImpl.java", "diffHunk": "@@ -885,6 +885,10 @@ public void doInTransactionWithoutResult(final TransactionStatus status) {\n     @DB\n     protected void updateSite2SiteVpnConnectionState(final List<DomainRouterVO> routers) {\n         for (final DomainRouterVO router : routers) {\n+            if (router.getRole() != Role.VIRTUAL_ROUTER) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NDY0NzQ3OQ=="}, "originalCommit": {"oid": "164f9847d63435eb30e7c543958c419cb64328d9"}, "originalPosition": 4}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzU1MTI4ODA2", "url": "https://github.com/apache/cloudstack/pull/3864#pullrequestreview-355128806", "createdAt": "2020-02-07T12:39:34Z", "commit": {"oid": "164f9847d63435eb30e7c543958c419cb64328d9"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "164f9847d63435eb30e7c543958c419cb64328d9", "author": {"user": {"login": "ravening", "name": "Rakesh"}}, "url": "https://github.com/apache/cloudstack/commit/164f9847d63435eb30e7c543958c419cb64328d9", "committedDate": "2020-02-04T10:54:46Z", "message": "Ignore site to site vpn status check on internallbvm\n\nWhen the state of the site to site vpn changes, the check\nis done on all the virtual routers including the internal\nload balancing vm as well. It is not needed to check the\nstate for internal load balancing vm"}, "afterCommit": {"oid": "4630e85c9e60415bb34938acf379414d808fc234", "author": {"user": {"login": "ravening", "name": "Rakesh"}}, "url": "https://github.com/apache/cloudstack/commit/4630e85c9e60415bb34938acf379414d808fc234", "committedDate": "2020-02-12T09:29:07Z", "message": "Ignore site to site vpn status check on internallbvm\n\nWhen the state of the site to site vpn changes, the check\nis done on all the virtual routers including the internal\nload balancing vm as well. It is not needed to check the\nstate for internal load balancing vm"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "2215f8b12de3fef7ea93ddda81cf9fa2208c17f3", "author": {"user": {"login": "ravening", "name": "Rakesh"}}, "url": "https://github.com/apache/cloudstack/commit/2215f8b12de3fef7ea93ddda81cf9fa2208c17f3", "committedDate": "2020-02-12T10:00:48Z", "message": "Ignore site to site vpn status check on internallbvm\n\nWhen the state of the site to site vpn changes, the check\nis done on all the virtual routers including the internal\nload balancing vm as well. It is not needed to check the\nstate for internal load balancing vm"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "4630e85c9e60415bb34938acf379414d808fc234", "author": {"user": {"login": "ravening", "name": "Rakesh"}}, "url": "https://github.com/apache/cloudstack/commit/4630e85c9e60415bb34938acf379414d808fc234", "committedDate": "2020-02-12T09:29:07Z", "message": "Ignore site to site vpn status check on internallbvm\n\nWhen the state of the site to site vpn changes, the check\nis done on all the virtual routers including the internal\nload balancing vm as well. It is not needed to check the\nstate for internal load balancing vm"}, "afterCommit": {"oid": "2215f8b12de3fef7ea93ddda81cf9fa2208c17f3", "author": {"user": {"login": "ravening", "name": "Rakesh"}}, "url": "https://github.com/apache/cloudstack/commit/2215f8b12de3fef7ea93ddda81cf9fa2208c17f3", "committedDate": "2020-02-12T10:00:48Z", "message": "Ignore site to site vpn status check on internallbvm\n\nWhen the state of the site to site vpn changes, the check\nis done on all the virtual routers including the internal\nload balancing vm as well. It is not needed to check the\nstate for internal load balancing vm"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzU3Mzc4MTI2", "url": "https://github.com/apache/cloudstack/pull/3864#pullrequestreview-357378126", "createdAt": "2020-02-12T11:27:27Z", "commit": {"oid": "2215f8b12de3fef7ea93ddda81cf9fa2208c17f3"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzU3NDQ3NjA1", "url": "https://github.com/apache/cloudstack/pull/3864#pullrequestreview-357447605", "createdAt": "2020-02-12T13:26:26Z", "commit": {"oid": "2215f8b12de3fef7ea93ddda81cf9fa2208c17f3"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4594, "cost": 1, "resetAt": "2021-10-28T17:48:14Z"}}}