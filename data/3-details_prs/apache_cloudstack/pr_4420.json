{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTA4MTI2Nzcw", "number": 4420, "title": "Including instance details in KubernetesClusterResponse", "bodyText": "Description\nReturning list of virtual machine nodes of a cluster rather than just their IDs. Simplifies the UI as well (Reduces API calls and checks post 4.15 release in primate for backward compatibility)\nTypes of changes\n\n\n Breaking change (fix or feature that would cause existing functionality to change)\n New feature (non-breaking change which adds functionality)\n Bug fix (non-breaking change which fixes an issue)\n Enhancement (improves an existing feature and functionality)\n Cleanup (Code refactoring and cleanup, that may add test cases)\n\nHow Has This Been Tested?\n(kubeadmin) \ud83d\udc31 > list kubernetesclusters id=3d2d10cd-db04-4c4f-87f0-7405d45333e8 \n{\n  \"count\": 1,\n  \"kubernetescluster\": [\n    {\n      .....\n      \"name\": \"cluster-1\",\n      \"virtualmachines\": [\n        {\n          .....\n          \"displayname\": \"cluster-1-master-1754f2cc2da\",\n          .....\n        },\n        {\n         .....\n          \"displayname\": \"cluster-1-node-1754f2cd5f1\",\n          .....\n        }\n      ],\n    }\n  ]\n}", "createdAt": "2020-10-22T08:52:13Z", "url": "https://github.com/apache/cloudstack/pull/4420", "merged": true, "mergeCommit": {"oid": "8a8947aa1ebc15c227f501bd8f747f360b5916d2"}, "closed": true, "closedAt": "2020-10-27T13:44:45Z", "author": {"login": "davidjumani"}, "timelineItems": {"totalCount": 9, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdU9-OpAH2gAyNTA4MTI2NzcwOjZjY2I5YTM3OTU3MDZjOWU0ZGYxZDM2OWM0MTQ4MmM3OGRiYjgwZGM=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdWnPPlgFqTUxNzU5ODE1Mw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "6ccb9a3795706c9e4df1d369c41482c78dbb80dc", "author": {"user": {"login": "davidjumani", "name": null}}, "url": "https://github.com/apache/cloudstack/commit/6ccb9a3795706c9e4df1d369c41482c78dbb80dc", "committedDate": "2020-10-22T08:47:54Z", "message": "Including instance details in KubernetesClusterResponse"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "42f92f6bed26962a79da18dac97b31c7b2262dd7", "author": {"user": {"login": "davidjumani", "name": null}}, "url": "https://github.com/apache/cloudstack/commit/42f92f6bed26962a79da18dac97b31c7b2262dd7", "committedDate": "2020-10-22T09:02:07Z", "message": "Fixing tests"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "ba7c048bc0f9a194599a9689d86511270814ef29", "author": {"user": {"login": "davidjumani", "name": null}}, "url": "https://github.com/apache/cloudstack/commit/ba7c048bc0f9a194599a9689d86511270814ef29", "committedDate": "2020-10-22T08:59:52Z", "message": "Fixing tests"}, "afterCommit": {"oid": "42f92f6bed26962a79da18dac97b31c7b2262dd7", "author": {"user": {"login": "davidjumani", "name": null}}, "url": "https://github.com/apache/cloudstack/commit/42f92f6bed26962a79da18dac97b31c7b2262dd7", "committedDate": "2020-10-22T09:02:07Z", "message": "Fixing tests"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTE0NjM3NTU2", "url": "https://github.com/apache/cloudstack/pull/4420#pullrequestreview-514637556", "createdAt": "2020-10-22T11:47:30Z", "commit": {"oid": "42f92f6bed26962a79da18dac97b31c7b2262dd7"}, "state": "APPROVED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yMlQxMTo0NzozMFrOHmdx-A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yMlQxMTo0NzozMFrOHmdx-A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMDA5NTg2NA==", "bodyText": "would like this string constant defined", "url": "https://github.com/apache/cloudstack/pull/4420#discussion_r510095864", "createdAt": "2020-10-22T11:47:30Z", "author": {"login": "DaanHoogland"}, "path": "plugins/integrations/kubernetes-service/src/main/java/com/cloud/kubernetes/cluster/KubernetesClusterManagerImpl.java", "diffHunk": "@@ -606,13 +610,20 @@ public KubernetesClusterResponse createKubernetesClusterResponse(long kubernetes\n         response.setEndpoint(kubernetesCluster.getEndpoint());\n         response.setNetworkId(ntwk.getUuid());\n         response.setAssociatedNetworkName(ntwk.getName());\n-        List<String> vmIds = new ArrayList<String>();\n+        List<UserVmResponse> vmIds = new ArrayList<UserVmResponse>();\n         List<KubernetesClusterVmMapVO> vmList = kubernetesClusterVmMapDao.listByClusterId(kubernetesCluster.getId());\n+        ResponseView respView = ResponseView.Restricted;\n+        Account caller = CallContext.current().getCallingAccount();\n+        if (accountService.isRootAdmin(caller.getId())) {\n+            respView = ResponseView.Full;\n+        }\n         if (vmList != null && !vmList.isEmpty()) {\n             for (KubernetesClusterVmMapVO vmMapVO : vmList) {\n-                UserVmVO userVM = userVmDao.findById(vmMapVO.getVmId());\n+                UserVmJoinVO userVM = userVmJoinDao.findById(vmMapVO.getVmId());\n                 if (userVM != null) {\n-                    vmIds.add(userVM.getUuid());\n+                    UserVmResponse vmResponse = ApiDBUtils.newUserVmResponse(respView, \"virtualmachine\", userVM,", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "42f92f6bed26962a79da18dac97b31c7b2262dd7"}, "originalPosition": 73}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTE1MjIyMTUz", "url": "https://github.com/apache/cloudstack/pull/4420#pullrequestreview-515222153", "createdAt": "2020-10-23T01:31:56Z", "commit": {"oid": "42f92f6bed26962a79da18dac97b31c7b2262dd7"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yM1QwMTozMTo1NlrOHm5SUQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yM1QwMTozMTo1NlrOHm5SUQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMDU0NjUxMw==", "bodyText": "@davidjumani considering that this variable has changed from a list of VM IDs to a list of VM Responses I would suggest renaming it.\nWhat do you think of vmResponses or vmResponseList?", "url": "https://github.com/apache/cloudstack/pull/4420#discussion_r510546513", "createdAt": "2020-10-23T01:31:56Z", "author": {"login": "GabrielBrascher"}, "path": "plugins/integrations/kubernetes-service/src/main/java/com/cloud/kubernetes/cluster/KubernetesClusterManagerImpl.java", "diffHunk": "@@ -606,13 +610,20 @@ public KubernetesClusterResponse createKubernetesClusterResponse(long kubernetes\n         response.setEndpoint(kubernetesCluster.getEndpoint());\n         response.setNetworkId(ntwk.getUuid());\n         response.setAssociatedNetworkName(ntwk.getName());\n-        List<String> vmIds = new ArrayList<String>();\n+        List<UserVmResponse> vmIds = new ArrayList<UserVmResponse>();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "42f92f6bed26962a79da18dac97b31c7b2262dd7"}, "originalPosition": 60}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e844a1c6af9d42bceaaee4c43db923d51dc5691a", "author": {"user": {"login": "davidjumani", "name": null}}, "url": "https://github.com/apache/cloudstack/commit/e844a1c6af9d42bceaaee4c43db923d51dc5691a", "committedDate": "2020-10-23T02:53:30Z", "message": "Refactoring"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTE3Mzg2MTA1", "url": "https://github.com/apache/cloudstack/pull/4420#pullrequestreview-517386105", "createdAt": "2020-10-27T06:42:11Z", "commit": {"oid": "e844a1c6af9d42bceaaee4c43db923d51dc5691a"}, "state": "COMMENTED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTE3NTM3MTA5", "url": "https://github.com/apache/cloudstack/pull/4420#pullrequestreview-517537109", "createdAt": "2020-10-27T10:12:41Z", "commit": {"oid": "e844a1c6af9d42bceaaee4c43db923d51dc5691a"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTE3NTk4MTUz", "url": "https://github.com/apache/cloudstack/pull/4420#pullrequestreview-517598153", "createdAt": "2020-10-27T11:26:31Z", "commit": {"oid": "e844a1c6af9d42bceaaee4c43db923d51dc5691a"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4725, "cost": 1, "resetAt": "2021-10-28T17:48:14Z"}}}