{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0MzgzMDIzNzU2", "number": 3925, "reviewThreads": {"totalCount": 10, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wNFQwNzo1NzowMlrODk8UHw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wNFQxODoxNjoxNlrODlJpiA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjQwMDYzNTE5OnYy", "diffSide": "RIGHT", "path": "api/src/main/java/org/apache/cloudstack/api/response/ServiceOfferingResponse.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wNFQwNzo1NzowMlrOFxjCjQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wNFQwNzo1NzowMlrOFxjCjQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NzQ5ODYzNw==", "bodyText": "\"since\" on the return @param as attribute but not on the request @parameter in the API. Probably C&P as i don't think you are planning this for the 4.4 branch! please adjust and expand (or remove)", "url": "https://github.com/apache/cloudstack/pull/3925#discussion_r387498637", "createdAt": "2020-03-04T07:57:02Z", "author": {"login": "DaanHoogland"}, "path": "api/src/main/java/org/apache/cloudstack/api/response/ServiceOfferingResponse.java", "diffHunk": "@@ -192,6 +192,10 @@\n     @Param(description = \"is true if the offering is customized\", since = \"4.3.0\")\n     private Boolean isCustomized;\n \n+    @SerializedName(\"cacheMode\")\n+    @Param(description = \"the cache mode to use for this disk offering. none, writeback or writethrough\", since = \"4.4\")", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "4521c0023c856d43db238b1a49771e6a3d91d633"}, "originalPosition": 5}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjQwMDY1MDI5OnYy", "diffSide": "RIGHT", "path": "server/src/main/java/com/cloud/configuration/ConfigurationManagerImpl.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wNFQwODowMjo1N1rOFxjLYA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wNFQwODowMjo1N1rOFxjLYA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NzUwMDg5Ng==", "bodyText": "can you put this in its own method.", "url": "https://github.com/apache/cloudstack/pull/3925#discussion_r387500896", "createdAt": "2020-03-04T08:02:57Z", "author": {"login": "DaanHoogland"}, "path": "server/src/main/java/com/cloud/configuration/ConfigurationManagerImpl.java", "diffHunk": "@@ -2936,6 +2948,11 @@ public DiskOffering createDiskOffering(final CreateDiskOfferingCmd cmd) {\n             throw new InvalidParameterValueException(\"Disksize is not allowed for a customized disk offering\");\n         }\n \n+        // check if valid cache_mode parameter\n+        if(cmd.getCacheMode() != null && !Enums.getIfPresent(DiskOffering.DiskCacheMode.class, cmd.getCacheMode().toUpperCase()).isPresent()){\n+            throw new InvalidParameterValueException(\"Please specify a valid cache mode parameter\");\n+        }\n+", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "4521c0023c856d43db238b1a49771e6a3d91d633"}, "originalPosition": 75}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjQwMDY5MTc2OnYy", "diffSide": "RIGHT", "path": "test/integration/smoke/test_disk_offerings.py", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wNFQwODoxODo0NVrOFxjkJg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wNFQwODoxODo0NVrOFxjkJg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NzUwNzIzOA==", "bodyText": "Why this renumbering/renaming? It can break statistic analysis of test breakage or comparison. Why not add them to the end with new numbers?", "url": "https://github.com/apache/cloudstack/pull/3925#discussion_r387507238", "createdAt": "2020-03-04T08:18:45Z", "author": {"login": "DaanHoogland"}, "path": "test/integration/smoke/test_disk_offerings.py", "diffHunk": "@@ -90,9 +90,81 @@ def test_01_create_disk_offering(self):\n                         )\n         return\n \n+    @attr(tags=[\"advanced\", \"basic\", \"eip\", \"sg\", \"advancedns\", \"smoke\"], required_hardware=\"false\")\n+    def test_02_create_disk_offering_with_cache_mode_type(self):", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "4521c0023c856d43db238b1a49771e6a3d91d633"}, "originalPosition": 5}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjQwMDY5NDIzOnYy", "diffSide": "RIGHT", "path": "test/integration/smoke/test_service_offerings.py", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wNFQwODoxOTozNFrOFxjlkw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wNFQwODoxOTozNFrOFxjlkw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NzUwNzYwMw==", "bodyText": "again, why not add as test_03 and test_04?", "url": "https://github.com/apache/cloudstack/pull/3925#discussion_r387507603", "createdAt": "2020-03-04T08:19:34Z", "author": {"login": "DaanHoogland"}, "path": "test/integration/smoke/test_service_offerings.py", "diffHunk": "@@ -129,6 +129,110 @@ def test_01_create_service_offering(self):\n             \"Check name in createServiceOffering\"\n         )\n         return\n+\n+    @attr(\n+        tags=[\n+            \"advanced\",\n+            \"advancedns\",\n+            \"smoke\",\n+            \"basic\",\n+            \"eip\",\n+            \"sg\"],\n+        required_hardware=\"false\")\n+    def test_02_create_service_offering_with_cache_mode_type(self):", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "4521c0023c856d43db238b1a49771e6a3d91d633"}, "originalPosition": 14}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjQwMjQwMDk2OnYy", "diffSide": "RIGHT", "path": "api/src/main/java/org/apache/cloudstack/api/command/admin/offering/CreateServiceOfferingCmd.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wNFQxNjoyMTowM1rOFx0F7w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wNFQxODo1MDowOVrOFx5V1w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4Nzc3ODAzMQ==", "bodyText": "since = \"4.14\" if merged in time for 4.14 releasing", "url": "https://github.com/apache/cloudstack/pull/3925#discussion_r387778031", "createdAt": "2020-03-04T16:21:03Z", "author": {"login": "GabrielBrascher"}, "path": "api/src/main/java/org/apache/cloudstack/api/command/admin/offering/CreateServiceOfferingCmd.java", "diffHunk": "@@ -178,6 +178,13 @@\n             since = \"4.4\")\n     private Integer hypervisorSnapshotReserve;\n \n+    @Parameter(name = ApiConstants.CACHE_MODE,\n+            type = CommandType.STRING,\n+            required = false,\n+            description = \"the cache mode to use for this disk offering. none, writeback or writethrough\",\n+            since = \"4.13\")", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ec4d15ef182c2f099f455c1a0dc3cbe2dc6d80e8"}, "originalPosition": 8}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4Nzg2NDAyMw==", "bodyText": "@DaanHoogland this \"since\" should be 4.14, right? Is it going to be merged into branch 4.13 instead of master?", "url": "https://github.com/apache/cloudstack/pull/3925#discussion_r387864023", "createdAt": "2020-03-04T18:50:09Z", "author": {"login": "GabrielBrascher"}, "path": "api/src/main/java/org/apache/cloudstack/api/command/admin/offering/CreateServiceOfferingCmd.java", "diffHunk": "@@ -178,6 +178,13 @@\n             since = \"4.4\")\n     private Integer hypervisorSnapshotReserve;\n \n+    @Parameter(name = ApiConstants.CACHE_MODE,\n+            type = CommandType.STRING,\n+            required = false,\n+            description = \"the cache mode to use for this disk offering. none, writeback or writethrough\",\n+            since = \"4.13\")", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4Nzc3ODAzMQ=="}, "originalCommit": {"oid": "ec4d15ef182c2f099f455c1a0dc3cbe2dc6d80e8"}, "originalPosition": 8}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjQwMjQwNjg0OnYy", "diffSide": "RIGHT", "path": "api/src/main/java/org/apache/cloudstack/api/response/ServiceOfferingResponse.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wNFQxNjoyMjoxOVrOFx0Jrw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wNFQxNjoyMjoxOVrOFx0Jrw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4Nzc3ODk5MQ==", "bodyText": "Change to 4.14?", "url": "https://github.com/apache/cloudstack/pull/3925#discussion_r387778991", "createdAt": "2020-03-04T16:22:19Z", "author": {"login": "GabrielBrascher"}, "path": "api/src/main/java/org/apache/cloudstack/api/response/ServiceOfferingResponse.java", "diffHunk": "@@ -192,6 +192,10 @@\n     @Param(description = \"is true if the offering is customized\", since = \"4.3.0\")\n     private Boolean isCustomized;\n \n+    @SerializedName(\"cacheMode\")\n+    @Param(description = \"the cache mode to use for this disk offering. none, writeback or writethrough\", since = \"4.13.0\")", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ec4d15ef182c2f099f455c1a0dc3cbe2dc6d80e8"}, "originalPosition": 5}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjQwMjU1OTE2OnYy", "diffSide": "RIGHT", "path": "api/src/main/java/org/apache/cloudstack/api/command/admin/offering/CreateDiskOfferingCmd.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wNFQxNzowMDowMVrOFx1png==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wNFQxNzowMDowMVrOFx1png==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NzgwMzU1MA==", "bodyText": "@radu-todirica why no since attribute here? no biggy, just wondering if you forgot.", "url": "https://github.com/apache/cloudstack/pull/3925#discussion_r387803550", "createdAt": "2020-03-04T17:00:01Z", "author": {"login": "DaanHoogland"}, "path": "api/src/main/java/org/apache/cloudstack/api/command/admin/offering/CreateDiskOfferingCmd.java", "diffHunk": "@@ -144,6 +144,9 @@\n             description = \"Hypervisor snapshot reserve space as a percent of a volume (for managed storage using Xen or VMware)\")\n     private Integer hypervisorSnapshotReserve;\n \n+    @Parameter(name = ApiConstants.CACHE_MODE, type = CommandType.STRING, required = false, description = \"the cache mode to use for this disk offering. none, writeback or writethrough\")", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ec4d15ef182c2f099f455c1a0dc3cbe2dc6d80e8"}, "originalPosition": 4}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjQwMjU2MzU1OnYy", "diffSide": "RIGHT", "path": "server/src/main/java/com/cloud/configuration/ConfigurationManagerImpl.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wNFQxNzowMToxMVrOFx1sXw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wNFQxNzowMToxMVrOFx1sXw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NzgwNDI1NQ==", "bodyText": "I think it is better to call the method validateCachMode(String cacheMode) and include this code as it is duplicated below in lines 2951 - 2955:\nvoid validateCachMode(String cacheMode){\n    if( cacheMode != null &&\n        !Enums.getIfPresent(DiskOffering.DiskCacheMode.class,\n                            cacheMode.toUpperCase()).isPresent() {\n        throw new InvalidParameterValueException(\"Please specify a valid cache mode parameter\");\n    }\n}", "url": "https://github.com/apache/cloudstack/pull/3925#discussion_r387804255", "createdAt": "2020-03-04T17:01:11Z", "author": {"login": "DaanHoogland"}, "path": "server/src/main/java/com/cloud/configuration/ConfigurationManagerImpl.java", "diffHunk": "@@ -2318,6 +2319,11 @@ public ServiceOffering createServiceOffering(final CreateServiceOfferingCmd cmd)\n             }\n         }\n \n+        // check if valid cache_mode parameter\n+        if(isCacheModeInvalid(cmd.getCacheMode())){\n+            throw new InvalidParameterValueException(\"Please specify a valid cache mode parameter\");\n+        }\n+", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ec4d15ef182c2f099f455c1a0dc3cbe2dc6d80e8"}, "originalPosition": 16}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjQwMjU2NDk5OnYy", "diffSide": "RIGHT", "path": "server/src/main/java/com/cloud/configuration/ConfigurationManagerImpl.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wNFQxNzowMTozN1rOFx1tWw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wNFQxNzowMTozN1rOFx1tWw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NzgwNDUwNw==", "bodyText": "duplicate of 2322 - 2326", "url": "https://github.com/apache/cloudstack/pull/3925#discussion_r387804507", "createdAt": "2020-03-04T17:01:37Z", "author": {"login": "DaanHoogland"}, "path": "server/src/main/java/com/cloud/configuration/ConfigurationManagerImpl.java", "diffHunk": "@@ -2936,6 +2948,11 @@ public DiskOffering createDiskOffering(final CreateDiskOfferingCmd cmd) {\n             throw new InvalidParameterValueException(\"Disksize is not allowed for a customized disk offering\");\n         }\n \n+        // check if valid cache_mode parameter\n+        if(isCacheModeInvalid(cmd.getCacheMode())){\n+            throw new InvalidParameterValueException(\"Please specify a valid cache mode parameter\");\n+        }\n+", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ec4d15ef182c2f099f455c1a0dc3cbe2dc6d80e8"}, "originalPosition": 75}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjQwMjgxOTkyOnYy", "diffSide": "RIGHT", "path": "server/src/main/java/com/cloud/configuration/ConfigurationManagerImpl.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wNFQxODoxNjoxNlrOFx4OeQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wNFQxODoxNjoxNlrOFx4OeQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4Nzg0NTc1Mw==", "bodyText": "Can you please add more information on the log? Example: String.format(\"Invalid cache mode (%s), specify a valid cache mode parameter\", cmd.getCacheMode())", "url": "https://github.com/apache/cloudstack/pull/3925#discussion_r387845753", "createdAt": "2020-03-04T18:16:16Z", "author": {"login": "GabrielBrascher"}, "path": "server/src/main/java/com/cloud/configuration/ConfigurationManagerImpl.java", "diffHunk": "@@ -2936,6 +2948,11 @@ public DiskOffering createDiskOffering(final CreateDiskOfferingCmd cmd) {\n             throw new InvalidParameterValueException(\"Disksize is not allowed for a customized disk offering\");\n         }\n \n+        // check if valid cache_mode parameter\n+        if(isCacheModeInvalid(cmd.getCacheMode())){\n+            throw new InvalidParameterValueException(\"Please specify a valid cache mode parameter\");", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ec4d15ef182c2f099f455c1a0dc3cbe2dc6d80e8"}, "originalPosition": 73}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3957, "cost": 1, "resetAt": "2021-11-12T11:18:39Z"}}}