{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDkyMDM3NTU2", "number": 4341, "reviewThreads": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yMlQwODoxOTo0MFrOEwprcg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0zMFQwNzo1NDoxMFrOEzrvdA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzE5NDQ5OTcwOnYy", "diffSide": "RIGHT", "path": "api/src/main/java/org/apache/cloudstack/api/command/admin/offering/CreateServiceOfferingCmd.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yMlQwODoxOTo0MFrOHmWClQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yMlQxNDowMjoxM1rOHmjW0w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwOTk2OTA0NQ==", "bodyText": "Do we need since parameter here?", "url": "https://github.com/apache/cloudstack/pull/4341#discussion_r509969045", "createdAt": "2020-10-22T08:19:40Z", "author": {"login": "ravening"}, "path": "api/src/main/java/org/apache/cloudstack/api/command/admin/offering/CreateServiceOfferingCmd.java", "diffHunk": "@@ -126,6 +126,9 @@\n     @Parameter(name = ApiConstants.SERVICE_OFFERING_DETAILS, type = CommandType.MAP, description = \"details for planner, used to store specific parameters\")\n     private Map details;\n \n+    @Parameter(name = ApiConstants.ROOT_DISK_SIZE, type = CommandType.LONG, required = false, description = \"the Root disk size in GB.\")", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "4f501f0624a44fe2414835f17f210bf977f08846"}, "originalPosition": 4}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMDE4NzIxOQ==", "bodyText": "Sounds like a good place to add since ;)\nThanks for the heads up @ravening!", "url": "https://github.com/apache/cloudstack/pull/4341#discussion_r510187219", "createdAt": "2020-10-22T14:02:13Z", "author": {"login": "GabrielBrascher"}, "path": "api/src/main/java/org/apache/cloudstack/api/command/admin/offering/CreateServiceOfferingCmd.java", "diffHunk": "@@ -126,6 +126,9 @@\n     @Parameter(name = ApiConstants.SERVICE_OFFERING_DETAILS, type = CommandType.MAP, description = \"details for planner, used to store specific parameters\")\n     private Map details;\n \n+    @Parameter(name = ApiConstants.ROOT_DISK_SIZE, type = CommandType.LONG, required = false, description = \"the Root disk size in GB.\")", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwOTk2OTA0NQ=="}, "originalCommit": {"oid": "4f501f0624a44fe2414835f17f210bf977f08846"}, "originalPosition": 4}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzE5NDUxNTcxOnYy", "diffSide": "RIGHT", "path": "server/src/main/java/com/cloud/configuration/ConfigurationManagerImpl.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yMlQwODoyMzoyMlrOHmWM0Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yMlQxMzo1OTozMlrOHmjN1A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwOTk3MTY2NQ==", "bodyText": "An optimization suggestion here. You can write below one liner since rootDiskSizeInBytes is not used anywhere else\noffering.setDiskSize(rootDiskSizeInGiB * GiB_TO_BYTES)", "url": "https://github.com/apache/cloudstack/pull/4341#discussion_r509971665", "createdAt": "2020-10-22T08:23:22Z", "author": {"login": "ravening"}, "path": "server/src/main/java/com/cloud/configuration/ConfigurationManagerImpl.java", "diffHunk": "@@ -2518,6 +2520,12 @@ protected ServiceOfferingVO createServiceOffering(final long userId, final boole\n             }\n         }\n \n+        if (rootDiskSizeInGiB != null && rootDiskSizeInGiB <= 0L) {\n+            throw new InvalidParameterValueException(String.format(\"The Root disk size is of %s GB but it must be greater than 0.\", rootDiskSizeInGiB));\n+        } else if (rootDiskSizeInGiB != null) {\n+            long rootDiskSizeInBytes = rootDiskSizeInGiB * GiB_TO_BYTES;\n+            offering.setDiskSize(rootDiskSizeInBytes);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "4f501f0624a44fe2414835f17f210bf977f08846"}, "originalPosition": 35}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMDE4NDkxNg==", "bodyText": "@ravening that does not make any difference. The JVM feeds its bytecodes to the Just-In-Time compiler (JIT) which will already take care of doing such optimization (among many others).\nI did that way because of 2 reasons, one tecnical and the other a personal option: (i) in case of remote debugging connected via JVM it helps on changing a variable value in runtime; (ii) I prefer that way for code readability.", "url": "https://github.com/apache/cloudstack/pull/4341#discussion_r510184916", "createdAt": "2020-10-22T13:59:32Z", "author": {"login": "GabrielBrascher"}, "path": "server/src/main/java/com/cloud/configuration/ConfigurationManagerImpl.java", "diffHunk": "@@ -2518,6 +2520,12 @@ protected ServiceOfferingVO createServiceOffering(final long userId, final boole\n             }\n         }\n \n+        if (rootDiskSizeInGiB != null && rootDiskSizeInGiB <= 0L) {\n+            throw new InvalidParameterValueException(String.format(\"The Root disk size is of %s GB but it must be greater than 0.\", rootDiskSizeInGiB));\n+        } else if (rootDiskSizeInGiB != null) {\n+            long rootDiskSizeInBytes = rootDiskSizeInGiB * GiB_TO_BYTES;\n+            offering.setDiskSize(rootDiskSizeInBytes);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwOTk3MTY2NQ=="}, "originalCommit": {"oid": "4f501f0624a44fe2414835f17f210bf977f08846"}, "originalPosition": 35}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzE5NDY3MDI4OnYy", "diffSide": "RIGHT", "path": "server/src/main/java/com/cloud/storage/VolumeApiServiceImpl.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yMlQwODo1OTozNlrOHmXsxg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yM1QxODoyMDozMVrOHnYq_A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwOTk5NjIzMA==", "bodyText": "Any specific reason why we are not allowing resizing when vm is running?", "url": "https://github.com/apache/cloudstack/pull/4341#discussion_r509996230", "createdAt": "2020-10-22T08:59:36Z", "author": {"login": "ravening"}, "path": "server/src/main/java/com/cloud/storage/VolumeApiServiceImpl.java", "diffHunk": "@@ -1139,6 +1143,13 @@ public VolumeVO resizeVolume(ResizeVolumeCmd cmd) throws ResourceAllocationExcep\n                 shrinkOk);\n     }\n \n+    private void checkIfVolumeIsRootAndVmIsRunning(Long newSize, VolumeVO volume, VMInstanceVO vmInstanceVO) {\n+        if (!volume.getSize().equals(newSize) && volume.getVolumeType().equals(Volume.Type.ROOT) && !State.Stopped.equals(vmInstanceVO.getState())) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "4f501f0624a44fe2414835f17f210bf977f08846"}, "originalPosition": 62}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMTA2MDczMg==", "bodyText": "@ravening good question.\nThis was done to avoid users thinking that the service offering was updated correctly. Unfortunatelly, it is necessary to Stop/Start the VM, otherwise IOps updates would not take effect, for example. Considering that this is a service offering update command, then we need to take such situations into account.\nAdditionally, not all operation systems support dynamic memory scaling.", "url": "https://github.com/apache/cloudstack/pull/4341#discussion_r511060732", "createdAt": "2020-10-23T18:20:31Z", "author": {"login": "GabrielBrascher"}, "path": "server/src/main/java/com/cloud/storage/VolumeApiServiceImpl.java", "diffHunk": "@@ -1139,6 +1143,13 @@ public VolumeVO resizeVolume(ResizeVolumeCmd cmd) throws ResourceAllocationExcep\n                 shrinkOk);\n     }\n \n+    private void checkIfVolumeIsRootAndVmIsRunning(Long newSize, VolumeVO volume, VMInstanceVO vmInstanceVO) {\n+        if (!volume.getSize().equals(newSize) && volume.getVolumeType().equals(Volume.Type.ROOT) && !State.Stopped.equals(vmInstanceVO.getState())) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwOTk5NjIzMA=="}, "originalCommit": {"oid": "4f501f0624a44fe2414835f17f210bf977f08846"}, "originalPosition": 62}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzIyNjI5NDkyOnYy", "diffSide": "RIGHT", "path": "server/src/main/java/com/cloud/vm/UserVmManagerImpl.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0zMFQwNzo1NDoxMFrOHrEYlA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0zMFQwNzo1NDoxMFrOHrEYlA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNDkyMjY0NA==", "bodyText": "this comment could be a method name instead canServiceOfferingBeAppliedToInstance(...)", "url": "https://github.com/apache/cloudstack/pull/4341#discussion_r514922644", "createdAt": "2020-10-30T07:54:10Z", "author": {"login": "DaanHoogland"}, "path": "server/src/main/java/com/cloud/vm/UserVmManagerImpl.java", "diffHunk": "@@ -1183,24 +1183,27 @@ private UserVm upgradeStoppedVirtualMachine(Long vmId, Long svcOffId, Map<String\n         // Check that the specified service offering ID is valid\n         _itMgr.checkIfCanUpgrade(vmInstance, newServiceOffering);\n \n-        DiskOfferingVO newROOTDiskOffering = _diskOfferingDao.findById(newServiceOffering.getId());\n+        // Check if the new service offering can be applied to vm instance", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "4f6f7f024bec236a7229783a4d60dc8afa3b26d7"}, "originalPosition": 5}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4193, "cost": 1, "resetAt": "2021-11-12T11:18:39Z"}}}