{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDk4MzI4ODgw", "number": 4376, "title": "server: Fix some cpuspeed issues while create service offering", "bodyText": "Description\n\n\n\n\n\n\nOnly the following offerings are accepted\n(1) fixed offering:\ncpunumber, memory, must be specified.\ncpuspeed should be specified\nexample: create serviceoffering displaytext=offering-fix name=offering-fix cpunumber=1 memory=1024 cpuspeed=1000\n(should not work)\ncreate serviceoffering displaytext=offering-fix name=offering-fix cpunumber=1 memory=1024 (but works in 4.14, fixed by this commit)\n(2) unconstrained offering:\ncpunumber, memory must be null\ncpuspeed must be null\nexample: create serviceoffering displaytext=offering-unconstrained name=offering-unconstrained\n(should not work)\ncreate serviceoffering displaytext=offering-unconstrained name=offering-unconstrained cpunumber=1\ncreate serviceoffering displaytext=offering-unconstrained name=offering-unconstrained memory=1024\ncreate serviceoffering displaytext=offering-unconstrained name=offering-unconstrained cpuspeed=1000 (but works in 4.14, fixed by this commit)\n(3) constrained offering:\ncpunumber, memory must be null\nmincpunumber, maxcpunumber, minmemory, maxmemory, cpuspeed must be specified\nexample:create serviceoffering displaytext=offering-constrained name=offering-constrained mincpunumber=1 maxcpunumber=2 minmemory=1024 maxmemory=2048 cpuspeed=1000\n(should not work)\ncreate serviceoffering displaytext=offering-constrained name=offering-constrained mincpunumber=1 maxcpunumber=2 minmemory=1024 maxmemory=2048 (but works in 4.14, fixed by this commit)\nTypes of changes\n\n\n Breaking change (fix or feature that would cause existing functionality to change)\n New feature (non-breaking change which adds functionality)\n Bug fix (non-breaking change which fixes an issue)\n Enhancement (improves an existing feature and functionality)\n Cleanup (Code refactoring and cleanup, that may add test cases)\n\nScreenshots (if appropriate):\nHow Has This Been Tested?", "createdAt": "2020-10-06T07:23:24Z", "url": "https://github.com/apache/cloudstack/pull/4376", "merged": true, "mergeCommit": {"oid": "94f9f8973666372a1d79ffe81776153d04edad78"}, "closed": true, "closedAt": "2020-10-13T09:32:17Z", "author": {"login": "ustcweizhou"}, "timelineItems": {"totalCount": 7, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdPzBw1gH2gAyNDk4MzI4ODgwOjNmMWU5MDk4YjQ0OWU5N2IzZDRmNTFkMTczOTMzODM0MTU4MTFlMTg=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdR3c88gFqTUwNjgwMDA4Nw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "3f1e9098b449e97b3d4f51d17393383415811e18", "author": {"user": {"login": "ustcweizhou", "name": "Wei Zhou"}}, "url": "https://github.com/apache/cloudstack/commit/3f1e9098b449e97b3d4f51d17393383415811e18", "committedDate": "2020-10-06T07:13:11Z", "message": "server: Fix some cpuspeed issues while create service offering\n\nOnly the following offerings are accepted\n\n(1) fixed offering:\ncpunumber, memory, must be specified.\ncpuspeed should be specified\n\nexample: create serviceoffering displaytext=offering-fix name=offering-fix cpunumber=1 memory=1024 cpuspeed=1000\n\n(should not work)\ncreate serviceoffering displaytext=offering-fix name=offering-fix cpunumber=1 memory=1024 (but works in 4.14, fixed by this commit)\n\n(2) unconstrained offering:\n\ncpunumber, memory must be null\ncpuspeed must be null\n\nexample: create serviceoffering displaytext=offering-unconstrained name=offering-unconstrained\n\n(should not work)\ncreate serviceoffering displaytext=offering-unconstrained name=offering-unconstrained cpunumber=1\ncreate serviceoffering displaytext=offering-unconstrained name=offering-unconstrained memory=1024\ncreate serviceoffering displaytext=offering-unconstrained name=offering-unconstrained cpuspeed=1000 (but works in 4.14, fixed by this commit)\n\n(3) constrained offering:\n\ncpunumber, memory must be null\nmincpunumber, maxcpunumber, minmemory, maxmemory, cpuspeed must be specified\n\nexample:create serviceoffering displaytext=offering-constrained name=offering-constrained mincpunumber=1 maxcpunumber=2 minmemory=1024 maxmemory=2048 cpuspeed=1000\n\n(should not work)\ncreate serviceoffering displaytext=offering-constrained name=offering-constrained mincpunumber=1 maxcpunumber=2 minmemory=1024 maxmemory=2048 (but works in 4.14, fixed by this commit)"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTAyODMwNDg3", "url": "https://github.com/apache/cloudstack/pull/4376#pullrequestreview-502830487", "createdAt": "2020-10-06T11:14:59Z", "commit": {"oid": "3f1e9098b449e97b3d4f51d17393383415811e18"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTA1Mzk3ODU1", "url": "https://github.com/apache/cloudstack/pull/4376#pullrequestreview-505397855", "createdAt": "2020-10-09T06:38:21Z", "commit": {"oid": "3f1e9098b449e97b3d4f51d17393383415811e18"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTA1NDIwMzk5", "url": "https://github.com/apache/cloudstack/pull/4376#pullrequestreview-505420399", "createdAt": "2020-10-09T07:21:45Z", "commit": {"oid": "3f1e9098b449e97b3d4f51d17393383415811e18"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wOVQwNzoyMTo0NlrOHe-AmA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wOVQwNzoyMTo0NlrOHe-AmA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMjIzNTI4OA==", "bodyText": "cpuSpeed null check not required here, it is always not null as per the above changes.", "url": "https://github.com/apache/cloudstack/pull/4376#discussion_r502235288", "createdAt": "2020-10-09T07:21:46Z", "author": {"login": "sureshanaparti"}, "path": "server/src/main/java/com/cloud/configuration/ConfigurationManagerImpl.java", "diffHunk": "@@ -2319,9 +2319,9 @@ public ServiceOffering createServiceOffering(final CreateServiceOfferingCmd cmd)\n                 throw new InvalidParameterValueException(\"For creating a custom compute offering cpu and memory all should be null\");\n             }\n             // if any of them is null, then all of them shoull be null\n-            if (maxCPU == null || minCPU == null || maxMemory == null || minMemory == null) {\n-                if (maxCPU != null || minCPU != null || maxMemory != null || minMemory != null) {\n-                    throw new InvalidParameterValueException(\"For creating a custom compute offering min/max cpu and min/max memory should all be specified\");\n+            if (maxCPU == null || minCPU == null || maxMemory == null || minMemory == null || cpuSpeed == null) {\n+                if (maxCPU != null || minCPU != null || maxMemory != null || minMemory != null || cpuSpeed != null) {\n+                    throw new InvalidParameterValueException(\"For creating a custom compute offering min/max cpu and min/max memory/cpu speed should all be null or all specified\");\n                 }\n             } else {\n                 if (cpuSpeed != null && (cpuSpeed.intValue() < 0 || cpuSpeed.longValue() > Integer.MAX_VALUE)) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "3f1e9098b449e97b3d4f51d17393383415811e18"}, "originalPosition": 12}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTA1NDI0NzEz", "url": "https://github.com/apache/cloudstack/pull/4376#pullrequestreview-505424713", "createdAt": "2020-10-09T07:28:51Z", "commit": {"oid": "3f1e9098b449e97b3d4f51d17393383415811e18"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wOVQwNzoyODo1MVrOHe-NzQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wOVQwNzoyODo1MVrOHe-NzQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMjIzODY2OQ==", "bodyText": "@ustcweizhou similar cond check applicable for cpuNumber and memory if these are mandatory params? check and update accordingly.", "url": "https://github.com/apache/cloudstack/pull/4376#discussion_r502238669", "createdAt": "2020-10-09T07:28:51Z", "author": {"login": "sureshanaparti"}, "path": "server/src/main/java/com/cloud/configuration/ConfigurationManagerImpl.java", "diffHunk": "@@ -2343,7 +2343,7 @@ public ServiceOffering createServiceOffering(final CreateServiceOfferingCmd cmd)\n             if (cpuNumber != null && (cpuNumber.intValue() <= 0 || cpuNumber.longValue() > Integer.MAX_VALUE)) {\n                 throw new InvalidParameterValueException(\"Failed to create service offering \" + offeringName + \": specify the cpu number value between 1 and \" + Integer.MAX_VALUE);\n             }\n-            if (cpuSpeed != null && (cpuSpeed.intValue() < 0 || cpuSpeed.longValue() > Integer.MAX_VALUE)) {\n+            if (cpuSpeed == null || (cpuSpeed.intValue() < 0 || cpuSpeed.longValue() > Integer.MAX_VALUE)) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "3f1e9098b449e97b3d4f51d17393383415811e18"}, "originalPosition": 18}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "5f2f58c0e2e2612238340caf2e3b152cbfd2872d", "author": {"user": {"login": "ustcweizhou", "name": "Wei Zhou"}}, "url": "https://github.com/apache/cloudstack/commit/5f2f58c0e2e2612238340caf2e3b152cbfd2872d", "committedDate": "2020-10-09T20:10:33Z", "message": " #4376 Remove unnecessary null check on cpuSpeed"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTA2ODAwMDg3", "url": "https://github.com/apache/cloudstack/pull/4376#pullrequestreview-506800087", "createdAt": "2020-10-12T17:30:21Z", "commit": {"oid": "5f2f58c0e2e2612238340caf2e3b152cbfd2872d"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4954, "cost": 1, "resetAt": "2021-10-28T17:48:14Z"}}}