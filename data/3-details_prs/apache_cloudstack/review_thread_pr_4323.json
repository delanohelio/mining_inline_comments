{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDg1ODczMzg4", "number": 4323, "reviewThreads": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wMy0wNVQwODo0OTozMlrOFh9CZg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wMy0wNVQwODo0OTozMlrOFh9CZg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzcxMTQ3MzY2OnYy", "diffSide": "RIGHT", "path": "systemvm/agent/noVNC/app/ui.js", "isResolved": false, "comments": {"totalCount": 6, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wMy0wNVQwODo0OTozMlrOIw4bLg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wMy0xMFQwNzowMTo1M1rOIzvsGA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU4ODEyNzAyMg==", "bodyText": "@davidjumani\none of our customers has issue accessing the novnc console, because scaleViewport is undefined in line 1216\nUI.rfb.scaleViewport = this.fullScreen\nBut I cannot find this change in novnc repository.\nhttps://github.com/novnc/noVNC/blob/master/app/ui.js#L1209", "url": "https://github.com/apache/cloudstack/pull/4323#discussion_r588127022", "createdAt": "2021-03-05T08:49:32Z", "author": {"login": "weizhouapache"}, "path": "systemvm/agent/noVNC/app/ui.js", "diffHunk": "@@ -1206,38 +1212,14 @@ const UI = {\n  * ------v------*/\n \n     toggleFullscreen() {\n-        if (document.fullscreenElement || // alternative standard method\n-            document.mozFullScreenElement || // currently working methods\n-            document.webkitFullscreenElement ||\n-            document.msFullscreenElement) {\n-            if (document.exitFullscreen) {\n-                document.exitFullscreen();\n-            } else if (document.mozCancelFullScreen) {\n-                document.mozCancelFullScreen();\n-            } else if (document.webkitExitFullscreen) {\n-                document.webkitExitFullscreen();\n-            } else if (document.msExitFullscreen) {\n-                document.msExitFullscreen();\n-            }\n-        } else {\n-            if (document.documentElement.requestFullscreen) {\n-                document.documentElement.requestFullscreen();\n-            } else if (document.documentElement.mozRequestFullScreen) {\n-                document.documentElement.mozRequestFullScreen();\n-            } else if (document.documentElement.webkitRequestFullscreen) {\n-                document.documentElement.webkitRequestFullscreen(Element.ALLOW_KEYBOARD_INPUT);\n-            } else if (document.body.msRequestFullscreen) {\n-                document.body.msRequestFullscreen();\n-            }\n-        }\n-        UI.updateFullscreenButton();\n+        this.fullScreen = !this.fullScreen\n+        UI.rfb.scaleViewport = this.fullScreen", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b74579e4c494474431e99e25636cf71ada8178ef"}, "originalPosition": 115}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU4ODgzOTM3Mw==", "bodyText": "@weizhouapache I've changed a bit of the novnc UI to allow fullscreen and pasting into the console.\nfullscreen is defined at line 44 and scaleViewport is defined in rfb.js", "url": "https://github.com/apache/cloudstack/pull/4323#discussion_r588839373", "createdAt": "2021-03-06T06:02:58Z", "author": {"login": "davidjumani"}, "path": "systemvm/agent/noVNC/app/ui.js", "diffHunk": "@@ -1206,38 +1212,14 @@ const UI = {\n  * ------v------*/\n \n     toggleFullscreen() {\n-        if (document.fullscreenElement || // alternative standard method\n-            document.mozFullScreenElement || // currently working methods\n-            document.webkitFullscreenElement ||\n-            document.msFullscreenElement) {\n-            if (document.exitFullscreen) {\n-                document.exitFullscreen();\n-            } else if (document.mozCancelFullScreen) {\n-                document.mozCancelFullScreen();\n-            } else if (document.webkitExitFullscreen) {\n-                document.webkitExitFullscreen();\n-            } else if (document.msExitFullscreen) {\n-                document.msExitFullscreen();\n-            }\n-        } else {\n-            if (document.documentElement.requestFullscreen) {\n-                document.documentElement.requestFullscreen();\n-            } else if (document.documentElement.mozRequestFullScreen) {\n-                document.documentElement.mozRequestFullScreen();\n-            } else if (document.documentElement.webkitRequestFullscreen) {\n-                document.documentElement.webkitRequestFullscreen(Element.ALLOW_KEYBOARD_INPUT);\n-            } else if (document.body.msRequestFullscreen) {\n-                document.body.msRequestFullscreen();\n-            }\n-        }\n-        UI.updateFullscreenButton();\n+        this.fullScreen = !this.fullScreen\n+        UI.rfb.scaleViewport = this.fullScreen", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU4ODEyNzAyMg=="}, "originalCommit": {"oid": "b74579e4c494474431e99e25636cf71ada8178ef"}, "originalPosition": 115}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU4ODkyNjcyNg==", "bodyText": "@weizhouapache I've changed a bit of the novnc UI to allow fullscreen and pasting into the console.\nfullscreen is defined at line 44 and scaleViewport is defined in rfb.js\n\n@davidjumani\nwe do not have any problem in our testing. but that customer cannot access the console. he tried with different browsers.\nit is strange. it seem UI.rfb is not initialized.", "url": "https://github.com/apache/cloudstack/pull/4323#discussion_r588926726", "createdAt": "2021-03-06T20:22:13Z", "author": {"login": "weizhouapache"}, "path": "systemvm/agent/noVNC/app/ui.js", "diffHunk": "@@ -1206,38 +1212,14 @@ const UI = {\n  * ------v------*/\n \n     toggleFullscreen() {\n-        if (document.fullscreenElement || // alternative standard method\n-            document.mozFullScreenElement || // currently working methods\n-            document.webkitFullscreenElement ||\n-            document.msFullscreenElement) {\n-            if (document.exitFullscreen) {\n-                document.exitFullscreen();\n-            } else if (document.mozCancelFullScreen) {\n-                document.mozCancelFullScreen();\n-            } else if (document.webkitExitFullscreen) {\n-                document.webkitExitFullscreen();\n-            } else if (document.msExitFullscreen) {\n-                document.msExitFullscreen();\n-            }\n-        } else {\n-            if (document.documentElement.requestFullscreen) {\n-                document.documentElement.requestFullscreen();\n-            } else if (document.documentElement.mozRequestFullScreen) {\n-                document.documentElement.mozRequestFullScreen();\n-            } else if (document.documentElement.webkitRequestFullscreen) {\n-                document.documentElement.webkitRequestFullscreen(Element.ALLOW_KEYBOARD_INPUT);\n-            } else if (document.body.msRequestFullscreen) {\n-                document.body.msRequestFullscreen();\n-            }\n-        }\n-        UI.updateFullscreenButton();\n+        this.fullScreen = !this.fullScreen\n+        UI.rfb.scaleViewport = this.fullScreen", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU4ODEyNzAyMg=="}, "originalCommit": {"oid": "b74579e4c494474431e99e25636cf71ada8178ef"}, "originalPosition": 115}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU4OTE1MTU2Mw==", "bodyText": "@weizhouapache That could be a bigger issue since rfb.js is used to communicate with the host. Did destroying and recreating the console proxy help ? Also could you check whether the customer has tweaked the novnc code in the cpvm ? Or any issue with the systemvm.iso itself ?", "url": "https://github.com/apache/cloudstack/pull/4323#discussion_r589151563", "createdAt": "2021-03-08T03:38:00Z", "author": {"login": "davidjumani"}, "path": "systemvm/agent/noVNC/app/ui.js", "diffHunk": "@@ -1206,38 +1212,14 @@ const UI = {\n  * ------v------*/\n \n     toggleFullscreen() {\n-        if (document.fullscreenElement || // alternative standard method\n-            document.mozFullScreenElement || // currently working methods\n-            document.webkitFullscreenElement ||\n-            document.msFullscreenElement) {\n-            if (document.exitFullscreen) {\n-                document.exitFullscreen();\n-            } else if (document.mozCancelFullScreen) {\n-                document.mozCancelFullScreen();\n-            } else if (document.webkitExitFullscreen) {\n-                document.webkitExitFullscreen();\n-            } else if (document.msExitFullscreen) {\n-                document.msExitFullscreen();\n-            }\n-        } else {\n-            if (document.documentElement.requestFullscreen) {\n-                document.documentElement.requestFullscreen();\n-            } else if (document.documentElement.mozRequestFullScreen) {\n-                document.documentElement.mozRequestFullScreen();\n-            } else if (document.documentElement.webkitRequestFullscreen) {\n-                document.documentElement.webkitRequestFullscreen(Element.ALLOW_KEYBOARD_INPUT);\n-            } else if (document.body.msRequestFullscreen) {\n-                document.body.msRequestFullscreen();\n-            }\n-        }\n-        UI.updateFullscreenButton();\n+        this.fullScreen = !this.fullScreen\n+        UI.rfb.scaleViewport = this.fullScreen", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU4ODEyNzAyMg=="}, "originalCommit": {"oid": "b74579e4c494474431e99e25636cf71ada8178ef"}, "originalPosition": 115}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU5MDM5ODY1Mw==", "bodyText": "@weizhouapache That could be a bigger issue since rfb.js is used to communicate with the host. Did destroying and recreating the console proxy help ? Also could you check whether the customer has tweaked the novnc code in the cpvm ? Or any issue with the systemvm.iso itself ?\n\n@davidjumani ignore the issue above. It happened when we enlarge the screen when websocket connection is not working. it is a bug but not critical. we are still looking for the root cause of the issue. customer uses German keyboard which is different from us.", "url": "https://github.com/apache/cloudstack/pull/4323#discussion_r590398653", "createdAt": "2021-03-09T14:07:31Z", "author": {"login": "weizhouapache"}, "path": "systemvm/agent/noVNC/app/ui.js", "diffHunk": "@@ -1206,38 +1212,14 @@ const UI = {\n  * ------v------*/\n \n     toggleFullscreen() {\n-        if (document.fullscreenElement || // alternative standard method\n-            document.mozFullScreenElement || // currently working methods\n-            document.webkitFullscreenElement ||\n-            document.msFullscreenElement) {\n-            if (document.exitFullscreen) {\n-                document.exitFullscreen();\n-            } else if (document.mozCancelFullScreen) {\n-                document.mozCancelFullScreen();\n-            } else if (document.webkitExitFullscreen) {\n-                document.webkitExitFullscreen();\n-            } else if (document.msExitFullscreen) {\n-                document.msExitFullscreen();\n-            }\n-        } else {\n-            if (document.documentElement.requestFullscreen) {\n-                document.documentElement.requestFullscreen();\n-            } else if (document.documentElement.mozRequestFullScreen) {\n-                document.documentElement.mozRequestFullScreen();\n-            } else if (document.documentElement.webkitRequestFullscreen) {\n-                document.documentElement.webkitRequestFullscreen(Element.ALLOW_KEYBOARD_INPUT);\n-            } else if (document.body.msRequestFullscreen) {\n-                document.body.msRequestFullscreen();\n-            }\n-        }\n-        UI.updateFullscreenButton();\n+        this.fullScreen = !this.fullScreen\n+        UI.rfb.scaleViewport = this.fullScreen", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU4ODEyNzAyMg=="}, "originalCommit": {"oid": "b74579e4c494474431e99e25636cf71ada8178ef"}, "originalPosition": 115}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU5MTEyOTYyNA==", "bodyText": "@weizhouapache Fixed in #4783\nIt prevents the fullscreen button from being shown when not connected to the VM", "url": "https://github.com/apache/cloudstack/pull/4323#discussion_r591129624", "createdAt": "2021-03-10T07:01:53Z", "author": {"login": "davidjumani"}, "path": "systemvm/agent/noVNC/app/ui.js", "diffHunk": "@@ -1206,38 +1212,14 @@ const UI = {\n  * ------v------*/\n \n     toggleFullscreen() {\n-        if (document.fullscreenElement || // alternative standard method\n-            document.mozFullScreenElement || // currently working methods\n-            document.webkitFullscreenElement ||\n-            document.msFullscreenElement) {\n-            if (document.exitFullscreen) {\n-                document.exitFullscreen();\n-            } else if (document.mozCancelFullScreen) {\n-                document.mozCancelFullScreen();\n-            } else if (document.webkitExitFullscreen) {\n-                document.webkitExitFullscreen();\n-            } else if (document.msExitFullscreen) {\n-                document.msExitFullscreen();\n-            }\n-        } else {\n-            if (document.documentElement.requestFullscreen) {\n-                document.documentElement.requestFullscreen();\n-            } else if (document.documentElement.mozRequestFullScreen) {\n-                document.documentElement.mozRequestFullScreen();\n-            } else if (document.documentElement.webkitRequestFullscreen) {\n-                document.documentElement.webkitRequestFullscreen(Element.ALLOW_KEYBOARD_INPUT);\n-            } else if (document.body.msRequestFullscreen) {\n-                document.body.msRequestFullscreen();\n-            }\n-        }\n-        UI.updateFullscreenButton();\n+        this.fullScreen = !this.fullScreen\n+        UI.rfb.scaleViewport = this.fullScreen", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU4ODEyNzAyMg=="}, "originalCommit": {"oid": "b74579e4c494474431e99e25636cf71ada8178ef"}, "originalPosition": 115}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3833, "cost": 1, "resetAt": "2021-11-12T11:18:39Z"}}}