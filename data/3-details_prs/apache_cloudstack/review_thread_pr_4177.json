{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDM5NTEzNTQw", "number": 4177, "reviewThreads": {"totalCount": 5, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yNlQxMjoxOTowNFrOEJHJtg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yOFQxMDo1Nzo0N1rOEywaPw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjc3OTg5ODE0OnYy", "diffSide": "RIGHT", "path": "server/src/main/java/com/cloud/configuration/ConfigurationManagerImpl.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yNlQxMjoxOTowNFrOGpev-g==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yNlQxMjoxOTowNFrOGpev-g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NjE0ODYwMg==", "bodyText": "CloudStack uses SLAAC for managing IPv6 ranges, therefore it is not necessary to have a start/end IPv6 address; on the other hand, IPv6 CIDR is mandatory for IPv6 networks.\nThat is why I changed this and other pieces of code that had start/end ipv6 address as mandatory.", "url": "https://github.com/apache/cloudstack/pull/4177#discussion_r446148602", "createdAt": "2020-06-26T12:19:04Z", "author": {"login": "GabrielBrascher"}, "path": "server/src/main/java/com/cloud/configuration/ConfigurationManagerImpl.java", "diffHunk": "@@ -3781,7 +3781,7 @@ public Vlan createVlanAndPublicIpRange(final long zoneId, final long networkId,\n             ipv4 = true;\n         }\n \n-        if (startIPv6 != null) {\n+        if (vlanIp6Cidr != null) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "e060158d2c25b9865a8245ab430a3c19dd986e00"}, "originalPosition": 5}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjc3OTkwNzk1OnYy", "diffSide": "RIGHT", "path": "server/src/main/java/com/cloud/network/NetworkServiceImpl.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yNlQxMjoyMjoyMlrOGpe2Gw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yNlQxMjoyMjoyMlrOGpe2Gw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NjE1MDE3MQ==", "bodyText": "Due to SLAAC implementation, an IPv6 network needs CIDR and Gateway. With the refactored code a network is \"marked\" as ipv6 if IPv6 CIDR and Gateway are not null.", "url": "https://github.com/apache/cloudstack/pull/4177#discussion_r446150171", "createdAt": "2020-06-26T12:22:22Z", "author": {"login": "GabrielBrascher"}, "path": "server/src/main/java/com/cloud/network/NetworkServiceImpl.java", "diffHunk": "@@ -1195,7 +1195,7 @@ public Network createGuestNetwork(CreateNetworkCmd cmd) throws InsufficientCapac\n         if (startIP != null) {\n             ipv4 = true;\n         }\n-        if (startIPv6 != null) {\n+        if (isNotBlank(ip6Cidr) && isNotBlank(ip6Gateway)) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "e060158d2c25b9865a8245ab430a3c19dd986e00"}, "originalPosition": 27}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjc3OTkxMTI1OnYy", "diffSide": "RIGHT", "path": "server/src/test/java/com/cloud/network/NetworkModelTest.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yNlQxMjoyMzoxOFrOGpe4FQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yNlQxMjoyMzoxOFrOGpe4FQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NjE1MDY3Nw==", "bodyText": "Nowadays IPv6 networking support only /64 CIDR. Added Unit tests covering this.", "url": "https://github.com/apache/cloudstack/pull/4177#discussion_r446150677", "createdAt": "2020-06-26T12:23:18Z", "author": {"login": "GabrielBrascher"}, "path": "server/src/test/java/com/cloud/network/NetworkModelTest.java", "diffHunk": "@@ -90,6 +91,11 @@\n     private static final long PHYSICAL_NETWORK_1_ID = 1L;\n     private static final long PHYSICAL_NETWORK_2_ID = 2L;\n \n+    private static final String IPV6_CIDR = \"fd59:16ba:559b:243d::/64\";", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "e060158d2c25b9865a8245ab430a3c19dd986e00"}, "originalPosition": 12}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzA5Njg3ODM5OnYy", "diffSide": "RIGHT", "path": "server/src/main/java/com/cloud/network/NetworkModelImpl.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yNVQwNzozMToyNlrOHX4P5Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yN1QyMToyNzoxM1rOHYqIiA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NDgwMDg2OQ==", "bodyText": "can you encapsulate this in our local proxy to the StringUtils, so migration efforts will be located in a single file?", "url": "https://github.com/apache/cloudstack/pull/4177#discussion_r494800869", "createdAt": "2020-09-25T07:31:26Z", "author": {"login": "DaanHoogland"}, "path": "server/src/main/java/com/cloud/network/NetworkModelImpl.java", "diffHunk": "@@ -2207,14 +2207,8 @@ public boolean isNetworkInlineMode(Network network) {\n \n     @Override\n     public void checkIp6Parameters(String startIPv6, String endIPv6, String ip6Gateway, String ip6Cidr) throws InvalidParameterValueException {\n-        if (!NetUtils.isValidIp6(startIPv6)) {\n-            throw new InvalidParameterValueException(\"Invalid format for the startIPv6 parameter\");\n-        }\n-        if (!NetUtils.isValidIp6(endIPv6)) {\n-            throw new InvalidParameterValueException(\"Invalid format for the endIPv6 parameter\");\n-        }\n \n-        if (!(ip6Gateway != null && ip6Cidr != null)) {\n+        if (org.apache.commons.lang3.StringUtils.isBlank(ip6Gateway) || org.apache.commons.lang3.StringUtils.isBlank(ip6Cidr)) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "1898b2fd2b2addb54e3cc3847bc597303b563c5b"}, "originalPosition": 28}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NTYxODE4NA==", "bodyText": "Fixed @DaanHoogland, code is now using the  com.cloud.utils.StringUtils.isBlank. Thanks!", "url": "https://github.com/apache/cloudstack/pull/4177#discussion_r495618184", "createdAt": "2020-09-27T21:27:13Z", "author": {"login": "GabrielBrascher"}, "path": "server/src/main/java/com/cloud/network/NetworkModelImpl.java", "diffHunk": "@@ -2207,14 +2207,8 @@ public boolean isNetworkInlineMode(Network network) {\n \n     @Override\n     public void checkIp6Parameters(String startIPv6, String endIPv6, String ip6Gateway, String ip6Cidr) throws InvalidParameterValueException {\n-        if (!NetUtils.isValidIp6(startIPv6)) {\n-            throw new InvalidParameterValueException(\"Invalid format for the startIPv6 parameter\");\n-        }\n-        if (!NetUtils.isValidIp6(endIPv6)) {\n-            throw new InvalidParameterValueException(\"Invalid format for the endIPv6 parameter\");\n-        }\n \n-        if (!(ip6Gateway != null && ip6Cidr != null)) {\n+        if (org.apache.commons.lang3.StringUtils.isBlank(ip6Gateway) || org.apache.commons.lang3.StringUtils.isBlank(ip6Cidr)) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NDgwMDg2OQ=="}, "originalCommit": {"oid": "1898b2fd2b2addb54e3cc3847bc597303b563c5b"}, "originalPosition": 28}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzIxNjU3NDA3OnYy", "diffSide": "RIGHT", "path": "server/src/main/java/com/cloud/network/NetworkModelImpl.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yOFQxMDo1Nzo0N1rOHpkhLA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yOFQxNTowOTo0MFrOHpu_MA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMzM1MTk4MA==", "bodyText": "@GabrielBrascher may be this exception msg has to be updated, as it is not sure here that startIPv6/endIPv6 are passed or not, as the checks for startIPv6/endIPv6 are moved after this.", "url": "https://github.com/apache/cloudstack/pull/4177#discussion_r513351980", "createdAt": "2020-10-28T10:57:47Z", "author": {"login": "sureshanaparti"}, "path": "server/src/main/java/com/cloud/network/NetworkModelImpl.java", "diffHunk": "@@ -2207,14 +2207,8 @@ public boolean isNetworkInlineMode(Network network) {\n \n     @Override\n     public void checkIp6Parameters(String startIPv6, String endIPv6, String ip6Gateway, String ip6Cidr) throws InvalidParameterValueException {\n-        if (!NetUtils.isValidIp6(startIPv6)) {\n-            throw new InvalidParameterValueException(\"Invalid format for the startIPv6 parameter\");\n-        }\n-        if (!NetUtils.isValidIp6(endIPv6)) {\n-            throw new InvalidParameterValueException(\"Invalid format for the endIPv6 parameter\");\n-        }\n \n-        if (!(ip6Gateway != null && ip6Cidr != null)) {\n+        if (StringUtils.isBlank(ip6Gateway) || StringUtils.isBlank(ip6Cidr)) {\n             throw new InvalidParameterValueException(\"ip6Gateway and ip6Cidr should be defined when startIPv6/endIPv6 are passed in\");", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c90e1e23824eaeb2e1cf5326d717763212d2440d"}, "originalPosition": 29}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMzUyMzUwNA==", "bodyText": "Just pushed a commit addressing your comment. Thanks Suresh.", "url": "https://github.com/apache/cloudstack/pull/4177#discussion_r513523504", "createdAt": "2020-10-28T15:09:40Z", "author": {"login": "GabrielBrascher"}, "path": "server/src/main/java/com/cloud/network/NetworkModelImpl.java", "diffHunk": "@@ -2207,14 +2207,8 @@ public boolean isNetworkInlineMode(Network network) {\n \n     @Override\n     public void checkIp6Parameters(String startIPv6, String endIPv6, String ip6Gateway, String ip6Cidr) throws InvalidParameterValueException {\n-        if (!NetUtils.isValidIp6(startIPv6)) {\n-            throw new InvalidParameterValueException(\"Invalid format for the startIPv6 parameter\");\n-        }\n-        if (!NetUtils.isValidIp6(endIPv6)) {\n-            throw new InvalidParameterValueException(\"Invalid format for the endIPv6 parameter\");\n-        }\n \n-        if (!(ip6Gateway != null && ip6Cidr != null)) {\n+        if (StringUtils.isBlank(ip6Gateway) || StringUtils.isBlank(ip6Cidr)) {\n             throw new InvalidParameterValueException(\"ip6Gateway and ip6Cidr should be defined when startIPv6/endIPv6 are passed in\");", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMzM1MTk4MA=="}, "originalCommit": {"oid": "c90e1e23824eaeb2e1cf5326d717763212d2440d"}, "originalPosition": 29}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3726, "cost": 1, "resetAt": "2021-11-12T11:18:39Z"}}}