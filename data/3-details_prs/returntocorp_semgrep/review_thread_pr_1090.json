{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDM3NDQ4NjA4", "number": 1090, "reviewThreads": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yM1QyMTo1NTo1MVrOEIJf1Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yM1QyMTo1OTozNlrOEIJjWQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjc2OTc5NjY5OnYy", "diffSide": "RIGHT", "path": "semgrep/semgrep/core_runner.py", "isResolved": false, "comments": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yM1QyMTo1NTo1MVrOGn8CUg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yOVQxODozMDoyOFrOGqdGlQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NDUzMTI4Mg==", "bodyText": "IMO shouldnt be the job of CoreRunner to know about output handling. It should run semgrep-core and return the findings, and errors and let the caller handle how that is output.", "url": "https://github.com/returntocorp/semgrep/pull/1090#discussion_r444531282", "createdAt": "2020-06-23T21:55:51Z", "author": {"login": "brendongo"}, "path": "semgrep/semgrep/core_runner.py", "diffHunk": "@@ -117,9 +122,10 @@ class CoreRunner:\n         This includes properly invoking semgrep-core and parsing the output\n     \"\"\"\n \n-    def __init__(self, allow_exec: bool, jobs: int):\n+    def __init__(self, allow_exec: bool, jobs: int, output_handler: OutputHandler):\n         self._allow_exec = allow_exec\n         self._jobs = jobs\n+        self._output_handler = output_handler", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "6235fed0f298cb5a58512e5b5d803e3977cf954c"}, "originalPosition": 26}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NDU0MDU4Mg==", "bodyText": "the intention is that in a followup diff, this will pave the way to have corerunner emit results as it gets them. I could also imagine some sort of generator interface, but I don't think that giving corerunner a place to report its results is a bad thing", "url": "https://github.com/returntocorp/semgrep/pull/1090#discussion_r444540582", "createdAt": "2020-06-23T22:20:23Z", "author": {"login": "rcoh"}, "path": "semgrep/semgrep/core_runner.py", "diffHunk": "@@ -117,9 +122,10 @@ class CoreRunner:\n         This includes properly invoking semgrep-core and parsing the output\n     \"\"\"\n \n-    def __init__(self, allow_exec: bool, jobs: int):\n+    def __init__(self, allow_exec: bool, jobs: int, output_handler: OutputHandler):\n         self._allow_exec = allow_exec\n         self._jobs = jobs\n+        self._output_handler = output_handler", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NDUzMTI4Mg=="}, "originalCommit": {"oid": "6235fed0f298cb5a58512e5b5d803e3977cf954c"}, "originalPosition": 26}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NDU2MjA4MA==", "bodyText": "I think it will be much cleaner to later modify CoreRunner to expose some streaming interface than have the CoreRunner class need to know about how its results and errors are being used. Much simpler for it to be a layer that interacts with semgrep-core and returns the results of that interaction.", "url": "https://github.com/returntocorp/semgrep/pull/1090#discussion_r444562080", "createdAt": "2020-06-23T23:26:19Z", "author": {"login": "brendongo"}, "path": "semgrep/semgrep/core_runner.py", "diffHunk": "@@ -117,9 +122,10 @@ class CoreRunner:\n         This includes properly invoking semgrep-core and parsing the output\n     \"\"\"\n \n-    def __init__(self, allow_exec: bool, jobs: int):\n+    def __init__(self, allow_exec: bool, jobs: int, output_handler: OutputHandler):\n         self._allow_exec = allow_exec\n         self._jobs = jobs\n+        self._output_handler = output_handler", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NDUzMTI4Mg=="}, "originalCommit": {"oid": "6235fed0f298cb5a58512e5b5d803e3977cf954c"}, "originalPosition": 26}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NzE3MDE5Nw==", "bodyText": "I'm not totally sure that's true since there are errors and successes that may both be coming back at different rates, but I've gone that direction for now", "url": "https://github.com/returntocorp/semgrep/pull/1090#discussion_r447170197", "createdAt": "2020-06-29T18:30:28Z", "author": {"login": "rcoh"}, "path": "semgrep/semgrep/core_runner.py", "diffHunk": "@@ -117,9 +122,10 @@ class CoreRunner:\n         This includes properly invoking semgrep-core and parsing the output\n     \"\"\"\n \n-    def __init__(self, allow_exec: bool, jobs: int):\n+    def __init__(self, allow_exec: bool, jobs: int, output_handler: OutputHandler):\n         self._allow_exec = allow_exec\n         self._jobs = jobs\n+        self._output_handler = output_handler", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NDUzMTI4Mg=="}, "originalCommit": {"oid": "6235fed0f298cb5a58512e5b5d803e3977cf954c"}, "originalPosition": 26}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjc2OTgwNTY5OnYy", "diffSide": "LEFT", "path": "semgrep/tests/e2e/test_semgrep_core_parse_error.py", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yM1QyMTo1OTozNlrOGn8IFQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yM1QyMjoxOTowM1rOGn8kug==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NDUzMjc1Nw==", "bodyText": "Why was this test removed?", "url": "https://github.com/returntocorp/semgrep/pull/1090#discussion_r444532757", "createdAt": "2020-06-23T21:59:36Z", "author": {"login": "brendongo"}, "path": "semgrep/tests/e2e/test_semgrep_core_parse_error.py", "diffHunk": "@@ -15,23 +15,3 @@ def test_rule_parser__failure__error_messages(run_semgrep_in_tmp, snapshot, file\n             stderr=True,\n         )\n     snapshot.assert_match(excinfo.value.output, \"error.txt\")\n-\n-\n-@pytest.mark.parametrize(\n-    \"filename\", [\"invalid_python.py\",],\n-)\n-def test_rule_parser__failure__error_messages_verbose(", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "6235fed0f298cb5a58512e5b5d803e3977cf954c"}, "originalPosition": 9}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NDU0MDA5MA==", "bodyText": "per a discussion with @DrewDennison , parse errors will show up even when not in verbose mode (so now there's no reason to test that they show up in verbose mode)", "url": "https://github.com/returntocorp/semgrep/pull/1090#discussion_r444540090", "createdAt": "2020-06-23T22:19:03Z", "author": {"login": "rcoh"}, "path": "semgrep/tests/e2e/test_semgrep_core_parse_error.py", "diffHunk": "@@ -15,23 +15,3 @@ def test_rule_parser__failure__error_messages(run_semgrep_in_tmp, snapshot, file\n             stderr=True,\n         )\n     snapshot.assert_match(excinfo.value.output, \"error.txt\")\n-\n-\n-@pytest.mark.parametrize(\n-    \"filename\", [\"invalid_python.py\",],\n-)\n-def test_rule_parser__failure__error_messages_verbose(", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NDUzMjc1Nw=="}, "originalCommit": {"oid": "6235fed0f298cb5a58512e5b5d803e3977cf954c"}, "originalPosition": 9}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4990, "cost": 1, "resetAt": "2021-11-12T12:57:47Z"}}}