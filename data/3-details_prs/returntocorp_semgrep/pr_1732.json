{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDkzNjE3Nzgy", "number": 1732, "title": "Clean up parser warning UX", "bodyText": "Added a --debug flag and moved most of the output under --verbose to it.\n\n\n Parse and other errors are mentioned at final output, but not individually displayed unless --verbose is passed\n\n\n Explicitly mark semgrep errors as being \"semgrep internal\" (Closes #384)\n\n\nsemgrep warn: parse error\n  --> invalid_python.py:1\n1 | def foo(a)\n  |           ^^^^^\n= help: If the code appears to be valid, this may be a semgrep bug.\nCould not parse invalid_python.py as python\n\n\n Closes #1550\n\nran 79 rules on 77 files: 14 findings\n1 files could not be analyzed; run with --verbose for details or run with --strict to exit non-zero if any file cannot be analyzed\n\n\n Closes #1562 (currently only under --verbose)\n\nfindings summary: 7 warning, 7 error, 0 info\n\n\n Closes #1551\n\nsemgrep warn: parse error\n  --> tests/e2e/targets/bad/invalid_python.py:1\n1 | def foo(a)\n  |           ^^^^^\n= help: If the code appears to be valid, this may be a semgrep bug.\nCould not parse invalid_python.py as python\n\n\n We display Level.ERROR semgrepErrors by default still; it's just parse, OOM, timeout errors, etc. (anything with .WARN) that now are not individually listed without --verbose\n\nOutstanding issues: assumes that # files could not be analyzed == # of errors returned from semgrep core. Probably not a show-stopper.", "createdAt": "2020-09-26T19:22:54Z", "url": "https://github.com/returntocorp/semgrep/pull/1732", "merged": true, "mergeCommit": {"oid": "b99327cf99135dc244724b59f6cd25bb9fd9a7cf"}, "closed": true, "closedAt": "2020-10-06T16:46:08Z", "author": {"login": "ievans"}, "timelineItems": {"totalCount": 21, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdMvcccAH2gAyNDkzNjE3NzgyOjI2NmFlMDI2MGI1Njg4MWQyMzE3ZWU5MDY5MzlmZmYyMDZlMmQ3YTg=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdP7L08gFqTUwMzE2MjAwOA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "266ae0260b56881d2317ee906939fff206e2d7a8", "author": {"user": {"login": "ievans", "name": "Isaac Evans"}}, "url": "https://github.com/returntocorp/semgrep/commit/266ae0260b56881d2317ee906939fff206e2d7a8", "committedDate": "2020-09-26T19:20:56Z", "message": "display a stats line in normal textual output"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f589a171fb6d7c7bdc6316330c97b5ad160b338b", "author": {"user": {"login": "ievans", "name": "Isaac Evans"}}, "url": "https://github.com/returntocorp/semgrep/commit/f589a171fb6d7c7bdc6316330c97b5ad160b338b", "committedDate": "2020-09-26T19:51:37Z", "message": "debug now actually means logging debug; verbose is for displaying errors"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "6b4c5e5122cadbaee8fa11ab4a33e960f125dc84", "author": {"user": {"login": "ievans", "name": "Isaac Evans"}}, "url": "https://github.com/returntocorp/semgrep/commit/6b4c5e5122cadbaee8fa11ab4a33e960f125dc84", "committedDate": "2020-09-26T20:00:51Z", "message": "per rule # of files ran on in --debug mode"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ad27e1adc63525de995b61fc55b86783e7b6e768", "author": {"user": {"login": "ievans", "name": "Isaac Evans"}}, "url": "https://github.com/returntocorp/semgrep/commit/ad27e1adc63525de995b61fc55b86783e7b6e768", "committedDate": "2020-09-26T20:05:31Z", "message": "add changelog"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "6a2178b336038206e026230a5c4886013b34f444", "author": {"user": {"login": "ievans", "name": "Isaac Evans"}}, "url": "https://github.com/returntocorp/semgrep/commit/6a2178b336038206e026230a5c4886013b34f444", "committedDate": "2020-09-26T20:07:15Z", "message": "revert ocaml tree sitter lang"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "bc52e2a220099bf25e2dc7f81ca8e46e15186405", "author": {"user": {"login": "ievans", "name": "Isaac Evans"}}, "url": "https://github.com/returntocorp/semgrep/commit/bc52e2a220099bf25e2dc7f81ca8e46e15186405", "committedDate": "2020-09-26T20:40:36Z", "message": "Fixes for #1562 and #1551"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a5dc0c88a5aa81004b02fb79562caad65f000911", "author": {"user": {"login": "ievans", "name": "Isaac Evans"}}, "url": "https://github.com/returntocorp/semgrep/commit/a5dc0c88a5aa81004b02fb79562caad65f000911", "committedDate": "2020-09-26T20:53:35Z", "message": "hide only WARN level SemgrepError(s) by default"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "6982ec1f1746917c7f73a8fa0f7b79ce75678f8d", "author": {"user": {"login": "ievans", "name": "Isaac Evans"}}, "url": "https://github.com/returntocorp/semgrep/commit/6982ec1f1746917c7f73a8fa0f7b79ce75678f8d", "committedDate": "2020-09-26T21:24:04Z", "message": "add missing kwargs"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "02a335b9a298a76690dd74b09c58e701463a420a", "author": {"user": {"login": "ievans", "name": "Isaac Evans"}}, "url": "https://github.com/returntocorp/semgrep/commit/02a335b9a298a76690dd74b09c58e701463a420a", "committedDate": "2020-09-26T21:36:25Z", "message": "commit expected text changes"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "454daaf0cfaa0e0c6cf294db27d6f109d00d324e", "author": {"user": {"login": "ievans", "name": "Isaac Evans"}}, "url": "https://github.com/returntocorp/semgrep/commit/454daaf0cfaa0e0c6cf294db27d6f109d00d324e", "committedDate": "2020-09-26T22:37:23Z", "message": "fix expected tests"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDk5NzE5NzI1", "url": "https://github.com/returntocorp/semgrep/pull/1732#pullrequestreview-499719725", "createdAt": "2020-09-30T18:51:45Z", "commit": {"oid": "454daaf0cfaa0e0c6cf294db27d6f109d00d324e"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0zMFQxODo1MTo0NlrOHaq-yQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0zMFQxODo1NzoxMlrOHarKlA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NzcyOTIyNQ==", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                    # logger.debug(all_targets)", "url": "https://github.com/returntocorp/semgrep/pull/1732#discussion_r497729225", "createdAt": "2020-09-30T18:51:46Z", "author": {"login": "brendongo"}, "path": "semgrep/semgrep/core_runner.py", "diffHunk": "@@ -498,6 +501,7 @@ def _run_rules(\n                             max_timeout_files.append(err.path)\n \n         all_errors = dedup_errors(all_errors)\n+        # logger.debug(all_targets)", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "454daaf0cfaa0e0c6cf294db27d6f109d00d324e"}, "originalPosition": 32}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NzczMjI0NA==", "bodyText": "Some users expect no output to be printed when no matches are found. IMO a stats line should be under --verbose and output should only ever be findings.", "url": "https://github.com/returntocorp/semgrep/pull/1732#discussion_r497732244", "createdAt": "2020-09-30T18:57:12Z", "author": {"login": "brendongo"}, "path": "semgrep/semgrep/output.py", "diffHunk": "@@ -399,7 +409,10 @@ def build_output(self, color_output: bool) -> str:\n         elif output_format == OutputFormat.SARIF:\n             return build_sarif_output(self.rule_matches, self.rules)\n         elif output_format == OutputFormat.TEXT:\n-            return \"\\n\".join(build_normal_output(self.rule_matches, color_output))\n+            return \"\\n\".join(\n+                list(build_normal_output(self.rule_matches, color_output))\n+                + ([self.stats_line] if self.stats_line else [])", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "454daaf0cfaa0e0c6cf294db27d6f109d00d324e"}, "originalPosition": 93}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "20ba06f3190906d29666c4038a57a29b0fba6ae3", "author": {"user": {"login": "ievans", "name": "Isaac Evans"}}, "url": "https://github.com/returntocorp/semgrep/commit/20ba06f3190906d29666c4038a57a29b0fba6ae3", "committedDate": "2020-10-01T23:54:51Z", "message": "Update semgrep/semgrep/core_runner.py\n\nCo-authored-by: Brendon Go <brendon.go@gmail.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "4c6a8646ec70b11db12546f440b1f664329de3df", "author": {"user": {"login": "ievans", "name": "Isaac Evans"}}, "url": "https://github.com/returntocorp/semgrep/commit/4c6a8646ec70b11db12546f440b1f664329de3df", "committedDate": "2020-10-02T00:01:13Z", "message": "Merge branch 'develop' into ie/output-stats"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTAwOTA2NDc5", "url": "https://github.com/returntocorp/semgrep/pull/1732#pullrequestreview-500906479", "createdAt": "2020-10-02T07:18:23Z", "commit": {"oid": "4c6a8646ec70b11db12546f440b1f664329de3df"}, "state": "COMMENTED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "dfae656daf741307613054e07fdb85c8540938a6", "author": {"user": {"login": "ievans", "name": "Isaac Evans"}}, "url": "https://github.com/returntocorp/semgrep/commit/dfae656daf741307613054e07fdb85c8540938a6", "committedDate": "2020-10-05T20:37:39Z", "message": "address PR feedback"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "3cb743e442f8953577daeac1663f8ec3eadbe41d", "author": {"user": {"login": "ievans", "name": "Isaac Evans"}}, "url": "https://github.com/returntocorp/semgrep/commit/3cb743e442f8953577daeac1663f8ec3eadbe41d", "committedDate": "2020-10-05T22:07:01Z", "message": "update tests"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTAyNDc2MzIw", "url": "https://github.com/returntocorp/semgrep/pull/1732#pullrequestreview-502476320", "createdAt": "2020-10-05T22:57:14Z", "commit": {"oid": "3cb743e442f8953577daeac1663f8ec3eadbe41d"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wNVQyMjo1NzoxNFrOHcwcww==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wNVQyMjo1NzoxNFrOHcwcww==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5OTkxNTk3MQ==", "bodyText": "Still not sure why we are passing stats line to output and gating tty instead of outputting to stderr like all other non finding output.", "url": "https://github.com/returntocorp/semgrep/pull/1732#discussion_r499915971", "createdAt": "2020-10-05T22:57:14Z", "author": {"login": "brendongo"}, "path": "semgrep/semgrep/output.py", "diffHunk": "@@ -399,7 +409,13 @@ def build_output(self, color_output: bool) -> str:\n         elif output_format == OutputFormat.SARIF:\n             return build_sarif_output(self.rule_matches, self.rules)\n         elif output_format == OutputFormat.TEXT:\n-            return \"\\n\".join(build_normal_output(self.rule_matches, color_output))\n+            stats_line = []\n+            if sys.stderr.isatty():", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "3cb743e442f8953577daeac1663f8ec3eadbe41d"}, "originalPosition": 92}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "820e229278c6f40f6378cb35fedfd42e83868209", "author": {"user": {"login": "ievans", "name": "Isaac Evans"}}, "url": "https://github.com/returntocorp/semgrep/commit/820e229278c6f40f6378cb35fedfd42e83868209", "committedDate": "2020-10-05T23:30:03Z", "message": "Revert \"update tests\"\n\nThis reverts commit 3cb743e442f8953577daeac1663f8ec3eadbe41d."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b76cda41c41fa71bdcd0344e68d6bd66daee4c39", "author": {"user": {"login": "ievans", "name": "Isaac Evans"}}, "url": "https://github.com/returntocorp/semgrep/commit/b76cda41c41fa71bdcd0344e68d6bd66daee4c39", "committedDate": "2020-10-05T23:31:52Z", "message": "ty bgo"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "734bf601c3d4468b8e4f468279f3c88f2bba8d5d", "author": {"user": {"login": "ievans", "name": "Isaac Evans"}}, "url": "https://github.com/returntocorp/semgrep/commit/734bf601c3d4468b8e4f468279f3c88f2bba8d5d", "committedDate": "2020-10-06T15:06:26Z", "message": "update tests"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTAzMTYyMDA4", "url": "https://github.com/returntocorp/semgrep/pull/1732#pullrequestreview-503162008", "createdAt": "2020-10-06T16:43:25Z", "commit": {"oid": "734bf601c3d4468b8e4f468279f3c88f2bba8d5d"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1266, "cost": 1, "resetAt": "2021-11-01T16:37:27Z"}}}