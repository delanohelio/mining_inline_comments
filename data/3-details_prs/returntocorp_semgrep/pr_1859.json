{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTA2MzQ0NzMw", "number": 1859, "title": "Use metavariable ranges", "bodyText": "Before this commit semgrep was using the abstract_context associated\nwith each metavariable assuming it was what the metavariable matched with\nthis is not always the case since the abstract context removes some concrete\nsyntax.\nThis PR relies on the more stable line ranges reported with the metavariable\nas the value of the metavariable.", "createdAt": "2020-10-19T23:37:50Z", "url": "https://github.com/returntocorp/semgrep/pull/1859", "merged": true, "mergeCommit": {"oid": "12d25a5c3c56937b4914b8c04fcea71699008a0e"}, "closed": true, "closedAt": "2020-10-21T08:17:24Z", "author": {"login": "brendongo"}, "timelineItems": {"totalCount": 8, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdUM4G8AH2gAyNTA2MzQ0NzMwOjEzZTgzYWRjZWQzNDhjZTYzYjg2ZDJiMjJkZDZhZDc3MTUxY2VkN2Q=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdUo5J0gFqTUxMzQxNjU1Mw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "13e83adced348ce63b86d2b22dd6ad77151ced7d", "author": {"user": {"login": "brendongo", "name": "Brendon Go"}}, "url": "https://github.com/returntocorp/semgrep/commit/13e83adced348ce63b86d2b22dd6ad77151ced7d", "committedDate": "2020-10-19T23:35:52Z", "message": "Use metavariable ranges\n\nBefore this commit semgrep was using the abstract_context associated\nwith each metavariable assuming it was what the metavariable matched with\nthis is not always the case since the abstract context removes some concrete\nsyntax.\n\nThis PR relies on the more stable line ranges reported with the metavariable\nas the value of the metavariable."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "2716631f7965a7dd459abf585de446fd11e8d92d", "author": {"user": {"login": "brendongo", "name": "Brendon Go"}}, "url": "https://github.com/returntocorp/semgrep/commit/2716631f7965a7dd459abf585de446fd11e8d92d", "committedDate": "2020-10-19T23:47:31Z", "message": "fixup! Use metavariable ranges"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "3c2acd192e9a476a9128a327320d99f8eaed3730", "author": {"user": {"login": "brendongo", "name": "Brendon Go"}}, "url": "https://github.com/returntocorp/semgrep/commit/3c2acd192e9a476a9128a327320d99f8eaed3730", "committedDate": "2020-10-20T00:51:55Z", "message": "Update tests"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ad494de50145e59fc8cdb15ade93e04e6473f280", "author": {"user": {"login": "brendongo", "name": "Brendon Go"}}, "url": "https://github.com/returntocorp/semgrep/commit/ad494de50145e59fc8cdb15ade93e04e6473f280", "committedDate": "2020-10-20T23:32:14Z", "message": "fixup! Update tests"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "24cf9fe0131347e621c53d4f63e2f403e620e7e6", "author": {"user": {"login": "brendongo", "name": "Brendon Go"}}, "url": "https://github.com/returntocorp/semgrep/commit/24cf9fe0131347e621c53d4f63e2f403e620e7e6", "committedDate": "2020-10-21T00:11:32Z", "message": "fixup! fixup! Update tests"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTEzMzg3Mzgy", "url": "https://github.com/returntocorp/semgrep/pull/1859#pullrequestreview-513387382", "createdAt": "2020-10-21T07:38:33Z", "commit": {"oid": "24cf9fe0131347e621c53d4f63e2f403e620e7e6"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yMVQwNzozODozM1rOHleQPg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yMVQwNzozODozM1rOHleQPg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwOTA1NTAzOA==", "bodyText": "If start or end are missing as keys, we'll fail anyway, so I'll update this to [\"end\"][\"offset\"] to make the error message more clear.", "url": "https://github.com/returntocorp/semgrep/pull/1859#discussion_r509055038", "createdAt": "2020-10-21T07:38:33Z", "author": {"login": "underyx"}, "path": "semgrep/semgrep/pattern_match.py", "diffHunk": "@@ -63,5 +63,23 @@ def end(self) -> Dict[str, Any]:\n             del end[\"offset\"]\n         return end\n \n+    def get_metavariable_value(self, metavariable: str) -> str:\n+        \"\"\"\n+            Use metavars start and end to read into the file to find what the\n+            metavariable in this pattern match maps to in the file\n+\n+            Assumes METAVARIABLE is a key in self.metavars\n+        \"\"\"\n+        # Offsets are start inclusive and end exclusive\n+        start_offset = self.metavars[metavariable].get(\"start\").get(\"offset\")\n+        end_offset = self.metavars[metavariable].get(\"end\").get(\"offset\")", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "24cf9fe0131347e621c53d4f63e2f403e620e7e6"}, "originalPosition": 13}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b97055950e78a163f1fac2156b5651a652684a39", "author": {"user": {"login": "underyx", "name": "Bence Nagy"}}, "url": "https://github.com/returntocorp/semgrep/commit/b97055950e78a163f1fac2156b5651a652684a39", "committedDate": "2020-10-21T07:53:41Z", "message": "get_metavariable_value: Fail faster on wrong data"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTEzNDE2NTUz", "url": "https://github.com/returntocorp/semgrep/pull/1859#pullrequestreview-513416553", "createdAt": "2020-10-21T08:14:21Z", "commit": {"oid": "b97055950e78a163f1fac2156b5651a652684a39"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1202, "cost": 1, "resetAt": "2021-11-01T16:37:27Z"}}}