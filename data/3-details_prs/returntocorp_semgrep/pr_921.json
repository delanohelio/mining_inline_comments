{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDI4MTUxNDk4", "number": 921, "title": "semgrep-core: don't filter out explicitly passed targets", "bodyText": "Files listed as targets for analysis are analyzed even if they do not\nhave an expected extension", "createdAt": "2020-06-05T00:09:08Z", "url": "https://github.com/returntocorp/semgrep/pull/921", "merged": true, "mergeCommit": {"oid": "3b344b24fe1f93102e458b48b457923fe69bde5d"}, "closed": true, "closedAt": "2020-06-09T18:49:38Z", "author": {"login": "brendongo"}, "timelineItems": {"totalCount": 7, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcoHP4UAFqTQyNDkxNzA1Ng==", "endCursor": "Y3Vyc29yOnYyOpPPAAABcppqNFgFqTQyNzQ0NjcyNQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDI0OTE3MDU2", "url": "https://github.com/returntocorp/semgrep/pull/921#pullrequestreview-424917056", "createdAt": "2020-06-05T00:09:44Z", "commit": {"oid": "77a89aa07d49cad2beb84c82d869eaf1544bc415"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wNVQwMDowOTo0NFrOGfcV0g==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wNVQwMDowOTo0NFrOGfcV0g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNTYyMzM3OA==", "bodyText": "Remove since this requires files have expected extension", "url": "https://github.com/returntocorp/semgrep/pull/921#discussion_r435623378", "createdAt": "2020-06-05T00:09:44Z", "author": {"login": "brendongo"}, "path": "semgrep-core/bin/Main.ml", "diffHunk": "@@ -415,18 +421,10 @@ let iter_generic_ast_of_files_and_get_matches_and_exn_to_errors f files =\n        if !verbose then pr2 (spf \"Analyzing %s\" file);\n        try\n          let lang =\n-           match Lang.langs_of_filename file with", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "77a89aa07d49cad2beb84c82d869eaf1544bc415"}, "originalPosition": 19}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDI0OTI0OTk3", "url": "https://github.com/returntocorp/semgrep/pull/921#pullrequestreview-424924997", "createdAt": "2020-06-05T00:36:42Z", "commit": {"oid": "77a89aa07d49cad2beb84c82d869eaf1544bc415"}, "state": "COMMENTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wNVQwMDozNjo0M1rOGfcvUw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wNVQwMDozOToyOFrOGfcx4w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNTYyOTkwNw==", "bodyText": "How does this avoid double-passing files in each side?", "url": "https://github.com/returntocorp/semgrep/pull/921#discussion_r435629907", "createdAt": "2020-06-05T00:36:43Z", "author": {"login": "nbrahms"}, "path": "semgrep-core/bin/Main.ml", "diffHunk": "@@ -405,7 +405,13 @@ let get_final_files xs =\n     | Some lang -> Lang.files_of_dirs_or_files lang xs\n   in\n   let files = filter_files files in\n-  files\n+\n+  let explicit_files = xs |> List.filter(fun file ->\n+      Sys.file_exists file && not (Sys.is_directory file)\n+    )\n+  in\n+\n+  files @ explicit_files", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "77a89aa07d49cad2beb84c82d869eaf1544bc415"}, "originalPosition": 11}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNTYzMDU2Mw==", "bodyText": "I think you want to move the langs_of_filename check in here, and keep the automated detection. So if someone omits -lang and passes in foo.py we parse as python, but if someone passes foo.blargh we error.", "url": "https://github.com/returntocorp/semgrep/pull/921#discussion_r435630563", "createdAt": "2020-06-05T00:39:28Z", "author": {"login": "nbrahms"}, "path": "semgrep-core/bin/Main.ml", "diffHunk": "@@ -415,18 +421,10 @@ let iter_generic_ast_of_files_and_get_matches_and_exn_to_errors f files =\n        if !verbose then pr2 (spf \"Analyzing %s\" file);\n        try\n          let lang =\n-           match Lang.langs_of_filename file with\n-           | [lang] -> lang\n-           | x::_xs ->\n-               (match Lang.lang_of_string_opt !lang with\n-               | Some lang -> lang\n-               | None ->\n-                 pr2 (spf \"no language specified, defaulting to %s for %s\"\n-                      (Lang.string_of_lang x) file);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "77a89aa07d49cad2beb84c82d869eaf1544bc415"}, "originalPosition": 26}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "12a25125a1cf94c84a673fc824c830c3907250b9", "author": {"user": {"login": "brendongo", "name": "Brendon Go"}}, "url": "https://github.com/returntocorp/semgrep/commit/12a25125a1cf94c84a673fc824c830c3907250b9", "committedDate": "2020-06-05T01:07:02Z", "message": "semgrep-core: don't filter out explicitly passed targets\n\nFiles listed as targets for analysis are analyzed even if they do not\nhave an expected extension"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "872fe3ba3b63c10ff46f9c9551829ceed3fdd83a", "author": {"user": {"login": "brendongo", "name": "Brendon Go"}}, "url": "https://github.com/returntocorp/semgrep/commit/872fe3ba3b63c10ff46f9c9551829ceed3fdd83a", "committedDate": "2020-06-05T01:07:02Z", "message": "fixup! semgrep-core: don't filter out explicitly passed targets"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "77a89aa07d49cad2beb84c82d869eaf1544bc415", "author": {"user": {"login": "brendongo", "name": "Brendon Go"}}, "url": "https://github.com/returntocorp/semgrep/commit/77a89aa07d49cad2beb84c82d869eaf1544bc415", "committedDate": "2020-06-05T00:07:53Z", "message": "semgrep-core: don't filter out explicitly passed targets\n\nFiles listed as targets for analysis are analyzed even if they do not\nhave an expected extension"}, "afterCommit": {"oid": "872fe3ba3b63c10ff46f9c9551829ceed3fdd83a", "author": {"user": {"login": "brendongo", "name": "Brendon Go"}}, "url": "https://github.com/returntocorp/semgrep/commit/872fe3ba3b63c10ff46f9c9551829ceed3fdd83a", "committedDate": "2020-06-05T01:07:02Z", "message": "fixup! semgrep-core: don't filter out explicitly passed targets"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "52f2f60dcfd64611916acd2753ff321d0019b8d0", "author": {"user": {"login": "brendongo", "name": "Brendon Go"}}, "url": "https://github.com/returntocorp/semgrep/commit/52f2f60dcfd64611916acd2753ff321d0019b8d0", "committedDate": "2020-06-05T17:05:17Z", "message": "fixup! semgrep-core: don't filter out explicitly passed targets"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDI3NDQ2NzI1", "url": "https://github.com/returntocorp/semgrep/pull/921#pullrequestreview-427446725", "createdAt": "2020-06-09T18:49:11Z", "commit": {"oid": "52f2f60dcfd64611916acd2753ff321d0019b8d0"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1493, "cost": 1, "resetAt": "2021-11-01T16:37:27Z"}}}