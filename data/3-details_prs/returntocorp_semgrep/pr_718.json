{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDE1MDE2MTQ4", "number": 718, "title": "Switch environment to use Pipenv", "bodyText": "Switch from requirements.txt to pipenv. This DRY's the dependencies -- the runtime deps are in setup.py. The dev deps are in the Pipfile.\nBake the latest git tag into the version string and use it from the CLI. This removes the need to ever manually bump a version for Python. To support Nuitka, a semgrep/version.py file is created as the wheel is built. Homebrew versioning support comes from the gitarchive.\n\nI verified that this produces the correct metadata for homebrew by pointing homebrew head at this branch and doing a homebrew install --HEAD", "createdAt": "2020-05-08T02:48:56Z", "url": "https://github.com/returntocorp/semgrep/pull/718", "merged": true, "mergeCommit": {"oid": "595847ec365e73b086d4f3c650183ec5da3e1274"}, "closed": true, "closedAt": "2020-05-14T18:46:08Z", "author": {"login": "rcoh"}, "timelineItems": {"totalCount": 23, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcfUCDsgFqTQwODM0MDcxNw==", "endCursor": "Y3Vyc29yOnYyOpPPAAABchRxFdgFqTQxMjA3NTk4NQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDA4MzQwNzE3", "url": "https://github.com/returntocorp/semgrep/pull/718#pullrequestreview-408340717", "createdAt": "2020-05-08T15:58:04Z", "commit": {"oid": "8f97ce08feea09bdd701234d2221e1669e3a4c25"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wOFQxNTo1ODowNVrOGSqkGg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wOFQxNTo1ODowNVrOGSqkGg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMjIyNDkyMg==", "bodyText": "We run tests on 3.6, couldn't we set that here?", "url": "https://github.com/returntocorp/semgrep/pull/718#discussion_r422224922", "createdAt": "2020-05-08T15:58:05Z", "author": {"login": "underyx"}, "path": "semgrep/Pipfile", "diffHunk": "@@ -0,0 +1,16 @@\n+[[source]]\n+name = \"pypi\"\n+url = \"https://pypi.org/simple\"\n+verify_ssl = true\n+\n+[dev-packages]\n+pytest = \"*\"\n+wheel = \"*\"\n+tox = \"*\"\n+pytest-snapshot = \"*\"\n+\n+[packages]\n+semgrep = {editable = true,path = \".\"}\n+\n+[requires]\n+python_version = \"3.7\"", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "8f97ce08feea09bdd701234d2221e1669e3a4c25"}, "originalPosition": 16}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "b0c50ce01d8b7a83aff2cccaa202faa044970ace", "author": {"user": {"login": "rcoh", "name": "Russell Cohen"}}, "url": "https://github.com/returntocorp/semgrep/commit/b0c50ce01d8b7a83aff2cccaa202faa044970ace", "committedDate": "2020-05-08T18:56:32Z", "message": "Don't install into the system so that make test works"}, "afterCommit": {"oid": "99c1d59d2fa94e70c5bd7a6317c2471946293607", "author": {"user": {"login": "rcoh", "name": "Russell Cohen"}}, "url": "https://github.com/returntocorp/semgrep/commit/99c1d59d2fa94e70c5bd7a6317c2471946293607", "committedDate": "2020-05-08T19:04:07Z", "message": "Don't install into the system so that make test works"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "4dd7217003a7327b37687119aedc1b121163b420", "author": {"user": {"login": "rcoh", "name": "Russell Cohen"}}, "url": "https://github.com/returntocorp/semgrep/commit/4dd7217003a7327b37687119aedc1b121163b420", "committedDate": "2020-05-14T15:22:06Z", "message": "Switch environment to use Pipenv"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ce079d5ccddcbaf80ec73661858d7997af68f47c", "author": {"user": {"login": "rcoh", "name": "Russell Cohen"}}, "url": "https://github.com/returntocorp/semgrep/commit/ce079d5ccddcbaf80ec73661858d7997af68f47c", "committedDate": "2020-05-14T15:22:06Z", "message": "Install pipenv in workflow"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "17c630e87c5bf239ba1dc2e0509853661b42eed0", "author": {"user": {"login": "rcoh", "name": "Russell Cohen"}}, "url": "https://github.com/returntocorp/semgrep/commit/17c630e87c5bf239ba1dc2e0509853661b42eed0", "committedDate": "2020-05-14T15:22:06Z", "message": "Fix build script to use pipfile deps"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "15dc56140ac35aa5cb31200b8524ad8b2f3811e9", "author": {"user": {"login": "rcoh", "name": "Russell Cohen"}}, "url": "https://github.com/returntocorp/semgrep/commit/15dc56140ac35aa5cb31200b8524ad8b2f3811e9", "committedDate": "2020-05-14T15:22:06Z", "message": "Replace another use of requirements.txt"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "0ad458722804dee7828176a93de5937fa200fb63", "author": {"user": {"login": "rcoh", "name": "Russell Cohen"}}, "url": "https://github.com/returntocorp/semgrep/commit/0ad458722804dee7828176a93de5937fa200fb63", "committedDate": "2020-05-14T15:24:10Z", "message": "Use importlib to load the version"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "3d40f325104861e294240799ff50af3b55d58c14", "author": {"user": {"login": "rcoh", "name": "Russell Cohen"}}, "url": "https://github.com/returntocorp/semgrep/commit/3d40f325104861e294240799ff50af3b55d58c14", "committedDate": "2020-05-14T15:24:10Z", "message": "Add .git during docker build"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b1cf6ebe49f5a51a643a909ebdcae765c1b93d95", "author": {"user": {"login": "rcoh", "name": "Russell Cohen"}}, "url": "https://github.com/returntocorp/semgrep/commit/b1cf6ebe49f5a51a643a909ebdcae765c1b93d95", "committedDate": "2020-05-14T15:24:10Z", "message": "Remove uneeded setting of PYTHONPATH"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "eda4bb005609abcf768177787fbe2df5c32150b2", "author": {"user": {"login": "rcoh", "name": "Russell Cohen"}}, "url": "https://github.com/returntocorp/semgrep/commit/eda4bb005609abcf768177787fbe2df5c32150b2", "committedDate": "2020-05-14T15:24:10Z", "message": "Don't install into the system so that make test works"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "9a7dc6751fd6d6d6a9ef91172537a466374510c3", "author": {"user": {"login": "rcoh", "name": "Russell Cohen"}}, "url": "https://github.com/returntocorp/semgrep/commit/9a7dc6751fd6d6d6a9ef91172537a466374510c3", "committedDate": "2020-05-14T15:24:10Z", "message": "Fix qa-test target"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f95a63632ccfe834505dc80fcf28a1c3f5c54606", "author": {"user": {"login": "rcoh", "name": "Russell Cohen"}}, "url": "https://github.com/returntocorp/semgrep/commit/f95a63632ccfe834505dc80fcf28a1c3f5c54606", "committedDate": "2020-05-14T16:00:56Z", "message": "Produce a semgrep/version.py file instead, add homebrew support"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "bef9bbf67a1f466a3c12497e207d54f154edd09d", "author": {"user": {"login": "rcoh", "name": "Russell Cohen"}}, "url": "https://github.com/returntocorp/semgrep/commit/bef9bbf67a1f466a3c12497e207d54f154edd09d", "committedDate": "2020-05-08T19:15:30Z", "message": "Fix qa-test target"}, "afterCommit": {"oid": "f95a63632ccfe834505dc80fcf28a1c3f5c54606", "author": {"user": {"login": "rcoh", "name": "Russell Cohen"}}, "url": "https://github.com/returntocorp/semgrep/commit/f95a63632ccfe834505dc80fcf28a1c3f5c54606", "committedDate": "2020-05-14T16:00:56Z", "message": "Produce a semgrep/version.py file instead, add homebrew support"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "9dbc97a673b989352a04a75cc5d7bb9ae8fa404e", "author": {"user": {"login": "rcoh", "name": "Russell Cohen"}}, "url": "https://github.com/returntocorp/semgrep/commit/9dbc97a673b989352a04a75cc5d7bb9ae8fa404e", "committedDate": "2020-05-14T16:16:35Z", "message": "Remove old version string. Thanks Bento!"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e6200f8af106ced6f0f54726ae20fa8e17692078", "author": {"user": {"login": "rcoh", "name": "Russell Cohen"}}, "url": "https://github.com/returntocorp/semgrep/commit/e6200f8af106ced6f0f54726ae20fa8e17692078", "committedDate": "2020-05-14T16:21:52Z", "message": "Remove uneeded line from Dockerfile"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "19597d5bf6c7c5d6ba33114811dbc16d6eef41d4", "author": {"user": {"login": "rcoh", "name": "Russell Cohen"}}, "url": "https://github.com/returntocorp/semgrep/commit/19597d5bf6c7c5d6ba33114811dbc16d6eef41d4", "committedDate": "2020-05-14T17:07:09Z", "message": "Masked keys refactoring"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "b88fd4c207f46dcf6f4fce7e6e7ceef8decce1b6", "author": {"user": {"login": "rcoh", "name": "Russell Cohen"}}, "url": "https://github.com/returntocorp/semgrep/commit/b88fd4c207f46dcf6f4fce7e6e7ceef8decce1b6", "committedDate": "2020-05-14T17:37:20Z", "message": "Remove unused Bento archive"}, "afterCommit": {"oid": "e4f2a9ad4d5253501150f89cbeee5b9e788b460d", "author": {"user": {"login": "rcoh", "name": "Russell Cohen"}}, "url": "https://github.com/returntocorp/semgrep/commit/e4f2a9ad4d5253501150f89cbeee5b9e788b460d", "committedDate": "2020-05-14T17:40:04Z", "message": "Remove unused Bento archive"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ca54932ef06eef261d665d6be5144e6ae742bdbd", "author": {"user": {"login": "rcoh", "name": "Russell Cohen"}}, "url": "https://github.com/returntocorp/semgrep/commit/ca54932ef06eef261d665d6be5144e6ae742bdbd", "committedDate": "2020-05-14T17:41:01Z", "message": "Remove unused Bento archive"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "e4f2a9ad4d5253501150f89cbeee5b9e788b460d", "author": {"user": {"login": "rcoh", "name": "Russell Cohen"}}, "url": "https://github.com/returntocorp/semgrep/commit/e4f2a9ad4d5253501150f89cbeee5b9e788b460d", "committedDate": "2020-05-14T17:40:04Z", "message": "Remove unused Bento archive"}, "afterCommit": {"oid": "ca54932ef06eef261d665d6be5144e6ae742bdbd", "author": {"user": {"login": "rcoh", "name": "Russell Cohen"}}, "url": "https://github.com/returntocorp/semgrep/commit/ca54932ef06eef261d665d6be5144e6ae742bdbd", "committedDate": "2020-05-14T17:41:01Z", "message": "Remove unused Bento archive"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e78a6dfabb8945d051d37b63fa92b30fef297d64", "author": {"user": {"login": "rcoh", "name": "Russell Cohen"}}, "url": "https://github.com/returntocorp/semgrep/commit/e78a6dfabb8945d051d37b63fa92b30fef297d64", "committedDate": "2020-05-14T17:46:59Z", "message": "Move git attributes to the right place"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDEyMDUxMDE2", "url": "https://github.com/returntocorp/semgrep/pull/718#pullrequestreview-412051016", "createdAt": "2020-05-14T17:53:56Z", "commit": {"oid": "ca54932ef06eef261d665d6be5144e6ae742bdbd"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xNFQxNzo1Mzo1NlrOGVn3vg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xNFQxNzo1Mzo1NlrOGVn3vg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNTMyNjUyNg==", "bodyText": "Is there a reason to have wheel installed separately instead of adding it to the --dev pipenv?", "url": "https://github.com/returntocorp/semgrep/pull/718#discussion_r425326526", "createdAt": "2020-05-14T17:53:56Z", "author": {"login": "brendongo"}, "path": ".github/workflows/build.yml", "diffHunk": "@@ -21,7 +21,7 @@ jobs:\n       - name: Install and test semgrep-core\n         run: eval $(opam  env --root /home/opam/.opam --set-root) && cd semgrep-core && opam install -y . && make all && make test && make install\n       - name: Install and test semgrep\n-        run: eval $(opam  env --root /home/opam/.opam --set-root) && cd semgrep && export PATH=/github/home/.local/bin:$PATH && pip3 install wheel==0.34.2 && pip3 install -r requirements.txt && make test && make qa-test && make all\n+        run: eval $(opam  env --root /home/opam/.opam --set-root) && cd semgrep && export PATH=/github/home/.local/bin:$PATH && pip3 install wheel==0.34.2 pipenv && pipenv install --dev && make test && make qa-test && make all", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ca54932ef06eef261d665d6be5144e6ae742bdbd"}, "originalPosition": 5}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e6c82f9a2602cd894e104a3da07a027be4035823", "author": {"user": {"login": "rcoh", "name": "Russell Cohen"}}, "url": "https://github.com/returntocorp/semgrep/commit/e6c82f9a2602cd894e104a3da07a027be4035823", "committedDate": "2020-05-14T18:22:52Z", "message": "Don't install wheel manually"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDEyMDc1OTg1", "url": "https://github.com/returntocorp/semgrep/pull/718#pullrequestreview-412075985", "createdAt": "2020-05-14T18:27:35Z", "commit": {"oid": "e6c82f9a2602cd894e104a3da07a027be4035823"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 970, "cost": 1, "resetAt": "2021-11-01T16:37:27Z"}}}