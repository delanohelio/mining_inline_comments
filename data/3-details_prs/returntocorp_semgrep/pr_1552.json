{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDcxMTY4NzQz", "number": 1552, "title": "No weird tree sitter output", "bodyText": "Fixes #1543.\nTrio-programmed with @colleend @mjambon", "createdAt": "2020-08-20T18:32:50Z", "url": "https://github.com/returntocorp/semgrep/pull/1552", "merged": true, "mergeCommit": {"oid": "36c1d1cd6f5ac6a74086e553deb741f0b7ad3eb9"}, "closed": true, "closedAt": "2020-08-20T19:33:45Z", "author": {"login": "nbrahms"}, "timelineItems": {"totalCount": 6, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdA0h79AH2gAyNDcxMTY4NzQzOjUzYTUzZTQ3Yjk4MWY1ZjRhODU5M2I0YWUwZWI0NDQxMjQ5ZTQwMDI=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdA1MflgFqTQ3MTkwODk2MA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "53a53e47b981f5f4a8593b4ae0eb4441249e4002", "author": {"user": {"login": "nbrahms", "name": "Nathaniel Brahms"}}, "url": "https://github.com/returntocorp/semgrep/commit/53a53e47b981f5f4a8593b4ae0eb4441249e4002", "committedDate": "2020-08-20T18:29:22Z", "message": "Prevent tree-sitter failures from breaking JSON output\n\nThis commit prevents this in two ways:\n1. Hides pr2-based debugging output on parse failures (we should\n   re-enable this under a debug flag later).\n2. Does not fall-back to tree-sitter parsing for JavaScript specifically\n   (tree-sitter for js is not complete)."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "10a86cb8111e1b4e945c55e555f6c2a920d9ee94", "author": {"user": {"login": "nbrahms", "name": "Nathaniel Brahms"}}, "url": "https://github.com/returntocorp/semgrep/commit/10a86cb8111e1b4e945c55e555f6c2a920d9ee94", "committedDate": "2020-08-20T18:31:34Z", "message": "Make immune to non-JSON core output"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "2436f382e54aaa04c099800d3dad5cf24b887ba9", "author": {"user": {"login": "nbrahms", "name": "Nathaniel Brahms"}}, "url": "https://github.com/returntocorp/semgrep/commit/2436f382e54aaa04c099800d3dad5cf24b887ba9", "committedDate": "2020-08-20T18:33:26Z", "message": "Merge branch 'develop' into nathan/no-weird-tree-sitter-output"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDcxODgzOTYy", "url": "https://github.com/returntocorp/semgrep/pull/1552#pullrequestreview-471883962", "createdAt": "2020-08-20T18:39:04Z", "commit": {"oid": "2436f382e54aaa04c099800d3dad5cf24b887ba9"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yMFQxODozOTowNFrOHEOeUQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yMFQxODozOTowNFrOHEOeUQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NDE5MzQ4OQ==", "bodyText": "do we need to comment this out?", "url": "https://github.com/returntocorp/semgrep/pull/1552#discussion_r474193489", "createdAt": "2020-08-20T18:39:04Z", "author": {"login": "colleend"}, "path": "semgrep-core/parsing/Parse_javascript_tree_sitter.ml", "diffHunk": "@@ -1758,10 +1758,13 @@ let parse file =\n     program env ast\n   with\n     (Failure \"not implemented\") as exn ->\n-      let s = Printexc.get_backtrace () in\n-      pr2 \"Some constructs are not handled yet\";\n-      pr2 \"CST was:\";\n-      CST.dump_tree ast;\n-      pr2 \"Original backtrace:\";\n-      pr2 s;\n+      (* This debugging output is not JSON and breaks core output", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "2436f382e54aaa04c099800d3dad5cf24b887ba9"}, "originalPosition": 10}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDcxODg4MTk5", "url": "https://github.com/returntocorp/semgrep/pull/1552#pullrequestreview-471888199", "createdAt": "2020-08-20T18:44:54Z", "commit": {"oid": "2436f382e54aaa04c099800d3dad5cf24b887ba9"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yMFQxODo0NDo1NVrOHEOrnw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yMFQxODo0NjowNVrOHEOuCA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NDE5Njg5NQ==", "bodyText": "We want to try treesitter if there is any exn in the pfff parser (lexer exn, parse error) or when we have -forcetreesitter", "url": "https://github.com/returntocorp/semgrep/pull/1552#discussion_r474196895", "createdAt": "2020-08-20T18:44:55Z", "author": {"login": "aryx"}, "path": "semgrep-core/parsing/Parse_code.ml", "diffHunk": "@@ -76,7 +78,7 @@ let just_parse_with_lang lang file =\n               Ast_js_build.program cst\n             )\n             file\n-        with _exn -> Parse_javascript_tree_sitter.parse file\n+        with ForceTreeSitter -> Parse_javascript_tree_sitter.parse file", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "2436f382e54aaa04c099800d3dad5cf24b887ba9"}, "originalPosition": 18}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NDE5NzExOQ==", "bodyText": "So it should remain _exn here", "url": "https://github.com/returntocorp/semgrep/pull/1552#discussion_r474197119", "createdAt": "2020-08-20T18:45:21Z", "author": {"login": "aryx"}, "path": "semgrep-core/parsing/Parse_code.ml", "diffHunk": "@@ -76,7 +78,7 @@ let just_parse_with_lang lang file =\n               Ast_js_build.program cst\n             )\n             file\n-        with _exn -> Parse_javascript_tree_sitter.parse file\n+        with ForceTreeSitter -> Parse_javascript_tree_sitter.parse file", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NDE5Njg5NQ=="}, "originalCommit": {"oid": "2436f382e54aaa04c099800d3dad5cf24b887ba9"}, "originalPosition": 18}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NDE5NzUxMg==", "bodyText": "But it is printed on stderr. It should not matter. The json is printed on stdout", "url": "https://github.com/returntocorp/semgrep/pull/1552#discussion_r474197512", "createdAt": "2020-08-20T18:46:05Z", "author": {"login": "aryx"}, "path": "semgrep-core/parsing/Parse_javascript_tree_sitter.ml", "diffHunk": "@@ -1758,10 +1758,13 @@ let parse file =\n     program env ast\n   with\n     (Failure \"not implemented\") as exn ->\n-      let s = Printexc.get_backtrace () in\n-      pr2 \"Some constructs are not handled yet\";\n-      pr2 \"CST was:\";\n-      CST.dump_tree ast;\n-      pr2 \"Original backtrace:\";\n-      pr2 s;\n+      (* This debugging output is not JSON and breaks core output", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NDE5MzQ4OQ=="}, "originalCommit": {"oid": "2436f382e54aaa04c099800d3dad5cf24b887ba9"}, "originalPosition": 10}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDcxOTA4OTYw", "url": "https://github.com/returntocorp/semgrep/pull/1552#pullrequestreview-471908960", "createdAt": "2020-08-20T19:15:51Z", "commit": {"oid": "2436f382e54aaa04c099800d3dad5cf24b887ba9"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1318, "cost": 1, "resetAt": "2021-11-01T16:37:27Z"}}}