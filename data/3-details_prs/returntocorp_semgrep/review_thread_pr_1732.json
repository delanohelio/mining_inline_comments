{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDkzNjE3Nzgy", "number": 1732, "reviewThreads": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0zMFQxODo1MTo0NlrOEpKTdw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wNVQyMjo1NzoxNFrOEqgjfQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzExNTk1ODk1OnYy", "diffSide": "RIGHT", "path": "semgrep/semgrep/core_runner.py", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0zMFQxODo1MTo0NlrOHaq-yQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0zMFQxODo1MTo0NlrOHaq-yQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NzcyOTIyNQ==", "bodyText": "This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters. Learn more about bidirectional Unicode characters\n\n\n  \n\n\n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                    # logger.debug(all_targets)", "url": "https://github.com/returntocorp/semgrep/pull/1732#discussion_r497729225", "createdAt": "2020-09-30T18:51:46Z", "author": {"login": "brendongo"}, "path": "semgrep/semgrep/core_runner.py", "diffHunk": "@@ -498,6 +501,7 @@ def _run_rules(\n                             max_timeout_files.append(err.path)\n \n         all_errors = dedup_errors(all_errors)\n+        # logger.debug(all_targets)", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "454daaf0cfaa0e0c6cf294db27d6f109d00d324e"}, "originalPosition": 32}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzExNTk3Nzg2OnYy", "diffSide": "RIGHT", "path": "semgrep/semgrep/output.py", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0zMFQxODo1NzoxMlrOHarKlA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wMVQyMzo1NTo1MlrOHbeDqQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NzczMjI0NA==", "bodyText": "Some users expect no output to be printed when no matches are found. IMO a stats line should be under --verbose and output should only ever be findings.", "url": "https://github.com/returntocorp/semgrep/pull/1732#discussion_r497732244", "createdAt": "2020-09-30T18:57:12Z", "author": {"login": "brendongo"}, "path": "semgrep/semgrep/output.py", "diffHunk": "@@ -399,7 +409,10 @@ def build_output(self, color_output: bool) -> str:\n         elif output_format == OutputFormat.SARIF:\n             return build_sarif_output(self.rule_matches, self.rules)\n         elif output_format == OutputFormat.TEXT:\n-            return \"\\n\".join(build_normal_output(self.rule_matches, color_output))\n+            return \"\\n\".join(\n+                list(build_normal_output(self.rule_matches, color_output))\n+                + ([self.stats_line] if self.stats_line else [])", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "454daaf0cfaa0e0c6cf294db27d6f109d00d324e"}, "originalPosition": 93}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5ODU2NjA1Nw==", "bodyText": "Even in an interactive session @brendongo? I agree if run under a headless shell but for interactive it makes more sense that it tells you how many files it ran on and that there were 0 findings. I get that that differs from grep, but I'm trying to think about the non-poweruser UX.", "url": "https://github.com/returntocorp/semgrep/pull/1732#discussion_r498566057", "createdAt": "2020-10-01T23:55:52Z", "author": {"login": "ievans"}, "path": "semgrep/semgrep/output.py", "diffHunk": "@@ -399,7 +409,10 @@ def build_output(self, color_output: bool) -> str:\n         elif output_format == OutputFormat.SARIF:\n             return build_sarif_output(self.rule_matches, self.rules)\n         elif output_format == OutputFormat.TEXT:\n-            return \"\\n\".join(build_normal_output(self.rule_matches, color_output))\n+            return \"\\n\".join(\n+                list(build_normal_output(self.rule_matches, color_output))\n+                + ([self.stats_line] if self.stats_line else [])", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NzczMjI0NA=="}, "originalCommit": {"oid": "454daaf0cfaa0e0c6cf294db27d6f109d00d324e"}, "originalPosition": 93}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzEzMDA5MDIxOnYy", "diffSide": "RIGHT", "path": "semgrep/semgrep/output.py", "isResolved": false, "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wNVQyMjo1NzoxNFrOHcwcww==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wNVQyMzowMzoyN1rOHcwkkQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5OTkxNTk3MQ==", "bodyText": "Still not sure why we are passing stats line to output and gating tty instead of outputting to stderr like all other non finding output.", "url": "https://github.com/returntocorp/semgrep/pull/1732#discussion_r499915971", "createdAt": "2020-10-05T22:57:14Z", "author": {"login": "brendongo"}, "path": "semgrep/semgrep/output.py", "diffHunk": "@@ -399,7 +409,13 @@ def build_output(self, color_output: bool) -> str:\n         elif output_format == OutputFormat.SARIF:\n             return build_sarif_output(self.rule_matches, self.rules)\n         elif output_format == OutputFormat.TEXT:\n-            return \"\\n\".join(build_normal_output(self.rule_matches, color_output))\n+            stats_line = []\n+            if sys.stderr.isatty():", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "3cb743e442f8953577daeac1663f8ec3eadbe41d"}, "originalPosition": 92}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5OTkxNjQ3OQ==", "bodyText": "Relevant slack convo: https://returntocorp.slack.com/archives/C6A1GN4P3/p1601598463387000?thread_ts=1601596568.384500&cid=C6A1GN4P3", "url": "https://github.com/returntocorp/semgrep/pull/1732#discussion_r499916479", "createdAt": "2020-10-05T22:58:57Z", "author": {"login": "brendongo"}, "path": "semgrep/semgrep/output.py", "diffHunk": "@@ -399,7 +409,13 @@ def build_output(self, color_output: bool) -> str:\n         elif output_format == OutputFormat.SARIF:\n             return build_sarif_output(self.rule_matches, self.rules)\n         elif output_format == OutputFormat.TEXT:\n-            return \"\\n\".join(build_normal_output(self.rule_matches, color_output))\n+            stats_line = []\n+            if sys.stderr.isatty():", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5OTkxNTk3MQ=="}, "originalCommit": {"oid": "3cb743e442f8953577daeac1663f8ec3eadbe41d"}, "originalPosition": 92}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5OTkxNzk2OQ==", "bodyText": "It's also less code: call logger.info here: https://github.com/returntocorp/semgrep/blob/develop/semgrep/semgrep/output.py#L346 ?", "url": "https://github.com/returntocorp/semgrep/pull/1732#discussion_r499917969", "createdAt": "2020-10-05T23:03:27Z", "author": {"login": "brendongo"}, "path": "semgrep/semgrep/output.py", "diffHunk": "@@ -399,7 +409,13 @@ def build_output(self, color_output: bool) -> str:\n         elif output_format == OutputFormat.SARIF:\n             return build_sarif_output(self.rule_matches, self.rules)\n         elif output_format == OutputFormat.TEXT:\n-            return \"\\n\".join(build_normal_output(self.rule_matches, color_output))\n+            stats_line = []\n+            if sys.stderr.isatty():", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5OTkxNTk3MQ=="}, "originalCommit": {"oid": "3cb743e442f8953577daeac1663f8ec3eadbe41d"}, "originalPosition": 92}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4871, "cost": 1, "resetAt": "2021-11-12T12:57:47Z"}}}