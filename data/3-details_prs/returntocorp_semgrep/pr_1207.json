{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDQ1NzM5NTY5", "number": 1207, "title": "Handle file-not-found errors more gracefully", "bodyText": "Re-factored target manager init method to use attr.s for clarity and passed output_handler to target_manager. Fixes #706", "createdAt": "2020-07-07T22:48:46Z", "url": "https://github.com/returntocorp/semgrep/pull/1207", "merged": true, "mergeCommit": {"oid": "444c15bf3e66e700d54c4f542494ada4f1698b43"}, "closed": true, "closedAt": "2020-07-08T22:40:07Z", "author": {"login": "chmccreery"}, "timelineItems": {"totalCount": 6, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcytyfDAH2gAyNDQ1NzM5NTY5OmYzYzcxY2FmNDJkNDk2NTNkY2Q4ZTUxOTg1MjdjMWNkZTQ4N2MwODU=", "endCursor": "Y3Vyc29yOnYyOpPPAAABczAeGlAH2gAyNDQ1NzM5NTY5OjRmMzJiYzc3YmFkN2E2MzgxYTU1NmRhY2NkYjc1YTI2NzEzY2Y5ZTU=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "f3c71caf42d49653dcd8e5198527c1cde487c085", "author": {"user": {"login": "chmccreery", "name": "Clara McCreery"}}, "url": "https://github.com/returntocorp/semgrep/commit/f3c71caf42d49653dcd8e5198527c1cde487c085", "committedDate": "2020-07-07T22:43:10Z", "message": "Handle file-not-found errors more gracefully\n\nRe-factored target manager init method to use attr.s for clarity and passed output_handler to target_manager."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDQ0MzI0NTM3", "url": "https://github.com/returntocorp/semgrep/pull/1207#pullrequestreview-444324537", "createdAt": "2020-07-07T23:51:38Z", "commit": {"oid": "f3c71caf42d49653dcd8e5198527c1cde487c085"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wN1QyMzo1MTozOFrOGuTbgw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wN1QyMzo1MTozOFrOGuTbgw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MTIwNjAxOQ==", "bodyText": "TargetManager should not need to know how to handle output. Probably better to have functions return relevant info and the caller can handle how it wants to deal with outputing said info.", "url": "https://github.com/returntocorp/semgrep/pull/1207#discussion_r451206019", "createdAt": "2020-07-07T23:51:38Z", "author": {"login": "brendongo"}, "path": "semgrep/semgrep/target_manager.py", "diffHunk": "@@ -62,26 +67,22 @@ def lang_to_exts(language: Language) -> List[FileExtension]:\n         raise _UnknownLanguageError(f\"Unsupported Language: {language}\")\n \n \n+@attr.s(auto_attribs=True)\n class TargetManager:\n-    def __init__(\n-        self,\n-        includes: List[str],\n-        excludes: List[str],\n-        targets: List[str],\n-        respect_git_ignore: bool,\n-    ) -> None:\n-        \"\"\"\n-            Handles all file include/exclude logic for semgrep\n+    \"\"\"\n+        Handles all file include/exclude logic for semgrep\n \n-            If respect_git_ignore is true then will only consider files that are\n-            tracked or (untracked but not ignored) by git\n-        \"\"\"\n-        self._targets = targets\n-        self._includes = includes\n-        self._excludes = excludes\n-        self._respect_git_ignore = respect_git_ignore\n+        If respect_git_ignore is true then will only consider files that are\n+        tracked or (untracked but not ignored) by git\n+    \"\"\"\n+\n+    targets: List[str]\n+    includes: List[str]\n+    excludes: List[str]\n+    respect_git_ignore: bool\n+    output_handler: OutputHandler", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f3c71caf42d49653dcd8e5198527c1cde487c085"}, "originalPosition": 52}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDQ0MzI1MTUx", "url": "https://github.com/returntocorp/semgrep/pull/1207#pullrequestreview-444325151", "createdAt": "2020-07-07T23:53:27Z", "commit": {"oid": "f3c71caf42d49653dcd8e5198527c1cde487c085"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wN1QyMzo1MzoyN1rOGuTdqA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wN1QyMzo1MzoyN1rOGuTdqA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MTIwNjU2OA==", "bodyText": "You might need to handle symlinked files as well?", "url": "https://github.com/returntocorp/semgrep/pull/1207#discussion_r451206568", "createdAt": "2020-07-07T23:53:27Z", "author": {"login": "brendongo"}, "path": "semgrep/semgrep/target_manager.py", "diffHunk": "@@ -237,23 +238,31 @@ def filtered_files(self, lang: Language) -> Set[Path]:\n         if lang in self._filtered_targets:\n             return self._filtered_targets[lang]\n \n-        targets = self.resolve_targets(self._targets)\n-        explicit_files, directories = partition_set(lambda p: not p.is_dir(), targets)\n+        targets = self.resolve_targets(self.targets)\n+\n+        files, directories = partition_set(lambda p: not p.is_dir(), targets)\n+\n+        # Error on non-existent files\n+        explicit_files, nonexistent_files = partition_set(lambda p: p.is_file(), files)", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f3c71caf42d49653dcd8e5198527c1cde487c085"}, "originalPosition": 70}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "93d1c7c00a43b2241f0f543f30ec69f53a26b47c", "author": {"user": {"login": "chmccreery", "name": "Clara McCreery"}}, "url": "https://github.com/returntocorp/semgrep/commit/93d1c7c00a43b2241f0f543f30ec69f53a26b47c", "committedDate": "2020-07-08T01:29:04Z", "message": "Fix test failures from reordered arguments to TargetManager"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDQ0OTU3NDM0", "url": "https://github.com/returntocorp/semgrep/pull/1207#pullrequestreview-444957434", "createdAt": "2020-07-08T16:56:02Z", "commit": {"oid": "93d1c7c00a43b2241f0f543f30ec69f53a26b47c"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "4f32bc77bad7a6381a556daccdb75a26713cf9e5", "author": {"user": {"login": "chmccreery", "name": "Clara McCreery"}}, "url": "https://github.com/returntocorp/semgrep/commit/4f32bc77bad7a6381a556daccdb75a26713cf9e5", "committedDate": "2020-07-08T20:29:06Z", "message": "update CHANGELOG"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1464, "cost": 1, "resetAt": "2021-11-01T16:37:27Z"}}}