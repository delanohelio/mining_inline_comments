{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDEzMTYzMjgy", "number": 680, "title": "Refactor tests to run via pytest", "bodyText": "Closes #626\nTODO\n\n Needs lots of documentation work before merging. But I'd rather do that after the general design & direction is approved. Namely, I went with a pytestic design which uses pytest features that optimize for simple test code, rather than verbose, type-safe code.\n Need to figure out what to do with mypy. I'd argue it's not worth it to type-check everything in these test files.\n Split commits for easier review.\n Create issues fo next steps of testing architecture", "createdAt": "2020-05-04T20:18:52Z", "url": "https://github.com/returntocorp/semgrep/pull/680", "merged": true, "mergeCommit": {"oid": "9c82fcc6cae0f2c048f25e2801e8445b36c52022"}, "closed": true, "closedAt": "2020-05-06T18:27:16Z", "author": {"login": "underyx"}, "timelineItems": {"totalCount": 42, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABceFYLugFqTQwNTMxNjM1Nw==", "endCursor": "Y3Vyc29yOnYyOpPPAAABcerC44gH2gAyNDEzMTYzMjgyOjhjNzUwOTMzZTM2NjE5YmZkNWUxMGJkMWYyMjgyZjA4YWNlZmYxYTU=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDA1MzE2MzU3", "url": "https://github.com/returntocorp/semgrep/pull/680#pullrequestreview-405316357", "createdAt": "2020-05-04T20:19:44Z", "commit": {"oid": "62539570a6325a86a2d1866c57bb6e9465354291"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wNFQyMDoxOTo0NFrOGQQo5A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wNFQyMDoxOTo0NFrOGQQo5A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxOTcwMzAxMg==", "bodyText": "Once semgrep is pip installable, I'd prefer to make sure everyone has it installed as editable in their environment instead of setting PYTHONPATH.", "url": "https://github.com/returntocorp/semgrep/pull/680#discussion_r419703012", "createdAt": "2020-05-04T20:19:44Z", "author": {"login": "underyx"}, "path": "semgrep/Makefile", "diffHunk": "@@ -3,7 +3,7 @@ all:\n clean:\n \trm -rf ./build/\n test:\n-\t./tests/run-lint-tests.sh\n+\tPYTHONPATH=. pytest tests/", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "62539570a6325a86a2d1866c57bb6e9465354291"}, "originalPosition": 5}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDA1MzE3Njky", "url": "https://github.com/returntocorp/semgrep/pull/680#pullrequestreview-405317692", "createdAt": "2020-05-04T20:21:45Z", "commit": {"oid": "62539570a6325a86a2d1866c57bb6e9465354291"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wNFQyMDoyMTo0NVrOGQQtIg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wNFQyMDoyMTo0NVrOGQQtIg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxOTcwNDA5OA==", "bodyText": "Note to self, find out why this printed message changed compared to the previous committed JSON.", "url": "https://github.com/returntocorp/semgrep/pull/680#discussion_r419704098", "createdAt": "2020-05-04T20:21:45Z", "author": {"login": "underyx"}, "path": "semgrep/tests/e2e/snapshots/test_json_output/test_default_rule__file/results.json", "diffHunk": "@@ -0,0 +1 @@\n+{\"results\": [{\"check_id\": \"eqeq-is-bad\", \"path\": \"targets/basic/stupid.py\", \"start\": {\"line\": 3, \"col\": 12}, \"end\": {\"line\": 3, \"col\": 26}, \"extra\": {\"message\": \"useless comparison operation `a+b == a+b` or `a+b != a+b`; possible bug?\", \"metavars\": {\"$X\": {\"start\": {\"line\": 3, \"col\": 12, \"offset\": 55}, \"end\": {\"line\": 3, \"col\": 17, \"offset\": 60}, \"abstract_content\": \"a+b\", \"unique_id\": {\"type\": \"AST\", \"md5sum\": \"07d71d85769e594dba9d7ae3d295c01f\"}}}, \"metadata\": {}, \"severity\": \"ERROR\"}}, {\"check_id\": \"javascript-basic-eqeq-bad\", \"path\": \"targets/basic/stupid.js\", \"start\": {\"line\": 3, \"col\": 13}, \"end\": {\"line\": 3, \"col\": 19}, \"extra\": {\"message\": \"useless comparison\", \"metavars\": {\"$X\": {\"start\": {\"line\": 3, \"col\": 13, \"offset\": 24}, \"end\": {\"line\": 3, \"col\": 14, \"offset\": 25}, \"abstract_content\": \"x\", \"unique_id\": {\"type\": \"id\", \"value\": \"x\", \"kind\": \"Global\", \"sid\": 1}}}, \"metadata\": {}, \"severity\": \"ERROR\"}}], \"errors\": []}", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "62539570a6325a86a2d1866c57bb6e9465354291"}, "originalPosition": 1}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDA1MzE4MzM0", "url": "https://github.com/returntocorp/semgrep/pull/680#pullrequestreview-405318334", "createdAt": "2020-05-04T20:22:45Z", "commit": {"oid": "62539570a6325a86a2d1866c57bb6e9465354291"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wNFQyMDoyMjo0NVrOGQQvYw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wNFQyMDoyMjo0NVrOGQQvYw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxOTcwNDY3NQ==", "bodyText": "Note that my paths being snapshotted here are okay, as this is marked as an expected failure and this issue is linked: #678", "url": "https://github.com/returntocorp/semgrep/pull/680#discussion_r419704675", "createdAt": "2020-05-04T20:22:45Z", "author": {"login": "underyx"}, "path": "semgrep/tests/e2e/snapshots/test_rule_parser/test_rule_parser__failure__error_messages/bad1/error.txt", "diffHunk": "@@ -0,0 +1,26 @@\n+Traceback (most recent call last):", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "62539570a6325a86a2d1866c57bb6e9465354291"}, "originalPosition": 1}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDA1MzE4OTMx", "url": "https://github.com/returntocorp/semgrep/pull/680#pullrequestreview-405318931", "createdAt": "2020-05-04T20:23:36Z", "commit": {"oid": "62539570a6325a86a2d1866c57bb6e9465354291"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wNFQyMDoyMzozNlrOGQQxFw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wNFQyMDoyMzozNlrOGQQxFw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxOTcwNTExMQ==", "bodyText": "I'm not fully sure what this does, @DrewDennison could you explain these commands and what they test?", "url": "https://github.com/returntocorp/semgrep/pull/680#discussion_r419705111", "createdAt": "2020-05-04T20:23:36Z", "author": {"login": "underyx"}, "path": "semgrep/tests/e2e/test_semgrep_rules_repo.py", "diffHunk": "@@ -0,0 +1,22 @@\n+import subprocess\n+from pathlib import Path\n+\n+\n+def test_semgrep_rules_repo(run_semgrep):\n+    subprocess.check_output(\n+        [\"git\", \"clone\", \"--depth=1\", \"https://github.com/returntocorp/semgrep-rules\"]\n+    )\n+    subprocess.check_output([\"python\", \"-m\", \"semgrep\", \"--generate-config\"])\n+    subprocess.check_output(\n+        [\n+            \"python\",\n+            \"-m\",\n+            \"semgrep\",\n+            \"--dangerously-allow-arbitrary-code-execution-from-rules\",\n+            \"--strict\",\n+            \"--test\",\n+            \"--test-ignore-todo\",\n+            \"semgrep-rules\",\n+        ]\n+    )\n+    subprocess.check_output([\"python\", \"-m\", \"semgrep\", \"--validate\", \"semgrep-rules\"])", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "62539570a6325a86a2d1866c57bb6e9465354291"}, "originalPosition": 22}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDA1ODc3NTg2", "url": "https://github.com/returntocorp/semgrep/pull/680#pullrequestreview-405877586", "createdAt": "2020-05-05T15:02:03Z", "commit": {"oid": "62539570a6325a86a2d1866c57bb6e9465354291"}, "state": "COMMENTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wNVQxNTowMjowM1rOGQttcQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wNVQxNTowMzozM1rOGQtxwg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMDE3OTMxMw==", "bodyText": "Is there any way we can achieve the same level of testing without snapshotting? If I'm understanding snapshots correctly, they seem very difficult to reason about. I can never tell why a huge JSON blob is no longer the same as a previous huge JSON blob. IMO we should be testing small amounts of functionality and return values instead of dumping everything to a file and essentially performing a diff.", "url": "https://github.com/returntocorp/semgrep/pull/680#discussion_r420179313", "createdAt": "2020-05-05T15:02:03Z", "author": {"login": "mschwager"}, "path": "semgrep/requirements.txt", "diffHunk": "@@ -1,5 +1,6 @@\n colorama==0.4.3\n pytest==5.3.5\n+pytest-snapshot==0.4.0", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "62539570a6325a86a2d1866c57bb6e9465354291"}, "originalPosition": 3}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMDE4MDQxOA==", "bodyText": "This is calling Python code from Python code. Is there any way we can just call this library directly instead of subprocessing out?", "url": "https://github.com/returntocorp/semgrep/pull/680#discussion_r420180418", "createdAt": "2020-05-05T15:03:33Z", "author": {"login": "mschwager"}, "path": "semgrep/tests/e2e/conftest.py", "diffHunk": "@@ -0,0 +1,45 @@\n+import subprocess\n+from pathlib import Path\n+from typing import Optional\n+from typing import Sequence\n+from typing import Union\n+\n+import pytest\n+\n+\n+E2E_TESTS_PATH = Path(__file__).parent\n+\n+\n+def _run_semgrep(\n+    config: Optional[Union[str, Path]] = None,\n+    *,\n+    target_name: str = \"basic\",\n+    stderr: bool = False\n+) -> str:\n+    config_opts = [\"--config\", config] if config is not None else []\n+\n+    return subprocess.check_output(", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "62539570a6325a86a2d1866c57bb6e9465354291"}, "originalPosition": 21}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "62539570a6325a86a2d1866c57bb6e9465354291", "author": {"user": {"login": "underyx", "name": "Bence Nagy"}}, "url": "https://github.com/returntocorp/semgrep/commit/62539570a6325a86a2d1866c57bb6e9465354291", "committedDate": "2020-05-04T20:14:39Z", "message": "Refactor tests to run via pytest\n\nCloses https://github.com/returntocorp/semgrep/issues/626"}, "afterCommit": {"oid": "420b674a1cff91e15ba0b02a80fa23194e76e773", "author": {"user": {"login": "underyx", "name": "Bence Nagy"}}, "url": "https://github.com/returntocorp/semgrep/commit/420b674a1cff91e15ba0b02a80fa23194e76e773", "committedDate": "2020-05-05T11:12:05Z", "message": "Makefile: Add regenerate-tests target for semgrep"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "420b674a1cff91e15ba0b02a80fa23194e76e773", "author": {"user": {"login": "underyx", "name": "Bence Nagy"}}, "url": "https://github.com/returntocorp/semgrep/commit/420b674a1cff91e15ba0b02a80fa23194e76e773", "committedDate": "2020-05-05T11:12:05Z", "message": "Makefile: Add regenerate-tests target for semgrep"}, "afterCommit": {"oid": "373f790e59761dcb01991e135b1d58008fc3bd21", "author": {"user": {"login": "underyx", "name": "Bence Nagy"}}, "url": "https://github.com/returntocorp/semgrep/commit/373f790e59761dcb01991e135b1d58008fc3bd21", "committedDate": "2020-05-05T17:21:47Z", "message": "Makefile: Add regenerate-tests target for semgrep"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "373f790e59761dcb01991e135b1d58008fc3bd21", "author": {"user": {"login": "underyx", "name": "Bence Nagy"}}, "url": "https://github.com/returntocorp/semgrep/commit/373f790e59761dcb01991e135b1d58008fc3bd21", "committedDate": "2020-05-05T17:21:47Z", "message": "Makefile: Add regenerate-tests target for semgrep"}, "afterCommit": {"oid": "4df9b5028e7822baaf2f86b16b57afc360e733f3", "author": {"user": {"login": "underyx", "name": "Bence Nagy"}}, "url": "https://github.com/returntocorp/semgrep/commit/4df9b5028e7822baaf2f86b16b57afc360e733f3", "committedDate": "2020-05-05T17:25:04Z", "message": "Makefile: Add regenerate-tests target for semgrep"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "86a7c56fb4500b328ccd786a0cc00a242d31e17a", "author": {"user": {"login": "underyx", "name": "Bence Nagy"}}, "url": "https://github.com/returntocorp/semgrep/commit/86a7c56fb4500b328ccd786a0cc00a242d31e17a", "committedDate": "2020-05-05T18:01:26Z", "message": "Add semgrep testing README"}, "afterCommit": {"oid": "930d22c1ac89e1b200303df41d227f519f86a746", "author": {"user": {"login": "underyx", "name": "Bence Nagy"}}, "url": "https://github.com/returntocorp/semgrep/commit/930d22c1ac89e1b200303df41d227f519f86a746", "committedDate": "2020-05-05T18:04:28Z", "message": "Add semgrep testing README"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "930d22c1ac89e1b200303df41d227f519f86a746", "author": {"user": {"login": "underyx", "name": "Bence Nagy"}}, "url": "https://github.com/returntocorp/semgrep/commit/930d22c1ac89e1b200303df41d227f519f86a746", "committedDate": "2020-05-05T18:04:28Z", "message": "Add semgrep testing README"}, "afterCommit": {"oid": "97ca8ef6b923e4cb00ffd507cbadcd957a071dff", "author": {"user": {"login": "underyx", "name": "Bence Nagy"}}, "url": "https://github.com/returntocorp/semgrep/commit/97ca8ef6b923e4cb00ffd507cbadcd957a071dff", "committedDate": "2020-05-05T18:05:21Z", "message": "Add semgrep testing README"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "97ca8ef6b923e4cb00ffd507cbadcd957a071dff", "author": {"user": {"login": "underyx", "name": "Bence Nagy"}}, "url": "https://github.com/returntocorp/semgrep/commit/97ca8ef6b923e4cb00ffd507cbadcd957a071dff", "committedDate": "2020-05-05T18:05:21Z", "message": "Add semgrep testing README"}, "afterCommit": {"oid": "ac0eb3257d12b67104da1bcc6d94d2d2971f6626", "author": {"user": {"login": "underyx", "name": "Bence Nagy"}}, "url": "https://github.com/returntocorp/semgrep/commit/ac0eb3257d12b67104da1bcc6d94d2d2971f6626", "committedDate": "2020-05-05T18:10:29Z", "message": "Add semgrep testing README"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDA2MDQ3MTI1", "url": "https://github.com/returntocorp/semgrep/pull/680#pullrequestreview-406047125", "createdAt": "2020-05-05T18:26:20Z", "commit": {"oid": "ac0eb3257d12b67104da1bcc6d94d2d2971f6626"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wNVQxODoyNjoyMFrOGQ2KuA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wNVQxODoyNjoyMFrOGQ2KuA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMDMxNzg4MA==", "bodyText": "At some point in the future, we probably want to be able to assert non-0 return codes", "url": "https://github.com/returntocorp/semgrep/pull/680#discussion_r420317880", "createdAt": "2020-05-05T18:26:20Z", "author": {"login": "nbrahms"}, "path": "semgrep/tests/conftest.py", "diffHunk": "@@ -0,0 +1,64 @@\n+import subprocess\n+from pathlib import Path\n+from typing import Optional\n+from typing import Sequence\n+from typing import Union\n+\n+import pytest\n+\n+\n+TESTS_PATH = Path(__file__).parent\n+\n+\n+def _run_semgrep(\n+    config: Optional[Union[str, Path]] = None,\n+    *,\n+    target_name: str = \"basic\",\n+    stderr: bool = False\n+) -> str:\n+    config_opts = [\"--config\", config] if config is not None else []\n+\n+    return subprocess.check_output(", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ac0eb3257d12b67104da1bcc6d94d2d2971f6626"}, "originalPosition": 21}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDA2MDQ5NDEx", "url": "https://github.com/returntocorp/semgrep/pull/680#pullrequestreview-406049411", "createdAt": "2020-05-05T18:29:28Z", "commit": {"oid": "ac0eb3257d12b67104da1bcc6d94d2d2971f6626"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wNVQxODoyOToyOFrOGQ2Shw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wNVQxODoyOToyOFrOGQ2Shw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMDMxOTg3OQ==", "bodyText": "Can this run from a temporary path?", "url": "https://github.com/returntocorp/semgrep/pull/680#discussion_r420319879", "createdAt": "2020-05-05T18:29:28Z", "author": {"login": "nbrahms"}, "path": "semgrep/tests/qa/test_public_repos.py", "diffHunk": "@@ -0,0 +1,99 @@\n+import json\n+import subprocess\n+from pathlib import Path\n+\n+import pytest\n+\n+pytestmark = pytest.mark.qa\n+\n+\n+def xfail_repo(url, *, reason=None):\n+    return pytest.param(url, marks=pytest.mark.xfail(reason=reason))\n+\n+\n+@pytest.mark.parametrize(\n+    \"repo_url\",\n+    [\n+        \"https://github.com/Airtable/airtable.js\",\n+        \"https://github.com/seemoo-lab/opendrop\",\n+        \"https://github.com/lightstep/lightstep-tracer-python\",\n+        \"https://github.com/draios/sysdig-inspect\",\n+        \"https://github.com/getsentry/sentry-python\",\n+        \"https://github.com/signalapp/signal-webrtc-ios\",\n+        \"https://github.com/secdev/scapy\",\n+        \"https://github.com/apache/airflow\",\n+        \"https://github.com/preset-io/elasticsearch-dbapi\",\n+        \"https://github.com/apache/libcloud\",\n+        \"https://github.com/keybase/pykeybasebot\",\n+        \"https://gitbox.apache.org/repos/asf/cassandra\",\n+        \"https://github.com/coinbase/coinbase-commerce-python\",\n+        \"https://github.com/keybase/python-triplesec\",\n+        \"https://github.com/psycopg/psycopg2\",\n+        \"https://github.com/preset-io/flask-jwt-extended\",\n+        \"https://github.com/vstinner/pyperf\",\n+        \"https://github.com/mysql/mysql-connector-python\",\n+        \"https://github.com/Netflix/lemur\",\n+        xfail_repo(\"https://github.com/highcharts/highcharts\"),\n+        xfail_repo(\n+            \"https://github.com/lodash/lodash\",\n+            reason=\"https://github.com/returntocorp/semgrep/issues/580\",\n+        ),\n+        xfail_repo(\"https://github.com/signalapp/Signal-Desktop\"),\n+        xfail_repo(\"https://github.com/opensourceactivismtech/call-power\"),\n+        xfail_repo(\"https://github.com/zulip/zulip\"),\n+        xfail_repo(\n+            \"https://github.com/home-assistant/home-assistant\",\n+            reason=(\n+                \"https://github.com/returntocorp/semgrep/issues/599, \"\n+                \"https://github.com/returntocorp/semgrep/issues/600, \"\n+                \"https://github.com/returntocorp/semgrep/issues/601, \"\n+                \"https://github.com/returntocorp/semgrep/issues/602\"\n+            ),\n+        ),\n+        xfail_repo(\n+            \"https://github.com/apache/incubator-superset\",\n+            reason=(\n+                \"https://github.com/returntocorp/semgrep/issues/581, \"\n+                \"https://github.com/returntocorp/semgrep/issues/582\"\n+            ),\n+        ),\n+    ],\n+)\n+def test_semgrep_on_repo(run_semgrep, repo_url):", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ac0eb3257d12b67104da1bcc6d94d2d2971f6626"}, "originalPosition": 62}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDA2MDQ5OTE5", "url": "https://github.com/returntocorp/semgrep/pull/680#pullrequestreview-406049919", "createdAt": "2020-05-05T18:30:09Z", "commit": {"oid": "ac0eb3257d12b67104da1bcc6d94d2d2971f6626"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "a07fc3fb6b73690e359d7205f067557d26df8687", "author": {"user": {"login": "underyx", "name": "Bence Nagy"}}, "url": "https://github.com/returntocorp/semgrep/commit/a07fc3fb6b73690e359d7205f067557d26df8687", "committedDate": "2020-05-05T19:09:35Z", "message": "tests: Pretty-print snapshot JSONs"}, "afterCommit": {"oid": "5f3fa0f749aee9ff209623a9260d028c4d815454", "author": {"user": {"login": "underyx", "name": "Bence Nagy"}}, "url": "https://github.com/returntocorp/semgrep/commit/5f3fa0f749aee9ff209623a9260d028c4d815454", "committedDate": "2020-05-06T09:31:51Z", "message": "fixup! tests: Pretty-print snapshot JSONs"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "bb8047f20e9834d09076e55790e91d88b72ebd25", "author": {"user": {"login": "underyx", "name": "Bence Nagy"}}, "url": "https://github.com/returntocorp/semgrep/commit/bb8047f20e9834d09076e55790e91d88b72ebd25", "committedDate": "2020-05-06T11:19:43Z", "message": "pre-commit: Don't run mypy on tests"}, "afterCommit": {"oid": "b1a82cb24a2b97e261198ab60ded9b4f13dc15ab", "author": {"user": {"login": "underyx", "name": "Bence Nagy"}}, "url": "https://github.com/returntocorp/semgrep/commit/b1a82cb24a2b97e261198ab60ded9b4f13dc15ab", "committedDate": "2020-05-06T11:22:24Z", "message": "pre-commit: Don't run mypy on tests"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "028f1e2b924fecdc12b0c3541f46bb454a7461b0", "author": {"user": {"login": "underyx", "name": "Bence Nagy"}}, "url": "https://github.com/returntocorp/semgrep/commit/028f1e2b924fecdc12b0c3541f46bb454a7461b0", "committedDate": "2020-05-06T12:36:01Z", "message": "tests: Specify python3 is to be used to run semgrep"}, "afterCommit": {"oid": "de2e8323f29bad39b3683ba0aa8a76997b1e47fe", "author": {"user": {"login": "underyx", "name": "Bence Nagy"}}, "url": "https://github.com/returntocorp/semgrep/commit/de2e8323f29bad39b3683ba0aa8a76997b1e47fe", "committedDate": "2020-05-06T12:45:37Z", "message": "tests: Specify python3 is to be used to run semgrep"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "527398aa20ba33b0cb2bc5a358d9641fdee31ac5", "author": {"user": {"login": "underyx", "name": "Bence Nagy"}}, "url": "https://github.com/returntocorp/semgrep/commit/527398aa20ba33b0cb2bc5a358d9641fdee31ac5", "committedDate": "2020-05-06T13:29:14Z", "message": "tests: Set up pytest to run semgrep and do snapshot testing"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "291fa449590fec5e10b3a849f91da7084b38b8f1", "author": {"user": {"login": "underyx", "name": "Bence Nagy"}}, "url": "https://github.com/returntocorp/semgrep/commit/291fa449590fec5e10b3a849f91da7084b38b8f1", "committedDate": "2020-05-06T13:37:42Z", "message": "tests: Refactor basic check tests to use pytest\n\nCloses https://github.com/returntocorp/semgrep/issues/626"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "149339e7f6db96fa79698c77792c0317c54fa6c2", "author": {"user": {"login": "underyx", "name": "Bence Nagy"}}, "url": "https://github.com/returntocorp/semgrep/commit/149339e7f6db96fa79698c77792c0317c54fa6c2", "committedDate": "2020-05-06T13:47:27Z", "message": "tests: Refactor hidden rulefile tests to use pytest"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "51f6eb11bd1cc9c0b1468e2fd6731f75fa116c9c", "author": {"user": {"login": "underyx", "name": "Bence Nagy"}}, "url": "https://github.com/returntocorp/semgrep/commit/51f6eb11bd1cc9c0b1468e2fd6731f75fa116c9c", "committedDate": "2020-05-06T13:55:27Z", "message": "tests: Refactor default config tests to use pytest"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "9ce42fd3167dbaf996d138c7adcbd76ca8048d10", "author": {"user": {"login": "underyx", "name": "Bence Nagy"}}, "url": "https://github.com/returntocorp/semgrep/commit/9ce42fd3167dbaf996d138c7adcbd76ca8048d10", "committedDate": "2020-05-06T13:58:02Z", "message": "tests: Refactor autofix & equivalence tests to use pytest\n\nPlaced these two in the same commit cause they're very similar in the\nnew testing architecture so it's a nice way to learn how these tests\nshould be written."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "2e5922df2c259d0fde8716c6a3aaf44289637cc5", "author": {"user": {"login": "underyx", "name": "Bence Nagy"}}, "url": "https://github.com/returntocorp/semgrep/commit/2e5922df2c259d0fde8716c6a3aaf44289637cc5", "committedDate": "2020-05-06T14:00:51Z", "message": "tests: Refactor include/exclude tests to use pytest"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "8a6837f5c15bfccc110a449a66dc799a98e60d37", "author": {"user": {"login": "underyx", "name": "Bence Nagy"}}, "url": "https://github.com/returntocorp/semgrep/commit/8a6837f5c15bfccc110a449a66dc799a98e60d37", "committedDate": "2020-05-06T14:47:09Z", "message": "tests: Refactor rule parsing tests to use pytest"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e313adb17bd8b6b0fb464efa2e2f83f764670a36", "author": {"user": {"login": "underyx", "name": "Bence Nagy"}}, "url": "https://github.com/returntocorp/semgrep/commit/e313adb17bd8b6b0fb464efa2e2f83f764670a36", "committedDate": "2020-05-06T14:48:49Z", "message": "tests: Refactor semgrep-rules regression testing to use pytest"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "de2e8323f29bad39b3683ba0aa8a76997b1e47fe", "author": {"user": {"login": "underyx", "name": "Bence Nagy"}}, "url": "https://github.com/returntocorp/semgrep/commit/de2e8323f29bad39b3683ba0aa8a76997b1e47fe", "committedDate": "2020-05-06T12:45:37Z", "message": "tests: Specify python3 is to be used to run semgrep"}, "afterCommit": {"oid": "a5dcf5ccd5506b46ad3918bcefcfa335c21983aa", "author": {"user": {"login": "underyx", "name": "Bence Nagy"}}, "url": "https://github.com/returntocorp/semgrep/commit/a5dcf5ccd5506b46ad3918bcefcfa335c21983aa", "committedDate": "2020-05-06T14:56:18Z", "message": "tests: Specify python3 is to be used to run semgrep"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b2b701d250419f6a2ec78e26c3e11265d8795ea1", "author": {"user": {"login": "underyx", "name": "Bence Nagy"}}, "url": "https://github.com/returntocorp/semgrep/commit/b2b701d250419f6a2ec78e26c3e11265d8795ea1", "committedDate": "2020-05-06T14:57:57Z", "message": "tests: Wipe resources used by old testing architecture"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "dee253bda3a862ed32ee409e718431e68040c91e", "author": {"user": {"login": "underyx", "name": "Bence Nagy"}}, "url": "https://github.com/returntocorp/semgrep/commit/dee253bda3a862ed32ee409e718431e68040c91e", "committedDate": "2020-05-06T14:57:57Z", "message": "Makefile: Add regenerate-tests target for semgrep"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "391762c77112f54cd0b9e26989d2c3960c1ec75e", "author": {"user": {"login": "underyx", "name": "Bence Nagy"}}, "url": "https://github.com/returntocorp/semgrep/commit/391762c77112f54cd0b9e26989d2c3960c1ec75e", "committedDate": "2020-05-06T14:57:57Z", "message": "Create unit tests directory for semgrep"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "a5dcf5ccd5506b46ad3918bcefcfa335c21983aa", "author": {"user": {"login": "underyx", "name": "Bence Nagy"}}, "url": "https://github.com/returntocorp/semgrep/commit/a5dcf5ccd5506b46ad3918bcefcfa335c21983aa", "committedDate": "2020-05-06T14:56:18Z", "message": "tests: Specify python3 is to be used to run semgrep"}, "afterCommit": {"oid": "6c40eaa732a7e9670b414cf12f5d9646af02c1ba", "author": {"user": {"login": "underyx", "name": "Bence Nagy"}}, "url": "https://github.com/returntocorp/semgrep/commit/6c40eaa732a7e9670b414cf12f5d9646af02c1ba", "committedDate": "2020-05-06T14:57:58Z", "message": "tests: Specify python3 is to be used to run semgrep"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "6c40eaa732a7e9670b414cf12f5d9646af02c1ba", "author": {"user": {"login": "underyx", "name": "Bence Nagy"}}, "url": "https://github.com/returntocorp/semgrep/commit/6c40eaa732a7e9670b414cf12f5d9646af02c1ba", "committedDate": "2020-05-06T14:57:58Z", "message": "tests: Specify python3 is to be used to run semgrep"}, "afterCommit": {"oid": "d11a59cff8ffbaf04909c734426eb10ab311ef61", "author": {"user": {"login": "underyx", "name": "Bence Nagy"}}, "url": "https://github.com/returntocorp/semgrep/commit/d11a59cff8ffbaf04909c734426eb10ab311ef61", "committedDate": "2020-05-06T15:01:52Z", "message": "tests: Specify python3 is to be used to run semgrep"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "38560a05b3005741a2bbfb3a680dc95ceb05bb89", "author": {"user": {"login": "underyx", "name": "Bence Nagy"}}, "url": "https://github.com/returntocorp/semgrep/commit/38560a05b3005741a2bbfb3a680dc95ceb05bb89", "committedDate": "2020-05-06T15:21:28Z", "message": "Add semgrep testing README"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "1896a923c4f624ef15118333994108f27e618b54", "author": {"user": {"login": "underyx", "name": "Bence Nagy"}}, "url": "https://github.com/returntocorp/semgrep/commit/1896a923c4f624ef15118333994108f27e618b54", "committedDate": "2020-05-06T15:21:42Z", "message": "tests; Rename run_semgrep to run_semgrep_in_tmp"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "d11a59cff8ffbaf04909c734426eb10ab311ef61", "author": {"user": {"login": "underyx", "name": "Bence Nagy"}}, "url": "https://github.com/returntocorp/semgrep/commit/d11a59cff8ffbaf04909c734426eb10ab311ef61", "committedDate": "2020-05-06T15:01:52Z", "message": "tests: Specify python3 is to be used to run semgrep"}, "afterCommit": {"oid": "9c504870b6e9a453bf1c6e6fbcf0bc6c181fa2bf", "author": {"user": {"login": "underyx", "name": "Bence Nagy"}}, "url": "https://github.com/returntocorp/semgrep/commit/9c504870b6e9a453bf1c6e6fbcf0bc6c181fa2bf", "committedDate": "2020-05-06T15:23:14Z", "message": "tests: Specify python3 is to be used to run semgrep"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e08684a6dd38cf409f987d6deed2bb3938e936db", "author": {"user": {"login": "underyx", "name": "Bence Nagy"}}, "url": "https://github.com/returntocorp/semgrep/commit/e08684a6dd38cf409f987d6deed2bb3938e936db", "committedDate": "2020-05-06T15:28:42Z", "message": "tests: Pretty-print snapshot JSONs"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "9a0aa109a1d5038036ee3f074306f57a5903117d", "author": {"user": {"login": "underyx", "name": "Bence Nagy"}}, "url": "https://github.com/returntocorp/semgrep/commit/9a0aa109a1d5038036ee3f074306f57a5903117d", "committedDate": "2020-05-06T15:28:42Z", "message": "pre-commit: Don't run mypy on tests"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "db343e2ac18f48e4388bf394d1838eeb24f8fda3", "author": {"user": {"login": "underyx", "name": "Bence Nagy"}}, "url": "https://github.com/returntocorp/semgrep/commit/db343e2ac18f48e4388bf394d1838eeb24f8fda3", "committedDate": "2020-05-06T15:28:42Z", "message": "Clean up leftover test files"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ae94329827a6eab529c4023d1711e08e364426a7", "author": {"user": {"login": "underyx", "name": "Bence Nagy"}}, "url": "https://github.com/returntocorp/semgrep/commit/ae94329827a6eab529c4023d1711e08e364426a7", "committedDate": "2020-05-06T15:28:42Z", "message": "tox.ini: Fix testing for 3.7 and 3.8"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "6b1f4a40a640d5465bd4d05351aff5316e016423", "author": {"user": {"login": "underyx", "name": "Bence Nagy"}}, "url": "https://github.com/returntocorp/semgrep/commit/6b1f4a40a640d5465bd4d05351aff5316e016423", "committedDate": "2020-05-06T15:28:43Z", "message": "Update tox.ini to work with new tests"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "61524dc8cae75ffa3266a62e413a85e77a9bbc76", "author": {"user": {"login": "underyx", "name": "Bence Nagy"}}, "url": "https://github.com/returntocorp/semgrep/commit/61524dc8cae75ffa3266a62e413a85e77a9bbc76", "committedDate": "2020-05-06T15:28:43Z", "message": "tests: Specify python3 is to be used to run semgrep"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "9c504870b6e9a453bf1c6e6fbcf0bc6c181fa2bf", "author": {"user": {"login": "underyx", "name": "Bence Nagy"}}, "url": "https://github.com/returntocorp/semgrep/commit/9c504870b6e9a453bf1c6e6fbcf0bc6c181fa2bf", "committedDate": "2020-05-06T15:23:14Z", "message": "tests: Specify python3 is to be used to run semgrep"}, "afterCommit": {"oid": "61524dc8cae75ffa3266a62e413a85e77a9bbc76", "author": {"user": {"login": "underyx", "name": "Bence Nagy"}}, "url": "https://github.com/returntocorp/semgrep/commit/61524dc8cae75ffa3266a62e413a85e77a9bbc76", "committedDate": "2020-05-06T15:28:43Z", "message": "tests: Specify python3 is to be used to run semgrep"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "8c750933e36619bfd5e10bd1f2282f08aceff1a5", "author": {"user": {"login": "underyx", "name": "Bence Nagy"}}, "url": "https://github.com/returntocorp/semgrep/commit/8c750933e36619bfd5e10bd1f2282f08aceff1a5", "committedDate": "2020-05-06T16:12:53Z", "message": "tests: Fix test_public_repos not scanning Python code\n\nPassing --language python --language javascript apparently made semgrep\nscan only javascript.\n\nThis commit changes it so we run semgrep twice for each repo,\nonce with both languages. Also added more assertions regarding output."}}]}}}, "rateLimit": {"limit": 5000, "remaining": 941, "cost": 1, "resetAt": "2021-11-01T16:37:27Z"}}}