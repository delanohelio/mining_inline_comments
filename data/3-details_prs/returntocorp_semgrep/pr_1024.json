{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDM0Nzc0OTU1", "number": 1024, "title": "Add tqdm", "bodyText": "Closes #943.", "createdAt": "2020-06-15T20:39:00Z", "url": "https://github.com/returntocorp/semgrep/pull/1024", "merged": true, "mergeCommit": {"oid": "1fa8e1bf6899366dd9a741a0b8918ec62c659411"}, "closed": true, "closedAt": "2020-06-16T19:04:11Z", "author": {"login": "minusworld"}, "timelineItems": {"totalCount": 18, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcqtygqAH2gAyNDM0Nzc0OTU1OjdhMWZlMDNkNWRmNjRiMDcyNzI1YTY0ZTJlMWYyNGU2NTg0MzdhNTc=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcr52y-AFqTQzMTc5OTA5Mg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "7a1fe03d5df64b072725a64e2e1f24e658437a57", "author": {"user": {"login": "brendongo", "name": "Brendon Go"}}, "url": "https://github.com/returntocorp/semgrep/commit/7a1fe03d5df64b072725a64e2e1f24e658437a57", "committedDate": "2020-06-13T02:11:48Z", "message": "core_runner: pass targets using -target_file instead of as list\n\nPassing as a list to subprocess will potentially hit command line\ncharacter limits. This bypasses the limit by using semgrep-core's\ntarget_file option."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "2773340c769910bfba4d432df20851819170b99c", "author": {"user": {"login": "brendongo", "name": "Brendon Go"}}, "url": "https://github.com/returntocorp/semgrep/commit/2773340c769910bfba4d432df20851819170b99c", "committedDate": "2020-06-15T18:00:52Z", "message": "fixup! core_runner: pass targets using -target_file instead of as list"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "fb9ebedd65b184976148e5a97dc5fb35918dc682", "author": {"user": {"login": "brendongo", "name": "Brendon Go"}}, "url": "https://github.com/returntocorp/semgrep/commit/fb9ebedd65b184976148e5a97dc5fb35918dc682", "committedDate": "2020-06-15T18:46:18Z", "message": "fixup! core_runner: pass targets using -target_file instead of as list"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "1cfd8e48c0b75fabd1c56dff052365af4273ed22", "author": {"user": {"login": "minusworld", "name": "Grayson H"}}, "url": "https://github.com/returntocorp/semgrep/commit/1cfd8e48c0b75fabd1c56dff052365af4273ed22", "committedDate": "2020-06-15T19:32:41Z", "message": "Merge branch 'brendon/usetargetfile' of https://github.com/returntocorp/semgrep into progress-indicator"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "946309201eb108e2ea2954dfdc22aa34a89b3065", "author": {"user": {"login": "minusworld", "name": "Grayson H"}}, "url": "https://github.com/returntocorp/semgrep/commit/946309201eb108e2ea2954dfdc22aa34a89b3065", "committedDate": "2020-06-15T20:37:27Z", "message": "Add tqdm to indicate that semgrep is running. tqdm progress bar uses rules as its basis. With verbose flag, semgrep will now also print which rule is running."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "0c67ae0236aa657bd9d86f732b57daeb1f99dd7e", "author": {"user": {"login": "minusworld", "name": "Grayson H"}}, "url": "https://github.com/returntocorp/semgrep/commit/0c67ae0236aa657bd9d86f732b57daeb1f99dd7e", "committedDate": "2020-06-15T20:40:50Z", "message": "Merge with develop branch. Remove debug print showing semgrep command."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f7ae13a5677fcbdb58d4d1a8c5be7918a9326fee", "author": {"user": {"login": "minusworld", "name": "Grayson H"}}, "url": "https://github.com/returntocorp/semgrep/commit/f7ae13a5677fcbdb58d4d1a8c5be7918a9326fee", "committedDate": "2020-06-15T20:41:51Z", "message": "Update snapshots"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "71b55c7ba40537df42df44f45a6b7fd095704230", "author": {"user": {"login": "minusworld", "name": "Grayson H"}}, "url": "https://github.com/returntocorp/semgrep/commit/71b55c7ba40537df42df44f45a6b7fd095704230", "committedDate": "2020-06-15T20:55:14Z", "message": "Change bar format to not include iterations/cycle."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "6d2c731c6efd5db5b6200420dd6f50e31e139c9b", "author": {"user": {"login": "minusworld", "name": "Grayson H"}}, "url": "https://github.com/returntocorp/semgrep/commit/6d2c731c6efd5db5b6200420dd6f50e31e139c9b", "committedDate": "2020-06-15T20:55:27Z", "message": "Update snapshots"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "d3c474ccd14a9af0fc5397058f593a1c2cf112f4", "author": {"user": {"login": "minusworld", "name": "Grayson H"}}, "url": "https://github.com/returntocorp/semgrep/commit/d3c474ccd14a9af0fc5397058f593a1c2cf112f4", "committedDate": "2020-06-15T21:29:28Z", "message": "Add tqdm to setup.py to enable Docker build"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ee7896d1ed2ba263bdfa0452de5fb034d4a39047", "author": {"user": {"login": "minusworld", "name": "Grayson H"}}, "url": "https://github.com/returntocorp/semgrep/commit/ee7896d1ed2ba263bdfa0452de5fb034d4a39047", "committedDate": "2020-06-15T21:48:05Z", "message": "Added a wrapper function which will check to see if the output stream for tqdm is a tty. If so, returns the iterable wrapped with tqdm, otherwise returns the regular iterable. Regenerated tests with this update."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "aa02a7e224ab7ae49f1207b1a0a4a508f74a8088", "author": {"user": {"login": "minusworld", "name": "Grayson H"}}, "url": "https://github.com/returntocorp/semgrep/commit/aa02a7e224ab7ae49f1207b1a0a4a508f74a8088", "committedDate": "2020-06-16T00:34:39Z", "message": "Merge branch 'develop' into add-tqdm"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "524dedcfc4a230d8f5d2a8f282fdc78a62924038", "author": {"user": {"login": "minusworld", "name": "Grayson H"}}, "url": "https://github.com/returntocorp/semgrep/commit/524dedcfc4a230d8f5d2a8f282fdc78a62924038", "committedDate": "2020-06-16T11:25:09Z", "message": "Black formatting'"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDMxMTAxMjkx", "url": "https://github.com/returntocorp/semgrep/pull/1024#pullrequestreview-431101291", "createdAt": "2020-06-16T01:38:55Z", "commit": {"oid": "aa02a7e224ab7ae49f1207b1a0a4a508f74a8088"}, "state": "COMMENTED", "comments": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xNlQwMTozODo1NVrOGkIRPw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xNlQwMTo0MTozMlrOGkIT9A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MDUzNzQwNw==", "bodyText": "having it in setup.py is sufficient, you can remove this", "url": "https://github.com/returntocorp/semgrep/pull/1024#discussion_r440537407", "createdAt": "2020-06-16T01:38:55Z", "author": {"login": "rcoh"}, "path": "semgrep/Pipfile", "diffHunk": "@@ -13,6 +13,7 @@ appdirs = \"*\"\n \n [packages]\n semgrep = {editable = true,path = \".\"}\n+tqdm = \"*\"", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "aa02a7e224ab7ae49f1207b1a0a4a508f74a8088"}, "originalPosition": 4}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MDUzNzY4Ng==", "bodyText": "might as well put this in util", "url": "https://github.com/returntocorp/semgrep/pull/1024#discussion_r440537686", "createdAt": "2020-06-16T01:40:01Z", "author": {"login": "rcoh"}, "path": "semgrep/semgrep/core_runner.py", "diffHunk": "@@ -35,6 +37,16 @@\n from semgrep.util import partition\n \n \n+def _progress_bar(iterable: List[Rule], file: IO = sys.stderr, **kwargs: Any) -> Any:", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "aa02a7e224ab7ae49f1207b1a0a4a508f74a8088"}, "originalPosition": 20}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MDUzNzkxNg==", "bodyText": "Also, it isn't iterable[Rule], since this is generally useful it can be Iterable[T]. It should also return Iterable[T]", "url": "https://github.com/returntocorp/semgrep/pull/1024#discussion_r440537916", "createdAt": "2020-06-16T01:40:51Z", "author": {"login": "rcoh"}, "path": "semgrep/semgrep/core_runner.py", "diffHunk": "@@ -35,6 +37,16 @@\n from semgrep.util import partition\n \n \n+def _progress_bar(iterable: List[Rule], file: IO = sys.stderr, **kwargs: Any) -> Any:", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MDUzNzY4Ng=="}, "originalCommit": {"oid": "aa02a7e224ab7ae49f1207b1a0a4a508f74a8088"}, "originalPosition": 20}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MDUzODEwMA==", "bodyText": "we shouldn't print while the progress bar is running, it will cause the progress bar output to be corrupted. I want tqdm.write I think?", "url": "https://github.com/returntocorp/semgrep/pull/1024#discussion_r440538100", "createdAt": "2020-06-16T01:41:32Z", "author": {"login": "rcoh"}, "path": "semgrep/semgrep/core_runner.py", "diffHunk": "@@ -327,8 +338,10 @@ def _run_rules(\n         debugging_steps_by_rule: Dict[Rule, List[Dict[str, Any]]] = {}\n         all_errors = []\n \n+        # cf. for bar_format: https://tqdm.github.io/docs/tqdm/\n         with tempfile.TemporaryDirectory() as semgrep_core_ast_cache_dir:\n-            for rule in rules:\n+            for rule in _progress_bar(rules, bar_format=\"{l_bar}{bar}|{n_fmt}/{total_fmt}\"):\n+                debug_print(f\"Running rule {rule._raw.get('id')}\")", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "aa02a7e224ab7ae49f1207b1a0a4a508f74a8088"}, "originalPosition": 49}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "8f62dfa0803f7ad406c29b129569efefb5e2dfca", "author": {"user": {"login": "minusworld", "name": "Grayson H"}}, "url": "https://github.com/returntocorp/semgrep/commit/8f62dfa0803f7ad406c29b129569efefb5e2dfca", "committedDate": "2020-06-16T17:17:59Z", "message": "Address PR comments; Remove tqdm from Pipfile"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "50c3c4568bcbf2f08cf669cd91a30d3a1dbca176", "author": {"user": {"login": "minusworld", "name": "Grayson H"}}, "url": "https://github.com/returntocorp/semgrep/commit/50c3c4568bcbf2f08cf669cd91a30d3a1dbca176", "committedDate": "2020-06-16T17:38:17Z", "message": "Address PR comments; move progress bar func to util. Use generic type hints"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "5d6176b0941d5b1fb6e32166e472e71d0b993723", "author": {"user": {"login": "minusworld", "name": "Grayson H"}}, "url": "https://github.com/returntocorp/semgrep/commit/5d6176b0941d5b1fb6e32166e472e71d0b993723", "committedDate": "2020-06-16T17:44:54Z", "message": "Remove unused imports"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDMxNzk5MDky", "url": "https://github.com/returntocorp/semgrep/pull/1024#pullrequestreview-431799092", "createdAt": "2020-06-16T18:49:16Z", "commit": {"oid": "5d6176b0941d5b1fb6e32166e472e71d0b993723"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1555, "cost": 1, "resetAt": "2021-11-01T16:37:27Z"}}}