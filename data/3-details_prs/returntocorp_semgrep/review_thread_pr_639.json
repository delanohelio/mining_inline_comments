{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDEyMDI4MTAy", "number": 639, "reviewThreads": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wMVQwODoyNDoxOVrOD4ULZA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wMVQwODoyNDoxOVrOD4ULZA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjYwMzc3NDQ0OnYy", "diffSide": "RIGHT", "path": "semgrep/semgrep/config_resolver.py", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wMVQwODoyNDoxOVrOGPEvzA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wMVQxOTowOToxNVrOGPS7HQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxODQ1OTU5Ng==", "bodyText": "Is this suffix useful? Maybe we don't need to keep the b64 line, cause the directory name will still have a random component anyway:\nIn [2]: tempfile.TemporaryDirectory().name\nOut[2]: '/var/folders/vp/mgl7xf9142x8wd081g9zrh2c0000gn/T/tmpxrtfnvmn'\n\nIn [3]: tempfile.TemporaryDirectory(suffix=\"arst\").name\nOut[3]: '/var/folders/vp/mgl7xf9142x8wd081g9zrh2c0000gn/T/tmpdu1cx064arst'\n\nIn [4]: tempfile.TemporaryDirectory(prefix=\"arst\").name\nOut[4]: '/var/folders/vp/mgl7xf9142x8wd081g9zrh2c0000gn/T/arstwg4yijot'\n\nIn [5]: tempfile.TemporaryDirectory(prefix=\"arst\", suffix=\"qwfp\").name\nOut[5]: '/var/folders/vp/mgl7xf9142x8wd081g9zrh2c0000gn/T/arstna4_ex81qwfp'", "url": "https://github.com/returntocorp/semgrep/pull/639#discussion_r418459596", "createdAt": "2020-05-01T08:24:19Z", "author": {"login": "underyx"}, "path": "semgrep/semgrep/config_resolver.py", "diffHunk": "@@ -182,14 +183,14 @@ def download_config(config_url: str) -> Dict[str, Optional[Dict[str, Any]]]:\n             if content_type and \"text/plain\" in content_type:\n                 return parse_config_string(\"remote-url\", r.content.decode(\"utf-8\"))\n             elif content_type and content_type == \"application/x-gzip\":\n-                fname = f\"/tmp/{base64.b64encode(config_url.encode()).decode()}\"\n-                shutil.rmtree(fname, ignore_errors=True)\n-                with tarfile.open(fileobj=r.raw, mode=\"r:gz\") as tar:\n-                    tar.extractall(fname)\n-                extracted = Path(fname)\n-                for path in extracted.iterdir():\n-                    # get first folder in extracted folder (this is how GH does it)\n-                    return parse_config_folder(path, relative=True)\n+                directory_name = base64.b64encode(config_url.encode()).decode()\n+                with tempfile.TemporaryDirectory(suffix=directory_name) as fname:", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "bad88e58a26d287efa4e7a4b2274b5e4531c940f"}, "originalPosition": 21}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxODY5MTg2OQ==", "bodyText": "Good call @underyx , addressed that", "url": "https://github.com/returntocorp/semgrep/pull/639#discussion_r418691869", "createdAt": "2020-05-01T19:09:15Z", "author": {"login": "ievans"}, "path": "semgrep/semgrep/config_resolver.py", "diffHunk": "@@ -182,14 +183,14 @@ def download_config(config_url: str) -> Dict[str, Optional[Dict[str, Any]]]:\n             if content_type and \"text/plain\" in content_type:\n                 return parse_config_string(\"remote-url\", r.content.decode(\"utf-8\"))\n             elif content_type and content_type == \"application/x-gzip\":\n-                fname = f\"/tmp/{base64.b64encode(config_url.encode()).decode()}\"\n-                shutil.rmtree(fname, ignore_errors=True)\n-                with tarfile.open(fileobj=r.raw, mode=\"r:gz\") as tar:\n-                    tar.extractall(fname)\n-                extracted = Path(fname)\n-                for path in extracted.iterdir():\n-                    # get first folder in extracted folder (this is how GH does it)\n-                    return parse_config_folder(path, relative=True)\n+                directory_name = base64.b64encode(config_url.encode()).decode()\n+                with tempfile.TemporaryDirectory(suffix=directory_name) as fname:", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxODQ1OTU5Ng=="}, "originalCommit": {"oid": "bad88e58a26d287efa4e7a4b2274b5e4531c940f"}, "originalPosition": 21}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4787, "cost": 1, "resetAt": "2021-11-13T12:26:42Z"}}}