{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0MzgxMDk5ODM5", "number": 221, "title": "refactor sgrep py", "bodyText": "What's this? Separate files for the python core!\nAlso, Docker now builds sgrep.py into a single, portable binary named sgrep-lint\nThe dockerfile is also almost half the size:\nsgrep-refactored                          53.9MB \nreturntocorp/sgrep:develop       82.8MB\n\nAnd it's significantly faster (note that the majority of the runtime here is sgrep core, so the savings are significant):\nine@imbp4 ~/D/r/sgrep-rules (feature/prototype-go-rules)> hyperfine -m 20 --warmup 2 'docker run --rm -v $(pwd):/home/repo sgrep-local:latest --config=. python/'\nBenchmark #1: docker run --rm -v $(pwd):/home/repo sgrep-local:latest --config=. python/\n  Time (mean \u00b1 \u03c3):     **10.426 s \u00b1  0.312 s**    [User: 26.8 ms, System: 13.5 ms]\n  Range (min \u2026 max):    9.857 s \u2026 10.960 s    20 runs\n\nine@imbp4 ~/D/r/sgrep-rules (feature/prototype-go-rules)> hyperfine -m 20 --warmup 2 'docker run --rm -v $(pwd):/home/repo returntocorp/sgrep:develop --config=. python/'\nBenchmark #1: docker run --rm -v $(pwd):/home/repo returntocorp/sgrep:develop --config=. python/\n  Time (mean \u00b1 \u03c3):     **10.814 s \u00b1  0.241 s**    [User: 26.9 ms, System: 13.5 ms]\n  Range (min \u2026 max):   10.277 s \u2026 11.351 s    20 runs\n\nFollowons:\n\nsgrep -> sgrep-core, sgrep-lint -> sgrep\nmove test.py functionality into sgrep.py", "createdAt": "2020-02-27T22:13:03Z", "url": "https://github.com/returntocorp/semgrep/pull/221", "merged": true, "mergeCommit": {"oid": "bc39236b35c99eea436228189eff5f4097266abd"}, "closed": true, "closedAt": "2020-03-02T22:52:53Z", "author": {"login": "ievans"}, "timelineItems": {"totalCount": 26, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcIhOn7gH2gAyMzgxMDk5ODM5OmU3YWFkYTlmZGE4MTEwYWUwMzIxZmRiMzA5MTkzN2ExNWRmMzU4Nzk=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcJ1oaxgH2gAyMzgxMDk5ODM5OmMzOWY4NzJlNWVkNWU5NmVjYjY2NzhiNDk2OWQ1ZGVhN2IwYWI5NzM=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "e7aada9fda8110ae0321fdb3091937a15df35879", "author": {"user": {"login": "ievans", "name": "Isaac Evans"}}, "url": "https://github.com/returntocorp/semgrep/commit/e7aada9fda8110ae0321fdb3091937a15df35879", "committedDate": "2020-02-27T20:20:19Z", "message": "refactor sgrep.py"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "668d01ab7128a136a954a07f35373c9546efd2e7", "author": {"user": {"login": "ievans", "name": "Isaac Evans"}}, "url": "https://github.com/returntocorp/semgrep/commit/668d01ab7128a136a954a07f35373c9546efd2e7", "committedDate": "2020-02-27T20:23:45Z", "message": "new sgrep location"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "5ed9cf206329e8cb7666625a36c57c2a8f72ded5", "author": {"user": {"login": "ievans", "name": "Isaac Evans"}}, "url": "https://github.com/returntocorp/semgrep/commit/5ed9cf206329e8cb7666625a36c57c2a8f72ded5", "committedDate": "2020-02-27T22:12:31Z", "message": "black"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "94de97df067a4842216bbd151b56a34c8b05a49f", "author": {"user": {"login": "ievans", "name": "Isaac Evans"}}, "url": "https://github.com/returntocorp/semgrep/commit/94de97df067a4842216bbd151b56a34c8b05a49f", "committedDate": "2020-02-27T22:45:01Z", "message": "standalone docker image, but breaks tests"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "0ad101c481c15b9ca756ac2009fda7359c83e094", "author": {"user": {"login": "ievans", "name": "Isaac Evans"}}, "url": "https://github.com/returntocorp/semgrep/commit/0ad101c481c15b9ca756ac2009fda7359c83e094", "committedDate": "2020-02-27T22:57:18Z", "message": "tests in non-module format"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "2c4beedef1e0751abc752dc8ba828bcec2c90e7c", "author": {"user": {"login": "ievans", "name": "Isaac Evans"}}, "url": "https://github.com/returntocorp/semgrep/commit/2c4beedef1e0751abc752dc8ba828bcec2c90e7c", "committedDate": "2020-02-27T22:59:19Z", "message": "tests in non-module format"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "309e07588691577a75903d6036bf7725246f4bb8", "author": {"user": {"login": "ievans", "name": "Isaac Evans"}}, "url": "https://github.com/returntocorp/semgrep/commit/309e07588691577a75903d6036bf7725246f4bb8", "committedDate": "2020-02-27T23:21:38Z", "message": "building now"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "3b7cee3a4c509ed1db8354a1449bc8f8ee31dc2d", "author": {"user": {"login": "ievans", "name": "Isaac Evans"}}, "url": "https://github.com/returntocorp/semgrep/commit/3b7cee3a4c509ed1db8354a1449bc8f8ee31dc2d", "committedDate": "2020-02-27T23:23:05Z", "message": "python workflow not relevant"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f7d089533e5882b9680dcbb5ea81faeaba5af93b", "author": {"user": {"login": "ievans", "name": "Isaac Evans"}}, "url": "https://github.com/returntocorp/semgrep/commit/f7d089533e5882b9680dcbb5ea81faeaba5af93b", "committedDate": "2020-02-27T23:26:26Z", "message": "no more requirements installation"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "5aa77383da5c75b6b27d950fd40505dc05265bf5", "author": {"user": {"login": "ievans", "name": "Isaac Evans"}}, "url": "https://github.com/returntocorp/semgrep/commit/5aa77383da5c75b6b27d950fd40505dc05265bf5", "committedDate": "2020-02-28T00:11:47Z", "message": "dependencies"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "87527438d161bde6ffbd7a8253ab2bcd7eef14c0", "author": {"user": {"login": "ievans", "name": "Isaac Evans"}}, "url": "https://github.com/returntocorp/semgrep/commit/87527438d161bde6ffbd7a8253ab2bcd7eef14c0", "committedDate": "2020-02-28T00:13:14Z", "message": "correct yaml"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "43fc343a7b2300746cc40cefcbc3f534e21cbc8a", "author": {"user": {"login": "ievans", "name": "Isaac Evans"}}, "url": "https://github.com/returntocorp/semgrep/commit/43fc343a7b2300746cc40cefcbc3f534e21cbc8a", "committedDate": "2020-02-28T00:39:47Z", "message": "remove init - not a module"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "63ffb97ae30394ce7eb1d0959c5ffbc28e6fe3b2", "author": {"user": {"login": "ievans", "name": "Isaac Evans"}}, "url": "https://github.com/returntocorp/semgrep/commit/63ffb97ae30394ce7eb1d0959c5ffbc28e6fe3b2", "committedDate": "2020-02-28T01:15:42Z", "message": "try build on CI"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "cc6a7d93ba2ce23c35d50a6d8ed84f86f4878ab2", "author": {"user": {"login": "ievans", "name": "Isaac Evans"}}, "url": "https://github.com/returntocorp/semgrep/commit/cc6a7d93ba2ce23c35d50a6d8ed84f86f4878ab2", "committedDate": "2020-02-28T01:15:54Z", "message": "try build on CI"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "9c829ee3b7fee7082c614e184f82bf394eb4d358", "author": {"user": {"login": "ievans", "name": "Isaac Evans"}}, "url": "https://github.com/returntocorp/semgrep/commit/9c829ee3b7fee7082c614e184f82bf394eb4d358", "committedDate": "2020-02-28T01:25:48Z", "message": "EOF fixer breaks tests, disabling"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e85e222f175f56d619ae9329a8198dae93cb4d30", "author": {"user": {"login": "ievans", "name": "Isaac Evans"}}, "url": "https://github.com/returntocorp/semgrep/commit/e85e222f175f56d619ae9329a8198dae93cb4d30", "committedDate": "2020-02-28T01:34:10Z", "message": "fix sgrep-lint tests"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "7efe496ae25214214b1e16da20e6f484e0967741", "author": {"user": {"login": "ievans", "name": "Isaac Evans"}}, "url": "https://github.com/returntocorp/semgrep/commit/7efe496ae25214214b1e16da20e6f484e0967741", "committedDate": "2020-02-28T01:42:13Z", "message": "add pytest dep"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e00d3709b403fca6510849288bcee1ed265c3e72", "author": {"user": {"login": "DrewDennison", "name": "Drew Dennison"}}, "url": "https://github.com/returntocorp/semgrep/commit/e00d3709b403fca6510849288bcee1ed265c3e72", "committedDate": "2020-02-28T03:30:25Z", "message": "fix pre-commit"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzY2MTQ0NzQ5", "url": "https://github.com/returntocorp/semgrep/pull/221#pullrequestreview-366144749", "createdAt": "2020-02-28T03:39:37Z", "commit": {"oid": "e00d3709b403fca6510849288bcee1ed265c3e72"}, "state": "COMMENTED", "comments": {"totalCount": 5, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yOFQwMzozOTozN1rOFvoqkw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yOFQwMzo0MTozNlrOFvor6w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NTQ5MzY1MQ==", "bodyText": "this should be a tag so Circle can cache it but I want to replace this with a GH action next week as part of the mac build so ok for now", "url": "https://github.com/returntocorp/semgrep/pull/221#discussion_r385493651", "createdAt": "2020-02-28T03:39:37Z", "author": {"login": "DrewDennison"}, "path": ".circleci/config.yml", "diffHunk": "@@ -3,14 +3,13 @@ version: 2.1\n executors:\n   sgrep-build:\n     docker:\n-      - image: returntocorp/sgrep-build:2.5\n+      - image: returntocorp/sgrep-build:latest", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "e00d3709b403fca6510849288bcee1ed265c3e72"}, "originalPosition": 5}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NTQ5Mzc0NA==", "bodyText": "I assume you use something other than pytest so ok with deleting", "url": "https://github.com/returntocorp/semgrep/pull/221#discussion_r385493744", "createdAt": "2020-02-28T03:40:19Z", "author": {"login": "DrewDennison"}, "path": ".github/workflows/python.yml", "diffHunk": "@@ -1,29 +0,0 @@\n-name: python\n-\n-on:\n-  pull_request:\n-  push:\n-    branches: [master, develop]\n-\n-jobs:\n-  build:\n-    runs-on: ubuntu-latest\n-    strategy:\n-      matrix:\n-        python-version: [3.7, 3.8]\n-    steps:\n-    - uses: actions/checkout@v2\n-    - name: Set up Python ${{ matrix.python-version }}\n-      uses: actions/setup-python@v1\n-      with:\n-        python-version: ${{ matrix.python-version }}\n-    - name: Install dependencies\n-      run: |\n-        python -m pip install --upgrade pip\n-        pip install -r requirements.txt\n-    - name: Test with pytest\n-      run: |\n-        # add to PYTHONPATH so imports work in test files\n-        export PYTHONPATH=\"${PYTHONPATH}:${pwd}\"\n-        pip install pytest\n-        pytest", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "e00d3709b403fca6510849288bcee1ed265c3e72"}, "originalPosition": 29}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NTQ5Mzg2OQ==", "bodyText": "why? \ud83d\ude1e", "url": "https://github.com/returntocorp/semgrep/pull/221#discussion_r385493869", "createdAt": "2020-02-28T03:40:53Z", "author": {"login": "DrewDennison"}, "path": ".pre-commit-config.yaml", "diffHunk": "@@ -1,12 +1,11 @@\n-exclude: \"^tests|testlint|old|lib|demos|bin|.*\\\\.ml\"\n+exclude: \"^sgrep-lint/tests|tests|testlint|old|lib|demos|bin|.*\\\\.ml\"\n \n repos:\n   - repo: https://github.com/pre-commit/pre-commit-hooks\n     rev: v2.5.0\n     hooks:\n       - id: check-yaml\n         args: [--allow-multiple-documents]\n-      - id: end-of-file-fixer", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "e00d3709b403fca6510849288bcee1ed265c3e72"}, "originalPosition": 10}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NTQ5Mzk0MA==", "bodyText": "I thought we believed in types \ud83d\ude22 Would you be ok if I added in the types to keep this check", "url": "https://github.com/returntocorp/semgrep/pull/221#discussion_r385493940", "createdAt": "2020-02-28T03:41:23Z", "author": {"login": "DrewDennison"}, "path": ".pre-commit-config.yaml", "diffHunk": "@@ -26,17 +25,6 @@ repos:\n     hooks:\n       - id: reorder-python-imports\n \n-  - repo: https://github.com/pre-commit/mirrors-mypy\n-    rev: \"v0.761\"\n-    hooks:\n-      - id: mypy", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "e00d3709b403fca6510849288bcee1ed265c3e72"}, "originalPosition": 21}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NTQ5Mzk5NQ==", "bodyText": "I have used this config multiple times to catch bugs", "url": "https://github.com/returntocorp/semgrep/pull/221#discussion_r385493995", "createdAt": "2020-02-28T03:41:36Z", "author": {"login": "DrewDennison"}, "path": ".pre-commit-config.yaml", "diffHunk": "@@ -26,17 +25,6 @@ repos:\n     hooks:\n       - id: reorder-python-imports\n \n-  - repo: https://github.com/pre-commit/mirrors-mypy\n-    rev: \"v0.761\"\n-    hooks:\n-      - id: mypy\n-\n-  - repo: https://gitlab.com/pycqa/flake8\n-    rev: \"3.7.9\"\n-    hooks:\n-      - id: flake8\n-        args: [\"--select=E9,F63,F7,F82\"]", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "e00d3709b403fca6510849288bcee1ed265c3e72"}, "originalPosition": 27}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "187a5c5d01502f87eb96e4a44d83a26953359a98", "author": {"user": {"login": "ievans", "name": "Isaac Evans"}}, "url": "https://github.com/returntocorp/semgrep/commit/187a5c5d01502f87eb96e4a44d83a26953359a98", "committedDate": "2020-02-28T06:33:24Z", "message": "docker subtleties"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "d6753bb47b2c0880c27cd7db780db474da1cb8d5", "author": {"user": {"login": "ievans", "name": "Isaac Evans"}}, "url": "https://github.com/returntocorp/semgrep/commit/d6753bb47b2c0880c27cd7db780db474da1cb8d5", "committedDate": "2020-02-28T06:35:57Z", "message": "precommit"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ab169c90d345c1467b8ab04be4328083f5c82835", "author": {"user": {"login": "ievans", "name": "Isaac Evans"}}, "url": "https://github.com/returntocorp/semgrep/commit/ab169c90d345c1467b8ab04be4328083f5c82835", "committedDate": "2020-02-28T08:04:25Z", "message": "enable LTO"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "0395a9400baef11d4ddfbe2b9d3b6e3da771a0ed", "author": {"user": {"login": "ievans", "name": "Isaac Evans"}}, "url": "https://github.com/returntocorp/semgrep/commit/0395a9400baef11d4ddfbe2b9d3b6e3da771a0ed", "committedDate": "2020-02-28T08:20:16Z", "message": "make mypy shut up again"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "403cdeb94df787063a14f881a06c6f224a801de7", "author": {"user": {"login": "ievans", "name": "Isaac Evans"}}, "url": "https://github.com/returntocorp/semgrep/commit/403cdeb94df787063a14f881a06c6f224a801de7", "committedDate": "2020-02-28T08:20:51Z", "message": "switch to tag"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzY3NTgxMDI1", "url": "https://github.com/returntocorp/semgrep/pull/221#pullrequestreview-367581025", "createdAt": "2020-03-02T22:36:51Z", "commit": {"oid": "403cdeb94df787063a14f881a06c6f224a801de7"}, "state": "APPROVED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wMlQyMjozNjo1MlrOFwx5MQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wMlQyMjozNjo1MlrOFwx5MQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NjY5MzQyNQ==", "bodyText": "\ud83d\udde1", "url": "https://github.com/returntocorp/semgrep/pull/221#discussion_r386693425", "createdAt": "2020-03-02T22:36:52Z", "author": {"login": "DrewDennison"}, "path": "sgrep_lint/constants.py", "diffHunk": "@@ -0,0 +1 @@\n+RCE_RULE_FLAG = \"--dangerously-allow-arbitrary-code-execution-from-rules\"", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "403cdeb94df787063a14f881a06c6f224a801de7"}, "originalPosition": 1}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c39f872e5ed5e96ecb6678b4969d5dea7b0ab973", "author": {"user": {"login": "ievans", "name": "Isaac Evans"}}, "url": "https://github.com/returntocorp/semgrep/commit/c39f872e5ed5e96ecb6678b4969d5dea7b0ab973", "committedDate": "2020-03-02T22:40:31Z", "message": "cleanup imports, move config resolution to separate file (#222)\n\n* cleanup imports, move config resolution to separate file\r\n\r\n* config resolver tests\r\n\r\n* add more tests"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1138, "cost": 1, "resetAt": "2021-11-01T16:37:27Z"}}}