{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDMxNDkxMjk4", "number": 946, "title": "target_manager: handle all file filtering in python instead of ocaml", "bodyText": "This PR adds logic in python to manage which files to run semgrep rules on.\n\nRespects per rule file ignores and only runs semgrep-core on necessary files instead of post-filtering\nRegex and semgrep-core rules share logic on what files to run on\nCode in semgrep-core that handles file include/exclude was not removed\nAdds support for respecting gitignore (for now turned off. we can turn on and add a flag in a follow up PR)\nAllows cli include/exclude behavior to mimic rule path config style so we don't have two separate include/exclude syntaxes but will expose the cli changes in a follow up PR\npassing list of files to semgrep-core as a file will also do in a follow up PR", "createdAt": "2020-06-09T02:11:49Z", "url": "https://github.com/returntocorp/semgrep/pull/946", "merged": true, "mergeCommit": {"oid": "09dafaabe4d6b26a833200a90b9d55824af35b2b"}, "closed": true, "closedAt": "2020-06-13T02:08:32Z", "author": {"login": "brendongo"}, "timelineItems": {"totalCount": 14, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcpuFCpgBqjM0MjcyNTg2MTA=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcqr78xABqjM0NDAyNDI4MDM=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "ce29e91d6b4b327e8404c1793746b08473f36b64", "author": {"user": {"login": "brendongo", "name": "Brendon Go"}}, "url": "https://github.com/returntocorp/semgrep/commit/ce29e91d6b4b327e8404c1793746b08473f36b64", "committedDate": "2020-06-09T02:11:24Z", "message": "target_manager: handle all file filtering in python instead of ocaml"}, "afterCommit": {"oid": "ca4d0ed30b11254ef653889eb7be0fba01b43031", "author": {"user": {"login": "brendongo", "name": "Brendon Go"}}, "url": "https://github.com/returntocorp/semgrep/commit/ca4d0ed30b11254ef653889eb7be0fba01b43031", "committedDate": "2020-06-09T23:58:00Z", "message": "WIP"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "7f75e99c0c5afe307fee3754a49712980d38dbe1", "author": {"user": {"login": "brendongo", "name": "Brendon Go"}}, "url": "https://github.com/returntocorp/semgrep/commit/7f75e99c0c5afe307fee3754a49712980d38dbe1", "committedDate": "2020-06-10T01:03:26Z", "message": "wip"}, "afterCommit": {"oid": "ab807474ce0428b7d3311d3c16f286ecd78183ec", "author": {"user": {"login": "brendongo", "name": "Brendon Go"}}, "url": "https://github.com/returntocorp/semgrep/commit/ab807474ce0428b7d3311d3c16f286ecd78183ec", "committedDate": "2020-06-11T00:15:36Z", "message": "wip"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "3d298bfaa56856c8238bed6c2ffbcba13e03cacb", "author": {"user": {"login": "brendongo", "name": "Brendon Go"}}, "url": "https://github.com/returntocorp/semgrep/commit/3d298bfaa56856c8238bed6c2ffbcba13e03cacb", "committedDate": "2020-06-11T23:16:46Z", "message": "Dedup parse errors"}, "afterCommit": {"oid": "b8e24808e7a250fb3ab76cc3a80a0a08032f5fee", "author": {"user": {"login": "brendongo", "name": "Brendon Go"}}, "url": "https://github.com/returntocorp/semgrep/commit/b8e24808e7a250fb3ab76cc3a80a0a08032f5fee", "committedDate": "2020-06-11T23:21:43Z", "message": "Dedup parse errors"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "b8e24808e7a250fb3ab76cc3a80a0a08032f5fee", "author": {"user": {"login": "brendongo", "name": "Brendon Go"}}, "url": "https://github.com/returntocorp/semgrep/commit/b8e24808e7a250fb3ab76cc3a80a0a08032f5fee", "committedDate": "2020-06-11T23:21:43Z", "message": "Dedup parse errors"}, "afterCommit": {"oid": "c29da4b60d1dc227612a19054c1483e601a3554b", "author": {"user": {"login": "brendongo", "name": "Brendon Go"}}, "url": "https://github.com/returntocorp/semgrep/commit/c29da4b60d1dc227612a19054c1483e601a3554b", "committedDate": "2020-06-11T23:46:59Z", "message": "Dedup parse errors"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDI5Mzg0Nzk1", "url": "https://github.com/returntocorp/semgrep/pull/946#pullrequestreview-429384795", "createdAt": "2020-06-12T00:17:20Z", "commit": {"oid": "c29da4b60d1dc227612a19054c1483e601a3554b"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xMlQwMDoxNzoyMVrOGizBrA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xMlQwMDoxNzoyMVrOGizBrA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzOTE0MDc4MA==", "bodyText": "\"excludes\" here twice \u270c\ufe0f", "url": "https://github.com/returntocorp/semgrep/pull/946#discussion_r439140780", "createdAt": "2020-06-12T00:17:21Z", "author": {"login": "minusworld"}, "path": "semgrep/semgrep/target_manager.py", "diffHunk": "@@ -0,0 +1,223 @@\n+import subprocess\n+from pathlib import Path\n+from typing import Dict\n+from typing import List\n+from typing import Set\n+\n+from semgrep.error import NotGitProjectError\n+from semgrep.error import UnknownLanguageError\n+from semgrep.util import partition_set\n+\n+\n+def lang_to_exts(language: str) -> List[str]:\n+    \"\"\"\n+        Convert language to expected file extensions\n+\n+        If language is not a supported semgrep language then\n+        raises UnknownLanguageError\n+    \"\"\"\n+    if language in [\"python\", \"python2\", \"python3\", \"py\"]:\n+        return [\"py\", \"pyi\"]\n+    elif language in [\"js\", \"javascript\"]:\n+        return [\"js\"]\n+    elif language in [\"java\"]:\n+        return [\"java\"]\n+    elif language in [\"c\"]:\n+        return [\"c\"]\n+    elif language in [\"go\", \"golang\"]:\n+        return [\"go\"]\n+    elif language in [\"ml\", \"ocaml\"]:\n+        return [\"mli\", \"ml\", \"mly\", \"mll\"]\n+    else:\n+        raise UnknownLanguageError(f\"Unsupported Language: {language}\")\n+\n+\n+class TargetManager:\n+    def __init__(\n+        self,\n+        includes: List[str],\n+        excludes: List[str],\n+        targets: List[str],\n+        visible_to_git_only: bool = False,\n+    ) -> None:\n+        \"\"\"\n+            Handles all file include/exclude logic for semgrep\n+\n+            If visible_to_git_only is true then will only consider files that are\n+            tracked or (untracked but not ignored) by git\n+        \"\"\"\n+        self._targets = targets\n+        self._includes = includes\n+        self._excludes = excludes\n+        self._visible_to_git_only = visible_to_git_only\n+\n+        self._filtered_targets: Dict[str, Set[Path]] = {}\n+\n+    @staticmethod\n+    def resolve_targets(targets: List[str]) -> Set[Path]:\n+        \"\"\"\n+            Return list of Path objects appropriately resolving relative paths\n+            (relative to cwd) if necessary\n+        \"\"\"\n+        base_path = Path(\".\")\n+        return set(\n+            Path(target) if Path(target).is_absolute() else base_path.joinpath(target)\n+            for target in targets\n+        )\n+\n+    def _parse_output(self, output: str, curr_dir: Path) -> Set[Path]:\n+        \"\"\"\n+            Convert a newline delimited list of files to a set of path objects\n+            prepends curr_dir to all paths in said list\n+\n+            If list is empty then returns an empty set\n+        \"\"\"\n+        files: Set[Path] = set()\n+        if output:\n+            files = set(Path(curr_dir) / elem for elem in output.strip().split(\"\\n\"))\n+        return files\n+\n+    def _expand_dir(self, curr_dir: Path, language: str) -> Set[Path]:\n+        \"\"\"\n+            Recursively go through a directory and return list of all files with\n+            default file extention of language\n+        \"\"\"\n+        extensions = lang_to_exts(language)\n+        expanded: Set[Path] = set()\n+\n+        for ext in extensions:\n+            if self._visible_to_git_only:\n+                try:\n+                    # Tracked files\n+                    tracked_output = subprocess.check_output(\n+                        [\"git\", \"ls-files\", f\"*.{ext}\"],\n+                        cwd=curr_dir.resolve(),\n+                        encoding=\"utf-8\",\n+                        stderr=subprocess.DEVNULL,\n+                    )\n+\n+                    # Untracked but not ignored files\n+                    untracked_output = subprocess.check_output(\n+                        [\n+                            \"git\",\n+                            \"ls-files\",\n+                            \"--other\",\n+                            \"--exclude-standard\",\n+                            f\"*.{ext}\",\n+                        ],\n+                        cwd=curr_dir.resolve(),\n+                        encoding=\"utf-8\",\n+                        stderr=subprocess.DEVNULL,\n+                    )\n+                except subprocess.CalledProcessError:\n+                    raise NotGitProjectError(\n+                        f\"{curr_dir.resolve()} is not a git repository.\"\n+                    )\n+\n+                tracked = self._parse_output(tracked_output, curr_dir)\n+                untracked_unignored = self._parse_output(untracked_output, curr_dir)\n+\n+                expanded = expanded.union(tracked)\n+                expanded = expanded.union(untracked_unignored)\n+\n+            else:\n+                output = subprocess.run(\n+                    [\"find\", curr_dir, \"-type\", \"f\", \"-name\", f\"*.{ext}\"],\n+                    encoding=\"utf-8\",\n+                    stdout=subprocess.PIPE,\n+                    stderr=subprocess.PIPE,\n+                )\n+\n+                # Note find already gives paths relative to pwd so no need to prepend curr_dir\n+                ext_files = self._parse_output(output.stdout, Path(\".\"))\n+                expanded = expanded.union(ext_files)\n+\n+        return expanded\n+\n+    def expand_targets(self, targets: Set[Path], lang: str) -> Set[Path]:\n+        \"\"\"\n+            Explore all directories. Remove duplicates\n+        \"\"\"\n+        expanded = set()\n+        for target in targets:\n+            if not target.exists():\n+                continue\n+\n+            if target.is_dir():\n+                expanded.update(self._expand_dir(target, lang))\n+            else:\n+                expanded.add(target)\n+\n+        return expanded\n+\n+    @staticmethod\n+    def match_glob(path: Path, globs: List[str]) -> bool:\n+        \"\"\"\n+            Return true if path or any parent of path matches any glob in globs\n+        \"\"\"\n+        subpaths = [path, *path.parents]\n+        return any(p.match(glob) for p in subpaths for glob in globs)\n+\n+    @staticmethod\n+    def filter_includes(arr: Set[Path], includes: List[str]) -> Set[Path]:\n+        \"\"\"\n+            Returns all elements in arr that match any includes pattern\n+\n+            If includes is empty, returns arr unchanged\n+        \"\"\"\n+        if not includes:\n+            return arr\n+\n+        return set(elem for elem in arr if TargetManager.match_glob(elem, includes))\n+\n+    @staticmethod\n+    def filter_excludes(arr: Set[Path], excludes: List[str]) -> Set[Path]:\n+        \"\"\"\n+            Returns all elements in arr that do not match any excludes excludes", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c29da4b60d1dc227612a19054c1483e601a3554b"}, "originalPosition": 176}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDI5Mzg1NjM3", "url": "https://github.com/returntocorp/semgrep/pull/946#pullrequestreview-429385637", "createdAt": "2020-06-12T00:20:02Z", "commit": {"oid": "c29da4b60d1dc227612a19054c1483e601a3554b"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDMwMDg2ODA0", "url": "https://github.com/returntocorp/semgrep/pull/946#pullrequestreview-430086804", "createdAt": "2020-06-12T23:49:45Z", "commit": {"oid": "97ffaf45ad7f0c5fc50189365c034aa790e2e318"}, "state": "DISMISSED", "comments": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xMlQyMzo0OTo0NVrOGjUFag==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xMlQyMzo1MjozOFrOGjUHVQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzOTY4MjQxMA==", "bodyText": "this will break on large repos", "url": "https://github.com/returntocorp/semgrep/pull/946#discussion_r439682410", "createdAt": "2020-06-12T23:49:45Z", "author": {"login": "DrewDennison"}, "path": "semgrep/semgrep/core_runner.py", "diffHunk": "@@ -273,7 +260,7 @@ def _run_rules(\n                     if equivalences:\n                         cmd += [\"-equivalences\", equiv_fout.name]\n                     cmd += [\"-j\", str(self._jobs)]\n-                    cmd += [*self.targeting_options, *[str(path) for path in targets]]\n+                    cmd += [str(path) for path in targets]", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "97ffaf45ad7f0c5fc50189365c034aa790e2e318"}, "originalPosition": 96}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzOTY4MjU4Mw==", "bodyText": "is this logic duplicated in ocaml or hopefully this is now the single source of truth?", "url": "https://github.com/returntocorp/semgrep/pull/946#discussion_r439682583", "createdAt": "2020-06-12T23:50:48Z", "author": {"login": "DrewDennison"}, "path": "semgrep/semgrep/target_manager.py", "diffHunk": "@@ -0,0 +1,234 @@\n+import subprocess\n+from pathlib import Path\n+from typing import Dict\n+from typing import List\n+from typing import Set\n+\n+from semgrep.error import NotGitProjectError\n+from semgrep.error import UnknownLanguageError\n+from semgrep.util import partition_set\n+\n+\n+def lang_to_exts(language: str) -> List[str]:\n+    \"\"\"\n+        Convert language to expected file extensions\n+\n+        If language is not a supported semgrep language then\n+        raises UnknownLanguageError\n+    \"\"\"\n+    if language in [\"python\", \"python2\", \"python3\", \"py\"]:", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "97ffaf45ad7f0c5fc50189365c034aa790e2e318"}, "originalPosition": 19}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzOTY4MjgxOA==", "bodyText": "what's the run time of this command? Seems slow compared to extracting globs from .gitignore", "url": "https://github.com/returntocorp/semgrep/pull/946#discussion_r439682818", "createdAt": "2020-06-12T23:52:10Z", "author": {"login": "DrewDennison"}, "path": "semgrep/semgrep/target_manager.py", "diffHunk": "@@ -0,0 +1,234 @@\n+import subprocess\n+from pathlib import Path\n+from typing import Dict\n+from typing import List\n+from typing import Set\n+\n+from semgrep.error import NotGitProjectError\n+from semgrep.error import UnknownLanguageError\n+from semgrep.util import partition_set\n+\n+\n+def lang_to_exts(language: str) -> List[str]:\n+    \"\"\"\n+        Convert language to expected file extensions\n+\n+        If language is not a supported semgrep language then\n+        raises UnknownLanguageError\n+    \"\"\"\n+    if language in [\"python\", \"python2\", \"python3\", \"py\"]:\n+        return [\"py\", \"pyi\"]\n+    elif language in [\"js\", \"javascript\"]:\n+        return [\"js\"]\n+    elif language in [\"java\"]:\n+        return [\"java\"]\n+    elif language in [\"c\"]:\n+        return [\"c\"]\n+    elif language in [\"go\", \"golang\"]:\n+        return [\"go\"]\n+    elif language in [\"ml\", \"ocaml\"]:\n+        return [\"mli\", \"ml\", \"mly\", \"mll\"]\n+    else:\n+        raise UnknownLanguageError(f\"Unsupported Language: {language}\")\n+\n+\n+class TargetManager:\n+    def __init__(\n+        self,\n+        includes: List[str],\n+        excludes: List[str],\n+        targets: List[str],\n+        visible_to_git_only: bool = False,\n+    ) -> None:\n+        \"\"\"\n+            Handles all file include/exclude logic for semgrep\n+\n+            If visible_to_git_only is true then will only consider files that are\n+            tracked or (untracked but not ignored) by git\n+        \"\"\"\n+        self._targets = targets\n+        self._includes = includes\n+        self._excludes = excludes\n+        self._visible_to_git_only = visible_to_git_only\n+\n+        self._filtered_targets: Dict[str, Set[Path]] = {}\n+\n+    @staticmethod\n+    def resolve_targets(targets: List[str]) -> Set[Path]:\n+        \"\"\"\n+            Return list of Path objects appropriately resolving relative paths\n+            (relative to cwd) if necessary\n+        \"\"\"\n+        base_path = Path(\".\")\n+        return set(\n+            Path(target) if Path(target).is_absolute() else base_path.joinpath(target)\n+            for target in targets\n+        )\n+\n+    @staticmethod\n+    def _parse_output(output: str, curr_dir: Path) -> Set[Path]:\n+        \"\"\"\n+            Convert a newline delimited list of files to a set of path objects\n+            prepends curr_dir to all paths in said list\n+\n+            If list is empty then returns an empty set\n+        \"\"\"\n+        files: Set[Path] = set()\n+        if output:\n+            files = set(Path(curr_dir) / elem for elem in output.strip().split(\"\\n\"))\n+        return files\n+\n+    @staticmethod\n+    def _expand_dir(\n+        curr_dir: Path, language: str, visible_to_git_only: bool\n+    ) -> Set[Path]:\n+        \"\"\"\n+            Recursively go through a directory and return list of all files with\n+            default file extention of language\n+        \"\"\"\n+        extensions = lang_to_exts(language)\n+        expanded: Set[Path] = set()\n+\n+        for ext in extensions:\n+            if visible_to_git_only:\n+                try:\n+                    # Tracked files\n+                    tracked_output = subprocess.check_output(\n+                        [\"git\", \"ls-files\", f\"*.{ext}\"],", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "97ffaf45ad7f0c5fc50189365c034aa790e2e318"}, "originalPosition": 97}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzOTY4MjkwMQ==", "bodyText": "shouldn't we be using Path(.).rglob(\"*\")?", "url": "https://github.com/returntocorp/semgrep/pull/946#discussion_r439682901", "createdAt": "2020-06-12T23:52:38Z", "author": {"login": "DrewDennison"}, "path": "semgrep/semgrep/target_manager.py", "diffHunk": "@@ -0,0 +1,234 @@\n+import subprocess\n+from pathlib import Path\n+from typing import Dict\n+from typing import List\n+from typing import Set\n+\n+from semgrep.error import NotGitProjectError\n+from semgrep.error import UnknownLanguageError\n+from semgrep.util import partition_set\n+\n+\n+def lang_to_exts(language: str) -> List[str]:\n+    \"\"\"\n+        Convert language to expected file extensions\n+\n+        If language is not a supported semgrep language then\n+        raises UnknownLanguageError\n+    \"\"\"\n+    if language in [\"python\", \"python2\", \"python3\", \"py\"]:\n+        return [\"py\", \"pyi\"]\n+    elif language in [\"js\", \"javascript\"]:\n+        return [\"js\"]\n+    elif language in [\"java\"]:\n+        return [\"java\"]\n+    elif language in [\"c\"]:\n+        return [\"c\"]\n+    elif language in [\"go\", \"golang\"]:\n+        return [\"go\"]\n+    elif language in [\"ml\", \"ocaml\"]:\n+        return [\"mli\", \"ml\", \"mly\", \"mll\"]\n+    else:\n+        raise UnknownLanguageError(f\"Unsupported Language: {language}\")\n+\n+\n+class TargetManager:\n+    def __init__(\n+        self,\n+        includes: List[str],\n+        excludes: List[str],\n+        targets: List[str],\n+        visible_to_git_only: bool = False,\n+    ) -> None:\n+        \"\"\"\n+            Handles all file include/exclude logic for semgrep\n+\n+            If visible_to_git_only is true then will only consider files that are\n+            tracked or (untracked but not ignored) by git\n+        \"\"\"\n+        self._targets = targets\n+        self._includes = includes\n+        self._excludes = excludes\n+        self._visible_to_git_only = visible_to_git_only\n+\n+        self._filtered_targets: Dict[str, Set[Path]] = {}\n+\n+    @staticmethod\n+    def resolve_targets(targets: List[str]) -> Set[Path]:\n+        \"\"\"\n+            Return list of Path objects appropriately resolving relative paths\n+            (relative to cwd) if necessary\n+        \"\"\"\n+        base_path = Path(\".\")\n+        return set(\n+            Path(target) if Path(target).is_absolute() else base_path.joinpath(target)\n+            for target in targets\n+        )\n+\n+    @staticmethod\n+    def _parse_output(output: str, curr_dir: Path) -> Set[Path]:\n+        \"\"\"\n+            Convert a newline delimited list of files to a set of path objects\n+            prepends curr_dir to all paths in said list\n+\n+            If list is empty then returns an empty set\n+        \"\"\"\n+        files: Set[Path] = set()\n+        if output:\n+            files = set(Path(curr_dir) / elem for elem in output.strip().split(\"\\n\"))\n+        return files\n+\n+    @staticmethod\n+    def _expand_dir(\n+        curr_dir: Path, language: str, visible_to_git_only: bool\n+    ) -> Set[Path]:\n+        \"\"\"\n+            Recursively go through a directory and return list of all files with\n+            default file extention of language\n+        \"\"\"\n+        extensions = lang_to_exts(language)\n+        expanded: Set[Path] = set()\n+\n+        for ext in extensions:\n+            if visible_to_git_only:\n+                try:\n+                    # Tracked files\n+                    tracked_output = subprocess.check_output(\n+                        [\"git\", \"ls-files\", f\"*.{ext}\"],\n+                        cwd=curr_dir.resolve(),\n+                        encoding=\"utf-8\",\n+                        stderr=subprocess.DEVNULL,\n+                    )\n+\n+                    # Untracked but not ignored files\n+                    untracked_output = subprocess.check_output(\n+                        [\n+                            \"git\",\n+                            \"ls-files\",\n+                            \"--other\",\n+                            \"--exclude-standard\",\n+                            f\"*.{ext}\",\n+                        ],\n+                        cwd=curr_dir.resolve(),\n+                        encoding=\"utf-8\",\n+                        stderr=subprocess.DEVNULL,\n+                    )\n+                except subprocess.CalledProcessError:\n+                    raise NotGitProjectError(\n+                        f\"{curr_dir.resolve()} is not a git repository.\"\n+                    )\n+\n+                tracked = TargetManager._parse_output(tracked_output, curr_dir)\n+                untracked_unignored = TargetManager._parse_output(\n+                    untracked_output, curr_dir\n+                )\n+\n+                expanded = expanded.union(tracked)\n+                expanded = expanded.union(untracked_unignored)\n+\n+            else:\n+                output = subprocess.run(\n+                    [\"find\", curr_dir, \"-type\", \"f\", \"-name\", f\"*.{ext}\"],", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "97ffaf45ad7f0c5fc50189365c034aa790e2e318"}, "originalPosition": 131}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a9544d46412e4eeebe29d551fc340d467b85be20", "author": {"user": {"login": "brendongo", "name": "Brendon Go"}}, "url": "https://github.com/returntocorp/semgrep/commit/a9544d46412e4eeebe29d551fc340d467b85be20", "committedDate": "2020-06-12T23:54:06Z", "message": "target_manager: handle all file filtering in python instead of ocaml"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "82123a71efb745f97ccf4b19191a4ffe6f7f912d", "author": {"user": {"login": "brendongo", "name": "Brendon Go"}}, "url": "https://github.com/returntocorp/semgrep/commit/82123a71efb745f97ccf4b19191a4ffe6f7f912d", "committedDate": "2020-06-12T23:54:06Z", "message": "WIP"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f8530b232b1a00145ba66b42d92dcf35ad0ae8cf", "author": {"user": {"login": "brendongo", "name": "Brendon Go"}}, "url": "https://github.com/returntocorp/semgrep/commit/f8530b232b1a00145ba66b42d92dcf35ad0ae8cf", "committedDate": "2020-06-12T23:54:06Z", "message": "wip"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e8ddc0e5569d2212679ce32aead52ba5ef85e6da", "author": {"user": {"login": "brendongo", "name": "Brendon Go"}}, "url": "https://github.com/returntocorp/semgrep/commit/e8ddc0e5569d2212679ce32aead52ba5ef85e6da", "committedDate": "2020-06-13T00:02:08Z", "message": "Hook up target_manager"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "eab56a16eb5c43e8824cc58f6a17dcaf1a6f2891", "author": {"user": {"login": "brendongo", "name": "Brendon Go"}}, "url": "https://github.com/returntocorp/semgrep/commit/eab56a16eb5c43e8824cc58f6a17dcaf1a6f2891", "committedDate": "2020-06-13T00:02:09Z", "message": "Dedup parse errors"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "55bdc2b8ea191430949d1495b088689c57d6e78b", "author": {"user": {"login": "brendongo", "name": "Brendon Go"}}, "url": "https://github.com/returntocorp/semgrep/commit/55bdc2b8ea191430949d1495b088689c57d6e78b", "committedDate": "2020-06-13T00:02:09Z", "message": "Add unit tests for target_manager"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "97ffaf45ad7f0c5fc50189365c034aa790e2e318", "author": {"user": {"login": "brendongo", "name": "Brendon Go"}}, "url": "https://github.com/returntocorp/semgrep/commit/97ffaf45ad7f0c5fc50189365c034aa790e2e318", "committedDate": "2020-06-12T23:39:11Z", "message": "Add unit tests for target_manager"}, "afterCommit": {"oid": "55bdc2b8ea191430949d1495b088689c57d6e78b", "author": {"user": {"login": "brendongo", "name": "Brendon Go"}}, "url": "https://github.com/returntocorp/semgrep/commit/55bdc2b8ea191430949d1495b088689c57d6e78b", "committedDate": "2020-06-13T00:02:09Z", "message": "Add unit tests for target_manager"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1509, "cost": 1, "resetAt": "2021-11-01T16:37:27Z"}}}