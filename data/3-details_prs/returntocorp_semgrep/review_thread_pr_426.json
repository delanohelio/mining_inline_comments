{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDAxNTgwMjY5", "number": 426, "reviewThreads": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wOVQyMDo1NjoyMlrODwkDyQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wOVQyMDo1OTo1MFrODwkH_w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjUyMjQ5MDMzOnYy", "diffSide": "RIGHT", "path": ".github/workflows/do-release.yml", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wOVQyMDo1NjoyMlrOGDpG2A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wOVQyMTo0MToyN1rOGDqa4A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNjQ3MjQwOA==", "bodyText": "Does this match the release name to be the semver tag?", "url": "https://github.com/returntocorp/semgrep/pull/426#discussion_r406472408", "createdAt": "2020-04-09T20:56:22Z", "author": {"login": "brendongo"}, "path": ".github/workflows/do-release.yml", "diffHunk": "@@ -0,0 +1,158 @@\n+on:\n+  push:\n+    # Sequence of patterns matched against refs/tags\n+    tags:\n+    - 'v*' # Push events to matching v*, i.e. v1.0, v20.15.10\n+\n+name: Create draft release\n+\n+jobs:\n+  create_release:\n+    name: Create the Github Release\n+    runs-on: ubuntu-latest\n+    needs: [release-osx, release-ubuntu-16-04]\n+    steps:\n+      - name: Create Release\n+        id: create_release\n+        uses: actions/create-release@v1\n+        env:\n+          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}\n+        with:\n+          tag_name: ${{ github.ref }}\n+          release_name: Release ${{ github.ref }}", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "9f99f75d8685f29b0b733bd17ed0d99fb72cd9ce"}, "originalPosition": 22}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNjQ5MzkyMA==", "bodyText": "I think it will make it release-0.4.10 etc", "url": "https://github.com/returntocorp/semgrep/pull/426#discussion_r406493920", "createdAt": "2020-04-09T21:41:27Z", "author": {"login": "DrewDennison"}, "path": ".github/workflows/do-release.yml", "diffHunk": "@@ -0,0 +1,158 @@\n+on:\n+  push:\n+    # Sequence of patterns matched against refs/tags\n+    tags:\n+    - 'v*' # Push events to matching v*, i.e. v1.0, v20.15.10\n+\n+name: Create draft release\n+\n+jobs:\n+  create_release:\n+    name: Create the Github Release\n+    runs-on: ubuntu-latest\n+    needs: [release-osx, release-ubuntu-16-04]\n+    steps:\n+      - name: Create Release\n+        id: create_release\n+        uses: actions/create-release@v1\n+        env:\n+          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}\n+        with:\n+          tag_name: ${{ github.ref }}\n+          release_name: Release ${{ github.ref }}", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNjQ3MjQwOA=="}, "originalCommit": {"oid": "9f99f75d8685f29b0b733bd17ed0d99fb72cd9ce"}, "originalPosition": 22}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjUyMjQ5MjM3OnYy", "diffSide": "RIGHT", "path": ".github/workflows/do-release.yml", "isResolved": false, "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wOVQyMDo1NzowNVrOGDpIPA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0xM1QxNzoxOTowNlrOGEt16g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNjQ3Mjc2NA==", "bodyText": "If this is a release probably better to have the release semver in the filename instead of the shahash?", "url": "https://github.com/returntocorp/semgrep/pull/426#discussion_r406472764", "createdAt": "2020-04-09T20:57:05Z", "author": {"login": "brendongo"}, "path": ".github/workflows/do-release.yml", "diffHunk": "@@ -0,0 +1,158 @@\n+on:\n+  push:\n+    # Sequence of patterns matched against refs/tags\n+    tags:\n+    - 'v*' # Push events to matching v*, i.e. v1.0, v20.15.10\n+\n+name: Create draft release\n+\n+jobs:\n+  create_release:\n+    name: Create the Github Release\n+    runs-on: ubuntu-latest\n+    needs: [release-osx, release-ubuntu-16-04]\n+    steps:\n+      - name: Create Release\n+        id: create_release\n+        uses: actions/create-release@v1\n+        env:\n+          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}\n+        with:\n+          tag_name: ${{ github.ref }}\n+          release_name: Release ${{ github.ref }}\n+          draft: true\n+          prerelease: false\n+      - uses: actions/download-artifact@v1\n+        with:\n+          name: sgrep-osx-${{ github.sha }}", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "9f99f75d8685f29b0b733bd17ed0d99fb72cd9ce"}, "originalPosition": 27}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNjQ5NDMwMA==", "bodyText": "could have a short hash for develop commits where it's changing but generally agree for semver releases", "url": "https://github.com/returntocorp/semgrep/pull/426#discussion_r406494300", "createdAt": "2020-04-09T21:42:25Z", "author": {"login": "DrewDennison"}, "path": ".github/workflows/do-release.yml", "diffHunk": "@@ -0,0 +1,158 @@\n+on:\n+  push:\n+    # Sequence of patterns matched against refs/tags\n+    tags:\n+    - 'v*' # Push events to matching v*, i.e. v1.0, v20.15.10\n+\n+name: Create draft release\n+\n+jobs:\n+  create_release:\n+    name: Create the Github Release\n+    runs-on: ubuntu-latest\n+    needs: [release-osx, release-ubuntu-16-04]\n+    steps:\n+      - name: Create Release\n+        id: create_release\n+        uses: actions/create-release@v1\n+        env:\n+          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}\n+        with:\n+          tag_name: ${{ github.ref }}\n+          release_name: Release ${{ github.ref }}\n+          draft: true\n+          prerelease: false\n+      - uses: actions/download-artifact@v1\n+        with:\n+          name: sgrep-osx-${{ github.sha }}", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNjQ3Mjc2NA=="}, "originalCommit": {"oid": "9f99f75d8685f29b0b733bd17ed0d99fb72cd9ce"}, "originalPosition": 27}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNzU5ODU3MA==", "bodyText": "these names don't get exposed. It's just the way we shuffle assets around internally. On the release, they get named properly.", "url": "https://github.com/returntocorp/semgrep/pull/426#discussion_r407598570", "createdAt": "2020-04-13T17:19:06Z", "author": {"login": "rcoh"}, "path": ".github/workflows/do-release.yml", "diffHunk": "@@ -0,0 +1,158 @@\n+on:\n+  push:\n+    # Sequence of patterns matched against refs/tags\n+    tags:\n+    - 'v*' # Push events to matching v*, i.e. v1.0, v20.15.10\n+\n+name: Create draft release\n+\n+jobs:\n+  create_release:\n+    name: Create the Github Release\n+    runs-on: ubuntu-latest\n+    needs: [release-osx, release-ubuntu-16-04]\n+    steps:\n+      - name: Create Release\n+        id: create_release\n+        uses: actions/create-release@v1\n+        env:\n+          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}\n+        with:\n+          tag_name: ${{ github.ref }}\n+          release_name: Release ${{ github.ref }}\n+          draft: true\n+          prerelease: false\n+      - uses: actions/download-artifact@v1\n+        with:\n+          name: sgrep-osx-${{ github.sha }}", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNjQ3Mjc2NA=="}, "originalCommit": {"oid": "9f99f75d8685f29b0b733bd17ed0d99fb72cd9ce"}, "originalPosition": 27}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjUyMjQ5NDkxOnYy", "diffSide": "RIGHT", "path": ".github/workflows/do-release.yml", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wOVQyMDo1Nzo1N1rOGDpJ6g==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wOVQyMDo1Nzo1N1rOGDpJ6g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNjQ3MzE5NA==", "bodyText": "the convention we've had with past releases has been sgrep-SEMVER-ubuntu-16.04.tgz", "url": "https://github.com/returntocorp/semgrep/pull/426#discussion_r406473194", "createdAt": "2020-04-09T20:57:57Z", "author": {"login": "brendongo"}, "path": ".github/workflows/do-release.yml", "diffHunk": "@@ -0,0 +1,158 @@\n+on:\n+  push:\n+    # Sequence of patterns matched against refs/tags\n+    tags:\n+    - 'v*' # Push events to matching v*, i.e. v1.0, v20.15.10\n+\n+name: Create draft release\n+\n+jobs:\n+  create_release:\n+    name: Create the Github Release\n+    runs-on: ubuntu-latest\n+    needs: [release-osx, release-ubuntu-16-04]\n+    steps:\n+      - name: Create Release\n+        id: create_release\n+        uses: actions/create-release@v1\n+        env:\n+          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}\n+        with:\n+          tag_name: ${{ github.ref }}\n+          release_name: Release ${{ github.ref }}\n+          draft: true\n+          prerelease: false\n+      - uses: actions/download-artifact@v1\n+        with:\n+          name: sgrep-osx-${{ github.sha }}\n+          path: sgrep-osx\n+      - name: Get the version\n+        id: get_version\n+        run: echo ::set-output name=VERSION::${GITHUB_REF/refs\\/tags\\//}\n+      - name: help\n+        run: |\n+          pwd;\n+          ls;\n+          find .;\n+      - name: Upload Release Asset\n+        id: upload-release-asset-osx\n+        uses: actions/upload-release-asset@v1\n+        env:\n+          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}\n+        with:\n+          upload_url: ${{ steps.create_release.outputs.upload_url }}\n+          asset_path: ./sgrep-osx/artifacts.zip\n+          asset_name: sgrep-osx-${{ steps.get_version.outputs.VERSION }}.zip\n+          asset_content_type: application/zip\n+      - uses: actions/download-artifact@v1\n+        with:\n+          name: sgrep-ubuntu-16.04-${{ github.sha }}\n+          path: sgrep-ubuntu\n+      - name: Upload Release Asset\n+        id: upload-release-asset-ubuntu\n+        uses: actions/upload-release-asset@v1\n+        env:\n+          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}\n+        with:\n+          upload_url: ${{ steps.create_release.outputs.upload_url }}\n+          asset_path: ./sgrep-ubuntu/artifacts.tar.gz\n+          asset_name: sgrep-ubuntu-1604-${{ steps.get_version.outputs.VERSION }}.tar.gz", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "9f99f75d8685f29b0b733bd17ed0d99fb72cd9ce"}, "originalPosition": 59}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjUyMjUwMTExOnYy", "diffSide": "RIGHT", "path": ".github/workflows/do-release.yml", "isResolved": false, "comments": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wOVQyMDo1OTo1MFrOGDpN3Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0xM1QyMDozNTowMVrOGE0VGA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNjQ3NDIwNQ==", "bodyText": "How much work is it to DRY in this PR instead of a follow up PR?", "url": "https://github.com/returntocorp/semgrep/pull/426#discussion_r406474205", "createdAt": "2020-04-09T20:59:50Z", "author": {"login": "brendongo"}, "path": ".github/workflows/do-release.yml", "diffHunk": "@@ -0,0 +1,158 @@\n+on:\n+  push:\n+    # Sequence of patterns matched against refs/tags\n+    tags:\n+    - 'v*' # Push events to matching v*, i.e. v1.0, v20.15.10\n+\n+name: Create draft release\n+\n+jobs:\n+  create_release:\n+    name: Create the Github Release\n+    runs-on: ubuntu-latest\n+    needs: [release-osx, release-ubuntu-16-04]\n+    steps:\n+      - name: Create Release\n+        id: create_release\n+        uses: actions/create-release@v1\n+        env:\n+          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}\n+        with:\n+          tag_name: ${{ github.ref }}\n+          release_name: Release ${{ github.ref }}\n+          draft: true\n+          prerelease: false\n+      - uses: actions/download-artifact@v1\n+        with:\n+          name: sgrep-osx-${{ github.sha }}\n+          path: sgrep-osx\n+      - name: Get the version\n+        id: get_version\n+        run: echo ::set-output name=VERSION::${GITHUB_REF/refs\\/tags\\//}\n+      - name: help\n+        run: |\n+          pwd;\n+          ls;\n+          find .;\n+      - name: Upload Release Asset\n+        id: upload-release-asset-osx\n+        uses: actions/upload-release-asset@v1\n+        env:\n+          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}\n+        with:\n+          upload_url: ${{ steps.create_release.outputs.upload_url }}\n+          asset_path: ./sgrep-osx/artifacts.zip\n+          asset_name: sgrep-osx-${{ steps.get_version.outputs.VERSION }}.zip\n+          asset_content_type: application/zip\n+      - uses: actions/download-artifact@v1\n+        with:\n+          name: sgrep-ubuntu-16.04-${{ github.sha }}\n+          path: sgrep-ubuntu\n+      - name: Upload Release Asset\n+        id: upload-release-asset-ubuntu\n+        uses: actions/upload-release-asset@v1\n+        env:\n+          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}\n+        with:\n+          upload_url: ${{ steps.create_release.outputs.upload_url }}\n+          asset_path: ./sgrep-ubuntu/artifacts.tar.gz\n+          asset_name: sgrep-ubuntu-1604-${{ steps.get_version.outputs.VERSION }}.tar.gz\n+          asset_content_type: application/gzip\n+  release-osx:\n+    name: Build the OSX binaries\n+    runs-on: macos-latest\n+    # TODO: this is very similar to the mac-build workflow. Convert to an action\n+    steps:\n+      - name: Install System Deps\n+        run: brew install opam pkg-config coreutils\n+      - name: Checkout\n+        uses: actions/checkout@v2\n+      - name: OPAM setup\n+        run: |\n+          opam init --no-setup --bare;\n+          opam switch create 4.07.1;\n+          opam switch 4.07.1;\n+      - name: OPAM install Deps\n+        run: eval $(opam env); opam install -y reason dune ocamlfind camlp4 num ocamlgraph json-wheel conf-perl yaml\n+      - name: Install submodules\n+        run: git submodule update --init --recursive\n+      - name: Install pfff\n+        run: eval $(opam env) && opam install -y ./pfff\n+      - name: Install and test sgrep\n+        run: eval $(opam env) && cd sgrep && make all && make test && make install\n+      - name: Prepare artifacts\n+        run: |\n+          mkdir -p artifacts;\n+          cp ./sgrep/_build/default/bin/main_sgrep.exe artifacts/sgrep;\n+          zip -r artifacts.zip artifacts\n+\n+      - name: Upload artifacts\n+        uses: actions/upload-artifact@v1\n+        with:\n+          name: sgrep-osx-${{ github.sha }}\n+          path: artifacts.zip\n+  release-ubuntu-16-04:\n+    # TODO: this is very similar to the ubuntu-build workflow.\n+    # convert to github action to DRY", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "9f99f75d8685f29b0b733bd17ed0d99fb72cd9ce"}, "originalPosition": 96}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNzU5ODk2NA==", "bodyText": "probably 1-2h? Not sure I'm also not 100% we want them to be exactly the same? eg. maybe there's a faster way to run tests", "url": "https://github.com/returntocorp/semgrep/pull/426#discussion_r407598964", "createdAt": "2020-04-13T17:19:48Z", "author": {"login": "rcoh"}, "path": ".github/workflows/do-release.yml", "diffHunk": "@@ -0,0 +1,158 @@\n+on:\n+  push:\n+    # Sequence of patterns matched against refs/tags\n+    tags:\n+    - 'v*' # Push events to matching v*, i.e. v1.0, v20.15.10\n+\n+name: Create draft release\n+\n+jobs:\n+  create_release:\n+    name: Create the Github Release\n+    runs-on: ubuntu-latest\n+    needs: [release-osx, release-ubuntu-16-04]\n+    steps:\n+      - name: Create Release\n+        id: create_release\n+        uses: actions/create-release@v1\n+        env:\n+          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}\n+        with:\n+          tag_name: ${{ github.ref }}\n+          release_name: Release ${{ github.ref }}\n+          draft: true\n+          prerelease: false\n+      - uses: actions/download-artifact@v1\n+        with:\n+          name: sgrep-osx-${{ github.sha }}\n+          path: sgrep-osx\n+      - name: Get the version\n+        id: get_version\n+        run: echo ::set-output name=VERSION::${GITHUB_REF/refs\\/tags\\//}\n+      - name: help\n+        run: |\n+          pwd;\n+          ls;\n+          find .;\n+      - name: Upload Release Asset\n+        id: upload-release-asset-osx\n+        uses: actions/upload-release-asset@v1\n+        env:\n+          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}\n+        with:\n+          upload_url: ${{ steps.create_release.outputs.upload_url }}\n+          asset_path: ./sgrep-osx/artifacts.zip\n+          asset_name: sgrep-osx-${{ steps.get_version.outputs.VERSION }}.zip\n+          asset_content_type: application/zip\n+      - uses: actions/download-artifact@v1\n+        with:\n+          name: sgrep-ubuntu-16.04-${{ github.sha }}\n+          path: sgrep-ubuntu\n+      - name: Upload Release Asset\n+        id: upload-release-asset-ubuntu\n+        uses: actions/upload-release-asset@v1\n+        env:\n+          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}\n+        with:\n+          upload_url: ${{ steps.create_release.outputs.upload_url }}\n+          asset_path: ./sgrep-ubuntu/artifacts.tar.gz\n+          asset_name: sgrep-ubuntu-1604-${{ steps.get_version.outputs.VERSION }}.tar.gz\n+          asset_content_type: application/gzip\n+  release-osx:\n+    name: Build the OSX binaries\n+    runs-on: macos-latest\n+    # TODO: this is very similar to the mac-build workflow. Convert to an action\n+    steps:\n+      - name: Install System Deps\n+        run: brew install opam pkg-config coreutils\n+      - name: Checkout\n+        uses: actions/checkout@v2\n+      - name: OPAM setup\n+        run: |\n+          opam init --no-setup --bare;\n+          opam switch create 4.07.1;\n+          opam switch 4.07.1;\n+      - name: OPAM install Deps\n+        run: eval $(opam env); opam install -y reason dune ocamlfind camlp4 num ocamlgraph json-wheel conf-perl yaml\n+      - name: Install submodules\n+        run: git submodule update --init --recursive\n+      - name: Install pfff\n+        run: eval $(opam env) && opam install -y ./pfff\n+      - name: Install and test sgrep\n+        run: eval $(opam env) && cd sgrep && make all && make test && make install\n+      - name: Prepare artifacts\n+        run: |\n+          mkdir -p artifacts;\n+          cp ./sgrep/_build/default/bin/main_sgrep.exe artifacts/sgrep;\n+          zip -r artifacts.zip artifacts\n+\n+      - name: Upload artifacts\n+        uses: actions/upload-artifact@v1\n+        with:\n+          name: sgrep-osx-${{ github.sha }}\n+          path: artifacts.zip\n+  release-ubuntu-16-04:\n+    # TODO: this is very similar to the ubuntu-build workflow.\n+    # convert to github action to DRY", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNjQ3NDIwNQ=="}, "originalCommit": {"oid": "9f99f75d8685f29b0b733bd17ed0d99fb72cd9ce"}, "originalPosition": 96}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNzYxNjg3NQ==", "bodyText": "actually turns out this is literally impossible for OSX tasks \ud83d\ude44", "url": "https://github.com/returntocorp/semgrep/pull/426#discussion_r407616875", "createdAt": "2020-04-13T17:51:55Z", "author": {"login": "rcoh"}, "path": ".github/workflows/do-release.yml", "diffHunk": "@@ -0,0 +1,158 @@\n+on:\n+  push:\n+    # Sequence of patterns matched against refs/tags\n+    tags:\n+    - 'v*' # Push events to matching v*, i.e. v1.0, v20.15.10\n+\n+name: Create draft release\n+\n+jobs:\n+  create_release:\n+    name: Create the Github Release\n+    runs-on: ubuntu-latest\n+    needs: [release-osx, release-ubuntu-16-04]\n+    steps:\n+      - name: Create Release\n+        id: create_release\n+        uses: actions/create-release@v1\n+        env:\n+          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}\n+        with:\n+          tag_name: ${{ github.ref }}\n+          release_name: Release ${{ github.ref }}\n+          draft: true\n+          prerelease: false\n+      - uses: actions/download-artifact@v1\n+        with:\n+          name: sgrep-osx-${{ github.sha }}\n+          path: sgrep-osx\n+      - name: Get the version\n+        id: get_version\n+        run: echo ::set-output name=VERSION::${GITHUB_REF/refs\\/tags\\//}\n+      - name: help\n+        run: |\n+          pwd;\n+          ls;\n+          find .;\n+      - name: Upload Release Asset\n+        id: upload-release-asset-osx\n+        uses: actions/upload-release-asset@v1\n+        env:\n+          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}\n+        with:\n+          upload_url: ${{ steps.create_release.outputs.upload_url }}\n+          asset_path: ./sgrep-osx/artifacts.zip\n+          asset_name: sgrep-osx-${{ steps.get_version.outputs.VERSION }}.zip\n+          asset_content_type: application/zip\n+      - uses: actions/download-artifact@v1\n+        with:\n+          name: sgrep-ubuntu-16.04-${{ github.sha }}\n+          path: sgrep-ubuntu\n+      - name: Upload Release Asset\n+        id: upload-release-asset-ubuntu\n+        uses: actions/upload-release-asset@v1\n+        env:\n+          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}\n+        with:\n+          upload_url: ${{ steps.create_release.outputs.upload_url }}\n+          asset_path: ./sgrep-ubuntu/artifacts.tar.gz\n+          asset_name: sgrep-ubuntu-1604-${{ steps.get_version.outputs.VERSION }}.tar.gz\n+          asset_content_type: application/gzip\n+  release-osx:\n+    name: Build the OSX binaries\n+    runs-on: macos-latest\n+    # TODO: this is very similar to the mac-build workflow. Convert to an action\n+    steps:\n+      - name: Install System Deps\n+        run: brew install opam pkg-config coreutils\n+      - name: Checkout\n+        uses: actions/checkout@v2\n+      - name: OPAM setup\n+        run: |\n+          opam init --no-setup --bare;\n+          opam switch create 4.07.1;\n+          opam switch 4.07.1;\n+      - name: OPAM install Deps\n+        run: eval $(opam env); opam install -y reason dune ocamlfind camlp4 num ocamlgraph json-wheel conf-perl yaml\n+      - name: Install submodules\n+        run: git submodule update --init --recursive\n+      - name: Install pfff\n+        run: eval $(opam env) && opam install -y ./pfff\n+      - name: Install and test sgrep\n+        run: eval $(opam env) && cd sgrep && make all && make test && make install\n+      - name: Prepare artifacts\n+        run: |\n+          mkdir -p artifacts;\n+          cp ./sgrep/_build/default/bin/main_sgrep.exe artifacts/sgrep;\n+          zip -r artifacts.zip artifacts\n+\n+      - name: Upload artifacts\n+        uses: actions/upload-artifact@v1\n+        with:\n+          name: sgrep-osx-${{ github.sha }}\n+          path: artifacts.zip\n+  release-ubuntu-16-04:\n+    # TODO: this is very similar to the ubuntu-build workflow.\n+    # convert to github action to DRY", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNjQ3NDIwNQ=="}, "originalCommit": {"oid": "9f99f75d8685f29b0b733bd17ed0d99fb72cd9ce"}, "originalPosition": 96}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNzcwNDg1Ng==", "bodyText": "I'm worried if they arent the same then this test might pass but the actual binary built by the other job is broken", "url": "https://github.com/returntocorp/semgrep/pull/426#discussion_r407704856", "createdAt": "2020-04-13T20:35:01Z", "author": {"login": "brendongo"}, "path": ".github/workflows/do-release.yml", "diffHunk": "@@ -0,0 +1,158 @@\n+on:\n+  push:\n+    # Sequence of patterns matched against refs/tags\n+    tags:\n+    - 'v*' # Push events to matching v*, i.e. v1.0, v20.15.10\n+\n+name: Create draft release\n+\n+jobs:\n+  create_release:\n+    name: Create the Github Release\n+    runs-on: ubuntu-latest\n+    needs: [release-osx, release-ubuntu-16-04]\n+    steps:\n+      - name: Create Release\n+        id: create_release\n+        uses: actions/create-release@v1\n+        env:\n+          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}\n+        with:\n+          tag_name: ${{ github.ref }}\n+          release_name: Release ${{ github.ref }}\n+          draft: true\n+          prerelease: false\n+      - uses: actions/download-artifact@v1\n+        with:\n+          name: sgrep-osx-${{ github.sha }}\n+          path: sgrep-osx\n+      - name: Get the version\n+        id: get_version\n+        run: echo ::set-output name=VERSION::${GITHUB_REF/refs\\/tags\\//}\n+      - name: help\n+        run: |\n+          pwd;\n+          ls;\n+          find .;\n+      - name: Upload Release Asset\n+        id: upload-release-asset-osx\n+        uses: actions/upload-release-asset@v1\n+        env:\n+          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}\n+        with:\n+          upload_url: ${{ steps.create_release.outputs.upload_url }}\n+          asset_path: ./sgrep-osx/artifacts.zip\n+          asset_name: sgrep-osx-${{ steps.get_version.outputs.VERSION }}.zip\n+          asset_content_type: application/zip\n+      - uses: actions/download-artifact@v1\n+        with:\n+          name: sgrep-ubuntu-16.04-${{ github.sha }}\n+          path: sgrep-ubuntu\n+      - name: Upload Release Asset\n+        id: upload-release-asset-ubuntu\n+        uses: actions/upload-release-asset@v1\n+        env:\n+          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}\n+        with:\n+          upload_url: ${{ steps.create_release.outputs.upload_url }}\n+          asset_path: ./sgrep-ubuntu/artifacts.tar.gz\n+          asset_name: sgrep-ubuntu-1604-${{ steps.get_version.outputs.VERSION }}.tar.gz\n+          asset_content_type: application/gzip\n+  release-osx:\n+    name: Build the OSX binaries\n+    runs-on: macos-latest\n+    # TODO: this is very similar to the mac-build workflow. Convert to an action\n+    steps:\n+      - name: Install System Deps\n+        run: brew install opam pkg-config coreutils\n+      - name: Checkout\n+        uses: actions/checkout@v2\n+      - name: OPAM setup\n+        run: |\n+          opam init --no-setup --bare;\n+          opam switch create 4.07.1;\n+          opam switch 4.07.1;\n+      - name: OPAM install Deps\n+        run: eval $(opam env); opam install -y reason dune ocamlfind camlp4 num ocamlgraph json-wheel conf-perl yaml\n+      - name: Install submodules\n+        run: git submodule update --init --recursive\n+      - name: Install pfff\n+        run: eval $(opam env) && opam install -y ./pfff\n+      - name: Install and test sgrep\n+        run: eval $(opam env) && cd sgrep && make all && make test && make install\n+      - name: Prepare artifacts\n+        run: |\n+          mkdir -p artifacts;\n+          cp ./sgrep/_build/default/bin/main_sgrep.exe artifacts/sgrep;\n+          zip -r artifacts.zip artifacts\n+\n+      - name: Upload artifacts\n+        uses: actions/upload-artifact@v1\n+        with:\n+          name: sgrep-osx-${{ github.sha }}\n+          path: artifacts.zip\n+  release-ubuntu-16-04:\n+    # TODO: this is very similar to the ubuntu-build workflow.\n+    # convert to github action to DRY", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNjQ3NDIwNQ=="}, "originalCommit": {"oid": "9f99f75d8685f29b0b733bd17ed0d99fb72cd9ce"}, "originalPosition": 96}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4819, "cost": 1, "resetAt": "2021-11-13T12:26:42Z"}}}