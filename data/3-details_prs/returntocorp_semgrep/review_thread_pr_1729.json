{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDkyNzMxNDIw", "number": 1729, "reviewThreads": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yNVQxNTozOTo0OFrOEngdAw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yNVQxNTo0MjozOFrOEnghHQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzA5ODYxNjM1OnYy", "diffSide": "RIGHT", "path": "semgrep-core/parsing/Parse_javascript_tree_sitter.ml", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yNVQxNTozOTo0OFrOHYI0Rw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yNVQyMjoyNjowN1rOHYVm8g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NTA3MjMyNw==", "bodyText": "I guess at some point we will need to extend ast_js.ml to describe more precisely this ?. construct instead\nof agglolmerating both in ObjAccess.", "url": "https://github.com/returntocorp/semgrep/pull/1729#discussion_r495072327", "createdAt": "2020-09-25T15:39:48Z", "author": {"login": "aryx"}, "path": "semgrep-core/parsing/Parse_javascript_tree_sitter.ml", "diffHunk": "@@ -715,19 +712,18 @@ and class_body (env : env) ((v1, v2, v3) : CST.class_body) =\n   let v3 = token env v3 (* \"}\" *) in\n   v1, v2, v3\n \n+and anon_choice_exp (env : env) (x : CST.anon_choice_exp) : expr =\n+  match x with\n+  | `Exp x -> expression env x\n+  | `Choice_this x -> primary_expression env x\n+\n and member_expression (env : env) ((v1, v2, v3) : CST.member_expression) : expr =\n-  let v1 =\n-    (match v1 with\n-    | `Exp x -> expression env x\n-    | `Id tok ->\n-          identifier_exp env tok (* identifier *)\n-    | `Super tok -> super env tok (* \"super\" *)\n-    | `Choice_get x ->\n-          let id = reserved_identifier env x in\n-          idexp id\n-    )\n+  let v1 = anon_choice_exp env v1 in\n+  let v2 =\n+    match v2 with\n+    | `DOT tok (* \".\" *)\n+    | `QMARKDOT (* \"?.\" *) tok -> token env tok\n   in\n-  let v2 = token env v2 (* \".\" *) in\n   let v3 = identifier env v3 (* identifier *) in\n   ObjAccess (v1, v2, PN v3)", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "71390472cd824023b89b70baecae235ab3d640ce"}, "originalPosition": 70}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NTI4MTkwNg==", "bodyText": "I added some to-dos. I suggest we take care of this later. At this point ?. is simply treated like normal access in all 3 cases (property access, function call, array access).", "url": "https://github.com/returntocorp/semgrep/pull/1729#discussion_r495281906", "createdAt": "2020-09-25T22:26:07Z", "author": {"login": "mjambon"}, "path": "semgrep-core/parsing/Parse_javascript_tree_sitter.ml", "diffHunk": "@@ -715,19 +712,18 @@ and class_body (env : env) ((v1, v2, v3) : CST.class_body) =\n   let v3 = token env v3 (* \"}\" *) in\n   v1, v2, v3\n \n+and anon_choice_exp (env : env) (x : CST.anon_choice_exp) : expr =\n+  match x with\n+  | `Exp x -> expression env x\n+  | `Choice_this x -> primary_expression env x\n+\n and member_expression (env : env) ((v1, v2, v3) : CST.member_expression) : expr =\n-  let v1 =\n-    (match v1 with\n-    | `Exp x -> expression env x\n-    | `Id tok ->\n-          identifier_exp env tok (* identifier *)\n-    | `Super tok -> super env tok (* \"super\" *)\n-    | `Choice_get x ->\n-          let id = reserved_identifier env x in\n-          idexp id\n-    )\n+  let v1 = anon_choice_exp env v1 in\n+  let v2 =\n+    match v2 with\n+    | `DOT tok (* \".\" *)\n+    | `QMARKDOT (* \"?.\" *) tok -> token env tok\n   in\n-  let v2 = token env v2 (* \".\" *) in\n   let v3 = identifier env v3 (* identifier *) in\n   ObjAccess (v1, v2, PN v3)", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NTA3MjMyNw=="}, "originalCommit": {"oid": "71390472cd824023b89b70baecae235ab3d640ce"}, "originalPosition": 70}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzA5ODYyNDE3OnYy", "diffSide": "RIGHT", "path": "semgrep-core/parsing/Parse_javascript_tree_sitter.ml", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yNVQxNTo0MTo1MFrOHYI5MQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yNVQxNTo0MTo1MFrOHYI5MQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NTA3MzU4NQ==", "bodyText": "again, probably need a new construct instead of putting in Apply.", "url": "https://github.com/returntocorp/semgrep/pull/1729#discussion_r495073585", "createdAt": "2020-09-25T15:41:50Z", "author": {"login": "aryx"}, "path": "semgrep-core/parsing/Parse_javascript_tree_sitter.ml", "diffHunk": "@@ -874,20 +871,30 @@ and constructable_expression (env : env) (x : CST.constructable_expression) : ex\n       let v3 = token env v3 (* \"target\" *) in\n       let t = PI.combine_infos v1 [v2;v3] in\n       IdSpecial (NewTarget, t)\n-  | `New_exp (v1, v2, v3) ->\n-      let v1 = token env v1 (* \"new\" *) in\n-      let v2 = constructable_expression env v2 in\n-      let (t1, xs, t2) =\n-        (match v3 with\n-        | Some x -> arguments env x\n-        | None -> fb [])\n-      in\n-      (* less: we should remove the extra Apply but that's what we do in pfff*)\n-      let newcall = Apply (IdSpecial (New, v1), fb [v2]) in\n-      Apply (newcall, (t1, xs, t2))\n-  )\n-\n \n+  | `Call_exp x ->\n+      (match x with\n+       | `Exp_choice_args (v1, v2) ->\n+           let v1 = expression env v1 in\n+           let v2 =\n+             (match v2 with\n+              | `Args x ->\n+                  let args = arguments env x in\n+                  Apply (v1, args)\n+              | `Temp_str x ->\n+                  let (t1, xs, t2) = template_string env x in\n+                  Apply (IdSpecial (Encaps true, t1),\n+                         (t1, v1::xs, t2))\n+             )\n+           in\n+           v2\n+       | `Choice_this_QMARKDOT_args (v1, v2, v3) ->\n+           let v1 = primary_expression env v1 in\n+           let _v2 = token env v2 (* \"?.\" *) in\n+           let v3 = arguments env v3 in\n+           Apply (v1, v3)", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "71390472cd824023b89b70baecae235ab3d640ce"}, "originalPosition": 149}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzA5ODYyNjg1OnYy", "diffSide": "RIGHT", "path": "semgrep-core/parsing/Parse_javascript_tree_sitter.ml", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yNVQxNTo0MjozOFrOHYI60g==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yNVQyMjoxMToyOVrOHYVEvg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NTA3NDAwMg==", "bodyText": "AST_generic.And is the logical and. (BitAnd is the bitwise and '&').", "url": "https://github.com/returntocorp/semgrep/pull/1729#discussion_r495074002", "createdAt": "2020-09-25T15:42:38Z", "author": {"login": "aryx"}, "path": "semgrep-core/parsing/Parse_javascript_tree_sitter.ml", "diffHunk": "@@ -1024,6 +1031,9 @@ and expression (env : env) (x : CST.expression) : expr =\n         | `GTGTGTEQ tok -> G.ASR, token env tok (* \">>>=\" *)\n         | `LTLTEQ tok -> G.LSL, token env tok (* \"<<=\" *)\n         | `STARSTAREQ tok -> G.Pow, token env tok (* \"**=\" *)\n+        | `AMPAMPEQ tok -> G.LogAndAss, token env tok (* \"&&=\" *)", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "71390472cd824023b89b70baecae235ab3d640ce"}, "originalPosition": 188}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NTI3MzE1MA==", "bodyText": "I fixed this for js and ts. It should transpile into the right thing now.", "url": "https://github.com/returntocorp/semgrep/pull/1729#discussion_r495273150", "createdAt": "2020-09-25T22:11:29Z", "author": {"login": "mjambon"}, "path": "semgrep-core/parsing/Parse_javascript_tree_sitter.ml", "diffHunk": "@@ -1024,6 +1031,9 @@ and expression (env : env) (x : CST.expression) : expr =\n         | `GTGTGTEQ tok -> G.ASR, token env tok (* \">>>=\" *)\n         | `LTLTEQ tok -> G.LSL, token env tok (* \"<<=\" *)\n         | `STARSTAREQ tok -> G.Pow, token env tok (* \"**=\" *)\n+        | `AMPAMPEQ tok -> G.LogAndAss, token env tok (* \"&&=\" *)", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NTA3NDAwMg=="}, "originalCommit": {"oid": "71390472cd824023b89b70baecae235ab3d640ce"}, "originalPosition": 188}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4868, "cost": 1, "resetAt": "2021-11-12T12:57:47Z"}}}