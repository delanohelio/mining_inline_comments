{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDEyMTI4NTI4", "number": 641, "title": "semgrep: Pass through include/exclude flags to semgrep-core (#479)", "bodyText": "Closes #616\nThis PR also adds a new -include-dir flag to complete the collection!\nWe didn't have it originally only because the requesting customer didn't need this one of the four.", "createdAt": "2020-05-01T13:23:26Z", "url": "https://github.com/returntocorp/semgrep/pull/641", "merged": true, "mergeCommit": {"oid": "73f1dc2b8eada870438704499b933ab0b4ff54b7"}, "closed": true, "closedAt": "2020-05-06T07:33:54Z", "author": {"login": "underyx"}, "timelineItems": {"totalCount": 16, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcdBrRFgBqjMyOTMxNzgzNTI=", "endCursor": "Y3Vyc29yOnYyOpPPAAABceb5c8AH2gAyNDEyMTI4NTI4OjM3MWQ1OTE5YjkyMDM4N2I1NjU0NTRjNGE4ZTFiYTljNmM1MjI3ZGE=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "aecd1cdd3825f11a538726eca377eb79bc6aa7e8", "author": {"user": {"login": "DrewDennison", "name": "Drew Dennison"}}, "url": "https://github.com/returntocorp/semgrep/commit/aecd1cdd3825f11a538726eca377eb79bc6aa7e8", "committedDate": "2020-05-01T13:22:52Z", "message": "sgrep_lint: Pass through include/exclude flags to sgrep (#479)\n\nCloses https://github.com/returntocorp/semgrep/issues/616\n\nAuthored-by: Bence Nagy <bence@underyx.me>\nSigned-off-by: Bence Nagy <bence@underyx.me>"}, "afterCommit": {"oid": "06307564cdae44863bffb2b960d909518d868108", "author": {"user": {"login": "DrewDennison", "name": "Drew Dennison"}}, "url": "https://github.com/returntocorp/semgrep/commit/06307564cdae44863bffb2b960d909518d868108", "committedDate": "2020-05-01T13:26:55Z", "message": "semgrep: Pass through include/exclude flags to semgrep-core (#479)\n\nCloses https://github.com/returntocorp/semgrep/issues/616\n\nAuthored-by: Bence Nagy <bence@underyx.me>\nSigned-off-by: Bence Nagy <bence@underyx.me>"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDA0MTc4OTU1", "url": "https://github.com/returntocorp/semgrep/pull/641#pullrequestreview-404178955", "createdAt": "2020-05-01T14:10:34Z", "commit": {"oid": "81c9b19709446f9c87dc46c4db1af80a0e71225a"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wMVQxNDoxMDozNFrOGPKuEA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wMVQxNDoxMDozNFrOGPKuEA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxODU1NzQ1Ng==", "bodyText": "These changes are just me standardizing the order to exclude, include, exclude-dir, include-dir.", "url": "https://github.com/returntocorp/semgrep/pull/641#discussion_r418557456", "createdAt": "2020-05-01T14:10:34Z", "author": {"login": "underyx"}, "path": "semgrep/semgrep/cli.py", "diffHunk": "@@ -64,23 +64,29 @@ def cli() -> None:\n     )\n \n     parser.add_argument(\n-        \"--include\",\n+        \"--exclude\",", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "81c9b19709446f9c87dc46c4db1af80a0e71225a"}, "originalPosition": 5}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDA0MTk2MTg5", "url": "https://github.com/returntocorp/semgrep/pull/641#pullrequestreview-404196189", "createdAt": "2020-05-01T14:41:33Z", "commit": {"oid": "069fd85e99511699ffb294b137b18acc109dc3e8"}, "state": "APPROVED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wMVQxNDo0MTozM1rOGPLkWQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wMVQxNDo0MTozM1rOGPLkWQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxODU3MTM1Mw==", "bodyText": "This will not work, because include_dirs, like exclude_dirs, apply the filter to the directory component of a path,\nit's not to a prefix of a path, so here you want ~include_dirs:[\"a\"] (or ~include_dirs:[\"b\"]).\nGREP exclude dirs work like that I think.\nI know @DrewDennison wanted to change that, but then you can have issues when the path is ./a/b/c\nand if you put \"a/b\" it will not match because it's not a prefix.", "url": "https://github.com/returntocorp/semgrep/pull/641#discussion_r418571353", "createdAt": "2020-05-01T14:41:33Z", "author": {"login": "aryx"}, "path": "semgrep-core/finding/unit_files.ml", "diffHunk": "@@ -15,7 +15,8 @@ let unittest =\n         let filters = Files_filter.mk_filters\n           ~excludes:[\"*.{c,h}\"; \"*.go\"]\n           ~includes:[\"foo.*\"]\n-          ~exclude_dirs:[\"c\"] in\n+          ~exclude_dirs:[\"c\"] \n+          ~include_dirs:[\"a/b\"] in", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "069fd85e99511699ffb294b137b18acc109dc3e8"}, "originalPosition": 6}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDA0MzQ3NzYz", "url": "https://github.com/returntocorp/semgrep/pull/641#pullrequestreview-404347763", "createdAt": "2020-05-01T19:16:07Z", "commit": {"oid": "069fd85e99511699ffb294b137b18acc109dc3e8"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wMVQxOToxNjowOFrOGPTF7g==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wMVQxOToxNjowOFrOGPTF7g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxODY5NDYzOA==", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                    help=\"Don't scan these directories, such as --exclude-dir='tests'. Add multiple times to exclude multiple patterns.\",\n          \n          \n            \n                    help=\"Skip any directory with this name; --exclude-dir=doc will ignore doc/ as well as src/doc. Can add multiple times. Overrides includes.\",", "url": "https://github.com/returntocorp/semgrep/pull/641#discussion_r418694638", "createdAt": "2020-05-01T19:16:08Z", "author": {"login": "underyx"}, "path": "semgrep/semgrep/cli.py", "diffHunk": "@@ -62,11 +62,30 @@ def cli() -> None:\n         help=f\"only invoke semgrep if config(s) are valid\",\n         action=\"store_true\",\n     )\n+\n     parser.add_argument(\n         \"--exclude\",\n         action=\"append\",\n         default=[],\n-        help=\"Path pattern to exclude. Can be added multiple times to exclude multiple patterns.\",\n+        help=\"Don't scan files with this filename, such as --exclude='*.js'. Add multiple times to exclude multiple patterns.\",\n+    )\n+    parser.add_argument(\n+        \"--include\",\n+        action=\"append\",\n+        default=[],\n+        help=\"Scan only files with this filename, such as --include='*.js'. Add multiple times to include multiple patterns.\",\n+    )\n+    parser.add_argument(\n+        \"--exclude-dir\",\n+        action=\"append\",\n+        default=[],\n+        help=\"Don't scan these directories, such as --exclude-dir='tests'. Add multiple times to exclude multiple patterns.\",", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "069fd85e99511699ffb294b137b18acc109dc3e8"}, "originalPosition": 22}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "069fd85e99511699ffb294b137b18acc109dc3e8", "author": {"user": {"login": "underyx", "name": "Bence Nagy"}}, "url": "https://github.com/returntocorp/semgrep/commit/069fd85e99511699ffb294b137b18acc109dc3e8", "committedDate": "2020-05-01T14:11:05Z", "message": "fixup! Add include-dir flag to semgrep-core and semgrep"}, "afterCommit": {"oid": "e56e2652aecbb6347c7e2ae0e02fb68d68a572e3", "author": {"user": {"login": "underyx", "name": "Bence Nagy"}}, "url": "https://github.com/returntocorp/semgrep/commit/e56e2652aecbb6347c7e2ae0e02fb68d68a572e3", "committedDate": "2020-05-05T19:46:48Z", "message": "Add include-dir flag to semgrep-core and semgrep\n\nThis was present in grep but not in semgrep."}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "e56e2652aecbb6347c7e2ae0e02fb68d68a572e3", "author": {"user": {"login": "underyx", "name": "Bence Nagy"}}, "url": "https://github.com/returntocorp/semgrep/commit/e56e2652aecbb6347c7e2ae0e02fb68d68a572e3", "committedDate": "2020-05-05T19:46:48Z", "message": "Add include-dir flag to semgrep-core and semgrep\n\nThis was present in grep but not in semgrep."}, "afterCommit": {"oid": "3554bfa4b8d45d9ac60df84ca55efcbe4f3dfc20", "author": {"user": {"login": "underyx", "name": "Bence Nagy"}}, "url": "https://github.com/returntocorp/semgrep/commit/3554bfa4b8d45d9ac60df84ca55efcbe4f3dfc20", "committedDate": "2020-05-05T19:48:23Z", "message": "Add include-dir flag to semgrep-core and semgrep\n\nThis was present in grep but not in semgrep."}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "3554bfa4b8d45d9ac60df84ca55efcbe4f3dfc20", "author": {"user": {"login": "underyx", "name": "Bence Nagy"}}, "url": "https://github.com/returntocorp/semgrep/commit/3554bfa4b8d45d9ac60df84ca55efcbe4f3dfc20", "committedDate": "2020-05-05T19:48:23Z", "message": "Add include-dir flag to semgrep-core and semgrep\n\nThis was present in grep but not in semgrep."}, "afterCommit": {"oid": "817f6f3b3cee44cebc064a423d48b4bd235cb027", "author": {"user": {"login": "underyx", "name": "Bence Nagy"}}, "url": "https://github.com/returntocorp/semgrep/commit/817f6f3b3cee44cebc064a423d48b4bd235cb027", "committedDate": "2020-05-05T19:49:58Z", "message": "Add include-dir flag to semgrep-core and semgrep\n\nThis was present in grep but not in semgrep."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "69d32c472d119e0d07c7d4849cb261ec3f5da2ef", "author": {"user": {"login": "DrewDennison", "name": "Drew Dennison"}}, "url": "https://github.com/returntocorp/semgrep/commit/69d32c472d119e0d07c7d4849cb261ec3f5da2ef", "committedDate": "2020-05-05T19:58:09Z", "message": "semgrep: Pass through include/exclude flags to semgrep-core (#479)\n\nCloses https://github.com/returntocorp/semgrep/issues/616\n\nAuthored-by: Bence Nagy <bence@underyx.me>\nSigned-off-by: Bence Nagy <bence@underyx.me>"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "817f6f3b3cee44cebc064a423d48b4bd235cb027", "author": {"user": {"login": "underyx", "name": "Bence Nagy"}}, "url": "https://github.com/returntocorp/semgrep/commit/817f6f3b3cee44cebc064a423d48b4bd235cb027", "committedDate": "2020-05-05T19:49:58Z", "message": "Add include-dir flag to semgrep-core and semgrep\n\nThis was present in grep but not in semgrep."}, "afterCommit": {"oid": "56bfff835f806060a7d9fc99b772fe26a105f7e6", "author": {"user": {"login": "underyx", "name": "Bence Nagy"}}, "url": "https://github.com/returntocorp/semgrep/commit/56bfff835f806060a7d9fc99b772fe26a105f7e6", "committedDate": "2020-05-05T19:58:10Z", "message": "Add include-dir flag to semgrep-core and semgrep\n\nThis was present in grep but not in semgrep."}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "56bfff835f806060a7d9fc99b772fe26a105f7e6", "author": {"user": {"login": "underyx", "name": "Bence Nagy"}}, "url": "https://github.com/returntocorp/semgrep/commit/56bfff835f806060a7d9fc99b772fe26a105f7e6", "committedDate": "2020-05-05T19:58:10Z", "message": "Add include-dir flag to semgrep-core and semgrep\n\nThis was present in grep but not in semgrep."}, "afterCommit": {"oid": "c0de26bca4af3f0c379ba5d5f77e2f936f67bbd9", "author": {"user": {"login": "underyx", "name": "Bence Nagy"}}, "url": "https://github.com/returntocorp/semgrep/commit/c0de26bca4af3f0c379ba5d5f77e2f936f67bbd9", "committedDate": "2020-05-05T20:02:41Z", "message": "Add include-dir flag to semgrep-core and semgrep\n\nThis was present in grep but not in semgrep."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "10a6d533e78a64673b373800b1436fc84ab947d5", "author": {"user": {"login": "underyx", "name": "Bence Nagy"}}, "url": "https://github.com/returntocorp/semgrep/commit/10a6d533e78a64673b373800b1436fc84ab947d5", "committedDate": "2020-05-05T20:03:13Z", "message": "Add include-dir flag to semgrep-core and semgrep\n\nThis was present in grep but not in semgrep."}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "c0de26bca4af3f0c379ba5d5f77e2f936f67bbd9", "author": {"user": {"login": "underyx", "name": "Bence Nagy"}}, "url": "https://github.com/returntocorp/semgrep/commit/c0de26bca4af3f0c379ba5d5f77e2f936f67bbd9", "committedDate": "2020-05-05T20:02:41Z", "message": "Add include-dir flag to semgrep-core and semgrep\n\nThis was present in grep but not in semgrep."}, "afterCommit": {"oid": "10a6d533e78a64673b373800b1436fc84ab947d5", "author": {"user": {"login": "underyx", "name": "Bence Nagy"}}, "url": "https://github.com/returntocorp/semgrep/commit/10a6d533e78a64673b373800b1436fc84ab947d5", "committedDate": "2020-05-05T20:03:13Z", "message": "Add include-dir flag to semgrep-core and semgrep\n\nThis was present in grep but not in semgrep."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "956b308fa9472bde9821f3a5203db8118e49d29a", "author": {"user": {"login": "brendongo", "name": "Brendon Go"}}, "url": "https://github.com/returntocorp/semgrep/commit/956b308fa9472bde9821f3a5203db8118e49d29a", "committedDate": "2020-05-05T20:46:41Z", "message": "Fix changelog"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDA2MTQyNzMz", "url": "https://github.com/returntocorp/semgrep/pull/641#pullrequestreview-406142733", "createdAt": "2020-05-05T20:47:15Z", "commit": {"oid": "956b308fa9472bde9821f3a5203db8118e49d29a"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "60a64d601e01e9f66006b1a60f352c9bcb6e114c", "author": {"user": {"login": "brendongo", "name": "Brendon Go"}}, "url": "https://github.com/returntocorp/semgrep/commit/60a64d601e01e9f66006b1a60f352c9bcb6e114c", "committedDate": "2020-05-05T22:13:14Z", "message": "fixup! Add include-dir flag to semgrep-core and semgrep"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "371d5919b920387b565454c4a8e1ba9c6c5227da", "author": {"user": {"login": "brendongo", "name": "Brendon Go"}}, "url": "https://github.com/returntocorp/semgrep/commit/371d5919b920387b565454c4a8e1ba9c6c5227da", "committedDate": "2020-05-05T22:34:00Z", "message": "fixup! Add include-dir flag to semgrep-core and semgrep"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 929, "cost": 1, "resetAt": "2021-11-01T16:37:27Z"}}}