{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDg0NTMzODcx", "number": 1668, "title": "Use base image for docker build", "bodyText": "Two changes:\n\nUse returntocorp/ocaml images instead of mjambon/r2c-ocaml.\nAlso use this image in the dockerfile, which will speed up the build and simplify maintenance.\n\nBackground: our ocaml-layer setup now runs a weekly job that builds base images (alpine and ubuntu) with the desired version of ocaml and most or all external dependencies. This is meant to speed up CI jobs.\nRelies on #1666", "createdAt": "2020-09-11T01:56:25Z", "url": "https://github.com/returntocorp/semgrep/pull/1668", "merged": true, "mergeCommit": {"oid": "96156bc0977c20d714f7adbeb76e55604e00fcce"}, "closed": true, "closedAt": "2020-09-15T01:13:27Z", "author": {"login": "mjambon"}, "timelineItems": {"totalCount": 7, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdHrGNGAH2gAyNDg0NTMzODcxOjAzZTkwYzQ1NjM0N2VmOTI1MGRjMjgzMjRmNTVmM2Q5OWNmYTE3MjU=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdI5eA0AH2gAyNDg0NTMzODcxOjZhYzY3YWE0Zjc1OTI5ZmE2NGNjZGVhZTZlNDI5YThjZjY2ZWY4ZmU=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "03e90c456347ef9250dc28324f55f3d99cfa1725", "author": {"user": null}, "url": "https://github.com/returntocorp/semgrep/commit/03e90c456347ef9250dc28324f55f3d99cfa1725", "committedDate": "2020-09-11T01:27:24Z", "message": "Use ocaml base images hosted on r2c's DockerHub account."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e73e34258d31ca07b65eaa12be989d2352921283", "author": {"user": null}, "url": "https://github.com/returntocorp/semgrep/commit/e73e34258d31ca07b65eaa12be989d2352921283", "committedDate": "2020-09-11T01:43:27Z", "message": "Use base ocaml image with pre-installed opam packages for\nthe dockerfile build."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDg2OTYxMzc5", "url": "https://github.com/returntocorp/semgrep/pull/1668#pullrequestreview-486961379", "createdAt": "2020-09-11T16:42:11Z", "commit": {"oid": "e73e34258d31ca07b65eaa12be989d2352921283"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xMVQxNjo0MjoxMVrOHQmF_w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xMVQxNjo0MjoxMVrOHQmF_w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NzE2MzM5MQ==", "bodyText": "Can we pin this to a specific hash. We want this public docker image to build as deterministically as possible", "url": "https://github.com/returntocorp/semgrep/pull/1668#discussion_r487163391", "createdAt": "2020-09-11T16:42:11Z", "author": {"login": "brendongo"}, "path": "Dockerfile", "diffHunk": "@@ -6,19 +6,15 @@\n # of the 'semgrep' wrapping.\n #\n \n-FROM ocaml/opam2:alpine@sha256:4c2ce9a181b4b12442a68fc221d0b753959ec80e24eae3bf788eeca4dcb9a293 as build-semgrep-core\n+FROM returntocorp/ocaml:alpine as build-semgrep-core", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "e73e34258d31ca07b65eaa12be989d2352921283"}, "originalPosition": 5}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDg2OTg0Njc0", "url": "https://github.com/returntocorp/semgrep/pull/1668#pullrequestreview-486984674", "createdAt": "2020-09-11T17:17:08Z", "commit": {"oid": "e73e34258d31ca07b65eaa12be989d2352921283"}, "state": "COMMENTED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "5c556366a81648216b6c5b997202e1f0ce08f81b", "author": {"user": null}, "url": "https://github.com/returntocorp/semgrep/commit/5c556366a81648216b6c5b997202e1f0ce08f81b", "committedDate": "2020-09-12T04:24:55Z", "message": "Use immutable image for main dockerfile"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDg4MDAwNDQw", "url": "https://github.com/returntocorp/semgrep/pull/1668#pullrequestreview-488000440", "createdAt": "2020-09-14T17:38:23Z", "commit": {"oid": "5c556366a81648216b6c5b997202e1f0ce08f81b"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "6ac67aa4f75929fa64ccdeae6e429a8cf66ef8fe", "author": {"user": null}, "url": "https://github.com/returntocorp/semgrep/commit/6ac67aa4f75929fa64ccdeae6e429a8cf66ef8fe", "committedDate": "2020-09-14T20:46:00Z", "message": "Merge remote-tracking branch 'origin/develop' into ocaml-base"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1246, "cost": 1, "resetAt": "2021-11-01T16:37:27Z"}}}