{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDkyNzMxNDIw", "number": 1729, "title": "Update javascript and typescript parsers for latest tree-sitter grammars", "bodyText": "Relies on returntocorp/pfff#308", "createdAt": "2020-09-24T22:28:35Z", "url": "https://github.com/returntocorp/semgrep/pull/1729", "merged": true, "mergeCommit": {"oid": "bbe8939b8d5f355a77eddccec6223eb8d92b62cf"}, "closed": true, "closedAt": "2020-09-26T02:40:13Z", "author": {"login": "mjambon"}, "timelineItems": {"totalCount": 8, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdLydWlgH2gAyNDkyNzMxNDIwOjQwZWZhNDg4MWYxN2E5ZjljZTNlODQwNDdmMmJkODYwYTU1YTZlOTM=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdMdc2SgH2gAyNDkyNzMxNDIwOjA5YWE5ZjM3NWM3Zjk3OWU1Y2VjOGQ2NGZlY2U3ZTk4ZjU0ZmYxYTc=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "40efa4881f17a9f9ce3e84047f2bd860a55a6e93", "author": {"user": null}, "url": "https://github.com/returntocorp/semgrep/commit/40efa4881f17a9f9ce3e84047f2bd860a55a6e93", "committedDate": "2020-09-23T20:17:43Z", "message": "Use latest ocaml-tree-sitter-lang, with breaking changes for javascript\nand typescript. Update the unified ts/tsx CST type definitions."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "aa0972bbb45d3752a880a13f16ebe003afdc2f52", "author": {"user": null}, "url": "https://github.com/returntocorp/semgrep/commit/aa0972bbb45d3752a880a13f16ebe003afdc2f52", "committedDate": "2020-09-24T01:43:06Z", "message": "Fix javascript converter from cst to ast."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b90582fc3f285b6c68dcbcb0a2b39a994deda710", "author": {"user": null}, "url": "https://github.com/returntocorp/semgrep/commit/b90582fc3f285b6c68dcbcb0a2b39a994deda710", "committedDate": "2020-09-24T21:57:22Z", "message": "Update typescript tree-sitter parser"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "71390472cd824023b89b70baecae235ab3d640ce", "author": {"user": null}, "url": "https://github.com/returntocorp/semgrep/commit/71390472cd824023b89b70baecae235ab3d640ce", "committedDate": "2020-09-24T22:27:28Z", "message": "Merge remote-tracking branch 'origin/develop' into ts"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDk2NTM1Njc2", "url": "https://github.com/returntocorp/semgrep/pull/1729#pullrequestreview-496535676", "createdAt": "2020-09-25T15:39:48Z", "commit": {"oid": "71390472cd824023b89b70baecae235ab3d640ce"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yNVQxNTozOTo0OFrOHYI0Rw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yNVQxNTo0MjozOFrOHYI60g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NTA3MjMyNw==", "bodyText": "I guess at some point we will need to extend ast_js.ml to describe more precisely this ?. construct instead\nof agglolmerating both in ObjAccess.", "url": "https://github.com/returntocorp/semgrep/pull/1729#discussion_r495072327", "createdAt": "2020-09-25T15:39:48Z", "author": {"login": "aryx"}, "path": "semgrep-core/parsing/Parse_javascript_tree_sitter.ml", "diffHunk": "@@ -715,19 +712,18 @@ and class_body (env : env) ((v1, v2, v3) : CST.class_body) =\n   let v3 = token env v3 (* \"}\" *) in\n   v1, v2, v3\n \n+and anon_choice_exp (env : env) (x : CST.anon_choice_exp) : expr =\n+  match x with\n+  | `Exp x -> expression env x\n+  | `Choice_this x -> primary_expression env x\n+\n and member_expression (env : env) ((v1, v2, v3) : CST.member_expression) : expr =\n-  let v1 =\n-    (match v1 with\n-    | `Exp x -> expression env x\n-    | `Id tok ->\n-          identifier_exp env tok (* identifier *)\n-    | `Super tok -> super env tok (* \"super\" *)\n-    | `Choice_get x ->\n-          let id = reserved_identifier env x in\n-          idexp id\n-    )\n+  let v1 = anon_choice_exp env v1 in\n+  let v2 =\n+    match v2 with\n+    | `DOT tok (* \".\" *)\n+    | `QMARKDOT (* \"?.\" *) tok -> token env tok\n   in\n-  let v2 = token env v2 (* \".\" *) in\n   let v3 = identifier env v3 (* identifier *) in\n   ObjAccess (v1, v2, PN v3)", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "71390472cd824023b89b70baecae235ab3d640ce"}, "originalPosition": 70}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NTA3MzU4NQ==", "bodyText": "again, probably need a new construct instead of putting in Apply.", "url": "https://github.com/returntocorp/semgrep/pull/1729#discussion_r495073585", "createdAt": "2020-09-25T15:41:50Z", "author": {"login": "aryx"}, "path": "semgrep-core/parsing/Parse_javascript_tree_sitter.ml", "diffHunk": "@@ -874,20 +871,30 @@ and constructable_expression (env : env) (x : CST.constructable_expression) : ex\n       let v3 = token env v3 (* \"target\" *) in\n       let t = PI.combine_infos v1 [v2;v3] in\n       IdSpecial (NewTarget, t)\n-  | `New_exp (v1, v2, v3) ->\n-      let v1 = token env v1 (* \"new\" *) in\n-      let v2 = constructable_expression env v2 in\n-      let (t1, xs, t2) =\n-        (match v3 with\n-        | Some x -> arguments env x\n-        | None -> fb [])\n-      in\n-      (* less: we should remove the extra Apply but that's what we do in pfff*)\n-      let newcall = Apply (IdSpecial (New, v1), fb [v2]) in\n-      Apply (newcall, (t1, xs, t2))\n-  )\n-\n \n+  | `Call_exp x ->\n+      (match x with\n+       | `Exp_choice_args (v1, v2) ->\n+           let v1 = expression env v1 in\n+           let v2 =\n+             (match v2 with\n+              | `Args x ->\n+                  let args = arguments env x in\n+                  Apply (v1, args)\n+              | `Temp_str x ->\n+                  let (t1, xs, t2) = template_string env x in\n+                  Apply (IdSpecial (Encaps true, t1),\n+                         (t1, v1::xs, t2))\n+             )\n+           in\n+           v2\n+       | `Choice_this_QMARKDOT_args (v1, v2, v3) ->\n+           let v1 = primary_expression env v1 in\n+           let _v2 = token env v2 (* \"?.\" *) in\n+           let v3 = arguments env v3 in\n+           Apply (v1, v3)", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "71390472cd824023b89b70baecae235ab3d640ce"}, "originalPosition": 149}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NTA3NDAwMg==", "bodyText": "AST_generic.And is the logical and. (BitAnd is the bitwise and '&').", "url": "https://github.com/returntocorp/semgrep/pull/1729#discussion_r495074002", "createdAt": "2020-09-25T15:42:38Z", "author": {"login": "aryx"}, "path": "semgrep-core/parsing/Parse_javascript_tree_sitter.ml", "diffHunk": "@@ -1024,6 +1031,9 @@ and expression (env : env) (x : CST.expression) : expr =\n         | `GTGTGTEQ tok -> G.ASR, token env tok (* \">>>=\" *)\n         | `LTLTEQ tok -> G.LSL, token env tok (* \"<<=\" *)\n         | `STARSTAREQ tok -> G.Pow, token env tok (* \"**=\" *)\n+        | `AMPAMPEQ tok -> G.LogAndAss, token env tok (* \"&&=\" *)", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "71390472cd824023b89b70baecae235ab3d640ce"}, "originalPosition": 188}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "d24b472ec3fe8e012b55bf4ccd8c14ea41f4f560", "author": {"user": null}, "url": "https://github.com/returntocorp/semgrep/commit/d24b472ec3fe8e012b55bf4ccd8c14ea41f4f560", "committedDate": "2020-09-25T20:55:50Z", "message": "Fix translation of logical assignment operators (js, ts)."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDk2ODk0MjU1", "url": "https://github.com/returntocorp/semgrep/pull/1729#pullrequestreview-496894255", "createdAt": "2020-09-25T22:21:13Z", "commit": {"oid": "d24b472ec3fe8e012b55bf4ccd8c14ea41f4f560"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "09aa9f375c7f979e5cec8d64fece7e98f54ff1a7", "author": {"user": null}, "url": "https://github.com/returntocorp/semgrep/commit/09aa9f375c7f979e5cec8d64fece7e98f54ff1a7", "committedDate": "2020-09-25T22:23:05Z", "message": "Add to-do notes about representing '?.' properly in the AST."}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1264, "cost": 1, "resetAt": "2021-11-01T16:37:27Z"}}}