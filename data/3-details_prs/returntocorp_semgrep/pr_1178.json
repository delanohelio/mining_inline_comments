{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDQyNzI5Mjk4", "number": 1178, "title": "Remove final Bento usage from project", "bodyText": "\ud83c\udf89", "createdAt": "2020-07-01T14:15:12Z", "url": "https://github.com/returntocorp/semgrep/pull/1178", "merged": true, "mergeCommit": {"oid": "0dd3e6c55ce0a9b6f5f00bbee30250cadee69782"}, "closed": true, "closedAt": "2020-07-01T18:19:59Z", "author": {"login": "mschwager"}, "timelineItems": {"totalCount": 9, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcwq5zoAH2gAyNDQyNzI5Mjk4OjM0YTRkMTQwMTdlNGE0Yzg0YjNmNmNmMzE3NzQ3YmViNGU0MzEwMDk=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcwtgvOAFqTQ0MTA1NzM5Nw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "34a4d14017e4a4c84b3f6cf317747beb4e431009", "author": {"user": {"login": "mschwager", "name": null}}, "url": "https://github.com/returntocorp/semgrep/commit/34a4d14017e4a4c84b3f6cf317747beb4e431009", "committedDate": "2020-07-01T14:13:36Z", "message": "Remove final Bento usage from project"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDQwOTEwODM0", "url": "https://github.com/returntocorp/semgrep/pull/1178#pullrequestreview-440910834", "createdAt": "2020-07-01T14:15:48Z", "commit": {"oid": "34a4d14017e4a4c84b3f6cf317747beb4e431009"}, "state": "COMMENTED", "comments": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wMVQxNDoxNTo0OFrOGrn0SA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wMVQxNDoxODoxNFrOGrn6bw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0ODM5NDMxMg==", "bodyText": "Bento flake8 included bugbear.", "url": "https://github.com/returntocorp/semgrep/pull/1178#discussion_r448394312", "createdAt": "2020-07-01T14:15:48Z", "author": {"login": "mschwager"}, "path": ".pre-commit-config.yaml", "diffHunk": "@@ -34,22 +34,38 @@ repos:\n         args: [--config, mypy.ini]\n \n   - repo: https://gitlab.com/pycqa/flake8\n-    rev: \"3.7.9\"\n+    rev: \"3.8.3\"\n     hooks:\n       - id: flake8\n-        args: [\"--select=E9,F63,F7,F82\"]\n+        additional_dependencies: [\"flake8-bugbear==20.1.4\"]", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "34a4d14017e4a4c84b3f6cf317747beb4e431009"}, "originalPosition": 9}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0ODM5NDg0NA==", "bodyText": "It's faster to do include/exclude in pre-commit vs. waiting until semgrep is run.", "url": "https://github.com/returntocorp/semgrep/pull/1178#discussion_r448394844", "createdAt": "2020-07-01T14:16:38Z", "author": {"login": "mschwager"}, "path": ".pre-commit-config.yaml", "diffHunk": "@@ -34,22 +34,38 @@ repos:\n         args: [--config, mypy.ini]\n \n   - repo: https://gitlab.com/pycqa/flake8\n-    rev: \"3.7.9\"\n+    rev: \"3.8.3\"\n     hooks:\n       - id: flake8\n-        args: [\"--select=E9,F63,F7,F82\"]\n+        additional_dependencies: [\"flake8-bugbear==20.1.4\"]\n+        args: [\"--select=B,E9,F63,F7,F82\"]\n \n   - repo: https://github.com/returntocorp/semgrep\n     rev: 'v0.12.0'\n     hooks:\n       - id: semgrep-develop\n-        args: ['--config', 'https://semgrep.live/p/python', '--include', '*.py', '--precommit', '--error']\n+        name: Semgrep Python\n+        types: [python]", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "34a4d14017e4a4c84b3f6cf317747beb4e431009"}, "originalPosition": 18}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0ODM5NTMzOQ==", "bodyText": "I moved this here for easier access to sub_run.", "url": "https://github.com/returntocorp/semgrep/pull/1178#discussion_r448395339", "createdAt": "2020-07-01T14:17:23Z", "author": {"login": "mschwager"}, "path": "semgrep/semgrep/util.py", "diffHunk": "@@ -128,3 +130,30 @@ def progress_bar(\n         wrapped: Iterable[T] = tqdm(listified, file=file, **kwargs)\n         return wrapped\n     return listified\n+\n+\n+def sub_run(cmd: List[str], **kwargs: Any) -> Any:\n+    \"\"\"A simple proxy function to minimize and centralize subprocess usage.\"\"\"\n+    # fmt: off\n+    result = subprocess.run(cmd, **kwargs)  # nosem: python.lang.security.audit.dangerous-subprocess-use.dangerous-subprocess-use\n+    # fmt: on\n+    return result\n+\n+\n+def sub_check_output(cmd: List[str], **kwargs: Any) -> Any:\n+    \"\"\"A simple proxy function to minimize and centralize subprocess usage.\"\"\"\n+    # fmt: off\n+    result = subprocess.check_output(cmd, **kwargs)  # nosem: python.lang.security.audit.dangerous-subprocess-use.dangerous-subprocess-use\n+    # fmt: on\n+    return result\n+\n+\n+def compute_semgrep_path() -> str:", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "34a4d14017e4a4c84b3f6cf317747beb4e431009"}, "originalPosition": 30}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0ODM5NTg4Nw==", "bodyText": "@minusworld ++", "url": "https://github.com/returntocorp/semgrep/pull/1178#discussion_r448395887", "createdAt": "2020-07-01T14:18:14Z", "author": {"login": "mschwager"}, "path": ".pre-commit-config.yaml", "diffHunk": "@@ -34,22 +34,38 @@ repos:\n         args: [--config, mypy.ini]\n \n   - repo: https://gitlab.com/pycqa/flake8\n-    rev: \"3.7.9\"\n+    rev: \"3.8.3\"\n     hooks:\n       - id: flake8\n-        args: [\"--select=E9,F63,F7,F82\"]\n+        additional_dependencies: [\"flake8-bugbear==20.1.4\"]\n+        args: [\"--select=B,E9,F63,F7,F82\"]\n \n   - repo: https://github.com/returntocorp/semgrep\n     rev: 'v0.12.0'\n     hooks:\n       - id: semgrep-develop\n-        args: ['--config', 'https://semgrep.live/p/python', '--include', '*.py', '--precommit', '--error']\n+        name: Semgrep Python\n+        types: [python]\n+        exclude: \"^semgrep/tests/.+$|^install-scripts/.+$|^release-scripts/.+$\"\n+        args: ['--config', 'https://semgrep.live/p/python', '--precommit', '--error']\n \n   - repo: https://github.com/returntocorp/semgrep\n     rev: 'v0.12.0'\n     hooks:\n       - id: semgrep-develop\n-        args: ['--config', '.bento/semgrep.yml', '--include', '*.py', '--precommit', '--error']\n+        name: Semgrep Bandit\n+        types: [python]\n+        exclude: \"^semgrep/tests/.+$|^install-scripts/.+$|^release-scripts/.+$\"\n+        args: ['--config', 'https://semgrep.live/p/bandit', '--precommit', '--error']", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "34a4d14017e4a4c84b3f6cf317747beb4e431009"}, "originalPosition": 30}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "050673d6c438eb961c72f78b8c71a035a374d19d", "author": {"user": {"login": "mschwager", "name": null}}, "url": "https://github.com/returntocorp/semgrep/commit/050673d6c438eb961c72f78b8c71a035a374d19d", "committedDate": "2020-07-01T14:26:51Z", "message": "Fix CI failures"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDQwOTIyMjgy", "url": "https://github.com/returntocorp/semgrep/pull/1178#pullrequestreview-440922282", "createdAt": "2020-07-01T14:28:20Z", "commit": {"oid": "050673d6c438eb961c72f78b8c71a035a374d19d"}, "state": "COMMENTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wMVQxNDoyODoyMFrOGroVjw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wMVQxNDozMDoxNFrOGrobJg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0ODQwMjgzMQ==", "bodyText": "This is now handled with the \"Semgrep Local\" pre-commit hook.", "url": "https://github.com/returntocorp/semgrep/pull/1178#discussion_r448402831", "createdAt": "2020-07-01T14:28:20Z", "author": {"login": "mschwager"}, "path": ".github/workflows/lint.yml", "diffHunk": "@@ -38,19 +26,6 @@ jobs:\n           publishToken: ${{ secrets.SEMGREP_APP_TOKEN }}\n           publishDeployment: ${{ secrets.SEMGREP_APP_DEPLOYMENT_ID }}\n \n-  semgrep-run-local-rules:", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "050673d6c438eb961c72f78b8c71a035a374d19d"}, "originalPosition": 23}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0ODQwNDI2Mg==", "bodyText": "I added an ignore for setup.py in the linting configuration instead of inline ignores, it seems like more trouble than it's worth at this point.", "url": "https://github.com/returntocorp/semgrep/pull/1178#discussion_r448404262", "createdAt": "2020-07-01T14:30:14Z", "author": {"login": "mschwager"}, "path": "semgrep/setup.py", "diffHunk": "@@ -86,13 +86,11 @@ def run(self):\n             os.putenv(\"SKIP_NUITKA\", \"TRUE\")\n             if \"osx\" in distutils.util.get_platform():\n                 with chdir(repo_root):\n-                    os.system(  # nosem: contrib.dlint.dlint-equivalent.insecure-os-exec-use\n-                        os.path.join(repo_root, \"release-scripts/osx-release.sh\")\n-                    )\n+                    os.system(os.path.join(repo_root, \"release-scripts/osx-release.sh\"))", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "050673d6c438eb961c72f78b8c71a035a374d19d"}, "originalPosition": 7}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDQwOTY5MDY4", "url": "https://github.com/returntocorp/semgrep/pull/1178#pullrequestreview-440969068", "createdAt": "2020-07-01T15:19:14Z", "commit": {"oid": "050673d6c438eb961c72f78b8c71a035a374d19d"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wMVQxNToxOToxNFrOGrqdxg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wMVQxNToxOToxNFrOGrqdxg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0ODQzNzcwMg==", "bodyText": "Do we still need the nosem in the source files, if we're now excluding setup.py?", "url": "https://github.com/returntocorp/semgrep/pull/1178#discussion_r448437702", "createdAt": "2020-07-01T15:19:14Z", "author": {"login": "nbrahms"}, "path": ".bento/archive.json", "diffHunk": "@@ -1,51 +0,0 @@\n-{\n-  \"bandit\": {\n-    \"violations\": {\n-      \"4e0db4785748aff9799910743970a07b\": {\n-        \"tool_id\": \"bandit\",\n-        \"check_id\": \"start-process-with-a-shell\",\n-        \"path\": \"semgrep/setup.py\",\n-        \"message\": \"Starting a process with a shell, possible injection detected, security issue.\",\n-        \"severity\": 2,\n-        \"syntactic_context\": \"os.system(  # nosem: contrib.dlint.dlint-equivalent.insecure-os-exec-use\\n    os.path.join(repo_root, \\\"release-scripts/ubuntu-release.sh\\\")\"", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "050673d6c438eb961c72f78b8c71a035a374d19d"}, "originalPosition": 10}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDQwOTY5MTM0", "url": "https://github.com/returntocorp/semgrep/pull/1178#pullrequestreview-440969134", "createdAt": "2020-07-01T15:19:18Z", "commit": {"oid": "050673d6c438eb961c72f78b8c71a035a374d19d"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDQwOTcxOTgy", "url": "https://github.com/returntocorp/semgrep/pull/1178#pullrequestreview-440971982", "createdAt": "2020-07-01T15:22:38Z", "commit": {"oid": "050673d6c438eb961c72f78b8c71a035a374d19d"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wMVQxNToyMjozOFrOGrqmMQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wMVQxNToyMjozOFrOGrqmMQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0ODQzOTg1Nw==", "bodyText": "It seems like it makes more sense just to remove the rule from the pack, if we effectively don't want to use it on this project at all.", "url": "https://github.com/returntocorp/semgrep/pull/1178#discussion_r448439857", "createdAt": "2020-07-01T15:22:38Z", "author": {"login": "nbrahms"}, "path": "semgrep/semgrep/util.py", "diffHunk": "@@ -128,3 +130,30 @@ def progress_bar(\n         wrapped: Iterable[T] = tqdm(listified, file=file, **kwargs)\n         return wrapped\n     return listified\n+\n+\n+def sub_run(cmd: List[str], **kwargs: Any) -> Any:\n+    \"\"\"A simple proxy function to minimize and centralize subprocess usage.\"\"\"\n+    # fmt: off\n+    result = subprocess.run(cmd, **kwargs)  # nosem: python.lang.security.audit.dangerous-subprocess-use.dangerous-subprocess-use", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "050673d6c438eb961c72f78b8c71a035a374d19d"}, "originalPosition": 17}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDQxMDI5NzQz", "url": "https://github.com/returntocorp/semgrep/pull/1178#pullrequestreview-441029743", "createdAt": "2020-07-01T16:35:33Z", "commit": {"oid": "050673d6c438eb961c72f78b8c71a035a374d19d"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wMVQxNjozNTozM1rOGrtU4A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wMVQxNjozNTozM1rOGrtU4A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0ODQ4NDU3Ng==", "bodyText": "Bento flake8 also included flake8-json, and flake8-debugger is there anything in those worth keeping?", "url": "https://github.com/returntocorp/semgrep/pull/1178#discussion_r448484576", "createdAt": "2020-07-01T16:35:33Z", "author": {"login": "brendongo"}, "path": ".bento/config.yml", "diffHunk": "@@ -1,35 +0,0 @@\n-autorun:\n-  block: true\n-formatter:\n-- clippy: {}\n-tools:\n-  bandit:\n-    ignore:\n-    - any-other-function-with-shell-equals-true\n-    - assert-used\n-    - hardcoded-bind-all-interfaces\n-    - hardcoded-password-default\n-    - hardcoded-password-funcarg\n-    - hardcoded-password-string\n-    - hardcoded-sql-expressions\n-    - hardcoded-tmp-directory\n-    - import-lxml\n-    - import-pickle\n-    - import-subprocess\n-    - import-xml-expat\n-    - import-xml-minidom\n-    - import-xml-pulldom\n-    - import-xml-sax\n-    - import_xml-etree\n-    - md5\n-    - random\n-    - start-process-with-no-shell\n-    - start-process-with-partial-path\n-    - subprocess-without-shell-equals-true\n-    - try-except-continue\n-    - urllib-urlopen\n-    run: true\n-  flake8:", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "050673d6c438eb961c72f78b8c71a035a374d19d"}, "originalPosition": 32}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDQxMDU3Mzk3", "url": "https://github.com/returntocorp/semgrep/pull/1178#pullrequestreview-441057397", "createdAt": "2020-07-01T17:15:56Z", "commit": {"oid": "050673d6c438eb961c72f78b8c71a035a374d19d"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wMVQxNzoxNTo1NlrOGrupaw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wMVQxNzoxNTo1NlrOGrupaw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0ODUwNjIxOQ==", "bodyText": "Do these get autoformatted otherwise?", "url": "https://github.com/returntocorp/semgrep/pull/1178#discussion_r448506219", "createdAt": "2020-07-01T17:15:56Z", "author": {"login": "brendongo"}, "path": "semgrep/semgrep/util.py", "diffHunk": "@@ -128,3 +130,30 @@ def progress_bar(\n         wrapped: Iterable[T] = tqdm(listified, file=file, **kwargs)\n         return wrapped\n     return listified\n+\n+\n+def sub_run(cmd: List[str], **kwargs: Any) -> Any:\n+    \"\"\"A simple proxy function to minimize and centralize subprocess usage.\"\"\"\n+    # fmt: off", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "050673d6c438eb961c72f78b8c71a035a374d19d"}, "originalPosition": 16}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1451, "cost": 1, "resetAt": "2021-11-01T16:37:27Z"}}}