{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTMyODk4MjYz", "number": 2194, "title": "basic stats in json output", "bodyText": "We have quite a few upcoming projects where we're going to be asking questions about what % of the codebase semgrep is actually analyzing. I am using this for a personal project. Cc @clintgibler @DrewDennison who I think are interested as well.\nrelated to #1208\nTODO\n\n gate behind --json-stats flag\n hide the flag and mark it as experimental\n consider adding line / sloccount for the files if --stats is passed\n add a rule_profile key which tracks which rules took the longest\n\nNote to reviewers: had to move some of target_manager.py to target_manager_extension.pyto avoid a circular dependency.\n@dlukeomalley do you think we should hide this flag from --help if it's currently intended mainly for our internal use? [I made it hidden]\nexample output\n  \"stats\": {\n    \"targets\": {\n      \"extensions\": {\n        \".py\": 1043,\n        \".pyi\": 7\n      },\n      \"languages\": {\n        \"py\": 1050\n      }\n    },\n    \"loc\": {\n      \"by_extension\": {\n        \".py\": 166978,\n        \".pyi\": 251\n      }\n    }\n  }\n}\nine@imbp4 ~/D/r/s/semgrep (ie/stats)> loc ~/Documents/returntocorp/test-repos/zulip/\n--------------------------------------------------------------------------------\n Language             Files        Lines        Blank      Comment         Code\n--------------------------------------------------------------------------------\n JSON                   884       337428          609            0       336819\n Python                1043       166978        25205        15645       126128\n\nexample output (profiling)\n\"profiler\": {\n      \"python.lang.correctness.dict-modify-iterating.dict-del-while-iterate\": [\n        0.2613539695739746\n      ],\n      \"python.lang.correctness.useless-comparison.no-strings-as-booleans\": [\n        0.29020214080810547\n      ],\n      \"python.lang.correctness.exit.use-sys-exit\": [\n        0.2967250347137451\n      ],\n      \"python.lang.security.audit.logging.listeneval.listen-eval\": [\n        0.3013787269592285\n      ],", "createdAt": "2020-12-05T04:48:41Z", "url": "https://github.com/returntocorp/semgrep/pull/2194", "merged": true, "mergeCommit": {"oid": "f89a8ef3269e97df876614b47eaf0027d9f94e69"}, "closed": true, "closedAt": "2020-12-07T16:50:13Z", "author": {"login": "ievans"}, "timelineItems": {"totalCount": 9, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdjE2i7gH2gAyNTMyODk4MjYzOjQ1YWEyODNiYTAwNzA1NjZmNGQ3NTMwZDNiMmYxMjk2OGYxYWJjMTU=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdj4JCCAH2gAyNTMyODk4MjYzOmFiOGZlM2NkYjA1NWVlODUyNDNmMDQzN2ZiMTAxOTI5YTM3MGJiZTQ=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "45aa283ba0070566f4d7530d3b2f12968f1abc15", "author": {"user": {"login": "ievans", "name": "Isaac Evans"}}, "url": "https://github.com/returntocorp/semgrep/commit/45aa283ba0070566f4d7530d3b2f12968f1abc15", "committedDate": "2020-12-05T04:43:47Z", "message": "basic stats pipe to json"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "13faeeb24568e18d29c5702c5858ea429ceba8f4", "author": {"user": {"login": "ievans", "name": "Isaac Evans"}}, "url": "https://github.com/returntocorp/semgrep/commit/13faeeb24568e18d29c5702c5858ea429ceba8f4", "committedDate": "2020-12-05T05:01:36Z", "message": "count loc as well"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f1c2d9ee24611ebf91417af4aa020960333e336b", "author": {"user": {"login": "ievans", "name": "Isaac Evans"}}, "url": "https://github.com/returntocorp/semgrep/commit/f1c2d9ee24611ebf91417af4aa020960333e336b", "committedDate": "2020-12-05T05:27:06Z", "message": "profile by rule"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "112f6c0041792faf8500a4c2291267a2a36e9b5b", "author": {"user": {"login": "ievans", "name": "Isaac Evans"}}, "url": "https://github.com/returntocorp/semgrep/commit/112f6c0041792faf8500a4c2291267a2a36e9b5b", "committedDate": "2020-12-05T05:35:37Z", "message": "move behind --json-stats flag"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTQ1NDE0Mjc3", "url": "https://github.com/returntocorp/semgrep/pull/2194#pullrequestreview-545414277", "createdAt": "2020-12-05T05:52:58Z", "commit": {"oid": "112f6c0041792faf8500a4c2291267a2a36e9b5b"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTQ1NDE2MDk2", "url": "https://github.com/returntocorp/semgrep/pull/2194#pullrequestreview-545416096", "createdAt": "2020-12-05T06:23:26Z", "commit": {"oid": "112f6c0041792faf8500a4c2291267a2a36e9b5b"}, "state": "APPROVED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0wNVQwNjoyMzoyNlrOH_q9wg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0wNVQwNjoyMzoyNlrOH_q9wg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNjUyNjI3NA==", "bodyText": "I have exactly the same poor's man profiler in pfff in Common.profile_code and now also its annitation [@@profiling]\nSemgrep-core -profile returns such info with stats per rule, ststs for parsing, naming, etc.", "url": "https://github.com/returntocorp/semgrep/pull/2194#discussion_r536526274", "createdAt": "2020-12-05T06:23:26Z", "author": {"login": "aryx"}, "path": "semgrep/semgrep/profile_manager.py", "diffHunk": "@@ -0,0 +1,22 @@\n+import collections\n+import time\n+from typing import Any\n+from typing import Dict\n+from typing import List\n+\n+\n+class ProfileManager:\n+    \"\"\"\n+    An incredibly rudimentary tool for tracking profiled calls with an associated named key", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "112f6c0041792faf8500a4c2291267a2a36e9b5b"}, "originalPosition": 10}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "9fe46fa8dca8a18bff9584ed3a9cdfe04a10095e", "author": {"user": {"login": "ievans", "name": "Isaac Evans"}}, "url": "https://github.com/returntocorp/semgrep/commit/9fe46fa8dca8a18bff9584ed3a9cdfe04a10095e", "committedDate": "2020-12-07T16:14:50Z", "message": "hide flag and update changelog"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "2185b950bf6da85c73f250236c6a81c1c7eb0eb9", "author": {"user": {"login": "ievans", "name": "Isaac Evans"}}, "url": "https://github.com/returntocorp/semgrep/commit/2185b950bf6da85c73f250236c6a81c1c7eb0eb9", "committedDate": "2020-12-07T16:18:43Z", "message": "fix CLI invocation"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ab8fe3cdb055ee85243f0437fb101929a370bbe4", "author": {"user": {"login": "ievans", "name": "Isaac Evans"}}, "url": "https://github.com/returntocorp/semgrep/commit/ab8fe3cdb055ee85243f0437fb101929a370bbe4", "committedDate": "2020-12-07T16:29:08Z", "message": "Merge branch 'develop' into ie/stats"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 815, "cost": 1, "resetAt": "2021-11-01T16:37:27Z"}}}