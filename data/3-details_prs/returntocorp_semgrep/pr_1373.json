{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDU3NDI5ODU4", "number": 1373, "title": "tests: add basic perf regression test", "bodyText": "Removes old benchmarking code and add a simple test that asserts semgrep finishes running on a specific ruleset/target in the expected amount of time. These tests will run as part of qa tests which for now are only run after merges to develop", "createdAt": "2020-07-27T22:15:08Z", "url": "https://github.com/returntocorp/semgrep/pull/1373", "merged": true, "mergeCommit": {"oid": "4d42922f496b8189d83b16e89eec14f2f8581f63"}, "closed": true, "closedAt": "2020-08-07T20:52:01Z", "author": {"login": "brendongo"}, "timelineItems": {"totalCount": 23, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABc5JtEIABqjM1OTE4OTcxMTA=", "endCursor": "Y3Vyc29yOnYyOpPPAAABc8qhfgAH2gAyNDU3NDI5ODU4OmY1ZmM5OThiN2VlMTFlMTIzYjMxYWU3NTgyNjc4ZmQ0MzIwZTQzN2Q=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "eb2743b6cfedc97780c80091a2a091a0d4620cb6", "author": {"user": {"login": "brendongo", "name": "Brendon Go"}}, "url": "https://github.com/returntocorp/semgrep/commit/eb2743b6cfedc97780c80091a2a091a0d4620cb6", "committedDate": "2020-07-27T22:25:46Z", "message": "fixup! Calculate timing on frozen target and config"}, "afterCommit": {"oid": "cc535682fce00a2baab517691cd39c852aee43f4", "author": {"user": {"login": "brendongo", "name": "Brendon Go"}}, "url": "https://github.com/returntocorp/semgrep/commit/cc535682fce00a2baab517691cd39c852aee43f4", "committedDate": "2020-07-27T22:38:00Z", "message": "fixup! Calculate timing on frozen target and config"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "a3fa5e8eda29cc28c05ccc16a338d6d4f9fc7e8b", "author": {"user": {"login": "brendongo", "name": "Brendon Go"}}, "url": "https://github.com/returntocorp/semgrep/commit/a3fa5e8eda29cc28c05ccc16a338d6d4f9fc7e8b", "committedDate": "2020-07-27T23:21:17Z", "message": "fixup! fixup! Calculate timing on frozen target and config"}, "afterCommit": {"oid": "528b72b437c421f4f3677bd39aa684c4693833be", "author": {"user": {"login": "brendongo", "name": "Brendon Go"}}, "url": "https://github.com/returntocorp/semgrep/commit/528b72b437c421f4f3677bd39aa684c4693833be", "committedDate": "2020-07-27T23:29:56Z", "message": "fixup! fixup! Calculate timing on frozen target and config"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "c9150acdd0fbd34e0f478dc04f89846f81ee7ef7", "author": {"user": {"login": "brendongo", "name": "Brendon Go"}}, "url": "https://github.com/returntocorp/semgrep/commit/c9150acdd0fbd34e0f478dc04f89846f81ee7ef7", "committedDate": "2020-07-31T22:16:42Z", "message": "fixup! fixup! fixup! Calculate timing on frozen target and config"}, "afterCommit": {"oid": "f0d7e6a56e8d638ab6ffdd451bac6bbfd4225116", "author": {"user": {"login": "brendongo", "name": "Brendon Go"}}, "url": "https://github.com/returntocorp/semgrep/commit/f0d7e6a56e8d638ab6ffdd451bac6bbfd4225116", "committedDate": "2020-07-31T23:20:15Z", "message": "fixup! fixup! fixup! Calculate timing on frozen target and config"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "f0d7e6a56e8d638ab6ffdd451bac6bbfd4225116", "author": {"user": {"login": "brendongo", "name": "Brendon Go"}}, "url": "https://github.com/returntocorp/semgrep/commit/f0d7e6a56e8d638ab6ffdd451bac6bbfd4225116", "committedDate": "2020-07-31T23:20:15Z", "message": "fixup! fixup! fixup! Calculate timing on frozen target and config"}, "afterCommit": {"oid": "0179c4946c61337853cbd59a45da508508c55c43", "author": {"user": {"login": "brendongo", "name": "Brendon Go"}}, "url": "https://github.com/returntocorp/semgrep/commit/0179c4946c61337853cbd59a45da508508c55c43", "committedDate": "2020-07-31T23:30:41Z", "message": "fixup! fixup! fixup! Calculate timing on frozen target and config"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "0179c4946c61337853cbd59a45da508508c55c43", "author": {"user": {"login": "brendongo", "name": "Brendon Go"}}, "url": "https://github.com/returntocorp/semgrep/commit/0179c4946c61337853cbd59a45da508508c55c43", "committedDate": "2020-07-31T23:30:41Z", "message": "fixup! fixup! fixup! Calculate timing on frozen target and config"}, "afterCommit": {"oid": "4653a945150316e88a88dd771074e76c54cc2fd3", "author": {"user": {"login": "brendongo", "name": "Brendon Go"}}, "url": "https://github.com/returntocorp/semgrep/commit/4653a945150316e88a88dd771074e76c54cc2fd3", "committedDate": "2020-08-01T00:09:05Z", "message": "fixup! fixup! fixup! Calculate timing on frozen target and config"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "4653a945150316e88a88dd771074e76c54cc2fd3", "author": {"user": {"login": "brendongo", "name": "Brendon Go"}}, "url": "https://github.com/returntocorp/semgrep/commit/4653a945150316e88a88dd771074e76c54cc2fd3", "committedDate": "2020-08-01T00:09:05Z", "message": "fixup! fixup! fixup! Calculate timing on frozen target and config"}, "afterCommit": {"oid": "b1f6c7e6340700c722eb039b4264f365ee5201d2", "author": {"user": {"login": "brendongo", "name": "Brendon Go"}}, "url": "https://github.com/returntocorp/semgrep/commit/b1f6c7e6340700c722eb039b4264f365ee5201d2", "committedDate": "2020-08-01T00:19:55Z", "message": "fixup! fixup! fixup! Calculate timing on frozen target and config"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "b1f6c7e6340700c722eb039b4264f365ee5201d2", "author": {"user": {"login": "brendongo", "name": "Brendon Go"}}, "url": "https://github.com/returntocorp/semgrep/commit/b1f6c7e6340700c722eb039b4264f365ee5201d2", "committedDate": "2020-08-01T00:19:55Z", "message": "fixup! fixup! fixup! Calculate timing on frozen target and config"}, "afterCommit": {"oid": "2d871782138860f3a6b44b24f1f89d564a257175", "author": {"user": {"login": "brendongo", "name": "Brendon Go"}}, "url": "https://github.com/returntocorp/semgrep/commit/2d871782138860f3a6b44b24f1f89d564a257175", "committedDate": "2020-08-01T00:37:04Z", "message": "fixup! fixup! fixup! Calculate timing on frozen target and config"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "762c1a6f18ef40ff51133c834015aa54ba22dd0c", "author": {"user": {"login": "brendongo", "name": "Brendon Go"}}, "url": "https://github.com/returntocorp/semgrep/commit/762c1a6f18ef40ff51133c834015aa54ba22dd0c", "committedDate": "2020-08-04T21:55:02Z", "message": "Calculate timing on frozen target and config"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "5357d34d73e12bf4c394ed1eff7e4871627361d0", "author": {"user": {"login": "brendongo", "name": "Brendon Go"}}, "url": "https://github.com/returntocorp/semgrep/commit/5357d34d73e12bf4c394ed1eff7e4871627361d0", "committedDate": "2020-08-04T21:55:02Z", "message": "fixup! Calculate timing on frozen target and config"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "73078d5ad3380b73f2d721b6a7b6f22d47d8a04a", "author": {"user": {"login": "brendongo", "name": "Brendon Go"}}, "url": "https://github.com/returntocorp/semgrep/commit/73078d5ad3380b73f2d721b6a7b6f22d47d8a04a", "committedDate": "2020-08-04T21:55:02Z", "message": "fixup! fixup! Calculate timing on frozen target and config"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "97f7614f3c119333607031449f5812ce8fef95af", "author": {"user": {"login": "brendongo", "name": "Brendon Go"}}, "url": "https://github.com/returntocorp/semgrep/commit/97f7614f3c119333607031449f5812ce8fef95af", "committedDate": "2020-08-04T21:55:02Z", "message": "fixup! fixup! fixup! Calculate timing on frozen target and config"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "3f81a59bb27544b4b458011ca699acfddb08fb82", "author": {"user": {"login": "brendongo", "name": "Brendon Go"}}, "url": "https://github.com/returntocorp/semgrep/commit/3f81a59bb27544b4b458011ca699acfddb08fb82", "committedDate": "2020-08-04T21:56:29Z", "message": "Calculate timing on frozen target and config"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "5b80dddc2a895dd731a6ac85bbca2d7e3d1fb378", "author": {"user": {"login": "brendongo", "name": "Brendon Go"}}, "url": "https://github.com/returntocorp/semgrep/commit/5b80dddc2a895dd731a6ac85bbca2d7e3d1fb378", "committedDate": "2020-08-04T21:56:29Z", "message": "fixup! Calculate timing on frozen target and config"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "3cb751aa5bb26424cf0607628eb493fff9d98e19", "author": {"user": {"login": "brendongo", "name": "Brendon Go"}}, "url": "https://github.com/returntocorp/semgrep/commit/3cb751aa5bb26424cf0607628eb493fff9d98e19", "committedDate": "2020-08-04T21:56:56Z", "message": "fixup! fixup! Calculate timing on frozen target and config"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "0439bc8294d73734254bf51ae28b8f045b5c6955", "author": {"user": {"login": "brendongo", "name": "Brendon Go"}}, "url": "https://github.com/returntocorp/semgrep/commit/0439bc8294d73734254bf51ae28b8f045b5c6955", "committedDate": "2020-08-04T23:34:16Z", "message": "tests: add basic perf regression"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "2d871782138860f3a6b44b24f1f89d564a257175", "author": {"user": {"login": "brendongo", "name": "Brendon Go"}}, "url": "https://github.com/returntocorp/semgrep/commit/2d871782138860f3a6b44b24f1f89d564a257175", "committedDate": "2020-08-01T00:37:04Z", "message": "fixup! fixup! fixup! Calculate timing on frozen target and config"}, "afterCommit": {"oid": "0439bc8294d73734254bf51ae28b8f045b5c6955", "author": {"user": {"login": "brendongo", "name": "Brendon Go"}}, "url": "https://github.com/returntocorp/semgrep/commit/0439bc8294d73734254bf51ae28b8f045b5c6955", "committedDate": "2020-08-04T23:34:16Z", "message": "tests: add basic perf regression"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "0cbfb068f1807dc23a376ff9d385ce8d1eaccde5", "author": {"user": {"login": "brendongo", "name": "Brendon Go"}}, "url": "https://github.com/returntocorp/semgrep/commit/0cbfb068f1807dc23a376ff9d385ce8d1eaccde5", "committedDate": "2020-08-05T00:42:35Z", "message": "fixup! tests: add basic perf regression"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "66bf13027e860e254025c1ca561b2f76ac26455c", "author": {"user": {"login": "brendongo", "name": "Brendon Go"}}, "url": "https://github.com/returntocorp/semgrep/commit/66bf13027e860e254025c1ca561b2f76ac26455c", "committedDate": "2020-08-05T21:35:43Z", "message": "fixup! fixup! tests: add basic perf regression"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDYyNjQwNzc2", "url": "https://github.com/returntocorp/semgrep/pull/1373#pullrequestreview-462640776", "createdAt": "2020-08-06T15:40:06Z", "commit": {"oid": "66bf13027e860e254025c1ca561b2f76ac26455c"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0wNlQxNTo0MDowNlrOG85L5w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0wNlQxNTo0MDowNlrOG85L5w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NjUwNDY3OQ==", "bodyText": "Instead of testing 3 repositories in one function manually can we instead parametrize the function to take a repo, SHA hash, and expected runtime? This will improve extensibility and allow us to easily test one set of parameters from the command line (via pytest's -k flag). I think xdist will also allow us to parallelize the 3 repositories.", "url": "https://github.com/returntocorp/semgrep/pull/1373#discussion_r466504679", "createdAt": "2020-08-06T15:40:06Z", "author": {"login": "mschwager"}, "path": "semgrep/tests/performance/test_ci_perf.py", "diffHunk": "@@ -1,203 +1,49 @@\n-import pipes\n import subprocess\n-from pathlib import Path\n-from typing import NamedTuple\n+import time\n \n import pytest\n \n-from ..conftest import TESTS_PATH\n \n-EXTENSIONS = {\n-    \"python\": \"py\",\n-    \"go\": \"go\",\n-    \"javascript\": \"js\",\n-}\n-\n-\n-def sloc(path, extension=None):\n-    \"\"\"Quick hack in lieu of installing sloccount\"\"\"\n-    if extension:\n-        extension_pat = f\"-name '*.{extension}'\"\n-    else:\n-        extension_pat = \"\"\n-    t = pipes.Template()\n-    t.prepend(f\"find {path} {extension_pat}\", \".-\")\n-    t.append(\"xargs cat\", \"--\")\n-    t.append(\"wc -l\", \"--\")\n-    f = t.open(\"pipefile\", \"r\")\n-    return int(f.read())\n-\n-\n-def test_sloc():\n-    assert sloc(path=\".\", extension=\"py\") > 0\n-\n-\n-class RepoCase(NamedTuple):\n-    url: str\n-    sha: str\n-    language: str\n-    # used to decouple test runs when we change what the\n-    # test is actually doing for benchmarking\n-    version: str = \"1\"\n-\n-    @property\n-    def test_id(self):\n-        repo_name = self.url.split(\"/\")[-1]\n-        return f\"{repo_name}-v{self.version}\"\n-\n-\n-@pytest.mark.parametrize(\n-    \"repo_case\",\n-    [\n-        # SHAs of May 6, 2020\n-        RepoCase(\n-            \"https://github.com/coinbase/node-process-lock\", \"dd687bc\", \"javascript\"\n-        ),\n-        RepoCase(\"https://github.com/getsentry/sentry\", \"f25ea5dc\", \"python\"),\n-        RepoCase(\n-            \"https://github.com/bkimminich/juice-shop.git\", \"e03629b\", \"javascript\"\n-        ),\n-    ],\n-    ids=lambda case: case.test_id,\n-)\n-def test_default_packs(run_semgrep_in_tmp, clone_github_repo, benchmark, repo_case):\n+@pytest.mark.qa\n+def test_perf(clone_github_repo):", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "66bf13027e860e254025c1ca561b2f76ac26455c"}, "originalPosition": 66}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDYyNjQyNDQw", "url": "https://github.com/returntocorp/semgrep/pull/1373#pullrequestreview-462642440", "createdAt": "2020-08-06T15:41:55Z", "commit": {"oid": "66bf13027e860e254025c1ca561b2f76ac26455c"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0wNlQxNTo0MTo1NVrOG85RDg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0wNlQxNTo0MTo1NVrOG85RDg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NjUwNTk5OA==", "bodyText": "I think we can remove this whole file, it's only referenced in benchmark.yml.", "url": "https://github.com/returntocorp/semgrep/pull/1373#discussion_r466505998", "createdAt": "2020-08-06T15:41:55Z", "author": {"login": "mschwager"}, "path": "install-scripts/latest-artifact-for-branch.py", "diffHunk": "@@ -100,12 +100,6 @@ def install_semgrep_core(url: str) -> None:\n         sys.exit(1)\n \n \n-def download_benchmarks(url: str, output: str) -> None:", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "66bf13027e860e254025c1ca561b2f76ac26455c"}, "originalPosition": 4}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f54c2c246d831d3fafe876fe487a963091f037b0", "author": {"user": {"login": "brendongo", "name": "Brendon Go"}}, "url": "https://github.com/returntocorp/semgrep/commit/f54c2c246d831d3fafe876fe487a963091f037b0", "committedDate": "2020-08-06T22:56:42Z", "message": "fixup! fixup! fixup! tests: add basic perf regression"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDYzNTkwMTky", "url": "https://github.com/returntocorp/semgrep/pull/1373#pullrequestreview-463590192", "createdAt": "2020-08-07T20:24:37Z", "commit": {"oid": "f54c2c246d831d3fafe876fe487a963091f037b0"}, "state": "APPROVED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0wN1QyMDoyNDozN1rOG9m08Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0wN1QyMDoyNToyM1rOG9m2YQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NzI1MjQ2NQ==", "bodyText": "Sounds good \ud83d\udc4d", "url": "https://github.com/returntocorp/semgrep/pull/1373#discussion_r467252465", "createdAt": "2020-08-07T20:24:37Z", "author": {"login": "mschwager"}, "path": "semgrep/tests/performance/test_ci_perf.py", "diffHunk": "@@ -1,203 +1,49 @@\n-import pipes\n import subprocess\n-from pathlib import Path\n-from typing import NamedTuple\n+import time\n \n import pytest\n \n-from ..conftest import TESTS_PATH\n \n-EXTENSIONS = {\n-    \"python\": \"py\",\n-    \"go\": \"go\",\n-    \"javascript\": \"js\",\n-}\n-\n-\n-def sloc(path, extension=None):\n-    \"\"\"Quick hack in lieu of installing sloccount\"\"\"\n-    if extension:\n-        extension_pat = f\"-name '*.{extension}'\"\n-    else:\n-        extension_pat = \"\"\n-    t = pipes.Template()\n-    t.prepend(f\"find {path} {extension_pat}\", \".-\")\n-    t.append(\"xargs cat\", \"--\")\n-    t.append(\"wc -l\", \"--\")\n-    f = t.open(\"pipefile\", \"r\")\n-    return int(f.read())\n-\n-\n-def test_sloc():\n-    assert sloc(path=\".\", extension=\"py\") > 0\n-\n-\n-class RepoCase(NamedTuple):\n-    url: str\n-    sha: str\n-    language: str\n-    # used to decouple test runs when we change what the\n-    # test is actually doing for benchmarking\n-    version: str = \"1\"\n-\n-    @property\n-    def test_id(self):\n-        repo_name = self.url.split(\"/\")[-1]\n-        return f\"{repo_name}-v{self.version}\"\n-\n-\n-@pytest.mark.parametrize(\n-    \"repo_case\",\n-    [\n-        # SHAs of May 6, 2020\n-        RepoCase(\n-            \"https://github.com/coinbase/node-process-lock\", \"dd687bc\", \"javascript\"\n-        ),\n-        RepoCase(\"https://github.com/getsentry/sentry\", \"f25ea5dc\", \"python\"),\n-        RepoCase(\n-            \"https://github.com/bkimminich/juice-shop.git\", \"e03629b\", \"javascript\"\n-        ),\n-    ],\n-    ids=lambda case: case.test_id,\n-)\n-def test_default_packs(run_semgrep_in_tmp, clone_github_repo, benchmark, repo_case):\n+@pytest.mark.qa\n+def test_perf(clone_github_repo):", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NjUwNDY3OQ=="}, "originalCommit": {"oid": "66bf13027e860e254025c1ca561b2f76ac26455c"}, "originalPosition": 66}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NzI1MjgzMw==", "bodyText": "Looks like we can remove this whole [pytest] key now.", "url": "https://github.com/returntocorp/semgrep/pull/1373#discussion_r467252833", "createdAt": "2020-08-07T20:25:23Z", "author": {"login": "mschwager"}, "path": "semgrep/tox.ini", "diffHunk": "@@ -11,4 +11,3 @@ setenv =\n     PIPENV_VERBOSITY = -1\n \n [pytest]", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f54c2c246d831d3fafe876fe487a963091f037b0"}, "originalPosition": 3}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f5fc998b7ee11e123b31ae7582678fd4320e437d", "author": {"user": {"login": "brendongo", "name": "Brendon Go"}}, "url": "https://github.com/returntocorp/semgrep/commit/f5fc998b7ee11e123b31ae7582678fd4320e437d", "committedDate": "2020-08-07T20:34:08Z", "message": "Update semgrep/tox.ini"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1375, "cost": 1, "resetAt": "2021-11-01T16:37:27Z"}}}