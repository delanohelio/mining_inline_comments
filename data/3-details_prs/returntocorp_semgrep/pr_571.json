{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDA4MjgzNzY5", "number": 571, "title": "Add regression testing infrastructure", "bodyText": "Can now specify rules to run on a given repo at a given commit\nand will make sure --json output of semgrep does not differ\nfrom some expected output", "createdAt": "2020-04-24T01:45:53Z", "url": "https://github.com/returntocorp/semgrep/pull/571", "merged": true, "mergeCommit": {"oid": "2958e75c3aadd09fca2a1c0f4202611330e3e660"}, "closed": true, "closedAt": "2020-04-29T22:37:26Z", "author": {"login": "brendongo"}, "timelineItems": {"totalCount": 13, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcanbdMAH2gAyNDA4MjgzNzY5OjYwNDViOWE3MDBmNzVjYTlmM2M1M2ExNTVkMWQzNTI4ZDA2NTA3NWQ=", "endCursor": "Y3Vyc29yOnYyOpPPAAABccfT5UgH2gAyNDA4MjgzNzY5OmYxMmQ0MjliMWMxZjAzZmE0Y2NlMGEzZDQxYzJhZWMzNWQ4MWU2MTY=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "6045b9a700f75ca9f3c53a155d1d3528d065075d", "author": {"user": {"login": "brendongo", "name": "Brendon Go"}}, "url": "https://github.com/returntocorp/semgrep/commit/6045b9a700f75ca9f3c53a155d1d3528d065075d", "committedDate": "2020-04-24T01:44:24Z", "message": "Add regression testing infrastructure\n\nCan now specify rules to run on a given repo at a given commit\nand will make sure --json output of semgrep does not differ\nfrom some expected output"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDAwMTA4NDkw", "url": "https://github.com/returntocorp/semgrep/pull/571#pullrequestreview-400108490", "createdAt": "2020-04-24T16:45:27Z", "commit": {"oid": "6045b9a700f75ca9f3c53a155d1d3528d065075d"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDAwMTA4ODYy", "url": "https://github.com/returntocorp/semgrep/pull/571#pullrequestreview-400108862", "createdAt": "2020-04-24T16:45:59Z", "commit": {"oid": "6045b9a700f75ca9f3c53a155d1d3528d065075d"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yNFQxNjo0NjowMFrOGLgSig==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yNFQxNjo0NjowMFrOGLgSig==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNDcxNjU1NA==", "bodyText": "@brendongo why is this necessary?", "url": "https://github.com/returntocorp/semgrep/pull/571#discussion_r414716554", "createdAt": "2020-04-24T16:46:00Z", "author": {"login": "ievans"}, "path": "semgrep/tests/acceptance/qa.py", "diffHunk": "@@ -0,0 +1,113 @@\n+import json\n+import os\n+import re\n+import shutil\n+import subprocess\n+import sys\n+import tempfile\n+from contextlib import contextmanager\n+from pathlib import Path\n+from typing import Any\n+from typing import Callable\n+from typing import Iterator\n+from typing import List\n+from typing import Mapping\n+from typing import Optional\n+\n+import yaml\n+\n+\n+@contextmanager\n+def git_checkout(url: str, commit_hash: str) -> Iterator[str]:\n+    \"\"\"\n+        Clones URL into destination and checks out commit_hash\n+\n+        Returns name of directory url was cloned into\n+    \"\"\"\n+    with tempfile.TemporaryDirectory() as destination:\n+        print(\"starting clone\")\n+        subprocess.run(\n+            [\"git\", \"clone\", url, destination],\n+            stdout=subprocess.PIPE,\n+            stderr=subprocess.PIPE,\n+            check=True,\n+        )\n+        print(\"done clone\")\n+        subprocess.run(\n+            [\"git\", \"checkout\", commit_hash],\n+            cwd=destination,\n+            stdout=subprocess.PIPE,\n+            stderr=subprocess.PIPE,\n+            check=True,\n+        )\n+        subprocess.run(\n+            [\"git\", \"clean\", \"-xdf\"],", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "6045b9a700f75ca9f3c53a155d1d3528d065075d"}, "originalPosition": 44}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "4bf6d31627df8b6d859f7eff01306b40f5a16c33", "author": {"user": {"login": "brendongo", "name": "Brendon Go"}}, "url": "https://github.com/returntocorp/semgrep/commit/4bf6d31627df8b6d859f7eff01306b40f5a16c33", "committedDate": "2020-04-27T08:31:34Z", "message": "fixup! Add regression testing infrastructure"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDAyMTIzNzky", "url": "https://github.com/returntocorp/semgrep/pull/571#pullrequestreview-402123792", "createdAt": "2020-04-28T18:57:28Z", "commit": {"oid": "4bf6d31627df8b6d859f7eff01306b40f5a16c33"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yOFQxODo1NzoyOFrOGNieLA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yOFQxODo1NzoyOFrOGNieLA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNjg0OTQ1Mg==", "bodyText": "You should add all our supported languages here [java, c, go]", "url": "https://github.com/returntocorp/semgrep/pull/571#discussion_r416849452", "createdAt": "2020-04-28T18:57:28Z", "author": {"login": "ievans"}, "path": "semgrep/tests/acceptance/rule.yaml", "diffHunk": "@@ -0,0 +1,6 @@\n+rules:\n+  - id: useless-equals\n+    pattern: $X==$X\n+    message: \"Useless equals\"\n+    languages: [python, javascript]", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "4bf6d31627df8b6d859f7eff01306b40f5a16c33"}, "originalPosition": 5}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "2cc814316a913eafa51d9f3f16151740945743e1", "author": {"user": {"login": "brendongo", "name": "Brendon Go"}}, "url": "https://github.com/returntocorp/semgrep/commit/2cc814316a913eafa51d9f3f16151740945743e1", "committedDate": "2020-04-28T20:50:41Z", "message": "Run QA test on PRs"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "3a9a77b2fb58a565ed634555d3b2740f5b3baaa5", "author": {"user": {"login": "brendongo", "name": "Brendon Go"}}, "url": "https://github.com/returntocorp/semgrep/commit/3a9a77b2fb58a565ed634555d3b2740f5b3baaa5", "committedDate": "2020-04-28T23:34:29Z", "message": "fixup! Add regression testing infrastructure"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDAyODMxMzY0", "url": "https://github.com/returntocorp/semgrep/pull/571#pullrequestreview-402831364", "createdAt": "2020-04-29T16:21:43Z", "commit": {"oid": "3a9a77b2fb58a565ed634555d3b2740f5b3baaa5"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yOVQxNjoyMTo0M1rOGOGx8w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yOVQxNjoyMTo0M1rOGOGx8w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNzQ0NDMzOQ==", "bodyText": "Spell check: pattrern", "url": "https://github.com/returntocorp/semgrep/pull/571#discussion_r417444339", "createdAt": "2020-04-29T16:21:43Z", "author": {"login": "mschwager"}, "path": "semgrep/tests/acceptance/qa.py", "diffHunk": "@@ -0,0 +1,180 @@\n+import json\n+import os\n+import re\n+import shutil\n+import subprocess\n+import sys\n+import tempfile\n+from contextlib import contextmanager\n+from pathlib import Path\n+from typing import Any\n+from typing import Callable\n+from typing import Iterator\n+from typing import List\n+from typing import Mapping\n+from typing import Optional\n+\n+import yaml\n+\n+\n+@contextmanager\n+def git_checkout(url: str, commit_hash: Optional[str] = None) -> Iterator[str]:\n+    \"\"\"\n+        Clones URL into destination\n+\n+        Returns name of directory url was cloned into\n+    \"\"\"\n+    with tempfile.TemporaryDirectory() as destination:\n+        subprocess.run(\n+            [\"git\", \"clone\", \"--depth=1\", url, destination],\n+            stdout=subprocess.PIPE,\n+            stderr=subprocess.PIPE,\n+            check=True,\n+        )\n+        yield destination\n+\n+\n+def run_repo(target: str, rewrite: bool = False) -> None:\n+    \"\"\"\n+    Runs semgrep on github repo with a simple pattrern", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "3a9a77b2fb58a565ed634555d3b2740f5b3baaa5"}, "originalPosition": 39}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDAyODMzNzIw", "url": "https://github.com/returntocorp/semgrep/pull/571#pullrequestreview-402833720", "createdAt": "2020-04-29T16:24:35Z", "commit": {"oid": "3a9a77b2fb58a565ed634555d3b2740f5b3baaa5"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yOVQxNjoyNDozNlrOGOG5KA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yOVQxNjoyNDozNlrOGOG5KA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNzQ0NjE4NA==", "bodyText": "Does this do anything right now? I assume we'd have to have a __main__ check in qa.py for this do things.", "url": "https://github.com/returntocorp/semgrep/pull/571#discussion_r417446184", "createdAt": "2020-04-29T16:24:36Z", "author": {"login": "mschwager"}, "path": "semgrep/Makefile", "diffHunk": "@@ -7,3 +7,11 @@ test:\n install:\n \tcp -rv ./build/semgrep.dist/ /usr/local/bin/semgrep-files/\n \tln -sf /usr/local/bin/semgrep-files/semgrep /usr/local/bin/semgrep\n+\n+.PHONY: qa-test\n+qa-test: build\n+\tpytest -s tests/acceptance/qa.py\n+\n+.PHONY: regenerate-tests\n+regenerate-tests:", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "3a9a77b2fb58a565ed634555d3b2740f5b3baaa5"}, "originalPosition": 10}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b9b3d42ba929b48677e7335e2b148a0dda40a9fc", "author": {"user": {"login": "brendongo", "name": "Brendon Go"}}, "url": "https://github.com/returntocorp/semgrep/commit/b9b3d42ba929b48677e7335e2b148a0dda40a9fc", "committedDate": "2020-04-29T20:37:30Z", "message": "fixup! Run QA test on PRs"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "76f7e5029383a88858454ad4335bf0fd14ef6b7d", "author": {"user": {"login": "brendongo", "name": "Brendon Go"}}, "url": "https://github.com/returntocorp/semgrep/commit/76f7e5029383a88858454ad4335bf0fd14ef6b7d", "committedDate": "2020-04-29T20:47:49Z", "message": "fixup! Run QA test on PRs"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b60d9c6e8b0b0a6090863f74b6c4d1e3336b091e", "author": {"user": {"login": "brendongo", "name": "Brendon Go"}}, "url": "https://github.com/returntocorp/semgrep/commit/b60d9c6e8b0b0a6090863f74b6c4d1e3336b091e", "committedDate": "2020-04-29T20:58:53Z", "message": "fixup! Run QA test on PRs"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f12d429b1c1f03fa4cce0a3d41c2aec35d81e616", "author": {"user": {"login": "brendongo", "name": "Brendon Go"}}, "url": "https://github.com/returntocorp/semgrep/commit/f12d429b1c1f03fa4cce0a3d41c2aec35d81e616", "committedDate": "2020-04-29T21:24:45Z", "message": "fixup! Run QA test on PRs"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1053, "cost": 1, "resetAt": "2021-11-01T16:37:27Z"}}}