{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTQyMjE4MzYx", "number": 2288, "reviewThreads": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xOFQwODo0NDo0OFrOFHFBvA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xOFQwODo1MDoyNlrOFHFQdg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzQyOTY2NzE2OnYy", "diffSide": "RIGHT", "path": "semgrep-core/parsing/Parse_kotlin_tree_sitter.ml", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xOFQwODo0NDo0OFrOIIYsYA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xOFQwODo0OToxMlrOIIY_Hw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NTY2NDA5Ng==", "bodyText": "I tyink you can build a ParamClassic with p_type = v1, and p_name = None,\nlike we do in C for function signatures.", "url": "https://github.com/returntocorp/semgrep/pull/2288#discussion_r545664096", "createdAt": "2020-12-18T08:44:48Z", "author": {"login": "aryx"}, "path": "semgrep-core/parsing/Parse_kotlin_tree_sitter.ml", "diffHunk": "@@ -465,8 +465,9 @@ and annotation (env : env) (x : CST.annotation) =\n and anon_choice_param_b77c1d8 (env : env) (x : CST.anon_choice_param_b77c1d8) =\n   (match x with\n    | `Param x -> parameter env x\n-   | `Type x -> let _ =  type_ env x in\n-       raise Todo\n+   | `Type x ->\n+       let v1 =  type_ env x in\n+       ParamPattern (PatType v1)", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "72e830b7096a42c47d903fd6f03311dc7c28b981"}, "originalPosition": 8}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NTY2ODg5NQ==", "bodyText": "There is even AST_generic.param_of_type() to help build this parameter_classic type.", "url": "https://github.com/returntocorp/semgrep/pull/2288#discussion_r545668895", "createdAt": "2020-12-18T08:49:12Z", "author": {"login": "aryx"}, "path": "semgrep-core/parsing/Parse_kotlin_tree_sitter.ml", "diffHunk": "@@ -465,8 +465,9 @@ and annotation (env : env) (x : CST.annotation) =\n and anon_choice_param_b77c1d8 (env : env) (x : CST.anon_choice_param_b77c1d8) =\n   (match x with\n    | `Param x -> parameter env x\n-   | `Type x -> let _ =  type_ env x in\n-       raise Todo\n+   | `Type x ->\n+       let v1 =  type_ env x in\n+       ParamPattern (PatType v1)", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NTY2NDA5Ng=="}, "originalCommit": {"oid": "72e830b7096a42c47d903fd6f03311dc7c28b981"}, "originalPosition": 8}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzQyOTY4ODkxOnYy", "diffSide": "RIGHT", "path": "semgrep-core/parsing/Parse_kotlin_tree_sitter.ml", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xOFQwODo0Nzo1NFrOIIY5gQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xOFQwODo0Nzo1NFrOIIY5gQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NTY2NzQ1Nw==", "bodyText": "in grammar.js they use repeat1($._quest)\nand _quest: $ => \"?\"\nwhich means there is at least one \"?\", so you can write the pattern:\n| [] -> raise Impossible (* see repeat1($._quest) in grammar.js *)", "url": "https://github.com/returntocorp/semgrep/pull/2288#discussion_r545667457", "createdAt": "2020-12-18T08:47:54Z", "author": {"login": "aryx"}, "path": "semgrep-core/parsing/Parse_kotlin_tree_sitter.ml", "diffHunk": "@@ -1344,13 +1345,25 @@ and nullable_type (env : env) ((v1, v2) : CST.nullable_type) =\n     )\n   in\n   let v2 = List.map (token env) (* \"?\" *) v2 in\n-  todo env (v1, v2)\n+  (match v2 with\n+   | hd::tl -> TyQuestion (v1, hd)\n+   | _ ->", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "72e830b7096a42c47d903fd6f03311dc7c28b981"}, "originalPosition": 60}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzQyOTcwNDg2OnYy", "diffSide": "RIGHT", "path": "semgrep-core/parsing/Parse_kotlin_tree_sitter.ml", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xOFQwODo1MDoyNlrOIIZDhg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xOFQwODo1MDoyNlrOIIZDhg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NTY3MDAyMg==", "bodyText": "You can factorize a bit and do let param = { (AST_generic.param_of_id v1) with ptype = v3 }", "url": "https://github.com/returntocorp/semgrep/pull/2288#discussion_r545670022", "createdAt": "2020-12-18T08:50:26Z", "author": {"login": "aryx"}, "path": "semgrep-core/parsing/Parse_kotlin_tree_sitter.ml", "diffHunk": "@@ -1344,13 +1345,25 @@ and nullable_type (env : env) ((v1, v2) : CST.nullable_type) =\n     )\n   in\n   let v2 = List.map (token env) (* \"?\" *) v2 in\n-  todo env (v1, v2)\n+  (match v2 with\n+   | hd::tl -> TyQuestion (v1, hd)\n+   | _ ->\n+       let q = Parse_info.fake_info \"?\" in\n+       TyQuestion (v1, q)\n+  )\n \n and parameter (env : env) ((v1, v2, v3) : CST.parameter) : parameter =\n   let v1 = simple_identifier env v1 in\n   let v2 = token env v2 (* \":\" *) in\n   let v3 = type_ env v3 in\n-  todo env (v1, v2, v3)\n+  let param = {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "72e830b7096a42c47d903fd6f03311dc7c28b981"}, "originalPosition": 70}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4727, "cost": 1, "resetAt": "2021-11-12T12:57:47Z"}}}