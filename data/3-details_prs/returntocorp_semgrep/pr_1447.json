{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDYzMDEwNzI2", "number": 1447, "title": "Group timeouts together in logging", "bodyText": "", "createdAt": "2020-08-04T21:09:48Z", "url": "https://github.com/returntocorp/semgrep/pull/1447", "merged": true, "mergeCommit": {"oid": "d13354ca774aeaabfa5116e48fab1ce20a6a5cde"}, "closed": true, "closedAt": "2020-08-05T14:09:19Z", "author": {"login": "sabrinabrogren"}, "timelineItems": {"totalCount": 7, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABc7tKG9gH2gAyNDYzMDEwNzI2OjlkNTY2NjIwNDZmYjAyM2NjMGQwZWM4MDU2ZGEwY2FkOTA2YTg4YjM=", "endCursor": "Y3Vyc29yOnYyOpPPAAABc77QKaAH2gAyNDYzMDEwNzI2OmM4ZTQwNzZiYzY2ZDFhNjFhMGRiMDE4OWFiYmE1NWZjNzNlNmE5YzI=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "9d56662046fb023cc0d0ec8056da0cad906a88b3", "author": {"user": {"login": "sabrinabrogren", "name": "Sabrina Brogren"}}, "url": "https://github.com/returntocorp/semgrep/commit/9d56662046fb023cc0d0ec8056da0cad906a88b3", "committedDate": "2020-08-04T21:04:23Z", "message": "Group timeouts together in logging"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDYxMTgyMDcy", "url": "https://github.com/returntocorp/semgrep/pull/1447#pullrequestreview-461182072", "createdAt": "2020-08-04T21:18:25Z", "commit": {"oid": "9d56662046fb023cc0d0ec8056da0cad906a88b3"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0wNFQyMToxODoyNVrOG7x3Rg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0wNFQyMToxODoyNVrOG7x3Rg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NTMzNjEzNA==", "bodyText": "Do we run into issues since codepaths diverge now? i.e. when the error is a MatchTimeoutError we don't set self.has_output to True, we don't check membership in self.error_set before appending to semgrep_structured_errors etc. (see handle_semgrep_error)", "url": "https://github.com/returntocorp/semgrep/pull/1447#discussion_r465336134", "createdAt": "2020-08-04T21:18:25Z", "author": {"login": "brendongo"}, "path": "semgrep/semgrep/output.py", "diffHunk": "@@ -226,8 +228,24 @@ def __init__(\n         self.final_error: Optional[Exception] = None\n \n     def handle_semgrep_errors(self, errors: List[SemgrepError]) -> None:\n+        timeout_errors = defaultdict(list)\n         for err in errors:\n-            self.handle_semgrep_error(err)\n+            if isinstance(err, MatchTimeoutError):", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "9d56662046fb023cc0d0ec8056da0cad906a88b3"}, "originalPosition": 23}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "66dbf185c3c5276094db3e5de0f22dc5d6d474ad", "author": {"user": {"login": "sabrinabrogren", "name": "Sabrina Brogren"}}, "url": "https://github.com/returntocorp/semgrep/commit/66dbf185c3c5276094db3e5de0f22dc5d6d474ad", "committedDate": "2020-08-04T21:23:59Z", "message": "check if in error_set"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f810da39f0d79b9b58d91538df60570a0abf207c", "author": {"user": {"login": "sabrinabrogren", "name": "Sabrina Brogren"}}, "url": "https://github.com/returntocorp/semgrep/commit/f810da39f0d79b9b58d91538df60570a0abf207c", "committedDate": "2020-08-04T21:46:21Z", "message": "set has_output"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDYxMjMwODk0", "url": "https://github.com/returntocorp/semgrep/pull/1447#pullrequestreview-461230894", "createdAt": "2020-08-04T22:56:05Z", "commit": {"oid": "f810da39f0d79b9b58d91538df60570a0abf207c"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0wNFQyMjo1NjowNVrOG70QBA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0wNFQyMjo1NjowNVrOG70QBA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NTM3NTIzNg==", "bodyText": "Nit: error(s) so pluralization is fine if len is 1", "url": "https://github.com/returntocorp/semgrep/pull/1447#discussion_r465375236", "createdAt": "2020-08-04T22:56:05Z", "author": {"login": "brendongo"}, "path": "semgrep/semgrep/output.py", "diffHunk": "@@ -226,8 +228,25 @@ def __init__(\n         self.final_error: Optional[Exception] = None\n \n     def handle_semgrep_errors(self, errors: List[SemgrepError]) -> None:\n+        timeout_errors = defaultdict(list)\n         for err in errors:\n-            self.handle_semgrep_error(err)\n+            if isinstance(err, MatchTimeoutError) and err not in self.error_set:\n+                self.semgrep_structured_errors.append(err)\n+                self.error_set.add(err)\n+                timeout_errors[err.path].append(err.rule_id)\n+            else:\n+                self.handle_semgrep_error(err)\n+\n+        if timeout_errors and self.settings.output_format == OutputFormat.TEXT:\n+            self.handle_semgrep_timeout_errors(timeout_errors)\n+\n+    def handle_semgrep_timeout_errors(self, errors: Dict[Path, List[str]]) -> None:\n+        self.has_output = True\n+        separator = \", \"\n+        for path in errors.keys():\n+            logger.error(\n+                f\"Warning: {len(errors[path])} timeout errors in {path} when running the following rules: [{separator.join(errors[path])}]\"", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f810da39f0d79b9b58d91538df60570a0abf207c"}, "originalPosition": 38}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDYxMjMwOTM0", "url": "https://github.com/returntocorp/semgrep/pull/1447#pullrequestreview-461230934", "createdAt": "2020-08-04T22:56:12Z", "commit": {"oid": "f810da39f0d79b9b58d91538df60570a0abf207c"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c8e4076bc66d1a61a0db0189abba55fc73e6a9c2", "author": {"user": {"login": "sabrinabrogren", "name": "Sabrina Brogren"}}, "url": "https://github.com/returntocorp/semgrep/commit/c8e4076bc66d1a61a0db0189abba55fc73e6a9c2", "committedDate": "2020-08-05T13:29:40Z", "message": "fixing singular/plural"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1406, "cost": 1, "resetAt": "2021-11-01T16:37:27Z"}}}