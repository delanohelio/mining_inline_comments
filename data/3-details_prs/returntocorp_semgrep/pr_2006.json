{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTE4NjkyMzQ2", "number": 2006, "title": "support for dumping AST of very basic function", "bodyText": "try semgrep-core/_build/default/cli/Main.exe -dump_ast tests/kotlin/small-program.kt. This should give you a basic AST.\nIt gives me:\nPr(\n  [DefStmt(\n     ({name=EId((\"foo\", ())); attrs=[]; tparams=[];\n       info={id_resolved=Ref(None); id_type=Ref(None);\n             id_const_literal=Ref(None); };\n       },\n      FuncDef(\n        {fkind=(Function, ()); fparams=[]; frettype=None;\n         fbody=Block([ExprStmt(L(Int((\"2\", ()))), ())]); })))])", "createdAt": "2020-11-10T18:44:03Z", "url": "https://github.com/returntocorp/semgrep/pull/2006", "merged": true, "mergeCommit": {"oid": "78cfd7fd7b21231044555268009b57a5d7063402"}, "closed": true, "closedAt": "2020-11-10T21:44:11Z", "author": {"login": "colleend"}, "timelineItems": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdbN3eagH2gAyNTE4NjkyMzQ2OmRiZWE3OTQ1OGNlY2JjNTA3OGE3ODYyMDU3Yzk2N2RkMmM4ZjI0ZWQ=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdbQBy9AH2gAyNTE4NjkyMzQ2OjI2N2I2OTRmYmU2Y2JkZDRkZjM0MjBjMzRmZmI5ODZmM2QzZGExY2E=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "dbea79458cecbc5078a7862057c967dd2c8f24ed", "author": {"user": null}, "url": "https://github.com/returntocorp/semgrep/commit/dbea79458cecbc5078a7862057c967dd2c8f24ed", "committedDate": "2020-11-10T18:42:33Z", "message": "support for dumping very basic AST"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTI3NTM3ODQw", "url": "https://github.com/returntocorp/semgrep/pull/2006#pullrequestreview-527537840", "createdAt": "2020-11-10T19:27:53Z", "commit": {"oid": "dbea79458cecbc5078a7862057c967dd2c8f24ed"}, "state": "APPROVED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xMFQxOToyNzo1M1rOHwsVCA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xMFQxOToyODoyN1rOHwsWXw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMDgxOTk3Ng==", "bodyText": "there's a pr2 here.\nWe actually should have a semgrep rule preventing to commit such code.", "url": "https://github.com/returntocorp/semgrep/pull/2006#discussion_r520819976", "createdAt": "2020-11-10T19:27:53Z", "author": {"login": "aryx"}, "path": "semgrep-core/parsing/Parse_kotlin_tree_sitter.ml", "diffHunk": "@@ -1358,12 +1366,13 @@ and primary_constructor (env : env) ((v1, v2) : CST.primary_constructor) =\n   let v2 = class_parameters env v2 in\n   todo env (v1, v2)\n \n-and primary_expression (env : env) (x : CST.primary_expression) : AST.expr =\n+and primary_expression (env : env) (x : CST.primary_expression) : expr =\n   (match x with\n-  | `Paren_exp x -> let _ = parenthesized_expression env x in\n-      raise Todo\n-  | `Simple_id x -> simple_identifier env x\n-  | `Lit_cst x -> literal_constant env x\n+  | `Paren_exp x -> parenthesized_expression env x\n+  | `Simple_id x -> \n+      let id = simple_identifier env x in\n+      Id(id, empty_id_info())\n+  | `Lit_cst x -> pr2 \"in lit_cst\"; L (literal_constant env x)", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "dbea79458cecbc5078a7862057c967dd2c8f24ed"}, "originalPosition": 314}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMDgyMDMxOQ==", "bodyText": "There is a IdSpecial for This and Super.\nSee what I do in Parse_java_tree_sitter.ml", "url": "https://github.com/returntocorp/semgrep/pull/2006#discussion_r520820319", "createdAt": "2020-11-10T19:28:27Z", "author": {"login": "aryx"}, "path": "semgrep-core/parsing/Parse_kotlin_tree_sitter.ml", "diffHunk": "@@ -1404,7 +1413,7 @@ and primary_expression (env : env) (x : CST.primary_expression) : AST.expr =\n       in\n       let v4 = token env v4 (* \"]\" *) in\n       todo env (v1, v2, v3, v4)\n-  | `This_exp tok -> let _ = token env tok in raise Todo (* \"this\" *)\n+  | `This_exp tok -> Id(str env tok, empty_id_info()) (* \"this\" *)", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "dbea79458cecbc5078a7862057c967dd2c8f24ed"}, "originalPosition": 332}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "267b694fbe6cbdd4df3420c34ffb986f3d3da1ca", "author": {"user": null}, "url": "https://github.com/returntocorp/semgrep/commit/267b694fbe6cbdd4df3420c34ffb986f3d3da1ca", "committedDate": "2020-11-10T21:13:38Z", "message": "removed pr2, changed conversion from Id to IdSpecial for This"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 909, "cost": 1, "resetAt": "2021-11-01T16:37:27Z"}}}