{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDM4MTcyODIw", "number": 1098, "title": "Don't try to parse an inline pattern as YAML", "bodyText": "To build an error span, we were attempting to parse the argument to -e as YAML, but this breaks if eg. it starts with # as in #1095. Instead, build a YamlTree[str] directly.", "createdAt": "2020-06-22T20:55:38Z", "url": "https://github.com/returntocorp/semgrep/pull/1098", "merged": true, "mergeCommit": {"oid": "3d46ae35852b19b4190aeb9cc54b68372375e473"}, "closed": true, "closedAt": "2020-06-24T19:14:09Z", "author": {"login": "rcoh"}, "timelineItems": {"totalCount": 9, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABct3VksgFqTQzNTI3MDU2OA==", "endCursor": "Y3Vyc29yOnYyOpPPAAABcueWmRABqjM0Nzg3NjkyMjQ=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDM1MjcwNTY4", "url": "https://github.com/returntocorp/semgrep/pull/1098#pullrequestreview-435270568", "createdAt": "2020-06-22T21:01:01Z", "commit": {"oid": "ca132a8962f19d4d75fd7da3b8f71f567315bba9"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "ca132a8962f19d4d75fd7da3b8f71f567315bba9", "author": {"user": {"login": "rcoh", "name": "Russell Cohen"}}, "url": "https://github.com/returntocorp/semgrep/commit/ca132a8962f19d4d75fd7da3b8f71f567315bba9", "committedDate": "2020-06-22T20:55:25Z", "message": "Don't try to parse an inline pattern as YAML"}, "afterCommit": {"oid": "42fa70a17a68a5e586db149b2926889576ff224a", "author": {"user": {"login": "rcoh", "name": "Russell Cohen"}}, "url": "https://github.com/returntocorp/semgrep/commit/42fa70a17a68a5e586db149b2926889576ff224a", "committedDate": "2020-06-23T17:35:38Z", "message": "Don't try to parse an inline pattern as YAML"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDM2MTI2MDE3", "url": "https://github.com/returntocorp/semgrep/pull/1098#pullrequestreview-436126017", "createdAt": "2020-06-23T20:22:29Z", "commit": {"oid": "42fa70a17a68a5e586db149b2926889576ff224a"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yM1QyMDoyMjoyOVrOGn5LnA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yM1QyMDoyMjoyOVrOGn5LnA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NDQ4NDUwOA==", "bodyText": "Maybe be more clear in that it can't be parsed as a C semgrep pattern so the user doesnt get confused why a pattern is being parsed as code", "url": "https://github.com/returntocorp/semgrep/pull/1098#discussion_r444484508", "createdAt": "2020-06-23T20:22:29Z", "author": {"login": "brendongo"}, "path": "semgrep/tests/e2e/snapshots/test_rule_parser/test_rule_parser_cli_pattern/error.txt", "diffHunk": "@@ -0,0 +1,7 @@\n+error: invalid pattern\n+  --> CLI Input:1\n+1 | #include $X\n+  | ^^^^^^^^^^\n+\n+Pattern could not be parsed as C", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "42fa70a17a68a5e586db149b2926889576ff224a"}, "originalPosition": 6}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDM2MTI2Mzk1", "url": "https://github.com/returntocorp/semgrep/pull/1098#pullrequestreview-436126395", "createdAt": "2020-06-23T20:23:03Z", "commit": {"oid": "42fa70a17a68a5e586db149b2926889576ff224a"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yM1QyMDoyMzowM1rOGn5Muw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yM1QyMDoyMzowM1rOGn5Muw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NDQ4NDc5NQ==", "bodyText": "Should we just use a different pattern that is actually bad instead of one that might eventually work?", "url": "https://github.com/returntocorp/semgrep/pull/1098#discussion_r444484795", "createdAt": "2020-06-23T20:23:03Z", "author": {"login": "brendongo"}, "path": "semgrep/tests/e2e/test_rule_parser.py", "diffHunk": "@@ -43,3 +43,16 @@ def test_rule_parser__failure__error_messages(run_semgrep_in_tmp, snapshot, file\n \n     if excinfo_in_color.value.stderr != excinfo.value.stderr:\n         snapshot.assert_match(excinfo_in_color.value.stderr, \"error-in-color.txt\")\n+\n+\n+# https://github.com/returntocorp/semgrep/issues/1095\n+def test_rule_parser_cli_pattern(run_semgrep_in_tmp, snapshot):\n+    # This test should eventually pass once this pattern is handled by semgrep-core, but for now,\n+    # getting a proper error from semgrep-core is an improvement\n+    with pytest.raises(CalledProcessError) as excinfo:\n+        run_semgrep_in_tmp(options=[\"-e\", \"#include $X\", \"-l\", \"c\"])", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "42fa70a17a68a5e586db149b2926889576ff224a"}, "originalPosition": 11}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDM2MTI3NzQ1", "url": "https://github.com/returntocorp/semgrep/pull/1098#pullrequestreview-436127745", "createdAt": "2020-06-23T20:25:06Z", "commit": {"oid": "42fa70a17a68a5e586db149b2926889576ff224a"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a650730f83f54fd5fb76740b207d2c2c4efbc71f", "author": {"user": {"login": "rcoh", "name": "Russell Cohen"}}, "url": "https://github.com/returntocorp/semgrep/commit/a650730f83f54fd5fb76740b207d2c2c4efbc71f", "committedDate": "2020-06-24T18:19:46Z", "message": "Don't try to parse an inline pattern as YAML"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "42fa70a17a68a5e586db149b2926889576ff224a", "author": {"user": {"login": "rcoh", "name": "Russell Cohen"}}, "url": "https://github.com/returntocorp/semgrep/commit/42fa70a17a68a5e586db149b2926889576ff224a", "committedDate": "2020-06-23T17:35:38Z", "message": "Don't try to parse an inline pattern as YAML"}, "afterCommit": {"oid": "a650730f83f54fd5fb76740b207d2c2c4efbc71f", "author": {"user": {"login": "rcoh", "name": "Russell Cohen"}}, "url": "https://github.com/returntocorp/semgrep/commit/a650730f83f54fd5fb76740b207d2c2c4efbc71f", "committedDate": "2020-06-24T18:19:46Z", "message": "Don't try to parse an inline pattern as YAML"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "78d6e27782c7caae6565c3be24689932ae70f23e", "author": {"user": {"login": "rcoh", "name": "Russell Cohen"}}, "url": "https://github.com/returntocorp/semgrep/commit/78d6e27782c7caae6565c3be24689932ae70f23e", "committedDate": "2020-06-24T18:28:17Z", "message": "Update error message & tests"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "2256af51455032aa830e811301c2fb4ca01015d4", "author": {"user": {"login": "rcoh", "name": "Russell Cohen"}}, "url": "https://github.com/returntocorp/semgrep/commit/2256af51455032aa830e811301c2fb4ca01015d4", "committedDate": "2020-06-24T18:26:44Z", "message": "Update error message & tests"}, "afterCommit": {"oid": "78d6e27782c7caae6565c3be24689932ae70f23e", "author": {"user": {"login": "rcoh", "name": "Russell Cohen"}}, "url": "https://github.com/returntocorp/semgrep/commit/78d6e27782c7caae6565c3be24689932ae70f23e", "committedDate": "2020-06-24T18:28:17Z", "message": "Update error message & tests"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1411, "cost": 1, "resetAt": "2021-11-01T16:37:27Z"}}}