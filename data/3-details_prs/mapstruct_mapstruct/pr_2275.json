{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTIxMTgwNDYy", "number": 2275, "title": "#2274, #2023 Fix problems with property mapping using source parameters", "bodyText": "Fixes problems when property mapping is using source parameter and has default value / expression or is doing an update\nFixes #2274\nFixes #2023\nI am not entirely happy with the solution, but I don't see currently how we can avoid this. Our PropertyMapping know too much about the BeanMappingMethod and vice versa", "createdAt": "2020-11-15T11:22:30Z", "url": "https://github.com/mapstruct/mapstruct/pull/2275", "merged": true, "mergeCommit": {"oid": "84c3bda5a23e48956ad5de4955792ef0a278638e"}, "closed": true, "closedAt": "2020-11-22T12:04:27Z", "author": {"login": "filiphr"}, "timelineItems": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdcuK_QgH2gAyNTIxMTgwNDYyOjk4NzliMWZkOWU5MDQxY2JiNTE4M2NjNWUyMDBlZjYzMDBjMDdmM2U=", "endCursor": "Y3Vyc29yOnYyOpPPAAABde_WnUgH2gAyNTIxMTgwNDYyOjI3NTA4M2VkYzk1MWVhYzAwMzAyOTM1NzJjNjExNDk0ZDc2Y2UyOWI=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "9879b1fd9e9041cbb5183cc5e200ef6300c07f3e", "author": {"user": {"login": "filiphr", "name": "Filip Hrisafov"}}, "url": "https://github.com/mapstruct/mapstruct/commit/9879b1fd9e9041cbb5183cc5e200ef6300c07f3e", "committedDate": "2020-11-15T10:54:45Z", "message": "#2274, #2023 Fix problems with property mapping using source parameters\n\nFixes problems when property mapping is using source parameter and has default value / expression or is doing an update"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTM1OTU1NTM3", "url": "https://github.com/mapstruct/mapstruct/pull/2275#pullrequestreview-535955537", "createdAt": "2020-11-21T10:08:18Z", "commit": {"oid": "9879b1fd9e9041cbb5183cc5e200ef6300c07f3e"}, "state": "APPROVED", "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0yMVQxMDowODoxOFrOH3tZJQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0yMVQxMDoxMToxOFrOH3taLQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyODE3NzQ0NQ==", "bodyText": "add in the comment this is auto-unboxing..", "url": "https://github.com/mapstruct/mapstruct/pull/2275#discussion_r528177445", "createdAt": "2020-11-21T10:08:18Z", "author": {"login": "sjaakd"}, "path": "processor/src/main/java/org/mapstruct/ap/internal/model/PropertyMapping.java", "diffHunk": "@@ -438,6 +434,49 @@ private Assignment assignToPlainViaSetter(Type targetType, Assignment rhs) {\n             }\n         }\n \n+        /**\n+         * Checks whether the setter wrapper should include a null / presence check or not\n+         *\n+         * @param rhs the source right hand side\n+         * @param targetType the target type\n+         *\n+         * @return whether to include a null / presence check or not\n+         */\n+        private boolean setterWrapperNeedsSourceNullCheck(Assignment rhs, Type targetType) {\n+            if ( rhs.getSourceType().isPrimitive() && rhs.getSourcePresenceCheckerReference() == null ) {\n+                // If the source type is primitive or it doesn't have a presence checker then\n+                // we shouldn't do a null check\n+                return false;\n+            }\n+\n+            if ( nvcs == ALWAYS ) {\n+                // NullValueCheckStrategy is ALWAYS -> do a null check\n+                return true;\n+            }\n+\n+            if ( nvpms == SET_TO_DEFAULT || nvpms == IGNORE ) {\n+                // NullValuePropertyMapping is SET_TO_DEFAULT or IGNORE -> do a null check\n+                return true;\n+            }\n+\n+            if ( rhs.getType().isConverted() ) {\n+                // If the type is converted then check is needed\n+                return true;\n+            }\n+\n+            if ( rhs.getType().isDirect() && targetType.isPrimitive() ) {\n+                // If the type is direct and the target type is primtive then check is needed", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "9879b1fd9e9041cbb5183cc5e200ef6300c07f3e"}, "originalPosition": 66}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyODE3NzY0Mg==", "bodyText": "This is a strange one.. NullValueCheckStrategy does concern parameters, not bean properties.. Do you remember why this one is here? Perhaps it requires some more comment \ud83d\ude04", "url": "https://github.com/mapstruct/mapstruct/pull/2275#discussion_r528177642", "createdAt": "2020-11-21T10:10:25Z", "author": {"login": "sjaakd"}, "path": "processor/src/main/java/org/mapstruct/ap/internal/model/PropertyMapping.java", "diffHunk": "@@ -438,6 +434,49 @@ private Assignment assignToPlainViaSetter(Type targetType, Assignment rhs) {\n             }\n         }\n \n+        /**\n+         * Checks whether the setter wrapper should include a null / presence check or not\n+         *\n+         * @param rhs the source right hand side\n+         * @param targetType the target type\n+         *\n+         * @return whether to include a null / presence check or not\n+         */\n+        private boolean setterWrapperNeedsSourceNullCheck(Assignment rhs, Type targetType) {\n+            if ( rhs.getSourceType().isPrimitive() && rhs.getSourcePresenceCheckerReference() == null ) {\n+                // If the source type is primitive or it doesn't have a presence checker then\n+                // we shouldn't do a null check\n+                return false;\n+            }\n+\n+            if ( nvcs == ALWAYS ) {\n+                // NullValueCheckStrategy is ALWAYS -> do a null check", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "9879b1fd9e9041cbb5183cc5e200ef6300c07f3e"}, "originalPosition": 51}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyODE3NzcwOQ==", "bodyText": "comment: 'a type conversion is applied' so null check is required.", "url": "https://github.com/mapstruct/mapstruct/pull/2275#discussion_r528177709", "createdAt": "2020-11-21T10:11:18Z", "author": {"login": "sjaakd"}, "path": "processor/src/main/java/org/mapstruct/ap/internal/model/PropertyMapping.java", "diffHunk": "@@ -438,6 +434,49 @@ private Assignment assignToPlainViaSetter(Type targetType, Assignment rhs) {\n             }\n         }\n \n+        /**\n+         * Checks whether the setter wrapper should include a null / presence check or not\n+         *\n+         * @param rhs the source right hand side\n+         * @param targetType the target type\n+         *\n+         * @return whether to include a null / presence check or not\n+         */\n+        private boolean setterWrapperNeedsSourceNullCheck(Assignment rhs, Type targetType) {\n+            if ( rhs.getSourceType().isPrimitive() && rhs.getSourcePresenceCheckerReference() == null ) {\n+                // If the source type is primitive or it doesn't have a presence checker then\n+                // we shouldn't do a null check\n+                return false;\n+            }\n+\n+            if ( nvcs == ALWAYS ) {\n+                // NullValueCheckStrategy is ALWAYS -> do a null check\n+                return true;\n+            }\n+\n+            if ( nvpms == SET_TO_DEFAULT || nvpms == IGNORE ) {\n+                // NullValuePropertyMapping is SET_TO_DEFAULT or IGNORE -> do a null check\n+                return true;\n+            }\n+\n+            if ( rhs.getType().isConverted() ) {\n+                // If the type is converted then check is needed", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "9879b1fd9e9041cbb5183cc5e200ef6300c07f3e"}, "originalPosition": 61}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "275083edc951eac0030293572c611494d76ce29b", "author": {"user": {"login": "filiphr", "name": "Filip Hrisafov"}}, "url": "https://github.com/mapstruct/mapstruct/commit/275083edc951eac0030293572c611494d76ce29b", "committedDate": "2020-11-22T12:03:41Z", "message": "Clarify comments"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4489, "cost": 1, "resetAt": "2021-11-01T16:37:27Z"}}}