{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTIzMTQ2MjUy", "number": 2280, "reviewThreads": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0zMFQxMzowNDo0M1rOFKFFQw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wMS0xNVQyMDoxNzoxOFrOFPXjxg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzQ2MTEzMzQ3OnYy", "diffSide": "RIGHT", "path": "processor/src/main/java/org/mapstruct/ap/internal/processor/MapperCreationProcessor.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0zMFQxMzowNDo0M1rOIMs0vw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wMS0xMVQxNDozMTo0MVrOIRXxNg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1MDE4ODIyMw==", "bodyText": "don't try to re-org the imports (nitty-witty thing.. but helps to review the code \ud83d\ude04", "url": "https://github.com/mapstruct/mapstruct/pull/2280#discussion_r550188223", "createdAt": "2020-12-30T13:04:43Z", "author": {"login": "sjaakd"}, "path": "processor/src/main/java/org/mapstruct/ap/internal/processor/MapperCreationProcessor.java", "diffHunk": "@@ -5,14 +5,24 @@\n  */\n package org.mapstruct.ap.internal.processor;\n \n+import static javax.lang.model.element.Modifier.FINAL;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "04d3393aef1f052a1d55900639787a080225adca"}, "originalPosition": 4}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1NTA4NjEzNA==", "bodyText": "Do you want me to rebase and keep the order of imports ?", "url": "https://github.com/mapstruct/mapstruct/pull/2280#discussion_r555086134", "createdAt": "2021-01-11T14:31:41Z", "author": {"login": "dmngb"}, "path": "processor/src/main/java/org/mapstruct/ap/internal/processor/MapperCreationProcessor.java", "diffHunk": "@@ -5,14 +5,24 @@\n  */\n package org.mapstruct.ap.internal.processor;\n \n+import static javax.lang.model.element.Modifier.FINAL;", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1MDE4ODIyMw=="}, "originalCommit": {"oid": "04d3393aef1f052a1d55900639787a080225adca"}, "originalPosition": 4}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzQ2MTEzODI2OnYy", "diffSide": "RIGHT", "path": "processor/src/main/java/org/mapstruct/ap/internal/processor/MapperCreationProcessor.java", "isResolved": true, "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0zMFQxMzowNjo1NVrOIMs3WQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wMS0xNVQyMDoyMjowMlrOIUsmnQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1MDE4ODg4OQ==", "bodyText": "I don't know this from the top of my head, but does a field in an interface automatically get the modifiers \"PUBLIC, STATIC, FINAL\" ?\nI guess checkstyle does, but should we warn as well if you spot an intention to use this pattern but for instance left out STATIC?", "url": "https://github.com/mapstruct/mapstruct/pull/2280#discussion_r550188889", "createdAt": "2020-12-30T13:06:55Z", "author": {"login": "sjaakd"}, "path": "processor/src/main/java/org/mapstruct/ap/internal/processor/MapperCreationProcessor.java", "diffHunk": "@@ -133,9 +138,16 @@ public int getPriority() {\n         List<String> variableNames = new LinkedList<>();\n \n         for ( TypeMirror usedMapper : mapperAnnotation.uses() ) {\n+            boolean isSingleton = typeUtils.asElement( usedMapper ).getEnclosedElements().stream()", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "04d3393aef1f052a1d55900639787a080225adca"}, "originalPosition": 69}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1NTA4Nzc0Nw==", "bodyText": "Yes, a field on an interface is automatically \"public static final\".", "url": "https://github.com/mapstruct/mapstruct/pull/2280#discussion_r555087747", "createdAt": "2021-01-11T14:33:56Z", "author": {"login": "dmngb"}, "path": "processor/src/main/java/org/mapstruct/ap/internal/processor/MapperCreationProcessor.java", "diffHunk": "@@ -133,9 +138,16 @@ public int getPriority() {\n         List<String> variableNames = new LinkedList<>();\n \n         for ( TypeMirror usedMapper : mapperAnnotation.uses() ) {\n+            boolean isSingleton = typeUtils.asElement( usedMapper ).getEnclosedElements().stream()", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1MDE4ODg4OQ=="}, "originalCommit": {"oid": "04d3393aef1f052a1d55900639787a080225adca"}, "originalPosition": 69}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1ODU3MzIxMw==", "bodyText": "I don't think it is our job to emit warnings for this. If it is really needed every project can define different rules and have such warnings through checkstyle / sonar", "url": "https://github.com/mapstruct/mapstruct/pull/2280#discussion_r558573213", "createdAt": "2021-01-15T20:22:02Z", "author": {"login": "filiphr"}, "path": "processor/src/main/java/org/mapstruct/ap/internal/processor/MapperCreationProcessor.java", "diffHunk": "@@ -133,9 +138,16 @@ public int getPriority() {\n         List<String> variableNames = new LinkedList<>();\n \n         for ( TypeMirror usedMapper : mapperAnnotation.uses() ) {\n+            boolean isSingleton = typeUtils.asElement( usedMapper ).getEnclosedElements().stream()", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1MDE4ODg4OQ=="}, "originalCommit": {"oid": "04d3393aef1f052a1d55900639787a080225adca"}, "originalPosition": 69}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzUxNjU4OTUwOnYy", "diffSide": "RIGHT", "path": "processor/src/main/java/org/mapstruct/ap/internal/processor/MapperCreationProcessor.java", "isResolved": false, "comments": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wMS0xNVQyMDoxNzoxOFrOIUsd-g==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wMS0xOFQxMDo0MjoxMFrOIVjcGw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1ODU3MTAwMg==", "bodyText": "I don't really like that we have so many different method calls here.\nI would suggest the following. Extract a method named hasInstanceMapper that takes Element as a parameter and returns true if  these 4 conditions here are satisfied. Additionally instead of using filter you can directly use anyMatch(this::hasInstanceMapper).\nI would also suggest extracting the Arrays.asList into a static field in the MapperCreationProcessor in order to avoid creating that list all the time.", "url": "https://github.com/mapstruct/mapstruct/pull/2280#discussion_r558571002", "createdAt": "2021-01-15T20:17:18Z", "author": {"login": "filiphr"}, "path": "processor/src/main/java/org/mapstruct/ap/internal/processor/MapperCreationProcessor.java", "diffHunk": "@@ -133,9 +138,16 @@ public int getPriority() {\n         List<String> variableNames = new LinkedList<>();\n \n         for ( TypeMirror usedMapper : mapperAnnotation.uses() ) {\n+            boolean isSingleton = typeUtils.asElement( usedMapper ).getEnclosedElements().stream()\n+            .filter( a -> a.getKind().isField() )\n+            .filter( a -> a.getModifiers().containsAll( Arrays.asList( PUBLIC, STATIC, FINAL ) ) )\n+            .filter( a -> a.getSimpleName().contentEquals( \"INSTANCE\" ) )\n+            .filter( a -> typeUtils.isSameType( a.asType(), usedMapper ) )\n+            .anyMatch( a -> true );", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "04d3393aef1f052a1d55900639787a080225adca"}, "originalPosition": 74}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1OTIwOTYzNg==", "bodyText": "I just pushed changes to extract  methods/constants (more or less) as suggested.\nOr do you prefer a rebase/squash ?", "url": "https://github.com/mapstruct/mapstruct/pull/2280#discussion_r559209636", "createdAt": "2021-01-17T17:07:48Z", "author": {"login": "dmngb"}, "path": "processor/src/main/java/org/mapstruct/ap/internal/processor/MapperCreationProcessor.java", "diffHunk": "@@ -133,9 +138,16 @@ public int getPriority() {\n         List<String> variableNames = new LinkedList<>();\n \n         for ( TypeMirror usedMapper : mapperAnnotation.uses() ) {\n+            boolean isSingleton = typeUtils.asElement( usedMapper ).getEnclosedElements().stream()\n+            .filter( a -> a.getKind().isField() )\n+            .filter( a -> a.getModifiers().containsAll( Arrays.asList( PUBLIC, STATIC, FINAL ) ) )\n+            .filter( a -> a.getSimpleName().contentEquals( \"INSTANCE\" ) )\n+            .filter( a -> typeUtils.isSameType( a.asType(), usedMapper ) )\n+            .anyMatch( a -> true );", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1ODU3MTAwMg=="}, "originalCommit": {"oid": "04d3393aef1f052a1d55900639787a080225adca"}, "originalPosition": 74}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1OTIxNDAxMQ==", "bodyText": "There is some conflict now, if you can rebase your changes on top of master it would branch, it would be great. If you can't we can do it when merging", "url": "https://github.com/mapstruct/mapstruct/pull/2280#discussion_r559214011", "createdAt": "2021-01-17T17:41:44Z", "author": {"login": "filiphr"}, "path": "processor/src/main/java/org/mapstruct/ap/internal/processor/MapperCreationProcessor.java", "diffHunk": "@@ -133,9 +138,16 @@ public int getPriority() {\n         List<String> variableNames = new LinkedList<>();\n \n         for ( TypeMirror usedMapper : mapperAnnotation.uses() ) {\n+            boolean isSingleton = typeUtils.asElement( usedMapper ).getEnclosedElements().stream()\n+            .filter( a -> a.getKind().isField() )\n+            .filter( a -> a.getModifiers().containsAll( Arrays.asList( PUBLIC, STATIC, FINAL ) ) )\n+            .filter( a -> a.getSimpleName().contentEquals( \"INSTANCE\" ) )\n+            .filter( a -> typeUtils.isSameType( a.asType(), usedMapper ) )\n+            .anyMatch( a -> true );", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1ODU3MTAwMg=="}, "originalCommit": {"oid": "04d3393aef1f052a1d55900639787a080225adca"}, "originalPosition": 74}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1OTQ3MTY0Mw==", "bodyText": "I have rebased on top of master.", "url": "https://github.com/mapstruct/mapstruct/pull/2280#discussion_r559471643", "createdAt": "2021-01-18T10:42:10Z", "author": {"login": "dmngb"}, "path": "processor/src/main/java/org/mapstruct/ap/internal/processor/MapperCreationProcessor.java", "diffHunk": "@@ -133,9 +138,16 @@ public int getPriority() {\n         List<String> variableNames = new LinkedList<>();\n \n         for ( TypeMirror usedMapper : mapperAnnotation.uses() ) {\n+            boolean isSingleton = typeUtils.asElement( usedMapper ).getEnclosedElements().stream()\n+            .filter( a -> a.getKind().isField() )\n+            .filter( a -> a.getModifiers().containsAll( Arrays.asList( PUBLIC, STATIC, FINAL ) ) )\n+            .filter( a -> a.getSimpleName().contentEquals( \"INSTANCE\" ) )\n+            .filter( a -> typeUtils.isSameType( a.asType(), usedMapper ) )\n+            .anyMatch( a -> true );", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1ODU3MTAwMg=="}, "originalCommit": {"oid": "04d3393aef1f052a1d55900639787a080225adca"}, "originalPosition": 74}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4193, "cost": 1, "resetAt": "2021-11-13T12:10:21Z"}}}