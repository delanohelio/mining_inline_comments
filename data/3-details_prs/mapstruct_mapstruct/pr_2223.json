{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDk5NTE2MDA0", "number": 2223, "title": "#2221: Fix configuration inheritance when there are multiple matching source parameters of the same type", "bodyText": "Fixes #2221\nI also did some small refactoring as the Collectors.reducing( (a, b) -> null ) was really confusing to me.", "createdAt": "2020-10-07T21:04:18Z", "url": "https://github.com/mapstruct/mapstruct/pull/2223", "merged": true, "mergeCommit": {"oid": "a5f49e591ed3bb2e5c2b7565c0a9f968be47643d"}, "closed": true, "closedAt": "2020-10-10T07:43:31Z", "author": {"login": "filiphr"}, "timelineItems": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdQTobtgH2gAyNDk5NTE2MDA0OmE3YTQwZjVkYjQ0NDMwYWU1M2VlNWNhMTgzOGI2ODViOTM5NzlmNGE=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdQn2l4gFqTUwNTE1MjUxOQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "a7a40f5db44430ae53ee5ca1838b685b93979f4a", "author": {"user": {"login": "filiphr", "name": "Filip Hrisafov"}}, "url": "https://github.com/mapstruct/mapstruct/commit/a7a40f5db44430ae53ee5ca1838b685b93979f4a", "committedDate": "2020-10-07T21:12:23Z", "message": "#2221: Fix configuration inheritance when there are multiple matching source parameters of the same type"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "3129056ca759bd8a26d9d7269b82da34da9793be", "author": {"user": {"login": "filiphr", "name": "Filip Hrisafov"}}, "url": "https://github.com/mapstruct/mapstruct/commit/3129056ca759bd8a26d9d7269b82da34da9793be", "committedDate": "2020-10-07T21:03:16Z", "message": "#2221: Fix configuration inheritance when there are multiple matching source parameters of the same type"}, "afterCommit": {"oid": "a7a40f5db44430ae53ee5ca1838b685b93979f4a", "author": {"user": {"login": "filiphr", "name": "Filip Hrisafov"}}, "url": "https://github.com/mapstruct/mapstruct/commit/a7a40f5db44430ae53ee5ca1838b685b93979f4a", "committedDate": "2020-10-07T21:12:23Z", "message": "#2221: Fix configuration inheritance when there are multiple matching source parameters of the same type"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTA1MTUyNTE5", "url": "https://github.com/mapstruct/mapstruct/pull/2223#pullrequestreview-505152519", "createdAt": "2020-10-08T20:45:34Z", "commit": {"oid": "a7a40f5db44430ae53ee5ca1838b685b93979f4a"}, "state": "APPROVED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wOFQyMDo0NTozNFrOHevxiw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wOFQyMDo0NTozNFrOHevxiw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMjAwMjA1OQ==", "bodyText": "is there a situation where the parameter you fetch here is not assignable? It seems like you fetch a parameter again only based on its name.", "url": "https://github.com/mapstruct/mapstruct/pull/2223#discussion_r502002059", "createdAt": "2020-10-08T20:45:34Z", "author": {"login": "sjaakd"}, "path": "processor/src/main/java/org/mapstruct/ap/internal/model/beanmapping/SourceReference.java", "diffHunk": "@@ -239,11 +238,24 @@ private Parameter getSourceParameterFromMethodOrTemplate(String parameterName )\n             if ( isForwarded ) {\n                 Parameter parameter = Parameter.getSourceParameter( templateMethod.getParameters(), parameterName );\n                 if ( parameter != null ) {\n-                    result = method.getSourceParameters()\n-                                   .stream()\n-                                   .filter( p -> p.getType().isAssignableTo( parameter.getType() ) )\n-                                   .collect( Collectors.reducing( (a, b) -> null ) )\n-                                   .orElse( null );\n+\n+                    // When forward inheriting we should find the matching source parameter by type\n+                    // If there are multiple parameters of the same type\n+                    // then we fallback to match the parameter name to the current method source parameters\n+                    for ( Parameter sourceParameter : method.getSourceParameters() ) {\n+                        if ( sourceParameter.getType().isAssignableTo( parameter.getType() ) ) {\n+                            if ( result == null ) {\n+                                result = sourceParameter;\n+                            }\n+                            else {\n+                                // When we reach here it means that we found a second source parameter\n+                                // that has the same type, then fallback to the matching source parameter\n+                                // in the current method\n+                                result = Parameter.getSourceParameter( method.getParameters(), parameterName );", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "a7a40f5db44430ae53ee5ca1838b685b93979f4a"}, "originalPosition": 30}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4471, "cost": 1, "resetAt": "2021-11-01T16:37:27Z"}}}