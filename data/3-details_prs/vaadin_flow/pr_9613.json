{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTM0OTQ1MDgw", "number": 9613, "title": "Add IT test for CSS loading order", "bodyText": "Resolves #9529", "createdAt": "2020-12-09T06:37:26Z", "url": "https://github.com/vaadin/flow/pull/9613", "merged": true, "mergeCommit": {"oid": "8da57c1401b93a78f9ed1310777dcac4026f58a0"}, "closed": true, "closedAt": "2020-12-21T09:42:54Z", "author": {"login": "tanbt"}, "timelineItems": {"totalCount": 13, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdkQfw0gH2gAyNTM0OTQ1MDgwOjJjNGZmYjkwZWZiMWFjNDkxZjlhZWM5OTM2YWUxOTc0ODM3MjkyOWE=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdoSsPOgFqTU1NjI0ODc1MA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "2c4ffb90efb1ac491f9aec9936ae19748372929a", "author": {"user": {"login": "tanbt", "name": "Tan Bui"}}, "url": "https://github.com/vaadin/flow/commit/2c4ffb90efb1ac491f9aec9936ae19748372929a", "committedDate": "2020-12-08T20:51:41Z", "message": "Add IT test for Css loading order"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "470b0179a8a4d84edbb30188406ad6780d9cc22e", "author": {"user": {"login": "tanbt", "name": "Tan Bui"}}, "url": "https://github.com/vaadin/flow/commit/470b0179a8a4d84edbb30188406ad6780d9cc22e", "committedDate": "2020-12-08T21:26:18Z", "message": "Add test for overriding Lumo custom CSS property"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTQ5ODU0NzQz", "url": "https://github.com/vaadin/flow/pull/9613#pullrequestreview-549854743", "createdAt": "2020-12-11T07:27:05Z", "commit": {"oid": "470b0179a8a4d84edbb30188406ad6780d9cc22e"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xMVQwNzoyNzowNVrOIDsStw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xMVQwNzoyNzowNVrOIDsStw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MDc0MjMyNw==", "bodyText": "The test name doesn't give a clear insight to what it actually tests.", "url": "https://github.com/vaadin/flow/pull/9613#discussion_r540742327", "createdAt": "2020-12-11T07:27:05Z", "author": {"login": "caalador"}, "path": "flow-tests/test-themes/src/test/java/com/vaadin/flow/uitest/ui/theme/CssLoadingIT.java", "diffHunk": "@@ -0,0 +1,75 @@\n+/*\n+ * Copyright 2000-2020 Vaadin Ltd.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\"); you may not\n+ * use this file except in compliance with the License. You may obtain a copy of\n+ * the License at\n+ *\n+ * http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS, WITHOUT\n+ * WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied. See the\n+ * License for the specific language governing permissions and limitations under\n+ * the License.\n+ */\n+package com.vaadin.flow.uitest.ui.theme;\n+\n+import org.junit.Assert;\n+import org.junit.Test;\n+import org.openqa.selenium.By;\n+import org.openqa.selenium.WebElement;\n+\n+import com.vaadin.flow.component.html.testbench.ParagraphElement;\n+import com.vaadin.flow.testutil.ChromeBrowserTest;\n+\n+import static com.vaadin.flow.uitest.ui.theme.CssLoadingView.CSS_IMPORT__PAGE_ADD_STYLESHEET;\n+import static com.vaadin.flow.uitest.ui.theme.CssLoadingView.CSS_IMPORT__STYLESHEET;\n+import static com.vaadin.flow.uitest.ui.theme.CssLoadingView.PAGE_ADD_STYLESHEET__STYLESHEET;\n+\n+public class CssLoadingIT extends ChromeBrowserTest {\n+\n+    private static final String BLUE_RGBA = \"rgba(0, 0, 255, 1)\";\n+    private static final String GREEN_RGBA = \"rgba(0, 255, 0, 1)\";\n+    private static final String STYLESHEET_LUMO_FONT_SIZE_M = \" 30px\";\n+\n+    @Test\n+    public void StyleSheet_overrides_CssImport() {\n+        open();\n+        // @StyleSheet [blue] > page.addStyleSheet() [green] < @CssImport [red]\n+        Assert.assertEquals(\n+                \"Styles from @StyleSheet should have a higher priority than from @CssImport.\",\n+                BLUE_RGBA, $(ParagraphElement.class).id(CSS_IMPORT__STYLESHEET)\n+                        .getCssValue(\"color\"));\n+    }\n+\n+    @Test\n+    public void addStyleSheet_overrides_StyleSheet() {\n+        open();\n+        Assert.assertEquals(\n+                \"Styles from addStyleSheet() should have a higher priority than from @StyleSheet.\",\n+                BLUE_RGBA,\n+                $(ParagraphElement.class).id(PAGE_ADD_STYLESHEET__STYLESHEET)\n+                        .getCssValue(\"color\"));\n+    }\n+\n+    @Test\n+    public void addStyleSheet_overrides_CssImport() {\n+        open();\n+        Assert.assertEquals(\n+                \"Styles from addStyleSheet() should have a higher priority than from @CssImport.\",\n+                GREEN_RGBA,\n+                $(ParagraphElement.class).id(CSS_IMPORT__PAGE_ADD_STYLESHEET)\n+                        .getCssValue(\"color\"));\n+    }\n+\n+    @Test\n+    public void lumoStyleIsOverridden() {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "470b0179a8a4d84edbb30188406ad6780d9cc22e"}, "originalPosition": 67}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "32dcafc7dfcd6604407e2ca5cd569ea61ad1bbcd", "author": {"user": {"login": "tanbt", "name": "Tan Bui"}}, "url": "https://github.com/vaadin/flow/commit/32dcafc7dfcd6604407e2ca5cd569ea61ad1bbcd", "committedDate": "2020-12-17T07:24:02Z", "message": "Merge branch 'master' into test-css-loading-order"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "35e49b4bde2985d6abbbf499fce738828c70a7e7", "author": {"user": {"login": "tanbt", "name": "Tan Bui"}}, "url": "https://github.com/vaadin/flow/commit/35e49b4bde2985d6abbbf499fce738828c70a7e7", "committedDate": "2020-12-17T13:16:02Z", "message": "Merge branch 'master' into test-css-loading-order"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "4e11ad9a7662ddb3ee2286aef0d8d2e83ebb5710", "author": {"user": {"login": "tanbt", "name": "Tan Bui"}}, "url": "https://github.com/vaadin/flow/commit/4e11ad9a7662ddb3ee2286aef0d8d2e83ebb5710", "committedDate": "2020-12-17T16:14:36Z", "message": "Merge branch 'master' into test-css-loading-order"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "d553baee027f30abbe4356d8e9c493636e4a4149", "author": {"user": {"login": "tanbt", "name": "Tan Bui"}}, "url": "https://github.com/vaadin/flow/commit/d553baee027f30abbe4356d8e9c493636e4a4149", "committedDate": "2020-12-17T19:41:05Z", "message": "Test that application theme override lumo styles"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "046b12236017cdfe7642e73a868a92c24c005e7e", "author": {"user": {"login": "tanbt", "name": "Tan Bui"}}, "url": "https://github.com/vaadin/flow/commit/046b12236017cdfe7642e73a868a92c24c005e7e", "committedDate": "2020-12-18T09:38:31Z", "message": "Add test for all overridings"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "bf00390c394113e863495df67dc2ffdf31420dbd", "author": {"user": {"login": "tanbt", "name": "Tan Bui"}}, "url": "https://github.com/vaadin/flow/commit/bf00390c394113e863495df67dc2ffdf31420dbd", "committedDate": "2020-12-18T10:32:09Z", "message": "Merge branch 'master' into test-css-loading-order"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTU1NDAxMTMy", "url": "https://github.com/vaadin/flow/pull/9613#pullrequestreview-555401132", "createdAt": "2020-12-18T11:13:55Z", "commit": {"oid": "bf00390c394113e863495df67dc2ffdf31420dbd"}, "state": "DISMISSED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xOFQxMToxMzo1NVrOIIe3Jg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xOFQxMToxMzo1NVrOIIe3Jg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NTc2NTE1OA==", "bodyText": "Should these 3 tests just be merged to one multipleDefinitions_correctOverrides as opening a new browser for single asserts is quite heavy and they could just mention in the assertion fail message which part failed for which exception.", "url": "https://github.com/vaadin/flow/pull/9613#discussion_r545765158", "createdAt": "2020-12-18T11:13:55Z", "author": {"login": "caalador"}, "path": "flow-tests/test-themes/src/test/java/com/vaadin/flow/uitest/ui/theme/CssLoadingIT.java", "diffHunk": "@@ -0,0 +1,80 @@\n+/*\n+ * Copyright 2000-2020 Vaadin Ltd.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\"); you may not\n+ * use this file except in compliance with the License. You may obtain a copy of\n+ * the License at\n+ *\n+ * http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS, WITHOUT\n+ * WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied. See the\n+ * License for the specific language governing permissions and limitations under\n+ * the License.\n+ */\n+package com.vaadin.flow.uitest.ui.theme;\n+\n+import org.junit.Assert;\n+import org.junit.Test;\n+import org.openqa.selenium.By;\n+import org.openqa.selenium.WebElement;\n+\n+import com.vaadin.flow.component.html.testbench.ParagraphElement;\n+import com.vaadin.flow.testutil.ChromeBrowserTest;\n+\n+/**\n+ * Test CSS loading order from different sources.\n+ *\n+ * The expected order is: Lumo styles < @CssImport < page.addStylesheet\n+ * < @Stylehseet < parent theme < current theme (app theme)\n+ */\n+public class CssLoadingIT extends ChromeBrowserTest {\n+\n+    private static final String RED_RGBA = \"rgba(255, 0, 0, 1)\";\n+    private static final String BLUE_RGBA = \"rgba(0, 0, 255, 1)\";\n+    private static final String GREEN_RGBA = \"rgba(0, 255, 0, 1)\";\n+    private static final String YELLOW_RGBA = \"rgba(255, 255, 0, 1)\";\n+    private static final String STYLESHEET_LUMO_FONT_SIZE_M = \" 1.1rem\";\n+\n+    @Test\n+    public void CssImport_overrides_Lumo() {\n+        open();\n+        WebElement htmlElement = findElement(By.tagName(\"html\"));\n+\n+        Assert.assertEquals(\"CssImport styles should override Lumo styles.\",\n+                STYLESHEET_LUMO_FONT_SIZE_M,\n+                executeScript(\n+                        \"return getComputedStyle(arguments[0]).getPropertyValue('--lumo-font-size-m')\",\n+                        htmlElement));\n+    }\n+\n+    @Test\n+    public void pageAddStylesheet_overrides_CssImport() {\n+        open();\n+        assertStylesOverride(\"p1\", GREEN_RGBA, \"16px\", \"1px\");\n+    }\n+\n+    @Test\n+    public void Stylesheet_overrides_pageAddStylesheetAndCssImport() {\n+        open();\n+        // @Stylesheet should override color and font-size but not margin\n+        assertStylesOverride(\"p2\", BLUE_RGBA, \"18px\", \"1px\");\n+    }\n+\n+    @Test\n+    public void appTheme_overrides_all() {\n+        open();\n+        assertStylesOverride(\"p3\", YELLOW_RGBA, \"20px\", \"2px\");\n+    }", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "bf00390c394113e863495df67dc2ffdf31420dbd"}, "originalPosition": 69}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e1e17e63123b7ea1edd7b10138d2402f9daf2a99", "author": {"user": {"login": "tanbt", "name": "Tan Bui"}}, "url": "https://github.com/vaadin/flow/commit/e1e17e63123b7ea1edd7b10138d2402f9daf2a99", "committedDate": "2020-12-18T11:33:11Z", "message": "Refactor based on review"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTU2MjQ3ODk3", "url": "https://github.com/vaadin/flow/pull/9613#pullrequestreview-556247897", "createdAt": "2020-12-21T09:39:21Z", "commit": {"oid": "e1e17e63123b7ea1edd7b10138d2402f9daf2a99"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0yMVQwOTozOToyMVrOIJSBlA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0yMVQwOTozOToyMVrOIJSBlA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NjYwMzQxMg==", "bodyText": "Is it better to split out these 3 assertions into 3 separate tests and name them accordingly for better readability/maintainability?", "url": "https://github.com/vaadin/flow/pull/9613#discussion_r546603412", "createdAt": "2020-12-21T09:39:21Z", "author": {"login": "mshabarov"}, "path": "flow-tests/test-themes/src/test/java/com/vaadin/flow/uitest/ui/theme/CssLoadingIT.java", "diffHunk": "@@ -0,0 +1,71 @@\n+/*\n+ * Copyright 2000-2020 Vaadin Ltd.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\"); you may not\n+ * use this file except in compliance with the License. You may obtain a copy of\n+ * the License at\n+ *\n+ * http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS, WITHOUT\n+ * WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied. See the\n+ * License for the specific language governing permissions and limitations under\n+ * the License.\n+ */\n+package com.vaadin.flow.uitest.ui.theme;\n+\n+import org.junit.Assert;\n+import org.junit.Test;\n+import org.openqa.selenium.By;\n+import org.openqa.selenium.WebElement;\n+\n+import com.vaadin.flow.component.html.testbench.ParagraphElement;\n+import com.vaadin.flow.testutil.ChromeBrowserTest;\n+\n+/**\n+ * Test CSS loading order from different sources.\n+ *\n+ * The expected priority is: Lumo styles < @CssImport < page.addStylesheet\n+ * < @Stylehseet < parent theme < current theme (app theme)\n+ */\n+public class CssLoadingIT extends ChromeBrowserTest {\n+\n+    private static final String BLUE_RGBA = \"rgba(0, 0, 255, 1)\";\n+    private static final String GREEN_RGBA = \"rgba(0, 255, 0, 1)\";\n+    private static final String YELLOW_RGBA = \"rgba(255, 255, 0, 1)\";\n+    private static final String STYLESHEET_LUMO_FONT_SIZE_M = \" 1.1rem\";\n+\n+    @Test\n+    public void CssImport_overrides_Lumo() {\n+        open();\n+        WebElement htmlElement = findElement(By.tagName(\"html\"));\n+\n+        Assert.assertEquals(\"CssImport styles should override Lumo styles.\",\n+                STYLESHEET_LUMO_FONT_SIZE_M,\n+                executeScript(\n+                        \"return getComputedStyle(arguments[0]).getPropertyValue('--lumo-font-size-m')\",\n+                        htmlElement));\n+    }\n+\n+    @Test\n+    public void multipleDefinitions_correctOverrides() {\n+        open();\n+        assertStylesOverride(\"p1\", GREEN_RGBA, \"16px\", \"1px\");", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "e1e17e63123b7ea1edd7b10138d2402f9daf2a99"}, "originalPosition": 54}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTU2MjQ4NzUw", "url": "https://github.com/vaadin/flow/pull/9613#pullrequestreview-556248750", "createdAt": "2020-12-21T09:40:49Z", "commit": {"oid": "e1e17e63123b7ea1edd7b10138d2402f9daf2a99"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4660, "cost": 1, "resetAt": "2021-10-28T20:13:43Z"}}}