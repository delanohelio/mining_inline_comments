{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTM5NTMyMzYz", "number": 9649, "reviewThreads": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xNlQyMjozMTozNlrOFGbX2w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xNlQyMjozMTozNlrOFGbX2w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzQyMjg0MjUxOnYy", "diffSide": "RIGHT", "path": "flow-client/src/main/resources/META-INF/resources/frontend/Connect.ts", "isResolved": false, "comments": {"totalCount": 6, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xNlQyMjozMTozNlrOIHcDDg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xN1QwNzozOTo1NVrOIHoYXg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NDY3MDQ3OA==", "bodyText": "I know it's a bit of the edge case, but Vaadin.Flow could be also defined if there is an embedded Flow component (not the whole application, just a component, probably even coming from another server)", "url": "https://github.com/vaadin/flow/pull/9649#discussion_r544670478", "createdAt": "2020-12-16T22:31:36Z", "author": {"login": "fluorumlabs"}, "path": "flow-client/src/main/resources/META-INF/resources/frontend/Connect.ts", "diffHunk": "@@ -285,6 +285,19 @@ export class ConnectClient {\n \n     // ensure connection indicator is visible from this entry point\n     getConnectionIndicator();\n+\n+    // Listen to browser online/offline events and update the loading indicator accordingly.\n+    // Note: if Flow.ts is loaded, it instead handles the state transitions.\n+    $wnd.addEventListener('online', () => {\n+      if ($wnd.Vaadin.Flow === undefined) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "bfdd30a9c1f9d508c1977615350aab645905a853"}, "originalPosition": 8}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NDg0MTM1OQ==", "bodyText": "Any suggestions on how it can be improved?", "url": "https://github.com/vaadin/flow/pull/9649#discussion_r544841359", "createdAt": "2020-12-17T06:24:15Z", "author": {"login": "haijian-vaadin"}, "path": "flow-client/src/main/resources/META-INF/resources/frontend/Connect.ts", "diffHunk": "@@ -285,6 +285,19 @@ export class ConnectClient {\n \n     // ensure connection indicator is visible from this entry point\n     getConnectionIndicator();\n+\n+    // Listen to browser online/offline events and update the loading indicator accordingly.\n+    // Note: if Flow.ts is loaded, it instead handles the state transitions.\n+    $wnd.addEventListener('online', () => {\n+      if ($wnd.Vaadin.Flow === undefined) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NDY3MDQ3OA=="}, "originalCommit": {"oid": "bfdd30a9c1f9d508c1977615350aab645905a853"}, "originalPosition": 8}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NDg1NzAyOA==", "bodyText": "I prefer to merge the PR now, as the fix is more important than covering the edge case atm.\nAfter the merge, we can start merging the offline branch to master, which can unblock the release.\nFurther suggestions can be applied to the master branch later on.", "url": "https://github.com/vaadin/flow/pull/9649#discussion_r544857028", "createdAt": "2020-12-17T07:05:24Z", "author": {"login": "haijian-vaadin"}, "path": "flow-client/src/main/resources/META-INF/resources/frontend/Connect.ts", "diffHunk": "@@ -285,6 +285,19 @@ export class ConnectClient {\n \n     // ensure connection indicator is visible from this entry point\n     getConnectionIndicator();\n+\n+    // Listen to browser online/offline events and update the loading indicator accordingly.\n+    // Note: if Flow.ts is loaded, it instead handles the state transitions.\n+    $wnd.addEventListener('online', () => {\n+      if ($wnd.Vaadin.Flow === undefined) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NDY3MDQ3OA=="}, "originalCommit": {"oid": "bfdd30a9c1f9d508c1977615350aab645905a853"}, "originalPosition": 8}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NDg1ODAwOA==", "bodyText": "Hard to say. To me it looks Flow client doesn't listen to online/offline events at all. Needs to be rechecked though.", "url": "https://github.com/vaadin/flow/pull/9649#discussion_r544858008", "createdAt": "2020-12-17T07:07:51Z", "author": {"login": "fluorumlabs"}, "path": "flow-client/src/main/resources/META-INF/resources/frontend/Connect.ts", "diffHunk": "@@ -285,6 +285,19 @@ export class ConnectClient {\n \n     // ensure connection indicator is visible from this entry point\n     getConnectionIndicator();\n+\n+    // Listen to browser online/offline events and update the loading indicator accordingly.\n+    // Note: if Flow.ts is loaded, it instead handles the state transitions.\n+    $wnd.addEventListener('online', () => {\n+      if ($wnd.Vaadin.Flow === undefined) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NDY3MDQ3OA=="}, "originalCommit": {"oid": "bfdd30a9c1f9d508c1977615350aab645905a853"}, "originalPosition": 8}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NDg1ODYyMQ==", "bodyText": "I prefer to merge the PR now, as the fix is more important than covering the edge case atm.\n\nSure thing. Let's move this to technical debt :)", "url": "https://github.com/vaadin/flow/pull/9649#discussion_r544858621", "createdAt": "2020-12-17T07:09:14Z", "author": {"login": "fluorumlabs"}, "path": "flow-client/src/main/resources/META-INF/resources/frontend/Connect.ts", "diffHunk": "@@ -285,6 +285,19 @@ export class ConnectClient {\n \n     // ensure connection indicator is visible from this entry point\n     getConnectionIndicator();\n+\n+    // Listen to browser online/offline events and update the loading indicator accordingly.\n+    // Note: if Flow.ts is loaded, it instead handles the state transitions.\n+    $wnd.addEventListener('online', () => {\n+      if ($wnd.Vaadin.Flow === undefined) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NDY3MDQ3OA=="}, "originalCommit": {"oid": "bfdd30a9c1f9d508c1977615350aab645905a853"}, "originalPosition": 8}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NDg3MjU0Mg==", "bodyText": "Hard to say. To me it looks Flow client doesn't listen to online/offline events at all. Needs to be rechecked though.\n\nhttps://github.com/vaadin/flow/blob/feature/offline/flow-client/src/main/java/com/vaadin/client/communication/DefaultConnectionStateHandler.java#L541-L551\nThough the point is good, the embedded case needs testing. Will do and create a ticket if I find some issues.", "url": "https://github.com/vaadin/flow/pull/9649#discussion_r544872542", "createdAt": "2020-12-17T07:39:55Z", "author": {"login": "joheriks"}, "path": "flow-client/src/main/resources/META-INF/resources/frontend/Connect.ts", "diffHunk": "@@ -285,6 +285,19 @@ export class ConnectClient {\n \n     // ensure connection indicator is visible from this entry point\n     getConnectionIndicator();\n+\n+    // Listen to browser online/offline events and update the loading indicator accordingly.\n+    // Note: if Flow.ts is loaded, it instead handles the state transitions.\n+    $wnd.addEventListener('online', () => {\n+      if ($wnd.Vaadin.Flow === undefined) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NDY3MDQ3OA=="}, "originalCommit": {"oid": "bfdd30a9c1f9d508c1977615350aab645905a853"}, "originalPosition": 8}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3742, "cost": 1, "resetAt": "2021-11-13T12:26:42Z"}}}