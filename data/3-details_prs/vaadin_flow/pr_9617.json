{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTM1MDU1NTk4", "number": 9617, "title": "Feat: Check that npm resources are available", "bodyText": "Check that we have named npm resources\navailable or throw an exception informing\nthe user to intall it using a NpmPackage\nannotation or manually with (p)npm i\nFixes #9615", "createdAt": "2020-12-09T09:57:05Z", "url": "https://github.com/vaadin/flow/pull/9617", "merged": true, "mergeCommit": {"oid": "7bb6181293d9f29f333d7977985f4c719af0e06a"}, "closed": true, "closedAt": "2020-12-10T12:20:18Z", "author": {"login": "caalador"}, "timelineItems": {"totalCount": 6, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdku1qEgH2gAyNTM1MDU1NTk4OjI1ODNmOWQ1MjgxYWUyYjg1NmRlMzg2OTAxNzQ3ZjJmOTQyMWQyMTg=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdkwxRNAFqTU0OTA1NTUzMA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "2583f9d5281ae2b856de386901747f2f9421d218", "author": {"user": {"login": "caalador", "name": null}}, "url": "https://github.com/vaadin/flow/commit/2583f9d5281ae2b856de386901747f2f9421d218", "committedDate": "2020-12-10T08:12:45Z", "message": "Feat: Check that npm resources are available\n\nCheck that we have named npm resources\navailable or throw an exception informing\nthe user to intall it using a NpmPackage\nannotation or manually with (p)npm i\n\nFixes #9615"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "d43242e419cbae9b032563a20d583770f7b4db6f", "author": {"user": {"login": "caalador", "name": null}}, "url": "https://github.com/vaadin/flow/commit/d43242e419cbae9b032563a20d583770f7b4db6f", "committedDate": "2020-12-10T08:12:47Z", "message": "Add npmPackage for assets."}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "dbf8f7933dce28a2a334046426e5f66e2ba1f39d", "author": {"user": {"login": "caalador", "name": null}}, "url": "https://github.com/vaadin/flow/commit/dbf8f7933dce28a2a334046426e5f66e2ba1f39d", "committedDate": "2020-12-09T10:43:23Z", "message": "Add npmPackage for assets."}, "afterCommit": {"oid": "d43242e419cbae9b032563a20d583770f7b4db6f", "author": {"user": {"login": "caalador", "name": null}}, "url": "https://github.com/vaadin/flow/commit/d43242e419cbae9b032563a20d583770f7b4db6f", "committedDate": "2020-12-10T08:12:47Z", "message": "Add npmPackage for assets."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTQ4OTY3MDUz", "url": "https://github.com/vaadin/flow/pull/9617#pullrequestreview-548967053", "createdAt": "2020-12-10T08:48:22Z", "commit": {"oid": "d43242e419cbae9b032563a20d583770f7b4db6f"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xMFQwODo0ODoyMlrOIC93AQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xMFQwODo1MzozOVrOIC-Eng==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzOTk4MTU2OQ==", "bodyText": "Would it be better if we would check for all the missing packages in a loop and output all of them at once ?\nSo if one is missing 5 of those (for example due to not reading our docs on how to package a reusable theme), they could know all of the missing things after one run instead of 5 ?", "url": "https://github.com/vaadin/flow/pull/9617#discussion_r539981569", "createdAt": "2020-12-10T08:48:22Z", "author": {"login": "pleku"}, "path": "flow-server/src/main/resources/plugins/application-theme-plugin/theme-copy.js", "diffHunk": "@@ -66,7 +66,10 @@ function copyStaticAssets(themeName, themeProperties, projectStaticAssetsOutputF\n     const copyRules = assets[module];\n     Object.keys(copyRules).forEach((copyRule) => {\n       const nodeSources = path.resolve('node_modules/', module, copyRule);\n-      const files = glob.sync(nodeSources, {nodir: true});\n+      if(!fs.existsSync(path.resolve('node_modules/', module))) {\n+        throw Error(\"Missing '\" + module + \"'. Install package by adding a @NpmPackage annotation or install it using 'npm/pnpm i'\");", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d43242e419cbae9b032563a20d583770f7b4db6f"}, "originalPosition": 6}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzOTk4MzAzNw==", "bodyText": "Should this clarify that the module is needed as an CSS asset in theme.json so they don't have to wonder where does this module come from ?", "url": "https://github.com/vaadin/flow/pull/9617#discussion_r539983037", "createdAt": "2020-12-10T08:50:35Z", "author": {"login": "pleku"}, "path": "flow-server/src/main/resources/plugins/application-theme-plugin/theme-copy.js", "diffHunk": "@@ -66,7 +66,10 @@ function copyStaticAssets(themeName, themeProperties, projectStaticAssetsOutputF\n     const copyRules = assets[module];\n     Object.keys(copyRules).forEach((copyRule) => {\n       const nodeSources = path.resolve('node_modules/', module, copyRule);\n-      const files = glob.sync(nodeSources, {nodir: true});\n+      if(!fs.existsSync(path.resolve('node_modules/', module))) {\n+        throw Error(\"Missing '\" + module + \"'. Install package by adding a @NpmPackage annotation or install it using 'npm/pnpm i'\");", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d43242e419cbae9b032563a20d583770f7b4db6f"}, "originalPosition": 6}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzOTk4MzI0MQ==", "bodyText": "Same comment here, should we first collect all of the missing packages and output them once ?", "url": "https://github.com/vaadin/flow/pull/9617#discussion_r539983241", "createdAt": "2020-12-10T08:50:52Z", "author": {"login": "pleku"}, "path": "flow-server/src/main/resources/plugins/application-theme-plugin/theme-generator.js", "diffHunk": "@@ -83,6 +84,11 @@ function generateThemeFile(themeFolder, themeName, themeProperties) {\n   let i = 0;\n   if (themeProperties.importCss) {\n     themeProperties.importCss.forEach((cssPath) => {\n+      const nodeSources = path.resolve('node_modules/', cssPath);\n+      if(!fs.existsSync(nodeSources)) {\n+        throw Error(\"Missing resource '\" + cssPath + \"'. Install package by adding a @NpmPackage annotation or install it using 'npm/pnpm i'\");", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d43242e419cbae9b032563a20d583770f7b4db6f"}, "originalPosition": 14}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzOTk4NTA1NA==", "bodyText": "Same, should this mention what this resource is and where is it coming from, like \"Missing imported css file  imported by theme.json. Install ...\"", "url": "https://github.com/vaadin/flow/pull/9617#discussion_r539985054", "createdAt": "2020-12-10T08:53:39Z", "author": {"login": "pleku"}, "path": "flow-server/src/main/resources/plugins/application-theme-plugin/theme-generator.js", "diffHunk": "@@ -83,6 +84,11 @@ function generateThemeFile(themeFolder, themeName, themeProperties) {\n   let i = 0;\n   if (themeProperties.importCss) {\n     themeProperties.importCss.forEach((cssPath) => {\n+      const nodeSources = path.resolve('node_modules/', cssPath);\n+      if(!fs.existsSync(nodeSources)) {\n+        throw Error(\"Missing resource '\" + cssPath + \"'. Install package by adding a @NpmPackage annotation or install it using 'npm/pnpm i'\");", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d43242e419cbae9b032563a20d583770f7b4db6f"}, "originalPosition": 14}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "d8261c6d93e69d4d05873dffb2dcefe47d6c6fdf", "author": {"user": {"login": "caalador", "name": null}}, "url": "https://github.com/vaadin/flow/commit/d8261c6d93e69d4d05873dffb2dcefe47d6c6fdf", "committedDate": "2020-12-10T09:35:19Z", "message": "Collect all missing, update exception."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTQ5MDU1NTMw", "url": "https://github.com/vaadin/flow/pull/9617#pullrequestreview-549055530", "createdAt": "2020-12-10T10:27:46Z", "commit": {"oid": "d8261c6d93e69d4d05873dffb2dcefe47d6c6fdf"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4663, "cost": 1, "resetAt": "2021-10-28T20:13:43Z"}}}