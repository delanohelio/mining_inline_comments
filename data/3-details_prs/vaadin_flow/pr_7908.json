{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0Mzk0MzA3NTY2", "number": 7908, "title": "Show a notification in the UI after live reload happened (#7820)", "bodyText": "(NEW)\nFix #7820\nPresent a notification when a Live Reload browser refresh is called, keep a timestamp in the notification about the time of the last reload.\n\n\nThis change is\u2002", "createdAt": "2020-03-26T17:19:10Z", "url": "https://github.com/vaadin/flow/pull/7908", "merged": true, "mergeCommit": {"oid": "5df6740458faf69b36c3a31689ab52582ccd8f02"}, "closed": true, "closedAt": "2020-03-31T19:04:27Z", "author": {"login": "jm-ferreira"}, "timelineItems": {"totalCount": 21, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcRe4gaAH2gAyMzk0MzA3NTY2OmMzNTIwNDczNWYwMGVjNDljMTcxNWE4MWM2MjJhOWQyNGViMjQxZWY=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcTHvx5AFqTM4NTAxMzQ5OA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "c35204735f00ec49c1715a81c622a9d24eb241ef", "author": {"user": {"login": "jm-ferreira", "name": "Jo\u00e3o Ferreira"}}, "url": "https://github.com/vaadin/flow/commit/c35204735f00ec49c1715a81c622a9d24eb241ef", "committedDate": "2020-03-26T16:41:40Z", "message": "Implement notification methods"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "93147e3b7c2f6862bb2601972531d6bb43b3907e", "author": {"user": {"login": "jm-ferreira", "name": "Jo\u00e3o Ferreira"}}, "url": "https://github.com/vaadin/flow/commit/93147e3b7c2f6862bb2601972531d6bb43b3907e", "committedDate": "2020-03-26T17:07:03Z", "message": "Fix disable not working\n\nFix disable not working because of assertion error when the notification is never rendered"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzgyMzA2MjMw", "url": "https://github.com/vaadin/flow/pull/7908#pullrequestreview-382306230", "createdAt": "2020-03-26T18:41:38Z", "commit": {"oid": "93147e3b7c2f6862bb2601972531d6bb43b3907e"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "5030b0d05521ea12cc4a882805053a363aaf7f00", "author": {"user": {"login": "jm-ferreira", "name": "Jo\u00e3o Ferreira"}}, "url": "https://github.com/vaadin/flow/commit/5030b0d05521ea12cc4a882805053a363aaf7f00", "committedDate": "2020-03-26T23:32:58Z", "message": "Change timestamp message and leading zeroes\n\nChange timestamp message to explicitly say that the time presented is the time of the last automatic reload.\nCreate method buildStringWith2LeadingZeroes() in order to present the reload timestamp in a standard fashion."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzgyNDk0MzUz", "url": "https://github.com/vaadin/flow/pull/7908#pullrequestreview-382494353", "createdAt": "2020-03-26T23:44:42Z", "commit": {"oid": "5030b0d05521ea12cc4a882805053a363aaf7f00"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yNlQyMzo0NDo0MlrOF8eYxA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yNlQyMzo0NDo0MlrOF8eYxA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5ODk1Njc0MA==", "bodyText": "Remove this use of \"getMinutes\"; it is deprecated.", "url": "https://github.com/vaadin/flow/pull/7908#discussion_r398956740", "createdAt": "2020-03-26T23:44:42Z", "author": {"login": "vaadin-bot"}, "path": "flow-client/src/main/java/com/vaadin/client/LiveReload.java", "diffHunk": "@@ -187,6 +195,40 @@ private Element getOrCreateIndicator() {\n         return reloadIndicator;\n     }\n \n+    private Element getOrCreateReloadNotification() {\n+        Element reloadNotificationElement = Browser.getDocument()\n+                .getElementById(\"vaadin-live-reload-notification\");\n+        if (reloadNotificationElement == null) {\n+            reloadNotificationElement = Browser.getDocument()\n+                    .createElement(\"div\");\n+            reloadNotificationElement.setId(\"vaadin-live-reload-notification\");\n+            Element message = Browser.getDocument().createElement(\"span\");\n+            message.setId(\"vaadin-live-reload-timestamp\");\n+            message.setInnerText(LAST_RELOAD_TEXT + getLastReloadInStorage());\n+            reloadNotificationElement.appendChild(message);\n+            Element liveReloadOverlay = Browser.getDocument()\n+                    .getElementById(\"vaadin-live-reload-overlay\");\n+            liveReloadOverlay.appendChild(reloadNotificationElement);\n+        } else {\n+            Element message = Browser.getDocument()\n+                    .getElementById(\"vaadin-live-reload-timestamp\");\n+            message.setInnerText(LAST_RELOAD_TEXT + getLastReloadInStorage());\n+        }\n+        return reloadNotificationElement;\n+    }\n+\n+    private void saveLastReloadInStorage(Date date) {\n+\n+        StorageUtil.setSessionItem(LAST_RELOAD_KEY_IN_STORAGE,\n+                buildStringWith2LeadingZeroes(date.getHours()) + \":\"\n+                        + buildStringWith2LeadingZeroes(date.getMinutes()) + \":\"", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "5030b0d05521ea12cc4a882805053a363aaf7f00"}, "originalPosition": 66}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzgyNDk0MzYw", "url": "https://github.com/vaadin/flow/pull/7908#pullrequestreview-382494360", "createdAt": "2020-03-26T23:44:42Z", "commit": {"oid": "5030b0d05521ea12cc4a882805053a363aaf7f00"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yNlQyMzo0NDo0MlrOF8eYyA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yNlQyMzo0NDo0MlrOF8eYyA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5ODk1Njc0NA==", "bodyText": "Remove this use of \"getSeconds\"; it is deprecated.", "url": "https://github.com/vaadin/flow/pull/7908#discussion_r398956744", "createdAt": "2020-03-26T23:44:42Z", "author": {"login": "vaadin-bot"}, "path": "flow-client/src/main/java/com/vaadin/client/LiveReload.java", "diffHunk": "@@ -187,6 +195,40 @@ private Element getOrCreateIndicator() {\n         return reloadIndicator;\n     }\n \n+    private Element getOrCreateReloadNotification() {\n+        Element reloadNotificationElement = Browser.getDocument()\n+                .getElementById(\"vaadin-live-reload-notification\");\n+        if (reloadNotificationElement == null) {\n+            reloadNotificationElement = Browser.getDocument()\n+                    .createElement(\"div\");\n+            reloadNotificationElement.setId(\"vaadin-live-reload-notification\");\n+            Element message = Browser.getDocument().createElement(\"span\");\n+            message.setId(\"vaadin-live-reload-timestamp\");\n+            message.setInnerText(LAST_RELOAD_TEXT + getLastReloadInStorage());\n+            reloadNotificationElement.appendChild(message);\n+            Element liveReloadOverlay = Browser.getDocument()\n+                    .getElementById(\"vaadin-live-reload-overlay\");\n+            liveReloadOverlay.appendChild(reloadNotificationElement);\n+        } else {\n+            Element message = Browser.getDocument()\n+                    .getElementById(\"vaadin-live-reload-timestamp\");\n+            message.setInnerText(LAST_RELOAD_TEXT + getLastReloadInStorage());\n+        }\n+        return reloadNotificationElement;\n+    }\n+\n+    private void saveLastReloadInStorage(Date date) {\n+\n+        StorageUtil.setSessionItem(LAST_RELOAD_KEY_IN_STORAGE,\n+                buildStringWith2LeadingZeroes(date.getHours()) + \":\"\n+                        + buildStringWith2LeadingZeroes(date.getMinutes()) + \":\"\n+                        + buildStringWith2LeadingZeroes(date.getSeconds()));", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "5030b0d05521ea12cc4a882805053a363aaf7f00"}, "originalPosition": 67}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzgyNDk0Mzcy", "url": "https://github.com/vaadin/flow/pull/7908#pullrequestreview-382494372", "createdAt": "2020-03-26T23:44:43Z", "commit": {"oid": "5030b0d05521ea12cc4a882805053a363aaf7f00"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yNlQyMzo0NDo0M1rOF8eY0g==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yNlQyMzo0NDo0M1rOF8eY0g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5ODk1Njc1NA==", "bodyText": "Remove this use of \"getHours\"; it is deprecated.", "url": "https://github.com/vaadin/flow/pull/7908#discussion_r398956754", "createdAt": "2020-03-26T23:44:43Z", "author": {"login": "vaadin-bot"}, "path": "flow-client/src/main/java/com/vaadin/client/LiveReload.java", "diffHunk": "@@ -187,6 +195,40 @@ private Element getOrCreateIndicator() {\n         return reloadIndicator;\n     }\n \n+    private Element getOrCreateReloadNotification() {\n+        Element reloadNotificationElement = Browser.getDocument()\n+                .getElementById(\"vaadin-live-reload-notification\");\n+        if (reloadNotificationElement == null) {\n+            reloadNotificationElement = Browser.getDocument()\n+                    .createElement(\"div\");\n+            reloadNotificationElement.setId(\"vaadin-live-reload-notification\");\n+            Element message = Browser.getDocument().createElement(\"span\");\n+            message.setId(\"vaadin-live-reload-timestamp\");\n+            message.setInnerText(LAST_RELOAD_TEXT + getLastReloadInStorage());\n+            reloadNotificationElement.appendChild(message);\n+            Element liveReloadOverlay = Browser.getDocument()\n+                    .getElementById(\"vaadin-live-reload-overlay\");\n+            liveReloadOverlay.appendChild(reloadNotificationElement);\n+        } else {\n+            Element message = Browser.getDocument()\n+                    .getElementById(\"vaadin-live-reload-timestamp\");\n+            message.setInnerText(LAST_RELOAD_TEXT + getLastReloadInStorage());\n+        }\n+        return reloadNotificationElement;\n+    }\n+\n+    private void saveLastReloadInStorage(Date date) {\n+\n+        StorageUtil.setSessionItem(LAST_RELOAD_KEY_IN_STORAGE,\n+                buildStringWith2LeadingZeroes(date.getHours()) + \":\"", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "5030b0d05521ea12cc4a882805053a363aaf7f00"}, "originalPosition": 65}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "469b690a5ec879239103e4b52e0ea66f144501dd", "author": {"user": {"login": "jm-ferreira", "name": "Jo\u00e3o Ferreira"}}, "url": "https://github.com/vaadin/flow/commit/469b690a5ec879239103e4b52e0ea66f144501dd", "committedDate": "2020-03-27T00:20:32Z", "message": "Add LiveReload timestamp visible functionality\n\nAdd events and code to show reload timestamp when reloading and hiding it when the focus is on the page body. If the LiveReload overlay is open, then the timestamp should be also visible regardless of focus."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzgyNTA5MDQ4", "url": "https://github.com/vaadin/flow/pull/7908#pullrequestreview-382509048", "createdAt": "2020-03-27T00:29:11Z", "commit": {"oid": "469b690a5ec879239103e4b52e0ea66f144501dd"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yN1QwMDoyOToxMVrOF8fNDg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yN1QwMDoyOToxMVrOF8fNDg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5ODk3MDEyNg==", "bodyText": "Remove this unused method parameter \"evt\".", "url": "https://github.com/vaadin/flow/pull/7908#discussion_r398970126", "createdAt": "2020-03-27T00:29:11Z", "author": {"login": "vaadin-bot"}, "path": "flow-client/src/main/java/com/vaadin/client/LiveReload.java", "diffHunk": "@@ -136,6 +145,20 @@ private void showMessage(String msg) {\n         }\n     }\n \n+    private void handleOnIconClickEvent(Event evt) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "469b690a5ec879239103e4b52e0ea66f144501dd"}, "originalPosition": 46}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzgyNTA5MDUw", "url": "https://github.com/vaadin/flow/pull/7908#pullrequestreview-382509050", "createdAt": "2020-03-27T00:29:12Z", "commit": {"oid": "469b690a5ec879239103e4b52e0ea66f144501dd"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yN1QwMDoyOToxMlrOF8fNEg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yN1QwMDoyOToxMlrOF8fNEg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5ODk3MDEzMA==", "bodyText": "Remove this unused method parameter \"evt\".", "url": "https://github.com/vaadin/flow/pull/7908#discussion_r398970130", "createdAt": "2020-03-27T00:29:12Z", "author": {"login": "vaadin-bot"}, "path": "flow-client/src/main/java/com/vaadin/client/LiveReload.java", "diffHunk": "@@ -187,6 +210,47 @@ private Element getOrCreateIndicator() {\n         return reloadIndicator;\n     }\n \n+    private void handleOnBodyFocusEvent(Event evt) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "469b690a5ec879239103e4b52e0ea66f144501dd"}, "originalPosition": 76}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "889ffacf4e77d0e106f4deabea217c30bcd6c911", "author": {"user": {"login": "jm-ferreira", "name": "Jo\u00e3o Ferreira"}}, "url": "https://github.com/vaadin/flow/commit/889ffacf4e77d0e106f4deabea217c30bcd6c911", "committedDate": "2020-03-27T00:32:41Z", "message": "quickfix wrong logical operator"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzgyNTE2Nzc0", "url": "https://github.com/vaadin/flow/pull/7908#pullrequestreview-382516774", "createdAt": "2020-03-27T00:55:43Z", "commit": {"oid": "889ffacf4e77d0e106f4deabea217c30bcd6c911"}, "state": "COMMENTED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzgyNzA4MTIw", "url": "https://github.com/vaadin/flow/pull/7908#pullrequestreview-382708120", "createdAt": "2020-03-27T09:44:38Z", "commit": {"oid": "889ffacf4e77d0e106f4deabea217c30bcd6c911"}, "state": "COMMENTED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzgyNzA4MjUw", "url": "https://github.com/vaadin/flow/pull/7908#pullrequestreview-382708250", "createdAt": "2020-03-27T09:44:50Z", "commit": {"oid": "889ffacf4e77d0e106f4deabea217c30bcd6c911"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzgyNzUwMjE3", "url": "https://github.com/vaadin/flow/pull/7908#pullrequestreview-382750217", "createdAt": "2020-03-27T10:46:07Z", "commit": {"oid": "889ffacf4e77d0e106f4deabea217c30bcd6c911"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "5b0dbea7637ac5af61c0b55442b460b47001412b", "author": {"user": {"login": "jm-ferreira", "name": "Jo\u00e3o Ferreira"}}, "url": "https://github.com/vaadin/flow/commit/5b0dbea7637ac5af61c0b55442b460b47001412b", "committedDate": "2020-03-30T07:39:12Z", "message": "Test Live Reload Notification fuctionality\n\nThis is broken. Should be fixed."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "00a454af0acc8e583d531e689ee7fd7369864dac", "author": {"user": {"login": "jm-ferreira", "name": "Jo\u00e3o Ferreira"}}, "url": "https://github.com/vaadin/flow/commit/00a454af0acc8e583d531e689ee7fd7369864dac", "committedDate": "2020-03-31T07:33:19Z", "message": "Added live reload button to test view"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "2fc128131bfb248d3440df74ec27418c4b87a00f", "author": {"user": {"login": "jm-ferreira", "name": "Jo\u00e3o Ferreira"}}, "url": "https://github.com/vaadin/flow/commit/2fc128131bfb248d3440df74ec27418c4b87a00f", "committedDate": "2020-03-31T08:49:17Z", "message": "Change LiveReload and IT tests\n\nHide LiveReload notification on click instead of on focus\nCorrect wrong checks on IT tests\nImplement trigger button click and wait for page render"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzg0NzQxODQw", "url": "https://github.com/vaadin/flow/pull/7908#pullrequestreview-384741840", "createdAt": "2020-03-31T13:39:25Z", "commit": {"oid": "2fc128131bfb248d3440df74ec27418c4b87a00f"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0zMVQxMzozOToyNVrOF-WRXw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0zMVQxMzozOToyNVrOF-WRXw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMDkyMDkyNw==", "bodyText": "Consider simplifying if-else clause this way:\nlastReloadNotification.setHidden(\noverlay.isHidden());", "url": "https://github.com/vaadin/flow/pull/7908#discussion_r400920927", "createdAt": "2020-03-31T13:39:25Z", "author": {"login": "mshabarov"}, "path": "flow-client/src/main/java/com/vaadin/client/LiveReload.java", "diffHunk": "@@ -136,6 +145,20 @@ private void showMessage(String msg) {\n         }\n     }\n \n+    private void handleOnIconClickEvent(Event evt) {\n+        Element overlay = Browser.getDocument()\n+                .getElementById(\"vaadin-live-reload-overlay\");\n+        overlay.setHidden(!overlay.isHidden());\n+        if (lastReloadNotification == null) {\n+            return;\n+        }\n+        if (!overlay.isHidden()) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "2fc128131bfb248d3440df74ec27418c4b87a00f"}, "originalPosition": 53}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzg1MDEyMzkw", "url": "https://github.com/vaadin/flow/pull/7908#pullrequestreview-385012390", "createdAt": "2020-03-31T18:50:37Z", "commit": {"oid": "2fc128131bfb248d3440df74ec27418c4b87a00f"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzg1MDEzNDk4", "url": "https://github.com/vaadin/flow/pull/7908#pullrequestreview-385013498", "createdAt": "2020-03-31T18:52:10Z", "commit": {"oid": "2fc128131bfb248d3440df74ec27418c4b87a00f"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 624, "cost": 1, "resetAt": "2021-10-28T19:08:13Z"}}}