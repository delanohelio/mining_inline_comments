{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDQwNTE1MTQz", "number": 8630, "reviewThreads": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yNlQxMTo0Nzo0MFrOEJGojg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yN1QxNzowOToyMVrOEJXWDA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjc3OTgxMzI2OnYy", "diffSide": "RIGHT", "path": "flow-server/src/main/java/com/vaadin/flow/router/internal/AbstractNavigationStateRenderer.java", "isResolved": true, "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yNlQxMTo0Nzo0MFrOGpd7WQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yNlQxNDoxMToxM1rOGpiaKA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NjEzNTEyOQ==", "bodyText": "I would suggest combine (event instanceof ErrorNavigationEvent) && isRouterLink in  one if.\nLess nested ifs.", "url": "https://github.com/vaadin/flow/pull/8630#discussion_r446135129", "createdAt": "2020-06-26T11:47:40Z", "author": {"login": "denis-anisimov"}, "path": "flow-server/src/main/java/com/vaadin/flow/router/internal/AbstractNavigationStateRenderer.java", "diffHunk": "@@ -243,11 +244,21 @@ public int handle(NavigationEvent event) {\n     }\n \n     private void pushHistoryStateIfNeeded(NavigationEvent event, UI ui) {\n-        if (event instanceof ErrorNavigationEvent) {\n-            return;\n-        }\n+        boolean isRouterLink = NavigationTrigger.ROUTER_LINK\n+                .equals(event.getTrigger());\n \n-        if (NavigationTrigger.ROUTER_LINK.equals(event.getTrigger())) {\n+        if (event instanceof ErrorNavigationEvent) {\n+            if (isRouterLink) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "010c0cfcc1671a174e852ab4d48dc68947d0eb55"}, "originalPosition": 20}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NjE1ODg4Mw==", "bodyText": "Also the other conditions should not be tested at all if event is of type ErrorNavigationEvent. Simplified the if structure and extracted the logic to another method.", "url": "https://github.com/vaadin/flow/pull/8630#discussion_r446158883", "createdAt": "2020-06-26T12:40:39Z", "author": {"login": "joheriks"}, "path": "flow-server/src/main/java/com/vaadin/flow/router/internal/AbstractNavigationStateRenderer.java", "diffHunk": "@@ -243,11 +244,21 @@ public int handle(NavigationEvent event) {\n     }\n \n     private void pushHistoryStateIfNeeded(NavigationEvent event, UI ui) {\n-        if (event instanceof ErrorNavigationEvent) {\n-            return;\n-        }\n+        boolean isRouterLink = NavigationTrigger.ROUTER_LINK\n+                .equals(event.getTrigger());\n \n-        if (NavigationTrigger.ROUTER_LINK.equals(event.getTrigger())) {\n+        if (event instanceof ErrorNavigationEvent) {\n+            if (isRouterLink) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NjEzNTEyOQ=="}, "originalCommit": {"oid": "010c0cfcc1671a174e852ab4d48dc68947d0eb55"}, "originalPosition": 20}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NjIwODU1Mg==", "bodyText": "You can combine everything inside the method - java uses short-circuit evaluation if used with && or ||, meaning the right side won't be executed, when left already matched.", "url": "https://github.com/vaadin/flow/pull/8630#discussion_r446208552", "createdAt": "2020-06-26T14:11:13Z", "author": {"login": "knoobie"}, "path": "flow-server/src/main/java/com/vaadin/flow/router/internal/AbstractNavigationStateRenderer.java", "diffHunk": "@@ -243,11 +244,21 @@ public int handle(NavigationEvent event) {\n     }\n \n     private void pushHistoryStateIfNeeded(NavigationEvent event, UI ui) {\n-        if (event instanceof ErrorNavigationEvent) {\n-            return;\n-        }\n+        boolean isRouterLink = NavigationTrigger.ROUTER_LINK\n+                .equals(event.getTrigger());\n \n-        if (NavigationTrigger.ROUTER_LINK.equals(event.getTrigger())) {\n+        if (event instanceof ErrorNavigationEvent) {\n+            if (isRouterLink) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NjEzNTEyOQ=="}, "originalCommit": {"oid": "010c0cfcc1671a174e852ab4d48dc68947d0eb55"}, "originalPosition": 20}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjc3OTgyMzEzOnYy", "diffSide": "RIGHT", "path": "flow-tests/test-root-context/src/test/java/com/vaadin/flow/uitest/ui/BrokenRouterLinkIT.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yNlQxMTo1MTozNlrOGpeBtQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yNlQxMTo1MTozNlrOGpeBtQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NjEzNjc1Nw==", "bodyText": "new line", "url": "https://github.com/vaadin/flow/pull/8630#discussion_r446136757", "createdAt": "2020-06-26T11:51:36Z", "author": {"login": "denis-anisimov"}, "path": "flow-tests/test-root-context/src/test/java/com/vaadin/flow/uitest/ui/BrokenRouterLinkIT.java", "diffHunk": "@@ -0,0 +1,41 @@\n+/*\n+ * Copyright 2000-2020 Vaadin Ltd.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\"); you may not\n+ * use this file except in compliance with the License. You may obtain a copy of\n+ * the License at\n+ *\n+ * http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS, WITHOUT\n+ * WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied. See the\n+ * License for the specific language governing permissions and limitations under\n+ * the License.\n+ */\n+package com.vaadin.flow.uitest.ui;\n+\n+import org.junit.Assert;\n+import org.junit.Test;\n+import org.openqa.selenium.By;\n+import org.openqa.selenium.WebElement;\n+\n+import com.vaadin.flow.testutil.ChromeBrowserTest;\n+\n+// https://github.com/vaadin/flow/issues/8544\n+public class BrokenRouterLinkIT extends ChromeBrowserTest {\n+\n+    @Test\n+    public void testRouterLink_linkIsBroken_urlIsUpdated() {\n+        open();\n+\n+        WebElement link = findElement(By.id(BrokenRouterLinkView.LINK_ID));\n+\n+        String href = link.getAttribute(\"href\");\n+\n+        link.click();\n+\n+        Assert.assertTrue(getDriver().getCurrentUrl().endsWith(href));\n+\n+    }\n+}", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "010c0cfcc1671a174e852ab4d48dc68947d0eb55"}, "originalPosition": 41}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjc4MjU1MTE2OnYy", "diffSide": "RIGHT", "path": "flow-server/src/main/java/com/vaadin/flow/router/internal/AbstractNavigationStateRenderer.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yN1QxNzowOToyMVrOGp3BfA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yOVQwNjo0NDoyNVrOGqGzNQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NjU0NjMwMA==", "bodyText": "I think we require javadocs for protected methods.\nI would avoid should  in method names. Not sure whether this is a better name though.", "url": "https://github.com/vaadin/flow/pull/8630#discussion_r446546300", "createdAt": "2020-06-27T17:09:21Z", "author": {"login": "denis-anisimov"}, "path": "flow-server/src/main/java/com/vaadin/flow/router/internal/AbstractNavigationStateRenderer.java", "diffHunk": "@@ -284,6 +290,14 @@ protected boolean shouldPushHistoryState(NavigationEvent event) {\n         return NavigationTrigger.UI_NAVIGATE.equals(event.getTrigger());\n     }\n \n+    protected boolean shouldPushHistoryStateForNavigationError(", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b3f85c65eae8bb4c26affa897ea79967117c0034"}, "originalPosition": 33}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NjgwNDc4OQ==", "bodyText": "No need for protected as a matter of fact, made private. Also renamed.", "url": "https://github.com/vaadin/flow/pull/8630#discussion_r446804789", "createdAt": "2020-06-29T06:44:25Z", "author": {"login": "joheriks"}, "path": "flow-server/src/main/java/com/vaadin/flow/router/internal/AbstractNavigationStateRenderer.java", "diffHunk": "@@ -284,6 +290,14 @@ protected boolean shouldPushHistoryState(NavigationEvent event) {\n         return NavigationTrigger.UI_NAVIGATE.equals(event.getTrigger());\n     }\n \n+    protected boolean shouldPushHistoryStateForNavigationError(", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NjU0NjMwMA=="}, "originalCommit": {"oid": "b3f85c65eae8bb4c26affa897ea79967117c0034"}, "originalPosition": 33}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3303, "cost": 1, "resetAt": "2021-11-13T12:26:42Z"}}}