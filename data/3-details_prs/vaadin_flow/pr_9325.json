{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTE2MTEzODc3", "number": 9325, "title": "chore: consolidated offline navigation tests to single class", "bodyText": "Moved offline stub test to module test-ccdm-flow-navigation and unified test naming (given_when_then-scheme).\nFixes #9121", "createdAt": "2020-11-05T14:45:17Z", "url": "https://github.com/vaadin/flow/pull/9325", "merged": true, "mergeCommit": {"oid": "00ef3a27a85f2cb5bb5707f7f1dbd4b4c2b54880"}, "closed": true, "closedAt": "2020-11-06T14:12:22Z", "author": {"login": "joheriks"}, "timelineItems": {"totalCount": 9, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdZjcj-gH2gAyNTE2MTEzODc3OjYzYzk5NWRmOGE5YmIyYWMzMjc5NDI4Y2NjYjg4NzgxOWU1ZDRiMDg=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdZ2bZAAH2gAyNTE2MTEzODc3OmNjZDJkZDMzZDU1ZDBmZDRjMWNhN2U2ZDljMWIxMmIxNDg5ZTI3MDM=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "63c995df8a9bb2ac3279428cccb887819e5d4b08", "author": {"user": {"login": "joheriks", "name": "Johannes Eriksson"}}, "url": "https://github.com/vaadin/flow/commit/63c995df8a9bb2ac3279428cccb887819e5d4b08", "committedDate": "2020-11-05T14:43:13Z", "message": "chore: consolidated offline navigation tests to single class"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTI0OTExNTM4", "url": "https://github.com/vaadin/flow/pull/9325#pullrequestreview-524911538", "createdAt": "2020-11-06T07:33:18Z", "commit": {"oid": "63c995df8a9bb2ac3279428cccb887819e5d4b08"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wNlQwNzozMzoxOVrOHui6GA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wNlQwNzozMzoxOVrOHui6GA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxODU2ODQ3Mg==", "bodyText": "I think we don't need to ignore this test?", "url": "https://github.com/vaadin/flow/pull/9325#discussion_r518568472", "createdAt": "2020-11-06T07:33:19Z", "author": {"login": "haijian-vaadin"}, "path": "flow-tests/test-ccdm-flow-navigation/src/test/java/com/vaadin/flow/navigate/ServiceWorkerIT.java", "diffHunk": "@@ -129,4 +131,79 @@ public void openTsView_goOffline_navigateToOtherTsView_navigationSuccessful() th\n         }\n     }\n \n+    @Test\n+    @Ignore\n+    // This test fails currently because leaveNavigation currently tries to\n+    // connect to the server in offline mode.\n+    public void offlineServerView_navigateToTsView_navigationSuccessful() throws IOException {\n+        getDriver().get(getRootURL() + \"/hello\");\n+        waitForServiceWorkerReady();\n+\n+        // Set offline network conditions in ChromeDriver\n+        setConnectionType(NetworkConnection.ConnectionType.AIRPLANE_MODE);\n+\n+        try {\n+            $(\"main-view\").first().$(\"a\").id(\"menu-another\").click();\n+\n+            // Wait for component inside shadow root as there is no vaadin\n+            // to wait for as with server-side\n+            waitUntil(input -> $(\"another-view\").first().$(\"div\").id(\"another-content\")\n+                    .isDisplayed());\n+\n+            MatcherAssert.assertThat(getDriver().getCurrentUrl(),\n+                    CoreMatchers.endsWith(\"/another\"));\n+            Assert.assertTrue(getInShadowRoot(findElement(By.tagName(\"another-view\")),\n+                    By.id(\"another-content\")).isDisplayed());\n+        } finally {\n+            // Reset network conditions back\n+            setConnectionType(NetworkConnection.ConnectionType.ALL);\n+        }\n+    }\n+\n+    @Test\n+    @Ignore", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "63c995df8a9bb2ac3279428cccb887819e5d4b08"}, "originalPosition": 73}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "3de6f26bc192532f271a7cab874808b2c6b05a81", "author": {"user": {"login": "joheriks", "name": "Johannes Eriksson"}}, "url": "https://github.com/vaadin/flow/commit/3de6f26bc192532f271a7cab874808b2c6b05a81", "committedDate": "2020-11-06T07:39:25Z", "message": "Unignore test"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTI1MDM2Njg4", "url": "https://github.com/vaadin/flow/pull/9325#pullrequestreview-525036688", "createdAt": "2020-11-06T10:38:33Z", "commit": {"oid": "3de6f26bc192532f271a7cab874808b2c6b05a81"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wNlQxMDozODozM1rOHuo0Ag==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wNlQxMDozODozM1rOHuo0Ag==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxODY2NTIxOA==", "bodyText": "BTW there is one ignored test in test-ccdm module: com.vaadin.flow.ccdmtest.IndexHtmlRequestHandlerIT#should_installServiceWorker\nI verified, it is passing if running in a ChromeDeviceTest suite. So the ignoring could be removed. Should we move it here, perhaps?", "url": "https://github.com/vaadin/flow/pull/9325#discussion_r518665218", "createdAt": "2020-11-06T10:38:33Z", "author": {"login": "platosha"}, "path": "flow-tests/test-ccdm-flow-navigation/src/test/java/com/vaadin/flow/navigate/ServiceWorkerIT.java", "diffHunk": "@@ -129,4 +131,78 @@ public void openTsView_goOffline_navigateToOtherTsView_navigationSuccessful() th\n         }\n     }\n \n+    @Test\n+    @Ignore\n+    // This test fails currently because leaveNavigation currently tries to\n+    // connect to the server in offline mode.\n+    public void offlineServerView_navigateToTsView_navigationSuccessful() throws IOException {\n+        getDriver().get(getRootURL() + \"/hello\");\n+        waitForServiceWorkerReady();\n+\n+        // Set offline network conditions in ChromeDriver\n+        setConnectionType(NetworkConnection.ConnectionType.AIRPLANE_MODE);\n+\n+        try {\n+            $(\"main-view\").first().$(\"a\").id(\"menu-another\").click();\n+\n+            // Wait for component inside shadow root as there is no vaadin\n+            // to wait for as with server-side\n+            waitUntil(input -> $(\"another-view\").first().$(\"div\").id(\"another-content\")\n+                    .isDisplayed());\n+\n+            MatcherAssert.assertThat(getDriver().getCurrentUrl(),\n+                    CoreMatchers.endsWith(\"/another\"));\n+            Assert.assertTrue(getInShadowRoot(findElement(By.tagName(\"another-view\")),\n+                    By.id(\"another-content\")).isDisplayed());\n+        } finally {\n+            // Reset network conditions back\n+            setConnectionType(NetworkConnection.ConnectionType.ALL);\n+        }\n+    }\n+\n+    @Test\n+    public void offlineTsView_navigateToServerView_offlineStubShown()\n+            throws IOException {\n+        getDriver().get(getRootURL() + \"/another\");\n+        waitForServiceWorkerReady();\n+\n+        setConnectionType(NetworkConnection.ConnectionType.AIRPLANE_MODE);\n+        try {\n+            $(\"main-view\").first().$(\"a\").id(\"menu-hello\").click();\n+\n+            waitForElementPresent(By.tagName(\"vaadin-offline-stub\"));\n+            WebElement offlineStub = findElement(\n+                    By.tagName(\"vaadin-offline-stub\"));\n+\n+            Assert.assertFalse(\n+                    \"vaadin-offline-stub shadow root expected to contain an element with class offline\",\n+                    findInShadowRoot(offlineStub, By.className(\"offline\"))\n+                            .isEmpty());\n+        } finally {\n+            setConnectionType(NetworkConnection.ConnectionType.ALL);\n+        }\n+    }\n+\n+    @Test\n+    public void offlineServerView_navigateToServerView_offlineStubShown()\n+            throws IOException {\n+        getDriver().get(getRootURL() + \"/hello\");\n+        waitForServiceWorkerReady();\n+\n+        setConnectionType(NetworkConnection.ConnectionType.AIRPLANE_MODE);\n+        try {\n+            $(\"main-view\").first().$(\"a\").id(\"menu-hello\").click();\n+\n+            waitForElementPresent(By.tagName(\"vaadin-offline-stub\"));\n+            WebElement offlineStub = findElement(\n+                    By.tagName(\"vaadin-offline-stub\"));\n+\n+            Assert.assertFalse(\n+                    \"vaadin-offline-stub shadow root expected to contain an element with class offline\",\n+                    findInShadowRoot(offlineStub, By.className(\"offline\"))\n+                            .isEmpty());\n+        } finally {\n+            setConnectionType(NetworkConnection.ConnectionType.ALL);\n+        }\n+    }", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "3de6f26bc192532f271a7cab874808b2c6b05a81"}, "originalPosition": 116}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTI1MDM2NzQy", "url": "https://github.com/vaadin/flow/pull/9325#pullrequestreview-525036742", "createdAt": "2020-11-06T10:38:37Z", "commit": {"oid": "3de6f26bc192532f271a7cab874808b2c6b05a81"}, "state": "DISMISSED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "62b4030be820eea2131727f8984ab6b9c76d06fa", "author": {"user": {"login": "joheriks", "name": "Johannes Eriksson"}}, "url": "https://github.com/vaadin/flow/commit/62b4030be820eea2131727f8984ab6b9c76d06fa", "committedDate": "2020-11-06T11:54:20Z", "message": "Moved service worker IT from test-ccdm module"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b6fb9dd966e7a3661fc3cffca4dfa8b9ad206b52", "author": {"user": {"login": "joheriks", "name": "Johannes Eriksson"}}, "url": "https://github.com/vaadin/flow/commit/b6fb9dd966e7a3661fc3cffca4dfa8b9ad206b52", "committedDate": "2020-11-06T11:54:45Z", "message": "Unignored server-client offline navigation test"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTI1MTA2ODMx", "url": "https://github.com/vaadin/flow/pull/9325#pullrequestreview-525106831", "createdAt": "2020-11-06T12:27:24Z", "commit": {"oid": "b6fb9dd966e7a3661fc3cffca4dfa8b9ad206b52"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ccd2dd33d55d0fd4c1ca7e6d9c1b12b1489e2703", "author": {"user": {"login": "joheriks", "name": "Johannes Eriksson"}}, "url": "https://github.com/vaadin/flow/commit/ccd2dd33d55d0fd4c1ca7e6d9c1b12b1489e2703", "committedDate": "2020-11-06T12:50:08Z", "message": "Merge branch 'feature/offline' into joheriks/9121-consolidate-offline-its"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4809, "cost": 1, "resetAt": "2021-10-28T20:13:43Z"}}}