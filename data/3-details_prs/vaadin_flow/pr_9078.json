{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDk0OTc5NjY4", "number": 9078, "title": "4.0 cherry pick", "bodyText": "", "createdAt": "2020-09-29T17:09:05Z", "url": "https://github.com/vaadin/flow/pull/9078", "merged": true, "mergeCommit": {"oid": "555d8ec6a948409588da228130ef5acace25e21b"}, "closed": true, "closedAt": "2020-10-05T11:02:50Z", "author": {"login": "haijian-vaadin"}, "timelineItems": {"totalCount": 11, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdNrWH6AH2gAyNDk0OTc5NjY4OjM4NjllYjA1N2MwN2ZkZGZiZGI4NzAzZWE5N2U0M2E4YWI2NjQ5ZWI=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdPhtUaAFqTUwMTk0MzA4MQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "3869eb057c07fddfbdb8703ea97e43a8ab6649eb", "author": {"user": {"login": "haijian-vaadin", "name": "Haijian Wang"}}, "url": "https://github.com/vaadin/flow/commit/3869eb057c07fddfbdb8703ea97e43a8ab6649eb", "committedDate": "2020-09-29T17:08:20Z", "message": "fix: each UI should have its own CSRF token (#9071)"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDk5NDUxNDY0", "url": "https://github.com/vaadin/flow/pull/9078#pullrequestreview-499451464", "createdAt": "2020-09-30T13:50:02Z", "commit": {"oid": "3869eb057c07fddfbdb8703ea97e43a8ab6649eb"}, "state": "DISMISSED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "577b6781b7eb788e9766d761120a547dda0af2fa", "author": {"user": null}, "url": "https://github.com/vaadin/flow/commit/577b6781b7eb788e9766d761120a547dda0af2fa", "committedDate": "2020-10-02T05:24:36Z", "message": "fix: Rewrite fix for clearing Current instances (#9088)\n\nFixes #8548"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "6d3037702dfd986685bcf71b220765b72a22ae80", "author": {"user": {"login": "mshabarov", "name": "Mikhail Shabarov"}}, "url": "https://github.com/vaadin/flow/commit/6d3037702dfd986685bcf71b220765b72a22ae80", "committedDate": "2020-10-02T07:37:34Z", "message": "fix: Use a default page size for DataCommunicator (#9081)\n\nFixes #9051"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "638606502f9b2f8f73434261fe63f3ac612fb6cf", "author": {"user": {"login": "marcushellberg", "name": "Marcus Hellberg"}}, "url": "https://github.com/vaadin/flow/commit/638606502f9b2f8f73434261fe63f3ac612fb6cf", "committedDate": "2020-10-02T07:40:15Z", "message": "fix: Add content type to dev-mode-not-ready response (#9095)\n\nIf you enable Spring Security, the missing charset causes the page to either be downloaded or shown as plain text depending on the browser."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "1e385bf61ceca6401fc887aea76de635908f11c1", "author": {"user": null}, "url": "https://github.com/vaadin/flow/commit/1e385bf61ceca6401fc887aea76de635908f11c1", "committedDate": "2020-10-02T08:06:24Z", "message": "Restructure dev mode handler logic to avoid starting webpack twice\n(#9061)\n\nRestructure dev mode handler logic to avoid starting webpack twice\n\nFixes #8981\n# Conflicts:\n#\tflow-server/src/main/java/com/vaadin/flow/server/DevModeHandler.java\n#\tflow-server/src/test/java/com/vaadin/flow/server/DevModeHandlerTest.java"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "02b08412bee4b61d48ed8b575f0bdd960056a998", "author": {"user": {"login": "joheriks", "name": "Johannes Eriksson"}}, "url": "https://github.com/vaadin/flow/commit/02b08412bee4b61d48ed8b575f0bdd960056a998", "committedDate": "2020-10-02T08:17:30Z", "message": "JavaScriptBootstrapHandler: Do not compute push url from service and request url on the server side (#9040)\n\nFixes a regression where the relative path calculation went wrong if the parameter contains a slash."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a3738cea2fba515702e6c9c2e38f0145149388f0", "author": {"user": null}, "url": "https://github.com/vaadin/flow/commit/a3738cea2fba515702e6c9c2e38f0145149388f0", "committedDate": "2020-10-05T07:06:16Z", "message": "Do more accurate check for error messages in IT (#9086)\n\nFixes #9068"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "2019c43b7c29640e139b2313429f28b30e73b572", "author": {"user": {"login": "mshabarov", "name": "Mikhail Shabarov"}}, "url": "https://github.com/vaadin/flow/commit/2019c43b7c29640e139b2313429f28b30e73b572", "committedDate": "2020-10-05T07:14:11Z", "message": "Add missing default page size constant"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTAxODUwMzc4", "url": "https://github.com/vaadin/flow/pull/9078#pullrequestreview-501850378", "createdAt": "2020-10-05T08:57:59Z", "commit": {"oid": "2019c43b7c29640e139b2313429f28b30e73b572"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wNVQwODo1Nzo1OVrOHcTofg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wNVQwODo1Nzo1OVrOHcTofg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5OTQ0MzgzOA==", "bodyText": "Remove this use of \"Thread.sleep()\".", "url": "https://github.com/vaadin/flow/pull/9078#discussion_r499443838", "createdAt": "2020-10-05T08:57:59Z", "author": {"login": "vaadin-bot"}, "path": "flow-server/src/test/java/com/vaadin/flow/server/DevModeHandlerTest.java", "diffHunk": "@@ -420,6 +481,80 @@ public void serveDevModeRequest_prepareTasksThrows_serveDevModeReturnsFalseAndDo\n         Assert.assertFalse(handler.serveDevModeRequest(request, response));\n     }\n \n+    @Test\n+    public void start_twoTimes_onlyOneHandlerInstanceIsCreated() {\n+        MockDeploymentConfiguration configuration = Mockito\n+                .spy(MockDeploymentConfiguration.class);\n+        DevModeHandler handler = DevModeHandler.start(0, configuration,\n+                npmFolder, CompletableFuture.completedFuture(null));\n+        handler.join();\n+\n+        // This is how new server handler instantiation checked:\n+        Mockito.verify(configuration).reuseDevServer();\n+\n+        // \"start\" one more time: there should not be another instance of dev\n+        // mode handler created\n+        DevModeHandler anotherHandler = DevModeHandler.start(0, configuration,\n+                npmFolder, CompletableFuture.completedFuture(null));\n+        anotherHandler.join();\n+\n+        // The handler instances are the same but there should be no attempt to\n+        // create another instance (which won't be stored anywhere), see below\n+        Assert.assertSame(handler, anotherHandler);\n+\n+        // No more \"reuseDevServer\" calls are done: see above, it has been\n+        // already called one time\n+        Mockito.verify(configuration).reuseDevServer();\n+    }\n+\n+    @Test\n+    public void start_twoInstances_secondInstanceUsesAnotherPort()\n+            throws Exception {\n+\n+        // start the first instance\n+        DevModeHandler handler = DevModeHandler.start(0, configuration,\n+                npmFolder, CompletableFuture.completedFuture(null));\n+\n+        // remove the \"singleton\" instance to be able to start another one\n+        removeDevModeHandlerInstance();\n+\n+        // since the timeout is quite big the server port still should be\n+        // available and the second instance should try to reuse it\n+\n+        DevModeHandler.start(0, configuration, npmFolder,\n+                CompletableFuture.completedFuture(null));\n+\n+        // make checks only if webpack has not yet completed\n+\n+        DevModeHandler anotherHandler = DevModeHandler.start(0, configuration,\n+                npmFolder, CompletableFuture.completedFuture(null));\n+\n+        while (handler.getPort() == 0) {\n+            Thread.sleep(100);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "2019c43b7c29640e139b2313429f28b30e73b572"}, "originalPosition": 205}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTAxOTQzMDgx", "url": "https://github.com/vaadin/flow/pull/9078#pullrequestreview-501943081", "createdAt": "2020-10-05T11:02:28Z", "commit": {"oid": "2019c43b7c29640e139b2313429f28b30e73b572"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4962, "cost": 1, "resetAt": "2021-10-28T20:13:43Z"}}}