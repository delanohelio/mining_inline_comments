{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTMyMzY3OTUw", "number": 9572, "title": "refactor: get Executor service from Lookup instead init params", "bodyText": "fixes #9570", "createdAt": "2020-12-04T08:13:11Z", "url": "https://github.com/vaadin/flow/pull/9572", "merged": true, "mergeCommit": {"oid": "dedb8dd1e643e09bc977ffc0c0a6c4a3928b38ed"}, "closed": true, "closedAt": "2020-12-07T07:49:47Z", "author": {"login": "denis-anisimov"}, "timelineItems": {"totalCount": 9, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdizFyAAH2gAyNTMyMzY3OTUwOjQxNTQ1YzllYWIyOTFmMzQwZjIyMDU5OGIwY2E0OTFkNjQxZmUyNmI=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdjws8TgFqTU0NTg5NTY5NQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "41545c9eab291f340f220598b0ca491d641fe26b", "author": {"user": null}, "url": "https://github.com/vaadin/flow/commit/41545c9eab291f340f220598b0ca491d641fe26b", "committedDate": "2020-12-04T08:02:08Z", "message": "refactor: get Executor service from Lookup instead init params\n\nfixes #9570"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f38c46bbf14663acab5cb199c891c88094cae7d7", "author": {"user": null}, "url": "https://github.com/vaadin/flow/commit/f38c46bbf14663acab5cb199c891c88094cae7d7", "committedDate": "2020-12-04T08:11:26Z", "message": "fix: update tests with new local API"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e7be22d9fc43863b48a683cecf553bad08b25e3f", "author": {"user": null}, "url": "https://github.com/vaadin/flow/commit/e7be22d9fc43863b48a683cecf553bad08b25e3f", "committedDate": "2020-12-04T08:38:15Z", "message": "fix: fix javadocs"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c491c821e49c314e72482ace762a70a0f7103fa1", "author": {"user": null}, "url": "https://github.com/vaadin/flow/commit/c491c821e49c314e72482ace762a70a0f7103fa1", "committedDate": "2020-12-04T09:46:49Z", "message": "fix: fix tests"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a43b621ef122aaf80c28e9683beb3235ba2a9a43", "author": {"user": null}, "url": "https://github.com/vaadin/flow/commit/a43b621ef122aaf80c28e9683beb3235ba2a9a43", "committedDate": "2020-12-04T10:20:20Z", "message": "test: extend LookupInitializer test"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTQ0ODQ0NTc3", "url": "https://github.com/vaadin/flow/pull/9572#pullrequestreview-544844577", "createdAt": "2020-12-04T10:41:32Z", "commit": {"oid": "a43b621ef122aaf80c28e9683beb3235ba2a9a43"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0wNFQxMDo0MTozMlrOH_LIAg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0wNFQxMDo0MTozMlrOH_LIAg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNjAwNDYxMA==", "bodyText": "Remove this use of \"Thread.sleep()\".", "url": "https://github.com/vaadin/flow/pull/9572#discussion_r536004610", "createdAt": "2020-12-04T10:41:32Z", "author": {"login": "vaadin-bot"}, "path": "flow-server/src/test/java/com/vaadin/flow/server/DevModeHandlerTest.java", "diffHunk": "@@ -529,13 +534,14 @@ public void start_twoInstances_secondInstanceUsesAnotherPort()\n         // since the timeout is quite big the server port still should be\n         // available and the second instance should try to reuse it\n \n-        DevModeHandler.start(0, configuration, npmFolder,\n+        DevModeHandler.start(0, createDevModeLookup(), npmFolder,\n                 CompletableFuture.completedFuture(null));\n \n         // make checks only if webpack has not yet completed\n \n-        DevModeHandler anotherHandler = DevModeHandler.start(0, configuration,\n-                npmFolder, CompletableFuture.completedFuture(null));\n+        DevModeHandler anotherHandler = DevModeHandler.start(0,\n+                createDevModeLookup(), npmFolder,\n+                CompletableFuture.completedFuture(null));\n \n         while (handler.getPort() == 0) {\n             Thread.sleep(100);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "a43b621ef122aaf80c28e9683beb3235ba2a9a43"}, "originalPosition": 293}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTQ0ODQ0NTkz", "url": "https://github.com/vaadin/flow/pull/9572#pullrequestreview-544844593", "createdAt": "2020-12-04T10:41:33Z", "commit": {"oid": "a43b621ef122aaf80c28e9683beb3235ba2a9a43"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0wNFQxMDo0MTozM1rOH_LIEg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0wNFQxMDo0MTozM1rOH_LIEg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNjAwNDYyNg==", "bodyText": "A \"Set\" cannot contain a \"Class\"", "url": "https://github.com/vaadin/flow/pull/9572#discussion_r536004626", "createdAt": "2020-12-04T10:41:33Z", "author": {"login": "vaadin-bot"}, "path": "flow-server/src/main/java/com/vaadin/flow/di/Lookup.java", "diffHunk": "@@ -89,4 +94,91 @@\n      *         returned)\n      */\n     <T> Collection<T> lookupAll(Class<T> serviceClass);\n+\n+    /**\n+     * Creates a lookup which contains (only) the provided {@code service} as\n+     * instance of given {@code serviceTypes}.\n+     * <p>\n+     * This method may be used to create a temporary lookup which then can be\n+     * used to extend an existing lookup via {@link #compose(Lookup, Lookup)}.\n+     * \n+     * @param <T>\n+     *            the service type\n+     * @param service\n+     *            the service object\n+     * @param serviceTypes\n+     *            the supertypes of the service which may be used to access the\n+     *            service\n+     * @return a lookup initialized with the given {@code service}\n+     */\n+    @SafeVarargs\n+    static <T> Lookup of(T service, Class<? super T>... serviceTypes) {\n+        Objects.requireNonNull(service);\n+        Set<Class<? super T>> services = Stream.of(serviceTypes).peek(type -> {\n+            if (!type.isInstance(service)) {\n+                throw new IllegalArgumentException(\n+                        \"Service type\" + service.getClass().getName()\n+                                + \" is not a subtype of \" + type.getName());\n+            }\n+        }).collect(Collectors.toSet());\n+        return new Lookup() {\n+\n+            @Override\n+            public <U> Collection<U> lookupAll(Class<U> serviceClass) {\n+                U service = lookup(serviceClass);\n+                return service == null ? Collections.emptyList()\n+                        : Collections.singleton(service);\n+            }\n+\n+            @Override\n+            public <U> U lookup(Class<U> serviceClass) {\n+                if (services.contains(serviceClass)) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "a43b621ef122aaf80c28e9683beb3235ba2a9a43"}, "originalPosition": 54}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f2e096dd69d537a7534f1b762998a82611a125a6", "author": {"user": null}, "url": "https://github.com/vaadin/flow/commit/f2e096dd69d537a7534f1b762998a82611a125a6", "committedDate": "2020-12-07T06:21:01Z", "message": "fix: clarify Lookup javadocs"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTQ1ODk1Njk1", "url": "https://github.com/vaadin/flow/pull/9572#pullrequestreview-545895695", "createdAt": "2020-12-07T07:49:07Z", "commit": {"oid": "f2e096dd69d537a7534f1b762998a82611a125a6"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4624, "cost": 1, "resetAt": "2021-10-28T20:13:43Z"}}}