{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0MzY5NDkzNDE4", "number": 7456, "title": "Pin versions based on versions file provided by the Platform", "bodyText": "Fixes #7451\n\n\nThis change is\u2002", "createdAt": "2020-01-31T09:41:26Z", "url": "https://github.com/vaadin/flow/pull/7456", "merged": true, "mergeCommit": {"oid": "bed0505f1defde54b90c8f94e5fbc68047396986"}, "closed": true, "closedAt": "2020-02-03T08:43:32Z", "author": {"login": "denis-anisimov"}, "timelineItems": {"totalCount": 25, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABb_r5SdgH2gAyMzY5NDkzNDE4Ojc5ZGU1OWQ5OTY2ZWFhYmRiMGQwZGRhMWRiMWYzZmE1M2FkZDAwNzY=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcAo3tWAFqTM1MjA5MDA1OQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "79de59d9966eaabdb0d0dda1db1f3fa53add0076", "author": {"user": null}, "url": "https://github.com/vaadin/flow/commit/79de59d9966eaabdb0d0dda1db1f3fa53add0076", "committedDate": "2020-01-31T09:40:39Z", "message": "Pin versions based on versions file provided by the Platform\n\nFixes #7451"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzUxMzkzNjM4", "url": "https://github.com/vaadin/flow/pull/7456#pullrequestreview-351393638", "createdAt": "2020-01-31T09:50:49Z", "commit": {"oid": "79de59d9966eaabdb0d0dda1db1f3fa53add0076"}, "state": "COMMENTED", "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0zMVQwOTo1MDo0OVrOFkGPIQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0zMVQwOTo1ODo0NFrOFkGcpg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MzM5NTIzMw==", "bodyText": "nit: probably better to remove before merging, there might be a lot of logging output.", "url": "https://github.com/vaadin/flow/pull/7456#discussion_r373395233", "createdAt": "2020-01-31T09:50:49Z", "author": {"login": "web-padawan"}, "path": "flow-server/src/main/resources/pnpmfile.js", "diffHunk": "@@ -0,0 +1,42 @@\n+const fs = require('fs');\n+\n+const packageJson = JSON.parse(fs.readFileSync('./package.json', 'utf-8'));\n+\n+const versionsFile = '[to-be-generated-by-flow]';\n+\n+if (!fs.existsSync(versionsFile)) {\n+    return;\n+}\n+const versions = JSON.parse(fs.readFileSync(versionsFile, 'utf-8'));\n+\n+let vaadinDeps;\n+\n+module.exports = {\n+  hooks: {\n+    readPackage\n+  }\n+};\n+\n+function getExactVersion(string) {\n+  return string.replace('^', '');\n+}\n+\n+\n+function readPackage(pkg) {\n+  const deps = versions;\n+\n+  const { dependencies } = pkg;\n+\n+  if (dependencies) {\n+    for (let k in deps) {\n+      if (dependencies[k] && dependencies[k] !== deps[k]) {\n+        console.log(", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "79de59d9966eaabdb0d0dda1db1f3fa53add0076"}, "originalPosition": 33}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MzM5NTM5MA==", "bodyText": "nit: unused variable from the original script, please remove.", "url": "https://github.com/vaadin/flow/pull/7456#discussion_r373395390", "createdAt": "2020-01-31T09:51:13Z", "author": {"login": "web-padawan"}, "path": "flow-server/src/main/resources/pnpmfile.js", "diffHunk": "@@ -0,0 +1,42 @@\n+const fs = require('fs');\n+\n+const packageJson = JSON.parse(fs.readFileSync('./package.json', 'utf-8'));\n+\n+const versionsFile = '[to-be-generated-by-flow]';\n+\n+if (!fs.existsSync(versionsFile)) {\n+    return;\n+}\n+const versions = JSON.parse(fs.readFileSync(versionsFile, 'utf-8'));\n+\n+let vaadinDeps;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "79de59d9966eaabdb0d0dda1db1f3fa53add0076"}, "originalPosition": 12}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MzM5ODY5NA==", "bodyText": "nit: this extra assignment is not necessary.\nyou can remove it and use for (let k in versions) { etc below.", "url": "https://github.com/vaadin/flow/pull/7456#discussion_r373398694", "createdAt": "2020-01-31T09:58:44Z", "author": {"login": "web-padawan"}, "path": "flow-server/src/main/resources/pnpmfile.js", "diffHunk": "@@ -0,0 +1,42 @@\n+const fs = require('fs');\n+\n+const packageJson = JSON.parse(fs.readFileSync('./package.json', 'utf-8'));\n+\n+const versionsFile = '[to-be-generated-by-flow]';\n+\n+if (!fs.existsSync(versionsFile)) {\n+    return;\n+}\n+const versions = JSON.parse(fs.readFileSync(versionsFile, 'utf-8'));\n+\n+let vaadinDeps;\n+\n+module.exports = {\n+  hooks: {\n+    readPackage\n+  }\n+};\n+\n+function getExactVersion(string) {\n+  return string.replace('^', '');\n+}\n+\n+\n+function readPackage(pkg) {\n+  const deps = versions;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "79de59d9966eaabdb0d0dda1db1f3fa53add0076"}, "originalPosition": 26}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c2a3e0d53a4208c8ec06c6f2b0401cb48d400e01", "author": {"user": null}, "url": "https://github.com/vaadin/flow/commit/c2a3e0d53a4208c8ec06c6f2b0401cb48d400e01", "committedDate": "2020-01-31T10:00:34Z", "message": "Exclude class for temporary work from serializable."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "d39b84a0ea2f20fe3a6fb26ce978976fabab6ce1", "author": {"user": null}, "url": "https://github.com/vaadin/flow/commit/d39b84a0ea2f20fe3a6fb26ce978976fabab6ce1", "committedDate": "2020-01-31T10:05:32Z", "message": "Clean up js file"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzUxNDAyNTI4", "url": "https://github.com/vaadin/flow/pull/7456#pullrequestreview-351402528", "createdAt": "2020-01-31T10:06:26Z", "commit": {"oid": "d39b84a0ea2f20fe3a6fb26ce978976fabab6ce1"}, "state": "COMMENTED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "42922e5504b022019af95d3a1e0a68a131daae86", "author": {"user": null}, "url": "https://github.com/vaadin/flow/commit/42922e5504b022019af95d3a1e0a68a131daae86", "committedDate": "2020-01-31T10:06:49Z", "message": "Add a new line in the end"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzUxNDI1MzMy", "url": "https://github.com/vaadin/flow/pull/7456#pullrequestreview-351425332", "createdAt": "2020-01-31T10:47:46Z", "commit": {"oid": "42922e5504b022019af95d3a1e0a68a131daae86"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "58839b2a404e666611f138f2765b2530b7e5d99a", "author": {"user": null}, "url": "https://github.com/vaadin/flow/commit/58839b2a404e666611f138f2765b2530b7e5d99a", "committedDate": "2020-01-31T11:46:05Z", "message": "Fixes based on review"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzUxNDUzODAz", "url": "https://github.com/vaadin/flow/pull/7456#pullrequestreview-351453803", "createdAt": "2020-01-31T11:46:18Z", "commit": {"oid": "42922e5504b022019af95d3a1e0a68a131daae86"}, "state": "COMMENTED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzUxNDU0MDQz", "url": "https://github.com/vaadin/flow/pull/7456#pullrequestreview-351454043", "createdAt": "2020-01-31T11:46:48Z", "commit": {"oid": "42922e5504b022019af95d3a1e0a68a131daae86"}, "state": "COMMENTED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzUxNDU1MTc4", "url": "https://github.com/vaadin/flow/pull/7456#pullrequestreview-351455178", "createdAt": "2020-01-31T11:49:25Z", "commit": {"oid": "58839b2a404e666611f138f2765b2530b7e5d99a"}, "state": "COMMENTED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzUxNDc1MTY1", "url": "https://github.com/vaadin/flow/pull/7456#pullrequestreview-351475165", "createdAt": "2020-01-31T12:32:24Z", "commit": {"oid": "58839b2a404e666611f138f2765b2530b7e5d99a"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzUxNDg4NzU1", "url": "https://github.com/vaadin/flow/pull/7456#pullrequestreview-351488755", "createdAt": "2020-01-31T13:00:34Z", "commit": {"oid": "58839b2a404e666611f138f2765b2530b7e5d99a"}, "state": "COMMENTED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "daec074f173622ac67942cb553af8c8e97708c70", "author": {"user": null}, "url": "https://github.com/vaadin/flow/commit/daec074f173622ac67942cb553af8c8e97708c70", "committedDate": "2020-01-31T13:01:33Z", "message": "More review fixes."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzUxNDkwNzkw", "url": "https://github.com/vaadin/flow/pull/7456#pullrequestreview-351490790", "createdAt": "2020-01-31T13:04:32Z", "commit": {"oid": "58839b2a404e666611f138f2765b2530b7e5d99a"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0zMVQxMzowNDozMlrOFkKv9A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0zMVQxMzowNDozMlrOFkKv9A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MzQ2OTE3Mg==", "bodyText": "nit: this function can be removed altogether and there are extra newlines below it.\ndidn't notice this during the first review round, sorry about that.", "url": "https://github.com/vaadin/flow/pull/7456#discussion_r373469172", "createdAt": "2020-01-31T13:04:32Z", "author": {"login": "web-padawan"}, "path": "flow-server/src/main/resources/pnpmfile.js", "diffHunk": "@@ -0,0 +1,35 @@\n+const fs = require('fs');\n+\n+const packageJson = JSON.parse(fs.readFileSync('./package.json', 'utf-8'));\n+\n+const versionsFile = '[to-be-generated-by-flow]';\n+\n+if (!fs.existsSync(versionsFile)) {\n+    return;\n+}\n+const versions = JSON.parse(fs.readFileSync(versionsFile, 'utf-8'));\n+\n+module.exports = {\n+  hooks: {\n+    readPackage\n+  }\n+};\n+\n+function getExactVersion(string) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "58839b2a404e666611f138f2765b2530b7e5d99a"}, "originalPosition": 18}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzUxNDkzNDU3", "url": "https://github.com/vaadin/flow/pull/7456#pullrequestreview-351493457", "createdAt": "2020-01-31T13:09:47Z", "commit": {"oid": "daec074f173622ac67942cb553af8c8e97708c70"}, "state": "DISMISSED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "bfafa835ec11509142d561a3fe7304ec36392af8", "author": {"user": null}, "url": "https://github.com/vaadin/flow/commit/bfafa835ec11509142d561a3fe7304ec36392af8", "committedDate": "2020-02-03T05:45:24Z", "message": "Clean up hook file content and correct the class name in serializable\ntest"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "dfe4664d8a6cbde4388f08abe0b6ee19a4a856ec", "author": {"user": null}, "url": "https://github.com/vaadin/flow/commit/dfe4664d8a6cbde4388f08abe0b6ee19a4a856ec", "committedDate": "2020-02-03T07:09:33Z", "message": "Remove test which is failing on CI."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzUyMDg0NDEy", "url": "https://github.com/vaadin/flow/pull/7456#pullrequestreview-352084412", "createdAt": "2020-02-03T08:32:17Z", "commit": {"oid": "dfe4664d8a6cbde4388f08abe0b6ee19a4a856ec"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0wM1QwODozMjoxN1rOFkpdBw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0wM1QwODozMjoxN1rOFkpdBw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3Mzk3MjIzMQ==", "bodyText": "Remove the declaration of thrown exception 'java.io.IOException', as it cannot be thrown from method's body.", "url": "https://github.com/vaadin/flow/pull/7456#discussion_r373972231", "createdAt": "2020-02-03T08:32:17Z", "author": {"login": "vaadin-bot"}, "path": "flow-server/src/main/java/com/vaadin/flow/server/frontend/VersionsJsonConverter.java", "diffHunk": "@@ -0,0 +1,72 @@\n+/*\n+ * Copyright 2000-2018 Vaadin Ltd.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\"); you may not\n+ * use this file except in compliance with the License. You may obtain a copy of\n+ * the License at\n+ *\n+ * http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS, WITHOUT\n+ * WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied. See the\n+ * License for the specific language governing permissions and limitations under\n+ * the License.\n+ */\n+package com.vaadin.flow.server.frontend;\n+\n+import java.io.IOException;\n+\n+import elemental.json.Json;\n+import elemental.json.JsonObject;\n+import elemental.json.JsonValue;\n+\n+/**\n+ * Converts platform versions file to internal format which doesn't contain\n+ * extra information.\n+ * <p>\n+ * The result contains all dependencies as keys and their versions as value.\n+ *\n+ * @author Vaadin Ltd\n+ *\n+ */\n+class VersionsJsonConverter {\n+\n+    private static final String JS_VERSION = \"jsVersion\";\n+    private static final String NPM_NAME = \"npmName\";\n+    private final JsonObject convertedObject;\n+\n+    VersionsJsonConverter(JsonObject platformVersions) {\n+        convertedObject = Json.createObject();\n+\n+        collectDependencies(platformVersions);\n+    }\n+\n+    JsonObject convert() throws IOException {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "dfe4664d8a6cbde4388f08abe0b6ee19a4a856ec"}, "originalPosition": 45}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzUyMDg0NDE5", "url": "https://github.com/vaadin/flow/pull/7456#pullrequestreview-352084419", "createdAt": "2020-02-03T08:32:18Z", "commit": {"oid": "dfe4664d8a6cbde4388f08abe0b6ee19a4a856ec"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0wM1QwODozMjoxOFrOFkpdDA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0wM1QwODozMjoxOFrOFkpdDA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3Mzk3MjIzNg==", "bodyText": "Remove this unused \"TemporaryFolder\".", "url": "https://github.com/vaadin/flow/pull/7456#discussion_r373972236", "createdAt": "2020-02-03T08:32:18Z", "author": {"login": "vaadin-bot"}, "path": "flow-server/src/test/java/com/vaadin/flow/server/frontend/VersionsJsonConverterTest.java", "diffHunk": "@@ -0,0 +1,67 @@\n+/*\n+ * Copyright 2000-2018 Vaadin Ltd.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\"); you may not\n+ * use this file except in compliance with the License. You may obtain a copy of\n+ * the License at\n+ *\n+ * http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS, WITHOUT\n+ * WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied. See the\n+ * License for the specific language governing permissions and limitations under\n+ * the License.\n+ */\n+package com.vaadin.flow.server.frontend;\n+\n+import java.io.IOException;\n+\n+import org.junit.Assert;\n+import org.junit.Rule;\n+import org.junit.Test;\n+import org.junit.rules.TemporaryFolder;\n+\n+import elemental.json.Json;\n+import elemental.json.JsonObject;\n+\n+public class VersionsJsonConverterTest {\n+\n+    @Rule\n+    public TemporaryFolder temporaryFolder = new TemporaryFolder();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "dfe4664d8a6cbde4388f08abe0b6ee19a4a856ec"}, "originalPosition": 31}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzUyMDg1NjE1", "url": "https://github.com/vaadin/flow/pull/7456#pullrequestreview-352085615", "createdAt": "2020-02-03T08:34:40Z", "commit": {"oid": "dfe4664d8a6cbde4388f08abe0b6ee19a4a856ec"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzUyMDg4NDgw", "url": "https://github.com/vaadin/flow/pull/7456#pullrequestreview-352088480", "createdAt": "2020-02-03T08:40:07Z", "commit": {"oid": "dfe4664d8a6cbde4388f08abe0b6ee19a4a856ec"}, "state": "COMMENTED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzUyMDg5MzE0", "url": "https://github.com/vaadin/flow/pull/7456#pullrequestreview-352089314", "createdAt": "2020-02-03T08:41:37Z", "commit": {"oid": "dfe4664d8a6cbde4388f08abe0b6ee19a4a856ec"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzUyMDg5NDU5", "url": "https://github.com/vaadin/flow/pull/7456#pullrequestreview-352089459", "createdAt": "2020-02-03T08:41:53Z", "commit": {"oid": "dfe4664d8a6cbde4388f08abe0b6ee19a4a856ec"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzUyMDkwMDU5", "url": "https://github.com/vaadin/flow/pull/7456#pullrequestreview-352090059", "createdAt": "2020-02-03T08:43:08Z", "commit": {"oid": "dfe4664d8a6cbde4388f08abe0b6ee19a4a856ec"}, "state": "COMMENTED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 667, "cost": 1, "resetAt": "2021-10-28T19:08:13Z"}}}