{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDc4NTM2NTc1", "number": 8940, "title": "Move service worker generation to webpack config", "bodyText": "WIP related to #8911.\nThe intention of this PR is to just move the generation of service worker to webpack (build time) but try to keep the behaviour same, so default offline page should stay working if possible. Some limitations or TODOs may be left to be solved in separate PRs to make things more clear to develop and review.\nTODO:\n\nservice worker should be registered and work both in dev and production mode (after mvn clean and removal of webpack.generated.js).\n\nCurrently webpack generates it to ../resources/sw.js which results in it being served at root but it only works after running build-frontend task. It can be changed to build/sw.js so that it also seems to be served in dev mode too but that results in it being served from VAADIN/build/sw.js and that causes a scope issue when registering the service worker (unless extra HTTP header Service-Worker-Allowed is added to the sw.js response). So we need some way to make sure the webpack generated sw.js is served from root, and also works in dev mode without extra steps.\n\n\nfollowing things should be somehow added to workbox precache manifest (with hash/revision):\n\noffline.html (currently runtime generated)\nmanifest.webmanifest (currently runtime generated)\npwa/app icons (currently runtime generated), only webmanifest icons?\ncan we precache these dynamically at runtime (when service worker has just been registered) without knowing the content/hash at build time? Or do we need to make sure these are also available at build time?", "createdAt": "2020-09-03T10:41:35Z", "url": "https://github.com/vaadin/flow/pull/8940", "merged": true, "mergeCommit": {"oid": "d69c44539dcf86ecce4bb5a399e137276bc3f1ba"}, "closed": true, "closedAt": "2020-09-30T12:03:28Z", "author": {"login": "Haprog"}, "timelineItems": {"totalCount": 43, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdFOThXgBqjM3MjQwOTQ3Mzk=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdN7cyzAFqTQ5OTM0OTM5Ng==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "92ab1a3195ac4558670e0df9a9e1a0536c3d381b", "author": {"user": {"login": "Haprog", "name": "Kari S\u00f6derholm"}}, "url": "https://github.com/vaadin/flow/commit/92ab1a3195ac4558670e0df9a9e1a0536c3d381b", "committedDate": "2020-09-03T10:31:29Z", "message": "Move service worker generation to webpack config\n\nWIP related to #8911.\n\nTODO:\n- service worker should be registered and work both in dev and production mode (after `mvn clean` and removal of webpack.generated.js)\n- following things should be somehow added to workbox precache manifest (with hash/revision):\n  - offline.html (currently runtime generated)\n  - manifest.webmanifest (currently runtime generated)\n  - pwa/app icons (currently runtime generated), only webmanifest icons?"}, "afterCommit": {"oid": "34671dcf6ce9b6ec6f1d25757a62c07165b7d625", "author": {"user": {"login": "Haprog", "name": "Kari S\u00f6derholm"}}, "url": "https://github.com/vaadin/flow/commit/34671dcf6ce9b6ec6f1d25757a62c07165b7d625", "committedDate": "2020-09-03T10:46:27Z", "message": "Move service worker generation to webpack config\n\nWIP related to #8911.\n\nTODO:\n- service worker should be registered and work both in dev and production mode (after `mvn clean` and removal of webpack.generated.js)\n- following things should be somehow added to workbox precache manifest (with hash/revision):\n  - offline.html (currently runtime generated)\n  - manifest.webmanifest (currently runtime generated)\n  - pwa/app icons (currently runtime generated), only webmanifest icons?"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "ae918dae49f06a81286716e506d00edfcaaf165a", "author": {"user": {"login": "platosha", "name": "Anton Platonov"}}, "url": "https://github.com/vaadin/flow/commit/ae918dae49f06a81286716e506d00edfcaaf165a", "committedDate": "2020-09-15T10:59:17Z", "message": "fix typo in webpack.generated.js template"}, "afterCommit": {"oid": "7afb30a15be042cf7cabe961d26c180ad856194f", "author": {"user": {"login": "platosha", "name": "Anton Platonov"}}, "url": "https://github.com/vaadin/flow/commit/7afb30a15be042cf7cabe961d26c180ad856194f", "committedDate": "2020-09-22T11:01:03Z", "message": "Map all webpack output resource paths listed in manifest.json"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "9ed726703cc0f8c6041e2f245295722aab15f3f3", "author": {"user": {"login": "Haprog", "name": "Kari S\u00f6derholm"}}, "url": "https://github.com/vaadin/flow/commit/9ed726703cc0f8c6041e2f245295722aab15f3f3", "committedDate": "2020-09-23T12:09:44Z", "message": "Move service worker generation to webpack config\n\nWIP related to #8911.\n\nTODO:\n- service worker should be registered and work both in dev and production mode (after `mvn clean` and removal of webpack.generated.js)\n- following things should be somehow added to workbox precache manifest (with hash/revision):\n  - offline.html (currently runtime generated)\n  - manifest.webmanifest (currently runtime generated)\n  - pwa/app icons (currently runtime generated), only webmanifest icons?"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "cbf62a68796980560ec50018b5c36041db5425fc", "author": {"user": {"login": "Haprog", "name": "Kari S\u00f6derholm"}}, "url": "https://github.com/vaadin/flow/commit/cbf62a68796980560ec50018b5c36041db5425fc", "committedDate": "2020-09-23T12:09:44Z", "message": "Fix SonarQube complaints"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "d42d57501c1f80d858317465affaba9b6e3b974b", "author": {"user": {"login": "platosha", "name": "Anton Platonov"}}, "url": "https://github.com/vaadin/flow/commit/d42d57501c1f80d858317465affaba9b6e3b974b", "committedDate": "2020-09-23T12:09:44Z", "message": "Enable serving webpack generated sw and workbox js resources in DevMode"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "3ed5a9e2548b346b9b4814b5dfecdb925766e74b", "author": {"user": {"login": "platosha", "name": "Anton Platonov"}}, "url": "https://github.com/vaadin/flow/commit/3ed5a9e2548b346b9b4814b5dfecdb925766e74b", "committedDate": "2020-09-23T12:09:44Z", "message": "fix typo in webpack.generated.js template"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "2b70bca930a751f9a04d1011887fbbd26ee7942c", "author": {"user": {"login": "platosha", "name": "Anton Platonov"}}, "url": "https://github.com/vaadin/flow/commit/2b70bca930a751f9a04d1011887fbbd26ee7942c", "committedDate": "2020-09-23T12:09:44Z", "message": "Add asset manifest json to webpack"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "0724c10b44f277cc22a841a40a2f9bdcedf44306", "author": {"user": {"login": "platosha", "name": "Anton Platonov"}}, "url": "https://github.com/vaadin/flow/commit/0724c10b44f277cc22a841a40a2f9bdcedf44306", "committedDate": "2020-09-23T12:09:44Z", "message": "Align all webpack output files to use META-INF/VAADIN/webapp/"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a5612818e28054c9f52f6ef68c91876777cfbc65", "author": {"user": {"login": "platosha", "name": "Anton Platonov"}}, "url": "https://github.com/vaadin/flow/commit/a5612818e28054c9f52f6ef68c91876777cfbc65", "committedDate": "2020-09-23T12:09:44Z", "message": "Map all webpack output resource paths listed in manifest.json"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f7dc4ccc3575d7175333b6f4da070f78094d0f89", "author": {"user": {"login": "platosha", "name": "Anton Platonov"}}, "url": "https://github.com/vaadin/flow/commit/f7dc4ccc3575d7175333b6f4da070f78094d0f89", "committedDate": "2020-09-23T12:09:44Z", "message": "cleanup in webpack.generated.js"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "7afb30a15be042cf7cabe961d26c180ad856194f", "author": {"user": {"login": "platosha", "name": "Anton Platonov"}}, "url": "https://github.com/vaadin/flow/commit/7afb30a15be042cf7cabe961d26c180ad856194f", "committedDate": "2020-09-22T11:01:03Z", "message": "Map all webpack output resource paths listed in manifest.json"}, "afterCommit": {"oid": "f7dc4ccc3575d7175333b6f4da070f78094d0f89", "author": {"user": {"login": "platosha", "name": "Anton Platonov"}}, "url": "https://github.com/vaadin/flow/commit/f7dc4ccc3575d7175333b6f4da070f78094d0f89", "committedDate": "2020-09-23T12:09:44Z", "message": "cleanup in webpack.generated.js"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "6d54217da2eaabc6e564f7d0a6e498fc80c34970", "author": {"user": {"login": "platosha", "name": "Anton Platonov"}}, "url": "https://github.com/vaadin/flow/commit/6d54217da2eaabc6e564f7d0a6e498fc80c34970", "committedDate": "2020-09-24T09:07:05Z", "message": "fix serving root-located Vaadin resources in StaticFileServer.java"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f24a1b05ebc186bff3150aed2db10b97dc4dc26a", "author": {"user": {"login": "Haprog", "name": "Kari S\u00f6derholm"}}, "url": "https://github.com/vaadin/flow/commit/f24a1b05ebc186bff3150aed2db10b97dc4dc26a", "committedDate": "2020-09-24T09:13:46Z", "message": "Precache the app shell and use it as navigateFallback\n\nMove serviceWorkerPlugin after HtmlWebpackPlugin so that it adds the generated index.html into the precache manifest automatically. Enable navigateFallback to precache the app shell (index.html served from '/' with some runtime changes)."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "eebf417a786551b27c90166459653419058c7786", "author": {"user": {"login": "Haprog", "name": "Kari S\u00f6derholm"}}, "url": "https://github.com/vaadin/flow/commit/eebf417a786551b27c90166459653419058c7786", "committedDate": "2020-09-25T06:23:21Z", "message": "Use CopyPlugin to to include offline resources to workbox precache (#8982)"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "36dabe733fd0343e4dc23c5866b31e863bf40551", "author": {"user": {"login": "platosha", "name": "Anton Platonov"}}, "url": "https://github.com/vaadin/flow/commit/36dabe733fd0343e4dc23c5866b31e863bf40551", "committedDate": "2020-09-25T12:05:01Z", "message": "Move config/ json resources back to META-INF/VAADIN/config\n\nThis partially reverts earlier changes, moving the config output files `META-INF/VAADIN/webapp/VAADIN/config` back to `META-INF/VAADIN/config`. Motivation:\n\n- Configuration resources are not intended for serving. Having `config/` outside of `webapp/` public resource root fits better in that regard.\n- Fixes tests expecting configuration json resources in their original location.\n\nAdditionally, this reverts several constants to their original value, including `VAADIN_SERVLET_RESOURCES`, `STATISTICS_JSON_DEFAULT`, and `VAADIN_CONFIGURATION_FILES_PATH` is removed.\n\nA new constant `VAADIN_WEBAPP_RESOURCES` is introduced to refer to the default location of served resources root."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "7a80a2916bbd15bf150c93e10310015ec3ed9cc0", "author": {"user": {"login": "platosha", "name": "Anton Platonov"}}, "url": "https://github.com/vaadin/flow/commit/7a80a2916bbd15bf150c93e10310015ec3ed9cc0", "committedDate": "2020-09-25T12:05:32Z", "message": "Move `index.html` test resource to webapp/"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "2f53616bcf7b80affaf443b8ec5278f69aeff8f3", "author": {"user": {"login": "platosha", "name": "Anton Platonov"}}, "url": "https://github.com/vaadin/flow/commit/2f53616bcf7b80affaf443b8ec5278f69aeff8f3", "committedDate": "2020-09-25T16:08:35Z", "message": "fix(test): support manifest.json in StaticFileServerTest"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "6bd4ad8734b5596a7b3f1ea3594786c3a21371d7", "author": {"user": {"login": "platosha", "name": "Anton Platonov"}}, "url": "https://github.com/vaadin/flow/commit/6bd4ad8734b5596a7b3f1ea3594786c3a21371d7", "committedDate": "2020-09-25T16:22:07Z", "message": "fix(test): support \"manifest.json\" request in DevModeHandlerTest"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "cf076f5bbda664ce2cbd7ab7b603bc0c538ea9c9", "author": {"user": {"login": "platosha", "name": "Anton Platonov"}}, "url": "https://github.com/vaadin/flow/commit/cf076f5bbda664ce2cbd7ab7b603bc0c538ea9c9", "committedDate": "2020-09-25T16:52:39Z", "message": "fix: obfuscate root url '/' to pass absolute path test"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDk3MzY3MTkz", "url": "https://github.com/vaadin/flow/pull/8940#pullrequestreview-497367193", "createdAt": "2020-09-28T10:05:54Z", "commit": {"oid": "cf076f5bbda664ce2cbd7ab7b603bc0c538ea9c9"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yOFQxMDowNTo1NVrOHY2-yg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yOFQxMDowNTo1NVrOHY2-yg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NTgyODY4Mg==", "bodyText": "I don't like this. Obfuscation for the sake of passing some test(s) makes no sense to me.", "url": "https://github.com/vaadin/flow/pull/8940#discussion_r495828682", "createdAt": "2020-09-28T10:05:55Z", "author": {"login": "Haprog"}, "path": "flow-server/src/main/resources/webpack.generated.js", "diffHunk": "@@ -88,6 +88,8 @@ if (useClientSideIndexFileForBootstrapping) {\n   webPackEntries.bundle = fileNameOfTheFlowGeneratedMainEntryPoint;\n }\n \n+const rootUrl = String.fromCharCode(47); // equivalent of '/'", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "cf076f5bbda664ce2cbd7ab7b603bc0c538ea9c9"}, "originalPosition": 22}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "018864e56a425d7b874dc4f0d58818292838e933", "author": {"user": {"login": "platosha", "name": "Anton Platonov"}}, "url": "https://github.com/vaadin/flow/commit/018864e56a425d7b874dc4f0d58818292838e933", "committedDate": "2020-09-28T12:48:10Z", "message": "add resourceOutputDirectory parameter to generated webpack config"}, "afterCommit": {"oid": "22b310a8228792660776398ccd794631a290f03a", "author": {"user": {"login": "platosha", "name": "Anton Platonov"}}, "url": "https://github.com/vaadin/flow/commit/22b310a8228792660776398ccd794631a290f03a", "committedDate": "2020-09-28T17:46:34Z", "message": "add resourceOutputDirectory parameter to generated webpack config"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "bacf4575ca5c5ceb2ce9c84926161daa1aad666f", "author": {"user": {"login": "platosha", "name": "Anton Platonov"}}, "url": "https://github.com/vaadin/flow/commit/bacf4575ca5c5ceb2ce9c84926161daa1aad666f", "committedDate": "2020-09-28T18:56:46Z", "message": "add resourceOutputDirectory parameter to generated webpack config"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "1a629359e4a52cfec127aef97f8fd683c52684db", "author": {"user": {"login": "platosha", "name": "Anton Platonov"}}, "url": "https://github.com/vaadin/flow/commit/1a629359e4a52cfec127aef97f8fd683c52684db", "committedDate": "2020-09-28T18:56:46Z", "message": "fix: support webpack internal prefixing of output bundles in BootstrapHandler"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "3d2367be417118d1806af2db9fc8067d70925984", "author": {"user": {"login": "platosha", "name": "Anton Platonov"}}, "url": "https://github.com/vaadin/flow/commit/3d2367be417118d1806af2db9fc8067d70925984", "committedDate": "2020-09-28T18:23:11Z", "message": "fix: support webpack internal prefixing of output bundles in BootstrapHandler"}, "afterCommit": {"oid": "1a629359e4a52cfec127aef97f8fd683c52684db", "author": {"user": {"login": "platosha", "name": "Anton Platonov"}}, "url": "https://github.com/vaadin/flow/commit/1a629359e4a52cfec127aef97f8fd683c52684db", "committedDate": "2020-09-28T18:56:46Z", "message": "fix: support webpack internal prefixing of output bundles in BootstrapHandler"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b0725798b8f2e7d0853863a71825e07a91c08fe9", "author": {"user": {"login": "platosha", "name": "Anton Platonov"}}, "url": "https://github.com/vaadin/flow/commit/b0725798b8f2e7d0853863a71825e07a91c08fe9", "committedDate": "2020-09-29T10:51:13Z", "message": "fix: skip \"index.html\" in mapped static resource paths"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "3f8b2d6542ed83f8648cc14f4a2ef9b07049e663", "author": {"user": {"login": "platosha", "name": "Anton Platonov"}}, "url": "https://github.com/vaadin/flow/commit/3f8b2d6542ed83f8648cc14f4a2ef9b07049e663", "committedDate": "2020-09-29T11:44:59Z", "message": "fix: relax performance IT startup time threshold"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "0122cc6e635aad08a5edf303aa557801bface386", "author": {"user": {"login": "platosha", "name": "Anton Platonov"}}, "url": "https://github.com/vaadin/flow/commit/0122cc6e635aad08a5edf303aa557801bface386", "committedDate": "2020-09-29T11:48:56Z", "message": "fix(test): skip rootUrl when checking absolute paths in TaskUpdateWebpackTest"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDk4NDIzMDM1", "url": "https://github.com/vaadin/flow/pull/8940#pullrequestreview-498423035", "createdAt": "2020-09-29T12:40:05Z", "commit": {"oid": "0122cc6e635aad08a5edf303aa557801bface386"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yOVQxMjo0MDowNVrOHZrGTw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yOVQxMjo0MDowNVrOHZrGTw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NjY4MjU3NQ==", "bodyText": "Remove this use of \"SERVLET_PARAMETER_PRODUCTION_MODE\"; it is deprecated.", "url": "https://github.com/vaadin/flow/pull/8940#discussion_r496682575", "createdAt": "2020-09-29T12:40:05Z", "author": {"login": "vaadin-bot"}, "path": "flow-maven-plugin/src/main/java/com/vaadin/flow/plugin/maven/PrepareFrontendMojo.java", "diffHunk": "@@ -139,7 +139,7 @@ public void execute() throws MojoExecutionException, MojoFailureException {\n     private void propagateBuildInfo() {\n         // For forked processes not accessing to System.properties we leave a\n         // token file with the information about the build\n-        File token = new File(webpackOutputDirectory, TOKEN_FILE);\n+        File token = new File(resourceOutputDirectory, TOKEN_FILE);\n         JsonObject buildInfo = Json.createObject();\n         buildInfo.put(SERVLET_PARAMETER_PRODUCTION_MODE, productionMode);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "0122cc6e635aad08a5edf303aa557801bface386"}, "originalPosition": 7}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDk4NDIzMDcz", "url": "https://github.com/vaadin/flow/pull/8940#pullrequestreview-498423073", "createdAt": "2020-09-29T12:40:06Z", "commit": {"oid": "0122cc6e635aad08a5edf303aa557801bface386"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yOVQxMjo0MDowNlrOHZrGXw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yOVQxMjo0MDowNlrOHZrGXw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NjY4MjU5MQ==", "bodyText": "Remove this use of \"SERVLET_PARAMETER_USE_V14_BOOTSTRAP\"; it is deprecated.", "url": "https://github.com/vaadin/flow/pull/8940#discussion_r496682591", "createdAt": "2020-09-29T12:40:06Z", "author": {"login": "vaadin-bot"}, "path": "flow-maven-plugin/src/main/java/com/vaadin/flow/plugin/maven/PrepareFrontendMojo.java", "diffHunk": "@@ -139,7 +139,7 @@ public void execute() throws MojoExecutionException, MojoFailureException {\n     private void propagateBuildInfo() {\n         // For forked processes not accessing to System.properties we leave a\n         // token file with the information about the build\n-        File token = new File(webpackOutputDirectory, TOKEN_FILE);\n+        File token = new File(resourceOutputDirectory, TOKEN_FILE);\n         JsonObject buildInfo = Json.createObject();\n         buildInfo.put(SERVLET_PARAMETER_PRODUCTION_MODE, productionMode);\n         buildInfo.put(SERVLET_PARAMETER_USE_V14_BOOTSTRAP,", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "0122cc6e635aad08a5edf303aa557801bface386"}, "originalPosition": 8}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "1c2f6fc8b07a7c9f1b332a4fff6189843ee80b3e", "author": {"user": {"login": "platosha", "name": "Anton Platonov"}}, "url": "https://github.com/vaadin/flow/commit/1c2f6fc8b07a7c9f1b332a4fff6189843ee80b3e", "committedDate": "2020-09-29T13:49:41Z", "message": "refactor: apply analysis suggestions"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "871323aa25084437548a8b4e321563a3c047e60b", "author": {"user": {"login": "platosha", "name": "Anton Platonov"}}, "url": "https://github.com/vaadin/flow/commit/871323aa25084437548a8b4e321563a3c047e60b", "committedDate": "2020-09-29T13:46:35Z", "message": "refactor: apply analysis suggestions"}, "afterCommit": {"oid": "1c2f6fc8b07a7c9f1b332a4fff6189843ee80b3e", "author": {"user": {"login": "platosha", "name": "Anton Platonov"}}, "url": "https://github.com/vaadin/flow/commit/1c2f6fc8b07a7c9f1b332a4fff6189843ee80b3e", "committedDate": "2020-09-29T13:49:41Z", "message": "refactor: apply analysis suggestions"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDk4NTQ2NzUz", "url": "https://github.com/vaadin/flow/pull/8940#pullrequestreview-498546753", "createdAt": "2020-09-29T14:41:35Z", "commit": {"oid": "1c2f6fc8b07a7c9f1b332a4fff6189843ee80b3e"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yOVQxNDo0MTozNVrOHZwu5A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yOVQxNDo0MTozNVrOHZwu5A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5Njc3NDg4NA==", "bodyText": "Immediately return this expression instead of assigning it to the temporary variable \"relativePath\".", "url": "https://github.com/vaadin/flow/pull/8940#discussion_r496774884", "createdAt": "2020-09-29T14:41:35Z", "author": {"login": "vaadin-bot"}, "path": "flow-server/src/main/java/com/vaadin/flow/server/frontend/TaskUpdateWebpack.java", "diffHunk": "@@ -219,9 +218,10 @@ private String getClientEntryPoint() {\n             Path path = Paths.get(\n                     getEscapedRelativeWebpackPath(webpackConfigPath), TARGET,\n                     INDEX_TS);\n-            String relativePath = String.format(\n-                    \"require('path').resolve(__dirname, '%s')\",\n-                    getEscapedRelativeWebpackPath(path).replaceFirst(\"\\\\.[tj]s$\", \"\"));\n+            String relativePath = formatPathResolve(", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "1c2f6fc8b07a7c9f1b332a4fff6189843ee80b3e"}, "originalPosition": 96}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "9ca5265219ad211123919c4c6d357764280deb28", "author": {"user": {"login": "platosha", "name": "Anton Platonov"}}, "url": "https://github.com/vaadin/flow/commit/9ca5265219ad211123919c4c6d357764280deb28", "committedDate": "2020-09-29T16:03:05Z", "message": "refactor: apply analysis suggessions"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDk4Njk0MjUz", "url": "https://github.com/vaadin/flow/pull/8940#pullrequestreview-498694253", "createdAt": "2020-09-29T16:56:16Z", "commit": {"oid": "9ca5265219ad211123919c4c6d357764280deb28"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yOVQxNjo1NjoxNlrOHZ4FPA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yOVQxNjo1NjoxNlrOHZ4FPA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5Njg5NTI5Mg==", "bodyText": "Remove this use of \"REQUIRE_HOME_NODE_EXECUTABLE\"; it is deprecated.", "url": "https://github.com/vaadin/flow/pull/8940#discussion_r496895292", "createdAt": "2020-09-29T16:56:16Z", "author": {"login": "vaadin-bot"}, "path": "flow-maven-plugin/src/main/java/com/vaadin/flow/plugin/maven/FlowModeAbstractMojo.java", "diffHunk": "@@ -120,22 +129,6 @@\n     @Parameter(property = Constants.REQUIRE_HOME_NODE_EXECUTABLE, defaultValue = \"false\")", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "9ca5265219ad211123919c4c6d357764280deb28"}, "originalPosition": 43}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDk5MTI3ODg0", "url": "https://github.com/vaadin/flow/pull/8940#pullrequestreview-499127884", "createdAt": "2020-09-30T06:48:46Z", "commit": {"oid": "9ca5265219ad211123919c4c6d357764280deb28"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0zMFQwNjo0ODo0NlrOHaPcnQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0zMFQwNjo1NzoxM1rOHaPrZQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NzI3ODEwOQ==", "bodyText": "it doesn't have the filter .filter(key -> !FrontendUtils.INDEX_HTML.equals(key))\nIs this a wrong comment or the filter was accidentally missing?", "url": "https://github.com/vaadin/flow/pull/8940#discussion_r497278109", "createdAt": "2020-09-30T06:48:46Z", "author": {"login": "haijian-vaadin"}, "path": "flow-server/src/main/java/com/vaadin/flow/server/DevModeHandler.java", "diffHunk": "@@ -514,6 +534,41 @@ private void runOnFutureComplete(DeploymentConfiguration config,\n         }\n     }\n \n+    /**\n+     * Get and parse /manifest.json from webpack-dev-server, extracting\n+     * paths to all resources in the webpack output.\n+     *\n+     * Those paths do not necessarily start with /VAADIN, as some resources\n+     * must be served from the root directory, e. g., service worker JS.\n+     *\n+     * @throws IOException\n+     */\n+    private void readManifestPaths() throws IOException {\n+        getLogger().debug(\"Reading manifest.json from webpack\");\n+        HttpURLConnection connection = prepareConnection(\"/manifest.json\",\n+                \"GET\");\n+        int responseCode = connection.getResponseCode();\n+        if (responseCode != HTTP_OK) {\n+            getLogger().error(\"Unable to get manifest.json from \" +\n+                    \"webpack-dev-server, got {} {}\", responseCode,\n+                    connection.getResponseMessage());\n+            return;\n+        }\n+\n+        String content =\n+                FrontendUtils.streamToString(connection.getInputStream());\n+        JsonObject manifest = Json.parse(content);\n+        manifestPaths = Arrays.stream(manifest.keys())\n+                // Skip \"index.html\", as it should go through", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "9ca5265219ad211123919c4c6d357764280deb28"}, "originalPosition": 107}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NzI4MTg5Mw==", "bodyText": "Is there a ticket for this?", "url": "https://github.com/vaadin/flow/pull/8940#discussion_r497281893", "createdAt": "2020-09-30T06:57:13Z", "author": {"login": "haijian-vaadin"}, "path": "flow-server/src/main/java/com/vaadin/flow/server/startup/DevModeInitializer.java", "diffHunk": "@@ -303,8 +304,11 @@ public static void initDevModeHandler(Set<Class<?>> classes,\n                 PACKAGE_JSON);\n \n         // Regenerate webpack configuration, as it may be necessary to update it\n-        builder.withWebpack(builder.npmFolder, FrontendUtils.WEBPACK_CONFIG,\n-                FrontendUtils.WEBPACK_GENERATED);\n+        // TODO: make sure target directories are aligned with build config", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "9ca5265219ad211123919c4c6d357764280deb28"}, "originalPosition": 36}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDk5Mjg4NjA2", "url": "https://github.com/vaadin/flow/pull/8940#pullrequestreview-499288606", "createdAt": "2020-09-30T10:23:45Z", "commit": {"oid": "9ca5265219ad211123919c4c6d357764280deb28"}, "state": "COMMENTED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c06127d240c44f7971547e4e75c39d4470a29f64", "author": {"user": {"login": "platosha", "name": "Anton Platonov"}}, "url": "https://github.com/vaadin/flow/commit/c06127d240c44f7971547e4e75c39d4470a29f64", "committedDate": "2020-09-30T10:35:06Z", "message": "refactor: extract FrontendUtil.parseManifestPaths utility method"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a24161b7728a7cb3b0705b70705e2c79a82d58f7", "author": {"user": {"login": "platosha", "name": "Anton Platonov"}}, "url": "https://github.com/vaadin/flow/commit/a24161b7728a7cb3b0705b70705e2c79a82d58f7", "committedDate": "2020-09-30T10:35:30Z", "message": "test: handling manifest paths in DevModeHanlder and StaticFileServer"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "41e77280c2459af7b3b320e8ee8c3590a9ae8829", "author": {"user": {"login": "platosha", "name": "Anton Platonov"}}, "url": "https://github.com/vaadin/flow/commit/41e77280c2459af7b3b320e8ee8c3590a9ae8829", "committedDate": "2020-09-30T10:51:42Z", "message": "chore: mention issue link in TODO"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDk5MzQzNjY4", "url": "https://github.com/vaadin/flow/pull/8940#pullrequestreview-499343668", "createdAt": "2020-09-30T11:45:49Z", "commit": {"oid": "41e77280c2459af7b3b320e8ee8c3590a9ae8829"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "21dd754caf463287aa7a7d64c7cdd8519987d3db", "author": {"user": {"login": "haijian-vaadin", "name": "Haijian Wang"}}, "url": "https://github.com/vaadin/flow/commit/21dd754caf463287aa7a7d64c7cdd8519987d3db", "committedDate": "2020-09-30T11:47:30Z", "message": "Merge branch 'feature/offline' into haprog/offline/sw-gen"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDk5MzQ5Mzg2", "url": "https://github.com/vaadin/flow/pull/8940#pullrequestreview-499349386", "createdAt": "2020-09-30T11:54:04Z", "commit": {"oid": "21dd754caf463287aa7a7d64c7cdd8519987d3db"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0zMFQxMTo1NDowNFrOHaZ5wQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0zMFQxMTo1NDowNFrOHaZ5wQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NzQ0OTQwOQ==", "bodyText": "Complete the task associated to this TODO comment.", "url": "https://github.com/vaadin/flow/pull/8940#discussion_r497449409", "createdAt": "2020-09-30T11:54:04Z", "author": {"login": "vaadin-bot"}, "path": "flow-server/src/main/java/com/vaadin/flow/server/startup/DevModeInitializer.java", "diffHunk": "@@ -303,8 +304,12 @@ public static void initDevModeHandler(Set<Class<?>> classes,\n                 PACKAGE_JSON);\n \n         // Regenerate webpack configuration, as it may be necessary to update it\n-        builder.withWebpack(builder.npmFolder, FrontendUtils.WEBPACK_CONFIG,\n-                FrontendUtils.WEBPACK_GENERATED);\n+        // TODO: make sure target directories are aligned with build config,", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "21dd754caf463287aa7a7d64c7cdd8519987d3db"}, "originalPosition": 36}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDk5MzQ5Mzk2", "url": "https://github.com/vaadin/flow/pull/8940#pullrequestreview-499349396", "createdAt": "2020-09-30T11:54:05Z", "commit": {"oid": "21dd754caf463287aa7a7d64c7cdd8519987d3db"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0zMFQxMTo1NDowNVrOHaZ5zA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0zMFQxMTo1NDowNVrOHaZ5zA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NzQ0OTQyMA==", "bodyText": "Document the parameter(s): manifestJson", "url": "https://github.com/vaadin/flow/pull/8940#discussion_r497449420", "createdAt": "2020-09-30T11:54:05Z", "author": {"login": "vaadin-bot"}, "path": "flow-server/src/main/java/com/vaadin/flow/server/frontend/FrontendUtils.java", "diffHunk": "@@ -1037,6 +1036,23 @@ public static String commandToString(String baseDir, List<String> command) {\n         return retval.toString();\n     }\n \n+    /**\n+     * Parse \"manifest.json\" file contents obtained from webpack and extract\n+     * the list of request paths to handle as static resources.\n+     *\n+     * @param manifestJson\n+     * @return list of paths, each starting with \"/\"\n+     */\n+    public static List<String> parseManifestPaths(String manifestJson) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "21dd754caf463287aa7a7d64c7cdd8519987d3db"}, "originalPosition": 89}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 138, "cost": 1, "resetAt": "2021-10-28T19:08:13Z"}}}