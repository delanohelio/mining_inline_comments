{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0Mzc2ODc4NTkx", "number": 7625, "title": "Read proxy config from .npmrc file", "bodyText": "Fixes #7567\n\n\nThis change is\u2002", "createdAt": "2020-02-18T22:57:42Z", "url": "https://github.com/vaadin/flow/pull/7625", "merged": true, "mergeCommit": {"oid": "6f5b5d0bc4ed371b07e27a3423e085ecd7d28897"}, "closed": true, "closedAt": "2020-02-20T15:38:26Z", "author": {"login": "mehdi-vaadin"}, "timelineItems": {"totalCount": 21, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcFqDbwAH2gAyMzc2ODc4NTkxOjg5MzY2ZDM4NGMzMWFkMjhjYjUyNzJkYjYyM2E0ZTg5NjAxOWIyZWI=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcGM_D1AFqTM2MjAwNDUwNw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "89366d384c31ad28cb5272db623a4e896019b2eb", "author": {"user": {"login": "mehdi-vaadin", "name": "Mehdi Javan"}}, "url": "https://github.com/vaadin/flow/commit/89366d384c31ad28cb5272db623a4e896019b2eb", "committedDate": "2020-02-18T22:55:28Z", "message": "Read proxy config from .npmrc file"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "0caf8595232c514ff0c9746f4cbc710d59fe9515", "author": {"user": {"login": "mehdi-vaadin", "name": "Mehdi Javan"}}, "url": "https://github.com/vaadin/flow/commit/0caf8595232c514ff0c9746f4cbc710d59fe9515", "committedDate": "2020-02-19T07:50:11Z", "message": "Fix sonar issue"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "5b66ed9f208ad992d44aedeb2a892ca7f5712fcb", "author": {"user": {"login": "mehdi-vaadin", "name": "Mehdi Javan"}}, "url": "https://github.com/vaadin/flow/commit/5b66ed9f208ad992d44aedeb2a892ca7f5712fcb", "committedDate": "2020-02-19T07:53:13Z", "message": "Merge branch 'master' into 7567-proxy-def"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "32bfc4d9048c64141c5a2e93f5cf3fe06f222cc2", "author": {"user": {"login": "mehdi-vaadin", "name": "Mehdi Javan"}}, "url": "https://github.com/vaadin/flow/commit/32bfc4d9048c64141c5a2e93f5cf3fe06f222cc2", "committedDate": "2020-02-19T08:01:50Z", "message": "Fix Javadoc issues"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "5c41e9339bc713353f81df9dd5f43814a6322c09", "author": {"user": {"login": "mehdi-vaadin", "name": "Mehdi Javan"}}, "url": "https://github.com/vaadin/flow/commit/5c41e9339bc713353f81df9dd5f43814a6322c09", "committedDate": "2020-02-19T08:14:31Z", "message": "Add more Javadoc"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzYwOTE1NzQy", "url": "https://github.com/vaadin/flow/pull/7625#pullrequestreview-360915742", "createdAt": "2020-02-19T08:25:49Z", "commit": {"oid": "5c41e9339bc713353f81df9dd5f43814a6322c09"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "24653abb45cf617862712f0a3ad55738a77b2a3e", "author": {"user": {"login": "mehdi-vaadin", "name": "Mehdi Javan"}}, "url": "https://github.com/vaadin/flow/commit/24653abb45cf617862712f0a3ad55738a77b2a3e", "committedDate": "2020-02-19T09:45:24Z", "message": "Add other sources of proxy config"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzYwOTY4MTQ2", "url": "https://github.com/vaadin/flow/pull/7625#pullrequestreview-360968146", "createdAt": "2020-02-19T09:45:56Z", "commit": {"oid": "24653abb45cf617862712f0a3ad55738a77b2a3e"}, "state": "COMMENTED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "843987a1469bba92f8b3def05e1ee1ea53764608", "author": {"user": {"login": "mehdi-vaadin", "name": "Mehdi Javan"}}, "url": "https://github.com/vaadin/flow/commit/843987a1469bba92f8b3def05e1ee1ea53764608", "committedDate": "2020-02-19T11:20:12Z", "message": "Fix compile error"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzYxMDUwMTQ4", "url": "https://github.com/vaadin/flow/pull/7625#pullrequestreview-361050148", "createdAt": "2020-02-19T11:53:17Z", "commit": {"oid": "843987a1469bba92f8b3def05e1ee1ea53764608"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "acda81a836ea7460cd12f373711bcd6d0450bf62", "author": {"user": {"login": "mehdi-vaadin", "name": "Mehdi Javan"}}, "url": "https://github.com/vaadin/flow/commit/acda81a836ea7460cd12f373711bcd6d0450bf62", "committedDate": "2020-02-19T13:48:05Z", "message": "Refactor FrontendUtils.getProxies"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzYxMTIyMjA1", "url": "https://github.com/vaadin/flow/pull/7625#pullrequestreview-361122205", "createdAt": "2020-02-19T13:48:39Z", "commit": {"oid": "843987a1469bba92f8b3def05e1ee1ea53764608"}, "state": "COMMENTED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzYxNjY2MTU4", "url": "https://github.com/vaadin/flow/pull/7625#pullrequestreview-361666158", "createdAt": "2020-02-20T06:51:55Z", "commit": {"oid": "acda81a836ea7460cd12f373711bcd6d0450bf62"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "7c6a5c18405361cf8fa92d01bd01956989f356ec", "author": {"user": {"login": "mehdi-vaadin", "name": "Mehdi Javan"}}, "url": "https://github.com/vaadin/flow/commit/7c6a5c18405361cf8fa92d01bd01956989f356ec", "committedDate": "2020-02-20T12:53:21Z", "message": "Change FrontendUtils.getProxies so it returns all defined proxies"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzYxODc2NzYz", "url": "https://github.com/vaadin/flow/pull/7625#pullrequestreview-361876763", "createdAt": "2020-02-20T12:54:13Z", "commit": {"oid": "7c6a5c18405361cf8fa92d01bd01956989f356ec"}, "state": "COMMENTED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzYxODgxODYx", "url": "https://github.com/vaadin/flow/pull/7625#pullrequestreview-361881861", "createdAt": "2020-02-20T13:02:40Z", "commit": {"oid": "7c6a5c18405361cf8fa92d01bd01956989f356ec"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yMFQxMzowMjo0MFrOFsSdRQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yMFQxMzowMjo0MFrOFsSdRQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MTk4NDA2OQ==", "bodyText": "Found reliance on default encoding in com.vaadin.flow.server.frontend.FrontendUtils.readProxySettingsFromNpmrcFile(String, File): new java.io.FileReader(File)", "url": "https://github.com/vaadin/flow/pull/7625#discussion_r381984069", "createdAt": "2020-02-20T13:02:40Z", "author": {"login": "vaadin-bot"}, "path": "flow-server/src/main/java/com/vaadin/flow/server/frontend/FrontendUtils.java", "diffHunk": "@@ -426,9 +441,118 @@ protected static String installNode(File installDirectory,\n                 .toString();\n     }\n \n-    private static List<ProxyConfig.Proxy> getProxies() {\n-        // TODO: Implement proxy collection #7567\n-        return Collections.emptyList();\n+    /**\n+     * Read list of configured proxies in order from system properties, .npmrc\n+     * file in the project root folder, .npmrc file in user root folder and\n+     * system environment variables.\n+     *\n+     * @param baseDir\n+     *            project root folder.\n+     * @return list of configured proxies\n+     */\n+    // Not private because of test\n+    static List<ProxyConfig.Proxy> getProxies(String baseDir) {\n+        File projectNpmrc = new File(baseDir, \".npmrc\");\n+        File userNpmrc = new File(FileUtils.getUserDirectory(), \".npmrc\");\n+        List<ProxyConfig.Proxy> proxyList = new ArrayList<>();\n+\n+        proxyList.addAll(readProxySettingsFromSystemProperties());\n+        proxyList.addAll(\n+                readProxySettingsFromNpmrcFile(\"project .npmrc\", projectNpmrc));\n+        proxyList.addAll(\n+                readProxySettingsFromNpmrcFile(\"user .npmrc\", userNpmrc));\n+        proxyList.addAll(readProxySettingsFromEnvironmentVariables());\n+\n+        return proxyList;\n+    }\n+\n+    private static List<ProxyConfig.Proxy> readProxySettingsFromNpmrcFile(\n+            String fileDescription, File npmrc) {\n+        if (!npmrc.exists()) {\n+            return Collections.emptyList();\n+        }\n+\n+        try (FileReader fileReader = new FileReader(npmrc)) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "7c6a5c18405361cf8fa92d01bd01956989f356ec"}, "originalPosition": 109}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzYxODg5MzE4", "url": "https://github.com/vaadin/flow/pull/7625#pullrequestreview-361889318", "createdAt": "2020-02-20T13:14:43Z", "commit": {"oid": "7c6a5c18405361cf8fa92d01bd01956989f356ec"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "693f1f8bb41845e02acee05708b4f12f2c3c66ed", "author": {"user": {"login": "mehdi-vaadin", "name": "Mehdi Javan"}}, "url": "https://github.com/vaadin/flow/commit/693f1f8bb41845e02acee05708b4f12f2c3c66ed", "committedDate": "2020-02-20T13:41:20Z", "message": "Add test for no noproxy case"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzYxOTA3Njgx", "url": "https://github.com/vaadin/flow/pull/7625#pullrequestreview-361907681", "createdAt": "2020-02-20T13:41:58Z", "commit": {"oid": "693f1f8bb41845e02acee05708b4f12f2c3c66ed"}, "state": "COMMENTED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzYxOTA4OTM2", "url": "https://github.com/vaadin/flow/pull/7625#pullrequestreview-361908936", "createdAt": "2020-02-20T13:43:38Z", "commit": {"oid": "693f1f8bb41845e02acee05708b4f12f2c3c66ed"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzYyMDA0NTA3", "url": "https://github.com/vaadin/flow/pull/7625#pullrequestreview-362004507", "createdAt": "2020-02-20T15:37:22Z", "commit": {"oid": "693f1f8bb41845e02acee05708b4f12f2c3c66ed"}, "state": "COMMENTED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 702, "cost": 1, "resetAt": "2021-10-28T19:08:13Z"}}}