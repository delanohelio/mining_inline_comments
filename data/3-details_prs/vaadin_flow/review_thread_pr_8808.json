{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDYyNTk0ODQ0", "number": 8808, "reviewThreads": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0wNVQxMzo1NDowNFrOEVbGsg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0wNlQwNzowNToyMFrOEVsbcg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjkwODk5NjM0OnYy", "diffSide": "RIGHT", "path": "flow-server/src/main/java/com/vaadin/flow/server/PwaRegistry.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0wNVQxMzo1NDowNFrOG8Kt8Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0wNVQxMzo1NDowNFrOG8Kt8Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NTc0MzM0NQ==", "bodyText": "I suggest to improve the naming a bit: getUrl -> getResourceUrl, URL logo -> resourceUrl", "url": "https://github.com/vaadin/flow/pull/8808#discussion_r465743345", "createdAt": "2020-08-05T13:54:04Z", "author": {"login": "mshabarov"}, "path": "flow-server/src/main/java/com/vaadin/flow/server/PwaRegistry.java", "diffHunk": "@@ -127,6 +132,19 @@ public PwaRegistry(PWA pwa, ServletContext servletContext)\n         }\n     }\n \n+    private URL getUrl(ServletContext context, String path)", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "7e6709970a9cc96879b6143f69d7bf8c89331b90"}, "originalPosition": 64}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjkwOTAxMDE4OnYy", "diffSide": "RIGHT", "path": "flow-server/src/main/java/com/vaadin/flow/server/PwaRegistry.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0wNVQxMzo1NzoxNVrOG8K2zg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0wNlQwNTo1MjozM1rOG8kQ0A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NTc0NTYxNA==", "bodyText": "Does it make sense to cover this by a test? Just to be sure this workaround won't be removed accidentally.", "url": "https://github.com/vaadin/flow/pull/8808#discussion_r465745614", "createdAt": "2020-08-05T13:57:15Z", "author": {"login": "mshabarov"}, "path": "flow-server/src/main/java/com/vaadin/flow/server/PwaRegistry.java", "diffHunk": "@@ -96,18 +99,20 @@ public PwaRegistry(PWA pwa, ServletContext servletContext)\n \n         // Build pwa elements only if they are enabled\n         if (pwaConfiguration.isEnabled()) {\n-            URL logo = servletContext\n-                    .getResource(pwaConfiguration.relIconPath());\n-            URL offlinePage = servletContext\n-                    .getResource(pwaConfiguration.relOfflinePath());\n+            URL logo = getUrl(servletContext, pwaConfiguration.relIconPath());", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "7e6709970a9cc96879b6143f69d7bf8c89331b90"}, "originalPosition": 41}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NjE2MTg3Mg==", "bodyText": "For many reasons I didn't want to make a test.\nBut let it be ...\nThe test makes impossible to test getting icon resource from servlet context - that was the primary reason.", "url": "https://github.com/vaadin/flow/pull/8808#discussion_r466161872", "createdAt": "2020-08-06T05:52:33Z", "author": {"login": "denis-anisimov"}, "path": "flow-server/src/main/java/com/vaadin/flow/server/PwaRegistry.java", "diffHunk": "@@ -96,18 +99,20 @@ public PwaRegistry(PWA pwa, ServletContext servletContext)\n \n         // Build pwa elements only if they are enabled\n         if (pwaConfiguration.isEnabled()) {\n-            URL logo = servletContext\n-                    .getResource(pwaConfiguration.relIconPath());\n-            URL offlinePage = servletContext\n-                    .getResource(pwaConfiguration.relOfflinePath());\n+            URL logo = getUrl(servletContext, pwaConfiguration.relIconPath());", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NTc0NTYxNA=="}, "originalCommit": {"oid": "7e6709970a9cc96879b6143f69d7bf8c89331b90"}, "originalPosition": 41}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjkxMTc2NjYzOnYy", "diffSide": "RIGHT", "path": "flow-server/src/main/java/com/vaadin/flow/server/PwaRegistry.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0wNlQwNjo0MToyNlrOG8lR0g==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0wNlQwNjo0MToyNlrOG8lR0g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NjE3ODUxNA==", "bodyText": "Rename logo to resourceUrl", "url": "https://github.com/vaadin/flow/pull/8808#discussion_r466178514", "createdAt": "2020-08-06T06:41:26Z", "author": {"login": "mshabarov"}, "path": "flow-server/src/main/java/com/vaadin/flow/server/PwaRegistry.java", "diffHunk": "@@ -127,6 +133,19 @@ public PwaRegistry(PWA pwa, ServletContext servletContext)\n         }\n     }\n \n+    private URL getResourceUrl(ServletContext context, String path)\n+            throws MalformedURLException {\n+        URL logo = context.getResource(path);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "3644226432deb46e4cd141f97979c9c9f13ebda4"}, "originalPosition": 67}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjkxMTgzNDc0OnYy", "diffSide": "RIGHT", "path": "flow-server/src/test/java/com/vaadin/flow/server/PwaRegistryTest.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0wNlQwNzowNToyMFrOG8l67g==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0wNlQwNzowNToyMFrOG8l67g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NjE4OTAzOA==", "bodyText": "Add a comment that this filtered pwaIcon is the custom one, and got from META-INF/resources/icons/icon.png", "url": "https://github.com/vaadin/flow/pull/8808#discussion_r466189038", "createdAt": "2020-08-06T07:05:20Z", "author": {"login": "mshabarov"}, "path": "flow-server/src/test/java/com/vaadin/flow/server/PwaRegistryTest.java", "diffHunk": "@@ -0,0 +1,45 @@\n+/*\n+ * Copyright 2000-2020 Vaadin Ltd.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\"); you may not\n+ * use this file except in compliance with the License. You may obtain a copy of\n+ * the License at\n+ *\n+ * http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS, WITHOUT\n+ * WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied. See the\n+ * License for the specific language governing permissions and limitations under\n+ * the License.\n+ */\n+package com.vaadin.flow.server;\n+\n+import javax.servlet.ServletContext;\n+\n+import java.io.ByteArrayOutputStream;\n+import java.io.IOException;\n+import java.util.List;\n+\n+import org.junit.Assert;\n+import org.junit.Test;\n+import org.mockito.Mockito;\n+\n+@PWA(name = \"foo\", shortName = \"bar\")\n+public class PwaRegistryTest {\n+\n+    @Test\n+    public void pwaIconIsGeneratedBasedOnClasspathIcon_servletContextHasNoResources()\n+            throws IOException {\n+        ServletContext context = Mockito.mock(ServletContext.class);\n+        PwaRegistry registry = new PwaRegistry(\n+                PwaRegistryTest.class.getAnnotation(PWA.class), context);\n+        List<PwaIcon> icons = registry.getIcons();\n+        PwaIcon pwaIcon = icons.stream().filter(icon -> icon.getWidth() == 32)", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "3644226432deb46e4cd141f97979c9c9f13ebda4"}, "originalPosition": 38}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3166, "cost": 1, "resetAt": "2021-11-13T12:26:42Z"}}}