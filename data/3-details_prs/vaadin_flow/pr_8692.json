{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDQ0NDU0NzIz", "number": 8692, "title": "Fix exact item count resolving if scrolled far", "bodyText": "Adds isCountEstimated() to ItemCountChangeEvent.\nIf item count estimate allows the user to scroll way past the exact count,\nDataCommunicator will now resolve the exact count immediately instead of\nreturning 0 items and new size to the client, which would have to keep\nrequesting items until the end was reached.\nFixes #8643", "createdAt": "2020-07-05T20:10:42Z", "url": "https://github.com/vaadin/flow/pull/8692", "merged": true, "mergeCommit": {"oid": "733731055d9467220a786a70fc3bab0e2d7d2ba8"}, "closed": true, "closedAt": "2020-07-06T12:40:24Z", "author": {"login": "pleku"}, "timelineItems": {"totalCount": 7, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcyCx_3gBqjM1MTM2NDY3MDQ=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcyP08ZAFqTQ0MzAwNDUyNw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "1b98877feab6844b2656b228904699fb092b73dc", "author": {"user": {"login": "pleku", "name": "Pekka Hyv\u00f6nen"}}, "url": "https://github.com/vaadin/flow/commit/1b98877feab6844b2656b228904699fb092b73dc", "committedDate": "2020-07-05T20:08:42Z", "message": "Fix exact item count resolving if scrolled far\n\nAdds isCountEstimated() to ItemCountChangeEvent.\n\nIf item count estimate allows the user to scroll way past the exact count,\nDataCommunicator will now resolve the exact count immediately instead of\nreturning 0 items and new size to the client, which would have to keep\nrequesting items until the end was reached.\n\nFixes #8643"}, "afterCommit": {"oid": "8809535f52c83fc2ffeee35643eb00d241a982d9", "author": {"user": {"login": "pleku", "name": "Pekka Hyv\u00f6nen"}}, "url": "https://github.com/vaadin/flow/commit/8809535f52c83fc2ffeee35643eb00d241a982d9", "committedDate": "2020-07-05T20:36:25Z", "message": "Fix exact item count resolving if scrolled far\n\nAdds isCountEstimated() to ItemCountChangeEvent.\n\nIf item count estimate allows the user to scroll way past the exact count,\nDataCommunicator will now resolve the exact count immediately instead of\nreturning 0 items and new size to the client, which would have to keep\nrequesting items until the end was reached.\n\nFixes #8643"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDQyODA5MzE0", "url": "https://github.com/vaadin/flow/pull/8692#pullrequestreview-442809314", "createdAt": "2020-07-06T06:43:19Z", "commit": {"oid": "8809535f52c83fc2ffeee35643eb00d241a982d9"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wNlQwNjo0MzoxOVrOGtKoig==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wNlQwNjo0MzoxOVrOGtKoig==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MDAxMzMyMg==", "bodyText": "Doesn't this break the connector behaviour? Have you tested the grid manually after these changes? I'm a bit worry about the fact that the connector send the requested range to the server, and then the server sends back the data corresponding to another request range (which is shifted by the server). Is that a some kind of optimisation to avoid redundant client-servers interactions?", "url": "https://github.com/vaadin/flow/pull/8692#discussion_r450013322", "createdAt": "2020-07-06T06:43:19Z", "author": {"login": "mshabarov"}, "path": "flow-data/src/main/java/com/vaadin/flow/data/provider/DataCommunicator.java", "diffHunk": "@@ -792,7 +797,20 @@ private void flush() {\n                 // the end has been reached\n                 assumedSize = requestedRange.getStart()\n                         + activation.getActiveKeys().size();\n-                skipSizeCheckUntilReset = true;\n+                skipCountIncreaseUntilReset = true;\n+                /*\n+                 * If the fetch query returned 0 items, it means that the user\n+                 * has scrolled past the end of the exact item count. Instead of\n+                 * returning 0 items to the client and letting it incrementally\n+                 * request for the previous pages, we'll cancel this flush and\n+                 * tweak the requested range and flush again.\n+                 */\n+                if (assumedSize != 0 && activation.getActiveKeys().size() == 0) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "8809535f52c83fc2ffeee35643eb00d241a982d9"}, "originalPosition": 103}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDQyODU2ODk4", "url": "https://github.com/vaadin/flow/pull/8692#pullrequestreview-442856898", "createdAt": "2020-07-06T08:05:07Z", "commit": {"oid": "8c332923dacc076fb3e58a9ee73527f3c1dd84ab"}, "state": "DISMISSED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "aee06073f8fac98757fb41a4300c24f077e6b493", "author": {"user": {"login": "pleku", "name": "Pekka Hyv\u00f6nen"}}, "url": "https://github.com/vaadin/flow/commit/aee06073f8fac98757fb41a4300c24f077e6b493", "committedDate": "2020-07-06T11:34:41Z", "message": "Fix exact item count resolving if scrolled far\n\nAdds isCountEstimated() to ItemCountChangeEvent.\n\nIf item count estimate allows the user to scroll way past the exact count,\nDataCommunicator will now resolve the exact count immediately instead of\nreturning 0 items and new size to the client, which would have to keep\nrequesting items until the end was reached.\n\nFixes #8643"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c6c5a8eaeb12a2fe707be3198d540f8bb9ab1f2a", "author": {"user": {"login": "mshabarov", "name": "Mikhail Shabarov"}}, "url": "https://github.com/vaadin/flow/commit/c6c5a8eaeb12a2fe707be3198d540f8bb9ab1f2a", "committedDate": "2020-07-06T11:34:42Z", "message": "Fix sonar issues"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "8c332923dacc076fb3e58a9ee73527f3c1dd84ab", "author": {"user": {"login": "mshabarov", "name": "Mikhail Shabarov"}}, "url": "https://github.com/vaadin/flow/commit/8c332923dacc076fb3e58a9ee73527f3c1dd84ab", "committedDate": "2020-07-06T08:02:10Z", "message": "Fix sonar issues"}, "afterCommit": {"oid": "c6c5a8eaeb12a2fe707be3198d540f8bb9ab1f2a", "author": {"user": {"login": "mshabarov", "name": "Mikhail Shabarov"}}, "url": "https://github.com/vaadin/flow/commit/c6c5a8eaeb12a2fe707be3198d540f8bb9ab1f2a", "committedDate": "2020-07-06T11:34:42Z", "message": "Fix sonar issues"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDQzMDA0NTI3", "url": "https://github.com/vaadin/flow/pull/8692#pullrequestreview-443004527", "createdAt": "2020-07-06T11:48:42Z", "commit": {"oid": "c6c5a8eaeb12a2fe707be3198d540f8bb9ab1f2a"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 286, "cost": 1, "resetAt": "2021-10-28T19:08:13Z"}}}