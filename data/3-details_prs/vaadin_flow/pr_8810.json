{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDYyNjEwNjAy", "number": 8810, "title": "#7911 Implement Component.isAttached().", "bodyText": "Fixes #7911", "createdAt": "2020-08-04T08:23:45Z", "url": "https://github.com/vaadin/flow/pull/8810", "merged": true, "mergeCommit": {"oid": "f9cfe688f68e5292b3ad6b66879d32ea0a8951e6"}, "closed": true, "closedAt": "2020-08-14T06:26:09Z", "author": {"login": "mvysny"}, "timelineItems": {"totalCount": 9, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABc7iQzCAH2gAyNDYyNjEwNjAyOmVjODYwMjllODM2NGNiZWZhMGY0YTE1OTgwMGI5M2Q2OTM4MmE2NmU=", "endCursor": "Y3Vyc29yOnYyOpPPAAABc-ukSFgFqTQ2NzMzMzYwMQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "ec86029e8364cbefa0f4a159800b93d69382a66e", "author": {"user": {"login": "mvysny", "name": "Martin Vysny"}}, "url": "https://github.com/vaadin/flow/commit/ec86029e8364cbefa0f4a159800b93d69382a66e", "committedDate": "2020-08-04T08:22:44Z", "message": "#7911 Implement Component.isAttached(). Closes #7911"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c6782df485051e014a7b3d7dfb20e2c22a0e48c1", "author": {"user": {"login": "mvysny", "name": "Martin Vysny"}}, "url": "https://github.com/vaadin/flow/commit/c6782df485051e014a7b3d7dfb20e2c22a0e48c1", "committedDate": "2020-08-04T08:26:01Z", "message": "#7911 More tests for Component.isAttached()"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDYwNjY2Njk0", "url": "https://github.com/vaadin/flow/pull/8810#pullrequestreview-460666694", "createdAt": "2020-08-04T09:54:06Z", "commit": {"oid": "c6782df485051e014a7b3d7dfb20e2c22a0e48c1"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0wNFQwOTo1NDowNlrOG7Zerw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0wNFQwOTo1NDowNlrOG7Zerw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NDkzNjYyMw==", "bodyText": "Wouldn't it be more logical that the component isn't attached anymore when the UI is closed / removed?", "url": "https://github.com/vaadin/flow/pull/8810#discussion_r464936623", "createdAt": "2020-08-04T09:54:06Z", "author": {"login": "knoobie"}, "path": "flow-server/src/test/java/com/vaadin/flow/component/ComponentTest.java", "diffHunk": "@@ -757,6 +757,51 @@ public void testSecondAttach() {\n         Assert.assertFalse(initialAttach.get());\n     }\n \n+    /**\n+     * Tests {@link Component#isAttached}.\n+     */\n+    @Test\n+    public void testIsAttached() {\n+        UI ui = new UI();\n+        // ui is always attached\n+        Assert.assertTrue(ui.isAttached());\n+\n+        TestComponentContainer parent = new TestComponentContainer();\n+        TestComponentContainer child = new TestComponentContainer();\n+        TestComponent grandChild = new TestComponent();\n+        child.track();\n+        grandChild.addAttachListener(\n+                event -> Assert.assertTrue(grandChild.isAttached()));\n+        grandChild.addDetachListener(\n+                event -> grandChild.getDetachEvents().incrementAndGet());\n+\n+        parent.add(child);\n+        child.add(grandChild);\n+        Assert.assertFalse(parent.isAttached());\n+        Assert.assertFalse(child.isAttached());\n+        Assert.assertFalse(grandChild.isAttached());\n+\n+        ui.add(parent);\n+        Assert.assertTrue(parent.isAttached());\n+        Assert.assertTrue(child.isAttached());\n+        Assert.assertTrue(grandChild.isAttached());\n+\n+        ui.remove(parent);\n+        Assert.assertFalse(parent.isAttached());\n+        Assert.assertFalse(child.isAttached());\n+        Assert.assertFalse(grandChild.isAttached());\n+\n+        ui.add(parent);\n+        Assert.assertTrue(parent.isAttached());\n+        Assert.assertTrue(child.isAttached());\n+        Assert.assertTrue(grandChild.isAttached());\n+\n+        ui.close();\n+        Assert.assertTrue(parent.isAttached());", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c6782df485051e014a7b3d7dfb20e2c22a0e48c1"}, "originalPosition": 44}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDY1NzMyNzI5", "url": "https://github.com/vaadin/flow/pull/8810#pullrequestreview-465732729", "createdAt": "2020-08-12T09:11:47Z", "commit": {"oid": "c6782df485051e014a7b3d7dfb20e2c22a0e48c1"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xMlQwOToxMTo0N1rOG_Yvbw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xMlQwOToxNzoxNVrOG_Y8YQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2OTExODgzMQ==", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                    ui.close();\n          \n          \n            \n                    Assert.assertTrue(parent.isAttached());\n          \n          \n            \n                    Assert.assertTrue(child.isAttached());\n          \n          \n            \n                    Assert.assertTrue(grandChild.isAttached());\n          \n          \n            \n                    // Mock closing of UI after request handled\n          \n          \n            \n                    ui.getInternals().setSession(Mockito.mock(VaadinSession.class));\n          \n          \n            \n                    ui.close();\n          \n          \n            \n                    ui.getInternals().setSession(null);\n          \n          \n            \n            \n          \n          \n            \n                    Assert.assertFalse(parent.isAttached());\n          \n          \n            \n                    Assert.assertFalse(child.isAttached());\n          \n          \n            \n                    Assert.assertFalse(grandChild.isAttached());", "url": "https://github.com/vaadin/flow/pull/8810#discussion_r469118831", "createdAt": "2020-08-12T09:11:47Z", "author": {"login": "caalador"}, "path": "flow-server/src/test/java/com/vaadin/flow/component/ComponentTest.java", "diffHunk": "@@ -757,6 +757,51 @@ public void testSecondAttach() {\n         Assert.assertFalse(initialAttach.get());\n     }\n \n+    /**\n+     * Tests {@link Component#isAttached}.\n+     */\n+    @Test\n+    public void testIsAttached() {\n+        UI ui = new UI();\n+        // ui is always attached\n+        Assert.assertTrue(ui.isAttached());\n+\n+        TestComponentContainer parent = new TestComponentContainer();\n+        TestComponentContainer child = new TestComponentContainer();\n+        TestComponent grandChild = new TestComponent();\n+        child.track();\n+        grandChild.addAttachListener(\n+                event -> Assert.assertTrue(grandChild.isAttached()));\n+        grandChild.addDetachListener(\n+                event -> grandChild.getDetachEvents().incrementAndGet());\n+\n+        parent.add(child);\n+        child.add(grandChild);\n+        Assert.assertFalse(parent.isAttached());\n+        Assert.assertFalse(child.isAttached());\n+        Assert.assertFalse(grandChild.isAttached());\n+\n+        ui.add(parent);\n+        Assert.assertTrue(parent.isAttached());\n+        Assert.assertTrue(child.isAttached());\n+        Assert.assertTrue(grandChild.isAttached());\n+\n+        ui.remove(parent);\n+        Assert.assertFalse(parent.isAttached());\n+        Assert.assertFalse(child.isAttached());\n+        Assert.assertFalse(grandChild.isAttached());\n+\n+        ui.add(parent);\n+        Assert.assertTrue(parent.isAttached());\n+        Assert.assertTrue(child.isAttached());\n+        Assert.assertTrue(grandChild.isAttached());\n+\n+        ui.close();\n+        Assert.assertTrue(parent.isAttached());\n+        Assert.assertTrue(child.isAttached());\n+        Assert.assertTrue(grandChild.isAttached());", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c6782df485051e014a7b3d7dfb20e2c22a0e48c1"}, "originalPosition": 46}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2OTEyMDcwNA==", "bodyText": "This can also be true if the UI has \"detached\" (e.g. closed and removed from the session)", "url": "https://github.com/vaadin/flow/pull/8810#discussion_r469120704", "createdAt": "2020-08-12T09:14:56Z", "author": {"login": "caalador"}, "path": "flow-server/src/main/java/com/vaadin/flow/component/Component.java", "diffHunk": "@@ -451,6 +451,17 @@ protected void onDetach(DetachEvent detachEvent) {\n         // NOOP by default\n     }\n \n+    /**\n+     * Checks whether this component is currently attached to a UI.\n+     * <p>\n+     * Returns true for attached components even if the UI itself is closed.\n+     *\n+     * @return true if the component is attached to an UI.", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c6782df485051e014a7b3d7dfb20e2c22a0e48c1"}, "originalPosition": 9}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2OTEyMjE0NQ==", "bodyText": "UI is always initially attached as it is the root node, but it can be \"detached\" as is the case in the final assert with the fixes mock close of the UI.", "url": "https://github.com/vaadin/flow/pull/8810#discussion_r469122145", "createdAt": "2020-08-12T09:17:15Z", "author": {"login": "caalador"}, "path": "flow-server/src/test/java/com/vaadin/flow/component/ComponentTest.java", "diffHunk": "@@ -757,6 +757,51 @@ public void testSecondAttach() {\n         Assert.assertFalse(initialAttach.get());\n     }\n \n+    /**\n+     * Tests {@link Component#isAttached}.\n+     */\n+    @Test\n+    public void testIsAttached() {\n+        UI ui = new UI();\n+        // ui is always attached", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c6782df485051e014a7b3d7dfb20e2c22a0e48c1"}, "originalPosition": 10}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "069a1a722bbfe74a10abc1cfb157a8d0789345df", "author": {"user": {"login": "mvysny", "name": "Martin Vysny"}}, "url": "https://github.com/vaadin/flow/commit/069a1a722bbfe74a10abc1cfb157a8d0789345df", "committedDate": "2020-08-12T09:47:47Z", "message": "Update flow-server/src/test/java/com/vaadin/flow/component/ComponentTest.java\n\nCo-authored-by: caalador <mikael.grankvist@gmail.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "8d2b2e36702435e2501987c764727119ca3c906c", "author": {"user": {"login": "mvysny", "name": "Martin Vysny"}}, "url": "https://github.com/vaadin/flow/commit/8d2b2e36702435e2501987c764727119ca3c906c", "committedDate": "2020-08-12T09:53:10Z", "message": "Fixed ComponentTest"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "01ac66b520e0685340bd54f5beaeb9afd3070f93", "author": {"user": {"login": "mvysny", "name": "Martin Vysny"}}, "url": "https://github.com/vaadin/flow/commit/01ac66b520e0685340bd54f5beaeb9afd3070f93", "committedDate": "2020-08-12T10:09:50Z", "message": "Improved javadoc of Component.isAttached()"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "d7d90847730d680afb1e84911cb615b1faa3099b", "author": {"user": {"login": "mvysny", "name": "Martin Vysny"}}, "url": "https://github.com/vaadin/flow/commit/d7d90847730d680afb1e84911cb615b1faa3099b", "committedDate": "2020-08-14T05:32:22Z", "message": "Update flow-server/src/main/java/com/vaadin/flow/component/Component.java\n\nCo-authored-by: caalador <mikael.grankvist@gmail.com>"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDY3MzMzNjAx", "url": "https://github.com/vaadin/flow/pull/8810#pullrequestreview-467333601", "createdAt": "2020-08-14T06:24:39Z", "commit": {"oid": "d7d90847730d680afb1e84911cb615b1faa3099b"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 63, "cost": 1, "resetAt": "2021-10-28T19:08:13Z"}}}