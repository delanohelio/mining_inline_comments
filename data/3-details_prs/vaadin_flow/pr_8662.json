{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDQyMDY2ODM5", "number": 8662, "title": "Use ItemCount instead of size and RowCount #8651", "bodyText": "Part of #8651", "createdAt": "2020-06-30T14:22:53Z", "url": "https://github.com/vaadin/flow/pull/8662", "merged": true, "mergeCommit": {"oid": "3c14f824d0fb972a078dfe0a73f2dddf9770c4ba"}, "closed": true, "closedAt": "2020-07-01T19:07:54Z", "author": {"login": "mshabarov"}, "timelineItems": {"totalCount": 9, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcwXbrrAH2gAyNDQyMDY2ODM5OjEyOWI2MmM2MTkzMmM4YmI3ZTBjY2RjNTU2NGRmZjM4MzI5ZDQwMGI=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcwm75oAFqTQ0MDcwNjkzOA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "129b62c61932c8bb7e0ccdc5564dff38329d400b", "author": {"user": {"login": "mshabarov", "name": "Mikhail Shabarov"}}, "url": "https://github.com/vaadin/flow/commit/129b62c61932c8bb7e0ccdc5564dff38329d400b", "committedDate": "2020-06-30T15:32:30Z", "message": "Use ItemCount instead of size and RowCount #8651"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "4dafd0a3f85ec24886e1e39a662556ab2ee483d9", "author": {"user": {"login": "mshabarov", "name": "Mikhail Shabarov"}}, "url": "https://github.com/vaadin/flow/commit/4dafd0a3f85ec24886e1e39a662556ab2ee483d9", "committedDate": "2020-06-30T15:42:32Z", "message": "HasLazyDataViewTest fix"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "05853aac9229f311cf5e0c2fe377eb34a66a41f8", "author": {"user": {"login": "mshabarov", "name": "Mikhail Shabarov"}}, "url": "https://github.com/vaadin/flow/commit/05853aac9229f311cf5e0c2fe377eb34a66a41f8", "committedDate": "2020-06-30T14:22:01Z", "message": "Use ItemCount instead of size and RowCount #8651"}, "afterCommit": {"oid": "4dafd0a3f85ec24886e1e39a662556ab2ee483d9", "author": {"user": {"login": "mshabarov", "name": "Mikhail Shabarov"}}, "url": "https://github.com/vaadin/flow/commit/4dafd0a3f85ec24886e1e39a662556ab2ee483d9", "committedDate": "2020-06-30T15:42:32Z", "message": "HasLazyDataViewTest fix"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "dff3421e97f889d4b415351ae7a6f3b047f9dec1", "author": {"user": {"login": "mshabarov", "name": "Mikhail Shabarov"}}, "url": "https://github.com/vaadin/flow/commit/dff3421e97f889d4b415351ae7a6f3b047f9dec1", "committedDate": "2020-06-30T15:49:33Z", "message": "Check the size via datacommunicator API"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDQwMTk4NjQ0", "url": "https://github.com/vaadin/flow/pull/8662#pullrequestreview-440198644", "createdAt": "2020-06-30T16:40:28Z", "commit": {"oid": "dff3421e97f889d4b415351ae7a6f3b047f9dec1"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 14, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0zMFQxNjo0MDoyOFrOGrFLoQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0zMFQxNzowOTowN1rOGrGVTw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NzgyNjg0OQ==", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n             * Event describing the data item count change for a component data set.\n          \n          \n            \n             * Event describing the item count change for a component.", "url": "https://github.com/vaadin/flow/pull/8662#discussion_r447826849", "createdAt": "2020-06-30T16:40:28Z", "author": {"login": "pleku"}, "path": "flow-data/src/main/java/com/vaadin/flow/data/provider/ItemCountChangeEvent.java", "diffHunk": "@@ -19,37 +19,34 @@\n import com.vaadin.flow.component.ComponentEvent;\n \n /**\n- * Event describing the data size change for a component data set.\n- * The SizeChangedEvent will fired from beforeClientResponse so changes done\n- * during the server round trip will only receive one event.\n+ * Event describing the data item count change for a component data set.", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "dff3421e97f889d4b415351ae7a6f3b047f9dec1"}, "originalPosition": 7}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NzgyOTExNA==", "bodyText": "The ItemCountChangedEvent will fired from beforeClientResponse so changes\n\nI think this means absolutely nothing for majority of the users so should be fixed since you're touching the line", "url": "https://github.com/vaadin/flow/pull/8662#discussion_r447829114", "createdAt": "2020-06-30T16:43:49Z", "author": {"login": "pleku"}, "path": "flow-data/src/main/java/com/vaadin/flow/data/provider/ItemCountChangeEvent.java", "diffHunk": "@@ -19,37 +19,34 @@\n import com.vaadin.flow.component.ComponentEvent;\n \n /**\n- * Event describing the data size change for a component data set.\n- * The SizeChangedEvent will fired from beforeClientResponse so changes done\n- * during the server round trip will only receive one event.\n+ * Event describing the data item count change for a component data set.\n+ * The ItemCountChangedEvent will fired from beforeClientResponse so changes", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "dff3421e97f889d4b415351ae7a6f3b047f9dec1"}, "originalPosition": 8}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NzgzMTE2OA==", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n             * Listener interface for getting updates on data item count changes. The\n          \n          \n            \n             * Listener interface for getting updates on item count changes. The", "url": "https://github.com/vaadin/flow/pull/8662#discussion_r447831168", "createdAt": "2020-06-30T16:47:02Z", "author": {"login": "pleku"}, "path": "flow-data/src/main/java/com/vaadin/flow/data/provider/ItemCountChangeListener.java", "diffHunk": "@@ -18,24 +18,24 @@\n import java.io.Serializable;\n \n /**\n- * Listener interface for getting updates on data set size changes. The\n- * sizeChanged method will be called on beforeClientResponse so changes done\n+ * Listener interface for getting updates on data item count changes. The", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "dff3421e97f889d4b415351ae7a6f3b047f9dec1"}, "originalPosition": 6}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NzgzMTQyNQ==", "bodyText": "Again, \"called on beforeClientResponse\" really means nothing to the majority of the users", "url": "https://github.com/vaadin/flow/pull/8662#discussion_r447831425", "createdAt": "2020-06-30T16:47:28Z", "author": {"login": "pleku"}, "path": "flow-data/src/main/java/com/vaadin/flow/data/provider/ItemCountChangeListener.java", "diffHunk": "@@ -18,24 +18,24 @@\n import java.io.Serializable;\n \n /**\n- * Listener interface for getting updates on data set size changes. The\n- * sizeChanged method will be called on beforeClientResponse so changes done\n+ * Listener interface for getting updates on data item count changes. The\n+ * itemCountChanged method will be called on beforeClientResponse so changes done", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "dff3421e97f889d4b415351ae7a6f3b047f9dec1"}, "originalPosition": 7}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NzgzMTgwMg==", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                 * (items) in the backend. Use this when it is cheap to get the exact item\n          \n          \n            \n                 * in the backend. Use this when it is cheap to get the exact item", "url": "https://github.com/vaadin/flow/pull/8662#discussion_r447831802", "createdAt": "2020-06-30T16:48:04Z", "author": {"login": "pleku"}, "path": "flow-data/src/main/java/com/vaadin/flow/data/provider/LazyDataView.java", "diffHunk": "@@ -25,7 +25,7 @@\n public interface LazyDataView<T> extends DataView<T> {\n \n     /**\n-     * Sets a callback that the component uses to get the exact rows count\n+     * Sets a callback that the component uses to get the exact item count\n      * (items) in the backend. Use this when it is cheap to get the exact item", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "dff3421e97f889d4b415351ae7a6f3b047f9dec1"}, "originalPosition": 6}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NzgzMzUzNg==", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                 * Get the full data item count with filters if any set. As the item count\n          \n          \n            \n                 * Get the full item count with filters if any set. As the item count", "url": "https://github.com/vaadin/flow/pull/8662#discussion_r447833536", "createdAt": "2020-06-30T16:50:49Z", "author": {"login": "pleku"}, "path": "flow-data/src/main/java/com/vaadin/flow/data/provider/ListDataView.java", "diffHunk": "@@ -34,6 +35,17 @@\n  */\n public interface ListDataView<T, V extends ListDataView<T, ?>>\n         extends DataView<T> {\n+    /**\n+     * Get the full data item count with filters if any set. As the item count", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "dff3421e97f889d4b415351ae7a6f3b047f9dec1"}, "originalPosition": 13}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NzgzNDgyNA==", "bodyText": "This will need fixing in #8655 as I supposed it now works by accident since the filters go to the data provider", "url": "https://github.com/vaadin/flow/pull/8662#discussion_r447834824", "createdAt": "2020-06-30T16:52:47Z", "author": {"login": "pleku"}, "path": "flow-data/src/main/java/com/vaadin/flow/data/provider/AbstractListDataView.java", "diffHunk": "@@ -67,6 +67,11 @@ public AbstractListDataView(\n         super(dataProviderSupplier, component);\n     }\n \n+    @Override\n+    public int getItemCount() {\n+        return getDataProvider().size(new Query<>());", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "dff3421e97f889d4b415351ae7a6f3b047f9dec1"}, "originalPosition": 6}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NzgzNjI0NA==", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                 * Add an item count change listener that is fired when the data item\n          \n          \n            \n                 * Add an item count change listener that is fired when the item", "url": "https://github.com/vaadin/flow/pull/8662#discussion_r447836244", "createdAt": "2020-06-30T16:55:00Z", "author": {"login": "pleku"}, "path": "flow-data/src/main/java/com/vaadin/flow/data/provider/DataView.java", "diffHunk": "@@ -78,19 +67,19 @@\n     boolean contains(T item);\n \n     /**\n-     * Add a size change listener that is fired when the data set size changes.\n-     * This can happen for instance when filtering the data set.\n+     * Add an item count change listener that is fired when the data item", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "dff3421e97f889d4b415351ae7a6f3b047f9dec1"}, "originalPosition": 24}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NzgzODg1Ng==", "bodyText": "You should refactor this instead to use ItemCountChangeListener to verify the correct size", "url": "https://github.com/vaadin/flow/pull/8662#discussion_r447838856", "createdAt": "2020-06-30T16:58:56Z", "author": {"login": "pleku"}, "path": "flow-data/src/test/java/com/vaadin/flow/data/provider/AbstractLazyDataViewTest.java", "diffHunk": "@@ -160,57 +160,6 @@ public void contains_itemsNotFetched_canCheckForItemWithBeforeClientResponse() {\n                 capturedContains.get());\n     }\n \n-    @Test\n-    public void size_withDefinedSize() {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "dff3421e97f889d4b415351ae7a6f3b047f9dec1"}, "originalPosition": 48}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NzgzODkxNw==", "bodyText": "You should refactor this instead to use ItemCountChangeListener to verify the correct size", "url": "https://github.com/vaadin/flow/pull/8662#discussion_r447838917", "createdAt": "2020-06-30T16:59:01Z", "author": {"login": "pleku"}, "path": "flow-data/src/test/java/com/vaadin/flow/data/provider/AbstractLazyDataViewTest.java", "diffHunk": "@@ -160,57 +160,6 @@ public void contains_itemsNotFetched_canCheckForItemWithBeforeClientResponse() {\n                 capturedContains.get());\n     }\n \n-    @Test\n-    public void size_withDefinedSize() {\n-        dataCommunicator.setRequestedRange(0, 50);\n-        Assert.assertEquals(\"Invalid size reported\", 3, dataView.getSize());\n-\n-        dataView.setRowCountCallback(query -> 5);\n-\n-        Assert.assertEquals(\"Invalid size reported\", 5, dataView.getSize());\n-    }\n-\n-    @Test\n-    public void size_withUndefinedSize() {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "dff3421e97f889d4b415351ae7a6f3b047f9dec1"}, "originalPosition": 58}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0Nzg0MzA2MQ==", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                public void setSizeCallback_itemCountEstimatesWereSet_overridesItemCountEstimates() {\n          \n          \n            \n                public void setCountCallback_itemCountEstimatesWereSet_overridesItemCountEstimates() {", "url": "https://github.com/vaadin/flow/pull/8662#discussion_r447843061", "createdAt": "2020-06-30T17:05:23Z", "author": {"login": "pleku"}, "path": "flow-data/src/test/java/com/vaadin/flow/data/provider/DataCommunicatorTest.java", "diffHunk": "@@ -393,23 +393,23 @@ public void setSizeCallback_null_throws() {\n     }\n \n     @Test\n-    public void setSizeCallback_rowCountEstimatesWereSet_overridesRowCountEstimates() {\n+    public void setSizeCallback_itemCountEstimatesWereSet_overridesItemCountEstimates() {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "dff3421e97f889d4b415351ae7a6f3b047f9dec1"}, "originalPosition": 5}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0Nzg0NDM3NA==", "bodyText": "Tests names in this class could refer to CountEstimate too instead of sizeEstimate", "url": "https://github.com/vaadin/flow/pull/8662#discussion_r447844374", "createdAt": "2020-06-30T17:07:00Z", "author": {"login": "pleku"}, "path": "flow-data/src/test/java/com/vaadin/flow/data/provider/DataCommunicatorTest.java", "diffHunk": "@@ -438,7 +438,7 @@ public void setInitialSizeEstimate_usedInitiallyThenDiscarded() {\n         dataCommunicator.setDataProvider(dataProvider, null);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "dff3421e97f889d4b415351ae7a6f3b047f9dec1"}, "originalPosition": 31}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0Nzg0NTQxMA==", "bodyText": "I would rename this method now too", "url": "https://github.com/vaadin/flow/pull/8662#discussion_r447845410", "createdAt": "2020-06-30T17:08:33Z", "author": {"login": "pleku"}, "path": "flow-data/src/main/java/com/vaadin/flow/data/provider/DataCommunicator.java", "diffHunk": "@@ -782,21 +782,21 @@ private void flush() {\n     }\n \n     /**\n-     * Fire a size change event if the last event was fired for a different size\n-     * from the last sent one.\n+     * Fire a item count change event if the last event was fired for a\n+     * different size from the last sent one.\n      *\n-     * @param dataSize\n-     *            data size to send\n+     * @param itemCount\n+     *            data item count to send\n      */\n-    private void fireSizeEvent(int dataSize) {\n-        if (lastSent != dataSize) {\n+    private void fireSizeEvent(int itemCount) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "dff3421e97f889d4b415351ae7a6f3b047f9dec1"}, "originalPosition": 171}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0Nzg0NTcxMQ==", "bodyText": "The getDataSize method should be renamed too", "url": "https://github.com/vaadin/flow/pull/8662#discussion_r447845711", "createdAt": "2020-06-30T17:09:07Z", "author": {"login": "pleku"}, "path": "flow-data/src/main/java/com/vaadin/flow/data/provider/DataCommunicator.java", "diffHunk": "@@ -397,79 +397,79 @@ public void setCountCallback(\n     }\n \n     /**\n-     * Sets the row count estimate to use and switches component to undefined\n+     * Sets the item count estimate to use and switches component to undefined\n      * size. Any previously set count callback is cleared. The new estimate is\n      * applied if the actual count has not been discovered and if the estimate\n      * is greater than the number of requested items. Otherwise it is not\n      * applied until there has been a reset.\n      * <p>\n-     * <em>NOTE:</em> setting row count estimate that is less than two pages\n+     * <em>NOTE:</em> setting item count estimate that is less than two pages\n      * (set with {@link #setPageSize(int)}) can cause extra requests initially\n      * or after a reset.\n      * \n-     * @param rowCountEstimate\n-     *            the row count estimate to be used\n+     * @param itemCountEstimate\n+     *            the item count estimate to be used\n      */\n-    public void setRowCountEstimate(int rowCountEstimate) {\n-        if (rowCountEstimate < 1) {\n+    public void setItemCountEstimate(int itemCountEstimate) {\n+        if (itemCountEstimate < 1) {\n             throw new IllegalArgumentException(\n-                    \"Given row count estimate cannot be less than 1.\");\n+                    \"Given item count estimate cannot be less than 1.\");\n         }\n-        this.rowCountEstimate = rowCountEstimate;\n+        this.itemCountEstimate = itemCountEstimate;\n         this.countCallback = null;\n         definedSize = false;\n         if (!skipSizeCheckUntilReset\n-                && requestedRange.getEnd() < rowCountEstimate) {\n+                && requestedRange.getEnd() < itemCountEstimate) {\n             sizeReset = true;\n             requestFlush();\n         }\n     }\n ", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "dff3421e97f889d4b415351ae7a6f3b047f9dec1"}, "originalPosition": 51}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "44bb49b24765b127cc5d29d48d53191b772f5f7b", "author": {"user": {"login": "mshabarov", "name": "Mikhail Shabarov"}}, "url": "https://github.com/vaadin/flow/commit/44bb49b24765b127cc5d29d48d53191b772f5f7b", "committedDate": "2020-07-01T08:14:01Z", "message": "Fix naming and refactor the tests"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a740e5b8a5bc676a79c1b024bcc7173d43d4d85f", "author": {"user": {"login": "mshabarov", "name": "Mikhail Shabarov"}}, "url": "https://github.com/vaadin/flow/commit/a740e5b8a5bc676a79c1b024bcc7173d43d4d85f", "committedDate": "2020-07-01T08:43:37Z", "message": "Improve item count change event javadoc"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDQwNjgzODMw", "url": "https://github.com/vaadin/flow/pull/8662#pullrequestreview-440683830", "createdAt": "2020-07-01T09:05:29Z", "commit": {"oid": "a740e5b8a5bc676a79c1b024bcc7173d43d4d85f"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wMVQwOTowNToyOVrOGrdbnw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wMVQwOTowNToyOVrOGrdbnw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0ODIyNDE1OQ==", "bodyText": "Complete the task associated to this TODO comment.", "url": "https://github.com/vaadin/flow/pull/8662#discussion_r448224159", "createdAt": "2020-07-01T09:05:29Z", "author": {"login": "vaadin-bot"}, "path": "flow-data/src/main/java/com/vaadin/flow/data/provider/DataCommunicator.java", "diffHunk": "@@ -284,12 +284,12 @@ public void confirmUpdate(int updateId) {\n     }\n \n     /**\n-     * This is the latest DataProvider size informed to the client or fetched\n-     * from the DataProvider if client data has not been sent.\n+     * This is the latest DataProvider item count informed to the client or\n+     * fetched from the DataProvider if client data has not been sent.\n      *\n-     * @return size of available data\n+     * @return count of available items\n      */\n-    public int getDataSize() {\n+    public int getItemCount() {\n         if (isDefinedSize()\n                 && (resendEntireRange || assumeEmptyClient || sizeReset)) {\n             // TODO it could be possible to cache the value returned here", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "a740e5b8a5bc676a79c1b024bcc7173d43d4d85f"}, "originalPosition": 27}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDQwNzA2OTM4", "url": "https://github.com/vaadin/flow/pull/8662#pullrequestreview-440706938", "createdAt": "2020-07-01T09:36:16Z", "commit": {"oid": "a740e5b8a5bc676a79c1b024bcc7173d43d4d85f"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 247, "cost": 1, "resetAt": "2021-10-28T19:08:13Z"}}}