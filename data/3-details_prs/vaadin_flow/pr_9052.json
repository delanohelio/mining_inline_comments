{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDkxNjIxNDE4", "number": 9052, "title": "Skip data provider verification in AbstractDataView if default one is used", "bodyText": "Fixes #8583", "createdAt": "2020-09-23T08:53:57Z", "url": "https://github.com/vaadin/flow/pull/9052", "merged": true, "mergeCommit": {"oid": "f374da0beb141961ee428fe4616c868abf4099ed"}, "closed": true, "closedAt": "2020-09-29T10:50:41Z", "author": {"login": "mshabarov"}, "timelineItems": {"totalCount": 5, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdLom-1gH2gAyNDkxNjIxNDE4OjNjZWM0NTU3YzdlNzU1YWUxZDFhMGYwMGFjMWNlNzg2ZjNmZmU1NTM=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdNl4tmgFqTQ5ODM0MTExMg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "3cec4557c7e755ae1d1a0f00ac1ce786f3ffe553", "author": {"user": {"login": "mshabarov", "name": "Mikhail Shabarov"}}, "url": "https://github.com/vaadin/flow/commit/3cec4557c7e755ae1d1a0f00ac1ce786f3ffe553", "committedDate": "2020-09-23T08:49:11Z", "message": "Skip data provider verification in AbstractDataView if default one is used in data communicator"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDk0NDY3MjE4", "url": "https://github.com/vaadin/flow/pull/9052#pullrequestreview-494467218", "createdAt": "2020-09-23T09:24:03Z", "commit": {"oid": "3cec4557c7e755ae1d1a0f00ac1ce786f3ffe553"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yM1QwOToyNDowM1rOHWgayg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yM1QwOTo0ODozNVrOHWh46Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MzM2MTg2Ng==", "bodyText": "This should be before instance variables, and any static variables too", "url": "https://github.com/vaadin/flow/pull/9052#discussion_r493361866", "createdAt": "2020-09-23T09:24:03Z", "author": {"login": "pleku"}, "path": "flow-data/src/main/java/com/vaadin/flow/data/provider/DataCommunicator.java", "diffHunk": "@@ -648,6 +648,30 @@ public void setPagingEnabled(boolean pagingEnabled) {\n         this.pagingEnabled = pagingEnabled;\n     }\n \n+    /**\n+     * In-memory data provider with no items.\n+     * <p>\n+     * Data Communicator is initialised with this data provider by default\n+     * until a new data provider is assigned with\n+     * {@link #setDataProvider(DataProvider, Object)}.\n+     * <p>\n+     * This type of data provider signals to data view to skip the data\n+     * provider verification on data view instantiation phase, so as to\n+     * support generic API for lazy loading case (add item count listener,\n+     * for instance), even if no backend data provider set by user.\n+     *\n+     * @param <T1> item type\n+     */\n+    static final class EmptyDataProvider<T1> extends ListDataProvider<T1> {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "3cec4557c7e755ae1d1a0f00ac1ce786f3ffe553"}, "originalPosition": 27}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MzM4NDA5Mg==", "bodyText": "NIT: it feels like this is documented now in two places, abstract data view and here, IMO this is a bit excessive and one would have sufficed with a comment // see xyz for the other place", "url": "https://github.com/vaadin/flow/pull/9052#discussion_r493384092", "createdAt": "2020-09-23T09:46:34Z", "author": {"login": "pleku"}, "path": "flow-data/src/main/java/com/vaadin/flow/data/provider/DataCommunicator.java", "diffHunk": "@@ -648,6 +648,30 @@ public void setPagingEnabled(boolean pagingEnabled) {\n         this.pagingEnabled = pagingEnabled;\n     }\n \n+    /**\n+     * In-memory data provider with no items.\n+     * <p>\n+     * Data Communicator is initialised with this data provider by default\n+     * until a new data provider is assigned with\n+     * {@link #setDataProvider(DataProvider, Object)}.\n+     * <p>\n+     * This type of data provider signals to data view to skip the data\n+     * provider verification on data view instantiation phase, so as to\n+     * support generic API for lazy loading case (add item count listener,\n+     * for instance), even if no backend data provider set by user.", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "3cec4557c7e755ae1d1a0f00ac1ce786f3ffe553"}, "originalPosition": 23}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MzM4NTk2MQ==", "bodyText": "This documentation (and the other duplicate in the empty data provider) is missing the part that in-memory data view API is supported without explicitly setting the data provider. Since you're documenting the usage, might add that too", "url": "https://github.com/vaadin/flow/pull/9052#discussion_r493385961", "createdAt": "2020-09-23T09:48:35Z", "author": {"login": "pleku"}, "path": "flow-data/src/main/java/com/vaadin/flow/data/provider/AbstractDataView.java", "diffHunk": "@@ -56,13 +56,27 @@ public AbstractDataView(\n                 \"DataProvider supplier cannot be null\");\n         this.dataProviderSupplier = dataProviderSupplier;\n         this.component = component;\n-        verifyDataProviderType(dataProviderSupplier.get().getClass());\n+        final Class<?> dataProviderType = dataProviderSupplier.get().getClass();\n+        /*\n+         * Skip verification if the verified data provider has not been\n+         * initialized yet.\n+         * This mainly refers to the following cases:\n+         * 1. Component uses data communicator which initialises data provider\n+         * lazily and meanwhile has a default empty one. Good example is a\n+         * ComboBox.\n+         * 2. Developer wants to set the ItemCountChangeListener before the data\n+         * provider has been set.", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "3cec4557c7e755ae1d1a0f00ac1ce786f3ffe553"}, "originalPosition": 14}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "78dfb1f3f552cc6214846eb92d9c583d4c033da8", "author": {"user": {"login": "mshabarov", "name": "Mikhail Shabarov"}}, "url": "https://github.com/vaadin/flow/commit/78dfb1f3f552cc6214846eb92d9c583d4c033da8", "committedDate": "2020-09-24T10:46:11Z", "message": "Improve explanatory comments"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b3cb2dbe08454ad62a3f11e296103c885c2d2b7f", "author": {"user": {"login": "mshabarov", "name": "Mikhail Shabarov"}}, "url": "https://github.com/vaadin/flow/commit/b3cb2dbe08454ad62a3f11e296103c885c2d2b7f", "committedDate": "2020-09-28T18:16:12Z", "message": "Make empty data provider public for being used in components"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDk4MzQxMTEy", "url": "https://github.com/vaadin/flow/pull/9052#pullrequestreview-498341112", "createdAt": "2020-09-29T10:46:41Z", "commit": {"oid": "b3cb2dbe08454ad62a3f11e296103c885c2d2b7f"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4934, "cost": 1, "resetAt": "2021-10-28T20:13:43Z"}}}