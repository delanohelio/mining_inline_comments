{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTQ2Mzg4OTc0", "number": 9727, "reviewThreads": {"totalCount": 5, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0yOVQxMTo1OTozMVrOFJwViA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wMS0wNFQwOTo1NzowM1rOFK1AyA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzQ1NzczNDQ4OnYy", "diffSide": "RIGHT", "path": "flow-server/src/main/java/com/vaadin/flow/server/startup/LookupServletContainerInitializer.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0yOVQxMTo1OTozMVrOIMNs4Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0yOVQxMTo1OTozMVrOIMNs4Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0OTY3ODMwNQ==", "bodyText": "Remove this use of \"DeprecatedPolymerPublishedEventHandler\"; it is deprecated.", "url": "https://github.com/vaadin/flow/pull/9727#discussion_r549678305", "createdAt": "2020-12-29T11:59:31Z", "author": {"login": "vaadin-bot"}, "path": "flow-server/src/main/java/com/vaadin/flow/server/startup/LookupServletContainerInitializer.java", "diffHunk": "@@ -0,0 +1,172 @@\n+/*\n+ * Copyright 2000-2020 Vaadin Ltd.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\"); you may not\n+ * use this file except in compliance with the License. You may obtain a copy of\n+ * the License at\n+ *\n+ * http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS, WITHOUT\n+ * WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied. See the\n+ * License for the specific language governing permissions and limitations under\n+ * the License.\n+ */\n+package com.vaadin.flow.server.startup;\n+\n+import javax.servlet.ServletContainerInitializer;\n+import javax.servlet.ServletContext;\n+import javax.servlet.ServletException;\n+import javax.servlet.annotation.HandlesTypes;\n+\n+import java.util.Collection;\n+import java.util.Collections;\n+import java.util.HashMap;\n+import java.util.Map;\n+import java.util.Set;\n+import java.util.stream.Collectors;\n+import java.util.stream.Stream;\n+\n+import com.vaadin.flow.component.template.internal.DeprecatedPolymerPublishedEventHandler;\n+import com.vaadin.flow.di.InstantiatorFactory;\n+import com.vaadin.flow.di.Lookup;\n+import com.vaadin.flow.di.LookupInitializer;\n+import com.vaadin.flow.di.ResourceProvider;\n+import com.vaadin.flow.internal.ReflectTools;\n+import com.vaadin.flow.server.VaadinServletContext;\n+import com.vaadin.flow.server.frontend.EndpointGeneratorTaskFactory;\n+\n+/**\n+ * Standard servlet initializer for collecting all SPI implementations.\n+ * \n+ * @author Vaadin Ltd\n+ * @since\n+ *\n+ */\n+@HandlesTypes({ ResourceProvider.class, InstantiatorFactory.class,\n+        DeprecatedPolymerPublishedEventHandler.class,", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "172a0059662622ddf1351b8df82f1e133d64a2e5"}, "originalPosition": 48}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzQ1NzczNDUyOnYy", "diffSide": "RIGHT", "path": "flow-server/src/main/java/com/vaadin/flow/server/startup/LookupServletContainerInitializer.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0yOVQxMTo1OTozMlrOIMNs5Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0yOVQxMTo1OTozMlrOIMNs5Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0OTY3ODMwOQ==", "bodyText": "\"servletContext\" is a method parameter, and should not be used for synchronization.", "url": "https://github.com/vaadin/flow/pull/9727#discussion_r549678309", "createdAt": "2020-12-29T11:59:32Z", "author": {"login": "vaadin-bot"}, "path": "flow-server/src/main/java/com/vaadin/flow/server/startup/LookupServletContainerInitializer.java", "diffHunk": "@@ -0,0 +1,172 @@\n+/*\n+ * Copyright 2000-2020 Vaadin Ltd.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\"); you may not\n+ * use this file except in compliance with the License. You may obtain a copy of\n+ * the License at\n+ *\n+ * http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS, WITHOUT\n+ * WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied. See the\n+ * License for the specific language governing permissions and limitations under\n+ * the License.\n+ */\n+package com.vaadin.flow.server.startup;\n+\n+import javax.servlet.ServletContainerInitializer;\n+import javax.servlet.ServletContext;\n+import javax.servlet.ServletException;\n+import javax.servlet.annotation.HandlesTypes;\n+\n+import java.util.Collection;\n+import java.util.Collections;\n+import java.util.HashMap;\n+import java.util.Map;\n+import java.util.Set;\n+import java.util.stream.Collectors;\n+import java.util.stream.Stream;\n+\n+import com.vaadin.flow.component.template.internal.DeprecatedPolymerPublishedEventHandler;\n+import com.vaadin.flow.di.InstantiatorFactory;\n+import com.vaadin.flow.di.Lookup;\n+import com.vaadin.flow.di.LookupInitializer;\n+import com.vaadin.flow.di.ResourceProvider;\n+import com.vaadin.flow.internal.ReflectTools;\n+import com.vaadin.flow.server.VaadinServletContext;\n+import com.vaadin.flow.server.frontend.EndpointGeneratorTaskFactory;\n+\n+/**\n+ * Standard servlet initializer for collecting all SPI implementations.\n+ * \n+ * @author Vaadin Ltd\n+ * @since\n+ *\n+ */\n+@HandlesTypes({ ResourceProvider.class, InstantiatorFactory.class,\n+        DeprecatedPolymerPublishedEventHandler.class,\n+        EndpointGeneratorTaskFactory.class,\n+        ApplicationConfigurationFactory.class, LookupInitializer.class })\n+public class LookupServletContainerInitializer\n+        implements ClassLoaderAwareServletContainerInitializer {\n+\n+    @Override\n+    public void process(Set<Class<?>> classSet, ServletContext servletContext)\n+            throws ServletException {\n+        VaadinServletContext vaadinContext = new VaadinServletContext(\n+                servletContext);\n+        Map<Class<?>, Collection<Class<?>>> services = new HashMap<>();\n+\n+        collectSubclasses(LookupInitializer.class, classSet, services);\n+\n+        LookupInitializer initializer = getLookupInitializer(services);\n+\n+        services.remove(LookupInitializer.class);\n+\n+        collectServiceImplementations(classSet, services);\n+\n+        initializer.initialize(vaadinContext, services, lookup -> {\n+            vaadinContext.setAttribute(Lookup.class, lookup);\n+\n+            DeferredServletContextInitializers deferredInitializers;\n+            synchronized (servletContext) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "172a0059662622ddf1351b8df82f1e133d64a2e5"}, "originalPosition": 73}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzQ1ODAxMzE4OnYy", "diffSide": "RIGHT", "path": "flow-server/src/main/java/com/vaadin/flow/di/LookupInitializer.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0yOVQxNDoxMDoxNlrOIMQJQA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0yOVQxNDoxMDoxNlrOIMQJQA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0OTcxODMzNg==", "bodyText": "Add a nested comment explaining why this method is empty, throw an UnsupportedOperationException or complete the implementation.", "url": "https://github.com/vaadin/flow/pull/9727#discussion_r549718336", "createdAt": "2020-12-29T14:10:16Z", "author": {"login": "vaadin-bot"}, "path": "flow-server/src/main/java/com/vaadin/flow/di/LookupInitializer.java", "diffHunk": "@@ -0,0 +1,387 @@\n+/*\n+ * Copyright 2000-2020 Vaadin Ltd.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\"); you may not\n+ * use this file except in compliance with the License. You may obtain a copy of\n+ * the License at\n+ *\n+ * http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS, WITHOUT\n+ * WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied. See the\n+ * License for the specific language governing permissions and limitations under\n+ * the License.\n+ */\n+package com.vaadin.flow.di;\n+\n+import javax.servlet.ServletContainerInitializer;\n+import javax.servlet.ServletException;\n+\n+import java.io.ByteArrayInputStream;\n+import java.io.ByteArrayOutputStream;\n+import java.io.IOException;\n+import java.io.InputStream;\n+import java.net.URL;\n+import java.util.ArrayList;\n+import java.util.Collection;\n+import java.util.Collections;\n+import java.util.HashMap;\n+import java.util.Iterator;\n+import java.util.List;\n+import java.util.Map;\n+import java.util.Objects;\n+import java.util.ServiceLoader;\n+import java.util.Set;\n+import java.util.concurrent.ConcurrentHashMap;\n+import java.util.function.BiFunction;\n+import java.util.stream.Collectors;\n+\n+import org.apache.commons.io.IOUtils;\n+\n+import com.vaadin.flow.function.VaadinApplicationInitializationBootstrap;\n+import com.vaadin.flow.internal.ReflectTools;\n+import com.vaadin.flow.server.VaadinContext;\n+import com.vaadin.flow.server.startup.ApplicationConfigurationFactory;\n+import com.vaadin.flow.server.startup.DefaultApplicationConfigurationFactory;\n+import com.vaadin.flow.server.startup.LookupServletContainerInitializer;\n+\n+/**\n+ * SPI for customizing lookup in applications inside Servlet 3.0 containers.\n+ * <p>\n+ * There are two ways of customizing Lookup in various servlet containers:\n+ * <ul>\n+ * <li>Somehow completely disable {@link LookupServletContainerInitializer} and\n+ * implement own way to set up {@link Lookup} and make it available via\n+ * {@link VaadinContext#getAttribute(Class)}.\n+ * <li>Use {@link LookupInitializer} SPI via providing an implementation for the\n+ * framework which doesn't prevent {@link LookupServletContainerInitializer}\n+ * execution.\n+ * </ul>\n+ * \n+ * The first case is only possible when a servlet container doesn't run\n+ * {@link ServletContainerInitializer}s out of the box (e.g. OSGi or Spring boot\n+ * executed as a Jar) at all. Otherwise you may not disable an existing\n+ * {@link ServletContainerInitializer} and it will be executed anyway.\n+ * <p>\n+ * The second case allows to customize {@link Lookup} creation and\n+ * initialization in case when it's not possible to prevent\n+ * {@link LookupServletContainerInitializer} execution (any container which\n+ * completely supports Servlet 3.0 specification). In this case it's possible to\n+ * implement {@link LookupInitializer} for the framework.\n+ * <p>\n+ * This is SPI for {@link Lookup} SPI. The difference is:\n+ * <ul>\n+ * <li>{@link Lookup} allows to override services per Web application (by the\n+ * application developer). For some service interfaces there can be several\n+ * implementations available in {@link Lookup}.\n+ * <li>{@link LookupInitializer} allows to override how the {@link Lookup} works\n+ * per framework. The default implementation available if no framework is used.\n+ * Only one service implementation (excluding the default one) may be available\n+ * in the web application classpath and it's provided by the developers for the\n+ * framework support (the main usecase here is Spring add-on).\n+ * </ul>\n+ * \n+ * @author Vaadin Ltd\n+ * @since\n+ *\n+ */\n+public class LookupInitializer {\n+\n+    protected static final String SPI = \" SPI: \";\n+\n+    protected static final String ONE_IMPL_REQUIRED = \". Only one implementation should be registered. \"\n+            + \"Use lookupAll to get all instances of the given type.\";\n+\n+    protected static final String SEVERAL_IMPLS = \"Found several implementations in the classpath for \";\n+\n+    /**\n+     * Default implementation of {@link Lookup}.\n+     * \n+     * @author Vaadin Ltd\n+     * @since\n+     *\n+     */\n+    protected static class LookupImpl implements Lookup {\n+\n+        protected final Map<Class<?>, Collection<Object>> serviceMap;\n+\n+        /**\n+         * Creates a new instance of {@link Lookup} with services found in the\n+         * application classpath.\n+         * \n+         * @param initialServices\n+         *            map of initial services with their implementations\n+         * @param factory\n+         *            a factory to create a service object instance\n+         */\n+        protected LookupImpl(\n+                Map<Class<?>, Collection<Class<?>>> initialServices,\n+                BiFunction<Class<?>, Class<?>, Object> factory) {\n+            serviceMap = new HashMap<>();\n+            initialServices.forEach((serviceClass,\n+                    impls) -> serviceMap.put(serviceClass, impls.stream()\n+                            .map(impl -> factory.apply(serviceClass, impl))\n+                            .filter(Objects::nonNull)\n+                            .collect(Collectors.toList())));\n+        }\n+\n+        @Override\n+        public <T> T lookup(Class<T> serviceClass) {\n+            Collection<Object> registered = serviceMap.get(serviceClass);\n+            if (registered == null || registered.isEmpty()) {\n+                ServiceLoader<T> loader = ServiceLoader.load(serviceClass);\n+                List<T> services = new ArrayList<>();\n+                for (Iterator<T> iterator = loader.iterator(); iterator\n+                        .hasNext();) {\n+                    services.add(iterator.next());\n+                }\n+                if (services.size() > 1) {\n+                    throw new IllegalStateException(SEVERAL_IMPLS + serviceClass\n+                            + SPI + services + ONE_IMPL_REQUIRED);\n+                } else if (services.size() == 1) {\n+                    return services.get(0);\n+                }\n+                return null;\n+            } else if (registered.size() > 1) {\n+                throw new IllegalStateException(SEVERAL_IMPLS + serviceClass\n+                        + SPI + registered + ONE_IMPL_REQUIRED);\n+            } else {\n+                return serviceClass.cast(registered.iterator().next());\n+            }\n+        }\n+\n+        @Override\n+        public <T> Collection<T> lookupAll(Class<T> serviceClass) {\n+            List<T> result = new ArrayList<>();\n+            Collection<Object> registered = serviceMap.get(serviceClass);\n+\n+            Set<?> registeredClasses = registered == null\n+                    ? Collections.emptySet()\n+                    : registered.stream().map(Object::getClass)\n+                            .collect(Collectors.toSet());\n+            if (registered != null) {\n+                registered.forEach(\n+                        service -> result.add(serviceClass.cast(service)));\n+            }\n+            ServiceLoader<T> loader = ServiceLoader.load(serviceClass);\n+            for (Iterator<T> iterator = loader.iterator(); iterator\n+                    .hasNext();) {\n+                T next = iterator.next();\n+                if (!registeredClasses.contains(next.getClass())) {\n+                    result.add(next);\n+                }\n+            }\n+            return result;\n+        }\n+\n+    }\n+\n+    /**\n+     * Default implementation of {@link ResourceProvider}.\n+     * \n+     * @author Vaadin Ltd\n+     * @since\n+     *\n+     */\n+    protected static class ResourceProviderImpl implements ResourceProvider {\n+\n+        private Map<String, CachedStreamData> cache = new ConcurrentHashMap<>();\n+\n+        /**\n+         * Creates a new instance.\n+         */\n+        public ResourceProviderImpl() {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f59db83576f1d192cc2ddfe79499cea1b8bdf00b"}, "originalPosition": 194}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzQ2ODgxMDg4OnYy", "diffSide": "RIGHT", "path": "flow-server/src/main/java/com/vaadin/flow/di/LookupInitializer.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wMS0wNFQwOTowNzo1OVrOINqA3A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wMS0wNFQxNzowOToxMVrOIN5voA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1MTE5MDc0OA==", "bodyText": "This shouldn't start with Somehow and should be the second way as it's not the recommended way (as we can't say how to disable a part from the ServletContainerInitializer)", "url": "https://github.com/vaadin/flow/pull/9727#discussion_r551190748", "createdAt": "2021-01-04T09:07:59Z", "author": {"login": "caalador"}, "path": "flow-server/src/main/java/com/vaadin/flow/di/LookupInitializer.java", "diffHunk": "@@ -0,0 +1,387 @@\n+/*\n+ * Copyright 2000-2020 Vaadin Ltd.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\"); you may not\n+ * use this file except in compliance with the License. You may obtain a copy of\n+ * the License at\n+ *\n+ * http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS, WITHOUT\n+ * WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied. See the\n+ * License for the specific language governing permissions and limitations under\n+ * the License.\n+ */\n+package com.vaadin.flow.di;\n+\n+import javax.servlet.ServletContainerInitializer;\n+import javax.servlet.ServletException;\n+\n+import java.io.ByteArrayInputStream;\n+import java.io.ByteArrayOutputStream;\n+import java.io.IOException;\n+import java.io.InputStream;\n+import java.net.URL;\n+import java.util.ArrayList;\n+import java.util.Collection;\n+import java.util.Collections;\n+import java.util.HashMap;\n+import java.util.Iterator;\n+import java.util.List;\n+import java.util.Map;\n+import java.util.Objects;\n+import java.util.ServiceLoader;\n+import java.util.Set;\n+import java.util.concurrent.ConcurrentHashMap;\n+import java.util.function.BiFunction;\n+import java.util.stream.Collectors;\n+\n+import org.apache.commons.io.IOUtils;\n+\n+import com.vaadin.flow.function.VaadinApplicationInitializationBootstrap;\n+import com.vaadin.flow.internal.ReflectTools;\n+import com.vaadin.flow.server.VaadinContext;\n+import com.vaadin.flow.server.startup.ApplicationConfigurationFactory;\n+import com.vaadin.flow.server.startup.DefaultApplicationConfigurationFactory;\n+import com.vaadin.flow.server.startup.LookupServletContainerInitializer;\n+\n+/**\n+ * SPI for customizing lookup in applications inside Servlet 3.0 containers.\n+ * <p>\n+ * There are two ways of customizing Lookup in various servlet containers:\n+ * <ul>\n+ * <li>Somehow completely disable {@link LookupServletContainerInitializer} and\n+ * implement own way to set up {@link Lookup} and make it available via\n+ * {@link VaadinContext#getAttribute(Class)}.", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f59db83576f1d192cc2ddfe79499cea1b8bdf00b"}, "originalPosition": 56}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1MTQ0ODQ4MA==", "bodyText": "Done", "url": "https://github.com/vaadin/flow/pull/9727#discussion_r551448480", "createdAt": "2021-01-04T17:09:11Z", "author": {"login": "denis-anisimov"}, "path": "flow-server/src/main/java/com/vaadin/flow/di/LookupInitializer.java", "diffHunk": "@@ -0,0 +1,387 @@\n+/*\n+ * Copyright 2000-2020 Vaadin Ltd.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\"); you may not\n+ * use this file except in compliance with the License. You may obtain a copy of\n+ * the License at\n+ *\n+ * http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS, WITHOUT\n+ * WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied. See the\n+ * License for the specific language governing permissions and limitations under\n+ * the License.\n+ */\n+package com.vaadin.flow.di;\n+\n+import javax.servlet.ServletContainerInitializer;\n+import javax.servlet.ServletException;\n+\n+import java.io.ByteArrayInputStream;\n+import java.io.ByteArrayOutputStream;\n+import java.io.IOException;\n+import java.io.InputStream;\n+import java.net.URL;\n+import java.util.ArrayList;\n+import java.util.Collection;\n+import java.util.Collections;\n+import java.util.HashMap;\n+import java.util.Iterator;\n+import java.util.List;\n+import java.util.Map;\n+import java.util.Objects;\n+import java.util.ServiceLoader;\n+import java.util.Set;\n+import java.util.concurrent.ConcurrentHashMap;\n+import java.util.function.BiFunction;\n+import java.util.stream.Collectors;\n+\n+import org.apache.commons.io.IOUtils;\n+\n+import com.vaadin.flow.function.VaadinApplicationInitializationBootstrap;\n+import com.vaadin.flow.internal.ReflectTools;\n+import com.vaadin.flow.server.VaadinContext;\n+import com.vaadin.flow.server.startup.ApplicationConfigurationFactory;\n+import com.vaadin.flow.server.startup.DefaultApplicationConfigurationFactory;\n+import com.vaadin.flow.server.startup.LookupServletContainerInitializer;\n+\n+/**\n+ * SPI for customizing lookup in applications inside Servlet 3.0 containers.\n+ * <p>\n+ * There are two ways of customizing Lookup in various servlet containers:\n+ * <ul>\n+ * <li>Somehow completely disable {@link LookupServletContainerInitializer} and\n+ * implement own way to set up {@link Lookup} and make it available via\n+ * {@link VaadinContext#getAttribute(Class)}.", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1MTE5MDc0OA=="}, "originalCommit": {"oid": "f59db83576f1d192cc2ddfe79499cea1b8bdf00b"}, "originalPosition": 56}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzQ2ODk4NjMyOnYy", "diffSide": "RIGHT", "path": "flow-server/src/test/java/com/vaadin/flow/di/LookupIntializerTest.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wMS0wNFQwOTo1NzowM1rOINrjDQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wMS0wNFQxNzoxMjozOVrOIN53Fw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1MTIxNTg4NQ==", "bodyText": "The name could say why it is expected to throw. Multiple instances I presume?", "url": "https://github.com/vaadin/flow/pull/9727#discussion_r551215885", "createdAt": "2021-01-04T09:57:03Z", "author": {"login": "caalador"}, "path": "flow-server/src/test/java/com/vaadin/flow/di/LookupIntializerTest.java", "diffHunk": "@@ -0,0 +1,263 @@\n+/*\n+ * Copyright 2000-2020 Vaadin Ltd.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\"); you may not\n+ * use this file except in compliance with the License. You may obtain a copy of\n+ * the License at\n+ *\n+ * http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS, WITHOUT\n+ * WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied. See the\n+ * License for the specific language governing permissions and limitations under\n+ * the License.\n+ */\n+package com.vaadin.flow.di;\n+\n+import javax.servlet.ServletException;\n+\n+import java.io.IOException;\n+import java.io.InputStream;\n+import java.net.URL;\n+import java.nio.charset.StandardCharsets;\n+import java.util.ArrayList;\n+import java.util.Arrays;\n+import java.util.Collection;\n+import java.util.Collections;\n+import java.util.HashMap;\n+import java.util.HashSet;\n+import java.util.Iterator;\n+import java.util.LinkedList;\n+import java.util.List;\n+import java.util.Map;\n+import java.util.Set;\n+import java.util.concurrent.atomic.AtomicReference;\n+import java.util.stream.Collectors;\n+\n+import org.apache.commons.io.IOUtils;\n+import org.junit.Assert;\n+import org.junit.Test;\n+import org.mockito.Mockito;\n+\n+import com.vaadin.flow.di.LookupInitializer.ResourceProviderImpl;\n+import com.vaadin.flow.function.VaadinApplicationInitializationBootstrap;\n+import com.vaadin.flow.server.startup.ApplicationConfigurationFactory;\n+import com.vaadin.flow.server.startup.DefaultApplicationConfigurationFactory;\n+import com.vaadin.flow.server.startup.testdata.AnotherTestInstantiatorFactory;\n+import com.vaadin.flow.server.startup.testdata.OneMoreTestInstantiatorFactory;\n+import com.vaadin.flow.server.startup.testdata.TestInstantiatorFactory;\n+import com.vaadin.flow.server.startup.testdata.TestResourceProvider;\n+\n+import elemental.json.Json;\n+import elemental.json.JsonObject;\n+\n+public class LookupIntializerTest {\n+\n+    private LookupInitializer initializer = new LookupInitializer();\n+\n+    @Test(expected = IllegalStateException.class)\n+    public void createLookup_instantiatorsAreProvidedAsAService_lookupThrows()\n+            throws ServletException {\n+        // Java standard SPI is used to register several instantiators via\n+        // META-INF/services\n+        Lookup lookup = initializer.createLookup(null, new HashMap<>());\n+\n+        lookup.lookup(InstantiatorFactory.class);\n+    }\n+\n+    @Test(expected = IllegalStateException.class)\n+    public void createLookup_instantiatorsAreProvidedAsScannedClasses_lookupThrows()", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f59db83576f1d192cc2ddfe79499cea1b8bdf00b"}, "originalPosition": 70}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1MTQ1MDM5MQ==", "bodyText": "Done", "url": "https://github.com/vaadin/flow/pull/9727#discussion_r551450391", "createdAt": "2021-01-04T17:12:39Z", "author": {"login": "denis-anisimov"}, "path": "flow-server/src/test/java/com/vaadin/flow/di/LookupIntializerTest.java", "diffHunk": "@@ -0,0 +1,263 @@\n+/*\n+ * Copyright 2000-2020 Vaadin Ltd.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\"); you may not\n+ * use this file except in compliance with the License. You may obtain a copy of\n+ * the License at\n+ *\n+ * http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS, WITHOUT\n+ * WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied. See the\n+ * License for the specific language governing permissions and limitations under\n+ * the License.\n+ */\n+package com.vaadin.flow.di;\n+\n+import javax.servlet.ServletException;\n+\n+import java.io.IOException;\n+import java.io.InputStream;\n+import java.net.URL;\n+import java.nio.charset.StandardCharsets;\n+import java.util.ArrayList;\n+import java.util.Arrays;\n+import java.util.Collection;\n+import java.util.Collections;\n+import java.util.HashMap;\n+import java.util.HashSet;\n+import java.util.Iterator;\n+import java.util.LinkedList;\n+import java.util.List;\n+import java.util.Map;\n+import java.util.Set;\n+import java.util.concurrent.atomic.AtomicReference;\n+import java.util.stream.Collectors;\n+\n+import org.apache.commons.io.IOUtils;\n+import org.junit.Assert;\n+import org.junit.Test;\n+import org.mockito.Mockito;\n+\n+import com.vaadin.flow.di.LookupInitializer.ResourceProviderImpl;\n+import com.vaadin.flow.function.VaadinApplicationInitializationBootstrap;\n+import com.vaadin.flow.server.startup.ApplicationConfigurationFactory;\n+import com.vaadin.flow.server.startup.DefaultApplicationConfigurationFactory;\n+import com.vaadin.flow.server.startup.testdata.AnotherTestInstantiatorFactory;\n+import com.vaadin.flow.server.startup.testdata.OneMoreTestInstantiatorFactory;\n+import com.vaadin.flow.server.startup.testdata.TestInstantiatorFactory;\n+import com.vaadin.flow.server.startup.testdata.TestResourceProvider;\n+\n+import elemental.json.Json;\n+import elemental.json.JsonObject;\n+\n+public class LookupIntializerTest {\n+\n+    private LookupInitializer initializer = new LookupInitializer();\n+\n+    @Test(expected = IllegalStateException.class)\n+    public void createLookup_instantiatorsAreProvidedAsAService_lookupThrows()\n+            throws ServletException {\n+        // Java standard SPI is used to register several instantiators via\n+        // META-INF/services\n+        Lookup lookup = initializer.createLookup(null, new HashMap<>());\n+\n+        lookup.lookup(InstantiatorFactory.class);\n+    }\n+\n+    @Test(expected = IllegalStateException.class)\n+    public void createLookup_instantiatorsAreProvidedAsScannedClasses_lookupThrows()", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1MTIxNTg4NQ=="}, "originalCommit": {"oid": "f59db83576f1d192cc2ddfe79499cea1b8bdf00b"}, "originalPosition": 70}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3807, "cost": 1, "resetAt": "2021-11-13T12:26:42Z"}}}