{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTM2MjgzNDcw", "number": 9631, "title": "chore: fix flaky tests that depends on mock count", "bodyText": "Move mock initialization to the setup method so that the tests depend on verify count won't affect each other.", "createdAt": "2020-12-10T21:55:14Z", "url": "https://github.com/vaadin/flow/pull/9631", "merged": true, "mergeCommit": {"oid": "df7a5f80b8c77f5d1505ecd6aea7e1adf70141bf"}, "closed": true, "closedAt": "2020-12-14T08:01:11Z", "author": {"login": "haijian-vaadin"}, "timelineItems": {"totalCount": 8, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdk6lLugH2gAyNTM2MjgzNDcwOmE0NjVjMWEwMGYyZDY1YWY2NGI4ODQ1YTVlYjM2NzJkYmMyMWUxZmQ=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdmAuTcAFqTU1MTEwNDEzMA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "a465c1a00f2d65af64b8845a5eb3672dbc21e1fd", "author": {"user": {"login": "haijian-vaadin", "name": "Haijian Wang"}}, "url": "https://github.com/vaadin/flow/commit/a465c1a00f2d65af64b8845a5eb3672dbc21e1fd", "committedDate": "2020-12-10T21:53:37Z", "message": "chore: fix flaky tests that depends on mock count"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTQ5ODUyMDgz", "url": "https://github.com/vaadin/flow/pull/9631#pullrequestreview-549852083", "createdAt": "2020-12-11T07:20:57Z", "commit": {"oid": "a465c1a00f2d65af64b8845a5eb3672dbc21e1fd"}, "state": "DISMISSED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTUwMDUxNjA5", "url": "https://github.com/vaadin/flow/pull/9631#pullrequestreview-550051609", "createdAt": "2020-12-11T12:21:44Z", "commit": {"oid": "a465c1a00f2d65af64b8845a5eb3672dbc21e1fd"}, "state": "DISMISSED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTUwMDU0MzA4", "url": "https://github.com/vaadin/flow/pull/9631#pullrequestreview-550054308", "createdAt": "2020-12-11T12:25:52Z", "commit": {"oid": "a465c1a00f2d65af64b8845a5eb3672dbc21e1fd"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e137f3c3564cdf7af53fcde30fb464bbebb401a7", "author": {"user": {"login": "haijian-vaadin", "name": "Haijian Wang"}}, "url": "https://github.com/vaadin/flow/commit/e137f3c3564cdf7af53fcde30fb464bbebb401a7", "committedDate": "2020-12-13T19:16:06Z", "message": "apply code review suggestions"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f354e3909685c798fe7230f85988a38dc7eda508", "author": {"user": {"login": "haijian-vaadin", "name": "Haijian Wang"}}, "url": "https://github.com/vaadin/flow/commit/f354e3909685c798fe7230f85988a38dc7eda508", "committedDate": "2020-12-13T20:57:28Z", "message": "apply code review suggestions"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTUwOTY3MDM1", "url": "https://github.com/vaadin/flow/pull/9631#pullrequestreview-550967035", "createdAt": "2020-12-13T22:21:10Z", "commit": {"oid": "f354e3909685c798fe7230f85988a38dc7eda508"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xM1QyMjoyMToxMFrOIE6Mqw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xM1QyMjoyMToxMFrOIE6Mqw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MjAxODczMQ==", "bodyText": "Remove this use of \"Thread.sleep()\".", "url": "https://github.com/vaadin/flow/pull/9631#discussion_r542018731", "createdAt": "2020-12-13T22:21:10Z", "author": {"login": "vaadin-bot"}, "path": "fusion-endpoint/src/test/java/com/vaadin/flow/server/startup/fusion/DevModeInitializerEndpointTest.java", "diffHunk": "@@ -128,63 +128,105 @@ public void teardown() throws Exception, SecurityException {\n     @Test\n     public void should_generateOpenApi_when_EndpointPresents()\n             throws Exception {\n-\n-        // Configure a folder that has .java classes with valid endpoints\n-        // Not using `src/test/java` because there are invalid endpoint names\n-        // in some tests\n-        File src = new File(\n-                getClass().getClassLoader().getResource(\"java\").getFile());\n-        System.setProperty(\"vaadin.\" + CONNECT_JAVA_SOURCE_FOLDER_TOKEN,\n-                src.getAbsolutePath());\n-\n+        String originalJavaSourceFolder = null;\n         File generatedOpenApiJson = Paths\n-                .get(baseDir, DEFAULT_CONNECT_OPENAPI_JSON_FILE).toFile();\n-\n-        Assert.assertFalse(generatedOpenApiJson.exists());\n-        DevModeInitializer devModeInitializer = new DevModeInitializer();\n-        devModeInitializer.onStartup(classes, servletContext);\n-        waitForDevModeServer();\n-        Thread.sleep(200);\n-        Assert.assertTrue(\"Should generate OpenAPI spec if Endpoint is used.\",\n-                generatedOpenApiJson.exists());\n+                    .get(baseDir, DEFAULT_CONNECT_OPENAPI_JSON_FILE).toFile();\n+        try {\n+            originalJavaSourceFolder = System.getProperty(\"vaadin.\" \n+                + CONNECT_JAVA_SOURCE_FOLDER_TOKEN);\n+            // Configure a folder that has .java classes with valid endpoints\n+            // Not using `src/test/java` because there are invalid endpoint names\n+            // in some tests\n+            File src = new File(\n+                    getClass().getClassLoader().getResource(\"java\").getFile());\n+            System.setProperty(\"vaadin.\" + CONNECT_JAVA_SOURCE_FOLDER_TOKEN,\n+                    src.getAbsolutePath());\n+\n+            Assert.assertFalse(generatedOpenApiJson.exists());\n+            DevModeInitializer devModeInitializer = new DevModeInitializer();\n+            devModeInitializer.onStartup(classes, servletContext);\n+            waitForDevModeServer();\n+            Thread.sleep(200);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f354e3909685c798fe7230f85988a38dc7eda508"}, "originalPosition": 40}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTUxMTA0MTMw", "url": "https://github.com/vaadin/flow/pull/9631#pullrequestreview-551104130", "createdAt": "2020-12-14T07:36:56Z", "commit": {"oid": "f354e3909685c798fe7230f85988a38dc7eda508"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4678, "cost": 1, "resetAt": "2021-10-28T20:13:43Z"}}}