{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTMxNTgyNjAw", "number": 9559, "title": "feat: document level npm css", "bodyText": "Now there is a possibility to use the\n\"documentCss\" key in theme.json to\ninject npm css into the document rool level\nelement.\ndepends on #9558\nFixes #9533", "createdAt": "2020-12-03T07:53:44Z", "url": "https://github.com/vaadin/flow/pull/9559", "merged": true, "mergeCommit": {"oid": "ab6855122c2278112e65da4a566429d55895f808"}, "closed": true, "closedAt": "2020-12-17T13:38:15Z", "author": {"login": "caalador"}, "timelineItems": {"totalCount": 11, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdiizovAFqTU0MzkyNjQyOQ==", "endCursor": "Y3Vyc29yOnYyOpPPAAABdnDT4pgFqTU1NDU4ODk1Ng==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTQzOTI2NDI5", "url": "https://github.com/vaadin/flow/pull/9559#pullrequestreview-543926429", "createdAt": "2020-12-03T12:58:44Z", "commit": {"oid": "0c229a34ce321766f4caa68c0cd921df7073d6d6"}, "state": "COMMENTED", "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0wM1QxMjo1ODo0NFrOH-aZxw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0wM1QxMzowMzoyMFrOH-ak5Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNTIwNjM0Mw==", "bodyText": "(stupid question): I cannot figure out where the target comes from to the generated file", "url": "https://github.com/vaadin/flow/pull/9559#discussion_r535206343", "createdAt": "2020-12-03T12:58:44Z", "author": {"login": "pleku"}, "path": "flow-server/src/main/resources/plugins/application-theme-plugin/theme-generator.js", "diffHunk": "@@ -78,6 +79,15 @@ function generateThemeFile(themeFolder, themeName) {\n     globalCssCode.push(`injectGlobalCss(${variable}.toString(), target);\\n`);\n   });\n \n+  let i = 0;\n+  if (themeProperties.documentCss) {\n+    themeProperties.documentCss.forEach((cssImport) => {\n+      const variable = 'module' + i++;\n+      imports.push(`import ${variable} from '${cssImport}';\\n`);\n+      globalCssCode.push(`    injectGlobalCss(${variable}.toString(), target);\\n`);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "0c229a34ce321766f4caa68c0cd921df7073d6d6"}, "originalPosition": 21}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNTIwODUwMg==", "bodyText": "While this is the same as to the global files, maybe the reason why this needs to be injected to both could be documented here", "url": "https://github.com/vaadin/flow/pull/9559#discussion_r535208502", "createdAt": "2020-12-03T13:02:04Z", "author": {"login": "pleku"}, "path": "flow-server/src/main/resources/plugins/application-theme-plugin/theme-generator.js", "diffHunk": "@@ -78,6 +79,15 @@ function generateThemeFile(themeFolder, themeName) {\n     globalCssCode.push(`injectGlobalCss(${variable}.toString(), target);\\n`);\n   });\n \n+  let i = 0;\n+  if (themeProperties.documentCss) {\n+    themeProperties.documentCss.forEach((cssImport) => {\n+      const variable = 'module' + i++;\n+      imports.push(`import ${variable} from '${cssImport}';\\n`);\n+      globalCssCode.push(`    injectGlobalCss(${variable}.toString(), target);\\n`);\n+      globalCssCode.push(`    injectGlobalCss(${variable}.toString(), document);\\n`);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "0c229a34ce321766f4caa68c0cd921df7073d6d6"}, "originalPosition": 22}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNTIwOTE4OQ==", "bodyText": "I thought this fort was a typo first \ud83e\udd26", "url": "https://github.com/vaadin/flow/pull/9559#discussion_r535209189", "createdAt": "2020-12-03T13:03:20Z", "author": {"login": "pleku"}, "path": "flow-tests/test-themes/frontend/theme/app-theme/theme.json", "diffHunk": "@@ -1,4 +1,5 @@\n {\n+  \"documentCss\": [\"@fortawesome/fontawesome-free/css/all.css\"],", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "0c229a34ce321766f4caa68c0cd921df7073d6d6"}, "originalPosition": 2}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "d77623c7f25f882c6512aebd8b08155f5d604c6e", "author": {"user": {"login": "caalador", "name": null}}, "url": "https://github.com/vaadin/flow/commit/d77623c7f25f882c6512aebd8b08155f5d604c6e", "committedDate": "2020-12-09T05:30:45Z", "message": "feat: document level npm css\n\nNow there is a possibility to use the\n\"documentCss\" key in theme.json to\ninject npm css into the document rool level\nelement.\n\nThis is mostly for embedded web components\nas they do not target document by default\n\nFixes #9533"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "0c229a34ce321766f4caa68c0cd921df7073d6d6", "author": {"user": {"login": "caalador", "name": null}}, "url": "https://github.com/vaadin/flow/commit/0c229a34ce321766f4caa68c0cd921df7073d6d6", "committedDate": "2020-12-03T06:50:43Z", "message": "feat: document level npm css\n\nNow there is a possibility to use the\n\"documentCss\" key in theme.json to\ninject npm css into the document rool level\nelement.\n\nFixes #9533"}, "afterCommit": {"oid": "d77623c7f25f882c6512aebd8b08155f5d604c6e", "author": {"user": {"login": "caalador", "name": null}}, "url": "https://github.com/vaadin/flow/commit/d77623c7f25f882c6512aebd8b08155f5d604c6e", "committedDate": "2020-12-09T05:30:45Z", "message": "feat: document level npm css\n\nNow there is a possibility to use the\n\"documentCss\" key in theme.json to\ninject npm css into the document rool level\nelement.\n\nThis is mostly for embedded web components\nas they do not target document by default\n\nFixes #9533"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "d92c5b4b6ef1512212d66c8b3781567a47cb1c07", "author": {"user": {"login": "caalador", "name": null}}, "url": "https://github.com/vaadin/flow/commit/d92c5b4b6ef1512212d66c8b3781567a47cb1c07", "committedDate": "2020-12-09T05:37:24Z", "message": "Dont allow faulty appshell configuration"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "1c05dc10ace63969999e8c6823b0201eead19b00", "author": {"user": {"login": "caalador", "name": null}}, "url": "https://github.com/vaadin/flow/commit/1c05dc10ace63969999e8c6823b0201eead19b00", "committedDate": "2020-12-09T06:19:29Z", "message": "Fix test expectation"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "3ec5f8868660c4bf45248741c4f1db93dfe55b84", "author": {"user": {"login": "caalador", "name": null}}, "url": "https://github.com/vaadin/flow/commit/3ec5f8868660c4bf45248741c4f1db93dfe55b84", "committedDate": "2020-12-14T11:13:17Z", "message": "Merge branch 'master' into issues/9533_document_level_css\n\n# Conflicts:\n#\tflow-server/src/main/resources/plugins/application-theme-plugin/package.json\n#\tflow-server/src/main/resources/plugins/application-theme-plugin/theme-generator.js\n#\tflow-server/src/main/resources/webpack.generated.js\n#\tflow-tests/test-embedding/test-embedding-application-theme/src/test/java/com/vaadin/flow/webcomponent/ApplicationThemeComponentIT.java"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "750c24d43efbac89e9eb78ad881859c06398960f", "author": {"user": {"login": "caalador", "name": null}}, "url": "https://github.com/vaadin/flow/commit/750c24d43efbac89e9eb78ad881859c06398960f", "committedDate": "2020-12-17T07:43:11Z", "message": "Merge branch 'master' into issues/9533_document_level_css\n\n# Conflicts:\n#\tflow-tests/test-embedding/test-embedding-application-theme/src/test/java/com/vaadin/flow/webcomponent/ApplicationThemeComponentIT.java"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "bc73782cec69271b4bc68628ffc36f11fa129d97", "author": {"user": {"login": "caalador", "name": null}}, "url": "https://github.com/vaadin/flow/commit/bc73782cec69271b4bc68628ffc36f11fa129d97", "committedDate": "2020-12-17T09:37:27Z", "message": "Use more targeted bookkeeping for globalCss\n\nHave a full map on where the global css\nhas been injected to so that if we add for\nshadow roots we don't add to document,\nbut we are able to add to other shadow roots."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "55b105123ba7231b005edfa9a656a30b727e816e", "author": {"user": {"login": "caalador", "name": null}}, "url": "https://github.com/vaadin/flow/commit/55b105123ba7231b005edfa9a656a30b727e816e", "committedDate": "2020-12-17T12:38:35Z", "message": "Add comment on why we also inject to target"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTU0NTg3OTI2", "url": "https://github.com/vaadin/flow/pull/9559#pullrequestreview-554587926", "createdAt": "2020-12-17T13:10:21Z", "commit": {"oid": "bc73782cec69271b4bc68628ffc36f11fa129d97"}, "state": "APPROVED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xN1QxMzoxMDoyMVrOIH06Fw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xN1QxMzoxMDoyMVrOIH06Fw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NTA3Nzc4Mw==", "bodyText": "Broken indent", "url": "https://github.com/vaadin/flow/pull/9559#discussion_r545077783", "createdAt": "2020-12-17T13:10:21Z", "author": {"login": "pleku"}, "path": "flow-tests/test-embedding/test-embedding-application-theme/src/test/java/com/vaadin/flow/webcomponent/ApplicationThemeComponentIT.java", "diffHunk": "@@ -73,11 +68,34 @@ public void applicationTheme_GlobalCss_isUsedOnlyInEmbeddeComponent() {\n \n         Assert.assertNotEquals(\"Ostrich\", body.getCssValue(\"font-family\"));\n \n-        getDriver().get(getRootURL() + \"/VAADIN/static/themes/embedded-theme/img/bg.jpg\");\n+        Assert\n+            .assertEquals(\"Embedded style should not match external component\",\n+                \"rgba(0, 0, 255, 1)\",\n+                $(SpanElement.class).id(\"overflow\").getCssValue(\"color\"));\n+                getDriver().get(getRootURL() + \"/themes/embedded-theme/img/bg.jpg\");", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "bc73782cec69271b4bc68628ffc36f11fa129d97"}, "originalPosition": 34}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTU0NTg4OTU2", "url": "https://github.com/vaadin/flow/pull/9559#pullrequestreview-554588956", "createdAt": "2020-12-17T13:11:43Z", "commit": {"oid": "55b105123ba7231b005edfa9a656a30b727e816e"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4602, "cost": 1, "resetAt": "2021-10-28T20:13:43Z"}}}