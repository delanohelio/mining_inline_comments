{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDM5MDk1NzQz", "number": 8611, "title": "Allow Vaadin plugins to configure node download URL and version", "bodyText": "Currently FrontendTools nor NodeTasks.Builder\ndoesn't allow you to override the node.js download URL. However, in firewalled corporate\nenvironments the node.js may be served from an intranet server.\nFixes #8603\nThe PR should be also merged into the 2.3 branch so that it will be present in Vaadin 14.3.", "createdAt": "2020-06-24T09:54:45Z", "url": "https://github.com/vaadin/flow/pull/8611", "merged": true, "mergeCommit": {"oid": "27ac83455dea400771e76cc292c7e7ff7b30e180"}, "closed": true, "closedAt": "2020-06-30T06:40:25Z", "author": {"login": "mvysny"}, "timelineItems": {"totalCount": 7, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcuW_QQAH2gAyNDM5MDk1NzQzOjIwNWM5YTMwYjUyODEzZGFjODJlNjAwN2IxOTk5YjQzMGRiNTI3ZmM=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcwPz1_gFqTQzOTcxMDY3Nw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "205c9a30b52813dac82e6007b1999b430db527fc", "author": {"user": {"login": "mvysny", "name": "Martin Vysny"}}, "url": "https://github.com/vaadin/flow/commit/205c9a30b52813dac82e6007b1999b430db527fc", "committedDate": "2020-06-24T09:53:36Z", "message": "Allow Vaadin plugins to configure node download URL and version\n\nhttps://github.com/vaadin/flow/issues/8603 . Currently FrontendTools nor NodeTasks.Builder\ndoesn't allow you to override the node.js download URL. However, in firewalled corporate\nenvironments the node.js may be served from an intranet server."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDM4NzEwMjgx", "url": "https://github.com/vaadin/flow/pull/8611#pullrequestreview-438710281", "createdAt": "2020-06-27T16:51:20Z", "commit": {"oid": "205c9a30b52813dac82e6007b1999b430db527fc"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yN1QxNzowNDoxNFrOGp2_nQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yN1QxNzowNToxMFrOGp3AHA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NjU0NTgyMQ==", "bodyText": "task.nodeVersion = builder.nodeVersion;\ntask.nodeDownloadRoot = builder.nodeDownloadRoot;\n\nI think this approach is not good.\nAs I understand there is no any other usage of \"absent setters\" for nodeVersion  and nodeDownloadRoot.\nSo I don't see any reason do not use CTOR with extended parameters.\nSetters may be called at any time which mutates the state of the object. As a result it adds some additional semantic to the usage.\nParameters in the CTOR may not be changed once the instance is constructed.\nIt allow to eliminate any confusion.\nI'm pretty sure that CTOR parameters should work here better than setters.", "url": "https://github.com/vaadin/flow/pull/8611#discussion_r446545821", "createdAt": "2020-06-27T17:04:14Z", "author": {"login": "denis-anisimov"}, "path": "flow-server/src/main/java/com/vaadin/flow/server/frontend/NodeTasks.java", "diffHunk": "@@ -496,8 +513,12 @@ private NodeTasks(Builder builder) {\n             commands.add(packageUpdater);\n \n             if (builder.runNpmInstall) {\n-                commands.add(new TaskRunNpmInstall(classFinder, packageUpdater,\n-                        builder.enablePnpm, builder.requireHomeNodeExec));\n+                final TaskRunNpmInstall task = new TaskRunNpmInstall(\n+                        classFinder, packageUpdater,\n+                        builder.enablePnpm, builder.requireHomeNodeExec);\n+                task.nodeVersion = builder.nodeVersion;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "205c9a30b52813dac82e6007b1999b430db527fc"}, "originalPosition": 46}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NjU0NTk0OA==", "bodyText": "CTOR parameters please.", "url": "https://github.com/vaadin/flow/pull/8611#discussion_r446545948", "createdAt": "2020-06-27T17:05:10Z", "author": {"login": "denis-anisimov"}, "path": "flow-server/src/main/java/com/vaadin/flow/server/frontend/TaskRunNpmInstall.java", "diffHunk": "@@ -306,6 +323,10 @@ private void runNpmInstall() throws ExecutionFailedException {\n \n         FrontendTools tools = new FrontendTools(baseDir,\n                 () -> FrontendUtils.getVaadinHomeDirectory().getAbsolutePath());\n+        if (nodeVersion != null) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "205c9a30b52813dac82e6007b1999b430db527fc"}, "originalPosition": 42}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ebacddee364a12fbe3b1a6e6e0bf1bdf7135ed4f", "author": {"user": {"login": "mvysny", "name": "Martin Vysny"}}, "url": "https://github.com/vaadin/flow/commit/ebacddee364a12fbe3b1a6e6e0bf1bdf7135ed4f", "committedDate": "2020-06-29T11:27:18Z", "message": "#8603 initialize FrontendTools and TaskRunNpmInstall fields in ctor"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDM5MDQ1OTUw", "url": "https://github.com/vaadin/flow/pull/8611#pullrequestreview-439045950", "createdAt": "2020-06-29T11:29:34Z", "commit": {"oid": "ebacddee364a12fbe3b1a6e6e0bf1bdf7135ed4f"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yOVQxMToyOTozNVrOGqMhtw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yOVQxMToyOTozN1rOGqMh2g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0Njg5ODYxNQ==", "bodyText": "public parameter", "url": "https://github.com/vaadin/flow/pull/8611#discussion_r446898615", "createdAt": "2020-06-29T11:29:35Z", "author": {"login": "denis-anisimov"}, "path": "flow-server/src/main/java/com/vaadin/flow/server/frontend/NodeTasks.java", "diffHunk": "@@ -114,17 +114,16 @@\n         /**\n          * The node.js version to be used when node.js is installed\n          * automatically by Vaadin, for example <code>\"v12.16.0\"</code>.\n-         * Defaults to null which uses the default node version.\n+         * Defaults to {@value FrontendTools#DEFAULT_NODE_VERSION}.\n          */\n-        public String nodeVersion = null;\n+        public String nodeVersion = FrontendTools.DEFAULT_NODE_VERSION;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ebacddee364a12fbe3b1a6e6e0bf1bdf7135ed4f"}, "originalPosition": 8}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0Njg5ODY1MA==", "bodyText": "public parameter", "url": "https://github.com/vaadin/flow/pull/8611#discussion_r446898650", "createdAt": "2020-06-29T11:29:37Z", "author": {"login": "denis-anisimov"}, "path": "flow-server/src/main/java/com/vaadin/flow/server/frontend/NodeTasks.java", "diffHunk": "@@ -114,17 +114,16 @@\n         /**\n          * The node.js version to be used when node.js is installed\n          * automatically by Vaadin, for example <code>\"v12.16.0\"</code>.\n-         * Defaults to null which uses the default node version.\n+         * Defaults to {@value FrontendTools#DEFAULT_NODE_VERSION}.\n          */\n-        public String nodeVersion = null;\n+        public String nodeVersion = FrontendTools.DEFAULT_NODE_VERSION;\n \n         /**\n          * Download node.js from this URL. Handy in heavily firewalled corporate\n          * environments where the node.js download can be provided from an\n-         * intranet mirror. Defaults to null which will cause the downloader\n-         * to use {@link NodeInstaller#DEFAULT_NODEJS_DOWNLOAD_ROOT}.\n+         * intranet mirror. Defaults to {@link NodeInstaller#DEFAULT_NODEJS_DOWNLOAD_ROOT}.\n          */\n-        public URI nodeDownloadRoot = null;\n+        public URI nodeDownloadRoot = URI.create(NodeInstaller.DEFAULT_NODEJS_DOWNLOAD_ROOT);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ebacddee364a12fbe3b1a6e6e0bf1bdf7135ed4f"}, "originalPosition": 18}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "db9a616e107a4c5b766dc77c9ce554b7b4ed665c", "author": {"user": {"login": "mvysny", "name": "Martin Vysny"}}, "url": "https://github.com/vaadin/flow/commit/db9a616e107a4c5b766dc77c9ce554b7b4ed665c", "committedDate": "2020-06-29T13:22:56Z", "message": "#8603 add test for FrontendTools.nodeVersion and nodeDownloadRoot"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ae33777eb087c0195882e5f262c89e0a11270261", "author": {"user": {"login": "mvysny", "name": "Martin Vysny"}}, "url": "https://github.com/vaadin/flow/commit/ae33777eb087c0195882e5f262c89e0a11270261", "committedDate": "2020-06-29T14:19:32Z", "message": "#8603 fixed javadoc"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDM5NzEwNjc3", "url": "https://github.com/vaadin/flow/pull/8611#pullrequestreview-439710677", "createdAt": "2020-06-30T06:39:39Z", "commit": {"oid": "ae33777eb087c0195882e5f262c89e0a11270261"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 203, "cost": 1, "resetAt": "2021-10-28T19:08:13Z"}}}