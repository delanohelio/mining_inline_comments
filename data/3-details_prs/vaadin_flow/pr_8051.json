{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDAzMTU1NDUy", "number": 8051, "title": "inherit the default behaviour of spring for internal object mapper", "bodyText": "This change is\u2002", "createdAt": "2020-04-14T12:31:09Z", "url": "https://github.com/vaadin/flow/pull/8051", "merged": true, "mergeCommit": {"oid": "e9e27c3a249d6b2d78dc7a7c16ea2b76f17fd51e"}, "closed": true, "closedAt": "2020-04-16T12:31:26Z", "author": {"login": "haijian-vaadin"}, "timelineItems": {"totalCount": 23, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcXhXCLAH2gAyNDAzMTU1NDUyOmNlNzU0Y2ZkNDE0YTkyOTdlYjM1YjE5NzdhYmRjNDMzNzlkOTVlYzk=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcYL42dgFqTM5NDU4MzU4Nw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "ce754cfd414a9297eb35b1977abdc43379d95ec9", "author": {"user": {"login": "haijian-vaadin", "name": "Haijian Wang"}}, "url": "https://github.com/vaadin/flow/commit/ce754cfd414a9297eb35b1977abdc43379d95ec9", "committedDate": "2020-04-14T10:58:22Z", "message": "inherit the default behaviour of spring for internal object mapper"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "970c9d9add64de948a0922501851dfbb645406c1", "author": {"user": {"login": "haijian-vaadin", "name": "Haijian Wang"}}, "url": "https://github.com/vaadin/flow/commit/970c9d9add64de948a0922501851dfbb645406c1", "committedDate": "2020-04-14T13:09:19Z", "message": "fix test"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzkyOTgwNjcy", "url": "https://github.com/vaadin/flow/pull/8051#pullrequestreview-392980672", "createdAt": "2020-04-14T14:26:12Z", "commit": {"oid": "970c9d9add64de948a0922501851dfbb645406c1"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0xNFQxNDoyNjoxMlrOGFRRVQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0xNFQxNDozNDozMVrOGFRquA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwODE3OTAyOQ==", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                private ObjectMapper getDefaultObjectMapper(ApplicationContext context) {\n          \n          \n            \n                private ObjectMapper createVaadinConnectObjectMapper(ApplicationContext context) {\n          \n      \n    \n    \n  \n\n\nI would rename the get to create, because we create a new instance\nI would rename the method to show that we create the default ObjectMapper for VaadinConnect, not the default ObjectMapper", "url": "https://github.com/vaadin/flow/pull/8051#discussion_r408179029", "createdAt": "2020-04-14T14:26:12Z", "author": {"login": "knoobie"}, "path": "flow-server/src/main/java/com/vaadin/flow/server/connect/VaadinConnectController.java", "diffHunk": "@@ -153,6 +161,17 @@ public VaadinConnectController(\n         }\n     }\n \n+    private ObjectMapper getDefaultObjectMapper(ApplicationContext context) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "970c9d9add64de948a0922501851dfbb645406c1"}, "originalPosition": 47}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwODE4MTQ5NQ==", "bodyText": "Edit: This could be all wrong - let me check it.. just saw that it is a static method call.\nEdit2: It is working like this (it inherits in my test spring's config) - this is surprising.. but I it feels wrong. I would still be in favor ofcontext.getBean(Jackson2ObjectMapperBuilder.class) - just in case.\nThis won't work Because you create a completely new instance again (this time from the Jackson2ObjectMapperBuilder) - so all spring related defaults are gone again.\nThis can be fixed in two ways:\n\nadd Jackson2ObjectMapperBuilder to the constructor of the class and in this method as argument\ncontext.getBean(Jackson2ObjectMapperBuilder.class) could be used to get the current impl of spring.\n\nSee here for more information what is configured: https://github.com/spring-projects/spring-boot/blob/master/spring-boot-project/spring-boot-autoconfigure/src/main/java/org/springframework/boot/autoconfigure/jackson/JacksonAutoConfiguration.java#L172", "url": "https://github.com/vaadin/flow/pull/8051#discussion_r408181495", "createdAt": "2020-04-14T14:29:17Z", "author": {"login": "knoobie"}, "path": "flow-server/src/main/java/com/vaadin/flow/server/connect/VaadinConnectController.java", "diffHunk": "@@ -153,6 +161,17 @@ public VaadinConnectController(\n         }\n     }\n \n+    private ObjectMapper getDefaultObjectMapper(ApplicationContext context) {\n+        ObjectMapper objectMapper = Jackson2ObjectMapperBuilder.json().build();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "970c9d9add64de948a0922501851dfbb645406c1"}, "originalPosition": 48}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwODE4NTUyOA==", "bodyText": "Not blocking, just my personal opinion: I feel this needs a lot more tests.\n\nno mocking - a real test with Spring / Spring Boot's Applicationcontext to verify that multiple instances are created with different qualifier (default and vaadin) - example:  Can be done with ApplicationContextRunner\na test that verifies that the bug described by the user is fixed\nmy comment in the last PR: #8016 (comment)", "url": "https://github.com/vaadin/flow/pull/8051#discussion_r408185528", "createdAt": "2020-04-14T14:34:31Z", "author": {"login": "knoobie"}, "path": "flow-server/src/test/java/com/vaadin/flow/server/connect/VaadinConnectControllerTest.java", "diffHunk": "@@ -813,9 +813,34 @@ public void should_Never_UseSpringObjectMapper() {\n                 mock(ServletContext.class));\n \n         verify(contextMock, never()).getBean(ObjectMapper.class);\n+        verify(contextMock, times(1)).getBean(JacksonProperties.class);\n         verify(mockSpringObjectMapper, never()).setVisibility(\n                 PropertyAccessor.ALL, JsonAutoDetect.Visibility.ANY);\n-        verify(contextMock, never()).getBean(JacksonProperties.class);\n+    }\n+\n+    @Test\n+    public void should_NotOverrideVisibility_When_JacksonPropertiesProvideVisibility() {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "970c9d9add64de948a0922501851dfbb645406c1"}, "originalPosition": 11}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzkzNjQ4ODY4", "url": "https://github.com/vaadin/flow/pull/8051#pullrequestreview-393648868", "createdAt": "2020-04-15T10:28:43Z", "commit": {"oid": "970c9d9add64de948a0922501851dfbb645406c1"}, "state": "DISMISSED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "13e95bb21fdc87abeff05e31228a31e718e787b4", "author": {"user": {"login": "haijian-vaadin", "name": "Haijian Wang"}}, "url": "https://github.com/vaadin/flow/commit/13e95bb21fdc87abeff05e31228a31e718e787b4", "committedDate": "2020-04-15T19:24:15Z", "message": "add tests"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "556b1f8cda07697f0ec9213a763081ecdc0b0754", "author": {"user": {"login": "haijian-vaadin", "name": "Haijian Wang"}}, "url": "https://github.com/vaadin/flow/commit/556b1f8cda07697f0ec9213a763081ecdc0b0754", "committedDate": "2020-04-16T06:27:55Z", "message": "rest endpoint test refactor"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "5e02739be33ed15bb698f2650349012ff0e472fc", "author": {"user": {"login": "haijian-vaadin", "name": "Haijian Wang"}}, "url": "https://github.com/vaadin/flow/commit/5e02739be33ed15bb698f2650349012ff0e472fc", "committedDate": "2020-04-16T06:32:50Z", "message": "revert VaadinConnectTypeConversionEndpoints.java"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "91a618362ae2684fbad454ddcc67066fec330782", "author": {"user": {"login": "haijian-vaadin", "name": "Haijian Wang"}}, "url": "https://github.com/vaadin/flow/commit/91a618362ae2684fbad454ddcc67066fec330782", "committedDate": "2020-04-16T07:31:21Z", "message": "Remove the IT suffix from the test"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "6ef06f07362dbb3742717045d05ccf68963e20ec", "author": {"user": {"login": "haijian-vaadin", "name": "Haijian Wang"}}, "url": "https://github.com/vaadin/flow/commit/6ef06f07362dbb3742717045d05ccf68963e20ec", "committedDate": "2020-04-16T08:00:04Z", "message": "method renaming"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzk0NDE1OTA2", "url": "https://github.com/vaadin/flow/pull/8051#pullrequestreview-394415906", "createdAt": "2020-04-16T08:37:23Z", "commit": {"oid": "6ef06f07362dbb3742717045d05ccf68963e20ec"}, "state": "COMMENTED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzk0NDIzMzU4", "url": "https://github.com/vaadin/flow/pull/8051#pullrequestreview-394423358", "createdAt": "2020-04-16T08:47:15Z", "commit": {"oid": "6ef06f07362dbb3742717045d05ccf68963e20ec"}, "state": "COMMENTED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzk0NDIzNDQz", "url": "https://github.com/vaadin/flow/pull/8051#pullrequestreview-394423443", "createdAt": "2020-04-16T08:47:22Z", "commit": {"oid": "6ef06f07362dbb3742717045d05ccf68963e20ec"}, "state": "COMMENTED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzk0NDMzNTI5", "url": "https://github.com/vaadin/flow/pull/8051#pullrequestreview-394433529", "createdAt": "2020-04-16T08:59:44Z", "commit": {"oid": "6ef06f07362dbb3742717045d05ccf68963e20ec"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzk0NDMzNjY2", "url": "https://github.com/vaadin/flow/pull/8051#pullrequestreview-394433666", "createdAt": "2020-04-16T08:59:54Z", "commit": {"oid": "6ef06f07362dbb3742717045d05ccf68963e20ec"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b8a0fae8962ac8e7672464e7c55107fe8b081f72", "author": {"user": {"login": "haijian-vaadin", "name": "Haijian Wang"}}, "url": "https://github.com/vaadin/flow/commit/b8a0fae8962ac8e7672464e7c55107fe8b081f72", "committedDate": "2020-04-16T09:21:46Z", "message": "remove leftover code"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzk0NDUyMzIx", "url": "https://github.com/vaadin/flow/pull/8051#pullrequestreview-394452321", "createdAt": "2020-04-16T09:23:23Z", "commit": {"oid": "b8a0fae8962ac8e7672464e7c55107fe8b081f72"}, "state": "COMMENTED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzk0NDczNzM0", "url": "https://github.com/vaadin/flow/pull/8051#pullrequestreview-394473734", "createdAt": "2020-04-16T09:50:50Z", "commit": {"oid": "b8a0fae8962ac8e7672464e7c55107fe8b081f72"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "513e5c30cdd72f852e518c69272b66e01f1386e4", "author": {"user": {"login": "haijian-vaadin", "name": "Haijian Wang"}}, "url": "https://github.com/vaadin/flow/commit/513e5c30cdd72f852e518c69272b66e01f1386e4", "committedDate": "2020-04-16T10:01:42Z", "message": "code formatting"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "eef328a67a8fea4a0cec5822b09d5403aedb8463", "author": {"user": {"login": "haijian-vaadin", "name": "Haijian Wang"}}, "url": "https://github.com/vaadin/flow/commit/eef328a67a8fea4a0cec5822b09d5403aedb8463", "committedDate": "2020-04-16T10:18:01Z", "message": "code format"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzk0NTAwMzAw", "url": "https://github.com/vaadin/flow/pull/8051#pullrequestreview-394500300", "createdAt": "2020-04-16T10:26:28Z", "commit": {"oid": "eef328a67a8fea4a0cec5822b09d5403aedb8463"}, "state": "COMMENTED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "721ccba8f1d1858170055bd748119f5002ec1b04", "author": {"user": {"login": "haijian-vaadin", "name": "Haijian Wang"}}, "url": "https://github.com/vaadin/flow/commit/721ccba8f1d1858170055bd748119f5002ec1b04", "committedDate": "2020-04-16T11:40:11Z", "message": "code formatting"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzk0NTUxNTg3", "url": "https://github.com/vaadin/flow/pull/8051#pullrequestreview-394551587", "createdAt": "2020-04-16T11:45:23Z", "commit": {"oid": "721ccba8f1d1858170055bd748119f5002ec1b04"}, "state": "COMMENTED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzk0NTgzNTg3", "url": "https://github.com/vaadin/flow/pull/8051#pullrequestreview-394583587", "createdAt": "2020-04-16T12:31:19Z", "commit": {"oid": "721ccba8f1d1858170055bd748119f5002ec1b04"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 562, "cost": 1, "resetAt": "2021-10-28T19:08:13Z"}}}