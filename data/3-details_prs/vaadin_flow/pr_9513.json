{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTI4MjIzMzU2", "number": 9513, "title": "feat(offline): retry server navigation when back online", "bodyText": "Fixes #9207", "createdAt": "2020-11-26T18:24:10Z", "url": "https://github.com/vaadin/flow/pull/9513", "merged": true, "mergeCommit": {"oid": "a76218afa689394b9210f92497a36c9049339cbf"}, "closed": true, "closedAt": "2020-11-30T09:30:39Z", "author": {"login": "platosha"}, "timelineItems": {"totalCount": 8, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdgnsQdgBqjQwNDYxNzI3MDM=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdhhHWhAH2gAyNTI4MjIzMzU2OmYzZDYzYmEyZjFiMmIwYWJhZjJjYmFjYjljZmE4ZTU5ZTZiOWM5YjE=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "8c6f8bfee707b70dc849a20f487858d6b256f667", "author": {"user": {"login": "platosha", "name": "Anton Platonov"}}, "url": "https://github.com/vaadin/flow/commit/8c6f8bfee707b70dc849a20f487858d6b256f667", "committedDate": "2020-11-26T18:23:05Z", "message": "feat(offline): retry server navigation when back online\n\nFixes #9207"}, "afterCommit": {"oid": "2587aaa44d2d12407c19d5bb65451462e59b6843", "author": {"user": {"login": "platosha", "name": "Anton Platonov"}}, "url": "https://github.com/vaadin/flow/commit/2587aaa44d2d12407c19d5bb65451462e59b6843", "committedDate": "2020-11-27T13:37:14Z", "message": "feat(offline): retry server navigation when back online\n\nFixes #9207"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTQwMDEzMzcx", "url": "https://github.com/vaadin/flow/pull/9513#pullrequestreview-540013371", "createdAt": "2020-11-27T14:20:16Z", "commit": {"oid": "2587aaa44d2d12407c19d5bb65451462e59b6843"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0yN1QxNDoyMDoxNlrOH7AB3Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0yN1QxNDoyMDoxNlrOH7AB3Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMTYyODUwOQ==", "bodyText": "Was this file intended to be added?", "url": "https://github.com/vaadin/flow/pull/9513#discussion_r531628509", "createdAt": "2020-11-27T14:20:16Z", "author": {"login": "joheriks"}, "path": "flow-tests/test-ccdm-flow-navigation/sw.ts", "diffHunk": "@@ -0,0 +1,45 @@\n+/// <reference lib=\"webworker\" />\n+\n+importScripts('sw-runtime-resources-precache.js');\n+import {skipWaiting, clientsClaim} from 'workbox-core';\n+import {matchPrecache, precacheAndRoute} from 'workbox-precaching';\n+import {NavigationRoute, registerRoute} from 'workbox-routing';\n+import {PrecacheEntry} from 'workbox-precaching/_types';\n+import {NetworkOnly} from 'workbox-strategies';\n+\n+skipWaiting();\n+clientsClaim();\n+\n+const appShellPath = '/';\n+// @ts-ignore: OFFLINE_PATH_ENABLED and OFFLINE_PATH are defined by webpack.generated.js\n+const offlinePath = OFFLINE_PATH_ENABLED ? '/' + OFFLINE_PATH : appShellPath;\n+const networkOnly = new NetworkOnly();\n+const navigationFallback = new NavigationRoute(async (params: any) => {\n+  // Use offlinePath fallback if offline was detected\n+  if (!self.navigator.onLine) {\n+    const offlinePathPrecachedResponse = await matchPrecache(offlinePath);\n+    if (offlinePathPrecachedResponse) {\n+      return offlinePathPrecachedResponse;\n+    }\n+  }\n+\n+  // Sometimes navigator.onLine is not reliable, use fallback to offlinePath\n+  // also in case of network failure\n+  try {\n+    return await networkOnly.handle(params);\n+  } catch (error) {\n+    return (await matchPrecache(offlinePath)) || error;\n+  }\n+});\n+\n+registerRoute(navigationFallback);\n+\n+// @ts-ignore: __WB_MANIFEST is injected by the InjectManifest plugin\n+let manifestEntries: Array<PrecacheEntry> = self.__WB_MANIFEST;\n+// @ts-ignore: additionalManifestEntries is defined in sw-runtime-resources-precache.js\n+const additionalManifestEntries: Array<PrecacheEntry> = self.additionalManifestEntries;\n+if (additionalManifestEntries && additionalManifestEntries.length) {\n+  manifestEntries = [...manifestEntries, ...additionalManifestEntries];\n+}\n+\n+precacheAndRoute(manifestEntries);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "2587aaa44d2d12407c19d5bb65451462e59b6843"}, "originalPosition": 45}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "2587aaa44d2d12407c19d5bb65451462e59b6843", "author": {"user": {"login": "platosha", "name": "Anton Platonov"}}, "url": "https://github.com/vaadin/flow/commit/2587aaa44d2d12407c19d5bb65451462e59b6843", "committedDate": "2020-11-27T13:37:14Z", "message": "feat(offline): retry server navigation when back online\n\nFixes #9207"}, "afterCommit": {"oid": "504f4e62018b98d9206f7a23f89f5d4bd2428bbd", "author": {"user": {"login": "platosha", "name": "Anton Platonov"}}, "url": "https://github.com/vaadin/flow/commit/504f4e62018b98d9206f7a23f89f5d4bd2428bbd", "committedDate": "2020-11-27T17:33:50Z", "message": "feat(offline): retry server navigation when back online\n\nFixes #9207"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "9c2753319ff7e7a952cefcc01d963ca5aa19c7b8", "author": {"user": {"login": "platosha", "name": "Anton Platonov"}}, "url": "https://github.com/vaadin/flow/commit/9c2753319ff7e7a952cefcc01d963ca5aa19c7b8", "committedDate": "2020-11-27T17:35:34Z", "message": "feat(offline): retry server navigation when back online\n\nFixes #9207"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "504f4e62018b98d9206f7a23f89f5d4bd2428bbd", "author": {"user": {"login": "platosha", "name": "Anton Platonov"}}, "url": "https://github.com/vaadin/flow/commit/504f4e62018b98d9206f7a23f89f5d4bd2428bbd", "committedDate": "2020-11-27T17:33:50Z", "message": "feat(offline): retry server navigation when back online\n\nFixes #9207"}, "afterCommit": {"oid": "9c2753319ff7e7a952cefcc01d963ca5aa19c7b8", "author": {"user": {"login": "platosha", "name": "Anton Platonov"}}, "url": "https://github.com/vaadin/flow/commit/9c2753319ff7e7a952cefcc01d963ca5aa19c7b8", "committedDate": "2020-11-27T17:35:34Z", "message": "feat(offline): retry server navigation when back online\n\nFixes #9207"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTQwNjU5NjEz", "url": "https://github.com/vaadin/flow/pull/9513#pullrequestreview-540659613", "createdAt": "2020-11-30T07:47:12Z", "commit": {"oid": "9c2753319ff7e7a952cefcc01d963ca5aa19c7b8"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTQwNjg2NTU0", "url": "https://github.com/vaadin/flow/pull/9513#pullrequestreview-540686554", "createdAt": "2020-11-30T08:31:08Z", "commit": {"oid": "9c2753319ff7e7a952cefcc01d963ca5aa19c7b8"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f3d63ba2f1b2b0abaf2cbacb9cfa8e59e6b9c9b1", "author": {"user": {"login": "haijian-vaadin", "name": "Haijian Wang"}}, "url": "https://github.com/vaadin/flow/commit/f3d63ba2f1b2b0abaf2cbacb9cfa8e59e6b9c9b1", "committedDate": "2020-11-30T08:31:38Z", "message": "Merge branch 'feature/offline' into ap/feature/offline-heartbeat-and-reload"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4580, "cost": 1, "resetAt": "2021-10-28T20:13:43Z"}}}