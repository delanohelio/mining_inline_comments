{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTA2MTM0MjY3", "number": 9200, "reviewThreads": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yMVQwNDo0MDo1MlrOEwEanQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yM1QxMTozNjo0NVrOExKxPw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzE4ODM5NDUzOnYy", "diffSide": "RIGHT", "path": "flow-client/src/main/resources/META-INF/resources/frontend/Flow.ts", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yMVQwNDo0MDo1MlrOHlZ_8g==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yMVQwNDo0MDo1MlrOHlZ_8g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwODk4NTMzMA==", "bodyText": "Maybe we should also check if a custom offlinePath is defined. Otherwise, Anton's PR won't work.", "url": "https://github.com/vaadin/flow/pull/9200#discussion_r508985330", "createdAt": "2020-10-21T04:40:52Z", "author": {"login": "haijian-vaadin"}, "path": "flow-client/src/main/resources/META-INF/resources/frontend/Flow.ts", "diffHunk": "@@ -117,11 +117,26 @@ export class Flow {\n       // Store last action pathname so as we can check it in events\n       this.pathname = params.pathname;\n \n-      await this.flowInit();\n-      // When an action happens, navigation will be resolved `onBeforeEnter`\n-      this.container.onBeforeEnter = (ctx, cmd) => this.flowNavigate(ctx, cmd);\n-      // For covering the 'server -> client' use case\n-      this.container.onBeforeLeave = (ctx, cmd) => this.flowLeave(ctx, cmd);\n+      if (navigator.onLine) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "93d51943b80baa2662298475f55806319b2b0c9c"}, "originalPosition": 18}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzE5OTkyMTI3OnYy", "diffSide": "RIGHT", "path": "flow-client/src/main/resources/META-INF/resources/frontend/Flow.ts", "isResolved": true, "comments": {"totalCount": 6, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yM1QxMTozNjo0NVrOHnKHOQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yNlQxOTo0MTo0M1rOHofjfA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMDgyMjIwMQ==", "bodyText": "onLine could be false positive, for example, if there is a network but it is not functional.\nIt would be nice to have a fallback for this use case as well. Something like:\nif (!navigator.onLine) {\n  await this.showOfflineStub();\n} else {\n  try {\n    await this.flowInit();\n  } catch(error) {\n    await this.showOfflineStub();\n  }\n}", "url": "https://github.com/vaadin/flow/pull/9200#discussion_r510822201", "createdAt": "2020-10-23T11:36:45Z", "author": {"login": "platosha"}, "path": "flow-client/src/main/resources/META-INF/resources/frontend/Flow.ts", "diffHunk": "@@ -117,7 +117,17 @@ export class Flow {\n       // Store last action pathname so as we can check it in events\n       this.pathname = params.pathname;\n \n-      await this.flowInit();\n+      if (navigator.onLine) {\n+        // @ts-ignore\n+        await this.flowInit();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "e43a038429751014b6ceffe6efa4c22db07b25b8"}, "originalPosition": 16}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMDkzMzE0NQ==", "bodyText": "Good idea, updated to show the offline stub also in the failed connection case. Only unit test for this one though, as setting up the scenario in IT gets unnecessarily complicated.", "url": "https://github.com/vaadin/flow/pull/9200#discussion_r510933145", "createdAt": "2020-10-23T14:42:32Z", "author": {"login": "joheriks"}, "path": "flow-client/src/main/resources/META-INF/resources/frontend/Flow.ts", "diffHunk": "@@ -117,7 +117,17 @@ export class Flow {\n       // Store last action pathname so as we can check it in events\n       this.pathname = params.pathname;\n \n-      await this.flowInit();\n+      if (navigator.onLine) {\n+        // @ts-ignore\n+        await this.flowInit();", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMDgyMjIwMQ=="}, "originalCommit": {"oid": "e43a038429751014b6ceffe6efa4c22db07b25b8"}, "originalPosition": 16}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMTc2Njc2NA==", "bodyText": "Should it also check what kind of error it is? simply catching all the errors might lead to a confusing situation, e.g. when the server throws some exception and the user suddenly sees an offline page.", "url": "https://github.com/vaadin/flow/pull/9200#discussion_r511766764", "createdAt": "2020-10-26T07:46:21Z", "author": {"login": "haijian-vaadin"}, "path": "flow-client/src/main/resources/META-INF/resources/frontend/Flow.ts", "diffHunk": "@@ -117,7 +117,17 @@ export class Flow {\n       // Store last action pathname so as we can check it in events\n       this.pathname = params.pathname;\n \n-      await this.flowInit();\n+      if (navigator.onLine) {\n+        // @ts-ignore\n+        await this.flowInit();", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMDgyMjIwMQ=="}, "originalCommit": {"oid": "e43a038429751014b6ceffe6efa4c22db07b25b8"}, "originalPosition": 16}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMTkzMjcxOA==", "bodyText": "The logic of flowInitUI wraps a XMLHttpRequest with a promise that is rejected only onerror. This SO thread  concludes that onerror only triggers for network-level errors (e.g., no internet, DNS lookup failure, same-origin violation, etc.). It does not trigger for irregular HTTP response code such as 404, 501, etc. I added a specific exception raised there so that offline stub is not shown for other exceptions raised within flowInitUI (instead the user will see the infinitely blinking loading indicator as before).", "url": "https://github.com/vaadin/flow/pull/9200#discussion_r511932718", "createdAt": "2020-10-26T12:47:16Z", "author": {"login": "joheriks"}, "path": "flow-client/src/main/resources/META-INF/resources/frontend/Flow.ts", "diffHunk": "@@ -117,7 +117,17 @@ export class Flow {\n       // Store last action pathname so as we can check it in events\n       this.pathname = params.pathname;\n \n-      await this.flowInit();\n+      if (navigator.onLine) {\n+        // @ts-ignore\n+        await this.flowInit();", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMDgyMjIwMQ=="}, "originalCommit": {"oid": "e43a038429751014b6ceffe6efa4c22db07b25b8"}, "originalPosition": 16}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMjE5NjEwNw==", "bodyText": "Looks good!\nJust found one small improvement that can be made. I think we could also hide the loading indicator (the hideLoading() method), otherwise when the server is not reachable, it shows the loading indicator indefinitely.", "url": "https://github.com/vaadin/flow/pull/9200#discussion_r512196107", "createdAt": "2020-10-26T18:55:28Z", "author": {"login": "haijian-vaadin"}, "path": "flow-client/src/main/resources/META-INF/resources/frontend/Flow.ts", "diffHunk": "@@ -117,7 +117,17 @@ export class Flow {\n       // Store last action pathname so as we can check it in events\n       this.pathname = params.pathname;\n \n-      await this.flowInit();\n+      if (navigator.onLine) {\n+        // @ts-ignore\n+        await this.flowInit();", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMDgyMjIwMQ=="}, "originalCommit": {"oid": "e43a038429751014b6ceffe6efa4c22db07b25b8"}, "originalPosition": 16}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMjIyMjA3Ng==", "bodyText": "Done.", "url": "https://github.com/vaadin/flow/pull/9200#discussion_r512222076", "createdAt": "2020-10-26T19:41:43Z", "author": {"login": "joheriks"}, "path": "flow-client/src/main/resources/META-INF/resources/frontend/Flow.ts", "diffHunk": "@@ -117,7 +117,17 @@ export class Flow {\n       // Store last action pathname so as we can check it in events\n       this.pathname = params.pathname;\n \n-      await this.flowInit();\n+      if (navigator.onLine) {\n+        // @ts-ignore\n+        await this.flowInit();", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMDgyMjIwMQ=="}, "originalCommit": {"oid": "e43a038429751014b6ceffe6efa4c22db07b25b8"}, "originalPosition": 16}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2945, "cost": 1, "resetAt": "2021-11-13T12:26:42Z"}}}