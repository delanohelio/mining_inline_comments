{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTM0Mzc1Mjcy", "number": 9604, "title": "fix(TypeScript): binder should allow typing decimal numbers", "bodyText": "Fixes #9521\nFixes #9522", "createdAt": "2020-12-08T11:10:01Z", "url": "https://github.com/vaadin/flow/pull/9604", "merged": true, "mergeCommit": {"oid": "f946d33f4fb0df4ce9f8f0202c6ba2f4491815f3"}, "closed": true, "closedAt": "2020-12-16T10:44:35Z", "author": {"login": "platosha"}, "timelineItems": {"totalCount": 13, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdkwIpmAFqTU0OTAxMjA1NA==", "endCursor": "Y3Vyc29yOnYyOpPPAAABdmYuFegFqTU1MjM2MDc4MQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTQ5MDEyMDU0", "url": "https://github.com/vaadin/flow/pull/9604#pullrequestreview-549012054", "createdAt": "2020-12-10T09:41:13Z", "commit": {"oid": "71564b9bf121b708d6154aca60908e6c966182bb"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xMFQwOTo0MToxM1rOIDAHwA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xMFQwOTo0MToxM1rOIDAHwA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MDAxODYyNA==", "bodyText": "redundant string?", "url": "https://github.com/vaadin/flow/pull/9604#discussion_r540018624", "createdAt": "2020-12-10T09:41:13Z", "author": {"login": "haijian-vaadin"}, "path": "flow-client/src/main/resources/META-INF/resources/frontend/form/Validators.ts", "diffHunk": "@@ -56,15 +56,30 @@ export class Required<T> extends AbstractValidator<T> {\n   }\n }\n \n-function _asValidatorAttributes(attrs: ValueNumberAttributes | number | string | PatternAttributes | RegExp) {\n+function _asValidatorAttributes(attrs: ValueNumberAttributes | number | string | PatternAttributes | string | RegExp) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "71564b9bf121b708d6154aca60908e6c966182bb"}, "originalPosition": 14}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "71564b9bf121b708d6154aca60908e6c966182bb", "author": {"user": {"login": "platosha", "name": "Anton Platonov"}}, "url": "https://github.com/vaadin/flow/commit/71564b9bf121b708d6154aca60908e6c966182bb", "committedDate": "2020-12-08T11:08:33Z", "message": "WIP: fix(TypeScript): binder should allow typing decimal numbers\n\nFixes #9521\nFixes #9522"}, "afterCommit": {"oid": "69335e574566c0673a9e9abd6bbbf4a48f69d595", "author": {"user": {"login": "platosha", "name": "Anton Platonov"}}, "url": "https://github.com/vaadin/flow/commit/69335e574566c0673a9e9abd6bbbf4a48f69d595", "committedDate": "2020-12-10T19:27:54Z", "message": "WIP: fix(TypeScript): binder should allow typing decimal numbers\n\nFixes #9521\nFixes #9522"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "69335e574566c0673a9e9abd6bbbf4a48f69d595", "author": {"user": {"login": "platosha", "name": "Anton Platonov"}}, "url": "https://github.com/vaadin/flow/commit/69335e574566c0673a9e9abd6bbbf4a48f69d595", "committedDate": "2020-12-10T19:27:54Z", "message": "WIP: fix(TypeScript): binder should allow typing decimal numbers\n\nFixes #9521\nFixes #9522"}, "afterCommit": {"oid": "2740b6d06ea197d906f0139f82f2540ebb457394", "author": {"user": {"login": "platosha", "name": "Anton Platonov"}}, "url": "https://github.com/vaadin/flow/commit/2740b6d06ea197d906f0139f82f2540ebb457394", "committedDate": "2020-12-10T19:28:20Z", "message": "WIP: fix(TypeScript): binder should allow typing decimal numbers\n\nFixes #9521\nFixes #9522"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "21f4d5a31c5b0d86785b2423daa2d63bbadcea17", "author": {"user": {"login": "platosha", "name": "Anton Platonov"}}, "url": "https://github.com/vaadin/flow/commit/21f4d5a31c5b0d86785b2423daa2d63bbadcea17", "committedDate": "2020-12-11T16:04:33Z", "message": "fix linter error"}, "afterCommit": {"oid": "323bc1595870d641ac5b06faebff8311d9b769e1", "author": {"user": {"login": "platosha", "name": "Anton Platonov"}}, "url": "https://github.com/vaadin/flow/commit/323bc1595870d641ac5b06faebff8311d9b769e1", "committedDate": "2020-12-14T13:06:17Z", "message": "fix: disallow incorrect decimal separator (,) and extra characters"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "323bc1595870d641ac5b06faebff8311d9b769e1", "author": {"user": {"login": "platosha", "name": "Anton Platonov"}}, "url": "https://github.com/vaadin/flow/commit/323bc1595870d641ac5b06faebff8311d9b769e1", "committedDate": "2020-12-14T13:06:17Z", "message": "fix: disallow incorrect decimal separator (,) and extra characters"}, "afterCommit": {"oid": "5382d7d9cf75cd72f10a87d564aeea4f537d1612", "author": {"user": {"login": "platosha", "name": "Anton Platonov"}}, "url": "https://github.com/vaadin/flow/commit/5382d7d9cf75cd72f10a87d564aeea4f537d1612", "committedDate": "2020-12-14T13:04:14Z", "message": "fix: disallow incorrect decimal separator (,) and extra characters"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f25cfa0985233350ea45979475111a22b1775762", "author": {"user": {"login": "platosha", "name": "Anton Platonov"}}, "url": "https://github.com/vaadin/flow/commit/f25cfa0985233350ea45979475111a22b1775762", "committedDate": "2020-12-14T13:08:50Z", "message": "WIP: fix(TypeScript): binder should allow typing decimal numbers\n\nFixes #9521\nFixes #9522"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c179aba54392d81a8aba8d2f235d0678e7562648", "author": {"user": {"login": "platosha", "name": "Anton Platonov"}}, "url": "https://github.com/vaadin/flow/commit/c179aba54392d81a8aba8d2f235d0678e7562648", "committedDate": "2020-12-14T13:08:50Z", "message": "fix linter error"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "180d8fd3f06b19e107d77e6d170989f22c3e7057", "author": {"user": {"login": "platosha", "name": "Anton Platonov"}}, "url": "https://github.com/vaadin/flow/commit/180d8fd3f06b19e107d77e6d170989f22c3e7057", "committedDate": "2020-12-14T13:08:50Z", "message": "fix: disallow incorrect decimal separator (,) and extra characters"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "5382d7d9cf75cd72f10a87d564aeea4f537d1612", "author": {"user": {"login": "platosha", "name": "Anton Platonov"}}, "url": "https://github.com/vaadin/flow/commit/5382d7d9cf75cd72f10a87d564aeea4f537d1612", "committedDate": "2020-12-14T13:04:14Z", "message": "fix: disallow incorrect decimal separator (,) and extra characters"}, "afterCommit": {"oid": "180d8fd3f06b19e107d77e6d170989f22c3e7057", "author": {"user": {"login": "platosha", "name": "Anton Platonov"}}, "url": "https://github.com/vaadin/flow/commit/180d8fd3f06b19e107d77e6d170989f22c3e7057", "committedDate": "2020-12-14T13:08:50Z", "message": "fix: disallow incorrect decimal separator (,) and extra characters"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "4c64e78daebd42962f58d510bbae841d6d7b75e4", "author": {"user": {"login": "platosha", "name": "Anton Platonov"}}, "url": "https://github.com/vaadin/flow/commit/4c64e78daebd42962f58d510bbae841d6d7b75e4", "committedDate": "2020-12-14T15:36:47Z", "message": "fix linter errors"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTUxODE5MDEy", "url": "https://github.com/vaadin/flow/pull/9604#pullrequestreview-551819012", "createdAt": "2020-12-14T19:22:51Z", "commit": {"oid": "4c64e78daebd42962f58d510bbae841d6d7b75e4"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xNFQxOToyMjo1MlrOIFiToQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xNFQxOTozMzozMVrOIFjC2Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MjY3NTg3Mw==", "bodyText": "remove debugger?", "url": "https://github.com/vaadin/flow/pull/9604#discussion_r542675873", "createdAt": "2020-12-14T19:22:52Z", "author": {"login": "haijian-vaadin"}, "path": "flow-client/src/test/frontend/form/FieldTests.ts", "diffHunk": "@@ -311,6 +394,76 @@ suite(\"form/Field\", () => {\n       sinon.assert.calledTwice(orderViewWithInput.customerFullNameField!.setAttributeSpy);\n       sinon.assert.calledOnce(orderViewWithInput.customerNickNameField!.setAttributeSpy);\n     });\n+\n+    suite('number model', () => {\n+      let view: OrderViewWithInput,\n+        priorityField: MockInputElement,\n+        binder: Binder<Order, OrderModel>;\n+\n+      beforeEach(async () => {\n+        view = orderViewWithInput;\n+        binder = view.binder;\n+        priorityField = view.priorityField!;\n+      });\n+\n+      test('should set initial zero', async () => {\n+        expect(priorityField.value).to.equal('0');\n+      });\n+\n+      test('should set number value from binder', async () => {\n+        priorityField.valueSpy.get.resetHistory();\n+        priorityField.valueSpy.set.resetHistory();\n+\n+        binder.for(binder.model.priority).value = 1.2;\n+        await view.updateComplete;\n+        sinon.assert.calledOnceWithExactly(priorityField.valueSpy.set, 1.2);\n+      });\n+\n+      test('should update binder value on typing', async () => {\n+        const cases: Array<[string, number]> = [\n+          ['1', 1],\n+          ['1.', NaN], // not allowed format\n+          ['1.2', 1.2],\n+          ['', NaN],\n+          ['not a number', NaN],\n+          ['.', NaN],\n+          ['.1', 0.1],\n+          // Invalid separator\n+          [',', NaN],\n+          [',2', NaN],\n+          ['1,', NaN],\n+          ['1,2', NaN]\n+        ];\n+\n+        for (const [inputValue, expectedNumber] of cases) {\n+          for (const eventName of ['input', 'change']) {\n+            debugger;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "4c64e78daebd42962f58d510bbae841d6d7b75e4"}, "originalPosition": 190}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MjY4MzMzOQ==", "bodyText": "Maybe we could add validations for 1,2, 1,abc, abc etc?", "url": "https://github.com/vaadin/flow/pull/9604#discussion_r542683339", "createdAt": "2020-12-14T19:29:20Z", "author": {"login": "haijian-vaadin"}, "path": "flow-client/src/test/frontend/form/ValidatorsTests.ts", "diffHunk": "@@ -120,6 +121,18 @@ suite(\"form/Validators\", () => {\n     assert.isFalse(validator.validate(true));\n   });\n \n+  test('IsNumber', () => {\n+    const validator = new IsNumber();\n+    assert.isNotTrue(validator.impliesRequired);\n+    assert.isTrue(validator.validate(0));\n+    assert.isTrue(validator.validate(1));\n+    assert.isTrue(validator.validate(1.2));", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "4c64e78daebd42962f58d510bbae841d6d7b75e4"}, "originalPosition": 17}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MjY4Nzk2MQ==", "bodyText": "remove debugger?", "url": "https://github.com/vaadin/flow/pull/9604#discussion_r542687961", "createdAt": "2020-12-14T19:33:31Z", "author": {"login": "haijian-vaadin"}, "path": "flow-client/src/test/frontend/form/FieldTests.ts", "diffHunk": "@@ -311,6 +394,76 @@ suite(\"form/Field\", () => {\n       sinon.assert.calledTwice(orderViewWithInput.customerFullNameField!.setAttributeSpy);\n       sinon.assert.calledOnce(orderViewWithInput.customerNickNameField!.setAttributeSpy);\n     });\n+\n+    suite('number model', () => {\n+      let view: OrderViewWithInput,\n+        priorityField: MockInputElement,\n+        binder: Binder<Order, OrderModel>;\n+\n+      beforeEach(async () => {\n+        view = orderViewWithInput;\n+        binder = view.binder;\n+        priorityField = view.priorityField!;\n+      });\n+\n+      test('should set initial zero', async () => {\n+        expect(priorityField.value).to.equal('0');\n+      });\n+\n+      test('should set number value from binder', async () => {\n+        priorityField.valueSpy.get.resetHistory();\n+        priorityField.valueSpy.set.resetHistory();\n+\n+        binder.for(binder.model.priority).value = 1.2;\n+        await view.updateComplete;\n+        sinon.assert.calledOnceWithExactly(priorityField.valueSpy.set, 1.2);\n+      });\n+\n+      test('should update binder value on typing', async () => {\n+        const cases: Array<[string, number]> = [\n+          ['1', 1],\n+          ['1.', NaN], // not allowed format\n+          ['1.2', 1.2],\n+          ['', NaN],\n+          ['not a number', NaN],\n+          ['.', NaN],\n+          ['.1', 0.1],\n+          // Invalid separator\n+          [',', NaN],\n+          [',2', NaN],\n+          ['1,', NaN],\n+          ['1,2', NaN]\n+        ];\n+\n+        for (const [inputValue, expectedNumber] of cases) {\n+          for (const eventName of ['input', 'change']) {\n+            debugger;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "4c64e78daebd42962f58d510bbae841d6d7b75e4"}, "originalPosition": 190}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "3b8fa6df48306f57073acb02ee63bcd82461818e", "author": {"user": {"login": "platosha", "name": "Anton Platonov"}}, "url": "https://github.com/vaadin/flow/commit/3b8fa6df48306f57073acb02ee63bcd82461818e", "committedDate": "2020-12-15T10:28:28Z", "message": "cleaup: remove debugger"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTUyMzYwNzgx", "url": "https://github.com/vaadin/flow/pull/9604#pullrequestreview-552360781", "createdAt": "2020-12-15T11:34:25Z", "commit": {"oid": "3b8fa6df48306f57073acb02ee63bcd82461818e"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4654, "cost": 1, "resetAt": "2021-10-28T20:13:43Z"}}}