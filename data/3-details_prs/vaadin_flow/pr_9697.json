{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTQyNjg2OTA2", "number": 9697, "title": "chore: improve stability of two tests", "bodyText": "Contains two stabilising fixes:\n\nA rare fluke (also in master) occurs in FlowTests when the setTimeout calls intended to simulate asynchronous server response in stubServerRemoteFunction complete after the unit test, when afterEach has already deleted window.Vaadin. This causing Flow.loadingFinished ran by Flow.serverConnected to crash between the tests. The fix cancels all timers between in afterEach.\nWith the right heartbeat timing, the browser console inLogoutIT can contain a session expiration message. The fix relaxes the acceptable console errors in the IT.", "createdAt": "2020-12-18T17:46:57Z", "url": "https://github.com/vaadin/flow/pull/9697", "merged": true, "mergeCommit": {"oid": "6b06affa412d452120d970d3c9eb572d56c81240"}, "closed": true, "closedAt": "2020-12-21T08:38:51Z", "author": {"login": "joheriks"}, "timelineItems": {"totalCount": 7, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdnbkKWgH2gAyNTQyNjg2OTA2OmFhYjE5MTUzNGMzZjBhY2U2ZmY5YWRlNjZiYTZmZDg4YzU4YzM5MDQ=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdoRaKTAFqTU1NjE5NTc1NA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "aab191534c3f0ace6ff9ade66ba6fd88c58c3904", "author": {"user": {"login": "joheriks", "name": "Johannes Eriksson"}}, "url": "https://github.com/vaadin/flow/commit/aab191534c3f0ace6ff9ade66ba6fd88c58c3904", "committedDate": "2020-12-18T17:27:13Z", "message": "chore: clear timers between tests"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b765461dd23f07925f884bfd9e7b3d4175448daf", "author": {"user": {"login": "joheriks", "name": "Johannes Eriksson"}}, "url": "https://github.com/vaadin/flow/commit/b765461dd23f07925f884bfd9e7b3d4175448daf", "committedDate": "2020-12-18T17:28:08Z", "message": "chore: accept a session expiration message in LogoutIT"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTU1NzAxNzcz", "url": "https://github.com/vaadin/flow/pull/9697#pullrequestreview-555701773", "createdAt": "2020-12-18T18:04:49Z", "commit": {"oid": "b765461dd23f07925f884bfd9e7b3d4175448daf"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xOFQxODowNDo1MFrOIItKdA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xOFQxODowNDo1MFrOIItKdA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NTk5OTQ3Ng==", "bodyText": "Is this commented line needed?", "url": "https://github.com/vaadin/flow/pull/9697#discussion_r545999476", "createdAt": "2020-12-18T18:04:50Z", "author": {"login": "haijian-vaadin"}, "path": "flow-client/src/test/frontend/FlowTests.ts", "diffHunk": "@@ -488,20 +492,23 @@ suite(\"Flow\", () => {\n             return {cancel: true};\n           }})\n           .then(obj => assert.isTrue(obj.cancel));\n-\n       });\n   });\n \n-  test(\"onBeforeLeave should cancel `server->client` navigation\", () => {\n+  test(\"onBeforeLeave should cancel `server->client` navigation\", async () => {\n     // true to prevent navigation from server\n     stubServerRemoteFunction('foobar-12345', true);\n     mockInitResponse('foobar-12345');\n \n+    await new Promise(resolve => setTimeout(resolve, 150));\n+\n     const flow = new Flow();\n     const route = flow.serverSideRoutes[0];\n \n     return route.action({pathname: 'Foo'})\n       .then((elem: any) => {\n+        //await new Promise(resolve => setTimeout(resolve, 500));", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b765461dd23f07925f884bfd9e7b3d4175448daf"}, "originalPosition": 34}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "5cb454ab070d531ed58a86c2786a66c205240bdf", "author": {"user": {"login": "joheriks", "name": "Johannes Eriksson"}}, "url": "https://github.com/vaadin/flow/commit/5cb454ab070d531ed58a86c2786a66c205240bdf", "committedDate": "2020-12-18T18:06:03Z", "message": "fix: removed waits"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTU1NzExODY1", "url": "https://github.com/vaadin/flow/pull/9697#pullrequestreview-555711865", "createdAt": "2020-12-18T18:19:22Z", "commit": {"oid": "5cb454ab070d531ed58a86c2786a66c205240bdf"}, "state": "DISMISSED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "3dd60903e10d33ca879fe0309470ba1463a9fe93", "author": {"user": {"login": "joheriks", "name": "Johannes Eriksson"}}, "url": "https://github.com/vaadin/flow/commit/3dd60903e10d33ca879fe0309470ba1463a9fe93", "committedDate": "2020-12-18T22:55:08Z", "message": "fix: remove unnecessary async"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTU2MTk1NzU0", "url": "https://github.com/vaadin/flow/pull/9697#pullrequestreview-556195754", "createdAt": "2020-12-21T08:11:10Z", "commit": {"oid": "3dd60903e10d33ca879fe0309470ba1463a9fe93"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 803, "cost": 1, "resetAt": "2021-10-28T19:08:13Z"}}}