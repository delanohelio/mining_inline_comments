{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDg3MTAzMzgz", "number": 9008, "title": "Read text for template element", "bodyText": "Fixes #8975", "createdAt": "2020-09-15T07:41:07Z", "url": "https://github.com/vaadin/flow/pull/9008", "merged": true, "mergeCommit": {"oid": "db04da7f008c3d62ec35bab68ad203c7582d994d"}, "closed": true, "closedAt": "2020-09-17T12:49:05Z", "author": {"login": "denis-anisimov"}, "timelineItems": {"totalCount": 13, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdJJgTbgFqTQ4ODczODg1NQ==", "endCursor": "Y3Vyc29yOnYyOpPPAAABdJwcN2gFqTQ5MDU1NTc0Ng==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDg4NzM4ODU1", "url": "https://github.com/vaadin/flow/pull/9008#pullrequestreview-488738855", "createdAt": "2020-09-15T14:22:56Z", "commit": {"oid": "1404cad33cddefe87cdc0eca742c25ec7f5557bb"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xNVQxNDoyMjo1NlrOHSEa2A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xNVQxNToyNTozN1rOHSHZ-Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4ODcwODgyNA==", "bodyText": "Method could be compacted to one-liner using computeIfAbsent.", "url": "https://github.com/vaadin/flow/pull/9008#discussion_r488708824", "createdAt": "2020-09-15T14:22:56Z", "author": {"login": "joheriks"}, "path": "flow-server/src/main/java/com/vaadin/flow/component/polymertemplate/IdCollector.java", "diffHunk": "@@ -194,4 +196,23 @@ private void setAttributeData(Attribute attribute,\n     private boolean isBooleanAttribute(Attribute attribute) {\n         return attribute.getKey().equals(attribute.toString());\n     }\n+\n+    private Map<String, String> getAttributeData(String id) {\n+        Map<String, String> map = attributesById.get(id);\n+        if (map == null) {\n+            map = new HashMap<>();\n+            attributesById.put(id, map);\n+        }\n+        return map;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "1404cad33cddefe87cdc0eca742c25ec7f5557bb"}, "originalPosition": 48}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4ODcyNDAwOQ==", "bodyText": "Could be final", "url": "https://github.com/vaadin/flow/pull/9008#discussion_r488724009", "createdAt": "2020-09-15T14:42:11Z", "author": {"login": "joheriks"}, "path": "flow-server/src/main/java/com/vaadin/flow/component/template/internal/AbstractInjectableElementInitializer.java", "diffHunk": "@@ -34,6 +34,15 @@\n public abstract class AbstractInjectableElementInitializer\n         implements Consumer<Map<String, String>> {\n \n+    /**\n+     * Represents text key which should be set to an {@link Element} via\n+     * {@link Element#setText(String)}.\n+     * <p>\n+     * The real attribute may not contain {@code \"=\"} sign in the name so it's\n+     * safe to use this special key for text value in a map.\n+     */\n+    public static String TEXT_DATA = \"=text\";", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "1404cad33cddefe87cdc0eca742c25ec7f5557bb"}, "originalPosition": 11}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4ODc1Nzc1Mw==", "bodyText": "The assertion on the order indeed seems more sensible after the change, so the order was wrong before and there is a bug fixed also?\nI find the assertions messy after this change, as some of the calls to assertNodeOrder will be with the concated texts and some with separate parameters. Would be easier to understand and modify if the \\n were removed from the inserted text pieces in the test views and the assertion changed to simply:\n    private void assertNodeOrder(WebElement container, String... nodes) {\n        String texts = container.getText().replace(\"\\n\", \"\");\n        String expected = String.join(\"\", nodes);\n        Assert.assertEquals(expected, texts);\n    }\nThat would abstract away from the extra complication of whitespace between the added nodes. Unless for some reason that is actually part of the test?", "url": "https://github.com/vaadin/flow/pull/9008#discussion_r488757753", "createdAt": "2020-09-15T15:25:37Z", "author": {"login": "joheriks"}, "path": "flow-tests/test-root-context/src/test/java/com/vaadin/flow/uitest/ui/template/ChildOrderIT.java", "diffHunk": "@@ -163,29 +163,28 @@ public void prependTextsFromServer_textsAreAddedBeforeExistingOnes() {\n         assertNodeOrder(container, \"Client text\");\n \n         clickAndWaitForContainerToChange(container, \"prependChildToContainer2\");\n-        assertNodeOrder(container, \"Client text\", \"Server text 1\");\n+        assertNodeOrder(container, \"Server text 1Client text\");\n \n         clickAndWaitForContainerToChange(container, \"prependChildToContainer2\");\n-        assertNodeOrder(container, \"Client text\", \"Server text 2\",\n-                \"Server text 1\");\n+        assertNodeOrder(container, \"Server text 2\", \"Server text 1Client text\");", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "1404cad33cddefe87cdc0eca742c25ec7f5557bb"}, "originalPosition": 10}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "a0174e523d82dc29f18911ff67d7178b4f93b98f", "author": {"user": null}, "url": "https://github.com/vaadin/flow/commit/a0174e523d82dc29f18911ff67d7178b4f93b98f", "committedDate": "2020-09-16T06:18:00Z", "message": "Improve code a bit based on review"}, "afterCommit": {"oid": "24701f0a1148245a22e233c1bc20d6ae5f720605", "author": {"user": null}, "url": "https://github.com/vaadin/flow/commit/24701f0a1148245a22e233c1bc20d6ae5f720605", "committedDate": "2020-09-16T12:42:16Z", "message": "Improve code a bit based on review"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e8fec4595e231062dbc71024599009a279177602", "author": {"user": null}, "url": "https://github.com/vaadin/flow/commit/e8fec4595e231062dbc71024599009a279177602", "committedDate": "2020-09-17T09:47:43Z", "message": "Read text content as an attribute data"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b01556d156ee704c7bf572fca7d7c790e13c5e86", "author": {"user": null}, "url": "https://github.com/vaadin/flow/commit/b01556d156ee704c7bf572fca7d7c790e13c5e86", "committedDate": "2020-09-17T09:47:44Z", "message": "Add unit tests for template element set text"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "8ca4a9a2105973f42ef7ef25ecdc1a4e65436f39", "author": {"user": null}, "url": "https://github.com/vaadin/flow/commit/8ca4a9a2105973f42ef7ef25ecdc1a4e65436f39", "committedDate": "2020-09-17T09:47:44Z", "message": "Add IT for template element set text"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "cc9aea88d7b2dc2f882006adcd1612ae8e65f269", "author": {"user": null}, "url": "https://github.com/vaadin/flow/commit/cc9aea88d7b2dc2f882006adcd1612ae8e65f269", "committedDate": "2020-09-17T09:47:44Z", "message": "Update IT after change for reading text"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b0b96b1b75a9cd2c3f31359c9104dfb451c61e36", "author": {"user": null}, "url": "https://github.com/vaadin/flow/commit/b0b96b1b75a9cd2c3f31359c9104dfb451c61e36", "committedDate": "2020-09-17T09:47:45Z", "message": "Improve code a bit based on review"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b6857b887f509973624fd8a169162068b9c206c8", "author": {"user": null}, "url": "https://github.com/vaadin/flow/commit/b6857b887f509973624fd8a169162068b9c206c8", "committedDate": "2020-09-17T09:47:45Z", "message": "Add missed tag for the component"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a79443097b5164a55a2656f6f260f329687ac34e", "author": {"user": null}, "url": "https://github.com/vaadin/flow/commit/a79443097b5164a55a2656f6f260f329687ac34e", "committedDate": "2020-09-17T09:47:46Z", "message": "Remove extra symbol"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "6eeb9aa4d125d2f53fa1583b76eee23fa7b830db", "author": {"user": null}, "url": "https://github.com/vaadin/flow/commit/6eeb9aa4d125d2f53fa1583b76eee23fa7b830db", "committedDate": "2020-09-17T09:47:46Z", "message": "Add lost lines after merge"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "30a4c45ec9ddbbb0edddec0ef018e2ba06ae063f", "author": {"user": null}, "url": "https://github.com/vaadin/flow/commit/30a4c45ec9ddbbb0edddec0ef018e2ba06ae063f", "committedDate": "2020-09-17T06:13:40Z", "message": "Add lost lines after merge"}, "afterCommit": {"oid": "6eeb9aa4d125d2f53fa1583b76eee23fa7b830db", "author": {"user": null}, "url": "https://github.com/vaadin/flow/commit/6eeb9aa4d125d2f53fa1583b76eee23fa7b830db", "committedDate": "2020-09-17T09:47:46Z", "message": "Add lost lines after merge"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDkwNDY1Nzg0", "url": "https://github.com/vaadin/flow/pull/9008#pullrequestreview-490465784", "createdAt": "2020-09-17T10:43:37Z", "commit": {"oid": "6eeb9aa4d125d2f53fa1583b76eee23fa7b830db"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xN1QxMDo0MzozN1rOHTcKuA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xN1QxMDo0MzozN1rOHTcKuA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MDE0NjQ4OA==", "bodyText": "Call \"tagName.isPresent()\" before accessing the value.", "url": "https://github.com/vaadin/flow/pull/9008#discussion_r490146488", "createdAt": "2020-09-17T10:43:37Z", "author": {"login": "vaadin-bot"}, "path": "flow-server/src/main/java/com/vaadin/flow/component/polymertemplate/IdCollector.java", "diffHunk": "@@ -136,8 +137,10 @@ private boolean collectElementData(String id, Field field) {\n             Optional<String> tagName = element\n                     .map(org.jsoup.nodes.Element::tagName);\n             if (element.isPresent()) {\n+                Element domElement = element.get();\n                 tagById.put(id, tagName.get());", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "6eeb9aa4d125d2f53fa1583b76eee23fa7b830db"}, "originalPosition": 13}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDkwNTU1NzQ2", "url": "https://github.com/vaadin/flow/pull/9008#pullrequestreview-490555746", "createdAt": "2020-09-17T12:48:49Z", "commit": {"oid": "6eeb9aa4d125d2f53fa1583b76eee23fa7b830db"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4874, "cost": 1, "resetAt": "2021-10-28T20:13:43Z"}}}