{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTE1NjYxMjky", "number": 9319, "title": "Cherry Picks to 2.4", "bodyText": "", "createdAt": "2020-11-04T21:55:30Z", "url": "https://github.com/vaadin/flow/pull/9319", "merged": true, "mergeCommit": {"oid": "0c1d708fe7bd47e1757e23f08e21b76e553319f1"}, "closed": true, "closedAt": "2020-11-09T14:44:09Z", "author": {"login": "taefi"}, "timelineItems": {"totalCount": 9, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdZU0W_AH2gAyNTE1NjYxMjkyOjI0ZTMyMjMxMmQzZDIwNDAxNDVkMGZmMjYwYTI2YTNiN2I5OWM2YTM=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdaz2lrgFqTUyNjE5OTEwMg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "24e322312d3d2040145d0ff260a26a3b7b99c6a3", "author": {"user": {"login": "taefi", "name": "Soroosh Taefi"}}, "url": "https://github.com/vaadin/flow/commit/24e322312d3d2040145d0ff260a26a3b7b99c6a3", "committedDate": "2020-11-04T21:40:38Z", "message": "fix: Sync HierarchicalDataCommunicator's expand state with client side (#9275)\n\nHierarchicalDataCommunicator's expanded state were not being synchronised with client side and TreeGrid's expanded nodes were being collapsed after re-attaching.\n\nWarranty: Sync TreeGrid expanded items state with the client side when detaching and reattaching\n\nFixes: https://github.com/vaadin/flow/issues/9175\n\n(cherry picked from commit bb51a2b5d3e04e28994f1fc619e7cf0848596625)"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "297253a80ae5b522ad347a5a764bbe826b836db6", "author": {"user": {"login": "taefi", "name": "Soroosh Taefi"}}, "url": "https://github.com/vaadin/flow/commit/297253a80ae5b522ad347a5a764bbe826b836db6", "committedDate": "2020-11-04T21:52:06Z", "message": "refactor the code to prevent minor change in maintenance version"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTI0MDEzNjU1", "url": "https://github.com/vaadin/flow/pull/9319#pullrequestreview-524013655", "createdAt": "2020-11-05T08:18:32Z", "commit": {"oid": "297253a80ae5b522ad347a5a764bbe826b836db6"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wNVQwODoxODozMlrOHt337Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wNVQwODoxODozMlrOHt337Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNzg2MzQwNQ==", "bodyText": "This goes through all the expanded items that HierarchyMapper says are expanded.\nDoes the hierarchy mapper have items only related to the active range (on client side) or ? Just wondering what is the cost of this operation. I bet that it throws out items that are not in the active range (done by DataCommunicator), but just want to verify as this look suspicious and there is no comment in the code.", "url": "https://github.com/vaadin/flow/pull/9319#discussion_r517863405", "createdAt": "2020-11-05T08:18:32Z", "author": {"login": "pleku"}, "path": "flow-data/src/main/java/com/vaadin/flow/data/provider/hierarchy/HierarchicalDataCommunicator.java", "diffHunk": "@@ -545,4 +560,27 @@ private JsonValue generateJsonForExpandedOrCollapsedItem(T item) {\n         return json;\n     }\n \n+    private Collection<T> getHierarchyMapperExpandedItems() {\n+        HierarchyMapper<T, ?> hierarchyMapper = getHierarchyMapper();\n+        if (!hierarchyMapper.hasExpandedItems()) {\n+            return Collections.emptySet();\n+        }\n+\n+        Collection<T> expandedItems = new HashSet<>();\n+        getHierarchyMapper().fetchRootItems(null)\n+                .forEach(root -> expandedItems.addAll(getExpandedItems(root)));", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "297253a80ae5b522ad347a5a764bbe826b836db6"}, "originalPosition": 42}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTI0MDYxMjY1", "url": "https://github.com/vaadin/flow/pull/9319#pullrequestreview-524061265", "createdAt": "2020-11-05T09:15:38Z", "commit": {"oid": "aba4809bc8f7b14079db559674188c1119c4fff0"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wNVQwOToxNTozOFrOHt6B9w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wNVQwOToxNTozOFrOHt6B9w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNzg5ODc0Mw==", "bodyText": "Collections.emptySet() already produces empty unmodifiable set, as I recall, why do you wrap it again?", "url": "https://github.com/vaadin/flow/pull/9319#discussion_r517898743", "createdAt": "2020-11-05T09:15:38Z", "author": {"login": "mshabarov"}, "path": "flow-data/src/main/java/com/vaadin/flow/data/provider/hierarchy/HierarchicalDataCommunicator.java", "diffHunk": "@@ -545,4 +560,27 @@ private JsonValue generateJsonForExpandedOrCollapsedItem(T item) {\n         return json;\n     }\n \n+    private Collection<T> getHierarchyMapperExpandedItems() {\n+        HierarchyMapper<T, ?> hierarchyMapper = getHierarchyMapper();\n+        if (!hierarchyMapper.hasExpandedItems()) {\n+            return Collections.unmodifiableCollection(Collections.emptySet());", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "aba4809bc8f7b14079db559674188c1119c4fff0"}, "originalPosition": 37}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTI0MTQ0OTMy", "url": "https://github.com/vaadin/flow/pull/9319#pullrequestreview-524144932", "createdAt": "2020-11-05T10:56:49Z", "commit": {"oid": "606e6621a25859b5de30070f701adb222cbc63ef"}, "state": "DISMISSED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTI2MDc3MDI2", "url": "https://github.com/vaadin/flow/pull/9319#pullrequestreview-526077026", "createdAt": "2020-11-09T09:42:10Z", "commit": {"oid": "36db9298d1a10d1c2951c2f6c2e953703412b8e1"}, "state": "DISMISSED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "5ad84703c8d4dbe6246c13fbb3c998067d1d6e32", "author": {"user": {"login": "taefi", "name": "Soroosh Taefi"}}, "url": "https://github.com/vaadin/flow/commit/5ad84703c8d4dbe6246c13fbb3c998067d1d6e32", "committedDate": "2020-11-09T11:07:27Z", "message": "fix: fix TreeGrid updating wrong expanded items state on setDataProvider (#9336)\n\nFixes: #9328\nDetails: HierarchicalDataProvider's reset method was called before recreating the HierrarchyMapper in setDataProvider. This was creating wrong updates for the client side.\n\n(cherry picked from commit 73ebb9eaf052afa2ad9843153a21b70eab67ee29)"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "36db9298d1a10d1c2951c2f6c2e953703412b8e1", "author": {"user": {"login": "taefi", "name": "Soroosh Taefi"}}, "url": "https://github.com/vaadin/flow/commit/36db9298d1a10d1c2951c2f6c2e953703412b8e1", "committedDate": "2020-11-09T09:31:36Z", "message": "fix: fix TreeGrid updating wrong expanded items state on setDataProvider (#9336)\n\nFixes: #9328\nDetails: HierarchicalDataProvider's reset method was called before recreating the HierrarchyMapper in setDataProvider. This was creating wrong updates for the client side.\n\n(cherry picked from commit 73ebb9eaf052afa2ad9843153a21b70eab67ee29)"}, "afterCommit": {"oid": "5ad84703c8d4dbe6246c13fbb3c998067d1d6e32", "author": {"user": {"login": "taefi", "name": "Soroosh Taefi"}}, "url": "https://github.com/vaadin/flow/commit/5ad84703c8d4dbe6246c13fbb3c998067d1d6e32", "committedDate": "2020-11-09T11:07:27Z", "message": "fix: fix TreeGrid updating wrong expanded items state on setDataProvider (#9336)\n\nFixes: #9328\nDetails: HierarchicalDataProvider's reset method was called before recreating the HierrarchyMapper in setDataProvider. This was creating wrong updates for the client side.\n\n(cherry picked from commit 73ebb9eaf052afa2ad9843153a21b70eab67ee29)"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTI2MTk5MTAy", "url": "https://github.com/vaadin/flow/pull/9319#pullrequestreview-526199102", "createdAt": "2020-11-09T12:24:03Z", "commit": {"oid": "5ad84703c8d4dbe6246c13fbb3c998067d1d6e32"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4795, "cost": 1, "resetAt": "2021-10-28T20:13:43Z"}}}