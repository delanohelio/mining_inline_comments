{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDkzNjA0NTY1", "number": 9067, "title": "Extract polymer templates into separate module", "bodyText": "Fixes #9039", "createdAt": "2020-09-26T17:25:41Z", "url": "https://github.com/vaadin/flow/pull/9067", "merged": true, "mergeCommit": {"oid": "be54d42dc27133de0ed1945cb84e92d648cdf472"}, "closed": true, "closedAt": "2020-09-30T08:21:08Z", "author": {"login": "denis-anisimov"}, "timelineItems": {"totalCount": 41, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdMS9ehAH2gAyNDkzNjA0NTY1OmIyYjBkM2VlNjlkMWRhYjdjZTMxZjNkZDA0MzliNmYyODk4NGI4NDA=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdN4QT4gFqTQ5OTE4Mzc2Mg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "b2b0d3ee69d1dab7ce31f3dd0439b6f28984b840", "author": {"user": null}, "url": "https://github.com/vaadin/flow/commit/b2b0d3ee69d1dab7ce31f3dd0439b6f28984b840", "committedDate": "2020-09-25T10:09:46Z", "message": "Extract polymer templates into separate module"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a2da1bb101fec3cfdc2e6e853eceb3b2a943856f", "author": {"user": null}, "url": "https://github.com/vaadin/flow/commit/a2da1bb101fec3cfdc2e6e853eceb3b2a943856f", "committedDate": "2020-09-27T18:27:45Z", "message": "Fix serializable test and extract its part to polymer"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "9f4f39fc0ea9006fb28260b4882b3438ba827861", "author": {"user": null}, "url": "https://github.com/vaadin/flow/commit/9f4f39fc0ea9006fb28260b4882b3438ba827861", "committedDate": "2020-09-28T05:33:48Z", "message": "Move template test resources to the correct place"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "25997559818e421c118d47cbdaa98392892ce085", "author": {"user": null}, "url": "https://github.com/vaadin/flow/commit/25997559818e421c118d47cbdaa98392892ce085", "committedDate": "2020-09-28T05:59:56Z", "message": "Add missed class"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "3197e97eaaa50677d0e85188af6b2b047b5df107", "author": {"user": null}, "url": "https://github.com/vaadin/flow/commit/3197e97eaaa50677d0e85188af6b2b047b5df107", "committedDate": "2020-09-28T06:05:00Z", "message": "Move standalone test resource"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDk3MjMyMjA4", "url": "https://github.com/vaadin/flow/pull/9067#pullrequestreview-497232208", "createdAt": "2020-09-28T06:58:10Z", "commit": {"oid": "3197e97eaaa50677d0e85188af6b2b047b5df107"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yOFQwNjo1ODoxMFrOHYwr6g==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yOFQwNjo1ODoxMFrOHYwr6g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NTcyNTU0Ng==", "bodyText": "Do not forget to remove this deprecated code someday.", "url": "https://github.com/vaadin/flow/pull/9067#discussion_r495725546", "createdAt": "2020-09-28T06:58:10Z", "author": {"login": "vaadin-bot"}, "path": "flow-server/src/main/java/com/vaadin/flow/component/dependency/Uses.java", "diffHunk": "@@ -47,6 +52,7 @@\n @Retention(RUNTIME)\n @Target(TYPE)\n @Repeatable(Uses.Container.class)\n+@Deprecated\n public @interface Uses {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "3197e97eaaa50677d0e85188af6b2b047b5df107"}, "originalPosition": 44}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDk3MjMyMjQ5", "url": "https://github.com/vaadin/flow/pull/9067#pullrequestreview-497232249", "createdAt": "2020-09-28T06:58:14Z", "commit": {"oid": "3197e97eaaa50677d0e85188af6b2b047b5df107"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yOFQwNjo1ODoxNFrOHYwsCQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yOFQwNjo1ODoxNFrOHYwsCQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NTcyNTU3Nw==", "bodyText": "Do not forget to remove this deprecated code someday.", "url": "https://github.com/vaadin/flow/pull/9067#discussion_r495725577", "createdAt": "2020-09-28T06:58:14Z", "author": {"login": "vaadin-bot"}, "path": "flow-server/src/main/java/com/vaadin/flow/internal/nodefeature/PolymerServerEventHandlers.java", "diffHunk": "@@ -44,9 +45,14 @@\n  */\n @Deprecated\n public class PolymerServerEventHandlers", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "3197e97eaaa50677d0e85188af6b2b047b5df107"}, "originalPosition": 28}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDk3MjMyMjU1", "url": "https://github.com/vaadin/flow/pull/9067#pullrequestreview-497232255", "createdAt": "2020-09-28T06:58:15Z", "commit": {"oid": "3197e97eaaa50677d0e85188af6b2b047b5df107"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yOFQwNjo1ODoxNVrOHYwsDg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yOFQwNjo1ODoxNVrOHYwsDg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NTcyNTU4Mg==", "bodyText": "Remove this use of \"getHandlerAnnotation\"; it is deprecated.", "url": "https://github.com/vaadin/flow/pull/9067#discussion_r495725582", "createdAt": "2020-09-28T06:58:15Z", "author": {"login": "vaadin-bot"}, "path": "flow-server/src/main/java/com/vaadin/flow/internal/nodefeature/AbstractServerHandlers.java", "diffHunk": "@@ -205,9 +216,20 @@ protected void ensureSupportedReturnType(Method method) {\n      * Gets the annotation which is used to mark methods as handlers.\n      *\n      * @return the handler marker annotation\n+     * @deprecated Implement {@link #getHandlerAnnotationFqn()} instead\n      */\n+    @Deprecated\n     protected abstract Class<? extends Annotation> getHandlerAnnotation();\n \n+    /**\n+     * Gets the annotation FQN which is used to mark methods as handlers.\n+     *\n+     * @return the handler marker annotation\n+     */\n+    protected String getHandlerAnnotationFqn() {\n+        return getHandlerAnnotation().getName();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "3197e97eaaa50677d0e85188af6b2b047b5df107"}, "originalPosition": 70}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDk3MjMyMjY0", "url": "https://github.com/vaadin/flow/pull/9067#pullrequestreview-497232264", "createdAt": "2020-09-28T06:58:16Z", "commit": {"oid": "3197e97eaaa50677d0e85188af6b2b047b5df107"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yOFQwNjo1ODoxNlrOHYwsFw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yOFQwNjo1ODoxNlrOHYwsFw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NTcyNTU5MQ==", "bodyText": "Do not forget to remove this deprecated code someday.", "url": "https://github.com/vaadin/flow/pull/9067#discussion_r495725591", "createdAt": "2020-09-28T06:58:16Z", "author": {"login": "vaadin-bot"}, "path": "flow-server/src/main/java/com/vaadin/flow/internal/nodefeature/AbstractServerHandlers.java", "diffHunk": "@@ -205,9 +216,20 @@ protected void ensureSupportedReturnType(Method method) {\n      * Gets the annotation which is used to mark methods as handlers.\n      *\n      * @return the handler marker annotation\n+     * @deprecated Implement {@link #getHandlerAnnotationFqn()} instead\n      */\n+    @Deprecated\n     protected abstract Class<? extends Annotation> getHandlerAnnotation();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "3197e97eaaa50677d0e85188af6b2b047b5df107"}, "originalPosition": 62}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDk3MjMyMjcz", "url": "https://github.com/vaadin/flow/pull/9067#pullrequestreview-497232273", "createdAt": "2020-09-28T06:58:17Z", "commit": {"oid": "3197e97eaaa50677d0e85188af6b2b047b5df107"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yOFQwNjo1ODoxN1rOHYwsHA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yOFQwNjo1ODoxN1rOHYwsHA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NTcyNTU5Ng==", "bodyText": "Do not forget to remove this deprecated code someday.", "url": "https://github.com/vaadin/flow/pull/9067#discussion_r495725596", "createdAt": "2020-09-28T06:58:17Z", "author": {"login": "vaadin-bot"}, "path": "flow-server/src/main/java/com/vaadin/flow/component/template/internal/DeprecatedPolymerTemplate.java", "diffHunk": "@@ -0,0 +1,53 @@\n+/*\n+ * Copyright 2000-2020 Vaadin Ltd.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\"); you may not\n+ * use this file except in compliance with the License. You may obtain a copy of\n+ * the License at\n+ *\n+ * http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS, WITHOUT\n+ * WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied. See the\n+ * License for the specific language governing permissions and limitations under\n+ * the License.\n+ */\n+package com.vaadin.flow.component.template.internal;\n+\n+import java.io.Serializable;\n+import java.lang.reflect.Type;\n+\n+import com.vaadin.flow.component.littemplate.LitTemplate;\n+\n+/**\n+ * Marker interface for Polymer Template.\n+ * \n+ * @author Vaadin Ltd\n+ * @since\n+ * \n+ * @deprecated Polymer template support is deprecated - we recommend you to use\n+ *             {@link LitTemplate} instead. Read more details from <a href=\n+ *             \"https://vaadin.com/blog/future-of-html-templates-in-vaadin\">the\n+ *             Vaadin blog.</a>\n+ *\n+ */\n+@Deprecated\n+public interface DeprecatedPolymerTemplate extends Serializable {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "3197e97eaaa50677d0e85188af6b2b047b5df107"}, "originalPosition": 36}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDk3MjMyMjkz", "url": "https://github.com/vaadin/flow/pull/9067#pullrequestreview-497232293", "createdAt": "2020-09-28T06:58:18Z", "commit": {"oid": "3197e97eaaa50677d0e85188af6b2b047b5df107"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yOFQwNjo1ODoxOFrOHYwsKg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yOFQwNjo1ODoxOFrOHYwsKg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NTcyNTYxMA==", "bodyText": "Do not forget to remove this deprecated code someday.", "url": "https://github.com/vaadin/flow/pull/9067#discussion_r495725610", "createdAt": "2020-09-28T06:58:18Z", "author": {"login": "vaadin-bot"}, "path": "flow-polymer-template/src/main/java/com/vaadin/flow/component/polymertemplate/AbstractTemplate.java", "diffHunk": "@@ -55,7 +56,7 @@\n  */\n @Deprecated\n public abstract class AbstractTemplate<M extends TemplateModel>", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "3197e97eaaa50677d0e85188af6b2b047b5df107"}, "originalPosition": 11}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDk3MjMyMzEy", "url": "https://github.com/vaadin/flow/pull/9067#pullrequestreview-497232312", "createdAt": "2020-09-28T06:58:20Z", "commit": {"oid": "3197e97eaaa50677d0e85188af6b2b047b5df107"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yOFQwNjo1ODoyMFrOHYwsNw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yOFQwNjo1ODoyMFrOHYwsNw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NTcyNTYyMw==", "bodyText": "Remove this use of \"DeprecatedPolymerTemplate\"; it is deprecated.", "url": "https://github.com/vaadin/flow/pull/9067#discussion_r495725623", "createdAt": "2020-09-28T06:58:20Z", "author": {"login": "vaadin-bot"}, "path": "flow-server/src/main/java/com/vaadin/flow/internal/nodefeature/ComponentMapping.java", "diffHunk": "@@ -62,10 +62,10 @@ public void setComponent(Component component) {\n             getNode().getFeature(ClientCallableHandlers.class)\n                     .componentSet(component);\n         }\n-        if (component instanceof PolymerTemplate<?>\n+        if (component instanceof DeprecatedPolymerTemplate", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "3197e97eaaa50677d0e85188af6b2b047b5df107"}, "originalPosition": 14}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDk3MjMyMzE4", "url": "https://github.com/vaadin/flow/pull/9067#pullrequestreview-497232318", "createdAt": "2020-09-28T06:58:21Z", "commit": {"oid": "3197e97eaaa50677d0e85188af6b2b047b5df107"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yOFQwNjo1ODoyMVrOHYwsOQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yOFQwNjo1ODoyMVrOHYwsOQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NTcyNTYyNQ==", "bodyText": "Remove this use of \"PolymerServerEventHandlers\"; it is deprecated.", "url": "https://github.com/vaadin/flow/pull/9067#discussion_r495725625", "createdAt": "2020-09-28T06:58:21Z", "author": {"login": "vaadin-bot"}, "path": "flow-server/src/main/java/com/vaadin/flow/internal/nodefeature/ComponentMapping.java", "diffHunk": "@@ -62,10 +62,10 @@ public void setComponent(Component component) {\n             getNode().getFeature(ClientCallableHandlers.class)\n                     .componentSet(component);\n         }\n-        if (component instanceof PolymerTemplate<?>\n+        if (component instanceof DeprecatedPolymerTemplate\n                 && getNode().hasFeature(PolymerServerEventHandlers.class)) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "3197e97eaaa50677d0e85188af6b2b047b5df107"}, "originalPosition": 15}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDk3MjMyMzI3", "url": "https://github.com/vaadin/flow/pull/9067#pullrequestreview-497232327", "createdAt": "2020-09-28T06:58:22Z", "commit": {"oid": "3197e97eaaa50677d0e85188af6b2b047b5df107"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yOFQwNjo1ODoyMlrOHYwsPw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yOFQwNjo1ODoyMlrOHYwsPw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NTcyNTYzMQ==", "bodyText": "Remove this use of \"PolymerServerEventHandlers\"; it is deprecated.", "url": "https://github.com/vaadin/flow/pull/9067#discussion_r495725631", "createdAt": "2020-09-28T06:58:22Z", "author": {"login": "vaadin-bot"}, "path": "flow-server/src/main/java/com/vaadin/flow/internal/nodefeature/ComponentMapping.java", "diffHunk": "@@ -62,10 +62,10 @@ public void setComponent(Component component) {\n             getNode().getFeature(ClientCallableHandlers.class)\n                     .componentSet(component);\n         }\n-        if (component instanceof PolymerTemplate<?>\n+        if (component instanceof DeprecatedPolymerTemplate\n                 && getNode().hasFeature(PolymerServerEventHandlers.class)) {\n             getNode().getFeature(PolymerServerEventHandlers.class)", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "3197e97eaaa50677d0e85188af6b2b047b5df107"}, "originalPosition": 16}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDk3MjMyMzM3", "url": "https://github.com/vaadin/flow/pull/9067#pullrequestreview-497232337", "createdAt": "2020-09-28T06:58:22Z", "commit": {"oid": "3197e97eaaa50677d0e85188af6b2b047b5df107"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yOFQwNjo1ODoyMlrOHYwsRA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yOFQwNjo1ODoyMlrOHYwsRA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NTcyNTYzNg==", "bodyText": "Remove this use of \"DeprecatedPolymerTemplate\"; it is deprecated.", "url": "https://github.com/vaadin/flow/pull/9067#discussion_r495725636", "createdAt": "2020-09-28T06:58:22Z", "author": {"login": "vaadin-bot"}, "path": "flow-server/src/main/java/com/vaadin/flow/internal/nodefeature/ComponentMapping.java", "diffHunk": "@@ -62,10 +62,10 @@ public void setComponent(Component component) {\n             getNode().getFeature(ClientCallableHandlers.class)\n                     .componentSet(component);\n         }\n-        if (component instanceof PolymerTemplate<?>\n+        if (component instanceof DeprecatedPolymerTemplate\n                 && getNode().hasFeature(PolymerServerEventHandlers.class)) {\n             getNode().getFeature(PolymerServerEventHandlers.class)\n-                    .componentSet((PolymerTemplate<?>) component);\n+                    .componentSet((DeprecatedPolymerTemplate) component);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "3197e97eaaa50677d0e85188af6b2b047b5df107"}, "originalPosition": 18}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "fa5e917b928ddf4a7e80602bbb9eecefbdeddfe0", "author": {"user": null}, "url": "https://github.com/vaadin/flow/commit/fa5e917b928ddf4a7e80602bbb9eecefbdeddfe0", "committedDate": "2020-09-28T07:15:20Z", "message": "Fix SQ reports"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDk4MjA4ODk3", "url": "https://github.com/vaadin/flow/pull/9067#pullrequestreview-498208897", "createdAt": "2020-09-29T08:03:21Z", "commit": {"oid": "fa5e917b928ddf4a7e80602bbb9eecefbdeddfe0"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 13, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yOVQwODowMzoyMVrOHZf7kA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yOVQwODo0MTozNFrOHZidIQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NjQ5OTYwMA==", "bodyText": "Non-blocking: I'm not sure if this should be in this specific module or in a reusable one", "url": "https://github.com/vaadin/flow/pull/9067#discussion_r496499600", "createdAt": "2020-09-29T08:03:21Z", "author": {"login": "pleku"}, "path": "flow-polymer-template/src/test/java/com/vaadin/flow/component/HasCurrentService.java", "diffHunk": "@@ -0,0 +1,53 @@\n+/*\n+ * Copyright 2000-2020 Vaadin Ltd.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\"); you may not\n+ * use this file except in compliance with the License. You may obtain a copy of\n+ * the License at\n+ *\n+ * http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS, WITHOUT\n+ * WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied. See the\n+ * License for the specific language governing permissions and limitations under\n+ * the License.\n+ */\n+package com.vaadin.flow.component;\n+\n+import static org.junit.Assert.assertNull;\n+\n+import org.junit.After;\n+import org.junit.Before;\n+\n+import com.vaadin.flow.server.VaadinService;\n+\n+/**\n+ * Helper for test classes that need to have {@code VaadinService.getCurrent()}\n+ * populated.\n+ *\n+ * @author Vaadin Ltd\n+ * @since 1.0\n+ */\n+public abstract class HasCurrentService {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "fa5e917b928ddf4a7e80602bbb9eecefbdeddfe0"}, "originalPosition": 32}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NjUwMTQ5Nw==", "bodyText": "Now I realize the package name kind of points out that this should be in another module instead (even though it is still just a test class in test sources). So this feels like a wrong place for the class and is not probably good for maintenance to be left here", "url": "https://github.com/vaadin/flow/pull/9067#discussion_r496501497", "createdAt": "2020-09-29T08:05:07Z", "author": {"login": "pleku"}, "path": "flow-polymer-template/src/test/java/com/vaadin/flow/component/HasCurrentService.java", "diffHunk": "@@ -0,0 +1,53 @@\n+/*\n+ * Copyright 2000-2020 Vaadin Ltd.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\"); you may not\n+ * use this file except in compliance with the License. You may obtain a copy of\n+ * the License at\n+ *\n+ * http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS, WITHOUT\n+ * WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied. See the\n+ * License for the specific language governing permissions and limitations under\n+ * the License.\n+ */\n+package com.vaadin.flow.component;\n+\n+import static org.junit.Assert.assertNull;\n+\n+import org.junit.After;\n+import org.junit.Before;\n+\n+import com.vaadin.flow.server.VaadinService;\n+\n+/**\n+ * Helper for test classes that need to have {@code VaadinService.getCurrent()}\n+ * populated.\n+ *\n+ * @author Vaadin Ltd\n+ * @since 1.0\n+ */\n+public abstract class HasCurrentService {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NjQ5OTYwMA=="}, "originalCommit": {"oid": "fa5e917b928ddf4a7e80602bbb9eecefbdeddfe0"}, "originalPosition": 32}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NjUwNDQ2NQ==", "bodyText": "I don't understand how this is related, seems like a mishap", "url": "https://github.com/vaadin/flow/pull/9067#discussion_r496504465", "createdAt": "2020-09-29T08:08:02Z", "author": {"login": "pleku"}, "path": "flow-server/config/flow-build-info.json", "diffHunk": "@@ -0,0 +1,40 @@\n+{", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "fa5e917b928ddf4a7e80602bbb9eecefbdeddfe0"}, "originalPosition": 1}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NjUwNjExMQ==", "bodyText": "This should be probably changed to instead just list the limitations. Or link to those in the docs.\nA user might not know anything about polymer template and doesn't know where to look for.", "url": "https://github.com/vaadin/flow/pull/9067#discussion_r496506111", "createdAt": "2020-09-29T08:09:39Z", "author": {"login": "pleku"}, "path": "flow-server/src/main/java/com/vaadin/flow/component/littemplate/LitTemplate.java", "diffHunk": "@@ -43,7 +42,7 @@\n  * given value to the annotation.\n  * <p>\n  * Note that injected components will have the same limitations as with\n- * {@link PolymerTemplate}.\n+ * {@code PolymerTemplate}.", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "fa5e917b928ddf4a7e80602bbb9eecefbdeddfe0"}, "originalPosition": 13}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NjUwNjQzNg==", "bodyText": "(Can be a separate issue)", "url": "https://github.com/vaadin/flow/pull/9067#discussion_r496506436", "createdAt": "2020-09-29T08:09:58Z", "author": {"login": "pleku"}, "path": "flow-server/src/main/java/com/vaadin/flow/component/littemplate/LitTemplate.java", "diffHunk": "@@ -43,7 +42,7 @@\n  * given value to the annotation.\n  * <p>\n  * Note that injected components will have the same limitations as with\n- * {@link PolymerTemplate}.\n+ * {@code PolymerTemplate}.", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NjUwNjExMQ=="}, "originalCommit": {"oid": "fa5e917b928ddf4a7e80602bbb9eecefbdeddfe0"}, "originalPosition": 13}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NjUxOTY1MA==", "bodyText": "Non-blocking: I think removing this will break Karibu-testing, heads up @mvysny", "url": "https://github.com/vaadin/flow/pull/9067#discussion_r496519650", "createdAt": "2020-09-29T08:22:04Z", "author": {"login": "pleku"}, "path": "flow-server/src/main/java/com/vaadin/flow/di/Instantiator.java", "diffHunk": "@@ -228,12 +226,4 @@ default I18NProvider getI18NProvider() {\n         return getOrCreate(I18NProvider.class);\n     }\n \n-    /**\n-     * Returns {@link TemplateParser} for this service.\n-     *\n-     * @return A non-null template parser.\n-     */\n-    default TemplateParser getTemplateParser() {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "fa5e917b928ddf4a7e80602bbb9eecefbdeddfe0"}, "originalPosition": 18}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NjUyMzU2NQ==", "bodyText": "I would just add it directly to the message instead of as an static final variable as it is used only here", "url": "https://github.com/vaadin/flow/pull/9067#discussion_r496523565", "createdAt": "2020-09-29T08:25:34Z", "author": {"login": "pleku"}, "path": "flow-server/src/main/java/com/vaadin/flow/internal/nodefeature/ElementPropertyMap.java", "diffHunk": "@@ -274,7 +275,7 @@ private AllowUpdate isUpdateFromClientAllowedByFilter(StateNode node,\n                     getLogger().warn(\"Ignoring model update for {}. \"\n                             + \"For security reasons, the property must have a \"\n                             + \"two-way binding in the template, be annotated with @{} in the model, or be defined as synchronized.\",\n-                            key, AllowClientUpdates.class.getSimpleName());\n+                            key, ALLOW_CLIENT_UPDATES_POLYMER);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "fa5e917b928ddf4a7e80602bbb9eecefbdeddfe0"}, "originalPosition": 22}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NjUyOTYxNg==", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                                        + \"two-way binding in the template, be annotated with @{} in the model, or be defined as synchronized.\",\n          \n          \n            \n                                        + \"defined as synchronized. In addition for (deprecated) polymer templates the model could be annotated with @AllowClientUpdates or a two-way binding could be used.\",", "url": "https://github.com/vaadin/flow/pull/9067#discussion_r496529616", "createdAt": "2020-09-29T08:31:11Z", "author": {"login": "pleku"}, "path": "flow-server/src/main/java/com/vaadin/flow/internal/nodefeature/ElementPropertyMap.java", "diffHunk": "@@ -274,7 +275,7 @@ private AllowUpdate isUpdateFromClientAllowedByFilter(StateNode node,\n                     getLogger().warn(\"Ignoring model update for {}. \"\n                             + \"For security reasons, the property must have a \"\n                             + \"two-way binding in the template, be annotated with @{} in the model, or be defined as synchronized.\",", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "fa5e917b928ddf4a7e80602bbb9eecefbdeddfe0"}, "originalPosition": 20}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NjUyOTgzOQ==", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                                        + \"For security reasons, the property must have a \"\n          \n          \n            \n                                        + \"For security reasons, the property must be \"", "url": "https://github.com/vaadin/flow/pull/9067#discussion_r496529839", "createdAt": "2020-09-29T08:31:24Z", "author": {"login": "pleku"}, "path": "flow-server/src/main/java/com/vaadin/flow/internal/nodefeature/ElementPropertyMap.java", "diffHunk": "@@ -274,7 +275,7 @@ private AllowUpdate isUpdateFromClientAllowedByFilter(StateNode node,\n                     getLogger().warn(\"Ignoring model update for {}. \"\n                             + \"For security reasons, the property must have a \"", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "fa5e917b928ddf4a7e80602bbb9eecefbdeddfe0"}, "originalPosition": 19}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NjUzNDg2NQ==", "bodyText": "Test sources and this package name in flow-server ??? This seems like a mistake, if it is not, then it should be clarified in code why is this class here and what is its role", "url": "https://github.com/vaadin/flow/pull/9067#discussion_r496534865", "createdAt": "2020-09-29T08:36:00Z", "author": {"login": "pleku"}, "path": "flow-server/src/test/java/com/vaadin/flow/component/polymertemplate/EventHandler.java", "diffHunk": "@@ -0,0 +1,59 @@\n+/*\n+ * Copyright 2000-2020 Vaadin Ltd.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\"); you may not\n+ * use this file except in compliance with the License. You may obtain a copy of\n+ * the License at\n+ *\n+ * http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS, WITHOUT\n+ * WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied. See the\n+ * License for the specific language governing permissions and limitations under\n+ * the License.\n+ */\n+package com.vaadin.flow.component.polymertemplate;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "fa5e917b928ddf4a7e80602bbb9eecefbdeddfe0"}, "originalPosition": 16}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NjUzNjI3Mg==", "bodyText": "Same thing - it should be clarified in code why is this class here to help the maintainers. Now it just looks like a mistake at a glance", "url": "https://github.com/vaadin/flow/pull/9067#discussion_r496536272", "createdAt": "2020-09-29T08:37:14Z", "author": {"login": "pleku"}, "path": "flow-server/src/test/java/com/vaadin/flow/component/polymertemplate/RepeatIndex.java", "diffHunk": "@@ -0,0 +1,51 @@\n+/*\n+ * Copyright 2000-2020 Vaadin Ltd.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\"); you may not\n+ * use this file except in compliance with the License. You may obtain a copy of\n+ * the License at\n+ *\n+ * http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS, WITHOUT\n+ * WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied. See the\n+ * License for the specific language governing permissions and limitations under\n+ * the License.\n+ */\n+\n+package com.vaadin.flow.component.polymertemplate;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "fa5e917b928ddf4a7e80602bbb9eecefbdeddfe0"}, "originalPosition": 17}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NjUzOTY3Nw==", "bodyText": "Should not be included ?", "url": "https://github.com/vaadin/flow/pull/9067#discussion_r496539677", "createdAt": "2020-09-29T08:40:23Z", "author": {"login": "pleku"}, "path": "flow-tests/test-ccdm/types.d.ts", "diffHunk": "@@ -0,0 +1,9 @@\n+// This TypeScript modules definition file is generated by vaadin-maven-plugin.\n+// You can not directly import your different static files into TypeScript,\n+// This is needed for TypeScript compiler to declare and export as a TypeScript module.\n+// It is recommended to commit this file to the VCS.\n+// You might want to change the configurations to fit your preferences\n+declare module '*.css' {\n+    const content: string;\n+    export default content;\n+}", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "fa5e917b928ddf4a7e80602bbb9eecefbdeddfe0"}, "originalPosition": 9}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NjU0MDk2MQ==", "bodyText": "This added code does not have a unit test in ReflectToolsTest", "url": "https://github.com/vaadin/flow/pull/9067#discussion_r496540961", "createdAt": "2020-09-29T08:41:34Z", "author": {"login": "pleku"}, "path": "flow-server/src/main/java/com/vaadin/flow/internal/ReflectTools.java", "diffHunk": "@@ -763,6 +764,67 @@ public static Method getFunctionalMethod(Class<?> functionalClass) {\n         return Optional.empty();\n     }\n \n+    /**\n+     * Checks whether the {@code element} has annotation whose FQN is\n+     * {@code annotationFqn}.\n+     * \n+     * @param element\n+     *            annotated element (field, method, etc.)\n+     * @param annotationFqn\n+     *            annotation FQN\n+     * @return {@code true} is {@code element} has annotation whose FQN is\n+     *         {@code annotationFqn}, {@code false} otherwise\n+     */\n+    public static boolean hasAnnotation(AnnotatedElement element,\n+            String annotationFqn) {\n+        return getAnnotation(element, annotationFqn).isPresent();\n+    }\n+\n+    /**\n+     * Gets the annotation method return value.\n+     * \n+     * @param annotation\n+     *            the annotation\n+     * @param methodName\n+     *            the method name\n+     * @return an optional value, or an empty optional if element has no\n+     *         annotation with required {@code annotationFqn}\n+     */\n+    public static Object getAnnotationMethodValue(Annotation annotation,", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "fa5e917b928ddf4a7e80602bbb9eecefbdeddfe0"}, "originalPosition": 66}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDk4MTk0OTM0", "url": "https://github.com/vaadin/flow/pull/9067#pullrequestreview-498194934", "createdAt": "2020-09-29T07:52:45Z", "commit": {"oid": "fa5e917b928ddf4a7e80602bbb9eecefbdeddfe0"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 13, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yOVQwNzo1Mjo0NVrOHZfWXg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yOVQwODo1NzozMFrOHZjMBg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NjQ5MDA3OA==", "bodyText": "OSGi shouldn't be here as we don't support OSGi at the moment. It's an extra that makes things more complex.", "url": "https://github.com/vaadin/flow/pull/9067#discussion_r496490078", "createdAt": "2020-09-29T07:52:45Z", "author": {"login": "caalador"}, "path": "flow-polymer-template/pom.xml", "diffHunk": "@@ -0,0 +1,126 @@\n+<?xml version=\"1.0\" encoding=\"UTF-8\"?>\n+<project xmlns=\"http://maven.apache.org/POM/4.0.0\"\n+    xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\"\n+    xsi:schemaLocation=\"http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd\">\n+    <modelVersion>4.0.0</modelVersion>\n+    <parent>\n+        <groupId>com.vaadin</groupId>\n+        <artifactId>flow-project</artifactId>\n+        <version>5.0-SNAPSHOT</version>\n+    </parent>\n+    <artifactId>flow-polymer-template</artifactId>\n+    <name>Flow Polymer Templates Support</name>\n+    <packaging>jar</packaging>\n+\n+    <properties>\n+    </properties>\n+\n+    <dependencies>\n+\n+        <!-- Project dependencies -->\n+\n+        <dependency>\n+            <groupId>com.vaadin</groupId>\n+            <artifactId>flow-server</artifactId>\n+            <version>${project.version}</version>\n+        </dependency>\n+\n+        <dependency>\n+            <groupId>com.vaadin</groupId>\n+            <artifactId>flow-test-generic</artifactId>\n+            <version>${project.version}</version>\n+            <scope>test</scope>\n+        </dependency>\n+\n+\n+        <!-- API DEPENDENCIES -->\n+\n+        <dependency>\n+            <groupId>org.slf4j</groupId>\n+            <artifactId>slf4j-api</artifactId>\n+        </dependency>\n+\n+        <!-- Library dependencies -->\n+\n+        <!-- Jsoup for BootstrapHandler, Template, ... -->\n+        <dependency>\n+            <groupId>org.jsoup</groupId>\n+            <artifactId>jsoup</artifactId>\n+            <version>${jsoup.version}</version>\n+        </dependency>\n+\n+        <!-- Byte code generation -->\n+        <dependency>\n+            <groupId>net.bytebuddy</groupId>\n+            <artifactId>byte-buddy</artifactId>\n+        </dependency>\n+\n+        <!-- Small reflection library -->\n+        <dependency>\n+            <groupId>com.vaadin.external</groupId>\n+            <artifactId>gentyref</artifactId>\n+            <version>1.2.0.vaadin1</version>\n+        </dependency>\n+\n+        <!-- TESTING DEPENDENCIES -->\n+\n+        <dependency>\n+            <groupId>javax.servlet</groupId>\n+            <artifactId>javax.servlet-api</artifactId>\n+            <scope>test</scope>\n+        </dependency>\n+        \n+        <dependency>\n+            <groupId>org.slf4j</groupId>\n+            <artifactId>slf4j-simple</artifactId>\n+            <scope>test</scope>\n+        </dependency>\n+\n+        <!-- Bean Validation implementation -->\n+        <dependency>\n+            <groupId>com.google.code.findbugs</groupId>\n+            <artifactId>annotations</artifactId>\n+            <version>3.0.1</version>\n+            <scope>test</scope>\n+        </dependency>\n+\n+        <dependency>\n+            <groupId>org.osgi</groupId>", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "fa5e917b928ddf4a7e80602bbb9eecefbdeddfe0"}, "originalPosition": 88}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NjQ5MDM3Mw==", "bodyText": "No OSGi extras should be here at the moment as OSGi is only for v14", "url": "https://github.com/vaadin/flow/pull/9067#discussion_r496490373", "createdAt": "2020-09-29T07:53:13Z", "author": {"login": "caalador"}, "path": "flow-polymer-template/bnd.bnd", "diffHunk": "@@ -0,0 +1,9 @@\n+Bundle-SymbolicName: ${project.groupId}.flow.polymer-template", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "fa5e917b928ddf4a7e80602bbb9eecefbdeddfe0"}, "originalPosition": 1}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NjUxOTcyMQ==", "bodyText": "Test name nor expected exception explain why this should throw and not return content.", "url": "https://github.com/vaadin/flow/pull/9067#discussion_r496519721", "createdAt": "2020-09-29T08:22:08Z", "author": {"login": "caalador"}, "path": "flow-polymer-template/src/test/java/com/vaadin/flow/component/CompositeTest.java", "diffHunk": "@@ -0,0 +1,94 @@\n+package com.vaadin.flow.component;\n+\n+import static org.junit.Assert.assertEquals;\n+\n+import org.jsoup.Jsoup;\n+import org.junit.After;\n+import org.junit.Before;\n+import org.junit.Test;\n+import org.mockito.Mockito;\n+\n+import com.vaadin.flow.component.polymertemplate.PolymerTemplate;\n+import com.vaadin.flow.component.polymertemplate.TemplateParser.TemplateData;\n+import com.vaadin.flow.dom.Element;\n+import com.vaadin.flow.function.DeploymentConfiguration;\n+import com.vaadin.flow.server.VaadinService;\n+import com.vaadin.flow.templatemodel.TemplateModel;\n+\n+import net.jcip.annotations.NotThreadSafe;\n+\n+@NotThreadSafe\n+public class CompositeTest {\n+\n+    @Tag(\"div\")\n+    public static class MyTemplate extends PolymerTemplate<TemplateModel> {\n+\n+        public MyTemplate() {\n+            super((clazz, tag, service) -> new TemplateData(\"\",\n+                    Jsoup.parse(\"<dom-module id='div'></dom-module>\")));\n+        }\n+    }\n+\n+    public static class KeyNotifierComposite extends Composite<MyTemplate>\n+            implements KeyNotifier {\n+\n+        @Override\n+        protected MyTemplate initContent() {\n+            MyTemplate template = new MyTemplate();\n+\n+            addKeyUpListener(Key.ENTER, event -> {\n+            }, KeyModifier.CONTROL);\n+\n+            return template;\n+        }\n+    }\n+\n+    private VaadinService service;\n+\n+    @Before\n+    public void setup() {\n+        service = Mockito.mock(VaadinService.class);\n+        VaadinService.setCurrent(service);\n+        DeploymentConfiguration configuration = Mockito\n+                .mock(DeploymentConfiguration.class);\n+\n+        Mockito.when(service.getDeploymentConfiguration())\n+                .thenReturn(configuration);\n+    }\n+\n+    @After\n+    public void tearDown() {\n+        VaadinService.setCurrent(null);\n+    }\n+\n+    @Test(expected = IllegalStateException.class)\n+    public void getContent_compositeIsKeyNotifier() {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "fa5e917b928ddf4a7e80602bbb9eecefbdeddfe0"}, "originalPosition": 65}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NjUyMjU1NQ==", "bodyText": "unused method in class that is also a duplicate of the one in the server package.", "url": "https://github.com/vaadin/flow/pull/9067#discussion_r496522555", "createdAt": "2020-09-29T08:24:41Z", "author": {"login": "caalador"}, "path": "flow-polymer-template/src/test/java/com/vaadin/flow/component/CompositeTest.java", "diffHunk": "@@ -0,0 +1,94 @@\n+package com.vaadin.flow.component;\n+\n+import static org.junit.Assert.assertEquals;\n+\n+import org.jsoup.Jsoup;\n+import org.junit.After;\n+import org.junit.Before;\n+import org.junit.Test;\n+import org.mockito.Mockito;\n+\n+import com.vaadin.flow.component.polymertemplate.PolymerTemplate;\n+import com.vaadin.flow.component.polymertemplate.TemplateParser.TemplateData;\n+import com.vaadin.flow.dom.Element;\n+import com.vaadin.flow.function.DeploymentConfiguration;\n+import com.vaadin.flow.server.VaadinService;\n+import com.vaadin.flow.templatemodel.TemplateModel;\n+\n+import net.jcip.annotations.NotThreadSafe;\n+\n+@NotThreadSafe\n+public class CompositeTest {\n+\n+    @Tag(\"div\")\n+    public static class MyTemplate extends PolymerTemplate<TemplateModel> {\n+\n+        public MyTemplate() {\n+            super((clazz, tag, service) -> new TemplateData(\"\",\n+                    Jsoup.parse(\"<dom-module id='div'></dom-module>\")));\n+        }\n+    }\n+\n+    public static class KeyNotifierComposite extends Composite<MyTemplate>\n+            implements KeyNotifier {\n+\n+        @Override\n+        protected MyTemplate initContent() {\n+            MyTemplate template = new MyTemplate();\n+\n+            addKeyUpListener(Key.ENTER, event -> {\n+            }, KeyModifier.CONTROL);\n+\n+            return template;\n+        }\n+    }\n+\n+    private VaadinService service;\n+\n+    @Before\n+    public void setup() {\n+        service = Mockito.mock(VaadinService.class);\n+        VaadinService.setCurrent(service);\n+        DeploymentConfiguration configuration = Mockito\n+                .mock(DeploymentConfiguration.class);\n+\n+        Mockito.when(service.getDeploymentConfiguration())\n+                .thenReturn(configuration);\n+    }\n+\n+    @After\n+    public void tearDown() {\n+        VaadinService.setCurrent(null);\n+    }\n+\n+    @Test(expected = IllegalStateException.class)\n+    public void getContent_compositeIsKeyNotifier() {\n+        KeyNotifierComposite composite = new KeyNotifierComposite();\n+        composite.getContent();\n+    }\n+\n+    /*\n+     * This is just a test for #1181.\n+     */\n+    @Test\n+    // @Ignore(\"Failing after adding connect client generators\")\n+    public void templateInsideComposite_compositeCanBeAdded() {\n+        class MyComponent extends Composite<MyTemplate> {\n+\n+        }\n+\n+        MyComponent component = new MyComponent();\n+\n+        UI ui = new UI();\n+        // Doesn't throw any exception\n+        ui.add(component);\n+    }\n+\n+    public static void assertElementChildren(Element parent,", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "fa5e917b928ddf4a7e80602bbb9eecefbdeddfe0"}, "originalPosition": 87}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NjUyNTE3MQ==", "bodyText": "Could be nicer with an import instead.", "url": "https://github.com/vaadin/flow/pull/9067#discussion_r496525171", "createdAt": "2020-09-29T08:27:05Z", "author": {"login": "caalador"}, "path": "flow-polymer-template/src/test/java/com/vaadin/flow/component/polymertemplate/PolymerTemplateTest.java", "diffHunk": "@@ -67,7 +67,8 @@\n import net.jcip.annotations.NotThreadSafe;\n \n @NotThreadSafe\n-public class PolymerTemplateTest extends HasCurrentService {\n+public class PolymerTemplateTest\n+        extends com.vaadin.flow.component.HasCurrentService {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "fa5e917b928ddf4a7e80602bbb9eecefbdeddfe0"}, "originalPosition": 19}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NjUyNzI2MQ==", "bodyText": "Why do we extend HasCurrentService if we override everything from there?", "url": "https://github.com/vaadin/flow/pull/9067#discussion_r496527261", "createdAt": "2020-09-29T08:28:59Z", "author": {"login": "caalador"}, "path": "flow-polymer-template/src/test/java/com/vaadin/flow/component/polymertemplate/PolymerTemplateTest.java", "diffHunk": "@@ -78,6 +79,25 @@\n     // Field to prevent current instance from being garbage collected\n     private UI ui;\n \n+    private VaadinService service;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "fa5e917b928ddf4a7e80602bbb9eecefbdeddfe0"}, "originalPosition": 27}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NjUzNTEwMg==", "bodyText": "Import would be cleaner.", "url": "https://github.com/vaadin/flow/pull/9067#discussion_r496535102", "createdAt": "2020-09-29T08:36:13Z", "author": {"login": "caalador"}, "path": "flow-polymer-template/src/test/java/com/vaadin/flow/templatemodel/TemplateModelProxyHandlerTest.java", "diffHunk": "@@ -6,15 +6,15 @@\n \n import com.vaadin.flow.component.UI;\n import com.vaadin.flow.function.DeploymentConfiguration;\n-import com.vaadin.flow.internal.HasCurrentService;\n import com.vaadin.flow.server.VaadinService;\n import com.vaadin.flow.templatemodel.TemplateModelTest.EmptyModel;\n import com.vaadin.flow.templatemodel.TemplateModelTest.EmptyModelTemplate;\n \n import net.jcip.annotations.NotThreadSafe;\n \n @NotThreadSafe\n-public class TemplateModelProxyHandlerTest extends HasCurrentService {\n+public class TemplateModelProxyHandlerTest\n+        extends com.vaadin.flow.component.HasCurrentService {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "fa5e917b928ddf4a7e80602bbb9eecefbdeddfe0"}, "originalPosition": 14}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NjUzNTQwMw==", "bodyText": "import would be cleaner", "url": "https://github.com/vaadin/flow/pull/9067#discussion_r496535403", "createdAt": "2020-09-29T08:36:30Z", "author": {"login": "caalador"}, "path": "flow-polymer-template/src/test/java/com/vaadin/flow/templatemodel/TemplateModelWithEncodersTest.java", "diffHunk": "@@ -23,7 +22,8 @@\n import net.jcip.annotations.NotThreadSafe;\n \n @NotThreadSafe\n-public class TemplateModelWithEncodersTest extends HasCurrentService {\n+public class TemplateModelWithEncodersTest\n+        extends com.vaadin.flow.component.HasCurrentService {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "fa5e917b928ddf4a7e80602bbb9eecefbdeddfe0"}, "originalPosition": 14}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NjU1MDgzNA==", "bodyText": "Shouldn't any test requiring the for Polymer EventHandler annotation be moved to the polymer package and not duplicate the annotation for a test.", "url": "https://github.com/vaadin/flow/pull/9067#discussion_r496550834", "createdAt": "2020-09-29T08:54:31Z", "author": {"login": "caalador"}, "path": "flow-server/src/test/java/com/vaadin/flow/component/polymertemplate/EventHandler.java", "diffHunk": "@@ -0,0 +1,59 @@\n+/*\n+ * Copyright 2000-2020 Vaadin Ltd.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\"); you may not\n+ * use this file except in compliance with the License. You may obtain a copy of\n+ * the License at\n+ *\n+ * http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS, WITHOUT\n+ * WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied. See the\n+ * License for the specific language governing permissions and limitations under\n+ * the License.\n+ */\n+package com.vaadin.flow.component.polymertemplate;\n+\n+import java.lang.annotation.Documented;\n+import java.lang.annotation.ElementType;\n+import java.lang.annotation.Retention;\n+import java.lang.annotation.RetentionPolicy;\n+import java.lang.annotation.Target;\n+\n+import com.vaadin.flow.component.EventData;\n+import com.vaadin.flow.component.littemplate.LitTemplate;\n+import com.vaadin.flow.dom.DisabledUpdateMode;\n+\n+/**\n+ * Publishes the annotated method so it can be invoked from the client side as\n+ * template event handlers.\n+ *\n+ * @see EventData\n+ * @author Vaadin Ltd\n+ * @since 1.0\n+ *\n+ * @deprecated Event handlers are not supported by Lit templates. Add a\n+ *             corresponding DOM listener from server side API instead or fire a\n+ *             custom event from client side template. Also you may handle an\n+ *             event directly on the client side and the server side may be\n+ *             called from this handler via {@code this.$server._some_method}.\n+ *             Polymer template support is deprecated - we recommend you to use\n+ *             {@link LitTemplate} instead. Read more details from <a href=\n+ *             \"https://vaadin.com/blog/future-of-html-templates-in-vaadin\">the\n+ *             Vaadin blog.</a>\n+ */\n+@Deprecated\n+@Retention(RetentionPolicy.RUNTIME)\n+@Target(ElementType.METHOD)\n+@Documented\n+public @interface EventHandler {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "fa5e917b928ddf4a7e80602bbb9eecefbdeddfe0"}, "originalPosition": 50}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NjU1MTI5NQ==", "bodyText": "Shouldn't tests using the RepeatIndex that is a Polymer annotation be moved to polymer package.", "url": "https://github.com/vaadin/flow/pull/9067#discussion_r496551295", "createdAt": "2020-09-29T08:55:10Z", "author": {"login": "caalador"}, "path": "flow-server/src/test/java/com/vaadin/flow/component/polymertemplate/RepeatIndex.java", "diffHunk": "@@ -0,0 +1,51 @@\n+/*\n+ * Copyright 2000-2020 Vaadin Ltd.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\"); you may not\n+ * use this file except in compliance with the License. You may obtain a copy of\n+ * the License at\n+ *\n+ * http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS, WITHOUT\n+ * WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied. See the\n+ * License for the specific language governing permissions and limitations under\n+ * the License.\n+ */\n+\n+package com.vaadin.flow.component.polymertemplate;\n+\n+import java.lang.annotation.Documented;\n+import java.lang.annotation.ElementType;\n+import java.lang.annotation.Retention;\n+import java.lang.annotation.RetentionPolicy;\n+import java.lang.annotation.Target;\n+\n+import com.vaadin.flow.component.EventData;\n+import com.vaadin.flow.component.littemplate.LitTemplate;\n+\n+/**\n+ * Allows to receive index of an element in dom-repeat Polymer template section.\n+ *\n+ * Can be applied on parameters of {@code int} and {@link Integer} types.\n+ *\n+ * This is a shorthand for {@code @EventData(\"event.model.index\")}, for more\n+ * information, refer to {@link EventData}.\n+ *\n+ * @author Vaadin Ltd\n+ * @since 1.0\n+ * @deprecated dom-repeat is not support by Lit templates but you may still use\n+ *             {@code @EventData(\"some_data\")} directly to receive data from the\n+ *             client side. Polymer template support is deprecated - we\n+ *             recommend you to use {@link LitTemplate} instead. Read more\n+ *             details from <a href=\n+ *             \"https://vaadin.com/blog/future-of-html-templates-in-vaadin\">the\n+ *             Vaadin blog.</a>\n+ */\n+@Deprecated\n+@Retention(RetentionPolicy.RUNTIME)\n+@Target({ ElementType.PARAMETER })\n+@Documented\n+public @interface RepeatIndex {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "fa5e917b928ddf4a7e80602bbb9eecefbdeddfe0"}, "originalPosition": 50}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NjU1MjExNA==", "bodyText": "Shouldn't this test class be moved as the feature is polymer and should be usable only with the opt in package?", "url": "https://github.com/vaadin/flow/pull/9067#discussion_r496552114", "createdAt": "2020-09-29T08:56:18Z", "author": {"login": "caalador"}, "path": "flow-server/src/test/java/com/vaadin/flow/internal/nodefeature/PolymerServerEventHandlersTest.java", "diffHunk": "@@ -65,15 +64,24 @@\n     private Map<String, Method> correctlyAnnotatedHandlers;\n     private Map<String, Method> wronglyAnnotatedHandlers;\n ", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "fa5e917b928ddf4a7e80602bbb9eecefbdeddfe0"}, "originalPosition": 38}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NjU1MjM1MA==", "bodyText": "Shouldn't this test class be moved as the feature is polymer and should be usable only with the opt in package?", "url": "https://github.com/vaadin/flow/pull/9067#discussion_r496552350", "createdAt": "2020-09-29T08:56:38Z", "author": {"login": "caalador"}, "path": "flow-server/src/test/java/com/vaadin/flow/server/communication/rpc/PublishedServerEventHandlerRpcHandlerTest.java", "diffHunk": "@@ -34,36 +33,30 @@\n import com.vaadin.flow.component.internal.PendingJavaScriptInvocation;\n import com.vaadin.flow.component.internal.UIInternals.JavaScriptInvocation;\n import com.vaadin.flow.component.polymertemplate.EventHandler;\n-import com.vaadin.flow.component.polymertemplate.PolymerTemplate;\n-import com.vaadin.flow.component.polymertemplate.TemplateParser.TemplateData;\n+import com.vaadin.flow.component.template.internal.DeprecatedPolymerTemplate;\n import com.vaadin.flow.dom.DisabledUpdateMode;\n import com.vaadin.flow.function.DeploymentConfiguration;\n import com.vaadin.flow.server.VaadinService;\n import com.vaadin.flow.shared.JsonConstants;\n-import com.vaadin.flow.templatemodel.TemplateModel;\n import com.vaadin.tests.util.MockUI;\n \n import elemental.json.Json;\n import elemental.json.JsonArray;\n import elemental.json.JsonObject;\n import elemental.json.JsonValue;\n+import net.jcip.annotations.NotThreadSafe;\n \n @NotThreadSafe\n public class PublishedServerEventHandlerRpcHandlerTest {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "fa5e917b928ddf4a7e80602bbb9eecefbdeddfe0"}, "originalPosition": 33}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NjU1Mjk2Ng==", "bodyText": "new line", "url": "https://github.com/vaadin/flow/pull/9067#discussion_r496552966", "createdAt": "2020-09-29T08:57:30Z", "author": {"login": "caalador"}, "path": "flow-tests/test-ccdm/types.d.ts", "diffHunk": "@@ -0,0 +1,9 @@\n+// This TypeScript modules definition file is generated by vaadin-maven-plugin.\n+// You can not directly import your different static files into TypeScript,\n+// This is needed for TypeScript compiler to declare and export as a TypeScript module.\n+// It is recommended to commit this file to the VCS.\n+// You might want to change the configurations to fit your preferences\n+declare module '*.css' {\n+    const content: string;\n+    export default content;\n+}", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "fa5e917b928ddf4a7e80602bbb9eecefbdeddfe0"}, "originalPosition": 9}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "80b31754157e7bb918794210f6be55db4ab119af", "author": {"user": null}, "url": "https://github.com/vaadin/flow/commit/80b31754157e7bb918794210f6be55db4ab119af", "committedDate": "2020-09-29T09:08:55Z", "message": "Update flow-server/src/main/java/com/vaadin/flow/internal/nodefeature/ElementPropertyMap.java\n\nCo-authored-by: Pekka Hyv\u00f6nen <pekka@vaadin.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "97dde3fc20121b7cf5c7d1dc5bf77fe8894bea6d", "author": {"user": null}, "url": "https://github.com/vaadin/flow/commit/97dde3fc20121b7cf5c7d1dc5bf77fe8894bea6d", "committedDate": "2020-09-29T09:45:29Z", "message": "Remove extra file\nAdd comments\nAdd unit tests"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "80b31754157e7bb918794210f6be55db4ab119af", "author": {"user": null}, "url": "https://github.com/vaadin/flow/commit/80b31754157e7bb918794210f6be55db4ab119af", "committedDate": "2020-09-29T09:08:55Z", "message": "Update flow-server/src/main/java/com/vaadin/flow/internal/nodefeature/ElementPropertyMap.java\n\nCo-authored-by: Pekka Hyv\u00f6nen <pekka@vaadin.com>"}, "afterCommit": {"oid": "97dde3fc20121b7cf5c7d1dc5bf77fe8894bea6d", "author": {"user": null}, "url": "https://github.com/vaadin/flow/commit/97dde3fc20121b7cf5c7d1dc5bf77fe8894bea6d", "committedDate": "2020-09-29T09:45:29Z", "message": "Remove extra file\nAdd comments\nAdd unit tests"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDk4MzEyOTY5", "url": "https://github.com/vaadin/flow/pull/9067#pullrequestreview-498312969", "createdAt": "2020-09-29T10:07:47Z", "commit": {"oid": "97dde3fc20121b7cf5c7d1dc5bf77fe8894bea6d"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yOVQxMDowNzo0N1rOHZl-Ww==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yOVQxMDowNzo0N1rOHZl-Ww==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NjU5ODYxOQ==", "bodyText": "Retention and Target should probably not be removed.", "url": "https://github.com/vaadin/flow/pull/9067#discussion_r496598619", "createdAt": "2020-09-29T10:07:47Z", "author": {"login": "caalador"}, "path": "flow-server/src/test/java/com/vaadin/flow/component/polymertemplate/EventHandler.java", "diffHunk": "@@ -15,45 +15,14 @@\n  */\n package com.vaadin.flow.component.polymertemplate;\n \n-import java.lang.annotation.Documented;\n-import java.lang.annotation.ElementType;\n-import java.lang.annotation.Retention;\n-import java.lang.annotation.RetentionPolicy;\n-import java.lang.annotation.Target;\n-\n-import com.vaadin.flow.component.EventData;\n-import com.vaadin.flow.component.littemplate.LitTemplate;\n import com.vaadin.flow.dom.DisabledUpdateMode;\n \n /**\n- * Publishes the annotated method so it can be invoked from the client side as\n- * template event handlers.\n- *\n- * @see EventData\n- * @author Vaadin Ltd\n- * @since 1.0\n- *\n- * @deprecated Event handlers are not supported by Lit templates. Add a\n- *             corresponding DOM listener from server side API instead or fire a\n- *             custom event from client side template. Also you may handle an\n- *             event directly on the client side and the server side may be\n- *             called from this handler via {@code this.$server._some_method}.\n- *             Polymer template support is deprecated - we recommend you to use\n- *             {@link LitTemplate} instead. Read more details from <a href=\n- *             \"https://vaadin.com/blog/future-of-html-templates-in-vaadin\">the\n- *             Vaadin blog.</a>\n+ * \n+ * This class here is for testing purpose: it's impossible to test polymer\n+ * templates related code which has not been moved to a separate module.\n  */\n-@Deprecated\n-@Retention(RetentionPolicy.RUNTIME)", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "97dde3fc20121b7cf5c7d1dc5bf77fe8894bea6d"}, "originalPosition": 36}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "d129a12f05c9373faba4c8db3686b64499479a8e", "author": {"user": null}, "url": "https://github.com/vaadin/flow/commit/d129a12f05c9373faba4c8db3686b64499479a8e", "committedDate": "2020-09-29T10:42:12Z", "message": "Merge branch '9039-polymer-separate-module' of\ngit@github.com:vaadin/flow.git into 9039-polymer-separate-module\n\nConflicts:\n\tflow-server/src/main/java/com/vaadin/flow/internal/nodefeature/ElementPropertyMap.java"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "d47e0764489838fff13db615d5c5d33b448c5123", "author": {"user": null}, "url": "https://github.com/vaadin/flow/commit/d47e0764489838fff13db615d5c5d33b448c5123", "committedDate": "2020-09-29T10:54:21Z", "message": "Correct reflection code"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDk4MzU2Nzcw", "url": "https://github.com/vaadin/flow/pull/9067#pullrequestreview-498356770", "createdAt": "2020-09-29T11:08:50Z", "commit": {"oid": "d47e0764489838fff13db615d5c5d33b448c5123"}, "state": "COMMENTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yOVQxMTowODo1MVrOHZoAGg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yOVQxMTowODo1NVrOHZoAPQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NjYzMTgzNA==", "bodyText": "Not an overriding method after merge commit.", "url": "https://github.com/vaadin/flow/pull/9067#discussion_r496631834", "createdAt": "2020-09-29T11:08:51Z", "author": {"login": "caalador"}, "path": "flow-server/src/test/java/com/vaadin/flow/internal/nodefeature/PolymerServerEventHandlersTest.java", "diffHunk": "@@ -65,15 +64,24 @@\n     private Map<String, Method> correctlyAnnotatedHandlers;\n     private Map<String, Method> wronglyAnnotatedHandlers;\n \n-    @Tag(\"polymer\")\n-    private static class CorrectAnnotationUsage\n-            extends PolymerTemplate<TemplateModel> {\n+    private static class AbstractTemplate extends Component\n+            implements DeprecatedPolymerTemplate {\n+\n+        @Override", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d47e0764489838fff13db615d5c5d33b448c5123"}, "originalPosition": 45}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NjYzMTg2OQ==", "bodyText": "Not an overriding method after merge commit.", "url": "https://github.com/vaadin/flow/pull/9067#discussion_r496631869", "createdAt": "2020-09-29T11:08:55Z", "author": {"login": "caalador"}, "path": "flow-server/src/test/java/com/vaadin/flow/internal/nodefeature/PolymerServerEventHandlersTest.java", "diffHunk": "@@ -65,15 +64,24 @@\n     private Map<String, Method> correctlyAnnotatedHandlers;\n     private Map<String, Method> wronglyAnnotatedHandlers;\n \n-    @Tag(\"polymer\")\n-    private static class CorrectAnnotationUsage\n-            extends PolymerTemplate<TemplateModel> {\n+    private static class AbstractTemplate extends Component\n+            implements DeprecatedPolymerTemplate {\n+\n+        @Override\n+        public boolean isSupportedClass(Class<?> type) {\n+            return false;\n+        }\n \n-        CorrectAnnotationUsage() {\n-            super((clazz, tag, service) -> new TemplateData(\"\",\n-                    Jsoup.parse(\"<dom-module id='polymer'></dom-module>\")));\n+        @Override", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d47e0764489838fff13db615d5c5d33b448c5123"}, "originalPosition": 53}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "772d9fcded0bcd68ef85da9f7032c3b00a754709", "author": {"user": null}, "url": "https://github.com/vaadin/flow/commit/772d9fcded0bcd68ef85da9f7032c3b00a754709", "committedDate": "2020-09-29T11:14:24Z", "message": "Fix compilation error"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "8cb297a0fa707232221ac8fe4876a2bf1d5d80e6", "author": {"user": null}, "url": "https://github.com/vaadin/flow/commit/8cb297a0fa707232221ac8fe4876a2bf1d5d80e6", "committedDate": "2020-09-29T12:14:30Z", "message": "Implement Serializable"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "d0d85ddb881de110d33dc32051e90c7d61066abe", "author": {"user": null}, "url": "https://github.com/vaadin/flow/commit/d0d85ddb881de110d33dc32051e90c7d61066abe", "committedDate": "2020-09-29T12:41:56Z", "message": "Correct reflection call"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDk4NDc1OTEy", "url": "https://github.com/vaadin/flow/pull/9067#pullrequestreview-498475912", "createdAt": "2020-09-29T13:36:15Z", "commit": {"oid": "d0d85ddb881de110d33dc32051e90c7d61066abe"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yOVQxMzozNjoxNVrOHZtgzQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yOVQxMzozNjoxNVrOHZtgzQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NjcyMjEyNQ==", "bodyText": "Define and throw a dedicated exception instead of using a generic one.", "url": "https://github.com/vaadin/flow/pull/9067#discussion_r496722125", "createdAt": "2020-09-29T13:36:15Z", "author": {"login": "vaadin-bot"}, "path": "flow-polymer-template/src/main/java/com/vaadin/flow/component/polymertemplate/rpc/PublishedServerEventHandlerRpcHandler.java", "diffHunk": "@@ -0,0 +1,371 @@\n+/*\n+ * Copyright 2000-2020 Vaadin Ltd.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\"); you may not\n+ * use this file except in compliance with the License. You may obtain a copy of\n+ * the License at\n+ *\n+ * http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS, WITHOUT\n+ * WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied. See the\n+ * License for the specific language governing permissions and limitations under\n+ * the License.\n+ */\n+package com.vaadin.flow.component.polymertemplate.rpc;\n+\n+import java.io.Serializable;\n+import java.lang.reflect.Array;\n+import java.lang.reflect.InvocationTargetException;\n+import java.lang.reflect.Method;\n+import java.lang.reflect.Type;\n+import java.util.ArrayList;\n+import java.util.Collection;\n+import java.util.List;\n+import java.util.Optional;\n+import java.util.stream.Collectors;\n+import java.util.stream.Stream;\n+\n+import org.slf4j.LoggerFactory;\n+\n+import com.vaadin.flow.component.ClientCallable;\n+import com.vaadin.flow.component.Component;\n+import com.vaadin.flow.component.Composite;\n+import com.vaadin.flow.component.littemplate.LitTemplate;\n+import com.vaadin.flow.component.polymertemplate.EventHandler;\n+import com.vaadin.flow.component.polymertemplate.PolymerTemplate;\n+import com.vaadin.flow.dom.DisabledUpdateMode;\n+import com.vaadin.flow.internal.ReflectTools;\n+import com.vaadin.flow.internal.StateNode;\n+import com.vaadin.flow.internal.nodefeature.ClientCallableHandlers;\n+import com.vaadin.flow.internal.nodefeature.ComponentMapping;\n+import com.vaadin.flow.internal.nodefeature.PolymerServerEventHandlers;\n+import com.vaadin.flow.server.communication.rpc.DefaultRpcDecoder;\n+import com.vaadin.flow.server.communication.rpc.RpcDecodeException;\n+import com.vaadin.flow.server.communication.rpc.RpcDecoder;\n+import com.vaadin.flow.server.communication.rpc.StringToEnumDecoder;\n+import com.vaadin.flow.server.communication.rpc.StringToNumberDecoder;\n+import com.vaadin.flow.shared.JsonConstants;\n+import com.vaadin.flow.templatemodel.ModelType;\n+\n+import elemental.json.Json;\n+import elemental.json.JsonArray;\n+import elemental.json.JsonObject;\n+import elemental.json.JsonType;\n+import elemental.json.JsonValue;\n+\n+/**\n+ * RPC handler for events triggered through <code>element.$server</code> or\n+ * simply <code>$server</code> in template event handlers.\n+ *\n+ * @see JsonConstants#RPC_PUBLISHED_SERVER_EVENT_HANDLER\n+ *\n+ * @author Vaadin Ltd\n+ * @since 1.0\n+ *\n+ * @deprecated Polymer template support is deprecated - we recommend you to use\n+ *             {@link LitTemplate} instead. Read more details from <a href=\n+ *             \"https://vaadin.com/blog/future-of-html-templates-in-vaadin\">the\n+ *             Vaadin blog.</a>\n+ */\n+@Deprecated\n+public class PublishedServerEventHandlerRpcHandler implements Serializable {\n+\n+    private static final Collection<RpcDecoder> DECODERS = loadDecoders();\n+\n+    public static void handleNode(StateNode node, JsonObject invocationJson) {\n+        assert invocationJson\n+                .hasKey(JsonConstants.RPC_TEMPLATE_EVENT_METHOD_NAME);\n+        String methodName = invocationJson\n+                .getString(JsonConstants.RPC_TEMPLATE_EVENT_METHOD_NAME);\n+        if (methodName == null) {\n+            throw new IllegalArgumentException(\n+                    \"Event handler method name may not be null\");\n+        }\n+        JsonValue args = invocationJson\n+                .get(JsonConstants.RPC_TEMPLATE_EVENT_ARGS);\n+        if (args == null) {\n+            args = Json.createArray();\n+        }\n+        if (args.getType() != JsonType.ARRAY) {\n+            throw new IllegalArgumentException(\n+                    \"Incorrect type for method arguments: \" + args.getClass());\n+        }\n+        int promiseId;\n+        if (invocationJson.hasKey(JsonConstants.RPC_TEMPLATE_EVENT_PROMISE)) {\n+            promiseId = (int) invocationJson\n+                    .getNumber(JsonConstants.RPC_TEMPLATE_EVENT_PROMISE);\n+        } else {\n+            promiseId = -1;\n+        }\n+        assert node.hasFeature(ComponentMapping.class);\n+        Optional<Component> component = ComponentMapping.getComponent(node);\n+        if (!component.isPresent()) {\n+            throw new IllegalStateException(\n+                    \"Unable to handle RPC template event JSON message: \"\n+                            + \"there is no component available for the target node\");\n+        }\n+\n+        boolean execute = node.isEnabled();\n+\n+        if (!execute) {\n+            ClientCallableHandlers clientDelegate = node\n+                    .getFeature(ClientCallableHandlers.class);\n+            PolymerServerEventHandlers eventHandlers = node\n+                    .getFeature(PolymerServerEventHandlers.class);\n+            if (clientDelegate.hasHandler(methodName)) {\n+                execute = DisabledUpdateMode.ALWAYS.equals(\n+                        clientDelegate.getDisabledUpdateMode(methodName));\n+            }\n+            if (eventHandlers.hasHandler(methodName)) {\n+                execute = execute || DisabledUpdateMode.ALWAYS.equals(\n+                        eventHandlers.getDisabledUpdateMode(methodName));\n+            }\n+        }\n+\n+        if (execute) {\n+            invokeMethod(component.get(), component.get().getClass(),\n+                    methodName, (JsonArray) args, promiseId);\n+        }\n+    }\n+\n+    static void invokeMethod(Component instance, Class<?> clazz,\n+            String methodName, JsonArray args, int promiseId) {\n+        assert instance != null;\n+        Optional<Method> method = findMethod(instance, clazz, methodName);\n+        if (method.isPresent()) {\n+            invokeMethod(instance, method.get(), args, promiseId);\n+        } else if (instance instanceof Composite) {\n+            Component compositeContent = ((Composite<?>) instance).getContent();\n+            invokeMethod(compositeContent, compositeContent.getClass(),\n+                    methodName, args, promiseId);\n+        } else {\n+            String msg = String.format(\"Neither class '%s' \"\n+                    + \"nor its super classes declare event handler method '%s'\",\n+                    instance.getClass().getName(), methodName);\n+            throw new IllegalStateException(msg);\n+        }\n+    }\n+\n+    private static Optional<Method> findMethod(Component instance,\n+            Class<?> clazz, String methodName) {\n+        List<Method> methods = Stream.of(clazz.getDeclaredMethods())\n+                .filter(method -> methodName.equals(method.getName()))\n+                .filter(method -> method.isAnnotationPresent(EventHandler.class)\n+                        || method.isAnnotationPresent(ClientCallable.class))\n+                .collect(Collectors.toList());\n+        if (methods.size() > 1) {\n+            String msg = String.format(\"Class '%s' contains \"\n+                    + \"several event handler method with the same name '%s'\",\n+                    instance.getClass().getName(), methodName);\n+            throw new IllegalStateException(msg);\n+        } else if (methods.size() == 1) {\n+            return Optional.of(methods.get(0));\n+        } else if (!Component.class.equals(clazz)) {\n+            return findMethod(instance, clazz.getSuperclass(), methodName);\n+        } else {\n+            return Optional.empty();\n+        }\n+    }\n+\n+    private static void invokeMethod(Component instance, Method method,\n+            JsonArray args, int promiseId) {\n+        if (promiseId == -1) {\n+            invokeMethod(instance, method, args);\n+        } else {\n+            try {\n+                Serializable returnValue = (Serializable) invokeMethod(instance,\n+                        method, args);\n+\n+                instance.getElement()\n+                        .executeJs(\"this.$server['\"\n+                                + JsonConstants.RPC_PROMISE_CALLBACK_NAME\n+                                + \"']($0, true, $1)\",\n+                                Integer.valueOf(promiseId), returnValue);\n+            } catch (RuntimeException e) {\n+                instance.getElement()\n+                        .executeJs(\"this.$server['\"\n+                                + JsonConstants.RPC_PROMISE_CALLBACK_NAME\n+                                + \"']($0, false)\", Integer.valueOf(promiseId));\n+\n+                throw e;\n+            }\n+        }\n+    }\n+\n+    private static Object invokeMethod(Component instance, Method method,\n+            JsonArray args) {\n+        try {\n+            method.setAccessible(true);\n+            return method.invoke(instance, decodeArgs(instance, method, args));\n+        } catch (IllegalAccessException e) {\n+            throw new RuntimeException(e);\n+        } catch (InvocationTargetException e) {\n+            LoggerFactory.getLogger(\n+                    PublishedServerEventHandlerRpcHandler.class.getName())\n+                    .debug(null, e);\n+            throw new RuntimeException(e.getCause());", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d0d85ddb881de110d33dc32051e90c7d61066abe"}, "originalPosition": 208}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDk4NDc1OTMy", "url": "https://github.com/vaadin/flow/pull/9067#pullrequestreview-498475932", "createdAt": "2020-09-29T13:36:16Z", "commit": {"oid": "d0d85ddb881de110d33dc32051e90c7d61066abe"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yOVQxMzozNjoxNlrOHZtg2w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yOVQxMzozNjoxNlrOHZtg2w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NjcyMjEzOQ==", "bodyText": "Merge this if statement with the enclosing one.", "url": "https://github.com/vaadin/flow/pull/9067#discussion_r496722139", "createdAt": "2020-09-29T13:36:16Z", "author": {"login": "vaadin-bot"}, "path": "flow-polymer-template/src/main/java/com/vaadin/flow/component/polymertemplate/rpc/PublishedServerEventHandlerRpcHandler.java", "diffHunk": "@@ -0,0 +1,371 @@\n+/*\n+ * Copyright 2000-2020 Vaadin Ltd.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\"); you may not\n+ * use this file except in compliance with the License. You may obtain a copy of\n+ * the License at\n+ *\n+ * http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS, WITHOUT\n+ * WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied. See the\n+ * License for the specific language governing permissions and limitations under\n+ * the License.\n+ */\n+package com.vaadin.flow.component.polymertemplate.rpc;\n+\n+import java.io.Serializable;\n+import java.lang.reflect.Array;\n+import java.lang.reflect.InvocationTargetException;\n+import java.lang.reflect.Method;\n+import java.lang.reflect.Type;\n+import java.util.ArrayList;\n+import java.util.Collection;\n+import java.util.List;\n+import java.util.Optional;\n+import java.util.stream.Collectors;\n+import java.util.stream.Stream;\n+\n+import org.slf4j.LoggerFactory;\n+\n+import com.vaadin.flow.component.ClientCallable;\n+import com.vaadin.flow.component.Component;\n+import com.vaadin.flow.component.Composite;\n+import com.vaadin.flow.component.littemplate.LitTemplate;\n+import com.vaadin.flow.component.polymertemplate.EventHandler;\n+import com.vaadin.flow.component.polymertemplate.PolymerTemplate;\n+import com.vaadin.flow.dom.DisabledUpdateMode;\n+import com.vaadin.flow.internal.ReflectTools;\n+import com.vaadin.flow.internal.StateNode;\n+import com.vaadin.flow.internal.nodefeature.ClientCallableHandlers;\n+import com.vaadin.flow.internal.nodefeature.ComponentMapping;\n+import com.vaadin.flow.internal.nodefeature.PolymerServerEventHandlers;\n+import com.vaadin.flow.server.communication.rpc.DefaultRpcDecoder;\n+import com.vaadin.flow.server.communication.rpc.RpcDecodeException;\n+import com.vaadin.flow.server.communication.rpc.RpcDecoder;\n+import com.vaadin.flow.server.communication.rpc.StringToEnumDecoder;\n+import com.vaadin.flow.server.communication.rpc.StringToNumberDecoder;\n+import com.vaadin.flow.shared.JsonConstants;\n+import com.vaadin.flow.templatemodel.ModelType;\n+\n+import elemental.json.Json;\n+import elemental.json.JsonArray;\n+import elemental.json.JsonObject;\n+import elemental.json.JsonType;\n+import elemental.json.JsonValue;\n+\n+/**\n+ * RPC handler for events triggered through <code>element.$server</code> or\n+ * simply <code>$server</code> in template event handlers.\n+ *\n+ * @see JsonConstants#RPC_PUBLISHED_SERVER_EVENT_HANDLER\n+ *\n+ * @author Vaadin Ltd\n+ * @since 1.0\n+ *\n+ * @deprecated Polymer template support is deprecated - we recommend you to use\n+ *             {@link LitTemplate} instead. Read more details from <a href=\n+ *             \"https://vaadin.com/blog/future-of-html-templates-in-vaadin\">the\n+ *             Vaadin blog.</a>\n+ */\n+@Deprecated\n+public class PublishedServerEventHandlerRpcHandler implements Serializable {\n+\n+    private static final Collection<RpcDecoder> DECODERS = loadDecoders();\n+\n+    public static void handleNode(StateNode node, JsonObject invocationJson) {\n+        assert invocationJson\n+                .hasKey(JsonConstants.RPC_TEMPLATE_EVENT_METHOD_NAME);\n+        String methodName = invocationJson\n+                .getString(JsonConstants.RPC_TEMPLATE_EVENT_METHOD_NAME);\n+        if (methodName == null) {\n+            throw new IllegalArgumentException(\n+                    \"Event handler method name may not be null\");\n+        }\n+        JsonValue args = invocationJson\n+                .get(JsonConstants.RPC_TEMPLATE_EVENT_ARGS);\n+        if (args == null) {\n+            args = Json.createArray();\n+        }\n+        if (args.getType() != JsonType.ARRAY) {\n+            throw new IllegalArgumentException(\n+                    \"Incorrect type for method arguments: \" + args.getClass());\n+        }\n+        int promiseId;\n+        if (invocationJson.hasKey(JsonConstants.RPC_TEMPLATE_EVENT_PROMISE)) {\n+            promiseId = (int) invocationJson\n+                    .getNumber(JsonConstants.RPC_TEMPLATE_EVENT_PROMISE);\n+        } else {\n+            promiseId = -1;\n+        }\n+        assert node.hasFeature(ComponentMapping.class);\n+        Optional<Component> component = ComponentMapping.getComponent(node);\n+        if (!component.isPresent()) {\n+            throw new IllegalStateException(\n+                    \"Unable to handle RPC template event JSON message: \"\n+                            + \"there is no component available for the target node\");\n+        }\n+\n+        boolean execute = node.isEnabled();\n+\n+        if (!execute) {\n+            ClientCallableHandlers clientDelegate = node\n+                    .getFeature(ClientCallableHandlers.class);\n+            PolymerServerEventHandlers eventHandlers = node\n+                    .getFeature(PolymerServerEventHandlers.class);\n+            if (clientDelegate.hasHandler(methodName)) {\n+                execute = DisabledUpdateMode.ALWAYS.equals(\n+                        clientDelegate.getDisabledUpdateMode(methodName));\n+            }\n+            if (eventHandlers.hasHandler(methodName)) {\n+                execute = execute || DisabledUpdateMode.ALWAYS.equals(\n+                        eventHandlers.getDisabledUpdateMode(methodName));\n+            }\n+        }\n+\n+        if (execute) {\n+            invokeMethod(component.get(), component.get().getClass(),\n+                    methodName, (JsonArray) args, promiseId);\n+        }\n+    }\n+\n+    static void invokeMethod(Component instance, Class<?> clazz,\n+            String methodName, JsonArray args, int promiseId) {\n+        assert instance != null;\n+        Optional<Method> method = findMethod(instance, clazz, methodName);\n+        if (method.isPresent()) {\n+            invokeMethod(instance, method.get(), args, promiseId);\n+        } else if (instance instanceof Composite) {\n+            Component compositeContent = ((Composite<?>) instance).getContent();\n+            invokeMethod(compositeContent, compositeContent.getClass(),\n+                    methodName, args, promiseId);\n+        } else {\n+            String msg = String.format(\"Neither class '%s' \"\n+                    + \"nor its super classes declare event handler method '%s'\",\n+                    instance.getClass().getName(), methodName);\n+            throw new IllegalStateException(msg);\n+        }\n+    }\n+\n+    private static Optional<Method> findMethod(Component instance,\n+            Class<?> clazz, String methodName) {\n+        List<Method> methods = Stream.of(clazz.getDeclaredMethods())\n+                .filter(method -> methodName.equals(method.getName()))\n+                .filter(method -> method.isAnnotationPresent(EventHandler.class)\n+                        || method.isAnnotationPresent(ClientCallable.class))\n+                .collect(Collectors.toList());\n+        if (methods.size() > 1) {\n+            String msg = String.format(\"Class '%s' contains \"\n+                    + \"several event handler method with the same name '%s'\",\n+                    instance.getClass().getName(), methodName);\n+            throw new IllegalStateException(msg);\n+        } else if (methods.size() == 1) {\n+            return Optional.of(methods.get(0));\n+        } else if (!Component.class.equals(clazz)) {\n+            return findMethod(instance, clazz.getSuperclass(), methodName);\n+        } else {\n+            return Optional.empty();\n+        }\n+    }\n+\n+    private static void invokeMethod(Component instance, Method method,\n+            JsonArray args, int promiseId) {\n+        if (promiseId == -1) {\n+            invokeMethod(instance, method, args);\n+        } else {\n+            try {\n+                Serializable returnValue = (Serializable) invokeMethod(instance,\n+                        method, args);\n+\n+                instance.getElement()\n+                        .executeJs(\"this.$server['\"\n+                                + JsonConstants.RPC_PROMISE_CALLBACK_NAME\n+                                + \"']($0, true, $1)\",\n+                                Integer.valueOf(promiseId), returnValue);\n+            } catch (RuntimeException e) {\n+                instance.getElement()\n+                        .executeJs(\"this.$server['\"\n+                                + JsonConstants.RPC_PROMISE_CALLBACK_NAME\n+                                + \"']($0, false)\", Integer.valueOf(promiseId));\n+\n+                throw e;\n+            }\n+        }\n+    }\n+\n+    private static Object invokeMethod(Component instance, Method method,\n+            JsonArray args) {\n+        try {\n+            method.setAccessible(true);\n+            return method.invoke(instance, decodeArgs(instance, method, args));\n+        } catch (IllegalAccessException e) {\n+            throw new RuntimeException(e);\n+        } catch (InvocationTargetException e) {\n+            LoggerFactory.getLogger(\n+                    PublishedServerEventHandlerRpcHandler.class.getName())\n+                    .debug(null, e);\n+            throw new RuntimeException(e.getCause());\n+        }\n+    }\n+\n+    private static Object[] decodeArgs(Component instance, Method method,\n+            JsonArray argsFromClient) {\n+        int methodArgs = method.getParameterCount();\n+        int clientValuesCount = argsFromClient.length();\n+        JsonArray argValues;\n+        if (method.isVarArgs()) {\n+            if (clientValuesCount >= methodArgs - 1) {\n+                argValues = unwrapVarArgs(argsFromClient, method);\n+            } else {\n+                String msg = String.format(\n+                        \"The number of received values (%d) is not enough \"\n+                                + \"to call the method '%s' declared in '%s' which \"\n+                                + \"has vararg parameter and the number of arguments %d\",\n+                        argsFromClient.length(), method.getName(),\n+                        method.getDeclaringClass().getName(),\n+                        method.getParameterCount());\n+                throw new IllegalArgumentException(msg);\n+            }\n+        } else {\n+            if (methodArgs == clientValuesCount) {\n+                argValues = argsFromClient;\n+            } else {\n+                String msg = String.format(\n+                        \"The number of received values (%d) is not equal \"\n+                                + \"to the number of arguments (%d) in the method '%s' \"\n+                                + \"declared in '%s'\",\n+                        argsFromClient.length(), method.getParameterCount(),\n+                        method.getName(), method.getDeclaringClass().getName());\n+                throw new IllegalArgumentException(msg);\n+            }\n+        }\n+        List<Object> decoded = new ArrayList<>(method.getParameterCount());\n+        Class<?>[] methodParameterTypes = method.getParameterTypes();\n+        for (int i = 0; i < argValues.length(); i++) {\n+            Class<?> type = methodParameterTypes[i];\n+            decoded.add(decodeArg(instance, method, type, i, argValues.get(i)));\n+        }\n+        return decoded.toArray(new Object[method.getParameterCount()]);\n+    }\n+\n+    private static JsonArray unwrapVarArgs(JsonArray argsFromClient,\n+            Method method) {\n+        int paramCount = method.getParameterCount();\n+        if (argsFromClient.length() == paramCount) {\n+            if (argsFromClient.get(paramCount - 1).getType()", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d0d85ddb881de110d33dc32051e90c7d61066abe"}, "originalPosition": 256}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDk4NDc1OTU0", "url": "https://github.com/vaadin/flow/pull/9067#pullrequestreview-498475954", "createdAt": "2020-09-29T13:36:17Z", "commit": {"oid": "d0d85ddb881de110d33dc32051e90c7d61066abe"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yOVQxMzozNjoxN1rOHZtg6g==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yOVQxMzozNjoxN1rOHZtg6g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NjcyMjE1NA==", "bodyText": "Call \"Optional#isPresent()\" before accessing the value.", "url": "https://github.com/vaadin/flow/pull/9067#discussion_r496722154", "createdAt": "2020-09-29T13:36:17Z", "author": {"login": "vaadin-bot"}, "path": "flow-polymer-template/src/main/java/com/vaadin/flow/component/polymertemplate/rpc/PublishedServerEventHandlerRpcHandler.java", "diffHunk": "@@ -0,0 +1,371 @@\n+/*\n+ * Copyright 2000-2020 Vaadin Ltd.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\"); you may not\n+ * use this file except in compliance with the License. You may obtain a copy of\n+ * the License at\n+ *\n+ * http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS, WITHOUT\n+ * WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied. See the\n+ * License for the specific language governing permissions and limitations under\n+ * the License.\n+ */\n+package com.vaadin.flow.component.polymertemplate.rpc;\n+\n+import java.io.Serializable;\n+import java.lang.reflect.Array;\n+import java.lang.reflect.InvocationTargetException;\n+import java.lang.reflect.Method;\n+import java.lang.reflect.Type;\n+import java.util.ArrayList;\n+import java.util.Collection;\n+import java.util.List;\n+import java.util.Optional;\n+import java.util.stream.Collectors;\n+import java.util.stream.Stream;\n+\n+import org.slf4j.LoggerFactory;\n+\n+import com.vaadin.flow.component.ClientCallable;\n+import com.vaadin.flow.component.Component;\n+import com.vaadin.flow.component.Composite;\n+import com.vaadin.flow.component.littemplate.LitTemplate;\n+import com.vaadin.flow.component.polymertemplate.EventHandler;\n+import com.vaadin.flow.component.polymertemplate.PolymerTemplate;\n+import com.vaadin.flow.dom.DisabledUpdateMode;\n+import com.vaadin.flow.internal.ReflectTools;\n+import com.vaadin.flow.internal.StateNode;\n+import com.vaadin.flow.internal.nodefeature.ClientCallableHandlers;\n+import com.vaadin.flow.internal.nodefeature.ComponentMapping;\n+import com.vaadin.flow.internal.nodefeature.PolymerServerEventHandlers;\n+import com.vaadin.flow.server.communication.rpc.DefaultRpcDecoder;\n+import com.vaadin.flow.server.communication.rpc.RpcDecodeException;\n+import com.vaadin.flow.server.communication.rpc.RpcDecoder;\n+import com.vaadin.flow.server.communication.rpc.StringToEnumDecoder;\n+import com.vaadin.flow.server.communication.rpc.StringToNumberDecoder;\n+import com.vaadin.flow.shared.JsonConstants;\n+import com.vaadin.flow.templatemodel.ModelType;\n+\n+import elemental.json.Json;\n+import elemental.json.JsonArray;\n+import elemental.json.JsonObject;\n+import elemental.json.JsonType;\n+import elemental.json.JsonValue;\n+\n+/**\n+ * RPC handler for events triggered through <code>element.$server</code> or\n+ * simply <code>$server</code> in template event handlers.\n+ *\n+ * @see JsonConstants#RPC_PUBLISHED_SERVER_EVENT_HANDLER\n+ *\n+ * @author Vaadin Ltd\n+ * @since 1.0\n+ *\n+ * @deprecated Polymer template support is deprecated - we recommend you to use\n+ *             {@link LitTemplate} instead. Read more details from <a href=\n+ *             \"https://vaadin.com/blog/future-of-html-templates-in-vaadin\">the\n+ *             Vaadin blog.</a>\n+ */\n+@Deprecated\n+public class PublishedServerEventHandlerRpcHandler implements Serializable {\n+\n+    private static final Collection<RpcDecoder> DECODERS = loadDecoders();\n+\n+    public static void handleNode(StateNode node, JsonObject invocationJson) {\n+        assert invocationJson\n+                .hasKey(JsonConstants.RPC_TEMPLATE_EVENT_METHOD_NAME);\n+        String methodName = invocationJson\n+                .getString(JsonConstants.RPC_TEMPLATE_EVENT_METHOD_NAME);\n+        if (methodName == null) {\n+            throw new IllegalArgumentException(\n+                    \"Event handler method name may not be null\");\n+        }\n+        JsonValue args = invocationJson\n+                .get(JsonConstants.RPC_TEMPLATE_EVENT_ARGS);\n+        if (args == null) {\n+            args = Json.createArray();\n+        }\n+        if (args.getType() != JsonType.ARRAY) {\n+            throw new IllegalArgumentException(\n+                    \"Incorrect type for method arguments: \" + args.getClass());\n+        }\n+        int promiseId;\n+        if (invocationJson.hasKey(JsonConstants.RPC_TEMPLATE_EVENT_PROMISE)) {\n+            promiseId = (int) invocationJson\n+                    .getNumber(JsonConstants.RPC_TEMPLATE_EVENT_PROMISE);\n+        } else {\n+            promiseId = -1;\n+        }\n+        assert node.hasFeature(ComponentMapping.class);\n+        Optional<Component> component = ComponentMapping.getComponent(node);\n+        if (!component.isPresent()) {\n+            throw new IllegalStateException(\n+                    \"Unable to handle RPC template event JSON message: \"\n+                            + \"there is no component available for the target node\");\n+        }\n+\n+        boolean execute = node.isEnabled();\n+\n+        if (!execute) {\n+            ClientCallableHandlers clientDelegate = node\n+                    .getFeature(ClientCallableHandlers.class);\n+            PolymerServerEventHandlers eventHandlers = node\n+                    .getFeature(PolymerServerEventHandlers.class);\n+            if (clientDelegate.hasHandler(methodName)) {\n+                execute = DisabledUpdateMode.ALWAYS.equals(\n+                        clientDelegate.getDisabledUpdateMode(methodName));\n+            }\n+            if (eventHandlers.hasHandler(methodName)) {\n+                execute = execute || DisabledUpdateMode.ALWAYS.equals(\n+                        eventHandlers.getDisabledUpdateMode(methodName));\n+            }\n+        }\n+\n+        if (execute) {\n+            invokeMethod(component.get(), component.get().getClass(),\n+                    methodName, (JsonArray) args, promiseId);\n+        }\n+    }\n+\n+    static void invokeMethod(Component instance, Class<?> clazz,\n+            String methodName, JsonArray args, int promiseId) {\n+        assert instance != null;\n+        Optional<Method> method = findMethod(instance, clazz, methodName);\n+        if (method.isPresent()) {\n+            invokeMethod(instance, method.get(), args, promiseId);\n+        } else if (instance instanceof Composite) {\n+            Component compositeContent = ((Composite<?>) instance).getContent();\n+            invokeMethod(compositeContent, compositeContent.getClass(),\n+                    methodName, args, promiseId);\n+        } else {\n+            String msg = String.format(\"Neither class '%s' \"\n+                    + \"nor its super classes declare event handler method '%s'\",\n+                    instance.getClass().getName(), methodName);\n+            throw new IllegalStateException(msg);\n+        }\n+    }\n+\n+    private static Optional<Method> findMethod(Component instance,\n+            Class<?> clazz, String methodName) {\n+        List<Method> methods = Stream.of(clazz.getDeclaredMethods())\n+                .filter(method -> methodName.equals(method.getName()))\n+                .filter(method -> method.isAnnotationPresent(EventHandler.class)\n+                        || method.isAnnotationPresent(ClientCallable.class))\n+                .collect(Collectors.toList());\n+        if (methods.size() > 1) {\n+            String msg = String.format(\"Class '%s' contains \"\n+                    + \"several event handler method with the same name '%s'\",\n+                    instance.getClass().getName(), methodName);\n+            throw new IllegalStateException(msg);\n+        } else if (methods.size() == 1) {\n+            return Optional.of(methods.get(0));\n+        } else if (!Component.class.equals(clazz)) {\n+            return findMethod(instance, clazz.getSuperclass(), methodName);\n+        } else {\n+            return Optional.empty();\n+        }\n+    }\n+\n+    private static void invokeMethod(Component instance, Method method,\n+            JsonArray args, int promiseId) {\n+        if (promiseId == -1) {\n+            invokeMethod(instance, method, args);\n+        } else {\n+            try {\n+                Serializable returnValue = (Serializable) invokeMethod(instance,\n+                        method, args);\n+\n+                instance.getElement()\n+                        .executeJs(\"this.$server['\"\n+                                + JsonConstants.RPC_PROMISE_CALLBACK_NAME\n+                                + \"']($0, true, $1)\",\n+                                Integer.valueOf(promiseId), returnValue);\n+            } catch (RuntimeException e) {\n+                instance.getElement()\n+                        .executeJs(\"this.$server['\"\n+                                + JsonConstants.RPC_PROMISE_CALLBACK_NAME\n+                                + \"']($0, false)\", Integer.valueOf(promiseId));\n+\n+                throw e;\n+            }\n+        }\n+    }\n+\n+    private static Object invokeMethod(Component instance, Method method,\n+            JsonArray args) {\n+        try {\n+            method.setAccessible(true);\n+            return method.invoke(instance, decodeArgs(instance, method, args));\n+        } catch (IllegalAccessException e) {\n+            throw new RuntimeException(e);\n+        } catch (InvocationTargetException e) {\n+            LoggerFactory.getLogger(\n+                    PublishedServerEventHandlerRpcHandler.class.getName())\n+                    .debug(null, e);\n+            throw new RuntimeException(e.getCause());\n+        }\n+    }\n+\n+    private static Object[] decodeArgs(Component instance, Method method,\n+            JsonArray argsFromClient) {\n+        int methodArgs = method.getParameterCount();\n+        int clientValuesCount = argsFromClient.length();\n+        JsonArray argValues;\n+        if (method.isVarArgs()) {\n+            if (clientValuesCount >= methodArgs - 1) {\n+                argValues = unwrapVarArgs(argsFromClient, method);\n+            } else {\n+                String msg = String.format(\n+                        \"The number of received values (%d) is not enough \"\n+                                + \"to call the method '%s' declared in '%s' which \"\n+                                + \"has vararg parameter and the number of arguments %d\",\n+                        argsFromClient.length(), method.getName(),\n+                        method.getDeclaringClass().getName(),\n+                        method.getParameterCount());\n+                throw new IllegalArgumentException(msg);\n+            }\n+        } else {\n+            if (methodArgs == clientValuesCount) {\n+                argValues = argsFromClient;\n+            } else {\n+                String msg = String.format(\n+                        \"The number of received values (%d) is not equal \"\n+                                + \"to the number of arguments (%d) in the method '%s' \"\n+                                + \"declared in '%s'\",\n+                        argsFromClient.length(), method.getParameterCount(),\n+                        method.getName(), method.getDeclaringClass().getName());\n+                throw new IllegalArgumentException(msg);\n+            }\n+        }\n+        List<Object> decoded = new ArrayList<>(method.getParameterCount());\n+        Class<?>[] methodParameterTypes = method.getParameterTypes();\n+        for (int i = 0; i < argValues.length(); i++) {\n+            Class<?> type = methodParameterTypes[i];\n+            decoded.add(decodeArg(instance, method, type, i, argValues.get(i)));\n+        }\n+        return decoded.toArray(new Object[method.getParameterCount()]);\n+    }\n+\n+    private static JsonArray unwrapVarArgs(JsonArray argsFromClient,\n+            Method method) {\n+        int paramCount = method.getParameterCount();\n+        if (argsFromClient.length() == paramCount) {\n+            if (argsFromClient.get(paramCount - 1).getType()\n+                    .equals(JsonType.ARRAY)) {\n+                return argsFromClient;\n+            }\n+        }\n+        JsonArray result = Json.createArray();\n+        JsonArray rest = Json.createArray();\n+        int newIndex = 0;\n+        for (int i = 0; i < argsFromClient.length(); i++) {\n+            JsonValue value = argsFromClient.get(i);\n+            if (i < paramCount - 1) {\n+                result.set(i, value);\n+            } else {\n+                rest.set(newIndex, value);\n+                newIndex++;\n+            }\n+        }\n+        result.set(paramCount - 1, rest);\n+        return result;\n+    }\n+\n+    private static Object decodeArg(Component instance, Method method,\n+            Class<?> type, int index, JsonValue argValue) {\n+        // come up with method to know that it's an id and should be gotten from\n+        // the model\n+        assert argValue != null;\n+        if (type.isPrimitive() && argValue.getType() == JsonType.NULL) {\n+            String msg = String.format(\n+                    \"Null values are not allowed for primitive types but \"\n+                            + \"a 'null' value was received for parameter %d \"\n+                            + \"which refers to primitive type '%s' \"\n+                            + \"in the method '%s' defined in the class '%s'\",\n+                    index, type.getName(), method.getName(),\n+                    method.getDeclaringClass().getName());\n+            throw new IllegalArgumentException(msg);\n+        } else if (type.isArray()) {\n+            return decodeArray(method, type, index, argValue);\n+        } else {\n+            Class<?> convertedType = ReflectTools.convertPrimitiveType(type);\n+\n+            if (isTemplateModelValue(instance, argValue, convertedType)) {\n+                return getTemplateItem((PolymerTemplate<?>) instance,\n+                        (JsonObject) argValue,\n+                        method.getGenericParameterTypes()[index]);\n+            }\n+\n+            Optional<RpcDecoder> decoder = getDecoder(argValue, convertedType);\n+            if (decoder.isPresent()) {\n+                try {\n+                    return decoder.get().decode(argValue, convertedType);\n+                } catch (RpcDecodeException exception) {\n+                    throw new IllegalArgumentException(exception);\n+                }\n+            }\n+            String msg = String.format(\"Class '%s' has the method '%s' \"\n+                    + \"whose parameter %d refers to unsupported type '%s'\",\n+                    method.getDeclaringClass().getName(), method.getName(),\n+                    index, type.getName());\n+            throw new IllegalArgumentException(msg);\n+        }\n+    }\n+\n+    private static Optional<RpcDecoder> getDecoder(JsonValue value,\n+            Class<?> type) {\n+        return DECODERS.stream()\n+                .filter(decoder -> decoder.isApplicable(value, type))\n+                .findFirst();\n+    }\n+\n+    private static boolean isTemplateModelValue(Component instance,\n+            JsonValue argValue, Class<?> convertedType) {\n+        return instance instanceof PolymerTemplate\n+                && argValue instanceof JsonObject\n+                && ((PolymerTemplate<?>) instance)\n+                        .isSupportedClass(convertedType)\n+                && ((JsonObject) argValue).hasKey(\"nodeId\");\n+    }\n+\n+    private static Object getTemplateItem(PolymerTemplate<?> template,\n+            JsonObject argValue, Type convertedType) {\n+        StateNode node = template.getUI().get().getInternals().getStateTree()", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d0d85ddb881de110d33dc32051e90c7d61066abe"}, "originalPosition": 336}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDk4NDc1OTcy", "url": "https://github.com/vaadin/flow/pull/9067#pullrequestreview-498475972", "createdAt": "2020-09-29T13:36:18Z", "commit": {"oid": "d0d85ddb881de110d33dc32051e90c7d61066abe"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yOVQxMzozNjoxOFrOHZtg-A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yOVQxMzozNjoxOFrOHZtg-A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NjcyMjE2OA==", "bodyText": "Do not forget to remove this deprecated code someday.", "url": "https://github.com/vaadin/flow/pull/9067#discussion_r496722168", "createdAt": "2020-09-29T13:36:18Z", "author": {"login": "vaadin-bot"}, "path": "flow-polymer-template/src/main/java/com/vaadin/flow/component/polymertemplate/rpc/PublishedServerEventHandlerRpcHandler.java", "diffHunk": "@@ -0,0 +1,371 @@\n+/*\n+ * Copyright 2000-2020 Vaadin Ltd.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\"); you may not\n+ * use this file except in compliance with the License. You may obtain a copy of\n+ * the License at\n+ *\n+ * http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS, WITHOUT\n+ * WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied. See the\n+ * License for the specific language governing permissions and limitations under\n+ * the License.\n+ */\n+package com.vaadin.flow.component.polymertemplate.rpc;\n+\n+import java.io.Serializable;\n+import java.lang.reflect.Array;\n+import java.lang.reflect.InvocationTargetException;\n+import java.lang.reflect.Method;\n+import java.lang.reflect.Type;\n+import java.util.ArrayList;\n+import java.util.Collection;\n+import java.util.List;\n+import java.util.Optional;\n+import java.util.stream.Collectors;\n+import java.util.stream.Stream;\n+\n+import org.slf4j.LoggerFactory;\n+\n+import com.vaadin.flow.component.ClientCallable;\n+import com.vaadin.flow.component.Component;\n+import com.vaadin.flow.component.Composite;\n+import com.vaadin.flow.component.littemplate.LitTemplate;\n+import com.vaadin.flow.component.polymertemplate.EventHandler;\n+import com.vaadin.flow.component.polymertemplate.PolymerTemplate;\n+import com.vaadin.flow.dom.DisabledUpdateMode;\n+import com.vaadin.flow.internal.ReflectTools;\n+import com.vaadin.flow.internal.StateNode;\n+import com.vaadin.flow.internal.nodefeature.ClientCallableHandlers;\n+import com.vaadin.flow.internal.nodefeature.ComponentMapping;\n+import com.vaadin.flow.internal.nodefeature.PolymerServerEventHandlers;\n+import com.vaadin.flow.server.communication.rpc.DefaultRpcDecoder;\n+import com.vaadin.flow.server.communication.rpc.RpcDecodeException;\n+import com.vaadin.flow.server.communication.rpc.RpcDecoder;\n+import com.vaadin.flow.server.communication.rpc.StringToEnumDecoder;\n+import com.vaadin.flow.server.communication.rpc.StringToNumberDecoder;\n+import com.vaadin.flow.shared.JsonConstants;\n+import com.vaadin.flow.templatemodel.ModelType;\n+\n+import elemental.json.Json;\n+import elemental.json.JsonArray;\n+import elemental.json.JsonObject;\n+import elemental.json.JsonType;\n+import elemental.json.JsonValue;\n+\n+/**\n+ * RPC handler for events triggered through <code>element.$server</code> or\n+ * simply <code>$server</code> in template event handlers.\n+ *\n+ * @see JsonConstants#RPC_PUBLISHED_SERVER_EVENT_HANDLER\n+ *\n+ * @author Vaadin Ltd\n+ * @since 1.0\n+ *\n+ * @deprecated Polymer template support is deprecated - we recommend you to use\n+ *             {@link LitTemplate} instead. Read more details from <a href=\n+ *             \"https://vaadin.com/blog/future-of-html-templates-in-vaadin\">the\n+ *             Vaadin blog.</a>\n+ */\n+@Deprecated\n+public class PublishedServerEventHandlerRpcHandler implements Serializable {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d0d85ddb881de110d33dc32051e90c7d61066abe"}, "originalPosition": 73}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDk4NDc1OTg2", "url": "https://github.com/vaadin/flow/pull/9067#pullrequestreview-498475986", "createdAt": "2020-09-29T13:36:19Z", "commit": {"oid": "d0d85ddb881de110d33dc32051e90c7d61066abe"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yOVQxMzozNjoxOVrOHZthCQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yOVQxMzozNjoxOVrOHZthCQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NjcyMjE4NQ==", "bodyText": "Define and throw a dedicated exception instead of using a generic one.", "url": "https://github.com/vaadin/flow/pull/9067#discussion_r496722185", "createdAt": "2020-09-29T13:36:19Z", "author": {"login": "vaadin-bot"}, "path": "flow-polymer-template/src/main/java/com/vaadin/flow/component/polymertemplate/rpc/PublishedServerEventHandlerRpcHandler.java", "diffHunk": "@@ -0,0 +1,371 @@\n+/*\n+ * Copyright 2000-2020 Vaadin Ltd.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\"); you may not\n+ * use this file except in compliance with the License. You may obtain a copy of\n+ * the License at\n+ *\n+ * http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS, WITHOUT\n+ * WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied. See the\n+ * License for the specific language governing permissions and limitations under\n+ * the License.\n+ */\n+package com.vaadin.flow.component.polymertemplate.rpc;\n+\n+import java.io.Serializable;\n+import java.lang.reflect.Array;\n+import java.lang.reflect.InvocationTargetException;\n+import java.lang.reflect.Method;\n+import java.lang.reflect.Type;\n+import java.util.ArrayList;\n+import java.util.Collection;\n+import java.util.List;\n+import java.util.Optional;\n+import java.util.stream.Collectors;\n+import java.util.stream.Stream;\n+\n+import org.slf4j.LoggerFactory;\n+\n+import com.vaadin.flow.component.ClientCallable;\n+import com.vaadin.flow.component.Component;\n+import com.vaadin.flow.component.Composite;\n+import com.vaadin.flow.component.littemplate.LitTemplate;\n+import com.vaadin.flow.component.polymertemplate.EventHandler;\n+import com.vaadin.flow.component.polymertemplate.PolymerTemplate;\n+import com.vaadin.flow.dom.DisabledUpdateMode;\n+import com.vaadin.flow.internal.ReflectTools;\n+import com.vaadin.flow.internal.StateNode;\n+import com.vaadin.flow.internal.nodefeature.ClientCallableHandlers;\n+import com.vaadin.flow.internal.nodefeature.ComponentMapping;\n+import com.vaadin.flow.internal.nodefeature.PolymerServerEventHandlers;\n+import com.vaadin.flow.server.communication.rpc.DefaultRpcDecoder;\n+import com.vaadin.flow.server.communication.rpc.RpcDecodeException;\n+import com.vaadin.flow.server.communication.rpc.RpcDecoder;\n+import com.vaadin.flow.server.communication.rpc.StringToEnumDecoder;\n+import com.vaadin.flow.server.communication.rpc.StringToNumberDecoder;\n+import com.vaadin.flow.shared.JsonConstants;\n+import com.vaadin.flow.templatemodel.ModelType;\n+\n+import elemental.json.Json;\n+import elemental.json.JsonArray;\n+import elemental.json.JsonObject;\n+import elemental.json.JsonType;\n+import elemental.json.JsonValue;\n+\n+/**\n+ * RPC handler for events triggered through <code>element.$server</code> or\n+ * simply <code>$server</code> in template event handlers.\n+ *\n+ * @see JsonConstants#RPC_PUBLISHED_SERVER_EVENT_HANDLER\n+ *\n+ * @author Vaadin Ltd\n+ * @since 1.0\n+ *\n+ * @deprecated Polymer template support is deprecated - we recommend you to use\n+ *             {@link LitTemplate} instead. Read more details from <a href=\n+ *             \"https://vaadin.com/blog/future-of-html-templates-in-vaadin\">the\n+ *             Vaadin blog.</a>\n+ */\n+@Deprecated\n+public class PublishedServerEventHandlerRpcHandler implements Serializable {\n+\n+    private static final Collection<RpcDecoder> DECODERS = loadDecoders();\n+\n+    public static void handleNode(StateNode node, JsonObject invocationJson) {\n+        assert invocationJson\n+                .hasKey(JsonConstants.RPC_TEMPLATE_EVENT_METHOD_NAME);\n+        String methodName = invocationJson\n+                .getString(JsonConstants.RPC_TEMPLATE_EVENT_METHOD_NAME);\n+        if (methodName == null) {\n+            throw new IllegalArgumentException(\n+                    \"Event handler method name may not be null\");\n+        }\n+        JsonValue args = invocationJson\n+                .get(JsonConstants.RPC_TEMPLATE_EVENT_ARGS);\n+        if (args == null) {\n+            args = Json.createArray();\n+        }\n+        if (args.getType() != JsonType.ARRAY) {\n+            throw new IllegalArgumentException(\n+                    \"Incorrect type for method arguments: \" + args.getClass());\n+        }\n+        int promiseId;\n+        if (invocationJson.hasKey(JsonConstants.RPC_TEMPLATE_EVENT_PROMISE)) {\n+            promiseId = (int) invocationJson\n+                    .getNumber(JsonConstants.RPC_TEMPLATE_EVENT_PROMISE);\n+        } else {\n+            promiseId = -1;\n+        }\n+        assert node.hasFeature(ComponentMapping.class);\n+        Optional<Component> component = ComponentMapping.getComponent(node);\n+        if (!component.isPresent()) {\n+            throw new IllegalStateException(\n+                    \"Unable to handle RPC template event JSON message: \"\n+                            + \"there is no component available for the target node\");\n+        }\n+\n+        boolean execute = node.isEnabled();\n+\n+        if (!execute) {\n+            ClientCallableHandlers clientDelegate = node\n+                    .getFeature(ClientCallableHandlers.class);\n+            PolymerServerEventHandlers eventHandlers = node\n+                    .getFeature(PolymerServerEventHandlers.class);\n+            if (clientDelegate.hasHandler(methodName)) {\n+                execute = DisabledUpdateMode.ALWAYS.equals(\n+                        clientDelegate.getDisabledUpdateMode(methodName));\n+            }\n+            if (eventHandlers.hasHandler(methodName)) {\n+                execute = execute || DisabledUpdateMode.ALWAYS.equals(\n+                        eventHandlers.getDisabledUpdateMode(methodName));\n+            }\n+        }\n+\n+        if (execute) {\n+            invokeMethod(component.get(), component.get().getClass(),\n+                    methodName, (JsonArray) args, promiseId);\n+        }\n+    }\n+\n+    static void invokeMethod(Component instance, Class<?> clazz,\n+            String methodName, JsonArray args, int promiseId) {\n+        assert instance != null;\n+        Optional<Method> method = findMethod(instance, clazz, methodName);\n+        if (method.isPresent()) {\n+            invokeMethod(instance, method.get(), args, promiseId);\n+        } else if (instance instanceof Composite) {\n+            Component compositeContent = ((Composite<?>) instance).getContent();\n+            invokeMethod(compositeContent, compositeContent.getClass(),\n+                    methodName, args, promiseId);\n+        } else {\n+            String msg = String.format(\"Neither class '%s' \"\n+                    + \"nor its super classes declare event handler method '%s'\",\n+                    instance.getClass().getName(), methodName);\n+            throw new IllegalStateException(msg);\n+        }\n+    }\n+\n+    private static Optional<Method> findMethod(Component instance,\n+            Class<?> clazz, String methodName) {\n+        List<Method> methods = Stream.of(clazz.getDeclaredMethods())\n+                .filter(method -> methodName.equals(method.getName()))\n+                .filter(method -> method.isAnnotationPresent(EventHandler.class)\n+                        || method.isAnnotationPresent(ClientCallable.class))\n+                .collect(Collectors.toList());\n+        if (methods.size() > 1) {\n+            String msg = String.format(\"Class '%s' contains \"\n+                    + \"several event handler method with the same name '%s'\",\n+                    instance.getClass().getName(), methodName);\n+            throw new IllegalStateException(msg);\n+        } else if (methods.size() == 1) {\n+            return Optional.of(methods.get(0));\n+        } else if (!Component.class.equals(clazz)) {\n+            return findMethod(instance, clazz.getSuperclass(), methodName);\n+        } else {\n+            return Optional.empty();\n+        }\n+    }\n+\n+    private static void invokeMethod(Component instance, Method method,\n+            JsonArray args, int promiseId) {\n+        if (promiseId == -1) {\n+            invokeMethod(instance, method, args);\n+        } else {\n+            try {\n+                Serializable returnValue = (Serializable) invokeMethod(instance,\n+                        method, args);\n+\n+                instance.getElement()\n+                        .executeJs(\"this.$server['\"\n+                                + JsonConstants.RPC_PROMISE_CALLBACK_NAME\n+                                + \"']($0, true, $1)\",\n+                                Integer.valueOf(promiseId), returnValue);\n+            } catch (RuntimeException e) {\n+                instance.getElement()\n+                        .executeJs(\"this.$server['\"\n+                                + JsonConstants.RPC_PROMISE_CALLBACK_NAME\n+                                + \"']($0, false)\", Integer.valueOf(promiseId));\n+\n+                throw e;\n+            }\n+        }\n+    }\n+\n+    private static Object invokeMethod(Component instance, Method method,\n+            JsonArray args) {\n+        try {\n+            method.setAccessible(true);\n+            return method.invoke(instance, decodeArgs(instance, method, args));\n+        } catch (IllegalAccessException e) {\n+            throw new RuntimeException(e);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d0d85ddb881de110d33dc32051e90c7d61066abe"}, "originalPosition": 203}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDk4NDc2MDA1", "url": "https://github.com/vaadin/flow/pull/9067#pullrequestreview-498476005", "createdAt": "2020-09-29T13:36:20Z", "commit": {"oid": "d0d85ddb881de110d33dc32051e90c7d61066abe"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yOVQxMzozNjoyMFrOHZthGg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yOVQxMzozNjoyMFrOHZthGg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NjcyMjIwMg==", "bodyText": "Document this public method by adding an explicit description.", "url": "https://github.com/vaadin/flow/pull/9067#discussion_r496722202", "createdAt": "2020-09-29T13:36:20Z", "author": {"login": "vaadin-bot"}, "path": "flow-polymer-template/src/main/java/com/vaadin/flow/component/polymertemplate/rpc/PublishedServerEventHandlerRpcHandler.java", "diffHunk": "@@ -0,0 +1,371 @@\n+/*\n+ * Copyright 2000-2020 Vaadin Ltd.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\"); you may not\n+ * use this file except in compliance with the License. You may obtain a copy of\n+ * the License at\n+ *\n+ * http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS, WITHOUT\n+ * WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied. See the\n+ * License for the specific language governing permissions and limitations under\n+ * the License.\n+ */\n+package com.vaadin.flow.component.polymertemplate.rpc;\n+\n+import java.io.Serializable;\n+import java.lang.reflect.Array;\n+import java.lang.reflect.InvocationTargetException;\n+import java.lang.reflect.Method;\n+import java.lang.reflect.Type;\n+import java.util.ArrayList;\n+import java.util.Collection;\n+import java.util.List;\n+import java.util.Optional;\n+import java.util.stream.Collectors;\n+import java.util.stream.Stream;\n+\n+import org.slf4j.LoggerFactory;\n+\n+import com.vaadin.flow.component.ClientCallable;\n+import com.vaadin.flow.component.Component;\n+import com.vaadin.flow.component.Composite;\n+import com.vaadin.flow.component.littemplate.LitTemplate;\n+import com.vaadin.flow.component.polymertemplate.EventHandler;\n+import com.vaadin.flow.component.polymertemplate.PolymerTemplate;\n+import com.vaadin.flow.dom.DisabledUpdateMode;\n+import com.vaadin.flow.internal.ReflectTools;\n+import com.vaadin.flow.internal.StateNode;\n+import com.vaadin.flow.internal.nodefeature.ClientCallableHandlers;\n+import com.vaadin.flow.internal.nodefeature.ComponentMapping;\n+import com.vaadin.flow.internal.nodefeature.PolymerServerEventHandlers;\n+import com.vaadin.flow.server.communication.rpc.DefaultRpcDecoder;\n+import com.vaadin.flow.server.communication.rpc.RpcDecodeException;\n+import com.vaadin.flow.server.communication.rpc.RpcDecoder;\n+import com.vaadin.flow.server.communication.rpc.StringToEnumDecoder;\n+import com.vaadin.flow.server.communication.rpc.StringToNumberDecoder;\n+import com.vaadin.flow.shared.JsonConstants;\n+import com.vaadin.flow.templatemodel.ModelType;\n+\n+import elemental.json.Json;\n+import elemental.json.JsonArray;\n+import elemental.json.JsonObject;\n+import elemental.json.JsonType;\n+import elemental.json.JsonValue;\n+\n+/**\n+ * RPC handler for events triggered through <code>element.$server</code> or\n+ * simply <code>$server</code> in template event handlers.\n+ *\n+ * @see JsonConstants#RPC_PUBLISHED_SERVER_EVENT_HANDLER\n+ *\n+ * @author Vaadin Ltd\n+ * @since 1.0\n+ *\n+ * @deprecated Polymer template support is deprecated - we recommend you to use\n+ *             {@link LitTemplate} instead. Read more details from <a href=\n+ *             \"https://vaadin.com/blog/future-of-html-templates-in-vaadin\">the\n+ *             Vaadin blog.</a>\n+ */\n+@Deprecated\n+public class PublishedServerEventHandlerRpcHandler implements Serializable {\n+\n+    private static final Collection<RpcDecoder> DECODERS = loadDecoders();\n+\n+    public static void handleNode(StateNode node, JsonObject invocationJson) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d0d85ddb881de110d33dc32051e90c7d61066abe"}, "originalPosition": 77}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDk4NDc2MDE3", "url": "https://github.com/vaadin/flow/pull/9067#pullrequestreview-498476017", "createdAt": "2020-09-29T13:36:21Z", "commit": {"oid": "d0d85ddb881de110d33dc32051e90c7d61066abe"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yOVQxMzozNjoyMVrOHZthJQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yOVQxMzozNjoyMVrOHZthJQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NjcyMjIxMw==", "bodyText": "Either log or rethrow this exception.", "url": "https://github.com/vaadin/flow/pull/9067#discussion_r496722213", "createdAt": "2020-09-29T13:36:21Z", "author": {"login": "vaadin-bot"}, "path": "flow-server/src/main/java/com/vaadin/flow/server/communication/rpc/PublishedServerEventHandlerRpcHandler.java", "diffHunk": "@@ -78,299 +55,28 @@ public String getRpcType() {\n     @Override\n     public Optional<Runnable> handleNode(StateNode node,\n             JsonObject invocationJson) {\n-        assert invocationJson\n-                .hasKey(JsonConstants.RPC_TEMPLATE_EVENT_METHOD_NAME);\n-        String methodName = invocationJson\n-                .getString(JsonConstants.RPC_TEMPLATE_EVENT_METHOD_NAME);\n-        if (methodName == null) {\n-            throw new IllegalArgumentException(\n-                    \"Event handler method name may not be null\");\n-        }\n-        JsonValue args = invocationJson\n-                .get(JsonConstants.RPC_TEMPLATE_EVENT_ARGS);\n-        if (args == null) {\n-            args = Json.createArray();\n-        }\n-        if (args.getType() != JsonType.ARRAY) {\n-            throw new IllegalArgumentException(\n-                    \"Incorrect type for method arguments: \" + args.getClass());\n-        }\n-        int promiseId;\n-        if (invocationJson.hasKey(JsonConstants.RPC_TEMPLATE_EVENT_PROMISE)) {\n-            promiseId = (int) invocationJson\n-                    .getNumber(JsonConstants.RPC_TEMPLATE_EVENT_PROMISE);\n-        } else {\n-            promiseId = -1;\n-        }\n-        assert node.hasFeature(ComponentMapping.class);\n-        Optional<Component> component = ComponentMapping.getComponent(node);\n-        if (!component.isPresent()) {\n-            throw new IllegalStateException(\n-                    \"Unable to handle RPC template event JSON message: \"\n-                            + \"there is no component available for the target node\");\n-        }\n-\n-        boolean execute = node.isEnabled();\n-\n-        if (!execute) {\n-            ClientCallableHandlers clientDelegate = node\n-                    .getFeature(ClientCallableHandlers.class);\n-            PolymerServerEventHandlers eventHandlers = node\n-                    .getFeature(PolymerServerEventHandlers.class);\n-            if (clientDelegate.hasHandler(methodName)) {\n-                execute = DisabledUpdateMode.ALWAYS.equals(\n-                        clientDelegate.getDisabledUpdateMode(methodName));\n-            }\n-            if (eventHandlers.hasHandler(methodName)) {\n-                execute = execute || DisabledUpdateMode.ALWAYS.equals(\n-                        eventHandlers.getDisabledUpdateMode(methodName));\n-            }\n-        }\n-\n-        if (execute) {\n-            invokeMethod(component.get(), component.get().getClass(),\n-                    methodName, (JsonArray) args, promiseId);\n-        }\n-\n-        return Optional.empty();\n-    }\n-\n-    static void invokeMethod(Component instance, Class<?> clazz,\n-            String methodName, JsonArray args, int promiseId) {\n-        assert instance != null;\n-        Optional<Method> method = findMethod(instance, clazz, methodName);\n-        if (method.isPresent()) {\n-            invokeMethod(instance, method.get(), args, promiseId);\n-        } else if (instance instanceof Composite) {\n-            Component compositeContent = ((Composite<?>) instance).getContent();\n-            invokeMethod(compositeContent, compositeContent.getClass(),\n-                    methodName, args, promiseId);\n-        } else {\n-            String msg = String.format(\"Neither class '%s' \"\n-                    + \"nor its super classes declare event handler method '%s'\",\n-                    instance.getClass().getName(), methodName);\n-            throw new IllegalStateException(msg);\n-        }\n-    }\n-\n-    private static Optional<Method> findMethod(Component instance,\n-            Class<?> clazz, String methodName) {\n-        List<Method> methods = Stream.of(clazz.getDeclaredMethods())\n-                .filter(method -> methodName.equals(method.getName()))\n-                .filter(method -> method.isAnnotationPresent(EventHandler.class)\n-                        || method.isAnnotationPresent(ClientCallable.class))\n-                .collect(Collectors.toList());\n-        if (methods.size() > 1) {\n-            String msg = String.format(\"Class '%s' contains \"\n-                    + \"several event handler method with the same name '%s'\",\n-                    instance.getClass().getName(), methodName);\n-            throw new IllegalStateException(msg);\n-        } else if (methods.size() == 1) {\n-            return Optional.of(methods.get(0));\n-        } else if (!Component.class.equals(clazz)) {\n-            return findMethod(instance, clazz.getSuperclass(), methodName);\n-        } else {\n-            return Optional.empty();\n-        }\n-    }\n-\n-    private static void invokeMethod(Component instance, Method method,\n-            JsonArray args, int promiseId) {\n-        if (promiseId == -1) {\n-            invokeMethod(instance, method, args);\n-        } else {\n-            try {\n-                Serializable returnValue = (Serializable) invokeMethod(instance,\n-                        method, args);\n-\n-                instance.getElement()\n-                        .executeJs(\"this.$server['\"\n-                                + JsonConstants.RPC_PROMISE_CALLBACK_NAME\n-                                + \"']($0, true, $1)\",\n-                                Integer.valueOf(promiseId), returnValue);\n-            } catch (RuntimeException e) {\n-                instance.getElement()\n-                        .executeJs(\"this.$server['\"\n-                                + JsonConstants.RPC_PROMISE_CALLBACK_NAME\n-                                + \"']($0, false)\", Integer.valueOf(promiseId));\n-\n-                throw e;\n-            }\n-        }\n-    }\n-\n-    private static Object invokeMethod(Component instance, Method method,\n-            JsonArray args) {\n         try {\n-            method.setAccessible(true);\n-            return method.invoke(instance, decodeArgs(instance, method, args));\n+            Class<?> clazz = Class\n+                    .forName(\"com.vaadin.flow.component.polymertemplate.rpc.\"\n+                            + PublishedServerEventHandlerRpcHandler.class\n+                                    .getSimpleName());\n+            Method handleMethod = Stream.of(clazz.getDeclaredMethods())\n+                    .filter(method -> Modifier.isStatic(method.getModifiers())\n+                            && Modifier.isPublic(method.getModifiers()))\n+                    .findFirst().get();\n+            handleMethod.invoke(null, node, invocationJson);\n+        } catch (ClassNotFoundException e) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d0d85ddb881de110d33dc32051e90c7d61066abe"}, "originalPosition": 190}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDk4NDc2MDM2", "url": "https://github.com/vaadin/flow/pull/9067#pullrequestreview-498476036", "createdAt": "2020-09-29T13:36:22Z", "commit": {"oid": "d0d85ddb881de110d33dc32051e90c7d61066abe"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yOVQxMzozNjoyMlrOHZthMA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yOVQxMzozNjoyMlrOHZthMA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NjcyMjIyNA==", "bodyText": "Do not forget to remove this deprecated code someday.", "url": "https://github.com/vaadin/flow/pull/9067#discussion_r496722224", "createdAt": "2020-09-29T13:36:22Z", "author": {"login": "vaadin-bot"}, "path": "flow-server/src/main/java/com/vaadin/flow/server/communication/rpc/PublishedServerEventHandlerRpcHandler.java", "diffHunk": "@@ -68,8 +47,6 @@\n public class PublishedServerEventHandlerRpcHandler", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d0d85ddb881de110d33dc32051e90c7d61066abe"}, "originalPosition": 43}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDk4NzUwMjYx", "url": "https://github.com/vaadin/flow/pull/9067#pullrequestreview-498750261", "createdAt": "2020-09-29T18:07:56Z", "commit": {"oid": "d0d85ddb881de110d33dc32051e90c7d61066abe"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yOVQxODowNzo1NlrOHZ6vmA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yOVQxODoxMjowNFrOHZ644Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NjkzODkwNA==", "bodyText": "Non-blocking: should this javadocs be maybe updated about how the \"implementation\" is in polymer-template module.", "url": "https://github.com/vaadin/flow/pull/9067#discussion_r496938904", "createdAt": "2020-09-29T18:07:56Z", "author": {"login": "pleku"}, "path": "flow-server/src/main/java/com/vaadin/flow/server/communication/rpc/PublishedServerEventHandlerRpcHandler.java", "diffHunk": "@@ -15,40 +15,19 @@\n  */\n package com.vaadin.flow.server.communication.rpc;\n \n-import java.io.Serializable;\n-import java.lang.reflect.Array;\n import java.lang.reflect.InvocationTargetException;\n import java.lang.reflect.Method;\n-import java.lang.reflect.Type;\n-import java.util.ArrayList;\n-import java.util.Collection;\n-import java.util.List;\n+import java.lang.reflect.Modifier;\n import java.util.Optional;\n-import java.util.stream.Collectors;\n import java.util.stream.Stream;\n \n import org.slf4j.LoggerFactory;\n \n-import com.vaadin.flow.component.ClientCallable;\n-import com.vaadin.flow.component.Component;\n-import com.vaadin.flow.component.Composite;\n import com.vaadin.flow.component.littemplate.LitTemplate;\n-import com.vaadin.flow.component.polymertemplate.EventHandler;\n-import com.vaadin.flow.component.polymertemplate.PolymerTemplate;\n-import com.vaadin.flow.dom.DisabledUpdateMode;\n-import com.vaadin.flow.internal.ReflectTools;\n import com.vaadin.flow.internal.StateNode;\n-import com.vaadin.flow.internal.nodefeature.ClientCallableHandlers;\n-import com.vaadin.flow.internal.nodefeature.ComponentMapping;\n-import com.vaadin.flow.internal.nodefeature.PolymerServerEventHandlers;\n import com.vaadin.flow.shared.JsonConstants;\n-import com.vaadin.flow.templatemodel.ModelType;\n \n-import elemental.json.Json;\n-import elemental.json.JsonArray;\n import elemental.json.JsonObject;\n-import elemental.json.JsonType;\n-import elemental.json.JsonValue;\n \n /**\n  * RPC handler for events triggered through <code>element.$server</code> or", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d0d85ddb881de110d33dc32051e90c7d61066abe"}, "originalPosition": 41}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5Njk0MDgwMQ==", "bodyText": "This has not been changed - still refers first to outdated deprecated features that people should not know about. It should mention property synchronization first. Unless this logging can only happen with polymer templates, which I'm not really sure about.", "url": "https://github.com/vaadin/flow/pull/9067#discussion_r496940801", "createdAt": "2020-09-29T18:11:15Z", "author": {"login": "pleku"}, "path": "flow-server/src/main/java/com/vaadin/flow/internal/nodefeature/ElementPropertyMap.java", "diffHunk": "@@ -273,8 +272,9 @@ private AllowUpdate isUpdateFromClientAllowedByFilter(StateNode node,\n                 if (!allow && log) {\n                     getLogger().warn(\"Ignoring model update for {}. \"\n                             + \"For security reasons, the property must have a \"\n-                            + \"two-way binding in the template, be annotated with @{} in the model, or be defined as synchronized.\",\n-                            key, AllowClientUpdates.class.getSimpleName());\n+                            + \"two-way binding in the template, be annotated\"\n+                            + \" with @AllowClientUpdates in the model, or be defined as synchronized.\",", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d0d85ddb881de110d33dc32051e90c7d61066abe"}, "originalPosition": 15}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5Njk0MTI4MQ==", "bodyText": "In case this can only happen with polymer templates, then a comment like // TODO to be removed with polymer template support removal would be nice for the code.", "url": "https://github.com/vaadin/flow/pull/9067#discussion_r496941281", "createdAt": "2020-09-29T18:12:04Z", "author": {"login": "pleku"}, "path": "flow-server/src/main/java/com/vaadin/flow/internal/nodefeature/ElementPropertyMap.java", "diffHunk": "@@ -273,8 +272,9 @@ private AllowUpdate isUpdateFromClientAllowedByFilter(StateNode node,\n                 if (!allow && log) {\n                     getLogger().warn(\"Ignoring model update for {}. \"\n                             + \"For security reasons, the property must have a \"\n-                            + \"two-way binding in the template, be annotated with @{} in the model, or be defined as synchronized.\",\n-                            key, AllowClientUpdates.class.getSimpleName());\n+                            + \"two-way binding in the template, be annotated\"\n+                            + \" with @AllowClientUpdates in the model, or be defined as synchronized.\",", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5Njk0MDgwMQ=="}, "originalCommit": {"oid": "d0d85ddb881de110d33dc32051e90c7d61066abe"}, "originalPosition": 15}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDk5MDY4MTY2", "url": "https://github.com/vaadin/flow/pull/9067#pullrequestreview-499068166", "createdAt": "2020-09-30T03:57:57Z", "commit": {"oid": "d0d85ddb881de110d33dc32051e90c7d61066abe"}, "state": "DISMISSED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "47c7d63929145461ac1ab6a558e78d89a414c74c", "author": {"user": null}, "url": "https://github.com/vaadin/flow/commit/47c7d63929145461ac1ab6a558e78d89a414c74c", "committedDate": "2020-09-30T04:48:23Z", "message": "Add more comments, move test class"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDk5MTQ0OTYw", "url": "https://github.com/vaadin/flow/pull/9067#pullrequestreview-499144960", "createdAt": "2020-09-30T07:16:45Z", "commit": {"oid": "47c7d63929145461ac1ab6a558e78d89a414c74c"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDk5MTgzNzYy", "url": "https://github.com/vaadin/flow/pull/9067#pullrequestreview-499183762", "createdAt": "2020-09-30T08:10:44Z", "commit": {"oid": "47c7d63929145461ac1ab6a558e78d89a414c74c"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0zMFQwODoxMDo0NFrOHaSHhQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0zMFQwODoxMDo0NFrOHaSHhQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NzMyMTg2MQ==", "bodyText": "Complete the task associated to this TODO comment.", "url": "https://github.com/vaadin/flow/pull/9067#discussion_r497321861", "createdAt": "2020-09-30T08:10:44Z", "author": {"login": "vaadin-bot"}, "path": "flow-server/src/main/java/com/vaadin/flow/internal/nodefeature/ElementPropertyMap.java", "diffHunk": "@@ -269,12 +268,14 @@ private AllowUpdate isUpdateFromClientAllowedByFilter(StateNode node,\n             ElementPropertyMap propertyMap = node\n                     .getFeature(ElementPropertyMap.class);\n             if (propertyMap.updateFromClientFilter != null) {\n+                //// TODO to be removed with polymer template support removal", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "47c7d63929145461ac1ab6a558e78d89a414c74c"}, "originalPosition": 12}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4949, "cost": 1, "resetAt": "2021-10-28T20:13:43Z"}}}