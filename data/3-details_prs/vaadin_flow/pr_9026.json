{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDg4OTIxMjc1", "number": 9026, "title": "Set `display:none` in addition to `hidden` attribute when hiding elements inside a shadow root", "bodyText": "Fixes #8256.", "createdAt": "2020-09-17T20:42:23Z", "url": "https://github.com/vaadin/flow/pull/9026", "merged": true, "mergeCommit": {"oid": "deab152efa6d6fa4e1a72f3245903e19b039bd9f"}, "closed": true, "closedAt": "2020-09-22T07:57:43Z", "author": {"login": "joheriks"}, "timelineItems": {"totalCount": 13, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdJt24zAH2gAyNDg4OTIxMjc1OmJjYTQ0ODM3ODQ2N2Q2NTk0YWQzOGVmYTdhNTI1ZWRmZmQxZWQ5ODU=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdLTRD5AFqTQ5MzIwODY2NA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "bca448378467d6594ad38efa7a525edffd1ed985", "author": {"user": {"login": "joheriks", "name": "Johannes Eriksson"}}, "url": "https://github.com/vaadin/flow/commit/bca448378467d6594ad38efa7a525edffd1ed985", "committedDate": "2020-09-17T09:48:14Z", "message": "Add `visibility: none` in additional to `hidden` attribute for invisibility"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b8a39227b5ec97d48dcaec252ae76b8251e596a7", "author": {"user": {"login": "joheriks", "name": "Johannes Eriksson"}}, "url": "https://github.com/vaadin/flow/commit/b8a39227b5ec97d48dcaec252ae76b8251e596a7", "committedDate": "2020-09-17T12:00:05Z", "message": "Integration test"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b55fe75ce6c17ba8f85673b9a07cb705c40225f8", "author": {"user": {"login": "joheriks", "name": "Johannes Eriksson"}}, "url": "https://github.com/vaadin/flow/commit/b55fe75ce6c17ba8f85673b9a07cb705c40225f8", "committedDate": "2020-09-17T21:23:05Z", "message": "Only set 'display: none' if hidden element is inside a shadow root"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "a3eedc8c70420037921e7bd2f43c16130cc8bad6", "author": {"user": {"login": "joheriks", "name": "Johannes Eriksson"}}, "url": "https://github.com/vaadin/flow/commit/a3eedc8c70420037921e7bd2f43c16130cc8bad6", "committedDate": "2020-09-17T20:40:47Z", "message": "Only set 'display: none' if hidden element is inside a shadow root"}, "afterCommit": {"oid": "b55fe75ce6c17ba8f85673b9a07cb705c40225f8", "author": {"user": {"login": "joheriks", "name": "Johannes Eriksson"}}, "url": "https://github.com/vaadin/flow/commit/b55fe75ce6c17ba8f85673b9a07cb705c40225f8", "committedDate": "2020-09-17T21:23:05Z", "message": "Only set 'display: none' if hidden element is inside a shadow root"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDkxMjc5Mzk5", "url": "https://github.com/vaadin/flow/pull/9026#pullrequestreview-491279399", "createdAt": "2020-09-18T09:00:05Z", "commit": {"oid": "b55fe75ce6c17ba8f85673b9a07cb705c40225f8"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xOFQwOTowMDowNVrOHUEWow==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xOFQwOTowMDoyMVrOHUEXSw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MDgwNDg5OQ==", "bodyText": "Since there is a code which checks for shadow root would be good to mention it also here.", "url": "https://github.com/vaadin/flow/pull/9026#discussion_r490804899", "createdAt": "2020-09-18T09:00:05Z", "author": {"login": "denis-anisimov"}, "path": "flow-server/src/main/java/com/vaadin/flow/internal/nodefeature/NodeProperties.java", "diffHunk": "@@ -87,6 +87,14 @@\n      */\n     public static final String VISIBILITY_HIDDEN_PROPERTY = \"hidden\";\n \n+    /**\n+     * The property used on the client side only in addition to\n+     * {@link #VISIBLE}. It stores the client side value of the CSS \"display\"\n+     * property to be able to restore when making a hidden element visible", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b55fe75ce6c17ba8f85673b9a07cb705c40225f8"}, "originalPosition": 7}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MDgwNTA2Nw==", "bodyText": "new line", "url": "https://github.com/vaadin/flow/pull/9026#discussion_r490805067", "createdAt": "2020-09-18T09:00:21Z", "author": {"login": "denis-anisimov"}, "path": "flow-tests/test-root-context/frontend/lit/lit-template-inner.js", "diffHunk": "@@ -0,0 +1,12 @@\n+import {html, LitElement} from 'lit-element';\n+\n+class TemplateInner extends LitElement {\n+\n+  render() {\n+    return html`\n+        <div>Hello template inner</div>\n+    `;\n+  }\n+}\n+\n+customElements.define('lit-template-inner', TemplateInner);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b55fe75ce6c17ba8f85673b9a07cb705c40225f8"}, "originalPosition": 12}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDkxMzMwMjMz", "url": "https://github.com/vaadin/flow/pull/9026#pullrequestreview-491330233", "createdAt": "2020-09-18T10:10:29Z", "commit": {"oid": "b55fe75ce6c17ba8f85673b9a07cb705c40225f8"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xOFQxMDoxMDoyOVrOHUGw5A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xOFQxMDoxMDoyOVrOHUGw5A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MDg0NDM4OA==", "bodyText": "double f type", "url": "https://github.com/vaadin/flow/pull/9026#discussion_r490844388", "createdAt": "2020-09-18T10:10:29Z", "author": {"login": "bogdanudrescu"}, "path": "flow-client/src/main/java/com/vaadin/client/PolymerUtils.java", "diffHunk": "@@ -646,4 +646,20 @@ public static native void setProperty(Element element, String path,\n          element.set(path, value);\n      }-*/;\n \n+    /**\n+     * Returns true iff the element has a shadow root ancestor.", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b55fe75ce6c17ba8f85673b9a07cb705c40225f8"}, "originalPosition": 5}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "424826c9abb63077875bd147f8c64c044b6380b1", "author": {"user": {"login": "joheriks", "name": "Johannes Eriksson"}}, "url": "https://github.com/vaadin/flow/commit/424826c9abb63077875bd147f8c64c044b6380b1", "committedDate": "2020-09-18T12:56:34Z", "message": "Check for display CSS is not added in existing GWT tests that assert hidden attribute present (not in shadowroot)"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "00559bfa3cdd6265290cbf4531be3aea615dfdb9", "author": {"user": {"login": "joheriks", "name": "Johannes Eriksson"}}, "url": "https://github.com/vaadin/flow/commit/00559bfa3cdd6265290cbf4531be3aea615dfdb9", "committedDate": "2020-09-18T13:01:04Z", "message": "Minor fixes based on review"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "97bf38fcc65200492de02c20640d47450c43ec64", "author": {"user": {"login": "joheriks", "name": "Johannes Eriksson"}}, "url": "https://github.com/vaadin/flow/commit/97bf38fcc65200492de02c20640d47450c43ec64", "committedDate": "2020-09-21T07:02:37Z", "message": "Corrected test comment"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDkyMzU5MzAz", "url": "https://github.com/vaadin/flow/pull/9026#pullrequestreview-492359303", "createdAt": "2020-09-21T08:05:58Z", "commit": {"oid": "97bf38fcc65200492de02c20640d47450c43ec64"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yMVQwODowNTo1OFrOHVEktA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yMVQwODowNTo1OFrOHVEktA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MTg1NzA3Ng==", "bodyText": "I added an additional assertion that style={display:none} is not added in existing tests checking attribute hidden. This protects against regressions where it would be added unncessarily (for elements not in shadow root). Not sure how to set up a GWT test for the shadow root case.\n\nI think we need more GWT tests for this.\nIt's possible to emulate code with shadow root with this code or change one.\nYou may create Elements hierarchy so that one element in the hierarchy returns '[object ShadowRoot]'.\nJust fake it: create a fake toString  method and return this string from it.\nAnother way could be reimplement this method a bit so that it doesn't use toString but check whether an element has a parent whose shadowRoot  property is set to the element.\nThen it's also possible to fake shadowRoot.\nWe have quite many tests like that which fakes elements.\nSee e.g. GwtBasicElementBinderTest: initPolymer , addShadowRootElement, etc.\nWith mocking/faking it should be possible to write the same tests for display style as we already have for hidden.", "url": "https://github.com/vaadin/flow/pull/9026#discussion_r491857076", "createdAt": "2020-09-21T08:05:58Z", "author": {"login": "denis-anisimov"}, "path": "flow-client/src/main/java/com/vaadin/client/PolymerUtils.java", "diffHunk": "@@ -646,4 +646,20 @@ public static native void setProperty(Element element, String path,\n          element.set(path, value);\n      }-*/;\n \n+    /**\n+     * Returns true if and only if the element has a shadow root ancestor.\n+     * \n+     * @param element\n+     *            the element to test\n+     * @return whether the element is in a shadow root\n+     */\n+    public static native boolean isInShadowRoot(Element element)", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "97bf38fcc65200492de02c20640d47450c43ec64"}, "originalPosition": 11}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "7099d79987f9fae2ccff41c3ff0ed5cbdb02db72", "author": {"user": {"login": "joheriks", "name": "Johannes Eriksson"}}, "url": "https://github.com/vaadin/flow/commit/7099d79987f9fae2ccff41c3ff0ed5cbdb02db72", "committedDate": "2020-09-21T09:17:35Z", "message": "Comment fix"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ec80684b3f210138670db1f71bef352a074c66f0", "author": {"user": {"login": "joheriks", "name": "Johannes Eriksson"}}, "url": "https://github.com/vaadin/flow/commit/ec80684b3f210138670db1f71bef352a074c66f0", "committedDate": "2020-09-21T12:07:42Z", "message": "Added two unit tests"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDkzMjA4NjY0", "url": "https://github.com/vaadin/flow/pull/9026#pullrequestreview-493208664", "createdAt": "2020-09-22T07:57:14Z", "commit": {"oid": "ec80684b3f210138670db1f71bef352a074c66f0"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4908, "cost": 1, "resetAt": "2021-10-28T20:13:43Z"}}}