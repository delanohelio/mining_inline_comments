{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDI0Njk3MTc5", "number": 8453, "reviewThreads": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yOVQwNTo0MzoxNlrOEAwykQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yOVQxMTo1ODowMFrOEA3J7A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjY5MjM0ODMzOnYy", "diffSide": "RIGHT", "path": "flow-data/src/test/java/com/vaadin/flow/data/provider/AbstractDataViewListenerTest.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yOVQwNTo0MzoxNlrOGcPd3w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yOVQxMzoyMjo0NlrOGccaDg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMjI2NjcxOQ==", "bodyText": "To make this unified with the DataCommunicator size change non communicator events should also be sent onBeforeClientResponse e.g. on the component we should use:\n        StateNode node = getElement().getNode();\n        node.runWhenAttached(ui -> ui.getInternals().getStateTree()\n                .beforeClientResponse(node, executionContext -> fireEvent(new SizeChangeEvent<>(this, newSize))));\nThis will need some more code in the test also see: https://github.com/vaadin/vaadin-grid-flow/pull/1002/files", "url": "https://github.com/vaadin/flow/pull/8453#discussion_r432266719", "createdAt": "2020-05-29T05:43:16Z", "author": {"login": "caalador"}, "path": "flow-data/src/test/java/com/vaadin/flow/data/provider/AbstractDataViewListenerTest.java", "diffHunk": "@@ -0,0 +1,86 @@\n+/*\n+ * Copyright 2000-2020 Vaadin Ltd.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\"); you may not\n+ * use this file except in compliance with the License. You may obtain a copy of\n+ * the License at\n+ *\n+ * http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS, WITHOUT\n+ * WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied. See the\n+ * License for the specific language governing permissions and limitations under\n+ * the License.\n+ */\n+\n+package com.vaadin.flow.data.provider;\n+\n+import org.junit.Assert;\n+import org.junit.Test;\n+\n+import java.util.Arrays;\n+import java.util.concurrent.atomic.AtomicBoolean;\n+import java.util.concurrent.atomic.AtomicInteger;\n+\n+public abstract class AbstractDataViewListenerTest {\n+\n+    private final String[] ITEMS = new String[] { \"one\", \"two\", \"three\",\n+            \"four\" };\n+\n+    @Test\n+    public void addSizeChangeListener_sizeChanged_listenersAreNotified() {\n+        HasListDataView<String, ? extends AbstractListDataView<String>> hasListDataView =\n+                getComponent();\n+        AbstractListDataView<String> dataView =\n+                hasListDataView.setDataProvider(Arrays.stream(ITEMS));\n+\n+        AtomicInteger invocationCounter = new AtomicInteger(0);\n+\n+        dataView.addSizeChangeListener(event -> invocationCounter.incrementAndGet());\n+\n+        dataView.withFilter(\"one\"::equals);\n+        dataView.withFilter(null);\n+        dataView.addItemAfter(\"five\", \"four\");\n+        dataView.addItemBefore(\"zero\", \"one\");\n+        dataView.addItem(\"last\");\n+        dataView.removeItem(\"zero\");\n+\n+        Assert.assertEquals(\n+                \"Unexpected count of size change listener invocations occurred\",\n+                6, invocationCounter.get());", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "bbd24993f3140d68342d31e9def189848c0c3ffe"}, "originalPosition": 51}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMjQ3ODczNA==", "bodyText": "done", "url": "https://github.com/vaadin/flow/pull/8453#discussion_r432478734", "createdAt": "2020-05-29T13:22:46Z", "author": {"login": "mshabarov"}, "path": "flow-data/src/test/java/com/vaadin/flow/data/provider/AbstractDataViewListenerTest.java", "diffHunk": "@@ -0,0 +1,86 @@\n+/*\n+ * Copyright 2000-2020 Vaadin Ltd.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\"); you may not\n+ * use this file except in compliance with the License. You may obtain a copy of\n+ * the License at\n+ *\n+ * http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS, WITHOUT\n+ * WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied. See the\n+ * License for the specific language governing permissions and limitations under\n+ * the License.\n+ */\n+\n+package com.vaadin.flow.data.provider;\n+\n+import org.junit.Assert;\n+import org.junit.Test;\n+\n+import java.util.Arrays;\n+import java.util.concurrent.atomic.AtomicBoolean;\n+import java.util.concurrent.atomic.AtomicInteger;\n+\n+public abstract class AbstractDataViewListenerTest {\n+\n+    private final String[] ITEMS = new String[] { \"one\", \"two\", \"three\",\n+            \"four\" };\n+\n+    @Test\n+    public void addSizeChangeListener_sizeChanged_listenersAreNotified() {\n+        HasListDataView<String, ? extends AbstractListDataView<String>> hasListDataView =\n+                getComponent();\n+        AbstractListDataView<String> dataView =\n+                hasListDataView.setDataProvider(Arrays.stream(ITEMS));\n+\n+        AtomicInteger invocationCounter = new AtomicInteger(0);\n+\n+        dataView.addSizeChangeListener(event -> invocationCounter.incrementAndGet());\n+\n+        dataView.withFilter(\"one\"::equals);\n+        dataView.withFilter(null);\n+        dataView.addItemAfter(\"five\", \"four\");\n+        dataView.addItemBefore(\"zero\", \"one\");\n+        dataView.addItem(\"last\");\n+        dataView.removeItem(\"zero\");\n+\n+        Assert.assertEquals(\n+                \"Unexpected count of size change listener invocations occurred\",\n+                6, invocationCounter.get());", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMjI2NjcxOQ=="}, "originalCommit": {"oid": "bbd24993f3140d68342d31e9def189848c0c3ffe"}, "originalPosition": 51}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjY5MzM5MTE2OnYy", "diffSide": "RIGHT", "path": "flow-data/src/test/java/com/vaadin/flow/data/provider/AbstractDataViewListenerTest.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yOVQxMTo1ODowMFrOGcZvrQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yOVQxMzoyMjozMlrOGccZcg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMjQzNTExNw==", "bodyText": "Should probably be AbstractListDataViewListenerTest as the test uses the List DataView.", "url": "https://github.com/vaadin/flow/pull/8453#discussion_r432435117", "createdAt": "2020-05-29T11:58:00Z", "author": {"login": "caalador"}, "path": "flow-data/src/test/java/com/vaadin/flow/data/provider/AbstractDataViewListenerTest.java", "diffHunk": "@@ -0,0 +1,86 @@\n+/*\n+ * Copyright 2000-2020 Vaadin Ltd.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\"); you may not\n+ * use this file except in compliance with the License. You may obtain a copy of\n+ * the License at\n+ *\n+ * http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS, WITHOUT\n+ * WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied. See the\n+ * License for the specific language governing permissions and limitations under\n+ * the License.\n+ */\n+\n+package com.vaadin.flow.data.provider;\n+\n+import org.junit.Assert;\n+import org.junit.Test;\n+\n+import java.util.Arrays;\n+import java.util.concurrent.atomic.AtomicBoolean;\n+import java.util.concurrent.atomic.AtomicInteger;\n+\n+public abstract class AbstractDataViewListenerTest {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "bbd24993f3140d68342d31e9def189848c0c3ffe"}, "originalPosition": 26}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMjQ3ODU3OA==", "bodyText": "done", "url": "https://github.com/vaadin/flow/pull/8453#discussion_r432478578", "createdAt": "2020-05-29T13:22:32Z", "author": {"login": "mshabarov"}, "path": "flow-data/src/test/java/com/vaadin/flow/data/provider/AbstractDataViewListenerTest.java", "diffHunk": "@@ -0,0 +1,86 @@\n+/*\n+ * Copyright 2000-2020 Vaadin Ltd.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\"); you may not\n+ * use this file except in compliance with the License. You may obtain a copy of\n+ * the License at\n+ *\n+ * http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS, WITHOUT\n+ * WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied. See the\n+ * License for the specific language governing permissions and limitations under\n+ * the License.\n+ */\n+\n+package com.vaadin.flow.data.provider;\n+\n+import org.junit.Assert;\n+import org.junit.Test;\n+\n+import java.util.Arrays;\n+import java.util.concurrent.atomic.AtomicBoolean;\n+import java.util.concurrent.atomic.AtomicInteger;\n+\n+public abstract class AbstractDataViewListenerTest {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMjQzNTExNw=="}, "originalCommit": {"oid": "bbd24993f3140d68342d31e9def189848c0c3ffe"}, "originalPosition": 26}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3419, "cost": 1, "resetAt": "2021-11-13T12:26:42Z"}}}