{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTE1Mjk4NzI5", "number": 9309, "title": "generate sw.ts to frontend folder when pwa enabled", "bodyText": "Fixes #9143\n\ngenerate sw.ts to target folder instead of the project root folder\ngenerate sw.ts only when PWA is enabled", "createdAt": "2020-11-04T10:47:51Z", "url": "https://github.com/vaadin/flow/pull/9309", "merged": true, "mergeCommit": {"oid": "304780274a96c463255748fc0969703d574af6de"}, "closed": true, "closedAt": "2020-11-10T19:44:58Z", "author": {"login": "haijian-vaadin"}, "timelineItems": {"totalCount": 9, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdZLcz5AH2gAyNTE1Mjk4NzI5OjVkNmNkMDZiMzc0ZjkxMWI4ZDEwZmQxOGU3YzUzMTk4ZTM4NDk3M2M=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdbFF1GgFqTUyNjk1OTY5MA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "5d6cd06b374f911b8d10fd18e7c53198e384973c", "author": {"user": {"login": "haijian-vaadin", "name": "Haijian Wang"}}, "url": "https://github.com/vaadin/flow/commit/5d6cd06b374f911b8d10fd18e7c53198e384973c", "committedDate": "2020-11-04T10:45:46Z", "message": "genereate sw.ts to frontend folder when pwa enabled"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTI0MDI4ODE3", "url": "https://github.com/vaadin/flow/pull/9309#pullrequestreview-524028817", "createdAt": "2020-11-05T08:39:05Z", "commit": {"oid": "5d6cd06b374f911b8d10fd18e7c53198e384973c"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTI0MDMxMTAx", "url": "https://github.com/vaadin/flow/pull/9309#pullrequestreview-524031101", "createdAt": "2020-11-05T08:42:04Z", "commit": {"oid": "5d6cd06b374f911b8d10fd18e7c53198e384973c"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wNVQwODo0MjowNVrOHt4vCg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wNVQwODo0MjowNVrOHt4vCg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNzg3NzUxNA==", "bodyText": "createWebpackUpdater is run by setup so not needed to run explicitly unless creating a new PwaConfiguration in the test.", "url": "https://github.com/vaadin/flow/pull/9309#discussion_r517877514", "createdAt": "2020-11-05T08:42:05Z", "author": {"login": "joheriks"}, "path": "flow-server/src/test/java/com/vaadin/flow/server/frontend/TaskUpdateWebpackTest.java", "diffHunk": "@@ -263,6 +263,37 @@ public void should_setPwaEnabledTrue_when_Pwa()\n                         .contains(\"const pwaEnabled = true;\"));\n     }\n \n+    @Test\n+    public void should_Not_generateServiceworkerFile_when_noPwa(){\n+        pwaConfiguration = new PwaConfiguration();\n+        createWebpackUpdater();\n+        webpackUpdater.execute();\n+\n+        File serviceWorkerFile = new File(frontendFolder,\n+                SERVICE_WORKER_SRC);\n+        Assert.assertFalse(serviceWorkerFile.exists());\n+    }\n+\n+    @Test\n+    public void should_generateServiceworkerFile_when_pwa(){\n+        createWebpackUpdater();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "5d6cd06b374f911b8d10fd18e7c53198e384973c"}, "originalPosition": 17}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTI0MDMxMjA1", "url": "https://github.com/vaadin/flow/pull/9309#pullrequestreview-524031205", "createdAt": "2020-11-05T08:42:13Z", "commit": {"oid": "5d6cd06b374f911b8d10fd18e7c53198e384973c"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wNVQwODo0MjoxM1rOHt4vXw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wNVQwODo0MjoxM1rOHt4vXw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNzg3NzU5OQ==", "bodyText": "createWebpackUpdater is run by setup so not needed to run explicitly unless creating a new PwaConfiguration in the test.", "url": "https://github.com/vaadin/flow/pull/9309#discussion_r517877599", "createdAt": "2020-11-05T08:42:13Z", "author": {"login": "joheriks"}, "path": "flow-server/src/test/java/com/vaadin/flow/server/frontend/TaskUpdateWebpackTest.java", "diffHunk": "@@ -263,6 +263,37 @@ public void should_setPwaEnabledTrue_when_Pwa()\n                         .contains(\"const pwaEnabled = true;\"));\n     }\n \n+    @Test\n+    public void should_Not_generateServiceworkerFile_when_noPwa(){\n+        pwaConfiguration = new PwaConfiguration();\n+        createWebpackUpdater();\n+        webpackUpdater.execute();\n+\n+        File serviceWorkerFile = new File(frontendFolder,\n+                SERVICE_WORKER_SRC);\n+        Assert.assertFalse(serviceWorkerFile.exists());\n+    }\n+\n+    @Test\n+    public void should_generateServiceworkerFile_when_pwa(){\n+        createWebpackUpdater();\n+        webpackUpdater.execute();\n+\n+        File serviceWorkerFile = new File(frontendFolder,\n+                SERVICE_WORKER_SRC);\n+        Assert.assertTrue(serviceWorkerFile.exists());\n+    }\n+\n+    @Test\n+    public void should_Not_generateServiceworkerFile_inProjectRootFoler_when_pwa(){\n+        createWebpackUpdater();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "5d6cd06b374f911b8d10fd18e7c53198e384973c"}, "originalPosition": 27}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "32eabe9545f49f5d220c1628c12691f5de7a17fb", "author": {"user": {"login": "haijian-vaadin", "name": "Haijian Wang"}}, "url": "https://github.com/vaadin/flow/commit/32eabe9545f49f5d220c1628c12691f5de7a17fb", "committedDate": "2020-11-09T20:50:22Z", "message": "align sw.ts genneration with other bootstrap entries"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTI2OTI4MTUz", "url": "https://github.com/vaadin/flow/pull/9309#pullrequestreview-526928153", "createdAt": "2020-11-10T07:42:07Z", "commit": {"oid": "32eabe9545f49f5d220c1628c12691f5de7a17fb"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xMFQwNzo0MjowOFrOHwPpFg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xMFQwNzo0MjowOFrOHwPpFg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMDM0OTk3NA==", "bodyText": "Would perhaps make sense to extract this duplicate logic into a private method, e.g. addServiceWorkerTask(Builder bilder, FrontendDependencies frontendDependencies).", "url": "https://github.com/vaadin/flow/pull/9309#discussion_r520349974", "createdAt": "2020-11-10T07:42:08Z", "author": {"login": "joheriks"}, "path": "flow-server/src/main/java/com/vaadin/flow/server/frontend/NodeTasks.java", "diffHunk": "@@ -619,6 +623,13 @@ private void addBootstrapTasks(Builder builder) {\n         TaskGenerateTsDefinitions taskGenerateTsDefinitions = new TaskGenerateTsDefinitions(\n                 builder.npmFolder);\n         commands.add(taskGenerateTsDefinitions);\n+\n+        if (frontendDependencies != null) {\n+            PwaConfiguration pwaConfiguration = frontendDependencies.getPwaConfiguration();\n+            if (pwaConfiguration.isEnabled()) {\n+                commands.add(new TaskGenerateServiceWorker(builder.frontendDirectory, outputDirectory));\n+            }\n+        }", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "32eabe9545f49f5d220c1628c12691f5de7a17fb"}, "originalPosition": 39}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c77795a218dd0839588db4c4951842b1dda84946", "author": {"user": {"login": "haijian-vaadin", "name": "Haijian Wang"}}, "url": "https://github.com/vaadin/flow/commit/c77795a218dd0839588db4c4951842b1dda84946", "committedDate": "2020-11-10T07:54:39Z", "message": "fix serialization unit test and remove duplicated code"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "d0ac3d0519ca15f47382f3a2433476f34e2d819d", "author": {"user": {"login": "haijian-vaadin", "name": "Haijian Wang"}}, "url": "https://github.com/vaadin/flow/commit/d0ac3d0519ca15f47382f3a2433476f34e2d819d", "committedDate": "2020-11-10T08:04:40Z", "message": "Merge remote-tracking branch 'origin/feature/offline' into haijian/sw-improvements"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTI2OTU5Njkw", "url": "https://github.com/vaadin/flow/pull/9309#pullrequestreview-526959690", "createdAt": "2020-11-10T08:29:05Z", "commit": {"oid": "d0ac3d0519ca15f47382f3a2433476f34e2d819d"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4780, "cost": 1, "resetAt": "2021-10-28T20:13:43Z"}}}