{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDY0NDAxOTY0", "number": 8826, "title": "Add transmission semantic for URI attribute values", "bodyText": "Fixes #8813", "createdAt": "2020-08-07T05:38:01Z", "url": "https://github.com/vaadin/flow/pull/8826", "merged": true, "mergeCommit": {"oid": "80e31943fce1831d4c85eef6879c9c4a67247770"}, "closed": true, "closedAt": "2020-08-12T11:46:23Z", "author": {"login": "denis-anisimov"}, "timelineItems": {"totalCount": 8, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABc8LPYvAH2gAyNDY0NDAxOTY0OmFhNDQzOTFhZjc2ZTBmMzY5NWU4ZGU3Y2QyNTAyMTYyNDIwMThkNzU=", "endCursor": "Y3Vyc29yOnYyOpPPAAABc-J8SdgFqTQ2NTgzMjE5Mg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "aa44391af76e0f3695e8de7cd250216242018d75", "author": {"user": null}, "url": "https://github.com/vaadin/flow/commit/aa44391af76e0f3695e8de7cd250216242018d75", "committedDate": "2020-08-06T08:07:18Z", "message": "Add transmission semantic for URI attribute values\n\nFixes #8813"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDYzMDkzMjQx", "url": "https://github.com/vaadin/flow/pull/8826#pullrequestreview-463093241", "createdAt": "2020-08-07T07:29:09Z", "commit": {"oid": "aa44391af76e0f3695e8de7cd250216242018d75"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 5, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0wN1QwNzoyOToxMFrOG9PgOQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0wN1QwODoyMjozNVrOG9RECQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2Njg3MDMyOQ==", "bodyText": "Please put a brief explanations that this wrapper is put intentionally within doSetResource method? Why don't we use java cast here, but use a JS cast?", "url": "https://github.com/vaadin/flow/pull/8826#discussion_r466870329", "createdAt": "2020-08-07T07:29:10Z", "author": {"login": "mshabarov"}, "path": "flow-client/src/main/java/com/vaadin/client/flow/binding/SimpleElementBindingStrategy.java", "diffHunk": "@@ -1366,6 +1375,28 @@ private EventRemover bindClientCallableMethods(BindingContext context) {\n                 (Element) context.htmlNode, context.node);\n     }\n \n+    private static void updateAttributeValue(\n+            ApplicationConfiguration configuration, Element element,\n+            String attribute, Object value) {\n+        if (value == null || value instanceof String) {\n+            WidgetUtil.updateAttribute(element, attribute, (String) value);\n+        } else {\n+            JsonObject object = WidgetUtil.crazyJsCast(value);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "aa44391af76e0f3695e8de7cd250216242018d75"}, "originalPosition": 55}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2Njg3NzU2NQ==", "bodyText": "Update a javadoc accordingly: ... otherwise {@code value.toString()} is set as its value. is obsolete now.", "url": "https://github.com/vaadin/flow/pull/8826#discussion_r466877565", "createdAt": "2020-08-07T07:44:45Z", "author": {"login": "mshabarov"}, "path": "flow-client/src/main/java/com/vaadin/client/WidgetUtil.java", "diffHunk": "@@ -136,11 +136,11 @@ public static String toPrettyJson(JsonValue json) {\n      *            the value to update\n      */\n     public static void updateAttribute(Element element, String attribute,\n-            Object value) {\n+            String value) {\n         if (value == null) {\n             DomApi.wrap(element).removeAttribute(attribute);\n         } else {\n-            DomApi.wrap(element).setAttribute(attribute, value.toString());\n+            DomApi.wrap(element).setAttribute(attribute, value);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "aa44391af76e0f3695e8de7cd250216242018d75"}, "originalPosition": 10}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2Njg4NTM3Nw==", "bodyText": "Even though the assert is placed here, I wonder why we so confident about URI_ATTRIBUTE  presence, it is hard to read and understand if someone doesn't know it should have been put here within doSetResource. Please put an explanation comment here.", "url": "https://github.com/vaadin/flow/pull/8826#discussion_r466885377", "createdAt": "2020-08-07T08:00:30Z", "author": {"login": "mshabarov"}, "path": "flow-server/src/main/java/com/vaadin/flow/internal/nodefeature/ElementAttributeMap.java", "diffHunk": "@@ -103,7 +105,15 @@ public Serializable remove(String attribute) {\n      */\n     @Override\n     public String get(String attribute) {\n-        return (String) super.get(attribute);\n+        Serializable value = super.get(attribute);\n+        if (value == null || value instanceof String) {\n+            return (String) value;\n+        } else {\n+            assert value instanceof JsonObject;\n+            JsonObject object = (JsonObject) value;\n+            assert object.hasKey(NodeProperties.URI_ATTRIBUTE);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "aa44391af76e0f3695e8de7cd250216242018d75"}, "originalPosition": 31}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2Njg4NzQxOQ==", "bodyText": "I believe this method should be private", "url": "https://github.com/vaadin/flow/pull/8826#discussion_r466887419", "createdAt": "2020-08-07T08:04:49Z", "author": {"login": "mshabarov"}, "path": "flow-server/src/main/java/com/vaadin/flow/internal/nodefeature/ElementAttributeMap.java", "diffHunk": "@@ -225,6 +239,11 @@ public void execute() {\n                 }));\n     }\n \n+    public void doSet(String attribute, Serializable value) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "aa44391af76e0f3695e8de7cd250216242018d75"}, "originalPosition": 54}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2Njg5NTg4MQ==", "bodyText": "Silly question: author's bug description refers to <RootUrl>/VAADIN/dynamic/resource/... URI, but here we expect <RootUrl>/vaadin/VAADIN/dynamic/resource/.... Why?", "url": "https://github.com/vaadin/flow/pull/8826#discussion_r466895881", "createdAt": "2020-08-07T08:22:35Z", "author": {"login": "mshabarov"}, "path": "flow-tests/test-embedding/embedding-test-assets/src/test/java/com/vaadin/flow/webcomponent/WebComponentIT.java", "diffHunk": "@@ -57,8 +58,25 @@ public void indexPageGetsWebComponent_attributeIsReflectedToServer() {\n                 select);\n \n         Assert.assertFalse(\"Message should not be visible\",\n-                noMessage.$(\"span\").first()\n-                        .isDisplayed());\n+                noMessage.$(\"span\").first().isDisplayed());\n+    }\n+\n+    @Test\n+    public void downloadLinkHasCorrectBaseURL() {\n+        open();\n+\n+        waitForElementVisible(By.id(\"show-message\"));\n+        TestBenchElement showMessage = byId(\"show-message\");\n+        TestBenchElement link = showMessage.$(\"a\").id(\"link\");\n+        String href = link.getAttribute(\"href\");\n+        // self check\n+        Assert.assertTrue(href.startsWith(getRootURL()));\n+        // remove host and port\n+        href = href.substring(getRootURL().length());\n+        // now the URI should starts with \"/vaadin\" since this is the URI of\n+        // embedded app\n+        Assert.assertThat(href,\n+                CoreMatchers.startsWith(\"/vaadin/VAADIN/dynamic/resource/\"));", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "aa44391af76e0f3695e8de7cd250216242018d75"}, "originalPosition": 32}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "0e65d83fdf6c3138fb96d588e82faee181452a6f", "author": {"user": null}, "url": "https://github.com/vaadin/flow/commit/0e65d83fdf6c3138fb96d588e82faee181452a6f", "committedDate": "2020-08-07T09:14:05Z", "message": "Add some comments, correct javadocs"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "7bd7113c128de4b151833f93c227888ba92fc3fb", "author": {"user": null}, "url": "https://github.com/vaadin/flow/commit/7bd7113c128de4b151833f93c227888ba92fc3fb", "committedDate": "2020-08-07T09:20:50Z", "message": "Fix GWT tests"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDYzMjAyMjEw", "url": "https://github.com/vaadin/flow/pull/8826#pullrequestreview-463202210", "createdAt": "2020-08-07T10:21:33Z", "commit": {"oid": "7bd7113c128de4b151833f93c227888ba92fc3fb"}, "state": "DISMISSED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "9ebadd21ac4212d281b33341ca790064c6a2abf9", "author": {"user": null}, "url": "https://github.com/vaadin/flow/commit/9ebadd21ac4212d281b33341ca790064c6a2abf9", "committedDate": "2020-08-07T10:22:32Z", "message": "Use one magic method instead of another"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "156b68a887fee2c1b36e1e654ae790a9de454cd8", "author": {"user": null}, "url": "https://github.com/vaadin/flow/commit/156b68a887fee2c1b36e1e654ae790a9de454cd8", "committedDate": "2020-08-07T10:45:39Z", "message": "Check the type of JsonValue before read it"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDY1ODMyMTky", "url": "https://github.com/vaadin/flow/pull/8826#pullrequestreview-465832192", "createdAt": "2020-08-12T11:44:23Z", "commit": {"oid": "156b68a887fee2c1b36e1e654ae790a9de454cd8"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 70, "cost": 1, "resetAt": "2021-10-28T19:08:13Z"}}}