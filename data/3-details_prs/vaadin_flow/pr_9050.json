{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDkwODA1ODY3", "number": 9050, "title": "Clear routes.", "bodyText": "Fixes #8433", "createdAt": "2020-09-22T09:23:47Z", "url": "https://github.com/vaadin/flow/pull/9050", "merged": true, "mergeCommit": {"oid": "819eb22a2e0cf8e29d4de23f6f38afc3a3ff1671"}, "closed": true, "closedAt": "2020-09-23T09:32:30Z", "author": {"login": "bogdanudrescu"}, "timelineItems": {"totalCount": 10, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdLUiY-AH2gAyNDkwODA1ODY3OmJjZGI5ZWEwZjBhZTk1OTljYTM1MDA4MmI5ZDljOTgwYzUwNjFiODQ=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdLpA3FgFqTQ5NDQ2MTgwOA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "bcdb9ea0f0ae9599ca350082b9d9c980c5061b84", "author": {"user": {"login": "bogdanudrescu", "name": "Bogdan Udrescu"}}, "url": "https://github.com/vaadin/flow/commit/bcdb9ea0f0ae9599ca350082b9d9c980c5061b84", "committedDate": "2020-09-22T09:26:04Z", "message": "Clear routes."}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "df8ba7372ddcf599ff631e50073c8cf55a100f67", "author": {"user": {"login": "bogdanudrescu", "name": "Bogdan Udrescu"}}, "url": "https://github.com/vaadin/flow/commit/df8ba7372ddcf599ff631e50073c8cf55a100f67", "committedDate": "2020-09-22T09:22:30Z", "message": "Clear routes."}, "afterCommit": {"oid": "bcdb9ea0f0ae9599ca350082b9d9c980c5061b84", "author": {"user": {"login": "bogdanudrescu", "name": "Bogdan Udrescu"}}, "url": "https://github.com/vaadin/flow/commit/bcdb9ea0f0ae9599ca350082b9d9c980c5061b84", "committedDate": "2020-09-22T09:26:04Z", "message": "Clear routes."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDkzMzI3OTM1", "url": "https://github.com/vaadin/flow/pull/9050#pullrequestreview-493327935", "createdAt": "2020-09-22T10:37:36Z", "commit": {"oid": "bcdb9ea0f0ae9599ca350082b9d9c980c5061b84"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yMlQxMDozNzozNlrOHV0Blg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yMlQxMDo0MjoyNlrOHV0KjQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MjYzNDUxOA==", "bodyText": "Failing should be due to route not registered yet as the exception is thrown for non unique route registration.\nAlso what does this actually test as the assert routes check that the route has been registered?\nI would remove this part as it doesn't bring anything that is expected.", "url": "https://github.com/vaadin/flow/pull/9050#discussion_r492634518", "createdAt": "2020-09-22T10:37:36Z", "author": {"login": "caalador"}, "path": "flow-server/src/test/java/com/vaadin/flow/router/internal/ConfigureRoutesTest.java", "diffHunk": "@@ -62,6 +62,56 @@ public void mutableConfiguration_canSetTargetRoute() {\n                 \"\", mutable.getTemplate(BaseTarget.class));\n     }\n \n+    @Test\n+    public void mutableConfiguration_clearRoutes() {\n+        ConfigureRoutes mutable = new ConfigureRoutes();\n+\n+        assertSetRoutes(mutable);\n+\n+        try {\n+            mutable.setRoute(\"\", BaseTarget.class);\n+            Assert.fail(\"Route is already registered\");", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "bcdb9ea0f0ae9599ca350082b9d9c980c5061b84"}, "originalPosition": 31}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MjYzNjgxMw==", "bodyText": "Also remove this set as it doesn't bring anything that is not tested in assertSetRoutes.", "url": "https://github.com/vaadin/flow/pull/9050#discussion_r492636813", "createdAt": "2020-09-22T10:42:26Z", "author": {"login": "caalador"}, "path": "flow-server/src/test/java/com/vaadin/flow/router/internal/ConfigureRoutesTest.java", "diffHunk": "@@ -62,6 +62,56 @@ public void mutableConfiguration_canSetTargetRoute() {\n                 \"\", mutable.getTemplate(BaseTarget.class));\n     }\n \n+    @Test\n+    public void mutableConfiguration_clearRoutes() {\n+        ConfigureRoutes mutable = new ConfigureRoutes();\n+\n+        assertSetRoutes(mutable);\n+\n+        try {\n+            mutable.setRoute(\"\", BaseTarget.class);\n+            Assert.fail(\"Route is already registered\");\n+        } catch (InvalidRouteConfigurationException e) {\n+        }\n+\n+        try {\n+            mutable.setRoute(\":param\", ParamTarget.class);\n+            Assert.fail(\"Route is already registered\");", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "bcdb9ea0f0ae9599ca350082b9d9c980c5061b84"}, "originalPosition": 37}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "91019339be2bc6c4f75e6221b4b94384db6d9f9f", "author": {"user": {"login": "bogdanudrescu", "name": "Bogdan Udrescu"}}, "url": "https://github.com/vaadin/flow/commit/91019339be2bc6c4f75e6221b4b94384db6d9f9f", "committedDate": "2020-09-23T06:58:02Z", "message": "Document exception test."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDk0MzA4MTM0", "url": "https://github.com/vaadin/flow/pull/9050#pullrequestreview-494308134", "createdAt": "2020-09-23T07:05:56Z", "commit": {"oid": "91019339be2bc6c4f75e6221b4b94384db6d9f9f"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yM1QwNzowNTo1NlrOHWZQPw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yM1QwNzowNTo1NlrOHWZQPw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MzI0NDQ3OQ==", "bodyText": "I would rather have these as their own tests e.g. duplicateRootPathRegistration_throwsException and duplicateParameterPathRegistration_throwsException. as then it's clear what is the expected outcome and having a test fail makes it clear. now it would seem that clearing routed doesn't work even if this wouldn't be the case.", "url": "https://github.com/vaadin/flow/pull/9050#discussion_r493244479", "createdAt": "2020-09-23T07:05:56Z", "author": {"login": "caalador"}, "path": "flow-server/src/test/java/com/vaadin/flow/router/internal/ConfigureRoutesTest.java", "diffHunk": "@@ -62,6 +62,56 @@ public void mutableConfiguration_canSetTargetRoute() {\n                 \"\", mutable.getTemplate(BaseTarget.class));\n     }\n \n+    @Test\n+    public void mutableConfiguration_clearRoutes() {\n+        ConfigureRoutes mutable = new ConfigureRoutes();\n+\n+        assertSetRoutes(mutable);\n+\n+        try {\n+            mutable.setRoute(\"\", BaseTarget.class);\n+            Assert.fail(\"Route is already registered\");", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MjYzNDUxOA=="}, "originalCommit": {"oid": "bcdb9ea0f0ae9599ca350082b9d9c980c5061b84"}, "originalPosition": 31}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "6727442d37fb636e8cfd6a516c7442cc29f41730", "author": {"user": {"login": "bogdanudrescu", "name": "Bogdan Udrescu"}}, "url": "https://github.com/vaadin/flow/commit/6727442d37fb636e8cfd6a516c7442cc29f41730", "committedDate": "2020-09-23T07:21:41Z", "message": "Fix comments"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDk0MzUzNTk5", "url": "https://github.com/vaadin/flow/pull/9050#pullrequestreview-494353599", "createdAt": "2020-09-23T07:31:15Z", "commit": {"oid": "6727442d37fb636e8cfd6a516c7442cc29f41730"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yM1QwNzozMToxNVrOHWaHaA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yM1QwNzozMToxNVrOHWaHaA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MzI1ODYwMA==", "bodyText": "Instead of the try catch you a better choice would be to add as a common parameter\n    @Rule\n    public ExpectedException exception = ExpectedException.none();\n\nand in the tests expecting exception have:\n        exceptionRule.expect(InvalidRouteConfigurationException.class);\n        exceptionRule.reportMissingExceptionWithMessage(\"Duplicate routes shouldn't be accepted.\");", "url": "https://github.com/vaadin/flow/pull/9050#discussion_r493258600", "createdAt": "2020-09-23T07:31:15Z", "author": {"login": "caalador"}, "path": "flow-server/src/test/java/com/vaadin/flow/router/internal/ConfigureRoutesTest.java", "diffHunk": "@@ -62,6 +62,70 @@ public void mutableConfiguration_canSetTargetRoute() {\n                 \"\", mutable.getTemplate(BaseTarget.class));\n     }\n \n+    @Test\n+    public void mutableConfigurationClear_removesRegisteredRoutes() {\n+        ConfigureRoutes mutable = new ConfigureRoutes();\n+\n+        assertSetRoutes(mutable);\n+\n+        mutable.clear();\n+\n+        Assert.assertFalse(mutable.hasRouteTarget(BaseTarget.class));\n+        Assert.assertFalse(mutable.hasRouteTarget(ParamTarget.class));\n+\n+        Assert.assertNull(\n+                mutable.getNavigationRouteTarget(\"\").getRouteTarget());\n+        Assert.assertNull(\n+                mutable.getNavigationRouteTarget(\"123\").getRouteTarget());\n+\n+        assertSetRoutes(mutable);\n+    }\n+\n+    @Test\n+    public void mutableConfigurationClear_preservesErrorRoute() {\n+        ConfigureRoutes mutable = new ConfigureRoutes();\n+\n+        mutable.setErrorRoute(IndexOutOfBoundsException.class, BaseError.class);\n+\n+        mutable.clear();\n+\n+        Assert.assertEquals(\"ErrorRoute shouldn't be cleared.\",\n+                BaseError.class, mutable.getExceptionHandlerByClass(\n+                        IndexOutOfBoundsException.class));\n+    }\n+\n+    @Test\n+    public void duplicateRootPathRegistration_throwsException() {\n+        ConfigureRoutes mutable = new ConfigureRoutes();\n+\n+        mutable.setRoute(\"\", BaseTarget.class);\n+        Assert.assertTrue(mutable.hasRouteTarget(BaseTarget.class));\n+        Assert.assertEquals(BaseTarget.class, mutable\n+                .getNavigationRouteTarget(\"\").getRouteTarget().getTarget());\n+\n+        try {\n+            mutable.setRoute(\"\", BaseTarget.class);\n+            Assert.fail(\"Base route is already registered\");\n+        } catch (InvalidRouteConfigurationException e) {\n+        }\n+    }\n+\n+    @Test\n+    public void duplicateParameterPathRegistration_throwsException() {\n+        ConfigureRoutes mutable = new ConfigureRoutes();\n+\n+        mutable.setRoute(\":param\", ParamTarget.class);\n+        Assert.assertTrue(mutable.hasRouteTarget(ParamTarget.class));\n+        Assert.assertEquals(ParamTarget.class, mutable\n+                .getNavigationRouteTarget(\"123\").getRouteTarget().getTarget());\n+\n+        try {\n+            mutable.setRoute(\":param\", ParamTarget.class);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "6727442d37fb636e8cfd6a516c7442cc29f41730"}, "originalPosition": 81}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b8daa002d5280b3e171cb28641461c0f01d79994", "author": {"user": {"login": "bogdanudrescu", "name": "Bogdan Udrescu"}}, "url": "https://github.com/vaadin/flow/commit/b8daa002d5280b3e171cb28641461c0f01d79994", "committedDate": "2020-09-23T08:08:15Z", "message": "Fix comments"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDk0NDA5MDg1", "url": "https://github.com/vaadin/flow/pull/9050#pullrequestreview-494409085", "createdAt": "2020-09-23T08:13:52Z", "commit": {"oid": "b8daa002d5280b3e171cb28641461c0f01d79994"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDk0NDYxODA4", "url": "https://github.com/vaadin/flow/pull/9050#pullrequestreview-494461808", "createdAt": "2020-09-23T09:17:27Z", "commit": {"oid": "b8daa002d5280b3e171cb28641461c0f01d79994"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4930, "cost": 1, "resetAt": "2021-10-28T20:13:43Z"}}}