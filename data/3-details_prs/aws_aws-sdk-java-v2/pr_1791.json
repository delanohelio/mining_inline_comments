{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDA4NzYwNzU4", "number": 1791, "title": "Various performance improvements.", "bodyText": "Benchmarks in progress.", "createdAt": "2020-04-24T20:54:24Z", "url": "https://github.com/aws/aws-sdk-java-v2/pull/1791", "merged": true, "mergeCommit": {"oid": "5a892e4a17e54dae135b922cbbc987fc64554947"}, "closed": true, "closedAt": "2020-04-24T22:54:59Z", "author": {"login": "millems"}, "timelineItems": {"totalCount": 5, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABca4LkbABqjMyNzEwNTc4NzI=", "endCursor": "Y3Vyc29yOnYyOpPPAAABca5imvAFqTQwMDMxMjUwOA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "c728f5283114f7d40a7b7de0f13fcb1218f0427e", "author": {"user": {"login": "millems", "name": "Matthew Miller"}}, "url": "https://github.com/aws/aws-sdk-java-v2/commit/c728f5283114f7d40a7b7de0f13fcb1218f0427e", "committedDate": "2020-04-24T20:53:51Z", "message": "Various performance improvements."}, "afterCommit": {"oid": "e36c6c3c9a4285d7d6422259b6dd283713c589a8", "author": {"user": {"login": "millems", "name": "Matthew Miller"}}, "url": "https://github.com/aws/aws-sdk-java-v2/commit/e36c6c3c9a4285d7d6422259b6dd283713c589a8", "committedDate": "2020-04-24T21:15:19Z", "message": "Various performance improvements."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDAwMjkyNDU3", "url": "https://github.com/aws/aws-sdk-java-v2/pull/1791#pullrequestreview-400292457", "createdAt": "2020-04-24T21:52:30Z", "commit": {"oid": "e36c6c3c9a4285d7d6422259b6dd283713c589a8"}, "state": "COMMENTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yNFQyMTo1MjozMFrOGLqiLA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yNFQyMjoxMToyNlrOGLq-bA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNDg4NDM5Ng==", "bodyText": "NIT: it's easier to read if canonicalizeSigningHeaders is nearer to getCanonicalizedHeaderString and getSignedHeadersString. Found myself scrolling up and down.", "url": "https://github.com/aws/aws-sdk-java-v2/pull/1791#discussion_r414884396", "createdAt": "2020-04-24T21:52:30Z", "author": {"login": "cenedhryn"}, "path": "core/auth/src/main/java/software/amazon/awssdk/auth/signer/internal/AbstractAws4Signer.java", "diffHunk": "@@ -191,26 +204,42 @@ protected abstract void processRequestPayload(SdkHttpFullRequest.Builder mutable\n      * generate the canonical request.\n      */\n     private String createCanonicalRequest(SdkHttpFullRequest.Builder request,\n+                                          Map<String, List<String>> canonicalHeaders,\n+                                          String signedHeadersString,\n                                           String contentSha256,\n                                           boolean doubleUrlEncode) {\n-\n         String canonicalRequest = request.method().toString() +\n                                   SignerConstant.LINE_SEPARATOR +\n                                   // This would optionally double url-encode the resource path\n                                   getCanonicalizedResourcePath(request.encodedPath(), doubleUrlEncode) +\n                                   SignerConstant.LINE_SEPARATOR +\n                                   getCanonicalizedQueryString(request.rawQueryParameters()) +\n                                   SignerConstant.LINE_SEPARATOR +\n-                                  getCanonicalizedHeaderString(request.headers()) +\n+                                  getCanonicalizedHeaderString(canonicalHeaders) +\n                                   SignerConstant.LINE_SEPARATOR +\n-                                  getSignedHeadersString(request.headers()) +\n+                                  signedHeadersString +\n                                   SignerConstant.LINE_SEPARATOR +\n                                   contentSha256;\n \n         LOG.trace(() -> \"AWS4 Canonical Request: \" + canonicalRequest);\n         return canonicalRequest;\n     }\n \n+    private Map<String, List<String>> canonicalizeSigningHeaders(Map<String, List<String>> headers) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "e36c6c3c9a4285d7d6422259b6dd283713c589a8"}, "originalPosition": 80}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNDg5MTYyOA==", "bodyText": "Substance over beauty!", "url": "https://github.com/aws/aws-sdk-java-v2/pull/1791#discussion_r414891628", "createdAt": "2020-04-24T22:11:26Z", "author": {"login": "cenedhryn"}, "path": "http-client-spi/src/main/java/software/amazon/awssdk/http/DefaultSdkHttpFullRequest.java", "diffHunk": "@@ -172,12 +169,35 @@ public String toString() {\n         private String host;\n         private Integer port;\n         private String path;\n-        private Map<String, List<String>> queryParameters = new LinkedHashMap<>();\n+\n+        private boolean queryParametersAreFromToBuilder;\n+        private Map<String, List<String>> queryParameters;\n+\n         private SdkHttpMethod httpMethod;\n-        private Map<String, List<String>> headers = new LinkedHashMap<>();\n+\n+        private boolean headersAreFromToBuilder;\n+        private Map<String, List<String>> headers;\n+\n         private ContentStreamProvider contentStreamProvider;\n \n         Builder() {\n+            queryParameters = new LinkedHashMap<>();\n+            queryParametersAreFromToBuilder = false;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "e36c6c3c9a4285d7d6422259b6dd283713c589a8"}, "originalPosition": 63}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "1097bdaa9a866ea34e9679880339205f869ff6c7", "author": {"user": {"login": "millems", "name": "Matthew Miller"}}, "url": "https://github.com/aws/aws-sdk-java-v2/commit/1097bdaa9a866ea34e9679880339205f869ff6c7", "committedDate": "2020-04-24T22:34:52Z", "message": "Various performance improvements."}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "e36c6c3c9a4285d7d6422259b6dd283713c589a8", "author": {"user": {"login": "millems", "name": "Matthew Miller"}}, "url": "https://github.com/aws/aws-sdk-java-v2/commit/e36c6c3c9a4285d7d6422259b6dd283713c589a8", "committedDate": "2020-04-24T21:15:19Z", "message": "Various performance improvements."}, "afterCommit": {"oid": "1097bdaa9a866ea34e9679880339205f869ff6c7", "author": {"user": {"login": "millems", "name": "Matthew Miller"}}, "url": "https://github.com/aws/aws-sdk-java-v2/commit/1097bdaa9a866ea34e9679880339205f869ff6c7", "committedDate": "2020-04-24T22:34:52Z", "message": "Various performance improvements."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDAwMzEyNTA4", "url": "https://github.com/aws/aws-sdk-java-v2/pull/1791#pullrequestreview-400312508", "createdAt": "2020-04-24T22:50:30Z", "commit": {"oid": "1097bdaa9a866ea34e9679880339205f869ff6c7"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2529, "cost": 1, "resetAt": "2021-11-01T11:59:11Z"}}}