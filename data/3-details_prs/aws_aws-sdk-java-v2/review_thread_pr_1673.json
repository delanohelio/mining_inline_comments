{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0MzgxMTAwNTY0", "number": 1673, "reviewThreads": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yOFQwMTowOTo1NlrODjqlcQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yOFQwMToxMTowNVrODjqmXA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjM4NzI0NDY1OnYy", "diffSide": "RIGHT", "path": "core/sdk-core/src/main/java/software/amazon/awssdk/core/retry/backoff/BackoffStrategy.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yOFQwMTowOTo1NlrOFvmjmw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yOFQwMTowOTo1NlrOFvmjmw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NTQ1OTA5OQ==", "bodyText": "Javadoc this", "url": "https://github.com/aws/aws-sdk-java-v2/pull/1673#discussion_r385459099", "createdAt": "2020-02-28T01:09:56Z", "author": {"login": "spfink"}, "path": "core/sdk-core/src/main/java/software/amazon/awssdk/core/retry/backoff/BackoffStrategy.java", "diffHunk": "@@ -24,6 +24,8 @@\n @FunctionalInterface\n public interface BackoffStrategy {\n \n+    int RETRIES_ATTEMPTED_CEILING = (int) Math.floor(Math.log(Integer.MAX_VALUE) / Math.log(2));", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "0b1606c3b3015d0bd00405c2d7ebe3e3ee53cdae"}, "originalPosition": 4}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjM4NzI0NTU4OnYy", "diffSide": "RIGHT", "path": "core/sdk-core/src/main/java/software/amazon/awssdk/core/retry/backoff/BackoffStrategy.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yOFQwMToxMDoyNlrOFvmkMA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yOFQwMToxMDoyNlrOFvmkMA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NTQ1OTI0OA==", "bodyText": "You should pull in our style template as this is incorrect", "url": "https://github.com/aws/aws-sdk-java-v2/pull/1673#discussion_r385459248", "createdAt": "2020-02-28T01:10:26Z", "author": {"login": "spfink"}, "path": "core/sdk-core/src/main/java/software/amazon/awssdk/core/retry/backoff/BackoffStrategy.java", "diffHunk": "@@ -33,21 +35,22 @@\n     Duration computeDelayBeforeNextRetry(RetryPolicyContext context);\n \n     default int calculateExponentialDelay(int retriesAttempted, Duration baseDelay, Duration maxBackoffTime) {\n-        return (int) Math.min((1L << retriesAttempted) * baseDelay.toMillis(), maxBackoffTime.toMillis());\n+        int cappedRetries = Math.min(retriesAttempted, RETRIES_ATTEMPTED_CEILING);\n+        return (int) Math.min(baseDelay.multipliedBy(1L << cappedRetries).toMillis(), maxBackoffTime.toMillis());\n     }\n \n     static BackoffStrategy defaultStrategy() {\n         return FullJitterBackoffStrategy.builder()\n-                                        .baseDelay(SdkDefaultRetrySetting.BASE_DELAY)\n-                                        .maxBackoffTime(SdkDefaultRetrySetting.MAX_BACKOFF)\n-                                        .build();\n+                .baseDelay(SdkDefaultRetrySetting.BASE_DELAY)", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "0b1606c3b3015d0bd00405c2d7ebe3e3ee53cdae"}, "originalPosition": 23}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjM4NzI0NzAwOnYy", "diffSide": "RIGHT", "path": "core/sdk-core/src/test/java/software/amazon/awssdk/core/retry/backoff/EqualJitterBackoffStrategyTest.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yOFQwMToxMTowNVrOFvmk-A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yOFQwMToxMTowNVrOFvmk-A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NTQ1OTQ0OA==", "bodyText": "Take a look at some of our existing tests and rename these to match our pattern", "url": "https://github.com/aws/aws-sdk-java-v2/pull/1673#discussion_r385459448", "createdAt": "2020-02-28T01:11:05Z", "author": {"login": "spfink"}, "path": "core/sdk-core/src/test/java/software/amazon/awssdk/core/retry/backoff/EqualJitterBackoffStrategyTest.java", "diffHunk": "@@ -0,0 +1,116 @@\n+/*\n+ * Copyright Amazon.com, Inc. or its affiliates. All Rights Reserved.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\").\n+ * You may not use this file except in compliance with the License.\n+ * A copy of the License is located at\n+ *\n+ *  http://aws.amazon.com/apache2.0\n+ *\n+ * or in the \"license\" file accompanying this file. This file is distributed\n+ * on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either\n+ * express or implied. See the License for the specific language governing\n+ * permissions and limitations under the License.\n+ */\n+\n+package software.amazon.awssdk.core.retry.backoff;\n+\n+import org.junit.Test;\n+import org.mockito.Mock;\n+import software.amazon.awssdk.core.retry.RetryPolicyContext;\n+\n+import java.time.Duration;\n+import java.util.Random;\n+\n+import static org.hamcrest.Matchers.is;\n+import static org.junit.Assert.*;\n+import static org.mockito.Mockito.mock;\n+import static org.mockito.Mockito.when;\n+import static org.testng.Assert.assertThrows;\n+\n+public class EqualJitterBackoffStrategyTest {\n+\n+    private static final int RANDOM_RESULT = 12345;\n+    private static final Duration FIVE_DAYS = Duration.ofDays(5);\n+    private static final Duration MAX_DURATION = Duration.ofSeconds(Long.MAX_VALUE);\n+    private static final Duration ONE_SECOND = Duration.ofSeconds(1);\n+    private static final Duration ONE_NANO_SECOND = Duration.ofNanos(1);\n+    private static final int NANO_IN_MILLISECONDS = 1_000_000;\n+    private static final Duration NEGATIVE_ONE_SECOND = Duration.ofSeconds(-1);\n+\n+    @Mock\n+    private Random mockRandom = mock(Random.class);\n+\n+    @Test\n+    public void GIVEN_exponentialDelayAboveCeiling_THEN_return_JitteredCeiling() {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "0b1606c3b3015d0bd00405c2d7ebe3e3ee53cdae"}, "originalPosition": 45}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4226, "cost": 1, "resetAt": "2021-11-12T11:18:39Z"}}}