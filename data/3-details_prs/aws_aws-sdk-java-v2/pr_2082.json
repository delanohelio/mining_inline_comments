{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDk5MjI1MTYw", "number": 2082, "title": "feature 2034: SdkHttpFullRequest builder.URI conditionally accept que\u2026", "bodyText": "Description\nWhen calling the SdkHttpFullRequest builder using the URI default method, query parameters are now supported in the provided URI if keepUriQueryParams is set to true on the builder.\\nThis can be useful in case you want to provide an already fully formed URI like a callback URI.\nMotivation and Context\nQuery parameters that were provided to the builder in the form of the passed URI were omitted before\n#2034\nTesting\nadded test cases in SdkHttpRequestResponseTest\nScreenshots (if appropriate)\nTypes of changes\n\n\n Bug fix (non-breaking change which fixes an issue)\n New feature (non-breaking change which adds functionality)\n\nChecklist\n\n\n\n I have read the CONTRIBUTING document\n Local run of mvn install succeeds\n My code follows the code style of this project\n My change requires a change to the Javadoc documentation\n I have updated the Javadoc documentation accordingly\n I have read the README document\n I have added tests to cover my changes\n All new and existing tests passed\n A short description of the change has been added to the CHANGELOG\n My change is to implement 1.11 parity feature and I have updated LaunchChangelog\n\nLicense\n\n\n\n\n I confirm that this pull request can be released under the Apache 2 license", "createdAt": "2020-10-07T12:48:39Z", "url": "https://github.com/aws/aws-sdk-java-v2/pull/2082", "merged": true, "mergeCommit": {"oid": "30660f43ec485b20b39d7ea6743bdf43b2b7faa1"}, "closed": true, "closedAt": "2020-10-17T00:00:43Z", "author": {"login": "Strat1987"}, "timelineItems": {"totalCount": 24, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdQ_QfHgFqTUwNjA0MTU1OA==", "endCursor": "Y3Vyc29yOnYyOpPPAAABdTL--KAH2gAyNDk5MjI1MTYwOjkwZDcxNDMxOWQ2M2JkMzhiYmI2YjlmZGNiYTIzMDYwZTIzYmZhYjQ=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTA2MDQxNTU4", "url": "https://github.com/aws/aws-sdk-java-v2/pull/2082#pullrequestreview-506041558", "createdAt": "2020-10-09T23:57:20Z", "commit": {"oid": "43a43be5a780b37d592d71b52e91ed7e3e6a51ba"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wOVQyMzo1NzoyMFrOHfbYbg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xMFQwMDowMTo0OFrOHfbbLA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMjcxNjUyNg==", "bodyText": "I don't think we should have methods that affect the behavior of other methods that are called later. I would rather method calls are on the builder be self-contained and have no side effects. It means other methods (existing or added in the future) will also have to at least consider whether this flag affects their behavior.\nI think a better solution here would to be introduce a new method that is similar to uri(URI), with the additional behavior of including the query params on the given URI. Something like uriWithQueryParams(URI)", "url": "https://github.com/aws/aws-sdk-java-v2/pull/2082#discussion_r502716526", "createdAt": "2020-10-09T23:57:20Z", "author": {"login": "dagnir"}, "path": "http-client-spi/src/main/java/software/amazon/awssdk/http/DefaultSdkHttpFullRequest.java", "diffHunk": "@@ -244,6 +255,19 @@ public String encodedPath() {\n             return path;\n         }\n \n+        @Override\n+        public DefaultSdkHttpFullRequest.Builder keepUriQueryParams(boolean keepUriQueryParams) {\n+            this.keepUriQueryParams = keepUriQueryParams;\n+            return this;\n+        }\n+\n+        @Override\n+        public boolean keepUriQueryParams() {\n+            return keepUriQueryParams;\n+        }", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "43a43be5a780b37d592d71b52e91ed7e3e6a51ba"}, "originalPosition": 52}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMjcxNzA4Nw==", "bodyText": "I don't think appending would be the correct behavior here; the current set of query parameters should be cleared; otherwise something like this\nbuilder.uri(myUri1).uri(myUri2);\nwill contain the query parameters from both URIs.", "url": "https://github.com/aws/aws-sdk-java-v2/pull/2082#discussion_r502717087", "createdAt": "2020-10-10T00:00:52Z", "author": {"login": "dagnir"}, "path": "http-client-spi/src/main/java/software/amazon/awssdk/http/SdkHttpRequest.java", "diffHunk": "@@ -134,18 +138,28 @@ default URI getUri() {\n      * {@link SdkHttpFullRequest#builder()}.\n      */\n     interface Builder extends CopyableBuilder<Builder, SdkHttpRequest> {\n+\n         /**\n-         * Convenience method to set the {@link #protocol()}, {@link #host()}, {@link #port()}, and\n-         * {@link #encodedPath()} from a {@link URI} object.\n+         * Convenience method to set the {@link #protocol()}, {@link #host()}, {@link #port()},\n+         * {@link #encodedPath()} and optional via {@link #keepUriQueryParams()} query parameters from a {@link URI} object.\n          *\n-         * @param uri URI containing protocol, host, port and path.\n+         * @param uri URI containing protocol, host, port, path and optional query parameters.\n          * @return This builder for method chaining.\n          */\n         default Builder uri(URI uri) {\n-            return this.protocol(uri.getScheme())\n-                       .host(uri.getHost())\n-                       .port(uri.getPort())\n-                       .encodedPath(SdkHttpUtils.appendUri(uri.getRawPath(), encodedPath()));\n+            SdkHttpRequest.Builder builder = this.protocol(uri.getScheme())\n+                                                 .host(uri.getHost())\n+                                                 .port(uri.getPort())\n+                                                 .encodedPath(SdkHttpUtils.appendUri(uri.getRawPath(), encodedPath()));\n+            if (uri.getQuery() != null) {\n+                Pattern.compile(\"\\\\s*&\\\\s*\")\n+                       .splitAsStream(uri.getQuery().trim())\n+                       .map(s -> s.split(\"=\", 2))\n+                       .collect(groupingBy(a -> a[0], mapping(a -> a[1], toList())))\n+                       .forEach((paramKey, paramValues) -> paramValues\n+                           .forEach(paramValue -> this.appendUriQueryParameter(paramKey, paramValue)));", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "43a43be5a780b37d592d71b52e91ed7e3e6a51ba"}, "originalPosition": 46}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMjcxNzIyOA==", "bodyText": "Think the query parameters need to be decoded as well", "url": "https://github.com/aws/aws-sdk-java-v2/pull/2082#discussion_r502717228", "createdAt": "2020-10-10T00:01:48Z", "author": {"login": "dagnir"}, "path": "http-client-spi/src/main/java/software/amazon/awssdk/http/SdkHttpRequest.java", "diffHunk": "@@ -134,18 +138,28 @@ default URI getUri() {\n      * {@link SdkHttpFullRequest#builder()}.\n      */\n     interface Builder extends CopyableBuilder<Builder, SdkHttpRequest> {\n+\n         /**\n-         * Convenience method to set the {@link #protocol()}, {@link #host()}, {@link #port()}, and\n-         * {@link #encodedPath()} from a {@link URI} object.\n+         * Convenience method to set the {@link #protocol()}, {@link #host()}, {@link #port()},\n+         * {@link #encodedPath()} and optional via {@link #keepUriQueryParams()} query parameters from a {@link URI} object.\n          *\n-         * @param uri URI containing protocol, host, port and path.\n+         * @param uri URI containing protocol, host, port, path and optional query parameters.\n          * @return This builder for method chaining.\n          */\n         default Builder uri(URI uri) {\n-            return this.protocol(uri.getScheme())\n-                       .host(uri.getHost())\n-                       .port(uri.getPort())\n-                       .encodedPath(SdkHttpUtils.appendUri(uri.getRawPath(), encodedPath()));\n+            SdkHttpRequest.Builder builder = this.protocol(uri.getScheme())\n+                                                 .host(uri.getHost())\n+                                                 .port(uri.getPort())\n+                                                 .encodedPath(SdkHttpUtils.appendUri(uri.getRawPath(), encodedPath()));\n+            if (uri.getQuery() != null) {\n+                Pattern.compile(\"\\\\s*&\\\\s*\")\n+                       .splitAsStream(uri.getQuery().trim())\n+                       .map(s -> s.split(\"=\", 2))\n+                       .collect(groupingBy(a -> a[0], mapping(a -> a[1], toList())))\n+                       .forEach((paramKey, paramValues) -> paramValues\n+                           .forEach(paramValue -> this.appendUriQueryParameter(paramKey, paramValue)));", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "43a43be5a780b37d592d71b52e91ed7e3e6a51ba"}, "originalPosition": 46}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "9d6fae0647cc2516d6cefb7ad6ea70a2b11a89dd", "author": {"user": {"login": "roexber", "name": null}}, "url": "https://github.com/aws/aws-sdk-java-v2/commit/9d6fae0647cc2516d6cefb7ad6ea70a2b11a89dd", "committedDate": "2020-10-11T11:25:09Z", "message": "feature 2034: SdkHttpFullRequest builder.URI keep query parameters of provided URI if the uriWithQueryParams builder method is used"}, "afterCommit": {"oid": "7dc5615dac6db69334bdbc35611dec993c7edb06", "author": {"user": {"login": "roexber", "name": null}}, "url": "https://github.com/aws/aws-sdk-java-v2/commit/7dc5615dac6db69334bdbc35611dec993c7edb06", "committedDate": "2020-10-13T17:01:26Z", "message": "feature 2034: SdkHttpFullRequest builder.URI keep query parameters of provided URI if the uriWithQueryParams builder method is used"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "7dc5615dac6db69334bdbc35611dec993c7edb06", "author": {"user": {"login": "roexber", "name": null}}, "url": "https://github.com/aws/aws-sdk-java-v2/commit/7dc5615dac6db69334bdbc35611dec993c7edb06", "committedDate": "2020-10-13T17:01:26Z", "message": "feature 2034: SdkHttpFullRequest builder.URI keep query parameters of provided URI if the uriWithQueryParams builder method is used"}, "afterCommit": {"oid": "46ee998ff83f21b99b36db30dc66f3571691d942", "author": {"user": {"login": "roexber", "name": null}}, "url": "https://github.com/aws/aws-sdk-java-v2/commit/46ee998ff83f21b99b36db30dc66f3571691d942", "committedDate": "2020-10-13T18:33:01Z", "message": "feature 2034: SdkHttpFullRequest builder.URI keep query parameters of provided URI if the uriWithQueryParams builder method is used"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "46ee998ff83f21b99b36db30dc66f3571691d942", "author": {"user": {"login": "roexber", "name": null}}, "url": "https://github.com/aws/aws-sdk-java-v2/commit/46ee998ff83f21b99b36db30dc66f3571691d942", "committedDate": "2020-10-13T18:33:01Z", "message": "feature 2034: SdkHttpFullRequest builder.URI keep query parameters of provided URI if the uriWithQueryParams builder method is used"}, "afterCommit": {"oid": "ee074224f4d1d58bbfb195169fe9bddbd5cf5779", "author": {"user": {"login": "roexber", "name": null}}, "url": "https://github.com/aws/aws-sdk-java-v2/commit/ee074224f4d1d58bbfb195169fe9bddbd5cf5779", "committedDate": "2020-10-13T18:34:46Z", "message": "feature 2034: SdkHttpFullRequest builder.URI keep query parameters of provided URI if the uriWithQueryParams builder method is used"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTA3Njk0NzUy", "url": "https://github.com/aws/aws-sdk-java-v2/pull/2082#pullrequestreview-507694752", "createdAt": "2020-10-13T17:57:07Z", "commit": {"oid": "7dc5615dac6db69334bdbc35611dec993c7edb06"}, "state": "COMMENTED", "comments": {"totalCount": 7, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xM1QxNzo1NzowOFrOHgy4GQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xM1QxODozNDoyNVrOHg0Vzw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNDE1MDA0MQ==", "bodyText": "Please revert formatting change here", "url": "https://github.com/aws/aws-sdk-java-v2/pull/2082#discussion_r504150041", "createdAt": "2020-10-13T17:57:08Z", "author": {"login": "dagnir"}, "path": "http-client-spi/src/main/java/software/amazon/awssdk/http/SdkHttpRequest.java", "diffHunk": "@@ -143,9 +148,29 @@ default URI getUri() {\n          */\n         default Builder uri(URI uri) {\n             return this.protocol(uri.getScheme())\n-                       .host(uri.getHost())\n-                       .port(uri.getPort())\n-                       .encodedPath(SdkHttpUtils.appendUri(uri.getRawPath(), encodedPath()));\n+                                                 .host(uri.getHost())\n+                                                 .port(uri.getPort())\n+                                                 .encodedPath(SdkHttpUtils.appendUri(uri.getRawPath(), encodedPath()));\n+        }", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "7dc5615dac6db69334bdbc35611dec993c7edb06"}, "originalPosition": 34}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNDE1MDMxMw==", "bodyText": "Please revert formatting change", "url": "https://github.com/aws/aws-sdk-java-v2/pull/2082#discussion_r504150313", "createdAt": "2020-10-13T17:57:35Z", "author": {"login": "dagnir"}, "path": "http-client-spi/src/main/java/software/amazon/awssdk/http/SdkHttpFullRequest.java", "diffHunk": "@@ -66,9 +71,29 @@\n         @Override\n         default Builder uri(URI uri) {\n             return this.protocol(uri.getScheme())\n-                       .host(uri.getHost())\n-                       .port(uri.getPort())\n-                       .encodedPath(SdkHttpUtils.appendUri(uri.getRawPath(), encodedPath()));\n+                    .host(uri.getHost())\n+                    .port(uri.getPort())\n+                    .encodedPath(SdkHttpUtils.appendUri(uri.getRawPath(), encodedPath()));\n+        }", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "7dc5615dac6db69334bdbc35611dec993c7edb06"}, "originalPosition": 35}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNDE1MzQ0NQ==", "bodyText": "This code is pretty complex and is duplicated here and in SdkHttpRequest. Let's move this out into SdkHttpUtils instead. Should also make the parsing easier to test in isolation", "url": "https://github.com/aws/aws-sdk-java-v2/pull/2082#discussion_r504153445", "createdAt": "2020-10-13T18:02:51Z", "author": {"login": "dagnir"}, "path": "http-client-spi/src/main/java/software/amazon/awssdk/http/SdkHttpFullRequest.java", "diffHunk": "@@ -66,9 +71,29 @@\n         @Override\n         default Builder uri(URI uri) {\n             return this.protocol(uri.getScheme())\n-                       .host(uri.getHost())\n-                       .port(uri.getPort())\n-                       .encodedPath(SdkHttpUtils.appendUri(uri.getRawPath(), encodedPath()));\n+                    .host(uri.getHost())\n+                    .port(uri.getPort())\n+                    .encodedPath(SdkHttpUtils.appendUri(uri.getRawPath(), encodedPath()));\n+        }\n+\n+        /**\n+         * Convenience method to set the {@link #protocol()}, {@link #host()}, {@link #port()},\n+         * {@link #encodedPath()} and keep query parameters if present from a {@link URI} object.\n+         *\n+         * @param uri URI containing protocol, host, port, path and optional query parameters.\n+         * @return This builder for method chaining.\n+         */\n+        default Builder uriWithQueryParams(URI uri) {\n+            Builder builder = this.uri(uri);\n+            if (uri.getQuery() != null) {\n+                Pattern.compile(\"\\\\s*&|%26\\\\s*\")\n+                       .splitAsStream(uri.getQuery().trim())\n+                       .map(s -> s.split(\"=|%3D\", 2))\n+                       .collect(groupingBy(a -> a[0], mapping(a -> a[1], toList())))\n+                       .forEach((paramKey, paramValues) -> paramValues\n+                           .forEach(paramValue -> this.appendUriQueryParameter(paramKey, paramValue)));", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "7dc5615dac6db69334bdbc35611dec993c7edb06"}, "originalPosition": 52}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNDE2NjAyOQ==", "bodyText": "I don't think we should including %26 here as the literal & should be the only delimiter we look for.\nCompiling a pattern each time is inefficient. Once this logic is moved into SdkHttpUtils, let's extract the pattern out into a static constant", "url": "https://github.com/aws/aws-sdk-java-v2/pull/2082#discussion_r504166029", "createdAt": "2020-10-13T18:19:53Z", "author": {"login": "dagnir"}, "path": "http-client-spi/src/main/java/software/amazon/awssdk/http/SdkHttpFullRequest.java", "diffHunk": "@@ -66,9 +71,29 @@\n         @Override\n         default Builder uri(URI uri) {\n             return this.protocol(uri.getScheme())\n-                       .host(uri.getHost())\n-                       .port(uri.getPort())\n-                       .encodedPath(SdkHttpUtils.appendUri(uri.getRawPath(), encodedPath()));\n+                    .host(uri.getHost())\n+                    .port(uri.getPort())\n+                    .encodedPath(SdkHttpUtils.appendUri(uri.getRawPath(), encodedPath()));\n+        }\n+\n+        /**\n+         * Convenience method to set the {@link #protocol()}, {@link #host()}, {@link #port()},\n+         * {@link #encodedPath()} and keep query parameters if present from a {@link URI} object.\n+         *\n+         * @param uri URI containing protocol, host, port, path and optional query parameters.\n+         * @return This builder for method chaining.\n+         */\n+        default Builder uriWithQueryParams(URI uri) {\n+            Builder builder = this.uri(uri);\n+            if (uri.getQuery() != null) {\n+                Pattern.compile(\"\\\\s*&|%26\\\\s*\")", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "7dc5615dac6db69334bdbc35611dec993c7edb06"}, "originalPosition": 47}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNDE2OTkyNw==", "bodyText": "Same here, should only splitting on the literal =.\nAlso seems like this assumes each query parameter is a name-value pair; we should support parameters that don't have a value  as well, like in https://github.com/aws/aws-sdk-java-v2/pull/2082?foo", "url": "https://github.com/aws/aws-sdk-java-v2/pull/2082#discussion_r504169927", "createdAt": "2020-10-13T18:26:53Z", "author": {"login": "dagnir"}, "path": "http-client-spi/src/main/java/software/amazon/awssdk/http/SdkHttpFullRequest.java", "diffHunk": "@@ -66,9 +71,29 @@\n         @Override\n         default Builder uri(URI uri) {\n             return this.protocol(uri.getScheme())\n-                       .host(uri.getHost())\n-                       .port(uri.getPort())\n-                       .encodedPath(SdkHttpUtils.appendUri(uri.getRawPath(), encodedPath()));\n+                    .host(uri.getHost())\n+                    .port(uri.getPort())\n+                    .encodedPath(SdkHttpUtils.appendUri(uri.getRawPath(), encodedPath()));\n+        }\n+\n+        /**\n+         * Convenience method to set the {@link #protocol()}, {@link #host()}, {@link #port()},\n+         * {@link #encodedPath()} and keep query parameters if present from a {@link URI} object.\n+         *\n+         * @param uri URI containing protocol, host, port, path and optional query parameters.\n+         * @return This builder for method chaining.\n+         */\n+        default Builder uriWithQueryParams(URI uri) {\n+            Builder builder = this.uri(uri);\n+            if (uri.getQuery() != null) {\n+                Pattern.compile(\"\\\\s*&|%26\\\\s*\")\n+                       .splitAsStream(uri.getQuery().trim())\n+                       .map(s -> s.split(\"=|%3D\", 2))", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "7dc5615dac6db69334bdbc35611dec993c7edb06"}, "originalPosition": 49}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNDE3MjUwOA==", "bodyText": "Hmm why do we need this instead of using putRawQueryParameter?", "url": "https://github.com/aws/aws-sdk-java-v2/pull/2082#discussion_r504172508", "createdAt": "2020-10-13T18:31:36Z", "author": {"login": "dagnir"}, "path": "http-client-spi/src/main/java/software/amazon/awssdk/http/SdkHttpRequest.java", "diffHunk": "@@ -337,5 +363,17 @@ default Builder putHeader(String headerName, String headerValue) {\n          * Removes all headers from this builder.\n          */\n         Builder clearHeaders();\n+\n+        /**\n+         * Add a single un-encoded URI query parameter to be included in the created HTTP request.\n+         *\n+         * <p>This will <b>ADD</b> the value to any existing values already configured with this parameter name in\n+         * the builder.</p>\n+         *\n+         * @param paramName  The name of the query parameter to add\n+         * @param paramValue The un-encoded value for the query parameter.\n+         */\n+        Builder appendUriQueryParameter(String paramName, String paramValue);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "7dc5615dac6db69334bdbc35611dec993c7edb06"}, "originalPosition": 79}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNDE3NDAzMQ==", "bodyText": "Please capitalize here to HTTP Client SPI to be consistent with the rest of the log entries", "url": "https://github.com/aws/aws-sdk-java-v2/pull/2082#discussion_r504174031", "createdAt": "2020-10-13T18:34:25Z", "author": {"login": "dagnir"}, "path": ".changes/next-release/feature-HTTPclientspi-25d1ed9.json", "diffHunk": "@@ -0,0 +1,5 @@\n+{\n+    \"category\": \"HTTP client spi\",", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "46ee998ff83f21b99b36db30dc66f3571691d942"}, "originalPosition": 2}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "ee074224f4d1d58bbfb195169fe9bddbd5cf5779", "author": {"user": {"login": "roexber", "name": null}}, "url": "https://github.com/aws/aws-sdk-java-v2/commit/ee074224f4d1d58bbfb195169fe9bddbd5cf5779", "committedDate": "2020-10-13T18:34:46Z", "message": "feature 2034: SdkHttpFullRequest builder.URI keep query parameters of provided URI if the uriWithQueryParams builder method is used"}, "afterCommit": {"oid": "3d02aef01c046ad769e1778c232997f596f343b7", "author": {"user": {"login": "roexber", "name": null}}, "url": "https://github.com/aws/aws-sdk-java-v2/commit/3d02aef01c046ad769e1778c232997f596f343b7", "committedDate": "2020-10-13T19:03:42Z", "message": "feature 2034: SdkHttpFullRequest builder.URI keep query parameters of provided URI if the uriWithQueryParams builder method is used"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "3d02aef01c046ad769e1778c232997f596f343b7", "author": {"user": {"login": "roexber", "name": null}}, "url": "https://github.com/aws/aws-sdk-java-v2/commit/3d02aef01c046ad769e1778c232997f596f343b7", "committedDate": "2020-10-13T19:03:42Z", "message": "feature 2034: SdkHttpFullRequest builder.URI keep query parameters of provided URI if the uriWithQueryParams builder method is used"}, "afterCommit": {"oid": "845d09fb2a99e24582763ae0469e6302105a8847", "author": {"user": {"login": "roexber", "name": null}}, "url": "https://github.com/aws/aws-sdk-java-v2/commit/845d09fb2a99e24582763ae0469e6302105a8847", "committedDate": "2020-10-13T19:04:46Z", "message": "feature 2034: SdkHttpFullRequest builder.URI keep query parameters of provided URI if the uriWithQueryParams builder method is used"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "845d09fb2a99e24582763ae0469e6302105a8847", "author": {"user": {"login": "roexber", "name": null}}, "url": "https://github.com/aws/aws-sdk-java-v2/commit/845d09fb2a99e24582763ae0469e6302105a8847", "committedDate": "2020-10-13T19:04:46Z", "message": "feature 2034: SdkHttpFullRequest builder.URI keep query parameters of provided URI if the uriWithQueryParams builder method is used"}, "afterCommit": {"oid": "c42de89cf225b99c86791dd243f9b9aca10682fa", "author": {"user": {"login": "roexber", "name": null}}, "url": "https://github.com/aws/aws-sdk-java-v2/commit/c42de89cf225b99c86791dd243f9b9aca10682fa", "committedDate": "2020-10-13T19:06:00Z", "message": "feature 2034: SdkHttpFullRequest builder.URI keep query parameters of provided URI if the uriWithQueryParams builder method is used"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "c42de89cf225b99c86791dd243f9b9aca10682fa", "author": {"user": {"login": "roexber", "name": null}}, "url": "https://github.com/aws/aws-sdk-java-v2/commit/c42de89cf225b99c86791dd243f9b9aca10682fa", "committedDate": "2020-10-13T19:06:00Z", "message": "feature 2034: SdkHttpFullRequest builder.URI keep query parameters of provided URI if the uriWithQueryParams builder method is used"}, "afterCommit": {"oid": "f0d18f9e19130d49e3e8d77c41623d4ec3e53c2d", "author": {"user": {"login": "roexber", "name": null}}, "url": "https://github.com/aws/aws-sdk-java-v2/commit/f0d18f9e19130d49e3e8d77c41623d4ec3e53c2d", "committedDate": "2020-10-13T19:09:06Z", "message": "feature 2034: SdkHttpFullRequest builder.URI keep query parameters of provided URI if the uriWithQueryParams builder method is used"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTA3NzUzOTI4", "url": "https://github.com/aws/aws-sdk-java-v2/pull/2082#pullrequestreview-507753928", "createdAt": "2020-10-13T19:17:45Z", "commit": {"oid": "f0d18f9e19130d49e3e8d77c41623d4ec3e53c2d"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xM1QxOToxNzo0NlrOHg1yAQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xM1QxOToxNzo0NlrOHg1yAQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNDE5NzYzMw==", "bodyText": "BTW, I think we should be looking at getRawQuery() here, since getQuery() will give you the decoded form which is not what we want", "url": "https://github.com/aws/aws-sdk-java-v2/pull/2082#discussion_r504197633", "createdAt": "2020-10-13T19:17:46Z", "author": {"login": "dagnir"}, "path": "utils/src/main/java/software/amazon/awssdk/utils/http/SdkHttpUtils.java", "diffHunk": "@@ -322,4 +328,15 @@ public static String appendUri(String baseUri, String path) {\n     public static boolean isSingleHeader(String h) {\n         return SINGLE_HEADERS.contains(StringUtils.lowerCase(h));\n     }\n+\n+    /**\n+     * Extracts query parameters from the given URI\n+     */\n+    public static Map<String, List<String>> uriParams(URI uri) {\n+        return Pattern.compile(QUERY_PARAM_PATTERN)\n+               .splitAsStream(uri.getQuery().trim())", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f0d18f9e19130d49e3e8d77c41623d4ec3e53c2d"}, "originalPosition": 37}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTA3NzU5MTc4", "url": "https://github.com/aws/aws-sdk-java-v2/pull/2082#pullrequestreview-507759178", "createdAt": "2020-10-13T19:25:46Z", "commit": {"oid": "f0d18f9e19130d49e3e8d77c41623d4ec3e53c2d"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xM1QxOToyNTo0NlrOHg2Dhw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xM1QxOToyNTo0NlrOHg2Dhw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNDIwMjExOQ==", "bodyText": "I don't think this assertion is correct per my comment earlier re: parsing.\nSplitting reqParam=1234&oParam=3456%26reqParam%3D5678 on the & delimiter should give reqParam=1234 and oParam=3456%26reqParam%3D5678 as the two name-value pairs, then parsing each as a pair gives [reqParam, 1234] and [oParam, 3456%26reqParam%3D5678]", "url": "https://github.com/aws/aws-sdk-java-v2/pull/2082#discussion_r504202119", "createdAt": "2020-10-13T19:25:46Z", "author": {"login": "dagnir"}, "path": "http-client-spi/src/test/java/software/amazon/awssdk/http/SdkHttpRequestResponseTest.java", "diffHunk": "@@ -401,13 +402,41 @@ public BuilderProxy setMap(Map<String, List<String>> map) {\n         });\n     }\n \n+    @Test\n+    public void testSdkHttpFullRequestBuilderNoQueryParams() throws URISyntaxException {\n+        URI uri = new URI(\"https://github.com/aws/aws-sdk-java-v2/issues/2034\");\n+        final SdkHttpFullRequest sdkHttpFullRequest = SdkHttpFullRequest.builder().method(SdkHttpMethod.POST).uri(uri).build();\n+        assertThat(sdkHttpFullRequest.getUri().getQuery()).isNullOrEmpty();\n+    }\n+\n+    @Test\n+    public void testSdkHttpFullRequestBuilderDoNotKeepUriRequestParameters() throws URISyntaxException {\n+        URI uri = new URI(\"https://github.com/aws/aws-sdk-java-v2/issues/2034?reqParam=1234&oParam=3456&reqParam=5678\");\n+        final SdkHttpFullRequest sdkHttpFullRequest = SdkHttpFullRequest.builder().method(SdkHttpMethod.POST).uri(uri).build();\n+        assertThat(sdkHttpFullRequest.getUri().getQuery()).isNullOrEmpty();\n+    }\n+\n+    @Test\n+    public void testSdkHttpFullRequestBuilderUriWithQueryParams() throws URISyntaxException {\n+        URI uri = new URI(\"https://github.com/aws/aws-sdk-java-v2/issues/2034?reqParam=1234&oParam=3456%26reqParam%3D5678\");\n+        final SdkHttpFullRequest sdkHttpFullRequest =\n+            SdkHttpFullRequest.builder().method(SdkHttpMethod.POST).uriWithQueryParams(uri).build();\n+        assertThat(sdkHttpFullRequest.getUri().getQuery()).contains(\"reqParam=1234\", \"oParam=3456\", \"reqParam=5678\");", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f0d18f9e19130d49e3e8d77c41623d4ec3e53c2d"}, "originalPosition": 35}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTA3NzgxNTc0", "url": "https://github.com/aws/aws-sdk-java-v2/pull/2082#pullrequestreview-507781574", "createdAt": "2020-10-13T19:58:30Z", "commit": {"oid": "f0d18f9e19130d49e3e8d77c41623d4ec3e53c2d"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xM1QxOTo1ODozMFrOHg3Ilw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xM1QxOTo1ODozMFrOHg3Ilw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNDIxOTc5OQ==", "bodyText": "We should just fail instead of logging a warning here", "url": "https://github.com/aws/aws-sdk-java-v2/pull/2082#discussion_r504219799", "createdAt": "2020-10-13T19:58:30Z", "author": {"login": "dagnir"}, "path": "http-client-spi/src/main/java/software/amazon/awssdk/http/DefaultSdkHttpFullRequest.java", "diffHunk": "@@ -349,6 +368,19 @@ private void copyHeadersIfNeeded() {\n             }\n         }\n \n+        @Override\n+        public SdkHttpFullRequest.Builder appendUriQueryParameter(String paramName, String paramValue) {\n+            try {\n+                this.uriQueryParameters.computeIfAbsent(paramName, k -> new ArrayList<>())\n+                                       .add(URLDecoder.decode(paramValue, StandardCharsets.UTF_8.toString()));\n+            } catch (UnsupportedEncodingException e) {\n+                log.warn(\"Could not decode {}={} using {}\", paramName, paramValue, StandardCharsets.UTF_8);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f0d18f9e19130d49e3e8d77c41623d4ec3e53c2d"}, "originalPosition": 89}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "f0d18f9e19130d49e3e8d77c41623d4ec3e53c2d", "author": {"user": {"login": "roexber", "name": null}}, "url": "https://github.com/aws/aws-sdk-java-v2/commit/f0d18f9e19130d49e3e8d77c41623d4ec3e53c2d", "committedDate": "2020-10-13T19:09:06Z", "message": "feature 2034: SdkHttpFullRequest builder.URI keep query parameters of provided URI if the uriWithQueryParams builder method is used"}, "afterCommit": {"oid": "4f8f009ff380003adc3badaa870e50956e55addf", "author": {"user": {"login": "roexber", "name": null}}, "url": "https://github.com/aws/aws-sdk-java-v2/commit/4f8f009ff380003adc3badaa870e50956e55addf", "committedDate": "2020-10-14T19:20:06Z", "message": "feature 2034: SdkHttpFullRequest builder.URI keep query parameters of provided URI if the uriWithQueryParams builder method is used"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "4f8f009ff380003adc3badaa870e50956e55addf", "author": {"user": {"login": "roexber", "name": null}}, "url": "https://github.com/aws/aws-sdk-java-v2/commit/4f8f009ff380003adc3badaa870e50956e55addf", "committedDate": "2020-10-14T19:20:06Z", "message": "feature 2034: SdkHttpFullRequest builder.URI keep query parameters of provided URI if the uriWithQueryParams builder method is used"}, "afterCommit": {"oid": "09f557d3c7cb368df19f51a0182a6904fe31d52e", "author": {"user": {"login": "roexber", "name": null}}, "url": "https://github.com/aws/aws-sdk-java-v2/commit/09f557d3c7cb368df19f51a0182a6904fe31d52e", "committedDate": "2020-10-14T19:36:45Z", "message": "feature 2034: SdkHttpFullRequest builder.uri keep query parameters of provided URI"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "09f557d3c7cb368df19f51a0182a6904fe31d52e", "author": {"user": {"login": "roexber", "name": null}}, "url": "https://github.com/aws/aws-sdk-java-v2/commit/09f557d3c7cb368df19f51a0182a6904fe31d52e", "committedDate": "2020-10-14T19:36:45Z", "message": "feature 2034: SdkHttpFullRequest builder.uri keep query parameters of provided URI"}, "afterCommit": {"oid": "4cd0e2d17bdc3487900e5aebcbe775e7fb11dfc5", "author": {"user": {"login": "roexber", "name": null}}, "url": "https://github.com/aws/aws-sdk-java-v2/commit/4cd0e2d17bdc3487900e5aebcbe775e7fb11dfc5", "committedDate": "2020-10-14T19:38:45Z", "message": "feature 2034: SdkHttpFullRequest builder.uri keep query parameters of provided URI"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "4cd0e2d17bdc3487900e5aebcbe775e7fb11dfc5", "author": {"user": {"login": "roexber", "name": null}}, "url": "https://github.com/aws/aws-sdk-java-v2/commit/4cd0e2d17bdc3487900e5aebcbe775e7fb11dfc5", "committedDate": "2020-10-14T19:38:45Z", "message": "feature 2034: SdkHttpFullRequest builder.uri keep query parameters of provided URI"}, "afterCommit": {"oid": "a5f5dad44a93461b61e7f63e2c8b3a9b17b97136", "author": {"user": {"login": "roexber", "name": null}}, "url": "https://github.com/aws/aws-sdk-java-v2/commit/a5f5dad44a93461b61e7f63e2c8b3a9b17b97136", "committedDate": "2020-10-14T19:41:14Z", "message": "feature 2034: SdkHttpFullRequest builder.uri keep query parameters of provided URI"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTA4NzEzNzk0", "url": "https://github.com/aws/aws-sdk-java-v2/pull/2082#pullrequestreview-508713794", "createdAt": "2020-10-14T20:44:11Z", "commit": {"oid": "a5f5dad44a93461b61e7f63e2c8b3a9b17b97136"}, "state": "COMMENTED", "comments": {"totalCount": 6, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xNFQyMDo0NDoxMVrOHhkXEA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xNFQyMToyMzowN1rOHhlieg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNDk2MDc4NA==", "bodyText": "The result of Pattern.compile() itself should be reused, so we don't need to call compile() each time.\nprivate static final Pattern QUERY_PARAM_PATTERN = ...\nSame for split() below since it also uses regex compile under the hood", "url": "https://github.com/aws/aws-sdk-java-v2/pull/2082#discussion_r504960784", "createdAt": "2020-10-14T20:44:11Z", "author": {"login": "dagnir"}, "path": "utils/src/main/java/software/amazon/awssdk/utils/http/SdkHttpUtils.java", "diffHunk": "@@ -322,4 +328,15 @@ public static String appendUri(String baseUri, String path) {\n     public static boolean isSingleHeader(String h) {\n         return SINGLE_HEADERS.contains(StringUtils.lowerCase(h));\n     }\n+\n+    /**\n+     * Extracts query parameters from the given URI\n+     */\n+    public static Map<String, List<String>> uriParams(URI uri) {\n+        return Pattern.compile(QUERY_PARAM_PATTERN)", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "a5f5dad44a93461b61e7f63e2c8b3a9b17b97136"}, "originalPosition": 36}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNDk3MzQ1Mw==", "bodyText": "The existing set of query parameters set on the builder should be cleared first", "url": "https://github.com/aws/aws-sdk-java-v2/pull/2082#discussion_r504973453", "createdAt": "2020-10-14T21:09:05Z", "author": {"login": "dagnir"}, "path": "http-client-spi/src/main/java/software/amazon/awssdk/http/SdkHttpRequest.java", "diffHunk": "@@ -134,18 +134,24 @@ default URI getUri() {\n      * {@link SdkHttpFullRequest#builder()}.\n      */\n     interface Builder extends CopyableBuilder<Builder, SdkHttpRequest> {\n+\n         /**\n-         * Convenience method to set the {@link #protocol()}, {@link #host()}, {@link #port()}, and\n-         * {@link #encodedPath()} from a {@link URI} object.\n+         * Convenience method to set the {@link #protocol()}, {@link #host()}, {@link #port()},\n+         * {@link #encodedPath()} and extracts query parameters from a {@link URI} object.\n          *\n          * @param uri URI containing protocol, host, port and path.\n          * @return This builder for method chaining.\n          */\n         default Builder uri(URI uri) {\n-            return this.protocol(uri.getScheme())\n+            Builder builder = this.protocol(uri.getScheme())\n                        .host(uri.getHost())\n                        .port(uri.getPort())\n                        .encodedPath(SdkHttpUtils.appendUri(uri.getRawPath(), encodedPath()));\n+            if (uri.getRawQuery() != null) {\n+                SdkHttpUtils.uriParams(uri)\n+                            .forEach(this::putRawQueryParameter);\n+            }\n+            return builder;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "a5f5dad44a93461b61e7f63e2c8b3a9b17b97136"}, "originalPosition": 24}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNDk3MzY2NQ==", "bodyText": "Same here, the existing set of query parameters set on the builder should be cleared first", "url": "https://github.com/aws/aws-sdk-java-v2/pull/2082#discussion_r504973665", "createdAt": "2020-10-14T21:09:31Z", "author": {"login": "dagnir"}, "path": "http-client-spi/src/main/java/software/amazon/awssdk/http/SdkHttpFullRequest.java", "diffHunk": "@@ -56,19 +56,25 @@\n      * {@link SdkHttpFullRequest#builder()}.\n      */\n     interface Builder extends SdkHttpRequest.Builder {\n+\n         /**\n-         * Convenience method to set the {@link #protocol()}, {@link #host()}, {@link #port()}, and\n-         * {@link #encodedPath()} from a {@link URI} object.\n+         * Convenience method to set the {@link #protocol()}, {@link #host()}, {@link #port()},\n+         * {@link #encodedPath()} and extracts query parameters from a {@link URI} object.\n          *\n          * @param uri URI containing protocol, host, port and path.\n          * @return This builder for method chaining.\n          */\n         @Override\n         default Builder uri(URI uri) {\n-            return this.protocol(uri.getScheme())\n+            Builder builder =  this.protocol(uri.getScheme())\n                        .host(uri.getHost())\n                        .port(uri.getPort())\n                        .encodedPath(SdkHttpUtils.appendUri(uri.getRawPath(), encodedPath()));\n+            if (uri.getRawQuery() != null) {\n+                SdkHttpUtils.uriParams(uri)\n+                            .forEach(this::putRawQueryParameter);\n+            }\n+            return builder;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "a5f5dad44a93461b61e7f63e2c8b3a9b17b97136"}, "originalPosition": 25}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNDk3NjIxOA==", "bodyText": "We should have tests for the two requests classes that we changed as well.", "url": "https://github.com/aws/aws-sdk-java-v2/pull/2082#discussion_r504976218", "createdAt": "2020-10-14T21:15:03Z", "author": {"login": "dagnir"}, "path": "utils/src/test/java/software/amazon/awssdk/utils/SdkHttpUtilsTest.java", "diffHunk": "@@ -173,4 +178,16 @@ public void headersFromCollectionWorksCorrectly() {\n         assertThat(SdkHttpUtils.firstMatchingHeaderFromCollection(headers, asList(\"foo\", \"nothing\"))).hasValue(\"bar\");\n         assertThat(SdkHttpUtils.firstMatchingHeaderFromCollection(headers, asList(\"foo\", \"other\"))).hasValue(\"foo\");\n     }\n+\n+    @Test\n+    public void uriParams() throws URISyntaxException {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "a5f5dad44a93461b61e7f63e2c8b3a9b17b97136"}, "originalPosition": 19}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNDk3OTc4Ng==", "bodyText": "Hmm I don't think using an empty string when there's no = is what we want; we should be setting null if there's no = for the parameter. There should be a test for the result of something like this is\nURI myUri = URI.create(\"https://github.com/aws/aws-sdk-for-java-v2?foo\");\n\nSdkHttpFullRequest request = SdkHttpFullRequest.builder().uri(myUri).build();\n\nrequest.getUri();\n\nto make sure that the result is not https://github.com/aws/aws-sdk-for-java-v2?foo=, which will likely be interpreted differently by the server", "url": "https://github.com/aws/aws-sdk-java-v2/pull/2082#discussion_r504979786", "createdAt": "2020-10-14T21:22:27Z", "author": {"login": "dagnir"}, "path": "utils/src/main/java/software/amazon/awssdk/utils/http/SdkHttpUtils.java", "diffHunk": "@@ -322,4 +328,15 @@ public static String appendUri(String baseUri, String path) {\n     public static boolean isSingleHeader(String h) {\n         return SINGLE_HEADERS.contains(StringUtils.lowerCase(h));\n     }\n+\n+    /**\n+     * Extracts query parameters from the given URI\n+     */\n+    public static Map<String, List<String>> uriParams(URI uri) {\n+        return Pattern.compile(QUERY_PARAM_PATTERN)\n+               .splitAsStream(uri.getRawQuery().trim())\n+               .map(s -> s.contains(\"=\") ? s.split(\"=\", 2) : new String[] {s, \"\"})", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "a5f5dad44a93461b61e7f63e2c8b3a9b17b97136"}, "originalPosition": 38}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNDk4MDA5MA==", "bodyText": "As mentioned above, the value for noval should be null, not a list containing \"\".", "url": "https://github.com/aws/aws-sdk-java-v2/pull/2082#discussion_r504980090", "createdAt": "2020-10-14T21:23:07Z", "author": {"login": "dagnir"}, "path": "utils/src/test/java/software/amazon/awssdk/utils/SdkHttpUtilsTest.java", "diffHunk": "@@ -173,4 +178,16 @@ public void headersFromCollectionWorksCorrectly() {\n         assertThat(SdkHttpUtils.firstMatchingHeaderFromCollection(headers, asList(\"foo\", \"nothing\"))).hasValue(\"bar\");\n         assertThat(SdkHttpUtils.firstMatchingHeaderFromCollection(headers, asList(\"foo\", \"other\"))).hasValue(\"foo\");\n     }\n+\n+    @Test\n+    public void uriParams() throws URISyntaxException {\n+        URI uri = new URI(\"https://github.com/aws/aws-sdk-java-v2/issues/2034?reqParam=1234&oParam=3456&reqParam=5678&noval\"\n+                          + \"&decoded%26Part=equals%3Dval\");\n+        Map<String, List<String>> uriParams = SdkHttpUtils.uriParams(uri);\n+        assertThat(uriParams).contains(entry(\"reqParam\", Arrays.asList(\"1234\", \"5678\")),\n+                                       entry(\"oParam\", Collections.singletonList(\"3456\")),\n+                                       entry(\"noval\", Arrays.asList(\"\")),", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "a5f5dad44a93461b61e7f63e2c8b3a9b17b97136"}, "originalPosition": 25}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "a5f5dad44a93461b61e7f63e2c8b3a9b17b97136", "author": {"user": {"login": "roexber", "name": null}}, "url": "https://github.com/aws/aws-sdk-java-v2/commit/a5f5dad44a93461b61e7f63e2c8b3a9b17b97136", "committedDate": "2020-10-14T19:41:14Z", "message": "feature 2034: SdkHttpFullRequest builder.uri keep query parameters of provided URI"}, "afterCommit": {"oid": "8ef3f779f0c2e559bc66714d5d4620be0ed385cf", "author": {"user": {"login": "roexber", "name": null}}, "url": "https://github.com/aws/aws-sdk-java-v2/commit/8ef3f779f0c2e559bc66714d5d4620be0ed385cf", "committedDate": "2020-10-15T19:14:26Z", "message": "feature 2034: SdkHttpFullRequest builder.uri keep query parameters of provided URI"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTA5ODE0MzY4", "url": "https://github.com/aws/aws-sdk-java-v2/pull/2082#pullrequestreview-509814368", "createdAt": "2020-10-15T21:14:39Z", "commit": {"oid": "8ef3f779f0c2e559bc66714d5d4620be0ed385cf"}, "state": "COMMENTED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c91e7709c77f48cf7098fb5c732bc04547d785b2", "author": {"user": {"login": "roexber", "name": null}}, "url": "https://github.com/aws/aws-sdk-java-v2/commit/c91e7709c77f48cf7098fb5c732bc04547d785b2", "committedDate": "2020-10-16T08:37:38Z", "message": "feature 2034: SdkHttpFullRequest builder.uri keep query parameters of provided URI"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "819cd777b5f45833238aac6f54d89f34802aec8b", "author": {"user": {"login": "dagnir", "name": "Dongie Agnir"}}, "url": "https://github.com/aws/aws-sdk-java-v2/commit/819cd777b5f45833238aac6f54d89f34802aec8b", "committedDate": "2020-10-15T23:52:38Z", "message": "Merge branch 'master' into httpclientspi-uri-with-query-params"}, "afterCommit": {"oid": "c91e7709c77f48cf7098fb5c732bc04547d785b2", "author": {"user": {"login": "roexber", "name": null}}, "url": "https://github.com/aws/aws-sdk-java-v2/commit/c91e7709c77f48cf7098fb5c732bc04547d785b2", "committedDate": "2020-10-16T08:37:38Z", "message": "feature 2034: SdkHttpFullRequest builder.uri keep query parameters of provided URI"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTEwNjc4OTIy", "url": "https://github.com/aws/aws-sdk-java-v2/pull/2082#pullrequestreview-510678922", "createdAt": "2020-10-16T17:41:27Z", "commit": {"oid": "c91e7709c77f48cf7098fb5c732bc04547d785b2"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "54154d932d91a5fc1939b0b216362cd6d7c26d87", "author": {"user": {"login": "dagnir", "name": "Dongie Agnir"}}, "url": "https://github.com/aws/aws-sdk-java-v2/commit/54154d932d91a5fc1939b0b216362cd6d7c26d87", "committedDate": "2020-10-16T17:46:32Z", "message": "Merge branch 'master' into httpclientspi-uri-with-query-params"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "90d714319d63bd38bbb6b9fdcba23060e23bfab4", "author": {"user": {"login": "dagnir", "name": "Dongie Agnir"}}, "url": "https://github.com/aws/aws-sdk-java-v2/commit/90d714319d63bd38bbb6b9fdcba23060e23bfab4", "committedDate": "2020-10-16T19:59:32Z", "message": "Merge branch 'master' into httpclientspi-uri-with-query-params"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2362, "cost": 1, "resetAt": "2021-11-01T11:59:11Z"}}}