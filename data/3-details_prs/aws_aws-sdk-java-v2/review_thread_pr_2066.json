{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDkzNDA5NDc2", "number": 2066, "reviewThreads": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yNVQyMjo1MTo1NlrOEnpDFg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yNVQyMzowMToyMFrOEnpQyA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzEwMDAyNDU0OnYy", "diffSide": "RIGHT", "path": "codegen/src/main/resources/software/amazon/awssdk/codegen/waiters/WaitersRuntime.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yNVQyMjo1MTo1NlrOHYWfTQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yNVQyMjo1MTo1NlrOHYWfTQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NTI5NjMzMw==", "bodyText": "Just return the value of the expression", "url": "https://github.com/aws/aws-sdk-java-v2/pull/2066#discussion_r495296333", "createdAt": "2020-09-25T22:51:56Z", "author": {"login": "dagnir"}, "path": "codegen/src/main/resources/software/amazon/awssdk/codegen/waiters/WaitersRuntime.java", "diffHunk": "@@ -502,7 +492,11 @@ public WaiterState waiterState() {\n \n         @Override\n         public boolean matches(SdkResponse response) {\n-            return response.sdkHttpResponse().statusCode() == statusCode;\n+            if (response.sdkHttpResponse() != null &&\n+                response.sdkHttpResponse().statusCode() == statusCode) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "fb5c896df67f33b59ccff992e9787bce2afd35fd"}, "originalPosition": 25}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzEwMDAyNzM5OnYy", "diffSide": "RIGHT", "path": "codegen/src/main/resources/software/amazon/awssdk/codegen/waiters/WaitersRuntime.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yNVQyMjo1Mjo0NlrOHYWhLw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yNVQyMjo1Mjo0NlrOHYWhLw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NTI5NjgxNQ==", "bodyText": "probably more appropriate to use Collections.singletonList", "url": "https://github.com/aws/aws-sdk-java-v2/pull/2066#discussion_r495296815", "createdAt": "2020-09-25T22:52:46Z", "author": {"login": "dagnir"}, "path": "codegen/src/main/resources/software/amazon/awssdk/codegen/waiters/WaitersRuntime.java", "diffHunk": "@@ -33,17 +33,7 @@ private WaitersRuntime() {\n     }\n \n     private static List<WaiterAcceptor<Object>> defaultAcceptors() {\n-        return Arrays.asList(throwOnUnmatchedExceptionWaiter(), retryOnUnmatchedResponseWaiter());\n-    }\n-\n-    private static WaiterAcceptor<Object> throwOnUnmatchedExceptionWaiter() {\n-        return WaiterAcceptor.errorOnExceptionAcceptor(t -> {\n-            if (t instanceof RuntimeException) {\n-                throw (RuntimeException) t;\n-            }\n-\n-            throw SdkClientException.create(\"Encountered unexpected exception.\", t);\n-        });\n+        return Arrays.asList(retryOnUnmatchedResponseWaiter());", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "fb5c896df67f33b59ccff992e9787bce2afd35fd"}, "originalPosition": 15}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzEwMDA1OTYwOnYy", "diffSide": "RIGHT", "path": "codegen/src/test/resources/software/amazon/awssdk/codegen/poet/waiters/query-sync-waiter-class.java", "isResolved": true, "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yNVQyMzowMToyMFrOHYW1qg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yNVQyMzozMzo1NlrOHYX0kQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NTMwMjA1OA==", "bodyText": "Is it possible to just overload the Waiter run() method to take an the override instead? That way the existing waiter can be reused without instantiating a new one when a override is given. Would also simplify codegen", "url": "https://github.com/aws/aws-sdk-java-v2/pull/2066#discussion_r495302058", "createdAt": "2020-09-25T23:01:20Z", "author": {"login": "dagnir"}, "path": "codegen/src/test/resources/software/amazon/awssdk/codegen/poet/waiters/query-sync-waiter-class.java", "diffHunk": "@@ -66,6 +66,15 @@ private static String errorCode(Throwable error) {\n         return postOperationSuccessWaiter.run(() -> client.aPostOperation(applyWaitersUserAgent(aPostOperationRequest)));\n     }\n \n+    @Override\n+    public WaiterResponse<APostOperationResponse> waitUntilPostOperationSuccess(APostOperationRequest aPostOperationRequest,\n+                                                                                WaiterOverrideConfiguration overrideConfig) {\n+        Waiter<APostOperationResponse> waiter = Waiter.builder(APostOperationResponse.class)\n+                                                      .acceptors(postOperationSuccessWaiterAcceptors())\n+                                                      .overrideConfiguration(postOperationSuccessWaiterConfig(overrideConfig)).build();\n+        return waiter.run(() -> client.aPostOperation(applyWaitersUserAgent(aPostOperationRequest)));", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "fb5c896df67f33b59ccff992e9787bce2afd35fd"}, "originalPosition": 40}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NTMxMDg3Ng==", "bodyText": "Instantiating a new waiter is actually very cheap, but I do like your idea. Well, too bad I already made the codegen change :( Anyway, I'll update it", "url": "https://github.com/aws/aws-sdk-java-v2/pull/2066#discussion_r495310876", "createdAt": "2020-09-25T23:16:34Z", "author": {"login": "zoewangg"}, "path": "codegen/src/test/resources/software/amazon/awssdk/codegen/poet/waiters/query-sync-waiter-class.java", "diffHunk": "@@ -66,6 +66,15 @@ private static String errorCode(Throwable error) {\n         return postOperationSuccessWaiter.run(() -> client.aPostOperation(applyWaitersUserAgent(aPostOperationRequest)));\n     }\n \n+    @Override\n+    public WaiterResponse<APostOperationResponse> waitUntilPostOperationSuccess(APostOperationRequest aPostOperationRequest,\n+                                                                                WaiterOverrideConfiguration overrideConfig) {\n+        Waiter<APostOperationResponse> waiter = Waiter.builder(APostOperationResponse.class)\n+                                                      .acceptors(postOperationSuccessWaiterAcceptors())\n+                                                      .overrideConfiguration(postOperationSuccessWaiterConfig(overrideConfig)).build();\n+        return waiter.run(() -> client.aPostOperation(applyWaitersUserAgent(aPostOperationRequest)));", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NTMwMjA1OA=="}, "originalCommit": {"oid": "fb5c896df67f33b59ccff992e9787bce2afd35fd"}, "originalPosition": 40}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NTMxODE2MQ==", "bodyText": "But hopefully less code to maintain :). Also customers using the generic Waiter directly would benefit as well", "url": "https://github.com/aws/aws-sdk-java-v2/pull/2066#discussion_r495318161", "createdAt": "2020-09-25T23:33:56Z", "author": {"login": "dagnir"}, "path": "codegen/src/test/resources/software/amazon/awssdk/codegen/poet/waiters/query-sync-waiter-class.java", "diffHunk": "@@ -66,6 +66,15 @@ private static String errorCode(Throwable error) {\n         return postOperationSuccessWaiter.run(() -> client.aPostOperation(applyWaitersUserAgent(aPostOperationRequest)));\n     }\n \n+    @Override\n+    public WaiterResponse<APostOperationResponse> waitUntilPostOperationSuccess(APostOperationRequest aPostOperationRequest,\n+                                                                                WaiterOverrideConfiguration overrideConfig) {\n+        Waiter<APostOperationResponse> waiter = Waiter.builder(APostOperationResponse.class)\n+                                                      .acceptors(postOperationSuccessWaiterAcceptors())\n+                                                      .overrideConfiguration(postOperationSuccessWaiterConfig(overrideConfig)).build();\n+        return waiter.run(() -> client.aPostOperation(applyWaitersUserAgent(aPostOperationRequest)));", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NTMwMjA1OA=="}, "originalCommit": {"oid": "fb5c896df67f33b59ccff992e9787bce2afd35fd"}, "originalPosition": 40}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4060, "cost": 1, "resetAt": "2021-11-12T11:18:39Z"}}}