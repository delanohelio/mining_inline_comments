{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0MzY5NzczNjcz", "number": 1629, "title": "Fixed an issue with Transcribe Streaming's startStreamingTranscription API that could cause signature mismatch exceptions.", "bodyText": "Because of netty/netty#7783, writes performed by the event-loop thread can 'skip ahead' of writes performed off of the event-loop thread. This can cause events to be sent to Transcribe out-of-order, if some are performed on the event loop. This manifests as a signature mismatch exception because the signature of the last message is included in the signature.\nThis change introduces a ChannelHandlerContext implementation that makes sure we're off of the event loop before performing a write. If we're on the event loop, it schedules a task for the write to be performed instead of performing the task immediately.\nThis change isn't finalized yet, and still requires additional testing.", "createdAt": "2020-01-31T21:14:22Z", "url": "https://github.com/aws/aws-sdk-java-v2/pull/1629", "merged": true, "mergeCommit": {"oid": "cda975a7d4315e2a336115307f14cf56f95e61d8"}, "closed": true, "closedAt": "2020-02-07T18:31:59Z", "author": {"login": "millems"}, "timelineItems": {"totalCount": 14, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcA2yFuABqjMwMDQzMzY1MDk=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcCDc7zgH2gAyMzY5NzczNjczOmZkYWUwNmNjMWFiOWRhZDg4ZmU3NmVmOWRlMGEyMmVjZDFlOWY1MWQ=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "0ec5c16a32de363924fe8e3eb9fe1248fe5029c2", "author": {"user": {"login": "millems", "name": "Matthew Miller"}}, "url": "https://github.com/aws/aws-sdk-java-v2/commit/0ec5c16a32de363924fe8e3eb9fe1248fe5029c2", "committedDate": "2020-01-31T21:06:41Z", "message": "[Discussion] Fixed an issue with Transcribe Streaming's startStreamingTranscription API that could cause signature mismatch exceptions.\n\nBecause of https://github.com/netty/netty/issues/7783, writes performed by the event-loop thread can 'skip ahead' of writes\nperformed off of the event-loop thread. This can cause events to be sent to Transcribe out-of-order, if some are performed\non the event loop. This manifests as a signature mismatch exception because the signature of the last message is included in\nthe signature.\n\nThis change introduces a ChannelHandlerContext implementation that makes sure we're off of the event loop before performing a\nwrite. If we're on the event loop, it schedules a task for the write to be performed instead of performing the task immediately.\n\nThis change isn't finalized yet, and still requires additional testing."}, "afterCommit": {"oid": "642dc518b0dbe28d62d31d8bbcccf7cafb19371f", "author": {"user": {"login": "millems", "name": "Matthew Miller"}}, "url": "https://github.com/aws/aws-sdk-java-v2/commit/642dc518b0dbe28d62d31d8bbcccf7cafb19371f", "committedDate": "2020-02-04T00:54:47Z", "message": "[Discussion] Fixed an issue with Transcribe Streaming's startStreamingTranscription API that could cause signature mismatch exceptions.\n\nBecause of https://github.com/netty/netty/issues/7783, writes performed by the event-loop thread can 'skip ahead' of writes\nperformed off of the event-loop thread. This can cause events to be sent to Transcribe out-of-order, if some are performed\non the event loop. This manifests as a signature mismatch exception because the signature of the last message is included in\nthe signature.\n\nThis change introduces a ChannelHandlerContext implementation that makes sure we're off of the event loop before performing a\nwrite. If we're on the event loop, it schedules a task for the write to be performed instead of performing the task immediately.\n\nThis change isn't finalized yet, and still requires additional testing."}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "61797a5a871032d44a25c83995212728e467a0f0", "author": {"user": {"login": "millems", "name": "Matthew Miller"}}, "url": "https://github.com/aws/aws-sdk-java-v2/commit/61797a5a871032d44a25c83995212728e467a0f0", "committedDate": "2020-02-04T00:58:20Z", "message": "Merge branch 'master' into millem/fix-signature-errors"}, "afterCommit": {"oid": "88e8287d46fef350e27bc27f8e1a585afb5b3a8f", "author": {"user": {"login": "millems", "name": "Matthew Miller"}}, "url": "https://github.com/aws/aws-sdk-java-v2/commit/88e8287d46fef350e27bc27f8e1a585afb5b3a8f", "committedDate": "2020-02-04T00:58:31Z", "message": "Fixed an issue with Transcribe Streaming's startStreamingTranscription API that could cause signature mismatch exceptions.\n\nBecause of https://github.com/netty/netty/issues/7783, writes performed by the event-loop thread can 'skip ahead' of writes\nperformed off of the event-loop thread. This can cause events to be sent to Transcribe out-of-order, if some are performed\non the event loop. This manifests as a signature mismatch exception because the signature of the last message is included in\nthe signature.\n\nThis change introduces a ChannelHandlerContext implementation that makes sure we're off of the event loop before performing a\nwrite. If we're on the event loop, it schedules a task for the write to be performed instead of performing the task immediately.\n\nThis change isn't finalized yet, and still requires additional testing."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzUzMjU2NTQ5", "url": "https://github.com/aws/aws-sdk-java-v2/pull/1629#pullrequestreview-353256549", "createdAt": "2020-02-04T19:52:00Z", "commit": {"oid": "88e8287d46fef350e27bc27f8e1a585afb5b3a8f"}, "state": "COMMENTED", "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0wNFQxOTo1MjowMFrOFlhV4w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0wNFQyMDo1MDo0M1rOFljAMw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NDg4NzkwNw==", "bodyText": "nit: Should it be Netty NIO HTTP Client?", "url": "https://github.com/aws/aws-sdk-java-v2/pull/1629#discussion_r374887907", "createdAt": "2020-02-04T19:52:00Z", "author": {"login": "zoewangg"}, "path": ".changes/next-release/bugfix-AmazonTranscribeStreaming-6508ef9.json", "diffHunk": "@@ -0,0 +1,5 @@\n+{\n+    \"type\": \"bugfix\",\n+    \"category\": \"Amazon Transcribe Streaming\",", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "88e8287d46fef350e27bc27f8e1a585afb5b3a8f"}, "originalPosition": 3}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NDg4ODkyMQ==", "bodyText": "Should we add sdk namespace to the key?", "url": "https://github.com/aws/aws-sdk-java-v2/pull/1629#discussion_r374888921", "createdAt": "2020-02-04T19:54:09Z", "author": {"login": "zoewangg"}, "path": "http-clients/netty-nio-client/src/main/java/software/amazon/awssdk/http/nio/netty/internal/utils/OrderedWriteChannelHandlerContext.java", "diffHunk": "@@ -0,0 +1,74 @@\n+package software.amazon.awssdk.http.nio.netty.internal.utils;\n+\n+import io.netty.channel.ChannelFuture;\n+import io.netty.channel.ChannelHandlerContext;\n+import io.netty.channel.ChannelPromise;\n+import io.netty.util.AttributeKey;\n+import java.util.function.Consumer;\n+import software.amazon.awssdk.utils.Logger;\n+\n+/**\n+ * An implementation of {@link ChannelHandlerContext} that ensures all writes are performed in the order they are invoked.\n+ *\n+ * This works around https://github.com/netty/netty/issues/7783 where writes by an event loop 'skip ahead' of writes off of the\n+ * event loop.\n+ */\n+public class OrderedWriteChannelHandlerContext extends DelegatingChannelHandlerContext {\n+    private static final AttributeKey<Void> ORDERED = AttributeKey.newInstance(\"OrderedWriteChannelHandlerContext.ORDERED\");", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "88e8287d46fef350e27bc27f8e1a585afb5b3a8f"}, "originalPosition": 17}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NDkxNTEyMw==", "bodyText": "Can we add a test to verify that if the channel already has ORDER attribute, it does not wrap it again?", "url": "https://github.com/aws/aws-sdk-java-v2/pull/1629#discussion_r374915123", "createdAt": "2020-02-04T20:50:43Z", "author": {"login": "zoewangg"}, "path": "http-clients/netty-nio-client/src/main/java/software/amazon/awssdk/http/nio/netty/internal/utils/OrderedWriteChannelHandlerContext.java", "diffHunk": "@@ -0,0 +1,74 @@\n+package software.amazon.awssdk.http.nio.netty.internal.utils;\n+\n+import io.netty.channel.ChannelFuture;\n+import io.netty.channel.ChannelHandlerContext;\n+import io.netty.channel.ChannelPromise;\n+import io.netty.util.AttributeKey;\n+import java.util.function.Consumer;\n+import software.amazon.awssdk.utils.Logger;\n+\n+/**\n+ * An implementation of {@link ChannelHandlerContext} that ensures all writes are performed in the order they are invoked.\n+ *\n+ * This works around https://github.com/netty/netty/issues/7783 where writes by an event loop 'skip ahead' of writes off of the\n+ * event loop.\n+ */\n+public class OrderedWriteChannelHandlerContext extends DelegatingChannelHandlerContext {\n+    private static final AttributeKey<Void> ORDERED = AttributeKey.newInstance(\"OrderedWriteChannelHandlerContext.ORDERED\");\n+\n+    public static ChannelHandlerContext wrap(ChannelHandlerContext ctx) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "88e8287d46fef350e27bc27f8e1a585afb5b3a8f"}, "originalPosition": 19}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "6a04935aa4ab36069ec1385af131fce931feca90", "author": {"user": {"login": "millems", "name": "Matthew Miller"}}, "url": "https://github.com/aws/aws-sdk-java-v2/commit/6a04935aa4ab36069ec1385af131fce931feca90", "committedDate": "2020-02-04T23:06:41Z", "message": "Fork netty-reactive-streams with attribution and license reference."}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "88e8287d46fef350e27bc27f8e1a585afb5b3a8f", "author": {"user": {"login": "millems", "name": "Matthew Miller"}}, "url": "https://github.com/aws/aws-sdk-java-v2/commit/88e8287d46fef350e27bc27f8e1a585afb5b3a8f", "committedDate": "2020-02-04T00:58:31Z", "message": "Fixed an issue with Transcribe Streaming's startStreamingTranscription API that could cause signature mismatch exceptions.\n\nBecause of https://github.com/netty/netty/issues/7783, writes performed by the event-loop thread can 'skip ahead' of writes\nperformed off of the event-loop thread. This can cause events to be sent to Transcribe out-of-order, if some are performed\non the event loop. This manifests as a signature mismatch exception because the signature of the last message is included in\nthe signature.\n\nThis change introduces a ChannelHandlerContext implementation that makes sure we're off of the event loop before performing a\nwrite. If we're on the event loop, it schedules a task for the write to be performed instead of performing the task immediately.\n\nThis change isn't finalized yet, and still requires additional testing."}, "afterCommit": {"oid": "bbfdbdf689935ed76c1651e349b16ee9e773847a", "author": {"user": {"login": "millems", "name": "Matthew Miller"}}, "url": "https://github.com/aws/aws-sdk-java-v2/commit/bbfdbdf689935ed76c1651e349b16ee9e773847a", "committedDate": "2020-02-04T23:18:35Z", "message": "Fixed an issue with Transcribe Streaming's startStreamingTranscription API that could cause signature mismatch exceptions.\n\nBecause of https://github.com/netty/netty/issues/7783, writes performed by the event-loop thread can 'skip ahead' of writes\nperformed off of the event-loop thread. This can cause events to be sent to Transcribe out-of-order, if some are performed\non the event loop. This manifests as a signature mismatch exception because the signature of the last message is included in\nthe signature.\n\nThis change introduces a ChannelHandlerContext implementation that makes sure we're off of the event loop before performing a\nwrite. If we're on the event loop, it schedules a task for the write to be performed instead of performing the task immediately.\n\nThis change isn't finalized yet, and still requires additional testing."}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "bbfdbdf689935ed76c1651e349b16ee9e773847a", "author": {"user": {"login": "millems", "name": "Matthew Miller"}}, "url": "https://github.com/aws/aws-sdk-java-v2/commit/bbfdbdf689935ed76c1651e349b16ee9e773847a", "committedDate": "2020-02-04T23:18:35Z", "message": "Fixed an issue with Transcribe Streaming's startStreamingTranscription API that could cause signature mismatch exceptions.\n\nBecause of https://github.com/netty/netty/issues/7783, writes performed by the event-loop thread can 'skip ahead' of writes\nperformed off of the event-loop thread. This can cause events to be sent to Transcribe out-of-order, if some are performed\non the event loop. This manifests as a signature mismatch exception because the signature of the last message is included in\nthe signature.\n\nThis change introduces a ChannelHandlerContext implementation that makes sure we're off of the event loop before performing a\nwrite. If we're on the event loop, it schedules a task for the write to be performed instead of performing the task immediately.\n\nThis change isn't finalized yet, and still requires additional testing."}, "afterCommit": {"oid": "336308d77cef71cdb238b0724e303f35060ddeb7", "author": {"user": {"login": "millems", "name": "Matthew Miller"}}, "url": "https://github.com/aws/aws-sdk-java-v2/commit/336308d77cef71cdb238b0724e303f35060ddeb7", "committedDate": "2020-02-05T00:02:24Z", "message": "Fixed an issue with Transcribe Streaming's startStreamingTranscription API that could cause signature mismatch exceptions.\n\nBecause of https://github.com/netty/netty/issues/7783, writes performed by the event-loop thread can 'skip ahead' of writes\nperformed off of the event-loop thread. This can cause events to be sent to Transcribe out-of-order, if some are performed\non the event loop. This manifests as a signature mismatch exception because the signature of the last message is included in\nthe signature.\n\nThis change introduces a ChannelHandlerContext implementation that makes sure we're off of the event loop before performing a\nwrite. If we're on the event loop, it schedules a task for the write to be performed instead of performing the task immediately.\n\nThis change isn't finalized yet, and still requires additional testing."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "8ce7ac100c7414d2f9c5176d9779608c1231b68f", "author": {"user": {"login": "millems", "name": "Matthew Miller"}}, "url": "https://github.com/aws/aws-sdk-java-v2/commit/8ce7ac100c7414d2f9c5176d9779608c1231b68f", "committedDate": "2020-02-05T00:02:42Z", "message": "Fixed an issue with Transcribe Streaming's startStreamingTranscription API that could cause signature mismatch exceptions.\n\nBecause of https://github.com/netty/netty/issues/7783, writes performed by the event-loop thread can 'skip ahead' of writes\nperformed off of the event-loop thread. This can cause events to be sent to Transcribe out-of-order, if some are performed\non the event loop. This manifests as a signature mismatch exception because the signature of the last message is included in\nthe signature.\n\nThis change introduces a ChannelHandlerContext implementation that makes sure we're off of the event loop before performing a\nwrite. If we're on the event loop, it schedules a task for the write to be performed instead of performing the task immediately.\n\nThis change isn't finalized yet, and still requires additional testing."}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "336308d77cef71cdb238b0724e303f35060ddeb7", "author": {"user": {"login": "millems", "name": "Matthew Miller"}}, "url": "https://github.com/aws/aws-sdk-java-v2/commit/336308d77cef71cdb238b0724e303f35060ddeb7", "committedDate": "2020-02-05T00:02:24Z", "message": "Fixed an issue with Transcribe Streaming's startStreamingTranscription API that could cause signature mismatch exceptions.\n\nBecause of https://github.com/netty/netty/issues/7783, writes performed by the event-loop thread can 'skip ahead' of writes\nperformed off of the event-loop thread. This can cause events to be sent to Transcribe out-of-order, if some are performed\non the event loop. This manifests as a signature mismatch exception because the signature of the last message is included in\nthe signature.\n\nThis change introduces a ChannelHandlerContext implementation that makes sure we're off of the event loop before performing a\nwrite. If we're on the event loop, it schedules a task for the write to be performed instead of performing the task immediately.\n\nThis change isn't finalized yet, and still requires additional testing."}, "afterCommit": {"oid": "8ce7ac100c7414d2f9c5176d9779608c1231b68f", "author": {"user": {"login": "millems", "name": "Matthew Miller"}}, "url": "https://github.com/aws/aws-sdk-java-v2/commit/8ce7ac100c7414d2f9c5176d9779608c1231b68f", "committedDate": "2020-02-05T00:02:42Z", "message": "Fixed an issue with Transcribe Streaming's startStreamingTranscription API that could cause signature mismatch exceptions.\n\nBecause of https://github.com/netty/netty/issues/7783, writes performed by the event-loop thread can 'skip ahead' of writes\nperformed off of the event-loop thread. This can cause events to be sent to Transcribe out-of-order, if some are performed\non the event loop. This manifests as a signature mismatch exception because the signature of the last message is included in\nthe signature.\n\nThis change introduces a ChannelHandlerContext implementation that makes sure we're off of the event loop before performing a\nwrite. If we're on the event loop, it schedules a task for the write to be performed instead of performing the task immediately.\n\nThis change isn't finalized yet, and still requires additional testing."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzUzOTIwMjEy", "url": "https://github.com/aws/aws-sdk-java-v2/pull/1629#pullrequestreview-353920212", "createdAt": "2020-02-05T17:54:21Z", "commit": {"oid": "bdb0874b12e3071a89bcfae9266e3542482b461c"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "9f0d9282d1fbc4018e267393026a7dfb843d8a0c", "author": {"user": {"login": "millems", "name": "Matthew Miller"}}, "url": "https://github.com/aws/aws-sdk-java-v2/commit/9f0d9282d1fbc4018e267393026a7dfb843d8a0c", "committedDate": "2020-02-05T21:39:34Z", "message": "Add attribution notice for netty-reactive-streams."}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "bdb0874b12e3071a89bcfae9266e3542482b461c", "author": {"user": {"login": "millems", "name": "Matthew Miller"}}, "url": "https://github.com/aws/aws-sdk-java-v2/commit/bdb0874b12e3071a89bcfae9266e3542482b461c", "committedDate": "2020-02-05T00:27:41Z", "message": "Add attribution notice for netty-reactive-streams."}, "afterCommit": {"oid": "9f0d9282d1fbc4018e267393026a7dfb843d8a0c", "author": {"user": {"login": "millems", "name": "Matthew Miller"}}, "url": "https://github.com/aws/aws-sdk-java-v2/commit/9f0d9282d1fbc4018e267393026a7dfb843d8a0c", "committedDate": "2020-02-05T21:39:34Z", "message": "Add attribution notice for netty-reactive-streams."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "8ac6b44fd2238199db93d83d2c37a96b4b560163", "author": {"user": {"login": "zoewangg", "name": "Zoe Wang"}}, "url": "https://github.com/aws/aws-sdk-java-v2/commit/8ac6b44fd2238199db93d83d2c37a96b4b560163", "committedDate": "2020-02-06T22:08:22Z", "message": "Merge branch 'master' into millem/fix-signature-errors"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "00813fdba268ae5928ac7e4088db3ce8f50bc7b9", "author": {"user": {"login": "zoewangg", "name": "Zoe Wang"}}, "url": "https://github.com/aws/aws-sdk-java-v2/commit/00813fdba268ae5928ac7e4088db3ce8f50bc7b9", "committedDate": "2020-02-06T23:03:07Z", "message": "Merge branch 'master' into millem/fix-signature-errors"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "fdae06cc1ab9dad88fe76ef9de0a22ecd1e9f51d", "author": {"user": {"login": "zoewangg", "name": "Zoe Wang"}}, "url": "https://github.com/aws/aws-sdk-java-v2/commit/fdae06cc1ab9dad88fe76ef9de0a22ecd1e9f51d", "committedDate": "2020-02-07T18:15:15Z", "message": "Merge branch 'master' into millem/fix-signature-errors"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2650, "cost": 1, "resetAt": "2021-11-01T11:59:11Z"}}}