{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0MzgxNTc2NDU1", "number": 1678, "title": "Add support for maven lambda archetype", "bodyText": "Description\nAdd support for maven lambda archetype\nTesting\nAdded unit tests\nScreenshots (if appropriate)\nTypes of changes\n\n\n Bug fix (non-breaking change which fixes an issue)\n New feature (non-breaking change which adds functionality)\n\nChecklist\n\n\n\n I have read the CONTRIBUTING document\n Local run of mvn install succeeds\n My code follows the code style of this project\n My change requires a change to the Javadoc documentation\n I have updated the Javadoc documentation accordingly\n I have read the README document\n I have added tests to cover my changes\n All new and existing tests passed\n A short description of the change has been added to the CHANGELOG\n My change is to implement 1.11 parity feature and I have updated LaunchChangelog\n\nLicense\n\n\n\n\n I confirm that this pull request can be released under the Apache 2 license", "createdAt": "2020-02-28T20:16:51Z", "url": "https://github.com/aws/aws-sdk-java-v2/pull/1678", "merged": true, "mergeCommit": {"oid": "22f4fb8c153eb69c890cc69550f5f6412a2c0d2d"}, "closed": true, "closedAt": "2020-03-27T02:46:42Z", "author": {"login": "zoewangg"}, "timelineItems": {"totalCount": 16, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcI24q9gFqTM2NjY5MTAwOA==", "endCursor": "Y3Vyc29yOnYyOpPPAAABcRkqHrgBqjMxNzA0MzM0MDQ=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzY2NjkxMDA4", "url": "https://github.com/aws/aws-sdk-java-v2/pull/1678#pullrequestreview-366691008", "createdAt": "2020-02-28T21:18:05Z", "commit": {"oid": "f922a397b7d9ef87f689bd0de4a4361c7051312c"}, "state": "COMMENTED", "comments": {"totalCount": 5, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yOFQyMToxODowNVrOFwDFSg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yOFQyMTozNDowOVrOFwDdlg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NTkyNjQ3NA==", "bodyText": "How do we pin this to the most recent version?", "url": "https://github.com/aws/aws-sdk-java-v2/pull/1678#discussion_r385926474", "createdAt": "2020-02-28T21:18:05Z", "author": {"login": "bmaizels"}, "path": "archetypes/archetype-lambda/src/main/resources/archetype-resources/pom.xml", "diffHunk": "@@ -0,0 +1,110 @@\n+<?xml version=\"1.0\" encoding=\"UTF-8\"?>\n+<!--\n+  ~ Copyright Amazon.com, Inc. or its affiliates. All Rights Reserved.\n+  ~\n+  ~ Licensed under the Apache License, Version 2.0 (the \"License\").\n+  ~ You may not use this file except in compliance with the License.\n+  ~ A copy of the License is located at\n+  ~\n+  ~  http://aws.amazon.com/apache2.0\n+  ~\n+  ~ or in the \"license\" file accompanying this file. This file is distributed\n+  ~ on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either\n+  ~ express or implied. See the License for the specific language governing\n+  ~ permissions and limitations under the License.\n+  -->\n+\n+<project xmlns=\"http://maven.apache.org/POM/4.0.0\" xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\" xsi:schemaLocation=\"http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd\">\n+    <modelVersion>4.0.0</modelVersion>\n+\n+    <groupId>${groupId}</groupId>\n+    <artifactId>${artifactId}</artifactId>\n+    <version>${version}</version>\n+    <packaging>jar</packaging>\n+    <properties>\n+        <project.build.sourceEncoding>UTF-8</project.build.sourceEncoding>\n+        <maven.compiler.source>1.8</maven.compiler.source>\n+        <maven.compiler.target>1.8</maven.compiler.target>\n+        <maven.shade.plugin.version>3.1.1</maven.shade.plugin.version>\n+        <maven.compiler.plugin.version>3.6.1</maven.compiler.plugin.version>\n+        <exec-maven-plugin.version>1.6.0</exec-maven-plugin.version>\n+        <aws.java.sdk.version>2.10.66</aws.java.sdk.version>", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f922a397b7d9ef87f689bd0de4a4361c7051312c"}, "originalPosition": 31}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NTkzMTI3OQ==", "bodyText": "Maybe we want comments here so people know that they could/should tweak based on their needs (assuming we never make this parameters of the archtype)", "url": "https://github.com/aws/aws-sdk-java-v2/pull/1678#discussion_r385931279", "createdAt": "2020-02-28T21:30:18Z", "author": {"login": "bmaizels"}, "path": "archetypes/archetype-lambda/src/main/resources/archetype-resources/template.yaml", "diffHunk": "@@ -0,0 +1,11 @@\n+AWSTemplateFormatVersion: '2010-09-09'\n+Transform: AWS::Serverless-2016-10-31\n+Resources:\n+  ${handlerClassName}Function:\n+    Type: AWS::Serverless::Function\n+    Properties:\n+      Runtime: java8\n+      Handler: ${package}.${handlerClassName}::handleRequest\n+      Timeout: 60\n+      MemorySize: 512", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f922a397b7d9ef87f689bd0de4a4361c7051312c"}, "originalPosition": 10}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NTkzMTQ3Nw==", "bodyText": "Ouch. Is this the only one?", "url": "https://github.com/aws/aws-sdk-java-v2/pull/1678#discussion_r385931477", "createdAt": "2020-02-28T21:30:51Z", "author": {"login": "bmaizels"}, "path": "archetypes/archetype-lambda/src/main/resources/global.vm", "diffHunk": "@@ -0,0 +1,26 @@\n+## global variables used by the project\n+#set( $symbol_pound = '#' )\n+#set( $symbol_dollar = '$' )\n+#set( $symbol_escape = '\\' )\n+## TODO: find a better way to handle this\n+#if( $service == 'dynamodb')\n+    #set ( $service = 'dynamoDb')\n+#end", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f922a397b7d9ef87f689bd0de4a4361c7051312c"}, "originalPosition": 8}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NTkzMjMxNg==", "bodyText": "Ideally we'd have validation here, what if they typo the service?", "url": "https://github.com/aws/aws-sdk-java-v2/pull/1678#discussion_r385932316", "createdAt": "2020-02-28T21:33:06Z", "author": {"login": "bmaizels"}, "path": "archetypes/archetype-lambda/src/main/resources/META-INF/maven/archetype-metadata.xml", "diffHunk": "@@ -0,0 +1,40 @@\n+<?xml version=\"1.0\" encoding=\"UTF-8\"?>\n+<archetype-descriptor xsi:schemaLocation=\"http://maven.apache.org/plugins/maven-archetype-plugin/archetype-descriptor/1.0.0 http://maven.apache.org/xsd/archetype-descriptor-1.0.0.xsd\" name=\"zoewanglambdatesting\"\n+    xmlns=\"http://maven.apache.org/plugins/maven-archetype-plugin/archetype-descriptor/1.0.0\"\n+    xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\">\n+  <fileSets>\n+    <fileSet filtered=\"true\" packaged=\"true\" encoding=\"UTF-8\">\n+      <directory>src/main/java</directory>\n+      <includes>\n+        <include>**/*.java</include>\n+      </includes>\n+    </fileSet>\n+    <fileSet filtered=\"true\" packaged=\"true\" encoding=\"UTF-8\">\n+      <directory>src/test/java</directory>\n+      <includes>\n+        <include>**/*.java</include>\n+      </includes>\n+    </fileSet>\n+    <fileSet filtered=\"true\" encoding=\"UTF-8\">\n+      <directory/>\n+      <includes>\n+        <include>.gitignore</include>\n+        <include>template.yaml</include>\n+      </includes>\n+    </fileSet>\n+  </fileSets>\n+  <requiredProperties>\n+    <requiredProperty key=\"handlerClassName\">\n+      <defaultValue>App</defaultValue>\n+    </requiredProperty>\n+    <requiredProperty key=\"service\">\n+    </requiredProperty>", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f922a397b7d9ef87f689bd0de4a4361c7051312c"}, "originalPosition": 31}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NTkzMjY5NA==", "bodyText": "Might be worth mentioning sync vs async here", "url": "https://github.com/aws/aws-sdk-java-v2/pull/1678#discussion_r385932694", "createdAt": "2020-02-28T21:34:09Z", "author": {"login": "bmaizels"}, "path": "archetypes/archetype-lambda/README.md", "diffHunk": "@@ -0,0 +1,44 @@\n+# Maven Archetype for lambda function using AWS SDK for Java 2.x\n+\n+## Description\n+This is an Apache Maven Archetype to create a lambda function template using [AWS Java SDK 2.x][aws-java-sdk-v2]. The generated template\n+has the optimized configurations and follows the best practices to reduce start up time.\n+\n+## Usage\n+\n+You can use the following command to generate a project:\n+\n+```\n+mvn archetype:generate \\\n+  -DarchetypeGroupId=software.amazon.awssdk \\\n+  -DarchetypeArtifactId=lambda-archetypes \\\n+  -DarchetypeVersion=2.x\\\n+```\n+\n+To deploy the function, you can use [SAM CLI][sam-cli].\n+\n+```\n+sam deploy --guided\n+```\n+Please refer to [deploying lambda apps][deploying-lambda-apps] for more info.\n+\n+## Parameters\n+      \n+Parameter Name | Default Value | Description\n+---|---|---\n+`service` (required) | n/a | Specifies service client to be used in the lambda function. You can find the  eg: s3, dynamodb\n+`region` (required) | n/a | Specifies region to be set for the SDK client in the application\n+`groupId`(required) | n/a | Specifies the group ID of the project\n+`artifactId`(required) | n/a | Specifies the artifact ID of the project\n+`httpClient` | url-connection-client | Specifies which http client to be used by the SDK client, available options are `url-connection-client`, `apache-client`, `netty-nio-client`", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f922a397b7d9ef87f689bd0de4a4361c7051312c"}, "originalPosition": 33}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "f922a397b7d9ef87f689bd0de4a4361c7051312c", "author": {"user": {"login": "zoewangg", "name": "Zoe Wang"}}, "url": "https://github.com/aws/aws-sdk-java-v2/commit/f922a397b7d9ef87f689bd0de4a4361c7051312c", "committedDate": "2020-02-28T02:14:48Z", "message": "Add support for maven lambda archetype"}, "afterCommit": {"oid": "c4a10dd2b5c5fc4f34cd6d209b78b43607891717", "author": {"user": {"login": "zoewangg", "name": "Zoe Wang"}}, "url": "https://github.com/aws/aws-sdk-java-v2/commit/c4a10dd2b5c5fc4f34cd6d209b78b43607891717", "committedDate": "2020-03-24T19:49:03Z", "message": "Add tests, improve docs and other changes"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "c4a10dd2b5c5fc4f34cd6d209b78b43607891717", "author": {"user": {"login": "zoewangg", "name": "Zoe Wang"}}, "url": "https://github.com/aws/aws-sdk-java-v2/commit/c4a10dd2b5c5fc4f34cd6d209b78b43607891717", "committedDate": "2020-03-24T19:49:03Z", "message": "Add tests, improve docs and other changes"}, "afterCommit": {"oid": "e85ff6b64bae02054cc6a47ad4e2419b5d6efd9f", "author": {"user": {"login": "zoewangg", "name": "Zoe Wang"}}, "url": "https://github.com/aws/aws-sdk-java-v2/commit/e85ff6b64bae02054cc6a47ad4e2419b5d6efd9f", "committedDate": "2020-03-24T20:07:30Z", "message": "Add tests, improve docs and other changes"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "e85ff6b64bae02054cc6a47ad4e2419b5d6efd9f", "author": {"user": {"login": "zoewangg", "name": "Zoe Wang"}}, "url": "https://github.com/aws/aws-sdk-java-v2/commit/e85ff6b64bae02054cc6a47ad4e2419b5d6efd9f", "committedDate": "2020-03-24T20:07:30Z", "message": "Add tests, improve docs and other changes"}, "afterCommit": {"oid": "b272b3f3bd9785fe4bd982df9b80af028d7fa3e7", "author": {"user": {"login": "zoewangg", "name": "Zoe Wang"}}, "url": "https://github.com/aws/aws-sdk-java-v2/commit/b272b3f3bd9785fe4bd982df9b80af028d7fa3e7", "committedDate": "2020-03-24T20:24:11Z", "message": "Add tests, improve docs and other changes"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "b272b3f3bd9785fe4bd982df9b80af028d7fa3e7", "author": {"user": {"login": "zoewangg", "name": "Zoe Wang"}}, "url": "https://github.com/aws/aws-sdk-java-v2/commit/b272b3f3bd9785fe4bd982df9b80af028d7fa3e7", "committedDate": "2020-03-24T20:24:11Z", "message": "Add tests, improve docs and other changes"}, "afterCommit": {"oid": "47165ca62890d5b9827c3007072bd29f4e22e723", "author": {"user": {"login": "zoewangg", "name": "Zoe Wang"}}, "url": "https://github.com/aws/aws-sdk-java-v2/commit/47165ca62890d5b9827c3007072bd29f4e22e723", "committedDate": "2020-03-24T20:28:53Z", "message": "Add tests, improve docs and other changes"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "47165ca62890d5b9827c3007072bd29f4e22e723", "author": {"user": {"login": "zoewangg", "name": "Zoe Wang"}}, "url": "https://github.com/aws/aws-sdk-java-v2/commit/47165ca62890d5b9827c3007072bd29f4e22e723", "committedDate": "2020-03-24T20:28:53Z", "message": "Add tests, improve docs and other changes"}, "afterCommit": {"oid": "31a5b3a88a1ddc84e0031f48f326edaadda1fb1f", "author": {"user": {"login": "zoewangg", "name": "Zoe Wang"}}, "url": "https://github.com/aws/aws-sdk-java-v2/commit/31a5b3a88a1ddc84e0031f48f326edaadda1fb1f", "committedDate": "2020-03-24T21:25:56Z", "message": "Add tests, improve docs and other changes"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzgxNDE3NzA4", "url": "https://github.com/aws/aws-sdk-java-v2/pull/1678#pullrequestreview-381417708", "createdAt": "2020-03-25T18:19:05Z", "commit": {"oid": "31a5b3a88a1ddc84e0031f48f326edaadda1fb1f"}, "state": "COMMENTED", "comments": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yNVQxODoxOTowNVrOF7oakg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yNVQxODozMTo1MFrOF7o6iA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5ODA3MjQ2Ng==", "bodyText": "Can they just specify the module name (s3) and client name (S3Client) or something, so that we don't need to maintain a mapping?\nCan we also generate instructions for adding more services? Maybe in a comment or something?", "url": "https://github.com/aws/aws-sdk-java-v2/pull/1678#discussion_r398072466", "createdAt": "2020-03-25T18:19:05Z", "author": {"login": "millems"}, "path": "archetypes/archetype-lambda/README.md", "diffHunk": "@@ -0,0 +1,65 @@\n+# Maven Archetype for lambda function using AWS SDK for Java 2.x\n+\n+## Description\n+This is an Apache Maven Archetype to create a lambda function template using [AWS Java SDK 2.x][aws-java-sdk-v2]. The generated template\n+has the optimized configurations and follows the best practices to reduce start up time.\n+\n+## Usage\n+\n+You can use `mvn archetype:generate` to generate a project using this archetype. See [maven archetype usage guidance][maven-archetype-usage] for more information.\n+\n+- Interactive mode\n+\n+```\n+mvn archetype:generate \\\n+  -DarchetypeGroupId=software.amazon.awssdk \\\n+  -DarchetypeArtifactId=archetype-lambda \\\n+  -DarchetypeVersion=2.x\\\n+```\n+\n+- Batch mode\n+\n+```\n+mvn archetype:generate \\\n+    -DarchetypeGroupId=software.amazon.awssdk \\\n+    -DarchetypeArtifactId=archetype-lambda \\\n+    -DarchetypeVersion=2.x\\\n+    -DgroupId=com.test \\\n+    -DartifactId=sample-project \\\n+    -Dservice=s3  \\\n+    -Dregion=us-west-2 \\\n+    -DinteractiveMode=false \\\n+```\n+\n+### Parameters\n+      \n+Parameter Name | Default Value | Description\n+---|---|---\n+`service` (required) | n/a | Specifies the service client to be used in the lambda function, eg: s3, dynamodb. You can find available services [here][java-sdk-v2-services].", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "31a5b3a88a1ddc84e0031f48f326edaadda1fb1f"}, "originalPosition": 38}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5ODA3NTM3OA==", "bodyText": "In the future, we should consider showing them how to do true DI with dagger.", "url": "https://github.com/aws/aws-sdk-java-v2/pull/1678#discussion_r398075378", "createdAt": "2020-03-25T18:23:34Z", "author": {"login": "millems"}, "path": "archetypes/archetype-lambda/src/main/resources/archetype-resources/src/main/java/DependencyFactory.java", "diffHunk": "@@ -0,0 +1,27 @@\n+#parse ( \"global.vm\")\n+\n+package ${package};\n+\n+import software.amazon.awssdk.auth.credentials.EnvironmentVariableCredentialsProvider;\n+import software.amazon.awssdk.http.${httpClientPackageName};\n+import software.amazon.awssdk.regions.Region;\n+import software.amazon.awssdk.services.${servicePackage}.${serviceClientClassName};\n+\n+/**\n+ * The module containing all dependencies required by the {@link ${handlerClassName}}.\n+ */\n+public class DependencyFactory {\n+\n+    private DependencyFactory() {}\n+\n+    /**\n+     * @return an instance of ${serviceClientClassName}\n+     */\n+    public static ${serviceClientClassName} ${service}Client() {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "31a5b3a88a1ddc84e0031f48f326edaadda1fb1f"}, "originalPosition": 20}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5ODA3OTY2Mw==", "bodyText": "If we want to invest time, we could generate these mappings and upload them to maven for the archetype to use.", "url": "https://github.com/aws/aws-sdk-java-v2/pull/1678#discussion_r398079663", "createdAt": "2020-03-25T18:30:11Z", "author": {"login": "millems"}, "path": "archetypes/archetype-lambda/src/main/resources/global.vm", "diffHunk": "@@ -0,0 +1,29 @@\n+## global variables used by the project\n+#set( $symbol_pound = '#' )\n+#set( $symbol_dollar = '$' )\n+#set( $symbol_escape = '\\' )\n+## TODO: there is no easy way to map service module artifactId to the client name derived the service name\n+## As a workaround: mapping the common service here\n+#if( $service == 'dynamodb')\n+    #set ( $service = 'dynamoDb')\n+#end", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "31a5b3a88a1ddc84e0031f48f326edaadda1fb1f"}, "originalPosition": 9}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5ODA4MDY0OA==", "bodyText": "Do we include open SSL or other tweaks for netty?", "url": "https://github.com/aws/aws-sdk-java-v2/pull/1678#discussion_r398080648", "createdAt": "2020-03-25T18:31:50Z", "author": {"login": "millems"}, "path": "archetypes/archetype-lambda/src/test/resources/projects/nettyclient/reference/src/main/java/software/amazonaws/test/DependencyFactory.java", "diffHunk": "@@ -0,0 +1,26 @@\n+\n+package software.amazonaws.test;\n+\n+import software.amazon.awssdk.auth.credentials.EnvironmentVariableCredentialsProvider;\n+import software.amazon.awssdk.http.nio.netty.NettyNioAsyncHttpClient;\n+import software.amazon.awssdk.regions.Region;\n+import software.amazon.awssdk.services.kinesis.KinesisAsyncClient;\n+\n+/**\n+ * The module containing all dependencies required by the {@link MyNettyFunction}.\n+ */\n+public class DependencyFactory {\n+\n+    private DependencyFactory() {}\n+\n+    /**\n+     * @return an instance of KinesisAsyncClient\n+     */\n+    public static KinesisAsyncClient kinesisClient() {\n+        return KinesisAsyncClient.builder()\n+                       .credentialsProvider(EnvironmentVariableCredentialsProvider.create())\n+                       .region(Region.US_EAST_1)\n+                       .httpClientBuilder(NettyNioAsyncHttpClient.builder())", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "31a5b3a88a1ddc84e0031f48f326edaadda1fb1f"}, "originalPosition": 23}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "9bf3407a2b3cc1aea9aeff3bc979b96acd709406", "author": {"user": {"login": "zoewangg", "name": "Zoe Wang"}}, "url": "https://github.com/aws/aws-sdk-java-v2/commit/9bf3407a2b3cc1aea9aeff3bc979b96acd709406", "committedDate": "2020-03-26T20:37:14Z", "message": "generate service mapping vm file during build time"}, "afterCommit": {"oid": "3dc5e50c84e1646cd8bf8ec3e56c51faf531a3fe", "author": {"user": {"login": "zoewangg", "name": "Zoe Wang"}}, "url": "https://github.com/aws/aws-sdk-java-v2/commit/3dc5e50c84e1646cd8bf8ec3e56c51faf531a3fe", "committedDate": "2020-03-26T20:55:20Z", "message": "generate service mapping vm file during build time"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "3dc5e50c84e1646cd8bf8ec3e56c51faf531a3fe", "author": {"user": {"login": "zoewangg", "name": "Zoe Wang"}}, "url": "https://github.com/aws/aws-sdk-java-v2/commit/3dc5e50c84e1646cd8bf8ec3e56c51faf531a3fe", "committedDate": "2020-03-26T20:55:20Z", "message": "generate service mapping vm file during build time"}, "afterCommit": {"oid": "52ff67bf2862bbbc26250db108e912ea7046b600", "author": {"user": {"login": "zoewangg", "name": "Zoe Wang"}}, "url": "https://github.com/aws/aws-sdk-java-v2/commit/52ff67bf2862bbbc26250db108e912ea7046b600", "committedDate": "2020-03-26T20:56:42Z", "message": "generate service mapping vm file during build time"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "52ff67bf2862bbbc26250db108e912ea7046b600", "author": {"user": {"login": "zoewangg", "name": "Zoe Wang"}}, "url": "https://github.com/aws/aws-sdk-java-v2/commit/52ff67bf2862bbbc26250db108e912ea7046b600", "committedDate": "2020-03-26T20:56:42Z", "message": "generate service mapping vm file during build time"}, "afterCommit": {"oid": "1067b6ecf28826f5ba944d2aa72e260663b6eb4d", "author": {"user": {"login": "zoewangg", "name": "Zoe Wang"}}, "url": "https://github.com/aws/aws-sdk-java-v2/commit/1067b6ecf28826f5ba944d2aa72e260663b6eb4d", "committedDate": "2020-03-26T21:18:29Z", "message": "generate service mapping vm file during build time"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzgyNDM2NzA5", "url": "https://github.com/aws/aws-sdk-java-v2/pull/1678#pullrequestreview-382436709", "createdAt": "2020-03-26T21:33:11Z", "commit": {"oid": "1067b6ecf28826f5ba944d2aa72e260663b6eb4d"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yNlQyMTozMzoxMVrOF8bSwA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yNlQyMTozMzoxMVrOF8bSwA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5ODkwNjA0OA==", "bodyText": "How does this work for modules with multiple clients, e.g. dynamodb?", "url": "https://github.com/aws/aws-sdk-java-v2/pull/1678#discussion_r398906048", "createdAt": "2020-03-26T21:33:11Z", "author": {"login": "millems"}, "path": "archetypes/archetype-lambda/src/main/resources/map-service-to-client-prefix", "diffHunk": "@@ -0,0 +1,50 @@\n+#!/usr/bin/env python\n+\n+import json\n+import os\n+import string\n+\n+MAPPING_FILE_NAME = 'serviceMapping.vm'\n+RESOURCES_ROOT_DIR = os.path.join(os.path.dirname(os.path.abspath(__file__)))\n+ARCHETYPE_LAMBDA_ROOT_DIR = os.path.dirname(os.path.dirname(os.path.abspath(os.path.join(RESOURCES_ROOT_DIR, \"../\"))))\n+SERVICE_DIR = os.path.join(\n+    os.path.dirname(os.path.dirname(os.path.abspath(os.path.join(__file__, \"../../../../\")))),\n+    'services'\n+)\n+\n+def load_all_service_modules():\n+    service_mapping = {}\n+    for f in [f for f in os.listdir(SERVICE_DIR) if os.path.isdir(os.path.join(SERVICE_DIR, f)) & os.path.exists(os.path.join(SERVICE_DIR, f, 'target'))]:\n+        for s in [s for s in os.listdir(os.path.join(SERVICE_DIR, f, 'target', 'generated-sources/sdk/software/amazon/awssdk/services', f)) if s.endswith('AsyncClient.java') & s.startswith('Default')]:\n+            service_mapping[f] = find_client_prefix(s)\n+    return service_mapping\n+\n+def find_client_prefix(d):\n+    index = d.find('AsyncClient.java')\n+    return d[7:index]\n+\n+def write_to_vm_file(service_mapping):\n+    target = os.path.join(ARCHETYPE_LAMBDA_ROOT_DIR, 'target')\n+\n+    if not os.path.exists(target):\n+        os.mkdir(target)\n+\n+    target = os.path.join(ARCHETYPE_LAMBDA_ROOT_DIR, 'target', 'classes')\n+\n+    if not os.path.exists(target):\n+        os.mkdir(target)\n+\n+    filename = os.path.join(target, MAPPING_FILE_NAME)\n+\n+    with open(filename, 'w') as f:\n+        f.write('#set ( $serviceMapping =')\n+        f.write(json.dumps(service_mapping))\n+        f.write(')')\n+    return filename", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "1067b6ecf28826f5ba944d2aa72e260663b6eb4d"}, "originalPosition": 43}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzgyNDUyMjQ1", "url": "https://github.com/aws/aws-sdk-java-v2/pull/1678#pullrequestreview-382452245", "createdAt": "2020-03-26T22:01:40Z", "commit": {"oid": "1067b6ecf28826f5ba944d2aa72e260663b6eb4d"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "ac3bea8935eb9ff2c4a8a683d019c943ebe7870d", "author": {"user": {"login": "millems", "name": "Matthew Miller"}}, "url": "https://github.com/aws/aws-sdk-java-v2/commit/ac3bea8935eb9ff2c4a8a683d019c943ebe7870d", "committedDate": "2020-03-26T22:01:36Z", "message": "Merge branch 'master' into zoewang/lambda-archetype"}, "afterCommit": {"oid": "4f1ab3032e4a07c35cd59ca4eebd5a9abb4e54e2", "author": {"user": {"login": "zoewangg", "name": "Zoe Wang"}}, "url": "https://github.com/aws/aws-sdk-java-v2/commit/4f1ab3032e4a07c35cd59ca4eebd5a9abb4e54e2", "committedDate": "2020-03-26T22:36:29Z", "message": "Add support for maven lambda archetype"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzgyNDcyMzQx", "url": "https://github.com/aws/aws-sdk-java-v2/pull/1678#pullrequestreview-382472341", "createdAt": "2020-03-26T22:45:54Z", "commit": {"oid": "4f1ab3032e4a07c35cd59ca4eebd5a9abb4e54e2"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "29cafa7734cd0ad5b0446ddfb83b14de1c6d62e8", "author": {"user": {"login": "zoewangg", "name": "Zoe Wang"}}, "url": "https://github.com/aws/aws-sdk-java-v2/commit/29cafa7734cd0ad5b0446ddfb83b14de1c6d62e8", "committedDate": "2020-03-26T23:25:14Z", "message": "Add support for maven lambda archetype"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "4f1ab3032e4a07c35cd59ca4eebd5a9abb4e54e2", "author": {"user": {"login": "zoewangg", "name": "Zoe Wang"}}, "url": "https://github.com/aws/aws-sdk-java-v2/commit/4f1ab3032e4a07c35cd59ca4eebd5a9abb4e54e2", "committedDate": "2020-03-26T22:36:29Z", "message": "Add support for maven lambda archetype"}, "afterCommit": {"oid": "29cafa7734cd0ad5b0446ddfb83b14de1c6d62e8", "author": {"user": {"login": "zoewangg", "name": "Zoe Wang"}}, "url": "https://github.com/aws/aws-sdk-java-v2/commit/29cafa7734cd0ad5b0446ddfb83b14de1c6d62e8", "committedDate": "2020-03-26T23:25:14Z", "message": "Add support for maven lambda archetype"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2710, "cost": 1, "resetAt": "2021-11-01T11:59:11Z"}}}