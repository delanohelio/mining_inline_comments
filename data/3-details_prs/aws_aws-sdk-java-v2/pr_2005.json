{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDczNTcxMTYx", "number": 2005, "title": "create connection health checks configuration", "bodyText": "Description\ncreate ConnectionHealthChecksConfiguration and expose it in the crt client builder\nMotivation and Context\nhttps://github.com/aws/aws-sdk-java-v2/blob/master/docs/design/http-clients/aws-crt-client/DecisionLog.md#82420\nTesting\nadded unit tests\nScreenshots (if appropriate)\nTypes of changes\n\n\n Bug fix (non-breaking change which fixes an issue)\n New feature (non-breaking change which adds functionality)\n\nChecklist\n\n\n\n I have read the CONTRIBUTING document\n Local run of mvn install succeeds\n My code follows the code style of this project\n My change requires a change to the Javadoc documentation\n I have updated the Javadoc documentation accordingly\n I have read the README document\n I have added tests to cover my changes\n All new and existing tests passed\n A short description of the change has been added to the CHANGELOG\n My change is to implement 1.11 parity feature and I have updated LaunchChangelog\n\nLicense\n\n\n\n\n I confirm that this pull request can be released under the Apache 2 license", "createdAt": "2020-08-26T00:17:15Z", "url": "https://github.com/aws/aws-sdk-java-v2/pull/2005", "merged": true, "mergeCommit": {"oid": "feebcd22ccadcc4e5acc289f435624ba729d7243"}, "closed": true, "closedAt": "2020-08-26T20:24:18Z", "author": {"login": "zoewangg"}, "timelineItems": {"totalCount": 5, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdCwDMegFqTQ3NTc0MjYwNQ==", "endCursor": "Y3Vyc29yOnYyOpPPAAABdCxZzcgBqjM2OTYzOTc1MTY=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDc1NzQyNjA1", "url": "https://github.com/aws/aws-sdk-java-v2/pull/2005#pullrequestreview-475742605", "createdAt": "2020-08-26T18:18:28Z", "commit": {"oid": "fd11ca88504ad6f16696414f0b6b813de685af0a"}, "state": "COMMENTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yNlQxODoxODoyOFrOHHYGZQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yNlQxODoyMzo0MlrOHHYRjQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NzQ5NjkzMw==", "bodyText": "Duration has getSeconds()", "url": "https://github.com/aws/aws-sdk-java-v2/pull/2005#discussion_r477496933", "createdAt": "2020-08-26T18:18:28Z", "author": {"login": "dagnir"}, "path": "http-clients/aws-crt-client/src/main/java/software/amazon/awssdk/http/crt/AwsCrtAsyncHttpClient.java", "diffHunk": "@@ -105,13 +106,25 @@ private AwsCrtAsyncHttpClient(DefaultBuilder builder, AttributeMap config) {\n \n             this.initialWindowSize = builder.initialWindowSize;\n             this.maxConnectionsPerEndpoint = maxConns;\n-            this.monitoringOptions = builder.monitoringOptions;\n+            this.monitoringOptions = revolveHttpMonitoringOptions(builder.connectionHealthChecksConfiguration);\n             this.maxConnectionIdleInMilliseconds = config.get(SdkHttpConfigurationOption.CONNECTION_MAX_IDLE_TIMEOUT).toMillis();\n \n             this.proxyOptions = buildProxyOptions(builder.proxyConfiguration);\n         }\n     }\n \n+    private HttpMonitoringOptions revolveHttpMonitoringOptions(ConnectionHealthChecksConfiguration config) {\n+        if (config == null) {\n+            return null;\n+        }\n+\n+        HttpMonitoringOptions httpMonitoringOptions = new HttpMonitoringOptions();\n+        httpMonitoringOptions.setMinThroughputBytesPerSecond(config.minThroughputInBytesPerSecond());\n+        int seconds = (int) (TimeUnit.MILLISECONDS.toSeconds(config.allowableThroughputFailureInterval().toMillis()));", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "fd11ca88504ad6f16696414f0b6b813de685af0a"}, "originalPosition": 27}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NzQ5OTc4OQ==", "bodyText": "nit: Duration doesn't have a single unit so I don't think it would make sense to say \"in seconds\" here. We might want to add a note on the setter that it only supports seconds precision though", "url": "https://github.com/aws/aws-sdk-java-v2/pull/2005#discussion_r477499789", "createdAt": "2020-08-26T18:23:42Z", "author": {"login": "dagnir"}, "path": "http-clients/aws-crt-client/src/main/java/software/amazon/awssdk/http/crt/ConnectionHealthChecksConfiguration.java", "diffHunk": "@@ -0,0 +1,111 @@\n+/*\n+ * Copyright Amazon.com, Inc. or its affiliates. All Rights Reserved.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\").\n+ * You may not use this file except in compliance with the License.\n+ * A copy of the License is located at\n+ *\n+ *  http://aws.amazon.com/apache2.0\n+ *\n+ * or in the \"license\" file accompanying this file. This file is distributed\n+ * on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either\n+ * express or implied. See the License for the specific language governing\n+ * permissions and limitations under the License.\n+ */\n+\n+package software.amazon.awssdk.http.crt;\n+\n+import java.time.Duration;\n+import software.amazon.awssdk.annotations.SdkPublicApi;\n+import software.amazon.awssdk.utils.Validate;\n+\n+/**\n+ * Configuration that defines health checks for for all connections established by\n+ * the{@link ConnectionHealthChecksConfiguration}.\n+ */\n+@SdkPublicApi\n+public final class ConnectionHealthChecksConfiguration {\n+    private final long minThroughputInBytesPerSecond;\n+    private final Duration allowableThroughputFailureInterval;\n+\n+    private ConnectionHealthChecksConfiguration(DefaultConnectionHealthChecksConfigurationBuilder builder) {\n+        this.minThroughputInBytesPerSecond = Validate.paramNotNull(builder.minThroughputInBytesPerSecond,\n+                                                                   \"minThroughputInBytesPerSecond\");\n+        this.allowableThroughputFailureInterval = Validate.isPositive(builder.allowableThroughputFailureIntervalSeconds,\n+                                                                      \"allowableThroughputFailureIntervalSeconds\");\n+    }\n+\n+    /**\n+     * @return the minimum amount of throughput, in bytes per second, for a connection to be considered healthy.\n+     */\n+    public long minThroughputInBytesPerSecond() {\n+        return minThroughputInBytesPerSecond;\n+    }\n+\n+    /**\n+     * @return How long, in seconds, a connection is allowed to be unhealthy before getting shut down.", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "fd11ca88504ad6f16696414f0b6b813de685af0a"}, "originalPosition": 46}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "fd11ca88504ad6f16696414f0b6b813de685af0a", "author": {"user": {"login": "zoewangg", "name": "Zoe Wang"}}, "url": "https://github.com/aws/aws-sdk-java-v2/commit/fd11ca88504ad6f16696414f0b6b813de685af0a", "committedDate": "2020-08-26T00:16:42Z", "message": "Create ConnectionHealthChecksConfiguration"}, "afterCommit": {"oid": "b2b828a13db01617629e14a71f60f5c873b3f938", "author": {"user": {"login": "zoewangg", "name": "Zoe Wang"}}, "url": "https://github.com/aws/aws-sdk-java-v2/commit/b2b828a13db01617629e14a71f60f5c873b3f938", "committedDate": "2020-08-26T19:31:08Z", "message": "Create ConnectionHealthChecksConfiguration"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDc1ODAxOTA0", "url": "https://github.com/aws/aws-sdk-java-v2/pull/2005#pullrequestreview-475801904", "createdAt": "2020-08-26T19:39:08Z", "commit": {"oid": "b2b828a13db01617629e14a71f60f5c873b3f938"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "fc5ec1c1b13bc13f45cd6dac5bb9f69ce6df130b", "author": {"user": {"login": "zoewangg", "name": "Zoe Wang"}}, "url": "https://github.com/aws/aws-sdk-java-v2/commit/fc5ec1c1b13bc13f45cd6dac5bb9f69ce6df130b", "committedDate": "2020-08-26T19:58:24Z", "message": "Create ConnectionHealthChecksConfiguration"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "b2b828a13db01617629e14a71f60f5c873b3f938", "author": {"user": {"login": "zoewangg", "name": "Zoe Wang"}}, "url": "https://github.com/aws/aws-sdk-java-v2/commit/b2b828a13db01617629e14a71f60f5c873b3f938", "committedDate": "2020-08-26T19:31:08Z", "message": "Create ConnectionHealthChecksConfiguration"}, "afterCommit": {"oid": "fc5ec1c1b13bc13f45cd6dac5bb9f69ce6df130b", "author": {"user": {"login": "zoewangg", "name": "Zoe Wang"}}, "url": "https://github.com/aws/aws-sdk-java-v2/commit/fc5ec1c1b13bc13f45cd6dac5bb9f69ce6df130b", "committedDate": "2020-08-26T19:58:24Z", "message": "Create ConnectionHealthChecksConfiguration"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2433, "cost": 1, "resetAt": "2021-11-01T11:59:11Z"}}}