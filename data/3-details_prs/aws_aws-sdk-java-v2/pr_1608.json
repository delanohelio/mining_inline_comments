{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0MzY2MTEzNjky", "number": 1608, "title": "Add the ability to set trust managers for Apache, URLConnection, Netty", "bodyText": "Description\nAbility to set a custom trust manager for Apache\nMotivation and Context\nAllows seamless setting of certs in IntelliJ\nTesting\nManually, got any ideas? \ud83d\ude04\nScreenshots (if appropriate)\n\nTypes of changes\n\n\n Bug fix (non-breaking change which fixes an issue)\n New feature (non-breaking change which adds functionality)\n\nChecklist\n\n\n\n I have read the CONTRIBUTING document\n Local run of mvn install succeeds\n My code follows the code style of this project\n My change requires a change to the Javadoc documentation\n I have updated the Javadoc documentation accordingly\n I have read the README document\n I have added tests to cover my changes\n All new and existing tests passed\n A short description of the change has been added to the CHANGELOG\n My change is to implement 1.11 parity feature and I have updated LaunchChangelog\n\nLicense\n\n\n\n\n I confirm that this pull request can be released under the Apache 2 license", "createdAt": "2020-01-22T23:29:59Z", "url": "https://github.com/aws/aws-sdk-java-v2/pull/1608", "merged": true, "mergeCommit": {"oid": "e84bdd4cbf2e57d99e4a5d838720010d39b09e17"}, "closed": true, "closedAt": "2020-02-06T22:34:19Z", "author": {"login": "abrooksv"}, "timelineItems": {"totalCount": 16, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABb8_0aPgBqjI5NzIxNTE1OTU=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcBxbrNgH2gAyMzY2MTEzNjkyOmFhMGY5MWVmYTExZmZiY2ZiYzExYmJmYTA2ZmE4NTBmMzA1MjVhMWE=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "76bf7b3832f4cb331d214de8b94bbb737417ef1f", "author": {"user": {"login": "abrooksv", "name": "Austin Brooks"}}, "url": "https://github.com/aws/aws-sdk-java-v2/commit/76bf7b3832f4cb331d214de8b94bbb737417ef1f", "committedDate": "2020-01-22T23:31:13Z", "message": "Merge branch 'master' into trustManagers"}, "afterCommit": {"oid": "d928feca5281d6cbedd0d9eff39f4bf9aa7a6cee", "author": {"user": {"login": "abrooksv", "name": "Austin Brooks"}}, "url": "https://github.com/aws/aws-sdk-java-v2/commit/d928feca5281d6cbedd0d9eff39f4bf9aa7a6cee", "committedDate": "2020-01-23T01:08:48Z", "message": "Add the ability to set trust managers for Apache, HttpUrlConnection"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "a740f1b1c84929f5484797e601af9c68544b112a", "author": {"user": {"login": "abrooksv", "name": "Austin Brooks"}}, "url": "https://github.com/aws/aws-sdk-java-v2/commit/a740f1b1c84929f5484797e601af9c68544b112a", "committedDate": "2020-01-23T01:11:45Z", "message": "Merge branch 'master' into trustManagers"}, "afterCommit": {"oid": "01c892019d474df15583ae0502544b5fe0462c91", "author": {"user": {"login": "abrooksv", "name": "Austin Brooks"}}, "url": "https://github.com/aws/aws-sdk-java-v2/commit/01c892019d474df15583ae0502544b5fe0462c91", "committedDate": "2020-01-23T02:00:45Z", "message": "Add the ability to set trust managers for Apache, HttpUrlConnection, Netty"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "98cf1d532d6b99145755618c03fb5c2b8cf62a96", "author": {"user": {"login": "abrooksv", "name": "Austin Brooks"}}, "url": "https://github.com/aws/aws-sdk-java-v2/commit/98cf1d532d6b99145755618c03fb5c2b8cf62a96", "committedDate": "2020-01-23T02:02:36Z", "message": "Merge branch 'master' into trustManagers"}, "afterCommit": {"oid": "ffaf4dbe00a8b36b8f4296d095b5f44172d07f94", "author": {"user": {"login": "abrooksv", "name": "Austin Brooks"}}, "url": "https://github.com/aws/aws-sdk-java-v2/commit/ffaf4dbe00a8b36b8f4296d095b5f44172d07f94", "committedDate": "2020-01-23T02:19:08Z", "message": "Add the ability to set trust managers for Apache, HttpUrlConnection, Netty"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "ffaf4dbe00a8b36b8f4296d095b5f44172d07f94", "author": {"user": {"login": "abrooksv", "name": "Austin Brooks"}}, "url": "https://github.com/aws/aws-sdk-java-v2/commit/ffaf4dbe00a8b36b8f4296d095b5f44172d07f94", "committedDate": "2020-01-23T02:19:08Z", "message": "Add the ability to set trust managers for Apache, HttpUrlConnection, Netty"}, "afterCommit": {"oid": "34b6f242cc6a25e21775572b4ad9bf84c812c746", "author": {"user": {"login": "abrooksv", "name": "Austin Brooks"}}, "url": "https://github.com/aws/aws-sdk-java-v2/commit/34b6f242cc6a25e21775572b4ad9bf84c812c746", "committedDate": "2020-01-23T20:25:28Z", "message": "Add the ability to set trust managers for Apache, HttpUrlConnection, Netty\n\n* UrlConnection no longer sets SSL context JVM wide\n* UrlConnection now supports TlsKeyManagersProvider"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzQ3NjgyMDUx", "url": "https://github.com/aws/aws-sdk-java-v2/pull/1608#pullrequestreview-347682051", "createdAt": "2020-01-23T23:46:48Z", "commit": {"oid": "34b6f242cc6a25e21775572b4ad9bf84c812c746"}, "state": "COMMENTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0yM1QyMzo0Njo0OFrOFhQRDg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0yM1QyMzo0ODo1M1rOFhQTKQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MDQxMzgzOA==", "bodyText": "Not directly related to your change, but can you make static vs not static import consistent?", "url": "https://github.com/aws/aws-sdk-java-v2/pull/1608#discussion_r370413838", "createdAt": "2020-01-23T23:46:48Z", "author": {"login": "spfink"}, "path": "http-clients/netty-nio-client/src/main/java/software/amazon/awssdk/http/nio/netty/internal/NettyConfiguration.java", "diffHunk": "@@ -92,4 +89,12 @@ public boolean reapIdleConnections() {\n     public TlsKeyManagersProvider tlsKeyManagersProvider() {\n         return configuration.get(SdkHttpConfigurationOption.TLS_KEY_MANAGERS_PROVIDER);\n     }\n+\n+    public TlsTrustManagersProvider tlsTrustManagersProvider() {\n+        return configuration.get(SdkHttpConfigurationOption.TLS_TRUST_MANAGERS_PROVIDER);\n+    }\n+\n+    public boolean trustAllCertificates() {\n+        return configuration.get(TRUST_ALL_CERTIFICATES);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "34b6f242cc6a25e21775572b4ad9bf84c812c746"}, "originalPosition": 29}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MDQxNDM3Nw==", "bodyText": "Add validation here (and other clients) that both this and trust all can't both be set?", "url": "https://github.com/aws/aws-sdk-java-v2/pull/1608#discussion_r370414377", "createdAt": "2020-01-23T23:48:53Z", "author": {"login": "spfink"}, "path": "http-clients/apache-client/src/main/java/software/amazon/awssdk/http/apache/ApacheHttpClient.java", "diffHunk": "@@ -581,6 +599,10 @@ private HostnameVerifier getHostNameVerifier(AttributeMap standardOptions) {\n \n         private SSLContext getSslContext(AttributeMap standardOptions) {\n             TrustManager[] trustManagers = null;\n+            if (standardOptions.containsKey(SdkHttpConfigurationOption.TLS_TRUST_MANAGERS_PROVIDER)) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "34b6f242cc6a25e21775572b4ad9bf84c812c746"}, "originalPosition": 61}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "34b6f242cc6a25e21775572b4ad9bf84c812c746", "author": {"user": {"login": "abrooksv", "name": "Austin Brooks"}}, "url": "https://github.com/aws/aws-sdk-java-v2/commit/34b6f242cc6a25e21775572b4ad9bf84c812c746", "committedDate": "2020-01-23T20:25:28Z", "message": "Add the ability to set trust managers for Apache, HttpUrlConnection, Netty\n\n* UrlConnection no longer sets SSL context JVM wide\n* UrlConnection now supports TlsKeyManagersProvider"}, "afterCommit": {"oid": "2786879237c2548ad5a5a036225807140d939b28", "author": {"user": {"login": "abrooksv", "name": "Austin Brooks"}}, "url": "https://github.com/aws/aws-sdk-java-v2/commit/2786879237c2548ad5a5a036225807140d939b28", "committedDate": "2020-01-24T23:00:25Z", "message": "Add the ability to set trust managers for Apache, HttpUrlConnection, Netty\n\n* UrlConnection no longer sets SSL context JVM wide\n* UrlConnection now supports TlsKeyManagersProvider"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "2786879237c2548ad5a5a036225807140d939b28", "author": {"user": {"login": "abrooksv", "name": "Austin Brooks"}}, "url": "https://github.com/aws/aws-sdk-java-v2/commit/2786879237c2548ad5a5a036225807140d939b28", "committedDate": "2020-01-24T23:00:25Z", "message": "Add the ability to set trust managers for Apache, HttpUrlConnection, Netty\n\n* UrlConnection no longer sets SSL context JVM wide\n* UrlConnection now supports TlsKeyManagersProvider"}, "afterCommit": {"oid": "9a8f257f9e85dd2767af3fd1e369043ad1ce42e0", "author": {"user": {"login": "abrooksv", "name": "Austin Brooks"}}, "url": "https://github.com/aws/aws-sdk-java-v2/commit/9a8f257f9e85dd2767af3fd1e369043ad1ce42e0", "committedDate": "2020-01-24T23:16:41Z", "message": "Add the ability to set trust managers for Apache, HttpUrlConnection, Netty\n\n* UrlConnection no longer sets SSL context JVM wide\n* UrlConnection now supports TlsKeyManagersProvider"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "9a8f257f9e85dd2767af3fd1e369043ad1ce42e0", "author": {"user": {"login": "abrooksv", "name": "Austin Brooks"}}, "url": "https://github.com/aws/aws-sdk-java-v2/commit/9a8f257f9e85dd2767af3fd1e369043ad1ce42e0", "committedDate": "2020-01-24T23:16:41Z", "message": "Add the ability to set trust managers for Apache, HttpUrlConnection, Netty\n\n* UrlConnection no longer sets SSL context JVM wide\n* UrlConnection now supports TlsKeyManagersProvider"}, "afterCommit": {"oid": "19f531abdcf5eb6da5338a93f5ef83c53bab589c", "author": {"user": {"login": "abrooksv", "name": "Austin Brooks"}}, "url": "https://github.com/aws/aws-sdk-java-v2/commit/19f531abdcf5eb6da5338a93f5ef83c53bab589c", "committedDate": "2020-01-24T23:50:17Z", "message": "Add the ability to set trust managers for Apache, HttpUrlConnection, Netty\n\n* UrlConnection no longer sets SSL context JVM wide\n* UrlConnection now supports TlsKeyManagersProvider"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "19f531abdcf5eb6da5338a93f5ef83c53bab589c", "author": {"user": {"login": "abrooksv", "name": "Austin Brooks"}}, "url": "https://github.com/aws/aws-sdk-java-v2/commit/19f531abdcf5eb6da5338a93f5ef83c53bab589c", "committedDate": "2020-01-24T23:50:17Z", "message": "Add the ability to set trust managers for Apache, HttpUrlConnection, Netty\n\n* UrlConnection no longer sets SSL context JVM wide\n* UrlConnection now supports TlsKeyManagersProvider"}, "afterCommit": {"oid": "96460e2c008076f1929bcb14383dc3835589a6d8", "author": {"user": {"login": "abrooksv", "name": "Austin Brooks"}}, "url": "https://github.com/aws/aws-sdk-java-v2/commit/96460e2c008076f1929bcb14383dc3835589a6d8", "committedDate": "2020-01-30T20:12:07Z", "message": "Add the ability to set trust managers for Apache, HttpUrlConnection, Netty\n\n* UrlConnection no longer sets SSL context JVM wide\n* UrlConnection now supports TlsKeyManagersProvider"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "96460e2c008076f1929bcb14383dc3835589a6d8", "author": {"user": {"login": "abrooksv", "name": "Austin Brooks"}}, "url": "https://github.com/aws/aws-sdk-java-v2/commit/96460e2c008076f1929bcb14383dc3835589a6d8", "committedDate": "2020-01-30T20:12:07Z", "message": "Add the ability to set trust managers for Apache, HttpUrlConnection, Netty\n\n* UrlConnection no longer sets SSL context JVM wide\n* UrlConnection now supports TlsKeyManagersProvider"}, "afterCommit": {"oid": "137692e4e1059f4d48d880d76a3625d78feb96f0", "author": {"user": {"login": "abrooksv", "name": "Austin Brooks"}}, "url": "https://github.com/aws/aws-sdk-java-v2/commit/137692e4e1059f4d48d880d76a3625d78feb96f0", "committedDate": "2020-01-30T20:18:00Z", "message": "Add the ability to set trust managers for Apache, HttpUrlConnection, Netty\n\n* UrlConnection no longer sets SSL context JVM wide\n* UrlConnection now supports TlsKeyManagersProvider"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzUxNjc0MTQw", "url": "https://github.com/aws/aws-sdk-java-v2/pull/1608#pullrequestreview-351674140", "createdAt": "2020-01-31T17:55:28Z", "commit": {"oid": "137692e4e1059f4d48d880d76a3625d78feb96f0"}, "state": "COMMENTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0zMVQxNzo1NToyOFrOFkTJkg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0zMVQxNzo1ODoxNFrOFkTOQQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MzYwNjgwMg==", "bodyText": "This formatting is weird", "url": "https://github.com/aws/aws-sdk-java-v2/pull/1608#discussion_r373606802", "createdAt": "2020-01-31T17:55:28Z", "author": {"login": "spfink"}, "path": "http-clients/netty-nio-client/src/main/java/software/amazon/awssdk/http/nio/netty/NettyNioAsyncHttpClient.java", "diffHunk": "@@ -82,9 +73,13 @@\n \n     // Override connection idle timeout for Netty http client to reduce the frequency of \"server failed to complete the\n     // response error\". see https://github.com/aws/aws-sdk-java-v2/issues/1122\n+    // CHECKSTYLE:OFF - Lines are too long\n     private static final AttributeMap NETTY_HTTP_DEFAULTS = AttributeMap.builder()\n-                                                                        .put(CONNECTION_MAX_IDLE_TIMEOUT, Duration.ofSeconds(5))\n+                                                                        .put(\n+                                                                            SdkHttpConfigurationOption.CONNECTION_MAX_IDLE_TIMEOUT,", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "137692e4e1059f4d48d880d76a3625d78feb96f0"}, "originalPosition": 33}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MzYwODAwMQ==", "bodyText": "A TlsTrustManagerProvider can't be provided if TrustAllCertificates is also set", "url": "https://github.com/aws/aws-sdk-java-v2/pull/1608#discussion_r373608001", "createdAt": "2020-01-31T17:58:14Z", "author": {"login": "spfink"}, "path": "http-clients/apache-client/src/main/java/software/amazon/awssdk/http/apache/ApacheHttpClient.java", "diffHunk": "@@ -580,14 +590,22 @@ private HostnameVerifier getHostNameVerifier(AttributeMap standardOptions) {\n         }\n \n         private SSLContext getSslContext(AttributeMap standardOptions) {\n+            Validate.isTrue(standardOptions.get(SdkHttpConfigurationOption.TLS_TRUST_MANAGERS_PROVIDER) == null ||\n+                            !standardOptions.get(SdkHttpConfigurationOption.TRUST_ALL_CERTIFICATES),\n+                            \"The tlsTrustManagersProvider and trust all can't both be configured.\");", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "137692e4e1059f4d48d880d76a3625d78feb96f0"}, "originalPosition": 168}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c852dd4a912760badcc44c6523f7fedd23051ebb", "author": {"user": {"login": "abrooksv", "name": "Austin Brooks"}}, "url": "https://github.com/aws/aws-sdk-java-v2/commit/c852dd4a912760badcc44c6523f7fedd23051ebb", "committedDate": "2020-01-31T18:07:05Z", "message": "Add the ability to set trust managers for Apache, HttpUrlConnection, Netty\n\n* UrlConnection no longer sets SSL context JVM wide\n* UrlConnection now supports TlsKeyManagersProvider"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "137692e4e1059f4d48d880d76a3625d78feb96f0", "author": {"user": {"login": "abrooksv", "name": "Austin Brooks"}}, "url": "https://github.com/aws/aws-sdk-java-v2/commit/137692e4e1059f4d48d880d76a3625d78feb96f0", "committedDate": "2020-01-30T20:18:00Z", "message": "Add the ability to set trust managers for Apache, HttpUrlConnection, Netty\n\n* UrlConnection no longer sets SSL context JVM wide\n* UrlConnection now supports TlsKeyManagersProvider"}, "afterCommit": {"oid": "c852dd4a912760badcc44c6523f7fedd23051ebb", "author": {"user": {"login": "abrooksv", "name": "Austin Brooks"}}, "url": "https://github.com/aws/aws-sdk-java-v2/commit/c852dd4a912760badcc44c6523f7fedd23051ebb", "committedDate": "2020-01-31T18:07:05Z", "message": "Add the ability to set trust managers for Apache, HttpUrlConnection, Netty\n\n* UrlConnection no longer sets SSL context JVM wide\n* UrlConnection now supports TlsKeyManagersProvider"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzU0NjM3NDcy", "url": "https://github.com/aws/aws-sdk-java-v2/pull/1608#pullrequestreview-354637472", "createdAt": "2020-02-06T17:30:36Z", "commit": {"oid": "c852dd4a912760badcc44c6523f7fedd23051ebb"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f44fe412fd38a4fb16eaf5ee17ce31f98ca101c2", "author": {"user": {"login": "spfink", "name": "Sam Fink"}}, "url": "https://github.com/aws/aws-sdk-java-v2/commit/f44fe412fd38a4fb16eaf5ee17ce31f98ca101c2", "committedDate": "2020-02-06T17:31:07Z", "message": "Merge branch 'master' into trustManagers"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "aa0f91efa11ffbcfbc11bbfa06fa850f30525a1a", "author": {"user": {"login": "spfink", "name": "Sam Fink"}}, "url": "https://github.com/aws/aws-sdk-java-v2/commit/aa0f91efa11ffbcfbc11bbfa06fa850f30525a1a", "committedDate": "2020-02-06T21:15:35Z", "message": "Merge branch 'master' into trustManagers"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2801, "cost": 1, "resetAt": "2021-11-01T11:59:11Z"}}}