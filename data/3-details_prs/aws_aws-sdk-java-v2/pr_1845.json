{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDE4ODMxMzYw", "number": 1845, "title": "Default endpointDiscovery to true for services that require it", "bodyText": "Services that have at least one operation that requires endpoint discovery will have their client builders default endpoint discovery to true.\nThe method 'enableEndpointDiscovery()' has been deprecated in client builders that support endpoint discovery.\nThe method 'endpointDiscoveryEnabled(boolean)' has been added to client builders that support endpoint discovery.\n\nThis behavior should now match the v1 SDK.\nLicense\n\n\n\n\n I confirm that this pull request can be released under the Apache 2 license", "createdAt": "2020-05-15T21:34:48Z", "url": "https://github.com/aws/aws-sdk-java-v2/pull/1845", "merged": true, "mergeCommit": {"oid": "c956d3e2740a5f5373f6159cf13ffaa5de525dab"}, "closed": true, "closedAt": "2020-05-18T19:21:37Z", "author": {"login": "bmaizels"}, "timelineItems": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcijVviAFqTQxMzc5MDEyMA==", "endCursor": "Y3Vyc29yOnYyOpPPAAABcikYQXgFqTQxMzg0NzE5MA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDEzNzkwMTIw", "url": "https://github.com/aws/aws-sdk-java-v2/pull/1845#pullrequestreview-413790120", "createdAt": "2020-05-18T17:17:06Z", "commit": {"oid": "71f07e16f7b4802c19ed089503113f1e647d0994"}, "state": "COMMENTED", "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xOFQxNzoxNzowNlrOGXAgdg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xOFQxNzoyNzowNlrOGXA2kA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNjc3ODc0Mg==", "bodyText": "We just use the last endpoint operation? Is that the right behavior?", "url": "https://github.com/aws/aws-sdk-java-v2/pull/1845#discussion_r426778742", "createdAt": "2020-05-18T17:17:06Z", "author": {"login": "millems"}, "path": "codegen/src/main/java/software/amazon/awssdk/codegen/IntermediateModelBuilder.java", "diffHunk": "@@ -107,12 +107,20 @@ public IntermediateModel build() {\n             new HashMap<>(new AddCustomAuthorizers(this.service, getNamingStrategy()).constructAuthorizers());\n \n         OperationModel endpointOperation = null;\n+        boolean endpointCacheRequired = false;\n \n         for (OperationModel o : operations.values()) {\n             if (o.isEndpointOperation()) {\n                 endpointOperation = o;\n-                break;\n             }", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "71f07e16f7b4802c19ed089503113f1e647d0994"}, "originalPosition": 10}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNjc3OTQ0Ng==", "bodyText": "So the \"new\" behavior is: if any operation requires endpoint discovery, enable it by default?", "url": "https://github.com/aws/aws-sdk-java-v2/pull/1845#discussion_r426779446", "createdAt": "2020-05-18T17:18:13Z", "author": {"login": "millems"}, "path": "codegen/src/main/java/software/amazon/awssdk/codegen/IntermediateModelBuilder.java", "diffHunk": "@@ -107,12 +107,20 @@ public IntermediateModel build() {\n             new HashMap<>(new AddCustomAuthorizers(this.service, getNamingStrategy()).constructAuthorizers());\n \n         OperationModel endpointOperation = null;\n+        boolean endpointCacheRequired = false;\n \n         for (OperationModel o : operations.values()) {\n             if (o.isEndpointOperation()) {\n                 endpointOperation = o;\n-                break;\n             }\n+\n+            if (o.getEndpointDiscovery() != null && o.getEndpointDiscovery().isRequired()) {\n+                endpointCacheRequired = true;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "71f07e16f7b4802c19ed089503113f1e647d0994"}, "originalPosition": 13}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNjc4NDQwMA==", "bodyText": "Deprecate here as well? Can we also remove it for new services?", "url": "https://github.com/aws/aws-sdk-java-v2/pull/1845#discussion_r426784400", "createdAt": "2020-05-18T17:27:06Z", "author": {"login": "millems"}, "path": "codegen/src/main/java/software/amazon/awssdk/codegen/poet/builder/AsyncClientBuilderClass.java", "diffHunk": "@@ -54,12 +54,24 @@ public TypeSpec poetSpec() {\n                          .addJavadoc(\"Internal implementation of {@link $T}.\", builderInterfaceName);\n \n         if (model.getEndpointOperation().isPresent()) {\n-            builder.addMethod(enableEndpointDiscovery());\n+            builder.addMethod(endpointDiscoveryEnabled())\n+                   .addMethod(enableEndpointDiscovery());\n         }\n \n         return builder.addMethod(buildClientMethod()).build();\n     }\n \n+    private MethodSpec endpointDiscoveryEnabled() {\n+        return MethodSpec.methodBuilder(\"endpointDiscoveryEnabled\")\n+                         .addAnnotation(Override.class)\n+                         .addModifiers(Modifier.PUBLIC)\n+                         .returns(builderClassName)\n+                         .addParameter(boolean.class, \"endpointDiscoveryEnabled\")\n+                         .addStatement(\"this.endpointDiscoveryEnabled = endpointDiscoveryEnabled\")\n+                         .addStatement(\"return this\")\n+                         .build();\n+    }\n+\n     private MethodSpec enableEndpointDiscovery() {\n         return MethodSpec.methodBuilder(\"enableEndpointDiscovery\")", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "71f07e16f7b4802c19ed089503113f1e647d0994"}, "originalPosition": 24}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "379e27cd7a93331d7e94d9741774f0ac41a572e4", "author": {"user": {"login": "bmaizels", "name": "Benjamin Maizels"}}, "url": "https://github.com/aws/aws-sdk-java-v2/commit/379e27cd7a93331d7e94d9741774f0ac41a572e4", "committedDate": "2020-05-18T18:41:09Z", "message": "Endpoint discovery is now enabled by default for future services that will require it"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "71f07e16f7b4802c19ed089503113f1e647d0994", "author": {"user": {"login": "bmaizels", "name": "Benjamin Maizels"}}, "url": "https://github.com/aws/aws-sdk-java-v2/commit/71f07e16f7b4802c19ed089503113f1e647d0994", "committedDate": "2020-05-15T21:35:03Z", "message": "Merge branch 'master' into bmaizels/enable-default-endpoint-discovery"}, "afterCommit": {"oid": "379e27cd7a93331d7e94d9741774f0ac41a572e4", "author": {"user": {"login": "bmaizels", "name": "Benjamin Maizels"}}, "url": "https://github.com/aws/aws-sdk-java-v2/commit/379e27cd7a93331d7e94d9741774f0ac41a572e4", "committedDate": "2020-05-18T18:41:09Z", "message": "Endpoint discovery is now enabled by default for future services that will require it"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDEzODQ3MTkw", "url": "https://github.com/aws/aws-sdk-java-v2/pull/1845#pullrequestreview-413847190", "createdAt": "2020-05-18T18:42:35Z", "commit": {"oid": "379e27cd7a93331d7e94d9741774f0ac41a572e4"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2564, "cost": 1, "resetAt": "2021-11-01T11:59:11Z"}}}