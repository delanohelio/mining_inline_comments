{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDg4MjU5MTU5", "number": 2039, "reviewThreads": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xOFQxOToyODowNFrOElFzwA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yMVQxNjo1MDozNFrOElwSNg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzA3MzI3OTM2OnYy", "diffSide": "RIGHT", "path": "codegen/src/test/resources/software/amazon/awssdk/codegen/poet/waiters/query-sync-waiter-class.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xOFQxOToyODowNFrOHUZX0A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xOFQyMDozMDozMVrOHUa_wg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MTE0OTI2NA==", "bodyText": "In metric publisher we do\nApiName.builder().name(\"hll\").version(\"cw-mp\").build();\n\nWith the mapper we do\nApiName.builder().version(\"ddb-enh\").name(\"hll\").build();\n\nWaiters is kind of a high-level library. Should we do\nApiName.builder().name(\"hll\").version(\"waiter\").build();\n\n?", "url": "https://github.com/aws/aws-sdk-java-v2/pull/2039#discussion_r491149264", "createdAt": "2020-09-18T19:28:04Z", "author": {"login": "millems"}, "path": "codegen/src/test/resources/software/amazon/awssdk/codegen/poet/waiters/query-sync-waiter-class.java", "diffHunk": "@@ -84,6 +89,15 @@ public void close() {\n         return new DefaultBuilder();\n     }\n \n+    private <T extends QueryRequest> T applyWaitersUserAgent(T request) {\n+        Consumer<AwsRequestOverrideConfiguration.Builder> userAgentApplier = b -> b.addApiName(ApiName.builder()\n+                                                                                                      .version(VersionInfo.SDK_VERSION).name(\"WAITERS\").build());", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "9be7b056bb6767b977e84e1720ebff18fd8192af"}, "originalPosition": 40}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MTE3NTg3NA==", "bodyText": "Yea sure, I can change that. I was imitating the Paginator user agent so it looked like this.", "url": "https://github.com/aws/aws-sdk-java-v2/pull/2039#discussion_r491175874", "createdAt": "2020-09-18T20:30:31Z", "author": {"login": "Quanzzzz"}, "path": "codegen/src/test/resources/software/amazon/awssdk/codegen/poet/waiters/query-sync-waiter-class.java", "diffHunk": "@@ -84,6 +89,15 @@ public void close() {\n         return new DefaultBuilder();\n     }\n \n+    private <T extends QueryRequest> T applyWaitersUserAgent(T request) {\n+        Consumer<AwsRequestOverrideConfiguration.Builder> userAgentApplier = b -> b.addApiName(ApiName.builder()\n+                                                                                                      .version(VersionInfo.SDK_VERSION).name(\"WAITERS\").build());", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MTE0OTI2NA=="}, "originalCommit": {"oid": "9be7b056bb6767b977e84e1720ebff18fd8192af"}, "originalPosition": 40}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzA3MzI4NDIyOnYy", "diffSide": "RIGHT", "path": "services/dynamodb/src/test/java/software/amazon/awssdk/services/dynamodb/WaitersUserAgentTest.java", "isResolved": false, "comments": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xOFQxOToyOTo0MFrOHUZawA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xOVQwMToxMDoxMFrOHUfc-Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MTE1MDAxNg==", "bodyText": "Is this an integration test now?", "url": "https://github.com/aws/aws-sdk-java-v2/pull/2039#discussion_r491150016", "createdAt": "2020-09-18T19:29:40Z", "author": {"login": "millems"}, "path": "services/dynamodb/src/test/java/software/amazon/awssdk/services/dynamodb/WaitersUserAgentTest.java", "diffHunk": "@@ -0,0 +1,97 @@\n+/*\n+ * Copyright Amazon.com, Inc. or its affiliates. All Rights Reserved.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\").\n+ * You may not use this file except in compliance with the License.\n+ * A copy of the License is located at\n+ *\n+ *  http://aws.amazon.com/apache2.0\n+ *\n+ * or in the \"license\" file accompanying this file. This file is distributed\n+ * on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either\n+ * express or implied. See the License for the specific language governing\n+ * permissions and limitations under the License.\n+ */\n+\n+package software.amazon.awssdk.services.dynamodb;\n+\n+import static com.github.tomakehurst.wiremock.core.WireMockConfiguration.options;\n+import static org.assertj.core.api.Assertions.assertThatThrownBy;\n+import static org.junit.Assert.assertTrue;\n+\n+import com.github.tomakehurst.wiremock.common.ConsoleNotifier;\n+import com.github.tomakehurst.wiremock.junit.WireMockRule;\n+import java.util.concurrent.CompletableFuture;\n+import org.junit.Before;\n+import org.junit.Rule;\n+import org.junit.Test;\n+import org.mockito.ArgumentCaptor;\n+import org.mockito.Matchers;\n+import org.mockito.Mockito;\n+import software.amazon.awssdk.auth.credentials.AwsBasicCredentials;\n+import software.amazon.awssdk.auth.credentials.StaticCredentialsProvider;\n+import software.amazon.awssdk.core.interceptor.Context;\n+import software.amazon.awssdk.core.interceptor.ExecutionInterceptor;\n+import software.amazon.awssdk.core.util.VersionInfo;\n+import software.amazon.awssdk.core.waiters.WaiterResponse;\n+import software.amazon.awssdk.regions.Region;\n+import software.amazon.awssdk.services.dynamodb.model.DescribeTableRequest;\n+import software.amazon.awssdk.services.dynamodb.model.DescribeTableResponse;\n+import software.amazon.awssdk.services.dynamodb.waiters.DynamoDbAsyncWaiter;\n+import software.amazon.awssdk.services.dynamodb.waiters.DynamoDbWaiter;\n+\n+public class WaitersUserAgentTest {\n+\n+    @Rule\n+    public WireMockRule mockServer = new WireMockRule(options().notifier(new ConsoleNotifier(true)).dynamicHttpsPort());\n+\n+    private DynamoDbClient dynamoDbClient;\n+    private DynamoDbAsyncClient dynamoDbAsyncClient;\n+    private ExecutionInterceptor interceptor;\n+\n+    @Before\n+    public void setup() {\n+        interceptor = Mockito.spy(AbstractExecutionInterceptor.class);\n+\n+        dynamoDbClient = DynamoDbClient.builder()\n+                                       .credentialsProvider(StaticCredentialsProvider.create(AwsBasicCredentials.create(\"test\",\n+                                                                                                                        \"test\")))\n+                                       .region(Region.US_WEST_2)\n+                                       .overrideConfiguration(c -> c.addExecutionInterceptor(interceptor))\n+                                       .build();\n+\n+        dynamoDbAsyncClient = DynamoDbAsyncClient.builder()\n+                                                 .credentialsProvider(StaticCredentialsProvider.create(AwsBasicCredentials\n+                                                                                                           .create(\"test\",\n+                                                                                                                   \"test\")))\n+                                                 .region(Region.US_WEST_2)\n+                                                 .overrideConfiguration(c -> c.addExecutionInterceptor(interceptor))\n+                                                 .build();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "9be7b056bb6767b977e84e1720ebff18fd8192af"}, "originalPosition": 69}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MTE3NjQ2Mw==", "bodyText": "No, these are just the clients with the interceptor. The integration tests are not here.", "url": "https://github.com/aws/aws-sdk-java-v2/pull/2039#discussion_r491176463", "createdAt": "2020-09-18T20:31:50Z", "author": {"login": "Quanzzzz"}, "path": "services/dynamodb/src/test/java/software/amazon/awssdk/services/dynamodb/WaitersUserAgentTest.java", "diffHunk": "@@ -0,0 +1,97 @@\n+/*\n+ * Copyright Amazon.com, Inc. or its affiliates. All Rights Reserved.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\").\n+ * You may not use this file except in compliance with the License.\n+ * A copy of the License is located at\n+ *\n+ *  http://aws.amazon.com/apache2.0\n+ *\n+ * or in the \"license\" file accompanying this file. This file is distributed\n+ * on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either\n+ * express or implied. See the License for the specific language governing\n+ * permissions and limitations under the License.\n+ */\n+\n+package software.amazon.awssdk.services.dynamodb;\n+\n+import static com.github.tomakehurst.wiremock.core.WireMockConfiguration.options;\n+import static org.assertj.core.api.Assertions.assertThatThrownBy;\n+import static org.junit.Assert.assertTrue;\n+\n+import com.github.tomakehurst.wiremock.common.ConsoleNotifier;\n+import com.github.tomakehurst.wiremock.junit.WireMockRule;\n+import java.util.concurrent.CompletableFuture;\n+import org.junit.Before;\n+import org.junit.Rule;\n+import org.junit.Test;\n+import org.mockito.ArgumentCaptor;\n+import org.mockito.Matchers;\n+import org.mockito.Mockito;\n+import software.amazon.awssdk.auth.credentials.AwsBasicCredentials;\n+import software.amazon.awssdk.auth.credentials.StaticCredentialsProvider;\n+import software.amazon.awssdk.core.interceptor.Context;\n+import software.amazon.awssdk.core.interceptor.ExecutionInterceptor;\n+import software.amazon.awssdk.core.util.VersionInfo;\n+import software.amazon.awssdk.core.waiters.WaiterResponse;\n+import software.amazon.awssdk.regions.Region;\n+import software.amazon.awssdk.services.dynamodb.model.DescribeTableRequest;\n+import software.amazon.awssdk.services.dynamodb.model.DescribeTableResponse;\n+import software.amazon.awssdk.services.dynamodb.waiters.DynamoDbAsyncWaiter;\n+import software.amazon.awssdk.services.dynamodb.waiters.DynamoDbWaiter;\n+\n+public class WaitersUserAgentTest {\n+\n+    @Rule\n+    public WireMockRule mockServer = new WireMockRule(options().notifier(new ConsoleNotifier(true)).dynamicHttpsPort());\n+\n+    private DynamoDbClient dynamoDbClient;\n+    private DynamoDbAsyncClient dynamoDbAsyncClient;\n+    private ExecutionInterceptor interceptor;\n+\n+    @Before\n+    public void setup() {\n+        interceptor = Mockito.spy(AbstractExecutionInterceptor.class);\n+\n+        dynamoDbClient = DynamoDbClient.builder()\n+                                       .credentialsProvider(StaticCredentialsProvider.create(AwsBasicCredentials.create(\"test\",\n+                                                                                                                        \"test\")))\n+                                       .region(Region.US_WEST_2)\n+                                       .overrideConfiguration(c -> c.addExecutionInterceptor(interceptor))\n+                                       .build();\n+\n+        dynamoDbAsyncClient = DynamoDbAsyncClient.builder()\n+                                                 .credentialsProvider(StaticCredentialsProvider.create(AwsBasicCredentials\n+                                                                                                           .create(\"test\",\n+                                                                                                                   \"test\")))\n+                                                 .region(Region.US_WEST_2)\n+                                                 .overrideConfiguration(c -> c.addExecutionInterceptor(interceptor))\n+                                                 .build();", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MTE1MDAxNg=="}, "originalCommit": {"oid": "9be7b056bb6767b977e84e1720ebff18fd8192af"}, "originalPosition": 69}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MTIwODc5OA==", "bodyText": "It looks like these are calling the real DynamoDB, though, not the wiremock server.", "url": "https://github.com/aws/aws-sdk-java-v2/pull/2039#discussion_r491208798", "createdAt": "2020-09-18T21:53:51Z", "author": {"login": "millems"}, "path": "services/dynamodb/src/test/java/software/amazon/awssdk/services/dynamodb/WaitersUserAgentTest.java", "diffHunk": "@@ -0,0 +1,97 @@\n+/*\n+ * Copyright Amazon.com, Inc. or its affiliates. All Rights Reserved.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\").\n+ * You may not use this file except in compliance with the License.\n+ * A copy of the License is located at\n+ *\n+ *  http://aws.amazon.com/apache2.0\n+ *\n+ * or in the \"license\" file accompanying this file. This file is distributed\n+ * on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either\n+ * express or implied. See the License for the specific language governing\n+ * permissions and limitations under the License.\n+ */\n+\n+package software.amazon.awssdk.services.dynamodb;\n+\n+import static com.github.tomakehurst.wiremock.core.WireMockConfiguration.options;\n+import static org.assertj.core.api.Assertions.assertThatThrownBy;\n+import static org.junit.Assert.assertTrue;\n+\n+import com.github.tomakehurst.wiremock.common.ConsoleNotifier;\n+import com.github.tomakehurst.wiremock.junit.WireMockRule;\n+import java.util.concurrent.CompletableFuture;\n+import org.junit.Before;\n+import org.junit.Rule;\n+import org.junit.Test;\n+import org.mockito.ArgumentCaptor;\n+import org.mockito.Matchers;\n+import org.mockito.Mockito;\n+import software.amazon.awssdk.auth.credentials.AwsBasicCredentials;\n+import software.amazon.awssdk.auth.credentials.StaticCredentialsProvider;\n+import software.amazon.awssdk.core.interceptor.Context;\n+import software.amazon.awssdk.core.interceptor.ExecutionInterceptor;\n+import software.amazon.awssdk.core.util.VersionInfo;\n+import software.amazon.awssdk.core.waiters.WaiterResponse;\n+import software.amazon.awssdk.regions.Region;\n+import software.amazon.awssdk.services.dynamodb.model.DescribeTableRequest;\n+import software.amazon.awssdk.services.dynamodb.model.DescribeTableResponse;\n+import software.amazon.awssdk.services.dynamodb.waiters.DynamoDbAsyncWaiter;\n+import software.amazon.awssdk.services.dynamodb.waiters.DynamoDbWaiter;\n+\n+public class WaitersUserAgentTest {\n+\n+    @Rule\n+    public WireMockRule mockServer = new WireMockRule(options().notifier(new ConsoleNotifier(true)).dynamicHttpsPort());\n+\n+    private DynamoDbClient dynamoDbClient;\n+    private DynamoDbAsyncClient dynamoDbAsyncClient;\n+    private ExecutionInterceptor interceptor;\n+\n+    @Before\n+    public void setup() {\n+        interceptor = Mockito.spy(AbstractExecutionInterceptor.class);\n+\n+        dynamoDbClient = DynamoDbClient.builder()\n+                                       .credentialsProvider(StaticCredentialsProvider.create(AwsBasicCredentials.create(\"test\",\n+                                                                                                                        \"test\")))\n+                                       .region(Region.US_WEST_2)\n+                                       .overrideConfiguration(c -> c.addExecutionInterceptor(interceptor))\n+                                       .build();\n+\n+        dynamoDbAsyncClient = DynamoDbAsyncClient.builder()\n+                                                 .credentialsProvider(StaticCredentialsProvider.create(AwsBasicCredentials\n+                                                                                                           .create(\"test\",\n+                                                                                                                   \"test\")))\n+                                                 .region(Region.US_WEST_2)\n+                                                 .overrideConfiguration(c -> c.addExecutionInterceptor(interceptor))\n+                                                 .build();", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MTE1MDAxNg=="}, "originalCommit": {"oid": "9be7b056bb6767b977e84e1720ebff18fd8192af"}, "originalPosition": 69}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MTI0ODg4OQ==", "bodyText": "Oh I got what you mean, yea I can add the wireMock server.", "url": "https://github.com/aws/aws-sdk-java-v2/pull/2039#discussion_r491248889", "createdAt": "2020-09-19T01:10:10Z", "author": {"login": "Quanzzzz"}, "path": "services/dynamodb/src/test/java/software/amazon/awssdk/services/dynamodb/WaitersUserAgentTest.java", "diffHunk": "@@ -0,0 +1,97 @@\n+/*\n+ * Copyright Amazon.com, Inc. or its affiliates. All Rights Reserved.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\").\n+ * You may not use this file except in compliance with the License.\n+ * A copy of the License is located at\n+ *\n+ *  http://aws.amazon.com/apache2.0\n+ *\n+ * or in the \"license\" file accompanying this file. This file is distributed\n+ * on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either\n+ * express or implied. See the License for the specific language governing\n+ * permissions and limitations under the License.\n+ */\n+\n+package software.amazon.awssdk.services.dynamodb;\n+\n+import static com.github.tomakehurst.wiremock.core.WireMockConfiguration.options;\n+import static org.assertj.core.api.Assertions.assertThatThrownBy;\n+import static org.junit.Assert.assertTrue;\n+\n+import com.github.tomakehurst.wiremock.common.ConsoleNotifier;\n+import com.github.tomakehurst.wiremock.junit.WireMockRule;\n+import java.util.concurrent.CompletableFuture;\n+import org.junit.Before;\n+import org.junit.Rule;\n+import org.junit.Test;\n+import org.mockito.ArgumentCaptor;\n+import org.mockito.Matchers;\n+import org.mockito.Mockito;\n+import software.amazon.awssdk.auth.credentials.AwsBasicCredentials;\n+import software.amazon.awssdk.auth.credentials.StaticCredentialsProvider;\n+import software.amazon.awssdk.core.interceptor.Context;\n+import software.amazon.awssdk.core.interceptor.ExecutionInterceptor;\n+import software.amazon.awssdk.core.util.VersionInfo;\n+import software.amazon.awssdk.core.waiters.WaiterResponse;\n+import software.amazon.awssdk.regions.Region;\n+import software.amazon.awssdk.services.dynamodb.model.DescribeTableRequest;\n+import software.amazon.awssdk.services.dynamodb.model.DescribeTableResponse;\n+import software.amazon.awssdk.services.dynamodb.waiters.DynamoDbAsyncWaiter;\n+import software.amazon.awssdk.services.dynamodb.waiters.DynamoDbWaiter;\n+\n+public class WaitersUserAgentTest {\n+\n+    @Rule\n+    public WireMockRule mockServer = new WireMockRule(options().notifier(new ConsoleNotifier(true)).dynamicHttpsPort());\n+\n+    private DynamoDbClient dynamoDbClient;\n+    private DynamoDbAsyncClient dynamoDbAsyncClient;\n+    private ExecutionInterceptor interceptor;\n+\n+    @Before\n+    public void setup() {\n+        interceptor = Mockito.spy(AbstractExecutionInterceptor.class);\n+\n+        dynamoDbClient = DynamoDbClient.builder()\n+                                       .credentialsProvider(StaticCredentialsProvider.create(AwsBasicCredentials.create(\"test\",\n+                                                                                                                        \"test\")))\n+                                       .region(Region.US_WEST_2)\n+                                       .overrideConfiguration(c -> c.addExecutionInterceptor(interceptor))\n+                                       .build();\n+\n+        dynamoDbAsyncClient = DynamoDbAsyncClient.builder()\n+                                                 .credentialsProvider(StaticCredentialsProvider.create(AwsBasicCredentials\n+                                                                                                           .create(\"test\",\n+                                                                                                                   \"test\")))\n+                                                 .region(Region.US_WEST_2)\n+                                                 .overrideConfiguration(c -> c.addExecutionInterceptor(interceptor))\n+                                                 .build();", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MTE1MDAxNg=="}, "originalCommit": {"oid": "9be7b056bb6767b977e84e1720ebff18fd8192af"}, "originalPosition": 69}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzA4MDIzODYyOnYy", "diffSide": "RIGHT", "path": "services/dynamodb/src/test/java/software/amazon/awssdk/services/dynamodb/WaitersUserAgentTest.java", "isResolved": false, "comments": {"totalCount": 5, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yMVQxNjo1MDozNFrOHVZ4rg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yMVQyMDo0NzozMFrOHVh2Rw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MjIwNjI1NA==", "bodyText": "How long do these tests take to run?", "url": "https://github.com/aws/aws-sdk-java-v2/pull/2039#discussion_r492206254", "createdAt": "2020-09-21T16:50:34Z", "author": {"login": "millems"}, "path": "services/dynamodb/src/test/java/software/amazon/awssdk/services/dynamodb/WaitersUserAgentTest.java", "diffHunk": "@@ -0,0 +1,106 @@\n+/*\n+ * Copyright Amazon.com, Inc. or its affiliates. All Rights Reserved.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\").\n+ * You may not use this file except in compliance with the License.\n+ * A copy of the License is located at\n+ *\n+ *  http://aws.amazon.com/apache2.0\n+ *\n+ * or in the \"license\" file accompanying this file. This file is distributed\n+ * on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either\n+ * express or implied. See the License for the specific language governing\n+ * permissions and limitations under the License.\n+ */\n+\n+package software.amazon.awssdk.services.dynamodb;\n+\n+import static com.github.tomakehurst.wiremock.client.WireMock.aResponse;\n+import static com.github.tomakehurst.wiremock.client.WireMock.any;\n+import static com.github.tomakehurst.wiremock.client.WireMock.stubFor;\n+import static com.github.tomakehurst.wiremock.client.WireMock.urlEqualTo;\n+import static com.github.tomakehurst.wiremock.core.WireMockConfiguration.options;\n+import static org.assertj.core.api.Assertions.assertThatThrownBy;\n+import static org.junit.Assert.assertTrue;\n+import static org.mockito.Mockito.times;\n+\n+import com.github.tomakehurst.wiremock.common.ConsoleNotifier;\n+import com.github.tomakehurst.wiremock.junit.WireMockRule;\n+import java.net.URI;\n+import java.util.concurrent.CompletableFuture;\n+import org.junit.Before;\n+import org.junit.Rule;\n+import org.junit.Test;\n+import org.mockito.ArgumentCaptor;\n+import org.mockito.Matchers;\n+import org.mockito.Mockito;\n+import software.amazon.awssdk.auth.credentials.AwsBasicCredentials;\n+import software.amazon.awssdk.auth.credentials.StaticCredentialsProvider;\n+import software.amazon.awssdk.core.interceptor.Context;\n+import software.amazon.awssdk.core.interceptor.ExecutionInterceptor;\n+import software.amazon.awssdk.core.waiters.WaiterResponse;\n+import software.amazon.awssdk.regions.Region;\n+import software.amazon.awssdk.services.dynamodb.model.DescribeTableRequest;\n+import software.amazon.awssdk.services.dynamodb.model.DescribeTableResponse;\n+import software.amazon.awssdk.services.dynamodb.waiters.DynamoDbAsyncWaiter;\n+import software.amazon.awssdk.services.dynamodb.waiters.DynamoDbWaiter;\n+\n+public class WaitersUserAgentTest {\n+\n+    @Rule\n+    public WireMockRule mockServer = new WireMockRule(options().notifier(new ConsoleNotifier(true)).dynamicHttpsPort());\n+\n+    private DynamoDbClient dynamoDbClient;\n+    private DynamoDbAsyncClient dynamoDbAsyncClient;\n+    private ExecutionInterceptor interceptor;\n+\n+    @Before\n+    public void setup() {\n+        interceptor = Mockito.spy(AbstractExecutionInterceptor.class);\n+\n+        dynamoDbClient = DynamoDbClient.builder()\n+                                       .credentialsProvider(StaticCredentialsProvider.create(AwsBasicCredentials.create(\"test\",\n+                                                                                                                        \"test\")))\n+                                       .region(Region.US_WEST_2)\n+                                       .endpointOverride(URI.create(\"http://localhost:\" + mockServer.port()))\n+                                       .overrideConfiguration(c -> c.addExecutionInterceptor(interceptor))\n+                                       .build();\n+\n+        dynamoDbAsyncClient = DynamoDbAsyncClient.builder()\n+                                                 .credentialsProvider(StaticCredentialsProvider.create(AwsBasicCredentials\n+                                                                                                           .create(\"test\",\n+                                                                                                                   \"test\")))\n+                                                 .region(Region.US_WEST_2)\n+                                                 .endpointOverride(URI.create(\"http://localhost:\" + mockServer.port()))\n+                                                 .overrideConfiguration(c -> c.addExecutionInterceptor(interceptor))\n+                                                 .build();\n+    }\n+\n+    @Test\n+    public void syncWaiters_shouldHaveWaitersUserAgent() {\n+        stubFor(any(urlEqualTo(\"/\")).willReturn(aResponse().withStatus(500)));\n+\n+        DynamoDbWaiter waiter = dynamoDbClient.waiter();\n+        assertThatThrownBy(() -> waiter.waitUntilTableExists(DescribeTableRequest.builder().tableName(\"table\").build())).isNotNull();\n+\n+        ArgumentCaptor<Context.BeforeTransmission> context = ArgumentCaptor.forClass(Context.BeforeTransmission.class);\n+        Mockito.verify(interceptor, times(9)).beforeTransmission(context.capture(), Matchers.any());\n+\n+        assertTrue(context.getValue().httpRequest().headers().get(\"User-Agent\").toString().contains(\"waiter\"));\n+    }", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "194547044f36776b7935c29b9cf84499b0bd3dfc"}, "originalPosition": 90}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MjIzNzk0Ng==", "bodyText": "The sync one takes around 7s, while the async one only takes 98ms, because the sync one does wait for the response. For the async one, the CompletableFuture is cancelled once the user agent is checked.", "url": "https://github.com/aws/aws-sdk-java-v2/pull/2039#discussion_r492237946", "createdAt": "2020-09-21T17:44:20Z", "author": {"login": "Quanzzzz"}, "path": "services/dynamodb/src/test/java/software/amazon/awssdk/services/dynamodb/WaitersUserAgentTest.java", "diffHunk": "@@ -0,0 +1,106 @@\n+/*\n+ * Copyright Amazon.com, Inc. or its affiliates. All Rights Reserved.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\").\n+ * You may not use this file except in compliance with the License.\n+ * A copy of the License is located at\n+ *\n+ *  http://aws.amazon.com/apache2.0\n+ *\n+ * or in the \"license\" file accompanying this file. This file is distributed\n+ * on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either\n+ * express or implied. See the License for the specific language governing\n+ * permissions and limitations under the License.\n+ */\n+\n+package software.amazon.awssdk.services.dynamodb;\n+\n+import static com.github.tomakehurst.wiremock.client.WireMock.aResponse;\n+import static com.github.tomakehurst.wiremock.client.WireMock.any;\n+import static com.github.tomakehurst.wiremock.client.WireMock.stubFor;\n+import static com.github.tomakehurst.wiremock.client.WireMock.urlEqualTo;\n+import static com.github.tomakehurst.wiremock.core.WireMockConfiguration.options;\n+import static org.assertj.core.api.Assertions.assertThatThrownBy;\n+import static org.junit.Assert.assertTrue;\n+import static org.mockito.Mockito.times;\n+\n+import com.github.tomakehurst.wiremock.common.ConsoleNotifier;\n+import com.github.tomakehurst.wiremock.junit.WireMockRule;\n+import java.net.URI;\n+import java.util.concurrent.CompletableFuture;\n+import org.junit.Before;\n+import org.junit.Rule;\n+import org.junit.Test;\n+import org.mockito.ArgumentCaptor;\n+import org.mockito.Matchers;\n+import org.mockito.Mockito;\n+import software.amazon.awssdk.auth.credentials.AwsBasicCredentials;\n+import software.amazon.awssdk.auth.credentials.StaticCredentialsProvider;\n+import software.amazon.awssdk.core.interceptor.Context;\n+import software.amazon.awssdk.core.interceptor.ExecutionInterceptor;\n+import software.amazon.awssdk.core.waiters.WaiterResponse;\n+import software.amazon.awssdk.regions.Region;\n+import software.amazon.awssdk.services.dynamodb.model.DescribeTableRequest;\n+import software.amazon.awssdk.services.dynamodb.model.DescribeTableResponse;\n+import software.amazon.awssdk.services.dynamodb.waiters.DynamoDbAsyncWaiter;\n+import software.amazon.awssdk.services.dynamodb.waiters.DynamoDbWaiter;\n+\n+public class WaitersUserAgentTest {\n+\n+    @Rule\n+    public WireMockRule mockServer = new WireMockRule(options().notifier(new ConsoleNotifier(true)).dynamicHttpsPort());\n+\n+    private DynamoDbClient dynamoDbClient;\n+    private DynamoDbAsyncClient dynamoDbAsyncClient;\n+    private ExecutionInterceptor interceptor;\n+\n+    @Before\n+    public void setup() {\n+        interceptor = Mockito.spy(AbstractExecutionInterceptor.class);\n+\n+        dynamoDbClient = DynamoDbClient.builder()\n+                                       .credentialsProvider(StaticCredentialsProvider.create(AwsBasicCredentials.create(\"test\",\n+                                                                                                                        \"test\")))\n+                                       .region(Region.US_WEST_2)\n+                                       .endpointOverride(URI.create(\"http://localhost:\" + mockServer.port()))\n+                                       .overrideConfiguration(c -> c.addExecutionInterceptor(interceptor))\n+                                       .build();\n+\n+        dynamoDbAsyncClient = DynamoDbAsyncClient.builder()\n+                                                 .credentialsProvider(StaticCredentialsProvider.create(AwsBasicCredentials\n+                                                                                                           .create(\"test\",\n+                                                                                                                   \"test\")))\n+                                                 .region(Region.US_WEST_2)\n+                                                 .endpointOverride(URI.create(\"http://localhost:\" + mockServer.port()))\n+                                                 .overrideConfiguration(c -> c.addExecutionInterceptor(interceptor))\n+                                                 .build();\n+    }\n+\n+    @Test\n+    public void syncWaiters_shouldHaveWaitersUserAgent() {\n+        stubFor(any(urlEqualTo(\"/\")).willReturn(aResponse().withStatus(500)));\n+\n+        DynamoDbWaiter waiter = dynamoDbClient.waiter();\n+        assertThatThrownBy(() -> waiter.waitUntilTableExists(DescribeTableRequest.builder().tableName(\"table\").build())).isNotNull();\n+\n+        ArgumentCaptor<Context.BeforeTransmission> context = ArgumentCaptor.forClass(Context.BeforeTransmission.class);\n+        Mockito.verify(interceptor, times(9)).beforeTransmission(context.capture(), Matchers.any());\n+\n+        assertTrue(context.getValue().httpRequest().headers().get(\"User-Agent\").toString().contains(\"waiter\"));\n+    }", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MjIwNjI1NA=="}, "originalCommit": {"oid": "194547044f36776b7935c29b9cf84499b0bd3dfc"}, "originalPosition": 90}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MjIzOTgwNg==", "bodyText": "Should we use mock clients instead? codegen-generated-classes-test seems like a good place for this test. https://github.com/aws/aws-sdk-java-v2/tree/waiters-development/test/codegen-generated-classes-test/src/test/java/software/amazon/awssdk/services/waiters\nnit, you can just use wiremock's verify method rather than the interceptor\n       verify(postRequestedFor(anyUrl()).withHeader(\"User-Agent\", contains(...));", "url": "https://github.com/aws/aws-sdk-java-v2/pull/2039#discussion_r492239806", "createdAt": "2020-09-21T17:47:28Z", "author": {"login": "zoewangg"}, "path": "services/dynamodb/src/test/java/software/amazon/awssdk/services/dynamodb/WaitersUserAgentTest.java", "diffHunk": "@@ -0,0 +1,106 @@\n+/*\n+ * Copyright Amazon.com, Inc. or its affiliates. All Rights Reserved.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\").\n+ * You may not use this file except in compliance with the License.\n+ * A copy of the License is located at\n+ *\n+ *  http://aws.amazon.com/apache2.0\n+ *\n+ * or in the \"license\" file accompanying this file. This file is distributed\n+ * on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either\n+ * express or implied. See the License for the specific language governing\n+ * permissions and limitations under the License.\n+ */\n+\n+package software.amazon.awssdk.services.dynamodb;\n+\n+import static com.github.tomakehurst.wiremock.client.WireMock.aResponse;\n+import static com.github.tomakehurst.wiremock.client.WireMock.any;\n+import static com.github.tomakehurst.wiremock.client.WireMock.stubFor;\n+import static com.github.tomakehurst.wiremock.client.WireMock.urlEqualTo;\n+import static com.github.tomakehurst.wiremock.core.WireMockConfiguration.options;\n+import static org.assertj.core.api.Assertions.assertThatThrownBy;\n+import static org.junit.Assert.assertTrue;\n+import static org.mockito.Mockito.times;\n+\n+import com.github.tomakehurst.wiremock.common.ConsoleNotifier;\n+import com.github.tomakehurst.wiremock.junit.WireMockRule;\n+import java.net.URI;\n+import java.util.concurrent.CompletableFuture;\n+import org.junit.Before;\n+import org.junit.Rule;\n+import org.junit.Test;\n+import org.mockito.ArgumentCaptor;\n+import org.mockito.Matchers;\n+import org.mockito.Mockito;\n+import software.amazon.awssdk.auth.credentials.AwsBasicCredentials;\n+import software.amazon.awssdk.auth.credentials.StaticCredentialsProvider;\n+import software.amazon.awssdk.core.interceptor.Context;\n+import software.amazon.awssdk.core.interceptor.ExecutionInterceptor;\n+import software.amazon.awssdk.core.waiters.WaiterResponse;\n+import software.amazon.awssdk.regions.Region;\n+import software.amazon.awssdk.services.dynamodb.model.DescribeTableRequest;\n+import software.amazon.awssdk.services.dynamodb.model.DescribeTableResponse;\n+import software.amazon.awssdk.services.dynamodb.waiters.DynamoDbAsyncWaiter;\n+import software.amazon.awssdk.services.dynamodb.waiters.DynamoDbWaiter;\n+\n+public class WaitersUserAgentTest {\n+\n+    @Rule\n+    public WireMockRule mockServer = new WireMockRule(options().notifier(new ConsoleNotifier(true)).dynamicHttpsPort());\n+\n+    private DynamoDbClient dynamoDbClient;\n+    private DynamoDbAsyncClient dynamoDbAsyncClient;\n+    private ExecutionInterceptor interceptor;\n+\n+    @Before\n+    public void setup() {\n+        interceptor = Mockito.spy(AbstractExecutionInterceptor.class);\n+\n+        dynamoDbClient = DynamoDbClient.builder()\n+                                       .credentialsProvider(StaticCredentialsProvider.create(AwsBasicCredentials.create(\"test\",\n+                                                                                                                        \"test\")))\n+                                       .region(Region.US_WEST_2)\n+                                       .endpointOverride(URI.create(\"http://localhost:\" + mockServer.port()))\n+                                       .overrideConfiguration(c -> c.addExecutionInterceptor(interceptor))\n+                                       .build();\n+\n+        dynamoDbAsyncClient = DynamoDbAsyncClient.builder()\n+                                                 .credentialsProvider(StaticCredentialsProvider.create(AwsBasicCredentials\n+                                                                                                           .create(\"test\",\n+                                                                                                                   \"test\")))\n+                                                 .region(Region.US_WEST_2)\n+                                                 .endpointOverride(URI.create(\"http://localhost:\" + mockServer.port()))\n+                                                 .overrideConfiguration(c -> c.addExecutionInterceptor(interceptor))\n+                                                 .build();\n+    }\n+\n+    @Test\n+    public void syncWaiters_shouldHaveWaitersUserAgent() {\n+        stubFor(any(urlEqualTo(\"/\")).willReturn(aResponse().withStatus(500)));\n+\n+        DynamoDbWaiter waiter = dynamoDbClient.waiter();\n+        assertThatThrownBy(() -> waiter.waitUntilTableExists(DescribeTableRequest.builder().tableName(\"table\").build())).isNotNull();\n+\n+        ArgumentCaptor<Context.BeforeTransmission> context = ArgumentCaptor.forClass(Context.BeforeTransmission.class);\n+        Mockito.verify(interceptor, times(9)).beforeTransmission(context.capture(), Matchers.any());\n+\n+        assertTrue(context.getValue().httpRequest().headers().get(\"User-Agent\").toString().contains(\"waiter\"));\n+    }", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MjIwNjI1NA=="}, "originalCommit": {"oid": "194547044f36776b7935c29b9cf84499b0bd3dfc"}, "originalPosition": 90}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MjI1NTg0OQ==", "bodyText": "You could also throw an exception from the interceptor if you want to cancel the calls altogether and just validate the request.", "url": "https://github.com/aws/aws-sdk-java-v2/pull/2039#discussion_r492255849", "createdAt": "2020-09-21T18:15:52Z", "author": {"login": "millems"}, "path": "services/dynamodb/src/test/java/software/amazon/awssdk/services/dynamodb/WaitersUserAgentTest.java", "diffHunk": "@@ -0,0 +1,106 @@\n+/*\n+ * Copyright Amazon.com, Inc. or its affiliates. All Rights Reserved.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\").\n+ * You may not use this file except in compliance with the License.\n+ * A copy of the License is located at\n+ *\n+ *  http://aws.amazon.com/apache2.0\n+ *\n+ * or in the \"license\" file accompanying this file. This file is distributed\n+ * on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either\n+ * express or implied. See the License for the specific language governing\n+ * permissions and limitations under the License.\n+ */\n+\n+package software.amazon.awssdk.services.dynamodb;\n+\n+import static com.github.tomakehurst.wiremock.client.WireMock.aResponse;\n+import static com.github.tomakehurst.wiremock.client.WireMock.any;\n+import static com.github.tomakehurst.wiremock.client.WireMock.stubFor;\n+import static com.github.tomakehurst.wiremock.client.WireMock.urlEqualTo;\n+import static com.github.tomakehurst.wiremock.core.WireMockConfiguration.options;\n+import static org.assertj.core.api.Assertions.assertThatThrownBy;\n+import static org.junit.Assert.assertTrue;\n+import static org.mockito.Mockito.times;\n+\n+import com.github.tomakehurst.wiremock.common.ConsoleNotifier;\n+import com.github.tomakehurst.wiremock.junit.WireMockRule;\n+import java.net.URI;\n+import java.util.concurrent.CompletableFuture;\n+import org.junit.Before;\n+import org.junit.Rule;\n+import org.junit.Test;\n+import org.mockito.ArgumentCaptor;\n+import org.mockito.Matchers;\n+import org.mockito.Mockito;\n+import software.amazon.awssdk.auth.credentials.AwsBasicCredentials;\n+import software.amazon.awssdk.auth.credentials.StaticCredentialsProvider;\n+import software.amazon.awssdk.core.interceptor.Context;\n+import software.amazon.awssdk.core.interceptor.ExecutionInterceptor;\n+import software.amazon.awssdk.core.waiters.WaiterResponse;\n+import software.amazon.awssdk.regions.Region;\n+import software.amazon.awssdk.services.dynamodb.model.DescribeTableRequest;\n+import software.amazon.awssdk.services.dynamodb.model.DescribeTableResponse;\n+import software.amazon.awssdk.services.dynamodb.waiters.DynamoDbAsyncWaiter;\n+import software.amazon.awssdk.services.dynamodb.waiters.DynamoDbWaiter;\n+\n+public class WaitersUserAgentTest {\n+\n+    @Rule\n+    public WireMockRule mockServer = new WireMockRule(options().notifier(new ConsoleNotifier(true)).dynamicHttpsPort());\n+\n+    private DynamoDbClient dynamoDbClient;\n+    private DynamoDbAsyncClient dynamoDbAsyncClient;\n+    private ExecutionInterceptor interceptor;\n+\n+    @Before\n+    public void setup() {\n+        interceptor = Mockito.spy(AbstractExecutionInterceptor.class);\n+\n+        dynamoDbClient = DynamoDbClient.builder()\n+                                       .credentialsProvider(StaticCredentialsProvider.create(AwsBasicCredentials.create(\"test\",\n+                                                                                                                        \"test\")))\n+                                       .region(Region.US_WEST_2)\n+                                       .endpointOverride(URI.create(\"http://localhost:\" + mockServer.port()))\n+                                       .overrideConfiguration(c -> c.addExecutionInterceptor(interceptor))\n+                                       .build();\n+\n+        dynamoDbAsyncClient = DynamoDbAsyncClient.builder()\n+                                                 .credentialsProvider(StaticCredentialsProvider.create(AwsBasicCredentials\n+                                                                                                           .create(\"test\",\n+                                                                                                                   \"test\")))\n+                                                 .region(Region.US_WEST_2)\n+                                                 .endpointOverride(URI.create(\"http://localhost:\" + mockServer.port()))\n+                                                 .overrideConfiguration(c -> c.addExecutionInterceptor(interceptor))\n+                                                 .build();\n+    }\n+\n+    @Test\n+    public void syncWaiters_shouldHaveWaitersUserAgent() {\n+        stubFor(any(urlEqualTo(\"/\")).willReturn(aResponse().withStatus(500)));\n+\n+        DynamoDbWaiter waiter = dynamoDbClient.waiter();\n+        assertThatThrownBy(() -> waiter.waitUntilTableExists(DescribeTableRequest.builder().tableName(\"table\").build())).isNotNull();\n+\n+        ArgumentCaptor<Context.BeforeTransmission> context = ArgumentCaptor.forClass(Context.BeforeTransmission.class);\n+        Mockito.verify(interceptor, times(9)).beforeTransmission(context.capture(), Matchers.any());\n+\n+        assertTrue(context.getValue().httpRequest().headers().get(\"User-Agent\").toString().contains(\"waiter\"));\n+    }", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MjIwNjI1NA=="}, "originalCommit": {"oid": "194547044f36776b7935c29b9cf84499b0bd3dfc"}, "originalPosition": 90}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MjMzNjcxMQ==", "bodyText": "@zoewangg I just tried testing with the mock clients and Mockito.verify(), and it took around 8 mins to get the response and finish the test, not sure what caused that but it seems the WireMock test is much more efficient.", "url": "https://github.com/aws/aws-sdk-java-v2/pull/2039#discussion_r492336711", "createdAt": "2020-09-21T20:47:30Z", "author": {"login": "Quanzzzz"}, "path": "services/dynamodb/src/test/java/software/amazon/awssdk/services/dynamodb/WaitersUserAgentTest.java", "diffHunk": "@@ -0,0 +1,106 @@\n+/*\n+ * Copyright Amazon.com, Inc. or its affiliates. All Rights Reserved.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\").\n+ * You may not use this file except in compliance with the License.\n+ * A copy of the License is located at\n+ *\n+ *  http://aws.amazon.com/apache2.0\n+ *\n+ * or in the \"license\" file accompanying this file. This file is distributed\n+ * on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either\n+ * express or implied. See the License for the specific language governing\n+ * permissions and limitations under the License.\n+ */\n+\n+package software.amazon.awssdk.services.dynamodb;\n+\n+import static com.github.tomakehurst.wiremock.client.WireMock.aResponse;\n+import static com.github.tomakehurst.wiremock.client.WireMock.any;\n+import static com.github.tomakehurst.wiremock.client.WireMock.stubFor;\n+import static com.github.tomakehurst.wiremock.client.WireMock.urlEqualTo;\n+import static com.github.tomakehurst.wiremock.core.WireMockConfiguration.options;\n+import static org.assertj.core.api.Assertions.assertThatThrownBy;\n+import static org.junit.Assert.assertTrue;\n+import static org.mockito.Mockito.times;\n+\n+import com.github.tomakehurst.wiremock.common.ConsoleNotifier;\n+import com.github.tomakehurst.wiremock.junit.WireMockRule;\n+import java.net.URI;\n+import java.util.concurrent.CompletableFuture;\n+import org.junit.Before;\n+import org.junit.Rule;\n+import org.junit.Test;\n+import org.mockito.ArgumentCaptor;\n+import org.mockito.Matchers;\n+import org.mockito.Mockito;\n+import software.amazon.awssdk.auth.credentials.AwsBasicCredentials;\n+import software.amazon.awssdk.auth.credentials.StaticCredentialsProvider;\n+import software.amazon.awssdk.core.interceptor.Context;\n+import software.amazon.awssdk.core.interceptor.ExecutionInterceptor;\n+import software.amazon.awssdk.core.waiters.WaiterResponse;\n+import software.amazon.awssdk.regions.Region;\n+import software.amazon.awssdk.services.dynamodb.model.DescribeTableRequest;\n+import software.amazon.awssdk.services.dynamodb.model.DescribeTableResponse;\n+import software.amazon.awssdk.services.dynamodb.waiters.DynamoDbAsyncWaiter;\n+import software.amazon.awssdk.services.dynamodb.waiters.DynamoDbWaiter;\n+\n+public class WaitersUserAgentTest {\n+\n+    @Rule\n+    public WireMockRule mockServer = new WireMockRule(options().notifier(new ConsoleNotifier(true)).dynamicHttpsPort());\n+\n+    private DynamoDbClient dynamoDbClient;\n+    private DynamoDbAsyncClient dynamoDbAsyncClient;\n+    private ExecutionInterceptor interceptor;\n+\n+    @Before\n+    public void setup() {\n+        interceptor = Mockito.spy(AbstractExecutionInterceptor.class);\n+\n+        dynamoDbClient = DynamoDbClient.builder()\n+                                       .credentialsProvider(StaticCredentialsProvider.create(AwsBasicCredentials.create(\"test\",\n+                                                                                                                        \"test\")))\n+                                       .region(Region.US_WEST_2)\n+                                       .endpointOverride(URI.create(\"http://localhost:\" + mockServer.port()))\n+                                       .overrideConfiguration(c -> c.addExecutionInterceptor(interceptor))\n+                                       .build();\n+\n+        dynamoDbAsyncClient = DynamoDbAsyncClient.builder()\n+                                                 .credentialsProvider(StaticCredentialsProvider.create(AwsBasicCredentials\n+                                                                                                           .create(\"test\",\n+                                                                                                                   \"test\")))\n+                                                 .region(Region.US_WEST_2)\n+                                                 .endpointOverride(URI.create(\"http://localhost:\" + mockServer.port()))\n+                                                 .overrideConfiguration(c -> c.addExecutionInterceptor(interceptor))\n+                                                 .build();\n+    }\n+\n+    @Test\n+    public void syncWaiters_shouldHaveWaitersUserAgent() {\n+        stubFor(any(urlEqualTo(\"/\")).willReturn(aResponse().withStatus(500)));\n+\n+        DynamoDbWaiter waiter = dynamoDbClient.waiter();\n+        assertThatThrownBy(() -> waiter.waitUntilTableExists(DescribeTableRequest.builder().tableName(\"table\").build())).isNotNull();\n+\n+        ArgumentCaptor<Context.BeforeTransmission> context = ArgumentCaptor.forClass(Context.BeforeTransmission.class);\n+        Mockito.verify(interceptor, times(9)).beforeTransmission(context.capture(), Matchers.any());\n+\n+        assertTrue(context.getValue().httpRequest().headers().get(\"User-Agent\").toString().contains(\"waiter\"));\n+    }", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MjIwNjI1NA=="}, "originalCommit": {"oid": "194547044f36776b7935c29b9cf84499b0bd3dfc"}, "originalPosition": 90}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4038, "cost": 1, "resetAt": "2021-11-12T11:18:39Z"}}}