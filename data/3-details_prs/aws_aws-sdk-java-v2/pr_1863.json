{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDI0MTE0MDkz", "number": 1863, "title": "Add apache HTTP request stats", "bodyText": "Description\n\nMotivation and Context\n\n\nTesting\n\n\n\nScreenshots (if appropriate)\nTypes of changes\n\n\n Bug fix (non-breaking change which fixes an issue)\n New feature (non-breaking change which adds functionality)\n\nChecklist\n\n\n\n I have read the CONTRIBUTING document\n Local run of mvn install succeeds\n My code follows the code style of this project\n My change requires a change to the Javadoc documentation\n I have updated the Javadoc documentation accordingly\n I have read the README document\n I have added tests to cover my changes\n All new and existing tests passed\n A short description of the change has been added to the CHANGELOG\n My change is to implement 1.11 parity feature and I have updated LaunchChangelog\n\nLicense\n\n\n\n\n I confirm that this pull request can be released under the Apache 2 license", "createdAt": "2020-05-27T21:06:33Z", "url": "https://github.com/aws/aws-sdk-java-v2/pull/1863", "merged": true, "mergeCommit": {"oid": "299ed84b1ba559932f2c7f701b9b80c68dd1f9cc"}, "closed": true, "closedAt": "2020-05-28T23:59:27Z", "author": {"login": "dagnir"}, "timelineItems": {"totalCount": 5, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABclgDvuAFqTQxOTYxMDkxNw==", "endCursor": "Y3Vyc29yOnYyOpPPAAABcl2pttgBqjMzODUwNjQ2ODQ=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDE5NjEwOTE3", "url": "https://github.com/aws/aws-sdk-java-v2/pull/1863#pullrequestreview-419610917", "createdAt": "2020-05-27T21:10:07Z", "commit": {"oid": "cac6868c4eb2bbe12921122ac54f2883fc2fe00a"}, "state": "COMMENTED", "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yN1QyMToxMDowN1rOGbdQbg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yN1QyMToxMjozMlrOGbdVEA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMTQ0NDA3OA==", "bodyText": "nit, no final on local variable \ud83d\ude1b", "url": "https://github.com/aws/aws-sdk-java-v2/pull/1863#discussion_r431444078", "createdAt": "2020-05-27T21:10:07Z", "author": {"login": "zoewangg"}, "path": "http-clients/apache-client/src/main/java/software/amazon/awssdk/http/apache/ApacheHttpClient.java", "diffHunk": "@@ -206,11 +214,15 @@ private boolean isProxyEnabled(ProxyConfiguration proxyConfiguration) {\n \n     @Override\n     public ExecutableHttpRequest prepareRequest(HttpExecuteRequest request) {\n+        final MetricCollector metricCollector = request.metricCollector().orElseGet(NoOpMetricCollector::create);\n+        metricCollector.reportMetric(HTTP_CLIENT_NAME, clientName());\n         HttpRequestBase apacheRequest = toApacheRequest(request);\n         return new ExecutableHttpRequest() {\n             @Override\n             public HttpExecuteResponse call() throws IOException {\n-                return execute(apacheRequest);\n+                final HttpExecuteResponse executeResponse = execute(apacheRequest);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "cac6868c4eb2bbe12921122ac54f2883fc2fe00a"}, "originalPosition": 40}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMTQ0NTE0MA==", "bodyText": "PENDING_CONNECTION_REQUESTS or PENDING_CONNECTIONS?", "url": "https://github.com/aws/aws-sdk-java-v2/pull/1863#discussion_r431445140", "createdAt": "2020-05-27T21:12:17Z", "author": {"login": "zoewangg"}, "path": "http-client-spi/src/main/java/software/amazon/awssdk/http/HttpMetrics.java", "diffHunk": "@@ -0,0 +1,56 @@\n+/*\n+ * Copyright Amazon.com, Inc. or its affiliates. All Rights Reserved.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\").\n+ * You may not use this file except in compliance with the License.\n+ * A copy of the License is located at\n+ *\n+ *  http://aws.amazon.com/apache2.0\n+ *\n+ * or in the \"license\" file accompanying this file. This file is distributed\n+ * on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either\n+ * express or implied. See the License for the specific language governing\n+ * permissions and limitations under the License.\n+ */\n+\n+package software.amazon.awssdk.http;\n+\n+import software.amazon.awssdk.metrics.MetricCategory;\n+import software.amazon.awssdk.metrics.SdkMetric;\n+\n+/**\n+ * Metrics collected by HTTP clients.\n+ */\n+public final class HttpMetrics {\n+    /**\n+     * The name of the HTTP client.\n+     */\n+    public static final SdkMetric<String> HTTP_CLIENT_NAME = metric(\"HttpClientName\", String.class);\n+\n+    /**\n+     * The maximum number of connections that will be pooled by the HTTP client.\n+     */\n+    public static final SdkMetric<Integer> MAX_CONNECTIONS = metric(\"MaxConnections\", Integer.class);\n+\n+    /**\n+     * The number of idle connections in the connection pool that are ready to serve a request.\n+     */\n+    public static final SdkMetric<Integer> AVAILABLE_CONNECTIONS = metric(\"AvailableConnections\", Integer.class);\n+\n+    /**\n+     * The number of connections from the connection pool that are busy serving requests.\n+     */\n+    public static final SdkMetric<Integer> LEASED_CONNECTIONS = metric(\"LeasedConnections\", Integer.class);\n+\n+    /**\n+     * The number of requests awaiting a free connection from the pool.\n+     */\n+    public static final SdkMetric<Integer> PENDING_REQUESTS = metric(\"PendingRequests\", Integer.class);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "cac6868c4eb2bbe12921122ac54f2883fc2fe00a"}, "originalPosition": 48}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMTQ0NTI2NA==", "bodyText": "Do we need to namespace all sdk metrics?", "url": "https://github.com/aws/aws-sdk-java-v2/pull/1863#discussion_r431445264", "createdAt": "2020-05-27T21:12:32Z", "author": {"login": "zoewangg"}, "path": "http-client-spi/src/main/java/software/amazon/awssdk/http/HttpMetrics.java", "diffHunk": "@@ -0,0 +1,56 @@\n+/*\n+ * Copyright Amazon.com, Inc. or its affiliates. All Rights Reserved.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\").\n+ * You may not use this file except in compliance with the License.\n+ * A copy of the License is located at\n+ *\n+ *  http://aws.amazon.com/apache2.0\n+ *\n+ * or in the \"license\" file accompanying this file. This file is distributed\n+ * on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either\n+ * express or implied. See the License for the specific language governing\n+ * permissions and limitations under the License.\n+ */\n+\n+package software.amazon.awssdk.http;\n+\n+import software.amazon.awssdk.metrics.MetricCategory;\n+import software.amazon.awssdk.metrics.SdkMetric;\n+\n+/**\n+ * Metrics collected by HTTP clients.\n+ */\n+public final class HttpMetrics {\n+    /**\n+     * The name of the HTTP client.\n+     */\n+    public static final SdkMetric<String> HTTP_CLIENT_NAME = metric(\"HttpClientName\", String.class);\n+\n+    /**\n+     * The maximum number of connections that will be pooled by the HTTP client.\n+     */\n+    public static final SdkMetric<Integer> MAX_CONNECTIONS = metric(\"MaxConnections\", Integer.class);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "cac6868c4eb2bbe12921122ac54f2883fc2fe00a"}, "originalPosition": 33}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDE5NjMzODQ1", "url": "https://github.com/aws/aws-sdk-java-v2/pull/1863#pullrequestreview-419633845", "createdAt": "2020-05-27T21:49:13Z", "commit": {"oid": "cac6868c4eb2bbe12921122ac54f2883fc2fe00a"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yN1QyMTo0OToxM1rOGbeYiQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yN1QyMTo0OToxM1rOGbeYiQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMTQ2MjUzNw==", "bodyText": "Do we want to differentiate h2 max connection from it? Is it worth creating a new class for all h2 http metrics such as window size, max streams, etc?", "url": "https://github.com/aws/aws-sdk-java-v2/pull/1863#discussion_r431462537", "createdAt": "2020-05-27T21:49:13Z", "author": {"login": "zoewangg"}, "path": "http-client-spi/src/main/java/software/amazon/awssdk/http/HttpMetrics.java", "diffHunk": "@@ -0,0 +1,56 @@\n+/*\n+ * Copyright Amazon.com, Inc. or its affiliates. All Rights Reserved.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\").\n+ * You may not use this file except in compliance with the License.\n+ * A copy of the License is located at\n+ *\n+ *  http://aws.amazon.com/apache2.0\n+ *\n+ * or in the \"license\" file accompanying this file. This file is distributed\n+ * on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either\n+ * express or implied. See the License for the specific language governing\n+ * permissions and limitations under the License.\n+ */\n+\n+package software.amazon.awssdk.http;\n+\n+import software.amazon.awssdk.metrics.MetricCategory;\n+import software.amazon.awssdk.metrics.SdkMetric;\n+\n+/**\n+ * Metrics collected by HTTP clients.\n+ */\n+public final class HttpMetrics {\n+    /**\n+     * The name of the HTTP client.\n+     */\n+    public static final SdkMetric<String> HTTP_CLIENT_NAME = metric(\"HttpClientName\", String.class);\n+\n+    /**\n+     * The maximum number of connections that will be pooled by the HTTP client.\n+     */\n+    public static final SdkMetric<Integer> MAX_CONNECTIONS = metric(\"MaxConnections\", Integer.class);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "cac6868c4eb2bbe12921122ac54f2883fc2fe00a"}, "originalPosition": 33}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDIwNDUxOTk3", "url": "https://github.com/aws/aws-sdk-java-v2/pull/1863#pullrequestreview-420451997", "createdAt": "2020-05-28T20:05:20Z", "commit": {"oid": "323f8dcf674337414da9b0a9e5b866d1431fc2d4"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "69e0b3c38cc87fa68d2dac3764146167f9d1b3be", "author": {"user": {"login": "dagnir", "name": "Dongie Agnir"}}, "url": "https://github.com/aws/aws-sdk-java-v2/commit/69e0b3c38cc87fa68d2dac3764146167f9d1b3be", "committedDate": "2020-05-28T23:41:30Z", "message": "Add apache HTTP request stats"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "323f8dcf674337414da9b0a9e5b866d1431fc2d4", "author": {"user": {"login": "dagnir", "name": "Dongie Agnir"}}, "url": "https://github.com/aws/aws-sdk-java-v2/commit/323f8dcf674337414da9b0a9e5b866d1431fc2d4", "committedDate": "2020-05-28T19:37:25Z", "message": "Review comments"}, "afterCommit": {"oid": "69e0b3c38cc87fa68d2dac3764146167f9d1b3be", "author": {"user": {"login": "dagnir", "name": "Dongie Agnir"}}, "url": "https://github.com/aws/aws-sdk-java-v2/commit/69e0b3c38cc87fa68d2dac3764146167f9d1b3be", "committedDate": "2020-05-28T23:41:30Z", "message": "Add apache HTTP request stats"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2576, "cost": 1, "resetAt": "2021-11-01T11:59:11Z"}}}