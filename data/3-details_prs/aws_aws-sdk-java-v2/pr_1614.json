{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0MzY2Njg2NjY3", "number": 1614, "title": "Throws IOException for an h2 connection acquiring race condition", "bodyText": "\u2026s picked up at the same time it gets closed\n\nDescription\n\n\nReduce the chances of the race condition where an HTTP2 connection gets reused at the same time it gets inactive\n\n\nThrow IOException instead of IllegalStatementException so the failed requests can be retried.\n\n\nTesting\nAdded unit tests\nScreenshots (if appropriate)\nTypes of changes\n\n\n Bug fix (non-breaking change which fixes an issue)\n New feature (non-breaking change which adds functionality)\n\nChecklist\n\n\n\n I have read the CONTRIBUTING document\n Local run of mvn install succeeds\n My code follows the code style of this project\n My change requires a change to the Javadoc documentation\n I have updated the Javadoc documentation accordingly\n I have read the README document\n I have added tests to cover my changes\n All new and existing tests passed\n A short description of the change has been added to the CHANGELOG\n My change is to implement 1.11 parity feature and I have updated LaunchChangelog\n\nLicense\n\n\n\n\n I confirm that this pull request can be released under the Apache 2 license", "createdAt": "2020-01-24T05:34:46Z", "url": "https://github.com/aws/aws-sdk-java-v2/pull/1614", "merged": true, "mergeCommit": {"oid": "fc58000797e7f5740007f9e91988303ba2b71f26"}, "closed": true, "closedAt": "2020-01-24T21:20:27Z", "author": {"login": "zoewangg"}, "timelineItems": {"totalCount": 5, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABb9kxtJgBqjI5Nzg0Njc1NDY=", "endCursor": "Y3Vyc29yOnYyOpPPAAABb9lcSvAFqTM0ODIyMjE2OA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "b4b739dd3a854dc0b0a24e3d03ffb83ebffca4eb", "author": {"user": {"login": "zoewangg", "name": "Zoe Wang"}}, "url": "https://github.com/aws/aws-sdk-java-v2/commit/b4b739dd3a854dc0b0a24e3d03ffb83ebffca4eb", "committedDate": "2020-01-24T05:32:06Z", "message": "Reduce the chance of the race condition where an http2 connection gets picked up at the same time it gets closed"}, "afterCommit": {"oid": "e9d93a4bbc7ad73e329cf0bc234078be61c187f1", "author": {"user": {"login": "zoewangg", "name": "Zoe Wang"}}, "url": "https://github.com/aws/aws-sdk-java-v2/commit/e9d93a4bbc7ad73e329cf0bc234078be61c187f1", "committedDate": "2020-01-24T20:15:00Z", "message": "Reduce the chance of the race condition where an http2 connection gets picked up at the same time it gets closed"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzQ4MjA2MzU2", "url": "https://github.com/aws/aws-sdk-java-v2/pull/1614#pullrequestreview-348206356", "createdAt": "2020-01-24T20:28:57Z", "commit": {"oid": "e9d93a4bbc7ad73e329cf0bc234078be61c187f1"}, "state": "APPROVED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0yNFQyMDoyODo1N1rOFhpktA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0yNFQyMDoyODo1N1rOFhpktA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MDgyODQ2OA==", "bodyText": "Do we know that this actually helps, or are we just guessing?", "url": "https://github.com/aws/aws-sdk-java-v2/pull/1614#discussion_r370828468", "createdAt": "2020-01-24T20:28:57Z", "author": {"login": "millems"}, "path": "http-clients/netty-nio-client/src/main/java/software/amazon/awssdk/http/nio/netty/internal/http2/MultiplexedChannelRecord.java", "diffHunk": "@@ -248,9 +249,13 @@ public Channel getConnection() {\n         return connection;\n     }\n \n-    public boolean claimStream() {\n+    private boolean claimStream() {\n         lastReserveAttemptTimeMillis = System.currentTimeMillis();\n         for (int attempt = 0; attempt < 5; ++attempt) {\n+            if (!connection.isActive()) {\n+                return false;\n+            }\n+", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "e9d93a4bbc7ad73e329cf0bc234078be61c187f1"}, "originalPosition": 46}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ca6fb14791b317022e48e773e7d0629a26459b43", "author": {"user": {"login": "zoewangg", "name": "Zoe Wang"}}, "url": "https://github.com/aws/aws-sdk-java-v2/commit/ca6fb14791b317022e48e773e7d0629a26459b43", "committedDate": "2020-01-24T20:57:03Z", "message": "Throws `IOException` for the race condition where an http2 connection gets picked up at the same time it gets closed"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "e9d93a4bbc7ad73e329cf0bc234078be61c187f1", "author": {"user": {"login": "zoewangg", "name": "Zoe Wang"}}, "url": "https://github.com/aws/aws-sdk-java-v2/commit/e9d93a4bbc7ad73e329cf0bc234078be61c187f1", "committedDate": "2020-01-24T20:15:00Z", "message": "Reduce the chance of the race condition where an http2 connection gets picked up at the same time it gets closed"}, "afterCommit": {"oid": "ca6fb14791b317022e48e773e7d0629a26459b43", "author": {"user": {"login": "zoewangg", "name": "Zoe Wang"}}, "url": "https://github.com/aws/aws-sdk-java-v2/commit/ca6fb14791b317022e48e773e7d0629a26459b43", "committedDate": "2020-01-24T20:57:03Z", "message": "Throws `IOException` for the race condition where an http2 connection gets picked up at the same time it gets closed"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzQ4MjIyMTY4", "url": "https://github.com/aws/aws-sdk-java-v2/pull/1614#pullrequestreview-348222168", "createdAt": "2020-01-24T21:01:42Z", "commit": {"oid": "ca6fb14791b317022e48e773e7d0629a26459b43"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2634, "cost": 1, "resetAt": "2021-11-01T11:59:11Z"}}}