{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDkzNDA5NDc2", "number": 2066, "title": "add per request waiterOverrideConfiguration overloaded waiter operation", "bodyText": "Description\n\nadd per request waiterOverrideConfiguration overloaded waiter operation\nremove throwOnUnmatchedExceptionWaiter from WaitersRuntime because it would cause async waiter future to hang. unmatched exception is handled in the generic waiter implementations\nadd try-catch in generic async waiter whenComplete block to fix the issue where any exception thrown there could cause the future to hang\nadd more functional tests\n\nMotivation and Context\n\n\nTesting\n\n\n\nScreenshots (if appropriate)\nTypes of changes\n\n\n Bug fix (non-breaking change which fixes an issue)\n New feature (non-breaking change which adds functionality)\n\nChecklist\n\n\n\n I have read the CONTRIBUTING document\n Local run of mvn install succeeds\n My code follows the code style of this project\n My change requires a change to the Javadoc documentation\n I have updated the Javadoc documentation accordingly\n I have read the README document\n I have added tests to cover my changes\n All new and existing tests passed\n A short description of the change has been added to the CHANGELOG\n My change is to implement 1.11 parity feature and I have updated LaunchChangelog\n\nLicense\n\n\n\n\n I confirm that this pull request can be released under the Apache 2 license", "createdAt": "2020-09-25T22:41:30Z", "url": "https://github.com/aws/aws-sdk-java-v2/pull/2066", "merged": true, "mergeCommit": {"oid": "ead3b78d397e3edc4e3089bfa897b778b06cfe42"}, "closed": true, "closedAt": "2020-09-28T18:59:39Z", "author": {"login": "zoewangg"}, "timelineItems": {"totalCount": 5, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdMeCTwAFqTQ5NjkwMzI3OA==", "endCursor": "Y3Vyc29yOnYyOpPPAAABdNXaOrgBqjM4MTU3ODExNDE=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDk2OTAzMjc4", "url": "https://github.com/aws/aws-sdk-java-v2/pull/2066#pullrequestreview-496903278", "createdAt": "2020-09-25T22:51:56Z", "commit": {"oid": "fb5c896df67f33b59ccff992e9787bce2afd35fd"}, "state": "COMMENTED", "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yNVQyMjo1MTo1NlrOHYWfTQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yNVQyMzowMToyMFrOHYW1qg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NTI5NjMzMw==", "bodyText": "Just return the value of the expression", "url": "https://github.com/aws/aws-sdk-java-v2/pull/2066#discussion_r495296333", "createdAt": "2020-09-25T22:51:56Z", "author": {"login": "dagnir"}, "path": "codegen/src/main/resources/software/amazon/awssdk/codegen/waiters/WaitersRuntime.java", "diffHunk": "@@ -502,7 +492,11 @@ public WaiterState waiterState() {\n \n         @Override\n         public boolean matches(SdkResponse response) {\n-            return response.sdkHttpResponse().statusCode() == statusCode;\n+            if (response.sdkHttpResponse() != null &&\n+                response.sdkHttpResponse().statusCode() == statusCode) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "fb5c896df67f33b59ccff992e9787bce2afd35fd"}, "originalPosition": 25}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NTI5NjgxNQ==", "bodyText": "probably more appropriate to use Collections.singletonList", "url": "https://github.com/aws/aws-sdk-java-v2/pull/2066#discussion_r495296815", "createdAt": "2020-09-25T22:52:46Z", "author": {"login": "dagnir"}, "path": "codegen/src/main/resources/software/amazon/awssdk/codegen/waiters/WaitersRuntime.java", "diffHunk": "@@ -33,17 +33,7 @@ private WaitersRuntime() {\n     }\n \n     private static List<WaiterAcceptor<Object>> defaultAcceptors() {\n-        return Arrays.asList(throwOnUnmatchedExceptionWaiter(), retryOnUnmatchedResponseWaiter());\n-    }\n-\n-    private static WaiterAcceptor<Object> throwOnUnmatchedExceptionWaiter() {\n-        return WaiterAcceptor.errorOnExceptionAcceptor(t -> {\n-            if (t instanceof RuntimeException) {\n-                throw (RuntimeException) t;\n-            }\n-\n-            throw SdkClientException.create(\"Encountered unexpected exception.\", t);\n-        });\n+        return Arrays.asList(retryOnUnmatchedResponseWaiter());", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "fb5c896df67f33b59ccff992e9787bce2afd35fd"}, "originalPosition": 15}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NTMwMjA1OA==", "bodyText": "Is it possible to just overload the Waiter run() method to take an the override instead? That way the existing waiter can be reused without instantiating a new one when a override is given. Would also simplify codegen", "url": "https://github.com/aws/aws-sdk-java-v2/pull/2066#discussion_r495302058", "createdAt": "2020-09-25T23:01:20Z", "author": {"login": "dagnir"}, "path": "codegen/src/test/resources/software/amazon/awssdk/codegen/poet/waiters/query-sync-waiter-class.java", "diffHunk": "@@ -66,6 +66,15 @@ private static String errorCode(Throwable error) {\n         return postOperationSuccessWaiter.run(() -> client.aPostOperation(applyWaitersUserAgent(aPostOperationRequest)));\n     }\n \n+    @Override\n+    public WaiterResponse<APostOperationResponse> waitUntilPostOperationSuccess(APostOperationRequest aPostOperationRequest,\n+                                                                                WaiterOverrideConfiguration overrideConfig) {\n+        Waiter<APostOperationResponse> waiter = Waiter.builder(APostOperationResponse.class)\n+                                                      .acceptors(postOperationSuccessWaiterAcceptors())\n+                                                      .overrideConfiguration(postOperationSuccessWaiterConfig(overrideConfig)).build();\n+        return waiter.run(() -> client.aPostOperation(applyWaitersUserAgent(aPostOperationRequest)));", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "fb5c896df67f33b59ccff992e9787bce2afd35fd"}, "originalPosition": 40}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "6721438d17f7f9e52fc810c257c5ee3e14f8dd62", "author": {"user": {"login": "zoewangg", "name": "Zoe Wang"}}, "url": "https://github.com/aws/aws-sdk-java-v2/commit/6721438d17f7f9e52fc810c257c5ee3e14f8dd62", "committedDate": "2020-09-26T00:54:18Z", "message": "Add request override config overload in Waiter"}, "afterCommit": {"oid": "0f97f94d54ff3e74f3310f2e69838542401222a1", "author": {"user": {"login": "zoewangg", "name": "Zoe Wang"}}, "url": "https://github.com/aws/aws-sdk-java-v2/commit/0f97f94d54ff3e74f3310f2e69838542401222a1", "committedDate": "2020-09-28T17:05:25Z", "message": "Add request override config overload in Waiter"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDk3NzM2MDc1", "url": "https://github.com/aws/aws-sdk-java-v2/pull/2066#pullrequestreview-497736075", "createdAt": "2020-09-28T17:11:27Z", "commit": {"oid": "0f97f94d54ff3e74f3310f2e69838542401222a1"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c3de0f765f40055b7f876a0d24faa8f2bcea93d3", "author": {"user": {"login": "zoewangg", "name": "Zoe Wang"}}, "url": "https://github.com/aws/aws-sdk-java-v2/commit/c3de0f765f40055b7f876a0d24faa8f2bcea93d3", "committedDate": "2020-09-28T17:54:19Z", "message": "Add request level override config overload\n\nFixed a bug where an exception thrown in waiterAcceptor could cause the async waiter operations to hang\n\nAdd request override config overload in Waiter"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "0f97f94d54ff3e74f3310f2e69838542401222a1", "author": {"user": {"login": "zoewangg", "name": "Zoe Wang"}}, "url": "https://github.com/aws/aws-sdk-java-v2/commit/0f97f94d54ff3e74f3310f2e69838542401222a1", "committedDate": "2020-09-28T17:05:25Z", "message": "Add request override config overload in Waiter"}, "afterCommit": {"oid": "c3de0f765f40055b7f876a0d24faa8f2bcea93d3", "author": {"user": {"login": "zoewangg", "name": "Zoe Wang"}}, "url": "https://github.com/aws/aws-sdk-java-v2/commit/c3de0f765f40055b7f876a0d24faa8f2bcea93d3", "committedDate": "2020-09-28T17:54:19Z", "message": "Add request level override config overload\n\nFixed a bug where an exception thrown in waiterAcceptor could cause the async waiter operations to hang\n\nAdd request override config overload in Waiter"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2489, "cost": 1, "resetAt": "2021-11-01T11:59:11Z"}}}