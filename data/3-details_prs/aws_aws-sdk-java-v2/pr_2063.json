{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDkyMDM4NTcx", "number": 2063, "title": "Various renaming and provide default values for waiterOverrideConfiguration", "bodyText": "Description\n\nrename {Service}Waiter.Builder#executorService -> {Service}Waiter.Builder#scheduledExecutorService\nrename PollingStratege -> WaiterOverrideConfiguration and Waiter.Builder#pollingStrategy -> Waiter.Builder#overrideConfiguration\nrename WaiterResponse#responseOrExecption -> WaiterResponse#matched\nprovide default values for waiterOverrideConfiguration\nrename maxWaitTime -> waitTimeout\n\nMotivation and Context\n\n\nTesting\n\n\n\nScreenshots (if appropriate)\nTypes of changes\n\n\n Bug fix (non-breaking change which fixes an issue)\n New feature (non-breaking change which adds functionality)\n\nChecklist\n\n\n\n I have read the CONTRIBUTING document\n Local run of mvn install succeeds\n My code follows the code style of this project\n My change requires a change to the Javadoc documentation\n I have updated the Javadoc documentation accordingly\n I have read the README document\n I have added tests to cover my changes\n All new and existing tests passed\n A short description of the change has been added to the CHANGELOG\n My change is to implement 1.11 parity feature and I have updated LaunchChangelog\n\nLicense\n\n\n\n\n I confirm that this pull request can be released under the Apache 2 license", "createdAt": "2020-09-23T21:02:14Z", "url": "https://github.com/aws/aws-sdk-java-v2/pull/2063", "merged": true, "mergeCommit": {"oid": "ebf0fdacc41860c90e8bc537bedba24a5e09ffbb"}, "closed": true, "closedAt": "2020-09-24T00:26:49Z", "author": {"login": "zoewangg"}, "timelineItems": {"totalCount": 5, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdLzQ0iABqjM4MDAyNzI4MjI=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdL1Yl_ABqjM4MDA3ODA3OTc=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "206e95e92aeb640757d058111965efd4d70fff18", "author": {"user": {"login": "zoewangg", "name": "Zoe Wang"}}, "url": "https://github.com/aws/aws-sdk-java-v2/commit/206e95e92aeb640757d058111965efd4d70fff18", "committedDate": "2020-09-23T20:59:11Z", "message": "Various renaming. Create default values for waiterOverrideConfiguration"}, "afterCommit": {"oid": "6ea044294d551eed68356933c2298c8bf769ef0d", "author": {"user": {"login": "zoewangg", "name": "Zoe Wang"}}, "url": "https://github.com/aws/aws-sdk-java-v2/commit/6ea044294d551eed68356933c2298c8bf769ef0d", "committedDate": "2020-09-23T21:13:45Z", "message": "Various renaming. Create default values for waiterOverrideConfiguration"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDk1MDUzMjU3", "url": "https://github.com/aws/aws-sdk-java-v2/pull/2063#pullrequestreview-495053257", "createdAt": "2020-09-23T21:13:31Z", "commit": {"oid": "206e95e92aeb640757d058111965efd4d70fff18"}, "state": "COMMENTED", "comments": {"totalCount": 5, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yM1QyMToxMzozMlrOHXBMiQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yM1QyMToyODoxMVrOHXBnRw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5Mzg5ODg4OQ==", "bodyText": "\"The consumer that will configure the overrideConfiguration\"?", "url": "https://github.com/aws/aws-sdk-java-v2/pull/2063#discussion_r493898889", "createdAt": "2020-09-23T21:13:32Z", "author": {"login": "millems"}, "path": "codegen/src/main/java/software/amazon/awssdk/codegen/docs/WaiterDocs.java", "diffHunk": "@@ -98,28 +98,28 @@ public static CodeBlock waiterCreateMethodJavadoc(ClassName className) {\n \n     public static CodeBlock waiterBuilderPollingStrategy() {\n         String javadocs = new DocumentationBuilder()\n-            .description(\"Defines a {@link $T} to use when polling a resource\")\n-            .param(\"pollingStrategy\", \"the polling strategy to set\")\n+            .description(\"Defines overrides to the default SDK waiter configuration that should be used for waiters created \"\n+                         + \"from this builder\")\n+            .param(\"overrideConfiguration\", \"the override configuration to set\")\n             .returns(\"a reference to this object so that method calls can be chained together.\")\n             .build();\n \n         return CodeBlock.builder()\n-                        .add(javadocs, ClassName.get(PollingStrategy.class))\n+                        .add(javadocs)\n                         .build();\n     }\n \n     public static CodeBlock waiterBuilderPollingStrategyConsumerBuilder() {\n         String javadocs = new DocumentationBuilder()\n-            .description(\"This is a convenient method to pass the configuration of the {@link $T} without the need to \"\n+            .description(\"This is a convenient method to pass the override configuration without the need to \"\n                          + \"create an instance manually via {@link $T.builder()}\")\n-            .param(\"pollingStrategy\", \"the polling strategy to set\")\n-            .see(\"#pollingStrategy(PollingStrategy)\")\n+            .param(\"overrideConfiguration\", \"the override configuration to set\")", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "206e95e92aeb640757d058111965efd4d70fff18"}, "originalPosition": 34}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MzkwMDUwOQ==", "bodyText": "Is it really required? Can we create one with default values? Doesn't feel like override config if it MUST be set.", "url": "https://github.com/aws/aws-sdk-java-v2/pull/2063#discussion_r493900509", "createdAt": "2020-09-23T21:16:42Z", "author": {"login": "millems"}, "path": "core/sdk-core/src/main/java/software/amazon/awssdk/core/internal/waiters/DefaultAsyncWaiter.java", "diffHunk": "@@ -36,16 +36,16 @@\n @SdkInternalApi\n @ThreadSafe\n public final class DefaultAsyncWaiter<T> implements AsyncWaiter<T> {\n-    private final PollingStrategy pollingStrategy;\n+    private final WaiterOverrideConfiguration overrideConfiguration;\n     private final ScheduledExecutorService executorService;\n     private final List<WaiterAcceptor<? super T>> waiterAcceptors;\n     private final AsyncWaiterExecutor<T> handler;\n \n     private DefaultAsyncWaiter(DefaultBuilder<T> builder) {\n         this.executorService = builder.scheduledExecutorService;\n-        this.pollingStrategy = Validate.paramNotNull(builder.pollingStrategy, \"pollingStrategy\");\n+        this.overrideConfiguration = Validate.paramNotNull(builder.overrideConfiguration, \"overrideConfiguration\");", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "6ea044294d551eed68356933c2298c8bf769ef0d"}, "originalPosition": 23}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MzkwMTk1NA==", "bodyText": "I guess this is kind of arbitrary, but 3 attempts with 2 second delay isn't very long to wait. I guess better to be conservative than steal the customer's thread for a long time. Maybe just maxWaitTime of 1 minute?", "url": "https://github.com/aws/aws-sdk-java-v2/pull/2063#discussion_r493901954", "createdAt": "2020-09-23T21:19:55Z", "author": {"login": "millems"}, "path": "core/sdk-core/src/main/java/software/amazon/awssdk/core/internal/waiters/WaiterExecutorHelper.java", "diffHunk": "@@ -32,12 +34,20 @@\n  */\n @SdkInternalApi\n public final class WaiterExecutorHelper<T> {\n+    private static final int DEFAULT_MAX_ATTEMPTS = 3;\n+    private static final BackoffStrategy DEFAULT_BACKOFF_STRATEGY = FixedDelayBackoffStrategy.create(Duration.ofSeconds(2));", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "6ea044294d551eed68356933c2298c8bf769ef0d"}, "originalPosition": 17}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MzkwMjY3MA==", "bodyText": "This is a little confusing. If the customer specifies the maxWaitTime, they might not know to jack up the maxAttempts, which are likely less time consuming to execute than their maxWaitTime if they stuck with the default values.\nI suppose this is no different than the requestTimeout and maxRetries, though. Perhaps we can rename maxWaitTime to waitTimeout to draw the parallel between the RetryPolicy.maxAttempts/WaiterOverrideConfig.maxAttempts and ClientOverrideConfig.requestTimeout/WaiterOverrideConfig.waitTimeout?", "url": "https://github.com/aws/aws-sdk-java-v2/pull/2063#discussion_r493902670", "createdAt": "2020-09-23T21:21:30Z", "author": {"login": "millems"}, "path": "core/sdk-core/src/main/java/software/amazon/awssdk/core/internal/waiters/WaiterExecutorHelper.java", "diffHunk": "@@ -32,12 +34,20 @@\n  */\n @SdkInternalApi\n public final class WaiterExecutorHelper<T> {\n+    private static final int DEFAULT_MAX_ATTEMPTS = 3;\n+    private static final BackoffStrategy DEFAULT_BACKOFF_STRATEGY = FixedDelayBackoffStrategy.create(Duration.ofSeconds(2));\n     private final List<WaiterAcceptor<? super T>> waiterAcceptors;\n-    private final PollingStrategy pollingStrategy;\n+    private final BackoffStrategy backoffStrategy;\n+    private final Duration maxWaitTime;\n+    private final int maxAttempts;\n \n-    public WaiterExecutorHelper(List<WaiterAcceptor<? super T>> waiterAcceptors, PollingStrategy pollingStrategy) {\n+    public WaiterExecutorHelper(List<WaiterAcceptor<? super T>> waiterAcceptors,\n+                                WaiterOverrideConfiguration overrideConfiguration) {\n         this.waiterAcceptors = waiterAcceptors;\n-        this.pollingStrategy = pollingStrategy;\n+        this.backoffStrategy = overrideConfiguration.backoffStrategy().orElse(DEFAULT_BACKOFF_STRATEGY);\n+        this.maxWaitTime = overrideConfiguration.maxWaitTime().orElse(null);\n+        this.maxAttempts = overrideConfiguration.maxAttempts().orElse(DEFAULT_MAX_ATTEMPTS);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "6ea044294d551eed68356933c2298c8bf769ef0d"}, "originalPosition": 31}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MzkwNTczNQ==", "bodyText": "Nit: spacing.", "url": "https://github.com/aws/aws-sdk-java-v2/pull/2063#discussion_r493905735", "createdAt": "2020-09-23T21:28:11Z", "author": {"login": "millems"}, "path": "core/sdk-core/src/main/java/software/amazon/awssdk/core/internal/waiters/WaiterExecutorHelper.java", "diffHunk": "@@ -52,15 +62,13 @@ public WaiterExecutorHelper(List<WaiterAcceptor<? super T>> waiterAcceptors, Pol\n     }\n \n     public long computeNextDelayInMills(int attemptNumber) {\n-        return pollingStrategy.backoffStrategy()\n-                              .computeDelayBeforeNextRetry(RetryPolicyContext.builder()\n-                                                                             .retriesAttempted(attemptNumber)\n-                                                                             .build())\n-                              .toMillis();\n+        return backoffStrategy.computeDelayBeforeNextRetry(RetryPolicyContext.builder()\n+                                                                                   .retriesAttempted(attemptNumber)\n+                                                                                   .build())", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "6ea044294d551eed68356933c2298c8bf769ef0d"}, "originalPosition": 47}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDk1MTE4ODkz", "url": "https://github.com/aws/aws-sdk-java-v2/pull/2063#pullrequestreview-495118893", "createdAt": "2020-09-23T23:30:48Z", "commit": {"oid": "bf863b772a3e03ea3a4810266060c6c5dffeefd4"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "81138f4840e205887b27ffc25fd4ef3b83754e08", "author": {"user": {"login": "zoewangg", "name": "Zoe Wang"}}, "url": "https://github.com/aws/aws-sdk-java-v2/commit/81138f4840e205887b27ffc25fd4ef3b83754e08", "committedDate": "2020-09-23T23:42:04Z", "message": "Various renaming. Create default values for waiterOverrideConfiguration"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "bf863b772a3e03ea3a4810266060c6c5dffeefd4", "author": {"user": {"login": "zoewangg", "name": "Zoe Wang"}}, "url": "https://github.com/aws/aws-sdk-java-v2/commit/bf863b772a3e03ea3a4810266060c6c5dffeefd4", "committedDate": "2020-09-23T23:20:08Z", "message": "Address comments: rename maxWaitTime -> waitTimeout, change default waiter configuration"}, "afterCommit": {"oid": "81138f4840e205887b27ffc25fd4ef3b83754e08", "author": {"user": {"login": "zoewangg", "name": "Zoe Wang"}}, "url": "https://github.com/aws/aws-sdk-java-v2/commit/81138f4840e205887b27ffc25fd4ef3b83754e08", "committedDate": "2020-09-23T23:42:04Z", "message": "Various renaming. Create default values for waiterOverrideConfiguration"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2486, "cost": 1, "resetAt": "2021-11-01T11:59:11Z"}}}