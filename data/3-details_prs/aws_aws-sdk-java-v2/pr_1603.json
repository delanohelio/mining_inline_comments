{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0MzY1NDk1Nzc5", "number": 1603, "title": "Additional logging for GOAWAY", "bodyText": "Description\nShould help during debugging and troubleshooting.\nMotivation and Context\nShould help during debugging and troubleshooting.\nTesting\n\n\n\nScreenshots (if appropriate)\nTypes of changes\n\n\n Bug fix (non-breaking change which fixes an issue)\n New feature (non-breaking change which adds functionality)\n\nChecklist\n\n\n\n I have read the CONTRIBUTING document\n Local run of mvn install succeeds\n My code follows the code style of this project\n My change requires a change to the Javadoc documentation\n I have updated the Javadoc documentation accordingly\n I have read the README document\n I have added tests to cover my changes\n All new and existing tests passed\n A short description of the change has been added to the CHANGELOG\n My change is to implement 1.11 parity feature and I have updated LaunchChangelog\n\nLicense\n\n\n\n\n I confirm that this pull request can be released under the Apache 2 license", "createdAt": "2020-01-21T20:26:46Z", "url": "https://github.com/aws/aws-sdk-java-v2/pull/1603", "merged": true, "mergeCommit": {"oid": "59219bb785e0e87db9e2c93e9de00f0779598fa2"}, "closed": true, "closedAt": "2020-01-24T04:52:16Z", "author": {"login": "dagnir"}, "timelineItems": {"totalCount": 7, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABb8nHqRgH2gAyMzY1NDk1Nzc5OjNlNTZiODg4ZmMzMzM4NmU2MzEwMmQxNDU2OGU0YmYxNzEzYjllMWU=", "endCursor": "Y3Vyc29yOnYyOpPPAAABb9XGlVgH2gAyMzY1NDk1Nzc5OjE0YWJlZjVmODBhNDk0M2JmOTc0ZTRhZTUxMmVkYjkyM2M5OTIwNjY=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "3e56b888fc33386e63102d14568e4bf1713b9e1e", "author": {"user": {"login": "dagnir", "name": "Dongie Agnir"}}, "url": "https://github.com/aws/aws-sdk-java-v2/commit/3e56b888fc33386e63102d14568e4bf1713b9e1e", "committedDate": "2020-01-21T20:25:03Z", "message": "Additional logging for GOAWAY\n\nShould help during debugging and troubleshooting."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzQ2MjM4Mzk0", "url": "https://github.com/aws/aws-sdk-java-v2/pull/1603#pullrequestreview-346238394", "createdAt": "2020-01-21T22:32:31Z", "commit": {"oid": "3e56b888fc33386e63102d14568e4bf1713b9e1e"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0yMVQyMjozMjozMVrOFgLB-w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0yMVQyMjozMjozMVrOFgLB-w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2OTI3OTQ4Mw==", "bodyText": "Still not sure if we should set it to warn as GOAWAY is not uncommon and retry normally should work. Using warn might raise unnecessary concerns.\nCan we add the message in the exception instead?", "url": "https://github.com/aws/aws-sdk-java-v2/pull/1603#discussion_r369279483", "createdAt": "2020-01-21T22:32:31Z", "author": {"login": "zoewangg"}, "path": "http-clients/netty-nio-client/src/main/java/software/amazon/awssdk/http/nio/netty/internal/http2/Http2MultiplexedChannelPool.java", "diffHunk": "@@ -316,7 +316,7 @@ private boolean acquireStreamOnInitializedConnection(MultiplexedChannelRecord ch\n     }\n \n     public void handleGoAway(Channel parentChannel, int lastStreamId, GoAwayException exception) {\n-        log.debug(() -> \"Received GOAWAY on \" + parentChannel + \" with lastStreamId of \" + lastStreamId);\n+        log.warn(() -> \"Received GOAWAY on \" + parentChannel + \" with lastStreamId of \" + lastStreamId);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "3e56b888fc33386e63102d14568e4bf1713b9e1e"}, "originalPosition": 5}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzQ2MjQ3Mzk5", "url": "https://github.com/aws/aws-sdk-java-v2/pull/1603#pullrequestreview-346247399", "createdAt": "2020-01-21T22:51:53Z", "commit": {"oid": "3e56b888fc33386e63102d14568e4bf1713b9e1e"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0yMVQyMjo1MTo1NFrOFgLe5A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0yMVQyMjo1MTo1NFrOFgLe5A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2OTI4Njg4NA==", "bodyText": "Same here. Can we add the message in the exception instead?", "url": "https://github.com/aws/aws-sdk-java-v2/pull/1603#discussion_r369286884", "createdAt": "2020-01-21T22:51:54Z", "author": {"login": "zoewangg"}, "path": "http-clients/netty-nio-client/src/main/java/software/amazon/awssdk/http/nio/netty/internal/http2/MultiplexedChannelRecord.java", "diffHunk": "@@ -81,7 +82,15 @@ boolean acquireStream(Promise<Channel> promise) {\n     private void acquireClaimedStream(Promise<Channel> promise) {\n         doInEventLoop(connection.eventLoop(), () -> {\n             if (state != RecordState.OPEN) {\n-                String message = \"Connection received GOAWAY or was closed while acquiring new stream.\";\n+                String message;\n+                // GOAWAY\n+                if (state == RecordState.CLOSED_TO_NEW) {\n+                    message = String.format(\"Connection %s received GOAWAY with Last Stream ID %d. Unable to open new \"\n+                                            + \"streams on this connection.\", connection, lastStreamId);\n+                } else {\n+                    message = String.format(\"Connection %s was closed while acquiring new stream.\", connection);\n+                }\n+                log.warn(() -> message);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "3e56b888fc33386e63102d14568e4bf1713b9e1e"}, "originalPosition": 21}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a00309b8be1c6876c9af89945951c269d66ab137", "author": {"user": {"login": "dagnir", "name": "Dongie Agnir"}}, "url": "https://github.com/aws/aws-sdk-java-v2/commit/a00309b8be1c6876c9af89945951c269d66ab137", "committedDate": "2020-01-23T18:42:21Z", "message": "Change back to DEBUG level"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzQ3NzAxOTIy", "url": "https://github.com/aws/aws-sdk-java-v2/pull/1603#pullrequestreview-347701922", "createdAt": "2020-01-24T00:52:55Z", "commit": {"oid": "a00309b8be1c6876c9af89945951c269d66ab137"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "9af709d6ea50a7306ada338e8cc275acb6bcc813", "author": {"user": {"login": "dagnir", "name": "Dongie Agnir"}}, "url": "https://github.com/aws/aws-sdk-java-v2/commit/9af709d6ea50a7306ada338e8cc275acb6bcc813", "committedDate": "2020-01-24T00:58:12Z", "message": "Merge branch 'master' into go_away-logging"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "14abef5f80a4943bf974e4ae512edb923c992066", "author": {"user": {"login": "zoewangg", "name": "Zoe Wang"}}, "url": "https://github.com/aws/aws-sdk-java-v2/commit/14abef5f80a4943bf974e4ae512edb923c992066", "committedDate": "2020-01-24T04:19:19Z", "message": "Merge branch 'master' into go_away-logging"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2790, "cost": 1, "resetAt": "2021-11-01T11:59:11Z"}}}