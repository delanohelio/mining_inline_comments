{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTE1NDk3ODk3", "number": 3265, "title": "[editor] Searchable Blocks Implementation", "bodyText": "It would make it easier to find the block you want. There are lots of blocks and it takes time to look for the one you want, especially because they're all placed in one large uncategorized all-inclusive selection with no indication if they're power blocks, terrain, drills, etc. (@RedstonerKBC)\nLittle demonstration:\n\nCloses Anuken/Mindustry-Suggestions#1012.", "createdAt": "2020-11-04T16:27:43Z", "url": "https://github.com/Anuken/Mindustry/pull/3265", "merged": true, "mergeCommit": {"oid": "bfb3cf32f6fc3ea5758fa4708799a1d2f6c7decb"}, "closed": true, "closedAt": "2020-11-06T14:54:35Z", "author": {"login": "summetdev"}, "timelineItems": {"totalCount": 9, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdZQGCWgH2gAyNTE1NDk3ODk3OmVjNjE3MzRmNWQ0Njg3YWVlMTk5NGU3OTliYjg5M2U5Y2U2MGJjOTg=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdZ4FFpgH2gAyNTE1NDk3ODk3OjI1NWQxYzUxMWVmMDdjNmU3Y2JiOWNmMzM1M2YzZmY2MTYwMjZlNjI=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "ec61734f5d4687aee1994e799bb893e9ce60bc98", "author": {"user": {"login": "summetdev", "name": "Andrew Antsiferov"}}, "url": "https://github.com/Anuken/Mindustry/commit/ec61734f5d4687aee1994e799bb893e9ce60bc98", "committedDate": "2020-11-04T16:10:25Z", "message": "[editor] Searchable blocks"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTIzNTUzODk4", "url": "https://github.com/Anuken/Mindustry/pull/3265#pullrequestreview-523553898", "createdAt": "2020-11-04T16:55:09Z", "commit": {"oid": "ec61734f5d4687aee1994e799bb893e9ce60bc98"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "fce5f23a49cb081261807d97f384e9ec28fb231e", "author": {"user": {"login": "summetdev", "name": "Andrew Antsiferov"}}, "url": "https://github.com/Anuken/Mindustry/commit/fce5f23a49cb081261807d97f384e9ec28fb231e", "committedDate": "2020-11-04T18:46:50Z", "message": "[editor] Searchbar <none> label"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c3a57a744c7fdb2afbfc25592dc822953a8625a5", "author": {"user": {"login": "summetdev", "name": "Andrew Antsiferov"}}, "url": "https://github.com/Anuken/Mindustry/commit/c3a57a744c7fdb2afbfc25592dc822953a8625a5", "committedDate": "2020-11-04T19:09:46Z", "message": "Cleanup"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTI0MzQ4NTA4", "url": "https://github.com/Anuken/Mindustry/pull/3265#pullrequestreview-524348508", "createdAt": "2020-11-05T15:00:11Z", "commit": {"oid": "c3a57a744c7fdb2afbfc25592dc822953a8625a5"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTI0NjMzNzAx", "url": "https://github.com/Anuken/Mindustry/pull/3265#pullrequestreview-524633701", "createdAt": "2020-11-05T20:17:49Z", "commit": {"oid": "c3a57a744c7fdb2afbfc25592dc822953a8625a5"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wNVQyMDoxNzo0OVrOHuU5-A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wNVQyMDoxNzo0OVrOHuU5-A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxODMzOTA2NA==", "bodyText": "Should be defined with .table(t -> {/** add field, image, etc*/})\nAlso, 10 is too much padding. Try something like 4-5.", "url": "https://github.com/Anuken/Mindustry/pull/3265#discussion_r518339064", "createdAt": "2020-11-05T20:17:49Z", "author": {"login": "Anuken"}, "path": "core/src/mindustry/editor/MapEditorDialog.java", "diffHunk": "@@ -666,18 +667,34 @@ private void tryExit(){\n     }\n \n     private void addBlockSelection(Table table){\n-        Table content = new Table();\n-        pane = new ScrollPane(content);\n+        blockSelection = new Table();\n+        pane = new ScrollPane(blockSelection);\n         pane.setFadeScrollBars(false);\n         pane.setOverscroll(true, false);\n         pane.exited(() -> {\n             if(pane.hasScroll()){\n                 Core.scene.setScrollFocus(view);\n             }\n         });\n-        ButtonGroup<ImageButton> group = new ButtonGroup<>();\n \n-        int i = 0;\n+        Table searchBar = new Table();\n+        searchBar.image(Icon.zoom);\n+        searchBar.field(\"\", this::rebuildBlockSelection)\n+        .name(\"editor/search\").maxTextLength(maxNameLength).get().setMessageText(\"@players.search\");\n+\n+        table.add(searchBar).pad(10);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c3a57a744c7fdb2afbfc25592dc822953a8625a5"}, "originalPosition": 31}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "275395b5536586a90ce0b79fe20ce90f198963b9", "author": {"user": {"login": "summetdev", "name": "Andrew Antsiferov"}}, "url": "https://github.com/Anuken/Mindustry/commit/275395b5536586a90ce0b79fe20ce90f198963b9", "committedDate": "2020-11-06T11:28:08Z", "message": "Cleanup & Padding changes"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTI1MTkzOTc5", "url": "https://github.com/Anuken/Mindustry/pull/3265#pullrequestreview-525193979", "createdAt": "2020-11-06T14:21:59Z", "commit": {"oid": "275395b5536586a90ce0b79fe20ce90f198963b9"}, "state": "COMMENTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wNlQxNDoyMjowMFrOHuv7QQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wNlQxNDoyMzo0N1rOHuv_OQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxODc4MTc2MQ==", "bodyText": "!searchText.isEmpty() should be put first so it short-circuits and prevents unnecessary contains() checks.", "url": "https://github.com/Anuken/Mindustry/pull/3265#discussion_r518781761", "createdAt": "2020-11-06T14:22:00Z", "author": {"login": "Anuken"}, "path": "core/src/mindustry/editor/MapEditorDialog.java", "diffHunk": "@@ -691,28 +707,32 @@ private void addBlockSelection(Table table){\n             return Integer.compare(b1.id, b2.id);\n         });\n \n+        int i = 0;\n+\n         for(Block block : blocksOut){\n             TextureRegion region = block.icon(Cicon.medium);\n \n-            if(!Core.atlas.isFound(region) || !block.inEditor || (block.buildVisibility == BuildVisibility.debugOnly)) continue;\n+            if(!Core.atlas.isFound(region) || !block.inEditor\n+                    || block.buildVisibility == BuildVisibility.debugOnly\n+                    || (!block.localizedName.toLowerCase().contains(searchText.toLowerCase()) && !searchText.isEmpty())", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "275395b5536586a90ce0b79fe20ce90f198963b9"}, "originalPosition": 60}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxODc4Mjc3Nw==", "bodyText": "Instead of a list, how about this:\n\ninstead of filteredBlocks.isEmpty(), check i == 0\ninstead of filteredBlocks.first();, just set drawBlock to the current when i == 0 and you're iterating", "url": "https://github.com/Anuken/Mindustry/pull/3265#discussion_r518782777", "createdAt": "2020-11-06T14:23:47Z", "author": {"login": "Anuken"}, "path": "core/src/mindustry/editor/MapEditorDialog.java", "diffHunk": "@@ -665,19 +666,34 @@ private void tryExit(){\n         ui.showConfirm(\"@confirm\", \"@editor.unsaved\", this::hide);\n     }\n \n-    private void addBlockSelection(Table table){\n-        Table content = new Table();\n-        pane = new ScrollPane(content);\n+    private void addBlockSelection(Table cont){\n+        blockSelection = new Table();\n+        pane = new ScrollPane(blockSelection);\n         pane.setFadeScrollBars(false);\n         pane.setOverscroll(true, false);\n         pane.exited(() -> {\n             if(pane.hasScroll()){\n                 Core.scene.setScrollFocus(view);\n             }\n         });\n-        ButtonGroup<ImageButton> group = new ButtonGroup<>();\n \n-        int i = 0;\n+        cont.table(search -> {\n+            search.image(Icon.zoom).padRight(8);\n+            search.field(\"\", this::rebuildBlockSelection)\n+            .name(\"editor/search\").maxTextLength(maxNameLength).get().setMessageText(\"@players.search\");\n+        }).pad(5);\n+        cont.row();\n+        cont.table(Tex.underline, extra -> extra.labelWrap(() -> editor.drawBlock.localizedName).width(200f).center()).growX();\n+        cont.row();\n+        cont.add(pane).expandY().top().left();\n+\n+        rebuildBlockSelection(\"\");\n+    }\n+\n+    private void rebuildBlockSelection(String searchText){\n+        blockSelection.clear();\n+\n+        Seq<Block> filteredBlocks = new Seq<>();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "275395b5536586a90ce0b79fe20ce90f198963b9"}, "originalPosition": 44}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "255d1c511ef07c6e7cbb9cf3353f3ff616026e62", "author": {"user": {"login": "summetdev", "name": "Andrew Antsiferov"}}, "url": "https://github.com/Anuken/Mindustry/commit/255d1c511ef07c6e7cbb9cf3353f3ff616026e62", "committedDate": "2020-11-06T14:45:35Z", "message": "Optimization tweaks"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2393, "cost": 1, "resetAt": "2021-10-29T17:30:11Z"}}}