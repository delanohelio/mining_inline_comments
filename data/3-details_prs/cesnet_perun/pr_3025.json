{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTM0MzA4NDc2", "number": 3025, "title": "Validation window for account activation", "bodyText": "Links for password reset and account activation use the same logic, but account\nvalidation should have different validation window.\nNew config property was created to specify account activation validation window\nwith default value 3 days.\nNew column validity_to was added to table pwdreset to specify till when\npassword reset or account activation is valid.", "createdAt": "2020-12-08T09:24:48Z", "url": "https://github.com/CESNET/perun/pull/3025", "merged": true, "mergeCommit": {"oid": "9db512533db538facf8317c30ad1cb256f5f0e97"}, "closed": true, "closedAt": "2020-12-08T11:55:28Z", "author": {"login": "cuadradek"}, "timelineItems": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdkHCaogFqTU0Njk2MTE1Ng==", "endCursor": "Y3Vyc29yOnYyOpPPAAABdkHqXRgFqTU0NzA1NDIyMA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTQ2OTYxMTU2", "url": "https://github.com/CESNET/perun/pull/3025#pullrequestreview-546961156", "createdAt": "2020-12-08T09:42:22Z", "commit": {"oid": "fe7531f0d20dccc614ab20451ba790ce0895b81b"}, "state": "APPROVED", "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0wOFQwOTo0MjoyMlrOIBQOfw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0wOFQwOTo0Njo0NlrOIBQcMw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzODE4NTM0Mw==", "bodyText": "indentation/alignment", "url": "https://github.com/CESNET/perun/pull/3025#discussion_r538185343", "createdAt": "2020-12-08T09:42:22Z", "author": {"login": "zlamalp"}, "path": "perun-base/src/test/resources/test-schema.sql", "diffHunk": "@@ -1264,6 +1264,7 @@ create table pwdreset (\n \tnamespace longvarchar not null,\n \tmail longvarchar,\n \tuser_id integer not null,\n+    validity_to timestamp not null,", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "fe7531f0d20dccc614ab20451ba790ce0895b81b"}, "originalPosition": 13}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzODE4NzMxMw==", "bodyText": "I would prefer using >=.", "url": "https://github.com/CESNET/perun/pull/3025#discussion_r538187313", "createdAt": "2020-12-08T09:44:39Z", "author": {"login": "zlamalp"}, "path": "perun-core/src/main/java/cz/metacentrum/perun/core/impl/UsersManagerImpl.java", "diffHunk": "@@ -1280,14 +1280,12 @@ public void checkPasswordResetRequestIsValid(PerunSession sess, User user, int r\n \t\t\t\tthrow new ConsistencyErrorException(\"Password reset request \" + requestId + \" exists more than once.\");\n \t\t\t}\n \n-\t\t\tint validWindow = BeansUtils.getCoreConfig().getPwdresetValidationWindow();\n-\n \t\t\tPair<String,String> result;\n \t\t\tif (Compatibility.isPostgreSql()) {\n-\t\t\t\tresult = jdbc.queryForObject(\"select namespace, mail from pwdreset where user_id=? and id=? and (created_at > (now() - interval '\" + validWindow + \" hours'))\",\n+\t\t\t\tresult = jdbc.queryForObject(\"select namespace, mail from pwdreset where user_id=? and id=? and validity_to > now()\",", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "fe7531f0d20dccc614ab20451ba790ce0895b81b"}, "originalPosition": 9}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzODE4ODg1MQ==", "bodyText": "indentation/alignment", "url": "https://github.com/CESNET/perun/pull/3025#discussion_r538188851", "createdAt": "2020-12-08T09:46:46Z", "author": {"login": "zlamalp"}, "path": "perun-db/postgres.sql", "diffHunk": "@@ -1259,7 +1259,8 @@ create table pwdreset (\n \tnamespace text not null,\n \tmail text,\n \tuser_id integer not null,\n-\tcreated_at timestamp default statement_timestamp() not null,\n+    validity_to timestamp not null,", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "fe7531f0d20dccc614ab20451ba790ce0895b81b"}, "originalPosition": 11}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ee9ec6df9bd40a60d9eb03fe53c16a30b1909a8a", "author": {"user": {"login": "cuadradek", "name": "Radoslav \u010cerh\u00e1k"}}, "url": "https://github.com/CESNET/perun/commit/ee9ec6df9bd40a60d9eb03fe53c16a30b1909a8a", "committedDate": "2020-12-08T10:15:24Z", "message": "Validation window for account activation\n\n- Links for password reset and account activation use the same logic, but account\nvalidation should have different validation window.\n- New config property was created to specify account activation validation window\nwith default value 3 days.\n- New column validity_to was added to table pwdreset to specify till when\npassword reset or account activation is valid."}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "fe7531f0d20dccc614ab20451ba790ce0895b81b", "author": {"user": {"login": "cuadradek", "name": "Radoslav \u010cerh\u00e1k"}}, "url": "https://github.com/CESNET/perun/commit/fe7531f0d20dccc614ab20451ba790ce0895b81b", "committedDate": "2020-12-08T09:04:57Z", "message": "Validation window for account activation\n\n- Links for password reset and account activation use the same logic, but account\nvalidation should have different validation window.\n- New config property was created to specify account activation validation window\nwith default value 3 days.\n- New column validity_to was added to table pwdreset to specify till when\npassword reset or account activation is valid."}, "afterCommit": {"oid": "ee9ec6df9bd40a60d9eb03fe53c16a30b1909a8a", "author": {"user": {"login": "cuadradek", "name": "Radoslav \u010cerh\u00e1k"}}, "url": "https://github.com/CESNET/perun/commit/ee9ec6df9bd40a60d9eb03fe53c16a30b1909a8a", "committedDate": "2020-12-08T10:15:24Z", "message": "Validation window for account activation\n\n- Links for password reset and account activation use the same logic, but account\nvalidation should have different validation window.\n- New config property was created to specify account activation validation window\nwith default value 3 days.\n- New column validity_to was added to table pwdreset to specify till when\npassword reset or account activation is valid."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTQ3MDU0MjIw", "url": "https://github.com/CESNET/perun/pull/3025#pullrequestreview-547054220", "createdAt": "2020-12-08T10:34:08Z", "commit": {"oid": "ee9ec6df9bd40a60d9eb03fe53c16a30b1909a8a"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1731, "cost": 1, "resetAt": "2021-11-01T13:07:16Z"}}}