{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0Mzg1MjYxMDgx", "number": 2609, "title": "New authorization in UsersManagerEntry", "bodyText": "In UsersManagerEntry was completely replaced the old authorization.\nFor that purpose was updated also perun-roles.yml file with the\npolicies used in the UsersManagerEntry.\nAll PerunBeans which are passed to the methods and already exist in\nPerun are passed also to the authorization, even when a policy does not\nneed them for now. It does not have any effect on the policy evaluation.\nIt erase the necessity to change these methods if the policy will change\nin the future.", "createdAt": "2020-03-08T12:26:23Z", "url": "https://github.com/CESNET/perun/pull/2609", "merged": true, "mergeCommit": {"oid": "8ec1f93177b3c1e2399bd58b5fb939b59c957d6f"}, "closed": true, "closedAt": "2020-07-09T12:04:40Z", "author": {"login": "balcirakpeter"}, "timelineItems": {"totalCount": 7, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcMN-wQgBqjMxMTM2MzgzNjA=", "endCursor": "Y3Vyc29yOnYyOpPPAAABczNsTzgBqjM1MjkzNDA2Mzk=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "4db80e01e825653b90f40b32a5f13bbf96537ec0", "author": {"user": {"login": "balcirakpeter", "name": null}}, "url": "https://github.com/CESNET/perun/commit/4db80e01e825653b90f40b32a5f13bbf96537ec0", "committedDate": "2020-03-08T12:25:54Z", "message": "New authorization in UsersManagerEntry\n\n- In UsersManagerEntry was completely replaced the old authorization.\n- For that purpose was updated also perun-roles.yml file with the\n  policies used in the UsersManagerEntry.\n- All PerunBeans which are passed to the methods and already exist in\n  Perun are passed also to the authorization, even when a policy does not\n  need them for now. It does not have any effect on the policy evaluation.\n  It erase the necessity to change these methods if the policy will change\n  in the future."}, "afterCommit": {"oid": "7c50c86b95b51c7c7fa9f6f9da566b34be98ea73", "author": {"user": {"login": "balcirakpeter", "name": null}}, "url": "https://github.com/CESNET/perun/commit/7c50c86b95b51c7c7fa9f6f9da566b34be98ea73", "committedDate": "2020-03-10T08:10:16Z", "message": "New authorization in UsersManagerEntry\n\n- In UsersManagerEntry was completely replaced the old authorization.\n- For that purpose was updated also perun-roles.yml file with the\n  policies used in the UsersManagerEntry.\n- All PerunBeans which are passed to the methods and already exist in\n  Perun are passed also to the authorization, even when a policy does not\n  need them for now. It does not have any effect on the policy evaluation.\n  It erase the necessity to change these methods if the policy will change\n  in the future."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzczNDc3Mjk3", "url": "https://github.com/CESNET/perun/pull/2609#pullrequestreview-373477297", "createdAt": "2020-03-12T11:32:46Z", "commit": {"oid": "7c50c86b95b51c7c7fa9f6f9da566b34be98ea73"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzc1OTk3MDgy", "url": "https://github.com/CESNET/perun/pull/2609#pullrequestreview-375997082", "createdAt": "2020-03-17T12:43:19Z", "commit": {"oid": "7c50c86b95b51c7c7fa9f6f9da566b34be98ea73"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xN1QxMjo0MzoxOVrOF3ahZA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xN1QxMzoyMzozOFrOF3cAhg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MzY1MDUzMg==", "bodyText": "What about to use 2 methods authorizedInternal in 1 if clause with different objects? Like:\nif(!AuthzResolver.authorizedInternal(sess, \"removeSpecificUserOwner_User_User_policy\", Collections.singletonList(user)) && !AuthzResolver.authorizedInternal(sess, \"removeSpecificUserOwner_User_User_policy\", Collections.singletonList(specificUser))) { .. }", "url": "https://github.com/CESNET/perun/pull/2609#discussion_r393650532", "createdAt": "2020-03-17T12:43:19Z", "author": {"login": "stavamichal"}, "path": "perun-core/src/main/java/cz/metacentrum/perun/core/entry/UsersManagerEntry.java", "diffHunk": "@@ -189,8 +169,9 @@ public void removeSpecificUserOwner(PerunSession sess, User user, User specificU\n \t\tif (user.isServiceUser()) throw new NotSpecificUserExpectedException(user);\n \t\tif (user.isSponsoredUser() && specificUser.isSponsoredUser()) throw new NotSpecificUserExpectedException(specificUser);\n \t\tif (!specificUser.isSpecificUser()) throw new SpecificUserExpectedException(specificUser);\n-\t\tif(!AuthzResolver.isAuthorized(sess, Role.SELF, specificUser) &&\n-\t\t\t!AuthzResolver.isAuthorized(sess, Role.SPONSOR, specificUser)) {\n+\n+\t\t// Authorization can take only specificUser, because it would not work correctly with both User objects.\n+\t\tif(!AuthzResolver.authorizedInternal(sess, \"removeSpecificUserOwner_User_User_policy\", Collections.singletonList(specificUser))) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "7c50c86b95b51c7c7fa9f6f9da566b34be98ea73"}, "originalPosition": 107}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MzY1MDc5NQ==", "bodyText": "What about to use 2 methods authorizedInternal in 1 if clause with different objects? Like:\nif(!AuthzResolver.authorizedInternal(sess, \"addSpecificUserOwner_User_User_policy\", Collections.singletonList(user)) && !AuthzResolver.authorizedInternal(sess, \"addSpecificUserOwner_User_User_policy\", Collections.singletonList(specificUser))) { .. }", "url": "https://github.com/CESNET/perun/pull/2609#discussion_r393650795", "createdAt": "2020-03-17T12:43:44Z", "author": {"login": "stavamichal"}, "path": "perun-core/src/main/java/cz/metacentrum/perun/core/entry/UsersManagerEntry.java", "diffHunk": "@@ -204,8 +185,9 @@ public void addSpecificUserOwner(PerunSession sess, User user, User specificUser\n \t\tif (user.isServiceUser()) throw new NotSpecificUserExpectedException(user);\n \t\tif (user.isSponsoredUser() && specificUser.isSponsoredUser()) throw new NotSpecificUserExpectedException(specificUser);\n \t\tif (!specificUser.isSpecificUser()) throw new SpecificUserExpectedException(specificUser);\n-\t\tif(!AuthzResolver.isAuthorized(sess, Role.SELF, specificUser) &&\n-\t\t\t!AuthzResolver.isAuthorized(sess, Role.SPONSOR, specificUser)) {\n+\n+\t\t// Authorization can take only specificUser, because it would not work correctly with both User objects.\n+\t\tif(!AuthzResolver.authorizedInternal(sess, \"addSpecificUserOwner_User_User_policy\", Collections.singletonList(specificUser))) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "7c50c86b95b51c7c7fa9f6f9da566b34be98ea73"}, "originalPosition": 119}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MzY3NDg4Ng==", "bodyText": "Same question like above.", "url": "https://github.com/CESNET/perun/pull/2609#discussion_r393674886", "createdAt": "2020-03-17T13:23:38Z", "author": {"login": "stavamichal"}, "path": "perun-core/src/main/java/cz/metacentrum/perun/core/entry/UsersManagerEntry.java", "diffHunk": "@@ -382,8 +350,8 @@ public User setSpecificUser(PerunSession sess, User specificUser, SpecificUserTy\n \t\tgetPerunBl().getUsersManagerBl().checkUserExists(sess, owner);\n \t\tgetPerunBl().getUsersManagerBl().checkUserExists(sess, specificUser);\n \n-\t\t// Authorization\n-\t\tif(!AuthzResolver.isAuthorized(sess, Role.PERUNADMIN)) {\n+\t\t// Authorization can take only specificUser, because it would not work correctly with both User objects.\n+\t\tif(!AuthzResolver.authorizedInternal(sess, \"setSpecificUser_User_SpecificUserType_User_policy\", Collections.singletonList(specificUser))) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "7c50c86b95b51c7c7fa9f6f9da566b34be98ea73"}, "originalPosition": 234}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "7c50c86b95b51c7c7fa9f6f9da566b34be98ea73", "author": {"user": {"login": "balcirakpeter", "name": null}}, "url": "https://github.com/CESNET/perun/commit/7c50c86b95b51c7c7fa9f6f9da566b34be98ea73", "committedDate": "2020-03-10T08:10:16Z", "message": "New authorization in UsersManagerEntry\n\n- In UsersManagerEntry was completely replaced the old authorization.\n- For that purpose was updated also perun-roles.yml file with the\n  policies used in the UsersManagerEntry.\n- All PerunBeans which are passed to the methods and already exist in\n  Perun are passed also to the authorization, even when a policy does not\n  need them for now. It does not have any effect on the policy evaluation.\n  It erase the necessity to change these methods if the policy will change\n  in the future."}, "afterCommit": {"oid": "3e8e69187432ed73cead7a49fb5593b7331653e3", "author": {"user": {"login": "balcirakpeter", "name": null}}, "url": "https://github.com/CESNET/perun/commit/3e8e69187432ed73cead7a49fb5593b7331653e3", "committedDate": "2020-03-25T13:43:38Z", "message": "New authorization in UsersManagerEntry\n\n- In UsersManagerEntry was completely replaced the old authorization.\n- For that purpose was updated also perun-roles.yml file with the\n  policies used in the UsersManagerEntry.\n- All PerunBeans which are passed to the methods and already exist in\n  Perun are passed also to the authorization, even when a policy does not\n  need them for now. It does not have any effect on the policy evaluation.\n  It erase the necessity to change these methods if the policy will change\n  in the future."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzg0NTg0MDEz", "url": "https://github.com/CESNET/perun/pull/2609#pullrequestreview-384584013", "createdAt": "2020-03-31T10:04:39Z", "commit": {"oid": "3e8e69187432ed73cead7a49fb5593b7331653e3"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f0c5c26a5fe3996282154306fa2f1ec162a614a4", "author": {"user": {"login": "balcirakpeter", "name": null}}, "url": "https://github.com/CESNET/perun/commit/f0c5c26a5fe3996282154306fa2f1ec162a614a4", "committedDate": "2020-07-09T11:52:58Z", "message": "New authorization in UsersManagerEntry\n\n- In UsersManagerEntry was completely replaced the old authorization.\n- For that purpose was updated also perun-roles.yml file with the\n  policies used in the UsersManagerEntry.\n- All PerunBeans which are passed to the methods and already exist in\n  Perun are passed also to the authorization, even when a policy does not\n  need them for now. It does not have any effect on the policy evaluation.\n  It erase the necessity to change these methods if the policy will change\n  in the future."}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "3e8e69187432ed73cead7a49fb5593b7331653e3", "author": {"user": {"login": "balcirakpeter", "name": null}}, "url": "https://github.com/CESNET/perun/commit/3e8e69187432ed73cead7a49fb5593b7331653e3", "committedDate": "2020-03-25T13:43:38Z", "message": "New authorization in UsersManagerEntry\n\n- In UsersManagerEntry was completely replaced the old authorization.\n- For that purpose was updated also perun-roles.yml file with the\n  policies used in the UsersManagerEntry.\n- All PerunBeans which are passed to the methods and already exist in\n  Perun are passed also to the authorization, even when a policy does not\n  need them for now. It does not have any effect on the policy evaluation.\n  It erase the necessity to change these methods if the policy will change\n  in the future."}, "afterCommit": {"oid": "f0c5c26a5fe3996282154306fa2f1ec162a614a4", "author": {"user": {"login": "balcirakpeter", "name": null}}, "url": "https://github.com/CESNET/perun/commit/f0c5c26a5fe3996282154306fa2f1ec162a614a4", "committedDate": "2020-07-09T11:52:58Z", "message": "New authorization in UsersManagerEntry\n\n- In UsersManagerEntry was completely replaced the old authorization.\n- For that purpose was updated also perun-roles.yml file with the\n  policies used in the UsersManagerEntry.\n- All PerunBeans which are passed to the methods and already exist in\n  Perun are passed also to the authorization, even when a policy does not\n  need them for now. It does not have any effect on the policy evaluation.\n  It erase the necessity to change these methods if the policy will change\n  in the future."}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1456, "cost": 1, "resetAt": "2021-11-01T13:07:16Z"}}}