{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTM0NTIyNTE2", "number": 3028, "reviewThreads": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0wOVQwOTozNTozN1rOFC00Sg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xNFQwODoyNjoxOFrOFE28sg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzM4NTA2ODI2OnYy", "diffSide": "RIGHT", "path": "perun-core/src/main/java/cz/metacentrum/perun/core/entry/MembersManagerEntry.java", "isResolved": false, "comments": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0wOVQwOTozNTozN1rOICLIOw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xNFQwODo1MzoyMVrOIFF5CA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzOTE1MDM5NQ==", "bodyText": "Please, use here the original politic getSponsoredMembers_Vo_policy. The GUI needs it to resolve authorization.", "url": "https://github.com/CESNET/perun/pull/3028#discussion_r539150395", "createdAt": "2020-12-09T09:35:37Z", "author": {"login": "Vojtech-Sassmann"}, "path": "perun-core/src/main/java/cz/metacentrum/perun/core/entry/MembersManagerEntry.java", "diffHunk": "@@ -1434,20 +1434,25 @@ public RichMember sponsorMember(PerunSession session, Member sponsored, User spo\n \n \t@Override\n \tpublic List<RichMember> getSponsoredMembers(PerunSession sess, Vo vo) throws PrivilegeException, VoNotExistsException {\n+\t\t//Filter members based on authorization", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "78588de21e14e49f198710d0a90253a12c23db01"}, "originalPosition": 4}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MTA3MDE5OA==", "bodyText": "Ok, fixed.", "url": "https://github.com/CESNET/perun/pull/3028#discussion_r541070198", "createdAt": "2020-12-11T16:29:09Z", "author": {"login": "metodej"}, "path": "perun-core/src/main/java/cz/metacentrum/perun/core/entry/MembersManagerEntry.java", "diffHunk": "@@ -1434,20 +1434,25 @@ public RichMember sponsorMember(PerunSession session, Member sponsored, User spo\n \n \t@Override\n \tpublic List<RichMember> getSponsoredMembers(PerunSession sess, Vo vo) throws PrivilegeException, VoNotExistsException {\n+\t\t//Filter members based on authorization", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzOTE1MDM5NQ=="}, "originalCommit": {"oid": "78588de21e14e49f198710d0a90253a12c23db01"}, "originalPosition": 4}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MjE5MjAwNQ==", "bodyText": "I think the policy check is still missing.", "url": "https://github.com/CESNET/perun/pull/3028#discussion_r542192005", "createdAt": "2020-12-14T08:23:53Z", "author": {"login": "Vojtech-Sassmann"}, "path": "perun-core/src/main/java/cz/metacentrum/perun/core/entry/MembersManagerEntry.java", "diffHunk": "@@ -1434,20 +1434,25 @@ public RichMember sponsorMember(PerunSession session, Member sponsored, User spo\n \n \t@Override\n \tpublic List<RichMember> getSponsoredMembers(PerunSession sess, Vo vo) throws PrivilegeException, VoNotExistsException {\n+\t\t//Filter members based on authorization", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzOTE1MDM5NQ=="}, "originalCommit": {"oid": "78588de21e14e49f198710d0a90253a12c23db01"}, "originalPosition": 4}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MjIxMDMxMg==", "bodyText": "Sorry, I misunderstood, I hope it's fixed now.", "url": "https://github.com/CESNET/perun/pull/3028#discussion_r542210312", "createdAt": "2020-12-14T08:53:21Z", "author": {"login": "metodej"}, "path": "perun-core/src/main/java/cz/metacentrum/perun/core/entry/MembersManagerEntry.java", "diffHunk": "@@ -1434,20 +1434,25 @@ public RichMember sponsorMember(PerunSession session, Member sponsored, User spo\n \n \t@Override\n \tpublic List<RichMember> getSponsoredMembers(PerunSession sess, Vo vo) throws PrivilegeException, VoNotExistsException {\n+\t\t//Filter members based on authorization", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzOTE1MDM5NQ=="}, "originalCommit": {"oid": "78588de21e14e49f198710d0a90253a12c23db01"}, "originalPosition": 4}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzM4NTA3NTQ1OnYy", "diffSide": "RIGHT", "path": "perun-core/src/main/java/cz/metacentrum/perun/core/entry/MembersManagerEntry.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0wOVQwOTozNzowOFrOICLMiw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xMVQxNjoyOToyM1rOIEAUCw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzOTE1MTQ5OQ==", "bodyText": "The variable name filteredMembers doesn't make much sense anymore, since this method doesn't filter anything.", "url": "https://github.com/CESNET/perun/pull/3028#discussion_r539151499", "createdAt": "2020-12-09T09:37:08Z", "author": {"login": "Vojtech-Sassmann"}, "path": "perun-core/src/main/java/cz/metacentrum/perun/core/entry/MembersManagerEntry.java", "diffHunk": "@@ -1434,20 +1434,25 @@ public RichMember sponsorMember(PerunSession session, Member sponsored, User spo\n \n \t@Override\n \tpublic List<RichMember> getSponsoredMembers(PerunSession sess, Vo vo) throws PrivilegeException, VoNotExistsException {\n+\t\t//Filter members based on authorization\n+\t\treturn getAllSponsoredMembers(sess, vo).stream()\n+\t\t\t.filter(member -> AuthzResolver.authorizedInternal(sess, \"filter-getSponsoredMembers_Vo_policy\", member, vo))\n+\t\t\t.collect(Collectors.toList());\n+\t}\n+\n+\t@Override\n+\tpublic List<RichMember> getAllSponsoredMembers(PerunSession sess, Vo vo) throws PrivilegeException, VoNotExistsException {\n \t\tUtils.checkPerunSession(sess);\n \t\tUtils.notNull(vo, \"vo\");\n \n \t\tperunBl.getVosManagerBl().checkVoExists(sess, vo);\n \n \t\t//Authorization\n-\t\tif(!AuthzResolver.authorizedInternal(sess, \"getSponsoredMembers_Vo_policy\", vo)) {\n-\t\t\tthrow new PrivilegeException(sess, \"getSponsoredMembers\");\n+\t\tif(!AuthzResolver.authorizedInternal(sess, \"getAllSponsoredMembers_Vo_policy\", vo)) {\n+\t\t\tthrow new PrivilegeException(sess, \"getAllSponsoredMembers\");\n \t\t}\n \n-\t\t//Filter members based on authorization\n-\t\tList<Member> filteredMembers = membersManagerBl.getSponsoredMembers(sess, vo).stream()\n-\t\t\t.filter(member -> AuthzResolver.authorizedInternal(sess, \"filter-getSponsoredMembers_Vo_policy\", member, vo))\n-\t\t\t.collect(Collectors.toList());\n+\t\tList<Member> filteredMembers = membersManagerBl.getSponsoredMembers(sess, vo);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "78588de21e14e49f198710d0a90253a12c23db01"}, "originalPosition": 28}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MTA3MDM0Nw==", "bodyText": "Good point, fixed.", "url": "https://github.com/CESNET/perun/pull/3028#discussion_r541070347", "createdAt": "2020-12-11T16:29:23Z", "author": {"login": "metodej"}, "path": "perun-core/src/main/java/cz/metacentrum/perun/core/entry/MembersManagerEntry.java", "diffHunk": "@@ -1434,20 +1434,25 @@ public RichMember sponsorMember(PerunSession session, Member sponsored, User spo\n \n \t@Override\n \tpublic List<RichMember> getSponsoredMembers(PerunSession sess, Vo vo) throws PrivilegeException, VoNotExistsException {\n+\t\t//Filter members based on authorization\n+\t\treturn getAllSponsoredMembers(sess, vo).stream()\n+\t\t\t.filter(member -> AuthzResolver.authorizedInternal(sess, \"filter-getSponsoredMembers_Vo_policy\", member, vo))\n+\t\t\t.collect(Collectors.toList());\n+\t}\n+\n+\t@Override\n+\tpublic List<RichMember> getAllSponsoredMembers(PerunSession sess, Vo vo) throws PrivilegeException, VoNotExistsException {\n \t\tUtils.checkPerunSession(sess);\n \t\tUtils.notNull(vo, \"vo\");\n \n \t\tperunBl.getVosManagerBl().checkVoExists(sess, vo);\n \n \t\t//Authorization\n-\t\tif(!AuthzResolver.authorizedInternal(sess, \"getSponsoredMembers_Vo_policy\", vo)) {\n-\t\t\tthrow new PrivilegeException(sess, \"getSponsoredMembers\");\n+\t\tif(!AuthzResolver.authorizedInternal(sess, \"getAllSponsoredMembers_Vo_policy\", vo)) {\n+\t\t\tthrow new PrivilegeException(sess, \"getAllSponsoredMembers\");\n \t\t}\n \n-\t\t//Filter members based on authorization\n-\t\tList<Member> filteredMembers = membersManagerBl.getSponsoredMembers(sess, vo).stream()\n-\t\t\t.filter(member -> AuthzResolver.authorizedInternal(sess, \"filter-getSponsoredMembers_Vo_policy\", member, vo))\n-\t\t\t.collect(Collectors.toList());\n+\t\tList<Member> filteredMembers = membersManagerBl.getSponsoredMembers(sess, vo);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzOTE1MTQ5OQ=="}, "originalCommit": {"oid": "78588de21e14e49f198710d0a90253a12c23db01"}, "originalPosition": 28}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzQwNjM3Nzg1OnYy", "diffSide": "RIGHT", "path": "perun-core/src/main/java/cz/metacentrum/perun/core/api/MembersManager.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xNFQwODoyMzozNlrOIFEw2g==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xNFQwODo1Mjo0NFrOIFF3gA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MjE5MTgzNA==", "bodyText": "This is probably an incorrect description.", "url": "https://github.com/CESNET/perun/pull/3028#discussion_r542191834", "createdAt": "2020-12-14T08:23:36Z", "author": {"login": "Vojtech-Sassmann"}, "path": "perun-core/src/main/java/cz/metacentrum/perun/core/api/MembersManager.java", "diffHunk": "@@ -1351,6 +1351,16 @@\n \t */\n \tList<RichMember> getSponsoredMembers(PerunSession sess, Vo vo) throws PrivilegeException, VoNotExistsException;\n \n+\t/**\n+\t * Gets list of all sponsored members of a VO.\n+\t *\n+\t * @param sess actor", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "4c9f9edbfb02a8185746db5588a83f80702432e8"}, "originalPosition": 7}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MjIwOTkyMA==", "bodyText": "Fixed.", "url": "https://github.com/CESNET/perun/pull/3028#discussion_r542209920", "createdAt": "2020-12-14T08:52:44Z", "author": {"login": "metodej"}, "path": "perun-core/src/main/java/cz/metacentrum/perun/core/api/MembersManager.java", "diffHunk": "@@ -1351,6 +1351,16 @@\n \t */\n \tList<RichMember> getSponsoredMembers(PerunSession sess, Vo vo) throws PrivilegeException, VoNotExistsException;\n \n+\t/**\n+\t * Gets list of all sponsored members of a VO.\n+\t *\n+\t * @param sess actor", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MjE5MTgzNA=="}, "originalCommit": {"oid": "4c9f9edbfb02a8185746db5588a83f80702432e8"}, "originalPosition": 7}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzQwNjM4ODk4OnYy", "diffSide": "RIGHT", "path": "perun-core/src/main/java/cz/metacentrum/perun/core/entry/MembersManagerEntry.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xNFQwODoyNjoxOFrOIFE3Lg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xNFQwODo1Mjo1NFrOIFF32w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MjE5MzQ1NA==", "bodyText": "This policy should be used in the method getSponsoredMembers. For this method, you should create a new one.", "url": "https://github.com/CESNET/perun/pull/3028#discussion_r542193454", "createdAt": "2020-12-14T08:26:18Z", "author": {"login": "Vojtech-Sassmann"}, "path": "perun-core/src/main/java/cz/metacentrum/perun/core/entry/MembersManagerEntry.java", "diffHunk": "@@ -1434,22 +1434,27 @@ public RichMember sponsorMember(PerunSession session, Member sponsored, User spo\n \n \t@Override\n \tpublic List<RichMember> getSponsoredMembers(PerunSession sess, Vo vo) throws PrivilegeException, VoNotExistsException {\n+\t\t//Filter members based on authorization\n+\t\treturn getAllSponsoredMembers(sess, vo).stream()\n+\t\t\t.filter(member -> AuthzResolver.authorizedInternal(sess, \"filter-getSponsoredMembers_Vo_policy\", member, vo))\n+\t\t\t.collect(Collectors.toList());\n+\t}\n+\n+\t@Override\n+\tpublic List<RichMember> getAllSponsoredMembers(PerunSession sess, Vo vo) throws PrivilegeException, VoNotExistsException {\n \t\tUtils.checkPerunSession(sess);\n \t\tUtils.notNull(vo, \"vo\");\n \n \t\tperunBl.getVosManagerBl().checkVoExists(sess, vo);\n \n \t\t//Authorization\n \t\tif(!AuthzResolver.authorizedInternal(sess, \"getSponsoredMembers_Vo_policy\", vo)) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "4c9f9edbfb02a8185746db5588a83f80702432e8"}, "originalPosition": 18}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MjIxMDAxMQ==", "bodyText": "Fixed.", "url": "https://github.com/CESNET/perun/pull/3028#discussion_r542210011", "createdAt": "2020-12-14T08:52:54Z", "author": {"login": "metodej"}, "path": "perun-core/src/main/java/cz/metacentrum/perun/core/entry/MembersManagerEntry.java", "diffHunk": "@@ -1434,22 +1434,27 @@ public RichMember sponsorMember(PerunSession session, Member sponsored, User spo\n \n \t@Override\n \tpublic List<RichMember> getSponsoredMembers(PerunSession sess, Vo vo) throws PrivilegeException, VoNotExistsException {\n+\t\t//Filter members based on authorization\n+\t\treturn getAllSponsoredMembers(sess, vo).stream()\n+\t\t\t.filter(member -> AuthzResolver.authorizedInternal(sess, \"filter-getSponsoredMembers_Vo_policy\", member, vo))\n+\t\t\t.collect(Collectors.toList());\n+\t}\n+\n+\t@Override\n+\tpublic List<RichMember> getAllSponsoredMembers(PerunSession sess, Vo vo) throws PrivilegeException, VoNotExistsException {\n \t\tUtils.checkPerunSession(sess);\n \t\tUtils.notNull(vo, \"vo\");\n \n \t\tperunBl.getVosManagerBl().checkVoExists(sess, vo);\n \n \t\t//Authorization\n \t\tif(!AuthzResolver.authorizedInternal(sess, \"getSponsoredMembers_Vo_policy\", vo)) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MjE5MzQ1NA=="}, "originalCommit": {"oid": "4c9f9edbfb02a8185746db5588a83f80702432e8"}, "originalPosition": 18}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2220, "cost": 1, "resetAt": "2021-11-12T18:49:56Z"}}}