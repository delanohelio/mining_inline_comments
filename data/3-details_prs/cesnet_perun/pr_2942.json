{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTA4OTI0NTY2", "number": 2942, "title": "New hash data format", "bodyText": "We needed to adjust to generated format so it can be easily proccessed\nin scripts.\nThe generator logic should be refactored since the generated format\nhas changed and it could be much better designed.", "createdAt": "2020-10-23T12:13:06Z", "url": "https://github.com/CESNET/perun/pull/2942", "merged": true, "mergeCommit": {"oid": "b431e20c7af7c93e86e96dba5e456f8d09709332"}, "closed": true, "closedAt": "2020-10-30T19:14:23Z", "author": {"login": "Vojtech-Sassmann"}, "timelineItems": {"totalCount": 8, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdVVsDRABqjM5MTM2OTQwNjU=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdXroDzAFqTUyMDk1Nzk0Ng==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "e321358e105c326ddcd0c01d9a830f44df119395", "author": {"user": {"login": "Vojtech-Sassmann", "name": "Vojt\u011bch Sassmann"}}, "url": "https://github.com/CESNET/perun/commit/e321358e105c326ddcd0c01d9a830f44df119395", "committedDate": "2020-10-23T12:09:31Z", "message": "New has data format\n\n* We needed to adjust to generated format so it can be easily proccessed\nin scripts.\n* The generator logic should be refactored since the generated format\nhas changed and it could be much better designed."}, "afterCommit": {"oid": "1aa797ba99b4e7e7105f4ccfa71c8a6a8d1cfb1b", "author": {"user": {"login": "Vojtech-Sassmann", "name": "Vojt\u011bch Sassmann"}}, "url": "https://github.com/CESNET/perun/commit/1aa797ba99b4e7e7105f4ccfa71c8a6a8d1cfb1b", "committedDate": "2020-10-23T12:25:32Z", "message": "New has data format\n\n* We needed to adjust to generated format so it can be easily proccessed\nin scripts.\n* The generator logic should be refactored since the generated format\nhas changed and it could be much better designed."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTE2NzcxNjk5", "url": "https://github.com/CESNET/perun/pull/2942#pullrequestreview-516771699", "createdAt": "2020-10-26T13:25:33Z", "commit": {"oid": "1aa797ba99b4e7e7105f4ccfa71c8a6a8d1cfb1b"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yNlQxMzoyNTozM1rOHoPVAw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yNlQxMzoyNjozNVrOHoPXlA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMTk1NjIyNw==", "bodyText": "These are all members on the facility, right?", "url": "https://github.com/CESNET/perun/pull/2942#discussion_r511956227", "createdAt": "2020-10-26T13:25:33Z", "author": {"login": "stavamichal"}, "path": "perun-core/src/main/java/cz/metacentrum/perun/core/api/ServicesManager.java", "diffHunk": "@@ -380,30 +380,24 @@\n \t *\n \t * attributes: {...hashes...}\n \t * hierarchy: {\n-\t *    ** facility **\n-\t *    hashes: [...hashes...]\n-\t *    members: []\n-\t *    children: [\n-\t *      {\n-\t *        ** resource1 **\n-\t *        hashes: [...hashes...]\n-\t *        children: []\n-\t *        members: [\n-\t *          {\n-\t *            ** member 1 **\n-\t *            hashes: [...hashes...]\n-\t *          },\n-\t *          {\n-\t *            ** member 2 **\n-\t *            ...\n-\t *          }\n-\t *        ]\n-\t *      },\n-\t *      {\n-\t *        ** resource2 **\n-\t *        ...\n-\t *      }\n-\t *    ]\n+\t *   \"1\": {    ** facility id **\n+\t *     members: {    ** all members on resource **", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "1aa797ba99b4e7e7105f4ccfa71c8a6a8d1cfb1b"}, "originalPosition": 29}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMTk1NjQ5NQ==", "bodyText": "These should be all members on the resource 2.", "url": "https://github.com/CESNET/perun/pull/2942#discussion_r511956495", "createdAt": "2020-10-26T13:25:58Z", "author": {"login": "stavamichal"}, "path": "perun-core/src/main/java/cz/metacentrum/perun/core/api/ServicesManager.java", "diffHunk": "@@ -380,30 +380,24 @@\n \t *\n \t * attributes: {...hashes...}\n \t * hierarchy: {\n-\t *    ** facility **\n-\t *    hashes: [...hashes...]\n-\t *    members: []\n-\t *    children: [\n-\t *      {\n-\t *        ** resource1 **\n-\t *        hashes: [...hashes...]\n-\t *        children: []\n-\t *        members: [\n-\t *          {\n-\t *            ** member 1 **\n-\t *            hashes: [...hashes...]\n-\t *          },\n-\t *          {\n-\t *            ** member 2 **\n-\t *            ...\n-\t *          }\n-\t *        ]\n-\t *      },\n-\t *      {\n-\t *        ** resource2 **\n-\t *        ...\n-\t *      }\n-\t *    ]\n+\t *   \"1\": {    ** facility id **\n+\t *     members: {    ** all members on resource **\n+\t *        \"4\" : 5,    ** member id : user id **\n+\t *        \"6\" : 7,    ** member id : user id **\n+\t *       ...\n+\t *     }\n+\t *     children: [\n+\t *       \"2\": {    ** resource id **\n+\t *         children: []\n+\t *         members: {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "1aa797ba99b4e7e7105f4ccfa71c8a6a8d1cfb1b"}, "originalPosition": 37}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMTk1Njg4NA==", "bodyText": "The same for all other places where this Javadoc is used.", "url": "https://github.com/CESNET/perun/pull/2942#discussion_r511956884", "createdAt": "2020-10-26T13:26:35Z", "author": {"login": "stavamichal"}, "path": "perun-core/src/main/java/cz/metacentrum/perun/core/api/ServicesManager.java", "diffHunk": "@@ -380,30 +380,24 @@\n \t *\n \t * attributes: {...hashes...}\n \t * hierarchy: {\n-\t *    ** facility **\n-\t *    hashes: [...hashes...]\n-\t *    members: []\n-\t *    children: [\n-\t *      {\n-\t *        ** resource1 **\n-\t *        hashes: [...hashes...]\n-\t *        children: []\n-\t *        members: [\n-\t *          {\n-\t *            ** member 1 **\n-\t *            hashes: [...hashes...]\n-\t *          },\n-\t *          {\n-\t *            ** member 2 **\n-\t *            ...\n-\t *          }\n-\t *        ]\n-\t *      },\n-\t *      {\n-\t *        ** resource2 **\n-\t *        ...\n-\t *      }\n-\t *    ]\n+\t *   \"1\": {    ** facility id **\n+\t *     members: {    ** all members on resource **", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMTk1NjIyNw=="}, "originalCommit": {"oid": "1aa797ba99b4e7e7105f4ccfa71c8a6a8d1cfb1b"}, "originalPosition": 29}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "1aa797ba99b4e7e7105f4ccfa71c8a6a8d1cfb1b", "author": {"user": {"login": "Vojtech-Sassmann", "name": "Vojt\u011bch Sassmann"}}, "url": "https://github.com/CESNET/perun/commit/1aa797ba99b4e7e7105f4ccfa71c8a6a8d1cfb1b", "committedDate": "2020-10-23T12:25:32Z", "message": "New has data format\n\n* We needed to adjust to generated format so it can be easily proccessed\nin scripts.\n* The generator logic should be refactored since the generated format\nhas changed and it could be much better designed."}, "afterCommit": {"oid": "0c282819932fece1a9b52603b124f9ba4edd83e2", "author": {"user": {"login": "Vojtech-Sassmann", "name": "Vojt\u011bch Sassmann"}}, "url": "https://github.com/CESNET/perun/commit/0c282819932fece1a9b52603b124f9ba4edd83e2", "committedDate": "2020-10-26T16:20:08Z", "message": "New has data format\n\n* We needed to adjust to generated format so it can be easily proccessed\nin scripts.\n* The generator logic should be refactored since the generated format\nhas changed and it could be much better designed."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTE3NTcwODUx", "url": "https://github.com/CESNET/perun/pull/2942#pullrequestreview-517570851", "createdAt": "2020-10-27T10:50:06Z", "commit": {"oid": "0c282819932fece1a9b52603b124f9ba4edd83e2"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 6, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yN1QxMDo1MDowNlrOHo14fA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yN1QxMDo1NzoyM1rOHo2OSQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMjU4NzkwMA==", "bodyText": "Shouldn't hashes: [...hashes...] be removed also from this class javadoc? It was removed from services manager methods API docs.", "url": "https://github.com/CESNET/perun/pull/2942#discussion_r512587900", "createdAt": "2020-10-27T10:50:06Z", "author": {"login": "zlamalp"}, "path": "perun-core/src/main/java/cz/metacentrum/perun/core/provisioning/HierarchicalHashedDataGenerator.java", "diffHunk": "@@ -54,6 +56,7 @@\n \tprivate final Service service;\n \tprivate final Facility facility;\n \tprivate final GenDataProvider dataProvider;\n+\tprivate final Set<Member> allMembers = new HashSet<>();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "0c282819932fece1a9b52603b124f9ba4edd83e2"}, "originalPosition": 26}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMjU5MDIzMw==", "bodyText": "Shouldn't hashes: [...hashes...] be removed also from this class javadoc? It was removed from services manager methods API docs.", "url": "https://github.com/CESNET/perun/pull/2942#discussion_r512590233", "createdAt": "2020-10-27T10:53:01Z", "author": {"login": "zlamalp"}, "path": "perun-core/src/main/java/cz/metacentrum/perun/core/provisioning/GroupsHashedDataGenerator.java", "diffHunk": "@@ -68,6 +68,7 @@\n \tprivate final Facility facility;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "0c282819932fece1a9b52603b124f9ba4edd83e2"}, "originalPosition": 26}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMjU5MTczNA==", "bodyText": "Variable resourceAttrHashes is not used.", "url": "https://github.com/CESNET/perun/pull/2942#discussion_r512591734", "createdAt": "2020-10-27T10:55:07Z", "author": {"login": "zlamalp"}, "path": "perun-core/src/main/java/cz/metacentrum/perun/core/provisioning/HierarchicalHashedDataGenerator.java", "diffHunk": "@@ -94,18 +99,19 @@ private GenDataNode getDataForResource(Resource resource) {\n \t\t} else {\n \t\t\tmembers = sess.getPerunBl().getResourcesManagerBl().getAllowedMembers(sess, resource);\n \t\t}\n+\t\tallMembers.addAll(members);\n \n \t\tdataProvider.loadResourceAttributes(resource, members, false);\n \n \t\tList<String> resourceAttrHashes = dataProvider.getResourceAttributesHashes(resource, false);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "0c282819932fece1a9b52603b124f9ba4edd83e2"}, "originalPosition": 65}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMjU5MjI3MQ==", "bodyText": "facilityAttrHashes is not used anywhere.", "url": "https://github.com/CESNET/perun/pull/2942#discussion_r512592271", "createdAt": "2020-10-27T10:55:51Z", "author": {"login": "zlamalp"}, "path": "perun-core/src/main/java/cz/metacentrum/perun/core/provisioning/HierarchicalHashedDataGenerator.java", "diffHunk": "@@ -72,19 +75,21 @@ public HashedGenData generateData() {\n \t\tList<Resource> resources =\n \t\t\t\tsess.getPerunBl().getFacilitiesManagerBl().getAssignedResources(sess, facility, null, service);\n \n-\t\tList<GenDataNode> childNodes = resources.stream()\n-\t\t\t\t.map(this::getDataForResource)\n-\t\t\t\t.collect(Collectors.toList());\n+\t\tMap<Integer, GenDataNode> childNodes = resources.stream()\n+\t\t\t\t.collect(toMap(Resource::getId, this::getDataForResource));\n \n \t\tList<String> facilityAttrHashes = dataProvider.getFacilityAttributesHashes();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "0c282819932fece1a9b52603b124f9ba4edd83e2"}, "originalPosition": 40}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMjU5MzI4NA==", "bodyText": "resourceAttrHashes is not used.", "url": "https://github.com/CESNET/perun/pull/2942#discussion_r512593284", "createdAt": "2020-10-27T10:57:10Z", "author": {"login": "zlamalp"}, "path": "perun-core/src/main/java/cz/metacentrum/perun/core/provisioning/GroupsHashedDataGenerator.java", "diffHunk": "@@ -106,26 +109,27 @@ private GenDataNode getDataForResource(Resource resource) {\n \t\t} else {\n \t\t\tmembers = sess.getPerunBl().getResourcesManagerBl().getAllowedMembers(sess, resource);\n \t\t}\n+\t\tallMembers.addAll(members);\n \n \t\tdataProvider.loadResourceAttributes(resource, members, true);\n \n \t\tList<String> resourceAttrHashes = dataProvider.getResourceAttributesHashes(resource, true);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "0c282819932fece1a9b52603b124f9ba4edd83e2"}, "originalPosition": 68}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMjU5MzQ4MQ==", "bodyText": "facilityAttrHashes is not used.", "url": "https://github.com/CESNET/perun/pull/2942#discussion_r512593481", "createdAt": "2020-10-27T10:57:23Z", "author": {"login": "zlamalp"}, "path": "perun-core/src/main/java/cz/metacentrum/perun/core/provisioning/GroupsHashedDataGenerator.java", "diffHunk": "@@ -84,19 +85,21 @@ public HashedGenData generateData() {\n \n \t\tList<Resource> resources = sess.getPerunBl().getFacilitiesManagerBl().getAssignedResources(sess, facility, null, service);\n \n-\t\tList<GenDataNode> childNodes = resources.stream()\n-\t\t\t\t.map(this::getDataForResource)\n-\t\t\t\t.collect(Collectors.toList());\n+\t\tMap<Integer, GenDataNode> childNodes = resources.stream()\n+\t\t\t\t.collect(toMap(Resource::getId, this::getDataForResource));\n \n \t\tList<String> facilityAttrHashes = dataProvider.getFacilityAttributesHashes();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "0c282819932fece1a9b52603b124f9ba4edd83e2"}, "originalPosition": 43}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "1f3a4deb322c1c49bb8c059046ad13fe79d044c4", "author": {"user": {"login": "Vojtech-Sassmann", "name": "Vojt\u011bch Sassmann"}}, "url": "https://github.com/CESNET/perun/commit/1f3a4deb322c1c49bb8c059046ad13fe79d044c4", "committedDate": "2020-10-30T09:38:01Z", "message": "New has data format\n\n* We needed to adjust to generated format so it can be easily proccessed\nin scripts.\n* The generator logic should be refactored since the generated format\nhas changed and it could be much better designed."}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "0c282819932fece1a9b52603b124f9ba4edd83e2", "author": {"user": {"login": "Vojtech-Sassmann", "name": "Vojt\u011bch Sassmann"}}, "url": "https://github.com/CESNET/perun/commit/0c282819932fece1a9b52603b124f9ba4edd83e2", "committedDate": "2020-10-26T16:20:08Z", "message": "New has data format\n\n* We needed to adjust to generated format so it can be easily proccessed\nin scripts.\n* The generator logic should be refactored since the generated format\nhas changed and it could be much better designed."}, "afterCommit": {"oid": "1f3a4deb322c1c49bb8c059046ad13fe79d044c4", "author": {"user": {"login": "Vojtech-Sassmann", "name": "Vojt\u011bch Sassmann"}}, "url": "https://github.com/CESNET/perun/commit/1f3a4deb322c1c49bb8c059046ad13fe79d044c4", "committedDate": "2020-10-30T09:38:01Z", "message": "New has data format\n\n* We needed to adjust to generated format so it can be easily proccessed\nin scripts.\n* The generator logic should be refactored since the generated format\nhas changed and it could be much better designed."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTIwNTE2NzQy", "url": "https://github.com/CESNET/perun/pull/2942#pullrequestreview-520516742", "createdAt": "2020-10-30T09:53:41Z", "commit": {"oid": "1f3a4deb322c1c49bb8c059046ad13fe79d044c4"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTIwOTU3OTQ2", "url": "https://github.com/CESNET/perun/pull/2942#pullrequestreview-520957946", "createdAt": "2020-10-30T19:07:10Z", "commit": {"oid": "1f3a4deb322c1c49bb8c059046ad13fe79d044c4"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1107, "cost": 1, "resetAt": "2021-11-01T13:07:16Z"}}}