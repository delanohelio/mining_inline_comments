{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTExNjE2NzE2", "number": 2955, "title": "New SPONSORSHIP role", "bodyText": "We needed to able in the policies to be able distinguish sponsorhips\nof the principal. Therefore, a new role SPONSORSHIP is added.\nThe new role SPONSORSHIP is not saved in DB, but is resolved\nfrom the members_sponsored table.\nNow, in the refreshAuthz method, are also added records to principal\nroles for this role. For each sponship of the principal there is\ninformation about who is he sponsoring.", "createdAt": "2020-10-28T15:03:10Z", "url": "https://github.com/CESNET/perun/pull/2955", "merged": true, "mergeCommit": {"oid": "ab181ab4bdb2475f53a523e4df71906e3a685ee8"}, "closed": true, "closedAt": "2020-10-28T17:19:36Z", "author": {"login": "Vojtech-Sassmann"}, "timelineItems": {"totalCount": 8, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdW_DcagBqjM5MzE4MTEyMDU=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdXAlBiAFqTUxODg4Njk2NQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "091bea1a27ef60f30c7304f192e89b178ba4c65f", "author": {"user": {"login": "Vojtech-Sassmann", "name": "Vojt\u011bch Sassmann"}}, "url": "https://github.com/CESNET/perun/commit/091bea1a27ef60f30c7304f192e89b178ba4c65f", "committedDate": "2020-10-28T14:57:25Z", "message": "New SPONSORSHIP role\n\n* We needed to able in the policies to be able distinguish sponsorhips\nof the principal. Therefore, a new role SPONSORSHIP is added.\n* The new role SPONSORSHIP is not saved in DB, but is resolved\nfrom the members_sponsored table.\n* Now, in the refreshAuthz method, are also added records to principal\nroles for this role. For each sponship of the principal there is\ninformation about who is he sponsoring."}, "afterCommit": {"oid": "04d58aeea31ecfe8aae63c8cf567597dda1560e7", "author": {"user": {"login": "Vojtech-Sassmann", "name": "Vojt\u011bch Sassmann"}}, "url": "https://github.com/CESNET/perun/commit/04d58aeea31ecfe8aae63c8cf567597dda1560e7", "committedDate": "2020-10-28T15:11:08Z", "message": "New SPONSORSHIP role\n\n* We needed to able in the policies to be able distinguish sponsorhips\nof the principal. Therefore, a new role SPONSORSHIP is added.\n* The new role SPONSORSHIP is not saved in DB, but is resolved\nfrom the members_sponsored table.\n* Now, in the refreshAuthz method, are also added records to principal\nroles for this role. For each sponship of the principal there is\ninformation about who is he sponsoring."}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "04d58aeea31ecfe8aae63c8cf567597dda1560e7", "author": {"user": {"login": "Vojtech-Sassmann", "name": "Vojt\u011bch Sassmann"}}, "url": "https://github.com/CESNET/perun/commit/04d58aeea31ecfe8aae63c8cf567597dda1560e7", "committedDate": "2020-10-28T15:11:08Z", "message": "New SPONSORSHIP role\n\n* We needed to able in the policies to be able distinguish sponsorhips\nof the principal. Therefore, a new role SPONSORSHIP is added.\n* The new role SPONSORSHIP is not saved in DB, but is resolved\nfrom the members_sponsored table.\n* Now, in the refreshAuthz method, are also added records to principal\nroles for this role. For each sponship of the principal there is\ninformation about who is he sponsoring."}, "afterCommit": {"oid": "d893905c113380cc675b639a07b2918596b28779", "author": {"user": {"login": "Vojtech-Sassmann", "name": "Vojt\u011bch Sassmann"}}, "url": "https://github.com/CESNET/perun/commit/d893905c113380cc675b639a07b2918596b28779", "committedDate": "2020-10-28T15:11:51Z", "message": "New SPONSORSHIP role\n\n* We needed to able in the policies to be able distinguish sponsorhips\nof the principal. Therefore, a new role SPONSORSHIP is added.\n* The new role SPONSORSHIP is not saved in DB, but is resolved\nfrom the members_sponsored table.\n* Now, in the refreshAuthz method, are also added records to principal\nroles for this role. For each sponship of the principal there is\ninformation about who is he sponsoring."}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "d893905c113380cc675b639a07b2918596b28779", "author": {"user": {"login": "Vojtech-Sassmann", "name": "Vojt\u011bch Sassmann"}}, "url": "https://github.com/CESNET/perun/commit/d893905c113380cc675b639a07b2918596b28779", "committedDate": "2020-10-28T15:11:51Z", "message": "New SPONSORSHIP role\n\n* We needed to able in the policies to be able distinguish sponsorhips\nof the principal. Therefore, a new role SPONSORSHIP is added.\n* The new role SPONSORSHIP is not saved in DB, but is resolved\nfrom the members_sponsored table.\n* Now, in the refreshAuthz method, are also added records to principal\nroles for this role. For each sponship of the principal there is\ninformation about who is he sponsoring."}, "afterCommit": {"oid": "9d4328ce5707c4b5247af18a44b3b44906f9bf9c", "author": {"user": {"login": "Vojtech-Sassmann", "name": "Vojt\u011bch Sassmann"}}, "url": "https://github.com/CESNET/perun/commit/9d4328ce5707c4b5247af18a44b3b44906f9bf9c", "committedDate": "2020-10-28T15:16:36Z", "message": "New SPONSORSHIP role\n\n* We needed to able in the policies to be able distinguish sponsorhips\nof the principal. Therefore, a new role SPONSORSHIP is added.\n* The new role SPONSORSHIP is not saved in DB, but is resolved\nfrom the members_sponsored table.\n* Now, in the refreshAuthz method, are also added records to principal\nroles for this role. For each sponship of the principal there is\ninformation about who is he sponsoring."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTE4Nzk0MzY5", "url": "https://github.com/CESNET/perun/pull/2955#pullrequestreview-518794369", "createdAt": "2020-10-28T15:31:41Z", "commit": {"oid": "9d4328ce5707c4b5247af18a44b3b44906f9bf9c"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTE4ODI4MjEz", "url": "https://github.com/CESNET/perun/pull/2955#pullrequestreview-518828213", "createdAt": "2020-10-28T16:01:53Z", "commit": {"oid": "9d4328ce5707c4b5247af18a44b3b44906f9bf9c"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yOFQxNjowMTo1M1rOHpxlWQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yOFQxNjowMTo1M1rOHpxlWQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMzU2NjA0MQ==", "bodyText": "Please use method authorizedToManageRole. This one should be deprecated. Or even better and simpler would be to call the method setRole from AuthzResolver right away. It will throw PrivilegeException if the given principal cannot manage the role in the Vo.", "url": "https://github.com/CESNET/perun/pull/2955#discussion_r513566041", "createdAt": "2020-10-28T16:01:53Z", "author": {"login": "balcirakpeter"}, "path": "perun-core/src/main/java/cz/metacentrum/perun/core/blImpl/MembersManagerBlImpl.java", "diffHunk": "@@ -2280,8 +2283,17 @@ public Member setSponsoredMember(PerunSession session, Vo vo, User userToBeSpons\n \t                                 String password, User sponsor, LocalDate validityTo, boolean asyncValidation) throws AlreadyMemberException, ExtendMembershipException, UserNotInRoleException, WrongAttributeValueException, WrongReferenceAttributeValueException, LoginNotExistsException, PasswordCreationFailedException, InvalidLoginException, ExtSourceNotExistsException {\n \t\t//check that sponsoring user has role SPONSOR for the VO\n \t\tif (!getPerunBl().getVosManagerBl().isUserInRoleForVo(session, sponsor, Role.SPONSOR, vo, true)) {\n-\t\t\tthrow new UserNotInRoleException(\"user \" + sponsor.getId() + \" is not in role SPONSOR for VO \" + vo.getId());\n+\t\t\tif (!AuthzResolver.isAuthorizedToManageRole(session, vo, Role.SPONSOR)) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "9d4328ce5707c4b5247af18a44b3b44906f9bf9c"}, "originalPosition": 23}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "56155fc164ddc4cb6c1320192bf8fc32f7d9b542", "author": {"user": {"login": "Vojtech-Sassmann", "name": "Vojt\u011bch Sassmann"}}, "url": "https://github.com/CESNET/perun/commit/56155fc164ddc4cb6c1320192bf8fc32f7d9b542", "committedDate": "2020-10-28T16:47:05Z", "message": "New SPONSORSHIP role\n\n* We needed to able in the policies to be able distinguish sponsorhips\nof the principal. Therefore, a new role SPONSORSHIP is added.\n* The new role SPONSORSHIP is not saved in DB, but is resolved\nfrom the members_sponsored table.\n* Now, in the refreshAuthz method, are also added records to principal\nroles for this role. For each sponship of the principal there is\ninformation about who is he sponsoring."}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "9d4328ce5707c4b5247af18a44b3b44906f9bf9c", "author": {"user": {"login": "Vojtech-Sassmann", "name": "Vojt\u011bch Sassmann"}}, "url": "https://github.com/CESNET/perun/commit/9d4328ce5707c4b5247af18a44b3b44906f9bf9c", "committedDate": "2020-10-28T15:16:36Z", "message": "New SPONSORSHIP role\n\n* We needed to able in the policies to be able distinguish sponsorhips\nof the principal. Therefore, a new role SPONSORSHIP is added.\n* The new role SPONSORSHIP is not saved in DB, but is resolved\nfrom the members_sponsored table.\n* Now, in the refreshAuthz method, are also added records to principal\nroles for this role. For each sponship of the principal there is\ninformation about who is he sponsoring."}, "afterCommit": {"oid": "56155fc164ddc4cb6c1320192bf8fc32f7d9b542", "author": {"user": {"login": "Vojtech-Sassmann", "name": "Vojt\u011bch Sassmann"}}, "url": "https://github.com/CESNET/perun/commit/56155fc164ddc4cb6c1320192bf8fc32f7d9b542", "committedDate": "2020-10-28T16:47:05Z", "message": "New SPONSORSHIP role\n\n* We needed to able in the policies to be able distinguish sponsorhips\nof the principal. Therefore, a new role SPONSORSHIP is added.\n* The new role SPONSORSHIP is not saved in DB, but is resolved\nfrom the members_sponsored table.\n* Now, in the refreshAuthz method, are also added records to principal\nroles for this role. For each sponship of the principal there is\ninformation about who is he sponsoring."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTE4ODg2OTY1", "url": "https://github.com/CESNET/perun/pull/2955#pullrequestreview-518886965", "createdAt": "2020-10-28T16:57:56Z", "commit": {"oid": "56155fc164ddc4cb6c1320192bf8fc32f7d9b542"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1124, "cost": 1, "resetAt": "2021-11-01T13:07:16Z"}}}