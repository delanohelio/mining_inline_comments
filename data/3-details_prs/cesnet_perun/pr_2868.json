{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDcyMzk0OTQ0", "number": 2868, "title": "virtual attribute processing added to LDAPc", "bodyText": "added beans to describe virtual attributes and their dependencies\nadded virtual attribute processor to act on membership status changes and group attribute changes\nadded virtual user attribute \"sponsoredMembershipInOrganizations\"", "createdAt": "2020-08-24T09:39:13Z", "url": "https://github.com/CESNET/perun/pull/2868", "merged": true, "mergeCommit": {"oid": "5633c3d4b60184dfd021638a5998d0924525b110"}, "closed": true, "closedAt": "2020-09-29T08:08:48Z", "author": {"login": "mvocu"}, "timelineItems": {"totalCount": 7, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdLrOfigFqTQ5NDU3NTQ2Nw==", "endCursor": "Y3Vyc29yOnYyOpPPAAABdNjn7-gFqTQ5ODIxMzA4OA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDk0NTc1NDY3", "url": "https://github.com/CESNET/perun/pull/2868#pullrequestreview-494575467", "createdAt": "2020-09-23T11:52:09Z", "commit": {"oid": "56ec4c48da851bc8c2628c72f6e68b9c589ae37d"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "d991e210877e468f7477e346c70d4ec09680292a", "author": {"user": {"login": "mvocu", "name": "Michal Voc\u016f"}}, "url": "https://github.com/CESNET/perun/commit/d991e210877e468f7477e346c70d4ec09680292a", "committedDate": "2020-09-23T14:40:33Z", "message": "definition of virtual attribute event processor"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "56ec4c48da851bc8c2628c72f6e68b9c589ae37d", "author": {"user": {"login": "mvocu", "name": "Michal Voc\u016f"}}, "url": "https://github.com/CESNET/perun/commit/56ec4c48da851bc8c2628c72f6e68b9c589ae37d", "committedDate": "2020-08-24T09:33:47Z", "message": "definition of virtual attribute event processor"}, "afterCommit": {"oid": "d991e210877e468f7477e346c70d4ec09680292a", "author": {"user": {"login": "mvocu", "name": "Michal Voc\u016f"}}, "url": "https://github.com/CESNET/perun/commit/d991e210877e468f7477e346c70d4ec09680292a", "committedDate": "2020-09-23T14:40:33Z", "message": "definition of virtual attribute event processor"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDk1MjU3ODM1", "url": "https://github.com/CESNET/perun/pull/2868#pullrequestreview-495257835", "createdAt": "2020-09-24T06:35:51Z", "commit": {"oid": "d991e210877e468f7477e346c70d4ec09680292a"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yNFQwNjozNTo1MVrOHXLpwA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yNFQwNjozNTo1MVrOHXLpwA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NDA3MDIwOA==", "bodyText": "We recently changed member suspended message, so it should be suspended.$ just like the other member states.\nMember status within group is limited to VALID and EXPIRED states, hence we should react only on validated.$ (which is correct in above conditions) and expired.$ in here.", "url": "https://github.com/CESNET/perun/pull/2868#discussion_r494070208", "createdAt": "2020-09-24T06:35:51Z", "author": {"login": "zlamalp"}, "path": "perun-ldapc/src/main/resources/perun-ldapc.xml", "diffHunk": "@@ -676,6 +676,105 @@ http://www.springframework.org/schema/aop http://www.springframework.org/schema/\n \t\t\t</list>\n \t\t</property>\n \t</bean>\n+\t\n+\t<!--  \n+\t  This bean processes events that would lead to change of virtual attribute and audit message\n+\t  \"virtual attribute changed\". It is here to off-load processing of the change from RPC to LDAPC.  \n+\t-->\n+\t<bean id=\"virtualAttributeEventProcessor\" class=\"cz.metacentrum.perun.ldapc.processor.impl.VirtualAttributeEventProcessor\">\n+\t\t<property name=\"dispatchConditions\">\n+\t\t\t<list>\n+\t\t\t\t<!-- group membership events -->\n+\t\t\t\t<bean class=\"cz.metacentrum.perun.ldapc.processor.impl.RegexpDispatchEventCondition\">\n+\t\t\t\t\t<property name=\"beansCondition\">\n+\t\t\t\t\t\t<list>\n+\t\t\t\t\t\t\t<value>cz.metacentrum.perun.core.api.Group</value>\n+\t\t\t\t\t\t\t<value>cz.metacentrum.perun.core.api.Member</value>\n+\t\t\t\t\t\t</list>\n+\t\t\t\t\t</property>\n+\t\t\t\t\t<property name=\"pattern\" value=\" added to Group:\\[.*\\]\"/>\n+\t\t\t\t\t<property name=\"handlerMethodName\" value=\"processGroupMemberChange\"/>\n+\t\t\t\t</bean>\n+\t\t\t\t<bean class=\"cz.metacentrum.perun.ldapc.processor.impl.RegexpDispatchEventCondition\">\n+\t\t\t\t\t<property name=\"beansCondition\">\n+\t\t\t\t\t\t<list>\n+\t\t\t\t\t\t\t<value>cz.metacentrum.perun.core.api.Group</value>\n+\t\t\t\t\t\t\t<value>cz.metacentrum.perun.core.api.Member</value>\n+\t\t\t\t\t\t</list>\n+\t\t\t\t\t</property>\n+\t\t\t\t\t<property name=\"pattern\" value=\" validated.$\"/>\n+\t\t\t\t\t<property name=\"handlerMethodName\" value=\"processGroupMemberChange\"/>\n+\t\t\t\t</bean>\n+\t\t\t\t<bean class=\"cz.metacentrum.perun.ldapc.processor.impl.RegexpDispatchEventCondition\">\n+\t\t\t\t\t<property name=\"beansCondition\">\n+\t\t\t\t\t\t<list>\n+\t\t\t\t\t\t\t<value>cz.metacentrum.perun.core.api.Group</value>\n+\t\t\t\t\t\t\t<value>cz.metacentrum.perun.core.api.Member</value>\n+\t\t\t\t\t\t</list>\n+\t\t\t\t\t</property>\n+\t\t\t\t\t<property name=\"pattern\" value=\" was removed from Group:\\[.*\\] totally\"/>\n+\t\t\t\t\t<property name=\"handlerMethodName\" value=\"processGroupMemberChange\"/>\n+\t\t\t\t</bean>\n+\t\t\t\t<bean class=\"cz.metacentrum.perun.ldapc.processor.impl.RegexpDispatchEventCondition\">\n+\t\t\t\t\t<property name=\"beansCondition\">\n+\t\t\t\t\t\t<list>\n+\t\t\t\t\t\t\t<value>cz.metacentrum.perun.core.api.Group</value>\n+\t\t\t\t\t\t\t<value>cz.metacentrum.perun.core.api.Member</value>\n+\t\t\t\t\t\t</list>\n+\t\t\t\t\t</property>\n+\t\t\t\t\t<property name=\"pattern\" value=\"expired.$|disabled.$|invalidated.$|suspended #\"/>", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d991e210877e468f7477e346c70d4ec09680292a"}, "originalPosition": 50}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDk1MjgxNDYy", "url": "https://github.com/CESNET/perun/pull/2868#pullrequestreview-495281462", "createdAt": "2020-09-24T07:16:17Z", "commit": {"oid": "d991e210877e468f7477e346c70d4ec09680292a"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yNFQwNzoxNjoxN1rOHXM2RQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yNFQwNzoxNjoxN1rOHXM2RQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NDA4OTc5Nw==", "bodyText": "We recently changed member suspended message, so it should be suspended.$ just like the other member states.", "url": "https://github.com/CESNET/perun/pull/2868#discussion_r494089797", "createdAt": "2020-09-24T07:16:17Z", "author": {"login": "zlamalp"}, "path": "perun-ldapc/src/main/resources/perun-ldapc.xml", "diffHunk": "@@ -676,6 +676,105 @@ http://www.springframework.org/schema/aop http://www.springframework.org/schema/\n \t\t\t</list>\n \t\t</property>\n \t</bean>\n+\t\n+\t<!--  \n+\t  This bean processes events that would lead to change of virtual attribute and audit message\n+\t  \"virtual attribute changed\". It is here to off-load processing of the change from RPC to LDAPC.  \n+\t-->\n+\t<bean id=\"virtualAttributeEventProcessor\" class=\"cz.metacentrum.perun.ldapc.processor.impl.VirtualAttributeEventProcessor\">\n+\t\t<property name=\"dispatchConditions\">\n+\t\t\t<list>\n+\t\t\t\t<!-- group membership events -->\n+\t\t\t\t<bean class=\"cz.metacentrum.perun.ldapc.processor.impl.RegexpDispatchEventCondition\">\n+\t\t\t\t\t<property name=\"beansCondition\">\n+\t\t\t\t\t\t<list>\n+\t\t\t\t\t\t\t<value>cz.metacentrum.perun.core.api.Group</value>\n+\t\t\t\t\t\t\t<value>cz.metacentrum.perun.core.api.Member</value>\n+\t\t\t\t\t\t</list>\n+\t\t\t\t\t</property>\n+\t\t\t\t\t<property name=\"pattern\" value=\" added to Group:\\[.*\\]\"/>\n+\t\t\t\t\t<property name=\"handlerMethodName\" value=\"processGroupMemberChange\"/>\n+\t\t\t\t</bean>\n+\t\t\t\t<bean class=\"cz.metacentrum.perun.ldapc.processor.impl.RegexpDispatchEventCondition\">\n+\t\t\t\t\t<property name=\"beansCondition\">\n+\t\t\t\t\t\t<list>\n+\t\t\t\t\t\t\t<value>cz.metacentrum.perun.core.api.Group</value>\n+\t\t\t\t\t\t\t<value>cz.metacentrum.perun.core.api.Member</value>\n+\t\t\t\t\t\t</list>\n+\t\t\t\t\t</property>\n+\t\t\t\t\t<property name=\"pattern\" value=\" validated.$\"/>\n+\t\t\t\t\t<property name=\"handlerMethodName\" value=\"processGroupMemberChange\"/>\n+\t\t\t\t</bean>\n+\t\t\t\t<bean class=\"cz.metacentrum.perun.ldapc.processor.impl.RegexpDispatchEventCondition\">\n+\t\t\t\t\t<property name=\"beansCondition\">\n+\t\t\t\t\t\t<list>\n+\t\t\t\t\t\t\t<value>cz.metacentrum.perun.core.api.Group</value>\n+\t\t\t\t\t\t\t<value>cz.metacentrum.perun.core.api.Member</value>\n+\t\t\t\t\t\t</list>\n+\t\t\t\t\t</property>\n+\t\t\t\t\t<property name=\"pattern\" value=\" was removed from Group:\\[.*\\] totally\"/>\n+\t\t\t\t\t<property name=\"handlerMethodName\" value=\"processGroupMemberChange\"/>\n+\t\t\t\t</bean>\n+\t\t\t\t<bean class=\"cz.metacentrum.perun.ldapc.processor.impl.RegexpDispatchEventCondition\">\n+\t\t\t\t\t<property name=\"beansCondition\">\n+\t\t\t\t\t\t<list>\n+\t\t\t\t\t\t\t<value>cz.metacentrum.perun.core.api.Group</value>\n+\t\t\t\t\t\t\t<value>cz.metacentrum.perun.core.api.Member</value>\n+\t\t\t\t\t\t</list>\n+\t\t\t\t\t</property>\n+\t\t\t\t\t<property name=\"pattern\" value=\"expired.$|disabled.$|invalidated.$|suspended #\"/>\n+\t\t\t\t\t<property name=\"handlerMethodName\" value=\"processGroupMemberChange\"/>\n+\t\t\t\t</bean>\n+\t\t\t\t<bean class=\"cz.metacentrum.perun.ldapc.processor.impl.RegexpDispatchEventCondition\">\n+\t\t\t\t\t<property name=\"beansCondition\">\n+\t\t\t\t\t\t<list>\n+\t\t\t\t\t\t\t<value>cz.metacentrum.perun.core.api.Member</value>\n+\t\t\t\t\t\t</list>\n+\t\t\t\t\t</property>\n+\t\t\t\t\t<property name=\"pattern\" value=\" validated.$\"/>\n+\t\t\t\t\t<property name=\"handlerMethodName\" value=\"processMemberChange\"/>\n+\t\t\t\t</bean>\n+\t\t\t\t<bean class=\"cz.metacentrum.perun.ldapc.processor.impl.RegexpDispatchEventCondition\">\n+\t\t\t\t\t<property name=\"beansCondition\">\n+\t\t\t\t\t\t<list>\n+\t\t\t\t\t\t\t<value>cz.metacentrum.perun.core.api.Member</value>\n+\t\t\t\t\t\t</list>\n+\t\t\t\t\t</property>\n+\t\t\t\t\t<property name=\"pattern\" value=\"expired.$|disabled.$|invalidated.$|suspended #\"/>", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d991e210877e468f7477e346c70d4ec09680292a"}, "originalPosition": 68}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "84e1bd0fb61a987d179864643b28963e6610416f", "author": {"user": {"login": "mvocu", "name": "Michal Voc\u016f"}}, "url": "https://github.com/CESNET/perun/commit/84e1bd0fb61a987d179864643b28963e6610416f", "committedDate": "2020-09-24T09:35:33Z", "message": "fix handler conditions according to review"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDk4MjEzMDg4", "url": "https://github.com/CESNET/perun/pull/2868#pullrequestreview-498213088", "createdAt": "2020-09-29T08:08:33Z", "commit": {"oid": "84e1bd0fb61a987d179864643b28963e6610416f"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1007, "cost": 1, "resetAt": "2021-11-01T13:07:16Z"}}}