{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0Mzk4MjY5NTYx", "number": 2656, "title": "Added method to reactivate member in group", "bodyText": "the method validates member and then sets membershipExpirationAttribute based on membershipExpirationRules as if he was added to group today\nalso added tests for this method", "createdAt": "2020-04-03T16:27:50Z", "url": "https://github.com/CESNET/perun/pull/2656", "merged": true, "mergeCommit": {"oid": "b51ff8984d85318169c36e5edee34d42c2765a91"}, "closed": true, "closedAt": "2020-04-09T05:38:49Z", "author": {"login": "metodej"}, "timelineItems": {"totalCount": 7, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcVNzI_gFqTM4ODgzNDA3MA==", "endCursor": "Y3Vyc29yOnYyOpPPAAABcVl3ruAFqTM4OTg3MTgxNA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzg4ODM0MDcw", "url": "https://github.com/CESNET/perun/pull/2656#pullrequestreview-388834070", "createdAt": "2020-04-07T07:01:08Z", "commit": {"oid": "4833eb997f8c91e8305691aa449972f7514f9497"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wN1QwNzowMTowOFrOGB1ihA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wN1QwNzowMTowOFrOGB1ihA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNDU3ODk0OA==", "bodyText": "I just wonder, if setting group membership expiration to null and calling extendMembershipInGroup() wouldn't do the same job, so we could prevent code duplicity?", "url": "https://github.com/CESNET/perun/pull/2656#discussion_r404578948", "createdAt": "2020-04-07T07:01:08Z", "author": {"login": "zlamalp"}, "path": "perun-core/src/main/java/cz/metacentrum/perun/core/blImpl/GroupsManagerBlImpl.java", "diffHunk": "@@ -4948,4 +4948,61 @@ private boolean isMemberInGracePeriod(Map<String, String> membershipExpirationRu\n \tpublic List<Facility> getFacilitiesWhereGroupIsAdmin(PerunSession perunSession, Group group) throws InternalErrorException {\n \t\treturn this.getGroupsManagerImpl().getFacilitiesWhereGroupIsAdmin(perunSession, group);\n \t}\n+\n+\t@Override\n+\tpublic void reactivateMember(PerunSession sess, Member member, Group group) throws InternalErrorException, MemberNotExistsException {\n+\t\tif (!isGroupMember(sess, group, member)) throw new MemberNotExistsException(\"Member does not belong to this group\");\n+\n+\t\tvalidateMemberInGroup(sess, member, group);\n+\n+\t\tAttribute membershipExpirationRulesAttribute = getMembershipExpirationRulesAttribute(sess, group);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "4833eb997f8c91e8305691aa449972f7514f9497"}, "originalPosition": 11}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "4833eb997f8c91e8305691aa449972f7514f9497", "author": {"user": {"login": "metodej", "name": null}}, "url": "https://github.com/CESNET/perun/commit/4833eb997f8c91e8305691aa449972f7514f9497", "committedDate": "2020-04-03T13:28:36Z", "message": "Added method to reactivate member in group\n\n- the method validates member and then sets membershipExpirationAttribute based on membershipExpirationRules as if he was added to group today\n- also added tests for this method"}, "afterCommit": {"oid": "cb81de7258aebd1ae5e87f038a513c27fcb1697d", "author": {"user": {"login": "metodej", "name": null}}, "url": "https://github.com/CESNET/perun/commit/cb81de7258aebd1ae5e87f038a513c27fcb1697d", "committedDate": "2020-04-07T10:43:12Z", "message": "Added method to reactivate member in group\n\n- the method validates member and then sets membershipExpirationAttribute based on membershipExpirationRules as if he was added to group today\n- also added tests for this method"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzg5MDQ0NTU2", "url": "https://github.com/CESNET/perun/pull/2656#pullrequestreview-389044556", "createdAt": "2020-04-07T11:59:02Z", "commit": {"oid": "cb81de7258aebd1ae5e87f038a513c27fcb1697d"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzg5NzI1OTky", "url": "https://github.com/CESNET/perun/pull/2656#pullrequestreview-389725992", "createdAt": "2020-04-08T07:43:20Z", "commit": {"oid": "cb81de7258aebd1ae5e87f038a513c27fcb1697d"}, "state": "APPROVED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wOFQwNzo0MzoyMFrOGCi1vQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wOFQwNzo0MzoyMFrOGCi1vQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNTMyMTE0OQ==", "bodyText": "If exception shouldn't be thrown (you are not expecting it), you should throw an InternalErrorException otherwise.", "url": "https://github.com/CESNET/perun/pull/2656#discussion_r405321149", "createdAt": "2020-04-08T07:43:20Z", "author": {"login": "stavamichal"}, "path": "perun-core/src/main/java/cz/metacentrum/perun/core/blImpl/GroupsManagerBlImpl.java", "diffHunk": "@@ -4948,4 +4948,30 @@ private boolean isMemberInGracePeriod(Map<String, String> membershipExpirationRu\n \tpublic List<Facility> getFacilitiesWhereGroupIsAdmin(PerunSession perunSession, Group group) throws InternalErrorException {\n \t\treturn this.getGroupsManagerImpl().getFacilitiesWhereGroupIsAdmin(perunSession, group);\n \t}\n+\n+\t@Override\n+\tpublic void reactivateMember(PerunSession sess, Member member, Group group) throws InternalErrorException, MemberNotExistsException {\n+\t\tif (!isGroupMember(sess, group, member)) throw new MemberNotExistsException(\"Member does not belong to this group\");\n+\n+\t\tvalidateMemberInGroup(sess, member, group);\n+\n+\t\t// Get current membershipExpiration date attribute\n+\t\tAttribute membershipExpirationAttribute = getMemberExpiration(sess, member, group);\n+\t\t// Set new value of the membershipExpiration for the member\n+\t\tmembershipExpirationAttribute.setValue(null);\n+\n+\t\ttry {\n+\t\t\tgetPerunBl().getAttributesManagerBl().setAttribute(sess, member, group, membershipExpirationAttribute);\n+\t\t} catch (WrongAttributeValueException e) {\n+\t\t\tthrow new InternalErrorException(\"Wrong value: \" + membershipExpirationAttribute.getValue(),e);\n+\t\t} catch (WrongReferenceAttributeValueException | WrongAttributeAssignmentException e) {\n+\t\t\tthrow new InternalErrorException(e);\n+\t\t}\n+\n+\t\ttry {\n+\t\t\textendMembershipInGroup(sess, member, group);\n+\t\t} catch (ExtendMembershipException ex) {\n+\t\t\t// This exception should not be thrown for null membershipExpiration attribute", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "cb81de7258aebd1ae5e87f038a513c27fcb1697d"}, "originalPosition": 27}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "98ccf5e3e43061b83f60235c990e2eb822bf8bdd", "author": {"user": {"login": "metodej", "name": null}}, "url": "https://github.com/CESNET/perun/commit/98ccf5e3e43061b83f60235c990e2eb822bf8bdd", "committedDate": "2020-04-08T09:56:33Z", "message": "Added method to reactivate member in group\n\n- the method validates member and then sets membershipExpirationAttribute based on membershipExpirationRules as if he was added to group today\n- also added tests for this method"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "cb81de7258aebd1ae5e87f038a513c27fcb1697d", "author": {"user": {"login": "metodej", "name": null}}, "url": "https://github.com/CESNET/perun/commit/cb81de7258aebd1ae5e87f038a513c27fcb1697d", "committedDate": "2020-04-07T10:43:12Z", "message": "Added method to reactivate member in group\n\n- the method validates member and then sets membershipExpirationAttribute based on membershipExpirationRules as if he was added to group today\n- also added tests for this method"}, "afterCommit": {"oid": "98ccf5e3e43061b83f60235c990e2eb822bf8bdd", "author": {"user": {"login": "metodej", "name": null}}, "url": "https://github.com/CESNET/perun/commit/98ccf5e3e43061b83f60235c990e2eb822bf8bdd", "committedDate": "2020-04-08T09:56:33Z", "message": "Added method to reactivate member in group\n\n- the method validates member and then sets membershipExpirationAttribute based on membershipExpirationRules as if he was added to group today\n- also added tests for this method"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzg5ODcxODE0", "url": "https://github.com/CESNET/perun/pull/2656#pullrequestreview-389871814", "createdAt": "2020-04-08T11:05:48Z", "commit": {"oid": "98ccf5e3e43061b83f60235c990e2eb822bf8bdd"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1328, "cost": 1, "resetAt": "2021-11-01T13:07:16Z"}}}