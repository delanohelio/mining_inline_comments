{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTAyMjIwMjMz", "number": 2930, "title": "Sponsorship Expiration - cron", "bodyText": "Implemented expiring of sponsorship. If some sponsorships have\nvalidityTo set in the past and are still active, they will be removed\nand a SponsorshipExpired event will me emitted.\nAlso, all incoming sponsorship expirations are audited. 1,7, and 14\ndays before the last day of validity, a SponsorspiExpirationInDays is\nemmited. 28 days before the last day of validity, a\nSponsorshipExpirationInDays is emitted.", "createdAt": "2020-10-13T11:33:23Z", "url": "https://github.com/CESNET/perun/pull/2930", "merged": true, "mergeCommit": {"oid": "cb36de70f4240d70dc3314849718a8224097c8f9"}, "closed": true, "closedAt": "2020-10-15T14:42:45Z", "author": {"login": "Vojtech-Sassmann"}, "timelineItems": {"totalCount": 6, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdSHoRsAFqTUwNzM1MDk5NA==", "endCursor": "Y3Vyc29yOnYyOpPPAAABdSyg66gBqjM4ODE4NTQ1NjI=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTA3MzUwOTk0", "url": "https://github.com/CESNET/perun/pull/2930#pullrequestreview-507350994", "createdAt": "2020-10-13T11:52:54Z", "commit": {"oid": "78fe63fcafabb5cb6f99470e040aa633c460e92e"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xM1QxMTo1Mjo1NVrOHgi4Wg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xM1QxMjowMzo0MlrOHgjRPw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMzg4Nzk2Mg==", "bodyText": "Is there a reason for adding this class here? You are not using it here.", "url": "https://github.com/CESNET/perun/pull/2930#discussion_r503887962", "createdAt": "2020-10-13T11:52:55Z", "author": {"login": "stavamichal"}, "path": "perun-core/src/main/java/cz/metacentrum/perun/core/bl/MembersManagerBl.java", "diffHunk": "@@ -2,6 +2,7 @@\n \n import cz.metacentrum.perun.core.api.AttributeDefinition;\n import cz.metacentrum.perun.core.api.Candidate;\n+import cz.metacentrum.perun.core.api.EnrichedSponsorship;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "78fe63fcafabb5cb6f99470e040aa633c460e92e"}, "originalPosition": 4}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMzg4ODM5OA==", "bodyText": "You are not using EnrichedSponsorship in this manager either.", "url": "https://github.com/CESNET/perun/pull/2930#discussion_r503888398", "createdAt": "2020-10-13T11:53:41Z", "author": {"login": "stavamichal"}, "path": "perun-core/src/main/java/cz/metacentrum/perun/core/blImpl/MembersManagerBlImpl.java", "diffHunk": "@@ -21,11 +21,13 @@\n import cz.metacentrum.perun.core.api.BanOnVo;\n import cz.metacentrum.perun.core.api.BeansUtils;\n import cz.metacentrum.perun.core.api.Candidate;\n+import cz.metacentrum.perun.core.api.EnrichedSponsorship;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "78fe63fcafabb5cb6f99470e040aa633c460e92e"}, "originalPosition": 4}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMzg5NDMzNQ==", "bodyText": "You can add information about the lowest value for 'from' and highest value for 'to' (using MIN and MAX of date).", "url": "https://github.com/CESNET/perun/pull/2930#discussion_r503894335", "createdAt": "2020-10-13T12:03:42Z", "author": {"login": "stavamichal"}, "path": "perun-core/src/main/java/cz/metacentrum/perun/core/implApi/MembersManagerImplApi.java", "diffHunk": "@@ -367,4 +367,15 @@\n \t * @throws SponsorshipDoesNotExistException if the given user is not sponsor of the given member\n \t */\n \tvoid updateSponsorshipValidity(PerunSession sess, Member sponsoredMember, User sponsor, LocalDate newValidity) throws SponsorshipDoesNotExistException;\n+\n+\t/**\n+\t * Returns sponsorship, which have validityTo in range [from, to).\n+\t * (from is inclusive, to is exclusive).\n+\t *\n+\t * @param sess session\n+\t * @param from lower validityTo bound (inclusive)\n+\t * @param to upper validityTo bound (exclusive)\n+\t * @return list of sponsorships which have validityTo set in the given range", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "78fe63fcafabb5cb6f99470e040aa633c460e92e"}, "originalPosition": 12}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "78fe63fcafabb5cb6f99470e040aa633c460e92e", "author": {"user": {"login": "Vojtech-Sassmann", "name": "Vojt\u011bch Sassmann"}}, "url": "https://github.com/CESNET/perun/commit/78fe63fcafabb5cb6f99470e040aa633c460e92e", "committedDate": "2020-10-13T11:32:52Z", "message": "Sponsorship Expiration - cron\n\n* Implemented expiring of sponsorship. If some sponsorships have\nvalidityTo set in the past and are still active, they will be removed\nand a SponsorshipExpired event will me emitted.\n* Also, all incoming sponsorship expirations are audited. 1,7, and 14\ndays before the last day of validity, a SponsorspiExpirationInDays is\nemmited. 28 days before the last day of validity, a\nSponsorshipExpirationInDays is emitted."}, "afterCommit": {"oid": "435569ab068cc811509b30b863d9f7a3dd11d503", "author": {"user": {"login": "Vojtech-Sassmann", "name": "Vojt\u011bch Sassmann"}}, "url": "https://github.com/CESNET/perun/commit/435569ab068cc811509b30b863d9f7a3dd11d503", "committedDate": "2020-10-13T12:46:12Z", "message": "Sponsorship Expiration - cron\n\n* Implemented expiring of sponsorship. If some sponsorships have\nvalidityTo set in the past and are still active, they will be removed\nand a SponsorshipExpired event will me emitted.\n* Also, all incoming sponsorship expirations are audited. 1,7, and 14\ndays before the last day of validity, a SponsorspiExpirationInDays is\nemmited. 28 days before the last day of validity, a\nSponsorshipExpirationInDays is emitted."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTA4MDQzOTE2", "url": "https://github.com/CESNET/perun/pull/2930#pullrequestreview-508043916", "createdAt": "2020-10-14T06:54:43Z", "commit": {"oid": "435569ab068cc811509b30b863d9f7a3dd11d503"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTA4MTY0MDE0", "url": "https://github.com/CESNET/perun/pull/2930#pullrequestreview-508164014", "createdAt": "2020-10-14T09:31:23Z", "commit": {"oid": "435569ab068cc811509b30b863d9f7a3dd11d503"}, "state": "APPROVED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xNFQwOTozMToyM1rOHhKdow==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xNFQwOTozMjoxNVrOHhKfoQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNDUzNjQ4Mw==", "bodyText": "Nit: you can add the info about MIN and MAX value also to this layer.", "url": "https://github.com/CESNET/perun/pull/2930#discussion_r504536483", "createdAt": "2020-10-14T09:31:23Z", "author": {"login": "balcirakpeter"}, "path": "perun-core/src/main/java/cz/metacentrum/perun/core/bl/MembersManagerBl.java", "diffHunk": "@@ -1686,4 +1686,15 @@\n \t * @throws SponsorshipDoesNotExistException if the given user is not sponsor of the given member\n \t */\n \tvoid updateSponsorshipValidity(PerunSession sess, Member sponsoredMember, User sponsor, LocalDate newValidity) throws SponsorshipDoesNotExistException;\n+\n+\t/**\n+\t * Returns sponsorship, which have validityTo in range [from, to).\n+\t * (from is inclusive, to is exclusive).\n+\t *\n+\t * @param sess session\n+\t * @param from lower validityTo bound (inclusive)", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "435569ab068cc811509b30b863d9f7a3dd11d503"}, "originalPosition": 10}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNDUzNjk5Mw==", "bodyText": "Nit: You could add null checks for from and to variables.", "url": "https://github.com/CESNET/perun/pull/2930#discussion_r504536993", "createdAt": "2020-10-14T09:32:15Z", "author": {"login": "balcirakpeter"}, "path": "perun-core/src/main/java/cz/metacentrum/perun/core/blImpl/MembersManagerBlImpl.java", "diffHunk": "@@ -2487,6 +2487,11 @@ public void updateSponsorshipValidity(PerunSession sess, Member sponsoredMember,\n \t\tperunBl.getAuditer().log(sess, new SponsorshipValidityUpdated(sponsoredMember, sponsor, newValidity));\n \t}\n \n+\t@Override\n+\tpublic List<Sponsorship> getSponsorshipsExpiringInRange(PerunSession sess, LocalDate from, LocalDate to) {\n+\t\treturn membersManagerImpl.getSponsorshipsExpiringInRange(sess, from, to);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "435569ab068cc811509b30b863d9f7a3dd11d503"}, "originalPosition": 6}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "277c96c72fda76cd47f335540d295454e0c51d1d", "author": {"user": {"login": "Vojtech-Sassmann", "name": "Vojt\u011bch Sassmann"}}, "url": "https://github.com/CESNET/perun/commit/277c96c72fda76cd47f335540d295454e0c51d1d", "committedDate": "2020-10-15T14:18:35Z", "message": "Sponsorship Expiration - cron\n\n* Implemented expiring of sponsorship. If some sponsorships have\nvalidityTo set in the past and are still active, they will be removed\nand a SponsorshipExpired event will me emitted.\n* Also, all incoming sponsorship expirations are audited. 1,7, and 14\ndays before the last day of validity, a SponsorspiExpirationInDays is\nemmited. 28 days before the last day of validity, a\nSponsorshipExpirationInDays is emitted."}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "435569ab068cc811509b30b863d9f7a3dd11d503", "author": {"user": {"login": "Vojtech-Sassmann", "name": "Vojt\u011bch Sassmann"}}, "url": "https://github.com/CESNET/perun/commit/435569ab068cc811509b30b863d9f7a3dd11d503", "committedDate": "2020-10-13T12:46:12Z", "message": "Sponsorship Expiration - cron\n\n* Implemented expiring of sponsorship. If some sponsorships have\nvalidityTo set in the past and are still active, they will be removed\nand a SponsorshipExpired event will me emitted.\n* Also, all incoming sponsorship expirations are audited. 1,7, and 14\ndays before the last day of validity, a SponsorspiExpirationInDays is\nemmited. 28 days before the last day of validity, a\nSponsorshipExpirationInDays is emitted."}, "afterCommit": {"oid": "277c96c72fda76cd47f335540d295454e0c51d1d", "author": {"user": {"login": "Vojtech-Sassmann", "name": "Vojt\u011bch Sassmann"}}, "url": "https://github.com/CESNET/perun/commit/277c96c72fda76cd47f335540d295454e0c51d1d", "committedDate": "2020-10-15T14:18:35Z", "message": "Sponsorship Expiration - cron\n\n* Implemented expiring of sponsorship. If some sponsorships have\nvalidityTo set in the past and are still active, they will be removed\nand a SponsorshipExpired event will me emitted.\n* Also, all incoming sponsorship expirations are audited. 1,7, and 14\ndays before the last day of validity, a SponsorspiExpirationInDays is\nemmited. 28 days before the last day of validity, a\nSponsorshipExpirationInDays is emitted."}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1097, "cost": 1, "resetAt": "2021-11-01T13:07:16Z"}}}