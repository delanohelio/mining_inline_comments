{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDkyNDk1MTY1", "number": 2910, "title": "Registrar - name prefills improvement", "bodyText": "Improved heuristic for prefilling user names and titles.\nIf the idp send givenName and sn attributes, they are always used as\nuser-firstName and user-lastName attributes.\nIf the idp sends givenName, sn, and displayName attributes, it is also\npossible to parse the middleName from the displayName.\nThese changes have been manually tested.", "createdAt": "2020-09-24T14:38:15Z", "url": "https://github.com/CESNET/perun/pull/2910", "merged": true, "mergeCommit": {"oid": "f2923e79d02162fe1ba375a5406074e9f8bc5948"}, "closed": true, "closedAt": "2020-10-02T08:03:26Z", "author": {"login": "Vojtech-Sassmann"}, "timelineItems": {"totalCount": 6, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdMCSy8AFqTQ5NTY1MDQ2OA==", "endCursor": "Y3Vyc29yOnYyOpPPAAABdOhWDmAFqTUwMDkzMjY0OA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDk1NjUwNDY4", "url": "https://github.com/CESNET/perun/pull/2910#pullrequestreview-495650468", "createdAt": "2020-09-24T14:44:29Z", "commit": {"oid": "6024709ba876af3df3e9b2a24427d52019b4764d"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yNFQxNDo0NDozMFrOHXecmw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yNFQxNDo0NDozMFrOHXecmw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NDM3ODEzOQ==", "bodyText": "You probably wanted to use fedLastName variable instead of repeating federValues.get(...).", "url": "https://github.com/CESNET/perun/pull/2910#discussion_r494378139", "createdAt": "2020-09-24T14:44:30Z", "author": {"login": "zlamalp"}, "path": "perun-registrar-lib/src/main/java/cz/metacentrum/perun/registrar/impl/RegistrarManagerImpl.java", "diffHunk": "@@ -2867,18 +2874,40 @@ private Application getApplicationById(int appId) {\n \t\t} else {\n \t\t\tparsedName = new HashMap<>();\n \t\t}\n-\t\t// try to fill if initial parsing failed -> returned null\n-\t\tif (parsedName.get(\"firstName\") == null) {\n-\t\t\tparsedName.put(\"firstName\", federValues.get(shibFirstNameVar));\n-\t\t}\n-\t\tif (parsedName.get(\"lastName\") == null) {\n-\t\t\tparsedName.put(\"lastName\", federValues.get(shibLastNameVar));\n+\t\t// if the idp provided first name or last name, always use it\n+\t\tString fedFirstName = federValues.get(shibFirstNameVar);\n+\t\tString fedLastName = federValues.get(shibLastNameVar);\n+\n+\t\tsetIfNonEmpty(parsedName, fedFirstName, \"firstName\");\n+\t\tsetIfNonEmpty(parsedName, federValues.get(shibLastNameVar), \"lastName\");", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "6024709ba876af3df3e9b2a24427d52019b4764d"}, "originalPosition": 29}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDk3MDUyMjg2", "url": "https://github.com/CESNET/perun/pull/2910#pullrequestreview-497052286", "createdAt": "2020-09-27T05:23:13Z", "commit": {"oid": "6024709ba876af3df3e9b2a24427d52019b4764d"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yN1QwNToyMzoxM1rOHYkyqQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yN1QwNToyMzoxM1rOHYkyqQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NTUzMDY2NQ==", "bodyText": "This can fail during the getNamesPattern method if the fedFirstName or the fedLastName is null.", "url": "https://github.com/CESNET/perun/pull/2910#discussion_r495530665", "createdAt": "2020-09-27T05:23:13Z", "author": {"login": "balcirakpeter"}, "path": "perun-registrar-lib/src/main/java/cz/metacentrum/perun/registrar/impl/RegistrarManagerImpl.java", "diffHunk": "@@ -2867,18 +2874,40 @@ private Application getApplicationById(int appId) {\n \t\t} else {\n \t\t\tparsedName = new HashMap<>();\n \t\t}\n-\t\t// try to fill if initial parsing failed -> returned null\n-\t\tif (parsedName.get(\"firstName\") == null) {\n-\t\t\tparsedName.put(\"firstName\", federValues.get(shibFirstNameVar));\n-\t\t}\n-\t\tif (parsedName.get(\"lastName\") == null) {\n-\t\t\tparsedName.put(\"lastName\", federValues.get(shibLastNameVar));\n+\t\t// if the idp provided first name or last name, always use it\n+\t\tString fedFirstName = federValues.get(shibFirstNameVar);\n+\t\tString fedLastName = federValues.get(shibLastNameVar);\n+\n+\t\tsetIfNonEmpty(parsedName, fedFirstName, \"firstName\");\n+\t\tsetIfNonEmpty(parsedName, federValues.get(shibLastNameVar), \"lastName\");\n+\n+\t\t// do new parsing heuristic\n+\t\tCandidate candidate = new Candidate();\n+\t\tif (displayName != null && !displayName.isEmpty()) {\n+\t\t\tparseTitlesAndMiddleName(candidate, displayName, fedFirstName, fedLastName);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "6024709ba876af3df3e9b2a24427d52019b4764d"}, "originalPosition": 34}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c8785c4bfe370d7880f24d5465ed02327d0113fb", "author": {"user": {"login": "Vojtech-Sassmann", "name": "Vojt\u011bch Sassmann"}}, "url": "https://github.com/CESNET/perun/commit/c8785c4bfe370d7880f24d5465ed02327d0113fb", "committedDate": "2020-10-02T07:43:02Z", "message": "Registrar - name prefills improvement\n\n* Improved heuristic for prefilling user names and titles.\n* If the idp send givenName and sn attributes, they are always used as\nuser-firstName and user-lastName attributes.\n* If the idp sends givenName, sn, and displayName attributes, it is also\npossible to parse the middleName from the displayName.\n* These changes have been manually tested."}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "6024709ba876af3df3e9b2a24427d52019b4764d", "author": {"user": {"login": "Vojtech-Sassmann", "name": "Vojt\u011bch Sassmann"}}, "url": "https://github.com/CESNET/perun/commit/6024709ba876af3df3e9b2a24427d52019b4764d", "committedDate": "2020-09-24T14:34:43Z", "message": "Registrar - name prefills improvement\n\n* Improved heuristic for prefilling user names and titles.\n* If the idp send givenName and sn attributes, they are always used as\nuser-firstName and user-lastName attributes.\n* If the idp sends givenName, sn, and displayName attributes, it is also\npossible to parse the middleName from the displayName.\n* These changes have been manually tested."}, "afterCommit": {"oid": "c8785c4bfe370d7880f24d5465ed02327d0113fb", "author": {"user": {"login": "Vojtech-Sassmann", "name": "Vojt\u011bch Sassmann"}}, "url": "https://github.com/CESNET/perun/commit/c8785c4bfe370d7880f24d5465ed02327d0113fb", "committedDate": "2020-10-02T07:43:02Z", "message": "Registrar - name prefills improvement\n\n* Improved heuristic for prefilling user names and titles.\n* If the idp send givenName and sn attributes, they are always used as\nuser-firstName and user-lastName attributes.\n* If the idp sends givenName, sn, and displayName attributes, it is also\npossible to parse the middleName from the displayName.\n* These changes have been manually tested."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTAwOTI0Mzkz", "url": "https://github.com/CESNET/perun/pull/2910#pullrequestreview-500924393", "createdAt": "2020-10-02T07:49:56Z", "commit": {"oid": "c8785c4bfe370d7880f24d5465ed02327d0113fb"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTAwOTMyNjQ4", "url": "https://github.com/CESNET/perun/pull/2910#pullrequestreview-500932648", "createdAt": "2020-10-02T08:03:08Z", "commit": {"oid": "c8785c4bfe370d7880f24d5465ed02327d0113fb"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1066, "cost": 1, "resetAt": "2021-11-01T13:07:16Z"}}}