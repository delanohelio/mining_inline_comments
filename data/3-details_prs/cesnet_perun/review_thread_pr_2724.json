{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDI2MDA0NDA2", "number": 2724, "reviewThreads": {"totalCount": 7, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wMlQxOToxNTo1OFrOEB4xkg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xMlQxMToxNTowNFrOEFBeRQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjcwNDE0MjI2OnYy", "diffSide": "RIGHT", "path": "perun-core/src/main/java/cz/metacentrum/perun/core/blImpl/AttributesManagerBlImpl.java", "isResolved": true, "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wMlQxOToxNTo1OFrOGeAhlg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wM1QyMDo0ODoyNFrOGesynA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNDExOTA2Mg==", "bodyText": "I believe you want to add result into the attributes list. Also, what if required attributes of passed services overlap? We probably should gather them into the set before returning as list.", "url": "https://github.com/CESNET/perun/pull/2724#discussion_r434119062", "createdAt": "2020-06-02T19:15:58Z", "author": {"login": "zlamalp"}, "path": "perun-core/src/main/java/cz/metacentrum/perun/core/blImpl/AttributesManagerBlImpl.java", "diffHunk": "@@ -3029,6 +3037,15 @@ public void deleteAttribute(PerunSession sess, AttributeDefinition attributeDefi\n \t\treturn attributes;\n \t}\n \n+\t@Override\n+\tpublic List<Attribute> getRequiredAttributes(PerunSession sess, List<Service> services, Facility facility, Resource resource, User user, Member member) throws InternalErrorException, MemberResourceMismatchException {\n+\t\tList<Attribute> attributes = new ArrayList<>();\n+\t\tfor (Service service : services) {\n+\t\t\tgetRequiredAttributes(sess, service, facility, resource, user, member);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f79c1a376bef678940c67aa3a35fdcc17c98fdc8"}, "originalPosition": 23}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNDQzMjU2MQ==", "bodyText": "Yeah, definitely I wanted. I have fixed it and also added a test for this method.", "url": "https://github.com/CESNET/perun/pull/2724#discussion_r434432561", "createdAt": "2020-06-03T09:27:29Z", "author": {"login": "Vojtech-Sassmann"}, "path": "perun-core/src/main/java/cz/metacentrum/perun/core/blImpl/AttributesManagerBlImpl.java", "diffHunk": "@@ -3029,6 +3037,15 @@ public void deleteAttribute(PerunSession sess, AttributeDefinition attributeDefi\n \t\treturn attributes;\n \t}\n \n+\t@Override\n+\tpublic List<Attribute> getRequiredAttributes(PerunSession sess, List<Service> services, Facility facility, Resource resource, User user, Member member) throws InternalErrorException, MemberResourceMismatchException {\n+\t\tList<Attribute> attributes = new ArrayList<>();\n+\t\tfor (Service service : services) {\n+\t\t\tgetRequiredAttributes(sess, service, facility, resource, user, member);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNDExOTA2Mg=="}, "originalCommit": {"oid": "f79c1a376bef678940c67aa3a35fdcc17c98fdc8"}, "originalPosition": 23}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNDg0NDMxNg==", "bodyText": "When I think about it, our equals() include attribute value. So if value of required attribute changes during the consequent calls, we still might get duplicity, which will probably fails some checks. But optimization of impl layer to load all data from DB at once is not a part of this change.", "url": "https://github.com/CESNET/perun/pull/2724#discussion_r434844316", "createdAt": "2020-06-03T20:48:24Z", "author": {"login": "zlamalp"}, "path": "perun-core/src/main/java/cz/metacentrum/perun/core/blImpl/AttributesManagerBlImpl.java", "diffHunk": "@@ -3029,6 +3037,15 @@ public void deleteAttribute(PerunSession sess, AttributeDefinition attributeDefi\n \t\treturn attributes;\n \t}\n \n+\t@Override\n+\tpublic List<Attribute> getRequiredAttributes(PerunSession sess, List<Service> services, Facility facility, Resource resource, User user, Member member) throws InternalErrorException, MemberResourceMismatchException {\n+\t\tList<Attribute> attributes = new ArrayList<>();\n+\t\tfor (Service service : services) {\n+\t\t\tgetRequiredAttributes(sess, service, facility, resource, user, member);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNDExOTA2Mg=="}, "originalCommit": {"oid": "f79c1a376bef678940c67aa3a35fdcc17c98fdc8"}, "originalPosition": 23}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjcwNDE3MTI1OnYy", "diffSide": "RIGHT", "path": "perun-core/src/main/java/cz/metacentrum/perun/core/impl/AttributesManagerImpl.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wMlQxOToyMzo1MlrOGeAywQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wM1QwOToyNzozN1rOGeTqeg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNDEyMzQ1Nw==", "bodyText": "We should make sure, that attribute IDs are unique, since they may overlap for multiple services.", "url": "https://github.com/CESNET/perun/pull/2724#discussion_r434123457", "createdAt": "2020-06-02T19:23:52Z", "author": {"login": "zlamalp"}, "path": "perun-core/src/main/java/cz/metacentrum/perun/core/impl/AttributesManagerImpl.java", "diffHunk": "@@ -3239,18 +3240,33 @@ public void deleteAllAttributeAuthz(PerunSession sess, AttributeDefinition attri\n \n \t@Override\n \tpublic List<Attribute> getRequiredAttributes(PerunSession sess, Service service, Resource resource, Group group) throws InternalErrorException {\n+\t\treturn getRequiredAttributes(sess, Collections.singletonList(service), resource, group);\n+\t}\n+\n+\t@Override\n+\tpublic List<Attribute> getRequiredAttributes(PerunSession sess, List<Service> services, Resource resource, Group group) throws InternalErrorException {\n \t\tif(!CacheManager.isCacheDisabled() && !perun.getCacheManager().wasCacheUpdatedInTransaction()) {\n-\t\t\tList<Integer> attrIds = getRequiredAttributeIds(service);\n-\t\t\tList<Attribute> attrs = perun.getCacheManager().getAttributesByIds(attrIds, new Holder(group.getId(), Holder.HolderType.GROUP), new Holder(resource.getId(), Holder.HolderType.RESOURCE));\n+\t\t\tList<Integer> attrIds = new ArrayList<>();\n+\t\t\tfor (Service service : services) {\n+\t\t\t\tattrIds.addAll(getRequiredAttributeIds(service));", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f79c1a376bef678940c67aa3a35fdcc17c98fdc8"}, "originalPosition": 22}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNDQzMjYzNA==", "bodyText": "Done.", "url": "https://github.com/CESNET/perun/pull/2724#discussion_r434432634", "createdAt": "2020-06-03T09:27:37Z", "author": {"login": "Vojtech-Sassmann"}, "path": "perun-core/src/main/java/cz/metacentrum/perun/core/impl/AttributesManagerImpl.java", "diffHunk": "@@ -3239,18 +3240,33 @@ public void deleteAllAttributeAuthz(PerunSession sess, AttributeDefinition attri\n \n \t@Override\n \tpublic List<Attribute> getRequiredAttributes(PerunSession sess, Service service, Resource resource, Group group) throws InternalErrorException {\n+\t\treturn getRequiredAttributes(sess, Collections.singletonList(service), resource, group);\n+\t}\n+\n+\t@Override\n+\tpublic List<Attribute> getRequiredAttributes(PerunSession sess, List<Service> services, Resource resource, Group group) throws InternalErrorException {\n \t\tif(!CacheManager.isCacheDisabled() && !perun.getCacheManager().wasCacheUpdatedInTransaction()) {\n-\t\t\tList<Integer> attrIds = getRequiredAttributeIds(service);\n-\t\t\tList<Attribute> attrs = perun.getCacheManager().getAttributesByIds(attrIds, new Holder(group.getId(), Holder.HolderType.GROUP), new Holder(resource.getId(), Holder.HolderType.RESOURCE));\n+\t\t\tList<Integer> attrIds = new ArrayList<>();\n+\t\t\tfor (Service service : services) {\n+\t\t\t\tattrIds.addAll(getRequiredAttributeIds(service));", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNDEyMzQ1Nw=="}, "originalCommit": {"oid": "f79c1a376bef678940c67aa3a35fdcc17c98fdc8"}, "originalPosition": 22}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjcwNDE3ODk3OnYy", "diffSide": "RIGHT", "path": "perun-core/src/main/java/cz/metacentrum/perun/core/impl/AttributesManagerImpl.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wMlQxOToyNjowMVrOGeA3cg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wM1QwOToyNzo0OFrOGeTrCA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNDEyNDY1OA==", "bodyText": "Again we should have unique set of attribute ids.", "url": "https://github.com/CESNET/perun/pull/2724#discussion_r434124658", "createdAt": "2020-06-02T19:26:01Z", "author": {"login": "zlamalp"}, "path": "perun-core/src/main/java/cz/metacentrum/perun/core/impl/AttributesManagerImpl.java", "diffHunk": "@@ -3565,18 +3581,32 @@ public void deleteAllAttributeAuthz(PerunSession sess, AttributeDefinition attri\n \n \t@Override\n \tpublic List<Attribute> getRequiredAttributes(PerunSession sess, Service service, Group group) throws InternalErrorException {\n+\t\treturn getRequiredAttributes(sess, Collections.singletonList(service), group);\n+\t}\n+\n+\t@Override\n+\tpublic List<Attribute> getRequiredAttributes(PerunSession sess, List<Service> services, Group group) throws InternalErrorException {\n \t\tif(!CacheManager.isCacheDisabled() && !perun.getCacheManager().wasCacheUpdatedInTransaction()) {\n-\t\t\tList<Integer> attrIds = getRequiredAttributeIds(service);\n+\t\t\tList<Integer> attrIds = new ArrayList<>();\n+\t\t\tfor (Service service : services) {\n+\t\t\t\tattrIds.addAll(getRequiredAttributeIds(service));", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f79c1a376bef678940c67aa3a35fdcc17c98fdc8"}, "originalPosition": 61}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNDQzMjc3Ng==", "bodyText": "Done.", "url": "https://github.com/CESNET/perun/pull/2724#discussion_r434432776", "createdAt": "2020-06-03T09:27:48Z", "author": {"login": "Vojtech-Sassmann"}, "path": "perun-core/src/main/java/cz/metacentrum/perun/core/impl/AttributesManagerImpl.java", "diffHunk": "@@ -3565,18 +3581,32 @@ public void deleteAllAttributeAuthz(PerunSession sess, AttributeDefinition attri\n \n \t@Override\n \tpublic List<Attribute> getRequiredAttributes(PerunSession sess, Service service, Group group) throws InternalErrorException {\n+\t\treturn getRequiredAttributes(sess, Collections.singletonList(service), group);\n+\t}\n+\n+\t@Override\n+\tpublic List<Attribute> getRequiredAttributes(PerunSession sess, List<Service> services, Group group) throws InternalErrorException {\n \t\tif(!CacheManager.isCacheDisabled() && !perun.getCacheManager().wasCacheUpdatedInTransaction()) {\n-\t\t\tList<Integer> attrIds = getRequiredAttributeIds(service);\n+\t\t\tList<Integer> attrIds = new ArrayList<>();\n+\t\t\tfor (Service service : services) {\n+\t\t\t\tattrIds.addAll(getRequiredAttributeIds(service));", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNDEyNDY1OA=="}, "originalCommit": {"oid": "f79c1a376bef678940c67aa3a35fdcc17c98fdc8"}, "originalPosition": 61}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjcyNDUyMjM2OnYy", "diffSide": "RIGHT", "path": "perun-core/src/main/java/cz/metacentrum/perun/core/entry/ResourcesManagerEntry.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wOVQxMTozMjo1MVrOGhFCaQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wOVQxMzoyNjo0OFrOGhJtbw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNzMzODcyOQ==", "bodyText": "It would be nice to have these checks before the authorization check. The new authorization model needs to be sure that all objects exist when the authorization checks are performed.", "url": "https://github.com/CESNET/perun/pull/2724#discussion_r437338729", "createdAt": "2020-06-09T11:32:51Z", "author": {"login": "balcirakpeter"}, "path": "perun-core/src/main/java/cz/metacentrum/perun/core/entry/ResourcesManagerEntry.java", "diffHunk": "@@ -542,6 +542,23 @@ public void assignService(PerunSession sess, Resource resource, Service service)\n \t\tgetResourcesManagerBl().assignService(sess, resource, service);\n \t}\n \n+\t@Override\n+\tpublic void assignServices(PerunSession sess, Resource resource, List<Service> services) throws PrivilegeException, ResourceNotExistsException, ServiceNotExistsException, ServiceAlreadyAssignedException, WrongAttributeValueException, WrongReferenceAttributeValueException {\n+\t\tUtils.checkPerunSession(sess);\n+\t\tgetResourcesManagerBl().checkResourceExists(sess, resource);\n+\n+\t\t// Authorization\n+\t\tif (!AuthzResolver.isAuthorized(sess, Role.FACILITYADMIN, resource)) {\n+\t\t\tthrow new PrivilegeException(sess, \"assignServices\");\n+\t\t}\n+\n+\t\tfor (Service service : services) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "21d5ac8fc025ee141d21b2833ec89f06aa6c3810"}, "originalPosition": 14}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNzQxNTI3OQ==", "bodyText": "Moved.", "url": "https://github.com/CESNET/perun/pull/2724#discussion_r437415279", "createdAt": "2020-06-09T13:26:48Z", "author": {"login": "Vojtech-Sassmann"}, "path": "perun-core/src/main/java/cz/metacentrum/perun/core/entry/ResourcesManagerEntry.java", "diffHunk": "@@ -542,6 +542,23 @@ public void assignService(PerunSession sess, Resource resource, Service service)\n \t\tgetResourcesManagerBl().assignService(sess, resource, service);\n \t}\n \n+\t@Override\n+\tpublic void assignServices(PerunSession sess, Resource resource, List<Service> services) throws PrivilegeException, ResourceNotExistsException, ServiceNotExistsException, ServiceAlreadyAssignedException, WrongAttributeValueException, WrongReferenceAttributeValueException {\n+\t\tUtils.checkPerunSession(sess);\n+\t\tgetResourcesManagerBl().checkResourceExists(sess, resource);\n+\n+\t\t// Authorization\n+\t\tif (!AuthzResolver.isAuthorized(sess, Role.FACILITYADMIN, resource)) {\n+\t\t\tthrow new PrivilegeException(sess, \"assignServices\");\n+\t\t}\n+\n+\t\tfor (Service service : services) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNzMzODcyOQ=="}, "originalCommit": {"oid": "21d5ac8fc025ee141d21b2833ec89f06aa6c3810"}, "originalPosition": 14}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjcyNDU4NDg3OnYy", "diffSide": "RIGHT", "path": "perun-core/src/main/java/cz/metacentrum/perun/core/bl/AttributesManagerBl.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wOVQxMTo1MjoxM1rOGhFo9w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wOVQxMzoyNjo0MVrOGhJtIg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNzM0ODU5OQ==", "bodyText": "Typo", "url": "https://github.com/CESNET/perun/pull/2724#discussion_r437348599", "createdAt": "2020-06-09T11:52:13Z", "author": {"login": "balcirakpeter"}, "path": "perun-core/src/main/java/cz/metacentrum/perun/core/bl/AttributesManagerBl.java", "diffHunk": "@@ -2364,6 +2391,27 @@\n \t */\n \tList<Attribute> getRequiredAttributes(PerunSession sess, Service service, Facility facility, Resource resource, User user, Member member) throws InternalErrorException, MemberResourceMismatchException;\n \n+\t/**\n+\t * Get memner, user, member-resource, user-facility attributes which are required by the services.", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "21d5ac8fc025ee141d21b2833ec89f06aa6c3810"}, "originalPosition": 39}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNzQxNTIwMg==", "bodyText": "Fixed.", "url": "https://github.com/CESNET/perun/pull/2724#discussion_r437415202", "createdAt": "2020-06-09T13:26:41Z", "author": {"login": "Vojtech-Sassmann"}, "path": "perun-core/src/main/java/cz/metacentrum/perun/core/bl/AttributesManagerBl.java", "diffHunk": "@@ -2364,6 +2391,27 @@\n \t */\n \tList<Attribute> getRequiredAttributes(PerunSession sess, Service service, Facility facility, Resource resource, User user, Member member) throws InternalErrorException, MemberResourceMismatchException;\n \n+\t/**\n+\t * Get memner, user, member-resource, user-facility attributes which are required by the services.", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNzM0ODU5OQ=="}, "originalCommit": {"oid": "21d5ac8fc025ee141d21b2833ec89f06aa6c3810"}, "originalPosition": 39}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjcyNDU5NjA5OnYy", "diffSide": "RIGHT", "path": "perun-core/src/main/java/cz/metacentrum/perun/core/blImpl/AttributesManagerBlImpl.java", "isResolved": true, "comments": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wOVQxMTo1NTozMlrOGhFwBA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xMFQxNDo0ODozNlrOGh4i7w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNzM1MDQwNA==", "bodyText": "You can use parameterized constructor call instead of addAll()", "url": "https://github.com/CESNET/perun/pull/2724#discussion_r437350404", "createdAt": "2020-06-09T11:55:32Z", "author": {"login": "balcirakpeter"}, "path": "perun-core/src/main/java/cz/metacentrum/perun/core/blImpl/AttributesManagerBlImpl.java", "diffHunk": "@@ -3042,6 +3059,18 @@ public void deleteAttribute(PerunSession sess, AttributeDefinition attributeDefi\n \n \t}\n \n+\t@Override\n+\tpublic List<Attribute> getRequiredAttributes(PerunSession sess, List<Service> services, Resource resource, Group group, boolean withGroupAttributes) throws GroupResourceMismatchException {\n+\t\tthis.checkGroupIsFromTheSameVoLikeResource(sess, group, resource);\n+\n+\t\tList<Attribute> attributes = new ArrayList<>();\n+\t\tattributes.addAll(getAttributesManagerImpl().getRequiredAttributes(sess, services, resource, group));", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "21d5ac8fc025ee141d21b2833ec89f06aa6c3810"}, "originalPosition": 49}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNzQxNTE1Ng==", "bodyText": "Done.", "url": "https://github.com/CESNET/perun/pull/2724#discussion_r437415156", "createdAt": "2020-06-09T13:26:37Z", "author": {"login": "Vojtech-Sassmann"}, "path": "perun-core/src/main/java/cz/metacentrum/perun/core/blImpl/AttributesManagerBlImpl.java", "diffHunk": "@@ -3042,6 +3059,18 @@ public void deleteAttribute(PerunSession sess, AttributeDefinition attributeDefi\n \n \t}\n \n+\t@Override\n+\tpublic List<Attribute> getRequiredAttributes(PerunSession sess, List<Service> services, Resource resource, Group group, boolean withGroupAttributes) throws GroupResourceMismatchException {\n+\t\tthis.checkGroupIsFromTheSameVoLikeResource(sess, group, resource);\n+\n+\t\tList<Attribute> attributes = new ArrayList<>();\n+\t\tattributes.addAll(getAttributesManagerImpl().getRequiredAttributes(sess, services, resource, group));", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNzM1MDQwNA=="}, "originalCommit": {"oid": "21d5ac8fc025ee141d21b2833ec89f06aa6c3810"}, "originalPosition": 49}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzODE2NDYyNA==", "bodyText": "Well, the list is not passed from the outside, so we should be able to safely assign result of the first call (which is a list) into the variable and just optionally add those group attributes.\nList<Attribute> attributes = getAttributesManagerImpl().getRequiredAttributes(sess, services, resource, group);\nif (withGroupAttributes) {\n\tattributes.addAll(getAttributesManagerImpl().getRequiredAttributes(sess, services, group));\n}\nreturn attributes;", "url": "https://github.com/CESNET/perun/pull/2724#discussion_r438164624", "createdAt": "2020-06-10T14:26:25Z", "author": {"login": "zlamalp"}, "path": "perun-core/src/main/java/cz/metacentrum/perun/core/blImpl/AttributesManagerBlImpl.java", "diffHunk": "@@ -3042,6 +3059,18 @@ public void deleteAttribute(PerunSession sess, AttributeDefinition attributeDefi\n \n \t}\n \n+\t@Override\n+\tpublic List<Attribute> getRequiredAttributes(PerunSession sess, List<Service> services, Resource resource, Group group, boolean withGroupAttributes) throws GroupResourceMismatchException {\n+\t\tthis.checkGroupIsFromTheSameVoLikeResource(sess, group, resource);\n+\n+\t\tList<Attribute> attributes = new ArrayList<>();\n+\t\tattributes.addAll(getAttributesManagerImpl().getRequiredAttributes(sess, services, resource, group));", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNzM1MDQwNA=="}, "originalCommit": {"oid": "21d5ac8fc025ee141d21b2833ec89f06aa6c3810"}, "originalPosition": 49}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzODE4MjYzOQ==", "bodyText": "You are right. I don't know why I didn't do it in the first place \ud83d\ude42", "url": "https://github.com/CESNET/perun/pull/2724#discussion_r438182639", "createdAt": "2020-06-10T14:48:36Z", "author": {"login": "Vojtech-Sassmann"}, "path": "perun-core/src/main/java/cz/metacentrum/perun/core/blImpl/AttributesManagerBlImpl.java", "diffHunk": "@@ -3042,6 +3059,18 @@ public void deleteAttribute(PerunSession sess, AttributeDefinition attributeDefi\n \n \t}\n \n+\t@Override\n+\tpublic List<Attribute> getRequiredAttributes(PerunSession sess, List<Service> services, Resource resource, Group group, boolean withGroupAttributes) throws GroupResourceMismatchException {\n+\t\tthis.checkGroupIsFromTheSameVoLikeResource(sess, group, resource);\n+\n+\t\tList<Attribute> attributes = new ArrayList<>();\n+\t\tattributes.addAll(getAttributesManagerImpl().getRequiredAttributes(sess, services, resource, group));", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNzM1MDQwNA=="}, "originalCommit": {"oid": "21d5ac8fc025ee141d21b2833ec89f06aa6c3810"}, "originalPosition": 49}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjczNzAyNDY5OnYy", "diffSide": "RIGHT", "path": "perun-rpc/src/main/java/cz/metacentrum/perun/rpc/methods/ResourcesManagerMethod.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xMlQxMToxNTowNFrOGjAV6Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xMlQxMToxNTowNFrOGjAV6Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzOTM1ODk1Mw==", "bodyText": "This was changed on the master branch to parms.stateChangingCheck().", "url": "https://github.com/CESNET/perun/pull/2724#discussion_r439358953", "createdAt": "2020-06-12T11:15:04Z", "author": {"login": "zlamalp"}, "path": "perun-rpc/src/main/java/cz/metacentrum/perun/rpc/methods/ResourcesManagerMethod.java", "diffHunk": "@@ -687,6 +688,32 @@ public Void call(ApiCaller ac, Deserializer parms) throws PerunException {\n \t\t}\n \t},\n \n+\t/*#\n+\t * Assign services to resource.\n+\t *\n+\t * @param resource int Resource <code>id</code>\n+\t * @param services List<Integer> list of services IDs\n+\t */\n+\tassignServices {\n+\n+\t\t@Override\n+\t\tpublic Void call(ApiCaller ac, Deserializer parms) throws PerunException {\n+\t\t\tac.stateChangingCheck();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "01b824bc02bedb3118f122e63579448d055ca50f"}, "originalPosition": 22}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1868, "cost": 1, "resetAt": "2021-11-12T18:49:56Z"}}}