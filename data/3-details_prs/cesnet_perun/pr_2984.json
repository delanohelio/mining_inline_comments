{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTIwNDI2ODQ3", "number": 2984, "title": "Method setSponsorshipForMember should validate members", "bodyText": "when member get new sponsor, his status in VO should be set to VALID\nagain if was different", "createdAt": "2020-11-13T08:15:59Z", "url": "https://github.com/CESNET/perun/pull/2984", "merged": true, "mergeCommit": {"oid": "e704c5951f04f235e6b383154302772e401bed27"}, "closed": true, "closedAt": "2020-11-13T11:36:19Z", "author": {"login": "stavamichal"}, "timelineItems": {"totalCount": 5, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdcC2b5gFqTUyOTg2MTE5Mg==", "endCursor": "Y3Vyc29yOnYyOpPPAAABdcFhcPAFqTUyOTk4ODgwMw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTI5ODYxMTky", "url": "https://github.com/CESNET/perun/pull/2984#pullrequestreview-529861192", "createdAt": "2020-11-13T08:26:11Z", "commit": {"oid": "f0157e596c213cea81064533cc04af62a003aedb"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xM1QwODoyNjoxMVrOHykddA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xM1QwODoyNjoxMVrOHykddA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMjc4ODIxMg==", "bodyText": "This is about existing member, right? What about membership expiration? Above methods do nothing with it, so the member would be switched back to expired after midnight if his expiration date is in the past.\nAlso I'm not sure if we don't want to have also \"sync\" validation for the purpose of the tests, since it creates thread outside of the test scope (rollback), but tests passed, since they test only sponsorship validity, not members validity. @martin-kuba ?", "url": "https://github.com/CESNET/perun/pull/2984#discussion_r522788212", "createdAt": "2020-11-13T08:26:11Z", "author": {"login": "zlamalp"}, "path": "perun-core/src/main/java/cz/metacentrum/perun/core/blImpl/MembersManagerBlImpl.java", "diffHunk": "@@ -2216,6 +2216,9 @@ public Member setSponsorshipForMember(PerunSession session, Member sponsoredMemb\n \t\tgetPerunBl().getAuditer().log(session, new SponsoredMemberSet(sponsoredMember));\n \t\tgetPerunBl().getAuditer().log(session, new SponsorshipEstablished(sponsoredMember, sponsor, validityTo));\n \n+\t\t//validate sponsored member in the VO (you can do it asynchronous) - if member was already valid, it will not change anything\n+\t\tvalidateMemberAsync(session, sponsoredMember);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f0157e596c213cea81064533cc04af62a003aedb"}, "originalPosition": 5}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "d2f4bdc0db3b9b03edd1820d6f8412f7da3838b5", "author": {"user": {"login": "stavamichal", "name": "Michal Stava"}}, "url": "https://github.com/CESNET/perun/commit/d2f4bdc0db3b9b03edd1820d6f8412f7da3838b5", "committedDate": "2020-11-13T11:03:56Z", "message": "Method setSponsorshipForMember should validate members\n\n - when member get new sponsor, his status in VO should be set to VALID\n again if was different (also expiration need to be removed)"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "f0157e596c213cea81064533cc04af62a003aedb", "author": {"user": {"login": "stavamichal", "name": "Michal Stava"}}, "url": "https://github.com/CESNET/perun/commit/f0157e596c213cea81064533cc04af62a003aedb", "committedDate": "2020-11-13T08:14:14Z", "message": "Method setSponsorshipForMember should validate members\n\n - when member get new sponsor, his status in VO should be set to VALID\n again if was different"}, "afterCommit": {"oid": "d2f4bdc0db3b9b03edd1820d6f8412f7da3838b5", "author": {"user": {"login": "stavamichal", "name": "Michal Stava"}}, "url": "https://github.com/CESNET/perun/commit/d2f4bdc0db3b9b03edd1820d6f8412f7da3838b5", "committedDate": "2020-11-13T11:03:56Z", "message": "Method setSponsorshipForMember should validate members\n\n - when member get new sponsor, his status in VO should be set to VALID\n again if was different (also expiration need to be removed)"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTI5OTgzODIw", "url": "https://github.com/CESNET/perun/pull/2984#pullrequestreview-529983820", "createdAt": "2020-11-13T11:24:41Z", "commit": {"oid": "d2f4bdc0db3b9b03edd1820d6f8412f7da3838b5"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTI5OTg4ODAz", "url": "https://github.com/CESNET/perun/pull/2984#pullrequestreview-529988803", "createdAt": "2020-11-13T11:33:10Z", "commit": {"oid": "d2f4bdc0db3b9b03edd1820d6f8412f7da3838b5"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1668, "cost": 1, "resetAt": "2021-11-01T13:07:16Z"}}}