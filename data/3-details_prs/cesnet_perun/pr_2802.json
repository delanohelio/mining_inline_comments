{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDU0NDc4Mzg4", "number": 2802, "title": "CORE: All attribute tables now have single attr_value column", "bodyText": "All values of large attributes from \"attr_value_text\" column\nwere moved to the standard \"attr_value\" column.\nDefault column type changed to \"text\" to contain large values.\n\n\nUpdated DB schema and changelog 3.1.65.\n\n\nSimplified attribute value reading where possible.\n\n\nWe expect to remove \"large\" attribute types from the API/logic\nin the future.", "createdAt": "2020-07-21T12:48:37Z", "url": "https://github.com/CESNET/perun/pull/2802", "merged": true, "mergeCommit": {"oid": "fc4947c2c4bd1dece47f5f229169807ecb13ca4e"}, "closed": true, "closedAt": "2020-08-03T06:27:17Z", "author": {"login": "zlamalp"}, "timelineItems": {"totalCount": 9, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABc3GGfNAFqTQ1MjQ0NDY2OA==", "endCursor": "Y3Vyc29yOnYyOpPPAAABc58M_4AH2gAyNDU0NDc4Mzg4OmZkZDVjZDE5NWVhNmU4NGY5YjJhN2Q3NDYyZDY1ZTVkMmMxNTE0ZDE=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDUyNDQ0NjY4", "url": "https://github.com/CESNET/perun/pull/2802#pullrequestreview-452444668", "createdAt": "2020-07-21T13:18:25Z", "commit": {"oid": "6c8e7105be9feeb3adafbc9089b4cccefa682bc8"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yMVQxMzoxODoyNVrOG03gQg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yMVQxMzoxODoyNVrOG03gQg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1ODA4ODUxNA==", "bodyText": "There is nothing like large objects anymore, so can't we remove these special parts too?", "url": "https://github.com/CESNET/perun/pull/2802#discussion_r458088514", "createdAt": "2020-07-21T13:18:25Z", "author": {"login": "stavamichal"}, "path": "perun-core/src/main/java/cz/metacentrum/perun/core/impl/SearcherImpl.java", "diffHunk": "@@ -186,62 +183,37 @@ private void insertWhereClausesAndQueryParametersFromAttributes(StringBuilder qu\n \t\t\tquery.append(\"left join attr_names nam\").append(counter).append(\" on val\").append(counter).append(\".attr_id=nam\").append(counter).append(\".id \");\n \n \t\t\tif (value == null || value.isEmpty()) {\n-\t\t\t\tif(key.getType().equals(LinkedHashMap.class.getName()) ||\n-\t\t\t\t\t\tkey.getType().equals(BeansUtils.largeStringClassName) ||\n-\t\t\t\t\t\tkey.getType().equals(BeansUtils.largeArrayListClassName)) {\n-\t\t\t\t\twhereClauses.add(\"val\" + counter + \".attr_value_text IS NULL \");\n-\t\t\t\t} else {\n-\t\t\t\t\twhereClauses.add(\"val\" + counter + \".attr_value IS NULL \");\n-\t\t\t\t}\n+\t\t\t\twhereClauses.add(\"val\" + counter + \".attr_value IS NULL \");\n \t\t\t} else {\n \t\t\t\tif (key.getType().equals(Integer.class.getName())) {\n \t\t\t\t\tkey.setValue(Integer.valueOf(value));\n \t\t\t\t\twhereClauses.add(\"val\" + counter + \".attr_value=:v\" + counter + \" \");\n \t\t\t\t\twhereClauses.add(\"nam\" + counter + \".type=:n\" + counter + \" \");\n \t\t\t\t\tparameters.addValue(\"n\" + counter, Integer.class.getName());\n \t\t\t\t\tparameters.addValue(\"v\" + counter, BeansUtils.attributeValueToString(key));\n-\t\t\t\t} else if (key.getType().equals(String.class.getName())) {\n+\t\t\t\t} else if (key.getType().equals(String.class.getName()) || key.getType().equals(BeansUtils.largeStringClassName)) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "6c8e7105be9feeb3adafbc9089b4cccefa682bc8"}, "originalPosition": 37}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "df02b606fd83f0135d379d2f6c0965e8c7d90f19", "author": {"user": {"login": "zlamalp", "name": "Pavel Zl\u00e1mal"}}, "url": "https://github.com/CESNET/perun/commit/df02b606fd83f0135d379d2f6c0965e8c7d90f19", "committedDate": "2020-07-22T11:16:56Z", "message": "CORE: Allow large attributes to be converted to unique\n\n- Revert changes from pull-request: #2245 where we prevented large\n  attributes to be converted to unique. Now all attribute value columns\n  are of \"text\" type, hence they can contain large values."}, "afterCommit": {"oid": "7303bb40b840d7017f5dd373a27b58d8132485e7", "author": {"user": {"login": "zlamalp", "name": "Pavel Zl\u00e1mal"}}, "url": "https://github.com/CESNET/perun/commit/7303bb40b840d7017f5dd373a27b58d8132485e7", "committedDate": "2020-07-22T11:20:13Z", "message": "CORE: Allow large attributes to be converted to unique\n\n- Revert changes from pull-request: #2245 where we prevented large\n  attributes to be converted to unique. Now all attribute value columns\n  are of \"text\" type, hence they can contain large values."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDU0MDU4Mjg0", "url": "https://github.com/CESNET/perun/pull/2802#pullrequestreview-454058284", "createdAt": "2020-07-23T11:55:18Z", "commit": {"oid": "7303bb40b840d7017f5dd373a27b58d8132485e7"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "1a0dd2fe84e1b163297af4432f7f810d9df29732", "author": {"user": {"login": "zlamalp", "name": "Pavel Zl\u00e1mal"}}, "url": "https://github.com/CESNET/perun/commit/1a0dd2fe84e1b163297af4432f7f810d9df29732", "committedDate": "2020-07-30T06:59:12Z", "message": "CORE: All attribute tables now have single attr_value column\n\n- All values of large attributes from \"attr_value_text\" column\n  were moved to the standard \"attr_value\" column.\n  Default column type changed to \"text\" to contain large values.\n- Updated DB schema and changelog 3.1.65.\n- Simplified attribute value reading where possible.\n\n- We expect to remove \"large\" attribute types from the API/logic\n  in the future."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "9d26041ab3480e620831815baa08ad93fea70af3", "author": {"user": {"login": "zlamalp", "name": "Pavel Zl\u00e1mal"}}, "url": "https://github.com/CESNET/perun/commit/9d26041ab3480e620831815baa08ad93fea70af3", "committedDate": "2020-07-30T06:59:12Z", "message": "CORE: Allow large attributes to be converted to unique\n\n- Revert changes from pull-request: #2245 where we prevented large\n  attributes to be converted to unique. Now all attribute value columns\n  are of \"text\" type, hence they can contain large values."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f477e1480c080d03fea4f34fbb8913677a553007", "author": {"user": {"login": "zlamalp", "name": "Pavel Zl\u00e1mal"}}, "url": "https://github.com/CESNET/perun/commit/f477e1480c080d03fea4f34fbb8913677a553007", "committedDate": "2020-07-30T07:05:12Z", "message": "DB: Fixed wrong attr_value type in host_attr_values table\n\n- We must use \"text\" as attr_value column type."}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "7303bb40b840d7017f5dd373a27b58d8132485e7", "author": {"user": {"login": "zlamalp", "name": "Pavel Zl\u00e1mal"}}, "url": "https://github.com/CESNET/perun/commit/7303bb40b840d7017f5dd373a27b58d8132485e7", "committedDate": "2020-07-22T11:20:13Z", "message": "CORE: Allow large attributes to be converted to unique\n\n- Revert changes from pull-request: #2245 where we prevented large\n  attributes to be converted to unique. Now all attribute value columns\n  are of \"text\" type, hence they can contain large values."}, "afterCommit": {"oid": "f477e1480c080d03fea4f34fbb8913677a553007", "author": {"user": {"login": "zlamalp", "name": "Pavel Zl\u00e1mal"}}, "url": "https://github.com/CESNET/perun/commit/f477e1480c080d03fea4f34fbb8913677a553007", "committedDate": "2020-07-30T07:05:12Z", "message": "DB: Fixed wrong attr_value type in host_attr_values table\n\n- We must use \"text\" as attr_value column type."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDU4MjMyODk1", "url": "https://github.com/CESNET/perun/pull/2802#pullrequestreview-458232895", "createdAt": "2020-07-30T09:22:23Z", "commit": {"oid": "f477e1480c080d03fea4f34fbb8913677a553007"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "fdd5cd195ea6e84f9b2a7d7462d65e5d2c1514d1", "author": {"user": {"login": "zlamalp", "name": "Pavel Zl\u00e1mal"}}, "url": "https://github.com/CESNET/perun/commit/fdd5cd195ea6e84f9b2a7d7462d65e5d2c1514d1", "committedDate": "2020-07-30T09:28:16Z", "message": "CORE: Removed unused isLargeAttribute() in AttributesManagerImpl"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1271, "cost": 1, "resetAt": "2021-11-01T13:07:16Z"}}}