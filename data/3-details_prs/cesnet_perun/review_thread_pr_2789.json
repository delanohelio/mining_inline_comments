{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDQ5MzQ0Njgx", "number": 2789, "reviewThreads": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xNVQxMToxMDoyMVrOEOoyBQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xNVQxMToyMTowMFrOEOo-pw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjgzNzgzNjg1OnYy", "diffSide": "RIGHT", "path": "perun-core/src/main/java/cz/metacentrum/perun/core/bl/GroupsManagerBl.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xNVQxMToxMDoyMVrOGx5WXQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yMFQwODoyNzoyM1rOGz_hog==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NDk3MzAyMQ==", "bodyText": "Not sure why added if not used.", "url": "https://github.com/CESNET/perun/pull/2789#discussion_r454973021", "createdAt": "2020-07-15T11:10:21Z", "author": {"login": "zlamalp"}, "path": "perun-core/src/main/java/cz/metacentrum/perun/core/bl/GroupsManagerBl.java", "diffHunk": "@@ -45,6 +45,7 @@\n import cz.metacentrum.perun.core.api.exceptions.WrongAttributeAssignmentException;\n import cz.metacentrum.perun.core.api.exceptions.WrongAttributeValueException;\n import cz.metacentrum.perun.core.api.exceptions.WrongReferenceAttributeValueException;\n+import cz.metacentrum.perun.core.api.exceptions.InvalidGroupNameException;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "60961d3010e9f9af6f8fc5477eeba0689bf00e64"}, "originalPosition": 4}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NzE3MTM2Mg==", "bodyText": "Import removed.", "url": "https://github.com/CESNET/perun/pull/2789#discussion_r457171362", "createdAt": "2020-07-20T08:27:23Z", "author": {"login": "Vojtech-Sassmann"}, "path": "perun-core/src/main/java/cz/metacentrum/perun/core/bl/GroupsManagerBl.java", "diffHunk": "@@ -45,6 +45,7 @@\n import cz.metacentrum.perun.core.api.exceptions.WrongAttributeAssignmentException;\n import cz.metacentrum.perun.core.api.exceptions.WrongAttributeValueException;\n import cz.metacentrum.perun.core.api.exceptions.WrongReferenceAttributeValueException;\n+import cz.metacentrum.perun.core.api.exceptions.InvalidGroupNameException;", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NDk3MzAyMQ=="}, "originalCommit": {"oid": "60961d3010e9f9af6f8fc5477eeba0689bf00e64"}, "originalPosition": 4}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjgzNzg1MTUzOnYy", "diffSide": "RIGHT", "path": "perun-registrar-lib/src/main/java/cz/metacentrum/perun/registrar/modules/EduGain.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xNVQxMToxNTowOFrOGx5fZg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yMFQwODoyNzozNlrOGz_iYg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NDk3NTMzNA==", "bodyText": "You should probably fail with InternalErrorException here, since module wants to add you as an admin of the members group, not just give you generic groupadmin role (with null group).", "url": "https://github.com/CESNET/perun/pull/2789#discussion_r454975334", "createdAt": "2020-07-15T11:15:08Z", "author": {"login": "zlamalp"}, "path": "perun-registrar-lib/src/main/java/cz/metacentrum/perun/registrar/modules/EduGain.java", "diffHunk": "@@ -34,7 +35,12 @@ public Application approveApplication(PerunSession session, Application app) thr\n \n \t\t\tAuthzResolver.setRole(session, user, vo, Role.TOPGROUPCREATOR);\n \n-\t\t\tGroup membersGroup = session.getPerun().getGroupsManager().getGroupByName(session, vo, \"members\");\n+\t\t\tGroup membersGroup = null;\n+\t\t\ttry {\n+\t\t\t\tmembersGroup = session.getPerun().getGroupsManager().getGroupByName(session, vo, \"members\");\n+\t\t\t} catch (InvalidGroupNameException e) {\n+\t\t\t\t// shouldn't happen, \"members\" is a valid name", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "60961d3010e9f9af6f8fc5477eeba0689bf00e64"}, "originalPosition": 17}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NzE3MTU1NA==", "bodyText": "Fixed.", "url": "https://github.com/CESNET/perun/pull/2789#discussion_r457171554", "createdAt": "2020-07-20T08:27:36Z", "author": {"login": "Vojtech-Sassmann"}, "path": "perun-registrar-lib/src/main/java/cz/metacentrum/perun/registrar/modules/EduGain.java", "diffHunk": "@@ -34,7 +35,12 @@ public Application approveApplication(PerunSession session, Application app) thr\n \n \t\t\tAuthzResolver.setRole(session, user, vo, Role.TOPGROUPCREATOR);\n \n-\t\t\tGroup membersGroup = session.getPerun().getGroupsManager().getGroupByName(session, vo, \"members\");\n+\t\t\tGroup membersGroup = null;\n+\t\t\ttry {\n+\t\t\t\tmembersGroup = session.getPerun().getGroupsManager().getGroupByName(session, vo, \"members\");\n+\t\t\t} catch (InvalidGroupNameException e) {\n+\t\t\t\t// shouldn't happen, \"members\" is a valid name", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NDk3NTMzNA=="}, "originalCommit": {"oid": "60961d3010e9f9af6f8fc5477eeba0689bf00e64"}, "originalPosition": 17}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjgzNzg2OTE5OnYy", "diffSide": "RIGHT", "path": "perun-core/src/main/java/cz/metacentrum/perun/core/impl/GroupsManagerImpl.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xNVQxMToyMTowMFrOGx5qKQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yMFQwODoyNzo1M1rOGz_jQA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NDk3ODA4OQ==", "bodyText": "This check is a safe-guard repetition of check from entry layer. Maybe we should add the same check for updateGroup().", "url": "https://github.com/CESNET/perun/pull/2789#discussion_r454978089", "createdAt": "2020-07-15T11:21:00Z", "author": {"login": "zlamalp"}, "path": "perun-core/src/main/java/cz/metacentrum/perun/core/impl/GroupsManagerImpl.java", "diffHunk": "@@ -122,9 +123,10 @@ public Group createGroup(PerunSession sess, Vo vo, Group group) throws GroupExis\n \t\t\t}\n \t\t}\n \n-\t\t// Check the group name, it can contain only a-Z0-9_- and space\n-\t\tif (!group.getShortName().matches(\"^[- a-zA-Z.0-9_]+$\")) {\n-\t\t\tthrow new InternalErrorException(new IllegalArgumentException(\"Wrong group name, group name can contain only a-Z0-9.-_: and space characters. \" + group));\n+\t\ttry {\n+\t\t\tUtils.validateGroupName(group.getShortName());", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "60961d3010e9f9af6f8fc5477eeba0689bf00e64"}, "originalPosition": 16}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NzE3MTc3Ng==", "bodyText": "I have added the check also to the update group method.", "url": "https://github.com/CESNET/perun/pull/2789#discussion_r457171776", "createdAt": "2020-07-20T08:27:53Z", "author": {"login": "Vojtech-Sassmann"}, "path": "perun-core/src/main/java/cz/metacentrum/perun/core/impl/GroupsManagerImpl.java", "diffHunk": "@@ -122,9 +123,10 @@ public Group createGroup(PerunSession sess, Vo vo, Group group) throws GroupExis\n \t\t\t}\n \t\t}\n \n-\t\t// Check the group name, it can contain only a-Z0-9_- and space\n-\t\tif (!group.getShortName().matches(\"^[- a-zA-Z.0-9_]+$\")) {\n-\t\t\tthrow new InternalErrorException(new IllegalArgumentException(\"Wrong group name, group name can contain only a-Z0-9.-_: and space characters. \" + group));\n+\t\ttry {\n+\t\t\tUtils.validateGroupName(group.getShortName());", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NDk3ODA4OQ=="}, "originalCommit": {"oid": "60961d3010e9f9af6f8fc5477eeba0689bf00e64"}, "originalPosition": 16}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1934, "cost": 1, "resetAt": "2021-11-12T18:49:56Z"}}}