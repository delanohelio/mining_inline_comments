{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0MzU5NTg1MDE2", "number": 2535, "title": "Forbid indirect relationship for group unions", "bodyText": "indirect relationship can exist between groups in the same structure,\nfor example if we have 3 groups \"A\", \"A:B\", \"A:B:C\", there is direct\nrelationship between \"A\" and \"A:B\" and also direct relationship between\n\"A:B\" and \"A:B:C\". Because all members of A:B:C are included by this\nrelationship to \"A:B\" and all such members are automatically included\ninto \"A\", there is indirect relationship between groups \"A\" and \"A:B:C\"\nnot saved in the database, but processed the same way\nwe want to prevent creating of unions between groups with such\nindirect relationship, so if someone want to create union from \"A:B:C\"\nto \"A\", it should be prohibited, because there is no benefit in such\nopration (all members of \"A:B:C\" are already indirect members of \"A\"\nthrough \"A:B\")\nthis situation need to be checked when new union has been created or\nexisting group has been moved and there is a possibility that wrong\nunion already exists\ntest for both of these use-case were added", "createdAt": "2020-01-06T15:15:43Z", "url": "https://github.com/CESNET/perun/pull/2535", "merged": true, "mergeCommit": {"oid": "ad632135787a2866b39f62a598eec7b0dba85838"}, "closed": true, "closedAt": "2020-01-20T13:54:03Z", "author": {"login": "stavamichal"}, "timelineItems": {"totalCount": 11, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABb3tvdmABqjI5MjQ1MjYyODQ=", "endCursor": "Y3Vyc29yOnYyOpPPAAABb8M67ugFqTM0NTMyMTkxNg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "bdad9b5e5000a0c2c0503d208bafd992926210cf", "author": {"user": {"login": "stavamichal", "name": "Michal Stava"}}, "url": "https://github.com/CESNET/perun/commit/bdad9b5e5000a0c2c0503d208bafd992926210cf", "committedDate": "2020-01-06T15:14:24Z", "message": "Forbid indirect relationship for group unions\n\n - indirect relationship can exist between groups in the same structure,\n for example if we have 3 groups \"A\", \"A:B\", \"A:B:C\", there is direct\n relationship between \"A\" and \"A:B\" and also direct relationship between\n \"A:B\" and \"A:B:C\". Because all members of A:B:C are included by this\n relationship to \"A:B\" and all such members are automatically included\n into \"A\", there is indirect relationship between groups \"A\" and \"A:B:C\"\n not saved in the database, but processed the same way\n - we want to prevent creating of unions between groups with such\n indirect relationship, so if someone want to create union from \"A:B:C\"\n to \"A\", it should be prohibit, because there is no benefit in such\n opration (all members of \"A:B:C\" are already indirect members of \"A\"\n through \"A:B\")\n - test for this use-case was added"}, "afterCommit": {"oid": "f6a1857ae9f5ef5a80ca8e9bff2db58ae6777dda", "author": {"user": {"login": "stavamichal", "name": "Michal Stava"}}, "url": "https://github.com/CESNET/perun/commit/f6a1857ae9f5ef5a80ca8e9bff2db58ae6777dda", "committedDate": "2020-01-06T15:17:56Z", "message": "Forbid indirect relationship for group unions\n\n - indirect relationship can exist between groups in the same structure,\n for example if we have 3 groups \"A\", \"A:B\", \"A:B:C\", there is direct\n relationship between \"A\" and \"A:B\" and also direct relationship between\n \"A:B\" and \"A:B:C\". Because all members of A:B:C are included by this\n relationship to \"A:B\" and all such members are automatically included\n into \"A\", there is indirect relationship between groups \"A\" and \"A:B:C\"\n not saved in the database, but processed the same way\n - we want to prevent creating of unions between groups with such\n indirect relationship, so if someone want to create union from \"A:B:C\"\n to \"A\", it should be prohibited, because there is no benefit in such\n opration (all members of \"A:B:C\" are already indirect members of \"A\"\n through \"A:B\")\n - test for this use-case was added"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzM5MTEyMjg0", "url": "https://github.com/CESNET/perun/pull/2535#pullrequestreview-339112284", "createdAt": "2020-01-07T09:16:11Z", "commit": {"oid": "f6a1857ae9f5ef5a80ca8e9bff2db58ae6777dda"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0wN1QwOToxNjoxMVrOFazq9g==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0wN1QwOToyMzozOVrOFaz29w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2MzY1Mzg3OA==", "bodyText": "Shouldn't this verify the presence of the resultGroup instead?\n\n  \n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            \t\tif(allParentGroups.contains(operandGroup)) {\n          \n          \n            \n            \t\tif(allParentGroups.contains(resultGroup)) {", "url": "https://github.com/CESNET/perun/pull/2535#discussion_r363653878", "createdAt": "2020-01-07T09:16:11Z", "author": {"login": "Vojtech-Sassmann"}, "path": "perun-core/src/main/java/cz/metacentrum/perun/core/blImpl/GroupsManagerBlImpl.java", "diffHunk": "@@ -4109,7 +4109,14 @@ public Group createGroupUnion(PerunSession sess, Group resultGroup, Group operan\n \t\t// check if there is already a record of these two groups\n \t\tif (this.groupsManagerImpl.isRelationBetweenGroups(resultGroup, operandGroup)) {\n \t\t\tthrow new GroupRelationAlreadyExists(\"There is already a relation defined between result group \" + resultGroup +\n-\t\t\t\t\t\" and operand group \" + operandGroup + \" or they are in hierarchical structure.\");\n+\t\t\t\t\t\" and operand group \" + operandGroup + \" or they are in direct hierarchical structure.\");\n+\t\t}\n+\n+\t\t// check indirect relationships (for example \"A\" with \"A:B:C\" are in indirect relationship using \"A:B\")\n+\t\tList<Group> allParentGroups = this.getParentGroups(sess, operandGroup);\n+\t\tif(allParentGroups.contains(operandGroup)) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f6a1857ae9f5ef5a80ca8e9bff2db58ae6777dda"}, "originalPosition": 10}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2MzY1Njk1MQ==", "bodyText": "I think there is an invalid order of the groups. The way it is implemented now, this test creates this relation:\n2\n|\n3\n|\n4\nAnd calling createGroupUnion(sess, group4, group2, false) tries to import members from group2 to group4. This causes a cycle, and I am not sure if we can detect this in the current implementation. Also, the test passes because of the error which I have pointed out above.\n\n  \n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            \t\tgroupsManagerBl.createGroupUnion(sess, group4, group2, false);\n          \n          \n            \n            \t\tgroupsManagerBl.createGroupUnion(sess, group2, group4, false);", "url": "https://github.com/CESNET/perun/pull/2535#discussion_r363656951", "createdAt": "2020-01-07T09:23:39Z", "author": {"login": "Vojtech-Sassmann"}, "path": "perun-core/src/test/java/cz/metacentrum/perun/core/entry/GroupsManagerEntryIntegrationTest.java", "diffHunk": "@@ -245,6 +245,18 @@ public void expireMemberInSubGroupAndInUpperGroup() throws Exception {\n \t\t\t\tfoundMember.getGroupStatuses().get(group.getId()), MemberGroupStatus.EXPIRED);\n \t}\n \n+\t@Test (expected=GroupRelationNotAllowed.class)\n+\tpublic void createGroupUnionForIndirectRelationship() throws Exception {\n+\t\tSystem.out.println(CLASS_NAME + \"createGroupUnionForIndirectRelationship\");\n+\n+\t\tVo vo = setUpVo();\n+\t\tgroupsManagerBl.createGroup(sess, vo, group2);\n+\t\tgroupsManagerBl.createGroup(sess, group2, group3);\n+\t\tgroupsManagerBl.createGroup(sess, group3, group4);\n+\n+\t\tgroupsManagerBl.createGroupUnion(sess, group4, group2, false);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f6a1857ae9f5ef5a80ca8e9bff2db58ae6777dda"}, "originalPosition": 13}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "f6a1857ae9f5ef5a80ca8e9bff2db58ae6777dda", "author": {"user": {"login": "stavamichal", "name": "Michal Stava"}}, "url": "https://github.com/CESNET/perun/commit/f6a1857ae9f5ef5a80ca8e9bff2db58ae6777dda", "committedDate": "2020-01-06T15:17:56Z", "message": "Forbid indirect relationship for group unions\n\n - indirect relationship can exist between groups in the same structure,\n for example if we have 3 groups \"A\", \"A:B\", \"A:B:C\", there is direct\n relationship between \"A\" and \"A:B\" and also direct relationship between\n \"A:B\" and \"A:B:C\". Because all members of A:B:C are included by this\n relationship to \"A:B\" and all such members are automatically included\n into \"A\", there is indirect relationship between groups \"A\" and \"A:B:C\"\n not saved in the database, but processed the same way\n - we want to prevent creating of unions between groups with such\n indirect relationship, so if someone want to create union from \"A:B:C\"\n to \"A\", it should be prohibited, because there is no benefit in such\n opration (all members of \"A:B:C\" are already indirect members of \"A\"\n through \"A:B\")\n - test for this use-case was added"}, "afterCommit": {"oid": "3ac3bea7f6f9b4fcbf285dde3eee40cf7e382640", "author": {"user": {"login": "stavamichal", "name": "Michal Stava"}}, "url": "https://github.com/CESNET/perun/commit/3ac3bea7f6f9b4fcbf285dde3eee40cf7e382640", "committedDate": "2020-01-07T12:09:27Z", "message": "Forbid indirect relationship for group unions\n\n - indirect relationship can exist between groups in the same structure,\n for example if we have 3 groups \"A\", \"A:B\", \"A:B:C\", there is direct\n relationship between \"A\" and \"A:B\" and also direct relationship between\n \"A:B\" and \"A:B:C\". Because all members of A:B:C are included by this\n relationship to \"A:B\" and all such members are automatically included\n into \"A\", there is indirect relationship between groups \"A\" and \"A:B:C\"\n not saved in the database, but processed the same way\n - we want to prevent creating of unions between groups with such\n indirect relationship, so if someone want to create union from \"A:B:C\"\n to \"A\", it should be prohibited, because there is no benefit in such\n opration (all members of \"A:B:C\" are already indirect members of \"A\"\n through \"A:B\")\n - test for this use-case was added"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "3ac3bea7f6f9b4fcbf285dde3eee40cf7e382640", "author": {"user": {"login": "stavamichal", "name": "Michal Stava"}}, "url": "https://github.com/CESNET/perun/commit/3ac3bea7f6f9b4fcbf285dde3eee40cf7e382640", "committedDate": "2020-01-07T12:09:27Z", "message": "Forbid indirect relationship for group unions\n\n - indirect relationship can exist between groups in the same structure,\n for example if we have 3 groups \"A\", \"A:B\", \"A:B:C\", there is direct\n relationship between \"A\" and \"A:B\" and also direct relationship between\n \"A:B\" and \"A:B:C\". Because all members of A:B:C are included by this\n relationship to \"A:B\" and all such members are automatically included\n into \"A\", there is indirect relationship between groups \"A\" and \"A:B:C\"\n not saved in the database, but processed the same way\n - we want to prevent creating of unions between groups with such\n indirect relationship, so if someone want to create union from \"A:B:C\"\n to \"A\", it should be prohibited, because there is no benefit in such\n opration (all members of \"A:B:C\" are already indirect members of \"A\"\n through \"A:B\")\n - test for this use-case was added"}, "afterCommit": {"oid": "389121ae29c3b0bc5de37fd2305f0f0ae3d75081", "author": {"user": {"login": "stavamichal", "name": "Michal Stava"}}, "url": "https://github.com/CESNET/perun/commit/389121ae29c3b0bc5de37fd2305f0f0ae3d75081", "committedDate": "2020-01-07T13:53:18Z", "message": "Forbid indirect relationship for group unions\n\n - indirect relationship can exist between groups in the same structure,\n for example if we have 3 groups \"A\", \"A:B\", \"A:B:C\", there is direct\n relationship between \"A\" and \"A:B\" and also direct relationship between\n \"A:B\" and \"A:B:C\". Because all members of A:B:C are included by this\n relationship to \"A:B\" and all such members are automatically included\n into \"A\", there is indirect relationship between groups \"A\" and \"A:B:C\"\n not saved in the database, but processed the same way\n - we want to prevent creating of unions between groups with such\n indirect relationship, so if someone want to create union from \"A:B:C\"\n to \"A\", it should be prohibited, because there is no benefit in such\n opration (all members of \"A:B:C\" are already indirect members of \"A\"\n through \"A:B\")\n - this situation need to be checked when new union has been created or\n existing group has been moved and there is a possibility that wrong\n union already exists\n - test for both of these use-case were added"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "389121ae29c3b0bc5de37fd2305f0f0ae3d75081", "author": {"user": {"login": "stavamichal", "name": "Michal Stava"}}, "url": "https://github.com/CESNET/perun/commit/389121ae29c3b0bc5de37fd2305f0f0ae3d75081", "committedDate": "2020-01-07T13:53:18Z", "message": "Forbid indirect relationship for group unions\n\n - indirect relationship can exist between groups in the same structure,\n for example if we have 3 groups \"A\", \"A:B\", \"A:B:C\", there is direct\n relationship between \"A\" and \"A:B\" and also direct relationship between\n \"A:B\" and \"A:B:C\". Because all members of A:B:C are included by this\n relationship to \"A:B\" and all such members are automatically included\n into \"A\", there is indirect relationship between groups \"A\" and \"A:B:C\"\n not saved in the database, but processed the same way\n - we want to prevent creating of unions between groups with such\n indirect relationship, so if someone want to create union from \"A:B:C\"\n to \"A\", it should be prohibited, because there is no benefit in such\n opration (all members of \"A:B:C\" are already indirect members of \"A\"\n through \"A:B\")\n - this situation need to be checked when new union has been created or\n existing group has been moved and there is a possibility that wrong\n union already exists\n - test for both of these use-case were added"}, "afterCommit": {"oid": "0e724d632b17ee6c078dd28e39c7b053cd53bb68", "author": {"user": {"login": "stavamichal", "name": "Michal Stava"}}, "url": "https://github.com/CESNET/perun/commit/0e724d632b17ee6c078dd28e39c7b053cd53bb68", "committedDate": "2020-01-07T14:35:19Z", "message": "Forbid indirect relationship for group unions\n\n - indirect relationship can exist between groups in the same structure,\n for example if we have 3 groups \"A\", \"A:B\", \"A:B:C\", there is direct\n relationship between \"A\" and \"A:B\" and also direct relationship between\n \"A:B\" and \"A:B:C\". Because all members of A:B:C are included by this\n relationship to \"A:B\" and all such members are automatically included\n into \"A\", there is indirect relationship between groups \"A\" and \"A:B:C\"\n not saved in the database, but processed the same way\n - we want to prevent creating of unions between groups with such\n indirect relationship, so if someone want to create union from \"A:B:C\"\n to \"A\", it should be prohibited, because there is no benefit in such\n opration (all members of \"A:B:C\" are already indirect members of \"A\"\n through \"A:B\")\n - this situation need to be checked when new union has been created or\n existing group has been moved and there is a possibility that wrong\n union already exists\n - test for both of these use-case were added"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzQwMzY4Njcw", "url": "https://github.com/CESNET/perun/pull/2535#pullrequestreview-340368670", "createdAt": "2020-01-09T08:58:35Z", "commit": {"oid": "0e724d632b17ee6c078dd28e39c7b053cd53bb68"}, "state": "COMMENTED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "0e724d632b17ee6c078dd28e39c7b053cd53bb68", "author": {"user": {"login": "stavamichal", "name": "Michal Stava"}}, "url": "https://github.com/CESNET/perun/commit/0e724d632b17ee6c078dd28e39c7b053cd53bb68", "committedDate": "2020-01-07T14:35:19Z", "message": "Forbid indirect relationship for group unions\n\n - indirect relationship can exist between groups in the same structure,\n for example if we have 3 groups \"A\", \"A:B\", \"A:B:C\", there is direct\n relationship between \"A\" and \"A:B\" and also direct relationship between\n \"A:B\" and \"A:B:C\". Because all members of A:B:C are included by this\n relationship to \"A:B\" and all such members are automatically included\n into \"A\", there is indirect relationship between groups \"A\" and \"A:B:C\"\n not saved in the database, but processed the same way\n - we want to prevent creating of unions between groups with such\n indirect relationship, so if someone want to create union from \"A:B:C\"\n to \"A\", it should be prohibited, because there is no benefit in such\n opration (all members of \"A:B:C\" are already indirect members of \"A\"\n through \"A:B\")\n - this situation need to be checked when new union has been created or\n existing group has been moved and there is a possibility that wrong\n union already exists\n - test for both of these use-case were added"}, "afterCommit": {"oid": "c5a5183730bcc6af68f63389792c8ddfcfe82f2d", "author": {"user": {"login": "stavamichal", "name": "Michal Stava"}}, "url": "https://github.com/CESNET/perun/commit/c5a5183730bcc6af68f63389792c8ddfcfe82f2d", "committedDate": "2020-01-09T10:20:33Z", "message": "Forbid indirect relationship for group unions\n\n - indirect relationship can exist between groups in the same structure,\n for example if we have 3 groups \"A\", \"A:B\", \"A:B:C\", there is direct\n relationship between \"A\" and \"A:B\" and also direct relationship between\n \"A:B\" and \"A:B:C\". Because all members of A:B:C are included by this\n relationship to \"A:B\" and all such members are automatically included\n into \"A\", there is indirect relationship between groups \"A\" and \"A:B:C\"\n not saved in the database, but processed the same way\n - we want to prevent creating of unions between groups with such\n indirect relationship, so if someone want to create union from \"A:B:C\"\n to \"A\", it should be prohibited, because there is no benefit in such\n opration (all members of \"A:B:C\" are already indirect members of \"A\"\n through \"A:B\")\n - this situation need to be checked when new union has been created or\n existing group has been moved and there is a possibility that wrong\n union already exists\n - test for both of these use-case were added"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzQ0NTk3MDg4", "url": "https://github.com/CESNET/perun/pull/2535#pullrequestreview-344597088", "createdAt": "2020-01-17T14:04:03Z", "commit": {"oid": "c5a5183730bcc6af68f63389792c8ddfcfe82f2d"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0xN1QxNDowNDowM1rOFe548A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0xN1QxNDowNDowM1rOFe548A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2Nzk1MDA2NA==", "bodyText": "I think the use of Sets, with their intersection operation, would improve the performance on larger group structures.", "url": "https://github.com/CESNET/perun/pull/2535#discussion_r367950064", "createdAt": "2020-01-17T14:04:03Z", "author": {"login": "Vojtech-Sassmann"}, "path": "perun-core/src/main/java/cz/metacentrum/perun/core/blImpl/GroupsManagerBlImpl.java", "diffHunk": "@@ -671,11 +671,42 @@ public void moveGroup(PerunSession sess, Group destinationGroup, Group movingGro\n \t\t\t\tthrow new GroupMoveNotAllowedException(\"There is already group union between moving group: \" + movingGroup + \" and destination group: \" + destinationGroup + \".\", movingGroup, destinationGroup);\n \t\t\t}\n \n+\t\t\t//prevent existence forbidden unions between groups after moving\n+\t\t\t//example: there are groups \"A\", \"A:B\" and \"C\", where \"C\" is included into \"A\" (there is a union), if we move \"C\" under \"A:B\", existing union will change to forbidden one\n+\t\t\t//Get all unions for moving group and all of its subgroups\n+\t\t\tList<Group> movingGroupStructureUnions = new ArrayList<>();\n+\t\t\tmovingGroupStructureUnions.addAll(getGroupUnions(sess, movingGroup, true));\n+\t\t\tfor(Group subGroup: getAllSubGroups(sess, movingGroup)) {\n+\t\t\t\tmovingGroupStructureUnions.addAll(getGroupUnions(sess, subGroup, true));\n+\t\t\t}\n+\t\t\t//remove direct relationship from moving group to it's parent group (if exists)\n+\t\t\t//prevent wrong exception in situation like \"A\", \"A:B\", \"A:C\" and moving \"A:C\" under \"A:B\", which is correct\n+\t\t\tif(movingGroup.getParentGroupId() != null) {\n+\t\t\t\ttry {\n+\t\t\t\t\tGroup parentGroupOfMovingGroup = getParentGroup(sess, movingGroup);\n+\t\t\t\t\tmovingGroupStructureUnions.remove(parentGroupOfMovingGroup);\n+\t\t\t\t} catch (ParentGroupNotExistsException ex) {\n+\t\t\t\t\tthrow new InternalErrorException(\"Can't find parentGroup for \" + movingGroup);\n+\t\t\t\t}\n+\t\t\t}\n+\n+\t\t\t//Get all group stucture of destination group (destination group all all its parent groups)\n+\t\t\tList<Group> destinationGroupStructure = new ArrayList<>();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c5a5183730bcc6af68f63389792c8ddfcfe82f2d"}, "originalPosition": 24}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "110c0e7d5eafb218c5f352290664c35d45e2a1c6", "author": {"user": {"login": "stavamichal", "name": "Michal Stava"}}, "url": "https://github.com/CESNET/perun/commit/110c0e7d5eafb218c5f352290664c35d45e2a1c6", "committedDate": "2020-01-20T12:31:40Z", "message": "Forbid indirect relationship for group unions\n\n - indirect relationship can exist between groups in the same structure,\n for example if we have 3 groups \"A\", \"A:B\", \"A:B:C\", there is direct\n relationship between \"A\" and \"A:B\" and also direct relationship between\n \"A:B\" and \"A:B:C\". Because all members of A:B:C are included by this\n relationship to \"A:B\" and all such members are automatically included\n into \"A\", there is indirect relationship between groups \"A\" and \"A:B:C\"\n not saved in the database, but processed the same way\n - we want to prevent creating of unions between groups with such\n indirect relationship, so if someone want to create union from \"A:B:C\"\n to \"A\", it should be prohibited, because there is no benefit in such\n opration (all members of \"A:B:C\" are already indirect members of \"A\"\n through \"A:B\")\n - this situation need to be checked when new union has been created or\n existing group has been moved and there is a possibility that wrong\n union already exists\n - test for both of these use-case were added"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "c5a5183730bcc6af68f63389792c8ddfcfe82f2d", "author": {"user": {"login": "stavamichal", "name": "Michal Stava"}}, "url": "https://github.com/CESNET/perun/commit/c5a5183730bcc6af68f63389792c8ddfcfe82f2d", "committedDate": "2020-01-09T10:20:33Z", "message": "Forbid indirect relationship for group unions\n\n - indirect relationship can exist between groups in the same structure,\n for example if we have 3 groups \"A\", \"A:B\", \"A:B:C\", there is direct\n relationship between \"A\" and \"A:B\" and also direct relationship between\n \"A:B\" and \"A:B:C\". Because all members of A:B:C are included by this\n relationship to \"A:B\" and all such members are automatically included\n into \"A\", there is indirect relationship between groups \"A\" and \"A:B:C\"\n not saved in the database, but processed the same way\n - we want to prevent creating of unions between groups with such\n indirect relationship, so if someone want to create union from \"A:B:C\"\n to \"A\", it should be prohibited, because there is no benefit in such\n opration (all members of \"A:B:C\" are already indirect members of \"A\"\n through \"A:B\")\n - this situation need to be checked when new union has been created or\n existing group has been moved and there is a possibility that wrong\n union already exists\n - test for both of these use-case were added"}, "afterCommit": {"oid": "110c0e7d5eafb218c5f352290664c35d45e2a1c6", "author": {"user": {"login": "stavamichal", "name": "Michal Stava"}}, "url": "https://github.com/CESNET/perun/commit/110c0e7d5eafb218c5f352290664c35d45e2a1c6", "committedDate": "2020-01-20T12:31:40Z", "message": "Forbid indirect relationship for group unions\n\n - indirect relationship can exist between groups in the same structure,\n for example if we have 3 groups \"A\", \"A:B\", \"A:B:C\", there is direct\n relationship between \"A\" and \"A:B\" and also direct relationship between\n \"A:B\" and \"A:B:C\". Because all members of A:B:C are included by this\n relationship to \"A:B\" and all such members are automatically included\n into \"A\", there is indirect relationship between groups \"A\" and \"A:B:C\"\n not saved in the database, but processed the same way\n - we want to prevent creating of unions between groups with such\n indirect relationship, so if someone want to create union from \"A:B:C\"\n to \"A\", it should be prohibited, because there is no benefit in such\n opration (all members of \"A:B:C\" are already indirect members of \"A\"\n through \"A:B\")\n - this situation need to be checked when new union has been created or\n existing group has been moved and there is a possibility that wrong\n union already exists\n - test for both of these use-case were added"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzQ1MzIxOTE2", "url": "https://github.com/CESNET/perun/pull/2535#pullrequestreview-345321916", "createdAt": "2020-01-20T13:53:37Z", "commit": {"oid": "110c0e7d5eafb218c5f352290664c35d45e2a1c6"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1392, "cost": 1, "resetAt": "2021-11-01T13:07:16Z"}}}