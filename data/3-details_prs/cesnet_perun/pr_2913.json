{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDk0NzcyNzMz", "number": 2913, "title": "New method for getting sponsored members and their sponsors", "bodyText": "We want to create a new method, which returns sponsored members and their sponsors for specific VO.\nThe method returns list of sponsored members and for each of them list of rich users, who sponsor this sponsored member.\nThe returned object also have to be filtered - the method returns to the sponsor only members, who are sponsored by this sponsor.", "createdAt": "2020-09-29T11:51:12Z", "url": "https://github.com/CESNET/perun/pull/2913", "merged": true, "mergeCommit": {"oid": "a7a58b848893b07bf420ca436bd1b97de71df693"}, "closed": true, "closedAt": "2020-10-08T18:31:42Z", "author": {"login": "HejdaJakub"}, "timelineItems": {"totalCount": 21, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdNnkWRgBqjM4MTkzNzAzNTE=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdQfkFvAFqTUwNDY2ODc2Mw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "d04925700364005af1dec75ae477a6e9c08a8255", "author": {"user": {"login": "HejdaJakub", "name": null}}, "url": "https://github.com/CESNET/perun/commit/d04925700364005af1dec75ae477a6e9c08a8255", "committedDate": "2020-09-29T11:40:35Z", "message": "New method for getting sponsored members and their sponsors\n\n* We want to create a new method, which returns sponsored members and their sponsors for specific VO.\n* The method returns list of sponsored members and for each of them list of rich users, who sponsor this sponsored member.\n* The returned object also have to be filtered - the method returns to the sponsor only members, who are sponsored by this sponsor."}, "afterCommit": {"oid": "05f943a2efca3422f070d2e1576c59322bc6b52e", "author": {"user": {"login": "HejdaJakub", "name": null}}, "url": "https://github.com/CESNET/perun/commit/05f943a2efca3422f070d2e1576c59322bc6b52e", "committedDate": "2020-09-29T12:43:43Z", "message": "New method for getting sponsored members and their sponsors\n\n* We want to create a new method, which returns sponsored members and their sponsors for specific VO.\n* The method returns list of sponsored members and for each of them list of rich users, who sponsor this sponsored member.\n* The returned object also have to be filtered - the method returns to the sponsor only members, who are sponsored by this sponsor."}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "05f943a2efca3422f070d2e1576c59322bc6b52e", "author": {"user": {"login": "HejdaJakub", "name": null}}, "url": "https://github.com/CESNET/perun/commit/05f943a2efca3422f070d2e1576c59322bc6b52e", "committedDate": "2020-09-29T12:43:43Z", "message": "New method for getting sponsored members and their sponsors\n\n* We want to create a new method, which returns sponsored members and their sponsors for specific VO.\n* The method returns list of sponsored members and for each of them list of rich users, who sponsor this sponsored member.\n* The returned object also have to be filtered - the method returns to the sponsor only members, who are sponsored by this sponsor."}, "afterCommit": {"oid": "fd91476d6108e132e70f1d906fe151c37b95c167", "author": {"user": {"login": "HejdaJakub", "name": null}}, "url": "https://github.com/CESNET/perun/commit/fd91476d6108e132e70f1d906fe151c37b95c167", "committedDate": "2020-09-29T13:15:28Z", "message": "New method for getting sponsored members and their sponsors\n\n* We want to create a new method, which returns sponsored members and their sponsors for specific VO.\n* The method returns list of sponsored members and for each of them list of rich users, who sponsor this sponsored member.\n* The returned object also have to be filtered - the method returns to the sponsor only members, who are sponsored by this sponsor."}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "fd91476d6108e132e70f1d906fe151c37b95c167", "author": {"user": {"login": "HejdaJakub", "name": null}}, "url": "https://github.com/CESNET/perun/commit/fd91476d6108e132e70f1d906fe151c37b95c167", "committedDate": "2020-09-29T13:15:28Z", "message": "New method for getting sponsored members and their sponsors\n\n* We want to create a new method, which returns sponsored members and their sponsors for specific VO.\n* The method returns list of sponsored members and for each of them list of rich users, who sponsor this sponsored member.\n* The returned object also have to be filtered - the method returns to the sponsor only members, who are sponsored by this sponsor."}, "afterCommit": {"oid": "87885dd0cd587f73ddf275f209f041fff3f8a3b1", "author": {"user": {"login": "HejdaJakub", "name": null}}, "url": "https://github.com/CESNET/perun/commit/87885dd0cd587f73ddf275f209f041fff3f8a3b1", "committedDate": "2020-09-29T14:36:08Z", "message": "New method for getting sponsored members and their sponsors\n\n* We want to create a new method, which returns sponsored members and their sponsors for specific VO.\n* The method returns list of sponsored members and for each of them list of rich users, who sponsor this sponsored member.\n* The returned object also have to be filtered - the method returns to the sponsor only members, who are sponsored by this sponsor."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTAwMDM4NDk5", "url": "https://github.com/CESNET/perun/pull/2913#pullrequestreview-500038499", "createdAt": "2020-10-01T06:25:08Z", "commit": {"oid": "87885dd0cd587f73ddf275f209f041fff3f8a3b1"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wMVQwNjoyNTowOFrOHa8CqA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wMVQwNjozODo0N1rOHa8WVw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5ODAwODc0NA==", "bodyText": "We already have this method in the UsersManagerBl. Please use it instead of the new implementation in MembersManagerBl.", "url": "https://github.com/CESNET/perun/pull/2913#discussion_r498008744", "createdAt": "2020-10-01T06:25:08Z", "author": {"login": "zlamalp"}, "path": "perun-core/src/main/java/cz/metacentrum/perun/core/bl/MembersManagerBl.java", "diffHunk": "@@ -895,6 +896,15 @@\n \t */\n \tList<RichMember> convertMembersToRichMembers(PerunSession sess, List<Member> members);\n \n+\t/**\n+\t * Converts users to rich users.\n+\t *\n+\t * @param sess\n+\t * @param users\n+\t * @return\n+\t */\n+\tList<RichUser> convertUsersToRichUsers(PerunSession sess, List<User> users);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "87885dd0cd587f73ddf275f209f041fff3f8a3b1"}, "originalPosition": 19}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5ODAxMDQ4OQ==", "bodyText": "How about simplifying it\nfor (Member sponsoredMember : sponsoredMembers) {\n\tsponsoredMembersAndTheirSponsors.put(sponsoredMember, getPerunBl().getUsersManagerBl().convertUsersToRichUsers(sess, getPerunBl().getUsersManagerBl().getSponsors(sess, sponsoredMember)));\n}", "url": "https://github.com/CESNET/perun/pull/2913#discussion_r498010489", "createdAt": "2020-10-01T06:29:56Z", "author": {"login": "zlamalp"}, "path": "perun-core/src/main/java/cz/metacentrum/perun/core/blImpl/MembersManagerBlImpl.java", "diffHunk": "@@ -2331,6 +2353,19 @@ public Member sponsorMember(PerunSession session, Member sponsoredMember, User s\n \t\treturn getMembersManagerImpl().getSponsoredMembers(sess, vo);\n \t}\n \n+\t@Override\n+\tpublic Map<Member, List<RichUser>> getSponsoredMembersAndTheirSponsors(PerunSession sess, Vo vo) {\n+\t\tMap<Member, List<RichUser>> sponsoredMembersAndTheirSponsors = new HashMap<>();\n+\t\tList<Member> sponsoredMembers = getSponsoredMembers(sess, vo);\n+\t\tList<User> sponsors;\n+\t\tfor (Member sponsoredMember : sponsoredMembers) {\n+\t\t\tsponsors = getPerunBl().getUsersManagerBl().getSponsors(sess, sponsoredMember);\n+\t\t\tsponsoredMembersAndTheirSponsors.put(sponsoredMember, convertUsersToRichUsers(sess, sponsors));\n+\t\t\tsponsors.clear();\n+\t\t}", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "87885dd0cd587f73ddf275f209f041fff3f8a3b1"}, "originalPosition": 49}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5ODAxMzMxMg==", "bodyText": "I don't think that this will work since the returned json doesn't contains properties \"member\" and \"sponsors\", but is plain object, where keys are the member objects and their values are plain lists of sponsors. Maybe see the definition above or consult it with @martin-kuba.", "url": "https://github.com/CESNET/perun/pull/2913#discussion_r498013312", "createdAt": "2020-10-01T06:37:30Z", "author": {"login": "zlamalp"}, "path": "perun-openapi/openapi.yml", "diffHunk": "@@ -924,6 +924,14 @@ components:\n           items:\n             type: integer\n \n+    #Map<Member, List<RichUser>>\n+    MembersAndTheirSponsors:\n+      type: object\n+      properties:\n+        member: { $ref: '#/components/schemas/Member' }\n+        sponsors: { type: array, items: { $ref: '#/components/schemas/RichUser' }}", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "87885dd0cd587f73ddf275f209f041fff3f8a3b1"}, "originalPosition": 9}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5ODAxMzc4Mw==", "bodyText": "We do not usually specify PrivilegeException in the RPC docs, since its added automatically by the docs parsing tool.", "url": "https://github.com/CESNET/perun/pull/2913#discussion_r498013783", "createdAt": "2020-10-01T06:38:47Z", "author": {"login": "zlamalp"}, "path": "perun-rpc/src/main/java/cz/metacentrum/perun/rpc/methods/MembersManagerMethod.java", "diffHunk": "@@ -290,6 +292,23 @@ public String call(ApiCaller ac, Deserializer params) throws PerunException {\n \t\t}\n \t},\n \n+\t/*#\n+\t * Gets map of sponsored members and lists of their sponsors for each of them.\n+\t *\n+\t * @param vo int id of virtual organization from which are the sponsored members chosen\n+\t * @throw VoNotExistsException if given VO does not exist\n+\t * @throw PrivilegeException if not VOADMIN, VOOBSERVER, PERUNOBSERVER or SPONSOR", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "87885dd0cd587f73ddf275f209f041fff3f8a3b1"}, "originalPosition": 19}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTAwNTE0Mzcw", "url": "https://github.com/CESNET/perun/pull/2913#pullrequestreview-500514370", "createdAt": "2020-10-01T16:19:20Z", "commit": {"oid": "87885dd0cd587f73ddf275f209f041fff3f8a3b1"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "87885dd0cd587f73ddf275f209f041fff3f8a3b1", "author": {"user": {"login": "HejdaJakub", "name": null}}, "url": "https://github.com/CESNET/perun/commit/87885dd0cd587f73ddf275f209f041fff3f8a3b1", "committedDate": "2020-09-29T14:36:08Z", "message": "New method for getting sponsored members and their sponsors\n\n* We want to create a new method, which returns sponsored members and their sponsors for specific VO.\n* The method returns list of sponsored members and for each of them list of rich users, who sponsor this sponsored member.\n* The returned object also have to be filtered - the method returns to the sponsor only members, who are sponsored by this sponsor."}, "afterCommit": {"oid": "c4608537c2aa3a81abd350e5d49c1adc41aed3a9", "author": {"user": {"login": "HejdaJakub", "name": null}}, "url": "https://github.com/CESNET/perun/commit/c4608537c2aa3a81abd350e5d49c1adc41aed3a9", "committedDate": "2020-10-05T13:28:46Z", "message": "New method for getting sponsored members and their sponsors\n\n* We want to create a new method, which returns sponsored members and their sponsors for specific VO.\n* The method returns list of sponsored members and for each of them list of rich users, who sponsor this sponsored member.\n* The returned object also have to be filtered - the method returns to the sponsor only members, who are sponsored by this sponsor."}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "c4608537c2aa3a81abd350e5d49c1adc41aed3a9", "author": {"user": {"login": "HejdaJakub", "name": null}}, "url": "https://github.com/CESNET/perun/commit/c4608537c2aa3a81abd350e5d49c1adc41aed3a9", "committedDate": "2020-10-05T13:28:46Z", "message": "New method for getting sponsored members and their sponsors\n\n* We want to create a new method, which returns sponsored members and their sponsors for specific VO.\n* The method returns list of sponsored members and for each of them list of rich users, who sponsor this sponsored member.\n* The returned object also have to be filtered - the method returns to the sponsor only members, who are sponsored by this sponsor."}, "afterCommit": {"oid": "94109f6aa41105b49a3281a15c659fafdd895675", "author": {"user": {"login": "HejdaJakub", "name": null}}, "url": "https://github.com/CESNET/perun/commit/94109f6aa41105b49a3281a15c659fafdd895675", "committedDate": "2020-10-05T13:35:18Z", "message": "New method for getting sponsored members and their sponsors\n\n* We want to create a new method, which returns sponsored members and their sponsors for specific VO.\n* The method returns list of sponsored members and for each of them list of rich users, who sponsor this sponsored member.\n* The returned object also have to be filtered - the method returns to the sponsor only members, who are sponsored by this sponsor."}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "94109f6aa41105b49a3281a15c659fafdd895675", "author": {"user": {"login": "HejdaJakub", "name": null}}, "url": "https://github.com/CESNET/perun/commit/94109f6aa41105b49a3281a15c659fafdd895675", "committedDate": "2020-10-05T13:35:18Z", "message": "New method for getting sponsored members and their sponsors\n\n* We want to create a new method, which returns sponsored members and their sponsors for specific VO.\n* The method returns list of sponsored members and for each of them list of rich users, who sponsor this sponsored member.\n* The returned object also have to be filtered - the method returns to the sponsor only members, who are sponsored by this sponsor."}, "afterCommit": {"oid": "beca08f492a463fe07df6f81be9d205d4cdf6734", "author": {"user": {"login": "HejdaJakub", "name": null}}, "url": "https://github.com/CESNET/perun/commit/beca08f492a463fe07df6f81be9d205d4cdf6734", "committedDate": "2020-10-06T07:01:05Z", "message": "New method for getting sponsored members and their sponsors\n\n* We want to create a new method, which returns sponsored members and their sponsors for specific VO.\n* The method returns list of sponsored members and for each of them list of rich users, who sponsor this sponsored member.\n* The returned object also have to be filtered - the method returns to the sponsor only members, who are sponsored by this sponsor."}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "beca08f492a463fe07df6f81be9d205d4cdf6734", "author": {"user": {"login": "HejdaJakub", "name": null}}, "url": "https://github.com/CESNET/perun/commit/beca08f492a463fe07df6f81be9d205d4cdf6734", "committedDate": "2020-10-06T07:01:05Z", "message": "New method for getting sponsored members and their sponsors\n\n* We want to create a new method, which returns sponsored members and their sponsors for specific VO.\n* The method returns list of sponsored members and for each of them list of rich users, who sponsor this sponsored member.\n* The returned object also have to be filtered - the method returns to the sponsor only members, who are sponsored by this sponsor."}, "afterCommit": {"oid": "5b97109b030c1e03b005ef2882bab7ac282d155e", "author": {"user": {"login": "HejdaJakub", "name": null}}, "url": "https://github.com/CESNET/perun/commit/5b97109b030c1e03b005ef2882bab7ac282d155e", "committedDate": "2020-10-06T07:16:31Z", "message": "New method for getting sponsored members and their sponsors\n\n* We want to create a new method, which returns sponsored members and their sponsors for specific VO.\n* The method returns list of sponsored members and for each of them list of rich users, who sponsor this sponsored member.\n* The returned object also have to be filtered - the method returns to the sponsor only members, who are sponsored by this sponsor."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTAyODc0OTY0", "url": "https://github.com/CESNET/perun/pull/2913#pullrequestreview-502874964", "createdAt": "2020-10-06T12:15:59Z", "commit": {"oid": "5b97109b030c1e03b005ef2882bab7ac282d155e"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "5b97109b030c1e03b005ef2882bab7ac282d155e", "author": {"user": {"login": "HejdaJakub", "name": null}}, "url": "https://github.com/CESNET/perun/commit/5b97109b030c1e03b005ef2882bab7ac282d155e", "committedDate": "2020-10-06T07:16:31Z", "message": "New method for getting sponsored members and their sponsors\n\n* We want to create a new method, which returns sponsored members and their sponsors for specific VO.\n* The method returns list of sponsored members and for each of them list of rich users, who sponsor this sponsored member.\n* The returned object also have to be filtered - the method returns to the sponsor only members, who are sponsored by this sponsor."}, "afterCommit": {"oid": "9875be80d93fd3950f70e8b4cffdc39d0c2cf7a6", "author": {"user": {"login": "HejdaJakub", "name": null}}, "url": "https://github.com/CESNET/perun/commit/9875be80d93fd3950f70e8b4cffdc39d0c2cf7a6", "committedDate": "2020-10-07T11:47:11Z", "message": "New method for getting sponsored members and their sponsors\n\n* We want to create a new method, which returns sponsored members and their sponsors for specific VO.\n* The method returns list of sponsored members (RichMembers) and for each of them list of users, who sponsor this sponsored member.\n* The returned object also have to be filtered - the method returns to the sponsor only members, who are sponsored by this sponsor."}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "9875be80d93fd3950f70e8b4cffdc39d0c2cf7a6", "author": {"user": {"login": "HejdaJakub", "name": null}}, "url": "https://github.com/CESNET/perun/commit/9875be80d93fd3950f70e8b4cffdc39d0c2cf7a6", "committedDate": "2020-10-07T11:47:11Z", "message": "New method for getting sponsored members and their sponsors\n\n* We want to create a new method, which returns sponsored members and their sponsors for specific VO.\n* The method returns list of sponsored members (RichMembers) and for each of them list of users, who sponsor this sponsored member.\n* The returned object also have to be filtered - the method returns to the sponsor only members, who are sponsored by this sponsor."}, "afterCommit": {"oid": "49d5d5cec38d61deb00387c0820d7f99946d3ce6", "author": {"user": {"login": "HejdaJakub", "name": null}}, "url": "https://github.com/CESNET/perun/commit/49d5d5cec38d61deb00387c0820d7f99946d3ce6", "committedDate": "2020-10-07T11:56:24Z", "message": "New method for getting sponsored members and their sponsors\n\n* We want to create a new method, which returns sponsored members and their sponsors for specific VO.\n* The method returns list of sponsored members (RichMembers) and for each of them list of users, who sponsor this sponsored member.\n* The returned object also have to be filtered - the method returns to the sponsor only members, who are sponsored by this sponsor."}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "49d5d5cec38d61deb00387c0820d7f99946d3ce6", "author": {"user": {"login": "HejdaJakub", "name": null}}, "url": "https://github.com/CESNET/perun/commit/49d5d5cec38d61deb00387c0820d7f99946d3ce6", "committedDate": "2020-10-07T11:56:24Z", "message": "New method for getting sponsored members and their sponsors\n\n* We want to create a new method, which returns sponsored members and their sponsors for specific VO.\n* The method returns list of sponsored members (RichMembers) and for each of them list of users, who sponsor this sponsored member.\n* The returned object also have to be filtered - the method returns to the sponsor only members, who are sponsored by this sponsor."}, "afterCommit": {"oid": "b6c0de9e409d962d904c2d6c48e56838a286b668", "author": {"user": {"login": "HejdaJakub", "name": null}}, "url": "https://github.com/CESNET/perun/commit/b6c0de9e409d962d904c2d6c48e56838a286b668", "committedDate": "2020-10-07T11:57:14Z", "message": "New method for getting sponsored members and their sponsors\n\n* We want to create a new method, which returns sponsored members and their sponsors for specific VO.\n* The method returns list of sponsored members (RichMembers) and for each of them list of users, who sponsor this sponsored member.\n* The returned object also have to be filtered - the method returns to the sponsor only members, who are sponsored by this sponsor."}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "b6c0de9e409d962d904c2d6c48e56838a286b668", "author": {"user": {"login": "HejdaJakub", "name": null}}, "url": "https://github.com/CESNET/perun/commit/b6c0de9e409d962d904c2d6c48e56838a286b668", "committedDate": "2020-10-07T11:57:14Z", "message": "New method for getting sponsored members and their sponsors\n\n* We want to create a new method, which returns sponsored members and their sponsors for specific VO.\n* The method returns list of sponsored members (RichMembers) and for each of them list of users, who sponsor this sponsored member.\n* The returned object also have to be filtered - the method returns to the sponsor only members, who are sponsored by this sponsor."}, "afterCommit": {"oid": "4a2f3a2edf238fc464e42fb4f82a0e794240e955", "author": {"user": {"login": "HejdaJakub", "name": null}}, "url": "https://github.com/CESNET/perun/commit/4a2f3a2edf238fc464e42fb4f82a0e794240e955", "committedDate": "2020-10-07T12:14:56Z", "message": "New method for getting sponsored members and their sponsors\n\n* We want to create a new method, which returns sponsored members and their sponsors for specific VO.\n* The method returns list of sponsored members (RichMembers) and for each of them list of users, who sponsor this sponsored member.\n* The returned object also have to be filtered - the method returns to the sponsor only members, who are sponsored by this sponsor."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTAzODMzMDQ1", "url": "https://github.com/CESNET/perun/pull/2913#pullrequestreview-503833045", "createdAt": "2020-10-07T12:39:47Z", "commit": {"oid": "4a2f3a2edf238fc464e42fb4f82a0e794240e955"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wN1QxMjozOTo0N1rOHdxRWQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wN1QxMjo0ODowN1rOHdxnEw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMDk3ODAwOQ==", "bodyText": "This should be just getSponsors() since it is a basic getter/setter for property List<User> sponsors.", "url": "https://github.com/CESNET/perun/pull/2913#discussion_r500978009", "createdAt": "2020-10-07T12:39:47Z", "author": {"login": "zlamalp"}, "path": "perun-base/src/main/java/cz/metacentrum/perun/core/api/MemberWithSponsors.java", "diffHunk": "@@ -0,0 +1,56 @@\n+package cz.metacentrum.perun.core.api;\n+\n+import java.util.List;\n+import java.util.Objects;\n+\n+/**\n+ * Sponsored member with list of his sponsors (for GUI)\n+ *\n+ * @author Jakub Hejda <Jakub.Hejda@cesnet.cz>\n+ */\n+public class MemberWithSponsors {\n+\tprivate RichMember member;\n+\tprivate List<User> sponsors;\n+\n+\t/**\n+\t * Constructor\n+\t */\n+\tpublic MemberWithSponsors() {\n+\t}\n+\n+\t/**\n+\t * Constructor\n+\t */\n+\tpublic MemberWithSponsors(RichMember member) {\n+\t\tthis.member = member;\n+\t}\n+\n+\tpublic Member getMember() {\n+\t\treturn member;\n+\t}\n+\n+\tpublic void setMember(RichMember member) {\n+\t\tthis.member = member;\n+\t}\n+\n+\tpublic List<User> getListOfSponsors() {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "4a2f3a2edf238fc464e42fb4f82a0e794240e955"}, "originalPosition": 36}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMDk3ODQ1Ng==", "bodyText": "Please add attrNames param to the javadoc.", "url": "https://github.com/CESNET/perun/pull/2913#discussion_r500978456", "createdAt": "2020-10-07T12:40:24Z", "author": {"login": "zlamalp"}, "path": "perun-core/src/main/java/cz/metacentrum/perun/core/api/MembersManager.java", "diffHunk": "@@ -1271,6 +1271,17 @@\n \t */\n \tList<RichMember> getSponsoredMembers(PerunSession sess, Vo vo) throws PrivilegeException, VoNotExistsException;\n \n+\t/**\n+\t * Gets list of sponsored members with sponsors.\n+\t *\n+\t * @param sess session\n+\t * @param vo virtual organization from which are the sponsored members chosen", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "4a2f3a2edf238fc464e42fb4f82a0e794240e955"}, "originalPosition": 8}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMDk4MzU3MQ==", "bodyText": "You should also filter only allowed attributes based on the caller authorization, see membersManagerBl.filterOnlyAllowedAttributes(sess, richMembers, null, true);", "url": "https://github.com/CESNET/perun/pull/2913#discussion_r500983571", "createdAt": "2020-10-07T12:48:07Z", "author": {"login": "zlamalp"}, "path": "perun-core/src/main/java/cz/metacentrum/perun/core/entry/MembersManagerEntry.java", "diffHunk": "@@ -1341,6 +1341,29 @@ public RichMember sponsorMember(PerunSession session, Member sponsored, User spo\n \t\treturn membersManagerBl.convertMembersToRichMembers(sess, membersManagerBl.getSponsoredMembers(sess, vo));\n \t}\n \n+\t@Override\n+\tpublic List<MemberWithSponsors> getSponsoredMembersAndTheirSponsors(PerunSession sess, Vo vo, List<String> attrNames) throws VoNotExistsException, PrivilegeException, AttributeNotExistsException {\n+\t\tUtils.checkPerunSession(sess);\n+\t\tUtils.notNull(vo, \"vo\");\n+\n+\t\tperunBl.getVosManagerBl().checkVoExists(sess, vo);\n+\n+\t\t//Authorization\n+\t\tif(!AuthzResolver.authorizedInternal(sess, \"getSponsoredMembersAndTheirSponsors_Vo_policy\", vo)) {\n+\t\t\tthrow new PrivilegeException(sess, \"getSponsoredMembersAndTheirSponsors\");\n+\t\t}\n+\n+\t\tList<AttributeDefinition> attrsDef = new ArrayList<>();\n+\t\tfor (String attrName : attrNames) {\n+\t\t\tattrsDef.add(getPerunBl().getAttributesManagerBl().getAttributeDefinition(sess, attrName));\n+\t\t}\n+\n+\t\treturn membersManagerBl.convertMembersToRichMembersWithAttributes(sess, getSponsoredMembers(sess, vo), attrsDef).stream()", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "4a2f3a2edf238fc464e42fb4f82a0e794240e955"}, "originalPosition": 47}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f246ac5039af0df65cee37bf3f9ea5de536d9012", "author": {"user": {"login": "HejdaJakub", "name": null}}, "url": "https://github.com/CESNET/perun/commit/f246ac5039af0df65cee37bf3f9ea5de536d9012", "committedDate": "2020-10-07T13:21:54Z", "message": "New method for getting sponsored members and their sponsors\n\n* We want to create a new method, which returns sponsored members and their sponsors for specific VO.\n* The method returns list of sponsored members (RichMembers) and for each of them list of users, who sponsor this sponsored member.\n* The returned object also have to be filtered - the method returns to the sponsor only members, who are sponsored by this sponsor."}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "4a2f3a2edf238fc464e42fb4f82a0e794240e955", "author": {"user": {"login": "HejdaJakub", "name": null}}, "url": "https://github.com/CESNET/perun/commit/4a2f3a2edf238fc464e42fb4f82a0e794240e955", "committedDate": "2020-10-07T12:14:56Z", "message": "New method for getting sponsored members and their sponsors\n\n* We want to create a new method, which returns sponsored members and their sponsors for specific VO.\n* The method returns list of sponsored members (RichMembers) and for each of them list of users, who sponsor this sponsored member.\n* The returned object also have to be filtered - the method returns to the sponsor only members, who are sponsored by this sponsor."}, "afterCommit": {"oid": "f246ac5039af0df65cee37bf3f9ea5de536d9012", "author": {"user": {"login": "HejdaJakub", "name": null}}, "url": "https://github.com/CESNET/perun/commit/f246ac5039af0df65cee37bf3f9ea5de536d9012", "committedDate": "2020-10-07T13:21:54Z", "message": "New method for getting sponsored members and their sponsors\n\n* We want to create a new method, which returns sponsored members and their sponsors for specific VO.\n* The method returns list of sponsored members (RichMembers) and for each of them list of users, who sponsor this sponsored member.\n* The returned object also have to be filtered - the method returns to the sponsor only members, who are sponsored by this sponsor."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTAzOTI0NDAz", "url": "https://github.com/CESNET/perun/pull/2913#pullrequestreview-503924403", "createdAt": "2020-10-07T14:12:34Z", "commit": {"oid": "f246ac5039af0df65cee37bf3f9ea5de536d9012"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTA0MDc1NTk4", "url": "https://github.com/CESNET/perun/pull/2913#pullrequestreview-504075598", "createdAt": "2020-10-07T16:46:34Z", "commit": {"oid": "f246ac5039af0df65cee37bf3f9ea5de536d9012"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTA0NTYxMzcx", "url": "https://github.com/CESNET/perun/pull/2913#pullrequestreview-504561371", "createdAt": "2020-10-08T08:49:17Z", "commit": {"oid": "f246ac5039af0df65cee37bf3f9ea5de536d9012"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wOFQwODo0OToxN1rOHeUTlA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wOFQwODo0OToxN1rOHeUTlA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMTU1MjAyMA==", "bodyText": "Is there any reason why do you call this version of the method instead of this one?\n\n  \n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            \t\trichMembers = membersManagerBl.filterOnlyAllowedAttributes(sess, richMembers, null, true);\n          \n          \n            \n            \t\trichMembers = membersManagerBl.filterOnlyAllowedAttributes(sess, richMembers);", "url": "https://github.com/CESNET/perun/pull/2913#discussion_r501552020", "createdAt": "2020-10-08T08:49:17Z", "author": {"login": "Vojtech-Sassmann"}, "path": "perun-core/src/main/java/cz/metacentrum/perun/core/entry/MembersManagerEntry.java", "diffHunk": "@@ -1341,6 +1341,32 @@ public RichMember sponsorMember(PerunSession session, Member sponsored, User spo\n \t\treturn membersManagerBl.convertMembersToRichMembers(sess, membersManagerBl.getSponsoredMembers(sess, vo));\n \t}\n \n+\t@Override\n+\tpublic List<MemberWithSponsors> getSponsoredMembersAndTheirSponsors(PerunSession sess, Vo vo, List<String> attrNames) throws VoNotExistsException, PrivilegeException, AttributeNotExistsException {\n+\t\tUtils.checkPerunSession(sess);\n+\t\tUtils.notNull(vo, \"vo\");\n+\n+\t\tperunBl.getVosManagerBl().checkVoExists(sess, vo);\n+\n+\t\t//Authorization\n+\t\tif(!AuthzResolver.authorizedInternal(sess, \"getSponsoredMembersAndTheirSponsors_Vo_policy\", vo)) {\n+\t\t\tthrow new PrivilegeException(sess, \"getSponsoredMembersAndTheirSponsors\");\n+\t\t}\n+\n+\t\tList<AttributeDefinition> attrsDef = new ArrayList<>();\n+\t\tfor (String attrName : attrNames) {\n+\t\t\tattrsDef.add(getPerunBl().getAttributesManagerBl().getAttributeDefinition(sess, attrName));\n+\t\t}\n+\n+\t\tList<RichMember> richMembers = membersManagerBl.convertMembersToRichMembersWithAttributes(sess, getSponsoredMembers(sess, vo), attrsDef);\n+\t\trichMembers = membersManagerBl.filterOnlyAllowedAttributes(sess, richMembers, null, true);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f246ac5039af0df65cee37bf3f9ea5de536d9012"}, "originalPosition": 48}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTA0NjY4NzYz", "url": "https://github.com/CESNET/perun/pull/2913#pullrequestreview-504668763", "createdAt": "2020-10-08T11:06:30Z", "commit": {"oid": "f246ac5039af0df65cee37bf3f9ea5de536d9012"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1074, "cost": 1, "resetAt": "2021-11-01T13:07:16Z"}}}