{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDkyNTI4MzE1", "number": 2911, "title": "check quota path syntax acccording to regex, not URI", "bodyText": "The changes concern all quota attributes and methods validating their content.\nThe original URI syntax checks allowed for transformations changing the path meaning,\nwhich is undesirable.", "createdAt": "2020-09-24T15:28:19Z", "url": "https://github.com/CESNET/perun/pull/2911", "merged": true, "mergeCommit": {"oid": "0875122390cb52d7a55115ae9c8ca7a15175fad6"}, "closed": true, "closedAt": "2020-10-01T09:13:46Z", "author": {"login": "mvocu"}, "timelineItems": {"totalCount": 7, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdLtlOBgH2gAyNDkyNTI4MzE1OmEwNTkxMTZlMmVmMWJhZDk4ZDdkYjExYWY3NWRkNjE2MmMyZTBmNTc=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdONrEZgFqTUwMDE1MDUyNw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "a059116e2ef1bad98d7db11af75dd6162c2e0f57", "author": {"user": {"login": "mvocu", "name": "Michal Voc\u016f"}}, "url": "https://github.com/CESNET/perun/commit/a059116e2ef1bad98d7db11af75dd6162c2e0f57", "committedDate": "2020-09-23T14:36:47Z", "message": "test quota syntax according to regex, not URI"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b5b759485a9cd7296f4ebc2992dcac309e8c042e", "author": {"user": {"login": "mvocu", "name": "Michal Voc\u016f"}}, "url": "https://github.com/CESNET/perun/commit/b5b759485a9cd7296f4ebc2992dcac309e8c042e", "committedDate": "2020-09-24T15:25:23Z", "message": "add unit test"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDk2MTQxODIw", "url": "https://github.com/CESNET/perun/pull/2911#pullrequestreview-496141820", "createdAt": "2020-09-25T06:29:23Z", "commit": {"oid": "b5b759485a9cd7296f4ebc2992dcac309e8c042e"}, "state": "APPROVED", "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yNVQwNjoyOTozOVrOHX2oAw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yNVQwNjozMTozOFrOHX2rCg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NDc3NDI3NQ==", "bodyText": "The regex could be maybe a constant?", "url": "https://github.com/CESNET/perun/pull/2911#discussion_r494774275", "createdAt": "2020-09-25T06:29:39Z", "author": {"login": "metodej"}, "path": "perun-core/src/main/java/cz/metacentrum/perun/core/blImpl/ModulesUtilsBlImpl.java", "diffHunk": "@@ -784,11 +785,10 @@ public void checkIfQuotasIsInLimit(Map<String, Pair<BigDecimal, BigDecimal>> quo\n \n \t\t\t//testing if path is unique\n \t\t\tString canonicalPath;\n-\t\t\ttry {\n-\t\t\t\tcanonicalPath = new URI(path).normalize().getPath();\n-\t\t\t\t//path should not end on '/' (problem with some systems as GPFS)\n-\t\t\t\tif(!canonicalPath.equals(\"/\") && canonicalPath.endsWith(\"/\")) canonicalPath = canonicalPath.substring(0, canonicalPath.length() - 1);\n-\t\t\t} catch (URISyntaxException ex) {\n+\t\t\tcanonicalPath = Paths.get(path).normalize().toString();\n+\t\t\t//path should not end on '/' (problem with some systems as GPFS)\n+\t\t\tif(!canonicalPath.equals(\"/\") && canonicalPath.endsWith(\"/\")) canonicalPath = canonicalPath.substring(0, canonicalPath.length() - 1);\n+\t\t\tif(!canonicalPath.matches(\"^[-a-zA-Z.0-9_/:=,]+$\")) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b5b759485a9cd7296f4ebc2992dcac309e8c042e"}, "originalPosition": 20}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NDc3NDUxOA==", "bodyText": "I think there is supposed to be name of the test in comment.", "url": "https://github.com/CESNET/perun/pull/2911#discussion_r494774518", "createdAt": "2020-09-25T06:30:11Z", "author": {"login": "metodej"}, "path": "perun-core/src/test/java/cz/metacentrum/perun/core/entry/ModulesUtilsEntryIntegrationTest.java", "diffHunk": "@@ -715,6 +715,15 @@ public void checkQuotasErrorInValue() throws Exception {\n \t\tmodulesUtilsBl.checkAndTransferQuotas(dataQuotasAttribute, resource, null, true);\n \t}\n \n+\t@Test(expected=WrongAttributeValueException.class)\n+\tpublic void checkQuotasErrorInPath() throws Exception {\n+\t\tSystem.out.println(CLASS_NAME + \"WrongAttributeValueException\");", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b5b759485a9cd7296f4ebc2992dcac309e8c042e"}, "originalPosition": 6}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NDc3NTA1MA==", "bodyText": "I think the declaration and the assignment of the variable could be on one line.", "url": "https://github.com/CESNET/perun/pull/2911#discussion_r494775050", "createdAt": "2020-09-25T06:31:38Z", "author": {"login": "metodej"}, "path": "perun-core/src/main/java/cz/metacentrum/perun/core/blImpl/ModulesUtilsBlImpl.java", "diffHunk": "@@ -784,11 +785,10 @@ public void checkIfQuotasIsInLimit(Map<String, Pair<BigDecimal, BigDecimal>> quo\n \n \t\t\t//testing if path is unique\n \t\t\tString canonicalPath;\n-\t\t\ttry {\n-\t\t\t\tcanonicalPath = new URI(path).normalize().getPath();\n-\t\t\t\t//path should not end on '/' (problem with some systems as GPFS)\n-\t\t\t\tif(!canonicalPath.equals(\"/\") && canonicalPath.endsWith(\"/\")) canonicalPath = canonicalPath.substring(0, canonicalPath.length() - 1);\n-\t\t\t} catch (URISyntaxException ex) {\n+\t\t\tcanonicalPath = Paths.get(path).normalize().toString();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b5b759485a9cd7296f4ebc2992dcac309e8c042e"}, "originalPosition": 17}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDk2MTUxODUw", "url": "https://github.com/CESNET/perun/pull/2911#pullrequestreview-496151850", "createdAt": "2020-09-25T06:50:07Z", "commit": {"oid": "b5b759485a9cd7296f4ebc2992dcac309e8c042e"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yNVQwNjo1MDowOFrOHX3IEA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yNVQwNjo1MDowOFrOHX3IEA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NDc4MjQ4MA==", "bodyText": "Also I think that the normalize() function changes slashes in windows and then the regex does not match there. But I don't know if we care about users with windows...", "url": "https://github.com/CESNET/perun/pull/2911#discussion_r494782480", "createdAt": "2020-09-25T06:50:08Z", "author": {"login": "metodej"}, "path": "perun-core/src/main/java/cz/metacentrum/perun/core/blImpl/ModulesUtilsBlImpl.java", "diffHunk": "@@ -784,11 +785,10 @@ public void checkIfQuotasIsInLimit(Map<String, Pair<BigDecimal, BigDecimal>> quo\n \n \t\t\t//testing if path is unique\n \t\t\tString canonicalPath;\n-\t\t\ttry {\n-\t\t\t\tcanonicalPath = new URI(path).normalize().getPath();\n-\t\t\t\t//path should not end on '/' (problem with some systems as GPFS)\n-\t\t\t\tif(!canonicalPath.equals(\"/\") && canonicalPath.endsWith(\"/\")) canonicalPath = canonicalPath.substring(0, canonicalPath.length() - 1);\n-\t\t\t} catch (URISyntaxException ex) {\n+\t\t\tcanonicalPath = Paths.get(path).normalize().toString();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b5b759485a9cd7296f4ebc2992dcac309e8c042e"}, "originalPosition": 17}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDk3MDUzMDg2", "url": "https://github.com/CESNET/perun/pull/2911#pullrequestreview-497053086", "createdAt": "2020-09-27T05:39:02Z", "commit": {"oid": "b5b759485a9cd7296f4ebc2992dcac309e8c042e"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "0d2a539d2d6bc488bd33305e93e1160eb438037e", "author": {"user": {"login": "mvocu", "name": "Michal Voc\u016f"}}, "url": "https://github.com/CESNET/perun/commit/0d2a539d2d6bc488bd33305e93e1160eb438037e", "committedDate": "2020-10-01T09:03:52Z", "message": "Fixes according to review. The changes concern all quota attributes and methods validating their content; the original URI syntax checks allowed for transformations changing the path meaning, which is undesirable."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTAwMTUwNTI3", "url": "https://github.com/CESNET/perun/pull/2911#pullrequestreview-500150527", "createdAt": "2020-10-01T09:07:59Z", "commit": {"oid": "0d2a539d2d6bc488bd33305e93e1160eb438037e"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1069, "cost": 1, "resetAt": "2021-11-01T13:07:16Z"}}}