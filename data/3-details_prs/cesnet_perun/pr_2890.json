{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDgyNzQ3NjQz", "number": 2890, "title": "Core - UUID", "bodyText": "DEPLOYMENT:\n\nNew DB version\nNeed to enable postgres plugin with command CREATE EXTENSION IF NOT EXISTS \"pgcrypto\";\n\n\nAdded UUID to Group, User, and Resource entities.\nThe UUID is of version 4 and is generated by the DB.\nI have also performed manual testing that the Postgres DB can work with the UUIDs.", "createdAt": "2020-09-09T10:38:44Z", "url": "https://github.com/CESNET/perun/pull/2890", "merged": true, "mergeCommit": {"oid": "354a55207146a824ce88d22d3002edf502e3941f"}, "closed": true, "closedAt": "2020-09-18T07:42:05Z", "author": {"login": "Vojtech-Sassmann"}, "timelineItems": {"totalCount": 16, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdJC_bvgFqTQ4ODQwOTUxNQ==", "endCursor": "Y3Vyc29yOnYyOpPPAAABdKAbTZAFqTQ5MTIxMzY0MQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDg4NDA5NTE1", "url": "https://github.com/CESNET/perun/pull/2890#pullrequestreview-488409515", "createdAt": "2020-09-15T07:42:06Z", "commit": {"oid": "bd56017aeaa80c78681700f9fec351c753da34be"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xNVQwNzo0MjowN1rOHR05vA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xNVQwNzo0MjowN1rOHR05vA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4ODQ1NDU4OA==", "bodyText": "Version doesn't matches.", "url": "https://github.com/CESNET/perun/pull/2890#discussion_r488454588", "createdAt": "2020-09-15T07:42:07Z", "author": {"login": "zlamalp"}, "path": "perun-core/src/main/resources/hsqldbChangelog.txt", "diffHunk": "@@ -3,6 +3,9 @@\n \n -- this update is not supported on hsql since its used only as in-memory db\n \n+3.1.66\n+update configurations set value='3.1.65' where property='DATABASE VERSION';", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "bd56017aeaa80c78681700f9fec351c753da34be"}, "originalPosition": 5}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDg4NDIyMzgz", "url": "https://github.com/CESNET/perun/pull/2890#pullrequestreview-488422383", "createdAt": "2020-09-15T07:58:47Z", "commit": {"oid": "bd56017aeaa80c78681700f9fec351c753da34be"}, "state": "COMMENTED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "bd56017aeaa80c78681700f9fec351c753da34be", "author": {"user": {"login": "Vojtech-Sassmann", "name": "Vojt\u011bch Sassmann"}}, "url": "https://github.com/CESNET/perun/commit/bd56017aeaa80c78681700f9fec351c753da34be", "committedDate": "2020-09-09T10:28:40Z", "message": "Core - UUID\n\n* DEPLOYMENT:\n  * New DB version\n  * Need to enable postgres plugin with command `CREATE EXTENSION IF NOT\nEXISTS \"pgcrypto\";`\n* Added UUID to Group, User and Resource entities.\n* The UUID is of version 4 and is generated by the DB."}, "afterCommit": {"oid": "ff871ed9473020b2e5199b0d04ebf029e44629c0", "author": {"user": {"login": "Vojtech-Sassmann", "name": "Vojt\u011bch Sassmann"}}, "url": "https://github.com/CESNET/perun/commit/ff871ed9473020b2e5199b0d04ebf029e44629c0", "committedDate": "2020-09-15T08:19:02Z", "message": "Core - UUID\n\n* DEPLOYMENT:\n  * New DB version\n  * Need to enable postgres plugin with command `CREATE EXTENSION IF NOT\nEXISTS \"pgcrypto\";`\n* Added UUID to Group, User and Resource entities.\n* The UUID is of version 4 and is generated by the DB."}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "ff871ed9473020b2e5199b0d04ebf029e44629c0", "author": {"user": {"login": "Vojtech-Sassmann", "name": "Vojt\u011bch Sassmann"}}, "url": "https://github.com/CESNET/perun/commit/ff871ed9473020b2e5199b0d04ebf029e44629c0", "committedDate": "2020-09-15T08:19:02Z", "message": "Core - UUID\n\n* DEPLOYMENT:\n  * New DB version\n  * Need to enable postgres plugin with command `CREATE EXTENSION IF NOT\nEXISTS \"pgcrypto\";`\n* Added UUID to Group, User and Resource entities.\n* The UUID is of version 4 and is generated by the DB."}, "afterCommit": {"oid": "80aa5b2d6b614b8bcdc46b2b630fc4efd0ee5397", "author": {"user": {"login": "Vojtech-Sassmann", "name": "Vojt\u011bch Sassmann"}}, "url": "https://github.com/CESNET/perun/commit/80aa5b2d6b614b8bcdc46b2b630fc4efd0ee5397", "committedDate": "2020-09-15T08:33:05Z", "message": "Core - UUID\n\n* DEPLOYMENT:\n  * New DB version\n  * Need to enable postgres plugin with command `CREATE EXTENSION IF NOT\nEXISTS \"pgcrypto\";`\n* Added UUID to Group, User and Resource entities.\n* The UUID is of version 4 and is generated by the DB."}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "80aa5b2d6b614b8bcdc46b2b630fc4efd0ee5397", "author": {"user": {"login": "Vojtech-Sassmann", "name": "Vojt\u011bch Sassmann"}}, "url": "https://github.com/CESNET/perun/commit/80aa5b2d6b614b8bcdc46b2b630fc4efd0ee5397", "committedDate": "2020-09-15T08:33:05Z", "message": "Core - UUID\n\n* DEPLOYMENT:\n  * New DB version\n  * Need to enable postgres plugin with command `CREATE EXTENSION IF NOT\nEXISTS \"pgcrypto\";`\n* Added UUID to Group, User and Resource entities.\n* The UUID is of version 4 and is generated by the DB."}, "afterCommit": {"oid": "ccf2b683a064f8d3843dee606c50a55cdc72da40", "author": {"user": {"login": "Vojtech-Sassmann", "name": "Vojt\u011bch Sassmann"}}, "url": "https://github.com/CESNET/perun/commit/ccf2b683a064f8d3843dee606c50a55cdc72da40", "committedDate": "2020-09-15T09:04:00Z", "message": "Core - UUID\n\n* DEPLOYMENT:\n  * New DB version\n  * Need to enable postgres plugin with command `CREATE EXTENSION IF NOT\nEXISTS \"pgcrypto\";`\n* Added UUID to Group, User and Resource entities.\n* The UUID is of version 4 and is generated by the DB."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDg5NDcwMDIy", "url": "https://github.com/CESNET/perun/pull/2890#pullrequestreview-489470022", "createdAt": "2020-09-16T10:03:29Z", "commit": {"oid": "ccf2b683a064f8d3843dee606c50a55cdc72da40"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xNlQxMDowMzozMFrOHSpqHg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xNlQxMDowNToxMVrOHSpt4g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4OTMxODk0Mg==", "bodyText": "I don't really think this is necessary.  You get the whole new group correctly set with all expected attributes.", "url": "https://github.com/CESNET/perun/pull/2890#discussion_r489318942", "createdAt": "2020-09-16T10:03:30Z", "author": {"login": "stavamichal"}, "path": "perun-core/src/main/java/cz/metacentrum/perun/core/impl/GroupsManagerImpl.java", "diffHunk": "@@ -129,21 +131,28 @@ public Group createGroup(PerunSession sess, Vo vo, Group group) throws GroupExis\n \t\t\tthrow new InternalErrorException(e);\n \t\t}\n \n+\t\tint newId;\n \t\ttry {\n \t\t\t// Store the group into the DB\n-\t\t\tint newId = Utils.getNewId(jdbc, \"groups_id_seq\");\n+\t\t\tnewId = Utils.getNewId(jdbc, \"groups_id_seq\");\n \n \t\t\tjdbc.update(\"insert into groups (id, parent_group_id, name, dsc, vo_id, created_by,created_at,modified_by,modified_at,created_by_uid,modified_by_uid) \" +\n \t\t\t\t\t\"values (?,?,?,?,?,?,\" + Compatibility.getSysdate() + \",?,\" + Compatibility.getSysdate() + \",?,?)\", newId, group.getParentGroupId(),\n \t\t\t\t\tgroup.getName(), group.getDescription(), vo.getId(), sess.getPerunPrincipal().getActor(), sess.getPerunPrincipal().getActor(), sess.getPerunPrincipal().getUserId(), sess.getPerunPrincipal().getUserId());\n-\t\t\tgroup.setId(newId);\n-\n-\t\t\tgroup.setVoId(vo.getId());\n-\n-\t\t\treturn group;\n \t\t} catch (RuntimeException err) {\n \t\t\tthrow new InternalErrorException(err);\n \t\t}\n+\t\tGroup newGroup;\n+\t\ttry {\n+\t\t\tnewGroup = getGroupById(sess, newId);\n+\t\t} catch (GroupNotExistsException e) {\n+\t\t\tthrow new InternalErrorException(\"Failed to read newly created group with id: \" + newId, e);\n+\t\t}\n+\t\tgroup.setId(newId);\n+\t\tgroup.setUuid(newGroup.getUuid());\n+\t\tgroup.setVoId(newGroup.getVoId());", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ccf2b683a064f8d3843dee606c50a55cdc72da40"}, "originalPosition": 54}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4OTMxOTU4MA==", "bodyText": "Same as for Group.", "url": "https://github.com/CESNET/perun/pull/2890#discussion_r489319580", "createdAt": "2020-09-16T10:04:37Z", "author": {"login": "stavamichal"}, "path": "perun-core/src/main/java/cz/metacentrum/perun/core/impl/ResourcesManagerImpl.java", "diffHunk": "@@ -222,22 +224,28 @@ public Resource getResourceByName(PerunSession sess, Vo vo, Facility facility, S\n \tpublic Resource createResource(PerunSession sess, Vo vo, Resource resource, Facility facility) {\n \t\tUtils.notNull(resource.getName(), \"resource.getName()\");\n \n+\t\tint newId;\n \t\ttry {\n-\t\t\tint newId = Utils.getNewId(jdbc, \"resources_id_seq\");\n+\t\t\tnewId = Utils.getNewId(jdbc, \"resources_id_seq\");\n \n \t\t\tjdbc.update(\"insert into resources(id, name, dsc, facility_id, vo_id, created_by, created_at,modified_by,modified_at,created_by_uid,modified_by_uid) \" +\n \t\t\t\t\t\"values (?,?,?,?,?,?,\" + Compatibility.getSysdate() + \",?,\" + Compatibility.getSysdate() + \",?,?)\",\n \t\t\t\t\tnewId, resource.getName(), resource.getDescription(), facility.getId(), vo.getId(), sess.getPerunPrincipal().getActor(),\n \t\t\t\t\tsess.getPerunPrincipal().getActor(), sess.getPerunPrincipal().getUserId(), sess.getPerunPrincipal().getUserId());\n-\n-\t\t\tresource.setId(newId);\n-\t\t\tresource.setFacilityId(facility.getId());\n-\t\t\tresource.setVoId(vo.getId());\n-\n-\t\t\treturn resource;\n \t\t} catch(RuntimeException ex) {\n \t\t\tthrow new InternalErrorException(ex);\n \t\t}\n+\t\tResource newResource;\n+\t\ttry {\n+\t\t\tnewResource = getResourceById(sess, newId);\n+\t\t} catch (ResourceNotExistsException e) {\n+\t\t\tthrow new InternalErrorException(\"Failed to read newly created resource with id: \" + newId, e);\n+\t\t}\n+\t\tresource.setId(newId);\n+\t\tresource.setVoId(newResource.getVoId());\n+\t\tresource.setFacilityId(newResource.getFacilityId());\n+\t\tresource.setUuid(newResource.getUuid());", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ccf2b683a064f8d3843dee606c50a55cdc72da40"}, "originalPosition": 56}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4OTMxOTkwNg==", "bodyText": "Same as for Group.", "url": "https://github.com/CESNET/perun/pull/2890#discussion_r489319906", "createdAt": "2020-09-16T10:05:11Z", "author": {"login": "stavamichal"}, "path": "perun-core/src/main/java/cz/metacentrum/perun/core/impl/UsersManagerImpl.java", "diffHunk": "@@ -367,18 +368,25 @@ public void deleteUser(PerunSession sess, User user) throws UserAlreadyRemovedEx\n \n \t@Override\n \tpublic User createUser(PerunSession sess, User user) {\n+\t\tint newId;\n \t\ttry {\n-\t\t\tint newId = Utils.getNewId(jdbc, \"users_id_seq\");\n+\t\t\tnewId = Utils.getNewId(jdbc, \"users_id_seq\");\n \t\t\tjdbc.update(\"insert into users(id,first_name,last_name,middle_name,title_before,title_after,created_by,modified_by,service_acc,sponsored_acc,created_by_uid,modified_by_uid)\" +\n \t\t\t\t\t\" values (?,?,?,?,?,?,?,?,?,?,?,?)\", newId, user.getFirstName(), user.getLastName(), user.getMiddleName(),\n \t\t\t\t\tuser.getTitleBefore(), user.getTitleAfter(), sess.getPerunPrincipal().getActor(), sess.getPerunPrincipal().getActor(), user.isServiceUser(), user.isSponsoredUser(),\n \t\t\t\t\tsess.getPerunPrincipal().getUserId(), sess.getPerunPrincipal().getUserId());\n-\t\t\tuser.setId(newId);\n-\n-\t\t\treturn user;\n \t\t} catch (RuntimeException err) {\n \t\t\tthrow new InternalErrorException(err);\n \t\t}\n+\t\tUser newUser;\n+\t\ttry {\n+\t\t\tnewUser = getUserById(sess, newId);\n+\t\t} catch (UserNotExistsException e) {\n+\t\t\tthrow new InternalErrorException(\"Failed to read newly created user with id: \" + newId, e);\n+\t\t}\n+\t\tuser.setId(newId);\n+\t\tuser.setUuid(newUser.getUuid());\n+\t\treturn newUser;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ccf2b683a064f8d3843dee606c50a55cdc72da40"}, "originalPosition": 52}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "ccf2b683a064f8d3843dee606c50a55cdc72da40", "author": {"user": {"login": "Vojtech-Sassmann", "name": "Vojt\u011bch Sassmann"}}, "url": "https://github.com/CESNET/perun/commit/ccf2b683a064f8d3843dee606c50a55cdc72da40", "committedDate": "2020-09-15T09:04:00Z", "message": "Core - UUID\n\n* DEPLOYMENT:\n  * New DB version\n  * Need to enable postgres plugin with command `CREATE EXTENSION IF NOT\nEXISTS \"pgcrypto\";`\n* Added UUID to Group, User and Resource entities.\n* The UUID is of version 4 and is generated by the DB."}, "afterCommit": {"oid": "6c5df17c5a5f5b49f54a7550dc2385f95ad09911", "author": {"user": {"login": "Vojtech-Sassmann", "name": "Vojt\u011bch Sassmann"}}, "url": "https://github.com/CESNET/perun/commit/6c5df17c5a5f5b49f54a7550dc2385f95ad09911", "committedDate": "2020-09-16T10:48:34Z", "message": "Core - UUID\n\n* DEPLOYMENT:\n  * New DB version\n  * Need to enable postgres plugin with command `CREATE EXTENSION IF NOT\nEXISTS \"pgcrypto\";`\n* Added UUID to Group, User and Resource entities.\n* The UUID is of version 4 and is generated by the DB."}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "6c5df17c5a5f5b49f54a7550dc2385f95ad09911", "author": {"user": {"login": "Vojtech-Sassmann", "name": "Vojt\u011bch Sassmann"}}, "url": "https://github.com/CESNET/perun/commit/6c5df17c5a5f5b49f54a7550dc2385f95ad09911", "committedDate": "2020-09-16T10:48:34Z", "message": "Core - UUID\n\n* DEPLOYMENT:\n  * New DB version\n  * Need to enable postgres plugin with command `CREATE EXTENSION IF NOT\nEXISTS \"pgcrypto\";`\n* Added UUID to Group, User and Resource entities.\n* The UUID is of version 4 and is generated by the DB."}, "afterCommit": {"oid": "6e673d200a0868f0e2aa59e3aa81c96379745789", "author": {"user": {"login": "Vojtech-Sassmann", "name": "Vojt\u011bch Sassmann"}}, "url": "https://github.com/CESNET/perun/commit/6e673d200a0868f0e2aa59e3aa81c96379745789", "committedDate": "2020-09-16T10:58:49Z", "message": "Core - UUID\n\n* DEPLOYMENT:\n  * New DB version\n  * Need to enable postgres plugin with command `CREATE EXTENSION IF NOT\nEXISTS \"pgcrypto\";`\n* Added UUID to Group, User and Resource entities.\n* The UUID is of version 4 and is generated by the DB."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDg5NTY5Njcy", "url": "https://github.com/CESNET/perun/pull/2890#pullrequestreview-489569672", "createdAt": "2020-09-16T12:25:59Z", "commit": {"oid": "6e673d200a0868f0e2aa59e3aa81c96379745789"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xNlQxMjoyNTo1OVrOHSuWFA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xNlQxMjoyODo0NFrOHSucnA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4OTM5NTczMg==", "bodyText": "There is missing the change for RichGroup.", "url": "https://github.com/CESNET/perun/pull/2890#discussion_r489395732", "createdAt": "2020-09-16T12:25:59Z", "author": {"login": "stavamichal"}, "path": "perun-auditparser/src/main/java/cz/metacentrum/perun/auditparser/AuditParser.java", "diffHunk": "@@ -716,6 +729,10 @@ private static RichResource createRichResource(Map<String, String> beanAttr) {\n \t\tif(beanAttr==null) return null;\n \t\tRichResource richResource = new RichResource();\n \t\trichResource.setId(Integer.valueOf(beanAttr.get(\"id\")));\n+\t\tString uuidString = beanAttr.get(\"uuid\");\n+\t\tif (uuidString != null && !\"null\".equals(uuidString)) {\n+\t\t\trichResource.setUuid(UUID.fromString(uuidString));\n+\t\t}", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "6e673d200a0868f0e2aa59e3aa81c96379745789"}, "originalPosition": 48}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4OTM5NzQwNA==", "bodyText": "Setting of UUID is missing in constructor.", "url": "https://github.com/CESNET/perun/pull/2890#discussion_r489397404", "createdAt": "2020-09-16T12:28:44Z", "author": {"login": "stavamichal"}, "path": "perun-base/src/main/java/cz/metacentrum/perun/core/api/RichResource.java", "diffHunk": "@@ -130,6 +131,7 @@ public String toString() {\n \n \t\treturn str.append(getClass().getSimpleName()).append(\":[\"\n \t\t\t).append(\"id='\").append(getId()\n+\t\t\t).append(\"', uuid='\").append(getUuid()", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "6e673d200a0868f0e2aa59e3aa81c96379745789"}, "originalPosition": 12}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "6e673d200a0868f0e2aa59e3aa81c96379745789", "author": {"user": {"login": "Vojtech-Sassmann", "name": "Vojt\u011bch Sassmann"}}, "url": "https://github.com/CESNET/perun/commit/6e673d200a0868f0e2aa59e3aa81c96379745789", "committedDate": "2020-09-16T10:58:49Z", "message": "Core - UUID\n\n* DEPLOYMENT:\n  * New DB version\n  * Need to enable postgres plugin with command `CREATE EXTENSION IF NOT\nEXISTS \"pgcrypto\";`\n* Added UUID to Group, User and Resource entities.\n* The UUID is of version 4 and is generated by the DB."}, "afterCommit": {"oid": "e7cd94d1a5b85c49c9393f0fd1adc23fe5dde8ba", "author": {"user": {"login": "Vojtech-Sassmann", "name": "Vojt\u011bch Sassmann"}}, "url": "https://github.com/CESNET/perun/commit/e7cd94d1a5b85c49c9393f0fd1adc23fe5dde8ba", "committedDate": "2020-09-16T12:34:06Z", "message": "Core - UUID\n\n* DEPLOYMENT:\n  * New DB version\n  * Need to enable postgres plugin with command `CREATE EXTENSION IF NOT\nEXISTS \"pgcrypto\";`\n* Added UUID to Group, User and Resource entities.\n* The UUID is of version 4 and is generated by the DB."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDg5NTg4NDY4", "url": "https://github.com/CESNET/perun/pull/2890#pullrequestreview-489588468", "createdAt": "2020-09-16T12:49:12Z", "commit": {"oid": "e7cd94d1a5b85c49c9393f0fd1adc23fe5dde8ba"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDkwNDg3MTI3", "url": "https://github.com/CESNET/perun/pull/2890#pullrequestreview-490487127", "createdAt": "2020-09-17T11:16:20Z", "commit": {"oid": "e7cd94d1a5b85c49c9393f0fd1adc23fe5dde8ba"}, "state": "APPROVED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xN1QxMToxNjoyMVrOHTdJrA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xN1QxMToxNjoyMVrOHTdJrA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MDE2MjYwNA==", "bodyText": "Regarding this, don't we want to then return group object instead of the newGroup ?\nAnd just a note, it would be so nice to use Postgres INSERT .... RETURNING query, but its not supported by HSQLDB which we use for the tests.", "url": "https://github.com/CESNET/perun/pull/2890#discussion_r490162604", "createdAt": "2020-09-17T11:16:21Z", "author": {"login": "zlamalp"}, "path": "perun-core/src/main/java/cz/metacentrum/perun/core/impl/GroupsManagerImpl.java", "diffHunk": "@@ -129,21 +131,28 @@ public Group createGroup(PerunSession sess, Vo vo, Group group) throws GroupExis\n \t\t\tthrow new InternalErrorException(e);\n \t\t}\n \n+\t\tint newId;\n \t\ttry {\n \t\t\t// Store the group into the DB\n-\t\t\tint newId = Utils.getNewId(jdbc, \"groups_id_seq\");\n+\t\t\tnewId = Utils.getNewId(jdbc, \"groups_id_seq\");\n \n \t\t\tjdbc.update(\"insert into groups (id, parent_group_id, name, dsc, vo_id, created_by,created_at,modified_by,modified_at,created_by_uid,modified_by_uid) \" +\n \t\t\t\t\t\"values (?,?,?,?,?,?,\" + Compatibility.getSysdate() + \",?,\" + Compatibility.getSysdate() + \",?,?)\", newId, group.getParentGroupId(),\n \t\t\t\t\tgroup.getName(), group.getDescription(), vo.getId(), sess.getPerunPrincipal().getActor(), sess.getPerunPrincipal().getActor(), sess.getPerunPrincipal().getUserId(), sess.getPerunPrincipal().getUserId());\n-\t\t\tgroup.setId(newId);\n-\n-\t\t\tgroup.setVoId(vo.getId());\n-\n-\t\t\treturn group;\n \t\t} catch (RuntimeException err) {\n \t\t\tthrow new InternalErrorException(err);\n \t\t}\n+\t\tGroup newGroup;\n+\t\ttry {\n+\t\t\tnewGroup = getGroupById(sess, newId);\n+\t\t} catch (GroupNotExistsException e) {\n+\t\t\tthrow new InternalErrorException(\"Failed to read newly created group with id: \" + newId, e);\n+\t\t}\n+\t\tgroup.setId(newId);\n+\t\tgroup.setUuid(newGroup.getUuid());\n+\t\tgroup.setVoId(newGroup.getVoId());", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4OTMxODk0Mg=="}, "originalCommit": {"oid": "ccf2b683a064f8d3843dee606c50a55cdc72da40"}, "originalPosition": 54}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDkwNDkzMzcw", "url": "https://github.com/CESNET/perun/pull/2890#pullrequestreview-490493370", "createdAt": "2020-09-17T11:25:18Z", "commit": {"oid": "e7cd94d1a5b85c49c9393f0fd1adc23fe5dde8ba"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e72964e00960c69416b39db33c675d6f1e439a8a", "author": {"user": {"login": "Vojtech-Sassmann", "name": "Vojt\u011bch Sassmann"}}, "url": "https://github.com/CESNET/perun/commit/e72964e00960c69416b39db33c675d6f1e439a8a", "committedDate": "2020-09-18T07:19:28Z", "message": "Core - UUID\n\n* DEPLOYMENT:\n  * New DB version\n  * Need to enable postgres plugin with command `CREATE EXTENSION IF NOT\nEXISTS \"pgcrypto\";`\n* Added UUID to Group, User and Resource entities.\n* The UUID is of version 4 and is generated by the DB."}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "e7cd94d1a5b85c49c9393f0fd1adc23fe5dde8ba", "author": {"user": {"login": "Vojtech-Sassmann", "name": "Vojt\u011bch Sassmann"}}, "url": "https://github.com/CESNET/perun/commit/e7cd94d1a5b85c49c9393f0fd1adc23fe5dde8ba", "committedDate": "2020-09-16T12:34:06Z", "message": "Core - UUID\n\n* DEPLOYMENT:\n  * New DB version\n  * Need to enable postgres plugin with command `CREATE EXTENSION IF NOT\nEXISTS \"pgcrypto\";`\n* Added UUID to Group, User and Resource entities.\n* The UUID is of version 4 and is generated by the DB."}, "afterCommit": {"oid": "e72964e00960c69416b39db33c675d6f1e439a8a", "author": {"user": {"login": "Vojtech-Sassmann", "name": "Vojt\u011bch Sassmann"}}, "url": "https://github.com/CESNET/perun/commit/e72964e00960c69416b39db33c675d6f1e439a8a", "committedDate": "2020-09-18T07:19:28Z", "message": "Core - UUID\n\n* DEPLOYMENT:\n  * New DB version\n  * Need to enable postgres plugin with command `CREATE EXTENSION IF NOT\nEXISTS \"pgcrypto\";`\n* Added UUID to Group, User and Resource entities.\n* The UUID is of version 4 and is generated by the DB."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDkxMjEzNjQx", "url": "https://github.com/CESNET/perun/pull/2890#pullrequestreview-491213641", "createdAt": "2020-09-18T07:26:18Z", "commit": {"oid": "e72964e00960c69416b39db33c675d6f1e439a8a"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1034, "cost": 1, "resetAt": "2021-11-01T13:07:16Z"}}}