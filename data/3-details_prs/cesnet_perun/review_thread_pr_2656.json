{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0Mzk4MjY5NTYx", "number": 2656, "reviewThreads": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wN1QwNzowMTowOFrODvbHHw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wOFQwNzo0MzoyMFrODv3xPw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjUxMDUzODU1OnYy", "diffSide": "RIGHT", "path": "perun-core/src/main/java/cz/metacentrum/perun/core/blImpl/GroupsManagerBlImpl.java", "isResolved": true, "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wN1QwNzowMTowOFrOGB1ihA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wN1QxMDo1Njo0NFrOGB-GtQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNDU3ODk0OA==", "bodyText": "I just wonder, if setting group membership expiration to null and calling extendMembershipInGroup() wouldn't do the same job, so we could prevent code duplicity?", "url": "https://github.com/CESNET/perun/pull/2656#discussion_r404578948", "createdAt": "2020-04-07T07:01:08Z", "author": {"login": "zlamalp"}, "path": "perun-core/src/main/java/cz/metacentrum/perun/core/blImpl/GroupsManagerBlImpl.java", "diffHunk": "@@ -4948,4 +4948,61 @@ private boolean isMemberInGracePeriod(Map<String, String> membershipExpirationRu\n \tpublic List<Facility> getFacilitiesWhereGroupIsAdmin(PerunSession perunSession, Group group) throws InternalErrorException {\n \t\treturn this.getGroupsManagerImpl().getFacilitiesWhereGroupIsAdmin(perunSession, group);\n \t}\n+\n+\t@Override\n+\tpublic void reactivateMember(PerunSession sess, Member member, Group group) throws InternalErrorException, MemberNotExistsException {\n+\t\tif (!isGroupMember(sess, group, member)) throw new MemberNotExistsException(\"Member does not belong to this group\");\n+\n+\t\tvalidateMemberInGroup(sess, member, group);\n+\n+\t\tAttribute membershipExpirationRulesAttribute = getMembershipExpirationRulesAttribute(sess, group);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "4833eb997f8c91e8305691aa449972f7514f9497"}, "originalPosition": 11}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNDYwODk5Ng==", "bodyText": "We should definitely prevent code duplicity if possible.", "url": "https://github.com/CESNET/perun/pull/2656#discussion_r404608996", "createdAt": "2020-04-07T07:54:44Z", "author": {"login": "stavamichal"}, "path": "perun-core/src/main/java/cz/metacentrum/perun/core/blImpl/GroupsManagerBlImpl.java", "diffHunk": "@@ -4948,4 +4948,61 @@ private boolean isMemberInGracePeriod(Map<String, String> membershipExpirationRu\n \tpublic List<Facility> getFacilitiesWhereGroupIsAdmin(PerunSession perunSession, Group group) throws InternalErrorException {\n \t\treturn this.getGroupsManagerImpl().getFacilitiesWhereGroupIsAdmin(perunSession, group);\n \t}\n+\n+\t@Override\n+\tpublic void reactivateMember(PerunSession sess, Member member, Group group) throws InternalErrorException, MemberNotExistsException {\n+\t\tif (!isGroupMember(sess, group, member)) throw new MemberNotExistsException(\"Member does not belong to this group\");\n+\n+\t\tvalidateMemberInGroup(sess, member, group);\n+\n+\t\tAttribute membershipExpirationRulesAttribute = getMembershipExpirationRulesAttribute(sess, group);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNDU3ODk0OA=="}, "originalCommit": {"oid": "4833eb997f8c91e8305691aa449972f7514f9497"}, "originalPosition": 11}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNDcxOTI4NQ==", "bodyText": "Yes, it would, thank you, it should be fixed now.", "url": "https://github.com/CESNET/perun/pull/2656#discussion_r404719285", "createdAt": "2020-04-07T10:56:44Z", "author": {"login": "metodej"}, "path": "perun-core/src/main/java/cz/metacentrum/perun/core/blImpl/GroupsManagerBlImpl.java", "diffHunk": "@@ -4948,4 +4948,61 @@ private boolean isMemberInGracePeriod(Map<String, String> membershipExpirationRu\n \tpublic List<Facility> getFacilitiesWhereGroupIsAdmin(PerunSession perunSession, Group group) throws InternalErrorException {\n \t\treturn this.getGroupsManagerImpl().getFacilitiesWhereGroupIsAdmin(perunSession, group);\n \t}\n+\n+\t@Override\n+\tpublic void reactivateMember(PerunSession sess, Member member, Group group) throws InternalErrorException, MemberNotExistsException {\n+\t\tif (!isGroupMember(sess, group, member)) throw new MemberNotExistsException(\"Member does not belong to this group\");\n+\n+\t\tvalidateMemberInGroup(sess, member, group);\n+\n+\t\tAttribute membershipExpirationRulesAttribute = getMembershipExpirationRulesAttribute(sess, group);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNDU3ODk0OA=="}, "originalCommit": {"oid": "4833eb997f8c91e8305691aa449972f7514f9497"}, "originalPosition": 11}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjUxNTIzMzkxOnYy", "diffSide": "RIGHT", "path": "perun-core/src/main/java/cz/metacentrum/perun/core/blImpl/GroupsManagerBlImpl.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wOFQwNzo0MzoyMFrOGCi1vQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wOFQwOTo1OTo1NFrOGCoBOQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNTMyMTE0OQ==", "bodyText": "If exception shouldn't be thrown (you are not expecting it), you should throw an InternalErrorException otherwise.", "url": "https://github.com/CESNET/perun/pull/2656#discussion_r405321149", "createdAt": "2020-04-08T07:43:20Z", "author": {"login": "stavamichal"}, "path": "perun-core/src/main/java/cz/metacentrum/perun/core/blImpl/GroupsManagerBlImpl.java", "diffHunk": "@@ -4948,4 +4948,30 @@ private boolean isMemberInGracePeriod(Map<String, String> membershipExpirationRu\n \tpublic List<Facility> getFacilitiesWhereGroupIsAdmin(PerunSession perunSession, Group group) throws InternalErrorException {\n \t\treturn this.getGroupsManagerImpl().getFacilitiesWhereGroupIsAdmin(perunSession, group);\n \t}\n+\n+\t@Override\n+\tpublic void reactivateMember(PerunSession sess, Member member, Group group) throws InternalErrorException, MemberNotExistsException {\n+\t\tif (!isGroupMember(sess, group, member)) throw new MemberNotExistsException(\"Member does not belong to this group\");\n+\n+\t\tvalidateMemberInGroup(sess, member, group);\n+\n+\t\t// Get current membershipExpiration date attribute\n+\t\tAttribute membershipExpirationAttribute = getMemberExpiration(sess, member, group);\n+\t\t// Set new value of the membershipExpiration for the member\n+\t\tmembershipExpirationAttribute.setValue(null);\n+\n+\t\ttry {\n+\t\t\tgetPerunBl().getAttributesManagerBl().setAttribute(sess, member, group, membershipExpirationAttribute);\n+\t\t} catch (WrongAttributeValueException e) {\n+\t\t\tthrow new InternalErrorException(\"Wrong value: \" + membershipExpirationAttribute.getValue(),e);\n+\t\t} catch (WrongReferenceAttributeValueException | WrongAttributeAssignmentException e) {\n+\t\t\tthrow new InternalErrorException(e);\n+\t\t}\n+\n+\t\ttry {\n+\t\t\textendMembershipInGroup(sess, member, group);\n+\t\t} catch (ExtendMembershipException ex) {\n+\t\t\t// This exception should not be thrown for null membershipExpiration attribute", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "cb81de7258aebd1ae5e87f038a513c27fcb1697d"}, "originalPosition": 27}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNTQwNjAwOQ==", "bodyText": "Okay, it should be fixed now.", "url": "https://github.com/CESNET/perun/pull/2656#discussion_r405406009", "createdAt": "2020-04-08T09:59:54Z", "author": {"login": "metodej"}, "path": "perun-core/src/main/java/cz/metacentrum/perun/core/blImpl/GroupsManagerBlImpl.java", "diffHunk": "@@ -4948,4 +4948,30 @@ private boolean isMemberInGracePeriod(Map<String, String> membershipExpirationRu\n \tpublic List<Facility> getFacilitiesWhereGroupIsAdmin(PerunSession perunSession, Group group) throws InternalErrorException {\n \t\treturn this.getGroupsManagerImpl().getFacilitiesWhereGroupIsAdmin(perunSession, group);\n \t}\n+\n+\t@Override\n+\tpublic void reactivateMember(PerunSession sess, Member member, Group group) throws InternalErrorException, MemberNotExistsException {\n+\t\tif (!isGroupMember(sess, group, member)) throw new MemberNotExistsException(\"Member does not belong to this group\");\n+\n+\t\tvalidateMemberInGroup(sess, member, group);\n+\n+\t\t// Get current membershipExpiration date attribute\n+\t\tAttribute membershipExpirationAttribute = getMemberExpiration(sess, member, group);\n+\t\t// Set new value of the membershipExpiration for the member\n+\t\tmembershipExpirationAttribute.setValue(null);\n+\n+\t\ttry {\n+\t\t\tgetPerunBl().getAttributesManagerBl().setAttribute(sess, member, group, membershipExpirationAttribute);\n+\t\t} catch (WrongAttributeValueException e) {\n+\t\t\tthrow new InternalErrorException(\"Wrong value: \" + membershipExpirationAttribute.getValue(),e);\n+\t\t} catch (WrongReferenceAttributeValueException | WrongAttributeAssignmentException e) {\n+\t\t\tthrow new InternalErrorException(e);\n+\t\t}\n+\n+\t\ttry {\n+\t\t\textendMembershipInGroup(sess, member, group);\n+\t\t} catch (ExtendMembershipException ex) {\n+\t\t\t// This exception should not be thrown for null membershipExpiration attribute", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNTMyMTE0OQ=="}, "originalCommit": {"oid": "cb81de7258aebd1ae5e87f038a513c27fcb1697d"}, "originalPosition": 27}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2004, "cost": 1, "resetAt": "2021-11-12T18:49:56Z"}}}