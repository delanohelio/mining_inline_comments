{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDc3Njg3MTQ3", "number": 2880, "title": "Core - new method to create service user", "bodyText": "Created new method createServiceUser which can be used to create a\nservice user without any members.", "createdAt": "2020-09-02T09:19:21Z", "url": "https://github.com/CESNET/perun/pull/2880", "merged": true, "mergeCommit": {"oid": "df4ef9e6fe7038fcd0dd3e831b4fdbdfce307982"}, "closed": true, "closedAt": "2020-09-07T10:58:41Z", "author": {"login": "Vojtech-Sassmann"}, "timelineItems": {"totalCount": 6, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdE7fV_AFqTQ4MDc3Mjk2Nw==", "endCursor": "Y3Vyc29yOnYyOpPPAAABdGg3eOAFqTQ4MzQ2NDI0Mg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDgwNzcyOTY3", "url": "https://github.com/CESNET/perun/pull/2880#pullrequestreview-480772967", "createdAt": "2020-09-02T12:35:48Z", "commit": {"oid": "d9a01b1bdc41fb824b27d78fe9354fc036bcdc2a"}, "state": "APPROVED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0wMlQxMjozNTo0OFrOHLs9yw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0wMlQxMjozNTo0OFrOHLs9yw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MjAzMzA5OQ==", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                policy_roles:\n          \n          \n            \n                policy_roles: []", "url": "https://github.com/CESNET/perun/pull/2880#discussion_r482033099", "createdAt": "2020-09-02T12:35:48Z", "author": {"login": "balcirakpeter"}, "path": "perun-base/src/main/resources/perun-roles.yml", "diffHunk": "@@ -4306,6 +4306,11 @@ perun_policies:\n     include_policies:\n       - default_policy\n \n+  createServiceUser_policy:\n+    policy_roles:", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d9a01b1bdc41fb824b27d78fe9354fc036bcdc2a"}, "originalPosition": 5}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "d9a01b1bdc41fb824b27d78fe9354fc036bcdc2a", "author": {"user": {"login": "Vojtech-Sassmann", "name": "Vojt\u011bch Sassmann"}}, "url": "https://github.com/CESNET/perun/commit/d9a01b1bdc41fb824b27d78fe9354fc036bcdc2a", "committedDate": "2020-09-02T09:18:31Z", "message": "Core - new method to create service user\n\n* Created new method createServiceUser which can be used to create a\nservice user without any members."}, "afterCommit": {"oid": "591f1f649d916733cfedca5e94cf9d0750bcbe4e", "author": {"user": {"login": "Vojtech-Sassmann", "name": "Vojt\u011bch Sassmann"}}, "url": "https://github.com/CESNET/perun/commit/591f1f649d916733cfedca5e94cf9d0750bcbe4e", "committedDate": "2020-09-02T12:58:33Z", "message": "Core - new method to create service user\n\n* Created new method createServiceUser which can be used to create a\nservice user without any members."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDgyNDAzMzAy", "url": "https://github.com/CESNET/perun/pull/2880#pullrequestreview-482403302", "createdAt": "2020-09-04T06:56:03Z", "commit": {"oid": "591f1f649d916733cfedca5e94cf9d0750bcbe4e"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0wNFQwNjo1NjowM1rOHNB4gw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0wNFQwNjo1NjoxNlrOHNB43g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MzQyNDM4Nw==", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            \t\tSystem.out.println(CLASS_NAME + \"testCreateServiceUserSetsAttributes\");\n          \n          \n            \n            \t\tSystem.out.println(CLASS_NAME + \"testCreateServiceUserSetsUes\");", "url": "https://github.com/CESNET/perun/pull/2880#discussion_r483424387", "createdAt": "2020-09-04T06:56:03Z", "author": {"login": "zlamalp"}, "path": "perun-core/src/test/java/cz/metacentrum/perun/core/entry/UsersManagerEntryIntegrationTest.java", "diffHunk": "@@ -1422,6 +1424,64 @@ public void findUserByUserExtSourceLogin() {\n \t\tassertEquals(user, users.get(0));\n \t}\n \n+\t@Test\n+\tpublic void testCreateServiceUser() throws Exception {\n+\t\tSystem.out.println(CLASS_NAME + \"testCreateServiceUser\");\n+\n+\t\tCandidate candidate = setUpCandidateForSpecificUser1();\n+\n+\t\tUser createdUser = usersManager.createServiceUser(sess, candidate, Collections.emptyList());\n+\n+\t\tcreatedUser = usersManager.getUserById(sess, createdUser.getId());\n+\n+\t\tassertThat(createdUser).isEqualToComparingOnlyGivenFields(candidate, \"firstName\", \"lastName\");\n+\t\tassertThat(createdUser.isServiceUser());\n+\t}\n+\n+\t@Test\n+\tpublic void testCreateServiceUserSetsAttributes() throws Exception {\n+\t\tSystem.out.println(CLASS_NAME + \"testCreateServiceUserSetsAttributes\");\n+\n+\t\tCandidate candidate = setUpCandidateForSpecificUser1();\n+\t\tMap<String, String> attrs = new HashMap<>();\n+\t\tString value = \"asdf@sdf.df\";\n+\t\tattrs.put(URN_ATTR_USER_PREFERRED_MAIL, value);\n+\t\tcandidate.setAttributes(attrs);\n+\n+\t\tUser createdUser = usersManager.createServiceUser(sess, candidate, Collections.emptyList());\n+\n+\t\tAttribute attr = perun.getAttributesManagerBl().getAttribute(sess, createdUser, URN_ATTR_USER_PREFERRED_MAIL);\n+\n+\t\tassertThat(attr.getValue()).isEqualTo(value);\n+\t}\n+\n+\t@Test\n+\tpublic void testCreateServiceUserSetsUes() throws Exception {\n+\t\tSystem.out.println(CLASS_NAME + \"testCreateServiceUserSetsAttributes\");", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "591f1f649d916733cfedca5e94cf9d0750bcbe4e"}, "originalPosition": 53}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MzQyNDQ3OA==", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            \t\tSystem.out.println(CLASS_NAME + \"testCreateServiceUserSetsAttributes\");\n          \n          \n            \n            \t\tSystem.out.println(CLASS_NAME + \"testCreateServiceUserFailsForAlreadyExistingUes\");", "url": "https://github.com/CESNET/perun/pull/2880#discussion_r483424478", "createdAt": "2020-09-04T06:56:16Z", "author": {"login": "zlamalp"}, "path": "perun-core/src/test/java/cz/metacentrum/perun/core/entry/UsersManagerEntryIntegrationTest.java", "diffHunk": "@@ -1422,6 +1424,64 @@ public void findUserByUserExtSourceLogin() {\n \t\tassertEquals(user, users.get(0));\n \t}\n \n+\t@Test\n+\tpublic void testCreateServiceUser() throws Exception {\n+\t\tSystem.out.println(CLASS_NAME + \"testCreateServiceUser\");\n+\n+\t\tCandidate candidate = setUpCandidateForSpecificUser1();\n+\n+\t\tUser createdUser = usersManager.createServiceUser(sess, candidate, Collections.emptyList());\n+\n+\t\tcreatedUser = usersManager.getUserById(sess, createdUser.getId());\n+\n+\t\tassertThat(createdUser).isEqualToComparingOnlyGivenFields(candidate, \"firstName\", \"lastName\");\n+\t\tassertThat(createdUser.isServiceUser());\n+\t}\n+\n+\t@Test\n+\tpublic void testCreateServiceUserSetsAttributes() throws Exception {\n+\t\tSystem.out.println(CLASS_NAME + \"testCreateServiceUserSetsAttributes\");\n+\n+\t\tCandidate candidate = setUpCandidateForSpecificUser1();\n+\t\tMap<String, String> attrs = new HashMap<>();\n+\t\tString value = \"asdf@sdf.df\";\n+\t\tattrs.put(URN_ATTR_USER_PREFERRED_MAIL, value);\n+\t\tcandidate.setAttributes(attrs);\n+\n+\t\tUser createdUser = usersManager.createServiceUser(sess, candidate, Collections.emptyList());\n+\n+\t\tAttribute attr = perun.getAttributesManagerBl().getAttribute(sess, createdUser, URN_ATTR_USER_PREFERRED_MAIL);\n+\n+\t\tassertThat(attr.getValue()).isEqualTo(value);\n+\t}\n+\n+\t@Test\n+\tpublic void testCreateServiceUserSetsUes() throws Exception {\n+\t\tSystem.out.println(CLASS_NAME + \"testCreateServiceUserSetsAttributes\");\n+\n+\t\tCandidate candidate = setUpCandidateForSpecificUser1();\n+\n+\t\tUser createdUser = usersManager.createServiceUser(sess, candidate, Collections.emptyList());\n+\n+\t\tUserExtSource candidateUes = candidate.getUserExtSource();\n+\t\tUser userByUes = usersManager.getUserByExtSourceNameAndExtLogin(sess, candidateUes.getExtSource().getName(),\n+\t\t\t\tcandidateUes.getLogin());\n+\n+\t\tassertThat(createdUser).isEqualByComparingTo(userByUes);\n+\t}\n+\n+\t@Test\n+\tpublic void testCreateServiceUserFailsForAlreadyExistingUes() throws Exception {\n+\t\tSystem.out.println(CLASS_NAME + \"testCreateServiceUserSetsAttributes\");", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "591f1f649d916733cfedca5e94cf9d0750bcbe4e"}, "originalPosition": 68}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "90514adebf40164360e045796457d8596b9d90d6", "author": {"user": {"login": "Vojtech-Sassmann", "name": "Vojt\u011bch Sassmann"}}, "url": "https://github.com/CESNET/perun/commit/90514adebf40164360e045796457d8596b9d90d6", "committedDate": "2020-09-07T10:47:04Z", "message": "Core - new method to create service user\n\n* Created new method createServiceUser which can be used to create a\nservice user without any members."}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "591f1f649d916733cfedca5e94cf9d0750bcbe4e", "author": {"user": {"login": "Vojtech-Sassmann", "name": "Vojt\u011bch Sassmann"}}, "url": "https://github.com/CESNET/perun/commit/591f1f649d916733cfedca5e94cf9d0750bcbe4e", "committedDate": "2020-09-02T12:58:33Z", "message": "Core - new method to create service user\n\n* Created new method createServiceUser which can be used to create a\nservice user without any members."}, "afterCommit": {"oid": "90514adebf40164360e045796457d8596b9d90d6", "author": {"user": {"login": "Vojtech-Sassmann", "name": "Vojt\u011bch Sassmann"}}, "url": "https://github.com/CESNET/perun/commit/90514adebf40164360e045796457d8596b9d90d6", "committedDate": "2020-09-07T10:47:04Z", "message": "Core - new method to create service user\n\n* Created new method createServiceUser which can be used to create a\nservice user without any members."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDgzNDY0MjQy", "url": "https://github.com/CESNET/perun/pull/2880#pullrequestreview-483464242", "createdAt": "2020-09-07T10:58:20Z", "commit": {"oid": "90514adebf40164360e045796457d8596b9d90d6"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1024, "cost": 1, "resetAt": "2021-11-01T13:07:16Z"}}}