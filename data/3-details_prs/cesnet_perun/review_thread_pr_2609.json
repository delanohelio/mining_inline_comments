{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0Mzg1MjYxMDgx", "number": 2609, "reviewThreads": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xN1QxMjo0MzoxOVrODotE2g==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xN1QxMzoyMzozOFrODot_RQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjQ0MDA4MTU0OnYy", "diffSide": "RIGHT", "path": "perun-core/src/main/java/cz/metacentrum/perun/core/entry/UsersManagerEntry.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xN1QxMjo0MzoxOVrOF3ahZA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yNVQxMzo0NTo1OVrOF7bvAw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MzY1MDUzMg==", "bodyText": "What about to use 2 methods authorizedInternal in 1 if clause with different objects? Like:\nif(!AuthzResolver.authorizedInternal(sess, \"removeSpecificUserOwner_User_User_policy\", Collections.singletonList(user)) && !AuthzResolver.authorizedInternal(sess, \"removeSpecificUserOwner_User_User_policy\", Collections.singletonList(specificUser))) { .. }", "url": "https://github.com/CESNET/perun/pull/2609#discussion_r393650532", "createdAt": "2020-03-17T12:43:19Z", "author": {"login": "stavamichal"}, "path": "perun-core/src/main/java/cz/metacentrum/perun/core/entry/UsersManagerEntry.java", "diffHunk": "@@ -189,8 +169,9 @@ public void removeSpecificUserOwner(PerunSession sess, User user, User specificU\n \t\tif (user.isServiceUser()) throw new NotSpecificUserExpectedException(user);\n \t\tif (user.isSponsoredUser() && specificUser.isSponsoredUser()) throw new NotSpecificUserExpectedException(specificUser);\n \t\tif (!specificUser.isSpecificUser()) throw new SpecificUserExpectedException(specificUser);\n-\t\tif(!AuthzResolver.isAuthorized(sess, Role.SELF, specificUser) &&\n-\t\t\t!AuthzResolver.isAuthorized(sess, Role.SPONSOR, specificUser)) {\n+\n+\t\t// Authorization can take only specificUser, because it would not work correctly with both User objects.\n+\t\tif(!AuthzResolver.authorizedInternal(sess, \"removeSpecificUserOwner_User_User_policy\", Collections.singletonList(specificUser))) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "7c50c86b95b51c7c7fa9f6f9da566b34be98ea73"}, "originalPosition": 107}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5Nzg2NDcwNw==", "bodyText": "Done, but the second call has to have its own policy.", "url": "https://github.com/CESNET/perun/pull/2609#discussion_r397864707", "createdAt": "2020-03-25T13:45:59Z", "author": {"login": "balcirakpeter"}, "path": "perun-core/src/main/java/cz/metacentrum/perun/core/entry/UsersManagerEntry.java", "diffHunk": "@@ -189,8 +169,9 @@ public void removeSpecificUserOwner(PerunSession sess, User user, User specificU\n \t\tif (user.isServiceUser()) throw new NotSpecificUserExpectedException(user);\n \t\tif (user.isSponsoredUser() && specificUser.isSponsoredUser()) throw new NotSpecificUserExpectedException(specificUser);\n \t\tif (!specificUser.isSpecificUser()) throw new SpecificUserExpectedException(specificUser);\n-\t\tif(!AuthzResolver.isAuthorized(sess, Role.SELF, specificUser) &&\n-\t\t\t!AuthzResolver.isAuthorized(sess, Role.SPONSOR, specificUser)) {\n+\n+\t\t// Authorization can take only specificUser, because it would not work correctly with both User objects.\n+\t\tif(!AuthzResolver.authorizedInternal(sess, \"removeSpecificUserOwner_User_User_policy\", Collections.singletonList(specificUser))) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MzY1MDUzMg=="}, "originalCommit": {"oid": "7c50c86b95b51c7c7fa9f6f9da566b34be98ea73"}, "originalPosition": 107}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjQ0MDA4MzA4OnYy", "diffSide": "RIGHT", "path": "perun-core/src/main/java/cz/metacentrum/perun/core/entry/UsersManagerEntry.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xN1QxMjo0Mzo0NFrOF3aiaw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yNVQxMzo0NjoxMlrOF7bvqA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MzY1MDc5NQ==", "bodyText": "What about to use 2 methods authorizedInternal in 1 if clause with different objects? Like:\nif(!AuthzResolver.authorizedInternal(sess, \"addSpecificUserOwner_User_User_policy\", Collections.singletonList(user)) && !AuthzResolver.authorizedInternal(sess, \"addSpecificUserOwner_User_User_policy\", Collections.singletonList(specificUser))) { .. }", "url": "https://github.com/CESNET/perun/pull/2609#discussion_r393650795", "createdAt": "2020-03-17T12:43:44Z", "author": {"login": "stavamichal"}, "path": "perun-core/src/main/java/cz/metacentrum/perun/core/entry/UsersManagerEntry.java", "diffHunk": "@@ -204,8 +185,9 @@ public void addSpecificUserOwner(PerunSession sess, User user, User specificUser\n \t\tif (user.isServiceUser()) throw new NotSpecificUserExpectedException(user);\n \t\tif (user.isSponsoredUser() && specificUser.isSponsoredUser()) throw new NotSpecificUserExpectedException(specificUser);\n \t\tif (!specificUser.isSpecificUser()) throw new SpecificUserExpectedException(specificUser);\n-\t\tif(!AuthzResolver.isAuthorized(sess, Role.SELF, specificUser) &&\n-\t\t\t!AuthzResolver.isAuthorized(sess, Role.SPONSOR, specificUser)) {\n+\n+\t\t// Authorization can take only specificUser, because it would not work correctly with both User objects.\n+\t\tif(!AuthzResolver.authorizedInternal(sess, \"addSpecificUserOwner_User_User_policy\", Collections.singletonList(specificUser))) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "7c50c86b95b51c7c7fa9f6f9da566b34be98ea73"}, "originalPosition": 119}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5Nzg2NDg3Mg==", "bodyText": "Same as above.", "url": "https://github.com/CESNET/perun/pull/2609#discussion_r397864872", "createdAt": "2020-03-25T13:46:12Z", "author": {"login": "balcirakpeter"}, "path": "perun-core/src/main/java/cz/metacentrum/perun/core/entry/UsersManagerEntry.java", "diffHunk": "@@ -204,8 +185,9 @@ public void addSpecificUserOwner(PerunSession sess, User user, User specificUser\n \t\tif (user.isServiceUser()) throw new NotSpecificUserExpectedException(user);\n \t\tif (user.isSponsoredUser() && specificUser.isSponsoredUser()) throw new NotSpecificUserExpectedException(specificUser);\n \t\tif (!specificUser.isSpecificUser()) throw new SpecificUserExpectedException(specificUser);\n-\t\tif(!AuthzResolver.isAuthorized(sess, Role.SELF, specificUser) &&\n-\t\t\t!AuthzResolver.isAuthorized(sess, Role.SPONSOR, specificUser)) {\n+\n+\t\t// Authorization can take only specificUser, because it would not work correctly with both User objects.\n+\t\tif(!AuthzResolver.authorizedInternal(sess, \"addSpecificUserOwner_User_User_policy\", Collections.singletonList(specificUser))) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MzY1MDc5NQ=="}, "originalCommit": {"oid": "7c50c86b95b51c7c7fa9f6f9da566b34be98ea73"}, "originalPosition": 119}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjQ0MDIzMTA5OnYy", "diffSide": "RIGHT", "path": "perun-core/src/main/java/cz/metacentrum/perun/core/entry/UsersManagerEntry.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xN1QxMzoyMzozOFrOF3cAhg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yNVQxMzo0NjoxN1rOF7bv3w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MzY3NDg4Ng==", "bodyText": "Same question like above.", "url": "https://github.com/CESNET/perun/pull/2609#discussion_r393674886", "createdAt": "2020-03-17T13:23:38Z", "author": {"login": "stavamichal"}, "path": "perun-core/src/main/java/cz/metacentrum/perun/core/entry/UsersManagerEntry.java", "diffHunk": "@@ -382,8 +350,8 @@ public User setSpecificUser(PerunSession sess, User specificUser, SpecificUserTy\n \t\tgetPerunBl().getUsersManagerBl().checkUserExists(sess, owner);\n \t\tgetPerunBl().getUsersManagerBl().checkUserExists(sess, specificUser);\n \n-\t\t// Authorization\n-\t\tif(!AuthzResolver.isAuthorized(sess, Role.PERUNADMIN)) {\n+\t\t// Authorization can take only specificUser, because it would not work correctly with both User objects.\n+\t\tif(!AuthzResolver.authorizedInternal(sess, \"setSpecificUser_User_SpecificUserType_User_policy\", Collections.singletonList(specificUser))) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "7c50c86b95b51c7c7fa9f6f9da566b34be98ea73"}, "originalPosition": 234}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5Nzg2NDkyNw==", "bodyText": "Same as above", "url": "https://github.com/CESNET/perun/pull/2609#discussion_r397864927", "createdAt": "2020-03-25T13:46:17Z", "author": {"login": "balcirakpeter"}, "path": "perun-core/src/main/java/cz/metacentrum/perun/core/entry/UsersManagerEntry.java", "diffHunk": "@@ -382,8 +350,8 @@ public User setSpecificUser(PerunSession sess, User specificUser, SpecificUserTy\n \t\tgetPerunBl().getUsersManagerBl().checkUserExists(sess, owner);\n \t\tgetPerunBl().getUsersManagerBl().checkUserExists(sess, specificUser);\n \n-\t\t// Authorization\n-\t\tif(!AuthzResolver.isAuthorized(sess, Role.PERUNADMIN)) {\n+\t\t// Authorization can take only specificUser, because it would not work correctly with both User objects.\n+\t\tif(!AuthzResolver.authorizedInternal(sess, \"setSpecificUser_User_SpecificUserType_User_policy\", Collections.singletonList(specificUser))) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MzY3NDg4Ng=="}, "originalCommit": {"oid": "7c50c86b95b51c7c7fa9f6f9da566b34be98ea73"}, "originalPosition": 234}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2124, "cost": 1, "resetAt": "2021-11-12T18:49:56Z"}}}