{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDgyODU3MTM2", "number": 2891, "reviewThreads": {"totalCount": 5, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xM1QxMjoyNDozM1rOEi3oig==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xNFQxMTozNTowOVrOEjFUTQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzA0OTk4NTM4OnYy", "diffSide": "RIGHT", "path": "perun-base/src/main/resources/perun-roles.yml", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xM1QxMjoyNDozM1rOHQ8Dcg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xM1QxMjoyNDozM1rOHQ8Dcg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NzUyMzE4Ng==", "bodyText": "RESOURCEADMIN and RESOURCESELFSERVICE are connected also to Facility objects. Therefore, you can use it in this policy.", "url": "https://github.com/CESNET/perun/pull/2891#discussion_r487523186", "createdAt": "2020-09-13T12:24:33Z", "author": {"login": "balcirakpeter"}, "path": "perun-base/src/main/resources/perun-roles.yml", "diffHunk": "@@ -2659,6 +2671,48 @@ perun_policies:\n     include_policies:\n       - default_policy\n \n+  getEnrichedResourcesForVo_Vo_policy:\n+    policy_roles:\n+      - FACILITYADMIN:\n+      - RESOURCESELFSERVICE: Vo\n+      - RESOURCEADMIN: Vo\n+      - VOADMIN: Vo\n+      - VOOBSERVER: Vo\n+      - PERUNOBSERVER:\n+    include_policies:\n+      - default_policy\n+\n+  filter-getEnrichedResourcesForVo_Vo_policy:\n+    policy_roles:\n+      - FACILITYADMIN: Facility\n+      - RESOURCESELFSERVICE: Resource\n+      - RESOURCEADMIN: Resource\n+      - VOADMIN: Vo\n+      - VOOBSERVER: Vo\n+      - PERUNOBSERVER:\n+    include_policies:\n+      - default_policy\n+\n+  getEnrichedResourcesForFacility_Facility_policy:\n+    policy_roles:\n+      - RESOURCEADMIN:", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d51d8fdd41d943fc69886e57e8aee42dc2787770"}, "originalPosition": 47}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzA1MDAyODMzOnYy", "diffSide": "RIGHT", "path": "perun-core/src/test/java/cz/metacentrum/perun/core/entry/ResourcesManagerEntryIntegrationTest.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xM1QxMzoxNjo0N1rOHQ8YUg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xM1QxMzoxNjo0N1rOHQ8YUg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NzUyODUzMA==", "bodyText": "This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters. Learn more about bidirectional Unicode characters\n\n\n  \n\n\n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            \t\tSystem.out.println(CLASS_NAME + \"getEnrichedResourceByIdWithAllAttributes\");\n          \n          \n            \n            \t\tSystem.out.println(CLASS_NAME + \"getEnrichedResourceByIdWithGivenAttributes\");", "url": "https://github.com/CESNET/perun/pull/2891#discussion_r487528530", "createdAt": "2020-09-13T13:16:47Z", "author": {"login": "balcirakpeter"}, "path": "perun-core/src/test/java/cz/metacentrum/perun/core/entry/ResourcesManagerEntryIntegrationTest.java", "diffHunk": "@@ -1917,6 +1921,99 @@ public void removeResourceSelfServiceGroup() throws Exception {\n \t\tassertFalse(roles.contains(\"RESOURCESELFSERVICE\"));\n \t}\n \n+\t@Test\n+\tpublic void getEnrichedResourceByIdWithAllAttributes() throws Exception {\n+\t\tSystem.out.println(CLASS_NAME + \"getEnrichedResourceByIdWithAllAttributes\");\n+\n+\t\tvo = setUpVo();\n+\t\tfacility = setUpFacility();\n+\t\tResource resource = setUpResource();\n+\n+\t\tEnrichedResource eResource = resourcesManager.getEnrichedResourceById(sess, resource.getId(), null);\n+\n+\t\tassertThat(eResource.getResource()).isEqualTo(resource);\n+\t\tassertThat(eResource.getAttributes()).isNotEmpty();\n+\t}\n+\n+\t@Test\n+\tpublic void getEnrichedResourceByIdWithGivenAttributes() throws Exception {\n+\t\tSystem.out.println(CLASS_NAME + \"getEnrichedResourceByIdWithAllAttributes\");", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d51d8fdd41d943fc69886e57e8aee42dc2787770"}, "originalPosition": 45}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzA1MDAyOTQ3OnYy", "diffSide": "RIGHT", "path": "perun-openapi/openapi.yml", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xM1QxMzoxODoyOVrOHQ8Y3A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xM1QxMzoxODoyOVrOHQ8Y3A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NzUyODY2OA==", "bodyText": "This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters. Learn more about bidirectional Unicode characters\n\n\n  \n\n\n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                  operationId: getEnrichedResourcesForFacility\n          \n          \n            \n                  operationId: getEnrichedResourcesForVo", "url": "https://github.com/CESNET/perun/pull/2891#discussion_r487528668", "createdAt": "2020-09-13T13:18:29Z", "author": {"login": "balcirakpeter"}, "path": "perun-openapi/openapi.yml", "diffHunk": "@@ -10562,6 +10600,36 @@ paths:\n         default:\n           $ref: '#/components/responses/ExceptionResponse'\n \n+  /json/resourcesManager/getEnrichedResourcesForVo:\n+    get:\n+      tags:\n+        - ResourcesManager\n+      operationId: getEnrichedResourcesForFacility", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d51d8fdd41d943fc69886e57e8aee42dc2787770"}, "originalPosition": 74}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzA1MDAyOTYyOnYy", "diffSide": "RIGHT", "path": "perun-openapi/openapi.yml", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xM1QxMzoxODo0N1rOHQ8Y7w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xM1QxMzoxODo0N1rOHQ8Y7w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NzUyODY4Nw==", "bodyText": "This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters. Learn more about bidirectional Unicode characters\n\n\n  \n\n\n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                  operationId: getEnrichedResourcesForVo\n          \n          \n            \n                  operationId: getEnrichedResourcesForFacility", "url": "https://github.com/CESNET/perun/pull/2891#discussion_r487528687", "createdAt": "2020-09-13T13:18:47Z", "author": {"login": "balcirakpeter"}, "path": "perun-openapi/openapi.yml", "diffHunk": "@@ -10562,6 +10600,36 @@ paths:\n         default:\n           $ref: '#/components/responses/ExceptionResponse'\n \n+  /json/resourcesManager/getEnrichedResourcesForVo:\n+    get:\n+      tags:\n+        - ResourcesManager\n+      operationId: getEnrichedResourcesForFacility\n+      summary: Find resources for given vo and attributes for given names. If the attrNames are empty or null, return all attributes.\n+      parameters:\n+        - $ref: '#/components/parameters/voId'\n+        - $ref: '#/components/parameters/attrNamesOptional'\n+      responses:\n+        '200':\n+          $ref: '#/components/responses/ListOfEnrichedResourcesResponse'\n+        default:\n+          $ref: '#/components/responses/ExceptionResponse'\n+\n+  /json/resourcesManager/getEnrichedResourcesForFacility:\n+    get:\n+      tags:\n+        - ResourcesManager\n+      operationId: getEnrichedResourcesForVo", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d51d8fdd41d943fc69886e57e8aee42dc2787770"}, "originalPosition": 89}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzA1MjIyNzMzOnYy", "diffSide": "RIGHT", "path": "perun-core/src/main/java/cz/metacentrum/perun/core/blImpl/ResourcesManagerBlImpl.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xNFQxMTozNTowOVrOHRPovQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xNFQxMTozNTowOVrOHRPovQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4Nzg0NDAyOQ==", "bodyText": "This is not the right place for filtering. On the business logic layer, you need to get always all objects you could have. Filtrations need to be done on entry layer.", "url": "https://github.com/CESNET/perun/pull/2891#discussion_r487844029", "createdAt": "2020-09-14T11:35:09Z", "author": {"login": "stavamichal"}, "path": "perun-core/src/main/java/cz/metacentrum/perun/core/blImpl/ResourcesManagerBlImpl.java", "diffHunk": "@@ -93,6 +95,12 @@ public Resource getResourceById(PerunSession sess, int id) throws ResourceNotExi\n \t\treturn getResourcesManagerImpl().getResourceById(sess, id);\n \t}\n \n+\t@Override\n+\tpublic EnrichedResource getEnrichedResourceById(PerunSession sess, int id, List<String> attrNames) throws ResourceNotExistsException {\n+\t\tResource resource = getResourceById(sess, id);\n+\t\treturn filterOnlyAllowedAttributes(sess, convertToEnrichedResource(sess, resource, attrNames));", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "dfe66df878fb208b756746229e38ec5308763e16"}, "originalPosition": 23}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2268, "cost": 1, "resetAt": "2021-11-12T18:49:56Z"}}}