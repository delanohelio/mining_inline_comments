{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTM0MzA4NDc2", "number": 3025, "reviewThreads": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0wOFQwOTo0MjoyMlrOFCOTLA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0wOFQwOTo0Njo0NlrOFCOccQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzM3ODc1NzU2OnYy", "diffSide": "RIGHT", "path": "perun-base/src/test/resources/test-schema.sql", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0wOFQwOTo0MjoyMlrOIBQOfw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0wOFQxMDoxNjo0OFrOIBRxfQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzODE4NTM0Mw==", "bodyText": "indentation/alignment", "url": "https://github.com/CESNET/perun/pull/3025#discussion_r538185343", "createdAt": "2020-12-08T09:42:22Z", "author": {"login": "zlamalp"}, "path": "perun-base/src/test/resources/test-schema.sql", "diffHunk": "@@ -1264,6 +1264,7 @@ create table pwdreset (\n \tnamespace longvarchar not null,\n \tmail longvarchar,\n \tuser_id integer not null,\n+    validity_to timestamp not null,", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "fe7531f0d20dccc614ab20451ba790ce0895b81b"}, "originalPosition": 13}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzODIxMDY4NQ==", "bodyText": "Fixed.", "url": "https://github.com/CESNET/perun/pull/3025#discussion_r538210685", "createdAt": "2020-12-08T10:16:48Z", "author": {"login": "cuadradek"}, "path": "perun-base/src/test/resources/test-schema.sql", "diffHunk": "@@ -1264,6 +1264,7 @@ create table pwdreset (\n \tnamespace longvarchar not null,\n \tmail longvarchar,\n \tuser_id integer not null,\n+    validity_to timestamp not null,", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzODE4NTM0Mw=="}, "originalCommit": {"oid": "fe7531f0d20dccc614ab20451ba790ce0895b81b"}, "originalPosition": 13}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzM3ODc3MDc1OnYy", "diffSide": "RIGHT", "path": "perun-core/src/main/java/cz/metacentrum/perun/core/impl/UsersManagerImpl.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0wOFQwOTo0NDozOVrOIBQWMQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0wOFQxMDoxNzowMVrOIBRyDw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzODE4NzMxMw==", "bodyText": "I would prefer using >=.", "url": "https://github.com/CESNET/perun/pull/3025#discussion_r538187313", "createdAt": "2020-12-08T09:44:39Z", "author": {"login": "zlamalp"}, "path": "perun-core/src/main/java/cz/metacentrum/perun/core/impl/UsersManagerImpl.java", "diffHunk": "@@ -1280,14 +1280,12 @@ public void checkPasswordResetRequestIsValid(PerunSession sess, User user, int r\n \t\t\t\tthrow new ConsistencyErrorException(\"Password reset request \" + requestId + \" exists more than once.\");\n \t\t\t}\n \n-\t\t\tint validWindow = BeansUtils.getCoreConfig().getPwdresetValidationWindow();\n-\n \t\t\tPair<String,String> result;\n \t\t\tif (Compatibility.isPostgreSql()) {\n-\t\t\t\tresult = jdbc.queryForObject(\"select namespace, mail from pwdreset where user_id=? and id=? and (created_at > (now() - interval '\" + validWindow + \" hours'))\",\n+\t\t\t\tresult = jdbc.queryForObject(\"select namespace, mail from pwdreset where user_id=? and id=? and validity_to > now()\",", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "fe7531f0d20dccc614ab20451ba790ce0895b81b"}, "originalPosition": 9}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzODIxMDgzMQ==", "bodyText": "Fixed.", "url": "https://github.com/CESNET/perun/pull/3025#discussion_r538210831", "createdAt": "2020-12-08T10:17:01Z", "author": {"login": "cuadradek"}, "path": "perun-core/src/main/java/cz/metacentrum/perun/core/impl/UsersManagerImpl.java", "diffHunk": "@@ -1280,14 +1280,12 @@ public void checkPasswordResetRequestIsValid(PerunSession sess, User user, int r\n \t\t\t\tthrow new ConsistencyErrorException(\"Password reset request \" + requestId + \" exists more than once.\");\n \t\t\t}\n \n-\t\t\tint validWindow = BeansUtils.getCoreConfig().getPwdresetValidationWindow();\n-\n \t\t\tPair<String,String> result;\n \t\t\tif (Compatibility.isPostgreSql()) {\n-\t\t\t\tresult = jdbc.queryForObject(\"select namespace, mail from pwdreset where user_id=? and id=? and (created_at > (now() - interval '\" + validWindow + \" hours'))\",\n+\t\t\t\tresult = jdbc.queryForObject(\"select namespace, mail from pwdreset where user_id=? and id=? and validity_to > now()\",", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzODE4NzMxMw=="}, "originalCommit": {"oid": "fe7531f0d20dccc614ab20451ba790ce0895b81b"}, "originalPosition": 9}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzM3ODc4MTI5OnYy", "diffSide": "RIGHT", "path": "perun-db/postgres.sql", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0wOFQwOTo0Njo0NlrOIBQcMw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0wOFQxMDoxNjo1NFrOIBRxuQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzODE4ODg1MQ==", "bodyText": "indentation/alignment", "url": "https://github.com/CESNET/perun/pull/3025#discussion_r538188851", "createdAt": "2020-12-08T09:46:46Z", "author": {"login": "zlamalp"}, "path": "perun-db/postgres.sql", "diffHunk": "@@ -1259,7 +1259,8 @@ create table pwdreset (\n \tnamespace text not null,\n \tmail text,\n \tuser_id integer not null,\n-\tcreated_at timestamp default statement_timestamp() not null,\n+    validity_to timestamp not null,", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "fe7531f0d20dccc614ab20451ba790ce0895b81b"}, "originalPosition": 11}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzODIxMDc0NQ==", "bodyText": "Fixed.", "url": "https://github.com/CESNET/perun/pull/3025#discussion_r538210745", "createdAt": "2020-12-08T10:16:54Z", "author": {"login": "cuadradek"}, "path": "perun-db/postgres.sql", "diffHunk": "@@ -1259,7 +1259,8 @@ create table pwdreset (\n \tnamespace text not null,\n \tmail text,\n \tuser_id integer not null,\n-\tcreated_at timestamp default statement_timestamp() not null,\n+    validity_to timestamp not null,", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzODE4ODg1MQ=="}, "originalCommit": {"oid": "fe7531f0d20dccc614ab20451ba790ce0895b81b"}, "originalPosition": 11}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2213, "cost": 1, "resetAt": "2021-11-12T18:49:56Z"}}}