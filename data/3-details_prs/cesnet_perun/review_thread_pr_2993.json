{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTI1MzE0NTIy", "number": 2993, "reviewThreads": {"totalCount": 7, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0yM1QwODowODo0MFrOE8Gsxg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0yM1QxMjo1NTo0M1rOE8NFrw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzMxNDU5NzgyOnYy", "diffSide": "RIGHT", "path": "perun-rpc/src/main/java/cz/metacentrum/perun/rpc/methods/AuthzResolverMethod.java", "isResolved": true, "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0yM1QwODowODo0MFrOH4Ci4w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0yM1QxMDoyNTowMFrOH4HNYA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyODUyNDAwMw==", "bodyText": "Can't we simply fetch bean based on \"class\" and \"id? If you would update getBeanFromDatabase() for that, you could use shared logic, instead of instantiating fake class and then replacing it with the real object anyway.", "url": "https://github.com/CESNET/perun/pull/2993#discussion_r528524003", "createdAt": "2020-11-23T08:08:40Z", "author": {"login": "zlamalp"}, "path": "perun-rpc/src/main/java/cz/metacentrum/perun/rpc/methods/AuthzResolverMethod.java", "diffHunk": "@@ -129,6 +129,7 @@ public AuthzRoles call(ApiCaller ac, Deserializer parms) throws PerunException {\n \t\t\ttry {\n \t\t\t\tbean = (PerunBean) Class.forName(\"cz.metacentrum.perun.core.api.\" + complementaryObjectName).getConstructor().newInstance();\n \t\t\t\tbean.setId(complementaryObjectId);\n+\t\t\t\tbean = ac.fetchPerunBean(bean);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "bad1f228a3b341354fa1e011cb820fba8af71e67"}, "originalPosition": 4}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyODUzMDgxNw==", "bodyText": "You are right I will change it.", "url": "https://github.com/CESNET/perun/pull/2993#discussion_r528530817", "createdAt": "2020-11-23T08:23:20Z", "author": {"login": "balcirakpeter"}, "path": "perun-rpc/src/main/java/cz/metacentrum/perun/rpc/methods/AuthzResolverMethod.java", "diffHunk": "@@ -129,6 +129,7 @@ public AuthzRoles call(ApiCaller ac, Deserializer parms) throws PerunException {\n \t\t\ttry {\n \t\t\t\tbean = (PerunBean) Class.forName(\"cz.metacentrum.perun.core.api.\" + complementaryObjectName).getConstructor().newInstance();\n \t\t\t\tbean.setId(complementaryObjectId);\n+\t\t\t\tbean = ac.fetchPerunBean(bean);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyODUyNDAwMw=="}, "originalCommit": {"oid": "bad1f228a3b341354fa1e011cb820fba8af71e67"}, "originalPosition": 4}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyODYwMDQxNg==", "bodyText": "Ok, we have decided that we will do it in the future as a refactorization.", "url": "https://github.com/CESNET/perun/pull/2993#discussion_r528600416", "createdAt": "2020-11-23T10:25:00Z", "author": {"login": "balcirakpeter"}, "path": "perun-rpc/src/main/java/cz/metacentrum/perun/rpc/methods/AuthzResolverMethod.java", "diffHunk": "@@ -129,6 +129,7 @@ public AuthzRoles call(ApiCaller ac, Deserializer parms) throws PerunException {\n \t\t\ttry {\n \t\t\t\tbean = (PerunBean) Class.forName(\"cz.metacentrum.perun.core.api.\" + complementaryObjectName).getConstructor().newInstance();\n \t\t\t\tbean.setId(complementaryObjectId);\n+\t\t\t\tbean = ac.fetchPerunBean(bean);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyODUyNDAwMw=="}, "originalCommit": {"oid": "bad1f228a3b341354fa1e011cb820fba8af71e67"}, "originalPosition": 4}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzMxNDYzODg5OnYy", "diffSide": "RIGHT", "path": "perun-rpc/src/main/java/cz/metacentrum/perun/rpc/methods/AuthzResolverMethod.java", "isResolved": true, "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0yM1QwODoyMToyN1rOH4C54Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0yM1QxMjoyOTowMFrOH4LW9A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyODUyOTg4OQ==", "bodyText": "So, generally there is no longer any check, that role requires some complementary object and we can expect more \"group managers without any group\" or what? If there is no check, then it might fail in AuthzResolverBlImpl.unsetRole(sess, user, complementaryObject, role) for role SPONSOR where code fetches beanName from complementaryObject. There might be more places like this.", "url": "https://github.com/CESNET/perun/pull/2993#discussion_r528529889", "createdAt": "2020-11-23T08:21:27Z", "author": {"login": "zlamalp"}, "path": "perun-rpc/src/main/java/cz/metacentrum/perun/rpc/methods/AuthzResolverMethod.java", "diffHunk": "@@ -250,6 +270,15 @@ public AuthzRoles call(ApiCaller ac, Deserializer parms) throws PerunException {\n \t * @exampleParam role \"VOADMIN\"\n \t * @exampleParam complementaryObject { \"id\" : 123 , \"name\" : \"My testing VO\" , \"shortName\" : \"test_vo\" , \"beanName\" : \"Vo\" }\n \t */\n+\t/*#\n+\t * Set role for users.\n+\t *\n+\t * IMPORTANT: Refresh authz only if user in session is affected.\n+\t *\n+\t * @param role String Role which will be set for given users ( FACILITYADMIN | GROUPADMIN | PERUNADMIN | RESOURCEADMIN | RESOURCESELFSERVICE | SPONSOR | TOPGROUPCREATOR | VOADMIN | VOOBSERVER | PERUNOBSERVER | SECURITYADMIN | CABINETADMIN )\n+\t * @param users int[] <code>ids</code> of users for which is the role set\n+\t * @exampleParam role \"VOADMIN\"\n+\t */", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b7075fd6b98d9044dd5b63852bad2986fa49a3eb"}, "originalPosition": 60}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyODUzMjQzMw==", "bodyText": "Rules for that are defined in the perun-roles.yml. So for example, it is possible to set/unset role without a complementary object for PERUNADMIN, PERUNOBSERVER, CABINETADMIN. However, it is not possible to set/unset role without a complementary object for GROUPADMIN, VOADMIN, SPONSOR etc.\nThis is checked in the business logic of set/unset role methods.", "url": "https://github.com/CESNET/perun/pull/2993#discussion_r528532433", "createdAt": "2020-11-23T08:26:32Z", "author": {"login": "balcirakpeter"}, "path": "perun-rpc/src/main/java/cz/metacentrum/perun/rpc/methods/AuthzResolverMethod.java", "diffHunk": "@@ -250,6 +270,15 @@ public AuthzRoles call(ApiCaller ac, Deserializer parms) throws PerunException {\n \t * @exampleParam role \"VOADMIN\"\n \t * @exampleParam complementaryObject { \"id\" : 123 , \"name\" : \"My testing VO\" , \"shortName\" : \"test_vo\" , \"beanName\" : \"Vo\" }\n \t */\n+\t/*#\n+\t * Set role for users.\n+\t *\n+\t * IMPORTANT: Refresh authz only if user in session is affected.\n+\t *\n+\t * @param role String Role which will be set for given users ( FACILITYADMIN | GROUPADMIN | PERUNADMIN | RESOURCEADMIN | RESOURCESELFSERVICE | SPONSOR | TOPGROUPCREATOR | VOADMIN | VOOBSERVER | PERUNOBSERVER | SECURITYADMIN | CABINETADMIN )\n+\t * @param users int[] <code>ids</code> of users for which is the role set\n+\t * @exampleParam role \"VOADMIN\"\n+\t */", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyODUyOTg4OQ=="}, "originalCommit": {"oid": "b7075fd6b98d9044dd5b63852bad2986fa49a3eb"}, "originalPosition": 60}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyODY2ODQwNA==", "bodyText": "Ok, that makes sense. It just might be confusing in javadoc, since we do not list correct combinations, but only all possible. But since its technically configurable per-instance we probably can't do anything about it.", "url": "https://github.com/CESNET/perun/pull/2993#discussion_r528668404", "createdAt": "2020-11-23T12:29:00Z", "author": {"login": "zlamalp"}, "path": "perun-rpc/src/main/java/cz/metacentrum/perun/rpc/methods/AuthzResolverMethod.java", "diffHunk": "@@ -250,6 +270,15 @@ public AuthzRoles call(ApiCaller ac, Deserializer parms) throws PerunException {\n \t * @exampleParam role \"VOADMIN\"\n \t * @exampleParam complementaryObject { \"id\" : 123 , \"name\" : \"My testing VO\" , \"shortName\" : \"test_vo\" , \"beanName\" : \"Vo\" }\n \t */\n+\t/*#\n+\t * Set role for users.\n+\t *\n+\t * IMPORTANT: Refresh authz only if user in session is affected.\n+\t *\n+\t * @param role String Role which will be set for given users ( FACILITYADMIN | GROUPADMIN | PERUNADMIN | RESOURCEADMIN | RESOURCESELFSERVICE | SPONSOR | TOPGROUPCREATOR | VOADMIN | VOOBSERVER | PERUNOBSERVER | SECURITYADMIN | CABINETADMIN )\n+\t * @param users int[] <code>ids</code> of users for which is the role set\n+\t * @exampleParam role \"VOADMIN\"\n+\t */", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyODUyOTg4OQ=="}, "originalCommit": {"oid": "b7075fd6b98d9044dd5b63852bad2986fa49a3eb"}, "originalPosition": 60}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzMxNTU4ODQ0OnYy", "diffSide": "RIGHT", "path": "perun-rpc/src/main/java/cz/metacentrum/perun/rpc/ApiCaller.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0yM1QxMjozOTozOVrOH4LtlQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0yM1QxMzowNjozMVrOH4Moww==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyODY3NDE5Nw==", "bodyText": "Nit: Unused imports.", "url": "https://github.com/CESNET/perun/pull/2993#discussion_r528674197", "createdAt": "2020-11-23T12:39:39Z", "author": {"login": "Vojtech-Sassmann"}, "path": "perun-rpc/src/main/java/cz/metacentrum/perun/rpc/ApiCaller.java", "diffHunk": "@@ -1,8 +1,12 @@\n package cz.metacentrum.perun.rpc;\n \n import java.util.ArrayList;\n+import java.util.Arrays;\n+import java.util.Collections;\n import java.util.List;\n import java.util.Map;\n+import java.util.function.BiFunction;\n+import java.util.function.Function;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b7075fd6b98d9044dd5b63852bad2986fa49a3eb"}, "originalPosition": 9}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyODY4OTM0Nw==", "bodyText": "Removed", "url": "https://github.com/CESNET/perun/pull/2993#discussion_r528689347", "createdAt": "2020-11-23T13:06:31Z", "author": {"login": "balcirakpeter"}, "path": "perun-rpc/src/main/java/cz/metacentrum/perun/rpc/ApiCaller.java", "diffHunk": "@@ -1,8 +1,12 @@\n package cz.metacentrum.perun.rpc;\n \n import java.util.ArrayList;\n+import java.util.Arrays;\n+import java.util.Collections;\n import java.util.List;\n import java.util.Map;\n+import java.util.function.BiFunction;\n+import java.util.function.Function;", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyODY3NDE5Nw=="}, "originalCommit": {"oid": "b7075fd6b98d9044dd5b63852bad2986fa49a3eb"}, "originalPosition": 9}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzMxNTYzNDU2OnYy", "diffSide": "RIGHT", "path": "perun-rpc/src/main/java/cz/metacentrum/perun/rpc/methods/AuthzResolverMethod.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0yM1QxMjo1MzowNFrOH4MKUg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0yM1QxMzowNjo1M1rOH4MppA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyODY4MTU1NA==", "bodyText": "This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters. Learn more about bidirectional Unicode characters\n\n\n  \n\n\n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            \t\t\t\t\tcz.metacentrum.perun.core.api.AuthzResolver.unsetRole(ac.getSession(),\n          \n          \n            \n            \t\t\t\t\tcz.metacentrum.perun.core.api.AuthzResolver.setRole(ac.getSession(),", "url": "https://github.com/CESNET/perun/pull/2993#discussion_r528681554", "createdAt": "2020-11-23T12:53:04Z", "author": {"login": "Vojtech-Sassmann"}, "path": "perun-rpc/src/main/java/cz/metacentrum/perun/rpc/methods/AuthzResolverMethod.java", "diffHunk": "@@ -279,63 +317,79 @@ public Void call(ApiCaller ac, Deserializer parms) throws PerunException {\n \t\t\t\tif(parms.contains(\"complementaryObject\")) {\n \t\t\t\t\tcz.metacentrum.perun.core.api.AuthzResolver.setRole(ac.getSession(),\n \t\t\t\t\t\t\t\tac.getUserById(parms.readInt(\"user\")),\n-\t\t\t\t\t\t\t\tparms.readPerunBean(\"complementaryObject\"),\n+\t\t\t\t\t\t\t\tac.fetchPerunBean(parms.readPerunBean(\"complementaryObject\")),\n \t\t\t\t\t\t\t\troleName);\n \t\t\t\t\treturn null;\n \t\t\t\t} else if(parms.contains(\"complementaryObjects\")) {\n \t\t\t\t\tcz.metacentrum.perun.core.api.AuthzResolver.setRole(ac.getSession(),\n \t\t\t\t\t\t\t\tac.getUserById(parms.readInt(\"user\")),\n \t\t\t\t\t\t\t\troleName,\n-\t\t\t\t\t\t\t\tparms.readListPerunBeans(\"complementaryObjects\"));\n+\t\t\t\t\t\tac.fetchPerunBeans(parms.readListPerunBeans(\"complementaryObjects\")));\n \t\t\t\t\treturn null;\n \t\t\t\t} else {\n-\t\t\t\t\tthrow new RpcException(RpcException.Type.MISSING_VALUE, \"list of complementary objects or complementary object\");\n+\t\t\t\t\tcz.metacentrum.perun.core.api.AuthzResolver.unsetRole(ac.getSession(),", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b7075fd6b98d9044dd5b63852bad2986fa49a3eb"}, "originalPosition": 97}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyODY4OTU3Mg==", "bodyText": "Fixed", "url": "https://github.com/CESNET/perun/pull/2993#discussion_r528689572", "createdAt": "2020-11-23T13:06:53Z", "author": {"login": "balcirakpeter"}, "path": "perun-rpc/src/main/java/cz/metacentrum/perun/rpc/methods/AuthzResolverMethod.java", "diffHunk": "@@ -279,63 +317,79 @@ public Void call(ApiCaller ac, Deserializer parms) throws PerunException {\n \t\t\t\tif(parms.contains(\"complementaryObject\")) {\n \t\t\t\t\tcz.metacentrum.perun.core.api.AuthzResolver.setRole(ac.getSession(),\n \t\t\t\t\t\t\t\tac.getUserById(parms.readInt(\"user\")),\n-\t\t\t\t\t\t\t\tparms.readPerunBean(\"complementaryObject\"),\n+\t\t\t\t\t\t\t\tac.fetchPerunBean(parms.readPerunBean(\"complementaryObject\")),\n \t\t\t\t\t\t\t\troleName);\n \t\t\t\t\treturn null;\n \t\t\t\t} else if(parms.contains(\"complementaryObjects\")) {\n \t\t\t\t\tcz.metacentrum.perun.core.api.AuthzResolver.setRole(ac.getSession(),\n \t\t\t\t\t\t\t\tac.getUserById(parms.readInt(\"user\")),\n \t\t\t\t\t\t\t\troleName,\n-\t\t\t\t\t\t\t\tparms.readListPerunBeans(\"complementaryObjects\"));\n+\t\t\t\t\t\tac.fetchPerunBeans(parms.readListPerunBeans(\"complementaryObjects\")));\n \t\t\t\t\treturn null;\n \t\t\t\t} else {\n-\t\t\t\t\tthrow new RpcException(RpcException.Type.MISSING_VALUE, \"list of complementary objects or complementary object\");\n+\t\t\t\t\tcz.metacentrum.perun.core.api.AuthzResolver.unsetRole(ac.getSession(),", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyODY4MTU1NA=="}, "originalCommit": {"oid": "b7075fd6b98d9044dd5b63852bad2986fa49a3eb"}, "originalPosition": 97}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzMxNTYzNTI3OnYy", "diffSide": "RIGHT", "path": "perun-rpc/src/main/java/cz/metacentrum/perun/rpc/methods/AuthzResolverMethod.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0yM1QxMjo1MzoxOFrOH4MK0A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0yM1QxMzowNjo1MFrOH4Mpgw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyODY4MTY4MA==", "bodyText": "This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters. Learn more about bidirectional Unicode characters\n\n\n  \n\n\n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            \t\t\t\t\tcz.metacentrum.perun.core.api.AuthzResolver.unsetRole(ac.getSession(),\n          \n          \n            \n            \t\t\t\t\tcz.metacentrum.perun.core.api.AuthzResolver.setRole(ac.getSession(),", "url": "https://github.com/CESNET/perun/pull/2993#discussion_r528681680", "createdAt": "2020-11-23T12:53:18Z", "author": {"login": "Vojtech-Sassmann"}, "path": "perun-rpc/src/main/java/cz/metacentrum/perun/rpc/methods/AuthzResolverMethod.java", "diffHunk": "@@ -279,63 +317,79 @@ public Void call(ApiCaller ac, Deserializer parms) throws PerunException {\n \t\t\t\tif(parms.contains(\"complementaryObject\")) {\n \t\t\t\t\tcz.metacentrum.perun.core.api.AuthzResolver.setRole(ac.getSession(),\n \t\t\t\t\t\t\t\tac.getUserById(parms.readInt(\"user\")),\n-\t\t\t\t\t\t\t\tparms.readPerunBean(\"complementaryObject\"),\n+\t\t\t\t\t\t\t\tac.fetchPerunBean(parms.readPerunBean(\"complementaryObject\")),\n \t\t\t\t\t\t\t\troleName);\n \t\t\t\t\treturn null;\n \t\t\t\t} else if(parms.contains(\"complementaryObjects\")) {\n \t\t\t\t\tcz.metacentrum.perun.core.api.AuthzResolver.setRole(ac.getSession(),\n \t\t\t\t\t\t\t\tac.getUserById(parms.readInt(\"user\")),\n \t\t\t\t\t\t\t\troleName,\n-\t\t\t\t\t\t\t\tparms.readListPerunBeans(\"complementaryObjects\"));\n+\t\t\t\t\t\tac.fetchPerunBeans(parms.readListPerunBeans(\"complementaryObjects\")));\n \t\t\t\t\treturn null;\n \t\t\t\t} else {\n-\t\t\t\t\tthrow new RpcException(RpcException.Type.MISSING_VALUE, \"list of complementary objects or complementary object\");\n+\t\t\t\t\tcz.metacentrum.perun.core.api.AuthzResolver.unsetRole(ac.getSession(),\n+\t\t\t\t\t\tac.getUserById(parms.readInt(\"user\")),\n+\t\t\t\t\t\tnull,\n+\t\t\t\t\t\troleName);\n+\t\t\t\t\treturn null;\n \t\t\t\t}\n \t\t\t} else if (parms.contains(\"users\")) {\n+\t\t\t\tint[] userIds = parms.readArrayOfInts(\"users\");\n+\t\t\t\tList<User> users = new ArrayList<>(userIds.length);\n+\t\t\t\tfor (int userId : userIds) {\n+\t\t\t\t\tusers.add(ac.getUserById(userId));\n+\t\t\t\t}\n \t\t\t\tif (parms.contains(\"complementaryObject\")) {\n-\t\t\t\t\tint[] userIds = parms.readArrayOfInts(\"users\");\n-\t\t\t\t\tList<User> users = new ArrayList<>(userIds.length);\n-\t\t\t\t\tfor (int userId : userIds) {\n-\t\t\t\t\t\tusers.add(ac.getUserById(userId));\n-\t\t\t\t\t}\n \t\t\t\t\tcz.metacentrum.perun.core.api.AuthzResolver.setRole(ac.getSession(),\n \t\t\t\t\t\t\t\tusers,\n \t\t\t\t\t\t\t\troleName,\n-\t\t\t\t\t\t\t\tparms.readPerunBean(\"complementaryObject\"));\n+\t\t\t\t\t\tac.fetchPerunBean(parms.readPerunBean(\"complementaryObject\")));\n \t\t\t\t\treturn null;\n \t\t\t\t} else {\n-\t\t\t\t\tthrow new RpcException(RpcException.Type.MISSING_VALUE, \"complementaryObject\");\n+\t\t\t\t\tcz.metacentrum.perun.core.api.AuthzResolver.unsetRole(ac.getSession(),", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b7075fd6b98d9044dd5b63852bad2986fa49a3eb"}, "originalPosition": 123}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyODY4OTUzOQ==", "bodyText": "Fixed", "url": "https://github.com/CESNET/perun/pull/2993#discussion_r528689539", "createdAt": "2020-11-23T13:06:50Z", "author": {"login": "balcirakpeter"}, "path": "perun-rpc/src/main/java/cz/metacentrum/perun/rpc/methods/AuthzResolverMethod.java", "diffHunk": "@@ -279,63 +317,79 @@ public Void call(ApiCaller ac, Deserializer parms) throws PerunException {\n \t\t\t\tif(parms.contains(\"complementaryObject\")) {\n \t\t\t\t\tcz.metacentrum.perun.core.api.AuthzResolver.setRole(ac.getSession(),\n \t\t\t\t\t\t\t\tac.getUserById(parms.readInt(\"user\")),\n-\t\t\t\t\t\t\t\tparms.readPerunBean(\"complementaryObject\"),\n+\t\t\t\t\t\t\t\tac.fetchPerunBean(parms.readPerunBean(\"complementaryObject\")),\n \t\t\t\t\t\t\t\troleName);\n \t\t\t\t\treturn null;\n \t\t\t\t} else if(parms.contains(\"complementaryObjects\")) {\n \t\t\t\t\tcz.metacentrum.perun.core.api.AuthzResolver.setRole(ac.getSession(),\n \t\t\t\t\t\t\t\tac.getUserById(parms.readInt(\"user\")),\n \t\t\t\t\t\t\t\troleName,\n-\t\t\t\t\t\t\t\tparms.readListPerunBeans(\"complementaryObjects\"));\n+\t\t\t\t\t\tac.fetchPerunBeans(parms.readListPerunBeans(\"complementaryObjects\")));\n \t\t\t\t\treturn null;\n \t\t\t\t} else {\n-\t\t\t\t\tthrow new RpcException(RpcException.Type.MISSING_VALUE, \"list of complementary objects or complementary object\");\n+\t\t\t\t\tcz.metacentrum.perun.core.api.AuthzResolver.unsetRole(ac.getSession(),\n+\t\t\t\t\t\tac.getUserById(parms.readInt(\"user\")),\n+\t\t\t\t\t\tnull,\n+\t\t\t\t\t\troleName);\n+\t\t\t\t\treturn null;\n \t\t\t\t}\n \t\t\t} else if (parms.contains(\"users\")) {\n+\t\t\t\tint[] userIds = parms.readArrayOfInts(\"users\");\n+\t\t\t\tList<User> users = new ArrayList<>(userIds.length);\n+\t\t\t\tfor (int userId : userIds) {\n+\t\t\t\t\tusers.add(ac.getUserById(userId));\n+\t\t\t\t}\n \t\t\t\tif (parms.contains(\"complementaryObject\")) {\n-\t\t\t\t\tint[] userIds = parms.readArrayOfInts(\"users\");\n-\t\t\t\t\tList<User> users = new ArrayList<>(userIds.length);\n-\t\t\t\t\tfor (int userId : userIds) {\n-\t\t\t\t\t\tusers.add(ac.getUserById(userId));\n-\t\t\t\t\t}\n \t\t\t\t\tcz.metacentrum.perun.core.api.AuthzResolver.setRole(ac.getSession(),\n \t\t\t\t\t\t\t\tusers,\n \t\t\t\t\t\t\t\troleName,\n-\t\t\t\t\t\t\t\tparms.readPerunBean(\"complementaryObject\"));\n+\t\t\t\t\t\tac.fetchPerunBean(parms.readPerunBean(\"complementaryObject\")));\n \t\t\t\t\treturn null;\n \t\t\t\t} else {\n-\t\t\t\t\tthrow new RpcException(RpcException.Type.MISSING_VALUE, \"complementaryObject\");\n+\t\t\t\t\tcz.metacentrum.perun.core.api.AuthzResolver.unsetRole(ac.getSession(),", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyODY4MTY4MA=="}, "originalCommit": {"oid": "b7075fd6b98d9044dd5b63852bad2986fa49a3eb"}, "originalPosition": 123}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzMxNTYzNjEyOnYy", "diffSide": "RIGHT", "path": "perun-rpc/src/main/java/cz/metacentrum/perun/rpc/methods/AuthzResolverMethod.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0yM1QxMjo1MzozN1rOH4MLag==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0yM1QxMzowNjo0N1rOH4MpaA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyODY4MTgzNA==", "bodyText": "This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters. Learn more about bidirectional Unicode characters\n\n\n  \n\n\n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            \t\t\t\t\tcz.metacentrum.perun.core.api.AuthzResolver.unsetRole(ac.getSession(),\n          \n          \n            \n            \t\t\t\t\tcz.metacentrum.perun.core.api.AuthzResolver.setRole(ac.getSession(),", "url": "https://github.com/CESNET/perun/pull/2993#discussion_r528681834", "createdAt": "2020-11-23T12:53:37Z", "author": {"login": "Vojtech-Sassmann"}, "path": "perun-rpc/src/main/java/cz/metacentrum/perun/rpc/methods/AuthzResolverMethod.java", "diffHunk": "@@ -279,63 +317,79 @@ public Void call(ApiCaller ac, Deserializer parms) throws PerunException {\n \t\t\t\tif(parms.contains(\"complementaryObject\")) {\n \t\t\t\t\tcz.metacentrum.perun.core.api.AuthzResolver.setRole(ac.getSession(),\n \t\t\t\t\t\t\t\tac.getUserById(parms.readInt(\"user\")),\n-\t\t\t\t\t\t\t\tparms.readPerunBean(\"complementaryObject\"),\n+\t\t\t\t\t\t\t\tac.fetchPerunBean(parms.readPerunBean(\"complementaryObject\")),\n \t\t\t\t\t\t\t\troleName);\n \t\t\t\t\treturn null;\n \t\t\t\t} else if(parms.contains(\"complementaryObjects\")) {\n \t\t\t\t\tcz.metacentrum.perun.core.api.AuthzResolver.setRole(ac.getSession(),\n \t\t\t\t\t\t\t\tac.getUserById(parms.readInt(\"user\")),\n \t\t\t\t\t\t\t\troleName,\n-\t\t\t\t\t\t\t\tparms.readListPerunBeans(\"complementaryObjects\"));\n+\t\t\t\t\t\tac.fetchPerunBeans(parms.readListPerunBeans(\"complementaryObjects\")));\n \t\t\t\t\treturn null;\n \t\t\t\t} else {\n-\t\t\t\t\tthrow new RpcException(RpcException.Type.MISSING_VALUE, \"list of complementary objects or complementary object\");\n+\t\t\t\t\tcz.metacentrum.perun.core.api.AuthzResolver.unsetRole(ac.getSession(),\n+\t\t\t\t\t\tac.getUserById(parms.readInt(\"user\")),\n+\t\t\t\t\t\tnull,\n+\t\t\t\t\t\troleName);\n+\t\t\t\t\treturn null;\n \t\t\t\t}\n \t\t\t} else if (parms.contains(\"users\")) {\n+\t\t\t\tint[] userIds = parms.readArrayOfInts(\"users\");\n+\t\t\t\tList<User> users = new ArrayList<>(userIds.length);\n+\t\t\t\tfor (int userId : userIds) {\n+\t\t\t\t\tusers.add(ac.getUserById(userId));\n+\t\t\t\t}\n \t\t\t\tif (parms.contains(\"complementaryObject\")) {\n-\t\t\t\t\tint[] userIds = parms.readArrayOfInts(\"users\");\n-\t\t\t\t\tList<User> users = new ArrayList<>(userIds.length);\n-\t\t\t\t\tfor (int userId : userIds) {\n-\t\t\t\t\t\tusers.add(ac.getUserById(userId));\n-\t\t\t\t\t}\n \t\t\t\t\tcz.metacentrum.perun.core.api.AuthzResolver.setRole(ac.getSession(),\n \t\t\t\t\t\t\t\tusers,\n \t\t\t\t\t\t\t\troleName,\n-\t\t\t\t\t\t\t\tparms.readPerunBean(\"complementaryObject\"));\n+\t\t\t\t\t\tac.fetchPerunBean(parms.readPerunBean(\"complementaryObject\")));\n \t\t\t\t\treturn null;\n \t\t\t\t} else {\n-\t\t\t\t\tthrow new RpcException(RpcException.Type.MISSING_VALUE, \"complementaryObject\");\n+\t\t\t\t\tcz.metacentrum.perun.core.api.AuthzResolver.unsetRole(ac.getSession(),\n+\t\t\t\t\t\tusers,\n+\t\t\t\t\t\troleName,\n+\t\t\t\t\t\tnull);\n+\t\t\t\t\treturn null;\n \t\t\t\t}\n \t\t\t} else if (parms.contains(\"authorizedGroups\")) {\n+\t\t\t\tint[] groupIds = parms.readArrayOfInts(\"authorizedGroups\");\n+\t\t\t\tList<Group> groups = new ArrayList<>(groupIds.length);\n+\t\t\t\tfor (int groupId : groupIds) {\n+\t\t\t\t\tgroups.add(ac.getGroupById(groupId));\n+\t\t\t\t}\n \t\t\t\tif (parms.contains(\"complementaryObject\")) {\n-\t\t\t\t\tint[] groupIds = parms.readArrayOfInts(\"authorizedGroups\");\n-\t\t\t\t\tList<Group> groups = new ArrayList<>(groupIds.length);\n-\t\t\t\t\tfor (int groupId : groupIds) {\n-\t\t\t\t\t\tgroups.add(ac.getGroupById(groupId));\n-\t\t\t\t\t}\n \t\t\t\t\tcz.metacentrum.perun.core.api.AuthzResolver.setRole(ac.getSession(),\n \t\t\t\t\t\t\t\tgroups,\n-\t\t\t\t\t\t\t\tparms.readPerunBean(\"complementaryObject\"),\n+\t\t\t\t\t\t\t\tac.fetchPerunBean(parms.readPerunBean(\"complementaryObject\")),\n \t\t\t\t\t\t\t\troleName);\n \t\t\t\t\treturn null;\n \t\t\t\t} else {\n-\t\t\t\t\tthrow new RpcException(RpcException.Type.MISSING_VALUE, \"complementaryObject\");\n+\t\t\t\t\tcz.metacentrum.perun.core.api.AuthzResolver.unsetRole(ac.getSession(),", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b7075fd6b98d9044dd5b63852bad2986fa49a3eb"}, "originalPosition": 149}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyODY4OTUxMg==", "bodyText": "Fixed", "url": "https://github.com/CESNET/perun/pull/2993#discussion_r528689512", "createdAt": "2020-11-23T13:06:47Z", "author": {"login": "balcirakpeter"}, "path": "perun-rpc/src/main/java/cz/metacentrum/perun/rpc/methods/AuthzResolverMethod.java", "diffHunk": "@@ -279,63 +317,79 @@ public Void call(ApiCaller ac, Deserializer parms) throws PerunException {\n \t\t\t\tif(parms.contains(\"complementaryObject\")) {\n \t\t\t\t\tcz.metacentrum.perun.core.api.AuthzResolver.setRole(ac.getSession(),\n \t\t\t\t\t\t\t\tac.getUserById(parms.readInt(\"user\")),\n-\t\t\t\t\t\t\t\tparms.readPerunBean(\"complementaryObject\"),\n+\t\t\t\t\t\t\t\tac.fetchPerunBean(parms.readPerunBean(\"complementaryObject\")),\n \t\t\t\t\t\t\t\troleName);\n \t\t\t\t\treturn null;\n \t\t\t\t} else if(parms.contains(\"complementaryObjects\")) {\n \t\t\t\t\tcz.metacentrum.perun.core.api.AuthzResolver.setRole(ac.getSession(),\n \t\t\t\t\t\t\t\tac.getUserById(parms.readInt(\"user\")),\n \t\t\t\t\t\t\t\troleName,\n-\t\t\t\t\t\t\t\tparms.readListPerunBeans(\"complementaryObjects\"));\n+\t\t\t\t\t\tac.fetchPerunBeans(parms.readListPerunBeans(\"complementaryObjects\")));\n \t\t\t\t\treturn null;\n \t\t\t\t} else {\n-\t\t\t\t\tthrow new RpcException(RpcException.Type.MISSING_VALUE, \"list of complementary objects or complementary object\");\n+\t\t\t\t\tcz.metacentrum.perun.core.api.AuthzResolver.unsetRole(ac.getSession(),\n+\t\t\t\t\t\tac.getUserById(parms.readInt(\"user\")),\n+\t\t\t\t\t\tnull,\n+\t\t\t\t\t\troleName);\n+\t\t\t\t\treturn null;\n \t\t\t\t}\n \t\t\t} else if (parms.contains(\"users\")) {\n+\t\t\t\tint[] userIds = parms.readArrayOfInts(\"users\");\n+\t\t\t\tList<User> users = new ArrayList<>(userIds.length);\n+\t\t\t\tfor (int userId : userIds) {\n+\t\t\t\t\tusers.add(ac.getUserById(userId));\n+\t\t\t\t}\n \t\t\t\tif (parms.contains(\"complementaryObject\")) {\n-\t\t\t\t\tint[] userIds = parms.readArrayOfInts(\"users\");\n-\t\t\t\t\tList<User> users = new ArrayList<>(userIds.length);\n-\t\t\t\t\tfor (int userId : userIds) {\n-\t\t\t\t\t\tusers.add(ac.getUserById(userId));\n-\t\t\t\t\t}\n \t\t\t\t\tcz.metacentrum.perun.core.api.AuthzResolver.setRole(ac.getSession(),\n \t\t\t\t\t\t\t\tusers,\n \t\t\t\t\t\t\t\troleName,\n-\t\t\t\t\t\t\t\tparms.readPerunBean(\"complementaryObject\"));\n+\t\t\t\t\t\tac.fetchPerunBean(parms.readPerunBean(\"complementaryObject\")));\n \t\t\t\t\treturn null;\n \t\t\t\t} else {\n-\t\t\t\t\tthrow new RpcException(RpcException.Type.MISSING_VALUE, \"complementaryObject\");\n+\t\t\t\t\tcz.metacentrum.perun.core.api.AuthzResolver.unsetRole(ac.getSession(),\n+\t\t\t\t\t\tusers,\n+\t\t\t\t\t\troleName,\n+\t\t\t\t\t\tnull);\n+\t\t\t\t\treturn null;\n \t\t\t\t}\n \t\t\t} else if (parms.contains(\"authorizedGroups\")) {\n+\t\t\t\tint[] groupIds = parms.readArrayOfInts(\"authorizedGroups\");\n+\t\t\t\tList<Group> groups = new ArrayList<>(groupIds.length);\n+\t\t\t\tfor (int groupId : groupIds) {\n+\t\t\t\t\tgroups.add(ac.getGroupById(groupId));\n+\t\t\t\t}\n \t\t\t\tif (parms.contains(\"complementaryObject\")) {\n-\t\t\t\t\tint[] groupIds = parms.readArrayOfInts(\"authorizedGroups\");\n-\t\t\t\t\tList<Group> groups = new ArrayList<>(groupIds.length);\n-\t\t\t\t\tfor (int groupId : groupIds) {\n-\t\t\t\t\t\tgroups.add(ac.getGroupById(groupId));\n-\t\t\t\t\t}\n \t\t\t\t\tcz.metacentrum.perun.core.api.AuthzResolver.setRole(ac.getSession(),\n \t\t\t\t\t\t\t\tgroups,\n-\t\t\t\t\t\t\t\tparms.readPerunBean(\"complementaryObject\"),\n+\t\t\t\t\t\t\t\tac.fetchPerunBean(parms.readPerunBean(\"complementaryObject\")),\n \t\t\t\t\t\t\t\troleName);\n \t\t\t\t\treturn null;\n \t\t\t\t} else {\n-\t\t\t\t\tthrow new RpcException(RpcException.Type.MISSING_VALUE, \"complementaryObject\");\n+\t\t\t\t\tcz.metacentrum.perun.core.api.AuthzResolver.unsetRole(ac.getSession(),", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyODY4MTgzNA=="}, "originalCommit": {"oid": "b7075fd6b98d9044dd5b63852bad2986fa49a3eb"}, "originalPosition": 149}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzMxNTY0NDYzOnYy", "diffSide": "RIGHT", "path": "perun-rpc/src/main/java/cz/metacentrum/perun/rpc/methods/AuthzResolverMethod.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0yM1QxMjo1NTo0M1rOH4MQcQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0yM1QxMzowNjo0MlrOH4MpPA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyODY4MzEyMQ==", "bodyText": "This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters. Learn more about bidirectional Unicode characters\n\n\n  \n\n\n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            \t\t\t\t\tcz.metacentrum.perun.core.api.AuthzResolver.unsetRole(ac.getSession(),\n          \n          \n            \n            \t\t\t\t\tcz.metacentrum.perun.core.api.AuthzResolver.setRole(ac.getSession(),", "url": "https://github.com/CESNET/perun/pull/2993#discussion_r528683121", "createdAt": "2020-11-23T12:55:43Z", "author": {"login": "Vojtech-Sassmann"}, "path": "perun-rpc/src/main/java/cz/metacentrum/perun/rpc/methods/AuthzResolverMethod.java", "diffHunk": "@@ -279,63 +317,79 @@ public Void call(ApiCaller ac, Deserializer parms) throws PerunException {\n \t\t\t\tif(parms.contains(\"complementaryObject\")) {\n \t\t\t\t\tcz.metacentrum.perun.core.api.AuthzResolver.setRole(ac.getSession(),\n \t\t\t\t\t\t\t\tac.getUserById(parms.readInt(\"user\")),\n-\t\t\t\t\t\t\t\tparms.readPerunBean(\"complementaryObject\"),\n+\t\t\t\t\t\t\t\tac.fetchPerunBean(parms.readPerunBean(\"complementaryObject\")),\n \t\t\t\t\t\t\t\troleName);\n \t\t\t\t\treturn null;\n \t\t\t\t} else if(parms.contains(\"complementaryObjects\")) {\n \t\t\t\t\tcz.metacentrum.perun.core.api.AuthzResolver.setRole(ac.getSession(),\n \t\t\t\t\t\t\t\tac.getUserById(parms.readInt(\"user\")),\n \t\t\t\t\t\t\t\troleName,\n-\t\t\t\t\t\t\t\tparms.readListPerunBeans(\"complementaryObjects\"));\n+\t\t\t\t\t\tac.fetchPerunBeans(parms.readListPerunBeans(\"complementaryObjects\")));\n \t\t\t\t\treturn null;\n \t\t\t\t} else {\n-\t\t\t\t\tthrow new RpcException(RpcException.Type.MISSING_VALUE, \"list of complementary objects or complementary object\");\n+\t\t\t\t\tcz.metacentrum.perun.core.api.AuthzResolver.unsetRole(ac.getSession(),\n+\t\t\t\t\t\tac.getUserById(parms.readInt(\"user\")),\n+\t\t\t\t\t\tnull,\n+\t\t\t\t\t\troleName);\n+\t\t\t\t\treturn null;\n \t\t\t\t}\n \t\t\t} else if (parms.contains(\"users\")) {\n+\t\t\t\tint[] userIds = parms.readArrayOfInts(\"users\");\n+\t\t\t\tList<User> users = new ArrayList<>(userIds.length);\n+\t\t\t\tfor (int userId : userIds) {\n+\t\t\t\t\tusers.add(ac.getUserById(userId));\n+\t\t\t\t}\n \t\t\t\tif (parms.contains(\"complementaryObject\")) {\n-\t\t\t\t\tint[] userIds = parms.readArrayOfInts(\"users\");\n-\t\t\t\t\tList<User> users = new ArrayList<>(userIds.length);\n-\t\t\t\t\tfor (int userId : userIds) {\n-\t\t\t\t\t\tusers.add(ac.getUserById(userId));\n-\t\t\t\t\t}\n \t\t\t\t\tcz.metacentrum.perun.core.api.AuthzResolver.setRole(ac.getSession(),\n \t\t\t\t\t\t\t\tusers,\n \t\t\t\t\t\t\t\troleName,\n-\t\t\t\t\t\t\t\tparms.readPerunBean(\"complementaryObject\"));\n+\t\t\t\t\t\tac.fetchPerunBean(parms.readPerunBean(\"complementaryObject\")));\n \t\t\t\t\treturn null;\n \t\t\t\t} else {\n-\t\t\t\t\tthrow new RpcException(RpcException.Type.MISSING_VALUE, \"complementaryObject\");\n+\t\t\t\t\tcz.metacentrum.perun.core.api.AuthzResolver.unsetRole(ac.getSession(),\n+\t\t\t\t\t\tusers,\n+\t\t\t\t\t\troleName,\n+\t\t\t\t\t\tnull);\n+\t\t\t\t\treturn null;\n \t\t\t\t}\n \t\t\t} else if (parms.contains(\"authorizedGroups\")) {\n+\t\t\t\tint[] groupIds = parms.readArrayOfInts(\"authorizedGroups\");\n+\t\t\t\tList<Group> groups = new ArrayList<>(groupIds.length);\n+\t\t\t\tfor (int groupId : groupIds) {\n+\t\t\t\t\tgroups.add(ac.getGroupById(groupId));\n+\t\t\t\t}\n \t\t\t\tif (parms.contains(\"complementaryObject\")) {\n-\t\t\t\t\tint[] groupIds = parms.readArrayOfInts(\"authorizedGroups\");\n-\t\t\t\t\tList<Group> groups = new ArrayList<>(groupIds.length);\n-\t\t\t\t\tfor (int groupId : groupIds) {\n-\t\t\t\t\t\tgroups.add(ac.getGroupById(groupId));\n-\t\t\t\t\t}\n \t\t\t\t\tcz.metacentrum.perun.core.api.AuthzResolver.setRole(ac.getSession(),\n \t\t\t\t\t\t\t\tgroups,\n-\t\t\t\t\t\t\t\tparms.readPerunBean(\"complementaryObject\"),\n+\t\t\t\t\t\t\t\tac.fetchPerunBean(parms.readPerunBean(\"complementaryObject\")),\n \t\t\t\t\t\t\t\troleName);\n \t\t\t\t\treturn null;\n \t\t\t\t} else {\n-\t\t\t\t\tthrow new RpcException(RpcException.Type.MISSING_VALUE, \"complementaryObject\");\n+\t\t\t\t\tcz.metacentrum.perun.core.api.AuthzResolver.unsetRole(ac.getSession(),\n+\t\t\t\t\t\tgroups,\n+\t\t\t\t\t\tnull,\n+\t\t\t\t\t\troleName);\n+\t\t\t\t\treturn null;\n \t\t\t\t}\n \t\t\t} else if(parms.contains(\"authorizedGroup\")) {\n \t\t\t\tif(parms.contains(\"complementaryObject\")) {\n \t\t\t\t\tcz.metacentrum.perun.core.api.AuthzResolver.setRole(ac.getSession(),\n \t\t\t\t\t\t\t\tac.getGroupById(parms.readInt(\"authorizedGroup\")),\n-\t\t\t\t\t\t\t\tparms.readPerunBean(\"complementaryObject\"),\n+\t\t\t\t\t\t\t\tac.fetchPerunBean(parms.readPerunBean(\"complementaryObject\")),\n \t\t\t\t\t\t\t\troleName);\n \t\t\t\t\treturn null;\n \t\t\t\t} else if(parms.contains(\"complementaryObjects\")) {\n \t\t\t\t\tcz.metacentrum.perun.core.api.AuthzResolver.setRole(ac.getSession(),\n \t\t\t\t\t\t\t\tac.getGroupById(parms.readInt(\"authorizedGroup\")),\n \t\t\t\t\t\t\t\troleName,\n-\t\t\t\t\t\t\t\tparms.readListPerunBeans(\"complementaryObjects\"));\n+\t\t\t\t\t\t\t\tac.fetchPerunBeans(parms.readListPerunBeans(\"complementaryObjects\")));\n \t\t\t\t\treturn null;\n \t\t\t\t} else {\n-\t\t\t\t\tthrow new RpcException(RpcException.Type.MISSING_VALUE, \"list of complementary objects or complementary object\");\n+\t\t\t\t\tcz.metacentrum.perun.core.api.AuthzResolver.unsetRole(ac.getSession(),", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b7075fd6b98d9044dd5b63852bad2986fa49a3eb"}, "originalPosition": 172}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyODY4OTQ2OA==", "bodyText": "Fixed", "url": "https://github.com/CESNET/perun/pull/2993#discussion_r528689468", "createdAt": "2020-11-23T13:06:42Z", "author": {"login": "balcirakpeter"}, "path": "perun-rpc/src/main/java/cz/metacentrum/perun/rpc/methods/AuthzResolverMethod.java", "diffHunk": "@@ -279,63 +317,79 @@ public Void call(ApiCaller ac, Deserializer parms) throws PerunException {\n \t\t\t\tif(parms.contains(\"complementaryObject\")) {\n \t\t\t\t\tcz.metacentrum.perun.core.api.AuthzResolver.setRole(ac.getSession(),\n \t\t\t\t\t\t\t\tac.getUserById(parms.readInt(\"user\")),\n-\t\t\t\t\t\t\t\tparms.readPerunBean(\"complementaryObject\"),\n+\t\t\t\t\t\t\t\tac.fetchPerunBean(parms.readPerunBean(\"complementaryObject\")),\n \t\t\t\t\t\t\t\troleName);\n \t\t\t\t\treturn null;\n \t\t\t\t} else if(parms.contains(\"complementaryObjects\")) {\n \t\t\t\t\tcz.metacentrum.perun.core.api.AuthzResolver.setRole(ac.getSession(),\n \t\t\t\t\t\t\t\tac.getUserById(parms.readInt(\"user\")),\n \t\t\t\t\t\t\t\troleName,\n-\t\t\t\t\t\t\t\tparms.readListPerunBeans(\"complementaryObjects\"));\n+\t\t\t\t\t\tac.fetchPerunBeans(parms.readListPerunBeans(\"complementaryObjects\")));\n \t\t\t\t\treturn null;\n \t\t\t\t} else {\n-\t\t\t\t\tthrow new RpcException(RpcException.Type.MISSING_VALUE, \"list of complementary objects or complementary object\");\n+\t\t\t\t\tcz.metacentrum.perun.core.api.AuthzResolver.unsetRole(ac.getSession(),\n+\t\t\t\t\t\tac.getUserById(parms.readInt(\"user\")),\n+\t\t\t\t\t\tnull,\n+\t\t\t\t\t\troleName);\n+\t\t\t\t\treturn null;\n \t\t\t\t}\n \t\t\t} else if (parms.contains(\"users\")) {\n+\t\t\t\tint[] userIds = parms.readArrayOfInts(\"users\");\n+\t\t\t\tList<User> users = new ArrayList<>(userIds.length);\n+\t\t\t\tfor (int userId : userIds) {\n+\t\t\t\t\tusers.add(ac.getUserById(userId));\n+\t\t\t\t}\n \t\t\t\tif (parms.contains(\"complementaryObject\")) {\n-\t\t\t\t\tint[] userIds = parms.readArrayOfInts(\"users\");\n-\t\t\t\t\tList<User> users = new ArrayList<>(userIds.length);\n-\t\t\t\t\tfor (int userId : userIds) {\n-\t\t\t\t\t\tusers.add(ac.getUserById(userId));\n-\t\t\t\t\t}\n \t\t\t\t\tcz.metacentrum.perun.core.api.AuthzResolver.setRole(ac.getSession(),\n \t\t\t\t\t\t\t\tusers,\n \t\t\t\t\t\t\t\troleName,\n-\t\t\t\t\t\t\t\tparms.readPerunBean(\"complementaryObject\"));\n+\t\t\t\t\t\tac.fetchPerunBean(parms.readPerunBean(\"complementaryObject\")));\n \t\t\t\t\treturn null;\n \t\t\t\t} else {\n-\t\t\t\t\tthrow new RpcException(RpcException.Type.MISSING_VALUE, \"complementaryObject\");\n+\t\t\t\t\tcz.metacentrum.perun.core.api.AuthzResolver.unsetRole(ac.getSession(),\n+\t\t\t\t\t\tusers,\n+\t\t\t\t\t\troleName,\n+\t\t\t\t\t\tnull);\n+\t\t\t\t\treturn null;\n \t\t\t\t}\n \t\t\t} else if (parms.contains(\"authorizedGroups\")) {\n+\t\t\t\tint[] groupIds = parms.readArrayOfInts(\"authorizedGroups\");\n+\t\t\t\tList<Group> groups = new ArrayList<>(groupIds.length);\n+\t\t\t\tfor (int groupId : groupIds) {\n+\t\t\t\t\tgroups.add(ac.getGroupById(groupId));\n+\t\t\t\t}\n \t\t\t\tif (parms.contains(\"complementaryObject\")) {\n-\t\t\t\t\tint[] groupIds = parms.readArrayOfInts(\"authorizedGroups\");\n-\t\t\t\t\tList<Group> groups = new ArrayList<>(groupIds.length);\n-\t\t\t\t\tfor (int groupId : groupIds) {\n-\t\t\t\t\t\tgroups.add(ac.getGroupById(groupId));\n-\t\t\t\t\t}\n \t\t\t\t\tcz.metacentrum.perun.core.api.AuthzResolver.setRole(ac.getSession(),\n \t\t\t\t\t\t\t\tgroups,\n-\t\t\t\t\t\t\t\tparms.readPerunBean(\"complementaryObject\"),\n+\t\t\t\t\t\t\t\tac.fetchPerunBean(parms.readPerunBean(\"complementaryObject\")),\n \t\t\t\t\t\t\t\troleName);\n \t\t\t\t\treturn null;\n \t\t\t\t} else {\n-\t\t\t\t\tthrow new RpcException(RpcException.Type.MISSING_VALUE, \"complementaryObject\");\n+\t\t\t\t\tcz.metacentrum.perun.core.api.AuthzResolver.unsetRole(ac.getSession(),\n+\t\t\t\t\t\tgroups,\n+\t\t\t\t\t\tnull,\n+\t\t\t\t\t\troleName);\n+\t\t\t\t\treturn null;\n \t\t\t\t}\n \t\t\t} else if(parms.contains(\"authorizedGroup\")) {\n \t\t\t\tif(parms.contains(\"complementaryObject\")) {\n \t\t\t\t\tcz.metacentrum.perun.core.api.AuthzResolver.setRole(ac.getSession(),\n \t\t\t\t\t\t\t\tac.getGroupById(parms.readInt(\"authorizedGroup\")),\n-\t\t\t\t\t\t\t\tparms.readPerunBean(\"complementaryObject\"),\n+\t\t\t\t\t\t\t\tac.fetchPerunBean(parms.readPerunBean(\"complementaryObject\")),\n \t\t\t\t\t\t\t\troleName);\n \t\t\t\t\treturn null;\n \t\t\t\t} else if(parms.contains(\"complementaryObjects\")) {\n \t\t\t\t\tcz.metacentrum.perun.core.api.AuthzResolver.setRole(ac.getSession(),\n \t\t\t\t\t\t\t\tac.getGroupById(parms.readInt(\"authorizedGroup\")),\n \t\t\t\t\t\t\t\troleName,\n-\t\t\t\t\t\t\t\tparms.readListPerunBeans(\"complementaryObjects\"));\n+\t\t\t\t\t\t\t\tac.fetchPerunBeans(parms.readListPerunBeans(\"complementaryObjects\")));\n \t\t\t\t\treturn null;\n \t\t\t\t} else {\n-\t\t\t\t\tthrow new RpcException(RpcException.Type.MISSING_VALUE, \"list of complementary objects or complementary object\");\n+\t\t\t\t\tcz.metacentrum.perun.core.api.AuthzResolver.unsetRole(ac.getSession(),", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyODY4MzEyMQ=="}, "originalCommit": {"oid": "b7075fd6b98d9044dd5b63852bad2986fa49a3eb"}, "originalPosition": 172}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2173, "cost": 1, "resetAt": "2021-11-12T18:49:56Z"}}}