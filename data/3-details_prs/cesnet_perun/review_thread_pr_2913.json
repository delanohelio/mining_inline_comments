{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDk0NzcyNzMz", "number": 2913, "reviewThreads": {"totalCount": 8, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wMVQwNjoyNTowOFrOEpVKSA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wOFQwODo0OToxN1rOErgtfQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzExNzczNzY4OnYy", "diffSide": "RIGHT", "path": "perun-core/src/main/java/cz/metacentrum/perun/core/bl/MembersManagerBl.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wMVQwNjoyNTowOFrOHa8CqA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wNlQxMTozNjozN1rOHdCFmQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5ODAwODc0NA==", "bodyText": "We already have this method in the UsersManagerBl. Please use it instead of the new implementation in MembersManagerBl.", "url": "https://github.com/CESNET/perun/pull/2913#discussion_r498008744", "createdAt": "2020-10-01T06:25:08Z", "author": {"login": "zlamalp"}, "path": "perun-core/src/main/java/cz/metacentrum/perun/core/bl/MembersManagerBl.java", "diffHunk": "@@ -895,6 +896,15 @@\n \t */\n \tList<RichMember> convertMembersToRichMembers(PerunSession sess, List<Member> members);\n \n+\t/**\n+\t * Converts users to rich users.\n+\t *\n+\t * @param sess\n+\t * @param users\n+\t * @return\n+\t */\n+\tList<RichUser> convertUsersToRichUsers(PerunSession sess, List<User> users);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "87885dd0cd587f73ddf275f209f041fff3f8a3b1"}, "originalPosition": 19}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMDIwNDk1Mw==", "bodyText": "I deleted my new method and I used this method from UserManagerBl", "url": "https://github.com/CESNET/perun/pull/2913#discussion_r500204953", "createdAt": "2020-10-06T11:36:37Z", "author": {"login": "HejdaJakub"}, "path": "perun-core/src/main/java/cz/metacentrum/perun/core/bl/MembersManagerBl.java", "diffHunk": "@@ -895,6 +896,15 @@\n \t */\n \tList<RichMember> convertMembersToRichMembers(PerunSession sess, List<Member> members);\n \n+\t/**\n+\t * Converts users to rich users.\n+\t *\n+\t * @param sess\n+\t * @param users\n+\t * @return\n+\t */\n+\tList<RichUser> convertUsersToRichUsers(PerunSession sess, List<User> users);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5ODAwODc0NA=="}, "originalCommit": {"oid": "87885dd0cd587f73ddf275f209f041fff3f8a3b1"}, "originalPosition": 19}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzExNzc0OTEwOnYy", "diffSide": "RIGHT", "path": "perun-core/src/main/java/cz/metacentrum/perun/core/blImpl/MembersManagerBlImpl.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wMVQwNjoyOTo1NlrOHa8JeQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wNlQxMTo0MjoyMVrOHdCRxg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5ODAxMDQ4OQ==", "bodyText": "How about simplifying it\nfor (Member sponsoredMember : sponsoredMembers) {\n\tsponsoredMembersAndTheirSponsors.put(sponsoredMember, getPerunBl().getUsersManagerBl().convertUsersToRichUsers(sess, getPerunBl().getUsersManagerBl().getSponsors(sess, sponsoredMember)));\n}", "url": "https://github.com/CESNET/perun/pull/2913#discussion_r498010489", "createdAt": "2020-10-01T06:29:56Z", "author": {"login": "zlamalp"}, "path": "perun-core/src/main/java/cz/metacentrum/perun/core/blImpl/MembersManagerBlImpl.java", "diffHunk": "@@ -2331,6 +2353,19 @@ public Member sponsorMember(PerunSession session, Member sponsoredMember, User s\n \t\treturn getMembersManagerImpl().getSponsoredMembers(sess, vo);\n \t}\n \n+\t@Override\n+\tpublic Map<Member, List<RichUser>> getSponsoredMembersAndTheirSponsors(PerunSession sess, Vo vo) {\n+\t\tMap<Member, List<RichUser>> sponsoredMembersAndTheirSponsors = new HashMap<>();\n+\t\tList<Member> sponsoredMembers = getSponsoredMembers(sess, vo);\n+\t\tList<User> sponsors;\n+\t\tfor (Member sponsoredMember : sponsoredMembers) {\n+\t\t\tsponsors = getPerunBl().getUsersManagerBl().getSponsors(sess, sponsoredMember);\n+\t\t\tsponsoredMembersAndTheirSponsors.put(sponsoredMember, convertUsersToRichUsers(sess, sponsors));\n+\t\t\tsponsors.clear();\n+\t\t}", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "87885dd0cd587f73ddf275f209f041fff3f8a3b1"}, "originalPosition": 49}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMDIwODA3MA==", "bodyText": "We decided to implemet it only in entry layer, so I changed it little bit more. I also simplified it by using stream.", "url": "https://github.com/CESNET/perun/pull/2913#discussion_r500208070", "createdAt": "2020-10-06T11:42:21Z", "author": {"login": "HejdaJakub"}, "path": "perun-core/src/main/java/cz/metacentrum/perun/core/blImpl/MembersManagerBlImpl.java", "diffHunk": "@@ -2331,6 +2353,19 @@ public Member sponsorMember(PerunSession session, Member sponsoredMember, User s\n \t\treturn getMembersManagerImpl().getSponsoredMembers(sess, vo);\n \t}\n \n+\t@Override\n+\tpublic Map<Member, List<RichUser>> getSponsoredMembersAndTheirSponsors(PerunSession sess, Vo vo) {\n+\t\tMap<Member, List<RichUser>> sponsoredMembersAndTheirSponsors = new HashMap<>();\n+\t\tList<Member> sponsoredMembers = getSponsoredMembers(sess, vo);\n+\t\tList<User> sponsors;\n+\t\tfor (Member sponsoredMember : sponsoredMembers) {\n+\t\t\tsponsors = getPerunBl().getUsersManagerBl().getSponsors(sess, sponsoredMember);\n+\t\t\tsponsoredMembersAndTheirSponsors.put(sponsoredMember, convertUsersToRichUsers(sess, sponsors));\n+\t\t\tsponsors.clear();\n+\t\t}", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5ODAxMDQ4OQ=="}, "originalCommit": {"oid": "87885dd0cd587f73ddf275f209f041fff3f8a3b1"}, "originalPosition": 49}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzExNzc2NzkyOnYy", "diffSide": "RIGHT", "path": "perun-openapi/openapi.yml", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wMVQwNjozNzozMFrOHa8UgA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wNlQxMTo0Njo0MVrOHdCanA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5ODAxMzMxMg==", "bodyText": "I don't think that this will work since the returned json doesn't contains properties \"member\" and \"sponsors\", but is plain object, where keys are the member objects and their values are plain lists of sponsors. Maybe see the definition above or consult it with @martin-kuba.", "url": "https://github.com/CESNET/perun/pull/2913#discussion_r498013312", "createdAt": "2020-10-01T06:37:30Z", "author": {"login": "zlamalp"}, "path": "perun-openapi/openapi.yml", "diffHunk": "@@ -924,6 +924,14 @@ components:\n           items:\n             type: integer\n \n+    #Map<Member, List<RichUser>>\n+    MembersAndTheirSponsors:\n+      type: object\n+      properties:\n+        member: { $ref: '#/components/schemas/Member' }\n+        sponsors: { type: array, items: { $ref: '#/components/schemas/RichUser' }}", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "87885dd0cd587f73ddf275f209f041fff3f8a3b1"}, "originalPosition": 9}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMDIxMDMzMg==", "bodyText": "I created new class MemberWithSponsors and I used it as returned object so I completely changed openapi specification, too.", "url": "https://github.com/CESNET/perun/pull/2913#discussion_r500210332", "createdAt": "2020-10-06T11:46:41Z", "author": {"login": "HejdaJakub"}, "path": "perun-openapi/openapi.yml", "diffHunk": "@@ -924,6 +924,14 @@ components:\n           items:\n             type: integer\n \n+    #Map<Member, List<RichUser>>\n+    MembersAndTheirSponsors:\n+      type: object\n+      properties:\n+        member: { $ref: '#/components/schemas/Member' }\n+        sponsors: { type: array, items: { $ref: '#/components/schemas/RichUser' }}", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5ODAxMzMxMg=="}, "originalCommit": {"oid": "87885dd0cd587f73ddf275f209f041fff3f8a3b1"}, "originalPosition": 9}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzExNzc3MTAwOnYy", "diffSide": "RIGHT", "path": "perun-rpc/src/main/java/cz/metacentrum/perun/rpc/methods/MembersManagerMethod.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wMVQwNjozODo0N1rOHa8WVw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wNlQxMTo0ODo0NlrOHdCe1A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5ODAxMzc4Mw==", "bodyText": "We do not usually specify PrivilegeException in the RPC docs, since its added automatically by the docs parsing tool.", "url": "https://github.com/CESNET/perun/pull/2913#discussion_r498013783", "createdAt": "2020-10-01T06:38:47Z", "author": {"login": "zlamalp"}, "path": "perun-rpc/src/main/java/cz/metacentrum/perun/rpc/methods/MembersManagerMethod.java", "diffHunk": "@@ -290,6 +292,23 @@ public String call(ApiCaller ac, Deserializer params) throws PerunException {\n \t\t}\n \t},\n \n+\t/*#\n+\t * Gets map of sponsored members and lists of their sponsors for each of them.\n+\t *\n+\t * @param vo int id of virtual organization from which are the sponsored members chosen\n+\t * @throw VoNotExistsException if given VO does not exist\n+\t * @throw PrivilegeException if not VOADMIN, VOOBSERVER, PERUNOBSERVER or SPONSOR", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "87885dd0cd587f73ddf275f209f041fff3f8a3b1"}, "originalPosition": 19}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMDIxMTQxMg==", "bodyText": "I deleted this PrivilegeException from the RPC.", "url": "https://github.com/CESNET/perun/pull/2913#discussion_r500211412", "createdAt": "2020-10-06T11:48:46Z", "author": {"login": "HejdaJakub"}, "path": "perun-rpc/src/main/java/cz/metacentrum/perun/rpc/methods/MembersManagerMethod.java", "diffHunk": "@@ -290,6 +292,23 @@ public String call(ApiCaller ac, Deserializer params) throws PerunException {\n \t\t}\n \t},\n \n+\t/*#\n+\t * Gets map of sponsored members and lists of their sponsors for each of them.\n+\t *\n+\t * @param vo int id of virtual organization from which are the sponsored members chosen\n+\t * @throw VoNotExistsException if given VO does not exist\n+\t * @throw PrivilegeException if not VOADMIN, VOOBSERVER, PERUNOBSERVER or SPONSOR", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5ODAxMzc4Mw=="}, "originalCommit": {"oid": "87885dd0cd587f73ddf275f209f041fff3f8a3b1"}, "originalPosition": 19}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzEzNjkwNzc4OnYy", "diffSide": "RIGHT", "path": "perun-base/src/main/java/cz/metacentrum/perun/core/api/MemberWithSponsors.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wN1QxMjozOTo0N1rOHdxRWQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wN1QxMzoyMzowNFrOHdzFiw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMDk3ODAwOQ==", "bodyText": "This should be just getSponsors() since it is a basic getter/setter for property List<User> sponsors.", "url": "https://github.com/CESNET/perun/pull/2913#discussion_r500978009", "createdAt": "2020-10-07T12:39:47Z", "author": {"login": "zlamalp"}, "path": "perun-base/src/main/java/cz/metacentrum/perun/core/api/MemberWithSponsors.java", "diffHunk": "@@ -0,0 +1,56 @@\n+package cz.metacentrum.perun.core.api;\n+\n+import java.util.List;\n+import java.util.Objects;\n+\n+/**\n+ * Sponsored member with list of his sponsors (for GUI)\n+ *\n+ * @author Jakub Hejda <Jakub.Hejda@cesnet.cz>\n+ */\n+public class MemberWithSponsors {\n+\tprivate RichMember member;\n+\tprivate List<User> sponsors;\n+\n+\t/**\n+\t * Constructor\n+\t */\n+\tpublic MemberWithSponsors() {\n+\t}\n+\n+\t/**\n+\t * Constructor\n+\t */\n+\tpublic MemberWithSponsors(RichMember member) {\n+\t\tthis.member = member;\n+\t}\n+\n+\tpublic Member getMember() {\n+\t\treturn member;\n+\t}\n+\n+\tpublic void setMember(RichMember member) {\n+\t\tthis.member = member;\n+\t}\n+\n+\tpublic List<User> getListOfSponsors() {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "4a2f3a2edf238fc464e42fb4f82a0e794240e955"}, "originalPosition": 36}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMTAwNzc1NQ==", "bodyText": "Changed.", "url": "https://github.com/CESNET/perun/pull/2913#discussion_r501007755", "createdAt": "2020-10-07T13:23:04Z", "author": {"login": "HejdaJakub"}, "path": "perun-base/src/main/java/cz/metacentrum/perun/core/api/MemberWithSponsors.java", "diffHunk": "@@ -0,0 +1,56 @@\n+package cz.metacentrum.perun.core.api;\n+\n+import java.util.List;\n+import java.util.Objects;\n+\n+/**\n+ * Sponsored member with list of his sponsors (for GUI)\n+ *\n+ * @author Jakub Hejda <Jakub.Hejda@cesnet.cz>\n+ */\n+public class MemberWithSponsors {\n+\tprivate RichMember member;\n+\tprivate List<User> sponsors;\n+\n+\t/**\n+\t * Constructor\n+\t */\n+\tpublic MemberWithSponsors() {\n+\t}\n+\n+\t/**\n+\t * Constructor\n+\t */\n+\tpublic MemberWithSponsors(RichMember member) {\n+\t\tthis.member = member;\n+\t}\n+\n+\tpublic Member getMember() {\n+\t\treturn member;\n+\t}\n+\n+\tpublic void setMember(RichMember member) {\n+\t\tthis.member = member;\n+\t}\n+\n+\tpublic List<User> getListOfSponsors() {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMDk3ODAwOQ=="}, "originalCommit": {"oid": "4a2f3a2edf238fc464e42fb4f82a0e794240e955"}, "originalPosition": 36}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzEzNjkxMDc3OnYy", "diffSide": "RIGHT", "path": "perun-core/src/main/java/cz/metacentrum/perun/core/api/MembersManager.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wN1QxMjo0MDoyNFrOHdxTGA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wN1QxMzoyNDoxN1rOHdzI_Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMDk3ODQ1Ng==", "bodyText": "Please add attrNames param to the javadoc.", "url": "https://github.com/CESNET/perun/pull/2913#discussion_r500978456", "createdAt": "2020-10-07T12:40:24Z", "author": {"login": "zlamalp"}, "path": "perun-core/src/main/java/cz/metacentrum/perun/core/api/MembersManager.java", "diffHunk": "@@ -1271,6 +1271,17 @@\n \t */\n \tList<RichMember> getSponsoredMembers(PerunSession sess, Vo vo) throws PrivilegeException, VoNotExistsException;\n \n+\t/**\n+\t * Gets list of sponsored members with sponsors.\n+\t *\n+\t * @param sess session\n+\t * @param vo virtual organization from which are the sponsored members chosen", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "4a2f3a2edf238fc464e42fb4f82a0e794240e955"}, "originalPosition": 8}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMTAwODYzNw==", "bodyText": "I added this param to javadoc.", "url": "https://github.com/CESNET/perun/pull/2913#discussion_r501008637", "createdAt": "2020-10-07T13:24:17Z", "author": {"login": "HejdaJakub"}, "path": "perun-core/src/main/java/cz/metacentrum/perun/core/api/MembersManager.java", "diffHunk": "@@ -1271,6 +1271,17 @@\n \t */\n \tList<RichMember> getSponsoredMembers(PerunSession sess, Vo vo) throws PrivilegeException, VoNotExistsException;\n \n+\t/**\n+\t * Gets list of sponsored members with sponsors.\n+\t *\n+\t * @param sess session\n+\t * @param vo virtual organization from which are the sponsored members chosen", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMDk3ODQ1Ng=="}, "originalCommit": {"oid": "4a2f3a2edf238fc464e42fb4f82a0e794240e955"}, "originalPosition": 8}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzEzNjk0MzQ1OnYy", "diffSide": "RIGHT", "path": "perun-core/src/main/java/cz/metacentrum/perun/core/entry/MembersManagerEntry.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wN1QxMjo0ODowN1rOHdxnEw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wN1QxMzoyNjozNVrOHdzQHA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMDk4MzU3MQ==", "bodyText": "You should also filter only allowed attributes based on the caller authorization, see membersManagerBl.filterOnlyAllowedAttributes(sess, richMembers, null, true);", "url": "https://github.com/CESNET/perun/pull/2913#discussion_r500983571", "createdAt": "2020-10-07T12:48:07Z", "author": {"login": "zlamalp"}, "path": "perun-core/src/main/java/cz/metacentrum/perun/core/entry/MembersManagerEntry.java", "diffHunk": "@@ -1341,6 +1341,29 @@ public RichMember sponsorMember(PerunSession session, Member sponsored, User spo\n \t\treturn membersManagerBl.convertMembersToRichMembers(sess, membersManagerBl.getSponsoredMembers(sess, vo));\n \t}\n \n+\t@Override\n+\tpublic List<MemberWithSponsors> getSponsoredMembersAndTheirSponsors(PerunSession sess, Vo vo, List<String> attrNames) throws VoNotExistsException, PrivilegeException, AttributeNotExistsException {\n+\t\tUtils.checkPerunSession(sess);\n+\t\tUtils.notNull(vo, \"vo\");\n+\n+\t\tperunBl.getVosManagerBl().checkVoExists(sess, vo);\n+\n+\t\t//Authorization\n+\t\tif(!AuthzResolver.authorizedInternal(sess, \"getSponsoredMembersAndTheirSponsors_Vo_policy\", vo)) {\n+\t\t\tthrow new PrivilegeException(sess, \"getSponsoredMembersAndTheirSponsors\");\n+\t\t}\n+\n+\t\tList<AttributeDefinition> attrsDef = new ArrayList<>();\n+\t\tfor (String attrName : attrNames) {\n+\t\t\tattrsDef.add(getPerunBl().getAttributesManagerBl().getAttributeDefinition(sess, attrName));\n+\t\t}\n+\n+\t\treturn membersManagerBl.convertMembersToRichMembersWithAttributes(sess, getSponsoredMembers(sess, vo), attrsDef).stream()", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "4a2f3a2edf238fc464e42fb4f82a0e794240e955"}, "originalPosition": 47}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMTAxMDQ2MA==", "bodyText": "I added this filter to the method.", "url": "https://github.com/CESNET/perun/pull/2913#discussion_r501010460", "createdAt": "2020-10-07T13:26:35Z", "author": {"login": "HejdaJakub"}, "path": "perun-core/src/main/java/cz/metacentrum/perun/core/entry/MembersManagerEntry.java", "diffHunk": "@@ -1341,6 +1341,29 @@ public RichMember sponsorMember(PerunSession session, Member sponsored, User spo\n \t\treturn membersManagerBl.convertMembersToRichMembers(sess, membersManagerBl.getSponsoredMembers(sess, vo));\n \t}\n \n+\t@Override\n+\tpublic List<MemberWithSponsors> getSponsoredMembersAndTheirSponsors(PerunSession sess, Vo vo, List<String> attrNames) throws VoNotExistsException, PrivilegeException, AttributeNotExistsException {\n+\t\tUtils.checkPerunSession(sess);\n+\t\tUtils.notNull(vo, \"vo\");\n+\n+\t\tperunBl.getVosManagerBl().checkVoExists(sess, vo);\n+\n+\t\t//Authorization\n+\t\tif(!AuthzResolver.authorizedInternal(sess, \"getSponsoredMembersAndTheirSponsors_Vo_policy\", vo)) {\n+\t\t\tthrow new PrivilegeException(sess, \"getSponsoredMembersAndTheirSponsors\");\n+\t\t}\n+\n+\t\tList<AttributeDefinition> attrsDef = new ArrayList<>();\n+\t\tfor (String attrName : attrNames) {\n+\t\t\tattrsDef.add(getPerunBl().getAttributesManagerBl().getAttributeDefinition(sess, attrName));\n+\t\t}\n+\n+\t\treturn membersManagerBl.convertMembersToRichMembersWithAttributes(sess, getSponsoredMembers(sess, vo), attrsDef).stream()", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMDk4MzU3MQ=="}, "originalCommit": {"oid": "4a2f3a2edf238fc464e42fb4f82a0e794240e955"}, "originalPosition": 47}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzE0MDYwMTU3OnYy", "diffSide": "RIGHT", "path": "perun-core/src/main/java/cz/metacentrum/perun/core/entry/MembersManagerEntry.java", "isResolved": false, "comments": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wOFQwODo0OToxN1rOHeUTlA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wOFQxMTowNDo1NVrOHeZU2A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMTU1MjAyMA==", "bodyText": "Is there any reason why do you call this version of the method instead of this one?\n\n  \n    \n  \n    \n\n  \n  This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters. Learn more about bidirectional Unicode characters\n\n\n  \n\n\n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            \t\trichMembers = membersManagerBl.filterOnlyAllowedAttributes(sess, richMembers, null, true);\n          \n          \n            \n            \t\trichMembers = membersManagerBl.filterOnlyAllowedAttributes(sess, richMembers);", "url": "https://github.com/CESNET/perun/pull/2913#discussion_r501552020", "createdAt": "2020-10-08T08:49:17Z", "author": {"login": "Vojtech-Sassmann"}, "path": "perun-core/src/main/java/cz/metacentrum/perun/core/entry/MembersManagerEntry.java", "diffHunk": "@@ -1341,6 +1341,32 @@ public RichMember sponsorMember(PerunSession session, Member sponsored, User spo\n \t\treturn membersManagerBl.convertMembersToRichMembers(sess, membersManagerBl.getSponsoredMembers(sess, vo));\n \t}\n \n+\t@Override\n+\tpublic List<MemberWithSponsors> getSponsoredMembersAndTheirSponsors(PerunSession sess, Vo vo, List<String> attrNames) throws VoNotExistsException, PrivilegeException, AttributeNotExistsException {\n+\t\tUtils.checkPerunSession(sess);\n+\t\tUtils.notNull(vo, \"vo\");\n+\n+\t\tperunBl.getVosManagerBl().checkVoExists(sess, vo);\n+\n+\t\t//Authorization\n+\t\tif(!AuthzResolver.authorizedInternal(sess, \"getSponsoredMembersAndTheirSponsors_Vo_policy\", vo)) {\n+\t\t\tthrow new PrivilegeException(sess, \"getSponsoredMembersAndTheirSponsors\");\n+\t\t}\n+\n+\t\tList<AttributeDefinition> attrsDef = new ArrayList<>();\n+\t\tfor (String attrName : attrNames) {\n+\t\t\tattrsDef.add(getPerunBl().getAttributesManagerBl().getAttributeDefinition(sess, attrName));\n+\t\t}\n+\n+\t\tList<RichMember> richMembers = membersManagerBl.convertMembersToRichMembersWithAttributes(sess, getSponsoredMembers(sess, vo), attrsDef);\n+\t\trichMembers = membersManagerBl.filterOnlyAllowedAttributes(sess, richMembers, null, true);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f246ac5039af0df65cee37bf3f9ea5de536d9012"}, "originalPosition": 48}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMTU1Mzg3MA==", "bodyText": "@zlamalp why did you suggested this version of the method?", "url": "https://github.com/CESNET/perun/pull/2913#discussion_r501553870", "createdAt": "2020-10-08T08:52:07Z", "author": {"login": "Vojtech-Sassmann"}, "path": "perun-core/src/main/java/cz/metacentrum/perun/core/entry/MembersManagerEntry.java", "diffHunk": "@@ -1341,6 +1341,32 @@ public RichMember sponsorMember(PerunSession session, Member sponsored, User spo\n \t\treturn membersManagerBl.convertMembersToRichMembers(sess, membersManagerBl.getSponsoredMembers(sess, vo));\n \t}\n \n+\t@Override\n+\tpublic List<MemberWithSponsors> getSponsoredMembersAndTheirSponsors(PerunSession sess, Vo vo, List<String> attrNames) throws VoNotExistsException, PrivilegeException, AttributeNotExistsException {\n+\t\tUtils.checkPerunSession(sess);\n+\t\tUtils.notNull(vo, \"vo\");\n+\n+\t\tperunBl.getVosManagerBl().checkVoExists(sess, vo);\n+\n+\t\t//Authorization\n+\t\tif(!AuthzResolver.authorizedInternal(sess, \"getSponsoredMembersAndTheirSponsors_Vo_policy\", vo)) {\n+\t\t\tthrow new PrivilegeException(sess, \"getSponsoredMembersAndTheirSponsors\");\n+\t\t}\n+\n+\t\tList<AttributeDefinition> attrsDef = new ArrayList<>();\n+\t\tfor (String attrName : attrNames) {\n+\t\t\tattrsDef.add(getPerunBl().getAttributesManagerBl().getAttributeDefinition(sess, attrName));\n+\t\t}\n+\n+\t\tList<RichMember> richMembers = membersManagerBl.convertMembersToRichMembersWithAttributes(sess, getSponsoredMembers(sess, vo), attrsDef);\n+\t\trichMembers = membersManagerBl.filterOnlyAllowedAttributes(sess, richMembers, null, true);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMTU1MjAyMA=="}, "originalCommit": {"oid": "f246ac5039af0df65cee37bf3f9ea5de536d9012"}, "originalPosition": 48}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMTU4OTIxNQ==", "bodyText": "Well, there is no reason to resolve attribute authorization for each RichMember, if you can be sure, they are from the same VO and with the same set of attributes. Hence you can use \"context=true\" and authorization is resolved only once and results are reused for the next member.", "url": "https://github.com/CESNET/perun/pull/2913#discussion_r501589215", "createdAt": "2020-10-08T09:47:39Z", "author": {"login": "zlamalp"}, "path": "perun-core/src/main/java/cz/metacentrum/perun/core/entry/MembersManagerEntry.java", "diffHunk": "@@ -1341,6 +1341,32 @@ public RichMember sponsorMember(PerunSession session, Member sponsored, User spo\n \t\treturn membersManagerBl.convertMembersToRichMembers(sess, membersManagerBl.getSponsoredMembers(sess, vo));\n \t}\n \n+\t@Override\n+\tpublic List<MemberWithSponsors> getSponsoredMembersAndTheirSponsors(PerunSession sess, Vo vo, List<String> attrNames) throws VoNotExistsException, PrivilegeException, AttributeNotExistsException {\n+\t\tUtils.checkPerunSession(sess);\n+\t\tUtils.notNull(vo, \"vo\");\n+\n+\t\tperunBl.getVosManagerBl().checkVoExists(sess, vo);\n+\n+\t\t//Authorization\n+\t\tif(!AuthzResolver.authorizedInternal(sess, \"getSponsoredMembersAndTheirSponsors_Vo_policy\", vo)) {\n+\t\t\tthrow new PrivilegeException(sess, \"getSponsoredMembersAndTheirSponsors\");\n+\t\t}\n+\n+\t\tList<AttributeDefinition> attrsDef = new ArrayList<>();\n+\t\tfor (String attrName : attrNames) {\n+\t\t\tattrsDef.add(getPerunBl().getAttributesManagerBl().getAttributeDefinition(sess, attrName));\n+\t\t}\n+\n+\t\tList<RichMember> richMembers = membersManagerBl.convertMembersToRichMembersWithAttributes(sess, getSponsoredMembers(sess, vo), attrsDef);\n+\t\trichMembers = membersManagerBl.filterOnlyAllowedAttributes(sess, richMembers, null, true);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMTU1MjAyMA=="}, "originalCommit": {"oid": "f246ac5039af0df65cee37bf3f9ea5de536d9012"}, "originalPosition": 48}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMTYzNDI2NA==", "bodyText": "Ok, I was just confused because of the group parameter.", "url": "https://github.com/CESNET/perun/pull/2913#discussion_r501634264", "createdAt": "2020-10-08T11:04:55Z", "author": {"login": "Vojtech-Sassmann"}, "path": "perun-core/src/main/java/cz/metacentrum/perun/core/entry/MembersManagerEntry.java", "diffHunk": "@@ -1341,6 +1341,32 @@ public RichMember sponsorMember(PerunSession session, Member sponsored, User spo\n \t\treturn membersManagerBl.convertMembersToRichMembers(sess, membersManagerBl.getSponsoredMembers(sess, vo));\n \t}\n \n+\t@Override\n+\tpublic List<MemberWithSponsors> getSponsoredMembersAndTheirSponsors(PerunSession sess, Vo vo, List<String> attrNames) throws VoNotExistsException, PrivilegeException, AttributeNotExistsException {\n+\t\tUtils.checkPerunSession(sess);\n+\t\tUtils.notNull(vo, \"vo\");\n+\n+\t\tperunBl.getVosManagerBl().checkVoExists(sess, vo);\n+\n+\t\t//Authorization\n+\t\tif(!AuthzResolver.authorizedInternal(sess, \"getSponsoredMembersAndTheirSponsors_Vo_policy\", vo)) {\n+\t\t\tthrow new PrivilegeException(sess, \"getSponsoredMembersAndTheirSponsors\");\n+\t\t}\n+\n+\t\tList<AttributeDefinition> attrsDef = new ArrayList<>();\n+\t\tfor (String attrName : attrNames) {\n+\t\t\tattrsDef.add(getPerunBl().getAttributesManagerBl().getAttributeDefinition(sess, attrName));\n+\t\t}\n+\n+\t\tList<RichMember> richMembers = membersManagerBl.convertMembersToRichMembersWithAttributes(sess, getSponsoredMembers(sess, vo), attrsDef);\n+\t\trichMembers = membersManagerBl.filterOnlyAllowedAttributes(sess, richMembers, null, true);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMTU1MjAyMA=="}, "originalCommit": {"oid": "f246ac5039af0df65cee37bf3f9ea5de536d9012"}, "originalPosition": 48}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2306, "cost": 1, "resetAt": "2021-11-12T18:49:56Z"}}}