{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDIwNTI0NTkz", "number": 123, "title": "Build separate artifacts for library using CPack", "bodyText": "Issue #, if available:\n#122\nDescription of changes:\nThis change uses CPack to generate separate RPM/DEB artifacts for the KNN JNI Library and adds the library as a dependency of the KNN Plugin.\nThe following steps will build the RPM and DEB packages in the jni/packages folder:\ncd jni\ncmake .\nmake package\n\n2 packages are generated:\n\nopendistro-knnlib-1.8.0.0-0.1_linux.x86_64.deb\nopendistro-knnlib-1.8.0.0-0.1_linux.x86_64.rpm\n\nAdditionally, I changed the directory layout of JNI to follow a more standard C++ convention. The JNI directory now looks like this:\nCMakeLists.txt\nexternal/nmslib\nsrc/com_amazon_opendistroforelasticsearch_knn_index_v1736_KNNIndex.cpp\nsrc/CMakeLists.txt\ninclude/com_amazon_opendistroforelasticsearch_knn_index_v1736_KNNIndex.h\nrelease/\npackages/\n\nNow, when running make, it will build the library in jni/release instead of buildSrc. ./gradlew build will then build the library and move it to buildSrc.\nUpdated documentation as well.\nBy submitting this pull request, I confirm that you can use, modify, copy, and redistribute this contribution, under the terms of your choice.", "createdAt": "2020-05-20T05:55:51Z", "url": "https://github.com/opendistro-for-elasticsearch/k-NN/pull/123", "merged": true, "mergeCommit": {"oid": "52dd13b6aba29cc8d1a96f4b2f4706561493df3f"}, "closed": true, "closedAt": "2020-05-26T15:45:04Z", "author": {"login": "jmazanec15"}, "timelineItems": {"totalCount": 14, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABchVPufAH2gAyNDIwNTI0NTkzOjRkMDQ5NWIzN2QxM2IxY2UwY2JkZGJkZDI1ZTA4ODI4ZTUwNzc2ZjI=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcj7T8igFqTQxNzIyODc4MQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "4d0495b37d13b1ce0cbddbdd25e08828e50776f2", "author": {"user": {"login": "jmazanec15", "name": "Jack Mazanec"}}, "url": "https://github.com/opendistro-for-elasticsearch/k-NN/commit/4d0495b37d13b1ce0cbddbdd25e08828e50776f2", "committedDate": "2020-05-14T22:30:46Z", "message": "refactored directory structure"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "4b094d6f0ab762ff05e279c6b3114c2b3f2ad8ae", "author": {"user": {"login": "jmazanec15", "name": "Jack Mazanec"}}, "url": "https://github.com/opendistro-for-elasticsearch/k-NN/commit/4b094d6f0ab762ff05e279c6b3114c2b3f2ad8ae", "committedDate": "2020-05-14T23:18:37Z", "message": "fixed install so only jni lib is installed"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c63c6f175cbcdb0a7b2995efec5a4eadae93463e", "author": {"user": {"login": "jmazanec15", "name": "Jack Mazanec"}}, "url": "https://github.com/opendistro-for-elasticsearch/k-NN/commit/c63c6f175cbcdb0a7b2995efec5a4eadae93463e", "committedDate": "2020-05-18T20:52:46Z", "message": "made adjustments to cpack logic"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "6e012967bbea7b02a4c33ddba6be2ee55172b3eb", "author": {"user": {"login": "jmazanec15", "name": "Jack Mazanec"}}, "url": "https://github.com/opendistro-for-elasticsearch/k-NN/commit/6e012967bbea7b02a4c33ddba6be2ee55172b3eb", "committedDate": "2020-05-19T22:59:32Z", "message": "updated for building artifacts"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "036886677e0c4622db205d30c452b419bd1a5a52", "author": {"user": {"login": "jmazanec15", "name": "Jack Mazanec"}}, "url": "https://github.com/opendistro-for-elasticsearch/k-NN/commit/036886677e0c4622db205d30c452b419bd1a5a52", "committedDate": "2020-05-20T04:52:36Z", "message": "cleaned up cpack logic"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "92e1e5a6817fb7a6405efdd500af019e7c055cbb", "author": {"user": {"login": "jmazanec15", "name": "Jack Mazanec"}}, "url": "https://github.com/opendistro-for-elasticsearch/k-NN/commit/92e1e5a6817fb7a6405efdd500af019e7c055cbb", "committedDate": "2020-05-20T04:53:12Z", "message": "added information about building knnlib artifacts"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c4aded2dcf75dc452d3773708c253c8056a9df5a", "author": {"user": {"login": "jmazanec15", "name": "Jack Mazanec"}}, "url": "https://github.com/opendistro-for-elasticsearch/k-NN/commit/c4aded2dcf75dc452d3773708c253c8056a9df5a", "committedDate": "2020-05-20T04:53:31Z", "message": "Merge branch 'master' of https://github.com/opendistro-for-elasticsearch/k-NN into lib-rpm"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "4a804294a6fd8248e63cbb6881ae345f9bc4cd8f", "author": {"user": {"login": "jmazanec15", "name": "Jack Mazanec"}}, "url": "https://github.com/opendistro-for-elasticsearch/k-NN/commit/4a804294a6fd8248e63cbb6881ae345f9bc4cd8f", "committedDate": "2020-05-20T16:22:30Z", "message": "added _CPack* to gitignore"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b4ff99e7cccfcfaec588ee7fdfef1ab745e21f6c", "author": {"user": {"login": "jmazanec15", "name": "Jack Mazanec"}}, "url": "https://github.com/opendistro-for-elasticsearch/k-NN/commit/b4ff99e7cccfcfaec588ee7fdfef1ab745e21f6c", "committedDate": "2020-05-20T21:23:09Z", "message": "change naming of artifacts"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c1603f4ca96755f16c03e116c35b6c82c3f8a125", "author": {"user": {"login": "jmazanec15", "name": "Jack Mazanec"}}, "url": "https://github.com/opendistro-for-elasticsearch/k-NN/commit/c1603f4ca96755f16c03e116c35b6c82c3f8a125", "committedDate": "2020-05-21T19:24:51Z", "message": "added packages to gitignore"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDE2Njc1ODgz", "url": "https://github.com/opendistro-for-elasticsearch/k-NN/pull/123#pullrequestreview-416675883", "createdAt": "2020-05-22T06:27:40Z", "commit": {"oid": "c1603f4ca96755f16c03e116c35b6c82c3f8a125"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yMlQwNjoyNzo0MFrOGZMDRg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yMlQwNjoyNzo0MFrOGZMDRg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyOTA2NTAzMA==", "bodyText": "Minor: Should we specify to just copy the library? Making sure nothing else is copied", "url": "https://github.com/opendistro-for-elasticsearch/k-NN/pull/123#discussion_r429065030", "createdAt": "2020-05-22T06:27:40Z", "author": {"login": "vamshin"}, "path": "build.gradle", "diffHunk": "@@ -148,16 +148,23 @@ task buildJniLib(type:Exec) {\n     commandLine 'make'\n }\n \n-test {\n+task makeJniLib(type: Copy) {\n     dependsOn buildJniLib\n+    from \"$buildDir/jni/release\"\n+    include \"*\"", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c1603f4ca96755f16c03e116c35b6c82c3f8a125"}, "originalPosition": 8}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDE3MTAwNzk4", "url": "https://github.com/opendistro-for-elasticsearch/k-NN/pull/123#pullrequestreview-417100798", "createdAt": "2020-05-22T18:13:13Z", "commit": {"oid": "c1603f4ca96755f16c03e116c35b6c82c3f8a125"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "3a7cc1d47d24ffbf1dccecd2474c610335873cd6", "author": {"user": {"login": "jmazanec15", "name": "Jack Mazanec"}}, "url": "https://github.com/opendistro-for-elasticsearch/k-NN/commit/3a7cc1d47d24ffbf1dccecd2474c610335873cd6", "committedDate": "2020-05-22T23:52:12Z", "message": "Merge branch 'master' of https://github.com/opendistro-for-elasticsearch/k-NN into lib-rpm"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDE3MjI4Nzgx", "url": "https://github.com/opendistro-for-elasticsearch/k-NN/pull/123#pullrequestreview-417228781", "createdAt": "2020-05-22T23:59:37Z", "commit": {"oid": "3a7cc1d47d24ffbf1dccecd2474c610335873cd6"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1366, "cost": 1, "resetAt": "2021-11-01T16:19:10Z"}}}