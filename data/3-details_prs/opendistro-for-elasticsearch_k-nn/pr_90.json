{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDAyNDE1MDAy", "number": 90, "title": "FEAT: support cosine similarity", "bodyText": "Issue #, if available:\n#28\nDescription of changes:\n\nAdd \"index.knn.space_type\" as string param into KNNSettings and use validator for fast fail\nPass in spaceType as String into jni functions (java/c++)\nUpdate vector field mapper to correctly parse the spaceType setting param\nAdapt KNNIndexCache\nAdapt existing test cases\n\nTODO\n\n check if \"index.knn.space_type\" should be reset or not once a index is created\n More test cases to cover cosine similarity\n update README\n\nBy submitting this pull request, I confirm that you can use, modify, copy, and redistribute this contribution, under the terms of your choice.", "createdAt": "2020-04-12T23:28:25Z", "url": "https://github.com/opendistro-for-elasticsearch/k-NN/pull/90", "merged": true, "mergeCommit": {"oid": "1c80b62c2a412324b3c6fccc8938a6b01d9cf88f"}, "closed": true, "closedAt": "2020-04-27T17:21:03Z", "author": {"login": "chenqi0805"}, "timelineItems": {"totalCount": 32, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcXCo5KgH2gAyNDAyNDE1MDAyOjk5Y2MxNmMyMTZlYWNkOTU3NjA2MDRjYTc2ZTJhMDA5NTkwZWMzNTU=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcbfHueAH2gAyNDAyNDE1MDAyOjAzOTRlOTM3ZjU3MzllNDMwNmY3YzczM2I3ZDU2Y2E5NzJlOGM4NWU=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "99cc16c216eacd95760604ca76e2a009590ec355", "author": {"user": {"login": "chenqi0805", "name": "Qi Chen"}}, "url": "https://github.com/opendistro-for-elasticsearch/k-NN/commit/99cc16c216eacd95760604ca76e2a009590ec355", "committedDate": "2020-04-12T23:10:49Z", "message": "MNT: pass in spaceType in jni cpp"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "6375d490fcb0f452bb2974470aa0ccacb2b4365a", "author": {"user": {"login": "chenqi0805", "name": "Qi Chen"}}, "url": "https://github.com/opendistro-for-elasticsearch/k-NN/commit/6375d490fcb0f452bb2974470aa0ccacb2b4365a", "committedDate": "2020-04-12T23:11:41Z", "message": "MNT: pass in spaceType in jni java"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "28f33f9f9ad1e20d57d1d61a9f09a91fa086d57b", "author": {"user": {"login": "chenqi0805", "name": "Qi Chen"}}, "url": "https://github.com/opendistro-for-elasticsearch/k-NN/commit/28f33f9f9ad1e20d57d1d61a9f09a91fa086d57b", "committedDate": "2020-04-12T23:12:04Z", "message": "Regenerate header file"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "784e67f496b108b5328277021a1329201890e945", "author": {"user": {"login": "chenqi0805", "name": "Qi Chen"}}, "url": "https://github.com/opendistro-for-elasticsearch/k-NN/commit/784e67f496b108b5328277021a1329201890e945", "committedDate": "2020-04-12T23:12:51Z", "message": "Regenerate jnilib"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "d29cabdc6be802ebb2eb214db050af82fc558ffd", "author": {"user": {"login": "chenqi0805", "name": "Qi Chen"}}, "url": "https://github.com/opendistro-for-elasticsearch/k-NN/commit/d29cabdc6be802ebb2eb214db050af82fc558ffd", "committedDate": "2020-04-12T23:13:52Z", "message": "ADD: spacetype into KNN settings"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "bde898cdef86a8659080a40f30202b40ea33c0f3", "author": {"user": {"login": "chenqi0805", "name": "Qi Chen"}}, "url": "https://github.com/opendistro-for-elasticsearch/k-NN/commit/bde898cdef86a8659080a40f30202b40ea33c0f3", "committedDate": "2020-04-12T23:15:10Z", "message": "Update vector field mapper"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "0bdf53e3a4e27fe3f152e1a437f0046f8a06f6b9", "author": {"user": {"login": "chenqi0805", "name": "Qi Chen"}}, "url": "https://github.com/opendistro-for-elasticsearch/k-NN/commit/0bdf53e3a4e27fe3f152e1a437f0046f8a06f6b9", "committedDate": "2020-04-12T23:16:35Z", "message": "Pass in spaceType in consumer"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "25cafe96cba19e876d71270f52b3fb986c773ded", "author": {"user": {"login": "chenqi0805", "name": "Qi Chen"}}, "url": "https://github.com/opendistro-for-elasticsearch/k-NN/commit/25cafe96cba19e876d71270f52b3fb986c773ded", "committedDate": "2020-04-12T23:17:53Z", "message": "ADD: spaceType param into constant"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "2920f5b40cc3b80451c794b1db9d5689bbfae24c", "author": {"user": {"login": "chenqi0805", "name": "Qi Chen"}}, "url": "https://github.com/opendistro-for-elasticsearch/k-NN/commit/2920f5b40cc3b80451c794b1db9d5689bbfae24c", "committedDate": "2020-04-12T23:18:43Z", "message": "fix loadIndex in cache"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a9388a9cde019b3fcf2ee191e8b418b6c45c0d6a", "author": {"user": {"login": "chenqi0805", "name": "Qi Chen"}}, "url": "https://github.com/opendistro-for-elasticsearch/k-NN/commit/a9388a9cde019b3fcf2ee191e8b418b6c45c0d6a", "committedDate": "2020-04-12T23:19:13Z", "message": "FIX: existing test cases"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "8a58bf6778608d2d6346c141cc30a1dbdc31115d", "author": {"user": {"login": "chenqi0805", "name": "Qi Chen"}}, "url": "https://github.com/opendistro-for-elasticsearch/k-NN/commit/8a58bf6778608d2d6346c141cc30a1dbdc31115d", "committedDate": "2020-04-12T23:19:46Z", "message": "Update jni external library"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzkyNDUxOTEx", "url": "https://github.com/opendistro-for-elasticsearch/k-NN/pull/90#pullrequestreview-392451911", "createdAt": "2020-04-13T21:26:45Z", "commit": {"oid": "8a58bf6778608d2d6346c141cc30a1dbdc31115d"}, "state": "COMMENTED", "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0xM1QyMToyNjo0NVrOGE18tw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0xM1QyMTozMDoyOVrOGE2DkA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNzczMTM4Mw==", "bodyText": "I believe this needs to be released via env->ReleaseStringUTFChars", "url": "https://github.com/opendistro-for-elasticsearch/k-NN/pull/90#discussion_r407731383", "createdAt": "2020-04-13T21:26:45Z", "author": {"login": "jmazanec15"}, "path": "jni/src/v1736/com_amazon_opendistroforelasticsearch_knn_index_v1736_KNNIndex.cpp", "diffHunk": "@@ -85,15 +85,17 @@ void catch_cpp_exception_and_throw_java(JNIEnv* env)\n     }\n }\n \n-JNIEXPORT void JNICALL Java_com_amazon_opendistroforelasticsearch_knn_index_v1736_KNNIndex_saveIndex(JNIEnv* env, jclass cls, jintArray ids, jobjectArray vectors, jstring indexPath, jobjectArray algoParams)\n+JNIEXPORT void JNICALL Java_com_amazon_opendistroforelasticsearch_knn_index_v1736_KNNIndex_saveIndex(JNIEnv* env, jclass cls, jintArray ids, jobjectArray vectors, jstring indexPath, jstring spaceType, jobjectArray algoParams)\n {\n     Space<float>* space = NULL;\n     ObjectVector dataset;\n     Index<float>* index = NULL;\n     int* object_ids = NULL;\n \n     try {\n-        space = SpaceFactoryRegistry<float>::Instance().CreateSpace(\"l2\", AnyParams());\n+        const char *spaceTypeCStr = env->GetStringUTFChars(spaceType, 0);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "8a58bf6778608d2d6346c141cc30a1dbdc31115d"}, "originalPosition": 27}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNzczMTc0Mw==", "bodyText": "This needs to be released as well", "url": "https://github.com/opendistro-for-elasticsearch/k-NN/pull/90#discussion_r407731743", "createdAt": "2020-04-13T21:27:32Z", "author": {"login": "jmazanec15"}, "path": "jni/src/v1736/com_amazon_opendistroforelasticsearch_knn_index_v1736_KNNIndex.cpp", "diffHunk": "@@ -171,17 +173,19 @@ JNIEXPORT jobjectArray JNICALL Java_com_amazon_opendistroforelasticsearch_knn_in\n     return NULL;\n }\n \n-JNIEXPORT jlong JNICALL Java_com_amazon_opendistroforelasticsearch_knn_index_v1736_KNNIndex_init(JNIEnv* env, jclass cls,  jstring indexPath, jobjectArray algoParams)\n+JNIEXPORT jlong JNICALL Java_com_amazon_opendistroforelasticsearch_knn_index_v1736_KNNIndex_init(JNIEnv* env, jclass cls,  jstring indexPath, jstring spaceType, jobjectArray algoParams)\n {\n     IndexWrapper *indexWrapper = NULL;\n     try {\n         const char *indexPathCStr = env->GetStringUTFChars(indexPath, 0);\n         string indexPathString(indexPathCStr);\n+        const char *spaceTypeCStr = env->GetStringUTFChars(spaceType, 0);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "8a58bf6778608d2d6346c141cc30a1dbdc31115d"}, "originalPosition": 53}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNzczMzEzNg==", "bodyText": "Why switch this?", "url": "https://github.com/opendistro-for-elasticsearch/k-NN/pull/90#discussion_r407733136", "createdAt": "2020-04-13T21:30:29Z", "author": {"login": "jmazanec15"}, "path": "src/test/java/com/amazon/opendistroforelasticsearch/knn/index/KNNJNITestsIT.java", "diffHunk": "@@ -31,8 +31,8 @@\n import java.util.Map;\n import java.util.stream.Collectors;\n \n-public class KNNJNITests extends ESTestCase {\n-    private static final Logger logger = LogManager.getLogger(KNNJNITests.class);\n+public class KNNJNITestsIT extends ESTestCase {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "8a58bf6778608d2d6346c141cc30a1dbdc31115d"}, "originalPosition": 6}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "de8271d874f597249517ac5209cd62436b3cf9b0", "author": {"user": {"login": "chenqi0805", "name": "Qi Chen"}}, "url": "https://github.com/opendistro-for-elasticsearch/k-NN/commit/de8271d874f597249517ac5209cd62436b3cf9b0", "committedDate": "2020-04-14T03:05:10Z", "message": "FIX: release jstring and char array"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c49efafaf6321ea87ba9411b01b8635d5ecf7497", "author": {"user": {"login": "chenqi0805", "name": "Qi Chen"}}, "url": "https://github.com/opendistro-for-elasticsearch/k-NN/commit/c49efafaf6321ea87ba9411b01b8635d5ecf7497", "committedDate": "2020-04-14T03:20:21Z", "message": "Rename test file and added a consinesimil test"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ce2660f21c33ea0bd979bfc6695cad9bba00499f", "author": {"user": {"login": "chenqi0805", "name": "Qi Chen"}}, "url": "https://github.com/opendistro-for-elasticsearch/k-NN/commit/ce2660f21c33ea0bd979bfc6695cad9bba00499f", "committedDate": "2020-04-14T03:20:37Z", "message": "update .jnilib"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "2c10607999d44e7a2e442382e23e7e04a2086ac7", "author": {"user": {"login": "chenqi0805", "name": "Qi Chen"}}, "url": "https://github.com/opendistro-for-elasticsearch/k-NN/commit/2c10607999d44e7a2e442382e23e7e04a2086ac7", "committedDate": "2020-04-14T03:35:38Z", "message": "Rename file"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "65052c8a73bb594e0ceacb87b46b1445e1772ad3", "author": {"user": {"login": "chenqi0805", "name": "Qi Chen"}}, "url": "https://github.com/opendistro-for-elasticsearch/k-NN/commit/65052c8a73bb594e0ceacb87b46b1445e1772ad3", "committedDate": "2020-04-14T05:04:13Z", "message": "Rename file"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "3eb7a47d8e5d350eea05d6a280881adc85cb864b", "author": {"user": {"login": "chenqi0805", "name": "Qi Chen"}}, "url": "https://github.com/opendistro-for-elasticsearch/k-NN/commit/3eb7a47d8e5d350eea05d6a280881adc85cb864b", "committedDate": "2020-04-14T05:45:11Z", "message": "Compile .so"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "aa26cfb33ed6c9a5fe7bb029db39854cbad38800", "author": {"user": {"login": "chenqi0805", "name": "Qi Chen"}}, "url": "https://github.com/opendistro-for-elasticsearch/k-NN/commit/aa26cfb33ed6c9a5fe7bb029db39854cbad38800", "committedDate": "2020-04-14T14:08:54Z", "message": "Compile .so on linux"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzkzMTgxMDEx", "url": "https://github.com/opendistro-for-elasticsearch/k-NN/pull/90#pullrequestreview-393181011", "createdAt": "2020-04-14T18:18:41Z", "commit": {"oid": "aa26cfb33ed6c9a5fe7bb029db39854cbad38800"}, "state": "COMMENTED", "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0xNFQxODoxODo0MlrOGFbMTw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0xNFQxODozNTozMVrOGFbzcQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwODM0MTU4Mw==", "bodyText": "Why is this case insensitive?", "url": "https://github.com/opendistro-for-elasticsearch/k-NN/pull/90#discussion_r408341583", "createdAt": "2020-04-14T18:18:42Z", "author": {"login": "jmazanec15"}, "path": "src/main/java/com/amazon/opendistroforelasticsearch/knn/index/KNNSettings.java", "diffHunk": "@@ -367,4 +387,48 @@ public void setClusterService(ClusterService clusterService) {\n         this.clusterService = clusterService;\n     }\n \n+    static class SpaceTypeValidator implements Setting.Validator<String> {\n+\n+        private Set<String> types = SpaceTypes.getValues();\n+\n+        @Override public void validate(String value) {\n+            if (!types.contains(value.toLowerCase())){", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "aa26cfb33ed6c9a5fe7bb029db39854cbad38800"}, "originalPosition": 71}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwODM0MzE3Nw==", "bodyText": "Could you add test cases to ensure that invalid space names throw the expected exceptions?", "url": "https://github.com/opendistro-for-elasticsearch/k-NN/pull/90#discussion_r408343177", "createdAt": "2020-04-14T18:21:29Z", "author": {"login": "jmazanec15"}, "path": "src/test/java/com/amazon/opendistroforelasticsearch/knn/index/KNNJNITests.java", "diffHunk": "@@ -165,7 +214,7 @@ public Void run() {\n         float[] queryVector = {1.0f, 1.0f, 1.0f, 1.0f};\n         String[] algoQueryParams = {\"efSearch=200\"};\n \n-        final KNNIndex index = KNNIndex.loadIndex(indexPath, algoQueryParams);\n+        final KNNIndex index = KNNIndex.loadIndex(indexPath, \"l2\", algoQueryParams);\n         final KNNQueryResult[] results = index.queryIndex(queryVector, 30);\n \n         Map<Integer, Float> scores = Arrays.stream(results).collect(", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "aa26cfb33ed6c9a5fe7bb029db39854cbad38800"}, "originalPosition": 109}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwODM1MTYwMQ==", "bodyText": "Tests as opposed to IT signals that it is a unit test. These tests run during ./gradlew build, which is what we use for the PR testing workflow. You can also run them individually with this command:\n./gradlew ':test' --tests \"com.amazon.opendistroforelasticsearch.knn.index.KNNJNITests.testCreateHnswIndex\"\n\nWe consider these unit tests because they are testing an isolated portion of code. Interesting that IntelliJ does not pick them up. Will need to look into it.", "url": "https://github.com/opendistro-for-elasticsearch/k-NN/pull/90#discussion_r408351601", "createdAt": "2020-04-14T18:35:31Z", "author": {"login": "jmazanec15"}, "path": "src/test/java/com/amazon/opendistroforelasticsearch/knn/index/KNNJNITestsIT.java", "diffHunk": "@@ -31,8 +31,8 @@\n import java.util.Map;\n import java.util.stream.Collectors;\n \n-public class KNNJNITests extends ESTestCase {\n-    private static final Logger logger = LogManager.getLogger(KNNJNITests.class);\n+public class KNNJNITestsIT extends ESTestCase {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNzczMzEzNg=="}, "originalCommit": {"oid": "8a58bf6778608d2d6346c141cc30a1dbdc31115d"}, "originalPosition": 6}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "18a84068eccdca5eaa06ae88e27bbb29bdcf785e", "author": {"user": {"login": "chenqi0805", "name": "Qi Chen"}}, "url": "https://github.com/opendistro-for-elasticsearch/k-NN/commit/18a84068eccdca5eaa06ae88e27bbb29bdcf785e", "committedDate": "2020-04-15T02:48:14Z", "message": "TST: IT on invalid spaceType settings"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "5ebb93023d57c484cc22715a1662ee1fd6518a42", "author": {"user": {"login": "chenqi0805", "name": "Qi Chen"}}, "url": "https://github.com/opendistro-for-elasticsearch/k-NN/commit/5ebb93023d57c484cc22715a1662ee1fd6518a42", "committedDate": "2020-04-15T02:49:53Z", "message": "Merge branch 'feat/28-cosine-similarity' of github.com:chenqi0805/k-NN into feat/28-cosine-similarity\n\n* 'feat/28-cosine-similarity' of github.com:chenqi0805/k-NN:\n  Compile .so on linux"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "635c7b1e62fbb48e71693f7282d4eb35fc7c9f3a", "author": {"user": {"login": "chenqi0805", "name": "Qi Chen"}}, "url": "https://github.com/opendistro-for-elasticsearch/k-NN/commit/635c7b1e62fbb48e71693f7282d4eb35fc7c9f3a", "committedDate": "2020-04-15T02:55:14Z", "message": "Unused import"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "83e4a90780ed8811393f16bd250dd480ca378c18", "author": {"user": {"login": "chenqi0805", "name": "Qi Chen"}}, "url": "https://github.com/opendistro-for-elasticsearch/k-NN/commit/83e4a90780ed8811393f16bd250dd480ca378c18", "committedDate": "2020-04-15T03:15:42Z", "message": "Update README"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzkzNTA0NDUy", "url": "https://github.com/opendistro-for-elasticsearch/k-NN/pull/90#pullrequestreview-393504452", "createdAt": "2020-04-15T07:03:13Z", "commit": {"oid": "83e4a90780ed8811393f16bd250dd480ca378c18"}, "state": "COMMENTED", "comments": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0xNVQwNzowMzoxM1rOGFsXTw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0xNVQwNzozNzo1MFrOGFtcNA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwODYyMjkyNw==", "bodyText": "nit: Please add the new function arguments to the end of the existing parameters list. Please take care in other places as well.", "url": "https://github.com/opendistro-for-elasticsearch/k-NN/pull/90#discussion_r408622927", "createdAt": "2020-04-15T07:03:13Z", "author": {"login": "vamshin"}, "path": "jni/src/v1736/com_amazon_opendistroforelasticsearch_knn_index_v1736_KNNIndex.cpp", "diffHunk": "@@ -85,15 +85,19 @@ void catch_cpp_exception_and_throw_java(JNIEnv* env)\n     }\n }\n \n-JNIEXPORT void JNICALL Java_com_amazon_opendistroforelasticsearch_knn_index_v1736_KNNIndex_saveIndex(JNIEnv* env, jclass cls, jintArray ids, jobjectArray vectors, jstring indexPath, jobjectArray algoParams)\n+JNIEXPORT void JNICALL Java_com_amazon_opendistroforelasticsearch_knn_index_v1736_KNNIndex_saveIndex(JNIEnv* env, jclass cls, jintArray ids, jobjectArray vectors, jstring indexPath, jstring spaceType, jobjectArray algoParams)", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "83e4a90780ed8811393f16bd250dd480ca378c18"}, "originalPosition": 18}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwODYzMDc1Ng==", "bodyText": "null check on value", "url": "https://github.com/opendistro-for-elasticsearch/k-NN/pull/90#discussion_r408630756", "createdAt": "2020-04-15T07:19:27Z", "author": {"login": "vamshin"}, "path": "src/main/java/com/amazon/opendistroforelasticsearch/knn/index/KNNSettings.java", "diffHunk": "@@ -367,4 +387,48 @@ public void setClusterService(ClusterService clusterService) {\n         this.clusterService = clusterService;\n     }\n \n+    static class SpaceTypeValidator implements Setting.Validator<String> {\n+\n+        private Set<String> types = SpaceTypes.getValues();\n+\n+        @Override public void validate(String value) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "83e4a90780ed8811393f16bd250dd480ca378c18"}, "originalPosition": 70}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwODYzMTI0NQ==", "bodyText": "nit: Move this enum class to a dedicated file", "url": "https://github.com/opendistro-for-elasticsearch/k-NN/pull/90#discussion_r408631245", "createdAt": "2020-04-15T07:20:27Z", "author": {"login": "vamshin"}, "path": "src/main/java/com/amazon/opendistroforelasticsearch/knn/index/KNNSettings.java", "diffHunk": "@@ -367,4 +387,48 @@ public void setClusterService(ClusterService clusterService) {\n         this.clusterService = clusterService;\n     }\n \n+    static class SpaceTypeValidator implements Setting.Validator<String> {\n+\n+        private Set<String> types = SpaceTypes.getValues();\n+\n+        @Override public void validate(String value) {\n+            if (!types.contains(value.toLowerCase())){\n+                throw new InvalidParameterException(String.format(\"Unsupported space type: %s\", value));\n+            }\n+        }\n+    }\n+\n+    /**\n+     * Enum contains space types for k-NN similarity search\n+     */\n+    public enum SpaceTypes {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "83e4a90780ed8811393f16bd250dd480ca378c18"}, "originalPosition": 80}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwODY0MDU2NA==", "bodyText": "nit: final String spaceType?", "url": "https://github.com/opendistro-for-elasticsearch/k-NN/pull/90#discussion_r408640564", "createdAt": "2020-04-15T07:37:50Z", "author": {"login": "vamshin"}, "path": "src/main/java/com/amazon/opendistroforelasticsearch/knn/index/v1736/KNNIndex.java", "diffHunk": "@@ -110,12 +110,13 @@ public void close() {\n      * Loads the knn index to memory for querying the neighbours\n      *\n      * @param indexPath path where the hnsw index is stored\n+     * @param spaceType space type of the index\n      * @param algoParams hnsw algorithm parameters\n      * @return knn index that can be queried for k nearest neighbours\n      */\n-    public static KNNIndex loadIndex(String indexPath, final String[] algoParams) {\n+    public static KNNIndex loadIndex(String indexPath, String spaceType, final String[] algoParams) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "83e4a90780ed8811393f16bd250dd480ca378c18"}, "originalPosition": 9}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzk0ODAwMjA1", "url": "https://github.com/opendistro-for-elasticsearch/k-NN/pull/90#pullrequestreview-394800205", "createdAt": "2020-04-16T16:25:33Z", "commit": {"oid": "83e4a90780ed8811393f16bd250dd480ca378c18"}, "state": "APPROVED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0xNlQxNjoyNTozM1rOGGtYSQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0xNlQxNjoyNTozM1rOGGtYSQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwOTY4ODEzNw==", "bodyText": "Makes sense thanks", "url": "https://github.com/opendistro-for-elasticsearch/k-NN/pull/90#discussion_r409688137", "createdAt": "2020-04-16T16:25:33Z", "author": {"login": "jmazanec15"}, "path": "src/test/java/com/amazon/opendistroforelasticsearch/knn/index/KNNJNITests.java", "diffHunk": "@@ -165,7 +214,7 @@ public Void run() {\n         float[] queryVector = {1.0f, 1.0f, 1.0f, 1.0f};\n         String[] algoQueryParams = {\"efSearch=200\"};\n \n-        final KNNIndex index = KNNIndex.loadIndex(indexPath, algoQueryParams);\n+        final KNNIndex index = KNNIndex.loadIndex(indexPath, \"l2\", algoQueryParams);\n         final KNNQueryResult[] results = index.queryIndex(queryVector, 30);\n \n         Map<Integer, Float> scores = Arrays.stream(results).collect(", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwODM0MzE3Nw=="}, "originalCommit": {"oid": "aa26cfb33ed6c9a5fe7bb029db39854cbad38800"}, "originalPosition": 109}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e858038b854cfa0c08f569dc71dc9a22a8624999", "author": {"user": {"login": "chenqi0805", "name": "Qi Chen"}}, "url": "https://github.com/opendistro-for-elasticsearch/k-NN/commit/e858038b854cfa0c08f569dc71dc9a22a8624999", "committedDate": "2020-04-17T15:36:16Z", "message": "MNT: null check on spacetype"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "6cbfc79d9cb7069e61bdcccffbf1f62a04704cb1", "author": {"user": {"login": "chenqi0805", "name": "Qi Chen"}}, "url": "https://github.com/opendistro-for-elasticsearch/k-NN/commit/6cbfc79d9cb7069e61bdcccffbf1f62a04704cb1", "committedDate": "2020-04-17T15:54:19Z", "message": "REF: SpaceTypes"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "66cbbe84eb505a8911a014f91003cc3c37b4f2f2", "author": {"user": {"login": "chenqi0805", "name": "Qi Chen"}}, "url": "https://github.com/opendistro-for-elasticsearch/k-NN/commit/66cbbe84eb505a8911a014f91003cc3c37b4f2f2", "committedDate": "2020-04-17T16:16:12Z", "message": "MNT: arg order in jni"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c852d84d9892aee131bc5e2bf4896ac6e46a863d", "author": {"user": {"login": "chenqi0805", "name": "Qi Chen"}}, "url": "https://github.com/opendistro-for-elasticsearch/k-NN/commit/c852d84d9892aee131bc5e2bf4896ac6e46a863d", "committedDate": "2020-04-17T16:31:17Z", "message": "Compile .so"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzk1Njk0MjQ3", "url": "https://github.com/opendistro-for-elasticsearch/k-NN/pull/90#pullrequestreview-395694247", "createdAt": "2020-04-17T18:48:47Z", "commit": {"oid": "c852d84d9892aee131bc5e2bf4896ac6e46a863d"}, "state": "APPROVED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0xN1QxODo0ODo0OFrOGHZVaA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0xN1QxODo0ODo0OFrOGHZVaA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMDQwODI5Ng==", "bodyText": "Ah got it. I think we can probably ignore this case.", "url": "https://github.com/opendistro-for-elasticsearch/k-NN/pull/90#discussion_r410408296", "createdAt": "2020-04-17T18:48:48Z", "author": {"login": "vamshin"}, "path": "src/main/java/com/amazon/opendistroforelasticsearch/knn/index/KNNSettings.java", "diffHunk": "@@ -367,4 +387,48 @@ public void setClusterService(ClusterService clusterService) {\n         this.clusterService = clusterService;\n     }\n \n+    static class SpaceTypeValidator implements Setting.Validator<String> {\n+\n+        private Set<String> types = SpaceTypes.getValues();\n+\n+        @Override public void validate(String value) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwODYzMDc1Ng=="}, "originalCommit": {"oid": "83e4a90780ed8811393f16bd250dd480ca378c18"}, "originalPosition": 70}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "0394e937f5739e4306f7c733b7d56ca972e8c85e", "author": {"user": {"login": "chenqi0805", "name": "Qi Chen"}}, "url": "https://github.com/opendistro-for-elasticsearch/k-NN/commit/0394e937f5739e4306f7c733b7d56ca972e8c85e", "committedDate": "2020-04-26T18:37:32Z", "message": "MNT: update readme on settings and experimental section"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1345, "cost": 1, "resetAt": "2021-11-01T16:19:10Z"}}}