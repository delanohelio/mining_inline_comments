{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0MzkxNTI0NzY1", "number": 73, "title": "k-NN CI/CD GitHub Actions", "bodyText": "Issue #74\n###CI.yml\nThis job will trigger on every code checkin in master and opendistro branches which then will build the k-NN plugin and run integration tests against the respective version of opendistro staging docker image.\nBefore running the test the job will first remove k-NN plugin, if available, then it will re-install the built plugin.\n###CD.yml\nThis job will trigger whenever a code checkin is made on an opendistro branch or a new opendistro branch is cut. It will build all the artifacts and then upload to respective S3 paths.\nBy submitting this pull request, I confirm that you can use, modify, copy, and redistribute this contribution, under the terms of your choice.", "createdAt": "2020-03-20T13:13:14Z", "url": "https://github.com/opendistro-for-elasticsearch/k-NN/pull/73", "merged": true, "mergeCommit": {"oid": "d5a5917aa390982c812e10fb83b5bcd916cc8c7f"}, "closed": true, "closedAt": "2020-03-24T19:47:00Z", "author": {"login": "rishabh6788"}, "timelineItems": {"totalCount": 10, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcPgQt1AH2gAyMzkxNTI0NzY1OjdhOTllN2EyNzczYzE2ZWJlMWNhNTE5ZWY3Mjg4MGJlMDU2MzY3N2E=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcQ4PWLgH2gAyMzkxNTI0NzY1OjI5YWI2ZGRkNGY2YjgyMjQ4MDdlY2UxZWZmZDYxMTRjZTYxNzJjNjc=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "7a99e7a2773c16ebe1ca519ef72880be0563677a", "author": {"user": {"login": "rishabh6788", "name": "Rishabh Singh"}}, "url": "https://github.com/opendistro-for-elasticsearch/k-NN/commit/7a99e7a2773c16ebe1ca519ef72880be0563677a", "committedDate": "2020-03-20T13:10:10Z", "message": "Create CI.yml"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c2a35e5fdc4589eff094f60d91e468018334f71f", "author": {"user": {"login": "rishabh6788", "name": "Rishabh Singh"}}, "url": "https://github.com/opendistro-for-elasticsearch/k-NN/commit/c2a35e5fdc4589eff094f60d91e468018334f71f", "committedDate": "2020-03-20T13:11:07Z", "message": "Create CD.yml"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzc4NjQ2MTUx", "url": "https://github.com/opendistro-for-elasticsearch/k-NN/pull/73#pullrequestreview-378646151", "createdAt": "2020-03-20T16:43:59Z", "commit": {"oid": "c2a35e5fdc4589eff094f60d91e468018334f71f"}, "state": "COMMENTED", "comments": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yMFQxNjo0Mzo1OVrOF5bYpw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yMFQxNjo0OTozNVrOF5blhQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NTc2MTgzMQ==", "bodyText": "So, this will basically trigger whenever we create a tag that starts in v for releases correct?", "url": "https://github.com/opendistro-for-elasticsearch/k-NN/pull/73#discussion_r395761831", "createdAt": "2020-03-20T16:43:59Z", "author": {"login": "jmazanec15"}, "path": ".github/workflows/CD.yml", "diffHunk": "@@ -0,0 +1,42 @@\n+name: Build and Release k-NN\n+on:\n+  push:\n+    tags: \n+      - v*", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c2a35e5fdc4589eff094f60d91e468018334f71f"}, "originalPosition": 5}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NTc2MjU5Ng==", "bodyText": "build buildDeb buildRpm  can be build release.", "url": "https://github.com/opendistro-for-elasticsearch/k-NN/pull/73#discussion_r395762596", "createdAt": "2020-03-20T16:45:18Z", "author": {"login": "jmazanec15"}, "path": ".github/workflows/CD.yml", "diffHunk": "@@ -0,0 +1,42 @@\n+name: Build and Release k-NN\n+on:\n+  push:\n+    tags: \n+      - v*\n+\n+jobs:\n+  Build-k-NN:\n+    strategy:\n+      matrix:\n+        java: [12]\n+\n+    name: Build and Release k-NN Plugin\n+    runs-on: ubuntu-latest\n+\n+    steps:\n+      - name: Checkout k-NN\n+        uses: actions/checkout@v1\n+        \n+      - name: Configure AWS\n+        uses: aws-actions/configure-aws-credentials@v1\n+        with:\n+          aws-access-key-id: ${{ secrets.AWS_ACCESS_KEY_ID }}\n+          aws-secret-access-key: ${{ secrets.AWS_SECRET_ACCESS_KEY }}\n+          aws-region: us-east-1\n+      \n+      - name: Setup Java ${{ matrix.java }}\n+        uses: actions/setup-java@v1\n+        with:\n+          java-version: ${{ matrix.java }}\n+      \n+      - name: Run build\n+        run: |\n+          ./gradlew build buildDeb buildRpm --console=plain -Dbuild.snapshot=false", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c2a35e5fdc4589eff094f60d91e468018334f71f"}, "originalPosition": 34}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NTc2NDMwMw==", "bodyText": "Does sleep 15 ever produce errors when the cluster isn't ready after 15 seconds?", "url": "https://github.com/opendistro-for-elasticsearch/k-NN/pull/73#discussion_r395764303", "createdAt": "2020-03-20T16:48:09Z", "author": {"login": "jmazanec15"}, "path": ".github/workflows/CI.yml", "diffHunk": "@@ -0,0 +1,59 @@\n+name: Build and Test k-NN\n+on:\n+  push:\n+    branches:\n+      - master\n+      - opendistro-*\n+\n+jobs:\n+  Build-k-NN:\n+    strategy:\n+      matrix:\n+        java: [12]\n+\n+    name: Build and Test k-NN Plugin\n+    runs-on: ubuntu-latest\n+\n+    steps:\n+      - name: Checkout k-NN\n+        uses: actions/checkout@v1\n+        \n+      - name: Setup Java ${{ matrix.java }}\n+        uses: actions/setup-java@v1\n+        with:\n+          java-version: ${{ matrix.java }}\n+      \n+      - name: Run build\n+        run: |\n+          ./gradlew build\n+          ls -ltr build/distributions/\n+          \n+      - name: Pull and Run Docker\n+        run: |\n+          plugin=`ls build/distributions/*.zip`\n+          version=`echo $plugin|awk -F- '{print $3}'| cut -d. -f 1-3`\n+          plugin_version=`echo $plugin|awk -F- '{print $3}'| cut -d. -f 1-4`\n+          echo $version\n+          cd ..\n+          \n+          if docker pull opendistroforelasticsearch/opendistroforelasticsearch:$version\n+          then\n+            echo \"FROM opendistroforelasticsearch/opendistroforelasticsearch:$version\" >> Dockerfile\n+            echo \"RUN if [ -d /usr/share/elasticsearch/plugins/opendistro_security ]; then /usr/share/elasticsearch/bin/elasticsearch-plugin remove opendistro_security; fi\" >> Dockerfile\n+            echo \"RUN if [ -d /usr/share/elasticsearch/plugins/opendistro-knn ]; then /usr/share/elasticsearch/bin/elasticsearch-plugin remove opendistro-knn; fi\" >> Dockerfile\n+            echo \"ADD k-NN/build/distributions/opendistro-knn-$plugin_version.zip /tmp/\" >> Dockerfile\n+            echo \"RUN /usr/share/elasticsearch/bin/elasticsearch-plugin install --batch file:/tmp/opendistro-knn-$plugin_version.zip\" >> Dockerfile\n+            \n+            docker build -t odfe-knn:test .\n+          fi\n+          \n+      - name: Run Docker Image\n+        run: |\n+          cd ..\n+          docker run -p 9200:9200 -d -p 9600:9600 -e \"discovery.type=single-node\" odfe-knn:test\n+          sleep 15", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c2a35e5fdc4589eff094f60d91e468018334f71f"}, "originalPosition": 54}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NTc2NTEyNQ==", "bodyText": "Is the purpose of this line to check that the cluster is running?", "url": "https://github.com/opendistro-for-elasticsearch/k-NN/pull/73#discussion_r395765125", "createdAt": "2020-03-20T16:49:35Z", "author": {"login": "jmazanec15"}, "path": ".github/workflows/CI.yml", "diffHunk": "@@ -0,0 +1,59 @@\n+name: Build and Test k-NN\n+on:\n+  push:\n+    branches:\n+      - master\n+      - opendistro-*\n+\n+jobs:\n+  Build-k-NN:\n+    strategy:\n+      matrix:\n+        java: [12]\n+\n+    name: Build and Test k-NN Plugin\n+    runs-on: ubuntu-latest\n+\n+    steps:\n+      - name: Checkout k-NN\n+        uses: actions/checkout@v1\n+        \n+      - name: Setup Java ${{ matrix.java }}\n+        uses: actions/setup-java@v1\n+        with:\n+          java-version: ${{ matrix.java }}\n+      \n+      - name: Run build\n+        run: |\n+          ./gradlew build\n+          ls -ltr build/distributions/\n+          \n+      - name: Pull and Run Docker\n+        run: |\n+          plugin=`ls build/distributions/*.zip`\n+          version=`echo $plugin|awk -F- '{print $3}'| cut -d. -f 1-3`\n+          plugin_version=`echo $plugin|awk -F- '{print $3}'| cut -d. -f 1-4`\n+          echo $version\n+          cd ..\n+          \n+          if docker pull opendistroforelasticsearch/opendistroforelasticsearch:$version\n+          then\n+            echo \"FROM opendistroforelasticsearch/opendistroforelasticsearch:$version\" >> Dockerfile\n+            echo \"RUN if [ -d /usr/share/elasticsearch/plugins/opendistro_security ]; then /usr/share/elasticsearch/bin/elasticsearch-plugin remove opendistro_security; fi\" >> Dockerfile\n+            echo \"RUN if [ -d /usr/share/elasticsearch/plugins/opendistro-knn ]; then /usr/share/elasticsearch/bin/elasticsearch-plugin remove opendistro-knn; fi\" >> Dockerfile\n+            echo \"ADD k-NN/build/distributions/opendistro-knn-$plugin_version.zip /tmp/\" >> Dockerfile\n+            echo \"RUN /usr/share/elasticsearch/bin/elasticsearch-plugin install --batch file:/tmp/opendistro-knn-$plugin_version.zip\" >> Dockerfile\n+            \n+            docker build -t odfe-knn:test .\n+          fi\n+          \n+      - name: Run Docker Image\n+        run: |\n+          cd ..\n+          docker run -p 9200:9200 -d -p 9600:9600 -e \"discovery.type=single-node\" odfe-knn:test\n+          sleep 15\n+          curl -XGET http://localhost:9200/_cat/plugins", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c2a35e5fdc4589eff094f60d91e468018334f71f"}, "originalPosition": 55}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "3031c5603f478eb73c07fbc7b80d6fb58f6c1577", "author": {"user": {"login": "rishabh6788", "name": "Rishabh Singh"}}, "url": "https://github.com/opendistro-for-elasticsearch/k-NN/commit/3031c5603f478eb73c07fbc7b80d6fb58f6c1577", "committedDate": "2020-03-20T17:10:30Z", "message": "Update CD.yml"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzc4Njg2NTYx", "url": "https://github.com/opendistro-for-elasticsearch/k-NN/pull/73#pullrequestreview-378686561", "createdAt": "2020-03-20T17:39:06Z", "commit": {"oid": "3031c5603f478eb73c07fbc7b80d6fb58f6c1577"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzc4NjkwNDg3", "url": "https://github.com/opendistro-for-elasticsearch/k-NN/pull/73#pullrequestreview-378690487", "createdAt": "2020-03-20T17:44:40Z", "commit": {"oid": "3031c5603f478eb73c07fbc7b80d6fb58f6c1577"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzc4ODcyODI5", "url": "https://github.com/opendistro-for-elasticsearch/k-NN/pull/73#pullrequestreview-378872829", "createdAt": "2020-03-21T00:26:39Z", "commit": {"oid": "3031c5603f478eb73c07fbc7b80d6fb58f6c1577"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yMVQwMDoyNjozOVrOF5mVmQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yMVQwMDoyNjozOVrOF5mVmQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NTk0MTI3Mw==", "bodyText": "Why do we need to remove security plugin?", "url": "https://github.com/opendistro-for-elasticsearch/k-NN/pull/73#discussion_r395941273", "createdAt": "2020-03-21T00:26:39Z", "author": {"login": "vamshin"}, "path": ".github/workflows/CI.yml", "diffHunk": "@@ -0,0 +1,59 @@\n+name: Build and Test k-NN\n+on:\n+  push:\n+    branches:\n+      - master\n+      - opendistro-*\n+\n+jobs:\n+  Build-k-NN:\n+    strategy:\n+      matrix:\n+        java: [12]\n+\n+    name: Build and Test k-NN Plugin\n+    runs-on: ubuntu-latest\n+\n+    steps:\n+      - name: Checkout k-NN\n+        uses: actions/checkout@v1\n+        \n+      - name: Setup Java ${{ matrix.java }}\n+        uses: actions/setup-java@v1\n+        with:\n+          java-version: ${{ matrix.java }}\n+      \n+      - name: Run build\n+        run: |\n+          ./gradlew build\n+          ls -ltr build/distributions/\n+          \n+      - name: Pull and Run Docker\n+        run: |\n+          plugin=`ls build/distributions/*.zip`\n+          version=`echo $plugin|awk -F- '{print $3}'| cut -d. -f 1-3`\n+          plugin_version=`echo $plugin|awk -F- '{print $3}'| cut -d. -f 1-4`\n+          echo $version\n+          cd ..\n+          \n+          if docker pull opendistroforelasticsearch/opendistroforelasticsearch:$version\n+          then\n+            echo \"FROM opendistroforelasticsearch/opendistroforelasticsearch:$version\" >> Dockerfile\n+            echo \"RUN if [ -d /usr/share/elasticsearch/plugins/opendistro_security ]; then /usr/share/elasticsearch/bin/elasticsearch-plugin remove opendistro_security; fi\" >> Dockerfile", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "3031c5603f478eb73c07fbc7b80d6fb58f6c1577"}, "originalPosition": 42}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "61affaff9c14fce6f25715b6696f1a778c83622a", "author": {"user": {"login": "rishabh6788", "name": "Rishabh Singh"}}, "url": "https://github.com/opendistro-for-elasticsearch/k-NN/commit/61affaff9c14fce6f25715b6696f1a778c83622a", "committedDate": "2020-03-23T14:44:41Z", "message": "Update CI.yml"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzc5NjE2MjUx", "url": "https://github.com/opendistro-for-elasticsearch/k-NN/pull/73#pullrequestreview-379616251", "createdAt": "2020-03-23T16:45:22Z", "commit": {"oid": "61affaff9c14fce6f25715b6696f1a778c83622a"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "29ab6ddd4f6b8224807ece1effd6114ce6172c67", "author": {"user": {"login": "jmazanec15", "name": "Jack Mazanec"}}, "url": "https://github.com/opendistro-for-elasticsearch/k-NN/commit/29ab6ddd4f6b8224807ece1effd6114ce6172c67", "committedDate": "2020-03-24T19:40:19Z", "message": "updated to Java 13"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1333, "cost": 1, "resetAt": "2021-11-01T16:19:10Z"}}}