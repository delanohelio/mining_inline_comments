{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDkwNTQ3Mjk0", "number": 233, "title": "Add stats for custom scoring feature", "bodyText": "Issue #, if available:\nDescription of changes:\nAdds a few statistics for custom scoring feature. The following statistics are added:\nscript_compilations\nThe number of times the knn script is compiled. This value should only be 0 or 1 most of the time. However, if the cache containing the compiled scripts is filled, it may cause the script to be recompiled.\nscript_compilation_errors\nThe number of errors during script compilation.\nscript_query_requests\nThe number of query requests that use the k-NN score script.\nscript_query_errors\nThe number of errors that have occurred during use of the k-NN score script.\nAlong with adding the stats, I updated the README and added another stats integration test to verify the changes.\nI think in the future, it will probably make sense to refactor the stats api into different sections for custom scoring and approximate k Nearest Neighbor search. I will create an issue to do this.\nBy submitting this pull request, I confirm that you can use, modify, copy, and redistribute this contribution, under the terms of your choice.", "createdAt": "2020-09-21T20:40:57Z", "url": "https://github.com/opendistro-for-elasticsearch/k-NN/pull/233", "merged": true, "mergeCommit": {"oid": "c2e84fd20d92c07a2935b1394655c6a231295010"}, "closed": true, "closedAt": "2020-09-22T00:26:08Z", "author": {"login": "jmazanec15"}, "timelineItems": {"totalCount": 11, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdLHG-CgH2gAyNDkwNTQ3Mjk0OmVlODhlYWZmYWRiYzVjOTM4ZmM5MTNjNGU0ZjdiYzgyNGIxNzQ5OTI=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdLMzn7gFqTQ5MzA2NDQxMA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "ee88eaffadbc5c938fc913c4e4f7bc824b174992", "author": {"user": {"login": "jmazanec15", "name": "Jack Mazanec"}}, "url": "https://github.com/opendistro-for-elasticsearch/k-NN/commit/ee88eaffadbc5c938fc913c4e4f7bc824b174992", "committedDate": "2020-09-21T17:47:21Z", "message": "add stats for custom scoring"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "4873605afdcd7b70d5c8d0db6b1d7b7488521db2", "author": {"user": {"login": "jmazanec15", "name": "Jack Mazanec"}}, "url": "https://github.com/opendistro-for-elasticsearch/k-NN/commit/4873605afdcd7b70d5c8d0db6b1d7b7488521db2", "committedDate": "2020-09-21T20:28:46Z", "message": "combined script l2 and cosine query counter into 1"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "3f60044d3a76fd737ec4516c570d4cc6faff27db", "author": {"user": {"login": "jmazanec15", "name": "Jack Mazanec"}}, "url": "https://github.com/opendistro-for-elasticsearch/k-NN/commit/3f60044d3a76fd737ec4516c570d4cc6faff27db", "committedDate": "2020-09-21T20:29:06Z", "message": "add test case for script stats"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "262f4c512e103debb1cf48796c90ac0047b5fc9a", "author": {"user": {"login": "jmazanec15", "name": "Jack Mazanec"}}, "url": "https://github.com/opendistro-for-elasticsearch/k-NN/commit/262f4c512e103debb1cf48796c90ac0047b5fc9a", "committedDate": "2020-09-21T20:34:46Z", "message": "update the README for script stats"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "49c71cd9a94b19e20d167d9a7bd87018a090ca0f", "author": {"user": {"login": "jmazanec15", "name": "Jack Mazanec"}}, "url": "https://github.com/opendistro-for-elasticsearch/k-NN/commit/49c71cd9a94b19e20d167d9a7bd87018a090ca0f", "committedDate": "2020-09-21T20:36:57Z", "message": "Merge branch 'master' of github.com:opendistro-for-elasticsearch/k-NN into custom-scoring-stats"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDkzMDMzMTE2", "url": "https://github.com/opendistro-for-elasticsearch/k-NN/pull/233#pullrequestreview-493033116", "createdAt": "2020-09-21T22:49:13Z", "commit": {"oid": "49c71cd9a94b19e20d167d9a7bd87018a090ca0f"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yMVQyMjo0OToxM1rOHVlDSw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yMVQyMjo0OToxM1rOHVlDSw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MjM4OTE5NQ==", "bodyText": "Can we add similar test with multiple shards?", "url": "https://github.com/opendistro-for-elasticsearch/k-NN/pull/233#discussion_r492389195", "createdAt": "2020-09-21T22:49:13Z", "author": {"login": "vamshin"}, "path": "src/test/java/com/amazon/opendistroforelasticsearch/knn/plugin/action/RestKNNStatsHandlerIT.java", "diffHunk": "@@ -164,6 +170,62 @@ public void testInvalidNodeIdStats() throws Exception {\n         assertEquals(0, nodeStats.size());\n     }\n \n+    /**\n+     *  Test checks that script stats are properly updated\n+     */\n+    public void testScriptStats() throws Exception {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "49c71cd9a94b19e20d167d9a7bd87018a090ca0f"}, "originalPosition": 35}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDkzMDM0Njk0", "url": "https://github.com/opendistro-for-elasticsearch/k-NN/pull/233#pullrequestreview-493034694", "createdAt": "2020-09-21T22:53:31Z", "commit": {"oid": "49c71cd9a94b19e20d167d9a7bd87018a090ca0f"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yMVQyMjo1MzozMVrOHVlIzw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yMVQyMjo1MzozMVrOHVlIzw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MjM5MDYwNw==", "bodyText": "I think these errors are counted at shard level. We could update the documentation accordingly. Also you might want to check if all the above metrics at shard level or index level", "url": "https://github.com/opendistro-for-elasticsearch/k-NN/pull/233#discussion_r492390607", "createdAt": "2020-09-21T22:53:31Z", "author": {"login": "vamshin"}, "path": "README.md", "diffHunk": "@@ -352,6 +352,18 @@ The total time in nanoseconds it has taken to load items into cache (cumulative)\n #### indices_in_cache\n For each index that has graphs in the cache, this stat provides the number of graphs that index has and the total graph_memory_usage that index is using in Kilobytes.\n \n+#### script_compilations\n+The number of times the knn script is compiled. This value should only be 0 or 1 most of the time. However, if the cache containing the compiled scripts is filled, it may cause the script to be recompiled.\n+\n+#### script_compilation_errors\n+The number of errors during script compilation.\n+\n+#### script_query_requests\n+The number of query requests that use the k-NN score script.\n+\n+#### script_query_errors", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "49c71cd9a94b19e20d167d9a7bd87018a090ca0f"}, "originalPosition": 13}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "2e1629aca594e89d534efd06864725c306f96314", "author": {"user": {"login": "jmazanec15", "name": "Jack Mazanec"}}, "url": "https://github.com/opendistro-for-elasticsearch/k-NN/commit/2e1629aca594e89d534efd06864725c306f96314", "committedDate": "2020-09-21T22:58:50Z", "message": "Update documentation on script stats"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e72725edee0cc47b46b56e42187d1f63d4ca7555", "author": {"user": {"login": "jmazanec15", "name": "Jack Mazanec"}}, "url": "https://github.com/opendistro-for-elasticsearch/k-NN/commit/e72725edee0cc47b46b56e42187d1f63d4ca7555", "committedDate": "2020-09-21T23:08:52Z", "message": "Merge branch 'master' of github.com:opendistro-for-elasticsearch/k-NN into custom-scoring-stats"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a5cb3691bae5e91e3f7a36ef2ad8ce369867bd2b", "author": {"user": {"login": "jmazanec15", "name": "Jack Mazanec"}}, "url": "https://github.com/opendistro-for-elasticsearch/k-NN/commit/a5cb3691bae5e91e3f7a36ef2ad8ce369867bd2b", "committedDate": "2020-09-21T23:26:04Z", "message": "add extra test case for script"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDkzMDY0NDEw", "url": "https://github.com/opendistro-for-elasticsearch/k-NN/pull/233#pullrequestreview-493064410", "createdAt": "2020-09-22T00:25:39Z", "commit": {"oid": "a5cb3691bae5e91e3f7a36ef2ad8ce369867bd2b"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1270, "cost": 1, "resetAt": "2021-11-01T16:19:10Z"}}}