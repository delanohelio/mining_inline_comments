{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0Mzk5NzgzODYy", "number": 83, "title": "Add cmake", "bodyText": "Issue #, if available:\n#17\nDescription of changes:\nThis PR incorporates CMake to build the JNI library for ease of development. In order to build the library, it adds nmslib as a submodule. Note that this submodule is set to the commit from the tag v1.7.3.6\nRunning the following commands will build the library for the respective platform into buildSrc:\ncd jni\ncmake .\nmake\n\nAlong with this, I updated the README to reflect these changes.\nBy submitting this pull request, I confirm that you can use, modify, copy, and redistribute this contribution, under the terms of your choice.", "createdAt": "2020-04-06T17:11:06Z", "url": "https://github.com/opendistro-for-elasticsearch/k-NN/pull/83", "merged": true, "mergeCommit": {"oid": "4b4cc3157da81d529dd0211792c3689d517aaa1f"}, "closed": true, "closedAt": "2020-04-09T19:59:24Z", "author": {"login": "jmazanec15"}, "timelineItems": {"totalCount": 9, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcU448dgH2gAyMzk5NzgzODYyOmRlZjhhNjkyOWY5ZGI2NmQwNGI2ODU1YTBlNjAzOTVkMzhiNjlkNmQ=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcWA8kBAFqTM5MTAzOTMyNA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "def8a6929f9db66d04b6855a0e60395d38b69d6d", "author": {"user": {"login": "jmazanec15", "name": "Jack Mazanec"}}, "url": "https://github.com/opendistro-for-elasticsearch/k-NN/commit/def8a6929f9db66d04b6855a0e60395d38b69d6d", "committedDate": "2020-04-06T06:41:27Z", "message": "added cmake to build library"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f066bddbdce2bcbc17cbb37f86871039356edb0f", "author": {"user": {"login": "jmazanec15", "name": "Jack Mazanec"}}, "url": "https://github.com/opendistro-for-elasticsearch/k-NN/commit/f066bddbdce2bcbc17cbb37f86871039356edb0f", "committedDate": "2020-04-06T16:07:19Z", "message": "moved submodule to v1.7.3.6"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "13b929a9c1ecefe85da2fd2f9282629f8d3538c3", "author": {"user": {"login": "jmazanec15", "name": "Jack Mazanec"}}, "url": "https://github.com/opendistro-for-elasticsearch/k-NN/commit/13b929a9c1ecefe85da2fd2f9282629f8d3538c3", "committedDate": "2020-04-06T16:20:24Z", "message": "updated CMakeLists.txt"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "eb4355795937b6ca7df4cb68f12b131e70154a0b", "author": {"user": {"login": "jmazanec15", "name": "Jack Mazanec"}}, "url": "https://github.com/opendistro-for-elasticsearch/k-NN/commit/eb4355795937b6ca7df4cb68f12b131e70154a0b", "committedDate": "2020-04-06T17:02:16Z", "message": "added library build information"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "19eee61e86576c509af99ee33e82ef70f330f7b4", "author": {"user": {"login": "jmazanec15", "name": "Jack Mazanec"}}, "url": "https://github.com/opendistro-for-elasticsearch/k-NN/commit/19eee61e86576c509af99ee33e82ef70f330f7b4", "committedDate": "2020-04-06T17:09:02Z", "message": "added license headers"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzg5NjQ3MDY1", "url": "https://github.com/opendistro-for-elasticsearch/k-NN/pull/83#pullrequestreview-389647065", "createdAt": "2020-04-08T04:38:41Z", "commit": {"oid": "19eee61e86576c509af99ee33e82ef70f330f7b4"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wOFQwNDozODo0MVrOGCeuIg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wOFQwNDozODo0MVrOGCeuIg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNTI1MzY2Ng==", "bodyText": "Probably need ${CMAKE_CURRENT_SOURCE_DIR}/external/nmslib/similarity_search", "url": "https://github.com/opendistro-for-elasticsearch/k-NN/pull/83#discussion_r405253666", "createdAt": "2020-04-08T04:38:41Z", "author": {"login": "chenqi0805"}, "path": "jni/CMakeLists.txt", "diffHunk": "@@ -0,0 +1,56 @@\n+#\n+#   Copyright 2019 Amazon.com, Inc. or its affiliates. All Rights Reserved.\n+#\n+#   Licensed under the Apache License, Version 2.0 (the \"License\").\n+#   You may not use this file except in compliance with the License.\n+#   A copy of the License is located at\n+#\n+#       http://www.apache.org/licenses/LICENSE-2.0\n+#\n+#   or in the \"license\" file accompanying this file. This file is distributed\n+#   on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either\n+#   express or implied. See the License for the specific language governing\n+#   permissions and limitations under the License.\n+#\n+\n+cmake_minimum_required(VERSION 2.8)\n+\n+project(KNNIndexV1_7_3_6)\n+\n+set(CMAKE_CXX_STANDARD 11)\n+set(CMAKE_CXX_STANDARD_REQUIRED True)\n+\n+# Target Library to be built\n+set(KNN_INDEX KNNIndexV1_7_3_6)\n+\n+# Check if similarity search exists\n+find_path(NMS_REPO_DIR NAMES similarity_search PATHS ${CMAKE_CURRENT_SOURCE_DIR}/external/nmslib REQUIRED)\n+\n+# If not, pull the updated submodule\n+if (NOT EXISTS ${NMS_REPO_DIR})\n+    message(STATUS \"Could not find nmslib. Pulling updated submodule.\")\n+    execute_process(COMMAND git submodule update --init -- external/nmslib WORKING_DIRECTORY ${CMAKE_CURRENT_SOURCE_DIR})\n+endif ()\n+\n+# Add the subdirectory so it is possible to use its targets\n+add_subdirectory(external/nmslib/similarity_search)", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "19eee61e86576c509af99ee33e82ef70f330f7b4"}, "originalPosition": 36}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "801534aff21a8069b18a98919a0bb62b2c7de63f", "author": {"user": {"login": "jmazanec15", "name": "Jack Mazanec"}}, "url": "https://github.com/opendistro-for-elasticsearch/k-NN/commit/801534aff21a8069b18a98919a0bb62b2c7de63f", "committedDate": "2020-04-08T17:26:58Z", "message": "Updated CMakeLists"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzkwMzkxNjc5", "url": "https://github.com/opendistro-for-elasticsearch/k-NN/pull/83#pullrequestreview-390391679", "createdAt": "2020-04-08T23:11:05Z", "commit": {"oid": "801534aff21a8069b18a98919a0bb62b2c7de63f"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wOFQyMzoxMTowNVrOGDEHMQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wOFQyMzoxMTowNVrOGDEHMQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNTg2NjI4OQ==", "bodyText": "I find out that .dylib will facilitate debugging jni code. Specifically, one can use \"attach to process\" in C++ IDE to successfully attach to jps. For .jnilib it will not work for unknown reason. Maybe it is worth building an extra shared library on macOS to facilitate development?", "url": "https://github.com/opendistro-for-elasticsearch/k-NN/pull/83#discussion_r405866289", "createdAt": "2020-04-08T23:11:05Z", "author": {"login": "chenqi0805"}, "path": "jni/CMakeLists.txt", "diffHunk": "@@ -0,0 +1,56 @@\n+#\n+#   Copyright 2019 Amazon.com, Inc. or its affiliates. All Rights Reserved.\n+#\n+#   Licensed under the Apache License, Version 2.0 (the \"License\").\n+#   You may not use this file except in compliance with the License.\n+#   A copy of the License is located at\n+#\n+#       http://www.apache.org/licenses/LICENSE-2.0\n+#\n+#   or in the \"license\" file accompanying this file. This file is distributed\n+#   on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either\n+#   express or implied. See the License for the specific language governing\n+#   permissions and limitations under the License.\n+#\n+\n+cmake_minimum_required(VERSION 2.8)\n+\n+project(KNNIndexV1_7_3_6)\n+\n+set(CMAKE_CXX_STANDARD 11)\n+set(CMAKE_CXX_STANDARD_REQUIRED True)\n+\n+# Target Library to be built\n+set(KNN_INDEX KNNIndexV1_7_3_6)\n+\n+# Check if similarity search exists\n+find_path(NMS_REPO_DIR NAMES similarity_search PATHS ${CMAKE_CURRENT_SOURCE_DIR}/external/nmslib REQUIRED)\n+\n+# If not, pull the updated submodule\n+if (NOT EXISTS ${NMS_REPO_DIR})\n+    message(STATUS \"Could not find nmslib. Pulling updated submodule.\")\n+    execute_process(COMMAND git submodule update --init -- external/nmslib WORKING_DIRECTORY ${CMAKE_CURRENT_SOURCE_DIR})\n+endif ()\n+\n+# Add the subdirectory so it is possible to use its targets\n+add_subdirectory(${CMAKE_CURRENT_SOURCE_DIR}/external/nmslib/similarity_search)\n+\n+# Set OS specific variables\n+if (${CMAKE_SYSTEM_NAME} STREQUAL Darwin)\n+    set(JVM_OS_TYPE darwin)\n+    set(LIB_EXT .jnilib)", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "801534aff21a8069b18a98919a0bb62b2c7de63f"}, "originalPosition": 41}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzkxMDM5MzI0", "url": "https://github.com/opendistro-for-elasticsearch/k-NN/pull/83#pullrequestreview-391039324", "createdAt": "2020-04-09T18:38:34Z", "commit": {"oid": "801534aff21a8069b18a98919a0bb62b2c7de63f"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1340, "cost": 1, "resetAt": "2021-11-01T16:19:10Z"}}}