{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDc3NzUzODMw", "number": 3562, "title": "fix: fix Maven source and test source directory resolving", "bodyText": "By climbing the pom.xml hierarchy to find the nearest ancestor that declares the source directory rather than immediately falling back to src/(main|test)/java if not declared in this immediate pom.\nAlso added interpolating (project|pom|'').basedir which is not uncommonly found in projects.", "createdAt": "2020-09-02T11:27:23Z", "url": "https://github.com/INRIA/spoon/pull/3562", "merged": true, "mergeCommit": {"oid": "ee739b573c54f832b6a3b7ec7d3d9f0bd60af975"}, "closed": true, "closedAt": "2020-09-09T13:59:44Z", "author": {"login": "Strum355"}, "timelineItems": {"totalCount": 10, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdFQQUrABqjM3MjQ2MDg3OTU=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdHLYDaABqjM3NDU1ODU3ODA=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "d136f1dfba3e2b4454f514d500bd9d0a57a20f27", "author": {"user": {"login": "Strum355", "name": "Noah S-C"}}, "url": "https://github.com/INRIA/spoon/commit/d136f1dfba3e2b4454f514d500bd9d0a57a20f27", "committedDate": "2020-09-03T13:02:12Z", "message": "Added test for getting maven source directory from ancestors"}, "afterCommit": {"oid": "7c8b185992adad130004f6144a83372a63ecf553", "author": {"user": {"login": "Strum355", "name": "Noah S-C"}}, "url": "https://github.com/INRIA/spoon/commit/7c8b185992adad130004f6144a83372a63ecf553", "committedDate": "2020-09-03T13:03:02Z", "message": "Added test for getting maven source directory from ancestors"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "aa0f9b7be3208a4c4190644e321df64feafc5a0a", "author": {"user": {"login": "Strum355", "name": "Noah S-C"}}, "url": "https://github.com/INRIA/spoon/commit/aa0f9b7be3208a4c4190644e321df64feafc5a0a", "committedDate": "2020-09-09T11:08:10Z", "message": "Improved source and test source directory resolving by climbing the pom.xml hierarchy to find the nearest ancestor that declares the source directory. Also added interpolating (project|pom|'').basedir"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "8287583d88ccb7270c21f0aa5697882333ca12b0", "author": {"user": {"login": "Strum355", "name": "Noah S-C"}}, "url": "https://github.com/INRIA/spoon/commit/8287583d88ccb7270c21f0aa5697882333ca12b0", "committedDate": "2020-09-09T11:08:11Z", "message": "Made 'SpoonPom.addModule' public to facilitate adding modules that are not linked via pom.xml to the model"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "589755f15f48b45e7b236a23dcc0e71aba4303fa", "author": {"user": {"login": "Strum355", "name": "Noah S-C"}}, "url": "https://github.com/INRIA/spoon/commit/589755f15f48b45e7b236a23dcc0e71aba4303fa", "committedDate": "2020-09-09T11:08:49Z", "message": "Added test for getting maven source directory from ancestors"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "4e8c5477f2be593680d4ba02590007b77046ddc6", "author": {"user": {"login": "Strum355", "name": "Noah S-C"}}, "url": "https://github.com/INRIA/spoon/commit/4e8c5477f2be593680d4ba02590007b77046ddc6", "committedDate": "2020-09-09T11:05:39Z", "message": "Added dummy file so folder exists for test case"}, "afterCommit": {"oid": "d6ca1ea419e75250b27a12d544d24d58bf466175", "author": {"user": {"login": "Strum355", "name": "Noah S-C"}}, "url": "https://github.com/INRIA/spoon/commit/d6ca1ea419e75250b27a12d544d24d58bf466175", "committedDate": "2020-09-09T11:08:50Z", "message": "Added dummy file so folder exists for test case"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "d6ca1ea419e75250b27a12d544d24d58bf466175", "author": {"user": {"login": "Strum355", "name": "Noah S-C"}}, "url": "https://github.com/INRIA/spoon/commit/d6ca1ea419e75250b27a12d544d24d58bf466175", "committedDate": "2020-09-09T11:08:50Z", "message": "Added dummy file so folder exists for test case"}, "afterCommit": {"oid": "76db1d31cb9ae94aac3a135010598195f980062a", "author": {"user": {"login": "Strum355", "name": "Noah S-C"}}, "url": "https://github.com/INRIA/spoon/commit/76db1d31cb9ae94aac3a135010598195f980062a", "committedDate": "2020-09-09T11:09:24Z", "message": "Added dummy file so folder exists for test case"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "76db1d31cb9ae94aac3a135010598195f980062a", "author": {"user": {"login": "Strum355", "name": "Noah S-C"}}, "url": "https://github.com/INRIA/spoon/commit/76db1d31cb9ae94aac3a135010598195f980062a", "committedDate": "2020-09-09T11:09:24Z", "message": "Added dummy file so folder exists for test case"}, "afterCommit": {"oid": "be9816fb806ac46521dea80fd4b60ceda19762e7", "author": {"user": {"login": "Strum355", "name": "Noah S-C"}}, "url": "https://github.com/INRIA/spoon/commit/be9816fb806ac46521dea80fd4b60ceda19762e7", "committedDate": "2020-09-09T11:09:52Z", "message": "Added dummy file so folder exists for test case"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDg0OTUzNDQ2", "url": "https://github.com/INRIA/spoon/pull/3562#pullrequestreview-484953446", "createdAt": "2020-09-09T12:25:55Z", "commit": {"oid": "be9816fb806ac46521dea80fd4b60ceda19762e7"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0wOVQxMjoyNTo1NVrOHPE0VQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0wOVQxMjoyNTo1NVrOHPE0VQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NTU2OTYyMQ==", "bodyText": "expected should be the second argument, not the last\nyou can remove the first one, the message, not relevant here", "url": "https://github.com/INRIA/spoon/pull/3562#discussion_r485569621", "createdAt": "2020-09-09T12:25:55Z", "author": {"login": "monperrus"}, "path": "src/test/java/spoon/support/compiler/SpoonPomTest.java", "diffHunk": "@@ -51,4 +52,20 @@ public void checkProfilesModules(String path, String[] expected, Pattern profile\n \t\t\tassertEquals(expected[i], modules.get(i).getName());\n \t\t}\n \t}\n+\t\n+\tpublic void getSourceDirectory() throws IOException, XmlPullParserException {\n+\t\tcheckSourceDirectory(\n+\t\t\t\"src/test/resources/maven-launcher/hierarchy\",\n+\t\t\tPaths.get(\"src/test/resources/maven-launcher/hierarchy/child/src\").toAbsolutePath().toString()\n+\t\t);\n+\t}\n+\n+\tpublic void checkSourceDirectory(String path, String expected) throws IOException, XmlPullParserException {\n+\t\tSpoonPom pomModel = new SpoonPom(path, null, MavenLauncher.SOURCE_TYPE.APP_SOURCE, new StandardEnvironment());\n+\n+\t\tSpoonPom childModel = pomModel.getModules().get(0);\n+\t\t//contract: source directory is derived from parent pom.xml if not declared in the current\n+\t\t// (childModel) SpoonPom\n+\t\tassertEquals(expected, childModel.getSourceDirectories().get(0).getAbsolutePath(), expected);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "be9816fb806ac46521dea80fd4b60ceda19762e7"}, "originalPosition": 26}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "1d27d680a42b9586b1123da6d9c23aca9da0169f", "author": {"user": {"login": "Strum355", "name": "Noah S-C"}}, "url": "https://github.com/INRIA/spoon/commit/1d27d680a42b9586b1123da6d9c23aca9da0169f", "committedDate": "2020-09-09T12:29:47Z", "message": "Added dummy file so folder exists for test case"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "be9816fb806ac46521dea80fd4b60ceda19762e7", "author": {"user": {"login": "Strum355", "name": "Noah S-C"}}, "url": "https://github.com/INRIA/spoon/commit/be9816fb806ac46521dea80fd4b60ceda19762e7", "committedDate": "2020-09-09T11:09:52Z", "message": "Added dummy file so folder exists for test case"}, "afterCommit": {"oid": "1d27d680a42b9586b1123da6d9c23aca9da0169f", "author": {"user": {"login": "Strum355", "name": "Noah S-C"}}, "url": "https://github.com/INRIA/spoon/commit/1d27d680a42b9586b1123da6d9c23aca9da0169f", "committedDate": "2020-09-09T12:29:47Z", "message": "Added dummy file so folder exists for test case"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1354, "cost": 1, "resetAt": "2021-11-01T14:51:55Z"}}}