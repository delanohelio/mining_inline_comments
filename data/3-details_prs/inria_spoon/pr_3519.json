{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDYxOTk0NDkz", "number": 3519, "title": "fix: fix bug in CtLineElementComparator", "bodyText": "Core Problem\nAs we saw in issue #3514 analyzing Palladio-SimuLizar produces jdk erros while sorting.\nThe reason for this is because the CtLineComparator does not follow the compareTo contract. This patch fixes the comparator.\nSome Math Stuff\nA comparator must follow the compareTo contract in java. The compareTo contract defines two formulas:\n(1)  antisymmetric sgn(x.compareTo(y)) == -sgn(y.compareTo(x))\n(2)  transitive (x.compareTo(y)>0 && y.compareTo(z)>0) => x.compareTo(z)>0\nAssuming we have 3 points X,Y and Z and all points have invalid positions.\ncompareTo(X,Y) == -1 ==> X < Y\ncompareTo(Y,Z) == -1 ==> Y < Z\ncompareTo(X,Z) == -1 ==> X < Z\nLooks good till here but now:\ncompareTo(Z,X) == -1 => Z<X\nhere we violate the transitive requirement. Because Z is now less than X.\nIf we do the same after the change:\ncompareTo(X,Y) == 0 ==> X=Y\ncompareTo(Y,Z) == 0 ==> Y=Z\ncompareTo(X,Z) == 0 ==> X=Z\ncompareTo(Z,X) == 0 ==> Z=X\nThe change still follows the antisymmetric contract, because sign(0)=0== -sign(0).\nConsequences\nSome testcases relay on the old sorting, because order was different. Some refactoring for the testcases is needed.\nThere is a risk, that some users have problems with new correct ordering.", "createdAt": "2020-08-03T07:15:47Z", "url": "https://github.com/INRIA/spoon/pull/3519", "merged": true, "mergeCommit": {"oid": "2714ff0f0b255e53927d625930cc38e0964fa910"}, "closed": true, "closedAt": "2020-08-18T12:45:57Z", "author": {"login": "MartinWitt"}, "timelineItems": {"totalCount": 11, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABc7M6tWAH2gAyNDYxOTk0NDkzOjA1ZWZkMDk0ZGY1YmUxNGY2YTQyOGNmYWRiNzI3MDFhNTA3ODJhYjE=", "endCursor": "Y3Vyc29yOnYyOpPPAAABc_3Y1egH2gAyNDYxOTk0NDkzOjYxMGJkODQ5YzA0OGYyMjljZDA4NzFkYmRjYTZiNDVhYTA3MGVmY2Q=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "05efd094df5be14f6a428cfadb72701a50782ab1", "author": {"user": {"login": "MartinWitt", "name": null}}, "url": "https://github.com/INRIA/spoon/commit/05efd094df5be14f6a428cfadb72701a50782ab1", "committedDate": "2020-08-03T07:30:36Z", "message": " fix comparator"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "207771cb3448eb24c01e1dcfaa5c6789638c16e2", "author": {"user": {"login": "MartinWitt", "name": null}}, "url": "https://github.com/INRIA/spoon/commit/207771cb3448eb24c01e1dcfaa5c6789638c16e2", "committedDate": "2020-08-03T07:02:20Z", "message": " delete randomn patch file"}, "afterCommit": {"oid": "05efd094df5be14f6a428cfadb72701a50782ab1", "author": {"user": {"login": "MartinWitt", "name": null}}, "url": "https://github.com/INRIA/spoon/commit/05efd094df5be14f6a428cfadb72701a50782ab1", "committedDate": "2020-08-03T07:30:36Z", "message": " fix comparator"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "08580cd2142b3ee8bbca6c58312c8fa4114aeb7c", "author": {"user": {"login": "MartinWitt", "name": null}}, "url": "https://github.com/INRIA/spoon/commit/08580cd2142b3ee8bbca6c58312c8fa4114aeb7c", "committedDate": "2020-08-06T17:37:37Z", "message": "remove checks, because we cant relay on a sorting\nif all constructors have invalid positions."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "3a0e5ad85e30e0b230cfc0de789e00fe578c22a0", "author": {"user": {"login": "MartinWitt", "name": null}}, "url": "https://github.com/INRIA/spoon/commit/3a0e5ad85e30e0b230cfc0de789e00fe578c22a0", "committedDate": "2020-08-06T18:01:17Z", "message": "generate visitors"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "d92ecdb798f4bc797e7c2fdb16cfbe188987a5d5", "author": {"user": {"login": "MartinWitt", "name": null}}, "url": "https://github.com/INRIA/spoon/commit/d92ecdb798f4bc797e7c2fdb16cfbe188987a5d5", "committedDate": "2020-08-08T18:44:01Z", "message": "update comment to describe the new behavior."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "99629c231050555cf6b3e46d1d9486f210485957", "author": {"user": {"login": "MartinWitt", "name": null}}, "url": "https://github.com/INRIA/spoon/commit/99629c231050555cf6b3e46d1d9486f210485957", "committedDate": "2020-08-08T18:44:26Z", "message": "Fix checkstyle:\n- Add missing newline add end of file"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "da180c36efdd0bfdf10dcd53c41a47bc3ce440bf", "author": {"user": {"login": "MartinWitt", "name": null}}, "url": "https://github.com/INRIA/spoon/commit/da180c36efdd0bfdf10dcd53c41a47bc3ce440bf", "committedDate": "2020-08-08T19:01:54Z", "message": " update licence header"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f8ec5382809ded91f4988e288d12e9e5f5a93a06", "author": {"user": {"login": "MartinWitt", "name": null}}, "url": "https://github.com/INRIA/spoon/commit/f8ec5382809ded91f4988e288d12e9e5f5a93a06", "committedDate": "2020-08-14T09:06:31Z", "message": "Merge branch 'master' into comparatorBug"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDY3NDY4NDAx", "url": "https://github.com/INRIA/spoon/pull/3519#pullrequestreview-467468401", "createdAt": "2020-08-14T10:20:46Z", "commit": {"oid": "da180c36efdd0bfdf10dcd53c41a47bc3ce440bf"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xNFQxMDoyMDo0N1rOHAviMg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xNFQxMDoyMDo0N1rOHAviMg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MDU0MDg1MA==", "bodyText": "it's better to change the expected value than to remove assertions.", "url": "https://github.com/INRIA/spoon/pull/3519#discussion_r470540850", "createdAt": "2020-08-14T10:20:47Z", "author": {"login": "monperrus"}, "path": "src/test/java/spoon/test/ctClass/CtClassTest.java", "diffHunk": "@@ -95,18 +95,10 @@ public void getConstructor() throws Exception {\n \t\tcons.addParameter(cons.getFactory().createParameter().setType(cons.getFactory().Type().OBJECT));\n \t\t// now that we have changed the signature we can call getConstructors safely\n \t\tassertEquals(4, foo.getConstructors().size());\n-\t\t// we cloned the first constructor, so it has the same position, and comes before the 2nd and 3rd constructor\n-\t\tassertSame(cons, foo.getTypeMembers().get(1));", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "da180c36efdd0bfdf10dcd53c41a47bc3ce440bf"}, "originalPosition": 5}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "34df6296a2b1785b3b50372259def1bec30a8c71", "author": {"user": {"login": "MartinWitt", "name": null}}, "url": "https://github.com/INRIA/spoon/commit/34df6296a2b1785b3b50372259def1bec30a8c71", "committedDate": "2020-08-17T13:56:35Z", "message": "readd assertion"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "610bd849c048f229cd0871dbdca6b45aa070efcd", "author": {"user": {"login": "MartinWitt", "name": null}}, "url": "https://github.com/INRIA/spoon/commit/610bd849c048f229cd0871dbdca6b45aa070efcd", "committedDate": "2020-08-17T19:15:13Z", "message": "Update CtClassTest.java\n\nremove sysout"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1339, "cost": 1, "resetAt": "2021-11-01T14:51:55Z"}}}