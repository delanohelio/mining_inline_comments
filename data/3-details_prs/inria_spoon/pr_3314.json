{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0MzkzNzMyMTA1", "number": 3314, "title": "feature: add support for java 14 switch/yield", "bodyText": "Java 14 Switches\nJep361 defines a new switchExpression.\nswitch (day) {\n    case MONDAY, FRIDAY, SUNDAY -> System.out.println(6);\n    case TUESDAY                -> System.out.println(7);\n    case THURSDAY, SATURDAY     -> System.out.println(8);\n    case WEDNESDAY              -> System.out.println(9);\n}\n@Egor18 implemented them already without yield( awesome work btw).\nThis pr adds support for java14 switches with yield and with this change spoon supports all java14 features that are non preview(records and textblocks are only part of jdt beta branch and still preview)\nWhats part of this PR\n\nRemove break [expression] and java 12 preview switches\nadd support for yieldStatements in switch\nupgrade jdt version 3.20\nfully refactor switchCaseTest to junit5\n\nConsequences\nThere are 2 consequence expect more code.\nspoon loses the ability to parse java 12 preview code with break [expression]\nCurrently spoon supports them, but i would instantly drop support for a feature that was never part java (only preview) and wont come back. Yield replaces this.\nSupported preview features should be seen as an experimental feature and i hope no one is relaying on them.\n####junit5 in testclasses####\nI cant guarantee that every testrunner in everyones IDE fully supports junit5.\nI would be nice if you could test the refactored SwitchCaseTest.\nReward is a much clearer design for the testclasses.\nupgrading jdt to 3.20 produced 2 problems\nLuckily there were only 2 visible problems after upgrading it.\nbreak.isImplicit flag was removed\nwasn't a big problem, because there are no longer needed.\nPackageBinding.java was changed to a abstract class\nIs a bigger problem, but current there is a fix.\nFor (potential) fix see src/main/java/spoon/support/compiler/jdt/ReferenceBuilder.java#363\nMaybe someone with more knowledge about this class could review it.\ninteresting more academic fact\nIs allowed code\nint a = switch(\"a){\ndefault -> {yield 3;}\n};\nbut the following is not allowed.\nint a = switch(\"a){\ndefault -> yield 3;\n};\nThis behavior seems intended, because looking at java grammar we find:\nSwitchRule:\nSwitchLabel -> Expression ;\nSwitchLabel -> Block\nSwitchLabel -> ThrowStatement\nand yield is not an expression but a StatementWithoutTrailingSubstatement from my understanding.\ntl;dr;\n\nspoon supports java 14 switches with yield\nIf you have some knowledge about some parts of spoon feel free to review the new code with new tests", "createdAt": "2020-03-25T17:43:11Z", "url": "https://github.com/INRIA/spoon/pull/3314", "merged": true, "mergeCommit": {"oid": "e7d42138db21a59beff566af22d72aca4141ddbc"}, "closed": true, "closedAt": "2020-04-01T08:23:15Z", "author": {"login": "MartinWitt"}, "timelineItems": {"totalCount": 18, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcQkbpXgH2gAyMzkzNzMyMTA1OjZlYzBmN2U1YmFlMGEwNjYzYWVjZjE0ZWFmZDI4ZjM5MDBiZTIyZGM=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcRx3GyAH2gAyMzkzNzMyMTA1OjY4YWVkNWIzNmY3ODJjMDkwMzQ1YWZjODUzMzAyNGI5ZjhmMjdlZDI=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "6ec0f7e5bae0a0663aecf14eafd28f3900be22dc", "author": {"user": {"login": "MartinWitt", "name": null}}, "url": "https://github.com/INRIA/spoon/commit/6ec0f7e5bae0a0663aecf14eafd28f3900be22dc", "committedDate": "2020-03-23T20:35:39Z", "message": "bump jdt"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ca300a926892ec474e1306f327c2c0279c289a66", "author": {"user": {"login": "MartinWitt", "name": null}}, "url": "https://github.com/INRIA/spoon/commit/ca300a926892ec474e1306f327c2c0279c289a66", "committedDate": "2020-03-25T16:30:30Z", "message": "add java14 yield, refactor switchCaseTest fully for junit5"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f4e0a3b04f2e9dc01e6f6ee54546e8627f62ef78", "author": {"user": {"login": "MartinWitt", "name": null}}, "url": "https://github.com/INRIA/spoon/commit/f4e0a3b04f2e9dc01e6f6ee54546e8627f62ef78", "committedDate": "2020-03-25T16:35:53Z", "message": "add displaynames to tests"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a45f3a75ba9d3b431d6229fdb6dc2dfaa881cdad", "author": {"user": {"login": "MartinWitt", "name": null}}, "url": "https://github.com/INRIA/spoon/commit/a45f3a75ba9d3b431d6229fdb6dc2dfaa881cdad", "committedDate": "2020-03-25T16:38:24Z", "message": "add CtYieldStatement to doc"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "843161fa0d92a0bc050756c27f8eb3e58ee83d1b", "author": {"user": {"login": "MartinWitt", "name": null}}, "url": "https://github.com/INRIA/spoon/commit/843161fa0d92a0bc050756c27f8eb3e58ee83d1b", "committedDate": "2020-03-25T16:42:47Z", "message": " fix imports"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "50843d6cc032f76de5a2af23facf71bfa8079c60", "author": {"user": {"login": "MartinWitt", "name": null}}, "url": "https://github.com/INRIA/spoon/commit/50843d6cc032f76de5a2af23facf71bfa8079c60", "committedDate": "2020-03-25T17:32:51Z", "message": "fix doc for yield and testcase"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "d50cfe9e498b9fddfee899b968e564730b520314", "author": {"user": {"login": "MartinWitt", "name": null}}, "url": "https://github.com/INRIA/spoon/commit/d50cfe9e498b9fddfee899b968e564730b520314", "committedDate": "2020-03-25T17:42:25Z", "message": "remove unused role"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e9eec9152e4303602f61f92d9b6e6bc70dea615b", "author": {"user": {"login": "MartinWitt", "name": null}}, "url": "https://github.com/INRIA/spoon/commit/e9eec9152e4303602f61f92d9b6e6bc70dea615b", "committedDate": "2020-03-25T19:14:43Z", "message": "fix compilation, list.of->Arrays.asList"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "2c0c689d39136796992ad3bb4e127a3f23cabea9", "author": {"user": {"login": "MartinWitt", "name": null}}, "url": "https://github.com/INRIA/spoon/commit/2c0c689d39136796992ad3bb4e127a3f23cabea9", "committedDate": "2020-03-25T19:20:41Z", "message": "fix testGenerateRoleHandler"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzgxNDcyODI3", "url": "https://github.com/INRIA/spoon/pull/3314#pullrequestreview-381472827", "createdAt": "2020-03-25T19:33:35Z", "commit": {"oid": "2c0c689d39136796992ad3bb4e127a3f23cabea9"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yNVQxOTozMzozNVrOF7rKKg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yNVQxOTozMzozNVrOF7rKKg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5ODExNzQxOA==", "bodyText": "#3314 just as a link", "url": "https://github.com/INRIA/spoon/pull/3314#discussion_r398117418", "createdAt": "2020-03-25T19:33:35Z", "author": {"login": "MartinWitt"}, "path": "src/main/java/spoon/support/compiler/jdt/ReferenceBuilder.java", "diffHunk": "@@ -358,8 +360,14 @@ CtReference getDeclaringReferenceFromImports(char[] expectedName) {\n \t\t\t\t\t\tif (packageBinding == null || packageBinding instanceof ProblemPackageBinding) {\n \t\t\t\t\t\t\t// Big crisis here. We are already in noclasspath mode but JDT doesn't support always\n \t\t\t\t\t\t\t// creation of a package in this mode. So, if we are in this brace, we make the job of JDT...\n-\t\t\t\t\t\t\tpackageBinding = new PackageBinding(chars, null, environment, environment.module);\n-\t\t\t\t\t\t}\n+\t\t\t\t\t\t\tpackageBinding = new PackageBinding(chars, null, environment, environment.module) {\n+\t\t\t\t\t\t\t\t@Override\n+\t\t\t\t\t\t\t\tpublic PlainPackageBinding getIncarnation(ModuleBinding arg0) {\n+\t\t\t\t\t\t\t\t\t//https://github.com/eclipse/eclipse.jdt.core/blob/master/org.eclipse.jdt.core/compiler/org/eclipse/jdt/internal/compiler/lookup/PlainPackageBinding.java#L43", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "2c0c689d39136796992ad3bb4e127a3f23cabea9"}, "originalPosition": 20}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e6fbbb6f890ef39a54e1636c174a1de70866075b", "author": {"user": {"login": "MartinWitt", "name": null}}, "url": "https://github.com/INRIA/spoon/commit/e6fbbb6f890ef39a54e1636c174a1de70866075b", "committedDate": "2020-03-25T19:38:07Z", "message": "add newlines"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "7853d1e6ecfcb7e925205c03122948e48a87fc3e", "author": {"user": {"login": "MartinWitt", "name": null}}, "url": "https://github.com/INRIA/spoon/commit/7853d1e6ecfcb7e925205c03122948e48a87fc3e", "committedDate": "2020-03-25T19:57:10Z", "message": "fix doc"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ab64ce68caafc538befc11c9bf4e49c79a13f269", "author": {"user": {"login": "MartinWitt", "name": null}}, "url": "https://github.com/INRIA/spoon/commit/ab64ce68caafc538befc11c9bf4e49c79a13f269", "committedDate": "2020-03-25T20:15:00Z", "message": " replace -> with -&gt;"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzgyNjgxMzU1", "url": "https://github.com/INRIA/spoon/pull/3314#pullrequestreview-382681355", "createdAt": "2020-03-27T09:06:03Z", "commit": {"oid": "ab64ce68caafc538befc11c9bf4e49c79a13f269"}, "state": "COMMENTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yN1QwOTowNjowNFrOF8oeJA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yN1QwOTowOTo1MVrOF8omNg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5OTEyMTk1Ng==", "bodyText": "to be removed", "url": "https://github.com/INRIA/spoon/pull/3314#discussion_r399121956", "createdAt": "2020-03-27T09:06:04Z", "author": {"login": "monperrus"}, "path": "src/main/java/spoon/reflect/visitor/CtAbstractVisitor.java", "diffHunk": "@@ -523,4 +524,9 @@ public void visitCtPackageDeclaration(CtPackageDeclaration packageDeclaration) {\n \tpublic void visitCtTypeMemberWildcardImportReference(CtTypeMemberWildcardImportReference wildcardReference) {\n \n \t}\n+\n+\t@Override\n+\tpublic void visitCtYieldStatement(CtYieldStatement statement) {\n+\t\tString foo = \"\";", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ab64ce68caafc538befc11c9bf4e49c79a13f269"}, "originalPosition": 15}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5OTEyNDAyMg==", "bodyText": "I don't understand, what do you mean?", "url": "https://github.com/INRIA/spoon/pull/3314#discussion_r399124022", "createdAt": "2020-03-27T09:09:51Z", "author": {"login": "monperrus"}, "path": "src/main/java/spoon/support/compiler/jdt/ReferenceBuilder.java", "diffHunk": "@@ -358,8 +360,14 @@ CtReference getDeclaringReferenceFromImports(char[] expectedName) {\n \t\t\t\t\t\tif (packageBinding == null || packageBinding instanceof ProblemPackageBinding) {\n \t\t\t\t\t\t\t// Big crisis here. We are already in noclasspath mode but JDT doesn't support always\n \t\t\t\t\t\t\t// creation of a package in this mode. So, if we are in this brace, we make the job of JDT...\n-\t\t\t\t\t\t\tpackageBinding = new PackageBinding(chars, null, environment, environment.module);\n-\t\t\t\t\t\t}\n+\t\t\t\t\t\t\tpackageBinding = new PackageBinding(chars, null, environment, environment.module) {\n+\t\t\t\t\t\t\t\t@Override\n+\t\t\t\t\t\t\t\tpublic PlainPackageBinding getIncarnation(ModuleBinding arg0) {\n+\t\t\t\t\t\t\t\t\t//https://github.com/eclipse/eclipse.jdt.core/blob/master/org.eclipse.jdt.core/compiler/org/eclipse/jdt/internal/compiler/lookup/PlainPackageBinding.java#L43", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5ODExNzQxOA=="}, "originalCommit": {"oid": "2c0c689d39136796992ad3bb4e127a3f23cabea9"}, "originalPosition": 20}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "d3234fa71cac1860b23baeaa711d218b1eebfb23", "author": {"user": {"login": "MartinWitt", "name": null}}, "url": "https://github.com/INRIA/spoon/commit/d3234fa71cac1860b23baeaa711d218b1eebfb23", "committedDate": "2020-03-27T11:44:04Z", "message": "remove debug stub"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a3276fa482f30b65272484f8845ea83a8cd1fecb", "author": {"user": {"login": "MartinWitt", "name": null}}, "url": "https://github.com/INRIA/spoon/commit/a3276fa482f30b65272484f8845ea83a8cd1fecb", "committedDate": "2020-03-27T11:47:31Z", "message": "fix whitespaces in pom.xml"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "818e40a7fc0cb0a7bcff9e77f8a4607769dc8184", "author": {"user": {"login": "MartinWitt", "name": null}}, "url": "https://github.com/INRIA/spoon/commit/818e40a7fc0cb0a7bcff9e77f8a4607769dc8184", "committedDate": "2020-03-27T12:19:38Z", "message": "Update DefaultJavaPrettyPrinter.java\n\nremove wrong comment"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "68aed5b36f782c090345afc8533024b9f8f27ed2", "author": {"user": {"login": "MartinWitt", "name": null}}, "url": "https://github.com/INRIA/spoon/commit/68aed5b36f782c090345afc8533024b9f8f27ed2", "committedDate": "2020-03-27T14:48:20Z", "message": "add explanation to the new anonymous class"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1362, "cost": 1, "resetAt": "2021-11-01T14:51:55Z"}}}