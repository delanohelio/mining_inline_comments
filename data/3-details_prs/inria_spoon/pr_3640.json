{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDk5MDgxMTgx", "number": 3640, "title": "fix(CtLineElementComparator): one can add two values to an annotation", "bodyText": "fix #3639 .\nI seems that the entry set of the values contained an CtAnnotationImpl are ordered based on their source position. The issue is that so far CtLineElementComparator#compare() returns 0 if both element have NoSourcePosition. But this is the case when both elements are constructed programmatically. Hence the entry set arbitrarily retains only one of them.\nMy proposed solution is to make CtLineElementComparator#compare() returns 0 only if both elements have the same exact position or if both elements have NoSourcePosition and are equals. Otherwise we return -1 (i.e. order them aribtrarily). This way our entry set is pseudo order but does not delete unequals elements.", "createdAt": "2020-10-07T08:38:38Z", "url": "https://github.com/INRIA/spoon/pull/3640", "merged": true, "mergeCommit": {"oid": "97e8752b9baab3d486df8465f2f21ce4c5c2e45d"}, "closed": true, "closedAt": "2020-10-08T06:04:15Z", "author": {"login": "nharrand"}, "timelineItems": {"totalCount": 6, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdQIw7_gH2gAyNDk5MDgxMTgxOjI5ZmU1OWZkNmI4YWI3M2MyNDIyM2RlZGU4NWMwOTZlY2IzYTcyZDY=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdQK4zTgH2gAyNDk5MDgxMTgxOmNkZjYxMWYyZDdhNmMzNzA4ZWZhNTY3ZjFiYTVkZDJiYzRhOWMyNDA=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "29fe59fd6b8ab73c24223dede85c096ecb3a72d6", "author": {"user": {"login": "nharrand", "name": "Nicolas Harrand"}}, "url": "https://github.com/INRIA/spoon/commit/29fe59fd6b8ab73c24223dede85c096ecb3a72d6", "committedDate": "2020-10-07T08:32:43Z", "message": "fix(CtLineElementComparator): element with NoSourcePosition are no ordered (arbitrarily)"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "562d31fe584180c50122ad4c6b01d7415d4e9d0e", "author": {"user": {"login": "nharrand", "name": "Nicolas Harrand"}}, "url": "https://github.com/INRIA/spoon/commit/562d31fe584180c50122ad4c6b01d7415d4e9d0e", "committedDate": "2020-10-07T08:33:35Z", "message": "up"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "01cfb2855d710d4107f18249b341f3c2de7af92f", "author": {"user": {"login": "nharrand", "name": "Nicolas Harrand"}}, "url": "https://github.com/INRIA/spoon/commit/01cfb2855d710d4107f18249b341f3c2de7af92f", "committedDate": "2020-10-07T09:08:21Z", "message": "gnagnagna checkstyle"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTAzNzU3Njc3", "url": "https://github.com/INRIA/spoon/pull/3640#pullrequestreview-503757677", "createdAt": "2020-10-07T10:55:23Z", "commit": {"oid": "01cfb2855d710d4107f18249b341f3c2de7af92f"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wN1QxMDo1NToyM1rOHdttuA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wN1QxMDo1NToyM1rOHdttuA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMDkxOTczNg==", "bodyText": "If you want to respect the antisymetric property, this line could be replaced with\nreturn o1.equals(o2) ? 0 : ((o1.hashCode() < o2.hashCode()) ? -1 : 1);", "url": "https://github.com/INRIA/spoon/pull/3640#discussion_r500919736", "createdAt": "2020-10-07T10:55:23Z", "author": {"login": "nharrand"}, "path": "src/main/java/spoon/support/comparator/CtLineElementComparator.java", "diffHunk": "@@ -19,14 +19,14 @@\n public class CtLineElementComparator implements Comparator<CtElement>, Serializable {\n \n \t/**\n-\t * Returns 0 if o1 has the same position as o2, or both positions are invalid.\n-\t * Returns -1 if o1 is before o2 in the file, or o1 has no valid position.\n+\t * Returns 0 if o1 has the same position as o2, or both positions are invalid and o1.equals(o2).\n+\t * Returns -1 if o1 is before o2 in the file, or o1 has no valid position or both positions are invalid !o1.equals(o2).\n \t * Returns 1 if o2 is after o1 in the file, or o2 has no valid position.\n \t */\n \t@Override\n \tpublic int compare(CtElement o1, CtElement o2) {\n \t\tif (!o1.getPosition().isValidPosition() && !o2.getPosition().isValidPosition()) {\n-\t\t\treturn 0;\n+\t\t\treturn o1.equals(o2) ? 0 : -1;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "01cfb2855d710d4107f18249b341f3c2de7af92f"}, "originalPosition": 14}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "84e5848cedf668e343af03f4cf8433cda43a2074", "author": {"user": {"login": "nharrand", "name": "Nicolas Harrand"}}, "url": "https://github.com/INRIA/spoon/commit/84e5848cedf668e343af03f4cf8433cda43a2074", "committedDate": "2020-10-07T10:56:19Z", "message": "Update CtLineElementComparator.java"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "cdf611f2d7a6c3708efa567f1ba5dd2bc4a9c240", "author": {"user": {"login": "nharrand", "name": "Nicolas Harrand"}}, "url": "https://github.com/INRIA/spoon/commit/cdf611f2d7a6c3708efa567f1ba5dd2bc4a9c240", "committedDate": "2020-10-07T11:01:07Z", "message": "Update CtLineElementComparator.java"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1314, "cost": 1, "resetAt": "2021-11-01T14:51:55Z"}}}