{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0MzgzODg5NTY4", "number": 3283, "title": "test: add @UnresolvedBug annotation for WIP test cases", "bodyText": "Fix #3001\nadded one marker class and annotation for two features.\n@Category(UnresolvedBug.class) excludes test from CI but not from maven test.\n@GithubIssue(String) allows linking your issue number with a (failing) testcase.\nAdded check for every GitHub annotation, that an issue with the number exists and every testcase with an Category Annotation has an Github annotation.\nChecking if the issue is open would be possible, but maybe you want to link a closed issue?\nFor showcasing the new feature i add the testcase from #3281.\nIf someone likes it, it could be included in the CONTRIBUTING guide.\nThe new feature needed a json parser. Gson was pretty easy to use, but could be changed if someone wants to include a different one.\nLastly both new files need an exclusion from the SpoonArchitectureEnforcerTest::testGoodTestClassNames because having test in the classnames would harm the readability.\nwdyt?", "createdAt": "2020-03-04T21:23:15Z", "url": "https://github.com/INRIA/spoon/pull/3283", "merged": true, "mergeCommit": {"oid": "471a91214ef1ab62e4f9de417e096bf28ef56c30"}, "closed": true, "closedAt": "2020-03-10T17:23:19Z", "author": {"login": "MartinWitt"}, "timelineItems": {"totalCount": 19, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcKdrc9AH2gAyMzgzODg5NTY4OjJiYmIzNDc4OWU2NzYzYTIwMTg2YmM3YzI2MTQyN2FhZGQ2Zjk1OWY=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcMT-XCgH2gAyMzgzODg5NTY4Ojk2YmU0MTJiZDQyZGNkNGE3YjRiZDY0ZGZkNWUwNTFjNjU3OTA5OTc=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "2bbb34789e6763a20186bc7c261427aadd6f959f", "author": {"user": {"login": "MartinWitt", "name": null}}, "url": "https://github.com/INRIA/spoon/commit/2bbb34789e6763a20186bc7c261427aadd6f959f", "committedDate": "2020-03-04T21:20:02Z", "message": " add annotation for ignoring"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "51e6f04a6c560d89fff017d336eda92618be0066", "author": {"user": {"login": "MartinWitt", "name": null}}, "url": "https://github.com/INRIA/spoon/commit/51e6f04a6c560d89fff017d336eda92618be0066", "committedDate": "2020-03-04T21:39:02Z", "message": "fix args"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "5b992458964830c19b27980dae5cbeda5e96e6ec", "author": {"user": {"login": "MartinWitt", "name": null}}, "url": "https://github.com/INRIA/spoon/commit/5b992458964830c19b27980dae5cbeda5e96e6ec", "committedDate": "2020-03-04T22:05:19Z", "message": "fix ci"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "5191647f40c9f27a8bbcc84c27ab6bc5f49d9859", "author": {"user": {"login": "MartinWitt", "name": null}}, "url": "https://github.com/INRIA/spoon/commit/5191647f40c9f27a8bbcc84c27ab6bc5f49d9859", "committedDate": "2020-03-04T23:03:23Z", "message": "added test from issue 3281 for showcasing"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f7130f4ce330735707be95c21b32a989c8c5c35c", "author": {"user": {"login": "MartinWitt", "name": null}}, "url": "https://github.com/INRIA/spoon/commit/f7130f4ce330735707be95c21b32a989c8c5c35c", "committedDate": "2020-03-04T23:05:21Z", "message": "restore testcase"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "1470a62bd9f60d3f7e14b6e19c675780777a43b9", "author": {"user": {"login": "MartinWitt", "name": null}}, "url": "https://github.com/INRIA/spoon/commit/1470a62bd9f60d3f7e14b6e19c675780777a43b9", "committedDate": "2020-03-05T00:59:58Z", "message": "add checks to githubissue annotation. added gson dependecy for checking"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "5e093bb42dab58b231b34b3d24abc264f22e789d", "author": {"user": {"login": "MartinWitt", "name": null}}, "url": "https://github.com/INRIA/spoon/commit/5e093bb42dab58b231b34b3d24abc264f22e789d", "committedDate": "2020-03-05T01:07:26Z", "message": "replaced readAllBytes because it's jdk9+"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "5c78b10cddba6db554bfb3b313457990db5be442", "author": {"user": {"login": "MartinWitt", "name": null}}, "url": "https://github.com/INRIA/spoon/commit/5c78b10cddba6db554bfb3b313457990db5be442", "committedDate": "2020-03-05T01:15:42Z", "message": "fix for jdk8"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b0762e9e44b5aad63637cb3a1bd737011473b7c4", "author": {"user": {"login": "MartinWitt", "name": null}}, "url": "https://github.com/INRIA/spoon/commit/b0762e9e44b5aad63637cb3a1bd737011473b7c4", "committedDate": "2020-03-05T01:36:38Z", "message": "change testGoodTestClassNames allowing both annotations"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a4b23fc88ffeb95fa47950b19ca49626cc8d80e4", "author": {"user": {"login": "MartinWitt", "name": null}}, "url": "https://github.com/INRIA/spoon/commit/a4b23fc88ffeb95fa47950b19ca49626cc8d80e4", "committedDate": "2020-03-05T14:36:54Z", "message": "remove @supress checkstyle"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "2f2b909e33330290a585c4b623234375e4f90480", "author": {"user": {"login": "MartinWitt", "name": null}}, "url": "https://github.com/INRIA/spoon/commit/2f2b909e33330290a585c4b623234375e4f90480", "committedDate": "2020-03-05T14:42:11Z", "message": "fix imports"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "2b709182b7400e3ae30803f9530fc6b0e3e489d6", "author": {"user": {"login": "MartinWitt", "name": null}}, "url": "https://github.com/INRIA/spoon/commit/2b709182b7400e3ae30803f9530fc6b0e3e489d6", "committedDate": "2020-03-06T20:28:52Z", "message": " splitted tests and annotation, added line to contributing file, showing both annoations"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "2ffa818687d51ca5b9a691db08e7710a097d4014", "author": {"user": {"login": "MartinWitt", "name": null}}, "url": "https://github.com/INRIA/spoon/commit/2ffa818687d51ca5b9a691db08e7710a097d4014", "committedDate": "2020-03-06T20:32:40Z", "message": "fix markdown"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzcwNjUwNTM1", "url": "https://github.com/INRIA/spoon/pull/3283#pullrequestreview-370650535", "createdAt": "2020-03-06T21:55:06Z", "commit": {"oid": "2ffa818687d51ca5b9a691db08e7710a097d4014"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wNlQyMTo1NTowNlrOFzIoag==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wNlQyMTo1NTowNlrOFzIoag==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4OTE2MzExNA==", "bodyText": "now this change can be removed :)", "url": "https://github.com/INRIA/spoon/pull/3283#discussion_r389163114", "createdAt": "2020-03-06T21:55:06Z", "author": {"login": "monperrus"}, "path": "src/test/java/spoon/test/architecture/SpoonArchitectureEnforcerTest.java", "diffHunk": "@@ -232,6 +232,9 @@ public void metamodelPackageRule() {\n \n \t@Test\n \tpublic void testGoodTestClassNames() {\n+\t\t//some testclasses are util only and dont have to follow the naming convention for better readability\n+\t\tSet<String> testUtilClasses = new HashSet<>(Arrays.asList(\"spoon.test.GitHubIssue\", \"spoon.test.UnresolvedBug\"));", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "2ffa818687d51ca5b9a691db08e7710a097d4014"}, "originalPosition": 5}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzcxNzkwNjMw", "url": "https://github.com/INRIA/spoon/pull/3283#pullrequestreview-371790630", "createdAt": "2020-03-10T09:27:57Z", "commit": {"oid": "2ffa818687d51ca5b9a691db08e7710a097d4014"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xMFQwOToyNzo1N1rOF0HCYw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xMFQwOToyNzo1N1rOF0HCYw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MDE4NTU3MQ==", "bodyText": "what about returning an int instead of a String?", "url": "https://github.com/INRIA/spoon/pull/3283#discussion_r390185571", "createdAt": "2020-03-10T09:27:57Z", "author": {"login": "monperrus"}, "path": "src/test/java/spoon/test/GitHubIssue.java", "diffHunk": "@@ -0,0 +1,18 @@\n+/**\n+ * Copyright (C) 2006-2019 INRIA and contributors\n+ *\n+ * Spoon is available either under the terms of the MIT License (see LICENSE-MIT.txt) of the Cecill-C License (see LICENSE-CECILL-C.txt). You as the user are entitled to choose the terms under which to adopt Spoon.\n+ */\n+package spoon.test;\n+\n+import java.lang.annotation.ElementType;\n+import java.lang.annotation.Retention;\n+import java.lang.annotation.RetentionPolicy;\n+import java.lang.annotation.Target;\n+\n+\n+@Retention(RetentionPolicy.RUNTIME)\n+@Target(ElementType.METHOD)\n+public @interface GitHubIssue {\n+\tString issueNumber();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "2ffa818687d51ca5b9a691db08e7710a097d4014"}, "originalPosition": 17}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "8401b97790024ecae038a87395e07ccbd5756da5", "author": {"user": {"login": "MartinWitt", "name": null}}, "url": "https://github.com/INRIA/spoon/commit/8401b97790024ecae038a87395e07ccbd5756da5", "committedDate": "2020-03-10T13:31:20Z", "message": "change string to int add restored testcase"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "55c99c915b42b2a1dacab75f63937ee6e34884ac", "author": {"user": {"login": "MartinWitt", "name": null}}, "url": "https://github.com/INRIA/spoon/commit/55c99c915b42b2a1dacab75f63937ee6e34884ac", "committedDate": "2020-03-10T13:46:29Z", "message": " fix test case"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzcyMDIxMjE5", "url": "https://github.com/INRIA/spoon/pull/3283#pullrequestreview-372021219", "createdAt": "2020-03-10T14:46:21Z", "commit": {"oid": "55c99c915b42b2a1dacab75f63937ee6e34884ac"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xMFQxNDo0NjoyMVrOF0SMTg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xMFQxNDo0NjoyMVrOF0SMTg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MDM2ODMzNA==", "bodyText": "+check that the issue is still open? (looks straighforward to do)", "url": "https://github.com/INRIA/spoon/pull/3283#discussion_r390368334", "createdAt": "2020-03-10T14:46:21Z", "author": {"login": "monperrus"}, "path": "src/test/java/spoon/test/UnresolvedBugTest.java", "diffHunk": "@@ -0,0 +1,74 @@\n+/**\n+ * Copyright (C) 2006-2019 INRIA and contributors\n+ *\n+ * Spoon is available either under the terms of the MIT License (see LICENSE-MIT.txt) of the Cecill-C License (see LICENSE-CECILL-C.txt). You as the user are entitled to choose the terms under which to adopt Spoon.\n+ */\n+package spoon.test;\n+\n+import static org.junit.Assert.assertEquals;\n+import static org.junit.Assert.assertTrue;\n+\n+import java.io.BufferedReader;\n+import java.io.IOException;\n+import java.io.InputStreamReader;\n+import java.net.URL;\n+import java.util.List;\n+import java.util.stream.Collectors;\n+\n+import com.google.gson.Gson;\n+import com.google.gson.JsonObject;\n+\n+import org.junit.Test;\n+import org.junit.experimental.categories.Category;\n+\n+import spoon.FluentLauncher;\n+import spoon.reflect.declaration.CtMethod;\n+import spoon.reflect.visitor.filter.TypeFilter;\n+\n+public class UnresolvedBugTest {\n+\n+\tprivate List<CtMethod<?>> testMethods = findTestMethods();\n+\tprivate final String githubURL = \"https://api.github.com/repos/INRIA/spoon/issues/\";\n+\n+\t/**\n+\t * Checks if every githubIssue annotation has an github issue.\n+\t */\n+\t@Test\n+\tpublic void checkGithubIssueAnnotations() throws IOException {\n+\t\t// contract: every test GitHubIssue annotation points to a valid issue number.\n+\t\ttestMethods = testMethods.stream()\n+\t\t\t\t.filter(v -> v.hasAnnotation(Test.class) && v.hasAnnotation(GitHubIssue.class))\n+\t\t\t\t.collect(Collectors.toList());\n+\t\tfor (CtMethod<?> ctMethod : testMethods) {\n+\t\t\tint issueNumber = ctMethod.getAnnotation(GitHubIssue.class).issueNumber();\n+\t\t\tURL url = new URL(githubURL + issueNumber);\n+\t\t\t// because readAllBytes is jdk9 only\n+\t\t\tString data = new BufferedReader(new InputStreamReader(url.openStream())).lines().collect(Collectors.joining());\n+\t\t\tJsonObject issue = new Gson().fromJson(data, JsonObject.class);\n+\t\t\tassertTrue(issue.get(\"number\").getAsInt()==issueNumber);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "55c99c915b42b2a1dacab75f63937ee6e34884ac"}, "originalPosition": 48}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "96be412bd42dcd4a7b4bd64dfd5e051c65790997", "author": {"user": {"login": "MartinWitt", "name": null}}, "url": "https://github.com/INRIA/spoon/commit/96be412bd42dcd4a7b4bd64dfd5e051c65790997", "committedDate": "2020-03-10T15:09:29Z", "message": "add check if pointed issues are still open"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1420, "cost": 1, "resetAt": "2021-11-01T14:51:55Z"}}}