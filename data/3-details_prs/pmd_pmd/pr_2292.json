{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0Mzc1ODY2NDIw", "number": 2292, "title": "[core] Simplify metrics framework (for PMD 7)", "bodyText": "This mostly just removes the API deprecated by #2241. It also occurred to me, that instead of using ResultOption, we could use java 8's DoubleSummaryStatistics instead, which is nice.", "createdAt": "2020-02-16T20:06:56Z", "url": "https://github.com/pmd/pmd/pull/2292", "merged": true, "mergeCommit": {"oid": "fd87420953254df442a5cac0e0f82e26f59df74b"}, "closed": true, "closedAt": "2020-03-17T23:36:28Z", "author": {"login": "oowekyala"}, "timelineItems": {"totalCount": 11, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcE9JTagH2gAyMzc1ODY2NDIwOjRlMmFlMGQ0YjI3ODViODlkZWRhYWY5MTYwNTYyZDJlNjhkZDUxMjI=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcQiwLcAFqTM3OTcxNTU0OQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "4e2ae0d4b2785b89dedaaf9160562d2e68dd5122", "author": {"user": {"login": "oowekyala", "name": "Cl\u00e9ment Fournier"}}, "url": "https://github.com/pmd/pmd/commit/4e2ae0d4b2785b89dedaaf9160562d2e68dd5122", "committedDate": "2020-02-16T18:36:09Z", "message": "Simplify apex metrics framework further"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "43f5252d7eae40a3f3609b9cdcf8eb939bfc770b", "author": {"user": {"login": "oowekyala", "name": "Cl\u00e9ment Fournier"}}, "url": "https://github.com/pmd/pmd/commit/43f5252d7eae40a3f3609b9cdcf8eb939bfc770b", "committedDate": "2020-02-16T18:41:21Z", "message": "Expose statistics instead of result option"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "9c770ac6bb7962a46e5f79617a820435767cc378", "author": {"user": {"login": "oowekyala", "name": "Cl\u00e9ment Fournier"}}, "url": "https://github.com/pmd/pmd/commit/9c770ac6bb7962a46e5f79617a820435767cc378", "committedDate": "2020-02-16T18:52:15Z", "message": "Simplify Java metrics framework further"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "bb3368f3aea14dabd8c757a20dd745b8bdc9298d", "author": {"user": {"login": "oowekyala", "name": "Cl\u00e9ment Fournier"}}, "url": "https://github.com/pmd/pmd/commit/bb3368f3aea14dabd8c757a20dd745b8bdc9298d", "committedDate": "2020-02-16T19:08:31Z", "message": "Cleanup PMD core metrics"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "4fa3a05ebb12255b4bc53b6ed8de0ed21562edfb", "author": {"user": {"login": "oowekyala", "name": "Cl\u00e9ment Fournier"}}, "url": "https://github.com/pmd/pmd/commit/4fa3a05ebb12255b4bc53b6ed8de0ed21562edfb", "committedDate": "2020-02-16T19:17:29Z", "message": "Move some tests to core"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "96097a80e879226281fcbad6c22c5b88ba8e2740", "author": {"user": {"login": "oowekyala", "name": "Cl\u00e9ment Fournier"}}, "url": "https://github.com/pmd/pmd/commit/96097a80e879226281fcbad6c22c5b88ba8e2740", "committedDate": "2020-02-16T19:40:42Z", "message": "Move metric key static creator to interface"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "d40fdc0e4da657bc6beb29e5001eccd31792e56a", "author": {"user": {"login": "oowekyala", "name": "Cl\u00e9ment Fournier"}}, "url": "https://github.com/pmd/pmd/commit/d40fdc0e4da657bc6beb29e5001eccd31792e56a", "committedDate": "2020-02-16T20:05:15Z", "message": "Remove deprecated stuff"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "fd87420953254df442a5cac0e0f82e26f59df74b", "author": {"user": {"login": "oowekyala", "name": "Cl\u00e9ment Fournier"}}, "url": "https://github.com/pmd/pmd/commit/fd87420953254df442a5cac0e0f82e26f59df74b", "committedDate": "2020-03-17T23:34:38Z", "message": "Merge branch '7.0.x' into simplify-metrics-framework-on-7"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzc5NzA3Njk5", "url": "https://github.com/pmd/pmd/pull/2292#pullrequestreview-379707699", "createdAt": "2020-03-23T18:27:42Z", "commit": {"oid": "fd87420953254df442a5cac0e0f82e26f59df74b"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yM1QxODoyNzo0M1rOF6SrLQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yM1QxODoyNzo0M1rOF6SrLQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NjY2NzY5Mw==", "bodyText": "Should we mark this as deprecated on master? It seems, it is only used by tests right now...", "url": "https://github.com/pmd/pmd/pull/2292#discussion_r396667693", "createdAt": "2020-03-23T18:27:43Z", "author": {"login": "adangel"}, "path": "pmd-core/src/main/java/net/sourceforge/pmd/lang/metrics/MetricKeyUtil.java", "diffHunk": "@@ -1,68 +0,0 @@\n-/**\n- * BSD-style license; for more info see http://pmd.sourceforge.net/license.html\n- */\n-\n-package net.sourceforge.pmd.lang.metrics;\n-\n-import java.util.Objects;\n-\n-import net.sourceforge.pmd.lang.ast.Node;\n-\n-/**\n- * Holds the key creation method until we move it to the MetricKey interface.\n- *\n- * @author Cl\u00e9ment Fournier\n- * @since 6.0.0\n- */\n-public final class MetricKeyUtil {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "fd87420953254df442a5cac0e0f82e26f59df74b"}, "originalPosition": 17}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzc5NzEyMTIz", "url": "https://github.com/pmd/pmd/pull/2292#pullrequestreview-379712123", "createdAt": "2020-03-23T18:33:35Z", "commit": {"oid": "fd87420953254df442a5cac0e0f82e26f59df74b"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yM1QxODozMzozNlrOF6S5Cg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yM1QxODozMzozNlrOF6S5Cg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NjY3MTI0Mg==", "bodyText": "Actually, do we still need this factory method? On master, I don't see any usage of MetricKeyUtil.of(...) other than in tests... Didn't look into the 7.0.0 branch yet", "url": "https://github.com/pmd/pmd/pull/2292#discussion_r396671242", "createdAt": "2020-03-23T18:33:36Z", "author": {"login": "adangel"}, "path": "pmd-core/src/main/java/net/sourceforge/pmd/lang/metrics/MetricKey.java", "diffHunk": "@@ -44,4 +51,53 @@\n \n     // TODO the metric key should know about supported options\n \n+\n+    /**\n+     * Creates a new metric key from its metric and name.\n+     *\n+     * @param name   The name of the metric\n+     * @param metric The metric to use\n+     * @param <T>    Type of node the metric can be computed on\n+     *\n+     * @return The metric key\n+     *\n+     * @throws NullPointerException If either parameter is null\n+     */\n+    static <T extends Node> MetricKey<T> of(@NonNull String name, @NonNull Metric<T> metric) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "fd87420953254df442a5cac0e0f82e26f59df74b"}, "originalPosition": 44}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzc5NzE1NTQ5", "url": "https://github.com/pmd/pmd/pull/2292#pullrequestreview-379715549", "createdAt": "2020-03-23T18:38:15Z", "commit": {"oid": "fd87420953254df442a5cac0e0f82e26f59df74b"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yM1QxODozODoxNVrOF6TEiA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yM1QxODozODoxNVrOF6TEiA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NjY3NDE4NA==", "bodyText": "Seems like, we also need to update the doc for PMD 7: https://github.com/pmd/pmd/blob/pmd/7.0.x/docs/pages/pmd/userdocs/extending/metrics_howto.md\nThe examples need to be updated to use MetricsUtil instead of JavaMetrics", "url": "https://github.com/pmd/pmd/pull/2292#discussion_r396674184", "createdAt": "2020-03-23T18:38:15Z", "author": {"login": "adangel"}, "path": "pmd-java/src/main/java/net/sourceforge/pmd/lang/java/rule/design/CyclomaticComplexityRule.java", "diffHunk": "@@ -128,7 +126,7 @@ public Object visit(ASTAnyTypeDeclaration node, Object data) {\n             int classWmc = (int) MetricsUtil.computeMetric(JavaClassMetricKey.WMC, node, cycloOptions);\n \n             if (classWmc >= classReportLevel) {\n-                int classHighest = (int) JavaMetrics.get(JavaOperationMetricKey.CYCLO, node, cycloOptions, ResultOption.HIGHEST);\n+                int classHighest = (int) MetricsUtil.computeStatistics(JavaOperationMetricKey.CYCLO, node.getOperations(), cycloOptions).getMax();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "fd87420953254df442a5cac0e0f82e26f59df74b"}, "originalPosition": 21}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4891, "cost": 1, "resetAt": "2021-11-01T16:37:27Z"}}}