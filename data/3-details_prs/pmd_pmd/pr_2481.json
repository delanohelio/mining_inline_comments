{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDE3MDE3MTYy", "number": 2481, "title": "[java] Fix JUnitSpellingRule false positive", "bodyText": "Describe the PR\nDo not trigger if it's a junit5 class (isJUnit5Class from AbstractJUnitRule can be used).\nDo not trigger if junit4 doesn't extend TestCase\n\nIt'd be probably good to add more explanation to the rule itself.\n\nRelated issues\n\n\nFixes #2477\n\nReady?\n\n\n Added unit tests for fixed bug/feature\n Passing all unit tests\n Complete build ./mvnw clean verify passes (checked automatically by travis)\n Added (in-code) documentation (if needed)", "createdAt": "2020-05-12T22:56:51Z", "url": "https://github.com/pmd/pmd/pull/2481", "merged": true, "mergeCommit": {"oid": "ad68cdda24038bfce80c50f327587eb98724343b"}, "closed": true, "closedAt": "2020-05-18T18:42:38Z", "author": {"login": "KroArtem"}, "timelineItems": {"totalCount": 5, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcgsRgOAH2gAyNDE3MDE3MTYyOmQzNDlkNjY2OTY2MWQ3ODkyMWM3MzBmYmZiMzQzYjc5NGEwNDBjYzQ=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcijiYIAFqTQxMzgwODEwMw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "d349d6669661d78921c730fbfb343b794a040cc4", "author": {"user": {"login": "KroArtem", "name": "Artem"}}, "url": "https://github.com/pmd/pmd/commit/d349d6669661d78921c730fbfb343b794a040cc4", "committedDate": "2020-05-12T22:46:36Z", "message": "fix JUnitSpellingRule false positive, closes #2477. Also add two more tests"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "8b5be784fd34a6af8c530af8eebdc671dcfd3977", "author": {"user": {"login": "KroArtem", "name": "Artem"}}, "url": "https://github.com/pmd/pmd/commit/8b5be784fd34a6af8c530af8eebdc671dcfd3977", "committedDate": "2020-05-12T23:05:27Z", "message": "fix pmd violation"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDEyMDYyNTQy", "url": "https://github.com/pmd/pmd/pull/2481#pullrequestreview-412062542", "createdAt": "2020-05-14T18:08:53Z", "commit": {"oid": "8b5be784fd34a6af8c530af8eebdc671dcfd3977"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xNFQxODowODo1M1rOGVoa-w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xNFQxODowOTo0NVrOGVocqw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNTMzNTU0Nw==", "bodyText": "I'd not expose these methods.\nThese methods are called already when visiting CompilationUnit and the result is stored in fields, see lines 38-40 above.\nI'd make these fields protected, so that you can use it in the rule.", "url": "https://github.com/pmd/pmd/pull/2481#discussion_r425335547", "createdAt": "2020-05-14T18:08:53Z", "author": {"login": "adangel"}, "path": "pmd-java/src/main/java/net/sourceforge/pmd/lang/java/rule/AbstractJUnitRule.java", "diffHunk": "@@ -89,7 +89,7 @@ private boolean isJUnit3Method(ASTMethodDeclaration method) {\n         return isJUnit3Class && method.isVoid() && method.getName().startsWith(\"test\");\n     }\n \n-    private boolean isJUnit3Class(ASTCompilationUnit node) {\n+    protected boolean isJUnit3Class(ASTCompilationUnit node) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "8b5be784fd34a6af8c530af8eebdc671dcfd3977"}, "originalPosition": 5}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNTMzNTk3OQ==", "bodyText": "If using the protected fields from the base class, you don't need to search here again for the compilation unit and call again the methods - that was already done....", "url": "https://github.com/pmd/pmd/pull/2481#discussion_r425335979", "createdAt": "2020-05-14T18:09:45Z", "author": {"login": "adangel"}, "path": "pmd-java/src/main/java/net/sourceforge/pmd/lang/java/rule/errorprone/JUnitSpellingRule.java", "diffHunk": "@@ -5,13 +5,19 @@\n \n package net.sourceforge.pmd.lang.java.rule.errorprone;\n \n+import net.sourceforge.pmd.lang.java.ast.ASTCompilationUnit;\n import net.sourceforge.pmd.lang.java.ast.ASTMethodDeclaration;\n import net.sourceforge.pmd.lang.java.rule.AbstractJUnitRule;\n \n public class JUnitSpellingRule extends AbstractJUnitRule {\n \n     @Override\n     public Object visit(ASTMethodDeclaration node, Object data) {\n+        ASTCompilationUnit acu = node.getFirstParentOfType(ASTCompilationUnit.class);\n+        if (isJUnit5Class(acu) || isJUnit4Class(acu)) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "8b5be784fd34a6af8c530af8eebdc671dcfd3977"}, "originalPosition": 13}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ad68cdda24038bfce80c50f327587eb98724343b", "author": {"user": {"login": "KroArtem", "name": "Artem"}}, "url": "https://github.com/pmd/pmd/commit/ad68cdda24038bfce80c50f327587eb98724343b", "committedDate": "2020-05-16T20:26:24Z", "message": "Fix review remarks"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDEzODA4MTAz", "url": "https://github.com/pmd/pmd/pull/2481#pullrequestreview-413808103", "createdAt": "2020-05-18T17:43:44Z", "commit": {"oid": "ad68cdda24038bfce80c50f327587eb98724343b"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4783, "cost": 1, "resetAt": "2021-11-01T16:37:27Z"}}}