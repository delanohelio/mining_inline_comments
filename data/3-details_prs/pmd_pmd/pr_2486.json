{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDE4MjAzMTAw", "number": 2486, "title": "[core] Revamp the language version alias APIs", "bodyText": "Builds on top of #2088 with an improved API\nThe old experimental API allowed calls such as addVersions(langHandler, false) which were not only invalid, but would throw an ArrayIndexOutOfBoundsException, so we split the name\n(required) and the aliases (varargs, and therefore optional). We now had:\naddVersion(\"1.4\", java4Handler, false);\naddVersions(java6Handler, false, \"1.6\", \"6\");\nIn doing so, I was bothered by parameter order. The version name is the most significant change when setting 2 versions for a language, so I liked it being first as the old addVersion method did, so I moved that ahead. I know had:\naddVersion(\"1.4\", java4Handler, false);\naddVersions(\"1.6\", java6Handler, false, \"6\");\nWith that, I now had 2 methods that where equivalent, except one allowed for varargs and the other didn't\u2026 so I made them overloads. We now had:\naddVersion(\"1.4\", java4Handler, false);\naddVersion(\"1.6\", java6Handler, false, \"6\");\nI do keep the old method for binary compatibility, but with the current API we could completely remove it and still be source compatible (all calls to addVersion would still be valid and compile, only reflection calls would break).\nWith this API I think we could aim to deprecate / remove the old method in master (do we even care about reflection calls?) and promote the varargs one to non-experimental, but would love your insight into this.", "createdAt": "2020-05-14T19:30:28Z", "url": "https://github.com/pmd/pmd/pull/2486", "merged": true, "mergeCommit": {"oid": "e1a22282d02db281f4467336e5c46faff25a765c"}, "closed": true, "closedAt": "2020-05-16T17:22:21Z", "author": {"login": "jsotuyod"}, "timelineItems": {"totalCount": 8, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABchSSMmgH2gAyNDE4MjAzMTAwOjhjN2E0OWViNjk1MDAxMWUwNGMyMTNlY2U4M2U4YTNhMGYyYzAyNDg=", "endCursor": "Y3Vyc29yOnYyOpPPAAABch5qcgAFqTQxMzA5MTc5MQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "8c7a49eb6950011e04c213ece83e8a3a0f2c0248", "author": {"user": {"login": "jsotuyod", "name": "Juan Mart\u00edn Sotuyo Dodero"}}, "url": "https://github.com/pmd/pmd/commit/8c7a49eb6950011e04c213ece83e8a3a0f2c0248", "committedDate": "2020-05-14T19:03:45Z", "message": "[core] Revamp the language version alias APIs\n\n - The old experimental API allowed calls such as\n`addVersions(langHandler, false)` which were not only invalid, but would\nthrow an `ArrayIndexOutOfBoundsException`, so we split the name\n(required) and the aliases (varargs, and therefore optional)\n - In doing so, I was bothered by parameter order. The version name is\nthe most significant change when setting 2 versions for a language, so I\nliked it being first as the old `addVersion` method did, so I moved\nthat ahead.\n - With that, I now had 2 methods that where equivalent, except one\nallowed for varargs and the other didn't\u2026 so I merged them. This is not\n100% binary compatible, but it is source compatible (that is, unless you\nused reflection, all valid calls to the old non-experimental method\nstill work)."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "d1e0f8c5faa4690beeea629f88e9aa6d6ebeb8eb", "author": {"user": {"login": "jsotuyod", "name": "Juan Mart\u00edn Sotuyo Dodero"}}, "url": "https://github.com/pmd/pmd/commit/d1e0f8c5faa4690beeea629f88e9aa6d6ebeb8eb", "committedDate": "2020-05-14T19:30:06Z", "message": "Bring back binary compatibility"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDEyMTIyMjkw", "url": "https://github.com/pmd/pmd/pull/2486#pullrequestreview-412122290", "createdAt": "2020-05-14T19:33:32Z", "commit": {"oid": "d1e0f8c5faa4690beeea629f88e9aa6d6ebeb8eb"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xNFQxOTozMzozMlrOGVrPjQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xNFQxOTozMzozMlrOGVrPjQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNTM4MTc3Mw==", "bodyText": "this change is unrelated, but the language attribute is not required in rule definition (may be provided by the rule implementation directly), so this may produce NPEs for definitions such as:\n<!-- AccessorClassGenerationRule is an AbstractJavaRule, which sets language to Java, \nmaximumLanguageVersion is invalid, but the builder is never explicitly told the language -->\n<rule name=\"AccessorClassGeneration\"\n          since=\"1.04\"\n          maximumLanguageVersion=\"16\"\n          message=\"Avoid instantiation through private constructors from outside of the constructor's class.\"\n          class=\"net.sourceforge.pmd.lang.java.rule.bestpractices.AccessorClassGenerationRule\"\n          externalInfoUrl=\"${pmd.website.baseurl}/pmd_rules_java_bestpractices.html#accessorclassgeneration\">\nthis bug just happened to bit me during my refactors :D", "url": "https://github.com/pmd/pmd/pull/2486#discussion_r425381773", "createdAt": "2020-05-14T19:33:32Z", "author": {"login": "jsotuyod"}, "path": "pmd-core/src/main/java/net/sourceforge/pmd/rules/RuleBuilder.java", "diffHunk": "@@ -184,12 +184,12 @@ private void loadLanguageMinMaxVersions(Rule rule) {\n         checkLanguageVersionsAreOrdered(rule);\n     }\n \n-    private void throwUnknownLanguageVersionException(String minOrMax, String unknownVersion) {\n+    private void throwUnknownLanguageVersionException(String minOrMax, String unknownVersion, Language lang) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d1e0f8c5faa4690beeea629f88e9aa6d6ebeb8eb"}, "originalPosition": 23}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDEyMTIzMTA2", "url": "https://github.com/pmd/pmd/pull/2486#pullrequestreview-412123106", "createdAt": "2020-05-14T19:34:39Z", "commit": {"oid": "d1e0f8c5faa4690beeea629f88e9aa6d6ebeb8eb"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xNFQxOTozNDozOVrOGVrR5g==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xNFQxOTozNDozOVrOGVrR5g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNTM4MjM3NA==", "bodyText": "shall we deprecate it and promote the experimental version?", "url": "https://github.com/pmd/pmd/pull/2486#discussion_r425382374", "createdAt": "2020-05-14T19:34:39Z", "author": {"login": "jsotuyod"}, "path": "pmd-core/src/main/java/net/sourceforge/pmd/lang/BaseLanguageModule.java", "diffHunk": "@@ -56,9 +57,9 @@ protected void addVersions(LanguageVersionHandler languageVersionHandler, boolea\n             defaultVersion = languageVersion;\n         }\n     }\n-\n+    \n     protected void addVersion(String version, LanguageVersionHandler languageVersionHandler, boolean isDefault) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d1e0f8c5faa4690beeea629f88e9aa6d6ebeb8eb"}, "originalPosition": 29}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDEyNjY1OTUx", "url": "https://github.com/pmd/pmd/pull/2486#pullrequestreview-412665951", "createdAt": "2020-05-15T13:49:29Z", "commit": {"oid": "d1e0f8c5faa4690beeea629f88e9aa6d6ebeb8eb"}, "state": "COMMENTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xNVQxMzo0OToyOVrOGWFqdA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xNVQxMzo1MzowMlrOGWFz8g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNTgxNDY0NA==", "bodyText": "I think we could improve further by hiding the isDefault parameter. There's only one default version, but all those calls have to mention this false argument, which is obscure unless you know what it is, or are in an IDE. We could just have addVersion for non-default versions, and a separate addDefaultVersion method", "url": "https://github.com/pmd/pmd/pull/2486#discussion_r425814644", "createdAt": "2020-05-15T13:49:29Z", "author": {"login": "oowekyala"}, "path": "pmd-java/src/main/java/net/sourceforge/pmd/lang/java/JavaLanguageModule.java", "diffHunk": "@@ -19,12 +19,12 @@ public JavaLanguageModule() {\n         super(NAME, null, TERSE_NAME, JavaRuleChainVisitor.class, \"java\");\n         addVersion(\"1.3\", new JavaLanguageHandler(3), false);\n         addVersion(\"1.4\", new JavaLanguageHandler(4), false);\n-        addVersions(new JavaLanguageHandler(5), false, \"1.5\", \"5\");\n-        addVersions(new JavaLanguageHandler(6), false, \"1.6\", \"6\");\n-        addVersions(new JavaLanguageHandler(7), false, \"1.7\", \"7\");\n-        addVersions(new JavaLanguageHandler(8), false, \"1.8\", \"8\");\n-        addVersions(new JavaLanguageHandler(9), false, \"9\", \"1.9\");\n-        addVersions(new JavaLanguageHandler(10), false, \"10\", \"1.10\");\n+        addVersion(\"1.5\", new JavaLanguageHandler(5), false, \"5\");", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d1e0f8c5faa4690beeea629f88e9aa6d6ebeb8eb"}, "originalPosition": 10}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNTgxNzA3NA==", "bodyText": "I think, we shouldn't remove the redundant overload on master, but deprecating it and removing it later is appropriate. Removing it abruptly would at least break the designer, though I don't know about other dependent projects", "url": "https://github.com/pmd/pmd/pull/2486#discussion_r425817074", "createdAt": "2020-05-15T13:53:02Z", "author": {"login": "oowekyala"}, "path": "pmd-core/src/main/java/net/sourceforge/pmd/lang/BaseLanguageModule.java", "diffHunk": "@@ -56,9 +57,9 @@ protected void addVersions(LanguageVersionHandler languageVersionHandler, boolea\n             defaultVersion = languageVersion;\n         }\n     }\n-\n+    \n     protected void addVersion(String version, LanguageVersionHandler languageVersionHandler, boolean isDefault) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNTM4MjM3NA=="}, "originalCommit": {"oid": "d1e0f8c5faa4690beeea629f88e9aa6d6ebeb8eb"}, "originalPosition": 29}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "0f552ee6207a59b84e3efcd7695a7043229fe7d3", "author": {"user": {"login": "jsotuyod", "name": "Juan Mart\u00edn Sotuyo Dodero"}}, "url": "https://github.com/pmd/pmd/commit/0f552ee6207a59b84e3efcd7695a7043229fe7d3", "committedDate": "2020-05-15T14:42:28Z", "message": "Further refine the addVersion API"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "465dead81c32ef609a1e2448334a62936657c210", "author": {"user": {"login": "jsotuyod", "name": "Juan Mart\u00edn Sotuyo Dodero"}}, "url": "https://github.com/pmd/pmd/commit/465dead81c32ef609a1e2448334a62936657c210", "committedDate": "2020-05-15T14:44:09Z", "message": "Optimize imports"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDEzMDkxNzkx", "url": "https://github.com/pmd/pmd/pull/2486#pullrequestreview-413091791", "createdAt": "2020-05-16T16:56:03Z", "commit": {"oid": "d1e0f8c5faa4690beeea629f88e9aa6d6ebeb8eb"}, "state": "APPROVED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xNlQxNjo1NjowM1rOGWbZeg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xNlQxNjo1NjowM1rOGWbZeg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNjE3MDc0Ng==", "bodyText": "I think this needs a test case. I'll add one when merging", "url": "https://github.com/pmd/pmd/pull/2486#discussion_r426170746", "createdAt": "2020-05-16T16:56:03Z", "author": {"login": "oowekyala"}, "path": "pmd-core/src/main/java/net/sourceforge/pmd/rules/RuleBuilder.java", "diffHunk": "@@ -184,12 +184,12 @@ private void loadLanguageMinMaxVersions(Rule rule) {\n         checkLanguageVersionsAreOrdered(rule);\n     }\n \n-    private void throwUnknownLanguageVersionException(String minOrMax, String unknownVersion) {\n+    private void throwUnknownLanguageVersionException(String minOrMax, String unknownVersion, Language lang) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNTM4MTc3Mw=="}, "originalCommit": {"oid": "d1e0f8c5faa4690beeea629f88e9aa6d6ebeb8eb"}, "originalPosition": 23}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4786, "cost": 1, "resetAt": "2021-11-01T16:37:27Z"}}}