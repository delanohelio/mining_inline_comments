{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTAzOTQ5MjU5", "number": 2831, "title": "[core] Fix XMLRenderer newlines when running under IBM Java", "bodyText": "Describe the PR\nWhen running PMD under Windows with IBM's Java, then the produced XML report looks like this:\n<?xml version=\"1.0\" encoding=\"UTF-8\"?>&#xD;\n<pmd xmlns=\"http://pmd.sourceforge.net/report/2.0.0\" xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\" xsi:schemaLocation=\"http://pmd.sourceforge.net/report/2.0.0 http://pmd.sourceforge.net/report_2_0_0.xsd\" version=\"6.28.0\" timestamp=\"2020-10-15T10:24:55.318\">&#xD;\n</pmd>&#xD;\nIBM's Java obviously uses an interesting implementation for XMLStreamWriter. The produced XML is invalid, e.g. xmllint says this:\n$ xmllint out.xml\nout.xml:1: parser error : Start tag expected, '<' not found\n<?xml version=\"1.0\" encoding=\"UTF-8\"?>&#xD;\n\nThis problem exists since I've refactored XMLRenderer to use XMLStreamWriter with PMD 6.26.0 (see #2633).\nTesting is a bit complicated, but possible under Linux (originally, this problem appears only under Windows, due to different default line separators). In order to test it, you'll need\n\nIBM's Java 8 SDK -> https://www.ibm.com/support/pages/java-sdk-downloads-version-80\nThe following start script for PMD for some bash magic...\n\n#!/bin/bash\n\nPMD_DIR=~/PMD/pmd-bin-6.28.0\n#PMD_DIR=~/PMD/pmd-bin-6.29.0-SNAPSHOT\n\nPMD_JAVA_OPTS=-Dline.separator=$'\\r\\n'\nLIB_DIR=$PMD_DIR/lib\n\n# need to source run.sh, otherwise subshell is used and IFS is not inherited and contains $'\\n'\n# which will destroy line.separator property (PMD_JAVA_OPTS is word split at the newline char)\nIFS=' '\nsource $PMD_DIR/bin/run.sh pmd -f xml -d . -R rulesets/java/quickstart.xml -no-cache\nOther changes\nThis PR also adds the missing call to \"writeEndDocument()\".\nRelated issues\n\n#2633\n#2615\nSee also https://stackoverflow.com/questions/29675481/xmlstreamwriter-java-8-writecharacters-xd\n\nReady?\n\n\n Added unit tests for fixed bug/feature\n Passing all unit tests\n Complete build ./mvnw clean verify passes (checked automatically by travis)\n Added (in-code) documentation (if needed)", "createdAt": "2020-10-15T09:11:47Z", "url": "https://github.com/pmd/pmd/pull/2831", "merged": true, "mergeCommit": {"oid": "14d1f7a0d33a238454a7f6d028be44dddcb9286c"}, "closed": true, "closedAt": "2020-10-22T07:58:51Z", "author": {"login": "adangel"}, "timelineItems": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdSt8uuAH2gAyNTAzOTQ5MjU5OmQ4NjE2Y2NhNTU5OGQ4YWM1NmMxOWE1NjVmNmJiMTk1NzVhMzM2MDE=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdTFrbAgH2gAyNTAzOTQ5MjU5OjYxYWNjNTI0MjJlNzAzZDIwYjE1MzdhM2VhZjU4MDMzYzgzMWFmZTg=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "d8616cca5598d8ac56c19a565f6bb19575a33601", "author": {"user": {"login": "adangel", "name": "Andreas Dangel"}}, "url": "https://github.com/pmd/pmd/commit/d8616cca5598d8ac56c19a565f6bb19575a33601", "committedDate": "2020-10-15T08:59:56Z", "message": "[core] Fix XMLRenderer newlines when running under IBM Java"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b22bc05b4b04dd8172ac26f295e626ac38117bda", "author": {"user": {"login": "adangel", "name": "Andreas Dangel"}}, "url": "https://github.com/pmd/pmd/commit/b22bc05b4b04dd8172ac26f295e626ac38117bda", "committedDate": "2020-10-15T09:14:28Z", "message": "[skip ci] [doc] Update release notes, refs #2831"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTA5MzgwNTcz", "url": "https://github.com/pmd/pmd/pull/2831#pullrequestreview-509380573", "createdAt": "2020-10-15T13:30:36Z", "commit": {"oid": "b22bc05b4b04dd8172ac26f295e626ac38117bda"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xNVQxMzozMDozNlrOHiH6OA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xNVQxMzozMDozNlrOHiH6OA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNTU0MzIyNA==", "bodyText": "this initialization seems moot, right?\n\n  \n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                private byte[] lineSeparator = new byte[0];\n          \n          \n            \n                private byte[] lineSeparator;", "url": "https://github.com/pmd/pmd/pull/2831#discussion_r505543224", "createdAt": "2020-10-15T13:30:36Z", "author": {"login": "jsotuyod"}, "path": "pmd-core/src/main/java/net/sourceforge/pmd/renderers/XMLRenderer.java", "diffHunk": "@@ -46,6 +46,7 @@\n \n     private XMLStreamWriter xmlWriter;\n     private OutputStream stream;\n+    private byte[] lineSeparator = new byte[0];", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b22bc05b4b04dd8172ac26f295e626ac38117bda"}, "originalPosition": 4}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "61acc52422e703d20b1537a3eaf58033c831afe8", "author": {"user": {"login": "adangel", "name": "Andreas Dangel"}}, "url": "https://github.com/pmd/pmd/commit/61acc52422e703d20b1537a3eaf58033c831afe8", "committedDate": "2020-10-16T12:38:45Z", "message": "[core] XMLRenderer - remove unecessary initialization\n\nCo-authored-by: Juan Mart\u00edn Sotuyo Dodero <juansotuyo@gmail.com>"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4544, "cost": 1, "resetAt": "2021-11-01T16:37:27Z"}}}