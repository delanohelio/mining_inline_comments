{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDEyNjkxMzkx", "number": 2465, "title": "[dependencies] Upgrade hamcrest, mockito and JUnit", "bodyText": "Describe the PR\nAccording to JLBP-11 I've decided to replace old hamcrest 1.3 version by a new one (2.2). This produced some inconvenience as it's required to define hamcrest before junit to resolve new version. This also requires defining hamcrest in every module where JUnit is used. (It can be defined in dependency management with default scope but it'll be exposed then). Information about upgrade tips and tricks is here. Maybe I'm missing something because it doesn't look like very nice.\nI've checked by mvn dependency:tree that there is only one version of hamcrest left.\nMockito 1.x was exposing hamcrest 1.1 thus it was updated to version 2.x as 1.x is also abandoned.\nJUnit was updated from 4.12 to 4.13.\nSome methods were replaced:\n\norg.junit.Assert.assertThat that accepts matchers is deprecated\nSubstringMatcher ctor now requires more parameters\norg.hamcrest.CoreMatchers was replaced by org.hamcrest.Matchers\norg.mockito.Matchers.any is deprecated, replaced by org.mockito.ArgumentMatchers.any\norg.mockito.Matchers.anyList is replaced by org.mockito.ArgumentMatchers.any\n\n\nReady?\n\n\n Added unit tests for fixed bug/feature\n Passing all unit tests\n Complete build ./mvnw clean verify passes (checked automatically by travis)\n Added (in-code) documentation (if needed)", "createdAt": "2020-05-04T00:23:07Z", "url": "https://github.com/pmd/pmd/pull/2465", "merged": true, "mergeCommit": {"oid": "5053b7beb4f634c67a250986e0471b86ac0ba90a"}, "closed": true, "closedAt": "2020-05-22T09:56:12Z", "author": {"login": "KroArtem"}, "timelineItems": {"totalCount": 5, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABceFGh2AH2gAyNDEyNjkxMzkxOjNmYmEzZjYyMTdiODI3YTdjNTFiOTUyNGMyNDdmOWMyODY3MzE1NTM=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcju2L5gFqTQxNjc3Mzg4Mg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "3fba3f6217b827a7c51b9524c247f9c286731553", "author": {"user": {"login": "KroArtem", "name": "Artem"}}, "url": "https://github.com/pmd/pmd/commit/3fba3f6217b827a7c51b9524c247f9c286731553", "committedDate": "2020-05-04T20:00:28Z", "message": "Update hamcrest to 2.2, Junit to 4.13, mockito to 2.28.2"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "53e8b3d0fca6c514c98a3f2431e15b39736e40ad", "author": {"user": {"login": "KroArtem", "name": "Artem"}}, "url": "https://github.com/pmd/pmd/commit/53e8b3d0fca6c514c98a3f2431e15b39736e40ad", "committedDate": "2020-05-04T15:26:04Z", "message": "hamcrest in pmd-test should have the same scope as junit"}, "afterCommit": {"oid": "3fba3f6217b827a7c51b9524c247f9c286731553", "author": {"user": {"login": "KroArtem", "name": "Artem"}}, "url": "https://github.com/pmd/pmd/commit/3fba3f6217b827a7c51b9524c247f9c286731553", "committedDate": "2020-05-04T20:00:28Z", "message": "Update hamcrest to 2.2, Junit to 4.13, mockito to 2.28.2"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDA3MjMwOTYx", "url": "https://github.com/pmd/pmd/pull/2465#pullrequestreview-407230961", "createdAt": "2020-05-07T07:54:50Z", "commit": {"oid": "3fba3f6217b827a7c51b9524c247f9c286731553"}, "state": "COMMENTED", "comments": {"totalCount": 7, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wN1QwNzo1NDo1MFrOGRytbA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wN1QwODo1ODozMVrOGR1F6A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMTMwOTgwNA==", "bodyText": "Note: this has nothing to do with your change, but I'm wondering, why we didn't declare this dependency down below the section starting with comment <!-- TEST DEPENDENCIES -->? I think, mockito would be used only in scope test later on... likewise wiremock, system-rules and assertj-core...\nWould you mind to have a look at this as well?", "url": "https://github.com/pmd/pmd/pull/2465#discussion_r421309804", "createdAt": "2020-05-07T07:54:50Z", "author": {"login": "adangel"}, "path": "pom.xml", "diffHunk": "@@ -664,8 +664,8 @@\n             </dependency>\n             <dependency>\n                 <groupId>org.mockito</groupId>\n-                <artifactId>mockito-all</artifactId>\n-                <version>1.10.19</version>\n+                <artifactId>mockito-core</artifactId>", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "3fba3f6217b827a7c51b9524c247f9c286731553"}, "originalPosition": 15}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMTMyNTg2NA==", "bodyText": "Do we still need hamcrest-library? I thought, from 2.x on, everything is now in hamcrest?\nI think we should avoid using hamcrest-library altogether (and make sure to exclude both hamcrest-library and hamcrest-core from junit).\nWe don't need to add these old (empty) hamcrest-core/hamcrest-library dependencies, because we use exclusions. And then it should also make no difference whether hamcrest is defined before or after junit, because we pretend, that junit doesn't use hamcrest (via the excludes) - giving us the task of dependency management, to make sure, hamcrest is declared whenever junit is used.", "url": "https://github.com/pmd/pmd/pull/2465#discussion_r421325864", "createdAt": "2020-05-07T08:22:14Z", "author": {"login": "adangel"}, "path": "pom.xml", "diffHunk": "@@ -720,16 +720,28 @@\n             </dependency>\n \n             <dependency>\n-                <groupId>junit</groupId>\n-                <artifactId>junit</artifactId>\n-                <version>4.12</version>\n+                <groupId>org.hamcrest</groupId>\n+                <artifactId>hamcrest</artifactId>\n+                <version>2.2</version>\n                 <scope>test</scope>\n             </dependency>\n             <dependency>\n                 <groupId>org.hamcrest</groupId>\n                 <artifactId>hamcrest-library</artifactId>", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "3fba3f6217b827a7c51b9524c247f9c286731553"}, "originalPosition": 34}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMTMyODA2NQ==", "bodyText": "also add\n                    <exclusion>\n                        <groupId>org.hamcrest</groupId>\n                        <artifactId>hamcrest-library</artifactId>\n                    </exclusion>", "url": "https://github.com/pmd/pmd/pull/2465#discussion_r421328065", "createdAt": "2020-05-07T08:25:49Z", "author": {"login": "adangel"}, "path": "pom.xml", "diffHunk": "@@ -720,16 +720,28 @@\n             </dependency>\n \n             <dependency>\n-                <groupId>junit</groupId>\n-                <artifactId>junit</artifactId>\n-                <version>4.12</version>\n+                <groupId>org.hamcrest</groupId>\n+                <artifactId>hamcrest</artifactId>\n+                <version>2.2</version>\n                 <scope>test</scope>\n             </dependency>\n             <dependency>\n                 <groupId>org.hamcrest</groupId>\n                 <artifactId>hamcrest-library</artifactId>\n-                <version>1.3</version>\n+                <version>2.2</version>\n+            </dependency>\n+\n+            <dependency>\n+                <groupId>junit</groupId>\n+                <artifactId>junit</artifactId>\n+                <version>4.13</version>\n                 <scope>test</scope>\n+                <exclusions>\n+                    <exclusion>\n+                        <groupId>org.hamcrest</groupId>\n+                        <artifactId>hamcrest-core</artifactId>\n+                    </exclusion>", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "3fba3f6217b827a7c51b9524c247f9c286731553"}, "originalPosition": 48}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMTMyOTYxMw==", "bodyText": "Defining the hamcrest dependencies here explicitly is actually more correct than it was before: Since we use hamcrest directly - so we not only depend transitively but directly.", "url": "https://github.com/pmd/pmd/pull/2465#discussion_r421329613", "createdAt": "2020-05-07T08:28:15Z", "author": {"login": "adangel"}, "path": "pmd-apex/pom.xml", "diffHunk": "@@ -64,7 +64,11 @@\n       <artifactId>saxon</artifactId>\n     </dependency>\n \n-\n+    <dependency>", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "3fba3f6217b827a7c51b9524c247f9c286731553"}, "originalPosition": 5}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMTMzMDAzNQ==", "bodyText": "please use hamcrest instead of hamcrest-library", "url": "https://github.com/pmd/pmd/pull/2465#discussion_r421330035", "createdAt": "2020-05-07T08:28:53Z", "author": {"login": "adangel"}, "path": "pmd-core/pom.xml", "diffHunk": "@@ -157,13 +157,13 @@\n             <scope>test</scope>\n         </dependency>\n         <dependency>\n-            <groupId>junit</groupId>\n-            <artifactId>junit</artifactId>\n+            <groupId>org.hamcrest</groupId>\n+            <artifactId>hamcrest-library</artifactId>", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "3fba3f6217b827a7c51b9524c247f9c286731553"}, "originalPosition": 7}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMTMzODU0Nw==", "bodyText": "Maybe we do not need to declare the dependency here - because we should get it transitively via pmd-test (see the comment there).\nCan you try this?\nIn general, we should declare the hamcrest dependency explicitly, if we use hamcrest matchers directly in our unit tests (instead of JUnit's Asserts).\nBtw. the JUnit's Assert is implemented internally by using hamcrest, so, if we don't have the hamcrest dependency at all, no Asserts will work.\nBut I think, that's ok - we will immediately see, when we have forgotten the dependency, because then we will have test failures.", "url": "https://github.com/pmd/pmd/pull/2465#discussion_r421338547", "createdAt": "2020-05-07T08:42:39Z", "author": {"login": "adangel"}, "path": "pmd-cpp/pom.xml", "diffHunk": "@@ -73,7 +73,11 @@\n             <groupId>commons-io</groupId>\n             <artifactId>commons-io</artifactId>\n         </dependency>\n-\n+        <dependency>\n+            <groupId>org.hamcrest</groupId>\n+            <artifactId>hamcrest</artifactId>", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "3fba3f6217b827a7c51b9524c247f9c286731553"}, "originalPosition": 7}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMTM0ODg0MA==", "bodyText": "I think, that might actually be a solution: This hamcrest dependency here will become a transitive dependency for all the other modules, that depend on pmd-test (which should be all modules except for pmd-core).\nNote: while the scope here is compile (for pmd-test), it will be the scope test for the other modules, since pmd-test is included there as scope test.", "url": "https://github.com/pmd/pmd/pull/2465#discussion_r421348840", "createdAt": "2020-05-07T08:58:31Z", "author": {"login": "adangel"}, "path": "pmd-test/pom.xml", "diffHunk": "@@ -12,6 +12,11 @@\n     </parent>\n \n     <dependencies>\n+        <dependency>\n+            <groupId>org.hamcrest</groupId>\n+            <artifactId>hamcrest</artifactId>\n+            <scope>compile</scope>", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "3fba3f6217b827a7c51b9524c247f9c286731553"}, "originalPosition": 7}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "5053b7beb4f634c67a250986e0471b86ac0ba90a", "author": {"user": {"login": "KroArtem", "name": "Artem"}}, "url": "https://github.com/pmd/pmd/commit/5053b7beb4f634c67a250986e0471b86ac0ba90a", "committedDate": "2020-05-11T12:25:07Z", "message": "review fixes: exclude hamcrest-library, hamcrest-core from junit, rm assertj-core from root pom, move mockito, wiremock and system-rules to test scope"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDE2NzczODgy", "url": "https://github.com/pmd/pmd/pull/2465#pullrequestreview-416773882", "createdAt": "2020-05-22T09:28:14Z", "commit": {"oid": "5053b7beb4f634c67a250986e0471b86ac0ba90a"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yMlQwOToyODoxNVrOGZQu3Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yMlQwOToyODoxNVrOGZQu3Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyOTE0MTcyNQ==", "bodyText": "Note, this should be scope compile - see comment above in the pom file.... I'll change that before merging", "url": "https://github.com/pmd/pmd/pull/2465#discussion_r429141725", "createdAt": "2020-05-22T09:28:15Z", "author": {"login": "adangel"}, "path": "pmd-lang-test/pom.xml", "diffHunk": "@@ -93,6 +93,11 @@\n              so that they are automatically available to users\n              of the pmd-lang-test module\n         -->\n+        <dependency>\n+            <groupId>org.hamcrest</groupId>\n+            <artifactId>hamcrest</artifactId>\n+            <scope>test</scope>", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "5053b7beb4f634c67a250986e0471b86ac0ba90a"}, "originalPosition": 7}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4778, "cost": 1, "resetAt": "2021-11-01T16:37:27Z"}}}