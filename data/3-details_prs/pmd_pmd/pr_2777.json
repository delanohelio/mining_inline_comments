{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDg1ODg5MDc3", "number": 2777, "title": "[java] Implement constant values", "bodyText": "Describe the PR\nFinish implementing ASTExpression#getConstValue, by also considering things like references to constant fields, and eg constant string concatenations, additions, etc.\nRelated issues\n\nThis is an item of #2701\nFixes #520: now, we can use constant expressions to suppress warnings\n\nReady?\n\n\n Added unit tests for fixed bug/feature\n Passing all unit tests\n Complete build ./mvnw clean verify passes (checked automatically by travis)\n Added (in-code) documentation (if needed)", "createdAt": "2020-09-12T12:26:28Z", "url": "https://github.com/pmd/pmd/pull/2777", "merged": true, "mergeCommit": {"oid": "4820f0c041447f9b403f9923c37e00fbb67caba5"}, "closed": true, "closedAt": "2020-09-17T13:05:11Z", "author": {"login": "oowekyala"}, "timelineItems": {"totalCount": 7, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdH2FOQgH2gAyNDg1ODg5MDc3OmE1ODI1MDRjMTQ0NWI3Mzg2NWQ2NDk4MTRlNzUyOTgwZmM2ZjZiY2Y=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdJwQa-AFqTQ5MDU0MTEwNw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "a582504c1445b73865d649814e752980fc6f6bcf", "author": {"user": {"login": "oowekyala", "name": "Cl\u00e9ment Fournier"}}, "url": "https://github.com/pmd/pmd/commit/a582504c1445b73865d649814e752980fc6f6bcf", "committedDate": "2020-09-11T14:15:17Z", "message": "Implement constant expressions"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "0c8851a3c1ebe4ee78be091973c7e460716bfdec", "author": {"user": {"login": "oowekyala", "name": "Cl\u00e9ment Fournier"}}, "url": "https://github.com/pmd/pmd/commit/0c8851a3c1ebe4ee78be091973c7e460716bfdec", "committedDate": "2020-09-11T14:26:20Z", "message": "Implement references to constant fields"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "9cf91bad0b4c7faeff3ddd158ef9b1a3dfab9cf1", "author": {"user": {"login": "oowekyala", "name": "Cl\u00e9ment Fournier"}}, "url": "https://github.com/pmd/pmd/commit/9cf91bad0b4c7faeff3ddd158ef9b1a3dfab9cf1", "committedDate": "2020-09-11T14:35:32Z", "message": "Fix #520: suppress warnings with const expr"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "1001c4a4515aff385fe8c696660a8891d4c614b3", "author": {"user": {"login": "oowekyala", "name": "Cl\u00e9ment Fournier"}}, "url": "https://github.com/pmd/pmd/commit/1001c4a4515aff385fe8c696660a8891d4c614b3", "committedDate": "2020-09-12T00:26:09Z", "message": "Fix tests"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "2da4d4eac87e3baf3365a679bfc22b5f5c1a955e", "author": {"user": {"login": "oowekyala", "name": "Cl\u00e9ment Fournier"}}, "url": "https://github.com/pmd/pmd/commit/2da4d4eac87e3baf3365a679bfc22b5f5c1a955e", "committedDate": "2020-09-12T12:02:58Z", "message": "Merge branch 'java-grammar' into java-const-values"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ea5b18fb25dcfeb569786d0a4ef683fcf5a2596e", "author": {"user": {"login": "oowekyala", "name": "Cl\u00e9ment Fournier"}}, "url": "https://github.com/pmd/pmd/commit/ea5b18fb25dcfeb569786d0a4ef683fcf5a2596e", "committedDate": "2020-09-12T12:25:18Z", "message": "Checkstyle"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDkwNTQxMTA3", "url": "https://github.com/pmd/pmd/pull/2777#pullrequestreview-490541107", "createdAt": "2020-09-17T12:30:25Z", "commit": {"oid": "ea5b18fb25dcfeb569786d0a4ef683fcf5a2596e"}, "state": "APPROVED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xN1QxMjozMDoyNVrOHTfuTQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xN1QxMjozMDoyNVrOHTfuTQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MDIwNDc0OQ==", "bodyText": "(\"PMD.\" + rule.getName()).equals(stringVal) // NOPMD uselessparentheses false positive\n\nSeems to be #2739", "url": "https://github.com/pmd/pmd/pull/2777#discussion_r490204749", "createdAt": "2020-09-17T12:30:25Z", "author": {"login": "adangel"}, "path": "pmd-java/src/main/java/net/sourceforge/pmd/lang/java/rule/internal/AnnotationSuppressionUtil.java", "diffHunk": "@@ -108,15 +109,19 @@ private static boolean hasSuppressWarningsAnnotationFor(final Annotatable node,\n     // @formatter:on\n     private static boolean annotationSuppresses(ASTAnnotation annotation, Rule rule) {\n         if (TypeTestUtil.isA(SuppressWarnings.class, annotation)) {\n-            for (ASTStringLiteral element : annotation.findDescendantsOfType(ASTStringLiteral.class)) {\n-                if (element.hasImageEqualTo(\"\\\"PMD\\\"\") || element.hasImageEqualTo(\n-                    \"\\\"PMD.\" + rule.getName() + \"\\\"\")\n-                    // Check for standard annotations values\n-                    || element.hasImageEqualTo(\"\\\"all\\\"\")\n-                    || element.hasImageEqualTo(\"\\\"serial\\\"\") && SERIAL_RULES.contains(rule.getName())\n-                    || element.hasImageEqualTo(\"\\\"unused\\\"\") && UNUSED_RULES.contains(rule.getName())\n-                    || element.hasImageEqualTo(\"\\\"all\\\"\")) {\n-                    return true;\n+            for (ASTMemberValue value : annotation.getValuesForName(ASTMemberValuePair.VALUE_ATTR)) {\n+                Object constVal = value.getConstValue();\n+                if (constVal instanceof String) {\n+                    String stringVal = (String) constVal;\n+                    if (\"PMD\".equals(stringVal)\n+                        || (\"PMD.\" + rule.getName()).equals(stringVal) // NOPMD uselessparentheses false positive", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ea5b18fb25dcfeb569786d0a4ef683fcf5a2596e"}, "originalPosition": 29}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4724, "cost": 1, "resetAt": "2021-11-01T16:37:27Z"}}}