{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0MzkxNjQ2MTQ0", "number": 2371, "title": "[core] Generify GenericToken, cleanup Token managers & CPD", "bodyText": "Make GenericToken... generic. This removes a lot of unchecked casts in CPD code. TokenManager, TokenFilter are also generified\nCleanup TokenMgrError. A lot of things are not needed anymore since all modules have been ported to the new wrapper script.\nCleanup AbstractTokenManager. Setting the filename on a ThreadLocal is unnecessary and counterproductive, because the class couldn't even implement TokenManager (name clash). Instead the TokenMgrErrors are caught by CPD at the point where we have a SourceCode instance, so we also have a file name. The exception is enriched with the file name and rethrown.\nSince that is so, we can remove setFileName from TokenManager, and AbstractTokenManager can implement TokenManager. We actually don't need wrappers around the generated token managers anymore. We can just use them directly as TokenManager<JavaccToken>. This is what CPD Tokenizers do now, and the wrappers are removed.\nWe can also remove createTokenManager from the Parser interface. This was actually never used, inconsistently supported, and duplicates logic.\n\nThere is still way to go to cleanup the CPD codebase, but I guess, this is a first step.\nDeprecations on master\n\n deprecate Parser::getTokenManager, TokenManager::setFileName, AbstractTokenManager::getFileName, AbstractTokenManager::setFileName - done via #2372", "createdAt": "2020-03-20T17:08:56Z", "url": "https://github.com/pmd/pmd/pull/2371", "merged": true, "mergeCommit": {"oid": "f93e8b9a482b71556c9f731dea24d35f16a0eb37"}, "closed": true, "closedAt": "2020-04-10T17:16:14Z", "author": {"login": "oowekyala"}, "timelineItems": {"totalCount": 16, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcPjjYQAH2gAyMzkxNjQ2MTQ0OjMwODg2NTQ0YzUzZGY1YzliZDk5YTVlNmZkNzBhMmNlNDYwOWMyZTM=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcWUXg2AFqTM5MTUyNDEwMw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "30886544c53df5c9bd99a5e6fd70a2ce4609c2e3", "author": {"user": {"login": "oowekyala", "name": "Cl\u00e9ment Fournier"}}, "url": "https://github.com/pmd/pmd/commit/30886544c53df5c9bd99a5e6fd70a2ce4609c2e3", "committedDate": "2020-03-20T17:00:16Z", "message": "Deprecations to clean up CPD"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "2b36ef5e39c02ac1de208c4a202fc6cc0692fdc1", "author": {"user": {"login": "oowekyala", "name": "Cl\u00e9ment Fournier"}}, "url": "https://github.com/pmd/pmd/commit/2b36ef5e39c02ac1de208c4a202fc6cc0692fdc1", "committedDate": "2020-03-20T17:07:42Z", "message": "Merge branch 'deprecate-token-mgr-stuff' into tmp"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "3cdcba2299a1be1789ecd9f232d4c6be61bcc6ef", "author": {"user": {"login": "oowekyala", "name": "Cl\u00e9ment Fournier"}}, "url": "https://github.com/pmd/pmd/commit/3cdcba2299a1be1789ecd9f232d4c6be61bcc6ef", "committedDate": "2020-03-20T17:07:56Z", "message": "Fix file name for token manager error"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e9b65823bf29694442ddd133620ed23f2216b65e", "author": {"user": {"login": "oowekyala", "name": "Cl\u00e9ment Fournier"}}, "url": "https://github.com/pmd/pmd/commit/e9b65823bf29694442ddd133620ed23f2216b65e", "committedDate": "2020-03-20T17:07:56Z", "message": "Cleanup TokenMgrError"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "368573e7c731e3a2559b53e2ee276cc86c3e6f3a", "author": {"user": {"login": "oowekyala", "name": "Cl\u00e9ment Fournier"}}, "url": "https://github.com/pmd/pmd/commit/368573e7c731e3a2559b53e2ee276cc86c3e6f3a", "committedDate": "2020-03-20T17:07:56Z", "message": "Start removing TokenManager wrappers"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "cd5af6a12dcd0e8c34e6afdedf179e992f3fe0db", "author": {"user": {"login": "oowekyala", "name": "Cl\u00e9ment Fournier"}}, "url": "https://github.com/pmd/pmd/commit/cd5af6a12dcd0e8c34e6afdedf179e992f3fe0db", "committedDate": "2020-03-20T17:07:56Z", "message": "do it in c++"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f64acb6c3859a4e59aa0240b3de81dc31cd43f15", "author": {"user": {"login": "oowekyala", "name": "Cl\u00e9ment Fournier"}}, "url": "https://github.com/pmd/pmd/commit/f64acb6c3859a4e59aa0240b3de81dc31cd43f15", "committedDate": "2020-03-20T17:07:56Z", "message": "python"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "96feed7b83c6f136da2642643ce76605a50591ef", "author": {"user": {"login": "oowekyala", "name": "Cl\u00e9ment Fournier"}}, "url": "https://github.com/pmd/pmd/commit/96feed7b83c6f136da2642643ce76605a50591ef", "committedDate": "2020-03-20T17:07:56Z", "message": "Do it for the other languages"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "7b091f2be2dc4f4e672a072aa400855da471c838", "author": {"user": {"login": "oowekyala", "name": "Cl\u00e9ment Fournier"}}, "url": "https://github.com/pmd/pmd/commit/7b091f2be2dc4f4e672a072aa400855da471c838", "committedDate": "2020-03-20T17:07:56Z", "message": "Fix other generic uses of GenericToken"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "62a9d5b65575add31c20664faca35593f2a7e0b3", "author": {"user": {"login": "oowekyala", "name": "Cl\u00e9ment Fournier"}}, "url": "https://github.com/pmd/pmd/commit/62a9d5b65575add31c20664faca35593f2a7e0b3", "committedDate": "2020-03-20T17:07:56Z", "message": "Fix build"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "16f30c9ece16845c96ba21db99fc4f34600a156c", "author": {"user": {"login": "oowekyala", "name": "Cl\u00e9ment Fournier"}}, "url": "https://github.com/pmd/pmd/commit/16f30c9ece16845c96ba21db99fc4f34600a156c", "committedDate": "2020-03-21T23:48:16Z", "message": "Make Antlr token manager throw TokenMgrError directly"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f6260463d77cd78d519fe4e2b61e3b50d0571304", "author": {"user": {"login": "oowekyala", "name": "Cl\u00e9ment Fournier"}}, "url": "https://github.com/pmd/pmd/commit/f6260463d77cd78d519fe4e2b61e3b50d0571304", "committedDate": "2020-03-21T23:50:26Z", "message": "Make Antlr token implementation respect its contract"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "2ea78db0dc51202c209514c19ea7413b7ae5f4d2", "author": {"user": {"login": "oowekyala", "name": "Cl\u00e9ment Fournier"}}, "url": "https://github.com/pmd/pmd/commit/2ea78db0dc51202c209514c19ea7413b7ae5f4d2", "committedDate": "2020-03-21T23:56:10Z", "message": "Checkstyle"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a8af14676d645573d065632f05ffd8dc8269b8a7", "author": {"user": {"login": "oowekyala", "name": "Cl\u00e9ment Fournier"}}, "url": "https://github.com/pmd/pmd/commit/a8af14676d645573d065632f05ffd8dc8269b8a7", "committedDate": "2020-03-22T00:03:59Z", "message": "Add isEof method"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "78edecc80fd0d7f00a0279722c5bb459544ca3be", "author": {"user": {"login": "oowekyala", "name": "Cl\u00e9ment Fournier"}}, "url": "https://github.com/pmd/pmd/commit/78edecc80fd0d7f00a0279722c5bb459544ca3be", "committedDate": "2020-03-22T00:00:50Z", "message": "Add isEof method"}, "afterCommit": {"oid": "a8af14676d645573d065632f05ffd8dc8269b8a7", "author": {"user": {"login": "oowekyala", "name": "Cl\u00e9ment Fournier"}}, "url": "https://github.com/pmd/pmd/commit/a8af14676d645573d065632f05ffd8dc8269b8a7", "committedDate": "2020-03-22T00:03:59Z", "message": "Add isEof method"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzkxNTI0MTAz", "url": "https://github.com/pmd/pmd/pull/2371#pullrequestreview-391524103", "createdAt": "2020-04-10T16:09:22Z", "commit": {"oid": "a8af14676d645573d065632f05ffd8dc8269b8a7"}, "state": "COMMENTED", "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0xMFQxNjowOToyMlrOGD-uRA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0xMFQxNjozMDo0M1rOGD_RcA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNjgyNjU2NA==", "bodyText": "What is the meaning of the package \"impl\"? I see this very often. Is there a difference between \"internal\" and \"impl\"? I think, we should stick at some point to one name...\nThe class AntlrToken is now moved from package net.sourceforge.pmd.cpd.token to net.sourceforge.pmd.lang.ast.impl.antlr4. This is a breaking API change, but one that can be fixed with \"organize imports\". Is it worth to do any deprecation warning on master for that change?", "url": "https://github.com/pmd/pmd/pull/2371#discussion_r406826564", "createdAt": "2020-04-10T16:09:22Z", "author": {"login": "adangel"}, "path": "pmd-core/src/main/java/net/sourceforge/pmd/lang/ast/impl/antlr4/AntlrToken.java", "diffHunk": "@@ -1,8 +1,8 @@\n-/**\n+/*\n  * BSD-style license; for more info see http://pmd.sourceforge.net/license.html\n  */\n \n-package net.sourceforge.pmd.cpd.token;\n+package net.sourceforge.pmd.lang.ast.impl.antlr4;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "a8af14676d645573d065632f05ffd8dc8269b8a7"}, "originalPosition": 7}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNjgzNDE3OQ==", "bodyText": "Maybe we should move CppCharStream then into a internal package? I think, this is just an implementation detail and API users should not need to care about it....", "url": "https://github.com/pmd/pmd/pull/2371#discussion_r406834179", "createdAt": "2020-04-10T16:27:20Z", "author": {"login": "adangel"}, "path": "pmd-cpp/src/main/java/net/sourceforge/pmd/lang/cpp/ast/CppCharStream.java", "diffHunk": "@@ -20,7 +20,7 @@\n  *\n  * @author Andreas Dangel\n  */\n-class CppCharStream extends SimpleCharStream {\n+public class CppCharStream extends SimpleCharStream {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "a8af14676d645573d065632f05ffd8dc8269b8a7"}, "originalPosition": 5}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNjgzNTU2OA==", "bodyText": "That's also an API change - but that would be easy to handle on master.\nFixed on master with 0710877", "url": "https://github.com/pmd/pmd/pull/2371#discussion_r406835568", "createdAt": "2020-04-10T16:30:43Z", "author": {"login": "adangel"}, "path": "pmd-core/src/main/java/net/sourceforge/pmd/lang/ast/impl/antlr4/AntlrToken.java", "diffHunk": "@@ -64,7 +69,7 @@ public int getEndColumn() {\n         return token.getCharPositionInLine() + token.getStopIndex() - token.getStartIndex();\n     }\n \n-    public int getType() {\n+    public int getKind() {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "a8af14676d645573d065632f05ffd8dc8269b8a7"}, "originalPosition": 58}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4937, "cost": 1, "resetAt": "2021-11-01T16:37:27Z"}}}