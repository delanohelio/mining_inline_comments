{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0Mzc2NzUyMjA0", "number": 2297, "title": "[apex] Cognitive complexity metrics", "bodyText": "Before submitting a PR, please check that:\n\n The PR is submitted against master. The PMD team will merge back to support branches as needed.\n ./mvnw clean verify passes. This will build and test PMD, execute PMD and checkstyle rules. Check this for more info\n\nPR Description:\nFixes #2162\nAdds a cognitive complexity metric for apex allowing you to use either cyclomatic complexity or cognitive complexity (or both). This is work in progress. I still need to run it against some real apex code (not just my tests) to ensure that something reasonable happens here.\nI've created the PR early to get some early feedback in case people feel like I'm going in the wrong direction.\nStill TODO:\n\n Whole class rule.\n Fill in the TODO in the design.xml file.\n Test against real apex classes.\n\nNot done:\n\nMutual recursion. This is probably quite hard so unless it is really wanted, I won't do this yet.\nSwitch statements. It seems like these don't parse in the current version of PMD?\nBoolean expressions. The way I've done it here doesn't 100% line up with the version in the paper - this uses the AST rather then as it's written so a && b || c && d gets complexity 2 rather than 3 because it parses as (a && b) || (c && d) which gives traversing order of ||, &&, && and therefore complexity 2.\n\nRequest for help:\n\nThere is a TODO in design.xml for what to fill in as the description and an example. I'm not quite sure what to put there.\n\nSome questions:\n\nI've put the visitor state in a State object because that's what the other visitors do, but it seems like I can make it part of the visitor itself which may be nicer (saves the State state = (State) data at the beginning of every line).", "createdAt": "2020-02-18T17:47:24Z", "url": "https://github.com/pmd/pmd/pull/2297", "merged": true, "mergeCommit": {"oid": "68e4f52da1f6330881e2d860bbb400f96e7fe9e6"}, "closed": true, "closedAt": "2020-02-22T11:27:59Z", "author": {"login": "gwilymatgearset"}, "timelineItems": {"totalCount": 31, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcFfpAYgH2gAyMzc2NzUyMjA0OjljMDkzMDNkNzUzY2JkNDZjYmQ4ZjA1MjE4YjFmOTllYmE4OTEwOTY=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcGxzcbAFqTM2MzAyMjI0OA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "9c09303d753cbd46cbd8f05218b1f99eba891096", "author": {"user": {"login": "gwilymatgearset", "name": null}}, "url": "https://github.com/pmd/pmd/commit/9c09303d753cbd46cbd8f05218b1f99eba891096", "committedDate": "2020-02-18T10:47:33Z", "message": "Skeleton implementation of CognativeComplexityVisitor"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "69c239e5a37366f613c7330d8015e70c9a14e07c", "author": {"user": {"login": "gwilymatgearset", "name": null}}, "url": "https://github.com/pmd/pmd/commit/69c239e5a37366f613c7330d8015e70c9a14e07c", "committedDate": "2020-02-18T11:02:06Z", "message": "Register the cognitive complexity measure"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "0967e437671f53aab2aa6a7bfb830698109eb411", "author": {"user": {"login": "gwilymatgearset", "name": null}}, "url": "https://github.com/pmd/pmd/commit/0967e437671f53aab2aa6a7bfb830698109eb411", "committedDate": "2020-02-18T11:02:31Z", "message": "Add class level cognitive complexity measures"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a8234af9a6aaeb950999c234ab3b93669467d35c", "author": {"user": {"login": "gwilymatgearset", "name": null}}, "url": "https://github.com/pmd/pmd/commit/a8234af9a6aaeb950999c234ab3b93669467d35c", "committedDate": "2020-02-18T11:02:56Z", "message": "Create design rule for cognitive complexity"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "01da573f5fcda19dcce70241fac88e5d97b3f553", "author": {"user": {"login": "gwilymatgearset", "name": null}}, "url": "https://github.com/pmd/pmd/commit/01da573f5fcda19dcce70241fac88e5d97b3f553", "committedDate": "2020-02-18T11:24:39Z", "message": "Add design rule for CognitiveComplexity"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "8c357fb8876da1db4957015859383e594296a134", "author": {"user": {"login": "gwilymatgearset", "name": null}}, "url": "https://github.com/pmd/pmd/commit/8c357fb8876da1db4957015859383e594296a134", "committedDate": "2020-02-18T11:47:36Z", "message": "Add tests for CognitiveComplexity"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "38ea3d1be92066783ce139c7ceaa12d0e7b99eb5", "author": {"user": {"login": "gwilymatgearset", "name": null}}, "url": "https://github.com/pmd/pmd/commit/38ea3d1be92066783ce139c7ceaa12d0e7b99eb5", "committedDate": "2020-02-18T11:47:40Z", "message": "Implement complexity for `if`"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "cea2081628dee5c1cfb9222596efbc30539c48c5", "author": {"user": {"login": "gwilymatgearset", "name": null}}, "url": "https://github.com/pmd/pmd/commit/cea2081628dee5c1cfb9222596efbc30539c48c5", "committedDate": "2020-02-18T11:51:46Z", "message": "Cognitive complexity for nested if statements"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "9492ca02c171e52a11814712f4951b1aa404eba9", "author": {"user": {"login": "gwilymatgearset", "name": null}}, "url": "https://github.com/pmd/pmd/commit/9492ca02c171e52a11814712f4951b1aa404eba9", "committedDate": "2020-02-18T11:53:00Z", "message": "Add test for non-nested if statements"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "1b93be5f600ac262aae26a79750977eaa8be7a86", "author": {"user": {"login": "gwilymatgearset", "name": null}}, "url": "https://github.com/pmd/pmd/commit/1b93be5f600ac262aae26a79750977eaa8be7a86", "committedDate": "2020-02-18T14:02:56Z", "message": "Handle if-else correctly"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "50d2bcb7f1ea0df1d8611680e1d419e9fd69194d", "author": {"user": {"login": "gwilymatgearset", "name": null}}, "url": "https://github.com/pmd/pmd/commit/50d2bcb7f1ea0df1d8611680e1d419e9fd69194d", "committedDate": "2020-02-18T14:08:05Z", "message": "Cognitive complexity for for loops"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "7d3a5ef7f4e222e35ed015aad34f6fb22a0e6e2d", "author": {"user": {"login": "gwilymatgearset", "name": null}}, "url": "https://github.com/pmd/pmd/commit/7d3a5ef7f4e222e35ed015aad34f6fb22a0e6e2d", "committedDate": "2020-02-18T14:08:44Z", "message": "When increasing nesting level we always get structure and nesting complexity"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "d9e7928d75b7ec00bb3a09adbd2473372b86154b", "author": {"user": {"login": "gwilymatgearset", "name": null}}, "url": "https://github.com/pmd/pmd/commit/d9e7928d75b7ec00bb3a09adbd2473372b86154b", "committedDate": "2020-02-18T14:10:32Z", "message": "For each statements incur cognitive complexity"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "7d3bb60d8381d7889112bc5e600aacb56e969167", "author": {"user": {"login": "gwilymatgearset", "name": null}}, "url": "https://github.com/pmd/pmd/commit/7d3bb60d8381d7889112bc5e600aacb56e969167", "committedDate": "2020-02-18T14:12:07Z", "message": "Continue statements incur complexity"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b2a42bf8ccc9c7c883c666a48b34cef7ae26f3a4", "author": {"user": {"login": "gwilymatgearset", "name": null}}, "url": "https://github.com/pmd/pmd/commit/b2a42bf8ccc9c7c883c666a48b34cef7ae26f3a4", "committedDate": "2020-02-18T14:12:49Z", "message": "Break statements incur complexity"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ec870225f2ecb9797f9f7b726bed6a3c9d761723", "author": {"user": {"login": "gwilymatgearset", "name": null}}, "url": "https://github.com/pmd/pmd/commit/ec870225f2ecb9797f9f7b726bed6a3c9d761723", "committedDate": "2020-02-18T15:16:26Z", "message": "While statements incur nesting complexity"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "559c1d9c397eafe87e6d54a070db4e6666043397", "author": {"user": {"login": "gwilymatgearset", "name": null}}, "url": "https://github.com/pmd/pmd/commit/559c1d9c397eafe87e6d54a070db4e6666043397", "committedDate": "2020-02-18T15:19:39Z", "message": "Catch blocks incur nesting complexity"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "5ea69530d7a65dae5a6173368c01ff9e3e639d74", "author": {"user": {"login": "gwilymatgearset", "name": null}}, "url": "https://github.com/pmd/pmd/commit/5ea69530d7a65dae5a6173368c01ff9e3e639d74", "committedDate": "2020-02-18T15:40:46Z", "message": "Add do-while loop nesting complexity"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "4b26d22c73c42a77d53871a217163197a4e80472", "author": {"user": {"login": "gwilymatgearset", "name": null}}, "url": "https://github.com/pmd/pmd/commit/4b26d22c73c42a77d53871a217163197a4e80472", "committedDate": "2020-02-18T15:56:08Z", "message": "Ternary operators increase nesting complexity"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a4db0ea069f513fd5671aa6897e31025397400ea", "author": {"user": {"login": "gwilymatgearset", "name": null}}, "url": "https://github.com/pmd/pmd/commit/a4db0ea069f513fd5671aa6897e31025397400ea", "committedDate": "2020-02-18T16:32:28Z", "message": "Any boolean expression causes increases in cognative complexity"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "0231350dea7b8235a9309b24d15088ab59eea09f", "author": {"user": {"login": "gwilymatgearset", "name": null}}, "url": "https://github.com/pmd/pmd/commit/0231350dea7b8235a9309b24d15088ab59eea09f", "committedDate": "2020-02-18T16:59:12Z", "message": "Handle boolean expressions on different statements"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "9d0fb82d6f5f66cec01b6c3537fe9e78da3cc678", "author": {"user": {"login": "gwilymatgearset", "name": null}}, "url": "https://github.com/pmd/pmd/commit/9d0fb82d6f5f66cec01b6c3537fe9e78da3cc678", "committedDate": "2020-02-18T17:06:18Z", "message": "Increase cognitive complexity on recursion"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "acfbb132d199fef8e40cdbaedd1ea4e00dd857b4", "author": {"user": {"login": "gwilymatgearset", "name": null}}, "url": "https://github.com/pmd/pmd/commit/acfbb132d199fef8e40cdbaedd1ea4e00dd857b4", "committedDate": "2020-02-18T17:07:22Z", "message": "We don't actually support switch statements yet"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "5d55b84f96e93f92e139827cb4db4b7def581cb5", "author": {"user": {"login": "gwilymatgearset", "name": null}}, "url": "https://github.com/pmd/pmd/commit/5d55b84f96e93f92e139827cb4db4b7def581cb5", "committedDate": "2020-02-18T17:24:40Z", "message": "Fix checkstyle errors"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "de878175c8bc42d98872883e84c2598fd80b05c7", "author": {"user": {"login": "gwilymatgearset", "name": null}}, "url": "https://github.com/pmd/pmd/commit/de878175c8bc42d98872883e84c2598fd80b05c7", "committedDate": "2020-02-18T17:29:37Z", "message": "Use correct message for cognitive complexity rule"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzYwNTU5NTQx", "url": "https://github.com/pmd/pmd/pull/2297#pullrequestreview-360559541", "createdAt": "2020-02-18T18:10:14Z", "commit": {"oid": "de878175c8bc42d98872883e84c2598fd80b05c7"}, "state": "COMMENTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xOFQxODoxMDoxNFrOFrM-Xw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xOFQxODoxMzo1N1rOFrNGCg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MDg0NTY2Mw==", "bodyText": "This would be since=\"6.22.0\", if it ships with the next release.", "url": "https://github.com/pmd/pmd/pull/2297#discussion_r380845663", "createdAt": "2020-02-18T18:10:14Z", "author": {"login": "adangel"}, "path": "pmd-apex/src/main/resources/category/apex/design.xml", "diffHunk": "@@ -86,6 +86,22 @@ public class Complicated {\n         </example>\n     </rule>\n \n+    <rule name=\"CognitiveComplexity\"\n+          message=\"The {0} ''{1}'' has a{2} cognitive complexity of {3}.\"\n+          since=\"6.0.0\"", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "de878175c8bc42d98872883e84c2598fd80b05c7"}, "originalPosition": 6}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MDg0NzYyNg==", "bodyText": "What you enter here will appear in the generated online documentation -> Example entry for cyclomatic complexity: https://pmd.github.io/latest/pmd_rules_apex_design.html#cyclomaticcomplexity\nThe description should help users to decide, whether they want to enable this rule or not. In this case, it should probably shortly explain what cognitive complexity is and link to the paper. You may also reason about the advantages of simpler software (less bugs, easier to understand, less maintenance cost).\nThe example section below could give 2 or 3 short examples to explain, how the metric is calculated - similar to what you did in the tests (// +1 or // +2).", "url": "https://github.com/pmd/pmd/pull/2297#discussion_r380847626", "createdAt": "2020-02-18T18:13:57Z", "author": {"login": "adangel"}, "path": "pmd-apex/src/main/resources/category/apex/design.xml", "diffHunk": "@@ -86,6 +86,22 @@ public class Complicated {\n         </example>\n     </rule>\n \n+    <rule name=\"CognitiveComplexity\"\n+          message=\"The {0} ''{1}'' has a{2} cognitive complexity of {3}.\"\n+          since=\"6.0.0\"\n+          class=\"net.sourceforge.pmd.lang.apex.rule.design.CognitiveComplexityRule\"\n+          externalInfoUrl=\"${pmd.website.baseurl}/pmd_rules_apex_design.html#cognitivecomplexity\">\n+        <description>\n+            TODO", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "de878175c8bc42d98872883e84c2598fd80b05c7"}, "originalPosition": 10}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a22d6f62b470d64eb0448db653e99053ff5e818e", "author": {"user": {"login": "gwilymatgearset", "name": null}}, "url": "https://github.com/pmd/pmd/commit/a22d6f62b470d64eb0448db653e99053ff5e818e", "committedDate": "2020-02-19T10:24:40Z", "message": "Optimistically say that cognitive complexity is in the next release"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "413d64ff39a5e074b6bca7e1af57527c87a45b0f", "author": {"user": {"login": "gwilymatgearset", "name": null}}, "url": "https://github.com/pmd/pmd/commit/413d64ff39a5e074b6bca7e1af57527c87a45b0f", "committedDate": "2020-02-19T14:22:30Z", "message": "Increase default values for cognitive complexity based on authors opinions"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "68e4f52da1f6330881e2d860bbb400f96e7fe9e6", "author": {"user": {"login": "gwilymatgearset", "name": null}}, "url": "https://github.com/pmd/pmd/commit/68e4f52da1f6330881e2d860bbb400f96e7fe9e6", "committedDate": "2020-02-19T16:28:02Z", "message": "Fill in TODO in documentation for coginitive complexity"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzYyMTkyOTQ0", "url": "https://github.com/pmd/pmd/pull/2297#pullrequestreview-362192944", "createdAt": "2020-02-20T19:59:15Z", "commit": {"oid": "68e4f52da1f6330881e2d860bbb400f96e7fe9e6"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzYzMDIyMjQ4", "url": "https://github.com/pmd/pmd/pull/2297#pullrequestreview-363022248", "createdAt": "2020-02-22T10:31:10Z", "commit": {"oid": "68e4f52da1f6330881e2d860bbb400f96e7fe9e6"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4899, "cost": 1, "resetAt": "2021-11-01T16:37:27Z"}}}