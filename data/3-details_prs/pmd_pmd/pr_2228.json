{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0MzYzMzkxNjM3", "number": 2228, "title": "[java] Symbol tables for imports", "bodyText": "Follow up on #2178. The PR includes:\n\nImplementations of the symbol tables for import declarations. The order these tables are chained in respects the precedence of each kind of import (eg import on demands are shadowed by java lang imports). This is described on the package-info of the internal package\nImplementation of the symbol table resolver. This is a new visitor, that runs after qualified name resolution. Its role is to create symbol tables, chain them in the correct order, and set them on the relevant nodes\n\nInput to this process is a SymbolResolver (abstraction over a ClassLoader), and a special logger object used to report missing declarations. If an imported type is missing it's still resolved as an \"unresolved class\" to perform symbolic resolution later, instead of dealing with null everywhere.\n\n\nFor now everything is inside a processing stage\n\nNext steps\n\nImplement AST-based symbols & related symbol tables (eg for blocks)\nIntroduce new type representation API", "createdAt": "2020-01-15T23:55:57Z", "url": "https://github.com/pmd/pmd/pull/2228", "merged": true, "mergeCommit": {"oid": "cceba2210fad8b117f946e140bd013414c8b9f14"}, "closed": true, "closedAt": "2020-01-28T13:29:00Z", "author": {"login": "oowekyala"}, "timelineItems": {"totalCount": 20, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABb5PTY7AH2gAyMzYzMzkxNjM3OjUwZDYyMjk4NDk5YzkxZDgxOWM3YWQ2OTEwY2EwYzQ4ZTRhYWRiNzk=", "endCursor": "Y3Vyc29yOnYyOpPPAAABb9nCY6gH2gAyMzYzMzkxNjM3OmNjZWJhMjIxMGZhZDhiMTE3Zjk0NmUxNDBiZDAxMzQxNGM4YjlmMTQ=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "50d62298499c91d819c7ad6910ca0c48e4aadb79", "author": {"user": {"login": "oowekyala", "name": "Cl\u00e9ment Fournier"}}, "url": "https://github.com/pmd/pmd/commit/50d62298499c91d819c7ad6910ca0c48e4aadb79", "committedDate": "2020-01-11T08:58:22Z", "message": "Checkout symbol tables"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "2d51379949a8a55ff41953382cdd8ca759fc096d", "author": {"user": {"login": "oowekyala", "name": "Cl\u00e9ment Fournier"}}, "url": "https://github.com/pmd/pmd/commit/2d51379949a8a55ff41953382cdd8ca759fc096d", "committedDate": "2020-01-11T08:58:22Z", "message": "Stash stuff for later"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "571018244b1f7df4c3cdead3307b74cd40a9ed26", "author": {"user": {"login": "oowekyala", "name": "Cl\u00e9ment Fournier"}}, "url": "https://github.com/pmd/pmd/commit/571018244b1f7df4c3cdead3307b74cd40a9ed26", "committedDate": "2020-01-11T09:01:39Z", "message": "Fix tests"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "d56fa7451819e8d12f17525f68575b1fa2b999f1", "author": {"user": {"login": "oowekyala", "name": "Cl\u00e9ment Fournier"}}, "url": "https://github.com/pmd/pmd/commit/d56fa7451819e8d12f17525f68575b1fa2b999f1", "committedDate": "2020-01-11T12:22:09Z", "message": "Resolve results"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "cb0aa4d4d0ffb128ad5a881d38b097eae0ca065b", "author": {"user": {"login": "oowekyala", "name": "Cl\u00e9ment Fournier"}}, "url": "https://github.com/pmd/pmd/commit/cb0aa4d4d0ffb128ad5a881d38b097eae0ca065b", "committedDate": "2020-01-15T11:19:43Z", "message": "Merge branch 'java-grammar' into sym-table-impl"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "7ca7fb331f00b6a694d75aa12a34669a9d0c1418", "author": {"user": {"login": "oowekyala", "name": "Cl\u00e9ment Fournier"}}, "url": "https://github.com/pmd/pmd/commit/7ca7fb331f00b6a694d75aa12a34669a9d0c1418", "committedDate": "2020-01-15T23:02:04Z", "message": "Cleanup"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "fb7d0747a9ea483fd1b348a7506d52e88840e550", "author": {"user": {"login": "oowekyala", "name": "Cl\u00e9ment Fournier"}}, "url": "https://github.com/pmd/pmd/commit/fb7d0747a9ea483fd1b348a7506d52e88840e550", "committedDate": "2020-01-15T23:06:27Z", "message": "Merge branch 'java-grammar' into sym-table-impl"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "3b7c849f2fad582cc697cee36a5864fb66bbae2c", "author": {"user": {"login": "oowekyala", "name": "Cl\u00e9ment Fournier"}}, "url": "https://github.com/pmd/pmd/commit/3b7c849f2fad582cc697cee36a5864fb66bbae2c", "committedDate": "2020-01-15T23:13:12Z", "message": "Merge branch 'java-grammar' into sym-table-impl"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "5fba0aeb5bb8e82cfe09f675bf34b34b82796426", "author": {"user": {"login": "oowekyala", "name": "Cl\u00e9ment Fournier"}}, "url": "https://github.com/pmd/pmd/commit/5fba0aeb5bb8e82cfe09f675bf34b34b82796426", "committedDate": "2020-01-15T23:38:35Z", "message": "Remove failed resolve result"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "80d9255cf5f2eab154e245840ce1ae4a1e72af99", "author": {"user": {"login": "oowekyala", "name": "Cl\u00e9ment Fournier"}}, "url": "https://github.com/pmd/pmd/commit/80d9255cf5f2eab154e245840ce1ae4a1e72af99", "committedDate": "2020-01-16T03:35:06Z", "message": "Merge branch 'java-grammar' into sym-table-impl"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c8b967135dcc4bab0ff1755d3605424adb096b35", "author": {"user": {"login": "oowekyala", "name": "Cl\u00e9ment Fournier"}}, "url": "https://github.com/pmd/pmd/commit/c8b967135dcc4bab0ff1755d3605424adb096b35", "committedDate": "2020-01-16T04:48:37Z", "message": "Change some names"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e8f30fdcd2bfc17309bba59a61305cce4dbf8c4c", "author": {"user": {"login": "oowekyala", "name": "Cl\u00e9ment Fournier"}}, "url": "https://github.com/pmd/pmd/commit/e8f30fdcd2bfc17309bba59a61305cce4dbf8c4c", "committedDate": "2020-01-16T22:22:08Z", "message": "Merge branch 'java-grammar' into sym-table-impl"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "286de16e7e349641b4b2c65896978a0733a6d6c4", "author": {"user": {"login": "oowekyala", "name": "Cl\u00e9ment Fournier"}}, "url": "https://github.com/pmd/pmd/commit/286de16e7e349641b4b2c65896978a0733a6d6c4", "committedDate": "2020-01-16T22:26:56Z", "message": "Fix test\n\nAutoformat of IDE removed imports"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "1262e4ba27dca2e28389047a50c116829aad9dc9", "author": {"user": {"login": "oowekyala", "name": "Cl\u00e9ment Fournier"}}, "url": "https://github.com/pmd/pmd/commit/1262e4ba27dca2e28389047a50c116829aad9dc9", "committedDate": "2020-01-17T14:47:09Z", "message": "Merge branch 'java-grammar' into sym-table-impl"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c3f31f2ff29be3b78b3325f141c7b29ea4d1f0b9", "author": {"user": {"login": "oowekyala", "name": "Cl\u00e9ment Fournier"}}, "url": "https://github.com/pmd/pmd/commit/c3f31f2ff29be3b78b3325f141c7b29ea4d1f0b9", "committedDate": "2020-01-17T15:45:12Z", "message": "Merge branch 'java-grammar' into sym-table-impl"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "4f88f5dde2bb12ee5973aaa9f83f4f51749c2cc6", "author": {"user": {"login": "oowekyala", "name": "Cl\u00e9ment Fournier"}}, "url": "https://github.com/pmd/pmd/commit/4f88f5dde2bb12ee5973aaa9f83f4f51749c2cc6", "committedDate": "2020-01-18T23:21:32Z", "message": "Merge branch 'java-grammar' into sym-table-impl"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "842e871b0e24f2bc71bfedba17edde55e6bc4605", "author": {"user": {"login": "oowekyala", "name": "Cl\u00e9ment Fournier"}}, "url": "https://github.com/pmd/pmd/commit/842e871b0e24f2bc71bfedba17edde55e6bc4605", "committedDate": "2020-01-18T23:22:24Z", "message": "Fix compil"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzQ1MDE4NTc0", "url": "https://github.com/pmd/pmd/pull/2228#pullrequestreview-345018574", "createdAt": "2020-01-19T18:40:19Z", "commit": {"oid": "842e871b0e24f2bc71bfedba17edde55e6bc4605"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0xOVQxODo0MDoyMFrOFfQDMA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0xOVQxODo0MDoyMFrOFfQDMA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2ODMxMzEzNg==", "bodyText": "Maybe throw a IllegalArgumentException like in SingleImportSymbolTable?", "url": "https://github.com/pmd/pmd/pull/2228#discussion_r368313136", "createdAt": "2020-01-19T18:40:20Z", "author": {"login": "adangel"}, "path": "pmd-java/src/main/java/net/sourceforge/pmd/lang/java/symbols/table/internal/ImportOnDemandSymbolTable.java", "diffHunk": "@@ -0,0 +1,116 @@\n+/*\n+ * BSD-style license; for more info see http://pmd.sourceforge.net/license.html\n+ */\n+\n+package net.sourceforge.pmd.lang.java.symbols.table.internal;\n+\n+import java.lang.reflect.Modifier;\n+import java.util.HashMap;\n+import java.util.List;\n+import java.util.Map;\n+import java.util.Map.Entry;\n+\n+import org.checkerframework.checker.nullness.qual.Nullable;\n+\n+import net.sourceforge.pmd.lang.java.ast.ASTImportDeclaration;\n+import net.sourceforge.pmd.lang.java.symbols.JClassSymbol;\n+import net.sourceforge.pmd.lang.java.symbols.JFieldSymbol;\n+import net.sourceforge.pmd.lang.java.symbols.JMethodSymbol;\n+import net.sourceforge.pmd.lang.java.symbols.JTypeDeclSymbol;\n+import net.sourceforge.pmd.lang.java.symbols.table.JSymbolTable;\n+import net.sourceforge.pmd.lang.java.symbols.table.ResolveResult;\n+import net.sourceforge.pmd.lang.java.symbols.table.internal.ResolveResultImpl.ClassResolveResult;\n+\n+\n+/**\n+ * Scope for imports on demand. Imports-on-demand never shadow anything, so this scope, if it exists,\n+ * is the top-level non-empty scope. All scope stacks have {@link EmptySymbolTable} as bottom though, for\n+ * implementation simplicity.\n+ *\n+ * @since 7.0.0\n+ */\n+final class ImportOnDemandSymbolTable extends AbstractImportSymbolTable {\n+\n+    /** Stores the names of packages and types for which all their types are imported. */\n+    private final Map<String, ASTImportDeclaration> importedPackagesAndTypes = new HashMap<>();\n+\n+\n+    /**\n+     * @param importsOnDemand List of import-on-demand statements, mustn't be single imports!\n+     */\n+    ImportOnDemandSymbolTable(JSymbolTable parent, SymbolTableHelper helper, List<ASTImportDeclaration> importsOnDemand) {\n+        super(parent, helper);\n+\n+        for (ASTImportDeclaration anImport : importsOnDemand) {\n+            assert anImport.isImportOnDemand() : \"Expected import on demand: \" + anImport;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "842e871b0e24f2bc71bfedba17edde55e6bc4605"}, "originalPosition": 45}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "cb4ade9eee927f8aca7daf28b0156a5f0636f4c9", "author": {"user": {"login": "oowekyala", "name": "Cl\u00e9ment Fournier"}}, "url": "https://github.com/pmd/pmd/commit/cb4ade9eee927f8aca7daf28b0156a5f0636f4c9", "committedDate": "2020-01-21T15:13:21Z", "message": "Merge branch 'java-grammar' into sym-table-impl"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "cceba2210fad8b117f946e140bd013414c8b9f14", "author": {"user": {"login": "oowekyala", "name": "Cl\u00e9ment Fournier"}}, "url": "https://github.com/pmd/pmd/commit/cceba2210fad8b117f946e140bd013414c8b9f14", "committedDate": "2020-01-24T22:53:13Z", "message": "Merge branch 'java-grammar' into sym-table-impl"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4850, "cost": 1, "resetAt": "2021-11-01T16:37:27Z"}}}