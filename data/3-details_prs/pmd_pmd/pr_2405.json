{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDAwMzAxMTQ0", "number": 2405, "title": "[core] Add wildcards to node stream API", "bodyText": "Followup on #2385 (comment)\nIndeed this change is a contagious, but it maximises the usability of the API.\nI also checked out filterIsAny from the java-grammar branch and used it in one rule to see if it works. This discovered a bug with find boundaries. I changed this API a bit, now it's called asInstanceOf.\nAlso I think we should deprecate Node::getFirstParentOfAnyType on master. This causes an unchecked warning because of the generic varargs creation. In 7.0 you can now just do node.ancestors().map(asInstanceOf(....)) without a warning", "createdAt": "2020-04-07T14:24:59Z", "url": "https://github.com/pmd/pmd/pull/2405", "merged": true, "mergeCommit": {"oid": "abf94d2bbbef6c93f86fa376c106d6359d72ab41"}, "closed": true, "closedAt": "2020-04-19T20:45:37Z", "author": {"login": "oowekyala"}, "timelineItems": {"totalCount": 9, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcU-uetgH2gAyNDAwMzAxMTQ0OmYzZDRjZDgxZWQwY2U2MGJjYzBhMDYyYjU3NzkzY2E2NDUwMzYyMzY=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcX1rPEAFqTM5MzUwMjU3OA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "f3d4cd81ed0ce60bcc0a062b57793ca645036236", "author": {"user": {"login": "oowekyala", "name": "Cl\u00e9ment Fournier"}}, "url": "https://github.com/pmd/pmd/commit/f3d4cd81ed0ce60bcc0a062b57793ca645036236", "committedDate": "2020-04-06T13:29:27Z", "message": "Add wildcards to nodestream API\n\nThis makes the API more flexible, for example\nyou can get a NodeStream<JavaNode> by filtering\nwith any subclass of JavaNode."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "8163a4a088d593f1fcd4d957f5453a1394217651", "author": {"user": {"login": "oowekyala", "name": "Cl\u00e9ment Fournier"}}, "url": "https://github.com/pmd/pmd/commit/8163a4a088d593f1fcd4d957f5453a1394217651", "committedDate": "2020-04-06T13:32:40Z", "message": "Checkout filterIsAny from java-grammar"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "52e97300549f3e7a92326e972dfea32e95426a00", "author": {"user": {"login": "oowekyala", "name": "Cl\u00e9ment Fournier"}}, "url": "https://github.com/pmd/pmd/commit/52e97300549f3e7a92326e972dfea32e95426a00", "committedDate": "2020-04-06T14:11:33Z", "message": "Test some usages, fix a bug"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "09adb287ebbb8c9738bfaba05c245e1bc635676b", "author": {"user": {"login": "oowekyala", "name": "Cl\u00e9ment Fournier"}}, "url": "https://github.com/pmd/pmd/commit/09adb287ebbb8c9738bfaba05c245e1bc635676b", "committedDate": "2020-04-07T14:03:09Z", "message": "Use filterIsAny as a map function to preserve fluent API"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "9d87a7bb9023c63f3721d04b7037405188474675", "author": {"user": {"login": "oowekyala", "name": "Cl\u00e9ment Fournier"}}, "url": "https://github.com/pmd/pmd/commit/9d87a7bb9023c63f3721d04b7037405188474675", "committedDate": "2020-04-07T14:23:27Z", "message": "Rename to asInstanceOf\n\nMakes more explicit that it should be used\nwith map and not filter"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e2a420b5ffb60d4fe413dd39f537cfdcc5a9ba52", "author": {"user": {"login": "oowekyala", "name": "Cl\u00e9ment Fournier"}}, "url": "https://github.com/pmd/pmd/commit/e2a420b5ffb60d4fe413dd39f537cfdcc5a9ba52", "committedDate": "2020-04-11T21:10:25Z", "message": "Port some other usages, introduce firstNonNull"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "50b708ac5f4e45e66d3425fce97fc42638eaeb45", "author": {"user": {"login": "oowekyala", "name": "Cl\u00e9ment Fournier"}}, "url": "https://github.com/pmd/pmd/commit/50b708ac5f4e45e66d3425fce97fc42638eaeb45", "committedDate": "2020-04-14T19:18:06Z", "message": "Fix examples"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "1db09d61c70c75ae5946a5f20b599485ba69b329", "author": {"user": {"login": "adangel", "name": "Andreas Dangel"}}, "url": "https://github.com/pmd/pmd/commit/1db09d61c70c75ae5946a5f20b599485ba69b329", "committedDate": "2020-04-15T10:24:13Z", "message": "Fix compile error with javac 11\n\nThe code compiles with java 8, but not with java 11 and 12.\nIt works again with java 13.\n\nIt seems that javac stumbles over the overloaded\napply method in the interface Filtermap."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzkzNTAyNTc4", "url": "https://github.com/pmd/pmd/pull/2405#pullrequestreview-393502578", "createdAt": "2020-04-15T06:59:44Z", "commit": {"oid": "50b708ac5f4e45e66d3425fce97fc42638eaeb45"}, "state": "COMMENTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0xNVQwNjo1OTo0NFrOGFsRSw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0xNVQwNzowOTo0OVrOGFsjGw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwODYyMTM4Nw==", "bodyText": "I'm just wondering: In the above Node methods, we use the type parameter \"T\", here we use \"R\". For the sake of not surprising any users of the API - we should use the same. Here at least, it has exactly the same meaning (R/T extends Node). We could even settle with \"N\" as in \"Node\" for all methods in Node... N extends Node. Wdyt?\nUpdate: I see now, where this comes from: from NodeStream. Don't know, what's easier to grasp here...", "url": "https://github.com/pmd/pmd/pull/2405#discussion_r408621387", "createdAt": "2020-04-15T06:59:44Z", "author": {"login": "adangel"}, "path": "pmd-core/src/main/java/net/sourceforge/pmd/lang/ast/Node.java", "diffHunk": "@@ -651,7 +648,7 @@ default void removeChildAtIndex(int childIndex) {\n      *\n      * @see NodeStream#children(Class)\n      */\n-    default <R extends Node> NodeStream<R> children(Class<R> rClass) {\n+    default <R extends Node> NodeStream<R> children(Class<? extends R> rClass) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "50b708ac5f4e45e66d3425fce97fc42638eaeb45"}, "originalPosition": 108}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwODYyNTk0Nw==", "bodyText": "Only one of <pre> or {@code is needed, isn't it?", "url": "https://github.com/pmd/pmd/pull/2405#discussion_r408625947", "createdAt": "2020-04-15T07:09:49Z", "author": {"login": "adangel"}, "path": "pmd-core/src/main/java/net/sourceforge/pmd/lang/ast/NodeStream.java", "diffHunk": "@@ -975,7 +1001,62 @@ default boolean isEmpty() {\n         return upstream.cached().flatMap(aggregate);\n     }\n \n-\n+    /**\n+     * Returns a map function, that checks whether the parameter is an\n+     * instance of any of the given classes. If so, it returns the parameter,\n+     * otherwise it returns null.\n+     *\n+     * <p>This may be used to filter a node stream to those specific\n+     * classes, for example:\n+     *\n+     * <pre>{@code", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "50b708ac5f4e45e66d3425fce97fc42638eaeb45"}, "originalPosition": 155}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4758, "cost": 1, "resetAt": "2021-11-01T16:37:27Z"}}}