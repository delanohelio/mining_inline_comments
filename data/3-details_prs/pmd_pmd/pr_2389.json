{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0Mzk1MjQ0Mjkw", "number": 2389, "title": "[java] Implement AST disambiguation", "bodyText": "See AstDisambiguationPass. This is a new pass in the JavaAstProcessor, right after symbol table resolution.\nThere are still a few limitations, namely that inherited members are not considered. I reckon it's easier to add that later, as a localized improvement to the TypeMemberSymTable.\nThis is the last piece needed before we can start working on type resolution.", "createdAt": "2020-03-29T12:37:35Z", "url": "https://github.com/pmd/pmd/pull/2389", "merged": true, "mergeCommit": {"oid": "f46e95847129805807ee6eeab25222f40df55ec0"}, "closed": true, "closedAt": "2020-04-13T10:02:48Z", "author": {"login": "oowekyala"}, "timelineItems": {"totalCount": 18, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcSYPvZAH2gAyMzk1MjQ0MjkwOjQ5MGY1N2NlNjIzNjNkYmRmOWEyYWM1OGY5MjBmZjM2YWUyNDkwNTY=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcXL409AFqTM5MjA0MTYzMA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "490f57ce62363dbdf9a2ac58f920ff36ae249056", "author": {"user": {"login": "oowekyala", "name": "Cl\u00e9ment Fournier"}}, "url": "https://github.com/pmd/pmd/commit/490f57ce62363dbdf9a2ac58f920ff36ae249056", "committedDate": "2020-03-29T11:31:38Z", "message": "Revert \"REVERT ME Remove disambig stuff\"\n\nThis reverts commit bda0f886144d4c12d41d55fbf8b114523874e4a8."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "653efd09bf7ef421ca1b9290800215dd3703f835", "author": {"user": {"login": "oowekyala", "name": "Cl\u00e9ment Fournier"}}, "url": "https://github.com/pmd/pmd/commit/653efd09bf7ef421ca1b9290800215dd3703f835", "committedDate": "2020-03-29T11:31:38Z", "message": "Fix tests"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ff03e3e565915c54cd1cff7020bcb3aff6d23983", "author": {"user": {"login": "oowekyala", "name": "Cl\u00e9ment Fournier"}}, "url": "https://github.com/pmd/pmd/commit/ff03e3e565915c54cd1cff7020bcb3aff6d23983", "committedDate": "2020-03-29T11:31:38Z", "message": "Checkout updated version with early disambig, etc"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "fae6a68664d71970395c8f010c70f1918a4bff13", "author": {"user": {"login": "oowekyala", "name": "Cl\u00e9ment Fournier"}}, "url": "https://github.com/pmd/pmd/commit/fae6a68664d71970395c8f010c70f1918a4bff13", "committedDate": "2020-03-29T11:31:38Z", "message": "Test superclass"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "618f51c9a48bb6073b398c2623f2e2f10088a82c", "author": {"user": {"login": "oowekyala", "name": "Cl\u00e9ment Fournier"}}, "url": "https://github.com/pmd/pmd/commit/618f51c9a48bb6073b398c2623f2e2f10088a82c", "committedDate": "2020-03-29T12:06:03Z", "message": "Cleanup"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "18af64a5c34b1c2bdfce0b40d68b14258320ab37", "author": {"user": {"login": "oowekyala", "name": "Cl\u00e9ment Fournier"}}, "url": "https://github.com/pmd/pmd/commit/18af64a5c34b1c2bdfce0b40d68b14258320ab37", "committedDate": "2020-04-02T18:12:43Z", "message": "Merge branch 'java-grammar' into sym-disambig2"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "4d1e8d06713a196f85fbeb8654a690e59d83c312", "author": {"user": {"login": "oowekyala", "name": "Cl\u00e9ment Fournier"}}, "url": "https://github.com/pmd/pmd/commit/4d1e8d06713a196f85fbeb8654a690e59d83c312", "committedDate": "2020-04-02T18:25:47Z", "message": "Fix class cast with records"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "cd5798650ac0dc5219a9bee5f805e48d2145805b", "author": {"user": {"login": "oowekyala", "name": "Cl\u00e9ment Fournier"}}, "url": "https://github.com/pmd/pmd/commit/cd5798650ac0dc5219a9bee5f805e48d2145805b", "committedDate": "2020-04-02T18:59:52Z", "message": "Merge branch 'java-grammar' into sym-disambig2"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "179fddc5027dd1f57648bbc665a76b0378a9fbbd", "author": {"user": {"login": "oowekyala", "name": "Cl\u00e9ment Fournier"}}, "url": "https://github.com/pmd/pmd/commit/179fddc5027dd1f57648bbc665a76b0378a9fbbd", "committedDate": "2020-04-02T21:49:05Z", "message": "Merge branch 'java-grammar' into sym-disambig2"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "eca2ee54fe999ff54527499265a6ea389a365936", "author": {"user": {"login": "oowekyala", "name": "Cl\u00e9ment Fournier"}}, "url": "https://github.com/pmd/pmd/commit/eca2ee54fe999ff54527499265a6ea389a365936", "committedDate": "2020-04-02T22:00:43Z", "message": "Merge branch 'java-grammar' into sym-disambig2"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e92093e1fbe9154a96246247fe9b598f4126ba32", "author": {"user": {"login": "oowekyala", "name": "Cl\u00e9ment Fournier"}}, "url": "https://github.com/pmd/pmd/commit/e92093e1fbe9154a96246247fe9b598f4126ba32", "committedDate": "2020-04-02T22:21:16Z", "message": "Merge branch 'java-grammar' into sym-disambig2"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a41283b7cd2d69872d9d41ffed188bb58e057245", "author": {"user": {"login": "oowekyala", "name": "Cl\u00e9ment Fournier"}}, "url": "https://github.com/pmd/pmd/commit/a41283b7cd2d69872d9d41ffed188bb58e057245", "committedDate": "2020-04-04T23:09:26Z", "message": "Fix compil"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "403b1ab7c0d3b7916052c393372937bfa7698a30", "author": {"user": {"login": "oowekyala", "name": "Cl\u00e9ment Fournier"}}, "url": "https://github.com/pmd/pmd/commit/403b1ab7c0d3b7916052c393372937bfa7698a30", "committedDate": "2020-04-04T23:12:30Z", "message": "Merge branch 'java-grammar' into sym-disambig2"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "643555bb1d91b99554f84923e41f008bd164621a", "author": {"user": {"login": "oowekyala", "name": "Cl\u00e9ment Fournier"}}, "url": "https://github.com/pmd/pmd/commit/643555bb1d91b99554f84923e41f008bd164621a", "committedDate": "2020-04-04T23:19:07Z", "message": "Checkout normal collectionUtil"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzg4NTA5NzQ1", "url": "https://github.com/pmd/pmd/pull/2389#pullrequestreview-388509745", "createdAt": "2020-04-06T18:27:25Z", "commit": {"oid": "643555bb1d91b99554f84923e41f008bd164621a"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wNlQxODoyNzoyNVrOGBkhOQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wNlQxODoyNzoyNVrOGBkhOQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNDMwMDA4OQ==", "bodyText": "That's in the public package lang.java.ast, but this is a implementation, isn't it? Should it be rather in a internal package?", "url": "https://github.com/pmd/pmd/pull/2389#discussion_r404300089", "createdAt": "2020-04-06T18:27:25Z", "author": {"login": "adangel"}, "path": "pmd-java/src/main/java/net/sourceforge/pmd/lang/java/ast/AstDisambiguationPass.java", "diffHunk": "@@ -0,0 +1,469 @@\n+/*\n+ * BSD-style license; for more info see http://pmd.sourceforge.net/license.html\n+ */\n+\n+\n+package net.sourceforge.pmd.lang.java.ast;\n+\n+import static net.sourceforge.pmd.lang.java.symbols.table.internal.SemanticChecksLogger.CANNOT_RESOLVE_AMBIGUOUS_NAME;\n+import static net.sourceforge.pmd.lang.java.symbols.table.internal.SemanticChecksLogger.CANNOT_RESOLVE_MEMBER;\n+\n+import java.util.Iterator;\n+\n+import org.checkerframework.checker.nullness.qual.Nullable;\n+\n+import net.sourceforge.pmd.lang.ast.NodeStream;\n+import net.sourceforge.pmd.lang.ast.impl.javacc.JavaccToken;\n+import net.sourceforge.pmd.lang.java.internal.JavaAstProcessor;\n+import net.sourceforge.pmd.lang.java.symbols.JClassSymbol;\n+import net.sourceforge.pmd.lang.java.symbols.JFieldSymbol;\n+import net.sourceforge.pmd.lang.java.symbols.JTypeDeclSymbol;\n+import net.sourceforge.pmd.lang.java.symbols.JVariableSymbol;\n+import net.sourceforge.pmd.lang.java.symbols.table.JSymbolTable;\n+import net.sourceforge.pmd.lang.java.symbols.table.ResolveResult;\n+import net.sourceforge.pmd.lang.java.symbols.table.internal.SemanticChecksLogger;\n+\n+/**\n+ * This implements name disambiguation following <a href=\"https://docs.oracle.com/javase/specs/jls/se8/html/jls-6.html#jls-6.5.2\">JLS\u00a76.5.2</a>.\n+ * (see also <a href=\"https://docs.oracle.com/javase/specs/jls/se13/html/jls-6.html#jls-6.4.2\">JLS\u00a76.4.2 - Obscuring</a>)\n+ *\n+ * <p>Currently disambiguation of package vs type name is fully implemented,\n+ * with the following limitations: TODO\n+ * - field accesses are not checked to be legal (and their symbol is not\n+ * resolved).\n+ * - inherited members are not considered. Same thing happens in the current\n+ * symbol table. Since that is so, visibility/accessibility is not handled either.\n+ * See bottom of file for some test cases.\n+ *\n+ * This is because we don't have full access to types yet. This is the next\n+ * step.\n+ */\n+public final class AstDisambiguationPass {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "643555bb1d91b99554f84923e41f008bd164621a"}, "originalPosition": 41}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "396567636fa1dbef2f7766f8c9ef57b4c095773e", "author": {"user": {"login": "oowekyala", "name": "Cl\u00e9ment Fournier"}}, "url": "https://github.com/pmd/pmd/commit/396567636fa1dbef2f7766f8c9ef57b4c095773e", "committedDate": "2020-04-07T13:30:30Z", "message": "Hide disambiguation fa\u00e7ade"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "eb4cdea126d9d8f3374c656c8cf44ec3f9bba38c", "author": {"user": {"login": "oowekyala", "name": "Cl\u00e9ment Fournier"}}, "url": "https://github.com/pmd/pmd/commit/eb4cdea126d9d8f3374c656c8cf44ec3f9bba38c", "committedDate": "2020-04-11T13:18:58Z", "message": "Merge branch 'java-grammar' into sym-disambig2"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzkyMDQxNjMw", "url": "https://github.com/pmd/pmd/pull/2389#pullrequestreview-392041630", "createdAt": "2020-04-13T09:14:02Z", "commit": {"oid": "eb4cdea126d9d8f3374c656c8cf44ec3f9bba38c"}, "state": "APPROVED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0xM1QwOToxNDowM1rOGEhQ0Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0xM1QwOToxNjoyMVrOGEhUjw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNzM5MjQ2NQ==", "bodyText": "Maybe these two methods (bench(...)) can stay private again?\nUpdate: turns out, no: It is called via SymbolTableHelper::earlyDisambig -> InternalApiBridge::disambig -> AstDisambiguationPass::disambig\nMaybe something to improve later...", "url": "https://github.com/pmd/pmd/pull/2389#discussion_r407392465", "createdAt": "2020-04-13T09:14:03Z", "author": {"login": "adangel"}, "path": "pmd-java/src/main/java/net/sourceforge/pmd/lang/java/internal/JavaAstProcessor.java", "diffHunk": "@@ -162,13 +165,13 @@ public static JavaAstProcessor create(ClassLoader classLoader,\n         );\n     }\n \n-    private static void bench(String label, Runnable runnable) {\n+    public static void bench(String label, Runnable runnable) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "eb4cdea126d9d8f3374c656c8cf44ec3f9bba38c"}, "originalPosition": 23}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNzM5MzQyMw==", "bodyText": "Mabye name this getToplevel()? nest root somehow sounds a bit strange (probably because nesting is the directing down and root is the direction up the tree...)", "url": "https://github.com/pmd/pmd/pull/2389#discussion_r407393423", "createdAt": "2020-04-13T09:16:21Z", "author": {"login": "adangel"}, "path": "pmd-java/src/main/java/net/sourceforge/pmd/lang/java/symbols/JClassSymbol.java", "diffHunk": "@@ -221,6 +181,20 @@ default boolean isClass() {\n     }\n \n \n+    /**\n+     * Returns the toplevel class containing this class. If this is a\n+     * toplevel class, returns this.\n+     */\n+    @NonNull\n+    default JClassSymbol getNestRoot() {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "eb4cdea126d9d8f3374c656c8cf44ec3f9bba38c"}, "originalPosition": 86}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4749, "cost": 1, "resetAt": "2021-11-01T16:37:27Z"}}}