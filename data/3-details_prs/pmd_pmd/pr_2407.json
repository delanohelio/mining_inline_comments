{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDAxMDU0MzUx", "number": 2407, "title": "[core] Deprecate Jaxen and XPath internal API ", "bodyText": "Part of #1687\n\nDeprecate XPathRuleQuery as internal API. On the 7.0 branch this will probably be removed as there is no need for several implementations without Jaxen\nMake an enum to represent XPath versions. This will be useful to manage migration for users I think, by issuing deprecation warnings. This replaces the string constants of XPathRuleQuery\nDeprecate the property descriptors for xpath version and xpath expression (note, that the properties are not deprecated!, so they don't produce a warning in the XML, it's just their programmatic usage that is deprecated). Implementing these as properties was an easy solution, but they should not be overridden by users, as they're part of the implementation of the rule. Since we'll be giving a special XML syntax to XPath rules in 7.0, we won't need to implement these with properties anymore anyway\nAlso deprecate MockRule and ImmutableLanguage, which are useless", "createdAt": "2020-04-08T20:08:34Z", "url": "https://github.com/pmd/pmd/pull/2407", "merged": true, "mergeCommit": {"oid": "60d443963c82d360d5a6169bba02bc0938ee1d7d"}, "closed": true, "closedAt": "2020-04-13T10:28:39Z", "author": {"login": "oowekyala"}, "timelineItems": {"totalCount": 9, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcVtKY3AH2gAyNDAxMDU0MzUxOmZjMzA0YmY3MGNjZTI0MzU5YjhmYzU4ZjFjYTc1N2NjZmYyZTM5Mjc=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcXMVwhAFqTM5MjA1MTQ4Mg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "fc304bf70cce24359b8fc58f1ca757ccff2e3927", "author": {"user": {"login": "oowekyala", "name": "Cl\u00e9ment Fournier"}}, "url": "https://github.com/pmd/pmd/commit/fc304bf70cce24359b8fc58f1ca757ccff2e3927", "committedDate": "2020-04-08T19:35:34Z", "message": "Add XPath version maker"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "bcf90ceb8ad1ef37af3c0a5c8d10ea4b26392bf5", "author": {"user": {"login": "oowekyala", "name": "Cl\u00e9ment Fournier"}}, "url": "https://github.com/pmd/pmd/commit/bcf90ceb8ad1ef37af3c0a5c8d10ea4b26392bf5", "committedDate": "2020-04-08T19:35:34Z", "message": "Externalize creator for XPath rule"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "8284fc8e816055a9231e32b57e1786124ffcbec3", "author": {"user": {"login": "oowekyala", "name": "Cl\u00e9ment Fournier"}}, "url": "https://github.com/pmd/pmd/commit/8284fc8e816055a9231e32b57e1786124ffcbec3", "committedDate": "2020-04-08T19:35:34Z", "message": "Deprecate two other things"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "961e78954aac16fc78dd9d16cd0754b0e98eff3d", "author": {"user": {"login": "oowekyala", "name": "Cl\u00e9ment Fournier"}}, "url": "https://github.com/pmd/pmd/commit/961e78954aac16fc78dd9d16cd0754b0e98eff3d", "committedDate": "2020-04-08T19:35:34Z", "message": "Update some tests"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "5067c79eb28c74691cacee0124468a740505919f", "author": {"user": {"login": "oowekyala", "name": "Cl\u00e9ment Fournier"}}, "url": "https://github.com/pmd/pmd/commit/5067c79eb28c74691cacee0124468a740505919f", "committedDate": "2020-04-08T19:38:10Z", "message": "Cleanup a test"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "1de1d1c66daf9e34947ad7f494a0f50c800d03c4", "author": {"user": {"login": "oowekyala", "name": "Cl\u00e9ment Fournier"}}, "url": "https://github.com/pmd/pmd/commit/1de1d1c66daf9e34947ad7f494a0f50c800d03c4", "committedDate": "2020-04-08T20:00:36Z", "message": "Update some usages early"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "60087590e65d4ec1859a7ea7f940f7d4fb94b29c", "author": {"user": {"login": "oowekyala", "name": "Cl\u00e9ment Fournier"}}, "url": "https://github.com/pmd/pmd/commit/60087590e65d4ec1859a7ea7f940f7d4fb94b29c", "committedDate": "2020-04-08T20:07:26Z", "message": "Remove changes to XPathHandler"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "60d443963c82d360d5a6169bba02bc0938ee1d7d", "author": {"user": {"login": "oowekyala", "name": "Cl\u00e9ment Fournier"}}, "url": "https://github.com/pmd/pmd/commit/60d443963c82d360d5a6169bba02bc0938ee1d7d", "committedDate": "2020-04-09T13:28:20Z", "message": "Call default ctor\n\nDefines properties"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzkyMDUxNDgy", "url": "https://github.com/pmd/pmd/pull/2407#pullrequestreview-392051482", "createdAt": "2020-04-13T09:37:22Z", "commit": {"oid": "60d443963c82d360d5a6169bba02bc0938ee1d7d"}, "state": "COMMENTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0xM1QwOTozNzoyMlrOGEhysA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0xM1QwOTo0MjozOFrOGEh50w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNzQwMTEzNg==", "bodyText": "Btw. this API must definitely change with PMD 7 - we are exposing here a implementation detail (that we use Saxon). And it happens, that the way, how custom functions are registered, changed with Saxon 9.5... which makes the need for a implementation agnostic API relevant...", "url": "https://github.com/pmd/pmd/pull/2407#discussion_r407401136", "createdAt": "2020-04-13T09:37:22Z", "author": {"login": "adangel"}, "path": "pmd-core/src/main/java/net/sourceforge/pmd/lang/ast/xpath/AbstractASTXPathHandler.java", "diffHunk": "@@ -25,4 +25,14 @@ public Navigator getNavigator() {\n     public void initialize(IndependentContext context, Language language, Class<?> functionsClass) {\n         context.declareNamespace(\"pmd-\" + language.getTerseName(), \"java:\" + functionsClass.getName());\n     }\n+\n+    @Override\n+    public void initialize() {\n+        // override if needed\n+    }\n+\n+    @Override\n+    public void initialize(IndependentContext context) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "60d443963c82d360d5a6169bba02bc0938ee1d7d"}, "originalPosition": 11}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNzQwMjk2Mw==", "bodyText": "Since this is an enum, we can use version == XPathVersion.XPATH_1_0 here\nUpdate: I've changed this while merging", "url": "https://github.com/pmd/pmd/pull/2407#discussion_r407402963", "createdAt": "2020-04-13T09:42:38Z", "author": {"login": "adangel"}, "path": "pmd-core/src/main/java/net/sourceforge/pmd/lang/rule/XPathRule.java", "diffHunk": "@@ -124,13 +171,21 @@ public void evaluate(final Node node, final RuleContext data) {\n      * engine in which the query will be run it looks at the XPath version.\n      */\n     private void initXPathRuleQuery() {\n-        String xpath = getProperty(XPATH_DESCRIPTOR);\n-        String version = getProperty(VERSION_DESCRIPTOR);\n+        String xpath = getXPathExpression();\n+        XPathVersion version = getVersion();\n \n-        initRuleQueryBasedOnVersion(version);\n+        if (version == null) {\n+            throw new IllegalStateException(\"Invalid XPath version, should have been caught by Rule::dysfunctionReason\");\n+        }\n+\n+        if (version.equals(XPathVersion.XPATH_1_0)) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "60d443963c82d360d5a6169bba02bc0938ee1d7d"}, "originalPosition": 147}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4761, "cost": 1, "resetAt": "2021-11-01T16:37:27Z"}}}