{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTA1MzcyNTA5", "number": 2837, "title": "[javascript] Remove JS parser options", "bodyText": "Describe the PR\nRemove JS parser options. Technically they could be converted to language versions, but I'm not sure how to map Rhino versions to ES standard versions, and I'm not sure we actually need it.\nThe default JS version, like now, is ES 6. But now it's unnamed, and not named \"3\", which was just weird.\nRelated issues\n\nRefs #2602\n\nReady?\n\n\n Update 7.0.0 release notes for the version name change\n\n\n Added unit tests for fixed bug/feature\n\n\n Passing all unit tests\n\n\n Complete build ./mvnw clean verify passes (checked automatically by travis)\n\n\n Added (in-code) documentation (if needed)", "createdAt": "2020-10-18T01:18:11Z", "url": "https://github.com/pmd/pmd/pull/2837", "merged": true, "mergeCommit": {"oid": "dd9390eb61afefc8236d920a819be14179ba38e8"}, "closed": true, "closedAt": "2020-11-06T09:13:44Z", "author": {"login": "oowekyala"}, "timelineItems": {"totalCount": 6, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdTlHWrgH2gAyNTA1MzcyNTA5OmExNmFlZDUwZWJkNzA5ODE4ZTNhMDQzMjRlM2RmNjJiODMzYjc0ODU=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdZy4JDgH2gAyNTA1MzcyNTA5OjdkZmRkNjUzZTc0MDg3OGJlODg2ZmQzOTk3ZGJiYWI4OTI1YzY2ODI=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "a16aed50ebd709818e3a04324e3df62b833b7485", "author": {"user": {"login": "oowekyala", "name": "Cl\u00e9ment Fournier"}}, "url": "https://github.com/pmd/pmd/commit/a16aed50ebd709818e3a04324e3df62b833b7485", "committedDate": "2020-10-18T01:16:19Z", "message": "Remove JS parser options"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c27b4216458547f04db2f108f595b2ec40e105c5", "author": {"user": {"login": "oowekyala", "name": "Cl\u00e9ment Fournier"}}, "url": "https://github.com/pmd/pmd/commit/c27b4216458547f04db2f108f595b2ec40e105c5", "committedDate": "2020-10-18T01:22:07Z", "message": "Fix PMD warnings"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c8da0b4b36ec3a95cf395c289674fe263ee296d6", "author": {"user": {"login": "oowekyala", "name": "Cl\u00e9ment Fournier"}}, "url": "https://github.com/pmd/pmd/commit/c8da0b4b36ec3a95cf395c289674fe263ee296d6", "committedDate": "2020-10-19T20:32:15Z", "message": "Fix tests expecting ES3\n\nDefault version is now ES 6 and unnamed"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "01018abed4f3fa59f1bc3f3033e29e2ba03f0040", "author": {"user": {"login": "oowekyala", "name": "Cl\u00e9ment Fournier"}}, "url": "https://github.com/pmd/pmd/commit/01018abed4f3fa59f1bc3f3033e29e2ba03f0040", "committedDate": "2020-10-18T02:12:34Z", "message": "Use default Rhino version instead\n\nJust like now"}, "afterCommit": {"oid": "c8da0b4b36ec3a95cf395c289674fe263ee296d6", "author": {"user": {"login": "oowekyala", "name": "Cl\u00e9ment Fournier"}}, "url": "https://github.com/pmd/pmd/commit/c8da0b4b36ec3a95cf395c289674fe263ee296d6", "committedDate": "2020-10-19T20:32:15Z", "message": "Fix tests expecting ES3\n\nDefault version is now ES 6 and unnamed"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTI0OTIyNDMx", "url": "https://github.com/pmd/pmd/pull/2837#pullrequestreview-524922431", "createdAt": "2020-11-06T07:54:38Z", "commit": {"oid": "c8da0b4b36ec3a95cf395c289674fe263ee296d6"}, "state": "APPROVED", "comments": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wNlQwNzo1NDozOFrOHujcKA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wNlQwODoyMTo0MVrOHukM1A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxODU3NzE5Mg==", "bodyText": "I'll internalize this class (and others) on master before merging this PR to pmd/7.0.x.\nE.g. in pmd-java, we already deprecated JavaLanguageHandler and JavaLanguageParser telling the users to use LanguageVersionHandler#getParser(ParserOptions) instead....\nalthough in future, ParserOptions will be gone... but that's another step", "url": "https://github.com/pmd/pmd/pull/2837#discussion_r518577192", "createdAt": "2020-11-06T07:54:38Z", "author": {"login": "adangel"}, "path": "pmd-javascript/src/main/java/net/sourceforge/pmd/lang/ecmascript/Ecmascript3Parser.java", "diffHunk": "@@ -1,31 +0,0 @@\n-/*\n- * BSD-style license; for more info see http://pmd.sourceforge.net/license.html\n- */\n-\n-package net.sourceforge.pmd.lang.ecmascript;\n-\n-import java.io.Reader;\n-\n-import net.sourceforge.pmd.lang.AbstractParser;\n-import net.sourceforge.pmd.lang.ParserOptions;\n-import net.sourceforge.pmd.lang.ast.ParseException;\n-import net.sourceforge.pmd.lang.ecmascript.ast.ASTAstRoot;\n-\n-/**\n- * Adapter for the EcmascriptParser.\n- */\n-public class Ecmascript3Parser extends AbstractParser {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c8da0b4b36ec3a95cf395c289674fe263ee296d6"}, "originalPosition": 17}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxODU3NzczNg==", "bodyText": "We can also remove this useless class comment.\nI guess, when PMD first supported Javascript, it was ECMAScript Version 3....", "url": "https://github.com/pmd/pmd/pull/2837#discussion_r518577736", "createdAt": "2020-11-06T07:55:49Z", "author": {"login": "adangel"}, "path": "pmd-javascript/src/main/java/net/sourceforge/pmd/lang/ecmascript/EcmascriptHandler.java", "diffHunk": "@@ -7,20 +7,22 @@\n import net.sourceforge.pmd.lang.AbstractPmdLanguageVersionHandler;\n import net.sourceforge.pmd.lang.Parser;\n import net.sourceforge.pmd.lang.ParserOptions;\n+import net.sourceforge.pmd.lang.ecmascript.ast.EcmascriptParser;\n \n /**\n  * Implementation of LanguageVersionHandler for the ECMAScript Version 3.", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c8da0b4b36ec3a95cf395c289674fe263ee296d6"}, "originalPosition": 7}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxODU4NDA0NQ==", "bodyText": "Why not Objects.requireNonNull? Ok, it has a little bit additional support for building the NPE message.....", "url": "https://github.com/pmd/pmd/pull/2837#discussion_r518584045", "createdAt": "2020-11-06T08:09:33Z", "author": {"login": "adangel"}, "path": "pmd-javascript/src/main/java/net/sourceforge/pmd/lang/ecmascript/ast/EcmascriptParser.java", "diffHunk": "@@ -19,28 +19,31 @@\n import org.mozilla.javascript.ast.ErrorCollector;\n import org.mozilla.javascript.ast.ParseProblem;\n \n+import net.sourceforge.pmd.internal.util.AssertionUtil;\n+import net.sourceforge.pmd.lang.ParserOptions;\n import net.sourceforge.pmd.lang.ast.ParseException;\n-import net.sourceforge.pmd.lang.ecmascript.EcmascriptParserOptions;\n \n-public class EcmascriptParser {\n-    protected final EcmascriptParserOptions parserOptions;\n+public final class EcmascriptParser implements net.sourceforge.pmd.lang.Parser {\n+    private final int esVersion;\n+    private final String suppressMarker;\n \n-    private Map<Integer, String> suppressMap;\n-    private String suppressMarker = \"NOPMD\"; // that's the default value\n+    public EcmascriptParser(int version, String suppressMarker) {\n+        this.esVersion = version;\n+        this.suppressMarker = AssertionUtil.requireParamNotNull(\"suppression marker\", suppressMarker);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c8da0b4b36ec3a95cf395c289674fe263ee296d6"}, "originalPosition": 19}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxODU4OTY1Mg==", "bodyText": "I'll change the version to \"ES6\" instead of a empty string.", "url": "https://github.com/pmd/pmd/pull/2837#discussion_r518589652", "createdAt": "2020-11-06T08:21:41Z", "author": {"login": "adangel"}, "path": "pmd-javascript/src/main/java/net/sourceforge/pmd/lang/ecmascript/EcmascriptLanguageModule.java", "diffHunk": "@@ -14,14 +15,9 @@\n \n     public static final String NAME = \"Ecmascript\";\n     public static final String TERSE_NAME = \"ecmascript\";\n-    private static final Ecmascript3Handler DEFAULT = new Ecmascript3Handler();\n \n     public EcmascriptLanguageModule() {\n         super(NAME, null, TERSE_NAME, \"js\");\n-        addVersion(\"3\", DEFAULT, true);\n-    }\n-\n-    public static LanguageVersionHandler defaultHandler() {\n-        return DEFAULT;\n+        addDefaultVersion(\"\", new EcmascriptHandler(Context.VERSION_ES6));", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c8da0b4b36ec3a95cf395c289674fe263ee296d6"}, "originalPosition": 24}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "7dfdd653e740878be886fd3997dbbab8925c6682", "author": {"user": {"login": "adangel", "name": "Andreas Dangel"}}, "url": "https://github.com/pmd/pmd/commit/7dfdd653e740878be886fd3997dbbab8925c6682", "committedDate": "2020-11-06T08:41:55Z", "message": "[javascript] Update default version name to \"ES6\""}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4547, "cost": 1, "resetAt": "2021-11-01T16:37:27Z"}}}