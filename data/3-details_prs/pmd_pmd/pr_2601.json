{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDM2NTM0OTA2", "number": 2601, "title": "[java] Rewrite symbol table", "bodyText": "Describe the PR\nRewrites the newer symbol table for maintainability and performance.\nThis extracts the following abstractions from the current symbol table implementation:\n\nNameResolver: this is a strategy that can map a name to a symbol, eg get it from a map, or ask a classloader. These were implemented ad-hoc in each symbol table implementation, now they're factorized into reusable units\nShadowChain: this is the API that symbol tables offered (resolve a name), but broken down, one chain for each kind of name. This is a linked list of NameResolvers, each node shadows the next one. Symbol tables previously were a single linked list for all kind of names, so this was a possible performance bottleneck\n\nThis also unifies the API to resolve method, type and variable names (previously resolveMethod returned a List, the others returned a ResolveResult). Now all may return a List. This handles name ambiguity and duplicate declarations for variables and type names, so it is more general than the previous mechanism. It also reuses more code.\nIn this new framework, JSymbolTable is retained as just a simple tuple of ShadowChains, for ease of use (but it's not a central concept anymore).\nThis also adds a \"MostlySingularMultimap\" type, a kind of multimap that is optimised for the case where there are actually only at most one value per key. So the implementation is optimised for the most common case.\n\nPossibly, the ShadowChain API could be lifted up to pmd-core. I'm waiting for a use case before doing this, but I implemented it as if it was in another module, so it has no dependencies on pmd-java\n\nThat was the \"rewrite\" part. The PR also adds support for inherited member resolution and a lot of tests to cover corner cases (hiding of inherited declarations).\nThis is the last piece needed before we proceed to the type resolution revamp.\nReady?\n\n\n Added unit tests for fixed bug/feature\n Passing all unit tests\n Complete build ./mvnw clean verify passes (checked automatically by travis)\n Added (in-code) documentation (if needed)", "createdAt": "2020-06-18T15:01:00Z", "url": "https://github.com/pmd/pmd/pull/2601", "merged": true, "mergeCommit": {"oid": "6c3f8c4bfbb018a123a41f462598039611128296"}, "closed": true, "closedAt": "2020-07-19T16:56:04Z", "author": {"login": "oowekyala"}, "timelineItems": {"totalCount": 43, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcsfrubAH2gAyNDM2NTM0OTA2OjBiN2IzOTdjOGFkYjVmZjQ5ZmI5MDVlOTQwZTRjMDBmODAyNzAxZTY=", "endCursor": "Y3Vyc29yOnYyOpPPAAABc2f983gFqTQ1MTE0NTMwNw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "0b7b397c8adb5ff49fb905e940e4c00f802701e6", "author": {"user": {"login": "oowekyala", "name": "Cl\u00e9ment Fournier"}}, "url": "https://github.com/pmd/pmd/commit/0b7b397c8adb5ff49fb905e940e4c00f802701e6", "committedDate": "2020-06-18T14:53:34Z", "message": "Make PMultimap type"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "480ee17847bef09f7e93a84ed3b8cb18f489267c", "author": {"user": {"login": "oowekyala", "name": "Cl\u00e9ment Fournier"}}, "url": "https://github.com/pmd/pmd/commit/480ee17847bef09f7e93a84ed3b8cb18f489267c", "committedDate": "2020-06-18T14:53:34Z", "message": "Make shadowGroup"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "4de86bd9a4db15fec00ea7301fd7f8293864368c", "author": {"user": {"login": "oowekyala", "name": "Cl\u00e9ment Fournier"}}, "url": "https://github.com/pmd/pmd/commit/4de86bd9a4db15fec00ea7301fd7f8293864368c", "committedDate": "2020-06-18T14:53:34Z", "message": "Make a few utilities to replace import tables"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "3d2899005f85c431714dcf03ec9caa678405b011", "author": {"user": {"login": "oowekyala", "name": "Cl\u00e9ment Fournier"}}, "url": "https://github.com/pmd/pmd/commit/3d2899005f85c431714dcf03ec9caa678405b011", "committedDate": "2020-06-18T14:53:34Z", "message": "Replace other tables"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "eaecefe404627dd800b10d852f93985307d3768b", "author": {"user": {"login": "oowekyala", "name": "Cl\u00e9ment Fournier"}}, "url": "https://github.com/pmd/pmd/commit/eaecefe404627dd800b10d852f93985307d3768b", "committedDate": "2020-06-18T14:53:34Z", "message": "Cleanup"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "1db3537fa34bdf8c4c459c8e074295e09ea404c3", "author": {"user": {"login": "oowekyala", "name": "Cl\u00e9ment Fournier"}}, "url": "https://github.com/pmd/pmd/commit/1db3537fa34bdf8c4c459c8e074295e09ea404c3", "committedDate": "2020-06-18T14:53:34Z", "message": "Compat with old impl"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "691fced420bfef100765995c3060b1b960f45694", "author": {"user": {"login": "oowekyala", "name": "Cl\u00e9ment Fournier"}}, "url": "https://github.com/pmd/pmd/commit/691fced420bfef100765995c3060b1b960f45694", "committedDate": "2020-06-18T14:53:34Z", "message": "Fix rebase"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c32dba700463f19b54c3e24e7e87e3b81a7a1983", "author": {"user": {"login": "oowekyala", "name": "Cl\u00e9ment Fournier"}}, "url": "https://github.com/pmd/pmd/commit/c32dba700463f19b54c3e24e7e87e3b81a7a1983", "committedDate": "2020-06-18T14:53:34Z", "message": "Checkout newer sym table from typeres branch"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "672718c752a66cd85760a997a4f6e3d2f79f6dbb", "author": {"user": {"login": "oowekyala", "name": "Cl\u00e9ment Fournier"}}, "url": "https://github.com/pmd/pmd/commit/672718c752a66cd85760a997a4f6e3d2f79f6dbb", "committedDate": "2020-06-18T14:53:34Z", "message": "Port"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "fcb2bf6ae58df7b561a72ecfe2429aab32767271", "author": {"user": {"login": "oowekyala", "name": "Cl\u00e9ment Fournier"}}, "url": "https://github.com/pmd/pmd/commit/fcb2bf6ae58df7b561a72ecfe2429aab32767271", "committedDate": "2020-06-18T14:53:34Z", "message": "Checkout tests"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "0cd4469746328bb094eebcb8819eb50fe5d9ec5c", "author": {"user": {"login": "oowekyala", "name": "Cl\u00e9ment Fournier"}}, "url": "https://github.com/pmd/pmd/commit/0cd4469746328bb094eebcb8819eb50fe5d9ec5c", "committedDate": "2020-06-18T14:53:34Z", "message": "Port tests, remove old impl"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "41b0713a72d674de68da8e3766508c237397171e", "author": {"user": {"login": "oowekyala", "name": "Cl\u00e9ment Fournier"}}, "url": "https://github.com/pmd/pmd/commit/41b0713a72d674de68da8e3766508c237397171e", "committedDate": "2020-06-18T14:53:34Z", "message": "Extract augment function"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "536eab300c3ef6ac09fc56bf3ac480c4e2cd7cc7", "author": {"user": {"login": "oowekyala", "name": "Cl\u00e9ment Fournier"}}, "url": "https://github.com/pmd/pmd/commit/536eab300c3ef6ac09fc56bf3ac480c4e2cd7cc7", "committedDate": "2020-06-18T14:53:34Z", "message": "Move classes back into internal package"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "57ab1e4933325088f99759f1a139b976e121ea26", "author": {"user": {"login": "oowekyala", "name": "Cl\u00e9ment Fournier"}}, "url": "https://github.com/pmd/pmd/commit/57ab1e4933325088f99759f1a139b976e121ea26", "committedDate": "2020-06-18T14:53:34Z", "message": "Abstract stuff away for pmd-core"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c4ffa795f4d52c1e0d782ace19cc3e22dfed3eea", "author": {"user": {"login": "oowekyala", "name": "Cl\u00e9ment Fournier"}}, "url": "https://github.com/pmd/pmd/commit/c4ffa795f4d52c1e0d782ace19cc3e22dfed3eea", "committedDate": "2020-06-18T14:53:34Z", "message": "Optimise singular map case even more"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "849d6dd91f6ecc7c0a280dc5309985584e2eba71", "author": {"user": {"login": "oowekyala", "name": "Cl\u00e9ment Fournier"}}, "url": "https://github.com/pmd/pmd/commit/849d6dd91f6ecc7c0a280dc5309985584e2eba71", "committedDate": "2020-06-18T14:53:34Z", "message": "Fix nextShadowGroup WIP"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "5606d387a7d55479b19763a896d8da16baabd45f", "author": {"user": {"login": "oowekyala", "name": "Cl\u00e9ment Fournier"}}, "url": "https://github.com/pmd/pmd/commit/5606d387a7d55479b19763a896d8da16baabd45f", "committedDate": "2020-06-18T14:53:34Z", "message": "Make ShadowIterator to replace getNextGroup"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "7bf9554570610c4f602c9b50771c1e8bdf9791d7", "author": {"user": {"login": "oowekyala", "name": "Cl\u00e9ment Fournier"}}, "url": "https://github.com/pmd/pmd/commit/7bf9554570610c4f602c9b50771c1e8bdf9791d7", "committedDate": "2020-06-18T14:53:34Z", "message": "Use chain iterator"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "bac76fc16ce2648ab94c5ea5e257043a82530d32", "author": {"user": {"login": "oowekyala", "name": "Cl\u00e9ment Fournier"}}, "url": "https://github.com/pmd/pmd/commit/bac76fc16ce2648ab94c5ea5e257043a82530d32", "committedDate": "2020-06-18T14:53:34Z", "message": "Add tests"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "46da94c9150460440498d3fea89e854986292457", "author": {"user": {"login": "oowekyala", "name": "Cl\u00e9ment Fournier"}}, "url": "https://github.com/pmd/pmd/commit/46da94c9150460440498d3fea89e854986292457", "committedDate": "2020-06-18T14:53:34Z", "message": "Specify tests for ambiguity\n\nTODO implement"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "eb976a1de2a12515c35c08b03053e81eec1dafbe", "author": {"user": {"login": "oowekyala", "name": "Cl\u00e9ment Fournier"}}, "url": "https://github.com/pmd/pmd/commit/eb976a1de2a12515c35c08b03053e81eec1dafbe", "committedDate": "2020-06-18T14:53:34Z", "message": "Finish impl"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "563037275002b7c6d2639c6df0b45544fcda34fb", "author": {"user": {"login": "oowekyala", "name": "Cl\u00e9ment Fournier"}}, "url": "https://github.com/pmd/pmd/commit/563037275002b7c6d2639c6df0b45544fcda34fb", "committedDate": "2020-06-18T14:53:34Z", "message": "Add tests for supertype enumerator"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "841fd6b1ba04659d504735003611977c93d797f8", "author": {"user": {"login": "oowekyala", "name": "Cl\u00e9ment Fournier"}}, "url": "https://github.com/pmd/pmd/commit/841fd6b1ba04659d504735003611977c93d797f8", "committedDate": "2020-06-18T14:53:34Z", "message": "Add tests for method shadowing in imports"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "5134a33d21baaff1e9771f1c35b3893705f3f2cc", "author": {"user": {"login": "oowekyala", "name": "Cl\u00e9ment Fournier"}}, "url": "https://github.com/pmd/pmd/commit/5134a33d21baaff1e9771f1c35b3893705f3f2cc", "committedDate": "2020-06-18T14:53:34Z", "message": "Object methods should be in scope in interfaces"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "1b48125eb3941db5e4ae232775c760c5bf74a7c6", "author": {"user": {"login": "oowekyala", "name": "Cl\u00e9ment Fournier"}}, "url": "https://github.com/pmd/pmd/commit/1b48125eb3941db5e4ae232775c760c5bf74a7c6", "committedDate": "2020-06-18T14:53:34Z", "message": "Doc"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ab9ec47aafe1da50302be8f89019e278ae21f3d7", "author": {"user": {"login": "oowekyala", "name": "Cl\u00e9ment Fournier"}}, "url": "https://github.com/pmd/pmd/commit/ab9ec47aafe1da50302be8f89019e278ae21f3d7", "committedDate": "2020-06-18T14:53:34Z", "message": "Change the name"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a5856e75a4f9c8185e51ba9c3d998c7b3f9c5e44", "author": {"user": {"login": "oowekyala", "name": "Cl\u00e9ment Fournier"}}, "url": "https://github.com/pmd/pmd/commit/a5856e75a4f9c8185e51ba9c3d998c7b3f9c5e44", "committedDate": "2020-06-18T14:53:34Z", "message": "Doc"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "134c760e28ebe32571826f80faae448f4d999ce4", "author": {"user": {"login": "oowekyala", "name": "Cl\u00e9ment Fournier"}}, "url": "https://github.com/pmd/pmd/commit/134c760e28ebe32571826f80faae448f4d999ce4", "committedDate": "2020-06-18T14:53:34Z", "message": "Split API"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e43eeeaa2ef43895780e7672dd70af16a49b1f40", "author": {"user": {"login": "oowekyala", "name": "Cl\u00e9ment Fournier"}}, "url": "https://github.com/pmd/pmd/commit/e43eeeaa2ef43895780e7672dd70af16a49b1f40", "committedDate": "2020-06-18T14:53:34Z", "message": "Remove recursion guard"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "54c0b994a500f3cb3a34e45f8b2b96d56ede43e7", "author": {"user": {"login": "oowekyala", "name": "Cl\u00e9ment Fournier"}}, "url": "https://github.com/pmd/pmd/commit/54c0b994a500f3cb3a34e45f8b2b96d56ede43e7", "committedDate": "2020-06-18T14:53:34Z", "message": "Move ConsList into pmd-core"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "4d75f64a8eef9aa1e4018dc2abaf129661bce483", "author": {"user": {"login": "oowekyala", "name": "Cl\u00e9ment Fournier"}}, "url": "https://github.com/pmd/pmd/commit/4d75f64a8eef9aa1e4018dc2abaf129661bce483", "committedDate": "2020-06-18T14:53:34Z", "message": "Prune more empty nodes"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "43a60c0f8913057154ae757d57995b8a26e17466", "author": {"user": {"login": "oowekyala", "name": "Cl\u00e9ment Fournier"}}, "url": "https://github.com/pmd/pmd/commit/43a60c0f8913057154ae757d57995b8a26e17466", "committedDate": "2020-06-18T14:53:34Z", "message": "Fix bug with shadow iterator"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a520d1df3fc702ff43798aec3fc18250f63bfb06", "author": {"user": {"login": "oowekyala", "name": "Cl\u00e9ment Fournier"}}, "url": "https://github.com/pmd/pmd/commit/a520d1df3fc702ff43798aec3fc18250f63bfb06", "committedDate": "2020-06-18T14:53:34Z", "message": "Move ScopeInfo into published package"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "36c9e97cde89b457a0732e015b9058243a6b4e3e", "author": {"user": {"login": "oowekyala", "name": "Cl\u00e9ment Fournier"}}, "url": "https://github.com/pmd/pmd/commit/36c9e97cde89b457a0732e015b9058243a6b4e3e", "committedDate": "2020-06-18T14:53:35Z", "message": "Fix socping"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "2deef0bc287ae828cacc9ddd3a4898fe3649b4a9", "author": {"user": {"login": "oowekyala", "name": "Cl\u00e9ment Fournier"}}, "url": "https://github.com/pmd/pmd/commit/2deef0bc287ae828cacc9ddd3a4898fe3649b4a9", "committedDate": "2020-06-18T14:53:35Z", "message": "Make disambiguation handle inherited types"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a7db7824cd920ccb60cd41022503606aa9008cd2", "author": {"user": {"login": "oowekyala", "name": "Cl\u00e9ment Fournier"}}, "url": "https://github.com/pmd/pmd/commit/a7db7824cd920ccb60cd41022503606aa9008cd2", "committedDate": "2020-06-18T14:53:35Z", "message": "Fix context accessibility"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a7051c4e37a1bc0540121b3f5f5f3aabf6c0f844", "author": {"user": {"login": "oowekyala", "name": "Cl\u00e9ment Fournier"}}, "url": "https://github.com/pmd/pmd/commit/a7051c4e37a1bc0540121b3f5f5f3aabf6c0f844", "committedDate": "2020-06-18T14:53:35Z", "message": "Report ambiguity errors"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "268a3e45295089b10992fdeb57371870362136a4", "author": {"user": {"login": "oowekyala", "name": "Cl\u00e9ment Fournier"}}, "url": "https://github.com/pmd/pmd/commit/268a3e45295089b10992fdeb57371870362136a4", "committedDate": "2020-06-18T14:53:35Z", "message": "PMD violation"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "8f0b62f46d6fb5119026ce465772ac76e5bdb017", "author": {"user": {"login": "oowekyala", "name": "Cl\u00e9ment Fournier"}}, "url": "https://github.com/pmd/pmd/commit/8f0b62f46d6fb5119026ce465772ac76e5bdb017", "committedDate": "2020-06-18T14:53:35Z", "message": "Cleanup pcollections dependency"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "9054303b4b7ae1a6a5cf0a1321b200abcbab49d5", "author": {"user": {"login": "oowekyala", "name": "Cl\u00e9ment Fournier"}}, "url": "https://github.com/pmd/pmd/commit/9054303b4b7ae1a6a5cf0a1321b200abcbab49d5", "committedDate": "2020-06-18T14:53:35Z", "message": "doc"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ad6c976898880506bad73e3f9464f26436adf2ff", "author": {"user": {"login": "oowekyala", "name": "Cl\u00e9ment Fournier"}}, "url": "https://github.com/pmd/pmd/commit/ad6c976898880506bad73e3f9464f26436adf2ff", "committedDate": "2020-07-06T11:41:45Z", "message": "Merge branch 'java-grammar' into sym-optimize-symtables"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c4c9ef37a196999ccfc80686a86a268e3c2057dd", "author": {"user": {"login": "oowekyala", "name": "Cl\u00e9ment Fournier"}}, "url": "https://github.com/pmd/pmd/commit/c4c9ef37a196999ccfc80686a86a268e3c2057dd", "committedDate": "2020-07-06T11:47:25Z", "message": "Remove duplicate pcollection dep"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDUxMTQ1MzA3", "url": "https://github.com/pmd/pmd/pull/2601#pullrequestreview-451145307", "createdAt": "2020-07-19T16:24:50Z", "commit": {"oid": "c4c9ef37a196999ccfc80686a86a268e3c2057dd"}, "state": "COMMENTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xOVQxNjoyNDo1MVrOGzwp9g==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xOVQxNjozMDo1NVrOGzwsZg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NjkyNzczNA==", "bodyText": "Should this be public? It sounds like an implementation helper....\nHm... seems to be used in the shadow chain API. Any reason, why you didn't use Optional<Boolean> instead?", "url": "https://github.com/pmd/pmd/pull/2601#discussion_r456927734", "createdAt": "2020-07-19T16:24:51Z", "author": {"login": "adangel"}, "path": "pmd-core/src/main/java/net/sourceforge/pmd/util/OptionalBool.java", "diffHunk": "@@ -0,0 +1,22 @@\n+/*\n+ * BSD-style license; for more info see http://pmd.sourceforge.net/license.html\n+ */\n+\n+package net.sourceforge.pmd.util;\n+\n+/** Represents a boolean that may not be present. Use as a non-null type. */\n+public enum OptionalBool {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c4c9ef37a196999ccfc80686a86a268e3c2057dd"}, "originalPosition": 8}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NjkyODM1OA==", "bodyText": "the package name \"coreimpl\" sounds a bit unusual. That's the part, you made independent of pmd-java and could potentially be moved to core, right?\nMaybe we should rename the sub-package with something like \"shadow\" or \"nameshadow\" or so... or maybe something with \"hierarchy\" in it?", "url": "https://github.com/pmd/pmd/pull/2601#discussion_r456928358", "createdAt": "2020-07-19T16:30:55Z", "author": {"login": "adangel"}, "path": "pmd-java/src/main/java/net/sourceforge/pmd/lang/java/symbols/table/coreimpl/CachingShadowChainNode.java", "diffHunk": "@@ -0,0 +1,83 @@\n+/*\n+ * BSD-style license; for more info see http://pmd.sourceforge.net/license.html\n+ */\n+\n+package net.sourceforge.pmd.lang.java.symbols.table.coreimpl;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c4c9ef37a196999ccfc80686a86a268e3c2057dd"}, "originalPosition": 5}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4826, "cost": 1, "resetAt": "2021-11-01T16:37:27Z"}}}