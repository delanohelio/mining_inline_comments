{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDE5NTMyNjk1", "number": 2491, "title": "[apex] Make apex have a single RootNode ", "bodyText": "Describe the PR\n\n\nIntroduce ASTApexFile as the RootNode for apex trees. The problem is that the contract of RootNode mandates a single RootNode instance per tree, but with nested classes/interfaces, this is not respected by Apex if eg ASTUserClass/Interface implement RootNode\n\nThis fixes a bug in #2490\n\n\nI also simplified the apex CompilerService, most of which is useless copy-paste\n\nAnother unrelated change, is that CanSuppressWarning is now removed in Apex. This aligns apex annotation suppression with the java module (on java-grammar), see #1927\nRelated issues\n\nFixes #1937\n\nReady?\n\n\n Added unit tests for fixed bug/feature\n Passing all unit tests\n Complete build ./mvnw clean verify passes (checked automatically by travis)\n Added (in-code) documentation (if needed)", "createdAt": "2020-05-18T14:17:30Z", "url": "https://github.com/pmd/pmd/pull/2491", "merged": true, "mergeCommit": {"oid": "08613786c3caf4ec2ba77ad6153d1078e862b8f1"}, "closed": true, "closedAt": "2020-06-14T19:41:15Z", "author": {"login": "oowekyala"}, "timelineItems": {"totalCount": 9, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcigdP6gH2gAyNDE5NTMyNjk1OmRmYjFjMmYwODBjMzUzYzFmMmExZjhjODU5NjJhYmQwNTJmMTNiZGE=", "endCursor": "Y3Vyc29yOnYyOpPPAAABctLjgqgFqTQzNDQzODk0OA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "dfb1c2f080c353c1f2a1f8c85962abd052f13bda", "author": {"user": {"login": "oowekyala", "name": "Cl\u00e9ment Fournier"}}, "url": "https://github.com/pmd/pmd/commit/dfb1c2f080c353c1f2a1f8c85962abd052f13bda", "committedDate": "2020-05-18T14:08:25Z", "message": "Simplify apex parser"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e248bac57b55759bf60c85c739ac05d87d54e04a", "author": {"user": {"login": "oowekyala", "name": "Cl\u00e9ment Fournier"}}, "url": "https://github.com/pmd/pmd/commit/e248bac57b55759bf60c85c739ac05d87d54e04a", "committedDate": "2020-05-18T14:08:25Z", "message": "Make apex have a single root node"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "39ff1145c4339181685280b317e6fd0aa6c90636", "author": {"user": {"login": "oowekyala", "name": "Cl\u00e9ment Fournier"}}, "url": "https://github.com/pmd/pmd/commit/39ff1145c4339181685280b317e6fd0aa6c90636", "committedDate": "2020-05-18T14:08:25Z", "message": "Remove apex CanSuppressWarnings"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "00a2497c9def04befe98ea22e6f8530c7e212d96", "author": {"user": {"login": "oowekyala", "name": "Cl\u00e9ment Fournier"}}, "url": "https://github.com/pmd/pmd/commit/00a2497c9def04befe98ea22e6f8530c7e212d96", "committedDate": "2020-05-18T14:08:25Z", "message": "Make apex version available"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e198b6afb5e723d67d356fcdbeeb14a969b6d897", "author": {"user": {"login": "oowekyala", "name": "Cl\u00e9ment Fournier"}}, "url": "https://github.com/pmd/pmd/commit/e198b6afb5e723d67d356fcdbeeb14a969b6d897", "committedDate": "2020-05-18T14:08:25Z", "message": "Fix tests"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "584ccc806b64a54595790533f722db770f6c8423", "author": {"user": {"login": "oowekyala", "name": "Cl\u00e9ment Fournier"}}, "url": "https://github.com/pmd/pmd/commit/584ccc806b64a54595790533f722db770f6c8423", "committedDate": "2020-05-18T14:21:04Z", "message": "Remove useless `implements Node`"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "53529f0f39f958d00f4c254b0b00dd4e974ef7e5", "author": {"user": {"login": "oowekyala", "name": "Cl\u00e9ment Fournier"}}, "url": "https://github.com/pmd/pmd/commit/53529f0f39f958d00f4c254b0b00dd4e974ef7e5", "committedDate": "2020-05-21T08:50:59Z", "message": "Merge branch '7.0.x' into apex-single-rootnode-2"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "d3d75fa0b91e30c59c6a947743a948ee09f5b051", "author": {"user": {"login": "oowekyala", "name": "Cl\u00e9ment Fournier"}}, "url": "https://github.com/pmd/pmd/commit/d3d75fa0b91e30c59c6a947743a948ee09f5b051", "committedDate": "2020-06-14T17:04:45Z", "message": "Merge branch '7.0.x' into apex-single-rootnode-2"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDM0NDM4OTQ4", "url": "https://github.com/pmd/pmd/pull/2491#pullrequestreview-434438948", "createdAt": "2020-06-20T16:26:23Z", "commit": {"oid": "d3d75fa0b91e30c59c6a947743a948ee09f5b051"}, "state": "COMMENTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yMFQxNjoyNjoyM1rOGmnSUg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yMFQxNjo1MToyN1rOGmnYmg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MzE0MjczOA==", "bodyText": "This change effectively moves ApexParser from package lang.apex into lang.apex.ast.\nI guess, we should internalize this one on master, as we did with the JavaLanguageParser.\nDone in 23c08b5", "url": "https://github.com/pmd/pmd/pull/2491#discussion_r443142738", "createdAt": "2020-06-20T16:26:23Z", "author": {"login": "adangel"}, "path": "pmd-apex/src/main/java/net/sourceforge/pmd/lang/apex/ApexParser.java", "diffHunk": "@@ -1,30 +0,0 @@\n-/**\n- * BSD-style license; for more info see http://pmd.sourceforge.net/license.html\n- */\n-\n-package net.sourceforge.pmd.lang.apex;\n-\n-import java.io.Reader;\n-\n-import net.sourceforge.pmd.lang.AbstractParser;\n-import net.sourceforge.pmd.lang.ParserOptions;\n-import net.sourceforge.pmd.lang.ast.ParseException;\n-import net.sourceforge.pmd.lang.ast.RootNode;\n-\n-/**\n- * Adapter for the Apex jorje parser\n- */\n-public class ApexParser extends AbstractParser {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d3d75fa0b91e30c59c6a947743a948ee09f5b051"}, "originalPosition": 17}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MzE0NDM0Ng==", "bodyText": "On master, in seems we have a bug: we don't visit top-level ASTUserEnum and ASTAnonymousClass...\nEnums in Apex can't have additional user defined methods, so they only define the constants. This means, only rules like Naming conventions would suffer from this bug.\nJust tested it: this rule uses rulechain, so we directly visit UserEnum - that works. The tests look like, they were written before introducing rule chain, since they don't have a top-level enum...\nASTAnonymousClass - hm... a anonymous class can't be top-level. So, this should be no issue at all... In fact, I have no clue, how to write an anonymous class in Apex....\nThis is addressed in #2610", "url": "https://github.com/pmd/pmd/pull/2491#discussion_r443144346", "createdAt": "2020-06-20T16:51:27Z", "author": {"login": "adangel"}, "path": "pmd-apex/src/main/java/net/sourceforge/pmd/lang/apex/rule/AbstractApexRule.java", "diffHunk": "@@ -131,13 +131,9 @@ public void apply(List<? extends Node> nodes, RuleContext ctx) {\n     }\n \n     protected void visitAll(List<? extends Node> nodes, RuleContext ctx) {\n-        for (Object element : nodes) {\n-            if (element instanceof ASTUserClass) {\n-                visit((ASTUserClass) element, ctx);\n-            } else if (element instanceof ASTUserInterface) {\n-                visit((ASTUserInterface) element, ctx);\n-            } else if (element instanceof ASTUserTrigger) {\n-                visit((ASTUserTrigger) element, ctx);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d3d75fa0b91e30c59c6a947743a948ee09f5b051"}, "originalPosition": 10}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4796, "cost": 1, "resetAt": "2021-11-01T16:37:27Z"}}}