{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDEzMTgxOTE4", "number": 4840, "title": "REST authentication: Remove exception class name from failure message", "bodyText": "our security review check all error views.\nserver.error.include-stacktrace=NEVER\n\ndeactivating stacktrace did not filter out messages with cas internal information. so you get information about the underlying technology and look how you can hack the whole system.\nWhat sensitive information are you referring to?\nCAS Class Information\nWhat framework are you referring to?\nCAS Rest Auth\nIf you're using REST-based authentication and your API is passing along sensitive information as part of a failure, have you considered to change the API to not do that?\nCAS is passing this info to client if something goes wrong. A hacker provoke errors to get such information.\nAre there test cases accounting for the changes you have made?\nThere are no tests for this class and i need an initial test class, because i do not know your whole test infrastructure.\nDoes this patch need to be ported forward to master?\nyes", "createdAt": "2020-05-04T20:59:26Z", "url": "https://github.com/apereo/cas/pull/4840", "merged": true, "mergeCommit": {"oid": "83008eb97b2e4634dd6688d89b68c0445ae13b9f"}, "closed": true, "closedAt": "2020-05-26T21:08:29Z", "author": {"login": "johnjcool"}, "timelineItems": {"totalCount": 11, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABceF7YqAH2gAyNDEzMTgxOTE4OjA3OTg4ZWJmZTI4NjFhY2ViMTkwOWFkZjZhM2QxOWFmNThmZjgxNGE=", "endCursor": "Y3Vyc29yOnYyOpPPAAABclAhwWgH2gAyNDEzMTgxOTE4OjEzZTgxY2E5NzBhYWI0ZDcyOGFhYWE1NzY1MDc4MzAzN2RlNTAyMjI=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "07988ebfe2861aceb1909adf6a3d19af58ff814a", "author": {"user": {"login": "johnjcool", "name": null}}, "url": "https://github.com/apereo/cas/commit/07988ebfe2861aceb1909adf6a3d19af58ff814a", "committedDate": "2020-05-04T20:58:12Z", "message": "Security: hide sensitive framework information during rest call exceptions"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b1dde6506814a65da3856a030c4ed39330d10455", "author": {"user": {"login": "johnjcool", "name": null}}, "url": "https://github.com/apereo/cas/commit/b1dde6506814a65da3856a030c4ed39330d10455", "committedDate": "2020-05-12T07:19:25Z", "message": "Merge branch '6.1.x' into bugfix/hide-sensitive-framework-information\n\n* 6.1.x:\n  Use tag for samba test container with version of ubuntu that works with java 11.0.2 (#4846)\n  Update Attribute-Release-PrincipalId.md"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDA5ODcwMTc5", "url": "https://github.com/apereo/cas/pull/4840#pullrequestreview-409870179", "createdAt": "2020-05-12T09:37:31Z", "commit": {"oid": "b1dde6506814a65da3856a030c4ed39330d10455"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ef736679dddcf791d36da49bae0b1466119cb0a4", "author": {"user": {"login": "johnjcool", "name": null}}, "url": "https://github.com/apereo/cas/commit/ef736679dddcf791d36da49bae0b1466119cb0a4", "committedDate": "2020-05-13T22:34:22Z", "message": "added test"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDExNDk3MDUz", "url": "https://github.com/apereo/cas/pull/4840#pullrequestreview-411497053", "createdAt": "2020-05-14T06:26:36Z", "commit": {"oid": "ef736679dddcf791d36da49bae0b1466119cb0a4"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xNFQwNjoyNjozNlrOGVNrDQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xNFQwNjoyNzo0MVrOGVNsuw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNDg5NzI5Mw==", "bodyText": "Why this change?", "url": "https://github.com/apereo/cas/pull/4840#discussion_r424897293", "createdAt": "2020-05-14T06:26:36Z", "author": {"login": "mmoayyed"}, "path": "support/cas-server-support-rest-core/src/main/java/org/apereo/cas/support/rest/resources/RestResourceUtils.java", "diffHunk": "@@ -39,8 +39,12 @@\n             .findAndRegisterModules()\n             .configure(DeserializationFeature.ADJUST_DATES_TO_CONTEXT_TIME_ZONE, false)\n             .configure(SerializationFeature.WRITE_DATES_AS_TIMESTAMPS, false)\n-            .setSerializationInclusion(JsonInclude.Include.NON_EMPTY)\n-            .enableDefaultTyping(ObjectMapper.DefaultTyping.NON_FINAL, JsonTypeInfo.As.PROPERTY);\n+            .setSerializationInclusion(JsonInclude.Include.NON_EMPTY);\n+        MAPPER.activateDefaultTyping(\n+                MAPPER.getPolymorphicTypeValidator(),\n+                ObjectMapper.DefaultTyping.NON_FINAL,\n+                JsonTypeInfo.As.PROPERTY", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ef736679dddcf791d36da49bae0b1466119cb0a4"}, "originalPosition": 10}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNDg5NzY2MA==", "bodyText": "Tag with @Tag(\"RestfulApi\")", "url": "https://github.com/apereo/cas/pull/4840#discussion_r424897660", "createdAt": "2020-05-14T06:27:30Z", "author": {"login": "mmoayyed"}, "path": "support/cas-server-support-rest/src/test/java/org/apereo/cas/support/rest/RestResourceUtilsTests.java", "diffHunk": "@@ -0,0 +1,63 @@\n+package org.apereo.cas.support.rest;\n+\n+import lombok.val;\n+import org.apereo.cas.authentication.AuthenticationException;\n+import org.apereo.cas.authentication.adaptive.UnauthorizedAuthenticationException;\n+import org.apereo.cas.support.rest.resources.RestResourceUtils;\n+import org.apereo.cas.util.CollectionUtils;\n+import org.junit.jupiter.api.BeforeEach;\n+import org.junit.jupiter.api.Test;\n+import org.junit.jupiter.api.extension.ExtendWith;\n+import org.mockito.Mock;\n+import org.mockito.MockitoAnnotations;\n+import org.mockito.junit.jupiter.MockitoExtension;\n+import org.springframework.context.ApplicationContext;\n+import org.springframework.http.ResponseEntity;\n+\n+import javax.servlet.http.HttpServletRequest;\n+import java.util.HashMap;\n+\n+import static org.junit.jupiter.api.Assertions.assertFalse;\n+import static org.junit.jupiter.api.Assertions.assertTrue;\n+import static org.mockito.ArgumentMatchers.any;\n+import static org.mockito.Mockito.doReturn;\n+import static org.mockito.Mockito.mock;\n+\n+/**\n+ * This is {@link RestResourceUtilsTests}.\n+ *\n+ * @author john.j.cool\n+ * @since 6.1.6\n+ */\n+@ExtendWith(MockitoExtension.class)\n+public class RestResourceUtilsTests {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ef736679dddcf791d36da49bae0b1466119cb0a4"}, "originalPosition": 33}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNDg5NzcyMw==", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                    ResponseEntity<String> response = RestResourceUtils.createResponseEntityForAuthnFailure(\n          \n          \n            \n                    val response = RestResourceUtils.createResponseEntityForAuthnFailure(", "url": "https://github.com/apereo/cas/pull/4840#discussion_r424897723", "createdAt": "2020-05-14T06:27:41Z", "author": {"login": "mmoayyed"}, "path": "support/cas-server-support-rest/src/test/java/org/apereo/cas/support/rest/RestResourceUtilsTests.java", "diffHunk": "@@ -0,0 +1,63 @@\n+package org.apereo.cas.support.rest;\n+\n+import lombok.val;\n+import org.apereo.cas.authentication.AuthenticationException;\n+import org.apereo.cas.authentication.adaptive.UnauthorizedAuthenticationException;\n+import org.apereo.cas.support.rest.resources.RestResourceUtils;\n+import org.apereo.cas.util.CollectionUtils;\n+import org.junit.jupiter.api.BeforeEach;\n+import org.junit.jupiter.api.Test;\n+import org.junit.jupiter.api.extension.ExtendWith;\n+import org.mockito.Mock;\n+import org.mockito.MockitoAnnotations;\n+import org.mockito.junit.jupiter.MockitoExtension;\n+import org.springframework.context.ApplicationContext;\n+import org.springframework.http.ResponseEntity;\n+\n+import javax.servlet.http.HttpServletRequest;\n+import java.util.HashMap;\n+\n+import static org.junit.jupiter.api.Assertions.assertFalse;\n+import static org.junit.jupiter.api.Assertions.assertTrue;\n+import static org.mockito.ArgumentMatchers.any;\n+import static org.mockito.Mockito.doReturn;\n+import static org.mockito.Mockito.mock;\n+\n+/**\n+ * This is {@link RestResourceUtilsTests}.\n+ *\n+ * @author john.j.cool\n+ * @since 6.1.6\n+ */\n+@ExtendWith(MockitoExtension.class)\n+public class RestResourceUtilsTests {\n+\n+    @Mock\n+    private ApplicationContext context;\n+\n+    @BeforeEach\n+    public void before() {\n+        MockitoAnnotations.initMocks(this);\n+        doReturn(\"test\").when(context)\n+                .getMessage(any(), any(), any());\n+    }\n+\n+    @Test\n+    public void verifyNoFrameworkClassSendToClient() {\n+        val request = mock(HttpServletRequest.class);\n+        val msg = \"test\";\n+        val map = CollectionUtils.<String, Throwable>wrap(\n+                UnauthorizedAuthenticationException.class.getSimpleName(),\n+                new UnauthorizedAuthenticationException(msg)\n+        );\n+\n+        ResponseEntity<String> response = RestResourceUtils.createResponseEntityForAuthnFailure(", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ef736679dddcf791d36da49bae0b1466119cb0a4"}, "originalPosition": 54}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "48f5914006b0bc85d29b09ba77781323e0913a6d", "author": {"user": {"login": "johnjcool", "name": null}}, "url": "https://github.com/apereo/cas/commit/48f5914006b0bc85d29b09ba77781323e0913a6d", "committedDate": "2020-05-14T07:06:44Z", "message": "adding feedback"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "047fc382a877c6c46184106de8e08ec7c27af04c", "author": {"user": {"login": "johnjcool", "name": null}}, "url": "https://github.com/apereo/cas/commit/047fc382a877c6c46184106de8e08ec7c27af04c", "committedDate": "2020-05-14T07:12:44Z", "message": "reverted deprecated fix."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "362df3031b21e5c1e11dd5c516960b29f9ebb220", "author": {"user": {"login": "johnjcool", "name": null}}, "url": "https://github.com/apereo/cas/commit/362df3031b21e5c1e11dd5c516960b29f9ebb220", "committedDate": "2020-05-14T16:23:48Z", "message": "fixing checkstyle errors"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ce4ced7adb235abf176a9f776ae264fb955640fa", "author": {"user": {"login": "mmoayyed", "name": "Misagh Moayyed"}}, "url": "https://github.com/apereo/cas/commit/ce4ced7adb235abf176a9f776ae264fb955640fa", "committedDate": "2020-05-22T09:39:00Z", "message": "Merge branch '6.1.x' into bugfix/hide-sensitive-framework-information"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a0930773c4b15c690c33ef45e45034a127e2ddf0", "author": {"user": {"login": "johnjcool", "name": null}}, "url": "https://github.com/apereo/cas/commit/a0930773c4b15c690c33ef45e45034a127e2ddf0", "committedDate": "2020-05-25T16:42:07Z", "message": "fixing test exception"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "13e81ca970aab4d728aaaa57650783037de50222", "author": {"user": {"login": "johnjcool", "name": null}}, "url": "https://github.com/apereo/cas/commit/13e81ca970aab4d728aaaa57650783037de50222", "committedDate": "2020-05-26T08:38:09Z", "message": "fixing tests"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3583, "cost": 1, "resetAt": "2021-11-01T11:59:11Z"}}}