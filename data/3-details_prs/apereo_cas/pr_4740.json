{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0MzgxNjQyNTAw", "number": 4740, "title": "Surrogate authentication NPE fix for REST protocol", "bodyText": "There exists a problem when you implement REST protocol and Surrogate Authentication in one CAS instance.\nIt happens when you try to request a ticket-granting ticket from a REST protocol endpoint. Surrogate Authentication has been configured in such a way that the REST protocol bean restHttpRequestCredentialFactoryConfigurer is overridden with surrogate authentication restHttpRequestCredentialFactoryConfigurer bean. Resulting in a single credential factory for username/password credential in the ChainingRestHttpRequestCredentialFactory chain. That credential factory is SurrogateAuthenticationRestHttpRequestCredentialFactory.\nThe fix allows SurrogateAuthenticationRestHttpRequestCredentialFactory to return UsernamePasswordCredential or SurrogateUsernamePasswordCredential depending on the request.\nI see that Misagh Moayyed has overridden the mentioned bean because of the fear of duplicate authentication. Surrogate authentication is extending the REST protocol, so it should still support basic username and password credential passing also.", "createdAt": "2020-02-28T23:23:08Z", "url": "https://github.com/apereo/cas/pull/4740", "merged": true, "mergeCommit": {"oid": "172ab78f1b91f7a476bfd3cbc5800282b272d71f"}, "closed": true, "closedAt": "2020-03-02T08:03:53Z", "author": {"login": "CardoEggert"}, "timelineItems": {"totalCount": 18, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcI4FmygH2gAyMzgxNjQyNTAwOjI0ODQyNDVmZTM4MzBlY2QxNjYzNjY2ZmEwYmM1ZDE4NmM4OGRiNjI=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcJoy2sgH2gAyMzgxNjQyNTAwOmY0Y2UzYjVkYWI5Mjk4ZTQyYzZkYWQwZGM2NzU2OTAzNDVhZmRkM2I=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "2484245fe3830ecd1663666fa0bc5d186c88db62", "author": {"user": {"login": "CardoEggert", "name": "Cardo Eggert"}}, "url": "https://github.com/apereo/cas/commit/2484245fe3830ecd1663666fa0bc5d186c88db62", "committedDate": "2020-02-28T22:58:17Z", "message": "Surrogate authentication NPE fix for basic REST protocol login"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "7688d8e488931bbb8007502fde203da19b44244e", "author": {"user": {"login": "apereocas-bot", "name": null}}, "url": "https://github.com/apereo/cas/commit/7688d8e488931bbb8007502fde203da19b44244e", "committedDate": "2020-02-29T07:17:28Z", "message": "Merge branch 'master' into surrogate-authentication-npe-fix"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "d5099b0c1acc2f902258099785c980e2038225b6", "author": {"user": {"login": "CardoEggert", "name": "Cardo Eggert"}}, "url": "https://github.com/apereo/cas/commit/d5099b0c1acc2f902258099785c980e2038225b6", "committedDate": "2020-02-29T07:35:28Z", "message": "Remove unused import"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzY2Nzg0MTU4", "url": "https://github.com/apereo/cas/pull/4740#pullrequestreview-366784158", "createdAt": "2020-02-29T07:49:19Z", "commit": {"oid": "d5099b0c1acc2f902258099785c980e2038225b6"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yOVQwNzo0OToxOVrOFwIMhw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yOVQwNzo0OToxOVrOFwIMhw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NjAxMDI0Nw==", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                        LOGGER.debug(\"Not a surrogate authentication attempt, returning parent class credentials\");\n          \n          \n            \n                        LOGGER.trace(\"Not a surrogate authentication attempt, returning parent class credentials\");", "url": "https://github.com/apereo/cas/pull/4740#discussion_r386010247", "createdAt": "2020-02-29T07:49:19Z", "author": {"login": "mmoayyed"}, "path": "support/cas-server-support-surrogate-authentication/src/main/java/org/apereo/cas/authentication/rest/SurrogateAuthenticationRestHttpRequestCredentialFactory.java", "diffHunk": "@@ -86,6 +86,10 @@ public int getOrder() {\n             return credentials;\n         }\n         val credential = extractCredential(request, credentials);\n+        if (credential == null) {\n+            LOGGER.debug(\"Not a surrogate authentication attempt, returning parent class credentials\");", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d5099b0c1acc2f902258099785c980e2038225b6"}, "originalPosition": 5}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "5b2d2ef0cd349fe8a3f0e2bb0b1823129dd14554", "author": {"user": {"login": "mmoayyed", "name": "Misagh Moayyed"}}, "url": "https://github.com/apereo/cas/commit/5b2d2ef0cd349fe8a3f0e2bb0b1823129dd14554", "committedDate": "2020-02-29T07:49:24Z", "message": "Update support/cas-server-support-surrogate-authentication/src/main/java/org/apereo/cas/authentication/rest/SurrogateAuthenticationRestHttpRequestCredentialFactory.java"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "3a02cefd89b7699c6218dcbd6485dafeebebc04e", "author": {"user": {"login": "apereocas-bot", "name": null}}, "url": "https://github.com/apereo/cas/commit/3a02cefd89b7699c6218dcbd6485dafeebebc04e", "committedDate": "2020-02-29T13:17:28Z", "message": "Merge branch 'master' into surrogate-authentication-npe-fix"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "9598f9ceb433024dbc067588f6205e2d2afc72b7", "author": {"user": {"login": "CardoEggert", "name": "Cardo Eggert"}}, "url": "https://github.com/apereo/cas/commit/9598f9ceb433024dbc067588f6205e2d2afc72b7", "committedDate": "2020-03-01T15:12:19Z", "message": "Ldap utils checkstyle comment fix from apereocas-bot master merge"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "9241bedfe16b82ac6641cfd88e45e77dbf7bdc86", "author": {"user": {"login": "CardoEggert", "name": "Cardo Eggert"}}, "url": "https://github.com/apereo/cas/commit/9241bedfe16b82ac6641cfd88e45e77dbf7bdc86", "committedDate": "2020-03-01T16:36:17Z", "message": "Merge branch 'master' of github.com:CardoKambla/cas into surrogate-authentication-npe-fix"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "aafa869d712006d2f40f0e80a6280d008a394313", "author": {"user": {"login": "apereocas-bot", "name": null}}, "url": "https://github.com/apereo/cas/commit/aafa869d712006d2f40f0e80a6280d008a394313", "committedDate": "2020-03-01T18:37:04Z", "message": "Merge branch 'master' into surrogate-authentication-npe-fix"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "281fa384acf6c5cc9b95d627cfdee8237ff1af56", "author": {"user": {"login": "apereocas-bot", "name": null}}, "url": "https://github.com/apereo/cas/commit/281fa384acf6c5cc9b95d627cfdee8237ff1af56", "committedDate": "2020-03-01T20:07:05Z", "message": "Merge branch 'master' into surrogate-authentication-npe-fix"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e3707bccbc53756043c43f1aedf250f2adbdcac7", "author": {"user": {"login": "apereocas-bot", "name": null}}, "url": "https://github.com/apereo/cas/commit/e3707bccbc53756043c43f1aedf250f2adbdcac7", "committedDate": "2020-03-01T21:13:09Z", "message": "Merge branch 'master' into surrogate-authentication-npe-fix"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "5ff2ee719671cd6f461a30e21b3f0844e3541a61", "author": {"user": {"login": "apereocas-bot", "name": null}}, "url": "https://github.com/apereo/cas/commit/5ff2ee719671cd6f461a30e21b3f0844e3541a61", "committedDate": "2020-03-01T22:43:09Z", "message": "Merge branch 'master' into surrogate-authentication-npe-fix"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b6f3f2de5baf47f8fa2749882ba6e68bce660691", "author": {"user": {"login": "apereocas-bot", "name": null}}, "url": "https://github.com/apereo/cas/commit/b6f3f2de5baf47f8fa2749882ba6e68bce660691", "committedDate": "2020-03-02T00:13:09Z", "message": "Merge branch 'master' into surrogate-authentication-npe-fix"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "d7f050c9605c2d9b835ccd0ccbb3708917458a51", "author": {"user": {"login": "apereocas-bot", "name": null}}, "url": "https://github.com/apereo/cas/commit/d7f050c9605c2d9b835ccd0ccbb3708917458a51", "committedDate": "2020-03-02T01:43:09Z", "message": "Merge branch 'master' into surrogate-authentication-npe-fix"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "9fe468ddc433e29c1fc1018552e9def467df5396", "author": {"user": {"login": "apereocas-bot", "name": null}}, "url": "https://github.com/apereo/cas/commit/9fe468ddc433e29c1fc1018552e9def467df5396", "committedDate": "2020-03-02T03:13:10Z", "message": "Merge branch 'master' into surrogate-authentication-npe-fix"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "bccdbe0ebdadfbac7c13715ff9d4dfb6abc033bc", "author": {"user": {"login": "apereocas-bot", "name": null}}, "url": "https://github.com/apereo/cas/commit/bccdbe0ebdadfbac7c13715ff9d4dfb6abc033bc", "committedDate": "2020-03-02T04:43:10Z", "message": "Merge branch 'master' into surrogate-authentication-npe-fix"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ed26413b5d71f76e7613bd9875f47cba5f681062", "author": {"user": {"login": "apereocas-bot", "name": null}}, "url": "https://github.com/apereo/cas/commit/ed26413b5d71f76e7613bd9875f47cba5f681062", "committedDate": "2020-03-02T06:13:09Z", "message": "Merge branch 'master' into surrogate-authentication-npe-fix"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f4ce3b5dab9298e42c6dad0dc675690345afdd3b", "author": {"user": {"login": "apereocas-bot", "name": null}}, "url": "https://github.com/apereo/cas/commit/f4ce3b5dab9298e42c6dad0dc675690345afdd3b", "committedDate": "2020-03-02T07:43:09Z", "message": "Merge branch 'master' into surrogate-authentication-npe-fix"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3638, "cost": 1, "resetAt": "2021-11-01T11:59:11Z"}}}