{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0Mzc0NTU0MzMz", "number": 4692, "reviewThreads": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xM1QwNzo1NTozMlrODfcnzg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xM1QwNzo1NjoyM1rODfcomQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjM0MzAxMzkwOnYy", "diffSide": "RIGHT", "path": "api/cas-server-core-api-configuration-model/src/main/java/org/apereo/cas/configuration/model/support/pm/PasswordManagementProperties.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xM1QwNzo1NTozMlrOFpJ8Yg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xM1QyMjo1ODowN1rOFpmeyg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3ODY5ODg1MA==", "bodyText": "Rename to includeServerIpAddress or something similar", "url": "https://github.com/apereo/cas/pull/4692#discussion_r378698850", "createdAt": "2020-02-13T07:55:32Z", "author": {"login": "mmoayyed"}, "path": "api/cas-server-core-api-configuration-model/src/main/java/org/apereo/cas/configuration/model/support/pm/PasswordManagementProperties.java", "diffHunk": "@@ -266,6 +266,16 @@ public ForgotUsername() {\n          */\n         private boolean securityQuestionsEnabled = true;\n \n+        /**\n+         * Whether the Password Management Token will contain the server IP Address.\n+         */\n+        private boolean checkServerIpAddress = true;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "a43f1d0473745f4def9a7ac2f40a41b72b361b8c"}, "originalPosition": 7}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3OTE2NjQxMA==", "bodyText": "Done", "url": "https://github.com/apereo/cas/pull/4692#discussion_r379166410", "createdAt": "2020-02-13T22:58:07Z", "author": {"login": "julienhuon"}, "path": "api/cas-server-core-api-configuration-model/src/main/java/org/apereo/cas/configuration/model/support/pm/PasswordManagementProperties.java", "diffHunk": "@@ -266,6 +266,16 @@ public ForgotUsername() {\n          */\n         private boolean securityQuestionsEnabled = true;\n \n+        /**\n+         * Whether the Password Management Token will contain the server IP Address.\n+         */\n+        private boolean checkServerIpAddress = true;", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3ODY5ODg1MA=="}, "originalCommit": {"oid": "a43f1d0473745f4def9a7ac2f40a41b72b361b8c"}, "originalPosition": 7}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjM0MzAxNDM4OnYy", "diffSide": "RIGHT", "path": "api/cas-server-core-api-configuration-model/src/main/java/org/apereo/cas/configuration/model/support/pm/PasswordManagementProperties.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xM1QwNzo1NTo0NVrOFpJ8rg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xM1QyMjo1ODoxNVrOFpme_A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3ODY5ODkyNg==", "bodyText": "Rename to includeClientIpAddress or something similar", "url": "https://github.com/apereo/cas/pull/4692#discussion_r378698926", "createdAt": "2020-02-13T07:55:45Z", "author": {"login": "mmoayyed"}, "path": "api/cas-server-core-api-configuration-model/src/main/java/org/apereo/cas/configuration/model/support/pm/PasswordManagementProperties.java", "diffHunk": "@@ -266,6 +266,16 @@ public ForgotUsername() {\n          */\n         private boolean securityQuestionsEnabled = true;\n \n+        /**\n+         * Whether the Password Management Token will contain the server IP Address.\n+         */\n+        private boolean checkServerIpAddress = true;\n+\n+        /**\n+         * Whether the Password Management Token will contain the client IP Address.\n+         */\n+        private boolean checkClientIpAddress = true;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "a43f1d0473745f4def9a7ac2f40a41b72b361b8c"}, "originalPosition": 12}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3OTE2NjQ2MA==", "bodyText": "Done", "url": "https://github.com/apereo/cas/pull/4692#discussion_r379166460", "createdAt": "2020-02-13T22:58:15Z", "author": {"login": "julienhuon"}, "path": "api/cas-server-core-api-configuration-model/src/main/java/org/apereo/cas/configuration/model/support/pm/PasswordManagementProperties.java", "diffHunk": "@@ -266,6 +266,16 @@ public ForgotUsername() {\n          */\n         private boolean securityQuestionsEnabled = true;\n \n+        /**\n+         * Whether the Password Management Token will contain the server IP Address.\n+         */\n+        private boolean checkServerIpAddress = true;\n+\n+        /**\n+         * Whether the Password Management Token will contain the client IP Address.\n+         */\n+        private boolean checkClientIpAddress = true;", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3ODY5ODkyNg=="}, "originalCommit": {"oid": "a43f1d0473745f4def9a7ac2f40a41b72b361b8c"}, "originalPosition": 12}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjM0MzAxNTMzOnYy", "diffSide": "RIGHT", "path": "support/cas-server-support-pm-core/src/main/java/org/apereo/cas/pm/BasePasswordManagementService.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xM1QwNzo1NjowOFrOFpJ9Qg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xM1QyMjo1ODoyMFrOFpmfEg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3ODY5OTA3NA==", "bodyText": "Extract properties.getRest() into a variable.", "url": "https://github.com/apereo/cas/pull/4692#discussion_r378699074", "createdAt": "2020-02-13T07:56:08Z", "author": {"login": "mmoayyed"}, "path": "support/cas-server-support-pm-core/src/main/java/org/apereo/cas/pm/BasePasswordManagementService.java", "diffHunk": "@@ -74,11 +74,11 @@ public String parseToken(final String token) {\n             }\n \n             val holder = ClientInfoHolder.getClientInfo();\n-            if (!claims.getStringClaimValue(\"origin\").equals(holder.getServerIpAddress())) {\n+            if (properties.getReset().isCheckServerIpAddress() && !claims.getStringClaimValue(\"origin\").equals(holder.getServerIpAddress())) {\n                 LOGGER.error(\"Token origin server IP address does not match CAS\");\n                 return null;\n             }\n-            if (!claims.getStringClaimValue(\"client\").equals(holder.getClientIpAddress())) {\n+            if (properties.getReset().isCheckClientIpAddress() && !claims.getStringClaimValue(\"client\").equals(holder.getClientIpAddress())) {\n                 LOGGER.error(\"Token client IP address does not match CAS\");", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "a43f1d0473745f4def9a7ac2f40a41b72b361b8c"}, "originalPosition": 11}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3OTE2NjQ4Mg==", "bodyText": "Done", "url": "https://github.com/apereo/cas/pull/4692#discussion_r379166482", "createdAt": "2020-02-13T22:58:20Z", "author": {"login": "julienhuon"}, "path": "support/cas-server-support-pm-core/src/main/java/org/apereo/cas/pm/BasePasswordManagementService.java", "diffHunk": "@@ -74,11 +74,11 @@ public String parseToken(final String token) {\n             }\n \n             val holder = ClientInfoHolder.getClientInfo();\n-            if (!claims.getStringClaimValue(\"origin\").equals(holder.getServerIpAddress())) {\n+            if (properties.getReset().isCheckServerIpAddress() && !claims.getStringClaimValue(\"origin\").equals(holder.getServerIpAddress())) {\n                 LOGGER.error(\"Token origin server IP address does not match CAS\");\n                 return null;\n             }\n-            if (!claims.getStringClaimValue(\"client\").equals(holder.getClientIpAddress())) {\n+            if (properties.getReset().isCheckClientIpAddress() && !claims.getStringClaimValue(\"client\").equals(holder.getClientIpAddress())) {\n                 LOGGER.error(\"Token client IP address does not match CAS\");", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3ODY5OTA3NA=="}, "originalCommit": {"oid": "a43f1d0473745f4def9a7ac2f40a41b72b361b8c"}, "originalPosition": 11}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjM0MzAxNTkzOnYy", "diffSide": "RIGHT", "path": "support/cas-server-support-pm-core/src/main/java/org/apereo/cas/pm/BasePasswordManagementService.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xM1QwNzo1NjoyM1rOFpJ9ng==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xM1QyMjo1ODoyOFrOFpmfOQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3ODY5OTE2Ng==", "bodyText": "Extract properties.getRest() into a variable.", "url": "https://github.com/apereo/cas/pull/4692#discussion_r378699166", "createdAt": "2020-02-13T07:56:23Z", "author": {"login": "mmoayyed"}, "path": "support/cas-server-support-pm-core/src/main/java/org/apereo/cas/pm/BasePasswordManagementService.java", "diffHunk": "@@ -110,8 +110,12 @@ public String createToken(final String to) {\n \n             val holder = ClientInfoHolder.getClientInfo();\n             if (holder != null) {\n-                claims.setStringClaim(\"origin\", holder.getServerIpAddress());\n-                claims.setStringClaim(\"client\", holder.getClientIpAddress());\n+                if (properties.getReset().isCheckServerIpAddress()) {\n+                    claims.setStringClaim(\"origin\", holder.getServerIpAddress());\n+                }\n+                if (properties.getReset().isCheckClientIpAddress()) {\n+                    claims.setStringClaim(\"client\", holder.getClientIpAddress());\n+                }", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "a43f1d0473745f4def9a7ac2f40a41b72b361b8c"}, "originalPosition": 25}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3OTE2NjUyMQ==", "bodyText": "Done", "url": "https://github.com/apereo/cas/pull/4692#discussion_r379166521", "createdAt": "2020-02-13T22:58:28Z", "author": {"login": "julienhuon"}, "path": "support/cas-server-support-pm-core/src/main/java/org/apereo/cas/pm/BasePasswordManagementService.java", "diffHunk": "@@ -110,8 +110,12 @@ public String createToken(final String to) {\n \n             val holder = ClientInfoHolder.getClientInfo();\n             if (holder != null) {\n-                claims.setStringClaim(\"origin\", holder.getServerIpAddress());\n-                claims.setStringClaim(\"client\", holder.getClientIpAddress());\n+                if (properties.getReset().isCheckServerIpAddress()) {\n+                    claims.setStringClaim(\"origin\", holder.getServerIpAddress());\n+                }\n+                if (properties.getReset().isCheckClientIpAddress()) {\n+                    claims.setStringClaim(\"client\", holder.getClientIpAddress());\n+                }", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3ODY5OTE2Ng=="}, "originalCommit": {"oid": "a43f1d0473745f4def9a7ac2f40a41b72b361b8c"}, "originalPosition": 25}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4111, "cost": 1, "resetAt": "2021-11-12T09:44:50Z"}}}