{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0Mzc4MjY2ODgw", "number": 4732, "title": "Fix OIDC logout", "bodyText": "Hello Misagh,\nThe OIDC RP-initiated logout describe here seems broken in CAS if you're using any of the specified parameters.\nThis pull request fixes the oidc logout and adds unit tests to avoid any future problem. the following bugs are fixed:\nState Parameter\nThe state parameter is never returned:\n> GET /cas/oidc/logout?state=fefefe HTTP/1.1\n< Location: http://cas.example.org:8080/cas/logout?state\n\nRedirectParameter is not defaulted to service\nIf you're not setting the following property in your cas.properties:\ncas.logout.redirectParameter=service\n\nWhen you're sending a valid id token, the following error will appears:\n2020-02-21 11:53:16,056 DEBUG [org.apereo.cas.logout.slo.DefaultSingleLogoutServiceLogoutUrlBuilder] - <Logout request will be sent to [http://logout,http://pouet] for service [AbstractWebApplicationService(id=svod, originalUrl=svod, artifactId=null, principal=null, source=null, loggedOutAlready=false, format=XML, attributes={})]>\n2020-02-21 11:53:16,071 DEBUG [org.apereo.cas.web.FlowExecutionExceptionResolver] - <Ignoring the received exception [java.lang.IllegalArgumentException: Name must not be null] due to a type mismatch with handler [org.apereo.cas.oidc.web.controllers.logout.OidcLogoutEndpointController#handleRequestInternal(String, String, String, HttpServletRequest, HttpServletResponse)]>\n2020-02-21 11:53:16,073 DEBUG [org.apereo.cas.web.FlowExecutionExceptionResolver] - <Ignoring the received exception [java.lang.IllegalArgumentException: Name must not be null] due to a type mismatch with handler [org.apereo.cas.oidc.web.controllers.logout.OidcLogoutEndpointController#handleRequestInternal(String, String, String, HttpServletRequest, HttpServletResponse)]>\n2020-02-21 11:53:16,076 ERROR [org.springframework.boot.web.servlet.support.ErrorPageFilter] - <Forwarding to error page from request [/oidc/logout] due to exception [Name must not be null]>\n\n\nAnd you will never be redirected.\nThe redirect url is not correctly formatted when you're not using post_logout_redirect_uri\nIf you're sending a request with an id_token but without post_logout_redirect_uri, cas will redirect you to an invalid url:\n> GET /cas/oidc/logout?id_token_hint=eyJhbGciOiJFUzI1NiIsInR5cCI6IkpXVCIsImtpZCI6InBvdWV0In0.eyJqdGkiOiJUR1QtMS1rZFZmOGMyU1BsZmJCMFFURU9LNllaNWMxVVpKNDJIUGpFbW10UnluSTFNMFBkaXpaa2hLYXFYaWNmay1HNjdOLW9nLWEwZmYwYTAxYzVhYiIsImlzcyI6Imh0dHA6Ly9jYXMuZXhhbXBsZS5vcmc6ODA4MC9jYXMvb2lkYyIsImF1ZCI6InN2b2QiLCJleHAiOjE1ODIzMTYxNTMsImlhdCI6MTU4MjI4NzM1MywibmJmIjoxNTgyMjg3MDUzLCJzdWIiOiJwb3VldCIsImNsaWVudF9pZCI6InN2b2QiLCJhdXRoX3RpbWUiOjE1ODIyODczNDUsInN0YXRlIjoiRTRIM0NJOUM5elQ5T0ZBeDd5dU9FZyIsIm5vbmNlIjoiIiwiYXRfaGFzaCI6Ii01ZXF6V1JLWTZYZ0g5Zm9PQTFXWUEiLCJwcmVmZXJyZWRfdXNlcm5hbWUiOiJwb3VldCJ9.1_0Kdo6h_Pw73Z5aN0OOnt1sVLXPX1AMwy4Er2o1ZB-wtX6Ua3uOSFsFsSQKUMf6jRsi0JwfdB44ICiVvKfVQQ&state=fefefe HTTP/1.1\n\n< Location: http://cas.example.org:8080/cas/logout?service=org.apereo.cas.logout.slo.SingleLogoutUrl@b123286f&state=org.apereo.cas.logout.slo.SingleLogoutUrl@b123286f\n\nNotice the state parameter value.\nRegards,\nJulien", "createdAt": "2020-02-21T12:48:46Z", "url": "https://github.com/apereo/cas/pull/4732", "merged": true, "mergeCommit": {"oid": "d8552017af435e5894006efb64922f50e107349a"}, "closed": true, "closedAt": "2020-02-29T07:47:57Z", "author": {"login": "julienhuon"}, "timelineItems": {"totalCount": 19, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcGfCVVAH2gAyMzc4MjY2ODgwOjA1YTllZTFkOThhZjM4NjIzZTFmMjc3ZmUzOWJkMzBjOWFlYjI3NDU=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcI_OqvgH2gAyMzc4MjY2ODgwOmYxYWQ2ZTQ5M2IyMjE5OTA0NjBhNDIyMmFlZjU5OGQzMzhjZjBlZWI=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "05a9ee1d98af38623e1f277fe39bd30c9aeb2745", "author": {"user": {"login": "julienhuon", "name": "Julien Huon"}}, "url": "https://github.com/apereo/cas/commit/05a9ee1d98af38623e1f277fe39bd30c9aeb2745", "committedDate": "2020-02-21T12:39:14Z", "message": "Fix OIDC logout"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "53ad7a3178a0edaa7170c926f85fbc76319dd88c", "author": {"user": {"login": "apereocas-bot", "name": null}}, "url": "https://github.com/apereo/cas/commit/53ad7a3178a0edaa7170c926f85fbc76319dd88c", "committedDate": "2020-02-21T12:57:23Z", "message": "Merge branch 'master' into oidclogoutmaster"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ad3eaa318419f6a3695fa2ab5f6236f86526543f", "author": {"user": {"login": "apereocas-bot", "name": null}}, "url": "https://github.com/apereo/cas/commit/ad3eaa318419f6a3695fa2ab5f6236f86526543f", "committedDate": "2020-02-21T14:27:24Z", "message": "Merge branch 'master' into oidclogoutmaster"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "4c768903c2d31df98b2bdcdf2c4c67f635f1c53b", "author": {"user": {"login": "apereocas-bot", "name": null}}, "url": "https://github.com/apereo/cas/commit/4c768903c2d31df98b2bdcdf2c4c67f635f1c53b", "committedDate": "2020-02-21T15:57:24Z", "message": "Merge branch 'master' into oidclogoutmaster"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "3ce1ac7d26d4f53efd065a0e2ac9807bc90f371b", "author": {"user": {"login": "apereocas-bot", "name": null}}, "url": "https://github.com/apereo/cas/commit/3ce1ac7d26d4f53efd065a0e2ac9807bc90f371b", "committedDate": "2020-02-21T17:27:22Z", "message": "Merge branch 'master' into oidclogoutmaster"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "13292cd1fb27b373c262b8e7219edf4acfa8649a", "author": {"user": {"login": "apereocas-bot", "name": null}}, "url": "https://github.com/apereo/cas/commit/13292cd1fb27b373c262b8e7219edf4acfa8649a", "committedDate": "2020-02-21T18:57:23Z", "message": "Merge branch 'master' into oidclogoutmaster"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "0de207f2dbd06fc246690ad3c5a543141508faa8", "author": {"user": {"login": "apereocas-bot", "name": null}}, "url": "https://github.com/apereo/cas/commit/0de207f2dbd06fc246690ad3c5a543141508faa8", "committedDate": "2020-02-21T20:27:23Z", "message": "Merge branch 'master' into oidclogoutmaster"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "50752572ac61ca19469261e890892db8ffdec594", "author": {"user": {"login": "apereocas-bot", "name": null}}, "url": "https://github.com/apereo/cas/commit/50752572ac61ca19469261e890892db8ffdec594", "committedDate": "2020-02-21T21:57:22Z", "message": "Merge branch 'master' into oidclogoutmaster"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzY0MTI5NTgy", "url": "https://github.com/apereo/cas/pull/4732#pullrequestreview-364129582", "createdAt": "2020-02-25T13:15:13Z", "commit": {"oid": "50752572ac61ca19469261e890892db8ffdec594"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzY1NDgyMDky", "url": "https://github.com/apereo/cas/pull/4732#pullrequestreview-365482092", "createdAt": "2020-02-27T08:15:55Z", "commit": {"oid": "50752572ac61ca19469261e890892db8ffdec594"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yN1QwODoxNTo1NVrOFvIsAA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yN1QwODoxNjoxM1rOFvIsfw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NDk2OTcyOA==", "bodyText": "Please revert this change; it's preferable to not depend on CasProtocolConstants if possible.", "url": "https://github.com/apereo/cas/pull/4732#discussion_r384969728", "createdAt": "2020-02-27T08:15:55Z", "author": {"login": "mmoayyed"}, "path": "api/cas-server-core-api-configuration-model/src/main/java/org/apereo/cas/configuration/model/core/logout/LogoutProperties.java", "diffHunk": "@@ -25,7 +26,7 @@\n      * is indicated and extracted by a parameter name of your choosing here. If none specified,\n      * the default will be used as {@code service}.\n      */\n-    private String redirectParameter;\n+    private String redirectParameter = CasProtocolConstants.PARAMETER_SERVICE;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "50752572ac61ca19469261e890892db8ffdec594"}, "originalPosition": 12}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NDk2OTg1NQ==", "bodyText": "Please revert this; See above.", "url": "https://github.com/apereo/cas/pull/4732#discussion_r384969855", "createdAt": "2020-02-27T08:16:13Z", "author": {"login": "mmoayyed"}, "path": "support/cas-server-support-actions/src/main/java/org/apereo/cas/web/flow/logout/LogoutAction.java", "diffHunk": "@@ -52,7 +51,7 @@ protected Event doInternalExecute(final HttpServletRequest request, final HttpSe\n             () -> Boolean.FALSE)\n             .get();\n \n-        val paramName = StringUtils.defaultIfEmpty(logoutProperties.getRedirectParameter(), CasProtocolConstants.PARAMETER_SERVICE);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "50752572ac61ca19469261e890892db8ffdec594"}, "originalPosition": 11}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "6335cc374e38abf73599179cfdf8b7491a7b859e", "author": {"user": {"login": "julienhuon", "name": "Julien Huon"}}, "url": "https://github.com/apereo/cas/commit/6335cc374e38abf73599179cfdf8b7491a7b859e", "committedDate": "2020-02-27T17:25:05Z", "message": "RedirectParameter defaulted to \"service\"."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzY1OTc4NTQ2", "url": "https://github.com/apereo/cas/pull/4732#pullrequestreview-365978546", "createdAt": "2020-02-27T20:34:10Z", "commit": {"oid": "6335cc374e38abf73599179cfdf8b7491a7b859e"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "75a04755350112a45c1837229e3adf98a026d272", "author": {"user": {"login": "apereocas-bot", "name": null}}, "url": "https://github.com/apereo/cas/commit/75a04755350112a45c1837229e3adf98a026d272", "committedDate": "2020-02-27T23:44:09Z", "message": "Merge branch 'master' into oidclogoutmaster"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "02252e9f951762bf4be2cd18b2e1ae73274491d0", "author": {"user": {"login": "apereocas-bot", "name": null}}, "url": "https://github.com/apereo/cas/commit/02252e9f951762bf4be2cd18b2e1ae73274491d0", "committedDate": "2020-02-28T04:14:11Z", "message": "Merge branch 'master' into oidclogoutmaster"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ce77b9fcff2b6542d27e668d173ab4a4c59cb7d5", "author": {"user": {"login": "apereocas-bot", "name": null}}, "url": "https://github.com/apereo/cas/commit/ce77b9fcff2b6542d27e668d173ab4a4c59cb7d5", "committedDate": "2020-02-28T07:14:06Z", "message": "Merge branch 'master' into oidclogoutmaster"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f46bf82cc62c12c397309236b904f7f78b5b5534", "author": {"user": {"login": "apereocas-bot", "name": null}}, "url": "https://github.com/apereo/cas/commit/f46bf82cc62c12c397309236b904f7f78b5b5534", "committedDate": "2020-02-28T13:14:10Z", "message": "Merge branch 'master' into oidclogoutmaster"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "32f1fc6d60664a3c13a92c03117b2dbc16f17882", "author": {"user": {"login": "apereocas-bot", "name": null}}, "url": "https://github.com/apereo/cas/commit/32f1fc6d60664a3c13a92c03117b2dbc16f17882", "committedDate": "2020-02-28T17:44:06Z", "message": "Merge branch 'master' into oidclogoutmaster"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a1291b3c34e0754e7c7d38723efd48aeb36713f4", "author": {"user": {"login": "apereocas-bot", "name": null}}, "url": "https://github.com/apereo/cas/commit/a1291b3c34e0754e7c7d38723efd48aeb36713f4", "committedDate": "2020-02-28T22:17:27Z", "message": "Merge branch 'master' into oidclogoutmaster"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f1ad6e493b221990460a4222aef598d338cf0eeb", "author": {"user": {"login": "apereocas-bot", "name": null}}, "url": "https://github.com/apereo/cas/commit/f1ad6e493b221990460a4222aef598d338cf0eeb", "committedDate": "2020-02-29T07:17:31Z", "message": "Merge branch 'master' into oidclogoutmaster"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3630, "cost": 1, "resetAt": "2021-11-01T11:59:11Z"}}}