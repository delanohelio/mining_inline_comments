{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTMzMTI4OTc2", "number": 5007, "title": "Make git repository support file: URI prefix for clone-directory and private-key-path", "bodyText": "This adds support for the git clone-directory property to access file path with the file resource prefix, to match documentation. The  privateKeyPath also take a Resource now but the underlying JSch library eventually wants a String path so it would only take a file: type of resource or classpath: type if in file in classpath but not in an archive. File type of resource also only makes sense for clone-directory but that should be obvious.\nI don't understand what is going on with GitServiceRegistryTests.java - There is a \"cas.service-registry.git.repository-url=file:/tmp/cas-sample-data.git\" and it deletes \"/tmp/cas-sample-data\" but I don't think it uses either one? Is that supposed to be a git repo that it clones from and pushes to because it is making the git repo in cas-service-registry and it tries to push somewhere but there is nowhere to push (the tests pass).\nI added a test to GitRepositoryBuilderTests.java to test the Resource usage via file: prefix. The existing test with ssh is doing an assertThrows(IllegalArgumentException... because of an authentication failure but that Exception would be thrown for any type of error so I am not clear on what is being tested. It's also an odd test because it works locally (which means assertThrows fails), presumably b/c the ssh library is using my ssh key (with no password) to authenticate to github.\nI added a new property to turn off host key verification but it defaults to being on as before. I think this could be useful when cloning from internal git repos from CAS running in a container that may not have the host key installed (scenarios where you aren't worried about MITM or DNS hijacking, etc).", "createdAt": "2020-12-06T02:54:18Z", "url": "https://github.com/apereo/cas/pull/5007", "merged": true, "mergeCommit": {"oid": "fc49c113fc0d45bbe71a189b56884cf29fe572a8"}, "closed": true, "closedAt": "2020-12-12T10:29:57Z", "author": {"login": "hdeadman"}, "timelineItems": {"totalCount": 21, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdi4bWWgH2gAyNTMzMTI4OTc2OjgxZWM3ZGY0MDFkMTY3M2JmOWMyY2YyZDBiMDIyODE3ZTE4ZDk1ZWE=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdlSVDNgH2gAyNTMzMTI4OTc2OjIwZTkyZTlmODA5OTU2MzVkODU4NzRjZDMzNzUwYzM2NWZlMWU3MzI=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "81ec7df401d1673bf9c2cf2d0b022817e18d95ea", "author": {"user": {"login": "hdeadman", "name": "Hal Deadman"}}, "url": "https://github.com/apereo/cas/commit/81ec7df401d1673bf9c2cf2d0b022817e18d95ea", "committedDate": "2020-12-04T14:15:13Z", "message": "support resource for git repo"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "899b425220d1a3e61566bb91057b194d9ab0c907", "author": {"user": {"login": "hdeadman", "name": "Hal Deadman"}}, "url": "https://github.com/apereo/cas/commit/899b425220d1a3e61566bb91057b194d9ab0c907", "committedDate": "2020-12-05T18:02:51Z", "message": "support resource for git repo"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "717fe135025edc61cbbe4aa1412f06596b958d88", "author": {"user": {"login": "hdeadman", "name": "Hal Deadman"}}, "url": "https://github.com/apereo/cas/commit/717fe135025edc61cbbe4aa1412f06596b958d88", "committedDate": "2020-12-06T02:32:08Z", "message": "support resource for git repo"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "5a45f558f776bf238baa56a79646b9539f891279", "author": {"user": {"login": "hdeadman", "name": "Hal Deadman"}}, "url": "https://github.com/apereo/cas/commit/5a45f558f776bf238baa56a79646b9539f891279", "committedDate": "2020-12-06T04:07:51Z", "message": "support resource for git repo"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c0c664be583f2ba1536f06881876c463303b562e", "author": {"user": {"login": "hdeadman", "name": "Hal Deadman"}}, "url": "https://github.com/apereo/cas/commit/c0c664be583f2ba1536f06881876c463303b562e", "committedDate": "2020-12-06T04:11:17Z", "message": "checkstyle"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "07eab1c2e81f8bdb0c05e62d4a000076c654af17", "author": {"user": {"login": "hdeadman", "name": "Hal Deadman"}}, "url": "https://github.com/apereo/cas/commit/07eab1c2e81f8bdb0c05e62d4a000076c654af17", "committedDate": "2020-12-06T04:13:46Z", "message": "make Resource transient"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "81ef066c8bbc7b0eaa87ba76ef425e2565702caf", "author": {"user": {"login": "hdeadman", "name": "Hal Deadman"}}, "url": "https://github.com/apereo/cas/commit/81ef066c8bbc7b0eaa87ba76ef425e2565702caf", "committedDate": "2020-12-06T06:08:38Z", "message": "allow turning off strict host checking"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "d953421f165d448aed08ab8d4702d0b0c9d72722", "author": {"user": {"login": "hdeadman", "name": "Hal Deadman"}}, "url": "https://github.com/apereo/cas/commit/d953421f165d448aed08ab8d4702d0b0c9d72722", "committedDate": "2020-12-06T16:21:36Z", "message": "uss https for clone"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "bd1dd2c40b60355648a1eef1cc4f3a228a53c168", "author": {"user": {"login": "hdeadman", "name": "Hal Deadman"}}, "url": "https://github.com/apereo/cas/commit/bd1dd2c40b60355648a1eef1cc4f3a228a53c168", "committedDate": "2020-12-06T16:27:59Z", "message": "uss https for clone"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "26c949bc246fabe23c71ca82b3028ea93fe45ec9", "author": {"user": {"login": "hdeadman", "name": "Hal Deadman"}}, "url": "https://github.com/apereo/cas/commit/26c949bc246fabe23c71ca82b3028ea93fe45ec9", "committedDate": "2020-12-06T16:32:47Z", "message": "add comment"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "64697cbaf187cc4737e56a97b33243ed9727c71e", "author": {"user": {"login": "hdeadman", "name": "Hal Deadman"}}, "url": "https://github.com/apereo/cas/commit/64697cbaf187cc4737e56a97b33243ed9727c71e", "committedDate": "2020-12-06T16:58:09Z", "message": "allow privatekeypath to be resource too"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b7503bfc823e5da0749b2f9b1e211db166a19996", "author": {"user": {"login": "hdeadman", "name": "Hal Deadman"}}, "url": "https://github.com/apereo/cas/commit/b7503bfc823e5da0749b2f9b1e211db166a19996", "committedDate": "2020-12-06T19:06:05Z", "message": "make private key path transient"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "29b8750316e8f160242305bdf84b4a8433fe7c34", "author": {"user": {"login": "hdeadman", "name": "Hal Deadman"}}, "url": "https://github.com/apereo/cas/commit/29b8750316e8f160242305bdf84b4a8433fe7c34", "committedDate": "2020-12-08T04:21:03Z", "message": "increase coverage and support saml repos that end in .git"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTQ3MTA3MzYw", "url": "https://github.com/apereo/cas/pull/5007#pullrequestreview-547107360", "createdAt": "2020-12-08T11:06:54Z", "commit": {"oid": "29b8750316e8f160242305bdf84b4a8433fe7c34"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0wOFQxMTowNjo1NFrOIBUDSA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0wOFQxMTowODoxNFrOIBUGjA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzODI0ODAwOA==", "bodyText": "use SpringResourceProperties", "url": "https://github.com/apereo/cas/pull/5007#discussion_r538248008", "createdAt": "2020-12-08T11:06:54Z", "author": {"login": "mmoayyed"}, "path": "api/cas-server-core-api-configuration-model/src/main/java/org/apereo/cas/configuration/model/support/git/services/BaseGitProperties.java", "diffHunk": "@@ -62,14 +64,16 @@\n     private boolean signCommits;\n \n     /**\n-     * Path to the SSH private key identity.\n+     * Password for the SSH private key.\n      */\n     private String privateKeyPassphrase;\n \n     /**\n-     * Password for the SSH private key.\n+     * Path to the SSH private key identity.\n+     * Must be a resource that can resolve to an absolute file on disk due to Jsch library needing String path.\n+     * Classpath resource would work if file on disk rather than inside archive.\n      */\n-    private File privateKeyPath;\n+    private transient Resource privateKeyPath;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "29b8750316e8f160242305bdf84b4a8433fe7c34"}, "originalPosition": 25}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzODI0ODE3Mg==", "bodyText": "use SpringResourceProperties; initialize the ctor if possible.", "url": "https://github.com/apereo/cas/pull/5007#discussion_r538248172", "createdAt": "2020-12-08T11:07:09Z", "author": {"login": "mmoayyed"}, "path": "api/cas-server-core-api-configuration-model/src/main/java/org/apereo/cas/configuration/model/support/git/services/BaseGitProperties.java", "diffHunk": "@@ -86,5 +96,5 @@\n     /**\n      * Directory into which the repository would be cloned.\n      */\n-    private File cloneDirectory = new File(FileUtils.getTempDirectory(), \"cas-git-clone\");\n+    private transient Resource cloneDirectory = new FileSystemResource(new File(FileUtils.getTempDirectory(), \"cas-git-clone\"));", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "29b8750316e8f160242305bdf84b4a8433fe7c34"}, "originalPosition": 47}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzODI0ODg0NA==", "bodyText": "Move the annotation next to the method name, with comments above it.", "url": "https://github.com/apereo/cas/pull/5007#discussion_r538248844", "createdAt": "2020-12-08T11:08:14Z", "author": {"login": "mmoayyed"}, "path": "support/cas-server-support-git-core/src/test/java/org/apereo/cas/git/GitRepositoryBuilderTests.java", "diffHunk": "@@ -32,16 +34,50 @@\n     private CasConfigurationProperties casProperties;\n \n     @Test", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "29b8750316e8f160242305bdf84b4a8433fe7c34"}, "originalPosition": 15}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "57676185880f8620e2c97948039964115ae64e8c", "author": {"user": {"login": "hdeadman", "name": "Hal Deadman"}}, "url": "https://github.com/apereo/cas/commit/57676185880f8620e2c97948039964115ae64e8c", "committedDate": "2020-12-09T02:55:58Z", "message": "change properties to SpringResourceProperties"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a36cd3c5dc9b9237e13e3121f529ea077b787bdc", "author": {"user": {"login": "hdeadman", "name": "Hal Deadman"}}, "url": "https://github.com/apereo/cas/commit/a36cd3c5dc9b9237e13e3121f529ea077b787bdc", "committedDate": "2020-12-09T03:19:36Z", "message": "change properties to SpringResourceProperties"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "15f4306d5dcc2ac66032add0602c4f933c5416b1", "author": {"user": {"login": "hdeadman", "name": "Hal Deadman"}}, "url": "https://github.com/apereo/cas/commit/15f4306d5dcc2ac66032add0602c4f933c5416b1", "committedDate": "2020-12-10T01:26:08Z", "message": "fix test"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e9eefaf0e77b0d98b2c692b3307bb876b2955029", "author": {"user": {"login": "hdeadman", "name": "Hal Deadman"}}, "url": "https://github.com/apereo/cas/commit/e9eefaf0e77b0d98b2c692b3307bb876b2955029", "committedDate": "2020-12-10T05:03:03Z", "message": "fix test"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c302c9762417e92ce5aca00e6e69d85c1082fe73", "author": {"user": {"login": "hdeadman", "name": "Hal Deadman"}}, "url": "https://github.com/apereo/cas/commit/c302c9762417e92ce5aca00e6e69d85c1082fe73", "committedDate": "2020-12-10T21:02:32Z", "message": "fix test"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "0c952253225de8021a6f5dfa60c3acd127de2bfb", "author": {"user": {"login": "hdeadman", "name": "Hal Deadman"}}, "url": "https://github.com/apereo/cas/commit/0c952253225de8021a6f5dfa60c3acd127de2bfb", "committedDate": "2020-12-11T01:53:48Z", "message": "update tomcat to 9.0.41 b/c CI failing to download"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "20e92e9f80995635d85874cd33750c365fe1e732", "author": {"user": {"login": "hdeadman", "name": "Hal Deadman"}}, "url": "https://github.com/apereo/cas/commit/20e92e9f80995635d85874cd33750c365fe1e732", "committedDate": "2020-12-12T01:33:43Z", "message": "remove extra delete directory"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3552, "cost": 1, "resetAt": "2021-11-01T11:59:11Z"}}}