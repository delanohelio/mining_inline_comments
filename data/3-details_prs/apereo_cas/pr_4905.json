{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDQ4OTQ4MjA2", "number": 4905, "title": "Small enhancements to Syncope auth", "bodyText": "more thorough check for null values\nadd derived and virtual attributes, not just plain\ngenerate attribute names as syncopeUserAttr_userId rather than syncopeUserAttruserId.", "createdAt": "2020-07-14T15:19:06Z", "url": "https://github.com/apereo/cas/pull/4905", "merged": true, "mergeCommit": {"oid": "f0356de7242e618bb135b60affdb3a7bc2d9c96a"}, "closed": true, "closedAt": "2020-07-15T10:23:26Z", "author": {"login": "ilgrosso"}, "timelineItems": {"totalCount": 6, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABc03nAuAH2gAyNDQ4OTQ4MjA2OjBmNmNmNWVhMDY5NjIwOGUzYjU3Y2QxYTY3MDc4OTBlNGQ0ZmQ2ODc=", "endCursor": "Y3Vyc29yOnYyOpPPAAABc1G9csgFqTQ0ODc3MDExOQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "0f6cf5ea0696208e3b57cd1a6707890e4d4fd687", "author": {"user": {"login": "ilgrosso", "name": "Francesco Chicchiricc\u00f2"}}, "url": "https://github.com/apereo/cas/commit/0f6cf5ea0696208e3b57cd1a6707890e4d4fd687", "committedDate": "2020-07-14T15:17:32Z", "message": "Small enhancements to Syncope auth"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f372180f6f3fef5a44826bf9f46c0e1236842d5d", "author": {"user": {"login": "ilgrosso", "name": "Francesco Chicchiricc\u00f2"}}, "url": "https://github.com/apereo/cas/commit/f372180f6f3fef5a44826bf9f46c0e1236842d5d", "committedDate": "2020-07-14T15:33:40Z", "message": "Moving member visibility to public, for external refs"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "2016e4a869bc8a57d00fc23a2eea2c058df92588", "author": {"user": {"login": "ilgrosso", "name": "Francesco Chicchiricc\u00f2"}}, "url": "https://github.com/apereo/cas/commit/2016e4a869bc8a57d00fc23a2eea2c058df92588", "committedDate": "2020-07-15T06:32:02Z", "message": "Merge remote-tracking branch 'upstream/master' into SYNCOPE_AUTH_ENHANCEMENTS"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDQ4NzA2NjAz", "url": "https://github.com/apereo/cas/pull/4905#pullrequestreview-448706603", "createdAt": "2020-07-15T07:44:19Z", "commit": {"oid": "2016e4a869bc8a57d00fc23a2eea2c058df92588"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xNVQwNzo0NDoxOVrOGxyO6w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xNVQwNzo0NToxM1rOGxyQzA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NDg1NjQyNw==", "bodyText": "Since we are now making this public (and the ones below),\n\nYou should likely add a bit of Javadoc here. (Checkstyle is probably mad at this line already)\nIt would make better sense to me to rename these as ALLOWED_CLAIMS to stick with the accepted jargon though there is the getter below that cannot be changed. So, your call.", "url": "https://github.com/apereo/cas/pull/4905#discussion_r454856427", "createdAt": "2020-07-15T07:44:19Z", "author": {"login": "mmoayyed"}, "path": "support/cas-server-support-oidc-core/src/main/java/org/apereo/cas/oidc/claims/OidcAddressScopeAttributeReleasePolicy.java", "diffHunk": "@@ -17,11 +15,11 @@\n public class OidcAddressScopeAttributeReleasePolicy extends BaseOidcScopeAttributeReleasePolicy {\n     private static final long serialVersionUID = 1532960981124784595L;\n \n-    private List<String> allowedAttributes = Stream.of(\"address\").collect(Collectors.toList());\n+    public static final List<String> ALLOWED_ATTRIBUTES = List.of(\"address\");", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "2016e4a869bc8a57d00fc23a2eea2c058df92588"}, "originalPosition": 14}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NDg1NjkwOA==", "bodyText": "This is all excellent. For all new lines, you should additionally modify the related test for the handler to make sure these are covered.", "url": "https://github.com/apereo/cas/pull/4905#discussion_r454856908", "createdAt": "2020-07-15T07:45:13Z", "author": {"login": "mmoayyed"}, "path": "support/cas-server-support-syncope-authentication/src/main/java/org/apereo/cas/syncope/authentication/SyncopeAuthenticationHandler.java", "diffHunk": "@@ -124,14 +117,24 @@ public SyncopeAuthenticationHandler(final String name,\n \n         if (user.has(\"relationships\")) {\n             user.get(\"relationships\").forEach(r -> attributes.put(\n-                \"syncopeUserRelationships\" + r.get(\"type\").asText(),\n-                List.of(r.get(\"otherEndName\").asText())));\n+                    \"syncopeUserRelationships\" + r.get(\"type\").asText(),\n+                    List.of(r.get(\"otherEndName\").asText())));\n         }\n \n         if (user.has(\"plainAttrs\")) {\n             user.get(\"plainAttrs\").forEach(a -> attributes.put(\n-                \"syncopeUserAttr\" + a.get(\"schema\").asText(),\n-                MAPPER.convertValue(a.get(\"values\"), ArrayList.class)));\n+                    \"syncopeUserAttr_\" + a.get(\"schema\").asText(),\n+                    MAPPER.convertValue(a.get(\"values\"), ArrayList.class)));\n+        }\n+        if (user.has(\"derAttrs\")) {\n+            user.get(\"derAttrs\").forEach(a -> attributes.put(\n+                    \"syncopeUserAttr_\" + a.get(\"schema\").asText(),\n+                    MAPPER.convertValue(a.get(\"values\"), ArrayList.class)));\n+        }\n+        if (user.has(\"virAttrs\")) {\n+            user.get(\"virAttrs\").forEach(a -> attributes.put(\n+                    \"syncopeUserAttr_\" + a.get(\"schema\").asText(),\n+                    MAPPER.convertValue(a.get(\"values\"), ArrayList.class)));", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "2016e4a869bc8a57d00fc23a2eea2c058df92588"}, "originalPosition": 95}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "788bfec75dd2d9ca1032544c2a3e0a3d6bb46783", "author": {"user": {"login": "ilgrosso", "name": "Francesco Chicchiricc\u00f2"}}, "url": "https://github.com/apereo/cas/commit/788bfec75dd2d9ca1032544c2a3e0a3d6bb46783", "committedDate": "2020-07-15T08:06:02Z", "message": "Addressing review comments"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDQ4NzcwMTE5", "url": "https://github.com/apereo/cas/pull/4905#pullrequestreview-448770119", "createdAt": "2020-07-15T09:10:37Z", "commit": {"oid": "788bfec75dd2d9ca1032544c2a3e0a3d6bb46783"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3561, "cost": 1, "resetAt": "2021-11-01T11:59:11Z"}}}