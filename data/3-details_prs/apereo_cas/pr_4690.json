{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0MzczNTMxODAx", "number": 4690, "title": "Fix PM + SPNEGO supports", "bodyText": "If you enable SPNEGO (cas-server-support-spnego-webflow) and password management (by default),  the password management no longer works.\nIn the PasswordManagementWebflowConfigurer, the password management webflow is inserted on the success transition of the initializeLoginForm state.\nIn the SpengoWebflowConfigurer, the transition on success from the initializeLoginForm state is replaced by the Spnego mechanism and the viewLoginForm state is finally \"restored\".\nSo if the PM is loaded before the SPNEGO, we have initializeLoginForm -> SPNEGO -> viewLoginForm then initializeLoginForm -> PM -> initializeLoginForm, so the PM is never triggered. While it works the other way: initializeLoginForm -> PM -> initializeLoginForm -> SPNEGO -> viewLoginForm.\nThis PR forces the SPNEGO webflow configuration to be called before the PM webflow configuration.", "createdAt": "2020-02-11T08:39:39Z", "url": "https://github.com/apereo/cas/pull/4690", "merged": true, "mergeCommit": {"oid": "58473c4d34922044c45acfdf1df4318676e94b6d"}, "closed": true, "closedAt": "2020-02-11T15:51:59Z", "author": {"login": "leleuj"}, "timelineItems": {"totalCount": 6, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcDNXZzgH2gAyMzczNTMxODAxOmVjOTJjODMxOGNiYWVjNjZkMTEzYzQ5YmZkNDc2YmRjY2FjNjI2MGE=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcDSwfvgH2gAyMzczNTMxODAxOmE0OTgzMDFhZDQ3MzkzODA4NjQ1ZDE1MGZmNmE5YTAyNzdmNWQ0MGE=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "ec92c8318cbaec66d113c49bfd476bdccac6260a", "author": {"user": {"login": "leleuj", "name": "CAS in the cloud LELEU J\u00e9r\u00f4me"}}, "url": "https://github.com/apereo/cas/commit/ec92c8318cbaec66d113c49bfd476bdccac6260a", "committedDate": "2020-02-11T08:22:11Z", "message": "Fix PM + SPNEGO supports"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzU2NTIxODkz", "url": "https://github.com/apereo/cas/pull/4690#pullrequestreview-356521893", "createdAt": "2020-02-11T09:49:30Z", "commit": {"oid": "ec92c8318cbaec66d113c49bfd476bdccac6260a"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xMVQwOTo0OTozMFrOFoCmUQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xMVQwOTo0OTozMFrOFoCmUQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NzUyOTkzNw==", "bodyText": "You should try to switch this to compileOnly. Leaking the PM module statically for those who run SPNEGO who might have no use for PM is not a good idea. The reference should only be done for compile-time, by a class-name reference or you actually can order webflow configurers IIRC so one executes before the other without changes to the source code.", "url": "https://github.com/apereo/cas/pull/4690#discussion_r377529937", "createdAt": "2020-02-11T09:49:30Z", "author": {"login": "mmoayyed"}, "path": "support/cas-server-support-spnego-webflow/build.gradle", "diffHunk": "@@ -11,6 +11,7 @@ dependencies {\n     implementation project(\":core:cas-server-core-services-api\")\n     implementation project(\":support:cas-server-support-spnego\")\n     implementation project(\":support:cas-server-support-ldap-core\")\n+    implementation project(\":support:cas-server-support-pm-webflow\")", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ec92c8318cbaec66d113c49bfd476bdccac6260a"}, "originalPosition": 4}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "5d3964fe086cb05d8dddbc320410b78ca79e12de", "author": {"user": {"login": "leleuj", "name": "CAS in the cloud LELEU J\u00e9r\u00f4me"}}, "url": "https://github.com/apereo/cas/commit/5d3964fe086cb05d8dddbc320410b78ca79e12de", "committedDate": "2020-02-11T10:56:07Z", "message": "use getOrder()"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzU2NTgxMTA2", "url": "https://github.com/apereo/cas/pull/4690#pullrequestreview-356581106", "createdAt": "2020-02-11T11:24:26Z", "commit": {"oid": "5d3964fe086cb05d8dddbc320410b78ca79e12de"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xMVQxMToyNDoyNlrOFoFcfA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xMVQxMToyNDoyNlrOFoFcfA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NzU3NjU3Mg==", "bodyText": "This is a good start, but I think rather than hardcoding the order, you should expose the order property in CAS settings and then configure it as you wish. Hardcoding the order is more or less the same as handling the auto-configuration order in a hardcoded way.", "url": "https://github.com/apereo/cas/pull/4690#discussion_r377576572", "createdAt": "2020-02-11T11:24:26Z", "author": {"login": "mmoayyed"}, "path": "support/cas-server-support-pm-webflow/src/main/java/org/apereo/cas/pm/web/flow/PasswordManagementWebflowConfigurer.java", "diffHunk": "@@ -55,6 +56,7 @@ public PasswordManagementWebflowConfigurer(final FlowBuilderServices flowBuilder\n                                                final Action initPasswordChangeAction) {\n         super(flowBuilderServices, loginFlowDefinitionRegistry, applicationContext, casProperties);\n         this.initPasswordChangeAction = initPasswordChangeAction;\n+        setOrder(WebflowConfigurersOrder.PM);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "5d3964fe086cb05d8dddbc320410b78ca79e12de"}, "originalPosition": 12}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "5ff388a7312140a21504d1f5e7167b4d8c9d1704", "author": {"user": {"login": "leleuj", "name": "CAS in the cloud LELEU J\u00e9r\u00f4me"}}, "url": "https://github.com/apereo/cas/commit/5ff388a7312140a21504d1f5e7167b4d8c9d1704", "committedDate": "2020-02-11T13:34:02Z", "message": "make webflow order configurable and fix typo on the spnego webflow configurer name"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a498301ad47393808645d150ff6a9a0277f5d40a", "author": {"user": {"login": "leleuj", "name": "CAS in the cloud LELEU J\u00e9r\u00f4me"}}, "url": "https://github.com/apereo/cas/commit/a498301ad47393808645d150ff6a9a0277f5d40a", "committedDate": "2020-02-11T14:39:07Z", "message": "use a nested property"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3676, "cost": 1, "resetAt": "2021-11-01T11:59:11Z"}}}