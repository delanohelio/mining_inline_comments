{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTI0MjY5NTM1", "number": 4984, "title": "[OAuth/OIDC] Support of the Authorization Requests Errors", "bodyText": "Hello Misagh,\nThe main goal of this PR is to have a better support of the Authorization Error Responses defined in the 4.1.2.1 and the 4.2.2.1 chapters of the OAuth Protocol.\nNowadays, when the OAuth/OIDC authorization request is invalid, CAS only response is the classic Unauthorized Client Error View. Moreover, the validation is done in the OAuth Handler Interceptor (to avoid to request authentication for an invalid request) and in the OAuth Authorization Endpoint (to produce the error view).\nHere the new workflow :\n\nThe validation is done in the OAuth Handler Interceptor\nThe OAuth Authorization Request Validators set the error and the error_description in the JEEContext's attributes.\nThe OAuth Authorization Endpoint check if an error attribute exists in the JEEContext instead of re-run the validators. If it does, it call the new OAuth Invalid Authorization Request response builder.\nThe Invalid Authorization Request response builder will:\n\nStill produce the unauthorized client error when a callback is impossible (absent or invalid client_id, absent or invalid redirect_uri). I'll produce a new PR to improve this later (all the required elements are in the request attributes)\nRedirect the user-agent to the redirect_uri  with the \"request_not_supported\" error code if the OIDC request parameter is used (Will move this in the futures OIDC Authorization Request Validators in #4980 after the merge of this PR).\nRedirect the user-agent to the redirect_uri with the \"unsupported_response_type\" error code when the response_type is missing or invalid\nRedirect the user-agent to the redirect_uri with the \"unauthorized_client\" error code when the response_type not authorized for the client\n\n\n\nI'll write all the tests needed after your review if you don't mind. I want to known if the approach is ok for you.\nThis PR will allow CAS to success the oidcc-response-type-missing test from the OpenID Connect certification program.\nRegards,\nJulien", "createdAt": "2020-11-19T22:18:13Z", "url": "https://github.com/apereo/cas/pull/4984", "merged": true, "mergeCommit": {"oid": "a76f1ac8934ee716910445aebbec67289119ee23"}, "closed": true, "closedAt": "2020-12-30T09:51:45Z", "author": {"login": "julienhuon"}, "timelineItems": {"totalCount": 42, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdeJS4eAH2gAyNTI0MjY5NTM1OmI2NTEyZWVjMzVlNTU0MGMyMDIyNGM4NjU2NzY5MjBlMWU0ZGJhM2Y=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdrLF70gFqTU1OTk1MjgyOA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "b6512eec35e5540c20224c865676920e1e4dba3f", "author": {"user": {"login": "julienhuon", "name": "Julien Huon"}}, "url": "https://github.com/apereo/cas/commit/b6512eec35e5540c20224c865676920e1e4dba3f", "committedDate": "2020-11-19T21:04:44Z", "message": "Add new OAuth constants."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "86a8c1409716f369545a8af01385f146bc33cad9", "author": {"user": {"login": "julienhuon", "name": "Julien Huon"}}, "url": "https://github.com/apereo/cas/commit/86a8c1409716f369545a8af01385f146bc33cad9", "committedDate": "2020-11-19T21:06:03Z", "message": "Add a new OAuth Authorization response builder dedicated to invalid requests."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "994a8cb64eb27ac7d700913fb1d94d49852bc9ff", "author": {"user": {"login": "julienhuon", "name": "Julien Huon"}}, "url": "https://github.com/apereo/cas/commit/994a8cb64eb27ac7d700913fb1d94d49852bc9ff", "committedDate": "2020-11-19T21:06:54Z", "message": "Add a new OAuth Authorization request validator dedicated for requests with a missing or an invalid Response type."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "7e4655b783560899157338da479f9976a7f7ce2a", "author": {"user": {"login": "julienhuon", "name": "Julien Huon"}}, "url": "https://github.com/apereo/cas/commit/7e4655b783560899157338da479f9976a7f7ce2a", "committedDate": "2020-11-19T21:08:03Z", "message": "Add the new request validator and the new response builder to the configuration"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "9b7694f4c59911cd2d1c1ef9a956be28015c954f", "author": {"user": {"login": "julienhuon", "name": "Julien Huon"}}, "url": "https://github.com/apereo/cas/commit/9b7694f4c59911cd2d1c1ef9a956be28015c954f", "committedDate": "2020-11-19T21:10:21Z", "message": "The Request Validator is now fill the context with the errors informations."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e189d6b1872aa1c8bd48d3c77b4fc5dd3b8bd515", "author": {"user": {"login": "julienhuon", "name": "Julien Huon"}}, "url": "https://github.com/apereo/cas/commit/e189d6b1872aa1c8bd48d3c77b4fc5dd3b8bd515", "committedDate": "2020-11-19T21:11:41Z", "message": "The Authorize Endpoint is now using the context error informations instead of a double check (the check is done by the Handler Interceptor)"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "6b67f8f63251d36ae7971477b0e805c6a11d39a6", "author": {"user": {"login": "julienhuon", "name": "Julien Huon"}}, "url": "https://github.com/apereo/cas/commit/6b67f8f63251d36ae7971477b0e805c6a11d39a6", "committedDate": "2020-11-19T21:20:42Z", "message": "Fix Missing or Invalid validator"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "520f1daf982bb14c01864ec1bd9aafca84fd2f25", "author": {"user": {"login": "julienhuon", "name": "Julien Huon"}}, "url": "https://github.com/apereo/cas/commit/520f1daf982bb14c01864ec1bd9aafca84fd2f25", "committedDate": "2020-11-19T21:28:41Z", "message": "Fix Warning log in the OAuth Autorization validator"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "52f3196a2d9dc8bfb2d273b19e5bfd0d5b034803", "author": {"user": {"login": "julienhuon", "name": "Julien Huon"}}, "url": "https://github.com/apereo/cas/commit/52f3196a2d9dc8bfb2d273b19e5bfd0d5b034803", "committedDate": "2020-11-19T21:51:26Z", "message": "Invalid response should not contains nonce parameter even if the request does [OIDC 3.1.2.6]"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c771bb83d9a19e4e69ec366a840faeb5d3a16ffa", "author": {"user": {"login": "julienhuon", "name": "Julien Huon"}}, "url": "https://github.com/apereo/cas/commit/c771bb83d9a19e4e69ec366a840faeb5d3a16ffa", "committedDate": "2020-11-19T21:51:41Z", "message": "Missing response_type is now supported in the authorization request validator"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "43145420e1cc2444f7e54b2adf82d905ef0842a8", "author": {"user": {"login": "julienhuon", "name": "Julien Huon"}}, "url": "https://github.com/apereo/cas/commit/43145420e1cc2444f7e54b2adf82d905ef0842a8", "committedDate": "2020-11-19T22:09:32Z", "message": "Just to be sure the Error attribute will always be in the context"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "3f4e5ba78f839c1afa8634a25fafa8890a150b4a", "author": {"user": {"login": "julienhuon", "name": "Julien Huon"}}, "url": "https://github.com/apereo/cas/commit/3f4e5ba78f839c1afa8634a25fafa8890a150b4a", "committedDate": "2020-11-19T23:06:49Z", "message": "Remove unused constant"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f5cd82c9fc9d7b185f4424d4900ebc9e9ff60bf3", "author": {"user": {"login": "julienhuon", "name": "Julien Huon"}}, "url": "https://github.com/apereo/cas/commit/f5cd82c9fc9d7b185f4424d4900ebc9e9ff60bf3", "committedDate": "2020-11-21T22:15:07Z", "message": "Add tests for OAuth HandlerInterceptor & OAuth Invalid Reponse builder"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "bc7bfb622ebb8eda2610bfebbe76ae4dcc8cf8d9", "author": {"user": {"login": "julienhuon", "name": "Julien Huon"}}, "url": "https://github.com/apereo/cas/commit/bc7bfb622ebb8eda2610bfebbe76ae4dcc8cf8d9", "committedDate": "2020-11-21T22:31:09Z", "message": "Removed Unused Imports."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c5ed5c45a85672703df11e029fb0ebbe1966e1c7", "author": {"user": {"login": "julienhuon", "name": "Julien Huon"}}, "url": "https://github.com/apereo/cas/commit/c5ed5c45a85672703df11e029fb0ebbe1966e1c7", "committedDate": "2020-11-21T23:42:10Z", "message": "Removed useless import"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "9a8e544b35e68e84397fdada3d784f991edf3aa7", "author": {"user": {"login": "julienhuon", "name": "Julien Huon"}}, "url": "https://github.com/apereo/cas/commit/9a8e544b35e68e84397fdada3d784f991edf3aa7", "committedDate": "2020-11-22T00:05:29Z", "message": "Import order"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "dce400599a7e12f3001cb58bfec16108f79c697b", "author": {"user": {"login": "julienhuon", "name": "Julien Huon"}}, "url": "https://github.com/apereo/cas/commit/dce400599a7e12f3001cb58bfec16108f79c697b", "committedDate": "2020-11-22T09:33:49Z", "message": "Useless since we do have a validator missing or invalid response type."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f58176f4e930945432503fa40465a9088e1b6999", "author": {"user": {"login": "julienhuon", "name": "Julien Huon"}}, "url": "https://github.com/apereo/cas/commit/f58176f4e930945432503fa40465a9088e1b6999", "committedDate": "2020-11-22T11:07:29Z", "message": "Add Authorization Validator tests"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "2d74da2e2b4c3ae34c89f9de886639fc395a7362", "author": {"user": {"login": "julienhuon", "name": "Julien Huon"}}, "url": "https://github.com/apereo/cas/commit/2d74da2e2b4c3ae34c89f9de886639fc395a7362", "committedDate": "2020-11-22T13:46:18Z", "message": "rollback & cleanup"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "f9e8c1b41991dd46f546926b5e6a297a2c33fafa", "author": {"user": {"login": "julienhuon", "name": "Julien Huon"}}, "url": "https://github.com/apereo/cas/commit/f9e8c1b41991dd46f546926b5e6a297a2c33fafa", "committedDate": "2020-11-22T12:59:12Z", "message": "Useless warn log"}, "afterCommit": {"oid": "2d74da2e2b4c3ae34c89f9de886639fc395a7362", "author": {"user": {"login": "julienhuon", "name": "Julien Huon"}}, "url": "https://github.com/apereo/cas/commit/2d74da2e2b4c3ae34c89f9de886639fc395a7362", "committedDate": "2020-11-22T13:46:18Z", "message": "rollback & cleanup"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a9b15f87b82077f51aff73ea057bad355dc54d55", "author": {"user": {"login": "julienhuon", "name": "Julien Huon"}}, "url": "https://github.com/apereo/cas/commit/a9b15f87b82077f51aff73ea057bad355dc54d55", "committedDate": "2020-11-22T14:54:00Z", "message": "Add Authorize Endpoint Test"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e18c7de3d96d4468293a2b9b773dfdeb5a890cd9", "author": {"user": {"login": "mmoayyed", "name": "Misagh Moayyed"}}, "url": "https://github.com/apereo/cas/commit/e18c7de3d96d4468293a2b9b773dfdeb5a890cd9", "committedDate": "2020-11-24T10:45:03Z", "message": "Merge branch 'master' into oauthAuthorize"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTM3NTEzNDYx", "url": "https://github.com/apereo/cas/pull/4984#pullrequestreview-537513461", "createdAt": "2020-11-24T13:55:30Z", "commit": {"oid": "e18c7de3d96d4468293a2b9b773dfdeb5a890cd9"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0yNFQxMzo1NTozMFrOH5B66Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0yNFQxMzo1NjozN1rOH5B-Eg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyOTU2MjM0NQ==", "bodyText": "Should this really be a public method?", "url": "https://github.com/apereo/cas/pull/4984#discussion_r529562345", "createdAt": "2020-11-24T13:55:30Z", "author": {"login": "mmoayyed"}, "path": "support/cas-server-support-oauth-core-api/src/main/java/org/apereo/cas/support/oauth/validator/authorization/OAuth20AuthorizationCodeResponseTypeAuthorizationRequestValidator.java", "diffHunk": "@@ -83,16 +82,85 @@ public boolean validate(final JEEContext context) {\n \n         if (accessResult.isExecutionFailure()) {\n             LOGGER.warn(\"Registered service [{}] is not found or is not authorized for access.\", registeredService);\n+\n+            setErrorDetails(context,\n+                OAuth20Constants.INVALID_REQUEST,\n+                StringUtils.EMPTY,\n+                false);\n+\n             return false;\n         }\n \n-        val redirectUri = request.getParameter(OAuth20Constants.REDIRECT_URI);\n         if (!OAuth20Utils.checkCallbackValid(registeredService, redirectUri)) {\n             LOGGER.warn(\"Callback URL [{}] is not authorized for registered service [{}].\", redirectUri, registeredService);\n+\n+            setErrorDetails(context,\n+                OAuth20Constants.INVALID_REQUEST,\n+                StringUtils.EMPTY,\n+                false);\n+\n+            return false;\n+        }\n+\n+        val authnRequest = request.getParameter(OAuth20Constants.REQUEST);\n+        if (StringUtils.isNotBlank(authnRequest)) {\n+            LOGGER.warn(\"Self-contained authentication requests as JWTs are not accepted\");\n+\n+            setErrorDetails(context,\n+                OAuth20Constants.REQUEST_NOT_SUPPORTED,\n+                StringUtils.EMPTY,\n+                true);\n+\n+            return false;\n+        }\n+\n+        val responseType = request.getParameter(OAuth20Constants.RESPONSE_TYPE);\n+        if (StringUtils.isBlank(responseType)) {\n+            setErrorDetails(context,\n+                OAuth20Constants.UNSUPPORTED_RESPONSE_TYPE,\n+                String.format(\"Missing required parameter: [%s]\", OAuth20Constants.RESPONSE_TYPE),\n+                true);\n+\n+            return false;\n+        }\n+\n+        if (!OAuth20Utils.checkResponseTypes(responseType, OAuth20ResponseTypes.values())) {\n+            LOGGER.warn(\"Response type [{}] is not found in the list of supported values [{}].\",\n+                responseType, OAuth20ResponseTypes.values());\n+\n+            setErrorDetails(context,\n+                OAuth20Constants.UNSUPPORTED_RESPONSE_TYPE,\n+                String.format(\"Unsupported response_type: [%s]\", responseType),\n+                true);\n+\n+            return false;\n+        }\n+\n+        if (!OAuth20Utils.isAuthorizedResponseTypeForService(context, registeredService)) {\n+            setErrorDetails(context,\n+                OAuth20Constants.UNAUTHORIZED_CLIENT,\n+                String.format(\"Client is not allowed to use the [%s] response_type\", responseType),\n+                true);\n+\n             return false;\n         }\n \n-        return OAuth20Utils.isAuthorizedResponseTypeForService(context, registeredService);\n+        return true;\n+    }\n+\n+    /**\n+     * Set the OAuth Error details in the context.\n+     *\n+     * @param context the context\n+     * @param error the OAuth error\n+     * @param errorDescription the OAuth error description\n+     * @param errorWithCallBack does the error will redirect the end-user to the client\n+     */\n+    public void setErrorDetails(final JEEContext context, final String error,", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "e18c7de3d96d4468293a2b9b773dfdeb5a890cd9"}, "originalPosition": 145}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyOTU2MzE1NA==", "bodyText": "The class name seems rather odd to me. How about OAuth20ResponseTypeAuthorizationRequestValidator instead? You're validating the response type, and the validator contains a number of checks. Those checks don't need to be advertised in the class name.", "url": "https://github.com/apereo/cas/pull/4984#discussion_r529563154", "createdAt": "2020-11-24T13:56:37Z", "author": {"login": "mmoayyed"}, "path": "support/cas-server-support-oauth-core-api/src/main/java/org/apereo/cas/support/oauth/validator/authorization/OAuth20MissingOrInvalidResponseTypeAuthorizationRequestValidator.java", "diffHunk": "@@ -0,0 +1,35 @@\n+package org.apereo.cas.support.oauth.validator.authorization;\n+\n+import org.apereo.cas.audit.AuditableExecution;\n+import org.apereo.cas.authentication.principal.ServiceFactory;\n+import org.apereo.cas.authentication.principal.WebApplicationService;\n+import org.apereo.cas.services.ServicesManager;\n+import org.apereo.cas.support.oauth.OAuth20Constants;\n+import org.apereo.cas.support.oauth.OAuth20ResponseTypes;\n+import org.apereo.cas.support.oauth.util.OAuth20Utils;\n+\n+import lombok.val;\n+import org.apache.commons.lang3.StringUtils;\n+import org.pac4j.core.context.JEEContext;\n+\n+/**\n+ * This is {@link OAuth20MissingOrInvalidResponseTypeAuthorizationRequestValidator}.\n+ *\n+ * @author Julien Huon\n+ * @since 6.3.0\n+ */\n+public class OAuth20MissingOrInvalidResponseTypeAuthorizationRequestValidator extends OAuth20AuthorizationCodeResponseTypeAuthorizationRequestValidator {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "e18c7de3d96d4468293a2b9b773dfdeb5a890cd9"}, "originalPosition": 21}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "20fd72b600f72570bb3b5205068e0b2538bfccde", "author": {"user": {"login": "julienhuon", "name": "Julien Huon"}}, "url": "https://github.com/apereo/cas/commit/20fd72b600f72570bb3b5205068e0b2538bfccde", "committedDate": "2020-11-24T21:17:14Z", "message": "setErrorDetails is now protected instead of public"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b5c55a3432a5ae421de83b90cb8236af1b6b4f48", "author": {"user": {"login": "julienhuon", "name": "Julien Huon"}}, "url": "https://github.com/apereo/cas/commit/b5c55a3432a5ae421de83b90cb8236af1b6b4f48", "committedDate": "2020-11-25T19:19:41Z", "message": "Merge branch 'master' into oauthAuthorize"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "198bb9e525a74a0b5b97e8fd29ed2b4f2abe5f1c", "author": {"user": {"login": "julienhuon", "name": "Julien Huon"}}, "url": "https://github.com/apereo/cas/commit/198bb9e525a74a0b5b97e8fd29ed2b4f2abe5f1c", "committedDate": "2020-11-25T22:30:09Z", "message": "Improve coverage on oauth authorization validators"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "cc43bdc983635c45003d24f5a2e1d5d964a0dc94", "author": {"user": {"login": "julienhuon", "name": "Julien Huon"}}, "url": "https://github.com/apereo/cas/commit/cc43bdc983635c45003d24f5a2e1d5d964a0dc94", "committedDate": "2020-11-26T00:20:38Z", "message": "cleanup"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "55ef2733e43053cb09ade2a3d0d3baf78b80d1a4", "author": {"user": {"login": "julienhuon", "name": "Julien Huon"}}, "url": "https://github.com/apereo/cas/commit/55ef2733e43053cb09ade2a3d0d3baf78b80d1a4", "committedDate": "2020-11-27T18:36:10Z", "message": "Merge branch 'master' into oauthAuthorize"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "380aee5e463f8a69996b259f56284ea7d5ef44ab", "author": {"user": {"login": "julienhuon", "name": "Julien Huon"}}, "url": "https://github.com/apereo/cas/commit/380aee5e463f8a69996b259f56284ea7d5ef44ab", "committedDate": "2020-11-27T22:25:43Z", "message": "Cleanup code: abstract class BaseOAuth20AuthorizationRequestValidator creation instead of the OAuth20MissingOrInvalidResponseTypeAuthorizationRequestValidator class."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "1d68d4a7293ae1b19aad5326960a15f2f6014939", "author": {"user": {"login": "julienhuon", "name": "Julien Huon"}}, "url": "https://github.com/apereo/cas/commit/1d68d4a7293ae1b19aad5326960a15f2f6014939", "committedDate": "2020-11-28T11:54:36Z", "message": "bug fix (useless since the new abstract class design)"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "076c72ee4b2f66612105bcbd6981a3ffeee6fd54", "author": {"user": {"login": "julienhuon", "name": "Julien Huon"}}, "url": "https://github.com/apereo/cas/commit/076c72ee4b2f66612105bcbd6981a3ffeee6fd54", "committedDate": "2020-11-28T12:53:24Z", "message": "Merge branch 'master' into oauthAuthorize"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTQxOTMyNjc2", "url": "https://github.com/apereo/cas/pull/4984#pullrequestreview-541932676", "createdAt": "2020-12-01T14:13:45Z", "commit": {"oid": "076c72ee4b2f66612105bcbd6981a3ffeee6fd54"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0wMVQxNDoxMzo0NVrOH8ubGg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0wMVQxNDoxMzo0NVrOH8ubGg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMzQzNzIxMA==", "bodyText": "This is not helpful. You need to, if you really want to, explain exactly what failed and how; the message here is very generic and it confuses more than it helps. If you don't have enough information to explain things, remove the line, specially if the error is tracked in logs via some other component.", "url": "https://github.com/apereo/cas/pull/4984#discussion_r533437210", "createdAt": "2020-12-01T14:13:45Z", "author": {"login": "mmoayyed"}, "path": "support/cas-server-support-oauth-core-api/src/main/java/org/apereo/cas/support/oauth/web/endpoints/OAuth20AuthorizeEndpointController.java", "diffHunk": "@@ -62,9 +63,13 @@ public ModelAndView handleRequest(final HttpServletRequest request,\n         val context = new JEEContext(request, response, getOAuthConfigurationContext().getSessionStore());\n         val manager = new ProfileManager<CommonProfile>(context, context.getSessionStore());\n \n-        if (!verifyAuthorizeRequest(context) || !isRequestAuthenticated(manager)) {\n-            LOGGER.error(\"Authorize request verification failed. Authorization request is missing required parameters, \"\n-                + \"or the request is not authenticated and contains no authenticated profile/principal.\");\n+        if (context.getRequestAttribute(OAuth20Constants.ERROR).isPresent()) {\n+            LOGGER.error(\"Authorize request verification failed\");", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "076c72ee4b2f66612105bcbd6981a3ffeee6fd54"}, "originalPosition": 18}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "bdd696d3d1b3f7a95d2b37f8d506d879ddb6722e", "author": {"user": {"login": "julienhuon", "name": "Julien Huon"}}, "url": "https://github.com/apereo/cas/commit/bdd696d3d1b3f7a95d2b37f8d506d879ddb6722e", "committedDate": "2020-12-01T20:13:26Z", "message": "Removed useless error message & update since annotation"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "971d517f6b5fa6928a1674ff2ffb1f0a73d32252", "author": {"user": {"login": "julienhuon", "name": "Julien Huon"}}, "url": "https://github.com/apereo/cas/commit/971d517f6b5fa6928a1674ff2ffb1f0a73d32252", "committedDate": "2020-12-05T21:09:52Z", "message": "Merge branch 'master' into oauthAuthorize"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ddaeaaa39668980dd22100381e7d252d2d32ef90", "author": {"user": {"login": "julienhuon", "name": "Julien Huon"}}, "url": "https://github.com/apereo/cas/commit/ddaeaaa39668980dd22100381e7d252d2d32ef90", "committedDate": "2020-12-12T15:55:00Z", "message": "Merge branch 'master' into oauthAuthorize"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "21c8a90ab2c31e4a778636dcc63658441c3f7963", "author": {"user": {"login": "julienhuon", "name": "Julien Huon"}}, "url": "https://github.com/apereo/cas/commit/21c8a90ab2c31e4a778636dcc63658441c3f7963", "committedDate": "2020-12-19T21:59:35Z", "message": "Merge branch 'master' into oauthAuthorize"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "e3b2a91406130fbcae14519d6e54f0f9f841cedd", "author": {"user": {"login": "julienhuon", "name": "Julien Huon"}}, "url": "https://github.com/apereo/cas/commit/e3b2a91406130fbcae14519d6e54f0f9f841cedd", "committedDate": "2020-12-20T14:17:36Z", "message": "Unused method"}, "afterCommit": {"oid": "e6e26c611fa06db41a6082b260662dbf25276e11", "author": {"user": {"login": "julienhuon", "name": "Julien Huon"}}, "url": "https://github.com/apereo/cas/commit/e6e26c611fa06db41a6082b260662dbf25276e11", "committedDate": "2020-12-20T20:57:38Z", "message": "Fix oauth authorize endpoint"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e6e26c611fa06db41a6082b260662dbf25276e11", "author": {"user": {"login": "julienhuon", "name": "Julien Huon"}}, "url": "https://github.com/apereo/cas/commit/e6e26c611fa06db41a6082b260662dbf25276e11", "committedDate": "2020-12-20T20:57:38Z", "message": "Fix oauth authorize endpoint"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f6191836ec413082cf221245c2bdcda7c77692ce", "author": {"user": {"login": "julienhuon", "name": "Julien Huon"}}, "url": "https://github.com/apereo/cas/commit/f6191836ec413082cf221245c2bdcda7c77692ce", "committedDate": "2020-12-29T14:06:09Z", "message": "Merge branch 'master' into oauthAuthorize"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "62073e73ee121909300155a986703e8c7d11f797", "author": {"user": {"login": "julienhuon", "name": "Julien Huon"}}, "url": "https://github.com/apereo/cas/commit/62073e73ee121909300155a986703e8c7d11f797", "committedDate": "2020-12-29T15:14:50Z", "message": "Improve coverage"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "914649eeb937edd1056b7b1b3c9d23bb0b1ab51b", "author": {"user": {"login": "julienhuon", "name": "Julien Huon"}}, "url": "https://github.com/apereo/cas/commit/914649eeb937edd1056b7b1b3c9d23bb0b1ab51b", "committedDate": "2020-12-29T15:14:58Z", "message": "Fix tests"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTU5OTUyODI4", "url": "https://github.com/apereo/cas/pull/4984#pullrequestreview-559952828", "createdAt": "2020-12-30T08:31:25Z", "commit": {"oid": "914649eeb937edd1056b7b1b3c9d23bb0b1ab51b"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3545, "cost": 1, "resetAt": "2021-11-01T11:59:11Z"}}}