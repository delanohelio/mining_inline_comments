{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDAxMTc5MTIx", "number": 4812, "reviewThreads": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wN1QxNTozNzo1NVrOD6TnPQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wN1QxNTozODo1NVrOD6TpGQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjYyNDY1MzQxOnYy", "diffSide": "RIGHT", "path": "core/cas-server-core-util/src/main/java/org/apereo/cas/config/CasCoreUtilConfiguration.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wN1QxNTozNzo1NVrOGSEf9Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wN1QxNTozNzo1NVrOGSEf9Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMTYwMTI2OQ==", "bodyText": "Remove all of this. See previous discussions on the topic.", "url": "https://github.com/apereo/cas/pull/4812#discussion_r421601269", "createdAt": "2020-05-07T15:37:55Z", "author": {"login": "mmoayyed"}, "path": "core/cas-server-core-util/src/main/java/org/apereo/cas/config/CasCoreUtilConfiguration.java", "diffHunk": "@@ -115,6 +116,13 @@ public SmsSender smsSender() {\n         return SmsSender.noOp();\n     }\n \n+    @Bean\n+    public SchedulerFactoryBean schedulerFactoryBean() {\n+        val schedulerFactoryBean = new SchedulerFactoryBean();\n+        schedulerFactoryBean.setWaitForJobsToCompleteOnShutdown(true);\n+        return schedulerFactoryBean;\n+    }", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "0d5d87bba4654a5516c4eaaf1ab90d9b11027635"}, "originalPosition": 17}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjYyNDY1NTk4OnYy", "diffSide": "RIGHT", "path": "support/cas-server-support-jdbc-drivers/src/main/java/org/apereo/cas/JdbcServletContextListener.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wN1QxNTozODozMFrOGSEhqw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wN1QxNTozODozMFrOGSEhqw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMTYwMTcwNw==", "bodyText": "Remove all inline comments; Either turn into javadoc or write the code in such a way that \"hidden\" comments would not be required.", "url": "https://github.com/apereo/cas/pull/4812#discussion_r421601707", "createdAt": "2020-05-07T15:38:30Z", "author": {"login": "mmoayyed"}, "path": "support/cas-server-support-jdbc-drivers/src/main/java/org/apereo/cas/JdbcServletContextListener.java", "diffHunk": "@@ -0,0 +1,53 @@\n+package org.apereo.cas;\n+\n+import lombok.val;\n+\n+import javax.servlet.ServletContextEvent;\n+import javax.servlet.ServletContextListener;\n+import javax.servlet.annotation.WebListener;\n+import java.sql.DriverManager;\n+import java.sql.SQLException;\n+import java.util.logging.Logger;\n+\n+/**\n+ * This is {@link JdbcServletContextListener} that properly\n+ * deregisters JDBC drivers.\n+ *\n+ * @author leeyc0\n+ * @since 6.2.0\n+ */\n+@WebListener\n+public class JdbcServletContextListener implements ServletContextListener {\n+\n+    @Override\n+    public void contextInitialized(final ServletContextEvent sce) {\n+    }\n+\n+    @Override\n+    public final void contextDestroyed(final ServletContextEvent sce) {\n+        /* Slf4j does not work in contextDestroyed */\n+        val logger = Logger.getLogger(\"org.apereo.cas\");\n+        logger.info(\"Unregistering JdbcServletContextListener\");\n+\n+        /* ... First close any background tasks which may be using the DB ...\n+         * ... Then close any DB connection pools ... */\n+\n+        /*  Now deregister JDBC drivers in this context's ClassLoader:\n+         *  Get the webapp's ClassLoader */", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "0d5d87bba4654a5516c4eaaf1ab90d9b11027635"}, "originalPosition": 36}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjYyNDY1Njg2OnYy", "diffSide": "RIGHT", "path": "support/cas-server-support-jdbc-drivers/src/main/java/org/apereo/cas/JdbcServletContextListener.java", "isResolved": true, "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wN1QxNTozODo0MFrOGSEiLA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wN1QxNTo1MTo1M1rOGSFG-w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMTYwMTgzNg==", "bodyText": "This should work.", "url": "https://github.com/apereo/cas/pull/4812#discussion_r421601836", "createdAt": "2020-05-07T15:38:40Z", "author": {"login": "mmoayyed"}, "path": "support/cas-server-support-jdbc-drivers/src/main/java/org/apereo/cas/JdbcServletContextListener.java", "diffHunk": "@@ -0,0 +1,53 @@\n+package org.apereo.cas;\n+\n+import lombok.val;\n+\n+import javax.servlet.ServletContextEvent;\n+import javax.servlet.ServletContextListener;\n+import javax.servlet.annotation.WebListener;\n+import java.sql.DriverManager;\n+import java.sql.SQLException;\n+import java.util.logging.Logger;\n+\n+/**\n+ * This is {@link JdbcServletContextListener} that properly\n+ * deregisters JDBC drivers.\n+ *\n+ * @author leeyc0\n+ * @since 6.2.0\n+ */\n+@WebListener\n+public class JdbcServletContextListener implements ServletContextListener {\n+\n+    @Override\n+    public void contextInitialized(final ServletContextEvent sce) {\n+    }\n+\n+    @Override\n+    public final void contextDestroyed(final ServletContextEvent sce) {\n+        /* Slf4j does not work in contextDestroyed */", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "0d5d87bba4654a5516c4eaaf1ab90d9b11027635"}, "originalPosition": 28}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMTYwOTQ1Mw==", "bodyText": "Actually I tried Slf4j first and did not work.", "url": "https://github.com/apereo/cas/pull/4812#discussion_r421609453", "createdAt": "2020-05-07T15:49:19Z", "author": {"login": "leeyc0"}, "path": "support/cas-server-support-jdbc-drivers/src/main/java/org/apereo/cas/JdbcServletContextListener.java", "diffHunk": "@@ -0,0 +1,53 @@\n+package org.apereo.cas;\n+\n+import lombok.val;\n+\n+import javax.servlet.ServletContextEvent;\n+import javax.servlet.ServletContextListener;\n+import javax.servlet.annotation.WebListener;\n+import java.sql.DriverManager;\n+import java.sql.SQLException;\n+import java.util.logging.Logger;\n+\n+/**\n+ * This is {@link JdbcServletContextListener} that properly\n+ * deregisters JDBC drivers.\n+ *\n+ * @author leeyc0\n+ * @since 6.2.0\n+ */\n+@WebListener\n+public class JdbcServletContextListener implements ServletContextListener {\n+\n+    @Override\n+    public void contextInitialized(final ServletContextEvent sce) {\n+    }\n+\n+    @Override\n+    public final void contextDestroyed(final ServletContextEvent sce) {\n+        /* Slf4j does not work in contextDestroyed */", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMTYwMTgzNg=="}, "originalCommit": {"oid": "0d5d87bba4654a5516c4eaaf1ab90d9b11027635"}, "originalPosition": 28}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMTYxMTI1OQ==", "bodyText": "It appears that Slf4j logger already closed before contextDestroyed is called.", "url": "https://github.com/apereo/cas/pull/4812#discussion_r421611259", "createdAt": "2020-05-07T15:51:53Z", "author": {"login": "leeyc0"}, "path": "support/cas-server-support-jdbc-drivers/src/main/java/org/apereo/cas/JdbcServletContextListener.java", "diffHunk": "@@ -0,0 +1,53 @@\n+package org.apereo.cas;\n+\n+import lombok.val;\n+\n+import javax.servlet.ServletContextEvent;\n+import javax.servlet.ServletContextListener;\n+import javax.servlet.annotation.WebListener;\n+import java.sql.DriverManager;\n+import java.sql.SQLException;\n+import java.util.logging.Logger;\n+\n+/**\n+ * This is {@link JdbcServletContextListener} that properly\n+ * deregisters JDBC drivers.\n+ *\n+ * @author leeyc0\n+ * @since 6.2.0\n+ */\n+@WebListener\n+public class JdbcServletContextListener implements ServletContextListener {\n+\n+    @Override\n+    public void contextInitialized(final ServletContextEvent sce) {\n+    }\n+\n+    @Override\n+    public final void contextDestroyed(final ServletContextEvent sce) {\n+        /* Slf4j does not work in contextDestroyed */", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMTYwMTgzNg=="}, "originalCommit": {"oid": "0d5d87bba4654a5516c4eaaf1ab90d9b11027635"}, "originalPosition": 28}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjYyNDY1ODE3OnYy", "diffSide": "RIGHT", "path": "support/cas-server-support-jdbc-drivers/src/main/java/org/apereo/cas/JdbcServletContextListener.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wN1QxNTozODo1NVrOGSEi9g==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wN1QxNTozODo1NVrOGSEi9g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMTYwMjAzOA==", "bodyText": "Review all logger statements, and choose levels correctly.", "url": "https://github.com/apereo/cas/pull/4812#discussion_r421602038", "createdAt": "2020-05-07T15:38:55Z", "author": {"login": "mmoayyed"}, "path": "support/cas-server-support-jdbc-drivers/src/main/java/org/apereo/cas/JdbcServletContextListener.java", "diffHunk": "@@ -0,0 +1,53 @@\n+package org.apereo.cas;\n+\n+import lombok.val;\n+\n+import javax.servlet.ServletContextEvent;\n+import javax.servlet.ServletContextListener;\n+import javax.servlet.annotation.WebListener;\n+import java.sql.DriverManager;\n+import java.sql.SQLException;\n+import java.util.logging.Logger;\n+\n+/**\n+ * This is {@link JdbcServletContextListener} that properly\n+ * deregisters JDBC drivers.\n+ *\n+ * @author leeyc0\n+ * @since 6.2.0\n+ */\n+@WebListener\n+public class JdbcServletContextListener implements ServletContextListener {\n+\n+    @Override\n+    public void contextInitialized(final ServletContextEvent sce) {\n+    }\n+\n+    @Override\n+    public final void contextDestroyed(final ServletContextEvent sce) {\n+        /* Slf4j does not work in contextDestroyed */\n+        val logger = Logger.getLogger(\"org.apereo.cas\");\n+        logger.info(\"Unregistering JdbcServletContextListener\");", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "0d5d87bba4654a5516c4eaaf1ab90d9b11027635"}, "originalPosition": 30}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4028, "cost": 1, "resetAt": "2021-11-12T09:44:50Z"}}}