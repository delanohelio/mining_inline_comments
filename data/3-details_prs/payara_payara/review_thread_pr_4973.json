{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTEzMTE4Mzcz", "number": 4973, "reviewThreads": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wMVQyMDo1MDo1MFrOE0LqrA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wMVQyMDo1MTo0M1rOE0Lq8w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzIzMTUyNTU2OnYy", "diffSide": "RIGHT", "path": "nucleus/payara-modules/nucleus-microprofile/config-service/src/main/java/fish/payara/nucleus/microprofile/config/source/JDBCConfigSource.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wMVQyMDo1MDo1MFrOHryBag==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wMVQyMDo1MDo1MFrOHryBag==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNTY3MDM3OA==", "bodyText": "How about an Optional here?", "url": "https://github.com/payara/Payara/pull/4973#discussion_r515670378", "createdAt": "2020-11-01T20:50:50Z", "author": {"login": "svendiedrichsen"}, "path": "nucleus/payara-modules/nucleus-microprofile/config-service/src/main/java/fish/payara/nucleus/microprofile/config/source/JDBCConfigSource.java", "diffHunk": "@@ -64,17 +83,31 @@ public int getOrdinal() {\n \n     @Override\n     public String getValue(String propertyName) {\n-        return jdbcConfigHelper.getConfigValue(propertyName);\n+        JDBCConfigSourceHelper helper = getHelper();\n+        if (helper == null) {\n+            return null;\n+        }\n+        try {\n+            return helper.getConfigValue(propertyName);\n+        } finally {\n+            try {\n+                helper.close();\n+            } catch (IOException e) {\n+                LOGGER.log(Level.SEVERE, \"Error closing JDBC connection\", e);\n+            }\n+        }\n     }\n \n     @Override\n     public String getName() {\n         return \"JDBC\";\n     }\n \n-    private void init() {\n-        if (jdbcConfigHelper == null) {\n-            jdbcConfigHelper = new JDBCConfigSourceHelper(Globals.getDefaultHabitat().getService(JDBCConfigSourceConfiguration.class));\n+    private JDBCConfigSourceHelper getHelper() {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "09f8f1c04108ad03890c2b22434c85e553d0090d"}, "originalPosition": 74}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzIzMTUyNjE3OnYy", "diffSide": "RIGHT", "path": "nucleus/payara-modules/nucleus-microprofile/config-service/src/main/java/fish/payara/nucleus/microprofile/config/source/JDBCConfigSource.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wMVQyMDo1MTozM1rOHryBvA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wMVQyMDo1MTozM1rOHryBvA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNTY3MDQ2MA==", "bodyText": "How about try-with-resources here?", "url": "https://github.com/payara/Payara/pull/4973#discussion_r515670460", "createdAt": "2020-11-01T20:51:33Z", "author": {"login": "svendiedrichsen"}, "path": "nucleus/payara-modules/nucleus-microprofile/config-service/src/main/java/fish/payara/nucleus/microprofile/config/source/JDBCConfigSource.java", "diffHunk": "@@ -64,17 +83,31 @@ public int getOrdinal() {\n \n     @Override\n     public String getValue(String propertyName) {\n-        return jdbcConfigHelper.getConfigValue(propertyName);\n+        JDBCConfigSourceHelper helper = getHelper();\n+        if (helper == null) {\n+            return null;\n+        }\n+        try {\n+            return helper.getConfigValue(propertyName);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "09f8f1c04108ad03890c2b22434c85e553d0090d"}, "originalPosition": 56}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzIzMTUyNjI3OnYy", "diffSide": "RIGHT", "path": "nucleus/payara-modules/nucleus-microprofile/config-service/src/main/java/fish/payara/nucleus/microprofile/config/source/JDBCConfigSource.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wMVQyMDo1MTo0M1rOHryByQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wMVQyMDo1MTo0M1rOHryByQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNTY3MDQ3Mw==", "bodyText": "How about try-with-resources here?", "url": "https://github.com/payara/Payara/pull/4973#discussion_r515670473", "createdAt": "2020-11-01T20:51:43Z", "author": {"login": "svendiedrichsen"}, "path": "nucleus/payara-modules/nucleus-microprofile/config-service/src/main/java/fish/payara/nucleus/microprofile/config/source/JDBCConfigSource.java", "diffHunk": "@@ -39,22 +39,41 @@\n  */\n package fish.payara.nucleus.microprofile.config.source;\n \n-import fish.payara.nucleus.microprofile.config.spi.JDBCConfigSourceConfiguration;\n+import java.io.IOException;\n import java.util.Map;\n+import java.util.logging.Level;\n+import java.util.logging.Logger;\n+\n import org.eclipse.microprofile.config.spi.ConfigSource;\n import org.glassfish.internal.api.Globals;\n \n+import fish.payara.nucleus.microprofile.config.spi.JDBCConfigSourceConfiguration;\n+\n public class JDBCConfigSource extends PayaraConfigSource implements ConfigSource {\n \n-    private JDBCConfigSourceHelper jdbcConfigHelper;\n+    private static final Logger LOGGER = Logger.getLogger(JDBCConfigSource.class.getName());\n+\n+    private final JDBCConfigSourceConfiguration config;\n \n     public JDBCConfigSource() {\n-      init();\n+        this.config = Globals.getDefaultHabitat().getService(JDBCConfigSourceConfiguration.class);\n     }\n \n     @Override\n     public Map<String, String> getProperties() {\n-        return jdbcConfigHelper.getAllConfigValues();\n+        JDBCConfigSourceHelper helper = getHelper();\n+        if (helper == null) {\n+            return null;\n+        }\n+        try {\n+            return helper.getAllConfigValues();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "09f8f1c04108ad03890c2b22434c85e553d0090d"}, "originalPosition": 35}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1244, "cost": 1, "resetAt": "2021-11-12T12:57:47Z"}}}