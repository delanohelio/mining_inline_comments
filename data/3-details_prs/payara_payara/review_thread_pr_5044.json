{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTM2MjI4ODc2", "number": 5044, "reviewThreads": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xMFQyMDo1NTozMlrOFDrbfQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xNFQwNzozNToxM1rOFE10MA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzM5NDAxNTk3OnYy", "diffSide": "RIGHT", "path": "nucleus/common/common-util/src/main/java/com/sun/common/util/logging/GFLogRecord.java", "isResolved": true, "comments": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xMFQyMDo1NTozMlrOIDc5yw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xMFQyMToxOTo0NVrOIDdxjA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MDQ5MDE4Nw==", "bodyText": "What is param.getClass().equals(String.class) supposed to do?", "url": "https://github.com/payara/Payara/pull/5044#discussion_r540490187", "createdAt": "2020-12-10T20:55:32Z", "author": {"login": "sgflt"}, "path": "nucleus/common/common-util/src/main/java/com/sun/common/util/logging/GFLogRecord.java", "diffHunk": "@@ -84,4 +84,25 @@ public String getThreadName() {\n     public void setThreadName(String threadName) {\n         this.threadName = threadName;\n     }\n+\n+    /**\n+     * CUSTOM-55\n+     * in case of an object passed as a parameter, call it's toString() method\n+     * to resolve it's values in the current thread, instead of waiting for queues / et\n+     * so there is no possibility of state change of the object between thread\n+     * @param params\n+     * @return parameter array\n+     */\n+    private Object[] transform(Object[] params) {\n+        if (params == null) {\n+            return null;\n+        }\n+        for (int ii = 0; ii < params.length; ++ii) {\n+            Object param = params[ii];\n+            if (param != null && !param.getClass().equals(String.class)) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "3445ae7c3f11bbe06460832843b1acd7a3fe1d75"}, "originalPosition": 60}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MDQ5NjY3MQ==", "bodyText": "See if it\u2019s already a string. I could use instanceof String instead I guess", "url": "https://github.com/payara/Payara/pull/5044#discussion_r540496671", "createdAt": "2020-12-10T21:06:50Z", "author": {"login": "lprimak"}, "path": "nucleus/common/common-util/src/main/java/com/sun/common/util/logging/GFLogRecord.java", "diffHunk": "@@ -84,4 +84,25 @@ public String getThreadName() {\n     public void setThreadName(String threadName) {\n         this.threadName = threadName;\n     }\n+\n+    /**\n+     * CUSTOM-55\n+     * in case of an object passed as a parameter, call it's toString() method\n+     * to resolve it's values in the current thread, instead of waiting for queues / et\n+     * so there is no possibility of state change of the object between thread\n+     * @param params\n+     * @return parameter array\n+     */\n+    private Object[] transform(Object[] params) {\n+        if (params == null) {\n+            return null;\n+        }\n+        for (int ii = 0; ii < params.length; ++ii) {\n+            Object param = params[ii];\n+            if (param != null && !param.getClass().equals(String.class)) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MDQ5MDE4Nw=="}, "originalCommit": {"oid": "3445ae7c3f11bbe06460832843b1acd7a3fe1d75"}, "originalPosition": 60}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MDUwMjU5Mg==", "bodyText": "I think it is not useful at all. String,toString() returns this, so it is NOOP and the condition just obfuscates code. Or am I missing something?", "url": "https://github.com/payara/Payara/pull/5044#discussion_r540502592", "createdAt": "2020-12-10T21:16:35Z", "author": {"login": "sgflt"}, "path": "nucleus/common/common-util/src/main/java/com/sun/common/util/logging/GFLogRecord.java", "diffHunk": "@@ -84,4 +84,25 @@ public String getThreadName() {\n     public void setThreadName(String threadName) {\n         this.threadName = threadName;\n     }\n+\n+    /**\n+     * CUSTOM-55\n+     * in case of an object passed as a parameter, call it's toString() method\n+     * to resolve it's values in the current thread, instead of waiting for queues / et\n+     * so there is no possibility of state change of the object between thread\n+     * @param params\n+     * @return parameter array\n+     */\n+    private Object[] transform(Object[] params) {\n+        if (params == null) {\n+            return null;\n+        }\n+        for (int ii = 0; ii < params.length; ++ii) {\n+            Object param = params[ii];\n+            if (param != null && !param.getClass().equals(String.class)) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MDQ5MDE4Nw=="}, "originalCommit": {"oid": "3445ae7c3f11bbe06460832843b1acd7a3fe1d75"}, "originalPosition": 60}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MDUwNDQ2MA==", "bodyText": "No you are not missing anything. You are right it\u2019s superfluous. I will remove that one", "url": "https://github.com/payara/Payara/pull/5044#discussion_r540504460", "createdAt": "2020-12-10T21:19:45Z", "author": {"login": "lprimak"}, "path": "nucleus/common/common-util/src/main/java/com/sun/common/util/logging/GFLogRecord.java", "diffHunk": "@@ -84,4 +84,25 @@ public String getThreadName() {\n     public void setThreadName(String threadName) {\n         this.threadName = threadName;\n     }\n+\n+    /**\n+     * CUSTOM-55\n+     * in case of an object passed as a parameter, call it's toString() method\n+     * to resolve it's values in the current thread, instead of waiting for queues / et\n+     * so there is no possibility of state change of the object between thread\n+     * @param params\n+     * @return parameter array\n+     */\n+    private Object[] transform(Object[] params) {\n+        if (params == null) {\n+            return null;\n+        }\n+        for (int ii = 0; ii < params.length; ++ii) {\n+            Object param = params[ii];\n+            if (param != null && !param.getClass().equals(String.class)) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MDQ5MDE4Nw=="}, "originalCommit": {"oid": "3445ae7c3f11bbe06460832843b1acd7a3fe1d75"}, "originalPosition": 60}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzM5NDI4MTU0OnYy", "diffSide": "RIGHT", "path": "nucleus/common/common-util/src/main/java/com/sun/common/util/logging/GFLogRecord.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xMFQyMjowMjozMVrOIDfSvw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xMVQwMDoxODozMlrOIDjbgQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MDUyOTM0Mw==", "bodyText": "For example UniformLogFormatter expects in some code paths java.util.Collection or java.util.Map. Now paremeters are just strings so it may require some adjustment of formatters. (or different approach)", "url": "https://github.com/payara/Payara/pull/5044#discussion_r540529343", "createdAt": "2020-12-10T22:02:31Z", "author": {"login": "sgflt"}, "path": "nucleus/common/common-util/src/main/java/com/sun/common/util/logging/GFLogRecord.java", "diffHunk": "@@ -84,4 +84,25 @@ public String getThreadName() {\n     public void setThreadName(String threadName) {\n         this.threadName = threadName;\n     }\n+\n+    /**\n+     * CUSTOM-55\n+     * in case of an object passed as a parameter, call it's toString() method\n+     * to resolve it's values in the current thread, instead of waiting for queues / et\n+     * so there is no possibility of state change of the object between thread\n+     * @param params\n+     * @return parameter array\n+     */\n+    private Object[] transform(Object[] params) {\n+        if (params == null) {\n+            return null;\n+        }\n+        for (int ii = 0; ii < params.length; ++ii) {\n+            Object param = params[ii];\n+            if (param != null && !param.getClass().equals(String.class)) {\n+                params[ii] = params[ii].toString();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "3445ae7c3f11bbe06460832843b1acd7a3fe1d75"}, "originalPosition": 61}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MDU5NzEyMQ==", "bodyText": "good catch, fixed", "url": "https://github.com/payara/Payara/pull/5044#discussion_r540597121", "createdAt": "2020-12-11T00:18:32Z", "author": {"login": "lprimak"}, "path": "nucleus/common/common-util/src/main/java/com/sun/common/util/logging/GFLogRecord.java", "diffHunk": "@@ -84,4 +84,25 @@ public String getThreadName() {\n     public void setThreadName(String threadName) {\n         this.threadName = threadName;\n     }\n+\n+    /**\n+     * CUSTOM-55\n+     * in case of an object passed as a parameter, call it's toString() method\n+     * to resolve it's values in the current thread, instead of waiting for queues / et\n+     * so there is no possibility of state change of the object between thread\n+     * @param params\n+     * @return parameter array\n+     */\n+    private Object[] transform(Object[] params) {\n+        if (params == null) {\n+            return null;\n+        }\n+        for (int ii = 0; ii < params.length; ++ii) {\n+            Object param = params[ii];\n+            if (param != null && !param.getClass().equals(String.class)) {\n+                params[ii] = params[ii].toString();", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MDUyOTM0Mw=="}, "originalCommit": {"oid": "3445ae7c3f11bbe06460832843b1acd7a3fe1d75"}, "originalPosition": 61}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzQwNjIwMzM2OnYy", "diffSide": "RIGHT", "path": "nucleus/common/common-util/src/main/java/com/sun/common/util/logging/GFLogRecord.java", "isResolved": true, "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xNFQwNzozNToxM1rOIFDQog==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xNFQxNzoxNDo0N1rOIFbIcQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MjE2NzIwMg==", "bodyText": "I would probably use paramsIndex instead of originalIndex as a name", "url": "https://github.com/payara/Payara/pull/5044#discussion_r542167202", "createdAt": "2020-12-14T07:35:13Z", "author": {"login": "dmatej"}, "path": "nucleus/common/common-util/src/main/java/com/sun/common/util/logging/GFLogRecord.java", "diffHunk": "@@ -84,4 +84,31 @@ public String getThreadName() {\n     public void setThreadName(String threadName) {\n         this.threadName = threadName;\n     }\n+\n+    /**\n+     * CUSTOM-55\n+     * in case of an object passed as a parameter, call it's toString() method\n+     * to resolve it's values in the current thread, instead of waiting for queues / etc\n+     * so there is no possibility of state change of the object between threads\n+     * Append the original parameters at the end, as they are used for by some logging formatters,\n+     * such as JSON logging formatter for context\n+     *\n+     * @param params\n+     * @return parameter array\n+     */\n+    private Object[] transformParameters(Object[] params) {\n+        if (params == null) {\n+            return null;\n+        }\n+        Object[] result = new Object[params.length * 2];\n+        for (int stringIndex = 0, originalIndex = params.length; stringIndex < params.length;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "a3231dc8fb5b5793e0e9f6b079fbc10bfffd6919"}, "originalPosition": 62}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MjU1NzA2MQ==", "bodyText": "Performance is unaffected because toString() gets called eventually anyway.\nJsonLogFormatIT works because now parameters include both strings and original objects.\nAll that's is original objects so memory consumption has only tiny increase at the end of the day, just due to object array being bigger", "url": "https://github.com/payara/Payara/pull/5044#discussion_r542557061", "createdAt": "2020-12-14T17:13:05Z", "author": {"login": "lprimak"}, "path": "nucleus/common/common-util/src/main/java/com/sun/common/util/logging/GFLogRecord.java", "diffHunk": "@@ -84,4 +84,31 @@ public String getThreadName() {\n     public void setThreadName(String threadName) {\n         this.threadName = threadName;\n     }\n+\n+    /**\n+     * CUSTOM-55\n+     * in case of an object passed as a parameter, call it's toString() method\n+     * to resolve it's values in the current thread, instead of waiting for queues / etc\n+     * so there is no possibility of state change of the object between threads\n+     * Append the original parameters at the end, as they are used for by some logging formatters,\n+     * such as JSON logging formatter for context\n+     *\n+     * @param params\n+     * @return parameter array\n+     */\n+    private Object[] transformParameters(Object[] params) {\n+        if (params == null) {\n+            return null;\n+        }\n+        Object[] result = new Object[params.length * 2];\n+        for (int stringIndex = 0, originalIndex = params.length; stringIndex < params.length;", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MjE2NzIwMg=="}, "originalCommit": {"oid": "a3231dc8fb5b5793e0e9f6b079fbc10bfffd6919"}, "originalPosition": 62}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MjU1ODMyMQ==", "bodyText": "Also if we would use both SysLogHandler and FileLoggerHandler, GFLogRecord would be created in bot\n\nfixed", "url": "https://github.com/payara/Payara/pull/5044#discussion_r542558321", "createdAt": "2020-12-14T17:14:47Z", "author": {"login": "lprimak"}, "path": "nucleus/common/common-util/src/main/java/com/sun/common/util/logging/GFLogRecord.java", "diffHunk": "@@ -84,4 +84,31 @@ public String getThreadName() {\n     public void setThreadName(String threadName) {\n         this.threadName = threadName;\n     }\n+\n+    /**\n+     * CUSTOM-55\n+     * in case of an object passed as a parameter, call it's toString() method\n+     * to resolve it's values in the current thread, instead of waiting for queues / etc\n+     * so there is no possibility of state change of the object between threads\n+     * Append the original parameters at the end, as they are used for by some logging formatters,\n+     * such as JSON logging formatter for context\n+     *\n+     * @param params\n+     * @return parameter array\n+     */\n+    private Object[] transformParameters(Object[] params) {\n+        if (params == null) {\n+            return null;\n+        }\n+        Object[] result = new Object[params.length * 2];\n+        for (int stringIndex = 0, originalIndex = params.length; stringIndex < params.length;", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MjE2NzIwMg=="}, "originalCommit": {"oid": "a3231dc8fb5b5793e0e9f6b079fbc10bfffd6919"}, "originalPosition": 62}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1185, "cost": 1, "resetAt": "2021-11-12T12:57:47Z"}}}