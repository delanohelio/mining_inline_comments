{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDkzNzc3MjEw", "number": 4918, "reviewThreads": {"totalCount": 7, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yOFQxNTo1NzoxMVrOEoJ4MQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yOFQxNjoyMjozNVrOEoKhEg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzEwNTQwMzM3OnYy", "diffSide": "RIGHT", "path": "nucleus/payara-modules/healthcheck-core/src/main/java/fish/payara/nucleus/healthcheck/configuration/MicroProfileMetricsChecker.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yOFQxNTo1NzoxMVrOHZFI0Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yOFQxNTo1NzoxMVrOHZFI0Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NjA2MDYyNQ==", "bodyText": "Looks like this has a default, but it's not displayed in the admin console!", "url": "https://github.com/payara/Payara/pull/4918#discussion_r496060625", "createdAt": "2020-09-28T15:57:11Z", "author": {"login": "MattGill98"}, "path": "nucleus/payara-modules/healthcheck-core/src/main/java/fish/payara/nucleus/healthcheck/configuration/MicroProfileMetricsChecker.java", "diffHunk": "@@ -0,0 +1,70 @@\n+/*\n+ * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS HEADER.\n+ * \n+ *    Copyright (c) [2020] Payara Foundation and/or its affiliates. All rights reserved.\n+ * \n+ *     The contents of this file are subject to the terms of either the GNU\n+ *     General Public License Version 2 only (\"GPL\") or the Common Development\n+ *     and Distribution License(\"CDDL\") (collectively, the \"License\").  You\n+ *     may not use this file except in compliance with the License.  You can\n+ *     obtain a copy of the License at\n+ *     https://github.com/payara/Payara/blob/master/LICENSE.txt\n+ *     See the License for the specific\n+ *     language governing permissions and limitations under the License.\n+ * \n+ *     When distributing the software, include this License Header Notice in each\n+ *     file and include the License file at glassfish/legal/LICENSE.txt.\n+ * \n+ *     GPL Classpath Exception:\n+ *     The Payara Foundation designates this particular file as subject to the \"Classpath\"\n+ *     exception as provided by the Payara Foundation in the GPL Version 2 section of the License\n+ *     file that accompanied this code.\n+ * \n+ *     Modifications:\n+ *     If applicable, add the following below the License Header, with the fields\n+ *     enclosed by brackets [] replaced by your own identifying information:\n+ *     \"Portions Copyright [year] [name of copyright owner]\"\n+ * \n+ *     Contributor(s):\n+ *     If you wish your version of this file to be governed by only the CDDL or\n+ *     only the GPL Version 2, indicate your decision by adding \"[Contributor]\n+ *     elects to include this software in this distribution under the [CDDL or GPL\n+ *     Version 2] license.\"  If you don't indicate a single choice of license, a\n+ *     recipient has the option to distribute your version of this file under\n+ *     either the CDDL, the GPL Version 2 or to extend the choice of license to\n+ *     its licensees as provided above.  However, if you add GPL Version 2 code\n+ *     and therefore, elected the GPL Version 2 license, then the option applies\n+ *     only if the new code is made subject to such option by the copyright\n+ *     holder.\n+ */\n+package fish.payara.nucleus.healthcheck.configuration;\n+\n+import static fish.payara.nucleus.healthcheck.HealthCheckConstants.DEFAULT_MICROPROFILE_METRICS_NAME;\n+import org.jvnet.hk2.config.Attribute;\n+import org.jvnet.hk2.config.Configured;\n+\n+import java.beans.PropertyVetoException;\n+\n+/**\n+ * @author mertcaliskan\n+ */\n+@Configured\n+@CheckerConfigurationType(type = CheckerType.MP_METRICS)\n+public interface MicroProfileMetricsChecker extends Checker {\n+    \n+    @Attribute(defaultValue = DEFAULT_MICROPROFILE_METRICS_NAME)\n+    String getName();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "974d33d82335c34455819059678fb587f88419e5"}, "originalPosition": 56}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzEwNTQzMzYwOnYy", "diffSide": "RIGHT", "path": "appserver/payara-appserver-modules/healthcheck-metrics/src/main/java/fish/payara/healthcheck/microprofile/metrics/MicroProfileMetricsCheck.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yOFQxNjowNDozNVrOHZFb1A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yOFQxNjowNDozNVrOHZFb1A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NjA2NTQ5Mg==", "bodyText": "I'd remove extra whitespace here", "url": "https://github.com/payara/Payara/pull/4918#discussion_r496065492", "createdAt": "2020-09-28T16:04:35Z", "author": {"login": "MattGill98"}, "path": "appserver/payara-appserver-modules/healthcheck-metrics/src/main/java/fish/payara/healthcheck/microprofile/metrics/MicroProfileMetricsCheck.java", "diffHunk": "@@ -0,0 +1,251 @@\n+/*\n+ *  DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS HEADER.\n+ * \n+ *  Copyright (c) [2020] Payara Foundation and/or its affiliates. All rights reserved.\n+ * \n+ *  The contents of this file are subject to the terms of either the GNU\n+ *  General Public License Version 2 only (\"GPL\") or the Common Development\n+ *  and Distribution License(\"CDDL\") (collectively, the \"License\").  You\n+ *  may not use this file except in compliance with the License.  You can\n+ *  obtain a copy of the License at\n+ *  https://github.com/payara/Payara/blob/master/LICENSE.txt\n+ *  See the License for the specific\n+ *  language governing permissions and limitations under the License.\n+ * \n+ *  When distributing the software, include this License Header Notice in each\n+ *  file and include the License.\n+ * \n+ *  When distributing the software, include this License Header Notice in each\n+ *  file and include the License file at glassfish/legal/LICENSE.txt.\n+ * \n+ *  GPL Classpath Exception:\n+ *  The Payara Foundation designates this particular file as subject to the \"Classpath\"\n+ *  exception as provided by the Payara Foundation in the GPL Version 2 section of the License\n+ *  file that accompanied this code.\n+ * \n+ *  Modifications:\n+ *  If applicable, add the following below the License Header, with the fields\n+ *  enclosed by brackets [] replaced by your own identifying information:\n+ *  \"Portions Copyright [year] [name of copyright owner]\"\n+ * \n+ *  Contributor(s):\n+ *  If you wish your version of this file to be governed by only the CDDL or\n+ *  only the GPL Version 2, indicate your decision by adding \"[Contributor]\n+ *  elects to include this software in this distribution under the [CDDL or GPL\n+ *  Version 2] license.\"  If you don't indicate a single choice of license, a\n+ *  recipient has the option to distribute your version of this file under\n+ *  either the CDDL, the GPL Version 2 or to extend the choice of license to\n+ *  its licensees as provided above.  However, if you add GPL Version 2 code\n+ *  and therefore, elected the GPL Version 2 license, then the option applies\n+ *  only if the new code is made subject to such option by the copyright\n+ *  holder.\n+ */\n+package fish.payara.healthcheck.microprofile.metrics;\n+\n+import fish.payara.microprofile.metrics.MetricsService;\n+import fish.payara.nucleus.healthcheck.configuration.MicroProfileMetricsChecker;\n+import fish.payara.notification.healthcheck.HealthCheckResultEntry;\n+import static fish.payara.notification.healthcheck.HealthCheckResultStatus.GOOD;\n+import static fish.payara.notification.healthcheck.HealthCheckResultStatus.WARNING;\n+import fish.payara.nucleus.healthcheck.HealthCheckResult;\n+import fish.payara.nucleus.healthcheck.preliminary.BaseHealthCheck;\n+import java.util.ArrayList;\n+import java.util.Arrays;\n+import java.util.List;\n+import java.util.Map;\n+import java.util.Map.Entry;\n+import java.util.Optional;\n+import java.util.stream.Collectors;\n+import javax.annotation.PostConstruct;\n+import org.eclipse.microprofile.metrics.ConcurrentGauge;\n+import org.eclipse.microprofile.metrics.Counter;\n+import org.eclipse.microprofile.metrics.Gauge;\n+import org.eclipse.microprofile.metrics.Histogram;\n+import org.eclipse.microprofile.metrics.Meter;\n+import org.eclipse.microprofile.metrics.Metric;\n+import org.eclipse.microprofile.metrics.MetricID;\n+import org.eclipse.microprofile.metrics.MetricRegistry;\n+import org.eclipse.microprofile.metrics.MetricUnits;\n+import org.eclipse.microprofile.metrics.SimpleTimer;\n+import org.eclipse.microprofile.metrics.Timer;\n+import org.glassfish.api.StartupRunLevel;\n+import org.glassfish.hk2.runlevel.RunLevel;\n+import org.glassfish.internal.api.Globals;\n+import org.jvnet.hk2.annotations.Service;\n+\n+@Service(name = \"healthcheck-mpmetrics\")\n+@RunLevel(StartupRunLevel.VAL)\n+public class MicroProfileMetricsCheck\n+        extends BaseHealthCheck<HealthCheckMicroProfileMetricstExecutionOptions, MicroProfileMetricsChecker> {\n+\n+    @PostConstruct\n+    public void postConstruct() {\n+        postConstruct(this, MicroProfileMetricsChecker.class);\n+    }\n+\n+    @Override\n+    public HealthCheckMicroProfileMetricstExecutionOptions constructOptions(MicroProfileMetricsChecker checker) {\n+        return new HealthCheckMicroProfileMetricstExecutionOptions(Boolean.valueOf(\n+                checker.getEnabled()),\n+                Long.parseLong(checker.getTime()),\n+                asTimeUnit(checker.getUnit()),\n+                checker.getMetricsScope(),\n+                checker.getMetricApplicationName(),\n+                checker.getMetricName());\n+    }\n+\n+    @Override\n+    protected String getDescription() {\n+        return \"healthcheck.description.MPmetrics\";\n+    }\n+\n+    @Override\n+    protected HealthCheckResult doCheckInternal() {\n+        String registryName = options.getMetricsScope();\n+        List<String> metricNames = new ArrayList<>(Arrays.asList(options.getMetricName().split(\",\")));", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "974d33d82335c34455819059678fb587f88419e5"}, "originalPosition": 105}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzEwNTQzNjU2OnYy", "diffSide": "RIGHT", "path": "appserver/payara-appserver-modules/healthcheck-metrics/src/main/java/fish/payara/healthcheck/microprofile/metrics/MicroProfileMetricsCheck.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yOFQxNjowNToxN1rOHZFdog==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yOFQxNjowNToxN1rOHZFdog==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NjA2NTk1NA==", "bodyText": "This is slow, I'd remove it from the string when removing whitespace to save 2 passes", "url": "https://github.com/payara/Payara/pull/4918#discussion_r496065954", "createdAt": "2020-09-28T16:05:17Z", "author": {"login": "MattGill98"}, "path": "appserver/payara-appserver-modules/healthcheck-metrics/src/main/java/fish/payara/healthcheck/microprofile/metrics/MicroProfileMetricsCheck.java", "diffHunk": "@@ -0,0 +1,251 @@\n+/*\n+ *  DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS HEADER.\n+ * \n+ *  Copyright (c) [2020] Payara Foundation and/or its affiliates. All rights reserved.\n+ * \n+ *  The contents of this file are subject to the terms of either the GNU\n+ *  General Public License Version 2 only (\"GPL\") or the Common Development\n+ *  and Distribution License(\"CDDL\") (collectively, the \"License\").  You\n+ *  may not use this file except in compliance with the License.  You can\n+ *  obtain a copy of the License at\n+ *  https://github.com/payara/Payara/blob/master/LICENSE.txt\n+ *  See the License for the specific\n+ *  language governing permissions and limitations under the License.\n+ * \n+ *  When distributing the software, include this License Header Notice in each\n+ *  file and include the License.\n+ * \n+ *  When distributing the software, include this License Header Notice in each\n+ *  file and include the License file at glassfish/legal/LICENSE.txt.\n+ * \n+ *  GPL Classpath Exception:\n+ *  The Payara Foundation designates this particular file as subject to the \"Classpath\"\n+ *  exception as provided by the Payara Foundation in the GPL Version 2 section of the License\n+ *  file that accompanied this code.\n+ * \n+ *  Modifications:\n+ *  If applicable, add the following below the License Header, with the fields\n+ *  enclosed by brackets [] replaced by your own identifying information:\n+ *  \"Portions Copyright [year] [name of copyright owner]\"\n+ * \n+ *  Contributor(s):\n+ *  If you wish your version of this file to be governed by only the CDDL or\n+ *  only the GPL Version 2, indicate your decision by adding \"[Contributor]\n+ *  elects to include this software in this distribution under the [CDDL or GPL\n+ *  Version 2] license.\"  If you don't indicate a single choice of license, a\n+ *  recipient has the option to distribute your version of this file under\n+ *  either the CDDL, the GPL Version 2 or to extend the choice of license to\n+ *  its licensees as provided above.  However, if you add GPL Version 2 code\n+ *  and therefore, elected the GPL Version 2 license, then the option applies\n+ *  only if the new code is made subject to such option by the copyright\n+ *  holder.\n+ */\n+package fish.payara.healthcheck.microprofile.metrics;\n+\n+import fish.payara.microprofile.metrics.MetricsService;\n+import fish.payara.nucleus.healthcheck.configuration.MicroProfileMetricsChecker;\n+import fish.payara.notification.healthcheck.HealthCheckResultEntry;\n+import static fish.payara.notification.healthcheck.HealthCheckResultStatus.GOOD;\n+import static fish.payara.notification.healthcheck.HealthCheckResultStatus.WARNING;\n+import fish.payara.nucleus.healthcheck.HealthCheckResult;\n+import fish.payara.nucleus.healthcheck.preliminary.BaseHealthCheck;\n+import java.util.ArrayList;\n+import java.util.Arrays;\n+import java.util.List;\n+import java.util.Map;\n+import java.util.Map.Entry;\n+import java.util.Optional;\n+import java.util.stream.Collectors;\n+import javax.annotation.PostConstruct;\n+import org.eclipse.microprofile.metrics.ConcurrentGauge;\n+import org.eclipse.microprofile.metrics.Counter;\n+import org.eclipse.microprofile.metrics.Gauge;\n+import org.eclipse.microprofile.metrics.Histogram;\n+import org.eclipse.microprofile.metrics.Meter;\n+import org.eclipse.microprofile.metrics.Metric;\n+import org.eclipse.microprofile.metrics.MetricID;\n+import org.eclipse.microprofile.metrics.MetricRegistry;\n+import org.eclipse.microprofile.metrics.MetricUnits;\n+import org.eclipse.microprofile.metrics.SimpleTimer;\n+import org.eclipse.microprofile.metrics.Timer;\n+import org.glassfish.api.StartupRunLevel;\n+import org.glassfish.hk2.runlevel.RunLevel;\n+import org.glassfish.internal.api.Globals;\n+import org.jvnet.hk2.annotations.Service;\n+\n+@Service(name = \"healthcheck-mpmetrics\")\n+@RunLevel(StartupRunLevel.VAL)\n+public class MicroProfileMetricsCheck\n+        extends BaseHealthCheck<HealthCheckMicroProfileMetricstExecutionOptions, MicroProfileMetricsChecker> {\n+\n+    @PostConstruct\n+    public void postConstruct() {\n+        postConstruct(this, MicroProfileMetricsChecker.class);\n+    }\n+\n+    @Override\n+    public HealthCheckMicroProfileMetricstExecutionOptions constructOptions(MicroProfileMetricsChecker checker) {\n+        return new HealthCheckMicroProfileMetricstExecutionOptions(Boolean.valueOf(\n+                checker.getEnabled()),\n+                Long.parseLong(checker.getTime()),\n+                asTimeUnit(checker.getUnit()),\n+                checker.getMetricsScope(),\n+                checker.getMetricApplicationName(),\n+                checker.getMetricName());\n+    }\n+\n+    @Override\n+    protected String getDescription() {\n+        return \"healthcheck.description.MPmetrics\";\n+    }\n+\n+    @Override\n+    protected HealthCheckResult doCheckInternal() {\n+        String registryName = options.getMetricsScope();\n+        List<String> metricNames = new ArrayList<>(Arrays.asList(options.getMetricName().split(\",\")));\n+        metricNames.removeAll(Arrays.asList(\"\", null));", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "974d33d82335c34455819059678fb587f88419e5"}, "originalPosition": 106}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzEwNTQzOTczOnYy", "diffSide": "RIGHT", "path": "appserver/payara-appserver-modules/healthcheck-metrics/src/main/java/fish/payara/healthcheck/microprofile/metrics/MicroProfileMetricsCheck.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yOFQxNjowNjowNVrOHZFfow==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yOFQxNjowNjowNVrOHZFfow==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NjA2NjQ2Nw==", "bodyText": "Is there any reason you're injecting the metrics service fresh each time?", "url": "https://github.com/payara/Payara/pull/4918#discussion_r496066467", "createdAt": "2020-09-28T16:06:05Z", "author": {"login": "MattGill98"}, "path": "appserver/payara-appserver-modules/healthcheck-metrics/src/main/java/fish/payara/healthcheck/microprofile/metrics/MicroProfileMetricsCheck.java", "diffHunk": "@@ -0,0 +1,251 @@\n+/*\n+ *  DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS HEADER.\n+ * \n+ *  Copyright (c) [2020] Payara Foundation and/or its affiliates. All rights reserved.\n+ * \n+ *  The contents of this file are subject to the terms of either the GNU\n+ *  General Public License Version 2 only (\"GPL\") or the Common Development\n+ *  and Distribution License(\"CDDL\") (collectively, the \"License\").  You\n+ *  may not use this file except in compliance with the License.  You can\n+ *  obtain a copy of the License at\n+ *  https://github.com/payara/Payara/blob/master/LICENSE.txt\n+ *  See the License for the specific\n+ *  language governing permissions and limitations under the License.\n+ * \n+ *  When distributing the software, include this License Header Notice in each\n+ *  file and include the License.\n+ * \n+ *  When distributing the software, include this License Header Notice in each\n+ *  file and include the License file at glassfish/legal/LICENSE.txt.\n+ * \n+ *  GPL Classpath Exception:\n+ *  The Payara Foundation designates this particular file as subject to the \"Classpath\"\n+ *  exception as provided by the Payara Foundation in the GPL Version 2 section of the License\n+ *  file that accompanied this code.\n+ * \n+ *  Modifications:\n+ *  If applicable, add the following below the License Header, with the fields\n+ *  enclosed by brackets [] replaced by your own identifying information:\n+ *  \"Portions Copyright [year] [name of copyright owner]\"\n+ * \n+ *  Contributor(s):\n+ *  If you wish your version of this file to be governed by only the CDDL or\n+ *  only the GPL Version 2, indicate your decision by adding \"[Contributor]\n+ *  elects to include this software in this distribution under the [CDDL or GPL\n+ *  Version 2] license.\"  If you don't indicate a single choice of license, a\n+ *  recipient has the option to distribute your version of this file under\n+ *  either the CDDL, the GPL Version 2 or to extend the choice of license to\n+ *  its licensees as provided above.  However, if you add GPL Version 2 code\n+ *  and therefore, elected the GPL Version 2 license, then the option applies\n+ *  only if the new code is made subject to such option by the copyright\n+ *  holder.\n+ */\n+package fish.payara.healthcheck.microprofile.metrics;\n+\n+import fish.payara.microprofile.metrics.MetricsService;\n+import fish.payara.nucleus.healthcheck.configuration.MicroProfileMetricsChecker;\n+import fish.payara.notification.healthcheck.HealthCheckResultEntry;\n+import static fish.payara.notification.healthcheck.HealthCheckResultStatus.GOOD;\n+import static fish.payara.notification.healthcheck.HealthCheckResultStatus.WARNING;\n+import fish.payara.nucleus.healthcheck.HealthCheckResult;\n+import fish.payara.nucleus.healthcheck.preliminary.BaseHealthCheck;\n+import java.util.ArrayList;\n+import java.util.Arrays;\n+import java.util.List;\n+import java.util.Map;\n+import java.util.Map.Entry;\n+import java.util.Optional;\n+import java.util.stream.Collectors;\n+import javax.annotation.PostConstruct;\n+import org.eclipse.microprofile.metrics.ConcurrentGauge;\n+import org.eclipse.microprofile.metrics.Counter;\n+import org.eclipse.microprofile.metrics.Gauge;\n+import org.eclipse.microprofile.metrics.Histogram;\n+import org.eclipse.microprofile.metrics.Meter;\n+import org.eclipse.microprofile.metrics.Metric;\n+import org.eclipse.microprofile.metrics.MetricID;\n+import org.eclipse.microprofile.metrics.MetricRegistry;\n+import org.eclipse.microprofile.metrics.MetricUnits;\n+import org.eclipse.microprofile.metrics.SimpleTimer;\n+import org.eclipse.microprofile.metrics.Timer;\n+import org.glassfish.api.StartupRunLevel;\n+import org.glassfish.hk2.runlevel.RunLevel;\n+import org.glassfish.internal.api.Globals;\n+import org.jvnet.hk2.annotations.Service;\n+\n+@Service(name = \"healthcheck-mpmetrics\")\n+@RunLevel(StartupRunLevel.VAL)\n+public class MicroProfileMetricsCheck\n+        extends BaseHealthCheck<HealthCheckMicroProfileMetricstExecutionOptions, MicroProfileMetricsChecker> {\n+\n+    @PostConstruct\n+    public void postConstruct() {\n+        postConstruct(this, MicroProfileMetricsChecker.class);\n+    }\n+\n+    @Override\n+    public HealthCheckMicroProfileMetricstExecutionOptions constructOptions(MicroProfileMetricsChecker checker) {\n+        return new HealthCheckMicroProfileMetricstExecutionOptions(Boolean.valueOf(\n+                checker.getEnabled()),\n+                Long.parseLong(checker.getTime()),\n+                asTimeUnit(checker.getUnit()),\n+                checker.getMetricsScope(),\n+                checker.getMetricApplicationName(),\n+                checker.getMetricName());\n+    }\n+\n+    @Override\n+    protected String getDescription() {\n+        return \"healthcheck.description.MPmetrics\";\n+    }\n+\n+    @Override\n+    protected HealthCheckResult doCheckInternal() {\n+        String registryName = options.getMetricsScope();\n+        List<String> metricNames = new ArrayList<>(Arrays.asList(options.getMetricName().split(\",\")));\n+        metricNames.removeAll(Arrays.asList(\"\", null));\n+        MetricsService metricsService = Globals.getDefaultBaseServiceLocator().getService(MetricsService.class);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "974d33d82335c34455819059678fb587f88419e5"}, "originalPosition": 107}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzEwNTQ1MTQ5OnYy", "diffSide": "RIGHT", "path": "appserver/payara-appserver-modules/healthcheck-metrics/src/main/java/fish/payara/healthcheck/microprofile/metrics/MicroProfileMetricsCheck.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yOFQxNjowOToxNVrOHZFnLQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yOFQxNjowOToxNVrOHZFnLQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NjA2ODM5Nw==", "bodyText": "Does this need repeating each loop? Also, users won't be familiar with the dot notation of the metrics - they're mote likely to use underscore notation as it appears in the metrics result", "url": "https://github.com/payara/Payara/pull/4918#discussion_r496068397", "createdAt": "2020-09-28T16:09:15Z", "author": {"login": "MattGill98"}, "path": "appserver/payara-appserver-modules/healthcheck-metrics/src/main/java/fish/payara/healthcheck/microprofile/metrics/MicroProfileMetricsCheck.java", "diffHunk": "@@ -0,0 +1,251 @@\n+/*\n+ *  DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS HEADER.\n+ * \n+ *  Copyright (c) [2020] Payara Foundation and/or its affiliates. All rights reserved.\n+ * \n+ *  The contents of this file are subject to the terms of either the GNU\n+ *  General Public License Version 2 only (\"GPL\") or the Common Development\n+ *  and Distribution License(\"CDDL\") (collectively, the \"License\").  You\n+ *  may not use this file except in compliance with the License.  You can\n+ *  obtain a copy of the License at\n+ *  https://github.com/payara/Payara/blob/master/LICENSE.txt\n+ *  See the License for the specific\n+ *  language governing permissions and limitations under the License.\n+ * \n+ *  When distributing the software, include this License Header Notice in each\n+ *  file and include the License.\n+ * \n+ *  When distributing the software, include this License Header Notice in each\n+ *  file and include the License file at glassfish/legal/LICENSE.txt.\n+ * \n+ *  GPL Classpath Exception:\n+ *  The Payara Foundation designates this particular file as subject to the \"Classpath\"\n+ *  exception as provided by the Payara Foundation in the GPL Version 2 section of the License\n+ *  file that accompanied this code.\n+ * \n+ *  Modifications:\n+ *  If applicable, add the following below the License Header, with the fields\n+ *  enclosed by brackets [] replaced by your own identifying information:\n+ *  \"Portions Copyright [year] [name of copyright owner]\"\n+ * \n+ *  Contributor(s):\n+ *  If you wish your version of this file to be governed by only the CDDL or\n+ *  only the GPL Version 2, indicate your decision by adding \"[Contributor]\n+ *  elects to include this software in this distribution under the [CDDL or GPL\n+ *  Version 2] license.\"  If you don't indicate a single choice of license, a\n+ *  recipient has the option to distribute your version of this file under\n+ *  either the CDDL, the GPL Version 2 or to extend the choice of license to\n+ *  its licensees as provided above.  However, if you add GPL Version 2 code\n+ *  and therefore, elected the GPL Version 2 license, then the option applies\n+ *  only if the new code is made subject to such option by the copyright\n+ *  holder.\n+ */\n+package fish.payara.healthcheck.microprofile.metrics;\n+\n+import fish.payara.microprofile.metrics.MetricsService;\n+import fish.payara.nucleus.healthcheck.configuration.MicroProfileMetricsChecker;\n+import fish.payara.notification.healthcheck.HealthCheckResultEntry;\n+import static fish.payara.notification.healthcheck.HealthCheckResultStatus.GOOD;\n+import static fish.payara.notification.healthcheck.HealthCheckResultStatus.WARNING;\n+import fish.payara.nucleus.healthcheck.HealthCheckResult;\n+import fish.payara.nucleus.healthcheck.preliminary.BaseHealthCheck;\n+import java.util.ArrayList;\n+import java.util.Arrays;\n+import java.util.List;\n+import java.util.Map;\n+import java.util.Map.Entry;\n+import java.util.Optional;\n+import java.util.stream.Collectors;\n+import javax.annotation.PostConstruct;\n+import org.eclipse.microprofile.metrics.ConcurrentGauge;\n+import org.eclipse.microprofile.metrics.Counter;\n+import org.eclipse.microprofile.metrics.Gauge;\n+import org.eclipse.microprofile.metrics.Histogram;\n+import org.eclipse.microprofile.metrics.Meter;\n+import org.eclipse.microprofile.metrics.Metric;\n+import org.eclipse.microprofile.metrics.MetricID;\n+import org.eclipse.microprofile.metrics.MetricRegistry;\n+import org.eclipse.microprofile.metrics.MetricUnits;\n+import org.eclipse.microprofile.metrics.SimpleTimer;\n+import org.eclipse.microprofile.metrics.Timer;\n+import org.glassfish.api.StartupRunLevel;\n+import org.glassfish.hk2.runlevel.RunLevel;\n+import org.glassfish.internal.api.Globals;\n+import org.jvnet.hk2.annotations.Service;\n+\n+@Service(name = \"healthcheck-mpmetrics\")\n+@RunLevel(StartupRunLevel.VAL)\n+public class MicroProfileMetricsCheck\n+        extends BaseHealthCheck<HealthCheckMicroProfileMetricstExecutionOptions, MicroProfileMetricsChecker> {\n+\n+    @PostConstruct\n+    public void postConstruct() {\n+        postConstruct(this, MicroProfileMetricsChecker.class);\n+    }\n+\n+    @Override\n+    public HealthCheckMicroProfileMetricstExecutionOptions constructOptions(MicroProfileMetricsChecker checker) {\n+        return new HealthCheckMicroProfileMetricstExecutionOptions(Boolean.valueOf(\n+                checker.getEnabled()),\n+                Long.parseLong(checker.getTime()),\n+                asTimeUnit(checker.getUnit()),\n+                checker.getMetricsScope(),\n+                checker.getMetricApplicationName(),\n+                checker.getMetricName());\n+    }\n+\n+    @Override\n+    protected String getDescription() {\n+        return \"healthcheck.description.MPmetrics\";\n+    }\n+\n+    @Override\n+    protected HealthCheckResult doCheckInternal() {\n+        String registryName = options.getMetricsScope();\n+        List<String> metricNames = new ArrayList<>(Arrays.asList(options.getMetricName().split(\",\")));\n+        metricNames.removeAll(Arrays.asList(\"\", null));\n+        MetricsService metricsService = Globals.getDefaultBaseServiceLocator().getService(MetricsService.class);\n+        if (registryName.equalsIgnoreCase(\"application\")) {\n+            registryName = options.getMetricsApplicationName();\n+        }\n+\n+        HealthCheckResult result = new HealthCheckResult();\n+        List<String> metrics = collectMetrics(metricsService.getRegistry(registryName), metricNames);\n+\n+        result.add(new HealthCheckResultEntry(metrics.isEmpty() ? WARNING : GOOD,\n+                metrics.isEmpty() ? \"The metric you entered doesn't exist under \" + registryName : metrics.stream().map(Object::toString).collect(Collectors.joining())));\n+\n+        return result;\n+\n+    }\n+\n+    private List<String> collectMetrics(MetricRegistry state, List<String> metricNames) {\n+        List<String> array = new ArrayList<>();\n+        String metricsInfos;\n+        if (metricNames == null || metricNames.isEmpty()) {\n+            for (String name : state.getNames()) {\n+                metricsInfos = getMetricInfos(name, state);\n+                if (metricsInfos != null) {\n+                    array.add(metricsInfos);\n+                }\n+\n+            }\n+        } else {\n+            for (String metricName : metricNames) {\n+                metricsInfos = getMetricInfos(metricName.trim(), state);\n+                if (metricsInfos != null) {\n+                    array.add(metricsInfos);\n+                }\n+            }\n+        }\n+        return array;\n+    }\n+\n+    private String getMetricInfos(String metricName, MetricRegistry state) {\n+        Map<MetricID, Metric> metricInfos = state.getMetrics().entrySet().stream()", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "974d33d82335c34455819059678fb587f88419e5"}, "originalPosition": 145}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzEwNTUwMDc1OnYy", "diffSide": "RIGHT", "path": "appserver/payara-appserver-modules/healthcheck-metrics/src/main/java/fish/payara/healthcheck/microprofile/metrics/MicroProfileMetricsCheck.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yOFQxNjoyMDo1M1rOHZGEqQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yOFQxNjoyMDo1M1rOHZGEqQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NjA3NTk0NQ==", "bodyText": "Can we have a few more variables? I don't find the streaming particularly intuitive here, and the result contains excess whitespace", "url": "https://github.com/payara/Payara/pull/4918#discussion_r496075945", "createdAt": "2020-09-28T16:20:53Z", "author": {"login": "MattGill98"}, "path": "appserver/payara-appserver-modules/healthcheck-metrics/src/main/java/fish/payara/healthcheck/microprofile/metrics/MicroProfileMetricsCheck.java", "diffHunk": "@@ -0,0 +1,251 @@\n+/*\n+ *  DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS HEADER.\n+ * \n+ *  Copyright (c) [2020] Payara Foundation and/or its affiliates. All rights reserved.\n+ * \n+ *  The contents of this file are subject to the terms of either the GNU\n+ *  General Public License Version 2 only (\"GPL\") or the Common Development\n+ *  and Distribution License(\"CDDL\") (collectively, the \"License\").  You\n+ *  may not use this file except in compliance with the License.  You can\n+ *  obtain a copy of the License at\n+ *  https://github.com/payara/Payara/blob/master/LICENSE.txt\n+ *  See the License for the specific\n+ *  language governing permissions and limitations under the License.\n+ * \n+ *  When distributing the software, include this License Header Notice in each\n+ *  file and include the License.\n+ * \n+ *  When distributing the software, include this License Header Notice in each\n+ *  file and include the License file at glassfish/legal/LICENSE.txt.\n+ * \n+ *  GPL Classpath Exception:\n+ *  The Payara Foundation designates this particular file as subject to the \"Classpath\"\n+ *  exception as provided by the Payara Foundation in the GPL Version 2 section of the License\n+ *  file that accompanied this code.\n+ * \n+ *  Modifications:\n+ *  If applicable, add the following below the License Header, with the fields\n+ *  enclosed by brackets [] replaced by your own identifying information:\n+ *  \"Portions Copyright [year] [name of copyright owner]\"\n+ * \n+ *  Contributor(s):\n+ *  If you wish your version of this file to be governed by only the CDDL or\n+ *  only the GPL Version 2, indicate your decision by adding \"[Contributor]\n+ *  elects to include this software in this distribution under the [CDDL or GPL\n+ *  Version 2] license.\"  If you don't indicate a single choice of license, a\n+ *  recipient has the option to distribute your version of this file under\n+ *  either the CDDL, the GPL Version 2 or to extend the choice of license to\n+ *  its licensees as provided above.  However, if you add GPL Version 2 code\n+ *  and therefore, elected the GPL Version 2 license, then the option applies\n+ *  only if the new code is made subject to such option by the copyright\n+ *  holder.\n+ */\n+package fish.payara.healthcheck.microprofile.metrics;\n+\n+import fish.payara.microprofile.metrics.MetricsService;\n+import fish.payara.nucleus.healthcheck.configuration.MicroProfileMetricsChecker;\n+import fish.payara.notification.healthcheck.HealthCheckResultEntry;\n+import static fish.payara.notification.healthcheck.HealthCheckResultStatus.GOOD;\n+import static fish.payara.notification.healthcheck.HealthCheckResultStatus.WARNING;\n+import fish.payara.nucleus.healthcheck.HealthCheckResult;\n+import fish.payara.nucleus.healthcheck.preliminary.BaseHealthCheck;\n+import java.util.ArrayList;\n+import java.util.Arrays;\n+import java.util.List;\n+import java.util.Map;\n+import java.util.Map.Entry;\n+import java.util.Optional;\n+import java.util.stream.Collectors;\n+import javax.annotation.PostConstruct;\n+import org.eclipse.microprofile.metrics.ConcurrentGauge;\n+import org.eclipse.microprofile.metrics.Counter;\n+import org.eclipse.microprofile.metrics.Gauge;\n+import org.eclipse.microprofile.metrics.Histogram;\n+import org.eclipse.microprofile.metrics.Meter;\n+import org.eclipse.microprofile.metrics.Metric;\n+import org.eclipse.microprofile.metrics.MetricID;\n+import org.eclipse.microprofile.metrics.MetricRegistry;\n+import org.eclipse.microprofile.metrics.MetricUnits;\n+import org.eclipse.microprofile.metrics.SimpleTimer;\n+import org.eclipse.microprofile.metrics.Timer;\n+import org.glassfish.api.StartupRunLevel;\n+import org.glassfish.hk2.runlevel.RunLevel;\n+import org.glassfish.internal.api.Globals;\n+import org.jvnet.hk2.annotations.Service;\n+\n+@Service(name = \"healthcheck-mpmetrics\")\n+@RunLevel(StartupRunLevel.VAL)\n+public class MicroProfileMetricsCheck\n+        extends BaseHealthCheck<HealthCheckMicroProfileMetricstExecutionOptions, MicroProfileMetricsChecker> {\n+\n+    @PostConstruct\n+    public void postConstruct() {\n+        postConstruct(this, MicroProfileMetricsChecker.class);\n+    }\n+\n+    @Override\n+    public HealthCheckMicroProfileMetricstExecutionOptions constructOptions(MicroProfileMetricsChecker checker) {\n+        return new HealthCheckMicroProfileMetricstExecutionOptions(Boolean.valueOf(\n+                checker.getEnabled()),\n+                Long.parseLong(checker.getTime()),\n+                asTimeUnit(checker.getUnit()),\n+                checker.getMetricsScope(),\n+                checker.getMetricApplicationName(),\n+                checker.getMetricName());\n+    }\n+\n+    @Override\n+    protected String getDescription() {\n+        return \"healthcheck.description.MPmetrics\";\n+    }\n+\n+    @Override\n+    protected HealthCheckResult doCheckInternal() {\n+        String registryName = options.getMetricsScope();\n+        List<String> metricNames = new ArrayList<>(Arrays.asList(options.getMetricName().split(\",\")));\n+        metricNames.removeAll(Arrays.asList(\"\", null));\n+        MetricsService metricsService = Globals.getDefaultBaseServiceLocator().getService(MetricsService.class);\n+        if (registryName.equalsIgnoreCase(\"application\")) {\n+            registryName = options.getMetricsApplicationName();\n+        }\n+\n+        HealthCheckResult result = new HealthCheckResult();\n+        List<String> metrics = collectMetrics(metricsService.getRegistry(registryName), metricNames);\n+\n+        result.add(new HealthCheckResultEntry(metrics.isEmpty() ? WARNING : GOOD,\n+                metrics.isEmpty() ? \"The metric you entered doesn't exist under \" + registryName : metrics.stream().map(Object::toString).collect(Collectors.joining())));", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "974d33d82335c34455819059678fb587f88419e5"}, "originalPosition": 116}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzEwNTUwODAyOnYy", "diffSide": "RIGHT", "path": "nucleus/payara-modules/healthcheck-core/src/main/java/fish/payara/nucleus/healthcheck/configuration/MicroProfileMetricsChecker.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yOFQxNjoyMjozNVrOHZGJEw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yOFQxNjoyMjozNVrOHZGJEw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NjA3NzA3NQ==", "bodyText": "This should be an actual list IMO (@Element(\"metric\")), to prevent comma separated strings in XML files - which can cause all sorts of issues!", "url": "https://github.com/payara/Payara/pull/4918#discussion_r496077075", "createdAt": "2020-09-28T16:22:35Z", "author": {"login": "MattGill98"}, "path": "nucleus/payara-modules/healthcheck-core/src/main/java/fish/payara/nucleus/healthcheck/configuration/MicroProfileMetricsChecker.java", "diffHunk": "@@ -0,0 +1,70 @@\n+/*\n+ * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS HEADER.\n+ * \n+ *    Copyright (c) [2020] Payara Foundation and/or its affiliates. All rights reserved.\n+ * \n+ *     The contents of this file are subject to the terms of either the GNU\n+ *     General Public License Version 2 only (\"GPL\") or the Common Development\n+ *     and Distribution License(\"CDDL\") (collectively, the \"License\").  You\n+ *     may not use this file except in compliance with the License.  You can\n+ *     obtain a copy of the License at\n+ *     https://github.com/payara/Payara/blob/master/LICENSE.txt\n+ *     See the License for the specific\n+ *     language governing permissions and limitations under the License.\n+ * \n+ *     When distributing the software, include this License Header Notice in each\n+ *     file and include the License file at glassfish/legal/LICENSE.txt.\n+ * \n+ *     GPL Classpath Exception:\n+ *     The Payara Foundation designates this particular file as subject to the \"Classpath\"\n+ *     exception as provided by the Payara Foundation in the GPL Version 2 section of the License\n+ *     file that accompanied this code.\n+ * \n+ *     Modifications:\n+ *     If applicable, add the following below the License Header, with the fields\n+ *     enclosed by brackets [] replaced by your own identifying information:\n+ *     \"Portions Copyright [year] [name of copyright owner]\"\n+ * \n+ *     Contributor(s):\n+ *     If you wish your version of this file to be governed by only the CDDL or\n+ *     only the GPL Version 2, indicate your decision by adding \"[Contributor]\n+ *     elects to include this software in this distribution under the [CDDL or GPL\n+ *     Version 2] license.\"  If you don't indicate a single choice of license, a\n+ *     recipient has the option to distribute your version of this file under\n+ *     either the CDDL, the GPL Version 2 or to extend the choice of license to\n+ *     its licensees as provided above.  However, if you add GPL Version 2 code\n+ *     and therefore, elected the GPL Version 2 license, then the option applies\n+ *     only if the new code is made subject to such option by the copyright\n+ *     holder.\n+ */\n+package fish.payara.nucleus.healthcheck.configuration;\n+\n+import static fish.payara.nucleus.healthcheck.HealthCheckConstants.DEFAULT_MICROPROFILE_METRICS_NAME;\n+import org.jvnet.hk2.config.Attribute;\n+import org.jvnet.hk2.config.Configured;\n+\n+import java.beans.PropertyVetoException;\n+\n+/**\n+ * @author mertcaliskan\n+ */\n+@Configured\n+@CheckerConfigurationType(type = CheckerType.MP_METRICS)\n+public interface MicroProfileMetricsChecker extends Checker {\n+    \n+    @Attribute(defaultValue = DEFAULT_MICROPROFILE_METRICS_NAME)\n+    String getName();\n+    void setName(String value) throws PropertyVetoException;\n+\n+    @Attribute\n+    String getMetricsScope();\n+    void setMetricsScope(String metricsSource) throws PropertyVetoException;\n+    \n+    @Attribute\n+    String getMetricApplicationName();\n+    void setMetricApplicationName(String metricsType) throws PropertyVetoException;\n+    \n+    @Attribute", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "974d33d82335c34455819059678fb587f88419e5"}, "originalPosition": 67}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1229, "cost": 1, "resetAt": "2021-11-12T12:57:47Z"}}}