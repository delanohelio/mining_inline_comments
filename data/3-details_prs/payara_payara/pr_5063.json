{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTQyNjcxODI5", "number": 5063, "title": "[QACI-410] - Classloader Leak Tracking", "bodyText": "Description\nTechnically a new feature - adds a new sample app that allows for tracking the number of instances of WebappClassLoader before and after a series of deployments\nImportant Info\nTesting\nNew tests\nCurrently removed classloader leak test in samples - removed due to intergration blockers\nTesting Performed\nManual testing, deployed locally and returns an appropriate value for instance count\nTesting Environment\nOSX, Zulu JDK 1.8.0_272\nDocumentation\nREADME included with usage instructions\nNotes for Reviewers\nThis is an internal tool as it were, a step in the direction of being able to test for Classloader instance leaks (i.e. instances of WebappClassLoader that aren't garbage collected when they should be)\nExcuse the formatting in the Samples pom - NetBeans decided it would be fun to insert a new line between every line in the file", "createdAt": "2020-12-18T17:14:24Z", "url": "https://github.com/payara/Payara/pull/5063", "merged": true, "mergeCommit": {"oid": "75cc47823f5f9d6f401fa84fcdbaef8bbd55a310"}, "closed": true, "closedAt": "2020-12-26T21:58:51Z", "author": {"login": "cubastanley"}, "timelineItems": {"totalCount": 33, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdmIQa6AH2gAyNTQyNjcxODI5OjJhNWM5NDUzYTAwNjBjMzYzZmI2NjI0ODJhMGVlMDk0MmMzNTIyNzY=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdpyd8_AH2gAyNTQyNjcxODI5OjVkOWIwZWJhMzBkZWI1YTkyYTE2YjMzMDY2NGQyNzUwMjc5ODdmMzI=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "2a5c9453a0060c363fb662482a0ee0942c352276", "author": {"user": {"login": "cubastanley", "name": "Cuba Stanley"}}, "url": "https://github.com/payara/Payara/commit/2a5c9453a0060c363fb662482a0ee0942c352276", "committedDate": "2020-12-14T16:23:32Z", "message": "Add static instance count increment to WebappClassLoader"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "309f331ecd0c63fbff441de27fef70b382e9c650", "author": {"user": {"login": "cubastanley", "name": "Cuba Stanley"}}, "url": "https://github.com/payara/Payara/commit/309f331ecd0c63fbff441de27fef70b382e9c650", "committedDate": "2020-12-15T10:44:43Z", "message": "Update Year"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ae0526a3da9e6e11c8f0b48036c25b25b4e6c2df", "author": {"user": {"login": "cubastanley", "name": "Cuba Stanley"}}, "url": "https://github.com/payara/Payara/commit/ae0526a3da9e6e11c8f0b48036c25b25b4e6c2df", "committedDate": "2020-12-17T12:09:10Z", "message": "Create access api"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b1801435a551e484160e8324b772790cdbb95e6a", "author": {"user": {"login": "cubastanley", "name": "Cuba Stanley"}}, "url": "https://github.com/payara/Payara/commit/b1801435a551e484160e8324b772790cdbb95e6a", "committedDate": "2020-12-17T15:21:44Z", "message": "Store previous instance count"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "990420cda2b37bbe8a4e9e00a6ecf8fd544d7db4", "author": {"user": {"login": "cubastanley", "name": "Cuba Stanley"}}, "url": "https://github.com/payara/Payara/commit/990420cda2b37bbe8a4e9e00a6ecf8fd544d7db4", "committedDate": "2020-12-17T15:22:14Z", "message": "Introduce initial classloader leak test"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "0cbaf3fc9c09b789b9c1444470a6b8151bcc5105", "author": {"user": {"login": "cubastanley", "name": "Cuba Stanley"}}, "url": "https://github.com/payara/Payara/commit/0cbaf3fc9c09b789b9c1444470a6b8151bcc5105", "committedDate": "2020-12-18T16:50:13Z", "message": "Final value getter"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "2d4ced8d6a2cb025bb3818dc79ed01af27c19ef4", "author": {"user": {"login": "cubastanley", "name": "Cuba Stanley"}}, "url": "https://github.com/payara/Payara/commit/2d4ced8d6a2cb025bb3818dc79ed01af27c19ef4", "committedDate": "2020-12-18T16:53:33Z", "message": "Remove Samples Intergrations"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "824ee780de3fe07c4d7259124f6cbd3869b0b272", "author": {"user": {"login": "cubastanley", "name": "Cuba Stanley"}}, "url": "https://github.com/payara/Payara/commit/824ee780de3fe07c4d7259124f6cbd3869b0b272", "committedDate": "2020-12-18T16:53:55Z", "message": "WebappClassloader Init failures"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e81e7c40026baa8834e7f30cf1a2dd5b19a0a22a", "author": {"user": {"login": "cubastanley", "name": "Cuba Stanley"}}, "url": "https://github.com/payara/Payara/commit/e81e7c40026baa8834e7f30cf1a2dd5b19a0a22a", "committedDate": "2020-12-18T16:55:45Z", "message": "Remove module from samples"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "dcd22959da6183456a38b8a1a2609428e8a34b57", "author": {"user": {"login": "cubastanley", "name": "Cuba Stanley"}}, "url": "https://github.com/payara/Payara/commit/dcd22959da6183456a38b8a1a2609428e8a34b57", "committedDate": "2020-12-18T17:07:01Z", "message": "POM Formatting"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTU1NzE2NTk4", "url": "https://github.com/payara/Payara/pull/5063#pullrequestreview-555716598", "createdAt": "2020-12-18T18:26:50Z", "commit": {"oid": "dcd22959da6183456a38b8a1a2609428e8a34b57"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTU1NzI0ODg4", "url": "https://github.com/payara/Payara/pull/5063#pullrequestreview-555724888", "createdAt": "2020-12-18T18:40:01Z", "commit": {"oid": "dcd22959da6183456a38b8a1a2609428e8a34b57"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 11, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xOFQxODo0MDowMVrOIIuVHw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xOFQxODo0NzoyNVrOIIui9Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NjAxODU5MQ==", "bodyText": "no need for Jersey, use plain jax-js APIs instead", "url": "https://github.com/payara/Payara/pull/5063#discussion_r546018591", "createdAt": "2020-12-18T18:40:01Z", "author": {"login": "lprimak"}, "path": "appserver/tests/payara-samples/classloader-data-api/pom.xml", "diffHunk": "@@ -0,0 +1,70 @@\n+<?xml version=\"1.0\"?>\n+<project xsi:schemaLocation=\"http://maven.apache.org/POM/4.0.0 https://maven.apache.org/xsd/maven-4.0.0.xsd\" xmlns=\"http://maven.apache.org/POM/4.0.0\"\n+         xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\">\n+    <modelVersion>4.0.0</modelVersion>\n+    <parent>\n+        <groupId>fish.payara.samples</groupId>\n+        <artifactId>payara-samples</artifactId>\n+        <version>5.2020.8-SNAPSHOT</version>\n+    </parent>\n+    \n+    <groupId>fish.payara.samples</groupId>\n+    <artifactId>classloader-data-api</artifactId>\n+    <version>5.2020.8-SNAPSHOT</version>\n+    \n+    <packaging>war</packaging>\n+    <name>Payara Samples - ClassLoader Data API</name>\n+    <description>A REST API Application for retrieving an instance count of \n+        WebappClassLoader from an instance of Payara Server</description>\n+    \n+    <properties>\n+        <jersey.version>3.0.0</jersey.version>\n+        <project.build.sourceEncoding>UTF-8</project.build.sourceEncoding>\n+    </properties>\n+    \n+    <dependencyManagement>", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "dcd22959da6183456a38b8a1a2609428e8a34b57"}, "originalPosition": 25}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NjAxODc2Ng==", "bodyText": "same here, use plain jax-rs APIs", "url": "https://github.com/payara/Payara/pull/5063#discussion_r546018766", "createdAt": "2020-12-18T18:40:24Z", "author": {"login": "lprimak"}, "path": "appserver/tests/payara-samples/classloader-data-api/pom.xml", "diffHunk": "@@ -0,0 +1,70 @@\n+<?xml version=\"1.0\"?>\n+<project xsi:schemaLocation=\"http://maven.apache.org/POM/4.0.0 https://maven.apache.org/xsd/maven-4.0.0.xsd\" xmlns=\"http://maven.apache.org/POM/4.0.0\"\n+         xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\">\n+    <modelVersion>4.0.0</modelVersion>\n+    <parent>\n+        <groupId>fish.payara.samples</groupId>\n+        <artifactId>payara-samples</artifactId>\n+        <version>5.2020.8-SNAPSHOT</version>\n+    </parent>\n+    \n+    <groupId>fish.payara.samples</groupId>\n+    <artifactId>classloader-data-api</artifactId>\n+    <version>5.2020.8-SNAPSHOT</version>\n+    \n+    <packaging>war</packaging>\n+    <name>Payara Samples - ClassLoader Data API</name>\n+    <description>A REST API Application for retrieving an instance count of \n+        WebappClassLoader from an instance of Payara Server</description>\n+    \n+    <properties>\n+        <jersey.version>3.0.0</jersey.version>\n+        <project.build.sourceEncoding>UTF-8</project.build.sourceEncoding>\n+    </properties>\n+    \n+    <dependencyManagement>\n+        <dependencies>\n+            <dependency>\n+                <groupId>org.glassfish.jersey</groupId>\n+                <artifactId>jersey-bom</artifactId>\n+                <version>${jersey.version}</version>\n+                <type>pom</type>\n+                <scope>import</scope>\n+            </dependency>\n+        </dependencies>\n+    </dependencyManagement>\n+    \n+    <dependencies>\n+        <dependency>\n+            <groupId>org.glassfish.jersey.containers</groupId>", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "dcd22959da6183456a38b8a1a2609428e8a34b57"}, "originalPosition": 39}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NjAxOTA1OQ==", "bodyText": "no need for this section at all, use properties equivalent\nThis way you don't override the complier plugin version at all", "url": "https://github.com/payara/Payara/pull/5063#discussion_r546019059", "createdAt": "2020-12-18T18:41:00Z", "author": {"login": "lprimak"}, "path": "appserver/tests/payara-samples/classloader-data-api/pom.xml", "diffHunk": "@@ -0,0 +1,70 @@\n+<?xml version=\"1.0\"?>\n+<project xsi:schemaLocation=\"http://maven.apache.org/POM/4.0.0 https://maven.apache.org/xsd/maven-4.0.0.xsd\" xmlns=\"http://maven.apache.org/POM/4.0.0\"\n+         xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\">\n+    <modelVersion>4.0.0</modelVersion>\n+    <parent>\n+        <groupId>fish.payara.samples</groupId>\n+        <artifactId>payara-samples</artifactId>\n+        <version>5.2020.8-SNAPSHOT</version>\n+    </parent>\n+    \n+    <groupId>fish.payara.samples</groupId>\n+    <artifactId>classloader-data-api</artifactId>\n+    <version>5.2020.8-SNAPSHOT</version>\n+    \n+    <packaging>war</packaging>\n+    <name>Payara Samples - ClassLoader Data API</name>\n+    <description>A REST API Application for retrieving an instance count of \n+        WebappClassLoader from an instance of Payara Server</description>\n+    \n+    <properties>\n+        <jersey.version>3.0.0</jersey.version>\n+        <project.build.sourceEncoding>UTF-8</project.build.sourceEncoding>\n+    </properties>\n+    \n+    <dependencyManagement>\n+        <dependencies>\n+            <dependency>\n+                <groupId>org.glassfish.jersey</groupId>\n+                <artifactId>jersey-bom</artifactId>\n+                <version>${jersey.version}</version>\n+                <type>pom</type>\n+                <scope>import</scope>\n+            </dependency>\n+        </dependencies>\n+    </dependencyManagement>\n+    \n+    <dependencies>\n+        <dependency>\n+            <groupId>org.glassfish.jersey.containers</groupId>\n+            <artifactId>jersey-container-servlet-core</artifactId>\n+        </dependency>\n+        <dependency>\n+            <groupId>org.glassfish.jersey.inject</groupId>\n+            <artifactId>jersey-hk2</artifactId>\n+        </dependency>\n+        \n+        <!-- Payara Dependencies -->\n+        <dependency>\n+            <groupId>fish.payara.server.internal.web</groupId>\n+            <artifactId>war-util</artifactId>\n+            <version>${project.version}</version>\n+            <scope>provided</scope>\n+        </dependency>\n+    </dependencies>\n+    \n+    <build>", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "dcd22959da6183456a38b8a1a2609428e8a34b57"}, "originalPosition": 56}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NjAxOTMxNw==", "bodyText": "full Payara copyright", "url": "https://github.com/payara/Payara/pull/5063#discussion_r546019317", "createdAt": "2020-12-18T18:41:31Z", "author": {"login": "lprimak"}, "path": "appserver/tests/payara-samples/classloader-data-api/src/main/java/fish/payara/samples/classloaderdata/InstanceCountService.java", "diffHunk": "@@ -0,0 +1,25 @@\n+/*", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "dcd22959da6183456a38b8a1a2609428e8a34b57"}, "originalPosition": 1}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NjAxOTU1Ng==", "bodyText": "Not sure this is necessary at all", "url": "https://github.com/payara/Payara/pull/5063#discussion_r546019556", "createdAt": "2020-12-18T18:42:00Z", "author": {"login": "lprimak"}, "path": "appserver/tests/payara-samples/classloader-data-api/src/main/java/fish/payara/samples/classloaderdata/InstanceCountService.java", "diffHunk": "@@ -0,0 +1,25 @@\n+/*\n+ * To change this license header, choose License Headers in Project Properties.\n+ * To change this template file, choose Tools | Templates\n+ * and open the template in the editor.\n+ */\n+package fish.payara.samples.classloaderdata;\n+\n+/**\n+ *\n+ * @author cuba\n+ */\n+public class InstanceCountService {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "dcd22959da6183456a38b8a1a2609428e8a34b57"}, "originalPosition": 12}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NjAyMDQwOQ==", "bodyText": "I would move instance count into own class, not have instance counts in different classes.\nMinimize changes to WebappClassLoader\nAlso, this doesn't touch non-webapp (jar, ear etc) class loaders", "url": "https://github.com/payara/Payara/pull/5063#discussion_r546020409", "createdAt": "2020-12-18T18:43:52Z", "author": {"login": "lprimak"}, "path": "appserver/tests/payara-samples/classloader-data-api/src/main/java/fish/payara/samples/classloaderdata/InstanceCountTracker.java", "diffHunk": "@@ -0,0 +1,36 @@\n+/*\n+ * To change this license header, choose License Headers in Project Properties.\n+ * To change this template file, choose Tools | Templates\n+ * and open the template in the editor.\n+ */\n+package fish.payara.samples.classloaderdata;\n+\n+import java.lang.ref.Reference;\n+import org.glassfish.web.loader.WebappClassLoader;\n+import org.glassfish.web.loader.WebappClassLoaderFinalizer;\n+\n+/**\n+ *\n+ * @author Cuba Stanley\n+ */\n+public class InstanceCountTracker {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "dcd22959da6183456a38b8a1a2609428e8a34b57"}, "originalPosition": 16}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NjAyMDc0OQ==", "bodyText": "no need for this file, use plain jax-rs APIs", "url": "https://github.com/payara/Payara/pull/5063#discussion_r546020749", "createdAt": "2020-12-18T18:44:36Z", "author": {"login": "lprimak"}, "path": "appserver/tests/payara-samples/classloader-data-api/src/main/webapp/WEB-INF/web.xml", "diffHunk": "@@ -0,0 +1,18 @@\n+<?xml version=\"1.0\" encoding=\"UTF-8\"?>", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "dcd22959da6183456a38b8a1a2609428e8a34b57"}, "originalPosition": 1}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NjAyMTA1OA==", "bodyText": "possible race condition, should be AtomicInteger", "url": "https://github.com/payara/Payara/pull/5063#discussion_r546021058", "createdAt": "2020-12-18T18:45:13Z", "author": {"login": "lprimak"}, "path": "appserver/web/war-util/src/main/java/org/glassfish/web/loader/WebappClassLoader.java", "diffHunk": "@@ -408,9 +409,25 @@\n     private static final boolean IS_JDK_VERSION_HIGHER_THAN_8 = JDK.getMajor() > 8;\n     private static Boolean isMultiReleaseJar;\n     private static final Name MULTI_RELEASE = new Name(\"Multi-Release\");\n+    \n+    private static int INSTANCE_COUNT;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "dcd22959da6183456a38b8a1a2609428e8a34b57"}, "originalPosition": 22}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NjAyMTI5NQ==", "bodyText": "this cast is a code smell, this needs to be refactored", "url": "https://github.com/payara/Payara/pull/5063#discussion_r546021295", "createdAt": "2020-12-18T18:45:41Z", "author": {"login": "lprimak"}, "path": "appserver/tests/payara-samples/classloader-data-api/src/main/java/fish/payara/samples/classloaderdata/InstanceCountTracker.java", "diffHunk": "@@ -0,0 +1,36 @@\n+/*\n+ * To change this license header, choose License Headers in Project Properties.\n+ * To change this template file, choose Tools | Templates\n+ * and open the template in the editor.\n+ */\n+package fish.payara.samples.classloaderdata;\n+\n+import java.lang.ref.Reference;\n+import org.glassfish.web.loader.WebappClassLoader;\n+import org.glassfish.web.loader.WebappClassLoaderFinalizer;\n+\n+/**\n+ *\n+ * @author Cuba Stanley\n+ */\n+public class InstanceCountTracker {\n+    \n+    private static int previousInstanceCount;\n+    \n+    public static int getInstanceCount() {\n+        System.gc();\n+        Reference<? extends WebappClassLoader> referenceFromQueue;\n+        while((referenceFromQueue = WebappClassLoader.referenceQueue.poll()) != null) {\n+            ((WebappClassLoaderFinalizer)referenceFromQueue).cleanupAction();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "dcd22959da6183456a38b8a1a2609428e8a34b57"}, "originalPosition": 24}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NjAyMjA0NQ==", "bodyText": "oracle copyrights should not be changed", "url": "https://github.com/payara/Payara/pull/5063#discussion_r546022045", "createdAt": "2020-12-18T18:47:12Z", "author": {"login": "lprimak"}, "path": "appserver/web/war-util/src/main/java/org/glassfish/web/loader/WebappClassLoader.java", "diffHunk": "@@ -1,7 +1,7 @@\n /*\n  * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS HEADER.\n  *\n- * Copyright (c) 1997-2019 Oracle and/or its affiliates. All rights reserved.\n+ * Copyright (c) 1997-2020 Oracle and/or its affiliates. All rights reserved.", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "dcd22959da6183456a38b8a1a2609428e8a34b57"}, "originalPosition": 5}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NjAyMjEzMw==", "bodyText": "needs full copyright, not just portions", "url": "https://github.com/payara/Payara/pull/5063#discussion_r546022133", "createdAt": "2020-12-18T18:47:25Z", "author": {"login": "lprimak"}, "path": "appserver/web/war-util/src/main/java/org/glassfish/web/loader/WebappClassLoaderFinalizer.java", "diffHunk": "@@ -0,0 +1,21 @@\n+// Portions Copyright [2020] [Payara Foundation and/or its affiliates]", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "dcd22959da6183456a38b8a1a2609428e8a34b57"}, "originalPosition": 1}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTU1NzMxNTg1", "url": "https://github.com/payara/Payara/pull/5063#pullrequestreview-555731585", "createdAt": "2020-12-18T18:50:34Z", "commit": {"oid": "dcd22959da6183456a38b8a1a2609428e8a34b57"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xOFQxODo1MDozNFrOIIupcw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xOFQxODo1MDozNFrOIIupcw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NjAyMzc5NQ==", "bodyText": "I would just revert and start this file over again", "url": "https://github.com/payara/Payara/pull/5063#discussion_r546023795", "createdAt": "2020-12-18T18:50:34Z", "author": {"login": "lprimak"}, "path": "appserver/tests/payara-samples/pom.xml", "diffHunk": "@@ -37,60 +37,56 @@\n  *    and therefore, elected the GPL Version 2 license, then the option applies\n  *    only if the new code is made subject to such option by the copyright\n  *    holder.\n--->\n-<project xmlns=\"http://maven.apache.org/POM/4.0.0\"\n-    xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\"\n-    xsi:schemaLocation=\"http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd\">\n+--><project xmlns=\"http://maven.apache.org/POM/4.0.0\" xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\" xsi:schemaLocation=\"http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd\">", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "dcd22959da6183456a38b8a1a2609428e8a34b57"}, "originalPosition": 14}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "cbbf4712cc827f9ec5ca2e9aca8e8f2ba02d3050", "author": {"user": {"login": "cubastanley", "name": "Cuba Stanley"}}, "url": "https://github.com/payara/Payara/commit/cbbf4712cc827f9ec5ca2e9aca8e8f2ba02d3050", "committedDate": "2020-12-21T11:14:11Z", "message": "Use basic jax-rs"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "0f33befc1d32cd6b1fa52743314ed5f2b3718752", "author": {"user": {"login": "cubastanley", "name": "Cuba Stanley"}}, "url": "https://github.com/payara/Payara/commit/0f33befc1d32cd6b1fa52743314ed5f2b3718752", "committedDate": "2020-12-21T13:48:53Z", "message": "Revert samples pom tweaks"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "17fc3412444a9ce2c14fe11db08f5d5b81e13539", "author": {"user": {"login": "cubastanley", "name": "Cuba Stanley"}}, "url": "https://github.com/payara/Payara/commit/17fc3412444a9ce2c14fe11db08f5d5b81e13539", "committedDate": "2020-12-21T13:58:02Z", "message": "Update license headers"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "74b2b93f7b991b661caa7ce224060c57a21be06d", "author": {"user": {"login": "cubastanley", "name": "Cuba Stanley"}}, "url": "https://github.com/payara/Payara/commit/74b2b93f7b991b661caa7ce224060c57a21be06d", "committedDate": "2020-12-21T14:10:04Z", "message": "Reset samples pom"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "d06040ab969aa8add2aefd3334c128e3a006daa7", "author": {"user": {"login": "cubastanley", "name": "Cuba Stanley"}}, "url": "https://github.com/payara/Payara/commit/d06040ab969aa8add2aefd3334c128e3a006daa7", "committedDate": "2020-12-21T16:51:31Z", "message": "Refactor casting"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTU2ODI1MTY0", "url": "https://github.com/payara/Payara/pull/5063#pullrequestreview-556825164", "createdAt": "2020-12-22T05:20:26Z", "commit": {"oid": "d06040ab969aa8add2aefd3334c128e3a006daa7"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 7, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0yMlQwNToyMDoyNlrOIJuu0g==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0yMlQwNToyNjo0NVrOIJu1Pg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NzA3Mzc0Ng==", "bodyText": "remove jersey", "url": "https://github.com/payara/Payara/pull/5063#discussion_r547073746", "createdAt": "2020-12-22T05:20:26Z", "author": {"login": "lprimak"}, "path": "appserver/tests/payara-samples/classloader-data-api/pom.xml", "diffHunk": "@@ -0,0 +1,45 @@\n+<?xml version=\"1.0\"?>\n+<project xsi:schemaLocation=\"http://maven.apache.org/POM/4.0.0 https://maven.apache.org/xsd/maven-4.0.0.xsd\" xmlns=\"http://maven.apache.org/POM/4.0.0\"\n+         xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\">\n+    <modelVersion>4.0.0</modelVersion>\n+    <parent>\n+        <groupId>fish.payara.samples</groupId>\n+        <artifactId>payara-samples</artifactId>\n+        <version>5.2020.8-SNAPSHOT</version>\n+    </parent>\n+    \n+    <groupId>fish.payara.samples</groupId>\n+    <artifactId>classloader-data-api</artifactId>\n+    <version>5.2020.8-SNAPSHOT</version>\n+    \n+    <packaging>war</packaging>\n+    <name>Payara Samples - ClassLoader Data API</name>\n+    <description>A REST API Application for retrieving an instance count of \n+        WebappClassLoader from an instance of Payara Server</description>\n+    \n+    <properties>\n+        <jersey.version>3.0.0</jersey.version>", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d06040ab969aa8add2aefd3334c128e3a006daa7"}, "originalPosition": 21}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NzA3Mzk0OQ==", "bodyText": "Need the same functionality for ASURLClassLoader (parent of EARClassLoader EJBClassLoader etc)", "url": "https://github.com/payara/Payara/pull/5063#discussion_r547073949", "createdAt": "2020-12-22T05:21:26Z", "author": {"login": "lprimak"}, "path": "appserver/tests/payara-samples/classloader-data-api/pom.xml", "diffHunk": "@@ -0,0 +1,45 @@\n+<?xml version=\"1.0\"?>\n+<project xsi:schemaLocation=\"http://maven.apache.org/POM/4.0.0 https://maven.apache.org/xsd/maven-4.0.0.xsd\" xmlns=\"http://maven.apache.org/POM/4.0.0\"\n+         xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\">\n+    <modelVersion>4.0.0</modelVersion>\n+    <parent>\n+        <groupId>fish.payara.samples</groupId>\n+        <artifactId>payara-samples</artifactId>\n+        <version>5.2020.8-SNAPSHOT</version>\n+    </parent>\n+    \n+    <groupId>fish.payara.samples</groupId>\n+    <artifactId>classloader-data-api</artifactId>\n+    <version>5.2020.8-SNAPSHOT</version>\n+    \n+    <packaging>war</packaging>\n+    <name>Payara Samples - ClassLoader Data API</name>\n+    <description>A REST API Application for retrieving an instance count of \n+        WebappClassLoader from an instance of Payara Server</description>", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d06040ab969aa8add2aefd3334c128e3a006daa7"}, "originalPosition": 18}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NzA3NDYwOA==", "bodyText": "I still see no point in this class, it does nothing.\nInstanceCountTracker can be used directly.", "url": "https://github.com/payara/Payara/pull/5063#discussion_r547074608", "createdAt": "2020-12-22T05:23:57Z", "author": {"login": "lprimak"}, "path": "appserver/tests/payara-samples/classloader-data-api/src/main/java/fish/payara/samples/classloaderdata/InstanceCountService.java", "diffHunk": "@@ -0,0 +1,25 @@\n+/*\n+ * To change this license header, choose License Headers in Project Properties.\n+ * To change this template file, choose Tools | Templates\n+ * and open the template in the editor.\n+ */\n+package fish.payara.samples.classloaderdata;\n+\n+/**\n+ *\n+ * @author cuba\n+ */\n+public class InstanceCountService {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NjAxOTU1Ng=="}, "originalCommit": {"oid": "dcd22959da6183456a38b8a1a2609428e8a34b57"}, "originalPosition": 12}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NzA3NDkzMg==", "bodyText": "needs intent javadoc", "url": "https://github.com/payara/Payara/pull/5063#discussion_r547074932", "createdAt": "2020-12-22T05:25:13Z", "author": {"login": "lprimak"}, "path": "appserver/tests/payara-samples/classloader-data-api/src/main/java/fish/payara/samples/classloaderdata/InstanceCountTracker.java", "diffHunk": "@@ -0,0 +1,69 @@\n+/*\n+ * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS HEADER.\n+ *\n+ * Copyright (c) [2020] Payara Foundation and/or its affiliates. All rights reserved.\n+ *\n+ * The contents of this file are subject to the terms of either the GNU\n+ * General Public License Version 2 only (\"GPL\") or the Common Development\n+ * and Distribution License(\"CDDL\") (collectively, the \"License\").  You\n+ * may not use this file except in compliance with the License.  You can\n+ * obtain a copy of the License at\n+ * https://github.com/payara/Payara/blob/master/LICENSE.txt\n+ * See the License for the specific\n+ * language governing permissions and limitations under the License.\n+ *\n+ * When distributing the software, include this License Header Notice in each\n+ * file and include the License file at glassfish/legal/LICENSE.txt.\n+ *\n+ * GPL Classpath Exception:\n+ * The Payara Foundation designates this particular file as subject to the \"Classpath\"\n+ * exception as provided by the Payara Foundation in the GPL Version 2 section of the License\n+ * file that accompanied this code.\n+ *\n+ * Modifications:\n+ * If applicable, add the following below the License Header, with the fields\n+ * enclosed by brackets [] replaced by your own identifying information:\n+ * \"Portions Copyright [year] [name of copyright owner]\"\n+ *\n+ * Contributor(s):\n+ * If you wish your version of this file to be governed by only the CDDL or\n+ * only the GPL Version 2, indicate your decision by adding \"[Contributor]\n+ * elects to include this software in this distribution under the [CDDL or GPL\n+ * Version 2] license.\"  If you don't indicate a single choice of license, a\n+ * recipient has the option to distribute your version of this file under\n+ * either the CDDL, the GPL Version 2 or to extend the choice of license to\n+ * its licensees as provided above.  However, if you add GPL Version 2 code\n+ * and therefore, elected the GPL Version 2 license, then the option applies\n+ * only if the new code is made subject to such option by the copyright\n+ * holder.\n+ */\n+package fish.payara.samples.classloaderdata;\n+\n+import java.lang.ref.Reference;\n+import org.glassfish.web.loader.WebappClassLoader;\n+\n+/**\n+ *\n+ * @author Cuba Stanley\n+ */\n+public class InstanceCountTracker {\n+    \n+    private static int previousInstanceCount;\n+    \n+    public static int getInstanceCount() {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d06040ab969aa8add2aefd3334c128e3a006daa7"}, "originalPosition": 53}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NzA3NTIxOQ==", "bodyText": "should be final", "url": "https://github.com/payara/Payara/pull/5063#discussion_r547075219", "createdAt": "2020-12-22T05:26:12Z", "author": {"login": "lprimak"}, "path": "appserver/web/war-util/src/main/java/org/glassfish/web/loader/WebappClassLoader.java", "diffHunk": "@@ -409,8 +411,14 @@\n     private static Boolean isMultiReleaseJar;\n     private static final Name MULTI_RELEASE = new Name(\"Multi-Release\");\n \n-    static {\n+    public static ReferenceQueue<WebappClassLoader> referenceQueue = new ReferenceQueue<WebappClassLoader>();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d06040ab969aa8add2aefd3334c128e3a006daa7"}, "originalPosition": 21}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NzA3NTI3Mw==", "bodyText": "should be final", "url": "https://github.com/payara/Payara/pull/5063#discussion_r547075273", "createdAt": "2020-12-22T05:26:24Z", "author": {"login": "lprimak"}, "path": "appserver/web/war-util/src/main/java/org/glassfish/web/loader/WebappClassLoader.java", "diffHunk": "@@ -409,8 +411,14 @@\n     private static Boolean isMultiReleaseJar;\n     private static final Name MULTI_RELEASE = new Name(\"Multi-Release\");\n \n-    static {\n+    public static ReferenceQueue<WebappClassLoader> referenceQueue = new ReferenceQueue<WebappClassLoader>();\n+    public static ArrayList<WebappClassLoaderFinalizer> list = new ArrayList<WebappClassLoaderFinalizer>();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d06040ab969aa8add2aefd3334c128e3a006daa7"}, "originalPosition": 22}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NzA3NTM5MA==", "bodyText": "is isn't really standard, you should move it down into the static block", "url": "https://github.com/payara/Payara/pull/5063#discussion_r547075390", "createdAt": "2020-12-22T05:26:45Z", "author": {"login": "lprimak"}, "path": "appserver/web/war-util/src/main/java/org/glassfish/web/loader/WebappClassLoader.java", "diffHunk": "@@ -409,8 +411,14 @@\n     private static Boolean isMultiReleaseJar;\n     private static final Name MULTI_RELEASE = new Name(\"Multi-Release\");\n \n-    static {\n+    public static ReferenceQueue<WebappClassLoader> referenceQueue = new ReferenceQueue<WebappClassLoader>();\n+    public static ArrayList<WebappClassLoaderFinalizer> list = new ArrayList<WebappClassLoaderFinalizer>();\n+    {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d06040ab969aa8add2aefd3334c128e3a006daa7"}, "originalPosition": 23}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "6168ccf33f5a3dc07d89e85c28d1b77a37bf338c", "author": {"user": {"login": "cubastanley", "name": "Cuba Stanley"}}, "url": "https://github.com/payara/Payara/commit/6168ccf33f5a3dc07d89e85c28d1b77a37bf338c", "committedDate": "2020-12-22T09:40:07Z", "message": "Remove InstanceCountService"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "bbf2016c766e9b5c7646fcb42fb60275511d1562", "author": {"user": {"login": "cubastanley", "name": "Cuba Stanley"}}, "url": "https://github.com/payara/Payara/commit/bbf2016c766e9b5c7646fcb42fb60275511d1562", "committedDate": "2020-12-23T15:32:22Z", "message": "Updates to WebappClassLoader"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "871dea3ea89c867f1c493a48915744863039c733", "author": {"user": {"login": "cubastanley", "name": "Cuba Stanley"}}, "url": "https://github.com/payara/Payara/commit/871dea3ea89c867f1c493a48915744863039c733", "committedDate": "2020-12-23T15:32:46Z", "message": "Improve functionality and usibility of api"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTU4MDI0NjQ4", "url": "https://github.com/payara/Payara/pull/5063#pullrequestreview-558024648", "createdAt": "2020-12-23T16:06:03Z", "commit": {"oid": "871dea3ea89c867f1c493a48915744863039c733"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0yM1QxNjowNjowM1rOIKpHlQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0yM1QxNjowNjowM1rOIKpHlQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0ODAzMDM1Nw==", "bodyText": "This does not seem to be thread safe too.", "url": "https://github.com/payara/Payara/pull/5063#discussion_r548030357", "createdAt": "2020-12-23T16:06:03Z", "author": {"login": "sgflt"}, "path": "appserver/web/war-util/src/main/java/org/glassfish/web/loader/WebappClassLoader.java", "diffHunk": "@@ -1887,8 +1894,11 @@ protected PermissionCollection getPermissions(CodeSource codeSource) {\n \n \n     private void init() {\n-\n+        \n         this.parent = getParent();\n+        \n+        list.add(new PhantomReference(this, referenceQueue));\n+        INSTANCE_COUNT.set(INSTANCE_COUNT.get() + 1);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "871dea3ea89c867f1c493a48915744863039c733"}, "originalPosition": 38}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c108c89fdd46434fdb1179be09bbd157be17be7f", "author": {"user": {"login": "cubastanley", "name": "Cuba Stanley"}}, "url": "https://github.com/payara/Payara/commit/c108c89fdd46434fdb1179be09bbd157be17be7f", "committedDate": "2020-12-23T16:18:14Z", "message": "Include ASURL counter"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTU4MTUxNzg2", "url": "https://github.com/payara/Payara/pull/5063#pullrequestreview-558151786", "createdAt": "2020-12-23T18:03:33Z", "commit": {"oid": "c108c89fdd46434fdb1179be09bbd157be17be7f"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "deb058d864b29ca003cbcdf35e343bba5a42d471", "author": {"user": {"login": "lprimak", "name": "Lenny Primak"}}, "url": "https://github.com/payara/Payara/commit/deb058d864b29ca003cbcdf35e343bba5a42d471", "committedDate": "2020-12-24T18:41:15Z", "message": "Merge branch 'master' into QACI-410-classloader-test"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "824ad47bc75a122c24c090cdcc2e8f87c20bb185", "author": {"user": {"login": "lprimak", "name": "Lenny Primak"}}, "url": "https://github.com/payara/Payara/commit/824ad47bc75a122c24c090cdcc2e8f87c20bb185", "committedDate": "2020-12-25T05:30:01Z", "message": "refactored, added ability to see active classloaders in real time"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f0430778c6d13df47206fa98bbe35ebc42ae9b99", "author": {"user": {"login": "lprimak", "name": "Lenny Primak"}}, "url": "https://github.com/payara/Payara/commit/f0430778c6d13df47206fa98bbe35ebc42ae9b99", "committedDate": "2020-12-25T05:58:16Z", "message": "removed unnecessary generics"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a98332734a79f81cee97fe4cf17b115288f21048", "author": {"user": {"login": "lprimak", "name": "Lenny Primak"}}, "url": "https://github.com/payara/Payara/commit/a98332734a79f81cee97fe4cf17b115288f21048", "committedDate": "2020-12-25T06:39:14Z", "message": "stablized, added additional unit tests"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTU4NzY3NDU5", "url": "https://github.com/payara/Payara/pull/5063#pullrequestreview-558767459", "createdAt": "2020-12-25T06:39:38Z", "commit": {"oid": "a98332734a79f81cee97fe4cf17b115288f21048"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTU4ODM0NTY3", "url": "https://github.com/payara/Payara/pull/5063#pullrequestreview-558834567", "createdAt": "2020-12-25T19:43:05Z", "commit": {"oid": "a98332734a79f81cee97fe4cf17b115288f21048"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0yNVQxOTo0MzowNVrOILei3Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0yNVQxOTo0MzowNVrOILei3Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0ODkwNTY5Mw==", "bodyText": "I would use ConcurrentMap interface to point that there is expected concurrency.\n\n  \n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                private static final Map<Class<?>, Count> INSTANCE_COUNT = new ConcurrentHashMap<>();\n          \n          \n            \n                private static final ConcurrentMap<Class<?>, Count> INSTANCE_COUNT = new ConcurrentHashMap<>();", "url": "https://github.com/payara/Payara/pull/5063#discussion_r548905693", "createdAt": "2020-12-25T19:43:05Z", "author": {"login": "sgflt"}, "path": "nucleus/common/common-util/src/main/java/org/glassfish/common/util/InstanceCounter.java", "diffHunk": "@@ -0,0 +1,145 @@\n+/*\n+ * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS HEADER.\n+ *\n+ * Copyright (c) [2020] Payara Foundation and/or its affiliates. All rights reserved.\n+ *\n+ * The contents of this file are subject to the terms of either the GNU\n+ * General Public License Version 2 only (\"GPL\") or the Common Development\n+ * and Distribution License(\"CDDL\") (collectively, the \"License\").  You\n+ * may not use this file except in compliance with the License.  You can\n+ * obtain a copy of the License at\n+ * https://github.com/payara/Payara/blob/master/LICENSE.txt\n+ * See the License for the specific\n+ * language governing permissions and limitations under the License.\n+ *\n+ * When distributing the software, include this License Header Notice in each\n+ * file and include the License file at glassfish/legal/LICENSE.txt.\n+ *\n+ * GPL Classpath Exception:\n+ * The Payara Foundation designates this particular file as subject to the \"Classpath\"\n+ * exception as provided by the Payara Foundation in the GPL Version 2 section of the License\n+ * file that accompanied this code.\n+ *\n+ * Modifications:\n+ * If applicable, add the following below the License Header, with the fields\n+ * enclosed by brackets [] replaced by your own identifying information:\n+ * \"Portions Copyright [year] [name of copyright owner]\"\n+ *\n+ * Contributor(s):\n+ * If you wish your version of this file to be governed by only the CDDL or\n+ * only the GPL Version 2, indicate your decision by adding \"[Contributor]\n+ * elects to include this software in this distribution under the [CDDL or GPL\n+ * Version 2] license.\"  If you don't indicate a single choice of license, a\n+ * recipient has the option to distribute your version of this file under\n+ * either the CDDL, the GPL Version 2 or to extend the choice of license to\n+ * its licensees as provided above.  However, if you add GPL Version 2 code\n+ * and therefore, elected the GPL Version 2 license, then the option applies\n+ * only if the new code is made subject to such option by the copyright\n+ * holder.\n+ */\n+package org.glassfish.common.util;\n+\n+import java.lang.ref.Reference;\n+import java.lang.ref.ReferenceQueue;\n+import java.lang.ref.WeakReference;\n+import java.util.Collections;\n+import java.util.IdentityHashMap;\n+import java.util.Map;\n+import java.util.Set;\n+import java.util.concurrent.ConcurrentHashMap;\n+\n+/**\n+ * Counts instances of a particular class, helpful in leak detection\n+ * <p>\n+ * Example: Put the following line into the class you want counted:\n+ * <p>\n+ * {@code\n+ *     private final InstanceCounter<MyClass> instanceCounter = new InstanceCounter<>(this);\n+ * }\n+ *\n+ * @author Cuba Stanley\n+ */\n+public class InstanceCounter {\n+    private static class Count {\n+        int instanceCount;\n+        private final ReferenceQueue<Object> referenceQueue = new ReferenceQueue<>();\n+        private final Set<WeakReference<?>> references = Collections.newSetFromMap(new IdentityHashMap<>());\n+\n+        public Count() {\n+            instanceCount = 1;\n+        }\n+\n+        public Count(int instanceCount) {\n+            this.instanceCount = instanceCount;\n+        }\n+    }\n+\n+    private static final Map<Class<?>, Count> INSTANCE_COUNT = new ConcurrentHashMap<>();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "a98332734a79f81cee97fe4cf17b115288f21048"}, "originalPosition": 77}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "fb459f96231eae9da70019a780b7ee5c9cd6a103", "author": {"user": {"login": "lprimak", "name": "Lenny Primak"}}, "url": "https://github.com/payara/Payara/commit/fb459f96231eae9da70019a780b7ee5c9cd6a103", "committedDate": "2020-12-26T00:53:43Z", "message": "Update nucleus/common/common-util/src/main/java/org/glassfish/common/util/InstanceCounter.java\n\nCo-authored-by: Luk\u00e1\u0161 Kv\u00eddera <lukas.kvidera@seznam.cz>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "5d9b0eba30deb5a92a16b330664d275027987f32", "author": {"user": {"login": "lprimak", "name": "Lenny Primak"}}, "url": "https://github.com/payara/Payara/commit/5d9b0eba30deb5a92a16b330664d275027987f32", "committedDate": "2020-12-26T01:16:06Z", "message": "import fix"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 645, "cost": 1, "resetAt": "2021-11-01T16:19:10Z"}}}