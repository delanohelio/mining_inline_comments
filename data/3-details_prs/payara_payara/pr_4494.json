{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0Mzc1NDE0MDU4", "number": 4494, "title": "CUSTCOM-203 Referenced component name in OpenApi 'paths' sec\u2026", "bodyText": "\u2026tion use name from the Schema annotation\nDescription\nThis is a bug fix of #4490\nImportant Info\nTesting\nCreated test class OASchemaReferenceNameTest. Tests whether the name is picked up from the Schema annotation, if present and the name  is not empty (default is empty). Otherwise it will use simple name of the class - which is in line with how the \"components\" schemas behave.\nTesting Environment\nJDK 1.8.0_241\nDocumentation\nNotes for Reviewers\nOASchemaReferenceNameTest and its schemaComponentReferenceNaming method. The test class is self-contained - everything required for this particular test case is there.", "createdAt": "2020-02-14T14:25:22Z", "url": "https://github.com/payara/Payara/pull/4494", "merged": true, "mergeCommit": {"oid": "ea444378cc02b02324bf77b6795f530def76a5f6"}, "closed": true, "closedAt": "2020-02-20T14:40:38Z", "author": {"login": "Pscheidl"}, "timelineItems": {"totalCount": 16, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcEQazOABqjMwMzg5MjQ2ODY=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcGMHt1gFqTM2MTk1MTQxNA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "a66e73895fd3b090c9a056c0cee9bd25b8aafea6", "author": {"user": null}, "url": "https://github.com/payara/Payara/commit/a66e73895fd3b090c9a056c0cee9bd25b8aafea6", "committedDate": "2020-02-14T14:24:15Z", "message": "MICROPROFILE #4490 - Referenced component name in OpenApi 'paths' section use name from the Schema annotation"}, "afterCommit": {"oid": "0b48687705b336f4f4c261c9cd1595d591a344e3", "author": {"user": null}, "url": "https://github.com/payara/Payara/commit/0b48687705b336f4f4c261c9cd1595d591a344e3", "committedDate": "2020-02-14T14:29:22Z", "message": "MICROPROFILE #4490 - Referenced component name in OpenApi 'paths' section use name from the Schema annotation"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "0b48687705b336f4f4c261c9cd1595d591a344e3", "author": {"user": null}, "url": "https://github.com/payara/Payara/commit/0b48687705b336f4f4c261c9cd1595d591a344e3", "committedDate": "2020-02-14T14:29:22Z", "message": "MICROPROFILE #4490 - Referenced component name in OpenApi 'paths' section use name from the Schema annotation"}, "afterCommit": {"oid": "4a049a5fb6f864a6e0fdab572dea4372d1086601", "author": {"user": null}, "url": "https://github.com/payara/Payara/commit/4a049a5fb6f864a6e0fdab572dea4372d1086601", "committedDate": "2020-02-14T14:34:28Z", "message": "MICROPROFILE #4490 - Referenced component name in OpenApi 'paths' section use name from the Schema annotation"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "4a049a5fb6f864a6e0fdab572dea4372d1086601", "author": {"user": null}, "url": "https://github.com/payara/Payara/commit/4a049a5fb6f864a6e0fdab572dea4372d1086601", "committedDate": "2020-02-14T14:34:28Z", "message": "MICROPROFILE #4490 - Referenced component name in OpenApi 'paths' section use name from the Schema annotation"}, "afterCommit": {"oid": "cda0b02e527242900977fc87b4811d3239259b37", "author": {"user": null}, "url": "https://github.com/payara/Payara/commit/cda0b02e527242900977fc87b4811d3239259b37", "committedDate": "2020-02-14T14:36:28Z", "message": "MICROPROFILE #4490 - Referenced component name in OpenApi 'paths' section use name from the Schema annotation"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "cda0b02e527242900977fc87b4811d3239259b37", "author": {"user": null}, "url": "https://github.com/payara/Payara/commit/cda0b02e527242900977fc87b4811d3239259b37", "committedDate": "2020-02-14T14:36:28Z", "message": "MICROPROFILE #4490 - Referenced component name in OpenApi 'paths' section use name from the Schema annotation"}, "afterCommit": {"oid": "3591fcc3aa74a22cfaba307c25e4905846ccfe02", "author": {"user": null}, "url": "https://github.com/payara/Payara/commit/3591fcc3aa74a22cfaba307c25e4905846ccfe02", "committedDate": "2020-02-14T14:39:12Z", "message": "MICROPROFILE #4490 - Referenced component name in OpenApi 'paths' section use name from the Schema annotation"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e7d2918993191312bbd37d2582951a8c9b2d52d1", "author": {"user": null}, "url": "https://github.com/payara/Payara/commit/e7d2918993191312bbd37d2582951a8c9b2d52d1", "committedDate": "2020-02-14T14:52:20Z", "message": "MICROPROFILE #4490 - Referenced component name in OpenApi 'paths' section use name from the Schema annotation"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "3591fcc3aa74a22cfaba307c25e4905846ccfe02", "author": {"user": null}, "url": "https://github.com/payara/Payara/commit/3591fcc3aa74a22cfaba307c25e4905846ccfe02", "committedDate": "2020-02-14T14:39:12Z", "message": "MICROPROFILE #4490 - Referenced component name in OpenApi 'paths' section use name from the Schema annotation"}, "afterCommit": {"oid": "e7d2918993191312bbd37d2582951a8c9b2d52d1", "author": {"user": null}, "url": "https://github.com/payara/Payara/commit/e7d2918993191312bbd37d2582951a8c9b2d52d1", "committedDate": "2020-02-14T14:52:20Z", "message": "MICROPROFILE #4490 - Referenced component name in OpenApi 'paths' section use name from the Schema annotation"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "5d0e54f6d8d27105cf375aa1c86f3cafee7f56db", "author": {"user": null}, "url": "https://github.com/payara/Payara/commit/5d0e54f6d8d27105cf375aa1c86f3cafee7f56db", "committedDate": "2020-02-14T16:05:03Z", "message": "Removed the original (now duplicated) referee.setRef(referenceClass.getSimpleName());"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzYwMTIzNjcw", "url": "https://github.com/payara/Payara/pull/4494#pullrequestreview-360123670", "createdAt": "2020-02-18T07:46:48Z", "commit": {"oid": "5d0e54f6d8d27105cf375aa1c86f3cafee7f56db"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xOFQwNzo0Njo0OVrOFq4DSg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xOFQwNzo0Njo0OVrOFq4DSg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MDUwMjg1OA==", "bodyText": "The visitSchema() is now called twice with the same parameters.", "url": "https://github.com/payara/Payara/pull/4494#discussion_r380502858", "createdAt": "2020-02-18T07:46:49Z", "author": {"login": "rdebusscher"}, "path": "appserver/payara-appserver-modules/microprofile/openapi/src/main/java/fish/payara/microprofile/openapi/impl/processor/ApplicationProcessor.java", "diffHunk": "@@ -1031,11 +1031,18 @@ private boolean insertObjectReference(ApiContext context, Reference<?> referee,\n             return false;\n         }\n \n+        final Schema schema = AnnotationInfo.valueOf(referenceClass).getAnnotation(Schema.class);\n+\n         // Set the reference name\n-        referee.setRef(referenceClass.getSimpleName());\n+        if (schema == null || schema.name().isEmpty()) {\n+            referee.setRef(referenceClass.getSimpleName());\n+        } else {\n+            referee.setRef(schema.name());\n+        }\n \n         // Create the schema\n         visitSchema(AnnotationInfo.valueOf(referenceClass).getAnnotation(Schema.class), referenceClass, context);\n+        visitSchema(schema, referenceClass, context);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "5d0e54f6d8d27105cf375aa1c86f3cafee7f56db"}, "originalPosition": 16}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e3fd7d2e2920ac58a126d0434caf61b588e4738b", "author": {"user": null}, "url": "https://github.com/payara/Payara/commit/e3fd7d2e2920ac58a126d0434caf61b588e4738b", "committedDate": "2020-02-18T10:45:31Z", "message": "Removed duplicated call of visitSchema method."}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "369794a7181575d204db98aaad315e623ae661d8", "author": {"user": null}, "url": "https://github.com/payara/Payara/commit/369794a7181575d204db98aaad315e623ae661d8", "committedDate": "2020-02-18T09:27:46Z", "message": "Removed duplicated call of visitSchema method."}, "afterCommit": {"oid": "e3fd7d2e2920ac58a126d0434caf61b588e4738b", "author": {"user": null}, "url": "https://github.com/payara/Payara/commit/e3fd7d2e2920ac58a126d0434caf61b588e4738b", "committedDate": "2020-02-18T10:45:31Z", "message": "Removed duplicated call of visitSchema method."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzYwOTU0NTAy", "url": "https://github.com/payara/Payara/pull/4494#pullrequestreview-360954502", "createdAt": "2020-02-19T09:27:58Z", "commit": {"oid": "e3fd7d2e2920ac58a126d0434caf61b588e4738b"}, "state": "APPROVED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xOVQwOToyNzo1OVrOFrgtGQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xOVQwOToyOToxMFrOFrgvwQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MTE2ODkyMQ==", "bodyText": "2020", "url": "https://github.com/payara/Payara/pull/4494#discussion_r381168921", "createdAt": "2020-02-19T09:27:59Z", "author": {"login": "jbee"}, "path": "appserver/payara-appserver-modules/microprofile/openapi/src/test/java/fish/payara/microprofile/openapi/test/app/application/OASchemaReferenceNameTest.java", "diffHunk": "@@ -0,0 +1,105 @@\n+/*\n+ * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS HEADER.\n+ *\n+ * Copyright (c) [2019] Payara Foundation and/or its affiliates. All rights reserved.", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "e3fd7d2e2920ac58a126d0434caf61b588e4738b"}, "originalPosition": 4}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MTE2OTYwMQ==", "bodyText": "I'd prefer a single referee.setRef(...) with a conditional expression but that is personal preference.", "url": "https://github.com/payara/Payara/pull/4494#discussion_r381169601", "createdAt": "2020-02-19T09:29:10Z", "author": {"login": "jbee"}, "path": "appserver/payara-appserver-modules/microprofile/openapi/src/main/java/fish/payara/microprofile/openapi/impl/processor/ApplicationProcessor.java", "diffHunk": "@@ -1031,11 +1031,17 @@ private boolean insertObjectReference(ApiContext context, Reference<?> referee,\n             return false;\n         }\n \n+        final Schema schema = AnnotationInfo.valueOf(referenceClass).getAnnotation(Schema.class);\n+\n         // Set the reference name\n-        referee.setRef(referenceClass.getSimpleName());\n+        if (schema == null || schema.name().isEmpty()) {\n+            referee.setRef(referenceClass.getSimpleName());\n+        } else {\n+            referee.setRef(schema.name());\n+        }", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "e3fd7d2e2920ac58a126d0434caf61b588e4738b"}, "originalPosition": 12}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ad0e8243f6a84298456c40465cf45cfee510560f", "author": {"user": null}, "url": "https://github.com/payara/Payara/commit/ad0e8243f6a84298456c40465cf45cfee510560f", "committedDate": "2020-02-19T09:54:24Z", "message": "Copyright dated to 2020"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "2e2e6f6f7a85351e4243eaf6fbf2b6b9248a5bc2", "author": {"user": null}, "url": "https://github.com/payara/Payara/commit/2e2e6f6f7a85351e4243eaf6fbf2b6b9248a5bc2", "committedDate": "2020-02-19T09:58:24Z", "message": "Ternary op for single-line referee.setRef()"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzYwOTgzMDgy", "url": "https://github.com/payara/Payara/pull/4494#pullrequestreview-360983082", "createdAt": "2020-02-19T10:06:32Z", "commit": {"oid": "2e2e6f6f7a85351e4243eaf6fbf2b6b9248a5bc2"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzYxODE5OTAx", "url": "https://github.com/payara/Payara/pull/4494#pullrequestreview-361819901", "createdAt": "2020-02-20T11:15:13Z", "commit": {"oid": "2e2e6f6f7a85351e4243eaf6fbf2b6b9248a5bc2"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzYxOTUxNDE0", "url": "https://github.com/payara/Payara/pull/4494#pullrequestreview-361951414", "createdAt": "2020-02-20T14:36:55Z", "commit": {"oid": "2e2e6f6f7a85351e4243eaf6fbf2b6b9248a5bc2"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 881, "cost": 1, "resetAt": "2021-11-01T16:19:10Z"}}}