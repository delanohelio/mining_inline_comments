{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTQzNTgwODUw", "number": 5065, "title": "FISH-663 MicroProfile OpenAPI 2.0 (MP 4.0)", "bodyText": "Description\n\nThis is an improvement, upgrading our implementation of MicroProfile OpenAPI to version 2.0\nChanges include:\n\nThe @SchemaProperty annotation has been added to allow the properties for a schema to be defined inline\nThe @RequestBodySchema annotation has been added to provide a shorthand mechanism to specify the schema for a request body\nThe @APIResponseSchema annotation has been added to provide a shorthand mechanism to specify the schema for a response body\nThe mp.openapi.schema.* MicroProfile Config property has been added to allow the schema for a specific class to be specified. This property would typically be used in cases where the application developer does not have access to the source code of a class\nGetter methods on model interfaces that return a list or map now return an immutable copy of that collection\nSetter methods on model interfaces that take a list or a map as a parameter MUST not use the list/map instance directly\n\nThe TCK has been upgraded in various places, meaning that not all of the changes here are strictly due to new behaviour.\nImportant Information\nHK2 has received a patch to now parse exception types when creating MethodModels. This was needed as exception mappers are now supported in OpenAPI (they may have been expected before, but not implemented).\nPatched source: payara/patched-src-hk2#19\nPatched artifact: payara/Payara_PatchedProjects#352\nTesting\nNew tests\n\nTCK Upgrade: payara/MicroProfile-TCK-Runners#132\nTesting Performed\n\nRan the new TCK. OpenAPI is reasonably isolated, so there shouldn't bean affect on many other tests.\nNotes for Reviewers\n\nI've disabled a TCK test and raised an upstream issue for it. I don't believe it's intended, and it shouldn't affect or compatibility.\nThis PR also fixes #4955 (FISH-760)", "createdAt": "2020-12-21T16:26:28Z", "url": "https://github.com/payara/Payara/pull/5065", "merged": true, "mergeCommit": {"oid": "181dc1c27f0a80a69d500368c93bbac2ceafd16e"}, "closed": true, "closedAt": "2020-12-23T00:05:58Z", "author": {"login": "MattGill98"}, "timelineItems": {"totalCount": 36, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdfYsyqAH2gAyNTQzNTgwODUwOmJkZjYzOWY5NTRkNGYzMWU4NjBjYzU4NDk4ODVkZjA4YTljNDUwN2E=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdottPegH2gAyNTQzNTgwODUwOjc2Y2EzNmVlMzg2NmQxMjk5NmNlNDU3MzUyYWQ5N2Q4YjIyOWQ0Zjc=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "bdf639f954d4f31e860cc5849885df08a9c4507a", "author": {"user": {"login": "MattGill98", "name": "Matthew Gill"}}, "url": "https://github.com/payara/Payara/commit/bdf639f954d4f31e860cc5849885df08a9c4507a", "committedDate": "2020-11-23T17:35:32Z", "message": "FISH-663 OpenAPI 2.0-RC3 Upgrade\n\nUpgraded the dependencies and fixed compilation errors.\n\nSigned-off-by: Matthew Gill <matthew.gill@live.co.uk>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "10862a0dda5c346cddc888cafa0ba3c4d4f19bb4", "author": {"user": {"login": "MattGill98", "name": "Matthew Gill"}}, "url": "https://github.com/payara/Payara/commit/10862a0dda5c346cddc888cafa0ba3c4d4f19bb4", "committedDate": "2020-11-23T17:35:40Z", "message": "FISH-660 Order all HashMaps\n\nAll data returned from the API should be deterministically ordered, so\nall HashMaps have been replaced with LinkedHashMap.\n\nSigned-off-by: Matthew Gill <matthew.gill@live.co.uk>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "40726adada04e6e214c4191ae23c1ec84217760c", "author": {"user": {"login": "MattGill98", "name": "Matthew Gill"}}, "url": "https://github.com/payara/Payara/commit/40726adada04e6e214c4191ae23c1ec84217760c", "committedDate": "2020-11-23T17:36:04Z", "message": "FISH-663 Remove Empty 'content' instances from response\n\nFor some reason, the upgrade is causing the ContentImpl instance to be\ncounted as not-empty, which is causing the current serialization\ninclusion settings to include it. This breaks several classes and tests\nthat expect any items with $ref tags to be otherwise empty (but it\ncontains 'content: {}'). This commit changes the inclusion settings to\ndisable this behaviour.\n\nSigned-off-by: Matthew Gill <matthew.gill@live.co.uk>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e4b28d7181b1d1a74b65fb0c2ceff1f147d594df", "author": {"user": {"login": "MattGill98", "name": "Matthew Gill"}}, "url": "https://github.com/payara/Payara/commit/e4b28d7181b1d1a74b65fb0c2ceff1f147d594df", "committedDate": "2020-11-27T12:54:53Z", "message": "FISH-663 Fix Runtime Exceptions\n\nSome errors were thrown at runtime, so a new test has been added and\nthey have been patched.\n\nSigned-off-by: Matthew Gill <matthew.gill@live.co.uk>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "0d308540bd1867681467886f5bdbc727ca96fe37", "author": {"user": {"login": "MattGill98", "name": "Matthew Gill"}}, "url": "https://github.com/payara/Payara/commit/0d308540bd1867681467886f5bdbc727ca96fe37", "committedDate": "2020-11-27T12:54:58Z", "message": "FISH-663 Merge Schema classes correctly\n\nIf a Schema was declared in the OpenAPIDefinition, the @Schema class\nannotations would totally replace the initial definition. It is now\nmerged correctly.\n\nSigned-off-by: Matthew Gill <matthew.gill@live.co.uk>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "1673ec6afaaf5200f71c65edf8598fea5a304ad8", "author": {"user": {"login": "MattGill98", "name": "Matthew Gill"}}, "url": "https://github.com/payara/Payara/commit/1673ec6afaaf5200f71c65edf8598fea5a304ad8", "committedDate": "2020-12-16T11:56:03Z", "message": "FISH-663 Make OpenAPI Collection Types Immutable\n\nThe TCK now checks that the get*() methods return immutable types.\n\nSigned-off-by: Matthew Gill <matthew.gill@live.co.uk>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "7976a0757acb93d9556d71da0569806da75d682b", "author": {"user": {"login": "MattGill98", "name": "Matthew Gill"}}, "url": "https://github.com/payara/Payara/commit/7976a0757acb93d9556d71da0569806da75d682b", "committedDate": "2020-12-16T11:56:07Z", "message": "FISH-663 Fix OpenAPI Collection set methods\n\nThe set methods would allow you to set unserializable types or types\nsuch as unmodifiableCollections which could cause issues.\n\nSigned-off-by: Matthew Gill <matthew.gill@live.co.uk>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "99f656127bfa019899f209a8987cbd1e21e2f9db", "author": {"user": {"login": "MattGill98", "name": "Matthew Gill"}}, "url": "https://github.com/payara/Payara/commit/99f656127bfa019899f209a8987cbd1e21e2f9db", "committedDate": "2020-12-16T11:56:07Z", "message": "FISH-663 Add detail to OpenAPI test failures\n\nThe node was printed, but not the context for the node. The errors now\nprint the OpenAPI document, with all the problems added as causes.\n\nSigned-off-by: Matthew Gill <matthew.gill@live.co.uk>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "71930fee134cd7c95215b2bc5e6f545c05e5f642", "author": {"user": {"login": "MattGill98", "name": "Matthew Gill"}}, "url": "https://github.com/payara/Payara/commit/71930fee134cd7c95215b2bc5e6f545c05e5f642", "committedDate": "2020-12-16T11:56:07Z", "message": "FISH-663 Prevent types being added to references\n\nIf a property Schema had a ref, type=OBJECT was still added. A check has\nnow been added for this.\n\nSigned-off-by: Matthew Gill <matthew.gill@live.co.uk>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "2b99faba3e4cc8ca5a19ca644764cd1bd42ac0f0", "author": {"user": {"login": "MattGill98", "name": "Matthew Gill"}}, "url": "https://github.com/payara/Payara/commit/2b99faba3e4cc8ca5a19ca644764cd1bd42ac0f0", "committedDate": "2020-12-16T11:56:07Z", "message": "FISH-663 Fix Collection methods\n\nThe TCK requires that the collections be nullable, where it wasn't\npreviously possible. Technically only one collection is tested, but in\nthe name of consistency, this functionality has been replicated\neverywhere.\n\nThe collection types have also been abstracted, to allow them to be\nchanged if required.\n\nSigned-off-by: Matthew Gill <matthew.gill@live.co.uk>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "982c41e589267c015d96a6c6fb9afcfa85bf6e1a", "author": {"user": {"login": "MattGill98", "name": "Matthew Gill"}}, "url": "https://github.com/payara/Payara/commit/982c41e589267c015d96a6c6fb9afcfa85bf6e1a", "committedDate": "2020-12-16T11:56:08Z", "message": "FISH-663 Refactor OpenApiConfiguration\n\nPrevent scanning all Config API Properties multiple times. The methods\nhave been refactored to take less time to scan for OpenAPI properties.\n\nSigned-off-by: Matthew Gill <matthew.gill@live.co.uk>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "4a820594f1a460f839acd00c54db2dab0c5675b4", "author": {"user": {"login": "MattGill98", "name": "Matthew Gill"}}, "url": "https://github.com/payara/Payara/commit/4a820594f1a460f839acd00c54db2dab0c5675b4", "committedDate": "2020-12-16T11:56:08Z", "message": "FISH-663 Add Config Property Schema Processing\n\nConfig Properties that specify schema objects are now parsed and\nincluded in the final object. Schema objects with parents also include\nall the parent class properties.\n\nSigned-off-by: Matthew Gill <matthew.gill@live.co.uk>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f248f137b8913de0d6a1d9c80fb62ba224b05887", "author": {"user": {"login": "MattGill98", "name": "Matthew Gill"}}, "url": "https://github.com/payara/Payara/commit/f248f137b8913de0d6a1d9c80fb62ba224b05887", "committedDate": "2020-12-16T11:56:08Z", "message": "FISH-663 Simplify extractAnnotations Methods\n\nThe extractAnnotations methods hadunused variables, which have been\nremoved. The ServerVariables weren't being added as they were being\nadded directly, then replaced with a blank map. This has been fixed, as\nwell as the UnmodifiableCollection modification issues caused by fixing\nit.\n\nSigned-off-by: Matthew Gill <matthew.gill@live.co.uk>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b2c358f9405384aacd64bc49443dbd73c751963c", "author": {"user": {"login": "MattGill98", "name": "Matthew Gill"}}, "url": "https://github.com/payara/Payara/commit/b2c358f9405384aacd64bc49443dbd73c751963c", "committedDate": "2020-12-16T11:56:08Z", "message": "FISH-663 Parse Exception Mappers\n\nOpenAPI should now scan and handle exception mappers. content annotation\nvalues with only one @Content value now set the content value\nimmediately, as they assume they're the only one.\n\nSigned-off-by: Matthew Gill <matthew.gill@live.co.uk>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "63753d672488f1399c2ea67f463c68c20e7a38a6", "author": {"user": {"login": "MattGill98", "name": "Matthew Gill"}}, "url": "https://github.com/payara/Payara/commit/63753d672488f1399c2ea67f463c68c20e7a38a6", "committedDate": "2020-12-16T11:56:08Z", "message": "FISH-663 Remove Unused 'Contents' variables\n\nSigned-off-by: Matthew Gill <matthew.gill@live.co.uk>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e060d3bdf3b9bc26d516bad433fadb35cb051cfa", "author": {"user": {"login": "MattGill98", "name": "Matthew Gill"}}, "url": "https://github.com/payara/Payara/commit/e060d3bdf3b9bc26d516bad433fadb35cb051cfa", "committedDate": "2020-12-16T11:56:08Z", "message": "FISH-663 Fix OpenAPI @Parameters parsing\n\nWhen parsing the @Parameters annotation, the information wouldn' be\nretained as the method looks for the result of @PathParam etc, which\nhasn't been parsed as the method annotations are found first.\n\nThe Schema implementation handling is done earlier, to allow annotation\nvalues to override the implementation class information.\n\nSigned-off-by: Matthew Gill <matthew.gill@live.co.uk>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e22efc66abcbf783f8092ecae9d0ae7da8acfd47", "author": {"user": {"login": "MattGill98", "name": "Matthew Gill"}}, "url": "https://github.com/payara/Payara/commit/e22efc66abcbf783f8092ecae9d0ae7da8acfd47", "committedDate": "2020-12-16T11:56:08Z", "message": "FISH-663 Fix OpenAPI Callback Schema Creation\n\nSchemas created as part of a @Callback annotation didn't parse the\nimplementation properly. The implementation logic is now performed as\npart of the initial creation, and also uses the ARRAY type properly.\n\nSigned-off-by: Matthew Gill <matthew.gill@live.co.uk>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c48528b365a08ca2f01d995184a27adb8ed55b06", "author": {"user": {"login": "MattGill98", "name": "Matthew Gill"}}, "url": "https://github.com/payara/Payara/commit/c48528b365a08ca2f01d995184a27adb8ed55b06", "committedDate": "2020-12-16T11:56:08Z", "message": "FISH-663 Fix OpenAPI format parameter\n\nThe TCK passes JSON in uppercase to the format query parameter to test\nit. The field isnow case insensitive.\n\nSigned-off-by: Matthew Gill <matthew.gill@live.co.uk>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "257f338a94499d3f00dd1004f34480632b9f864e", "author": {"user": {"login": "MattGill98", "name": "Matthew Gill"}}, "url": "https://github.com/payara/Payara/commit/257f338a94499d3f00dd1004f34480632b9f864e", "committedDate": "2020-12-16T11:56:52Z", "message": "Merge branch 'master' of https://github.com/payara/Payara into FISH-663"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "01567d775d23b896c652593f7a49ab71bd4a7d63", "author": {"user": {"login": "MattGill98", "name": "Matthew Gill"}}, "url": "https://github.com/payara/Payara/commit/01567d775d23b896c652593f7a49ab71bd4a7d63", "committedDate": "2020-12-21T13:51:54Z", "message": "FISH-663 MP OpenAPI 2.0 @APIResponseSchema support\n\nImplemented annotation parsing for the new annotation.\n\nSigned-off-by: Matthew Gill <matthew.gill@live.co.uk>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "fca79aee0c41c6754edb037e08d4355318b611fe", "author": {"user": {"login": "MattGill98", "name": "Matthew Gill"}}, "url": "https://github.com/payara/Payara/commit/fca79aee0c41c6754edb037e08d4355318b611fe", "committedDate": "2020-12-21T13:54:03Z", "message": "FISH-663 MP OpenAPI add required properties\n\nProperties marked as 'required' weren't added correctly to their parent\nschemas.\n\nSigned-off-by: Matthew Gill <matthew.gill@live.co.uk>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "936002c64b8e23e7e5107f93eba8526c6394209d", "author": {"user": {"login": "MattGill98", "name": "Matthew Gill"}}, "url": "https://github.com/payara/Payara/commit/936002c64b8e23e7e5107f93eba8526c6394209d", "committedDate": "2020-12-21T13:54:07Z", "message": "FISH-663 MP OpenAPI use method schema annotations\n\n@Schema annotations are now parsed correctly when attached\nto accessor methods. @XmlRootElement annotations are also now allowed to\ndenote Schema classes.\n\nSigned-off-by: Matthew Gill <matthew.gill@live.co.uk>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c96f44cfb36f6dcc80d4ecc37b20b78ceeb7b301", "author": {"user": {"login": "MattGill98", "name": "Matthew Gill"}}, "url": "https://github.com/payara/Payara/commit/c96f44cfb36f6dcc80d4ecc37b20b78ceeb7b301", "committedDate": "2020-12-21T13:54:07Z", "message": "FISH-663 MP OpenAPI 2.0 @RequestBodySchema support\n\nSigned-off-by: Matthew Gill <matthew.gill@live.co.uk>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "cb78882409eb173aefd858cc42e1eae6aeda90eb", "author": {"user": {"login": "MattGill98", "name": "Matthew Gill"}}, "url": "https://github.com/payara/Payara/commit/cb78882409eb173aefd858cc42e1eae6aeda90eb", "committedDate": "2020-12-21T17:23:49Z", "message": "FISH-760 Fix OpenAPI Enum parsing\n\nEnums were including HK2 data in the enumeration object, rather than the\nenum value name. This commit tests and fixes this behaviour.\n\nSigned-off-by: Matthew Gill <matthew.gill@live.co.uk>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "7fc5a19c3708f0929810bd53a5218e64bf3fa19f", "author": {"user": {"login": "MattGill98", "name": "Matthew Gill"}}, "url": "https://github.com/payara/Payara/commit/7fc5a19c3708f0929810bd53a5218e64bf3fa19f", "committedDate": "2020-12-22T09:37:32Z", "message": "Merge branch 'master' of https://github.com/payara/Payara into FISH-663"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "6a610a8b8d2702936e9cf6f584caf4da3d561b33", "author": {"user": {"login": "MattGill98", "name": "Matthew Gill"}}, "url": "https://github.com/payara/Payara/commit/6a610a8b8d2702936e9cf6f584caf4da3d561b33", "committedDate": "2020-12-22T12:33:04Z", "message": "FISH-663 HK2 2.6.1.payara-p5 upgrade\n\nUpgraded HK2 to support exception type parsing\n\nSigned-off-by: Matthew Gill <matthew.gill@live.co.uk>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e663b379a9631a49826297835556cdca9b6612ab", "author": {"user": {"login": "MattGill98", "name": "Matthew Gill"}}, "url": "https://github.com/payara/Payara/commit/e663b379a9631a49826297835556cdca9b6612ab", "committedDate": "2020-12-22T12:33:09Z", "message": "FISH-663 OpenAPI remove numeric path syntax from tests\n\nIndices in paths should be accessed by using square brackets. The syntax\nwithout this is ambiguous ans interferes with fetching response codes\ne.g. 500 as this will be interpreted as an index in the array.\n\nSigned-off-by: Matthew Gill <matthew.gill@live.co.uk>"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "450d2e27f4e4adffa48b0411ab85b5bb84324905", "author": {"user": {"login": "MattGill98", "name": "Matthew Gill"}}, "url": "https://github.com/payara/Payara/commit/450d2e27f4e4adffa48b0411ab85b5bb84324905", "committedDate": "2020-12-22T09:37:54Z", "message": "FISH-663 HK2 2.6.1.payara-p5 upgrade\n\nUpgraded HK2 to support exception type parsing\n\nSigned-off-by: Matthew Gill <matthew.gill@live.co.uk>"}, "afterCommit": {"oid": "e663b379a9631a49826297835556cdca9b6612ab", "author": {"user": {"login": "MattGill98", "name": "Matthew Gill"}}, "url": "https://github.com/payara/Payara/commit/e663b379a9631a49826297835556cdca9b6612ab", "committedDate": "2020-12-22T12:33:09Z", "message": "FISH-663 OpenAPI remove numeric path syntax from tests\n\nIndices in paths should be accessed by using square brackets. The syntax\nwithout this is ambiguous ans interferes with fetching response codes\ne.g. 500 as this will be interpreted as an index in the array.\n\nSigned-off-by: Matthew Gill <matthew.gill@live.co.uk>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a452e202106f7df3234abb1eca61f19790b63f4c", "author": {"user": {"login": "MattGill98", "name": "Matthew Gill"}}, "url": "https://github.com/payara/Payara/commit/a452e202106f7df3234abb1eca61f19790b63f4c", "committedDate": "2020-12-22T12:57:16Z", "message": "FISH-663 OpenAPI Fix exception mapping order\n\nWhen encountered in the wrong order, exception mappers weren't\nrespected. @APIResponseSchema also broke on exception mappers. This\ncommit fixes this basic behaviour.\n\nSigned-off-by: Matthew Gill <matthew.gill@live.co.uk>"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTU3MTQyMTE5", "url": "https://github.com/payara/Payara/pull/5065#pullrequestreview-557142119", "createdAt": "2020-12-22T15:00:21Z", "commit": {"oid": "a452e202106f7df3234abb1eca61f19790b63f4c"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTU3MTMxMjE5", "url": "https://github.com/payara/Payara/pull/5065#pullrequestreview-557131219", "createdAt": "2020-12-22T14:46:39Z", "commit": {"oid": "a452e202106f7df3234abb1eca61f19790b63f4c"}, "state": "COMMENTED", "comments": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0yMlQxNDo0NjozOVrOIJ9ong==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0yMlQxNTowNDozNVrOIJ-Pqw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NzMxNzkxOA==", "bodyText": "Suggestion:\nremove the if (from.getSchemas()!= null) { and put it with the if (from == null) {\nLike so:\nif (from==null || from.getSchemas()!= null) {", "url": "https://github.com/payara/Payara/pull/5065#discussion_r547317918", "createdAt": "2020-12-22T14:46:39Z", "author": {"login": "MarkWareham"}, "path": "appserver/payara-appserver-modules/microprofile/openapi/src/main/java/fish/payara/microprofile/openapi/impl/model/ComponentsImpl.java", "diffHunk": "@@ -305,11 +354,13 @@ public static void merge(Components from, Components to,\n         }\n         // Handle @Schema\n         if (from.getSchemas()!= null) {\n-            for (String schemaName : from.getSchemas().keySet()) {\n+            for (Entry<String, Schema> fromEntry : from.getSchemas().entrySet()) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "a452e202106f7df3234abb1eca61f19790b63f4c"}, "originalPosition": 348}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NzMyMzcwMA==", "bodyText": "It seems you do a lot of unnecessary null checks. When could the object be null? It's instantiated in the declaration and nothing sets or nullifies it (that I see)", "url": "https://github.com/payara/Payara/pull/5065#discussion_r547323700", "createdAt": "2020-12-22T14:57:00Z", "author": {"login": "MarkWareham"}, "path": "appserver/payara-appserver-modules/microprofile/openapi/src/main/java/fish/payara/microprofile/openapi/impl/model/ExtensibleImpl.java", "diffHunk": "@@ -58,25 +60,30 @@\n     private static final Logger LOGGER = Logger.getLogger(ExtensibleImpl.class.getName());\n \n     @JsonIgnore\n-    protected Map<String, Object> extensions = new LinkedHashMap<>();\n+    protected Map<String, Object> extensions = createMap();\n \n     @Override\n     public Map<String, Object> getExtensions() {\n-        return extensions;\n+        return readOnlyView(extensions);\n     }\n \n     @SuppressWarnings(\"unchecked\")\n     @Override\n     public T addExtension(String name, Object value) {\n         if (value != null) {\n+            if (extensions == null) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "a452e202106f7df3234abb1eca61f19790b63f4c"}, "originalPosition": 36}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NzMyNTEyOQ==", "bodyText": "can remove the negation and put into the first if of the method to return. Easier to read, less cyclomatic complexity", "url": "https://github.com/payara/Payara/pull/5065#discussion_r547325129", "createdAt": "2020-12-22T14:59:36Z", "author": {"login": "MarkWareham"}, "path": "appserver/payara-appserver-modules/microprofile/openapi/src/main/java/fish/payara/microprofile/openapi/impl/model/ExtensibleImpl.java", "diffHunk": "@@ -100,7 +107,7 @@ public static void merge(Extensible<?> from, Extensible<?> to, boolean override)\n             return;\n         }\n         if (to.getExtensions() == null) {\n-            to.setExtensions(new LinkedHashMap<>());\n+            to.setExtensions(createMap());\n         }\n         if (!from.getExtensions().isEmpty()) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "a452e202106f7df3234abb1eca61f19790b63f4c"}, "originalPosition": 60}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NzMyNzkxNQ==", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                    if (server != null) {\n          \n          \n            \n                        if (servers == null) {\n          \n          \n            \n                            servers = createList();\n          \n          \n            \n                        }\n          \n          \n            \n                        if (server.getUrl() != null) {\n          \n          \n            \n                            for (Server existingServer : getServers()) {\n          \n          \n            \n                                // If a server with the same URL is found, merge them\n          \n          \n            \n                                if (server.getUrl().equals(existingServer.getUrl())) {\n          \n          \n            \n                                    ModelUtils.merge(server, existingServer, true);\n          \n          \n            \n                                    return this;\n          \n          \n            \n                                }\n          \n          \n            \n                            }\n          \n          \n            \n                        }\n          \n          \n            \n                \n          \n          \n            \n                        // If a server with the same URL doesn't exist, create it\n          \n          \n            \n                        servers.add(server);\n          \n          \n            \n                    }\n          \n          \n            \n                    if (server == null || server.getUrl() == null)) {\n          \n          \n            \n                        return this;\n          \n          \n            \n                    }\n          \n          \n            \n                   \n          \n          \n            \n                    if (servers == null) {\n          \n          \n            \n                        servers = createList();\n          \n          \n            \n                    }\n          \n          \n            \n                       \n          \n          \n            \n                     for (Server existingServer : getServers()) {\n          \n          \n            \n                          // If a server with the same URL is found, merge them\n          \n          \n            \n                          if (server.getUrl().equals(existingServer.getUrl())) {\n          \n          \n            \n                              ModelUtils.merge(server, existingServer, true);\n          \n          \n            \n                              return this;\n          \n          \n            \n                          }\n          \n          \n            \n                      }\n          \n          \n            \n                       \n          \n          \n            \n                        // If a server with the same URL doesn't exist, create it\n          \n          \n            \n                        servers.add(server);\n          \n      \n    \n    \n  \n\nreduces complexity", "url": "https://github.com/payara/Payara/pull/5065#discussion_r547327915", "createdAt": "2020-12-22T15:04:35Z", "author": {"login": "MarkWareham"}, "path": "appserver/payara-appserver-modules/microprofile/openapi/src/main/java/fish/payara/microprofile/openapi/impl/model/OpenAPIImpl.java", "diffHunk": "@@ -130,76 +131,95 @@ public void setExternalDocs(ExternalDocumentation externalDocs) {\n \n     @Override\n     public List<Server> getServers() {\n-        return servers;\n+        return readOnlyView(servers);\n     }\n \n     @Override\n     public void setServers(List<Server> servers) {\n-        this.servers = servers;\n+        this.servers = createList(servers);\n     }\n \n     @Override\n     public OpenAPI addServer(Server server) {\n-        if (server.getUrl() != null) {\n-            for (Server existingServer : getServers()) {\n-                // If a server with the same URL is found, merge them\n-                if (server.getUrl().equals(existingServer.getUrl())) {\n-                    ModelUtils.merge(server, existingServer, true);\n-                    return this;\n+        if (server != null) {\n+            if (servers == null) {\n+                servers = createList();\n+            }\n+            if (server.getUrl() != null) {\n+                for (Server existingServer : getServers()) {\n+                    // If a server with the same URL is found, merge them\n+                    if (server.getUrl().equals(existingServer.getUrl())) {\n+                        ModelUtils.merge(server, existingServer, true);\n+                        return this;\n+                    }\n                 }\n             }\n+    \n+            // If a server with the same URL doesn't exist, create it\n+            servers.add(server);\n         }", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "a452e202106f7df3234abb1eca61f19790b63f4c"}, "originalPosition": 90}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTU3MTc4MTc4", "url": "https://github.com/payara/Payara/pull/5065#pullrequestreview-557178178", "createdAt": "2020-12-22T15:50:03Z", "commit": {"oid": "a452e202106f7df3234abb1eca61f19790b63f4c"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0yMlQxNTo1MDowM1rOIJ_0DQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0yMlQxNTo1MDowM1rOIJ_0DQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NzM1MzYxMw==", "bodyText": "As per the existing design of OpenAPI Impl, merge operations are invoked after the creation of the instances.\n    public void visitOpenAPI(AnnotationModel definition, AnnotatedElement element, ApiContext context) {\n        OpenAPIImpl.merge(OpenAPIImpl.createInstance(definition, context), context.getApi(), true, context);\n    }", "url": "https://github.com/payara/Payara/pull/5065#discussion_r547353613", "createdAt": "2020-12-22T15:50:03Z", "author": {"login": "jGauravGupta"}, "path": "appserver/payara-appserver-modules/microprofile/openapi/src/main/java/fish/payara/microprofile/openapi/impl/model/parameters/RequestBodyImpl.java", "diffHunk": "@@ -55,19 +57,24 @@\n \n     private String description;\n     private Content content = new ContentImpl();\n-    private List<ContentImpl> contents = new ArrayList<>();\n     private Boolean required;\n     private String ref;\n \n-    public static RequestBody createInstance(AnnotationModel annotation, ApiContext context) {\n+    public static RequestBodyImpl createInstance(AnnotationModel annotation, ApiContext context) {\n         RequestBodyImpl from = new RequestBodyImpl();\n         from.setDescription(annotation.getValue(\"description\", String.class));\n         from.setRequired(annotation.getValue(\"required\", Boolean.class));\n         String ref = annotation.getValue(\"ref\", String.class);\n         if (ref != null && !ref.isEmpty()) {\n             from.setRef(ref);\n         }\n-        extractAnnotations(annotation, context, \"content\", ContentImpl::createInstance, from.getContents());\n+\n+        final List<ContentImpl> contents = createList();\n+        extractAnnotations(annotation, context, \"content\", ContentImpl::createInstance, contents::add);\n+        for (ContentImpl content : contents) {\n+            ContentImpl.merge(content, from.content, true, context);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "a452e202106f7df3234abb1eca61f19790b63f4c"}, "originalPosition": 36}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f8daa58589cc1a3832baf4b9de4cd93afd4563ba", "author": {"user": {"login": "MattGill98", "name": "Matthew Gill"}}, "url": "https://github.com/payara/Payara/commit/f8daa58589cc1a3832baf4b9de4cd93afd4563ba", "committedDate": "2020-12-22T16:09:50Z", "message": "FISH-663 OpenAPI minor PR fixes\n\nThe server add function had reasonably high complexity, which has been\nreduced. ExtensibleImpl had been missed in the mass collection fix, so\nthis has been kept consistent with the rest of the collection methods.\n\nSigned-off-by: Matthew Gill <matthew.gill@live.co.uk>"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "3868c9e7ca1cbcac90bcb9bff56fe16f97cffa1d", "author": {"user": {"login": "MattGill98", "name": "Matthew Gill"}}, "url": "https://github.com/payara/Payara/commit/3868c9e7ca1cbcac90bcb9bff56fe16f97cffa1d", "committedDate": "2020-12-22T16:01:14Z", "message": "FISH-663 OpenAPI minor PR fixes\n\nThe server add function had reasonably high complexity, which has been\nreduced. ExtensibleImpl had been missed in the mass collection fix, so\nthis has been kept consistent with the rest of the collection methods.\n\nSigned-off-by: Matthew Gill <matthew.gill@live.co.uk>"}, "afterCommit": {"oid": "f8daa58589cc1a3832baf4b9de4cd93afd4563ba", "author": {"user": {"login": "MattGill98", "name": "Matthew Gill"}}, "url": "https://github.com/payara/Payara/commit/f8daa58589cc1a3832baf4b9de4cd93afd4563ba", "committedDate": "2020-12-22T16:09:50Z", "message": "FISH-663 OpenAPI minor PR fixes\n\nThe server add function had reasonably high complexity, which has been\nreduced. ExtensibleImpl had been missed in the mass collection fix, so\nthis has been kept consistent with the rest of the collection methods.\n\nSigned-off-by: Matthew Gill <matthew.gill@live.co.uk>"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTU3MjI5NDMw", "url": "https://github.com/payara/Payara/pull/5065#pullrequestreview-557229430", "createdAt": "2020-12-22T17:04:48Z", "commit": {"oid": "f8daa58589cc1a3832baf4b9de4cd93afd4563ba"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "76ca36ee3866d12996ce457352ad97d8b229d4f7", "author": {"user": {"login": "MattGill98", "name": "Matthew Gill"}}, "url": "https://github.com/payara/Payara/commit/76ca36ee3866d12996ce457352ad97d8b229d4f7", "committedDate": "2020-12-22T17:09:21Z", "message": "FISH-663 MP OpenAPI separate create and merge phases\n\nContentImpl merge function was being used in creation of Contents, which\ncauses the code to be entangled and difficult to debug. There was no\nreason to merge them, so they've been replaced with simpler add\nfunctions.\n\nSigned-off-by: Matthew Gill <matthew.gill@live.co.uk>"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 649, "cost": 1, "resetAt": "2021-11-01T16:19:10Z"}}}