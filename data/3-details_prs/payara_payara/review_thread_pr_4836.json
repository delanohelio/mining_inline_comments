{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDY3OTE4MzE4", "number": 4836, "reviewThreads": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xNFQxMjo1OToxNFrOEYdcNw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xNFQxNDowMzowM1rOEYe04w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjk0MDgzNjM5OnYy", "diffSide": "RIGHT", "path": "Jenkinsfile", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xNFQxMjo1OToxNFrOHAzoNA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xNFQxMzoxMjozOVrOHA0Dkg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MDYwNzkyNA==", "bodyText": "I note you are running managed profile. Why would this stage need the stage \"Setup for MP TCK Runners\" ?", "url": "https://github.com/payara/Payara/pull/4836#discussion_r470607924", "createdAt": "2020-08-14T12:59:14Z", "author": {"login": "MarkWareham"}, "path": "Jenkinsfile", "diffHunk": "@@ -99,6 +101,37 @@ pipeline {\n                }\n             }\n         }\n+        stage('Checkout MP TCK Runners') {\n+            steps{\n+                echo '*#*#*#*#*#*#*#*#*#*#*#*#  Checking out MP TCK Runners  *#*#*#*#*#*#*#*#*#*#*#*#*#*#*#'\n+                checkout changelog: false, poll: false, scm: [$class: 'GitSCM',\n+                    branches: [[name: \"*/master\"]],\n+                    userRemoteConfigs: [[url: \"https://github.com/payara/MicroProfile-TCK-Runners.git\"]]]\n+                echo '*#*#*#*#*#*#*#*#*#*#*#*#  Checked out MP TCK Runners  *#*#*#*#*#*#*#*#*#*#*#*#*#*#*#'\n+            }\n+        }\n+        stage('Setup for MP TCK Runners') {\n+            steps {\n+                makeDomain()\n+            }\n+        }\n+        stage('Run MP TCK Tests') {\n+            steps {\n+                echo '*#*#*#*#*#*#*#*#*#*#*#*#  Running test  *#*#*#*#*#*#*#*#*#*#*#*#*#*#*#'\n+                sh \"\"\"mvn -B -V -ff -e clean verify \\\n+                -Djavax.net.ssl.trustStore=${env.JAVA_HOME}/jre/lib/security/cacerts \\\n+                -Djavax.xml.accessExternalSchema=all -Dpayara.version=${pom.version} \\\n+                -Dpayara_domain=${DOMAIN_NAME} -Duse.cnHost=true \\\n+                -Dsurefire.rerunFailingTestsCount=2 -Ppayara-server-managed,payara5\"\"\"", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "77dc9c8e2375223b4f9d1d309255eac896f2ffb6"}, "originalPosition": 34}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MDYxNDkzMA==", "bodyText": "True", "url": "https://github.com/payara/Payara/pull/4836#discussion_r470614930", "createdAt": "2020-08-14T13:12:39Z", "author": {"login": "AlanRoth"}, "path": "Jenkinsfile", "diffHunk": "@@ -99,6 +101,37 @@ pipeline {\n                }\n             }\n         }\n+        stage('Checkout MP TCK Runners') {\n+            steps{\n+                echo '*#*#*#*#*#*#*#*#*#*#*#*#  Checking out MP TCK Runners  *#*#*#*#*#*#*#*#*#*#*#*#*#*#*#'\n+                checkout changelog: false, poll: false, scm: [$class: 'GitSCM',\n+                    branches: [[name: \"*/master\"]],\n+                    userRemoteConfigs: [[url: \"https://github.com/payara/MicroProfile-TCK-Runners.git\"]]]\n+                echo '*#*#*#*#*#*#*#*#*#*#*#*#  Checked out MP TCK Runners  *#*#*#*#*#*#*#*#*#*#*#*#*#*#*#'\n+            }\n+        }\n+        stage('Setup for MP TCK Runners') {\n+            steps {\n+                makeDomain()\n+            }\n+        }\n+        stage('Run MP TCK Tests') {\n+            steps {\n+                echo '*#*#*#*#*#*#*#*#*#*#*#*#  Running test  *#*#*#*#*#*#*#*#*#*#*#*#*#*#*#'\n+                sh \"\"\"mvn -B -V -ff -e clean verify \\\n+                -Djavax.net.ssl.trustStore=${env.JAVA_HOME}/jre/lib/security/cacerts \\\n+                -Djavax.xml.accessExternalSchema=all -Dpayara.version=${pom.version} \\\n+                -Dpayara_domain=${DOMAIN_NAME} -Duse.cnHost=true \\\n+                -Dsurefire.rerunFailingTestsCount=2 -Ppayara-server-managed,payara5\"\"\"", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MDYwNzkyNA=="}, "originalCommit": {"oid": "77dc9c8e2375223b4f9d1d309255eac896f2ffb6"}, "originalPosition": 34}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjk0MDg0NjM0OnYy", "diffSide": "RIGHT", "path": "Jenkinsfile", "isResolved": false, "comments": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xNFQxMzowMjoxM1rOHAzuNA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xNFQxNDoyMjoyNVrOHA2dYg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MDYwOTQ2MA==", "bodyText": "Would be nicer to only zip the logs on failure, otherwise you're just using disk space", "url": "https://github.com/payara/Payara/pull/4836#discussion_r470609460", "createdAt": "2020-08-14T13:02:13Z", "author": {"login": "MarkWareham"}, "path": "Jenkinsfile", "diffHunk": "@@ -99,6 +101,37 @@ pipeline {\n                }\n             }\n         }\n+        stage('Checkout MP TCK Runners') {\n+            steps{\n+                echo '*#*#*#*#*#*#*#*#*#*#*#*#  Checking out MP TCK Runners  *#*#*#*#*#*#*#*#*#*#*#*#*#*#*#'\n+                checkout changelog: false, poll: false, scm: [$class: 'GitSCM',\n+                    branches: [[name: \"*/master\"]],\n+                    userRemoteConfigs: [[url: \"https://github.com/payara/MicroProfile-TCK-Runners.git\"]]]\n+                echo '*#*#*#*#*#*#*#*#*#*#*#*#  Checked out MP TCK Runners  *#*#*#*#*#*#*#*#*#*#*#*#*#*#*#'\n+            }\n+        }\n+        stage('Setup for MP TCK Runners') {\n+            steps {\n+                makeDomain()\n+            }\n+        }\n+        stage('Run MP TCK Tests') {\n+            steps {\n+                echo '*#*#*#*#*#*#*#*#*#*#*#*#  Running test  *#*#*#*#*#*#*#*#*#*#*#*#*#*#*#'\n+                sh \"\"\"mvn -B -V -ff -e clean verify \\\n+                -Djavax.net.ssl.trustStore=${env.JAVA_HOME}/jre/lib/security/cacerts \\\n+                -Djavax.xml.accessExternalSchema=all -Dpayara.version=${pom.version} \\\n+                -Dpayara_domain=${DOMAIN_NAME} -Duse.cnHost=true \\\n+                -Dsurefire.rerunFailingTestsCount=2 -Ppayara-server-managed,payara5\"\"\"\n+                echo '*#*#*#*#*#*#*#*#*#*#*#*#  Ran test  *#*#*#*#*#*#*#*#*#*#*#*#*#*#*#'\n+            }\n+            post {\n+                always {\n+                    zip archive: true, dir: \"appserver/distributions/payara/target/stage/payara5/glassfish/domains/${DOMAIN_NAME}/logs\", glob: 'server.*', zipFile: 'mp-tck-log.zip'", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "77dc9c8e2375223b4f9d1d309255eac896f2ffb6"}, "originalPosition": 39}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MDYxNTY4Mw==", "bodyText": "I think that'll need a refactor on every other stage then aswell", "url": "https://github.com/payara/Payara/pull/4836#discussion_r470615683", "createdAt": "2020-08-14T13:14:00Z", "author": {"login": "AlanRoth"}, "path": "Jenkinsfile", "diffHunk": "@@ -99,6 +101,37 @@ pipeline {\n                }\n             }\n         }\n+        stage('Checkout MP TCK Runners') {\n+            steps{\n+                echo '*#*#*#*#*#*#*#*#*#*#*#*#  Checking out MP TCK Runners  *#*#*#*#*#*#*#*#*#*#*#*#*#*#*#'\n+                checkout changelog: false, poll: false, scm: [$class: 'GitSCM',\n+                    branches: [[name: \"*/master\"]],\n+                    userRemoteConfigs: [[url: \"https://github.com/payara/MicroProfile-TCK-Runners.git\"]]]\n+                echo '*#*#*#*#*#*#*#*#*#*#*#*#  Checked out MP TCK Runners  *#*#*#*#*#*#*#*#*#*#*#*#*#*#*#'\n+            }\n+        }\n+        stage('Setup for MP TCK Runners') {\n+            steps {\n+                makeDomain()\n+            }\n+        }\n+        stage('Run MP TCK Tests') {\n+            steps {\n+                echo '*#*#*#*#*#*#*#*#*#*#*#*#  Running test  *#*#*#*#*#*#*#*#*#*#*#*#*#*#*#'\n+                sh \"\"\"mvn -B -V -ff -e clean verify \\\n+                -Djavax.net.ssl.trustStore=${env.JAVA_HOME}/jre/lib/security/cacerts \\\n+                -Djavax.xml.accessExternalSchema=all -Dpayara.version=${pom.version} \\\n+                -Dpayara_domain=${DOMAIN_NAME} -Duse.cnHost=true \\\n+                -Dsurefire.rerunFailingTestsCount=2 -Ppayara-server-managed,payara5\"\"\"\n+                echo '*#*#*#*#*#*#*#*#*#*#*#*#  Ran test  *#*#*#*#*#*#*#*#*#*#*#*#*#*#*#'\n+            }\n+            post {\n+                always {\n+                    zip archive: true, dir: \"appserver/distributions/payara/target/stage/payara5/glassfish/domains/${DOMAIN_NAME}/logs\", glob: 'server.*', zipFile: 'mp-tck-log.zip'", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MDYwOTQ2MA=="}, "originalCommit": {"oid": "77dc9c8e2375223b4f9d1d309255eac896f2ffb6"}, "originalPosition": 39}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MDY0ODI0Ng==", "bodyText": "Problem I found is that the always stage will run before success stage, meaning the logs will get deleted in the teardown and it'll fail trying to find the logs in the success stage", "url": "https://github.com/payara/Payara/pull/4836#discussion_r470648246", "createdAt": "2020-08-14T14:12:16Z", "author": {"login": "AlanRoth"}, "path": "Jenkinsfile", "diffHunk": "@@ -99,6 +101,37 @@ pipeline {\n                }\n             }\n         }\n+        stage('Checkout MP TCK Runners') {\n+            steps{\n+                echo '*#*#*#*#*#*#*#*#*#*#*#*#  Checking out MP TCK Runners  *#*#*#*#*#*#*#*#*#*#*#*#*#*#*#'\n+                checkout changelog: false, poll: false, scm: [$class: 'GitSCM',\n+                    branches: [[name: \"*/master\"]],\n+                    userRemoteConfigs: [[url: \"https://github.com/payara/MicroProfile-TCK-Runners.git\"]]]\n+                echo '*#*#*#*#*#*#*#*#*#*#*#*#  Checked out MP TCK Runners  *#*#*#*#*#*#*#*#*#*#*#*#*#*#*#'\n+            }\n+        }\n+        stage('Setup for MP TCK Runners') {\n+            steps {\n+                makeDomain()\n+            }\n+        }\n+        stage('Run MP TCK Tests') {\n+            steps {\n+                echo '*#*#*#*#*#*#*#*#*#*#*#*#  Running test  *#*#*#*#*#*#*#*#*#*#*#*#*#*#*#'\n+                sh \"\"\"mvn -B -V -ff -e clean verify \\\n+                -Djavax.net.ssl.trustStore=${env.JAVA_HOME}/jre/lib/security/cacerts \\\n+                -Djavax.xml.accessExternalSchema=all -Dpayara.version=${pom.version} \\\n+                -Dpayara_domain=${DOMAIN_NAME} -Duse.cnHost=true \\\n+                -Dsurefire.rerunFailingTestsCount=2 -Ppayara-server-managed,payara5\"\"\"\n+                echo '*#*#*#*#*#*#*#*#*#*#*#*#  Ran test  *#*#*#*#*#*#*#*#*#*#*#*#*#*#*#'\n+            }\n+            post {\n+                always {\n+                    zip archive: true, dir: \"appserver/distributions/payara/target/stage/payara5/glassfish/domains/${DOMAIN_NAME}/logs\", glob: 'server.*', zipFile: 'mp-tck-log.zip'", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MDYwOTQ2MA=="}, "originalCommit": {"oid": "77dc9c8e2375223b4f9d1d309255eac896f2ffb6"}, "originalPosition": 39}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MDY1NDMwNg==", "bodyText": "Cleanup stage to the rescue", "url": "https://github.com/payara/Payara/pull/4836#discussion_r470654306", "createdAt": "2020-08-14T14:22:25Z", "author": {"login": "AlanRoth"}, "path": "Jenkinsfile", "diffHunk": "@@ -99,6 +101,37 @@ pipeline {\n                }\n             }\n         }\n+        stage('Checkout MP TCK Runners') {\n+            steps{\n+                echo '*#*#*#*#*#*#*#*#*#*#*#*#  Checking out MP TCK Runners  *#*#*#*#*#*#*#*#*#*#*#*#*#*#*#'\n+                checkout changelog: false, poll: false, scm: [$class: 'GitSCM',\n+                    branches: [[name: \"*/master\"]],\n+                    userRemoteConfigs: [[url: \"https://github.com/payara/MicroProfile-TCK-Runners.git\"]]]\n+                echo '*#*#*#*#*#*#*#*#*#*#*#*#  Checked out MP TCK Runners  *#*#*#*#*#*#*#*#*#*#*#*#*#*#*#'\n+            }\n+        }\n+        stage('Setup for MP TCK Runners') {\n+            steps {\n+                makeDomain()\n+            }\n+        }\n+        stage('Run MP TCK Tests') {\n+            steps {\n+                echo '*#*#*#*#*#*#*#*#*#*#*#*#  Running test  *#*#*#*#*#*#*#*#*#*#*#*#*#*#*#'\n+                sh \"\"\"mvn -B -V -ff -e clean verify \\\n+                -Djavax.net.ssl.trustStore=${env.JAVA_HOME}/jre/lib/security/cacerts \\\n+                -Djavax.xml.accessExternalSchema=all -Dpayara.version=${pom.version} \\\n+                -Dpayara_domain=${DOMAIN_NAME} -Duse.cnHost=true \\\n+                -Dsurefire.rerunFailingTestsCount=2 -Ppayara-server-managed,payara5\"\"\"\n+                echo '*#*#*#*#*#*#*#*#*#*#*#*#  Ran test  *#*#*#*#*#*#*#*#*#*#*#*#*#*#*#'\n+            }\n+            post {\n+                always {\n+                    zip archive: true, dir: \"appserver/distributions/payara/target/stage/payara5/glassfish/domains/${DOMAIN_NAME}/logs\", glob: 'server.*', zipFile: 'mp-tck-log.zip'", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MDYwOTQ2MA=="}, "originalCommit": {"oid": "77dc9c8e2375223b4f9d1d309255eac896f2ffb6"}, "originalPosition": 39}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjk0MTA2MzM5OnYy", "diffSide": "RIGHT", "path": "Jenkinsfile", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xNFQxNDowMzowM1rOHA1xPg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xNFQxNDowMzowM1rOHA1xPg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MDY0MzAwNg==", "bodyText": "We always want to collect the junit results", "url": "https://github.com/payara/Payara/pull/4836#discussion_r470643006", "createdAt": "2020-08-14T14:03:03Z", "author": {"login": "MarkWareham"}, "path": "Jenkinsfile", "diffHunk": "@@ -73,11 +75,13 @@ pipeline {\n                 echo '*#*#*#*#*#*#*#*#*#*#*#*#  Ran test  *#*#*#*#*#*#*#*#*#*#*#*#*#*#*#'\n             }\n             post {\n-                always {\n+                success {\n                     zip archive: true, dir: \"appserver/distributions/payara/target/stage/payara5/glassfish/domains/${DOMAIN_NAME}/logs\", glob: 'server.*', zipFile: 'quicklook-log.zip'\n-                    teardownDomain()\n                     junit '**/target/surefire-reports/*.xml'", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "382c12e2f5e32ea9d6cf7c04c67d895b6d7a7b4f"}, "originalPosition": 17}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1303, "cost": 1, "resetAt": "2021-11-12T12:57:47Z"}}}