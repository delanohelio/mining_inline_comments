{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDY3OTE4MzE4", "number": 4836, "title": "QACI-195 Add MP TCKs to PR tests", "bodyText": "Adds MP TCK Runners to Jenkinsfile to include them as standard testing when merging a PR.", "createdAt": "2020-08-14T10:57:12Z", "url": "https://github.com/payara/Payara/pull/4836", "merged": true, "mergeCommit": {"oid": "05524a533833a970323f2df40b977ba6f07f64bc"}, "closed": true, "closedAt": "2020-08-17T10:27:08Z", "author": {"login": "AlanRoth"}, "timelineItems": {"totalCount": 31, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcrPdbsgH2gAyNDY3OTE4MzE4OjBiZDc4NGU0ZjQ0MDE0MjEyYzlkZjAxMDBlMzM2MDExYjRhMzUzOGE=", "endCursor": "Y3Vyc29yOnYyOpPPAAABc_t4xdgH2gAyNDY3OTE4MzE4OjI1MzQ3ODg2MjJmMzQ3Y2M0MjNhMTc4ZmM4OTg1YjMxMWJkOTNiODg=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "0bd784e4f44014212c9df0100e336011b4a3538a", "author": {"user": {"login": "MarkWareham", "name": "Mark Wareham"}}, "url": "https://github.com/payara/Payara/commit/0bd784e4f44014212c9df0100e336011b4a3538a", "committedDate": "2020-06-14T17:25:33Z", "message": "Add MP TCKs to PR tests"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "36a17a69cab350a0eae245cc8465bd92c7bd9ba4", "author": {"user": {"login": "MarkWareham", "name": "Mark Wareham"}}, "url": "https://github.com/payara/Payara/commit/36a17a69cab350a0eae245cc8465bd92c7bd9ba4", "committedDate": "2020-06-25T14:41:02Z", "message": "Update Jenkinsfile\n\nCo-authored-by: Alan <alan.roth@payara.fish>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "7e532a2e4a7ca7a975561134a21e661cc2b7683d", "author": {"user": {"login": "MarkWareham", "name": "Mark Wareham"}}, "url": "https://github.com/payara/Payara/commit/7e532a2e4a7ca7a975561134a21e661cc2b7683d", "committedDate": "2020-06-25T14:44:16Z", "message": "remove redundant profile"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "712b71228410ecd43f0708083d70aecaec0aec10", "author": {"user": {"login": "AlanRoth", "name": "Alan"}}, "url": "https://github.com/payara/Payara/commit/712b71228410ecd43f0708083d70aecaec0aec10", "committedDate": "2020-06-26T09:34:06Z", "message": "Added required variables and move test near the top"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "dd86ca19280d570228a237f25e6f67a923b905b1", "author": {"user": {"login": "AlanRoth", "name": "Alan"}}, "url": "https://github.com/payara/Payara/commit/dd86ca19280d570228a237f25e6f67a923b905b1", "committedDate": "2020-06-26T09:37:37Z", "message": "Remove JenkinsFile-Microprofile, not used"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "36e294a68d6ed2a3188b6c526865724599f3b7f7", "author": {"user": {"login": "MarkWareham", "name": "Mark Wareham"}}, "url": "https://github.com/payara/Payara/commit/36e294a68d6ed2a3188b6c526865724599f3b7f7", "committedDate": "2020-06-26T13:01:05Z", "message": "Merge pull request #10 from AlanRoth/add-mp-tcks\n\nQACI-195 Add MP TCKs to PR tests"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "9ac58df2c758e6a273106781a5b878b976a7c82c", "author": {"user": {"login": "AlanRoth", "name": "Alan"}}, "url": "https://github.com/payara/Payara/commit/9ac58df2c758e6a273106781a5b878b976a7c82c", "committedDate": "2020-06-30T07:56:26Z", "message": "Removed expired certificates"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "2b6afbc24c3c1bc8088b60dd0457a0bad51023de", "author": {"user": {"login": "AlanRoth", "name": "Alan"}}, "url": "https://github.com/payara/Payara/commit/2b6afbc24c3c1bc8088b60dd0457a0bad51023de", "committedDate": "2020-06-30T12:29:00Z", "message": "Merge pull request #27 from MarkWareham/add-mp-tcks\n\nMerge pull request #10 from AlanRoth/add-mp-tcks"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "413d65a47e40abad43175b5df291154a3a8a807d", "author": {"user": {"login": "AlanRoth", "name": "Alan"}}, "url": "https://github.com/payara/Payara/commit/413d65a47e40abad43175b5df291154a3a8a807d", "committedDate": "2020-06-30T12:33:12Z", "message": "Merge pull request #28 from AlanRoth/expired-certs\n\nExpired certs"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "78f320e87a2405358eda687752cbfa368bec5384", "author": {"user": {"login": "AlanRoth", "name": "Alan"}}, "url": "https://github.com/payara/Payara/commit/78f320e87a2405358eda687752cbfa368bec5384", "committedDate": "2020-07-02T08:16:55Z", "message": "Add capital variable to env in pipeline\n\nWorkaround for case sensitivity bug in jenkins"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "455b44dbf87c992f48f4706258ec080f041dea9d", "author": {"user": {"login": "AlanRoth", "name": "Alan"}}, "url": "https://github.com/payara/Payara/commit/455b44dbf87c992f48f4706258ec080f041dea9d", "committedDate": "2020-07-03T10:56:57Z", "message": "Export variables before mptck are ran"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c5bd572b5993879f52fdc739c9c2e84d1f9c9df6", "author": {"user": {"login": "AlanRoth", "name": "Alan"}}, "url": "https://github.com/payara/Payara/commit/c5bd572b5993879f52fdc739c9c2e84d1f9c9df6", "committedDate": "2020-07-07T10:55:32Z", "message": "removed redundant property in env var in pipeline"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "78479e2bdea065268a96c14b678bf0117036047f", "author": {"user": {"login": "AlanRoth", "name": "Alan"}}, "url": "https://github.com/payara/Payara/commit/78479e2bdea065268a96c14b678bf0117036047f", "committedDate": "2020-07-09T10:45:22Z", "message": "Run MPTCKs with Payara-Managed"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ae50d90277ca36059bccbde2af6a47ccd8ce301d", "author": {"user": {"login": "AlanRoth", "name": "Alan"}}, "url": "https://github.com/payara/Payara/commit/ae50d90277ca36059bccbde2af6a47ccd8ce301d", "committedDate": "2020-07-09T10:46:10Z", "message": "Merge branch 'add-mp-tcks' of https://github.com/AlanRoth/Payara into add-mp-tcks"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "9c3297eaf188b521eac17830982357dd67b45e70", "author": {"user": {"login": "AlanRoth", "name": "Alan"}}, "url": "https://github.com/payara/Payara/commit/9c3297eaf188b521eac17830982357dd67b45e70", "committedDate": "2020-07-14T10:06:20Z", "message": "Merge pull request #29 from payara/master\n\nsync branch with master"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "851c97f07f60c883891af952a08c6c5c56b3702e", "author": {"user": {"login": "AlanRoth", "name": "Alan"}}, "url": "https://github.com/payara/Payara/commit/851c97f07f60c883891af952a08c6c5c56b3702e", "committedDate": "2020-07-14T10:37:34Z", "message": "Mptck only jenkinsfile"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c2adf29b80943411a7eb0a4b4e98fa13eb29bebf", "author": {"user": {"login": "AlanRoth", "name": "Alan"}}, "url": "https://github.com/payara/Payara/commit/c2adf29b80943411a7eb0a4b4e98fa13eb29bebf", "committedDate": "2020-07-14T11:15:29Z", "message": "Quick build"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "265cd6c1b1a3964a5edcc60df5e0b8213e7df186", "author": {"user": {"login": "AlanRoth", "name": "Alan"}}, "url": "https://github.com/payara/Payara/commit/265cd6c1b1a3964a5edcc60df5e0b8213e7df186", "committedDate": "2020-07-14T11:27:41Z", "message": "Added skips"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "377c96e8dfd5d9b2c19a78c1ea6e1eb1a342020e", "author": {"user": {"login": "AlanRoth", "name": "Alan"}}, "url": "https://github.com/payara/Payara/commit/377c96e8dfd5d9b2c19a78c1ea6e1eb1a342020e", "committedDate": "2020-07-14T12:19:51Z", "message": "removed redundant profiles"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f1f79375e2316dbab44b9500ceede55a734672d8", "author": {"user": {"login": "AlanRoth", "name": "Alan"}}, "url": "https://github.com/payara/Payara/commit/f1f79375e2316dbab44b9500ceede55a734672d8", "committedDate": "2020-07-14T12:20:57Z", "message": "Remove post always stage"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ced7fa8b5980109fabea0d6a75650772d68b5288", "author": {"user": {"login": "AlanRoth", "name": "Alan"}}, "url": "https://github.com/payara/Payara/commit/ced7fa8b5980109fabea0d6a75650772d68b5288", "committedDate": "2020-08-14T10:30:09Z", "message": "Merge branch 'add-mp-tcks' of https://github.com/AlanRoth/payara into add-mp-tcks"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "77dc9c8e2375223b4f9d1d309255eac896f2ffb6", "author": {"user": {"login": "AlanRoth", "name": "Alan"}}, "url": "https://github.com/payara/Payara/commit/77dc9c8e2375223b4f9d1d309255eac896f2ffb6", "committedDate": "2020-08-14T10:47:24Z", "message": "Removed testing file"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e856c4fac604db9b613e669566fc3b11a544f145", "author": {"user": {"login": "AlanRoth", "name": "Alan"}}, "url": "https://github.com/payara/Payara/commit/e856c4fac604db9b613e669566fc3b11a544f145", "committedDate": "2020-08-14T12:59:30Z", "message": "Teardown domain after MPTCKs"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDY3NTUzNjc1", "url": "https://github.com/payara/Payara/pull/4836#pullrequestreview-467553675", "createdAt": "2020-08-14T12:59:14Z", "commit": {"oid": "77dc9c8e2375223b4f9d1d309255eac896f2ffb6"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xNFQxMjo1OToxNFrOHAzoNA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xNFQxMzowMjoxM1rOHAzuNA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MDYwNzkyNA==", "bodyText": "I note you are running managed profile. Why would this stage need the stage \"Setup for MP TCK Runners\" ?", "url": "https://github.com/payara/Payara/pull/4836#discussion_r470607924", "createdAt": "2020-08-14T12:59:14Z", "author": {"login": "MarkWareham"}, "path": "Jenkinsfile", "diffHunk": "@@ -99,6 +101,37 @@ pipeline {\n                }\n             }\n         }\n+        stage('Checkout MP TCK Runners') {\n+            steps{\n+                echo '*#*#*#*#*#*#*#*#*#*#*#*#  Checking out MP TCK Runners  *#*#*#*#*#*#*#*#*#*#*#*#*#*#*#'\n+                checkout changelog: false, poll: false, scm: [$class: 'GitSCM',\n+                    branches: [[name: \"*/master\"]],\n+                    userRemoteConfigs: [[url: \"https://github.com/payara/MicroProfile-TCK-Runners.git\"]]]\n+                echo '*#*#*#*#*#*#*#*#*#*#*#*#  Checked out MP TCK Runners  *#*#*#*#*#*#*#*#*#*#*#*#*#*#*#'\n+            }\n+        }\n+        stage('Setup for MP TCK Runners') {\n+            steps {\n+                makeDomain()\n+            }\n+        }\n+        stage('Run MP TCK Tests') {\n+            steps {\n+                echo '*#*#*#*#*#*#*#*#*#*#*#*#  Running test  *#*#*#*#*#*#*#*#*#*#*#*#*#*#*#'\n+                sh \"\"\"mvn -B -V -ff -e clean verify \\\n+                -Djavax.net.ssl.trustStore=${env.JAVA_HOME}/jre/lib/security/cacerts \\\n+                -Djavax.xml.accessExternalSchema=all -Dpayara.version=${pom.version} \\\n+                -Dpayara_domain=${DOMAIN_NAME} -Duse.cnHost=true \\\n+                -Dsurefire.rerunFailingTestsCount=2 -Ppayara-server-managed,payara5\"\"\"", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "77dc9c8e2375223b4f9d1d309255eac896f2ffb6"}, "originalPosition": 34}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MDYwOTQ2MA==", "bodyText": "Would be nicer to only zip the logs on failure, otherwise you're just using disk space", "url": "https://github.com/payara/Payara/pull/4836#discussion_r470609460", "createdAt": "2020-08-14T13:02:13Z", "author": {"login": "MarkWareham"}, "path": "Jenkinsfile", "diffHunk": "@@ -99,6 +101,37 @@ pipeline {\n                }\n             }\n         }\n+        stage('Checkout MP TCK Runners') {\n+            steps{\n+                echo '*#*#*#*#*#*#*#*#*#*#*#*#  Checking out MP TCK Runners  *#*#*#*#*#*#*#*#*#*#*#*#*#*#*#'\n+                checkout changelog: false, poll: false, scm: [$class: 'GitSCM',\n+                    branches: [[name: \"*/master\"]],\n+                    userRemoteConfigs: [[url: \"https://github.com/payara/MicroProfile-TCK-Runners.git\"]]]\n+                echo '*#*#*#*#*#*#*#*#*#*#*#*#  Checked out MP TCK Runners  *#*#*#*#*#*#*#*#*#*#*#*#*#*#*#'\n+            }\n+        }\n+        stage('Setup for MP TCK Runners') {\n+            steps {\n+                makeDomain()\n+            }\n+        }\n+        stage('Run MP TCK Tests') {\n+            steps {\n+                echo '*#*#*#*#*#*#*#*#*#*#*#*#  Running test  *#*#*#*#*#*#*#*#*#*#*#*#*#*#*#'\n+                sh \"\"\"mvn -B -V -ff -e clean verify \\\n+                -Djavax.net.ssl.trustStore=${env.JAVA_HOME}/jre/lib/security/cacerts \\\n+                -Djavax.xml.accessExternalSchema=all -Dpayara.version=${pom.version} \\\n+                -Dpayara_domain=${DOMAIN_NAME} -Duse.cnHost=true \\\n+                -Dsurefire.rerunFailingTestsCount=2 -Ppayara-server-managed,payara5\"\"\"\n+                echo '*#*#*#*#*#*#*#*#*#*#*#*#  Ran test  *#*#*#*#*#*#*#*#*#*#*#*#*#*#*#'\n+            }\n+            post {\n+                always {\n+                    zip archive: true, dir: \"appserver/distributions/payara/target/stage/payara5/glassfish/domains/${DOMAIN_NAME}/logs\", glob: 'server.*', zipFile: 'mp-tck-log.zip'", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "77dc9c8e2375223b4f9d1d309255eac896f2ffb6"}, "originalPosition": 39}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "382c12e2f5e32ea9d6cf7c04c67d895b6d7a7b4f", "author": {"user": {"login": "AlanRoth", "name": "Alan"}}, "url": "https://github.com/payara/Payara/commit/382c12e2f5e32ea9d6cf7c04c67d895b6d7a7b4f", "committedDate": "2020-08-14T13:22:10Z", "message": "Save logs only on success, no domain setup for managed profile"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDY3NjAwMjk3", "url": "https://github.com/payara/Payara/pull/4836#pullrequestreview-467600297", "createdAt": "2020-08-14T14:03:03Z", "commit": {"oid": "382c12e2f5e32ea9d6cf7c04c67d895b6d7a7b4f"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xNFQxNDowMzowM1rOHA1xPg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xNFQxNDowMzowM1rOHA1xPg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MDY0MzAwNg==", "bodyText": "We always want to collect the junit results", "url": "https://github.com/payara/Payara/pull/4836#discussion_r470643006", "createdAt": "2020-08-14T14:03:03Z", "author": {"login": "MarkWareham"}, "path": "Jenkinsfile", "diffHunk": "@@ -73,11 +75,13 @@ pipeline {\n                 echo '*#*#*#*#*#*#*#*#*#*#*#*#  Ran test  *#*#*#*#*#*#*#*#*#*#*#*#*#*#*#'\n             }\n             post {\n-                always {\n+                success {\n                     zip archive: true, dir: \"appserver/distributions/payara/target/stage/payara5/glassfish/domains/${DOMAIN_NAME}/logs\", glob: 'server.*', zipFile: 'quicklook-log.zip'\n-                    teardownDomain()\n                     junit '**/target/surefire-reports/*.xml'", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "382c12e2f5e32ea9d6cf7c04c67d895b6d7a7b4f"}, "originalPosition": 17}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "07c5f24618caff7b0f7be1180ceb088ced8e7377", "author": {"user": {"login": "AlanRoth", "name": "Alan"}}, "url": "https://github.com/payara/Payara/commit/07c5f24618caff7b0f7be1180ceb088ced8e7377", "committedDate": "2020-08-14T14:20:01Z", "message": "Always save junit and teardown domain in cleanup stage"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "7a959b530ed0945ca1153f1cecdd0169e32387cd", "author": {"user": {"login": "AlanRoth", "name": "Alan"}}, "url": "https://github.com/payara/Payara/commit/7a959b530ed0945ca1153f1cecdd0169e32387cd", "committedDate": "2020-08-14T14:23:35Z", "message": "typo"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "83d8856d99ca9ed6d0ab9b2470342f5f1dab9764", "author": {"user": {"login": "AlanRoth", "name": "Alan"}}, "url": "https://github.com/payara/Payara/commit/83d8856d99ca9ed6d0ab9b2470342f5f1dab9764", "committedDate": "2020-08-14T14:33:27Z", "message": "Save logs on failure"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDY3NjI1ODE3", "url": "https://github.com/payara/Payara/pull/4836#pullrequestreview-467625817", "createdAt": "2020-08-14T14:35:50Z", "commit": {"oid": "83d8856d99ca9ed6d0ab9b2470342f5f1dab9764"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "2534788622f347cc423a178fc8985b311bd93b88", "author": {"user": {"login": "AlanRoth", "name": "Alan"}}, "url": "https://github.com/payara/Payara/commit/2534788622f347cc423a178fc8985b311bd93b88", "committedDate": "2020-08-17T08:11:03Z", "message": "Typo"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 767, "cost": 1, "resetAt": "2021-11-01T16:19:10Z"}}}