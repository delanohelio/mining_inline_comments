{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDE1MTIzMjU2", "number": 4659, "reviewThreads": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xMlQxNjo1NDozNlrOD7vaJg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xMlQxNjo1NDozNlrOD7vaJg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjYzOTY5MzE4OnYy", "diffSide": "RIGHT", "path": "appserver/payara-appserver-modules/security-openid/src/main/java/fish/payara/security/openid/OpenIdAuthenticationMechanism.java", "isResolved": true, "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xMlQxNjo1NDozNlrOGUQC5Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xOFQxNToyNDowMlrOGW8KnA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMzg4NzU4OQ==", "bodyText": "Hi, what is the reason of adding extra redirectURI.contains(request.getServletPath()) check?\nit breaks existing applications, (I just debugged it),\nif redirectURI is \"https://localhost:8181/myapp/\" and a welcome file is specified, i.e.\n\nfaces/About.xhtml\n\nrequest.getServletPath() returns \"/faces\" and this check fails. In case of index.html it returns \"/index.html\". Setting welcome-file to \"/\" makes authentication work again, but breaks user experience.", "url": "https://github.com/payara/Payara/pull/4659#discussion_r423887589", "createdAt": "2020-05-12T16:54:36Z", "author": {"login": "NikitaZ"}, "path": "appserver/payara-appserver-modules/security-openid/src/main/java/fish/payara/security/openid/OpenIdAuthenticationMechanism.java", "diffHunk": "@@ -235,21 +236,22 @@ private AuthenticationStatus authenticate(\n \n         Optional<OpenIdState> receivedState = OpenIdState.from(request.getParameter(STATE));\n         String redirectURI = configuration.buildRedirectURI(request);\n-        if (receivedState.isPresent()\n-                && request.getRequestURL().toString().equals(redirectURI)) {\n-\n+        if (receivedState.isPresent() && redirectURI.contains(request.getServletPath())) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b72d4f7d2e307a7e5720abe44824e9db862e0163"}, "originalPosition": 24}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMzg5MDExOA==", "bodyText": "I don't think I want to set redirectURI to https://localhost:8181/myapp/faces/About.xhtml, it breaks the idea of welcome-file, if it changes one also have to change configuration at openID provider (Google Cloud in my case). Or we have to add a servlet for redirect URI and then forward to proper page which again reinvents welcome-file. Please, advice!", "url": "https://github.com/payara/Payara/pull/4659#discussion_r423890118", "createdAt": "2020-05-12T16:58:16Z", "author": {"login": "NikitaZ"}, "path": "appserver/payara-appserver-modules/security-openid/src/main/java/fish/payara/security/openid/OpenIdAuthenticationMechanism.java", "diffHunk": "@@ -235,21 +236,22 @@ private AuthenticationStatus authenticate(\n \n         Optional<OpenIdState> receivedState = OpenIdState.from(request.getParameter(STATE));\n         String redirectURI = configuration.buildRedirectURI(request);\n-        if (receivedState.isPresent()\n-                && request.getRequestURL().toString().equals(redirectURI)) {\n-\n+        if (receivedState.isPresent() && redirectURI.contains(request.getServletPath())) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMzg4NzU4OQ=="}, "originalCommit": {"oid": "b72d4f7d2e307a7e5720abe44824e9db862e0163"}, "originalPosition": 24}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNjcwNzYxMg==", "bodyText": "Thanks Nikita,\nI also confirm the issue, if the callback URL is mapped to home. Updated the PR.", "url": "https://github.com/payara/Payara/pull/4659#discussion_r426707612", "createdAt": "2020-05-18T15:24:02Z", "author": {"login": "jGauravGupta"}, "path": "appserver/payara-appserver-modules/security-openid/src/main/java/fish/payara/security/openid/OpenIdAuthenticationMechanism.java", "diffHunk": "@@ -235,21 +236,22 @@ private AuthenticationStatus authenticate(\n \n         Optional<OpenIdState> receivedState = OpenIdState.from(request.getParameter(STATE));\n         String redirectURI = configuration.buildRedirectURI(request);\n-        if (receivedState.isPresent()\n-                && request.getRequestURL().toString().equals(redirectURI)) {\n-\n+        if (receivedState.isPresent() && redirectURI.contains(request.getServletPath())) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMzg4NzU4OQ=="}, "originalCommit": {"oid": "b72d4f7d2e307a7e5720abe44824e9db862e0163"}, "originalPosition": 24}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1342, "cost": 1, "resetAt": "2021-11-12T12:57:47Z"}}}