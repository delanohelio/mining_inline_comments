{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0Mzk0NjMxNDIw", "number": 4594, "reviewThreads": {"totalCount": 11, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yN1QwOTowNToyM1rODr-nSg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yMVQwODo1NzoyOFrOD0IZQQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjQ3NDQxMjI2OnYy", "diffSide": "RIGHT", "path": "appserver/extras/docker-images/server-full/src/main/docker/Dockerfile", "isResolved": true, "comments": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yN1QwOTowNToyM1rOF8ocrw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yN1QxMjoyODoyMlrOF8u_2g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5OTEyMTU4Mw==", "bodyText": "Unless there is special reason for that, we should keep single add and thus single intermediate image.", "url": "https://github.com/payara/Payara/pull/4594#discussion_r399121583", "createdAt": "2020-03-27T09:05:23Z", "author": {"login": "pdudits"}, "path": "appserver/extras/docker-images/server-full/src/main/docker/Dockerfile", "diffHunk": "@@ -29,25 +29,25 @@ ENV PATH=\"${PATH}:${PAYARA_DIR}/bin\"\n ARG TINI_VERSION=v0.18.0\n \n # Download tini\n-ADD https://github.com/krallin/tini/releases/download/${TINI_VERSION}/tini \\\n-    https://github.com/krallin/tini/releases/download/${TINI_VERSION}/tini.asc /\n+ADD https://github.com/krallin/tini/releases/download/${TINI_VERSION}/tini /tini\n+ADD https://github.com/krallin/tini/releases/download/${TINI_VERSION}/tini.asc /tini.asc", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "9f28eedcc4945a65fd4d407b7414511f45ecb6a1"}, "originalPosition": 7}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5OTIwMzE0Mw==", "bodyText": "We use --no-cache, so layers are not cached and used.\nAnd also docker does not mention this as allowed in documentation, I found only a merged PR where it was implemented somehow. So I would rather avoid it.\nThe RUN command is different case, it is in all examples and each execution can make many changes.\nhttps://stackoverflow.com/questions/35594987/how-to-force-docker-for-a-clean-build-of-an-image\nfabric8io/docker-maven-plugin#348", "url": "https://github.com/payara/Payara/pull/4594#discussion_r399203143", "createdAt": "2020-03-27T11:36:09Z", "author": {"login": "dmatej"}, "path": "appserver/extras/docker-images/server-full/src/main/docker/Dockerfile", "diffHunk": "@@ -29,25 +29,25 @@ ENV PATH=\"${PATH}:${PAYARA_DIR}/bin\"\n ARG TINI_VERSION=v0.18.0\n \n # Download tini\n-ADD https://github.com/krallin/tini/releases/download/${TINI_VERSION}/tini \\\n-    https://github.com/krallin/tini/releases/download/${TINI_VERSION}/tini.asc /\n+ADD https://github.com/krallin/tini/releases/download/${TINI_VERSION}/tini /tini\n+ADD https://github.com/krallin/tini/releases/download/${TINI_VERSION}/tini.asc /tini.asc", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5OTEyMTU4Mw=="}, "originalCommit": {"oid": "9f28eedcc4945a65fd4d407b7414511f45ecb6a1"}, "originalPosition": 7}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5OTIxNTA2NA==", "bodyText": "https://docs.docker.com/engine/reference/builder/#add\nADD [--chown=<user>:<group>] <src>... <dest>\nNote the ellipsis.", "url": "https://github.com/payara/Payara/pull/4594#discussion_r399215064", "createdAt": "2020-03-27T12:00:45Z", "author": {"login": "pdudits"}, "path": "appserver/extras/docker-images/server-full/src/main/docker/Dockerfile", "diffHunk": "@@ -29,25 +29,25 @@ ENV PATH=\"${PATH}:${PAYARA_DIR}/bin\"\n ARG TINI_VERSION=v0.18.0\n \n # Download tini\n-ADD https://github.com/krallin/tini/releases/download/${TINI_VERSION}/tini \\\n-    https://github.com/krallin/tini/releases/download/${TINI_VERSION}/tini.asc /\n+ADD https://github.com/krallin/tini/releases/download/${TINI_VERSION}/tini /tini\n+ADD https://github.com/krallin/tini/releases/download/${TINI_VERSION}/tini.asc /tini.asc", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5OTEyMTU4Mw=="}, "originalCommit": {"oid": "9f28eedcc4945a65fd4d407b7414511f45ecb6a1"}, "originalPosition": 7}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5OTIyODg5MA==", "bodyText": "OK, you win. I don't know why my brain ignored it :D", "url": "https://github.com/payara/Payara/pull/4594#discussion_r399228890", "createdAt": "2020-03-27T12:28:22Z", "author": {"login": "dmatej"}, "path": "appserver/extras/docker-images/server-full/src/main/docker/Dockerfile", "diffHunk": "@@ -29,25 +29,25 @@ ENV PATH=\"${PATH}:${PAYARA_DIR}/bin\"\n ARG TINI_VERSION=v0.18.0\n \n # Download tini\n-ADD https://github.com/krallin/tini/releases/download/${TINI_VERSION}/tini \\\n-    https://github.com/krallin/tini/releases/download/${TINI_VERSION}/tini.asc /\n+ADD https://github.com/krallin/tini/releases/download/${TINI_VERSION}/tini /tini\n+ADD https://github.com/krallin/tini/releases/download/${TINI_VERSION}/tini.asc /tini.asc", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5OTEyMTU4Mw=="}, "originalCommit": {"oid": "9f28eedcc4945a65fd4d407b7414511f45ecb6a1"}, "originalPosition": 7}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjQ3NDQxOTkzOnYy", "diffSide": "RIGHT", "path": "appserver/extras/docker-images/micro/src/main/docker/Dockerfile", "isResolved": true, "comments": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yN1QwOTowNzo0NlrOF8ohtA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wNlQxNjoxODo0NlrOGBflEA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5OTEyMjg2OA==", "bodyText": "As in other Dockerfiles, despite it uses same directory here", "url": "https://github.com/payara/Payara/pull/4594#discussion_r399122868", "createdAt": "2020-03-27T09:07:46Z", "author": {"login": "dmatej"}, "path": "appserver/extras/docker-images/micro/src/main/docker/Dockerfile", "diffHunk": "@@ -4,20 +4,21 @@ FROM @docker.java.image@\n EXPOSE 6900 8080\n \n # Configure environment variables\n-ENV PAYARA_HOME=/opt/payara\\\n+ENV HOME_DIR=/opt/payara", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "9f28eedcc4945a65fd4d407b7414511f45ecb6a1"}, "originalPosition": 5}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5OTEzMzU3NQ==", "bodyText": "The change of the ENV name will affect all users who extend our images and possible require them to adjust their dockerfiles.", "url": "https://github.com/payara/Payara/pull/4594#discussion_r399133575", "createdAt": "2020-03-27T09:26:38Z", "author": {"login": "rdebusscher"}, "path": "appserver/extras/docker-images/micro/src/main/docker/Dockerfile", "diffHunk": "@@ -4,20 +4,21 @@ FROM @docker.java.image@\n EXPOSE 6900 8080\n \n # Configure environment variables\n-ENV PAYARA_HOME=/opt/payara\\\n+ENV HOME_DIR=/opt/payara", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5OTEyMjg2OA=="}, "originalCommit": {"oid": "9f28eedcc4945a65fd4d407b7414511f45ecb6a1"}, "originalPosition": 5}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5OTE4ODg3Nw==", "bodyText": "In this release is much more breaking changes in docker files, so I think it is a good oportunity to synchronize behavior of all images to same principles and provide documentation about how things work.\nBut then it would be good to use also same directory structure in all three Dockerfiles.", "url": "https://github.com/payara/Payara/pull/4594#discussion_r399188877", "createdAt": "2020-03-27T11:07:39Z", "author": {"login": "dmatej"}, "path": "appserver/extras/docker-images/micro/src/main/docker/Dockerfile", "diffHunk": "@@ -4,20 +4,21 @@ FROM @docker.java.image@\n EXPOSE 6900 8080\n \n # Configure environment variables\n-ENV PAYARA_HOME=/opt/payara\\\n+ENV HOME_DIR=/opt/payara", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5OTEyMjg2OA=="}, "originalCommit": {"oid": "9f28eedcc4945a65fd4d407b7414511f45ecb6a1"}, "originalPosition": 5}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNDIxOTE1Mg==", "bodyText": "Seems that other changes are not so much breaking as I thought, so I brought  the PAYARA_HOME back to life here.", "url": "https://github.com/payara/Payara/pull/4594#discussion_r404219152", "createdAt": "2020-04-06T16:18:46Z", "author": {"login": "dmatej"}, "path": "appserver/extras/docker-images/micro/src/main/docker/Dockerfile", "diffHunk": "@@ -4,20 +4,21 @@ FROM @docker.java.image@\n EXPOSE 6900 8080\n \n # Configure environment variables\n-ENV PAYARA_HOME=/opt/payara\\\n+ENV HOME_DIR=/opt/payara", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5OTEyMjg2OA=="}, "originalCommit": {"oid": "9f28eedcc4945a65fd4d407b7414511f45ecb6a1"}, "originalPosition": 5}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjQ3NDQyMjI0OnYy", "diffSide": "RIGHT", "path": "appserver/extras/docker-images/micro/src/main/docker/Dockerfile", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yN1QwOTowODoyN1rOF8ojKQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yN1QwOTowODoyN1rOF8ojKQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5OTEyMzI0MQ==", "bodyText": "Evil block - this works in alpine, debian and ubuntu", "url": "https://github.com/payara/Payara/pull/4594#discussion_r399123241", "createdAt": "2020-03-27T09:08:27Z", "author": {"login": "dmatej"}, "path": "appserver/extras/docker-images/micro/src/main/docker/Dockerfile", "diffHunk": "@@ -4,20 +4,21 @@ FROM @docker.java.image@\n EXPOSE 6900 8080\n \n # Configure environment variables\n-ENV PAYARA_HOME=/opt/payara\\\n+ENV HOME_DIR=/opt/payara\n+ENV PAYARA_DIR=${HOME_DIR} \\\n     DEPLOY_DIR=/opt/payara/deployments\n \n # Create and set the Payara user and working directory owned by the new user\n RUN true \\\n-    && addgroup payara \\\n-    && adduser -D -h ${PAYARA_HOME} -H -s /bin/bash payara -G payara \\\n+    && addgroup --gid 1000 payara \\", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "9f28eedcc4945a65fd4d407b7414511f45ecb6a1"}, "originalPosition": 13}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjQ3NDQ4Mzc0OnYy", "diffSide": "RIGHT", "path": "appserver/extras/docker-images/server-full/src/main/docker/Dockerfile", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yN1QwOToyNToyMFrOF8pIsA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yN1QxMTozMDoxMlrOF8tP7w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5OTEzMjg0OA==", "bodyText": "Since this is source of majority of build failures, I'd propose specific exit code (until we implement different issue for taking this away completely from main build).\nLike (gpg --recvkeys... || exit 55)", "url": "https://github.com/payara/Payara/pull/4594#discussion_r399132848", "createdAt": "2020-03-27T09:25:20Z", "author": {"login": "pdudits"}, "path": "appserver/extras/docker-images/server-full/src/main/docker/Dockerfile", "diffHunk": "@@ -29,25 +29,25 @@ ENV PATH=\"${PATH}:${PAYARA_DIR}/bin\"\n ARG TINI_VERSION=v0.18.0\n \n # Download tini\n-ADD https://github.com/krallin/tini/releases/download/${TINI_VERSION}/tini \\\n-    https://github.com/krallin/tini/releases/download/${TINI_VERSION}/tini.asc /\n+ADD https://github.com/krallin/tini/releases/download/${TINI_VERSION}/tini /tini\n+ADD https://github.com/krallin/tini/releases/download/${TINI_VERSION}/tini.asc /tini.asc\n \n RUN true \\\n     # Install dependencies\n     && apt-get update \\\n-    && apt-get install -y coreutils gpg \\\n+    && apt-get install -y gpg \\\n     && rm -rf /var/lib/apt/lists/* \\\n     # Create and set the Payara user and working directory owned by the new user\n-    && groupadd --gid 1000 payara \\\n-    && useradd -u 1000 -M -s /bin/bash -d ${HOME_DIR} payara -g payara \\\n+    && addgroup --gid 1000 payara \\\n+    && adduser --system --uid 1000 --no-create-home --shell /bin/bash --home \"${HOME_DIR}\" --gecos \"\" --ingroup payara payara \\\n     && echo payara:payara | chpasswd \\\n     && mkdir -p ${DEPLOY_DIR} \\\n     && mkdir -p ${CONFIG_DIR} \\\n     && mkdir -p ${SCRIPT_DIR} \\\n     && chown -R payara: ${HOME_DIR} \\\n     # Verify tini\n-    && gpg --batch --keyserver \"hkp://ipv4.pool.sks-keyservers.net\" --recv-keys 595E85A6B1B4779EA4DAAEC70B588DFF0527A9B7 \\\n-    && gpg --batch --verify /tini.asc /tini \\\n+    && gpg --verbose --keyserver @docker.keyserver.url@ --recv-keys 595E85A6B1B4779EA4DAAEC70B588DFF0527A9B7 \\", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "9f28eedcc4945a65fd4d407b7414511f45ecb6a1"}, "originalPosition": 28}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5OTIwMDIzOQ==", "bodyText": "We already discussed it - exit codes are not much helpful when you don't remember what they mean. So until somebody would provide such code (for cycle?),\n--verbose + -Ddocker.verbose is more helpful as it directly prints what it tried to do and why it failed.", "url": "https://github.com/payara/Payara/pull/4594#discussion_r399200239", "createdAt": "2020-03-27T11:30:12Z", "author": {"login": "dmatej"}, "path": "appserver/extras/docker-images/server-full/src/main/docker/Dockerfile", "diffHunk": "@@ -29,25 +29,25 @@ ENV PATH=\"${PATH}:${PAYARA_DIR}/bin\"\n ARG TINI_VERSION=v0.18.0\n \n # Download tini\n-ADD https://github.com/krallin/tini/releases/download/${TINI_VERSION}/tini \\\n-    https://github.com/krallin/tini/releases/download/${TINI_VERSION}/tini.asc /\n+ADD https://github.com/krallin/tini/releases/download/${TINI_VERSION}/tini /tini\n+ADD https://github.com/krallin/tini/releases/download/${TINI_VERSION}/tini.asc /tini.asc\n \n RUN true \\\n     # Install dependencies\n     && apt-get update \\\n-    && apt-get install -y coreutils gpg \\\n+    && apt-get install -y gpg \\\n     && rm -rf /var/lib/apt/lists/* \\\n     # Create and set the Payara user and working directory owned by the new user\n-    && groupadd --gid 1000 payara \\\n-    && useradd -u 1000 -M -s /bin/bash -d ${HOME_DIR} payara -g payara \\\n+    && addgroup --gid 1000 payara \\\n+    && adduser --system --uid 1000 --no-create-home --shell /bin/bash --home \"${HOME_DIR}\" --gecos \"\" --ingroup payara payara \\\n     && echo payara:payara | chpasswd \\\n     && mkdir -p ${DEPLOY_DIR} \\\n     && mkdir -p ${CONFIG_DIR} \\\n     && mkdir -p ${SCRIPT_DIR} \\\n     && chown -R payara: ${HOME_DIR} \\\n     # Verify tini\n-    && gpg --batch --keyserver \"hkp://ipv4.pool.sks-keyservers.net\" --recv-keys 595E85A6B1B4779EA4DAAEC70B588DFF0527A9B7 \\\n-    && gpg --batch --verify /tini.asc /tini \\\n+    && gpg --verbose --keyserver @docker.keyserver.url@ --recv-keys 595E85A6B1B4779EA4DAAEC70B588DFF0527A9B7 \\", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5OTEzMjg0OA=="}, "originalCommit": {"oid": "9f28eedcc4945a65fd4d407b7414511f45ecb6a1"}, "originalPosition": 28}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjUxMDc3NjM4OnYy", "diffSide": "RIGHT", "path": "appserver/extras/docker-images/micro/src/main/docker/Dockerfile", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wN1QwODowNzozOVrOGB31sA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wN1QwOTo0OToxOFrOGB7wag==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNDYxNjYyNA==", "bodyText": "Just my 2 cents: I added tini in the full server image because any shell is not a proper init daemon. You might argue that Docker can use a tini-wrapper, but IMHO it should be done within the image, as there are more container and orchestration environments, which don't wrap it.", "url": "https://github.com/payara/Payara/pull/4594#discussion_r404616624", "createdAt": "2020-04-07T08:07:39Z", "author": {"login": "poikilotherm"}, "path": "appserver/extras/docker-images/micro/src/main/docker/Dockerfile", "diffHunk": "@@ -4,23 +4,29 @@ FROM @docker.java.image@\n EXPOSE 6900 8080\n \n # Configure environment variables\n-ENV PAYARA_HOME=/opt/payara\\\n-    DEPLOY_DIR=/opt/payara/deployments\n+# PAYARA_HOME is deprecated - it is here for backward compatibility\n+ENV PAYARA_HOME=/opt/payara\n+ENV HOME_DIR=${PAYARA_HOME}\n+ENV PAYARA_DIR=${HOME_DIR} \\\n+    DEPLOY_DIR=/opt/payara/deployments \\\n+    JVM_ARGS=\"\" \\\n+    MEM_MAX_RAM_PERCENTAGE=70.0 \\\n+    MEM_XSS=512k\n \n # Create and set the Payara user and working directory owned by the new user\n RUN true \\\n-    && addgroup payara \\\n-    && adduser -D -h ${PAYARA_HOME} -H -s /bin/bash payara -G payara \\\n+    && addgroup --gid 1000 payara \\\n+    && adduser --system --uid 1000 --no-create-home --shell /bin/bash --home \"${HOME_DIR}\" --gecos \"\" --ingroup payara payara \\\n     && echo payara:payara | chpasswd \\\n     && mkdir -p ${DEPLOY_DIR}  \\\n-    && chown -R payara:payara ${PAYARA_HOME} \\\n+    && chown -R payara:payara ${HOME_DIR} \\\n     && true\n \n USER payara\n-WORKDIR ${PAYARA_HOME}\n+WORKDIR ${HOME_DIR}\n \n COPY maven/artifacts/payara-micro.jar .\n \n # Default command to run\n-ENTRYPOINT [\"java\", \"-XX:+UseContainerSupport\", \"-XX:MaxRAMPercentage=90.0\", \"-jar\", \"payara-micro.jar\"]\n+ENTRYPOINT [\"sh\", \"-c\", \"java -XX:MaxRAMPercentage=${MEM_MAX_RAM_PERCENTAGE} -Xss${MEM_XSS} -XX:+UseContainerSupport ${JVM_ARGS} -jar payara-micro.jar\"]", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b24088d046dfd8414e676b696bab4e56039b9ca9"}, "originalPosition": 35}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNDY4MDgxMA==", "bodyText": "We use signed tini in the server-full and I have to admit I don't like it from two reasons:\n\ngpg used to sign tini crashes builds from time to time and makes them much slower.\nyesterday I found that it ignores system signals, I'm not sure if it is caused by tini usage or not. But I think we should target these things in standalone issue and stop extending this, because this was originally targeting only better usability and compatibility.\n\nThe shell here is only because environment options are not resolved without it.\nGenerally I agree that all docker files should use same principles only customized to their own usage.", "url": "https://github.com/payara/Payara/pull/4594#discussion_r404680810", "createdAt": "2020-04-07T09:49:18Z", "author": {"login": "dmatej"}, "path": "appserver/extras/docker-images/micro/src/main/docker/Dockerfile", "diffHunk": "@@ -4,23 +4,29 @@ FROM @docker.java.image@\n EXPOSE 6900 8080\n \n # Configure environment variables\n-ENV PAYARA_HOME=/opt/payara\\\n-    DEPLOY_DIR=/opt/payara/deployments\n+# PAYARA_HOME is deprecated - it is here for backward compatibility\n+ENV PAYARA_HOME=/opt/payara\n+ENV HOME_DIR=${PAYARA_HOME}\n+ENV PAYARA_DIR=${HOME_DIR} \\\n+    DEPLOY_DIR=/opt/payara/deployments \\\n+    JVM_ARGS=\"\" \\\n+    MEM_MAX_RAM_PERCENTAGE=70.0 \\\n+    MEM_XSS=512k\n \n # Create and set the Payara user and working directory owned by the new user\n RUN true \\\n-    && addgroup payara \\\n-    && adduser -D -h ${PAYARA_HOME} -H -s /bin/bash payara -G payara \\\n+    && addgroup --gid 1000 payara \\\n+    && adduser --system --uid 1000 --no-create-home --shell /bin/bash --home \"${HOME_DIR}\" --gecos \"\" --ingroup payara payara \\\n     && echo payara:payara | chpasswd \\\n     && mkdir -p ${DEPLOY_DIR}  \\\n-    && chown -R payara:payara ${PAYARA_HOME} \\\n+    && chown -R payara:payara ${HOME_DIR} \\\n     && true\n \n USER payara\n-WORKDIR ${PAYARA_HOME}\n+WORKDIR ${HOME_DIR}\n \n COPY maven/artifacts/payara-micro.jar .\n \n # Default command to run\n-ENTRYPOINT [\"java\", \"-XX:+UseContainerSupport\", \"-XX:MaxRAMPercentage=90.0\", \"-jar\", \"payara-micro.jar\"]\n+ENTRYPOINT [\"sh\", \"-c\", \"java -XX:MaxRAMPercentage=${MEM_MAX_RAM_PERCENTAGE} -Xss${MEM_XSS} -XX:+UseContainerSupport ${JVM_ARGS} -jar payara-micro.jar\"]", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNDYxNjYyNA=="}, "originalCommit": {"oid": "b24088d046dfd8414e676b696bab4e56039b9ca9"}, "originalPosition": 35}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjUxMDc4ODI1OnYy", "diffSide": "RIGHT", "path": "appserver/extras/docker-images/server-full/src/main/docker/Dockerfile", "isResolved": true, "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wN1QwODoxMDo0NFrOGB39QQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0xOVQwODo0MTo1N1rOGH0fKw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNDYxODU2MQ==", "bodyText": "If you guys don't want gpg et al in the resulting image, this could as well be done in a multistage build step. This might also be charming as it could be cached for later builds, avoiding build failures.", "url": "https://github.com/payara/Payara/pull/4594#discussion_r404618561", "createdAt": "2020-04-07T08:10:44Z", "author": {"login": "poikilotherm"}, "path": "appserver/extras/docker-images/server-full/src/main/docker/Dockerfile", "diffHunk": "@@ -35,26 +37,26 @@ ADD https://github.com/krallin/tini/releases/download/${TINI_VERSION}/tini \\\n RUN true \\\n     # Install dependencies\n     && apt-get update \\\n-    && apt-get install -y coreutils gpg \\\n+    && apt-get install -y gpg \\\n     && rm -rf /var/lib/apt/lists/* \\\n     # Create and set the Payara user and working directory owned by the new user\n-    && groupadd --gid 1000 payara \\\n-    && useradd -u 1000 -M -s /bin/bash -d ${HOME_DIR} payara -g payara \\\n+    && addgroup --gid 1000 payara \\\n+    && adduser --system --uid 1000 --no-create-home --shell /bin/bash --home \"${HOME_DIR}\" --gecos \"\" --ingroup payara payara \\\n     && echo payara:payara | chpasswd \\\n     && mkdir -p ${DEPLOY_DIR} \\\n     && mkdir -p ${CONFIG_DIR} \\\n     && mkdir -p ${SCRIPT_DIR} \\\n     && chown -R payara: ${HOME_DIR} \\\n     # Verify tini", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b24088d046dfd8414e676b696bab4e56039b9ca9"}, "originalPosition": 26}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNDY4MzM1NQ==", "bodyText": "Caches are disabled in this build, but this leads me to a question - is it possible to tell docker to use cache only for some stage?\nEnabled cache lead few versions back to the state where docker image of 5.194 contained 5.193 inside it.", "url": "https://github.com/payara/Payara/pull/4594#discussion_r404683355", "createdAt": "2020-04-07T09:53:30Z", "author": {"login": "dmatej"}, "path": "appserver/extras/docker-images/server-full/src/main/docker/Dockerfile", "diffHunk": "@@ -35,26 +37,26 @@ ADD https://github.com/krallin/tini/releases/download/${TINI_VERSION}/tini \\\n RUN true \\\n     # Install dependencies\n     && apt-get update \\\n-    && apt-get install -y coreutils gpg \\\n+    && apt-get install -y gpg \\\n     && rm -rf /var/lib/apt/lists/* \\\n     # Create and set the Payara user and working directory owned by the new user\n-    && groupadd --gid 1000 payara \\\n-    && useradd -u 1000 -M -s /bin/bash -d ${HOME_DIR} payara -g payara \\\n+    && addgroup --gid 1000 payara \\\n+    && adduser --system --uid 1000 --no-create-home --shell /bin/bash --home \"${HOME_DIR}\" --gecos \"\" --ingroup payara payara \\\n     && echo payara:payara | chpasswd \\\n     && mkdir -p ${DEPLOY_DIR} \\\n     && mkdir -p ${CONFIG_DIR} \\\n     && mkdir -p ${SCRIPT_DIR} \\\n     && chown -R payara: ${HOME_DIR} \\\n     # Verify tini", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNDYxODU2MQ=="}, "originalCommit": {"oid": "b24088d046dfd8414e676b696bab4e56039b9ca9"}, "originalPosition": 26}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMDg1MzE2Mw==", "bodyText": "Now it should be better - I created separate module for the shared basic image. Only the micro has it's own, because it is based on alpine.", "url": "https://github.com/payara/Payara/pull/4594#discussion_r410853163", "createdAt": "2020-04-19T08:41:57Z", "author": {"login": "dmatej"}, "path": "appserver/extras/docker-images/server-full/src/main/docker/Dockerfile", "diffHunk": "@@ -35,26 +37,26 @@ ADD https://github.com/krallin/tini/releases/download/${TINI_VERSION}/tini \\\n RUN true \\\n     # Install dependencies\n     && apt-get update \\\n-    && apt-get install -y coreutils gpg \\\n+    && apt-get install -y gpg \\\n     && rm -rf /var/lib/apt/lists/* \\\n     # Create and set the Payara user and working directory owned by the new user\n-    && groupadd --gid 1000 payara \\\n-    && useradd -u 1000 -M -s /bin/bash -d ${HOME_DIR} payara -g payara \\\n+    && addgroup --gid 1000 payara \\\n+    && adduser --system --uid 1000 --no-create-home --shell /bin/bash --home \"${HOME_DIR}\" --gecos \"\" --ingroup payara payara \\\n     && echo payara:payara | chpasswd \\\n     && mkdir -p ${DEPLOY_DIR} \\\n     && mkdir -p ${CONFIG_DIR} \\\n     && mkdir -p ${SCRIPT_DIR} \\\n     && chown -R payara: ${HOME_DIR} \\\n     # Verify tini", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNDYxODU2MQ=="}, "originalCommit": {"oid": "b24088d046dfd8414e676b696bab4e56039b9ca9"}, "originalPosition": 26}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjUxMDgxMTQ1OnYy", "diffSide": "RIGHT", "path": "appserver/extras/docker-images/server-full/src/main/docker/Dockerfile", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wN1QwODoxNjo0MFrOGB4LyQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wN1QxMDowNjo0NlrOGB8Zrg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNDYyMjI4MQ==", "bodyText": "-XX\\:+UseCGroupMemoryLimitForHeap is deprecated since Java 10, it has been superseded by -XX\\:+UseContainerSupport (which is backported to Java 8u192+ and enabled by default). IMHO it should be removed, together with -XX\\:+UnlockExperimentalVMOptions.", "url": "https://github.com/payara/Payara/pull/4594#discussion_r404622281", "createdAt": "2020-04-07T08:16:40Z", "author": {"login": "poikilotherm"}, "path": "appserver/extras/docker-images/server-full/src/main/docker/Dockerfile", "diffHunk": "@@ -66,14 +68,13 @@ RUN true \\\n     && ${PAYARA_DIR}/bin/asadmin --user=${ADMIN_USER} --passwordfile=${PASSWORD_FILE} start-domain ${DOMAIN_NAME} \\\n     && ${PAYARA_DIR}/bin/asadmin --user=${ADMIN_USER} --passwordfile=${PASSWORD_FILE} enable-secure-admin \\\n     && for MEMORY_JVM_OPTION in \\\n-       $(${PAYARA_DIR}/bin/asadmin --user=${ADMIN_USER} --passwordfile=${PASSWORD_FILE} list-jvm-options | grep \"Xm[sx]\"); \\\n+       $(${PAYARA_DIR}/bin/asadmin --user=${ADMIN_USER} --passwordfile=${PASSWORD_FILE} list-jvm-options | grep \"Xm[sx]\\|Xss\"); \\\n        do\\\n          ${PAYARA_DIR}/bin/asadmin --user=${ADMIN_USER} --passwordfile=${PASSWORD_FILE} delete-jvm-options $MEMORY_JVM_OPTION;\\\n        done \\\n-    # FIXME: when upgrading this container to Java 10+, this needs to be changed to\n-    #        '-XX:+UseContainerSupport' and '-XX:MaxRAMPercentage'\n     && ${PAYARA_DIR}/bin/asadmin --user=${ADMIN_USER} --passwordfile=${PASSWORD_FILE} create-jvm-options \\\n-      '-XX\\:+UnlockExperimentalVMOptions:-XX\\:+IgnoreUnrecognizedVMOptions:-XX\\:+UseCGroupMemoryLimitForHeap:-XX\\:MaxRAMFraction=1' \\\n+      '-XX\\:+UnlockExperimentalVMOptions:-XX\\:+IgnoreUnrecognizedVMOptions:-XX\\:+UseCGroupMemoryLimitForHeap:-XX\\:+UseContainerSupport:-XX\\:MaxRAMPercentage=${ENV=MEM_MAX_RAM_PERCENTAGE}:-Xss${ENV=MEM_XSS}' \\", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b24088d046dfd8414e676b696bab4e56039b9ca9"}, "originalPosition": 55}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNDY5MTM3NA==", "bodyText": "You're right, just to document it:\n\nhttps://bugs.openjdk.java.net/browse/JDK-8196595\nhttps://bugs.openjdk.java.net/browse/JDK-8146115", "url": "https://github.com/payara/Payara/pull/4594#discussion_r404691374", "createdAt": "2020-04-07T10:06:46Z", "author": {"login": "dmatej"}, "path": "appserver/extras/docker-images/server-full/src/main/docker/Dockerfile", "diffHunk": "@@ -66,14 +68,13 @@ RUN true \\\n     && ${PAYARA_DIR}/bin/asadmin --user=${ADMIN_USER} --passwordfile=${PASSWORD_FILE} start-domain ${DOMAIN_NAME} \\\n     && ${PAYARA_DIR}/bin/asadmin --user=${ADMIN_USER} --passwordfile=${PASSWORD_FILE} enable-secure-admin \\\n     && for MEMORY_JVM_OPTION in \\\n-       $(${PAYARA_DIR}/bin/asadmin --user=${ADMIN_USER} --passwordfile=${PASSWORD_FILE} list-jvm-options | grep \"Xm[sx]\"); \\\n+       $(${PAYARA_DIR}/bin/asadmin --user=${ADMIN_USER} --passwordfile=${PASSWORD_FILE} list-jvm-options | grep \"Xm[sx]\\|Xss\"); \\\n        do\\\n          ${PAYARA_DIR}/bin/asadmin --user=${ADMIN_USER} --passwordfile=${PASSWORD_FILE} delete-jvm-options $MEMORY_JVM_OPTION;\\\n        done \\\n-    # FIXME: when upgrading this container to Java 10+, this needs to be changed to\n-    #        '-XX:+UseContainerSupport' and '-XX:MaxRAMPercentage'\n     && ${PAYARA_DIR}/bin/asadmin --user=${ADMIN_USER} --passwordfile=${PASSWORD_FILE} create-jvm-options \\\n-      '-XX\\:+UnlockExperimentalVMOptions:-XX\\:+IgnoreUnrecognizedVMOptions:-XX\\:+UseCGroupMemoryLimitForHeap:-XX\\:MaxRAMFraction=1' \\\n+      '-XX\\:+UnlockExperimentalVMOptions:-XX\\:+IgnoreUnrecognizedVMOptions:-XX\\:+UseCGroupMemoryLimitForHeap:-XX\\:+UseContainerSupport:-XX\\:MaxRAMPercentage=${ENV=MEM_MAX_RAM_PERCENTAGE}:-Xss${ENV=MEM_XSS}' \\", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNDYyMjI4MQ=="}, "originalCommit": {"oid": "b24088d046dfd8414e676b696bab4e56039b9ca9"}, "originalPosition": 55}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjU1NDE5MjM1OnYy", "diffSide": "RIGHT", "path": "appserver/extras/docker-images/micro/src/main/docker/Dockerfile", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yMFQwNzozMjowNlrOGIHAaQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yMFQwNzozMjowNlrOGIHAaQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMTE1NjU4NQ==", "bodyText": "Revert order of these 2 COPY commands as script content will change less likely as Payara Micro. -> reuse of layers", "url": "https://github.com/payara/Payara/pull/4594#discussion_r411156585", "createdAt": "2020-04-20T07:32:06Z", "author": {"login": "rdebusscher"}, "path": "appserver/extras/docker-images/micro/src/main/docker/Dockerfile", "diffHunk": "@@ -4,23 +4,29 @@ FROM @docker.java.image@\n EXPOSE 6900 8080\n \n # Configure environment variables\n-ENV PAYARA_HOME=/opt/payara\\\n-    DEPLOY_DIR=/opt/payara/deployments\n+# PAYARA_HOME is deprecated - it is here for backward compatibility\n+ENV PAYARA_HOME=/opt/payara\n+ENV HOME_DIR=${PAYARA_HOME}\n+ENV PAYARA_DIR=${HOME_DIR} \\\n+    SCRIPT_DIR=${HOME_DIR} \\\n+    DEPLOY_DIR=/opt/payara/deployments \\\n+    JVM_ARGS=\"\" \\\n+    MEM_MAX_RAM_PERCENTAGE=70.0 \\\n+    MEM_XSS=512k\n \n # Create and set the Payara user and working directory owned by the new user\n RUN true \\\n-    && addgroup payara \\\n-    && adduser -D -h ${PAYARA_HOME} -H -s /bin/bash payara -G payara \\\n+    && addgroup --gid 1000 payara \\\n+    && adduser --system --uid 1000 --no-create-home --shell /bin/bash --home \"${HOME_DIR}\" --gecos \"\" --ingroup payara payara \\\n     && echo payara:payara | chpasswd \\\n     && mkdir -p ${DEPLOY_DIR}  \\\n-    && chown -R payara:payara ${PAYARA_HOME} \\\n+    && chown -R payara:payara ${HOME_DIR} \\\n     && true\n \n USER payara\n-WORKDIR ${PAYARA_HOME}\n+WORKDIR ${HOME_DIR}\n \n-COPY maven/artifacts/payara-micro.jar .\n+COPY --chown=payara:payara maven/artifacts/payara-micro.jar .", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "39dc2360f5dc0ad0e5576ff8e4be1d310754a761"}, "originalPosition": 33}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjU1NDE5MzQyOnYy", "diffSide": "RIGHT", "path": "appserver/extras/docker-images/server-full/src/main/docker/Dockerfile", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yMFQwNzozMjoyOVrOGIHBJA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yMFQwNzozMjoyOVrOGIHBJA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMTE1Njc3Mg==", "bodyText": "Revert order of these 2 COPY commands as script content will change less likely as Payara Server. -> reuse of layers", "url": "https://github.com/payara/Payara/pull/4594#discussion_r411156772", "createdAt": "2020-04-20T07:32:29Z", "author": {"login": "rdebusscher"}, "path": "appserver/extras/docker-images/server-full/src/main/docker/Dockerfile", "diffHunk": "@@ -7,77 +7,31 @@ FROM @docker.java.image@\n # 8181: https\n EXPOSE 4848 9009 8080 8181\n \n-# Initialize the configurable environment variables\n-ENV HOME_DIR=/opt/payara\\\n-    PAYARA_DIR=/opt/payara/appserver\\\n-    SCRIPT_DIR=/opt/payara/scripts\\\n-    CONFIG_DIR=/opt/payara/config\\\n-    DEPLOY_DIR=/opt/payara/deployments\\\n-    PASSWORD_FILE=/opt/payara/passwordFile\\\n-    # Payara Server Domain options\n-    DOMAIN_NAME=@docker.payara.domainName@\\\n-    ADMIN_USER=admin\\\n-    ADMIN_PASSWORD=admin \\\n-    # Utility environment variables\n-    JVM_ARGS=\\\n-    PAYARA_ARGS=\\\n-    DEPLOY_PROPS=\\\n-    POSTBOOT_COMMANDS=/opt/payara/config/post-boot-commands.asadmin\\\n-    PREBOOT_COMMANDS=/opt/payara/config/pre-boot-commands.asadmin\n-ENV PATH=\"${PATH}:${PAYARA_DIR}/bin\"\n+ENV DOMAIN_NAME=@docker.payara.domainName@ \\\n+    PAYARA_ARGS=\"\" \\\n+    PREBOOT_COMMANDS=${CONFIG_DIR}/pre-boot-commands.asadmin \\\n+    POSTBOOT_COMMANDS=${CONFIG_DIR}/post-boot-commands.asadmin \\\n+    DEPLOY_PROPS=\"\"\n \n-ARG TINI_VERSION=v0.18.0\n-\n-# Download tini\n-ADD https://github.com/krallin/tini/releases/download/${TINI_VERSION}/tini \\\n-    https://github.com/krallin/tini/releases/download/${TINI_VERSION}/tini.asc /\n-\n-RUN true \\\n-    # Install dependencies\n-    && apt-get update \\\n-    && apt-get install -y coreutils gpg \\\n-    && rm -rf /var/lib/apt/lists/* \\\n-    # Create and set the Payara user and working directory owned by the new user\n-    && groupadd --gid 1000 payara \\\n-    && useradd -u 1000 -M -s /bin/bash -d ${HOME_DIR} payara -g payara \\\n-    && echo payara:payara | chpasswd \\\n-    && mkdir -p ${DEPLOY_DIR} \\\n-    && mkdir -p ${CONFIG_DIR} \\\n-    && mkdir -p ${SCRIPT_DIR} \\\n-    && chown -R payara: ${HOME_DIR} \\\n-    # Verify tini\n-    && gpg --batch --keyserver \"hkp://ipv4.pool.sks-keyservers.net\" --recv-keys 595E85A6B1B4779EA4DAAEC70B588DFF0527A9B7 \\\n-    && gpg --batch --verify /tini.asc /tini \\\n-    && chmod +x /tini \\\n-    && true\n-\n-USER payara\n-WORKDIR ${HOME_DIR}\n-\n-COPY --chown=payara:payara maven/artifacts/payara5 ${PAYARA_DIR}/\n+COPY --chown=payara:payara maven/artifacts/@docker.payara.rootDirectoryName@ ${PAYARA_DIR}/", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "39dc2360f5dc0ad0e5576ff8e4be1d310754a761"}, "originalPosition": 63}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjU1NDE5NDI1OnYy", "diffSide": "RIGHT", "path": "appserver/extras/docker-images/server-node/src/main/docker/Dockerfile", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yMFQwNzozMjo0N1rOGIHBsA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yMFQwNzozMjo0N1rOGIHBsA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMTE1NjkxMg==", "bodyText": "Revert order of these 2 COPY commands as script content will change less likely as Payara Micro. -> reuse of Server", "url": "https://github.com/payara/Payara/pull/4594#discussion_r411156912", "createdAt": "2020-04-20T07:32:47Z", "author": {"login": "rdebusscher"}, "path": "appserver/extras/docker-images/server-node/src/main/docker/Dockerfile", "diffHunk": "@@ -14,20 +11,10 @@ ENV PAYARA_PASSWORD_FILE=${PAYARA_PASSWORD_FILE_DIR}/passwordfile.txt\n \n # Create and set the Payara user and working directory owned by the new user\n RUN true \\\n-    && mkdir ${HOME_DIR} \\\n-    && mkdir ${PAYARA_DIR} \\\n-    && mkdir ${PAYARA_PASSWORD_FILE_DIR} \\\n-    && groupadd -g 1000 payara \\\n-    && useradd -u 1000 -M -s /bin/bash -d ${HOME_DIR} payara -g payara \\\n-    && echo payara:payara | chpasswd \\\n-    && chown -R payara:payara ${HOME_DIR} \\\n+    && mkdir -p ${PAYARA_PASSWORD_FILE_DIR} \\\n     && true\n \n-USER payara\n-WORKDIR ${HOME_DIR}\n+COPY --chown=payara:payara maven/artifacts/@docker.payara.rootDirectoryName@ ${PAYARA_DIR}", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "39dc2360f5dc0ad0e5576ff8e4be1d310754a761"}, "originalPosition": 28}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjU1OTkwMDgxOnYy", "diffSide": "RIGHT", "path": "appserver/extras/docker-images/basic/src/main/docker/Dockerfile", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yMVQwODo1NzoyOVrOGI6r4w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yMVQwOToxNzowN1rOGI7jXw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMjAwMzI5OQ==", "bodyText": "Heads up that tini v0.19 has been released two days ago.\nReleases now offer SHA256 sums, thus easing installation A LOT!\nhttps://github.com/krallin/tini/releases/tag/v0.19.0\nSee also krallin/tini#153", "url": "https://github.com/payara/Payara/pull/4594#discussion_r412003299", "createdAt": "2020-04-21T08:57:29Z", "author": {"login": "poikilotherm"}, "path": "appserver/extras/docker-images/basic/src/main/docker/Dockerfile", "diffHunk": "@@ -0,0 +1,42 @@\n+FROM @docker.java.image@\n+\n+ENV HOME_DIR=/opt/payara\n+ENV PAYARA_DIR=${HOME_DIR}/appserver \\\n+    SCRIPT_DIR=${HOME_DIR}/scripts \\\n+    CONFIG_DIR=${HOME_DIR}/config \\\n+    DEPLOY_DIR=${HOME_DIR}/deployments \\\n+    PASSWORD_FILE=${HOME_DIR}/passwordFile \\\n+    ADMIN_USER=admin \\\n+    ADMIN_PASSWORD=admin \\\n+    JVM_ARGS=\"\" \\\n+    MEM_MAX_RAM_PERCENTAGE=\"70.0\" \\\n+    MEM_XSS=\"512k\"\n+ENV PATH=\"${PATH}:${PAYARA_DIR}/bin\"\n+\n+ARG TINI_VERSION=v0.18.0", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "a6174171e438e5051c7c4be1303e097652260a99"}, "originalPosition": 16}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMjAxNzUwMw==", "bodyText": "I think we will merge this first and then upgrade this in standalone PR, but thanks for the good news!", "url": "https://github.com/payara/Payara/pull/4594#discussion_r412017503", "createdAt": "2020-04-21T09:17:07Z", "author": {"login": "dmatej"}, "path": "appserver/extras/docker-images/basic/src/main/docker/Dockerfile", "diffHunk": "@@ -0,0 +1,42 @@\n+FROM @docker.java.image@\n+\n+ENV HOME_DIR=/opt/payara\n+ENV PAYARA_DIR=${HOME_DIR}/appserver \\\n+    SCRIPT_DIR=${HOME_DIR}/scripts \\\n+    CONFIG_DIR=${HOME_DIR}/config \\\n+    DEPLOY_DIR=${HOME_DIR}/deployments \\\n+    PASSWORD_FILE=${HOME_DIR}/passwordFile \\\n+    ADMIN_USER=admin \\\n+    ADMIN_PASSWORD=admin \\\n+    JVM_ARGS=\"\" \\\n+    MEM_MAX_RAM_PERCENTAGE=\"70.0\" \\\n+    MEM_XSS=\"512k\"\n+ENV PATH=\"${PATH}:${PAYARA_DIR}/bin\"\n+\n+ARG TINI_VERSION=v0.18.0", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMjAwMzI5OQ=="}, "originalCommit": {"oid": "a6174171e438e5051c7c4be1303e097652260a99"}, "originalPosition": 16}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1322, "cost": 1, "resetAt": "2021-11-12T12:57:47Z"}}}