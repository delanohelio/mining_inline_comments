{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDc4NDkzMDc2", "number": 4870, "title": "FISH-37 URL in DataSourceDefinition overrides serverName", "bodyText": "Description\nThis is a bug fix.\nIf URL has been set it should override the serverName, causing that to be set to null\nto prevent that being using when the DataSource is initialised\nFixes #4385\nImportant Info\nTesting\nNew tests\nNew test added in PR, DataSource Definition Tests\nTesting Performed\n\nWritten test\nDebugging Payara and checking the value of serverName is set to null and unused\nDocker test in original issue\n\nTesting Environment\nZulu JDK 1.8_262 on Ubuntu 20.04 with Maven 3.6.3", "createdAt": "2020-09-03T09:28:49Z", "url": "https://github.com/payara/Payara/pull/4870", "merged": true, "mergeCommit": {"oid": "d9033e1d7a4bc640565f60777e29c688b88a2900"}, "closed": true, "closedAt": "2020-09-05T09:55:38Z", "author": {"login": "Cousjava"}, "timelineItems": {"totalCount": 5, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdFM_iXgH2gAyNDc4NDkzMDc2OmFkYmYyYmU0ZmQwMmIyZjc5ZjVjN2Y4ZDk3N2RmMTRhYzcyYjNlYjY=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdFjnoGgFqTQ4MjU3OTIyMw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "adbf2be4fd02b2f79f5c7f8d977df14ac72b3eb6", "author": {"user": {"login": "Cousjava", "name": "Jonathan C"}}, "url": "https://github.com/payara/Payara/commit/adbf2be4fd02b2f79f5c7f8d977df14ac72b3eb6", "committedDate": "2020-09-03T09:15:07Z", "message": "FISH-37 URL in DataSourceDefinition overrides serverName\n\nIf URL has been set it should override the serverName, causing that to be set to null\nto prevent that being using when the DataSource is initialised\n\nFixes #4385"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "7d074a71f66775c60bd0c6e38a13fa6bbe1350c0", "author": {"user": {"login": "Cousjava", "name": "Jonathan C"}}, "url": "https://github.com/payara/Payara/commit/7d074a71f66775c60bd0c6e38a13fa6bbe1350c0", "committedDate": "2020-09-03T09:34:20Z", "message": "FISH-37 Written additional test case for serverName not being overriden"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDgyNTAyNDM4", "url": "https://github.com/payara/Payara/pull/4870#pullrequestreview-482502438", "createdAt": "2020-09-04T09:28:09Z", "commit": {"oid": "7d074a71f66775c60bd0c6e38a13fa6bbe1350c0"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0wNFQwOToyODowOVrOHNGmqA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0wNFQwOToyODowOVrOHNGmqA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MzUwMTczNg==", "bodyText": "Can you make a small change to the DataSourceDefinitionDescriptor.setServerName(String serverName) method please to reflect this.\nThat method sets a boolean of serverNameSet to true, which when you're setting it to null probably shouldn't be the case :)", "url": "https://github.com/payara/Payara/pull/4870#discussion_r483501736", "createdAt": "2020-09-04T09:28:09Z", "author": {"login": "Pandrex247"}, "path": "appserver/jdbc/jdbc-runtime/src/main/java/org/glassfish/jdbcruntime/deployment/annotation/handlers/DataSourceDefinitionHandler.java", "diffHunk": "@@ -394,11 +394,12 @@ private DataSourceDefinitionDescriptor createDescriptor(DataSourceDefinition def\n             desc.setDatabaseName(defn.databaseName());\n         }\n \n-        if ((desc.getPortNumber() != -1 && desc.getDatabaseName() != null && desc.getServerName() != null)) {\n+        if (desc.getPortNumber() != -1 && desc.getDatabaseName() != null && desc.getServerName() != null) {\n             //standard properties are set, ignore URL\n         } else {\n             if (defn.url() != null && !defn.url().equals(\"\")) {\n                 desc.setUrl(defn.url());\n+                desc.setServerName(null); //To prevent serverName overriding the URL, always use the URL if the standard properties are not set", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "7d074a71f66775c60bd0c6e38a13fa6bbe1350c0"}, "originalPosition": 30}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "36739b4a5d8682babbef8f7b3fd86272d654a4d8", "author": {"user": {"login": "Cousjava", "name": "Jonathan C"}}, "url": "https://github.com/payara/Payara/commit/36739b4a5d8682babbef8f7b3fd86272d654a4d8", "committedDate": "2020-09-04T10:26:33Z", "message": "FISH-37 serverNameSet set to false if serverName set to null"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDgyNTc5MjIz", "url": "https://github.com/payara/Payara/pull/4870#pullrequestreview-482579223", "createdAt": "2020-09-04T11:36:49Z", "commit": {"oid": "36739b4a5d8682babbef8f7b3fd86272d654a4d8"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 659, "cost": 1, "resetAt": "2021-11-01T16:19:10Z"}}}