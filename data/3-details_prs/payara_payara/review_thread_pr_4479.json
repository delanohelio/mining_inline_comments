{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0MzcyODIxNjY5", "number": 4479, "reviewThreads": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xOVQxNzoxOToxNlrOEP34SQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xOVQxODozMzowNlrOEP4PRQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjg1MDc5NjI1OnYy", "diffSide": "RIGHT", "path": "appserver/web/web-glue/src/main/java/com/sun/enterprise/security/web/GlassFishSingleSignOn.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xOVQxNzoxOToxNlrOGzw-bQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xOVQxNzoxOToxNlrOGzw-bQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NjkzMjk3Mw==", "bodyText": "There is a little change in behavior.\nOld implementation locked SSOs and created a list of expired SSOs. No one could create a new SSO.\nNew implementation uses what is available and does not block creation of a new SSO (which is not taken for expiration in given round). However probability of a new SSO being expired is so small so I think this change should be OK for a real world usage.", "url": "https://github.com/payara/Payara/pull/4479#discussion_r456932973", "createdAt": "2020-07-19T17:19:16Z", "author": {"login": "sgflt"}, "path": "appserver/web/web-glue/src/main/java/com/sun/enterprise/security/web/GlassFishSingleSignOn.java", "diffHunk": "@@ -464,44 +461,38 @@ private void processExpires() {\n         long tooOld = System.currentTimeMillis() - ssoMaxInactive * 1000L;\n         // S1AS8 6155481 START\n         if (logger.isLoggable(Level.FINE)) {\n-            logger.log(Level.FINE, LogFacade.SSO_EXPIRATION_STARTED, cache.size());\n+            logger.log(Level.FINE, LogFacade.SSO_EXPIRATION_STARTED, this.cache.size());\n         }\n         // S1AS8 6155481 END\n-        ArrayList<String> removals = new ArrayList<String>(cache.size() / 2);\n+        final ArrayList<String> removals = new ArrayList<>(this.cache.size() / 2);\n \n         // build list of removal targets\n \n         // Note that only those SSO entries which are NOT associated with\n-        // any session are elegible for removal here.\n+        // any session are eligible for removal here.\n         // Currently no session association ever happens so this covers all\n         // SSO entries. However, this should be addressed separately.\n \n         try {\n-            synchronized (cache) {\n-\n-                Iterator<String> it = cache.keySet().iterator();\n-                while (it.hasNext()) {\n-                    String key = it.next();\n-                    SingleSignOnEntry sso = (SingleSignOnEntry) cache.get(key);\n-                    if (sso.isEmpty() && sso.getLastAccessTime() < tooOld) {\n-                        removals.add(key);\n-                    }\n+            this.cache.forEach((ssoId, sso) -> {\n+                if (sso.isEmpty() && sso.getLastAccessTime() < tooOld) {\n+                    removals.add(ssoId);\n                 }", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b298f292cd383ea3aab7ad244f0d4ce649a6a4e9"}, "originalPosition": 49}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjg1MDg1NDcyOnYy", "diffSide": "LEFT", "path": "appserver/web/web-core/src/main/java/org/apache/catalina/session/StandardManager.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xOVQxODozMjozMlrOGzxakA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xOVQxODozMjozMlrOGzxakA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1Njk0MDE3Ng==", "bodyText": "nullcheck for broken contract removed", "url": "https://github.com/payara/Payara/pull/4479#discussion_r456940176", "createdAt": "2020-07-19T18:32:32Z", "author": {"login": "sgflt"}, "path": "appserver/web/web-core/src/main/java/org/apache/catalina/session/StandardManager.java", "diffHunk": "@@ -985,16 +982,14 @@ public void processExpires() {\n \n         long timeNow = System.currentTimeMillis();\n \n-        Session[] sessions = findSessions();\n-        if (sessions != null) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "bef9a8250ea63bfbb8c6c5a03b5e85580bcad80b"}, "originalPosition": 70}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjg1MDg1NDgxOnYy", "diffSide": "LEFT", "path": "appserver/web/web-core/src/main/java/org/apache/catalina/session/StandardManager.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xOVQxODozMjo0NVrOGzxaoA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xOVQxODozMjo0NVrOGzxaoA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1Njk0MDE5Mg==", "bodyText": "nullcheck for broken contract removed", "url": "https://github.com/payara/Payara/pull/4479#discussion_r456940192", "createdAt": "2020-07-19T18:32:45Z", "author": {"login": "sgflt"}, "path": "appserver/web/web-core/src/main/java/org/apache/catalina/session/StandardManager.java", "diffHunk": "@@ -882,21 +881,19 @@ public void stop(boolean isShutdown) throws LifecycleException {\n         }\n \n         // Expire all active sessions and notify their listeners\n-        Session sessions[] = findSessions();\n-        if (sessions != null) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "bef9a8250ea63bfbb8c6c5a03b5e85580bcad80b"}, "originalPosition": 35}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjg1MDg1NTA5OnYy", "diffSide": "LEFT", "path": "appserver/web/web-core/src/main/java/org/apache/catalina/session/CookiePersistentManager.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xOVQxODozMzowNlrOGzxaxw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xOVQxODozMzowNlrOGzxaxw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1Njk0MDIzMQ==", "bodyText": "broken contract fixed", "url": "https://github.com/payara/Payara/pull/4479#discussion_r456940231", "createdAt": "2020-07-19T18:33:06Z", "author": {"login": "sgflt"}, "path": "appserver/web/web-core/src/main/java/org/apache/catalina/session/CookiePersistentManager.java", "diffHunk": "@@ -111,8 +111,8 @@ public void clearSessions() {\n     }\n \n     @Override\n-    public Session[] findSessions() {\n-        return null;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "bef9a8250ea63bfbb8c6c5a03b5e85580bcad80b"}, "originalPosition": 5}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1387, "cost": 1, "resetAt": "2021-11-12T12:57:47Z"}}}