{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTI4OTAwNjcy", "number": 5014, "reviewThreads": {"totalCount": 6, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0wNFQxNzozMTo0M1rOFA5wXQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0wOFQxOTozMjowMVrOFCjvAg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzM2NDkwNTg5OnYy", "diffSide": "RIGHT", "path": "appserver/tests/payara-samples/samples/clustered-singleton/clustered-singleton-test/src/main/java/com/flowlogix/clust/singleton/ClusteredSingletonEjbXml.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0wNFQxNzozMTo0M1rOH_ayEA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0wNFQxNzozNTowMFrOH_a6SA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNjI2MTEzNg==", "bodyText": "Same recommendations as the other PR. Package needs changing, and to Lombok or not to Lombok", "url": "https://github.com/payara/Payara/pull/5014#discussion_r536261136", "createdAt": "2020-12-04T17:31:43Z", "author": {"login": "MattGill98"}, "path": "appserver/tests/payara-samples/samples/clustered-singleton/clustered-singleton-test/src/main/java/com/flowlogix/clust/singleton/ClusteredSingletonEjbXml.java", "diffHunk": "@@ -37,24 +37,25 @@\n  * only if the new code is made subject to such option by the copyright\n  * holder.\n  */\n-package fish.payara.nucleus.hazelcast;\n+package com.flowlogix.clust.singleton;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "e70cb90188a3fdb1b37a9c3bac8be36ac05339b0"}, "originalPosition": 5}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNjI2MzI0MA==", "bodyText": "This will be fixed with the other PR, as you said :)", "url": "https://github.com/payara/Payara/pull/5014#discussion_r536263240", "createdAt": "2020-12-04T17:35:00Z", "author": {"login": "lprimak"}, "path": "appserver/tests/payara-samples/samples/clustered-singleton/clustered-singleton-test/src/main/java/com/flowlogix/clust/singleton/ClusteredSingletonEjbXml.java", "diffHunk": "@@ -37,24 +37,25 @@\n  * only if the new code is made subject to such option by the copyright\n  * holder.\n  */\n-package fish.payara.nucleus.hazelcast;\n+package com.flowlogix.clust.singleton;", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNjI2MTEzNg=="}, "originalCommit": {"oid": "e70cb90188a3fdb1b37a9c3bac8be36ac05339b0"}, "originalPosition": 5}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzM4MjE4NDYwOnYy", "diffSide": "RIGHT", "path": "appserver/batch/hazelcast-jbatch-store/src/main/java/fish/payara/jbatch/persistence/hazelcast/HazelcastPersistenceService.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0wOFQxOToxMjo0MVrOIBx1GA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0wOFQxOToxMjo0MVrOIBx1GA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzODczNTg5Ng==", "bodyText": "Btw, could you kill all these comments?\n //To change body of generated methods, choose Tools | Templates.", "url": "https://github.com/payara/Payara/pull/5014#discussion_r538735896", "createdAt": "2020-12-08T19:12:41Z", "author": {"login": "dmatej"}, "path": "appserver/batch/hazelcast-jbatch-store/src/main/java/fish/payara/jbatch/persistence/hazelcast/HazelcastPersistenceService.java", "diffHunk": "@@ -56,8 +56,8 @@ and Distribution License(\"CDDL\") (collectively, the \"License\").  You\n     private IMap jobInstanceMap;\n     private IMap checkpointMAP;\n     private HazelcastInstance theInstance;\n-    private IdGenerator jobInstanceIdGenerator;\n-    private IdGenerator checkpointIdGenerator;\n+    private FlakeIdGenerator jobInstanceIdGenerator;\n+    private FlakeIdGenerator checkpointIdGenerator;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "9fcd8db2b9b707bd1bcb7f953e16036f44cf3453"}, "originalPosition": 27}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzM4MjE5NTc0OnYy", "diffSide": "RIGHT", "path": "appserver/batch/hazelcast-jbatch-store/src/main/java/fish/payara/jbatch/persistence/hazelcast/HazelcastPersistenceService.java", "isResolved": true, "comments": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0wOFQxOToxNToxNlrOIBx7jw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0wOVQwMzo1NTozNFrOICBI_g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzODczNzU1MQ==", "bodyText": "For other reviewers: getIdGenerator is deprecated, this is in it's javadoc:\n\nThe implementation can produce duplicate IDs in case of network split, even with split-brain protection enabled (during short window while split-brain is detected). Use getFlakeIdGenerator(String) for an alternative implementation which does not suffer from this problem.", "url": "https://github.com/payara/Payara/pull/5014#discussion_r538737551", "createdAt": "2020-12-08T19:15:16Z", "author": {"login": "dmatej"}, "path": "appserver/batch/hazelcast-jbatch-store/src/main/java/fish/payara/jbatch/persistence/hazelcast/HazelcastPersistenceService.java", "diffHunk": "@@ -274,8 +274,8 @@ public void init(IBatchConfig batchConfig) {\n             theInstance = HazelcastInstance.class.cast(ctx.lookup(hazelcastJNDIName));\n             jobInstanceMap = theInstance.getMap(JOB_INSTANCE_MAP);\n             checkpointMAP = theInstance.getMap(CHECKPOINTMAP);\n-            jobInstanceIdGenerator = theInstance.getIdGenerator(JOB_INSTANCE_MAP+\"ID\");\n-            checkpointIdGenerator = theInstance.getIdGenerator(CHECKPOINTMAP + \"ID\");\n+            jobInstanceIdGenerator = theInstance.getFlakeIdGenerator(JOB_INSTANCE_MAP+\"ID\");", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "9fcd8db2b9b707bd1bcb7f953e16036f44cf3453"}, "originalPosition": 37}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzODc1NDg2Ng==", "bodyText": "Please raise a separate issue for this, as it's out of scope for this PR", "url": "https://github.com/payara/Payara/pull/5014#discussion_r538754866", "createdAt": "2020-12-08T19:42:08Z", "author": {"login": "lprimak"}, "path": "appserver/batch/hazelcast-jbatch-store/src/main/java/fish/payara/jbatch/persistence/hazelcast/HazelcastPersistenceService.java", "diffHunk": "@@ -274,8 +274,8 @@ public void init(IBatchConfig batchConfig) {\n             theInstance = HazelcastInstance.class.cast(ctx.lookup(hazelcastJNDIName));\n             jobInstanceMap = theInstance.getMap(JOB_INSTANCE_MAP);\n             checkpointMAP = theInstance.getMap(CHECKPOINTMAP);\n-            jobInstanceIdGenerator = theInstance.getIdGenerator(JOB_INSTANCE_MAP+\"ID\");\n-            checkpointIdGenerator = theInstance.getIdGenerator(CHECKPOINTMAP + \"ID\");\n+            jobInstanceIdGenerator = theInstance.getFlakeIdGenerator(JOB_INSTANCE_MAP+\"ID\");", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzODczNzU1MQ=="}, "originalCommit": {"oid": "9fcd8db2b9b707bd1bcb7f953e16036f44cf3453"}, "originalPosition": 37}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzODc1Nzc5Nw==", "bodyText": "It is a misunderstanding, no new issue required, I just explained why you did it ;)", "url": "https://github.com/payara/Payara/pull/5014#discussion_r538757797", "createdAt": "2020-12-08T19:46:51Z", "author": {"login": "dmatej"}, "path": "appserver/batch/hazelcast-jbatch-store/src/main/java/fish/payara/jbatch/persistence/hazelcast/HazelcastPersistenceService.java", "diffHunk": "@@ -274,8 +274,8 @@ public void init(IBatchConfig batchConfig) {\n             theInstance = HazelcastInstance.class.cast(ctx.lookup(hazelcastJNDIName));\n             jobInstanceMap = theInstance.getMap(JOB_INSTANCE_MAP);\n             checkpointMAP = theInstance.getMap(CHECKPOINTMAP);\n-            jobInstanceIdGenerator = theInstance.getIdGenerator(JOB_INSTANCE_MAP+\"ID\");\n-            checkpointIdGenerator = theInstance.getIdGenerator(CHECKPOINTMAP + \"ID\");\n+            jobInstanceIdGenerator = theInstance.getFlakeIdGenerator(JOB_INSTANCE_MAP+\"ID\");", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzODczNzU1MQ=="}, "originalCommit": {"oid": "9fcd8db2b9b707bd1bcb7f953e16036f44cf3453"}, "originalPosition": 37}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzODk4Njc1MA==", "bodyText": "oh ok :) I was wondering what's going on, got me confused, so I figured you know what you are talking about :)", "url": "https://github.com/payara/Payara/pull/5014#discussion_r538986750", "createdAt": "2020-12-09T03:55:34Z", "author": {"login": "lprimak"}, "path": "appserver/batch/hazelcast-jbatch-store/src/main/java/fish/payara/jbatch/persistence/hazelcast/HazelcastPersistenceService.java", "diffHunk": "@@ -274,8 +274,8 @@ public void init(IBatchConfig batchConfig) {\n             theInstance = HazelcastInstance.class.cast(ctx.lookup(hazelcastJNDIName));\n             jobInstanceMap = theInstance.getMap(JOB_INSTANCE_MAP);\n             checkpointMAP = theInstance.getMap(CHECKPOINTMAP);\n-            jobInstanceIdGenerator = theInstance.getIdGenerator(JOB_INSTANCE_MAP+\"ID\");\n-            checkpointIdGenerator = theInstance.getIdGenerator(CHECKPOINTMAP + \"ID\");\n+            jobInstanceIdGenerator = theInstance.getFlakeIdGenerator(JOB_INSTANCE_MAP+\"ID\");", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzODczNzU1MQ=="}, "originalCommit": {"oid": "9fcd8db2b9b707bd1bcb7f953e16036f44cf3453"}, "originalPosition": 37}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzM4MjE5OTA1OnYy", "diffSide": "RIGHT", "path": "appserver/common/container-common/src/main/java/com/sun/enterprise/container/common/impl/util/ClusteredSingletonLookupImplBase.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0wOFQxOToxNjowM1rOIBx9gw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0wOFQxOToxNjowM1rOIBx9gw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzODczODA1MQ==", "bodyText": "Again, ILock is deprecated, FencedLock is used instead. Correct.", "url": "https://github.com/payara/Payara/pull/5014#discussion_r538738051", "createdAt": "2020-12-08T19:16:03Z", "author": {"login": "dmatej"}, "path": "appserver/common/container-common/src/main/java/com/sun/enterprise/container/common/impl/util/ClusteredSingletonLookupImplBase.java", "diffHunk": "@@ -63,7 +63,7 @@\n     private final String keyPrefix;\n     private final String mapKey;\n     private final AtomicReference<String> sessionHzKey = new AtomicReference<>();\n-    private final AtomicReference<ILock> lock = new AtomicReference<>();\n+    private final AtomicReference<FencedLock> lock = new AtomicReference<>();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "9fcd8db2b9b707bd1bcb7f953e16036f44cf3453"}, "originalPosition": 18}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzM4MjIzNTk2OnYy", "diffSide": "RIGHT", "path": "nucleus/payara-modules/hazelcast-bootstrap/src/main/java/fish/payara/nucleus/cluster/MemberEvent.java", "isResolved": true, "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0wOFQxOToyNDoyMlrOIByTDQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0wOFQxOTo0ODoyOVrOIBzOUA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzODc0MzU2NQ==", "bodyText": "Could you move those fields to the beginning of the class?", "url": "https://github.com/payara/Payara/pull/5014#discussion_r538743565", "createdAt": "2020-12-08T19:24:22Z", "author": {"login": "dmatej"}, "path": "nucleus/payara-modules/hazelcast-bootstrap/src/main/java/fish/payara/nucleus/cluster/MemberEvent.java", "diffHunk": "@@ -39,31 +39,33 @@\n  */\n package fish.payara.nucleus.cluster;\n \n-import com.hazelcast.core.Member;\n+import com.hazelcast.cluster.Member;\n import fish.payara.nucleus.hazelcast.HazelcastCore;\n+import java.util.UUID;\n \n /**\n  *\n  * @author Steve Millidge (Payara Foundation)\n  */\n public class MemberEvent {\n     \n-    public MemberEvent(Member member) {\n+    public MemberEvent(HazelcastCore hzCore, Member member) {\n+        this.hzCore = hzCore;\n         this.member = member;\n     }\n     \n-    public String getUuid() {\n+    public UUID getUuid() {\n         return member.getUuid();\n     }\n     \n     public String getServer() {\n-        return member.getStringAttribute(HazelcastCore.INSTANCE_ATTRIBUTE);\n+        return hzCore.getAttribute(member.getUuid(), HazelcastCore.INSTANCE_ATTRIBUTE);\n     }\n     \n     public String getServerGroup() {\n-        return member.getStringAttribute(HazelcastCore.INSTANCE_GROUP_ATTRIBUTE);\n+        return member.getAttribute(HazelcastCore.INSTANCE_GROUP_ATTRIBUTE);\n     }\n     \n-    private Member member;\n-    \n+    private final HazelcastCore hzCore;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "9fcd8db2b9b707bd1bcb7f953e16036f44cf3453"}, "originalPosition": 47}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzODc1NTM5NQ==", "bodyText": "Out of scope, again", "url": "https://github.com/payara/Payara/pull/5014#discussion_r538755395", "createdAt": "2020-12-08T19:42:56Z", "author": {"login": "lprimak"}, "path": "nucleus/payara-modules/hazelcast-bootstrap/src/main/java/fish/payara/nucleus/cluster/MemberEvent.java", "diffHunk": "@@ -39,31 +39,33 @@\n  */\n package fish.payara.nucleus.cluster;\n \n-import com.hazelcast.core.Member;\n+import com.hazelcast.cluster.Member;\n import fish.payara.nucleus.hazelcast.HazelcastCore;\n+import java.util.UUID;\n \n /**\n  *\n  * @author Steve Millidge (Payara Foundation)\n  */\n public class MemberEvent {\n     \n-    public MemberEvent(Member member) {\n+    public MemberEvent(HazelcastCore hzCore, Member member) {\n+        this.hzCore = hzCore;\n         this.member = member;\n     }\n     \n-    public String getUuid() {\n+    public UUID getUuid() {\n         return member.getUuid();\n     }\n     \n     public String getServer() {\n-        return member.getStringAttribute(HazelcastCore.INSTANCE_ATTRIBUTE);\n+        return hzCore.getAttribute(member.getUuid(), HazelcastCore.INSTANCE_ATTRIBUTE);\n     }\n     \n     public String getServerGroup() {\n-        return member.getStringAttribute(HazelcastCore.INSTANCE_GROUP_ATTRIBUTE);\n+        return member.getAttribute(HazelcastCore.INSTANCE_GROUP_ATTRIBUTE);\n     }\n     \n-    private Member member;\n-    \n+    private final HazelcastCore hzCore;", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzODc0MzU2NQ=="}, "originalCommit": {"oid": "9fcd8db2b9b707bd1bcb7f953e16036f44cf3453"}, "originalPosition": 47}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzODc1ODczNg==", "bodyText": "Improving code quality by trivial steps is in the scope. But it depends on your decision, I just noticed it ;)", "url": "https://github.com/payara/Payara/pull/5014#discussion_r538758736", "createdAt": "2020-12-08T19:48:29Z", "author": {"login": "dmatej"}, "path": "nucleus/payara-modules/hazelcast-bootstrap/src/main/java/fish/payara/nucleus/cluster/MemberEvent.java", "diffHunk": "@@ -39,31 +39,33 @@\n  */\n package fish.payara.nucleus.cluster;\n \n-import com.hazelcast.core.Member;\n+import com.hazelcast.cluster.Member;\n import fish.payara.nucleus.hazelcast.HazelcastCore;\n+import java.util.UUID;\n \n /**\n  *\n  * @author Steve Millidge (Payara Foundation)\n  */\n public class MemberEvent {\n     \n-    public MemberEvent(Member member) {\n+    public MemberEvent(HazelcastCore hzCore, Member member) {\n+        this.hzCore = hzCore;\n         this.member = member;\n     }\n     \n-    public String getUuid() {\n+    public UUID getUuid() {\n         return member.getUuid();\n     }\n     \n     public String getServer() {\n-        return member.getStringAttribute(HazelcastCore.INSTANCE_ATTRIBUTE);\n+        return hzCore.getAttribute(member.getUuid(), HazelcastCore.INSTANCE_ATTRIBUTE);\n     }\n     \n     public String getServerGroup() {\n-        return member.getStringAttribute(HazelcastCore.INSTANCE_GROUP_ATTRIBUTE);\n+        return member.getAttribute(HazelcastCore.INSTANCE_GROUP_ATTRIBUTE);\n     }\n     \n-    private Member member;\n-    \n+    private final HazelcastCore hzCore;", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzODc0MzU2NQ=="}, "originalCommit": {"oid": "9fcd8db2b9b707bd1bcb7f953e16036f44cf3453"}, "originalPosition": 47}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzM4MjI2OTQ2OnYy", "diffSide": "RIGHT", "path": "nucleus/payara-modules/hazelcast-bootstrap/src/main/java/fish/payara/nucleus/hazelcast/HazelcastCore.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0wOFQxOTozMjowMVrOIBymWw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0wOFQxOTozMjowMVrOIBymWw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzODc0ODUwNw==", "bodyText": "Ok, seems this is related, it already did not work ...\nhazelcast/hazelcast#11867", "url": "https://github.com/payara/Payara/pull/5014#discussion_r538748507", "createdAt": "2020-12-08T19:32:01Z", "author": {"login": "dmatej"}, "path": "nucleus/payara-modules/hazelcast-bootstrap/src/main/java/fish/payara/nucleus/hazelcast/HazelcastCore.java", "diffHunk": "@@ -349,10 +368,7 @@ private Config buildConfiguration() {\n                 config.setLiteMember(Boolean.parseBoolean(nodeConfig.getLite()));\n \n \n-                // set group config\n-                GroupConfig gc = config.getGroupConfig();\n-                gc.setName(configuration.getClusterGroupName());\n-                gc.setPassword(configuration.getClusterGroupPassword());\n+                config.setClusterName(configuration.getClusterGroupName());", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "9fcd8db2b9b707bd1bcb7f953e16036f44cf3453"}, "originalPosition": 86}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1181, "cost": 1, "resetAt": "2021-11-12T12:57:47Z"}}}