{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDQ1MjQ0MzYz", "number": 4768, "title": "FISH-128 OpenAPI does not include APIs from jars within a war ", "bodyText": "Signed-off-by: Gaurav Gupta gaurav.gupta@payara.fish\nDescription\nThis is a feature to include classes for OpenAPI Metadata scanning from the packaged jar within a  war.\nTesting\nTesting Performed\nUnit tests, Manual testing, MP OpenAPI TCK Runner\nTesting Environment\nWindows 10, JDK 11.0\nDocumentation\nTODO", "createdAt": "2020-07-07T08:23:26Z", "url": "https://github.com/payara/Payara/pull/4768", "merged": true, "mergeCommit": {"oid": "71b6f6f761d8fe58703327543561c50337bf0410"}, "closed": true, "closedAt": "2020-07-07T18:41:40Z", "author": {"login": "jGauravGupta"}, "timelineItems": {"totalCount": 8, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcyhcjYgH2gAyNDQ1MjQ0MzYzOmQxNzE1OTZiMDE0YjA5YzYxZDQwNzk4ZDkzODFiMGEyOWQxZTFiNjA=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcyoFnfAFqTQ0NDAzNzg2MQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "d171596b014b09c61d40798d9381b0a29d1e1b60", "author": {"user": {"login": "jGauravGupta", "name": "Gaurav Gupta"}}, "url": "https://github.com/payara/Payara/commit/d171596b014b09c61d40798d9381b0a29d1e1b60", "committedDate": "2020-07-07T08:20:21Z", "message": "FISH-128 OpenAPI does not include APIs from jars within a war (other jars)\n\nSigned-off-by: Gaurav Gupta <gaurav.gupta@payara.fish>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "374c590346c7a991e070905273a49c1559102a28", "author": {"user": {"login": "jGauravGupta", "name": "Gaurav Gupta"}}, "url": "https://github.com/payara/Payara/commit/374c590346c7a991e070905273a49c1559102a28", "committedDate": "2020-07-07T08:55:55Z", "message": "Merge branch 'master' into FISH-128"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDQzNzA4NjQ1", "url": "https://github.com/payara/Payara/pull/4768#pullrequestreview-443708645", "createdAt": "2020-07-07T09:14:06Z", "commit": {"oid": "d171596b014b09c61d40798d9381b0a29d1e1b60"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wN1QwOToxNDowNlrOGt173Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wN1QwOToxNjowNlrOGt2AhA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MDcyMjc4MQ==", "bodyText": "I think you could just use a for loop with iterator here.", "url": "https://github.com/payara/Payara/pull/4768#discussion_r450722781", "createdAt": "2020-07-07T09:14:06Z", "author": {"login": "jbee"}, "path": "appserver/payara-appserver-modules/microprofile/openapi/src/main/java/fish/payara/microprofile/openapi/impl/OpenApiService.java", "diffHunk": "@@ -262,6 +271,52 @@ private OpenAPI buildDocument() throws OpenAPIBuildException {\n \n     }\n \n+    /**\n+     * @return a list of all classes in the archive.\n+     */\n+    private Set<Type> filterTypes(ApplicationInfo appInfo, OpenApiConfiguration config) {\n+        ReadableArchive archive = appInfo.getSource();\n+\n+        Set<Type> types = new HashSet<>();\n+        if (config != null && config.getScanLib()) {\n+            Iterator<String> subArchiveItr = archive.entries().asIterator();\n+            while (subArchiveItr.hasNext()) {\n+                String subArchive = subArchiveItr.next();\n+                if (subArchive.startsWith(\"WEB-INF/lib/\") && subArchive.endsWith(\".jar\")) {\n+                    try {\n+                        Iterator<String> classItr = archive.getSubArchive(subArchive).entries().asIterator();\n+                        while (classItr.hasNext()) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d171596b014b09c61d40798d9381b0a29d1e1b60"}, "originalPosition": 58}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MDcyMzAwNw==", "bodyText": "I think you could just use a for loop with iterator here.", "url": "https://github.com/payara/Payara/pull/4768#discussion_r450723007", "createdAt": "2020-07-07T09:14:28Z", "author": {"login": "jbee"}, "path": "appserver/payara-appserver-modules/microprofile/openapi/src/main/java/fish/payara/microprofile/openapi/impl/OpenApiService.java", "diffHunk": "@@ -262,6 +271,52 @@ private OpenAPI buildDocument() throws OpenAPIBuildException {\n \n     }\n \n+    /**\n+     * @return a list of all classes in the archive.\n+     */\n+    private Set<Type> filterTypes(ApplicationInfo appInfo, OpenApiConfiguration config) {\n+        ReadableArchive archive = appInfo.getSource();\n+\n+        Set<Type> types = new HashSet<>();\n+        if (config != null && config.getScanLib()) {\n+            Iterator<String> subArchiveItr = archive.entries().asIterator();\n+            while (subArchiveItr.hasNext()) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d171596b014b09c61d40798d9381b0a29d1e1b60"}, "originalPosition": 53}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MDcyMzk3Mg==", "bodyText": "Quite a big method that could be split into a few steps.", "url": "https://github.com/payara/Payara/pull/4768#discussion_r450723972", "createdAt": "2020-07-07T09:16:06Z", "author": {"login": "jbee"}, "path": "appserver/payara-appserver-modules/microprofile/openapi/src/main/java/fish/payara/microprofile/openapi/impl/OpenApiService.java", "diffHunk": "@@ -262,6 +271,52 @@ private OpenAPI buildDocument() throws OpenAPIBuildException {\n \n     }\n \n+    /**\n+     * @return a list of all classes in the archive.\n+     */\n+    private Set<Type> filterTypes(ApplicationInfo appInfo, OpenApiConfiguration config) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d171596b014b09c61d40798d9381b0a29d1e1b60"}, "originalPosition": 47}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "71e7e15d288427c5b29240931aaf821b5ed59c2c", "author": {"user": {"login": "jGauravGupta", "name": "Gaurav Gupta"}}, "url": "https://github.com/payara/Payara/commit/71e7e15d288427c5b29240931aaf821b5ed59c2c", "committedDate": "2020-07-07T11:36:02Z", "message": "FISH-128 PR review changes\n\nSigned-off-by: Gaurav Gupta <gaurav.gupta@payara.fish>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "5ae568b8d2b2fd3fcf183a6d90285c8f430fa238", "author": {"user": {"login": "jGauravGupta", "name": "Gaurav Gupta"}}, "url": "https://github.com/payara/Payara/commit/5ae568b8d2b2fd3fcf183a6d90285c8f430fa238", "committedDate": "2020-07-07T11:38:09Z", "message": "Merge branch 'FISH-128' of https://github.com/jgauravgupta/Payara into FISH-128"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a52364f60ae810cc4fb9b3d453554f19ea1107f3", "author": {"user": {"login": "jGauravGupta", "name": "Gaurav Gupta"}}, "url": "https://github.com/payara/Payara/commit/a52364f60ae810cc4fb9b3d453554f19ea1107f3", "committedDate": "2020-07-07T11:44:18Z", "message": "FISH-128 polish\n\nSigned-off-by: Gaurav Gupta <gaurav.gupta@payara.fish>"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDQzOTU5NzQ0", "url": "https://github.com/payara/Payara/pull/4768#pullrequestreview-443959744", "createdAt": "2020-07-07T14:41:09Z", "commit": {"oid": "a52364f60ae810cc4fb9b3d453554f19ea1107f3"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDQ0MDM3ODYx", "url": "https://github.com/payara/Payara/pull/4768#pullrequestreview-444037861", "createdAt": "2020-07-07T16:04:38Z", "commit": {"oid": "a52364f60ae810cc4fb9b3d453554f19ea1107f3"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 744, "cost": 1, "resetAt": "2021-11-01T16:19:10Z"}}}