{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTQ1NTc3NDM5", "number": 5071, "title": "Add appropriate application name to GAV deployments / FISH-1015", "bodyText": "Description\n\nThis is a bug fix.\nRemote artifact deployed with a temporary name app...tmp. But, e.g., for MDBs we need to specify resource adapter name activation property and we get an deployment error. This fix changes deploy name to artifactId-version.\nWhen creating an uber jar a GAV artifacts are added with a context name, not a filename. When executes this uber jar an exception throws if context name length less than or equal 4. In other case we have an incomplete application name (context - last four chars). This fix writes GAV artifacts with their filenames and adds their contexts to the contexts.properties during uber jar creation.\nImportant Info\nBlockers\n\nTesting\nNew tests\n\nTesting Performed\n\nTesting Environment\n\nDocumentation\n\nNotes for Reviewers", "createdAt": "2020-12-25T11:15:20Z", "url": "https://github.com/payara/Payara/pull/5071", "merged": true, "mergeCommit": {"oid": "2595404306bbb26945900f792b17e9ffbcdbb6f2"}, "closed": true, "closedAt": "2021-01-24T06:13:57Z", "author": {"login": "avpinchuk"}, "timelineItems": {"totalCount": 14, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdpmIMEAH2gAyNTQ1NTc3NDM5OjUwOWY4NjY0MTE1MTc5Mjg2NGQ3MDEyOWVmMjVmMjMwMDRkMjkwMWU=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdtzeSWAFqTU2MzQ1MzUzMg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "509f86641151792864d70129ef25f23004d2901e", "author": {"user": {"login": "avpinchuk", "name": "Alexander Pinchuk"}}, "url": "https://github.com/payara/Payara/commit/509f86641151792864d70129ef25f23004d2901e", "committedDate": "2020-12-25T10:53:28Z", "message": "Fix GAV deployment"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTU4ODA2ODAy", "url": "https://github.com/payara/Payara/pull/5071#pullrequestreview-558806802", "createdAt": "2020-12-25T11:24:04Z", "commit": {"oid": "509f86641151792864d70129ef25f23004d2901e"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0yNVQxMToyNDowNFrOILbsNg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0yNVQxMToyNDowNFrOILbsNg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0ODg1ODkzNA==", "bodyText": "Could this be extracted to (tested) method?\nCould this variable be renamed to something like nameWithExtension - and above comment removed?", "url": "https://github.com/payara/Payara/pull/5071#discussion_r548858934", "createdAt": "2020-12-25T11:24:04Z", "author": {"login": "pzygielo"}, "path": "appserver/extras/payara-micro/payara-micro-core/src/main/java/fish/payara/micro/impl/PayaraMicroImpl.java", "diffHunk": "@@ -1662,9 +1662,15 @@ private void deployAll() throws GlassFishException {\n                         // Convert the URL to a URI for use with the deploy method\n                         URI artefactURI = deploymentMapEntry.getValue().toURI();\n \n-                        deployer.deploy(artefactURI, \"--availabilityenabled\",\n-                                \"true\", \"--contextroot\",\n-                                deploymentMapEntry.getKey(), \"--force=true\", \"--loadOnly\", \"true\");\n+                        String artefactName= artefactURI.getPath().substring(artefactURI.getPath().lastIndexOf('/') + 1);\n+                        // artefact name always has a valid extension\n+                        String name = artefactName.substring(0, artefactName.length() - 4);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "509f86641151792864d70129ef25f23004d2901e"}, "originalPosition": 9}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTU4ODA3MDMw", "url": "https://github.com/payara/Payara/pull/5071#pullrequestreview-558807030", "createdAt": "2020-12-25T11:26:50Z", "commit": {"oid": "509f86641151792864d70129ef25f23004d2901e"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0yNVQxMToyNjo1MFrOILbtoQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0yNVQxMToyNjo1MFrOILbtoQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0ODg1OTI5Nw==", "bodyText": "With above comment implemented - could new method be used here?", "url": "https://github.com/payara/Payara/pull/5071#discussion_r548859297", "createdAt": "2020-12-25T11:26:50Z", "author": {"login": "pzygielo"}, "path": "appserver/extras/payara-micro/payara-micro-core/src/main/java/fish/payara/micro/impl/PayaraMicroImpl.java", "diffHunk": "@@ -2063,7 +2073,12 @@ private void getGAVURLs() throws GlassFishException {\n                     contextRoot = null; // use only once\n                 }\n \n-                deploymentURLsMap.put(defaultContext, artefactMapEntry.getValue());\n+                URL artefactURL = artefactMapEntry.getValue();\n+                String artefactName = artefactURL.getPath().substring(artefactURL.getPath().lastIndexOf('/') + 1);\n+", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "509f86641151792864d70129ef25f23004d2901e"}, "originalPosition": 37}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTU4ODQ3NDQw", "url": "https://github.com/payara/Payara/pull/5071#pullrequestreview-558847440", "createdAt": "2020-12-26T05:03:23Z", "commit": {"oid": "509f86641151792864d70129ef25f23004d2901e"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "3f4383074f5c7473284aab086156dc9e3858f83e", "author": {"user": {"login": "avpinchuk", "name": "Alexander Pinchuk"}}, "url": "https://github.com/payara/Payara/commit/3f4383074f5c7473284aab086156dc9e3858f83e", "committedDate": "2020-12-26T11:44:15Z", "message": "Add utility method for getting filename"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "d18fc907f3e7ed53999d4d59c6b9c00e87dfc0db", "author": {"user": {"login": "avpinchuk", "name": "Alexander Pinchuk"}}, "url": "https://github.com/payara/Payara/commit/d18fc907f3e7ed53999d4d59c6b9c00e87dfc0db", "committedDate": "2020-12-27T18:52:39Z", "message": "Fix GAV write order"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTU5NjMzMTAy", "url": "https://github.com/payara/Payara/pull/5071#pullrequestreview-559633102", "createdAt": "2020-12-29T17:35:04Z", "commit": {"oid": "d18fc907f3e7ed53999d4d59c6b9c00e87dfc0db"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0yOVQxNzozNTowNFrOIMUdcA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0yOVQxNzozNTowNFrOIMUdcA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0OTc4OTA0MA==", "bodyText": "Yes, this will break in so many ways, I cannot count \ud83d\udc4d", "url": "https://github.com/payara/Payara/pull/5071#discussion_r549789040", "createdAt": "2020-12-29T17:35:04Z", "author": {"login": "lprimak"}, "path": "appserver/extras/payara-micro/payara-micro-core/src/main/java/fish/payara/micro/impl/PayaraMicroImpl.java", "diffHunk": "@@ -1662,9 +1662,14 @@ private void deployAll() throws GlassFishException {\n                         // Convert the URL to a URI for use with the deploy method\n                         URI artefactURI = deploymentMapEntry.getValue().toURI();\n \n-                        deployer.deploy(artefactURI, \"--availabilityenabled\",\n-                                \"true\", \"--contextroot\",\n-                                deploymentMapEntry.getKey(), \"--force=true\", \"--loadOnly\", \"true\");\n+                        String artefactName = getFileName(artefactURI.getPath());\n+                        String name = artefactName.substring(0, artefactName.length() - 4);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d18fc907f3e7ed53999d4d59c6b9c00e87dfc0db"}, "originalPosition": 8}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "1451ebdecd46867c0730444f92663ee795e9d6e2", "author": {"user": {"login": "lprimak", "name": "Lenny Primak"}}, "url": "https://github.com/payara/Payara/commit/1451ebdecd46867c0730444f92663ee795e9d6e2", "committedDate": "2020-12-29T20:51:27Z", "message": "refactored primitive obsession when getting file name from path to existing java File() class"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "1d9a532691c8052344734067301227def2787b8d", "author": {"user": {"login": "lprimak", "name": "Lenny Primak"}}, "url": "https://github.com/payara/Payara/commit/1d9a532691c8052344734067301227def2787b8d", "committedDate": "2020-12-29T20:59:19Z", "message": "factore out removeJavaArchiveExtension()"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "6501fee90ab23a967e45302f0ab431dc4a7917ed", "author": {"user": {"login": "avpinchuk", "name": "Alexander Pinchuk"}}, "url": "https://github.com/payara/Payara/commit/6501fee90ab23a967e45302f0ab431dc4a7917ed", "committedDate": "2020-12-30T19:11:06Z", "message": "Merge pull request #1 from flowlogix/gav-branch\n\nrefactored primitive obsession when getting file name from path to ex\u2026"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTYwMTc1OTg2", "url": "https://github.com/payara/Payara/pull/5071#pullrequestreview-560175986", "createdAt": "2020-12-30T19:33:13Z", "commit": {"oid": "6501fee90ab23a967e45302f0ab431dc4a7917ed"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "361e8ec4ad46baf3ca4e10390da998c58b222bf6", "author": {"user": {"login": "avpinchuk", "name": "Alexander Pinchuk"}}, "url": "https://github.com/payara/Payara/commit/361e8ec4ad46baf3ca4e10390da998c58b222bf6", "committedDate": "2020-12-30T20:07:08Z", "message": "Fix IllegalArgumentException for remote maven artifacts"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTYwMTk5NDYx", "url": "https://github.com/payara/Payara/pull/5071#pullrequestreview-560199461", "createdAt": "2020-12-30T21:02:00Z", "commit": {"oid": "361e8ec4ad46baf3ca4e10390da998c58b222bf6"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTYzNDUzNTMy", "url": "https://github.com/payara/Payara/pull/5071#pullrequestreview-563453532", "createdAt": "2021-01-07T12:39:57Z", "commit": {"oid": "361e8ec4ad46baf3ca4e10390da998c58b222bf6"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wMS0wN1QxMjozOTo1N1rOIPq9TQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wMS0wN1QxMjozOTo1N1rOIPq9TQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1MzMwMzM3Mw==", "bodyText": "I'm probably being blind, but is there a reason this is being made static?", "url": "https://github.com/payara/Payara/pull/5071#discussion_r553303373", "createdAt": "2021-01-07T12:39:57Z", "author": {"login": "Pandrex247"}, "path": "appserver/extras/payara-micro/payara-micro-core/src/main/java/fish/payara/micro/impl/PayaraMicroImpl.java", "diffHunk": "@@ -1679,7 +1673,18 @@ private void deployAll() throws GlassFishException {\n         LOGGER.log(Level.INFO, \"Deployed {0} archive(s)\", deploymentCount);\n     }\n \n-    private boolean hasJavaArchiveExtension(String filePath) {\n+    private String removeJavaArchiveExtension(String fileName) {\n+        if (hasJavaArchiveExtension(fileName)) {\n+            return fileName.substring(0, fileName.length() - 4);\n+        } else {\n+            return fileName;\n+        }\n+    }\n+\n+    private static boolean hasJavaArchiveExtension(String filePath) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "361e8ec4ad46baf3ca4e10390da998c58b222bf6"}, "originalPosition": 75}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 652, "cost": 1, "resetAt": "2021-11-01T16:19:10Z"}}}