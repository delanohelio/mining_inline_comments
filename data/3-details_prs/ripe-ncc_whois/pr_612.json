{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0Mzg5MjY0NTY4", "number": 612, "title": "Nrtm acl limit", "bodyText": "ACL Limit in NRTM Service", "createdAt": "2020-03-16T14:09:59Z", "url": "https://github.com/RIPE-NCC/whois/pull/612", "merged": true, "mergeCommit": {"oid": "f1157cea41f90a48dd19705bf96d51faf78c2aa6"}, "closed": true, "closedAt": "2020-03-17T13:56:48Z", "author": {"login": "maggarwal13"}, "timelineItems": {"totalCount": 21, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcNMTrRgH2gAyMzg5MjY0NTY4OjBlYjhhY2UzZGMxOWU1YTYyNGQwMDc0ZWJlNzU3Y2IyNDE4ZTZkNjg=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcOi__EgFqTM3NjA0OTE1NA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "0eb8ace3dc19e5a624d0074ebe757cb2418e6d68", "author": {"user": {"login": "maggarwal13", "name": null}}, "url": "https://github.com/RIPE-NCC/whois/commit/0eb8ace3dc19e5a624d0074ebe757cb2418e6d68", "committedDate": "2020-03-13T08:47:27Z", "message": "add acl limit to nrtm"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "828fc855ebd0a771b100f5dc735cea853a6bc5e3", "author": {"user": {"login": "maggarwal13", "name": null}}, "url": "https://github.com/RIPE-NCC/whois/commit/828fc855ebd0a771b100f5dc735cea853a6bc5e3", "committedDate": "2020-03-13T09:14:10Z", "message": "Merge branch 'master' into nrtm_acl_limit"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "082677e9646f892b0ea68db27f84f18992b3cdbf", "author": {"user": {"login": "maggarwal13", "name": null}}, "url": "https://github.com/RIPE-NCC/whois/commit/082677e9646f892b0ea68db27f84f18992b3cdbf", "committedDate": "2020-03-13T09:52:15Z", "message": "add query application context in nrtm"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ae4f165300cfee6475ba3c6c4a5df9756b7cca0e", "author": {"user": {"login": "maggarwal13", "name": null}}, "url": "https://github.com/RIPE-NCC/whois/commit/ae4f165300cfee6475ba3c6c4a5df9756b7cca0e", "committedDate": "2020-03-13T11:40:37Z", "message": "add integration tests"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "0f9aeb66a09259de5026a3e78440390edffbcd10", "author": {"user": {"login": "maggarwal13", "name": null}}, "url": "https://github.com/RIPE-NCC/whois/commit/0f9aeb66a09259de5026a3e78440390edffbcd10", "committedDate": "2020-03-16T09:58:39Z", "message": "inject only acl package in nrtm"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f36fddbc1d6a46861c48a78ce9c7d7550e3b81f8", "author": {"user": {"login": "maggarwal13", "name": null}}, "url": "https://github.com/RIPE-NCC/whois/commit/f36fddbc1d6a46861c48a78ce9c7d7550e3b81f8", "committedDate": "2020-03-16T14:08:38Z", "message": "include acl package from whois-query"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzc1MjU2OTgx", "url": "https://github.com/RIPE-NCC/whois/pull/612#pullrequestreview-375256981", "createdAt": "2020-03-16T14:13:40Z", "commit": {"oid": "f36fddbc1d6a46861c48a78ce9c7d7550e3b81f8"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xNlQxNDoxMzo0MFrOF219Lw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xNlQxNDoxODo0OVrOF22SjA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MzA1MTQzOQ==", "bodyText": "Please fix your IDE settings not to use \"star\" for imports, it's harder to diff changes", "url": "https://github.com/RIPE-NCC/whois/pull/612#discussion_r393051439", "createdAt": "2020-03-16T14:13:40Z", "author": {"login": "eshryane"}, "path": "whois-nrtm/src/test/java/net/ripe/db/whois/nrtm/NrtmConnectionPerIpLimitHandlerTest.java", "diffHunk": "@@ -11,14 +13,14 @@\n import org.junit.Test;\n import org.junit.runner.RunWith;\n import org.mockito.ArgumentMatcher;\n+import org.mockito.Matchers;\n import org.mockito.Mock;\n import org.mockito.runners.MockitoJUnitRunner;\n \n import java.net.Inet4Address;\n import java.net.InetSocketAddress;\n \n-import static org.mockito.Matchers.anyObject;\n-import static org.mockito.Matchers.argThat;\n+import static org.mockito.Matchers.*;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f36fddbc1d6a46861c48a78ce9c7d7550e3b81f8"}, "originalPosition": 21}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MzA1MzI5NQ==", "bodyText": "This method is misleading, the name suggests there are no side-effects, but then it can close the connection. The method does multiple things, and it's only called once - I think it's clearer to inline it into the channelOpen method()?", "url": "https://github.com/RIPE-NCC/whois/pull/612#discussion_r393053295", "createdAt": "2020-03-16T14:15:23Z", "author": {"login": "eshryane"}, "path": "whois-nrtm/src/main/java/net/ripe/db/whois/nrtm/NrtmConnectionPerIpLimitHandler.java", "diffHunk": "@@ -70,4 +72,23 @@ private boolean connectionsExceeded(final InetAddress remoteAddresss) {\n         final Integer count = connectionCounter.increment(remoteAddresss);\n         return (count != null && count > maxConnectionsPerIp);\n     }\n+\n+    private boolean canOpenConnection(final Channel channel, final InetAddress remoteAddress) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f36fddbc1d6a46861c48a78ce9c7d7550e3b81f8"}, "originalPosition": 58}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MzA1NjkwOA==", "bodyText": "Can you move the ACL logic into a separate class? Look at the #596 PR for an example (there's a separate class for AccessControlList).  It's confusing that this Handler now also includes the ACL logic, it should be separate.", "url": "https://github.com/RIPE-NCC/whois/pull/612#discussion_r393056908", "createdAt": "2020-03-16T14:18:49Z", "author": {"login": "eshryane"}, "path": "whois-nrtm/src/main/java/net/ripe/db/whois/nrtm/NrtmConnectionPerIpLimitHandler.java", "diffHunk": "@@ -23,29 +23,31 @@\n @ChannelHandler.Sharable\n public class NrtmConnectionPerIpLimitHandler extends SimpleChannelUpstreamHandler {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f36fddbc1d6a46861c48a78ce9c7d7550e3b81f8"}, "originalPosition": 19}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "dad1b86826312e1dc9d5d9e2ca4e15aa7f79a8ad", "author": {"user": {"login": "maggarwal13", "name": null}}, "url": "https://github.com/RIPE-NCC/whois/commit/dad1b86826312e1dc9d5d9e2ca4e15aa7f79a8ad", "committedDate": "2020-03-16T15:08:44Z", "message": "implementing Ed suggestions"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "8188fc5423e13d6679bf0491bfc1f6854532cff0", "author": {"user": {"login": "maggarwal13", "name": null}}, "url": "https://github.com/RIPE-NCC/whois/commit/8188fc5423e13d6679bf0491bfc1f6854532cff0", "committedDate": "2020-03-16T15:13:34Z", "message": "Merge branch 'master' into nrtm_acl_limit"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzc1MzM0Njcz", "url": "https://github.com/RIPE-NCC/whois/pull/612#pullrequestreview-375334673", "createdAt": "2020-03-16T15:37:06Z", "commit": {"oid": "8188fc5423e13d6679bf0491bfc1f6854532cff0"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xNlQxNTozNzowN1rOF254yg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xNlQxNTozNzowN1rOF254yg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MzExNTg1MA==", "bodyText": "Can you add one \"success\" test, where the client isn't blocked or denied by ACL?", "url": "https://github.com/RIPE-NCC/whois/pull/612#discussion_r393115850", "createdAt": "2020-03-16T15:37:07Z", "author": {"login": "eshryane"}, "path": "whois-nrtm/src/test/java/net/ripe/db/whois/nrtm/integration/NrtmClientACLLimitTestIntegration.java", "diffHunk": "@@ -0,0 +1,103 @@\n+package net.ripe.db.whois.nrtm.integration;\n+\n+import com.jayway.awaitility.Awaitility;\n+import com.jayway.awaitility.Duration;\n+import net.ripe.db.whois.common.IntegrationTest;\n+import net.ripe.db.whois.common.dao.jdbc.DatabaseHelper;\n+import net.ripe.db.whois.common.rpsl.RpslObject;\n+import net.ripe.db.whois.common.source.SourceContext;\n+import net.ripe.db.whois.nrtm.NrtmServer;\n+import net.ripe.db.whois.nrtm.client.NrtmImporter;\n+import net.ripe.db.whois.query.acl.AccessControlListManager;\n+import net.ripe.db.whois.query.acl.IpResourceConfiguration;\n+import net.ripe.db.whois.query.support.TestPersonalObjectAccounting;\n+import org.junit.After;\n+import org.junit.Before;\n+import org.junit.BeforeClass;\n+import org.junit.Test;\n+import org.junit.experimental.categories.Category;\n+import org.springframework.beans.factory.annotation.Autowired;\n+import org.springframework.test.annotation.DirtiesContext;\n+\n+import java.net.InetAddress;\n+\n+@Category(IntegrationTest.class)", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "8188fc5423e13d6679bf0491bfc1f6854532cff0"}, "originalPosition": 24}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "286c6969177490e85ed2a9fd99e63c92ed321527", "author": {"user": {"login": "maggarwal13", "name": null}}, "url": "https://github.com/RIPE-NCC/whois/commit/286c6969177490e85ed2a9fd99e63c92ed321527", "committedDate": "2020-03-16T16:01:52Z", "message": "adding success case"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "de59365d1fcab216936f3a5cbde8a67e30395b21", "author": {"user": {"login": "maggarwal13", "name": null}}, "url": "https://github.com/RIPE-NCC/whois/commit/de59365d1fcab216936f3a5cbde8a67e30395b21", "committedDate": "2020-03-17T08:06:20Z", "message": "Merge branch 'master' into nrtm_acl_limit"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "fcd192982cc1550ce88f185a4b62b9b337e19c1d", "author": {"user": {"login": "eshryane", "name": "Ed Shryane"}}, "url": "https://github.com/RIPE-NCC/whois/commit/fcd192982cc1550ce88f185a4b62b9b337e19c1d", "committedDate": "2020-03-17T08:32:37Z", "message": "Merge branch 'master' into nrtm_acl_limit"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "fd7a330907626c52eb4a321f6dbf2908b23a373f", "author": {"user": {"login": "maggarwal13", "name": null}}, "url": "https://github.com/RIPE-NCC/whois/commit/fd7a330907626c52eb4a321f6dbf2908b23a373f", "committedDate": "2020-03-17T10:51:52Z", "message": "fixing acl limit test case"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "4ec095161a483a1831b8f7d675c8e07c515172ab", "author": {"user": {"login": "maggarwal13", "name": null}}, "url": "https://github.com/RIPE-NCC/whois/commit/4ec095161a483a1831b8f7d675c8e07c515172ab", "committedDate": "2020-03-17T10:52:05Z", "message": "Merge branch 'nrtm_acl_limit' of github.com:RIPE-NCC/whois into nrtm_acl_limit\n\n* 'nrtm_acl_limit' of github.com:RIPE-NCC/whois:\n  Restored failsafe config (re-ordered) and integration tests are passing (locally) (?)"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "01e49a495715a906df758b73fbe91e51a9b60ece", "author": {"user": {"login": "maggarwal13", "name": null}}, "url": "https://github.com/RIPE-NCC/whois/commit/01e49a495715a906df758b73fbe91e51a9b60ece", "committedDate": "2020-03-17T11:30:58Z", "message": "refactor unit test case"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "42aa31a8b4526c6c51b20c0a7e09f61c51491b82", "author": {"user": {"login": "maggarwal13", "name": null}}, "url": "https://github.com/RIPE-NCC/whois/commit/42aa31a8b4526c6c51b20c0a7e09f61c51491b82", "committedDate": "2020-03-17T11:35:20Z", "message": "refactor"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b5bf429d7bcfed341062a27a120bfebee66e22a6", "author": {"user": {"login": "maggarwal13", "name": null}}, "url": "https://github.com/RIPE-NCC/whois/commit/b5bf429d7bcfed341062a27a120bfebee66e22a6", "committedDate": "2020-03-17T11:38:02Z", "message": "unused injected beans"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "8a997b04b6a4d6130c08b5b643cdfb599dc7af72", "author": {"user": {"login": "maggarwal13", "name": null}}, "url": "https://github.com/RIPE-NCC/whois/commit/8a997b04b6a4d6130c08b5b643cdfb599dc7af72", "committedDate": "2020-03-17T11:40:12Z", "message": "Merge branch 'master' into nrtm_acl_limit"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b41038d76f374156bb26c99e6602c1376c18f4ed", "author": {"user": {"login": "eshryane", "name": "Ed Shryane"}}, "url": "https://github.com/RIPE-NCC/whois/commit/b41038d76f374156bb26c99e6602c1376c18f4ed", "committedDate": "2020-03-17T13:39:46Z", "message": "Renamed class for consistency"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzc2MDQ5MTU0", "url": "https://github.com/RIPE-NCC/whois/pull/612#pullrequestreview-376049154", "createdAt": "2020-03-17T13:47:41Z", "commit": {"oid": "8a997b04b6a4d6130c08b5b643cdfb599dc7af72"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 739, "cost": 1, "resetAt": "2021-11-01T16:37:27Z"}}}