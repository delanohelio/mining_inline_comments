{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDcxNTA0MzQw", "number": 653, "title": "Aws ripe profile", "bodyText": "", "createdAt": "2020-08-21T08:52:51Z", "url": "https://github.com/RIPE-NCC/whois/pull/653", "merged": true, "mergeCommit": {"oid": "42f8bdbdf7c8d8b8c87e141904fb81f1d22bc4ea"}, "closed": true, "closedAt": "2020-08-31T08:37:14Z", "author": {"login": "maggarwal13"}, "timelineItems": {"totalCount": 12, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdAv8hogH2gAyNDcxNTA0MzQwOjg1MGM4NzMyOTcyZTNjMjY4NWI5MmYwMGM1NDdhOGVhZGU3YzFiOTk=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdEOWyzAFqTQ3ODQxMDQyMg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "850c8732972e3c2685b92f00c547a8eade7c1b99", "author": {"user": {"login": "maggarwal13", "name": null}}, "url": "https://github.com/RIPE-NCC/whois/commit/850c8732972e3c2685b92f00c547a8eade7c1b99", "committedDate": "2020-08-20T13:08:53Z", "message": "use aws profile and ripe profile"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "286e58106d36c65e5029745717270a47e4eb9bdc", "author": {"user": {"login": "maggarwal13", "name": null}}, "url": "https://github.com/RIPE-NCC/whois/commit/286e58106d36c65e5029745717270a47e4eb9bdc", "committedDate": "2020-08-20T13:22:47Z", "message": "add todo"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "4569499f1572b0df45462e745185bd8b24323e7b", "author": {"user": {"login": "maggarwal13", "name": null}}, "url": "https://github.com/RIPE-NCC/whois/commit/4569499f1572b0df45462e745185bd8b24323e7b", "committedDate": "2020-08-24T14:35:59Z", "message": "remove propertysource for aws profile"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "8fb6b7294ec8d7060185434697133f829e848aaa", "author": {"user": {"login": "maggarwal13", "name": null}}, "url": "https://github.com/RIPE-NCC/whois/commit/8fb6b7294ec8d7060185434697133f829e848aaa", "committedDate": "2020-08-25T11:46:48Z", "message": "Merge branch 'aws' into aws_ripe_profile"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDc0NDE1OTk3", "url": "https://github.com/RIPE-NCC/whois/pull/653#pullrequestreview-474415997", "createdAt": "2020-08-25T12:10:28Z", "commit": {"oid": "4569499f1572b0df45462e745185bd8b24323e7b"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yNVQxMjoxMDoyOFrOHGVEvg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yNVQxMjoxMDoyOFrOHGVEvg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NjM5ODc4Mg==", "bodyText": "Should be provided as a environment variable (hopefully automatically).", "url": "https://github.com/RIPE-NCC/whois/pull/653#discussion_r476398782", "createdAt": "2020-08-25T12:10:28Z", "author": {"login": "sbusk"}, "path": "whois-commons/src/main/java/net/ripe/db/whois/common/WhoisAWSPropertyResolver.java", "diffHunk": "@@ -0,0 +1,77 @@\n+package net.ripe.db.whois.common;\n+\n+import com.amazonaws.services.simplesystemsmanagement.AWSSimpleSystemsManagement;\n+import com.amazonaws.services.simplesystemsmanagement.AWSSimpleSystemsManagementClient;\n+import com.amazonaws.services.simplesystemsmanagement.model.GetParametersByPathRequest;\n+import com.amazonaws.services.simplesystemsmanagement.model.GetParametersByPathResult;\n+import com.amazonaws.services.simplesystemsmanagement.model.Parameter;\n+import net.ripe.db.whois.common.profiles.WhoisProfile;\n+import org.slf4j.Logger;\n+import org.slf4j.LoggerFactory;\n+import org.springframework.context.annotation.Bean;\n+import org.springframework.context.annotation.Configuration;\n+import org.springframework.context.annotation.Profile;\n+import org.springframework.context.annotation.PropertySource;\n+import org.springframework.context.support.PropertySourcesPlaceholderConfigurer;\n+\n+import java.util.HashMap;\n+import java.util.List;\n+import java.util.Map;\n+import java.util.Properties;\n+import java.util.stream.Collectors;\n+\n+@Configuration\n+@Profile(WhoisProfile.AWS_DEPLOYED)\n+@PropertySource(value = \"classpath:version.properties\", ignoreResourceNotFound = true)\n+public class WhoisAWSPropertyResolver {\n+\n+    private static final Logger LOGGER = LoggerFactory.getLogger(WhoisAWSPropertyResolver.class);\n+\n+    //TODO: get region to deploy from gitlab", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "4569499f1572b0df45462e745185bd8b24323e7b"}, "originalPosition": 30}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDc0NDE2NjI4", "url": "https://github.com/RIPE-NCC/whois/pull/653#pullrequestreview-474416628", "createdAt": "2020-08-25T12:11:25Z", "commit": {"oid": "4569499f1572b0df45462e745185bd8b24323e7b"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yNVQxMjoxMToyNlrOHGVGow==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yNVQxMjoxMToyNlrOHGVGow==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NjM5OTI2Nw==", "bodyText": "If encryption is only ever true, why pass it as an argument?", "url": "https://github.com/RIPE-NCC/whois/pull/653#discussion_r476399267", "createdAt": "2020-08-25T12:11:26Z", "author": {"login": "sbusk"}, "path": "whois-commons/src/main/java/net/ripe/db/whois/common/WhoisAWSPropertyResolver.java", "diffHunk": "@@ -0,0 +1,77 @@\n+package net.ripe.db.whois.common;\n+\n+import com.amazonaws.services.simplesystemsmanagement.AWSSimpleSystemsManagement;\n+import com.amazonaws.services.simplesystemsmanagement.AWSSimpleSystemsManagementClient;\n+import com.amazonaws.services.simplesystemsmanagement.model.GetParametersByPathRequest;\n+import com.amazonaws.services.simplesystemsmanagement.model.GetParametersByPathResult;\n+import com.amazonaws.services.simplesystemsmanagement.model.Parameter;\n+import net.ripe.db.whois.common.profiles.WhoisProfile;\n+import org.slf4j.Logger;\n+import org.slf4j.LoggerFactory;\n+import org.springframework.context.annotation.Bean;\n+import org.springframework.context.annotation.Configuration;\n+import org.springframework.context.annotation.Profile;\n+import org.springframework.context.annotation.PropertySource;\n+import org.springframework.context.support.PropertySourcesPlaceholderConfigurer;\n+\n+import java.util.HashMap;\n+import java.util.List;\n+import java.util.Map;\n+import java.util.Properties;\n+import java.util.stream.Collectors;\n+\n+@Configuration\n+@Profile(WhoisProfile.AWS_DEPLOYED)\n+@PropertySource(value = \"classpath:version.properties\", ignoreResourceNotFound = true)\n+public class WhoisAWSPropertyResolver {\n+\n+    private static final Logger LOGGER = LoggerFactory.getLogger(WhoisAWSPropertyResolver.class);\n+\n+    //TODO: get region to deploy from gitlab\n+    private static final String REGION = \"eu-central-1\";\n+\n+    @Bean\n+    public static PropertySourcesPlaceholderConfigurer properties(){\n+        LOGGER.info(\"AWS profile : using ssm parameter store \");\n+\n+        Properties properties = new Properties();\n+        properties.putAll( getParametersByEnvAndApp(\"/whois/\", true));\n+\n+        PropertySourcesPlaceholderConfigurer propertySourceConfig = new PropertySourcesPlaceholderConfigurer();\n+        propertySourceConfig.setProperties(properties);\n+\n+        return propertySourceConfig;\n+    }\n+\n+    public static Map<String, Object> getParametersByEnvAndApp(final String path, final boolean encryption) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "4569499f1572b0df45462e745185bd8b24323e7b"}, "originalPosition": 46}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDc0NDE2OTcz", "url": "https://github.com/RIPE-NCC/whois/pull/653#pullrequestreview-474416973", "createdAt": "2020-08-25T12:11:56Z", "commit": {"oid": "4569499f1572b0df45462e745185bd8b24323e7b"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yNVQxMjoxMTo1NlrOHGVH8w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yNVQxMjoxMTo1NlrOHGVH8w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NjM5OTYwMw==", "bodyText": "Nitpicking here but .withPath(...) should be on next line.", "url": "https://github.com/RIPE-NCC/whois/pull/653#discussion_r476399603", "createdAt": "2020-08-25T12:11:56Z", "author": {"login": "sbusk"}, "path": "whois-commons/src/main/java/net/ripe/db/whois/common/WhoisAWSPropertyResolver.java", "diffHunk": "@@ -0,0 +1,77 @@\n+package net.ripe.db.whois.common;\n+\n+import com.amazonaws.services.simplesystemsmanagement.AWSSimpleSystemsManagement;\n+import com.amazonaws.services.simplesystemsmanagement.AWSSimpleSystemsManagementClient;\n+import com.amazonaws.services.simplesystemsmanagement.model.GetParametersByPathRequest;\n+import com.amazonaws.services.simplesystemsmanagement.model.GetParametersByPathResult;\n+import com.amazonaws.services.simplesystemsmanagement.model.Parameter;\n+import net.ripe.db.whois.common.profiles.WhoisProfile;\n+import org.slf4j.Logger;\n+import org.slf4j.LoggerFactory;\n+import org.springframework.context.annotation.Bean;\n+import org.springframework.context.annotation.Configuration;\n+import org.springframework.context.annotation.Profile;\n+import org.springframework.context.annotation.PropertySource;\n+import org.springframework.context.support.PropertySourcesPlaceholderConfigurer;\n+\n+import java.util.HashMap;\n+import java.util.List;\n+import java.util.Map;\n+import java.util.Properties;\n+import java.util.stream.Collectors;\n+\n+@Configuration\n+@Profile(WhoisProfile.AWS_DEPLOYED)\n+@PropertySource(value = \"classpath:version.properties\", ignoreResourceNotFound = true)\n+public class WhoisAWSPropertyResolver {\n+\n+    private static final Logger LOGGER = LoggerFactory.getLogger(WhoisAWSPropertyResolver.class);\n+\n+    //TODO: get region to deploy from gitlab\n+    private static final String REGION = \"eu-central-1\";\n+\n+    @Bean\n+    public static PropertySourcesPlaceholderConfigurer properties(){\n+        LOGGER.info(\"AWS profile : using ssm parameter store \");\n+\n+        Properties properties = new Properties();\n+        properties.putAll( getParametersByEnvAndApp(\"/whois/\", true));\n+\n+        PropertySourcesPlaceholderConfigurer propertySourceConfig = new PropertySourcesPlaceholderConfigurer();\n+        propertySourceConfig.setProperties(properties);\n+\n+        return propertySourceConfig;\n+    }\n+\n+    public static Map<String, Object> getParametersByEnvAndApp(final String path, final boolean encryption) {\n+        final AWSSimpleSystemsManagement awsSimpleSystemsManagement = AWSSimpleSystemsManagementClient.builder()\n+                .withRegion(REGION).build();\n+\n+        final GetParametersByPathRequest getParametersByPathRequest = new GetParametersByPathRequest().withPath(path)", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "4569499f1572b0df45462e745185bd8b24323e7b"}, "originalPosition": 50}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDc0NDE5Nzk1", "url": "https://github.com/RIPE-NCC/whois/pull/653#pullrequestreview-474419795", "createdAt": "2020-08-25T12:16:11Z", "commit": {"oid": "4569499f1572b0df45462e745185bd8b24323e7b"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yNVQxMjoxNjoxMlrOHGVQqA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yNVQxMjoxNjoxMlrOHGVQqA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NjQwMTgzMg==", "bodyText": "We'll put this in Terraform.", "url": "https://github.com/RIPE-NCC/whois/pull/653#discussion_r476401832", "createdAt": "2020-08-25T12:16:12Z", "author": {"login": "sbusk"}, "path": "whois-db/pom.xml", "diffHunk": "@@ -171,6 +171,8 @@\n                         <jvmFlags>\n                             <jvmFlag>-Dwhois.config=/export/services/whois/properties</jvmFlag>\n                             <jvmFlag>-Dlog4j.configurationFile=file:/export/services/whois/log4j2.xml</jvmFlag>\n+                            <!-- TODO: get profile from gitlab -->", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "4569499f1572b0df45462e745185bd8b24323e7b"}, "originalPosition": 4}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "3a59f7a56b5c3e4ba7d2b5e50d68d5c6925da382", "author": {"user": {"login": "maggarwal13", "name": null}}, "url": "https://github.com/RIPE-NCC/whois/commit/3a59f7a56b5c3e4ba7d2b5e50d68d5c6925da382", "committedDate": "2020-08-25T12:19:02Z", "message": "basic refactoring"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a270fa8c73d9d863a4d0375de80e12ce7822b1a9", "author": {"user": {"login": "maggarwal13", "name": null}}, "url": "https://github.com/RIPE-NCC/whois/commit/a270fa8c73d9d863a4d0375de80e12ce7822b1a9", "committedDate": "2020-08-25T12:28:42Z", "message": "remove hard coded spring profile"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "90cca63402343aff083db47b1576e5fc08e12c89", "author": {"user": {"login": "maggarwal13", "name": null}}, "url": "https://github.com/RIPE-NCC/whois/commit/90cca63402343aff083db47b1576e5fc08e12c89", "committedDate": "2020-08-27T11:22:04Z", "message": "use env variable for aws region"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDc4NDEwNDIy", "url": "https://github.com/RIPE-NCC/whois/pull/653#pullrequestreview-478410422", "createdAt": "2020-08-31T08:16:30Z", "commit": {"oid": "90cca63402343aff083db47b1576e5fc08e12c89"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 783, "cost": 1, "resetAt": "2021-11-01T16:37:27Z"}}}