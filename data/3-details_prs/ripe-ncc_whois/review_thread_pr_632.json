{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDE5NDkzOTkx", "number": 632, "reviewThreads": {"totalCount": 5, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xOFQxNDo0MTozM1rOD9bLyQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yNVQxOToyNjo1OVrOD_dRFw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjY1NzM1MTEzOnYy", "diffSide": "RIGHT", "path": "whois-api/src/main/java/net/ripe/db/whois/api/rdap/RdapObjectMapper.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xOFQxNDo0MTozM1rOGW6S2w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xOFQxNDo0MTozM1rOGW6S2w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNjY3Njk1NQ==", "bodyText": "Typo performace -> performance", "url": "https://github.com/RIPE-NCC/whois/pull/632#discussion_r426676955", "createdAt": "2020-05-18T14:41:33Z", "author": {"login": "sbusk"}, "path": "whois-api/src/main/java/net/ripe/db/whois/api/rdap/RdapObjectMapper.java", "diffHunk": "@@ -138,6 +137,14 @@ public Object mapSearch(final String requestUrl, final List<RpslObject> objects,\n             }\n         }\n \n+        if(objects.size() == maxResultSize) {\n+            final Notice notice = new Notice();\n+            notice.setTitle(\"Search result cap to \" + maxResultSize);\n+            notice.getDescription().add(\"Due to performace issue, we have capped the maximum search result to \" + maxResultSize);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "3cea3f0e35a939ba7e1c46bfbe9ef4af9aebd49d"}, "originalPosition": 23}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjY3ODY1ODc4OnYy", "diffSide": "RIGHT", "path": "whois-api/src/main/java/net/ripe/db/whois/api/rdap/RdapObjectMapper.java", "isResolved": true, "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yNVQxOToyMzoyM1rOGaIYnA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yNlQwNzo1MzowMFrOGaSqMw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMDA1MzUzMg==", "bodyText": "Is it possible that objects.size() can be larger than maxResultSize ?", "url": "https://github.com/RIPE-NCC/whois/pull/632#discussion_r430053532", "createdAt": "2020-05-25T19:23:23Z", "author": {"login": "eshryane"}, "path": "whois-api/src/main/java/net/ripe/db/whois/api/rdap/RdapObjectMapper.java", "diffHunk": "@@ -138,6 +137,14 @@ public Object mapSearch(final String requestUrl, final List<RpslObject> objects,\n             }\n         }\n \n+        if(objects.size() == maxResultSize) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "217f9d802d14678817ce490fcc39663310fe1b6a"}, "originalPosition": 20}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMDIxODcwNg==", "bodyText": "it can be smaller than max result size, this condition is used to add a notice in case it is above the limit. if the result is smaller we donot need to add a notice", "url": "https://github.com/RIPE-NCC/whois/pull/632#discussion_r430218706", "createdAt": "2020-05-26T07:47:28Z", "author": {"login": "maggarwal13"}, "path": "whois-api/src/main/java/net/ripe/db/whois/api/rdap/RdapObjectMapper.java", "diffHunk": "@@ -138,6 +137,14 @@ public Object mapSearch(final String requestUrl, final List<RpslObject> objects,\n             }\n         }\n \n+        if(objects.size() == maxResultSize) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMDA1MzUzMg=="}, "originalCommit": {"oid": "217f9d802d14678817ce490fcc39663310fe1b6a"}, "originalPosition": 20}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMDIyMTg3NQ==", "bodyText": "Thanks!", "url": "https://github.com/RIPE-NCC/whois/pull/632#discussion_r430221875", "createdAt": "2020-05-26T07:53:00Z", "author": {"login": "eshryane"}, "path": "whois-api/src/main/java/net/ripe/db/whois/api/rdap/RdapObjectMapper.java", "diffHunk": "@@ -138,6 +137,14 @@ public Object mapSearch(final String requestUrl, final List<RpslObject> objects,\n             }\n         }\n \n+        if(objects.size() == maxResultSize) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMDA1MzUzMg=="}, "originalCommit": {"oid": "217f9d802d14678817ce490fcc39663310fe1b6a"}, "originalPosition": 20}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjY3ODY2MTQ4OnYy", "diffSide": "RIGHT", "path": "whois-api/src/main/java/net/ripe/db/whois/api/rdap/RdapObjectMapper.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yNVQxOToyNTowNFrOGaIaNA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yNVQxOToyNTowNFrOGaIaNA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMDA1Mzk0MA==", "bodyText": "I suggest simplifying the text as 'limited search results to ... maximum' (s/capped/limited/g) and no need for details in the description.", "url": "https://github.com/RIPE-NCC/whois/pull/632#discussion_r430053940", "createdAt": "2020-05-25T19:25:04Z", "author": {"login": "eshryane"}, "path": "whois-api/src/main/java/net/ripe/db/whois/api/rdap/RdapObjectMapper.java", "diffHunk": "@@ -138,6 +137,14 @@ public Object mapSearch(final String requestUrl, final List<RpslObject> objects,\n             }\n         }\n \n+        if(objects.size() == maxResultSize) {\n+            final Notice notice = new Notice();\n+            notice.setTitle(\"Search result cap to \" + maxResultSize);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "217f9d802d14678817ce490fcc39663310fe1b6a"}, "originalPosition": 22}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjY3ODY2MjczOnYy", "diffSide": "RIGHT", "path": "whois-api/src/main/java/net/ripe/db/whois/api/rdap/WhoisRdapService.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yNVQxOToyNjowMFrOGaIa8g==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yNVQxOToyNjowMFrOGaIa8g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMDA1NDEzMA==", "bodyText": "Prefix with 'sort consistently ... for predictable search results'", "url": "https://github.com/RIPE-NCC/whois/pull/632#discussion_r430054130", "createdAt": "2020-05-25T19:26:00Z", "author": {"login": "eshryane"}, "path": "whois-api/src/main/java/net/ripe/db/whois/api/rdap/WhoisRdapService.java", "diffHunk": "@@ -73,7 +77,11 @@\n     private static final String CONTENT_TYPE_RDAP_JSON = \"application/rdap+json\";\n     private static final Joiner COMMA_JOINER = Joiner.on(\",\");\n \n-    private static final int SEARCH_MAX_RESULTS = 100;\n+    //necessary for predictable search results", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "217f9d802d14678817ce490fcc39663310fe1b6a"}, "originalPosition": 30}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjY3ODY2MzkxOnYy", "diffSide": "RIGHT", "path": "whois-api/src/test/java/net/ripe/db/whois/api/rdap/WhoisRdapQueryLimitTestIntegration.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yNVQxOToyNjo1OVrOGaIbqw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yNVQxOToyNjo1OVrOGaIbqw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMDA1NDMxNQ==", "bodyText": "Change your IDE settings to not use asterisk for importing packages (it's harder to see what's imported, and what changes)", "url": "https://github.com/RIPE-NCC/whois/pull/632#discussion_r430054315", "createdAt": "2020-05-25T19:26:59Z", "author": {"login": "eshryane"}, "path": "whois-api/src/test/java/net/ripe/db/whois/api/rdap/WhoisRdapQueryLimitTestIntegration.java", "diffHunk": "@@ -0,0 +1,261 @@\n+package net.ripe.db.whois.api.rdap;\n+\n+import com.google.common.collect.Lists;\n+import com.google.common.net.HttpHeaders;\n+import net.ripe.db.whois.api.fulltextsearch.FullTextIndex;\n+import net.ripe.db.whois.api.rdap.domain.Action;\n+import net.ripe.db.whois.api.rdap.domain.Autnum;\n+import net.ripe.db.whois.api.rdap.domain.Domain;\n+import net.ripe.db.whois.api.rdap.domain.Entity;\n+import net.ripe.db.whois.api.rdap.domain.Event;\n+import net.ripe.db.whois.api.rdap.domain.Ip;\n+import net.ripe.db.whois.api.rdap.domain.Link;\n+import net.ripe.db.whois.api.rdap.domain.Nameserver;\n+import net.ripe.db.whois.api.rdap.domain.Notice;\n+import net.ripe.db.whois.api.rdap.domain.RdapObject;\n+import net.ripe.db.whois.api.rdap.domain.Remark;\n+import net.ripe.db.whois.api.rdap.domain.Role;\n+import net.ripe.db.whois.api.rdap.domain.SearchResult;\n+import net.ripe.db.whois.common.IntegrationTest;\n+import net.ripe.db.whois.query.support.TestWhoisLog;\n+import org.hamcrest.Matchers;\n+import org.junit.Before;\n+import org.junit.BeforeClass;\n+import org.junit.Test;\n+import org.junit.experimental.categories.Category;\n+import org.springframework.beans.factory.annotation.Autowired;\n+import org.springframework.test.annotation.DirtiesContext;\n+\n+import javax.ws.rs.BadRequestException;\n+import javax.ws.rs.HttpMethod;\n+import javax.ws.rs.NotFoundException;\n+import javax.ws.rs.core.MediaType;\n+import javax.ws.rs.core.Response;\n+import java.time.LocalDateTime;\n+import java.util.Collection;\n+import java.util.Collections;\n+import java.util.List;\n+import java.util.stream.Collectors;\n+\n+import static org.hamcrest.Matchers.*;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "217f9d802d14678817ce490fcc39663310fe1b6a"}, "originalPosition": 40}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4637, "cost": 1, "resetAt": "2021-11-12T12:57:47Z"}}}