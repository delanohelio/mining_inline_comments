{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDcxNTA0MzQw", "number": 653, "reviewThreads": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yNVQxMjoxMDoyOFrOEcCe7Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yNVQxMjoxNjoxMlrOEcCm4A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjk3ODM2MjY5OnYy", "diffSide": "RIGHT", "path": "whois-commons/src/main/java/net/ripe/db/whois/common/WhoisAWSPropertyResolver.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yNVQxMjoxMDoyOFrOHGVEvg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yNVQxMjoxMDoyOFrOHGVEvg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NjM5ODc4Mg==", "bodyText": "Should be provided as a environment variable (hopefully automatically).", "url": "https://github.com/RIPE-NCC/whois/pull/653#discussion_r476398782", "createdAt": "2020-08-25T12:10:28Z", "author": {"login": "sbusk"}, "path": "whois-commons/src/main/java/net/ripe/db/whois/common/WhoisAWSPropertyResolver.java", "diffHunk": "@@ -0,0 +1,77 @@\n+package net.ripe.db.whois.common;\n+\n+import com.amazonaws.services.simplesystemsmanagement.AWSSimpleSystemsManagement;\n+import com.amazonaws.services.simplesystemsmanagement.AWSSimpleSystemsManagementClient;\n+import com.amazonaws.services.simplesystemsmanagement.model.GetParametersByPathRequest;\n+import com.amazonaws.services.simplesystemsmanagement.model.GetParametersByPathResult;\n+import com.amazonaws.services.simplesystemsmanagement.model.Parameter;\n+import net.ripe.db.whois.common.profiles.WhoisProfile;\n+import org.slf4j.Logger;\n+import org.slf4j.LoggerFactory;\n+import org.springframework.context.annotation.Bean;\n+import org.springframework.context.annotation.Configuration;\n+import org.springframework.context.annotation.Profile;\n+import org.springframework.context.annotation.PropertySource;\n+import org.springframework.context.support.PropertySourcesPlaceholderConfigurer;\n+\n+import java.util.HashMap;\n+import java.util.List;\n+import java.util.Map;\n+import java.util.Properties;\n+import java.util.stream.Collectors;\n+\n+@Configuration\n+@Profile(WhoisProfile.AWS_DEPLOYED)\n+@PropertySource(value = \"classpath:version.properties\", ignoreResourceNotFound = true)\n+public class WhoisAWSPropertyResolver {\n+\n+    private static final Logger LOGGER = LoggerFactory.getLogger(WhoisAWSPropertyResolver.class);\n+\n+    //TODO: get region to deploy from gitlab", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "4569499f1572b0df45462e745185bd8b24323e7b"}, "originalPosition": 30}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjk3ODM2NTgxOnYy", "diffSide": "RIGHT", "path": "whois-commons/src/main/java/net/ripe/db/whois/common/WhoisAWSPropertyResolver.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yNVQxMjoxMToyNlrOHGVGow==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yNVQxMjoxMzoyMlrOHGVKrg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NjM5OTI2Nw==", "bodyText": "If encryption is only ever true, why pass it as an argument?", "url": "https://github.com/RIPE-NCC/whois/pull/653#discussion_r476399267", "createdAt": "2020-08-25T12:11:26Z", "author": {"login": "sbusk"}, "path": "whois-commons/src/main/java/net/ripe/db/whois/common/WhoisAWSPropertyResolver.java", "diffHunk": "@@ -0,0 +1,77 @@\n+package net.ripe.db.whois.common;\n+\n+import com.amazonaws.services.simplesystemsmanagement.AWSSimpleSystemsManagement;\n+import com.amazonaws.services.simplesystemsmanagement.AWSSimpleSystemsManagementClient;\n+import com.amazonaws.services.simplesystemsmanagement.model.GetParametersByPathRequest;\n+import com.amazonaws.services.simplesystemsmanagement.model.GetParametersByPathResult;\n+import com.amazonaws.services.simplesystemsmanagement.model.Parameter;\n+import net.ripe.db.whois.common.profiles.WhoisProfile;\n+import org.slf4j.Logger;\n+import org.slf4j.LoggerFactory;\n+import org.springframework.context.annotation.Bean;\n+import org.springframework.context.annotation.Configuration;\n+import org.springframework.context.annotation.Profile;\n+import org.springframework.context.annotation.PropertySource;\n+import org.springframework.context.support.PropertySourcesPlaceholderConfigurer;\n+\n+import java.util.HashMap;\n+import java.util.List;\n+import java.util.Map;\n+import java.util.Properties;\n+import java.util.stream.Collectors;\n+\n+@Configuration\n+@Profile(WhoisProfile.AWS_DEPLOYED)\n+@PropertySource(value = \"classpath:version.properties\", ignoreResourceNotFound = true)\n+public class WhoisAWSPropertyResolver {\n+\n+    private static final Logger LOGGER = LoggerFactory.getLogger(WhoisAWSPropertyResolver.class);\n+\n+    //TODO: get region to deploy from gitlab\n+    private static final String REGION = \"eu-central-1\";\n+\n+    @Bean\n+    public static PropertySourcesPlaceholderConfigurer properties(){\n+        LOGGER.info(\"AWS profile : using ssm parameter store \");\n+\n+        Properties properties = new Properties();\n+        properties.putAll( getParametersByEnvAndApp(\"/whois/\", true));\n+\n+        PropertySourcesPlaceholderConfigurer propertySourceConfig = new PropertySourcesPlaceholderConfigurer();\n+        propertySourceConfig.setProperties(properties);\n+\n+        return propertySourceConfig;\n+    }\n+\n+    public static Map<String, Object> getParametersByEnvAndApp(final String path, final boolean encryption) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "4569499f1572b0df45462e745185bd8b24323e7b"}, "originalPosition": 46}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NjQwMDMwMg==", "bodyText": "ok, I will make it default true always, as it needs to decrypt the passwords", "url": "https://github.com/RIPE-NCC/whois/pull/653#discussion_r476400302", "createdAt": "2020-08-25T12:13:22Z", "author": {"login": "maggarwal13"}, "path": "whois-commons/src/main/java/net/ripe/db/whois/common/WhoisAWSPropertyResolver.java", "diffHunk": "@@ -0,0 +1,77 @@\n+package net.ripe.db.whois.common;\n+\n+import com.amazonaws.services.simplesystemsmanagement.AWSSimpleSystemsManagement;\n+import com.amazonaws.services.simplesystemsmanagement.AWSSimpleSystemsManagementClient;\n+import com.amazonaws.services.simplesystemsmanagement.model.GetParametersByPathRequest;\n+import com.amazonaws.services.simplesystemsmanagement.model.GetParametersByPathResult;\n+import com.amazonaws.services.simplesystemsmanagement.model.Parameter;\n+import net.ripe.db.whois.common.profiles.WhoisProfile;\n+import org.slf4j.Logger;\n+import org.slf4j.LoggerFactory;\n+import org.springframework.context.annotation.Bean;\n+import org.springframework.context.annotation.Configuration;\n+import org.springframework.context.annotation.Profile;\n+import org.springframework.context.annotation.PropertySource;\n+import org.springframework.context.support.PropertySourcesPlaceholderConfigurer;\n+\n+import java.util.HashMap;\n+import java.util.List;\n+import java.util.Map;\n+import java.util.Properties;\n+import java.util.stream.Collectors;\n+\n+@Configuration\n+@Profile(WhoisProfile.AWS_DEPLOYED)\n+@PropertySource(value = \"classpath:version.properties\", ignoreResourceNotFound = true)\n+public class WhoisAWSPropertyResolver {\n+\n+    private static final Logger LOGGER = LoggerFactory.getLogger(WhoisAWSPropertyResolver.class);\n+\n+    //TODO: get region to deploy from gitlab\n+    private static final String REGION = \"eu-central-1\";\n+\n+    @Bean\n+    public static PropertySourcesPlaceholderConfigurer properties(){\n+        LOGGER.info(\"AWS profile : using ssm parameter store \");\n+\n+        Properties properties = new Properties();\n+        properties.putAll( getParametersByEnvAndApp(\"/whois/\", true));\n+\n+        PropertySourcesPlaceholderConfigurer propertySourceConfig = new PropertySourcesPlaceholderConfigurer();\n+        propertySourceConfig.setProperties(properties);\n+\n+        return propertySourceConfig;\n+    }\n+\n+    public static Map<String, Object> getParametersByEnvAndApp(final String path, final boolean encryption) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NjM5OTI2Nw=="}, "originalCommit": {"oid": "4569499f1572b0df45462e745185bd8b24323e7b"}, "originalPosition": 46}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjk3ODM2ODI3OnYy", "diffSide": "RIGHT", "path": "whois-commons/src/main/java/net/ripe/db/whois/common/WhoisAWSPropertyResolver.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yNVQxMjoxMTo1NlrOHGVH8w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yNVQxMjoxMTo1NlrOHGVH8w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NjM5OTYwMw==", "bodyText": "Nitpicking here but .withPath(...) should be on next line.", "url": "https://github.com/RIPE-NCC/whois/pull/653#discussion_r476399603", "createdAt": "2020-08-25T12:11:56Z", "author": {"login": "sbusk"}, "path": "whois-commons/src/main/java/net/ripe/db/whois/common/WhoisAWSPropertyResolver.java", "diffHunk": "@@ -0,0 +1,77 @@\n+package net.ripe.db.whois.common;\n+\n+import com.amazonaws.services.simplesystemsmanagement.AWSSimpleSystemsManagement;\n+import com.amazonaws.services.simplesystemsmanagement.AWSSimpleSystemsManagementClient;\n+import com.amazonaws.services.simplesystemsmanagement.model.GetParametersByPathRequest;\n+import com.amazonaws.services.simplesystemsmanagement.model.GetParametersByPathResult;\n+import com.amazonaws.services.simplesystemsmanagement.model.Parameter;\n+import net.ripe.db.whois.common.profiles.WhoisProfile;\n+import org.slf4j.Logger;\n+import org.slf4j.LoggerFactory;\n+import org.springframework.context.annotation.Bean;\n+import org.springframework.context.annotation.Configuration;\n+import org.springframework.context.annotation.Profile;\n+import org.springframework.context.annotation.PropertySource;\n+import org.springframework.context.support.PropertySourcesPlaceholderConfigurer;\n+\n+import java.util.HashMap;\n+import java.util.List;\n+import java.util.Map;\n+import java.util.Properties;\n+import java.util.stream.Collectors;\n+\n+@Configuration\n+@Profile(WhoisProfile.AWS_DEPLOYED)\n+@PropertySource(value = \"classpath:version.properties\", ignoreResourceNotFound = true)\n+public class WhoisAWSPropertyResolver {\n+\n+    private static final Logger LOGGER = LoggerFactory.getLogger(WhoisAWSPropertyResolver.class);\n+\n+    //TODO: get region to deploy from gitlab\n+    private static final String REGION = \"eu-central-1\";\n+\n+    @Bean\n+    public static PropertySourcesPlaceholderConfigurer properties(){\n+        LOGGER.info(\"AWS profile : using ssm parameter store \");\n+\n+        Properties properties = new Properties();\n+        properties.putAll( getParametersByEnvAndApp(\"/whois/\", true));\n+\n+        PropertySourcesPlaceholderConfigurer propertySourceConfig = new PropertySourcesPlaceholderConfigurer();\n+        propertySourceConfig.setProperties(properties);\n+\n+        return propertySourceConfig;\n+    }\n+\n+    public static Map<String, Object> getParametersByEnvAndApp(final String path, final boolean encryption) {\n+        final AWSSimpleSystemsManagement awsSimpleSystemsManagement = AWSSimpleSystemsManagementClient.builder()\n+                .withRegion(REGION).build();\n+\n+        final GetParametersByPathRequest getParametersByPathRequest = new GetParametersByPathRequest().withPath(path)", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "4569499f1572b0df45462e745185bd8b24323e7b"}, "originalPosition": 50}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjk3ODM4MzA0OnYy", "diffSide": "RIGHT", "path": "whois-db/pom.xml", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yNVQxMjoxNjoxMlrOHGVQqA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yNVQxMjoxNjoxMlrOHGVQqA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NjQwMTgzMg==", "bodyText": "We'll put this in Terraform.", "url": "https://github.com/RIPE-NCC/whois/pull/653#discussion_r476401832", "createdAt": "2020-08-25T12:16:12Z", "author": {"login": "sbusk"}, "path": "whois-db/pom.xml", "diffHunk": "@@ -171,6 +171,8 @@\n                         <jvmFlags>\n                             <jvmFlag>-Dwhois.config=/export/services/whois/properties</jvmFlag>\n                             <jvmFlag>-Dlog4j.configurationFile=file:/export/services/whois/log4j2.xml</jvmFlag>\n+                            <!-- TODO: get profile from gitlab -->", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "4569499f1572b0df45462e745185bd8b24323e7b"}, "originalPosition": 4}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4662, "cost": 1, "resetAt": "2021-11-12T12:57:47Z"}}}