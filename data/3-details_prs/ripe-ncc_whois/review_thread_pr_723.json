{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTQxMTg0ODkw", "number": 723, "reviewThreads": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xOFQwOTozOTo1M1rOFHHAKg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xOFQwOTo0MDo0OVrOFHHBag==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzQyOTk5MDgyOnYy", "diffSide": "RIGHT", "path": "whois-update/src/main/java/net/ripe/db/whois/update/handler/SingleUpdateHandler.java", "isResolved": true, "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xOFQwOTozOTo1M1rOIIbw_Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xOFQwOTo1MToyMFrOIIcKeg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NTcxNDQyOQ==", "bodyText": "So the error message will contain the key as the user submitted it?", "url": "https://github.com/RIPE-NCC/whois/pull/723#discussion_r545714429", "createdAt": "2020-12-18T09:39:53Z", "author": {"login": "eshryane"}, "path": "whois-update/src/main/java/net/ripe/db/whois/update/handler/SingleUpdateHandler.java", "diffHunk": "@@ -102,7 +102,7 @@ public void handle(final Origin origin, final Keyword keyword, final Update upda\n         }\n \n         if (action == Action.DELETE && originalObject == null) {\n-            updateContext.addMessage(update, UpdateMessages.objectNotFound(updatedObject.getFormattedKey()));\n+            updateContext.addMessage(update, UpdateMessages.objectNotFound(update.getSubmittedObject().getFormattedKey()));", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "3d739d77b3cc72ec7856040f2aa429caf02674d3"}, "originalPosition": 5}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NTcxNzI4NA==", "bodyText": "Yes, like it was before.", "url": "https://github.com/RIPE-NCC/whois/pull/723#discussion_r545717284", "createdAt": "2020-12-18T09:44:58Z", "author": {"login": "maggarwal13"}, "path": "whois-update/src/main/java/net/ripe/db/whois/update/handler/SingleUpdateHandler.java", "diffHunk": "@@ -102,7 +102,7 @@ public void handle(final Origin origin, final Keyword keyword, final Update upda\n         }\n \n         if (action == Action.DELETE && originalObject == null) {\n-            updateContext.addMessage(update, UpdateMessages.objectNotFound(updatedObject.getFormattedKey()));\n+            updateContext.addMessage(update, UpdateMessages.objectNotFound(update.getSubmittedObject().getFormattedKey()));", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NTcxNDQyOQ=="}, "originalCommit": {"oid": "3d739d77b3cc72ec7856040f2aa429caf02674d3"}, "originalPosition": 5}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NTcyMDk1NA==", "bodyText": "Great, thanks", "url": "https://github.com/RIPE-NCC/whois/pull/723#discussion_r545720954", "createdAt": "2020-12-18T09:51:20Z", "author": {"login": "eshryane"}, "path": "whois-update/src/main/java/net/ripe/db/whois/update/handler/SingleUpdateHandler.java", "diffHunk": "@@ -102,7 +102,7 @@ public void handle(final Origin origin, final Keyword keyword, final Update upda\n         }\n \n         if (action == Action.DELETE && originalObject == null) {\n-            updateContext.addMessage(update, UpdateMessages.objectNotFound(updatedObject.getFormattedKey()));\n+            updateContext.addMessage(update, UpdateMessages.objectNotFound(update.getSubmittedObject().getFormattedKey()));", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NTcxNDQyOQ=="}, "originalCommit": {"oid": "3d739d77b3cc72ec7856040f2aa429caf02674d3"}, "originalPosition": 5}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzQyOTk5NDAyOnYy", "diffSide": "RIGHT", "path": "whois-api/src/test/java/net/ripe/db/whois/api/rest/WhoisRestServiceTestIntegration.java", "isResolved": true, "comments": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xOFQwOTo0MDo0OVrOIIby2A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xOFQwOTo1NDoyNFrOIIcRrw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NTcxNDkwNA==", "bodyText": "Do you need to test the primary key in the test? It seems superfluous", "url": "https://github.com/RIPE-NCC/whois/pull/723#discussion_r545714904", "createdAt": "2020-12-18T09:40:49Z", "author": {"login": "eshryane"}, "path": "whois-api/src/test/java/net/ripe/db/whois/api/rest/WhoisRestServiceTestIntegration.java", "diffHunk": "@@ -4707,6 +4707,33 @@ public void delete_route_out_of_region_redirect() {\n         databaseHelper.addAuthoritativeResource(\"test\", \"0.0.0.0/0\");\n     }\n \n+    @Test\n+    public void delete_domain_trailing_dot_nserver() {\n+        databaseHelper.addObject(\n+                \"domain:        193.in-addr.arpa4\\n\" +\n+                        \"nserver:         test.ns.\\n\" +\n+                        \"mnt-by:          OWNER-MNT\\n\" +\n+                        \"source:          TEST\\n\");\n+\n+        final WhoisResources whoisResources = RestTest.target(getPort(), \"whois/test/domain/193.in-addr.arpa4\")\n+                .request()\n+                .get(WhoisResources.class);\n+        assertThat(whoisResources.getWhoisObjects().get(0).getPrimaryKey().get(0).getValue(), is(\"193.in-addr.arpa4\"));", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "3d739d77b3cc72ec7856040f2aa429caf02674d3"}, "originalPosition": 15}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NTcxODA1Mw==", "bodyText": "Its just a way to test that before delete key exists and after it does not. I can remove that if you prefer that", "url": "https://github.com/RIPE-NCC/whois/pull/723#discussion_r545718053", "createdAt": "2020-12-18T09:46:14Z", "author": {"login": "maggarwal13"}, "path": "whois-api/src/test/java/net/ripe/db/whois/api/rest/WhoisRestServiceTestIntegration.java", "diffHunk": "@@ -4707,6 +4707,33 @@ public void delete_route_out_of_region_redirect() {\n         databaseHelper.addAuthoritativeResource(\"test\", \"0.0.0.0/0\");\n     }\n \n+    @Test\n+    public void delete_domain_trailing_dot_nserver() {\n+        databaseHelper.addObject(\n+                \"domain:        193.in-addr.arpa4\\n\" +\n+                        \"nserver:         test.ns.\\n\" +\n+                        \"mnt-by:          OWNER-MNT\\n\" +\n+                        \"source:          TEST\\n\");\n+\n+        final WhoisResources whoisResources = RestTest.target(getPort(), \"whois/test/domain/193.in-addr.arpa4\")\n+                .request()\n+                .get(WhoisResources.class);\n+        assertThat(whoisResources.getWhoisObjects().get(0).getPrimaryKey().get(0).getValue(), is(\"193.in-addr.arpa4\"));", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NTcxNDkwNA=="}, "originalCommit": {"oid": "3d739d77b3cc72ec7856040f2aa429caf02674d3"}, "originalPosition": 15}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NTcyMDg0NQ==", "bodyText": "I don't think it's needed, and can be safely removed", "url": "https://github.com/RIPE-NCC/whois/pull/723#discussion_r545720845", "createdAt": "2020-12-18T09:51:08Z", "author": {"login": "eshryane"}, "path": "whois-api/src/test/java/net/ripe/db/whois/api/rest/WhoisRestServiceTestIntegration.java", "diffHunk": "@@ -4707,6 +4707,33 @@ public void delete_route_out_of_region_redirect() {\n         databaseHelper.addAuthoritativeResource(\"test\", \"0.0.0.0/0\");\n     }\n \n+    @Test\n+    public void delete_domain_trailing_dot_nserver() {\n+        databaseHelper.addObject(\n+                \"domain:        193.in-addr.arpa4\\n\" +\n+                        \"nserver:         test.ns.\\n\" +\n+                        \"mnt-by:          OWNER-MNT\\n\" +\n+                        \"source:          TEST\\n\");\n+\n+        final WhoisResources whoisResources = RestTest.target(getPort(), \"whois/test/domain/193.in-addr.arpa4\")\n+                .request()\n+                .get(WhoisResources.class);\n+        assertThat(whoisResources.getWhoisObjects().get(0).getPrimaryKey().get(0).getValue(), is(\"193.in-addr.arpa4\"));", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NTcxNDkwNA=="}, "originalCommit": {"oid": "3d739d77b3cc72ec7856040f2aa429caf02674d3"}, "originalPosition": 15}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NTcyMjc5OQ==", "bodyText": "Done", "url": "https://github.com/RIPE-NCC/whois/pull/723#discussion_r545722799", "createdAt": "2020-12-18T09:54:24Z", "author": {"login": "maggarwal13"}, "path": "whois-api/src/test/java/net/ripe/db/whois/api/rest/WhoisRestServiceTestIntegration.java", "diffHunk": "@@ -4707,6 +4707,33 @@ public void delete_route_out_of_region_redirect() {\n         databaseHelper.addAuthoritativeResource(\"test\", \"0.0.0.0/0\");\n     }\n \n+    @Test\n+    public void delete_domain_trailing_dot_nserver() {\n+        databaseHelper.addObject(\n+                \"domain:        193.in-addr.arpa4\\n\" +\n+                        \"nserver:         test.ns.\\n\" +\n+                        \"mnt-by:          OWNER-MNT\\n\" +\n+                        \"source:          TEST\\n\");\n+\n+        final WhoisResources whoisResources = RestTest.target(getPort(), \"whois/test/domain/193.in-addr.arpa4\")\n+                .request()\n+                .get(WhoisResources.class);\n+        assertThat(whoisResources.getWhoisObjects().get(0).getPrimaryKey().get(0).getValue(), is(\"193.in-addr.arpa4\"));", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NTcxNDkwNA=="}, "originalCommit": {"oid": "3d739d77b3cc72ec7856040f2aa429caf02674d3"}, "originalPosition": 15}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4620, "cost": 1, "resetAt": "2021-11-12T12:57:47Z"}}}