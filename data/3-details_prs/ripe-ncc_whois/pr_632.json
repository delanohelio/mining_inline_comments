{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDE5NDkzOTkx", "number": 632, "title": "Rdap query limit", "bodyText": "", "createdAt": "2020-05-18T13:15:15Z", "url": "https://github.com/RIPE-NCC/whois/pull/632", "merged": true, "mergeCommit": {"oid": "a36039a6f4b10063559e6474c04edc058dcf9e0c"}, "closed": true, "closedAt": "2020-05-29T08:13:14Z", "author": {"login": "maggarwal13"}, "timelineItems": {"totalCount": 12, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABchivBdgH2gAyNDE5NDkzOTkxOmE2YWVmNDNmODAxMDJlNjE1OTdjMTY0ZDBmMzg2YWM3ODI2MjQxNzc=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcl98FXgFqTQyMDc0MDk1Mg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "a6aef43f80102e61597c164d0f386ac782624177", "author": {"user": {"login": "maggarwal13", "name": null}}, "url": "https://github.com/RIPE-NCC/whois/commit/a6aef43f80102e61597c164d0f386ac782624177", "committedDate": "2020-05-15T14:13:43Z", "message": "rdap limit query result"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "3cea3f0e35a939ba7e1c46bfbe9ef4af9aebd49d", "author": {"user": {"login": "maggarwal13", "name": null}}, "url": "https://github.com/RIPE-NCC/whois/commit/3cea3f0e35a939ba7e1c46bfbe9ef4af9aebd49d", "committedDate": "2020-05-18T11:51:58Z", "message": "add test cases and notice banner for rdap"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDEzNjYwODYz", "url": "https://github.com/RIPE-NCC/whois/pull/632#pullrequestreview-413660863", "createdAt": "2020-05-18T14:41:33Z", "commit": {"oid": "3cea3f0e35a939ba7e1c46bfbe9ef4af9aebd49d"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xOFQxNDo0MTozM1rOGW6S2w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xOFQxNDo0MTozM1rOGW6S2w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNjY3Njk1NQ==", "bodyText": "Typo performace -> performance", "url": "https://github.com/RIPE-NCC/whois/pull/632#discussion_r426676955", "createdAt": "2020-05-18T14:41:33Z", "author": {"login": "sbusk"}, "path": "whois-api/src/main/java/net/ripe/db/whois/api/rdap/RdapObjectMapper.java", "diffHunk": "@@ -138,6 +137,14 @@ public Object mapSearch(final String requestUrl, final List<RpslObject> objects,\n             }\n         }\n \n+        if(objects.size() == maxResultSize) {\n+            final Notice notice = new Notice();\n+            notice.setTitle(\"Search result cap to \" + maxResultSize);\n+            notice.getDescription().add(\"Due to performace issue, we have capped the maximum search result to \" + maxResultSize);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "3cea3f0e35a939ba7e1c46bfbe9ef4af9aebd49d"}, "originalPosition": 23}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDEzNjY0Mzc3", "url": "https://github.com/RIPE-NCC/whois/pull/632#pullrequestreview-413664377", "createdAt": "2020-05-18T14:45:25Z", "commit": {"oid": "3cea3f0e35a939ba7e1c46bfbe9ef4af9aebd49d"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "46a93297dfa6b2d5ba001eec9aa3d67260a765aa", "author": {"user": {"login": "maggarwal13", "name": null}}, "url": "https://github.com/RIPE-NCC/whois/commit/46a93297dfa6b2d5ba001eec9aa3d67260a765aa", "committedDate": "2020-05-18T15:39:58Z", "message": "correct typo mistake"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f47c8fb4d2ed05ffe47d964ea80bd0ed4960d8b2", "author": {"user": {"login": "maggarwal13", "name": null}}, "url": "https://github.com/RIPE-NCC/whois/commit/f47c8fb4d2ed05ffe47d964ea80bd0ed4960d8b2", "committedDate": "2020-05-19T11:21:36Z", "message": "fulltext search limit 100"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "4f8e0f0f64ad6831fb190dcfe140cbde462083e4", "author": {"user": {"login": "maggarwal13", "name": null}}, "url": "https://github.com/RIPE-NCC/whois/commit/4f8e0f0f64ad6831fb190dcfe140cbde462083e4", "committedDate": "2020-05-19T14:17:13Z", "message": "add test"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "217f9d802d14678817ce490fcc39663310fe1b6a", "author": {"user": {"login": "maggarwal13", "name": null}}, "url": "https://github.com/RIPE-NCC/whois/commit/217f9d802d14678817ce490fcc39663310fe1b6a", "committedDate": "2020-05-19T14:17:57Z", "message": "Merge branch 'fulltext_limit_rows' into rdap_query_limit"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDE3ODUyMDE4", "url": "https://github.com/RIPE-NCC/whois/pull/632#pullrequestreview-417852018", "createdAt": "2020-05-25T19:23:23Z", "commit": {"oid": "217f9d802d14678817ce490fcc39663310fe1b6a"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yNVQxOToyMzoyM1rOGaIYnA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yNVQxOToyNjo1OVrOGaIbqw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMDA1MzUzMg==", "bodyText": "Is it possible that objects.size() can be larger than maxResultSize ?", "url": "https://github.com/RIPE-NCC/whois/pull/632#discussion_r430053532", "createdAt": "2020-05-25T19:23:23Z", "author": {"login": "eshryane"}, "path": "whois-api/src/main/java/net/ripe/db/whois/api/rdap/RdapObjectMapper.java", "diffHunk": "@@ -138,6 +137,14 @@ public Object mapSearch(final String requestUrl, final List<RpslObject> objects,\n             }\n         }\n \n+        if(objects.size() == maxResultSize) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "217f9d802d14678817ce490fcc39663310fe1b6a"}, "originalPosition": 20}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMDA1Mzk0MA==", "bodyText": "I suggest simplifying the text as 'limited search results to ... maximum' (s/capped/limited/g) and no need for details in the description.", "url": "https://github.com/RIPE-NCC/whois/pull/632#discussion_r430053940", "createdAt": "2020-05-25T19:25:04Z", "author": {"login": "eshryane"}, "path": "whois-api/src/main/java/net/ripe/db/whois/api/rdap/RdapObjectMapper.java", "diffHunk": "@@ -138,6 +137,14 @@ public Object mapSearch(final String requestUrl, final List<RpslObject> objects,\n             }\n         }\n \n+        if(objects.size() == maxResultSize) {\n+            final Notice notice = new Notice();\n+            notice.setTitle(\"Search result cap to \" + maxResultSize);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "217f9d802d14678817ce490fcc39663310fe1b6a"}, "originalPosition": 22}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMDA1NDEzMA==", "bodyText": "Prefix with 'sort consistently ... for predictable search results'", "url": "https://github.com/RIPE-NCC/whois/pull/632#discussion_r430054130", "createdAt": "2020-05-25T19:26:00Z", "author": {"login": "eshryane"}, "path": "whois-api/src/main/java/net/ripe/db/whois/api/rdap/WhoisRdapService.java", "diffHunk": "@@ -73,7 +77,11 @@\n     private static final String CONTENT_TYPE_RDAP_JSON = \"application/rdap+json\";\n     private static final Joiner COMMA_JOINER = Joiner.on(\",\");\n \n-    private static final int SEARCH_MAX_RESULTS = 100;\n+    //necessary for predictable search results", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "217f9d802d14678817ce490fcc39663310fe1b6a"}, "originalPosition": 30}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMDA1NDMxNQ==", "bodyText": "Change your IDE settings to not use asterisk for importing packages (it's harder to see what's imported, and what changes)", "url": "https://github.com/RIPE-NCC/whois/pull/632#discussion_r430054315", "createdAt": "2020-05-25T19:26:59Z", "author": {"login": "eshryane"}, "path": "whois-api/src/test/java/net/ripe/db/whois/api/rdap/WhoisRdapQueryLimitTestIntegration.java", "diffHunk": "@@ -0,0 +1,261 @@\n+package net.ripe.db.whois.api.rdap;\n+\n+import com.google.common.collect.Lists;\n+import com.google.common.net.HttpHeaders;\n+import net.ripe.db.whois.api.fulltextsearch.FullTextIndex;\n+import net.ripe.db.whois.api.rdap.domain.Action;\n+import net.ripe.db.whois.api.rdap.domain.Autnum;\n+import net.ripe.db.whois.api.rdap.domain.Domain;\n+import net.ripe.db.whois.api.rdap.domain.Entity;\n+import net.ripe.db.whois.api.rdap.domain.Event;\n+import net.ripe.db.whois.api.rdap.domain.Ip;\n+import net.ripe.db.whois.api.rdap.domain.Link;\n+import net.ripe.db.whois.api.rdap.domain.Nameserver;\n+import net.ripe.db.whois.api.rdap.domain.Notice;\n+import net.ripe.db.whois.api.rdap.domain.RdapObject;\n+import net.ripe.db.whois.api.rdap.domain.Remark;\n+import net.ripe.db.whois.api.rdap.domain.Role;\n+import net.ripe.db.whois.api.rdap.domain.SearchResult;\n+import net.ripe.db.whois.common.IntegrationTest;\n+import net.ripe.db.whois.query.support.TestWhoisLog;\n+import org.hamcrest.Matchers;\n+import org.junit.Before;\n+import org.junit.BeforeClass;\n+import org.junit.Test;\n+import org.junit.experimental.categories.Category;\n+import org.springframework.beans.factory.annotation.Autowired;\n+import org.springframework.test.annotation.DirtiesContext;\n+\n+import javax.ws.rs.BadRequestException;\n+import javax.ws.rs.HttpMethod;\n+import javax.ws.rs.NotFoundException;\n+import javax.ws.rs.core.MediaType;\n+import javax.ws.rs.core.Response;\n+import java.time.LocalDateTime;\n+import java.util.Collection;\n+import java.util.Collections;\n+import java.util.List;\n+import java.util.stream.Collectors;\n+\n+import static org.hamcrest.Matchers.*;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "217f9d802d14678817ce490fcc39663310fe1b6a"}, "originalPosition": 40}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "7bb5f0d8ca92fc9ede0ef8e5281c5a54268a798b", "author": {"user": {"login": "maggarwal13", "name": null}}, "url": "https://github.com/RIPE-NCC/whois/commit/7bb5f0d8ca92fc9ede0ef8e5281c5a54268a798b", "committedDate": "2020-05-26T08:14:58Z", "message": "implement Ed suggestions"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "13f9f1e2e61d3bb35c39e983c7ba859379c34fb4", "author": {"user": {"login": "maggarwal13", "name": null}}, "url": "https://github.com/RIPE-NCC/whois/commit/13f9f1e2e61d3bb35c39e983c7ba859379c34fb4", "committedDate": "2020-05-26T08:20:46Z", "message": "change comment text"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDIwNzQwOTUy", "url": "https://github.com/RIPE-NCC/whois/pull/632#pullrequestreview-420740952", "createdAt": "2020-05-29T08:11:07Z", "commit": {"oid": "13f9f1e2e61d3bb35c39e983c7ba859379c34fb4"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 756, "cost": 1, "resetAt": "2021-11-01T16:37:27Z"}}}