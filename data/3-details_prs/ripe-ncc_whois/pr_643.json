{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDQ1MjI2ODM1", "number": 643, "title": "NWI-11 Punycode Internationalized Domain Names in email addresses.", "bodyText": "This is the NWI-11 Implementation, which automatically converts international (i.e. IDN or non-ASCII) domain names in email addresses into Punycode (since the RIPE database uses Latin-1).\nProblem Definition:\nhttps://www.ripe.net/ripe/mail/archives/db-wg/2020-June/006524.html\nSolution Definition:\nhttps://www.ripe.net/ripe/mail/archives/db-wg/2020-June/006525.html\nImplementation Plan:\nhttps://www.ripe.net/ripe/mail/archives/db-wg/2020-July/006595.html", "createdAt": "2020-07-07T07:53:03Z", "url": "https://github.com/RIPE-NCC/whois/pull/643", "merged": true, "mergeCommit": {"oid": "8c7cf0cbf547e30deada8238468f7e5671958b29"}, "closed": true, "closedAt": "2020-09-16T13:01:03Z", "author": {"login": "sbusk"}, "timelineItems": {"totalCount": 21, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcyhCqKAH2gAyNDQ1MjI2ODM1OmM4OWZjNzI3MTExNGNiYTZkYWVmOTUyOGU2NmU0NjIwYjAwNmY4Y2Y=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdJbP_BgH2gAyNDQ1MjI2ODM1OjY0NjA1NTc3NmE4ODFkZjNkM2IzZDczZjA3YWI5Zjg4YzljZDcxZGI=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "c89fc7271114cba6daef9528e66e4620b006f8cf", "author": {"user": {"login": "sbusk", "name": null}}, "url": "https://github.com/RIPE-NCC/whois/commit/c89fc7271114cba6daef9528e66e4620b006f8cf", "committedDate": "2020-07-07T07:52:04Z", "message": "Punycode Internationalized Domain Names in email addresses."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "6cb8537e83a56e70c6c5cf574add6a758cbe6085", "author": {"user": {"login": "sbusk", "name": null}}, "url": "https://github.com/RIPE-NCC/whois/commit/6cb8537e83a56e70c6c5cf574add6a758cbe6085", "committedDate": "2020-07-07T07:54:36Z", "message": "Fix test code."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDQ0MjE2ODU3", "url": "https://github.com/RIPE-NCC/whois/pull/643#pullrequestreview-444216857", "createdAt": "2020-07-07T20:14:47Z", "commit": {"oid": "6cb8537e83a56e70c6c5cf574add6a758cbe6085"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wN1QyMDoxNDo0OFrOGuN_nQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wN1QyMDoxNDo0OFrOGuN_nQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MTExNjk1Nw==", "bodyText": "Need an additional test to confirm local-part with a non-ASCII value is not converted to Punycode but is rejected with a syntax error.", "url": "https://github.com/RIPE-NCC/whois/pull/643#discussion_r451116957", "createdAt": "2020-07-07T20:14:48Z", "author": {"login": "eshryane"}, "path": "whois-endtoend/src/test/groovy/net/ripe/db/whois/spec/update/RoleSpec.groovy", "diffHunk": "@@ -671,6 +671,43 @@ class RoleSpec extends BaseQueryUpdateSpec {\n         query_object_not_matches(\"-rBT role FR1-TEST\", \"role\", \"First Role\", \"tech-c:\")\n     }\n \n+    def \"punycode abuse-mailbox with IDN\"() {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "6cb8537e83a56e70c6c5cf574add6a758cbe6085"}, "originalPosition": 4}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "441118bd372c281d6d999b8d26841905a410eba0", "author": {"user": {"login": "sbusk", "name": null}}, "url": "https://github.com/RIPE-NCC/whois/commit/441118bd372c281d6d999b8d26841905a410eba0", "committedDate": "2020-07-08T11:54:43Z", "message": "Added unit tests for punycoding of email addresses."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "0a0d32ff6a809513a2a4688beeac420cb7169337", "author": {"user": {"login": "eshryane", "name": "Ed Shryane"}}, "url": "https://github.com/RIPE-NCC/whois/commit/0a0d32ff6a809513a2a4688beeac420cb7169337", "committedDate": "2020-07-13T14:21:17Z", "message": "Allow gzip or deflate compression in RSNG response. Tested response size is reduced from 19MB to 3.8MB without affecting response time."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "3f95dd6f3fa04cec649820b124240684a7faa1fe", "author": {"user": {"login": "eshryane", "name": "Ed Shryane"}}, "url": "https://github.com/RIPE-NCC/whois/commit/3f95dd6f3fa04cec649820b124240684a7faa1fe", "committedDate": "2020-07-13T14:21:17Z", "message": "An object may be deleted from the RIPE database and a full text search matches it before its been removed from the index. (#644)\n\nHandle this by catching the DB exception, and decrementing the result size (i.e. skip the non-existant match)."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "fcfb6e4da7dbae2909cf3bfdf6aebf661575b181", "author": {"user": {"login": "eshryane", "name": "Ed Shryane"}}, "url": "https://github.com/RIPE-NCC/whois/commit/fcfb6e4da7dbae2909cf3bfdf6aebf661575b181", "committedDate": "2020-07-13T14:21:17Z", "message": "An object may be deleted from the RIPE database and an RDAP search matches it before its been removed from the full text search index. (#645)\n\nHandle this by catching the DB exception, and continuing (i.e. skip the non-existant match)."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "eabfa768b6ee08abe46d63213cc4b7e108bbbc40", "author": {"user": {"login": "eshryane", "name": "Ed Shryane"}}, "url": "https://github.com/RIPE-NCC/whois/commit/eabfa768b6ee08abe46d63213cc4b7e108bbbc40", "committedDate": "2020-07-13T14:21:20Z", "message": "Merge branch 'master' into punycode"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "053a58c6299a507c7bfd7e2df0096fd65b1bbdaa", "author": {"user": {"login": "eshryane", "name": "Ed Shryane"}}, "url": "https://github.com/RIPE-NCC/whois/commit/053a58c6299a507c7bfd7e2df0096fd65b1bbdaa", "committedDate": "2020-07-14T06:51:19Z", "message": "Non-latin1 characters are substituted and not converted to Punycode properly."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "076d122aaa9665708655a23336940c3266826b1f", "author": {"user": {"login": "eshryane", "name": "Ed Shryane"}}, "url": "https://github.com/RIPE-NCC/whois/commit/076d122aaa9665708655a23336940c3266826b1f", "committedDate": "2020-07-14T06:58:06Z", "message": "Added integration test"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f915b21442a234e971ea99819cdd959c282ed992", "author": {"user": {"login": "sbusk", "name": null}}, "url": "https://github.com/RIPE-NCC/whois/commit/f915b21442a234e971ea99819cdd959c282ed992", "committedDate": "2020-07-14T07:25:00Z", "message": "Only accept US ASCII characters for email address local part."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "cff57f3619555d8473d9e47efefff224d0ae8dff", "author": {"user": {"login": "eshryane", "name": "Ed Shryane"}}, "url": "https://github.com/RIPE-NCC/whois/commit/cff57f3619555d8473d9e47efefff224d0ae8dff", "committedDate": "2020-09-08T12:40:46Z", "message": "Merge branch 'master' into punycode"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "503155ad3eb95d146cef0f10b994f0aeba980ef6", "author": {"user": {"login": "eshryane", "name": "Ed Shryane"}}, "url": "https://github.com/RIPE-NCC/whois/commit/503155ad3eb95d146cef0f10b994f0aeba980ef6", "committedDate": "2020-09-16T07:54:51Z", "message": "Perform Punycode conversion on the paragraph and not on the RPSL object (i.e. before the content has been converted to latin-1)"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "8a83891bc9e6e3aaf6d826221694af39dd5dd83f", "author": {"user": {"login": "eshryane", "name": "Ed Shryane"}}, "url": "https://github.com/RIPE-NCC/whois/commit/8a83891bc9e6e3aaf6d826221694af39dd5dd83f", "committedDate": "2020-09-16T08:23:22Z", "message": "Improved logging on failure"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "49c2733bc6b5643aa8d201dd9712fea9cca2b717", "author": {"user": {"login": "eshryane", "name": "Ed Shryane"}}, "url": "https://github.com/RIPE-NCC/whois/commit/49c2733bc6b5643aa8d201dd9712fea9cca2b717", "committedDate": "2020-09-16T08:37:07Z", "message": "Added tests"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "6070682d45a8caa5877fe71ac8ebcda2e3944482", "author": {"user": {"login": "eshryane", "name": "Ed Shryane"}}, "url": "https://github.com/RIPE-NCC/whois/commit/6070682d45a8caa5877fe71ac8ebcda2e3944482", "committedDate": "2020-09-16T10:05:32Z", "message": "Allow charset to be specified in Syncupdates request"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "9969a2e19441c5fd7a0377c64145e0f564281b3e", "author": {"user": {"login": "eshryane", "name": "Ed Shryane"}}, "url": "https://github.com/RIPE-NCC/whois/commit/9969a2e19441c5fd7a0377c64145e0f564281b3e", "committedDate": "2020-09-16T10:07:13Z", "message": "Updated tests"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDg5NTExOTI0", "url": "https://github.com/RIPE-NCC/whois/pull/643#pullrequestreview-489511924", "createdAt": "2020-09-16T11:02:04Z", "commit": {"oid": "9969a2e19441c5fd7a0377c64145e0f564281b3e"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xNlQxMTowMjowNFrOHSrnWA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xNlQxMTowMjowNFrOHSrnWA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4OTM1MTAwMA==", "bodyText": "Minor: Maybe consider using StandardCharsets.ISO_8859_1 instead of hardcoded string", "url": "https://github.com/RIPE-NCC/whois/pull/643#discussion_r489351000", "createdAt": "2020-09-16T11:02:04Z", "author": {"login": "dadepo"}, "path": "whois-client/src/main/java/net/ripe/db/whois/api/syncupdate/SyncUpdateBuilder.java", "diffHunk": "@@ -83,23 +84,20 @@ public SyncUpdateBuilder setRedirect(final boolean redirect) {\n         return this;\n     }\n \n-    public Client build() {\n-        if (url != null) {\n-            return new Client(url, headers, data, help, diff, aNew, redirect);\n-        }\n-\n-        if (host != null && port != null && source != null) {\n-            return new Client(host, port, source, headers, data, help, diff, aNew, redirect);\n-        }\n+    public SyncUpdateBuilder setCharset(final String charset) {\n+        this.charset = charset;\n+        return this;\n+    }\n \n-        throw new IllegalStateException(\"Either (host, port, source) or (url) should not be null\");\n+    public Client build() {\n+        return new Client(url, host, port, source, headers, data, help, diff, aNew, redirect, charset);\n     }\n \n     public static class Client {\n \n         private static final Joiner.MapJoiner PARAM_JOINER = Joiner.on('&').withKeyValueSeparator(\"=\");\n         private static final Pattern CHARSET_PATTERN = Pattern.compile(\".*;charset=(.*)\");\n-        private static final String CHARSET = \"ISO-8859-1\";\n+        private static final String DEFAULT_CHARSET = \"ISO-8859-1\";", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "9969a2e19441c5fd7a0377c64145e0f564281b3e"}, "originalPosition": 35}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDg5NTE4NTk2", "url": "https://github.com/RIPE-NCC/whois/pull/643#pullrequestreview-489518596", "createdAt": "2020-09-16T11:12:29Z", "commit": {"oid": "9969a2e19441c5fd7a0377c64145e0f564281b3e"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "bcdbb7865c39b55c34d8f30a2d02219616b59771", "author": {"user": {"login": "eshryane", "name": "Ed Shryane"}}, "url": "https://github.com/RIPE-NCC/whois/commit/bcdbb7865c39b55c34d8f30a2d02219616b59771", "committedDate": "2020-09-16T11:53:34Z", "message": "Use constant for charset rather than hard-coded String."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "646055776a881df3d3b3d73f07ab9f88c9cd71db", "author": {"user": {"login": "eshryane", "name": "Ed Shryane"}}, "url": "https://github.com/RIPE-NCC/whois/commit/646055776a881df3d3b3d73f07ab9f88c9cd71db", "committedDate": "2020-09-16T12:07:27Z", "message": "Test punycode abuse-mailbox but object is syntactically incorrect"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 775, "cost": 1, "resetAt": "2021-11-01T16:37:27Z"}}}