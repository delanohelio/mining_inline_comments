{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDI0MzQwMTE3", "number": 635, "reviewThreads": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yOVQwNzozNzoxMFrOEAyXSg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yOVQwNzozODo0MlrOEAyZGQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjY5MjYwNjE4OnYy", "diffSide": "RIGHT", "path": "whois-commons/src/main/java/net/ripe/db/whois/common/dao/jdbc/JdbcManagedAttributeDao.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yOVQwNzozNzoxMFrOGcR-Ag==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wOFQwOTozMjoxNFrOGgWEuw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMjMwNzcxNA==", "bodyText": "Uppercase SQL keywords for readibility (and consistency)", "url": "https://github.com/RIPE-NCC/whois/pull/635#discussion_r432307714", "createdAt": "2020-05-29T07:37:10Z", "author": {"login": "eshryane"}, "path": "whois-commons/src/main/java/net/ripe/db/whois/common/dao/jdbc/JdbcManagedAttributeDao.java", "diffHunk": "@@ -0,0 +1,69 @@\n+package net.ripe.db.whois.common.dao.jdbc;\n+\n+import net.ripe.db.whois.common.aspects.RetryFor;\n+import net.ripe.db.whois.common.dao.jdbc.domain.ObjectTypeIds;\n+import net.ripe.db.whois.common.domain.CIString;\n+import net.ripe.db.whois.common.domain.Maintainers;\n+import net.ripe.db.whois.common.rpsl.AttributeType;\n+import net.ripe.db.whois.common.rpsl.ObjectType;\n+import net.ripe.db.whois.common.rpsl.RpslObject;\n+import org.springframework.beans.factory.annotation.Autowired;\n+import org.springframework.beans.factory.annotation.Qualifier;\n+import org.springframework.dao.RecoverableDataAccessException;\n+import org.springframework.jdbc.core.JdbcTemplate;\n+import org.springframework.stereotype.Repository;\n+\n+import javax.sql.DataSource;\n+\n+import static net.ripe.db.whois.common.dao.jdbc.JdbcStreamingHelper.executeStreaming;\n+\n+@Repository\n+@RetryFor(RecoverableDataAccessException.class)\n+public class JdbcManagedAttributeDao {\n+\n+    private final JdbcTemplate jdbcTemplate;\n+    private final Maintainers maintainers;\n+\n+    @Autowired\n+    public JdbcManagedAttributeDao(@Qualifier(\"whoisSlaveDataSource\") final DataSource dataSource,\n+                                   final Maintainers maintainers) {\n+        this.jdbcTemplate = new JdbcTemplate(dataSource);\n+        this.maintainers = maintainers;\n+    }\n+\n+    public boolean hasManagedResource(final CIString orgId) {\n+        final int orgObjectId = jdbcTemplate.queryForObject(\n+            \"select object_id from organisation where organisation = ?\",\n+                new Object[] { orgId },\n+                Integer.class\n+        );\n+\n+        return executeStreaming(\n+                jdbcTemplate,\n+                \"select l.object \" +", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "2142bc2f24febbafe6f865fa293d8033bea87b12"}, "originalPosition": 43}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNjU2OTI3NQ==", "bodyText": "Ok.", "url": "https://github.com/RIPE-NCC/whois/pull/635#discussion_r436569275", "createdAt": "2020-06-08T09:32:14Z", "author": {"login": "sbusk"}, "path": "whois-commons/src/main/java/net/ripe/db/whois/common/dao/jdbc/JdbcManagedAttributeDao.java", "diffHunk": "@@ -0,0 +1,69 @@\n+package net.ripe.db.whois.common.dao.jdbc;\n+\n+import net.ripe.db.whois.common.aspects.RetryFor;\n+import net.ripe.db.whois.common.dao.jdbc.domain.ObjectTypeIds;\n+import net.ripe.db.whois.common.domain.CIString;\n+import net.ripe.db.whois.common.domain.Maintainers;\n+import net.ripe.db.whois.common.rpsl.AttributeType;\n+import net.ripe.db.whois.common.rpsl.ObjectType;\n+import net.ripe.db.whois.common.rpsl.RpslObject;\n+import org.springframework.beans.factory.annotation.Autowired;\n+import org.springframework.beans.factory.annotation.Qualifier;\n+import org.springframework.dao.RecoverableDataAccessException;\n+import org.springframework.jdbc.core.JdbcTemplate;\n+import org.springframework.stereotype.Repository;\n+\n+import javax.sql.DataSource;\n+\n+import static net.ripe.db.whois.common.dao.jdbc.JdbcStreamingHelper.executeStreaming;\n+\n+@Repository\n+@RetryFor(RecoverableDataAccessException.class)\n+public class JdbcManagedAttributeDao {\n+\n+    private final JdbcTemplate jdbcTemplate;\n+    private final Maintainers maintainers;\n+\n+    @Autowired\n+    public JdbcManagedAttributeDao(@Qualifier(\"whoisSlaveDataSource\") final DataSource dataSource,\n+                                   final Maintainers maintainers) {\n+        this.jdbcTemplate = new JdbcTemplate(dataSource);\n+        this.maintainers = maintainers;\n+    }\n+\n+    public boolean hasManagedResource(final CIString orgId) {\n+        final int orgObjectId = jdbcTemplate.queryForObject(\n+            \"select object_id from organisation where organisation = ?\",\n+                new Object[] { orgId },\n+                Integer.class\n+        );\n+\n+        return executeStreaming(\n+                jdbcTemplate,\n+                \"select l.object \" +", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMjMwNzcxNA=="}, "originalCommit": {"oid": "2142bc2f24febbafe6f865fa293d8033bea87b12"}, "originalPosition": 43}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjY5MjYxMDgxOnYy", "diffSide": "RIGHT", "path": "whois-api/src/main/java/net/ripe/db/whois/api/rest/search/ManagedAttributeSearch.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yOVQwNzozODo0M1rOGcSA4w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wOFQwOTozNTo1MVrOGgWMoQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMjMwODQ1MQ==", "bodyText": "Inconsistent imports (some fields are imported, some are not)", "url": "https://github.com/RIPE-NCC/whois/pull/635#discussion_r432308451", "createdAt": "2020-05-29T07:38:43Z", "author": {"login": "eshryane"}, "path": "whois-api/src/main/java/net/ripe/db/whois/api/rest/search/ManagedAttributeSearch.java", "diffHunk": "@@ -17,24 +16,25 @@\n import org.slf4j.Logger;\n import org.slf4j.LoggerFactory;\n import org.springframework.beans.factory.annotation.Autowired;\n-import org.springframework.dao.DataAccessException;\n import org.springframework.stereotype.Component;\n \n import javax.annotation.Nullable;\n-import java.util.Optional;\n-import java.util.stream.Stream;\n+\n+import static net.ripe.db.whois.common.rpsl.AttributeType.ORG;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "2142bc2f24febbafe6f865fa293d8033bea87b12"}, "originalPosition": 21}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNjU3MTI5Nw==", "bodyText": "Done.", "url": "https://github.com/RIPE-NCC/whois/pull/635#discussion_r436571297", "createdAt": "2020-06-08T09:35:51Z", "author": {"login": "sbusk"}, "path": "whois-api/src/main/java/net/ripe/db/whois/api/rest/search/ManagedAttributeSearch.java", "diffHunk": "@@ -17,24 +16,25 @@\n import org.slf4j.Logger;\n import org.slf4j.LoggerFactory;\n import org.springframework.beans.factory.annotation.Autowired;\n-import org.springframework.dao.DataAccessException;\n import org.springframework.stereotype.Component;\n \n import javax.annotation.Nullable;\n-import java.util.Optional;\n-import java.util.stream.Stream;\n+\n+import static net.ripe.db.whois.common.rpsl.AttributeType.ORG;", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMjMwODQ1MQ=="}, "originalCommit": {"oid": "2142bc2f24febbafe6f865fa293d8033bea87b12"}, "originalPosition": 21}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4642, "cost": 1, "resetAt": "2021-11-12T12:57:47Z"}}}