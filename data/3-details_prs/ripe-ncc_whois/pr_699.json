{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTI0NjgwMTkx", "number": 699, "title": "managed attribute country code for org", "bodyText": "", "createdAt": "2020-11-20T12:40:23Z", "url": "https://github.com/RIPE-NCC/whois/pull/699", "merged": true, "mergeCommit": {"oid": "ae132c1bb58f3939dca315836b6b29aabefd01d3"}, "closed": true, "closedAt": "2020-12-02T08:20:32Z", "author": {"login": "maggarwal13"}, "timelineItems": {"totalCount": 9, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdeBqR9gH2gAyNTI0NjgwMTkxOmNmZGU4ZGNjYzM0N2YzZjNhODIyYTg0ZTJmY2ZhZmEzOGE0MDAzNjE=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdhljxpAH2gAyNTI0NjgwMTkxOjY2YTU4ZDgzOTgzNThmMTQ4ODM5ODA1YTdjNWE0NDVhYjI0MDhkODA=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "cfde8dccc347f3f3a822a84e2fcfafa38a400361", "author": {"user": {"login": "maggarwal13", "name": null}}, "url": "https://github.com/RIPE-NCC/whois/commit/cfde8dccc347f3f3a822a84e2fcfafa38a400361", "committedDate": "2020-11-19T12:11:03Z", "message": "managed attribute country code for org"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTM2MjI0Nzgy", "url": "https://github.com/RIPE-NCC/whois/pull/699#pullrequestreview-536224782", "createdAt": "2020-11-23T07:38:37Z", "commit": {"oid": "cfde8dccc347f3f3a822a84e2fcfafa38a400361"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0yM1QwNzozODozN1rOH4By1w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0yM1QwNzozODozN1rOH4By1w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyODUxMTcwMw==", "bodyText": "typo: orgnasation -> organisation\nThis test is for testing the validation of country code updating only being allowed by RIPE NCC, not for the attribute being flagged as managed?", "url": "https://github.com/RIPE-NCC/whois/pull/699#discussion_r528511703", "createdAt": "2020-11-23T07:38:37Z", "author": {"login": "sbusk"}, "path": "whois-api/src/test/java/net/ripe/db/whois/api/rest/WhoisRestServiceTestIntegration.java", "diffHunk": "@@ -1563,6 +1563,79 @@ public void lookup_inetnum_managed_attributes_resource_holder_abuse_contact() {\n         assertThat(response.getWhoisObjects().get(0).getAttributes().get(5).getManaged(), is(true));    // source\n     }\n \n+    @Test\n+    public void validate_country_managed_attribute_only_for_organisation() {\n+        databaseHelper.addObject(\n+                \"mntner:       RIPE-NCC-HM-MNT\\n\" +\n+                        \"source:   TEST\");\n+        databaseHelper.addObject(\n+                \"organisation: ORG-TO1-TEST\\n\" +\n+                        \"org-name:     Test Organisation\\n\" +\n+                        \"org-type:     LIR\\n\" +\n+                        \"country:      NL\\n\" +\n+                        \"abuse-c:      TR1-TEST\\n\" +\n+                        \"source:       TEST\");\n+        databaseHelper.addObject(\n+                \"inetnum:       10.0.0.0 - 10.0.0.255\\n\" +\n+                        \"status:   ALLOCATED PA\\n\" +\n+                        \"org:      ORG-TO1-TEST\\n\" +\n+                        \"country:  NL\\n\" +\n+                        \"mnt-by:   OWNER-MNT\\n\" +\n+                        \"mnt-by:   RIPE-NCC-HM-MNT\\n\" +\n+                        \"source:   TEST\");\n+\n+\n+        final WhoisResources searchOrg = RestTest.target(getPort(), \"whois/test/organisation/ORG-TO1-TEST?managed-attributes\")\n+                .request(MediaType.APPLICATION_XML_TYPE)\n+                .get(WhoisResources.class);\n+\n+        assertThat(searchOrg.getWhoisObjects(), hasSize(1));\n+        assertThat(searchOrg.getWhoisObjects().get(0).getPrimaryKey().get(0).getValue(), is(\"ORG-TO1-TEST\"));\n+        assertThat(searchOrg.getWhoisObjects().get(0).isManaged(), is(true));\n+        assertThat(searchOrg.getWhoisObjects().get(0).getAttributes().get(3).getName(), is(\"country\"));\n+        assertThat(searchOrg.getWhoisObjects().get(0).getAttributes().get(3).getManaged(), is(true));\n+\n+\n+        final WhoisResources searchinetnum = RestTest.target(getPort(), \"whois/test/inetnum/10.0.0.0%20-%2010.0.0.255?managed-attributes&resource-holder&abuse-contact\")\n+                .request(MediaType.APPLICATION_XML_TYPE)\n+                .get(WhoisResources.class);\n+\n+        assertThat(searchinetnum.getWhoisObjects(), hasSize(1));\n+        assertThat(searchinetnum.getWhoisObjects().get(0).getPrimaryKey().get(0).getValue(), is(\"10.0.0.0 - 10.0.0.255\"));\n+        assertThat(searchinetnum.getWhoisObjects().get(0).getAttributes().get(3).getName(), is(\"country\"));\n+        assertThat(searchinetnum.getWhoisObjects().get(0).getAttributes().get(3).getManaged(), is(nullValue()));\n+    }\n+\n+    @Test\n+    public void update_orgnasation_country_code_fails() {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "cfde8dccc347f3f3a822a84e2fcfafa38a400361"}, "originalPosition": 48}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e742e3b7c662ab23417519f184035af129ed9adc", "author": {"user": {"login": "maggarwal13", "name": null}}, "url": "https://github.com/RIPE-NCC/whois/commit/e742e3b7c662ab23417519f184035af129ed9adc", "committedDate": "2020-11-23T10:44:01Z", "message": "add test case"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ef2e0f604919331ea86c362e67f44f706ca7a310", "author": {"user": {"login": "eshryane", "name": "Ed Shryane"}}, "url": "https://github.com/RIPE-NCC/whois/commit/ef2e0f604919331ea86c362e67f44f706ca7a310", "committedDate": "2020-11-26T13:40:05Z", "message": "Merge branch 'master' into country_managed_attribute"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTM5MzI3OTQx", "url": "https://github.com/RIPE-NCC/whois/pull/699#pullrequestreview-539327941", "createdAt": "2020-11-26T13:46:11Z", "commit": {"oid": "ef2e0f604919331ea86c362e67f44f706ca7a310"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0yNlQxMzo0NjoxMVrOH6cFgg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0yNlQxMzo0NjoxMVrOH6cFgg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMTAzOTYxOA==", "bodyText": "This validation is already done in CountryRipeMaintainedValidator.java. If you add it here also, there may be duplicate error messages in the response.\nI don't mind if you want to move it here for consistency, but then please delete the other validator.", "url": "https://github.com/RIPE-NCC/whois/pull/699#discussion_r531039618", "createdAt": "2020-11-26T13:46:11Z", "author": {"login": "eshryane"}, "path": "whois-update/src/main/java/net/ripe/db/whois/update/handler/validator/organisation/LirRipeMaintainedAttributesValidator.java", "diffHunk": "@@ -30,7 +30,8 @@\n     private static final List<AttributeType> RIPE_NCC_MANAGED_ATTRIBUTES = ImmutableList.of(\n             AttributeType.MNT_BY,\n             AttributeType.ORG,\n-            AttributeType.ORG_TYPE);\n+            AttributeType.ORG_TYPE,\n+            AttributeType.COUNTRY);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ef2e0f604919331ea86c362e67f44f706ca7a310"}, "originalPosition": 6}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b88b2b9b94d992f5b580c12fcc997238f6a84dc3", "author": {"user": {"login": "maggarwal13", "name": null}}, "url": "https://github.com/RIPE-NCC/whois/commit/b88b2b9b94d992f5b580c12fcc997238f6a84dc3", "committedDate": "2020-11-26T14:21:39Z", "message": "remove validator for country"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "225e9285fe3414835cc0ae4f62da15b71cb40936", "author": {"user": {"login": "maggarwal13", "name": null}}, "url": "https://github.com/RIPE-NCC/whois/commit/225e9285fe3414835cc0ae4f62da15b71cb40936", "committedDate": "2020-11-26T14:21:51Z", "message": "Merge branch 'country_managed_attribute' of github.com:RIPE-NCC/whois into country_managed_attribute\n\n* 'country_managed_attribute' of github.com:RIPE-NCC/whois:\n  Bump springockito-annotations from 1.0.5 to 1.0.9 (#698)\n  Bump log4j.version from 2.13.2 to 2.14.0 (#697)\n  Sonar coverage (#690)"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTM5MzY5NDcw", "url": "https://github.com/RIPE-NCC/whois/pull/699#pullrequestreview-539369470", "createdAt": "2020-11-26T14:39:08Z", "commit": {"oid": "225e9285fe3414835cc0ae4f62da15b71cb40936"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "66a58d8398358f148839805a7c5a445ab2408d80", "author": {"user": {"login": "eshryane", "name": "Ed Shryane"}}, "url": "https://github.com/RIPE-NCC/whois/commit/66a58d8398358f148839805a7c5a445ab2408d80", "committedDate": "2020-11-30T13:42:18Z", "message": "Merge branch 'master' into country_managed_attribute"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 807, "cost": 1, "resetAt": "2021-11-01T16:37:27Z"}}}