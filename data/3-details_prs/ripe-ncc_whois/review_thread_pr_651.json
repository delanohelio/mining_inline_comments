{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDY0MjUxMDkz", "number": 651, "reviewThreads": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xMVQxMTowMjo0OFrOEXKRRA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xMVQxMTowNTo0M1rOEXKUkQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjkyNzIwOTY0OnYy", "diffSide": "RIGHT", "path": "whois-api/src/main/java/net/ripe/db/whois/api/rdap/RdapObjectMapper.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xMVQxMTowMjo0OFrOG-y3aA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xN1QxMToxMjo0M1rOHBkeQA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2ODQ5ODI4MA==", "bodyText": "Mixing Nullable and Optional in the same method arguments? Can we choose one style for consistency?", "url": "https://github.com/RIPE-NCC/whois/pull/651#discussion_r468498280", "createdAt": "2020-08-11T11:02:48Z", "author": {"login": "eshryane"}, "path": "whois-api/src/main/java/net/ripe/db/whois/api/rdap/RdapObjectMapper.java", "diffHunk": "@@ -161,7 +160,11 @@ public RdapObject mapHelp(final String requestUrl) {\n         return mapCommons(new RdapObject(), requestUrl);\n     }\n \n-    private RdapObject getRdapObject(final String requestUrl, final RpslObject rpslObject, final LocalDateTime lastChangedTimestamp, @Nullable final RpslObject abuseContact) {\n+    private RdapObject getRdapObject(final String requestUrl,\n+                                     final RpslObject rpslObject,\n+                                     final LocalDateTime lastChangedTimestamp,\n+                                     @Nullable final RpslObject abuseRoleObject,", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "abaa1a8c546e7e5fdab62e98fca0e3611e8bb36f"}, "originalPosition": 135}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MTQwODE5Mg==", "bodyText": "We use just the AbuseContact now.", "url": "https://github.com/RIPE-NCC/whois/pull/651#discussion_r471408192", "createdAt": "2020-08-17T11:12:43Z", "author": {"login": "sbusk"}, "path": "whois-api/src/main/java/net/ripe/db/whois/api/rdap/RdapObjectMapper.java", "diffHunk": "@@ -161,7 +160,11 @@ public RdapObject mapHelp(final String requestUrl) {\n         return mapCommons(new RdapObject(), requestUrl);\n     }\n \n-    private RdapObject getRdapObject(final String requestUrl, final RpslObject rpslObject, final LocalDateTime lastChangedTimestamp, @Nullable final RpslObject abuseContact) {\n+    private RdapObject getRdapObject(final String requestUrl,\n+                                     final RpslObject rpslObject,\n+                                     final LocalDateTime lastChangedTimestamp,\n+                                     @Nullable final RpslObject abuseRoleObject,", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2ODQ5ODI4MA=="}, "originalCommit": {"oid": "abaa1a8c546e7e5fdab62e98fca0e3611e8bb36f"}, "originalPosition": 135}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjkyNzIxMTA0OnYy", "diffSide": "RIGHT", "path": "whois-api/src/main/java/net/ripe/db/whois/api/rdap/RdapObjectMapper.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xMVQxMTowMzoxOFrOG-y4UA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xOFQwOTo0NDoxOFrOHCL1pg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2ODQ5ODUxMg==", "bodyText": "Can the TODO be resolved?", "url": "https://github.com/RIPE-NCC/whois/pull/651#discussion_r468498512", "createdAt": "2020-08-11T11:03:18Z", "author": {"login": "eshryane"}, "path": "whois-api/src/main/java/net/ripe/db/whois/api/rdap/RdapObjectMapper.java", "diffHunk": "@@ -296,7 +305,12 @@ private static Remark createRemark(final RpslObject rpslObject) {\n         return new Remark(descriptions);\n     }\n \n-    private static boolean hasRemark(final RpslObject rpslObject) {\n+    private static Remark createRemark(final CIString key, final AbuseContact abuseContact) {\n+        // TODO message duplicated from QueryMessages.unvalidatedAbuseCShown", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "abaa1a8c546e7e5fdab62e98fca0e3611e8bb36f"}, "originalPosition": 172}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MjA1MzE1OA==", "bodyText": "Done.", "url": "https://github.com/RIPE-NCC/whois/pull/651#discussion_r472053158", "createdAt": "2020-08-18T09:44:18Z", "author": {"login": "sbusk"}, "path": "whois-api/src/main/java/net/ripe/db/whois/api/rdap/RdapObjectMapper.java", "diffHunk": "@@ -296,7 +305,12 @@ private static Remark createRemark(final RpslObject rpslObject) {\n         return new Remark(descriptions);\n     }\n \n-    private static boolean hasRemark(final RpslObject rpslObject) {\n+    private static Remark createRemark(final CIString key, final AbuseContact abuseContact) {\n+        // TODO message duplicated from QueryMessages.unvalidatedAbuseCShown", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2ODQ5ODUxMg=="}, "originalCommit": {"oid": "abaa1a8c546e7e5fdab62e98fca0e3611e8bb36f"}, "originalPosition": 172}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjkyNzIxNTQ0OnYy", "diffSide": "RIGHT", "path": "whois-api/src/main/java/net/ripe/db/whois/api/rdap/WhoisRdapService.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xMVQxMTowNDo0OFrOG-y69g==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xN1QxMToxMjoyMlrOHBkdrw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2ODQ5OTE5MA==", "bodyText": "Do we need two separate calls to the abuseCFinder? can you read the abuse-mailbox from the RpslObject from the  getAbuseContactRole() ?", "url": "https://github.com/RIPE-NCC/whois/pull/651#discussion_r468499190", "createdAt": "2020-08-11T11:04:48Z", "author": {"login": "eshryane"}, "path": "whois-api/src/main/java/net/ripe/db/whois/api/rdap/WhoisRdapService.java", "diffHunk": "@@ -276,7 +276,8 @@ private Response getResponse(HttpServletRequest request, List<RpslObject> result\n                         getRequestUrl(request),\n                         resultObject,\n                         objectDao.getLastUpdated(resultObject.getObjectId()),\n-                        abuseCFinder.getAbuseContactRole(resultObject)))\n+                        abuseCFinder.getAbuseContactRole(resultObject),", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "abaa1a8c546e7e5fdab62e98fca0e3611e8bb36f"}, "originalPosition": 5}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MTQwODA0Nw==", "bodyText": "I've added the abuse role object to the AbuseContact so we don't need multiple lookups and we have all the information we need in one place.", "url": "https://github.com/RIPE-NCC/whois/pull/651#discussion_r471408047", "createdAt": "2020-08-17T11:12:22Z", "author": {"login": "sbusk"}, "path": "whois-api/src/main/java/net/ripe/db/whois/api/rdap/WhoisRdapService.java", "diffHunk": "@@ -276,7 +276,8 @@ private Response getResponse(HttpServletRequest request, List<RpslObject> result\n                         getRequestUrl(request),\n                         resultObject,\n                         objectDao.getLastUpdated(resultObject.getObjectId()),\n-                        abuseCFinder.getAbuseContactRole(resultObject)))\n+                        abuseCFinder.getAbuseContactRole(resultObject),", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2ODQ5OTE5MA=="}, "originalCommit": {"oid": "abaa1a8c546e7e5fdab62e98fca0e3611e8bb36f"}, "originalPosition": 5}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjkyNzIxODA5OnYy", "diffSide": "RIGHT", "path": "whois-api/src/test/java/net/ripe/db/whois/api/rdap/RdapObjectMapperTest.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xMVQxMTowNTo0M1rOG-y8lA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xOFQxMjowNToyM1rOHCQVpw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2ODQ5OTYwNA==", "bodyText": "Can you add a negative test in a different test case? (i.e. the messages doesn't appear)", "url": "https://github.com/RIPE-NCC/whois/pull/651#discussion_r468499604", "createdAt": "2020-08-11T11:05:43Z", "author": {"login": "eshryane"}, "path": "whois-api/src/test/java/net/ripe/db/whois/api/rdap/RdapObjectMapperTest.java", "diffHunk": "@@ -591,14 +599,49 @@ public void help() {\n         assertThat(result.getPort43(), is(\"whois.ripe.net\"));\n     }\n \n+    @Test\n+    public void abuse_validation_failed() {\n+        when(abuseContact.isSuspect()).thenReturn(true);\n+        when(abuseContact.getOrgId()).thenReturn(ciString(\"ORG-NCC1-RIPE\"));\n+        when(abuseContact.getAbuseMailbox()).thenReturn(ciString(\"abuse@test.com\"));\n+        when(abuseContact.getNicHandle()).thenReturn(ciString(\"AB-TEST\"));\n+\n+        final Autnum result = (Autnum) map(\n+                RpslObject.parse(\"\" +\n+                    \"aut-num:        AS102\\n\" +\n+                    \"as-name:        End-User-2\\n\" +\n+                    \"org:            ORG-NCC1-RIPE\\n\" +\n+                    \"admin-c:        AP1-TEST\\n\" +\n+                    \"tech-c:         AP1-TEST\\n\" +\n+                    \"abuse-c:        AB-TEST\\n\" +\n+                    \"notify:         noreply@ripe.net\\n\" +\n+                    \"mnt-by:         UPD-MNT\\n\" +\n+                    \"source:         TEST\\n\"\n+                ),\n+                RpslObject.parse(\n+                    \"role:           Abuse Contact\\n\" +\n+                    \"nic-hdl:        AB-TEST\\n\" +\n+                    \"mnt-by:         TEST-MNT\\n\" +\n+                    \"abuse-mailbox:  abuse@test.com\\n\" +\n+                    \"admin-c:        TP1-TEST\\n\" +\n+                    \"tech-c:         TP2-TEST\\n\" +\n+                    \"phone:          +31 12345678\\n\" +\n+                    \"source:         TEST\"\n+                ),\n+                Optional.of(abuseContact)\n+        );\n+\n+        assertThat(result.getRemarks().get(0).getDescription().get(0), is(\"Abuse-mailbox validation failed. Please refer to ORG-NCC1-RIPE for further information.\"));", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "abaa1a8c546e7e5fdab62e98fca0e3611e8bb36f"}, "originalPosition": 101}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MjEyNjg4Nw==", "bodyText": "I've added a bunch of test cases (message doesn't appear, responsible org not found, IT).", "url": "https://github.com/RIPE-NCC/whois/pull/651#discussion_r472126887", "createdAt": "2020-08-18T12:05:23Z", "author": {"login": "sbusk"}, "path": "whois-api/src/test/java/net/ripe/db/whois/api/rdap/RdapObjectMapperTest.java", "diffHunk": "@@ -591,14 +599,49 @@ public void help() {\n         assertThat(result.getPort43(), is(\"whois.ripe.net\"));\n     }\n \n+    @Test\n+    public void abuse_validation_failed() {\n+        when(abuseContact.isSuspect()).thenReturn(true);\n+        when(abuseContact.getOrgId()).thenReturn(ciString(\"ORG-NCC1-RIPE\"));\n+        when(abuseContact.getAbuseMailbox()).thenReturn(ciString(\"abuse@test.com\"));\n+        when(abuseContact.getNicHandle()).thenReturn(ciString(\"AB-TEST\"));\n+\n+        final Autnum result = (Autnum) map(\n+                RpslObject.parse(\"\" +\n+                    \"aut-num:        AS102\\n\" +\n+                    \"as-name:        End-User-2\\n\" +\n+                    \"org:            ORG-NCC1-RIPE\\n\" +\n+                    \"admin-c:        AP1-TEST\\n\" +\n+                    \"tech-c:         AP1-TEST\\n\" +\n+                    \"abuse-c:        AB-TEST\\n\" +\n+                    \"notify:         noreply@ripe.net\\n\" +\n+                    \"mnt-by:         UPD-MNT\\n\" +\n+                    \"source:         TEST\\n\"\n+                ),\n+                RpslObject.parse(\n+                    \"role:           Abuse Contact\\n\" +\n+                    \"nic-hdl:        AB-TEST\\n\" +\n+                    \"mnt-by:         TEST-MNT\\n\" +\n+                    \"abuse-mailbox:  abuse@test.com\\n\" +\n+                    \"admin-c:        TP1-TEST\\n\" +\n+                    \"tech-c:         TP2-TEST\\n\" +\n+                    \"phone:          +31 12345678\\n\" +\n+                    \"source:         TEST\"\n+                ),\n+                Optional.of(abuseContact)\n+        );\n+\n+        assertThat(result.getRemarks().get(0).getDescription().get(0), is(\"Abuse-mailbox validation failed. Please refer to ORG-NCC1-RIPE for further information.\"));", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2ODQ5OTYwNA=="}, "originalCommit": {"oid": "abaa1a8c546e7e5fdab62e98fca0e3611e8bb36f"}, "originalPosition": 101}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4658, "cost": 1, "resetAt": "2021-11-12T12:57:47Z"}}}