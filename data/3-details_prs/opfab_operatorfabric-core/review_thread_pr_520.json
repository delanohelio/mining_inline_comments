{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTAxNDg3MjI1", "number": 520, "reviewThreads": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xMlQxNDo1MjoyNVrOEsqmug==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xMlQxNTowODoyNVrOEsrAHw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzE1MjcwODQyOnYy", "diffSide": "RIGHT", "path": "src/docs/asciidoc/reference_doc/card_examples.adoc", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xMlQxNDo1MjoyNVrOHgCD1g==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xMlQxNDo1MjoyNVrOHgCD1g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMzM1MDIzMA==", "bodyText": "not \"will be\" but  \"is deprecated\"", "url": "https://github.com/opfab/operatorfabric-core/pull/520#discussion_r503350230", "createdAt": "2020-10-12T14:52:25Z", "author": {"login": "freddidierRTE"}, "path": "src/docs/asciidoc/reference_doc/card_examples.adoc", "diffHunk": "@@ -124,31 +115,32 @@ If this card need to be viewed by a user who is not in the `TSO1` group, it's po\n definition of the recipient. If the `tso2-operator` needs to see also this card, the recipient definition could be(the following code details only the recipient part):\n \n ....\n-\"recipient\":{ \n-\t\"type\":\"UNION\",\n-\t\"recipients\":[\n-\t\t{ \"type\": \"GROUP\", \"identity\":\"TSO1\"},\n-\t\t{ \"type\": \"USER\", \"identity\":\"tso2-operator\"}\n-\t\t]\n-\t}\n+\"groupRecipients\": [\"TSO1\"],\n+\"userRecipients\": [\"tso2-operator\"]\n ....\n \n+\n So here, all the users of the `TSO1` group will receive the `INFORMATION` as should the `tos2-operator` user.\n \n Another example, if a card is destined to the operators of `TSO1` and `TSO2` and needs to be also seen by the `admin`, the recipient configuration looks like:\n \n ....\n-\"recipient\":{\"type\":\"UNION\",\n-\t\"recipients\":[\n-\t\t{\"type\":\"GROUP\",\"identity\":\"TSO1\"},\n-\t\t{\"type\":\"GROUP\",\"identity\":\"TSO2\"},\n-\t\t{\"type\":\"USER\",\"identity\":\"admin\"}\n-\t\t]\n-\t}\n+\"groupRecipients\": [\"TSO1\", \"TSO2\"],\n+\"userRecipients\": [\"admin\"]\n ....\n \n \n+There is and alternative way to declare recipients of card, this syntax is more complex and will be deprecated:", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "fe803915f6ad351b996e74838df7c2223c6fcded"}, "originalPosition": 69}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzE1Mjc3MzQzOnYy", "diffSide": "RIGHT", "path": "services/core/cards-publication/src/main/java/org/lfenergy/operatorfabric/cards/publication/services/RecipientProcessor.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xMlQxNTowODoyNVrOHgCrVw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xMlQxNTowODoyNVrOHgCrVw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMzM2MDM0Mw==", "bodyText": "Change the warning text to :\n\"Use of recipient field is deprecated. Please use usersRecipients and groupsRecipients fields (See documentation)\"", "url": "https://github.com/opfab/operatorfabric-core/pull/520#discussion_r503360343", "createdAt": "2020-10-12T15:08:25Z", "author": {"login": "freddidierRTE"}, "path": "services/core/cards-publication/src/main/java/org/lfenergy/operatorfabric/cards/publication/services/RecipientProcessor.java", "diffHunk": "@@ -38,8 +41,21 @@\n      * @return computed recipient that were affected to card\n      */\n     public ComputedRecipient processAll(CardPublicationData card) {\n-        Recipient recipient = card.getRecipient();\n-        ComputedRecipient computedRecipient = processAll(recipient);\n+        ComputedRecipient computedRecipient;\n+        if ((card.getUserRecipients() != null && !card.getUserRecipients().isEmpty())\n+                        || (card.getGroupRecipients() != null && !card.getGroupRecipients().isEmpty())) {\n+            ComputedRecipient.BuilderEncapsulator result = ComputedRecipient.encapsulatedBuilder();\n+            ComputedRecipient.ComputedRecipientBuilder builder = result.builder();\n+\n+            builder.users(card.getUserRecipients() == null ? Collections.emptyList() : card.getUserRecipients());\n+            builder.groups(card.getGroupRecipients() == null ? Collections.emptyList() : card.getGroupRecipients());\n+            computedRecipient = builder.build();\n+        } else {\n+            log.warn(\"Using deprecated recipient field\");", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "fe803915f6ad351b996e74838df7c2223c6fcded"}, "originalPosition": 33}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 990, "cost": 1, "resetAt": "2021-11-13T12:10:21Z"}}}