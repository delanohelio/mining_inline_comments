{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDg3MTk0MjE1", "number": 472, "reviewThreads": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xNVQxMjozMToxN1rOEjkZog==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xNVQxMjozMToxN1rOEjkZog==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzA1NzMyMDAyOnYy", "diffSide": "RIGHT", "path": "ui/main/src/app/modules/free-message/free-message.component.ts", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xNVQxMjozMToxN1rOHR_dPQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xNVQxMzoxMDo0MFrOHSBDFQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4ODYyNzUxNw==", "bodyText": "These three line should be put out of the subscribe", "url": "https://github.com/opfab/operatorfabric-core/pull/472#discussion_r488627517", "createdAt": "2020-09-15T12:31:17Z", "author": {"login": "freddidierRTE"}, "path": "ui/main/src/app/modules/free-message/free-message.component.ts", "diffHunk": "@@ -122,21 +122,17 @@ export class FreeMessageComponent implements OnDestroy {\n         this.entityOptions$ = this.store.select(selectAllEntities).pipe(\n             takeUntil(this.unsubscribe$),\n             map((allEntities: Entity[]) => allEntities.map((entity: Entity) => {\n-                    return {value: entity.id, label: entity.name};\n-                })\n+                return { value: entity.id, label: entity.name };\n+            })\n             )\n         );\n-        this.store.select(selectIdentifier)\n-            .pipe(\n-                switchMap(id => this.userService.askUserApplicationRegistered(id)),\n-                withLatestFrom(this.store.select(selectProcesses))\n-            )\n-            .subscribe(([user, allProcesses]: [User, Process[]]) => {\n-\n-                this.currentUser = user;\n+        this.store.select(selectProcesses).pipe(takeUntil(this.unsubscribe$)).\n+            subscribe((allProcesses: Process[]) => {\n+                const userWithPerimeters = this.userService.getCurrentUserWithPerimeters();\n+                if (userWithPerimeters) {\n+                    this.currentUser = userWithPerimeters.userData;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "0c1686891c2a7a7b58f0b92558b530bbf9d92b22"}, "originalPosition": 107}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4ODY1MzU4OQ==", "bodyText": "Ok", "url": "https://github.com/opfab/operatorfabric-core/pull/472#discussion_r488653589", "createdAt": "2020-09-15T13:10:40Z", "author": {"login": "taoufikbermaki"}, "path": "ui/main/src/app/modules/free-message/free-message.component.ts", "diffHunk": "@@ -122,21 +122,17 @@ export class FreeMessageComponent implements OnDestroy {\n         this.entityOptions$ = this.store.select(selectAllEntities).pipe(\n             takeUntil(this.unsubscribe$),\n             map((allEntities: Entity[]) => allEntities.map((entity: Entity) => {\n-                    return {value: entity.id, label: entity.name};\n-                })\n+                return { value: entity.id, label: entity.name };\n+            })\n             )\n         );\n-        this.store.select(selectIdentifier)\n-            .pipe(\n-                switchMap(id => this.userService.askUserApplicationRegistered(id)),\n-                withLatestFrom(this.store.select(selectProcesses))\n-            )\n-            .subscribe(([user, allProcesses]: [User, Process[]]) => {\n-\n-                this.currentUser = user;\n+        this.store.select(selectProcesses).pipe(takeUntil(this.unsubscribe$)).\n+            subscribe((allProcesses: Process[]) => {\n+                const userWithPerimeters = this.userService.getCurrentUserWithPerimeters();\n+                if (userWithPerimeters) {\n+                    this.currentUser = userWithPerimeters.userData;", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4ODYyNzUxNw=="}, "originalCommit": {"oid": "0c1686891c2a7a7b58f0b92558b530bbf9d92b22"}, "originalPosition": 107}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 972, "cost": 1, "resetAt": "2021-11-13T12:10:21Z"}}}