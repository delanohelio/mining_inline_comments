{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDk1MTc2NzI3", "number": 10748, "title": "JITServer: Eliminate cpu.getProcessorDescription() remote override", "bodyText": "Currently there is an inconsistency in the design where cpu.getProcessorDescription() always goes to vmInfo to grab processor info in JITServer mode. With the cross-compilation design in place, cpu should already contain what's needed in its member fields. I want to eliminate this inconsistency by removing the \"JITServer remote override\" to cpu.getProcessorDescription() and follow what has been done for the cross-compilation design. Additional benefit of this is that it also eliminates the thread local read performed by the \"JITServer remote override\"\nSigned-off-by: Harry Yu harryyu1994@gmail.com", "createdAt": "2020-09-29T23:57:22Z", "url": "https://github.com/eclipse-openj9/openj9/pull/10748", "merged": true, "mergeCommit": {"oid": "35737c021b032e93e37a41843f1d587e397bdca2"}, "closed": true, "closedAt": "2020-10-08T14:37:52Z", "author": {"login": "harryyu1994"}, "timelineItems": {"totalCount": 9, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdNxNiRgBqjM4MjIxMDk4NjY=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdQSer_AFqTUwNDIxNjAzMA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "fe02bed40dc3fed743095458933b1b2cf80e41e9", "author": {"user": {"login": "harryyu1994", "name": "Harry Yu"}}, "url": "https://github.com/eclipse-openj9/openj9/commit/fe02bed40dc3fed743095458933b1b2cf80e41e9", "committedDate": "2020-09-29T23:51:28Z", "message": "JITServer: Eliminate cpu.getProcessorDescription() remote override\n\nThere is only one place in the entire codebase where it makes sense to grab processor description from the client.\nThere is no need to do a remote override for this method unlike the other methods that get called in many places in the codebase.\nEliminate the remote call to client in getProcessorDescription to avoid any confusions and make the code a little bit faster.\n\nSigned-off-by: Harry Yu <harryyu1994@gmail.com>"}, "afterCommit": {"oid": "0be0079ed6c5de2859c4f9c6ffe949ae89f478d7", "author": {"user": {"login": "harryyu1994", "name": "Harry Yu"}}, "url": "https://github.com/eclipse-openj9/openj9/commit/0be0079ed6c5de2859c4f9c6ffe949ae89f478d7", "committedDate": "2020-09-29T23:58:03Z", "message": "JITServer: Eliminate cpu.getProcessorDescription() remote override\n\nThere is only one place in the entire codebase where it makes sense to grab processor description from the client.\nThere is no need to do a remote override for this method unlike the other methods that get called in many places in the codebase.\nEliminate the remote call to client in getProcessorDescription to avoid any confusions and make the code a little bit faster.\n\nSigned-off-by: Harry Yu <harryyu1994@gmail.com>"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "0be0079ed6c5de2859c4f9c6ffe949ae89f478d7", "author": {"user": {"login": "harryyu1994", "name": "Harry Yu"}}, "url": "https://github.com/eclipse-openj9/openj9/commit/0be0079ed6c5de2859c4f9c6ffe949ae89f478d7", "committedDate": "2020-09-29T23:58:03Z", "message": "JITServer: Eliminate cpu.getProcessorDescription() remote override\n\nThere is only one place in the entire codebase where it makes sense to grab processor description from the client.\nThere is no need to do a remote override for this method unlike the other methods that get called in many places in the codebase.\nEliminate the remote call to client in getProcessorDescription to avoid any confusions and make the code a little bit faster.\n\nSigned-off-by: Harry Yu <harryyu1994@gmail.com>"}, "afterCommit": {"oid": "9a6fb4804a6ce439b65744c9a1e2dfce5d47f62e", "author": {"user": {"login": "harryyu1994", "name": "Harry Yu"}}, "url": "https://github.com/eclipse-openj9/openj9/commit/9a6fb4804a6ce439b65744c9a1e2dfce5d47f62e", "committedDate": "2020-09-30T00:00:45Z", "message": "JITServer: Eliminate cpu.getProcessorDescription() remote override\n\nThere is only one place in the entire codebase where it makes sense to grab processor description from the client.\nThere is no need to do a remote override for this method unlike the other methods that get called in many places in the codebase.\nEliminate the remote call to client in getProcessorDescription to avoid any confusions and make the code a little bit faster.\n\nSigned-off-by: Harry Yu <harryyu1994@gmail.com>"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTAyMzk5NTkx", "url": "https://github.com/eclipse-openj9/openj9/pull/10748#pullrequestreview-502399591", "createdAt": "2020-10-05T20:33:58Z", "commit": {"oid": "9a6fb4804a6ce439b65744c9a1e2dfce5d47f62e"}, "state": "COMMENTED", "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wNVQyMDozMzo1OVrOHcsy9g==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wNVQyMDo0MToyOVrOHctCCQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5OTg1NjExOA==", "bodyText": "that is a CompilationInfoPerThreadBase and you should be able to obtain the client data from there.", "url": "https://github.com/eclipse-openj9/openj9/pull/10748#discussion_r499856118", "createdAt": "2020-10-05T20:33:59Z", "author": {"login": "mpirvu"}, "path": "runtime/compiler/control/CompilationThread.cpp", "diffHunk": "@@ -8513,7 +8513,7 @@ TR::CompilationInfoPerThreadBase::wrappedCompile(J9PortLibrary *portLib, void *\n #if defined(J9VM_OPT_JITSERVER)\n          if (that->_methodBeingCompiled->isOutOfProcessCompReq())\n             {\n-            OMRProcessorDesc JITClientProcessorDesc = TR::Compiler->target.cpu.getProcessorDescription();\n+            OMRProcessorDesc JITClientProcessorDesc = that->_methodBeingCompiled->_compInfoPT->getClientData()->getOrCacheVMInfo(that->_methodBeingCompiled->_stream)->_processorDescription;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "9a6fb4804a6ce439b65744c9a1e2dfce5d47f62e"}, "originalPosition": 5}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5OTg1OTgwNQ==", "bodyText": "Since this path is never supposed to be taken, you could transform this assert into a fatal one without the risk of adding extra overhead.", "url": "https://github.com/eclipse-openj9/openj9/pull/10748#discussion_r499859805", "createdAt": "2020-10-05T20:41:09Z", "author": {"login": "mpirvu"}, "path": "runtime/compiler/env/J9CPU.cpp", "diffHunk": "@@ -24,22 +24,19 @@\n #pragma csect(STATIC,\"J9J9CPU#S\")\n #pragma csect(TEST,\"J9J9CPU#T\")\n \n-#include \"control/CompilationRuntime.hpp\"\n-#include \"env/CompilerEnv.hpp\"\n #include \"env/CPU.hpp\"\n-#include \"env/VMJ9.h\"\n-#include \"j9.h\"\n-#include \"j9port.h\"\n+#include \"infra/Assert.hpp\"                         // for TR_ASSERT\n \n-OMRProcessorDesc\n-J9::CPU::getProcessorDescription()\n+const char *\n+J9::CPU::getProcessorVendorId() \n    {\n-#if defined(J9VM_OPT_JITSERVER)\n-   if (auto stream = TR::CompilationInfo::getStream())\n-      {\n-      auto *vmInfo = TR::compInfoPT->getClientData()->getOrCacheVMInfo(stream);\n-      return vmInfo->_processorDescription;\n-      }\n-#endif /* defined(J9VM_OPT_JITSERVER) */\n-   return _processorDescription;\n+   TR_ASSERT(false, \"Vendor ID not defined for this platform!\");", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "9a6fb4804a6ce439b65744c9a1e2dfce5d47f62e"}, "originalPosition": 25}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5OTg1OTk3Nw==", "bodyText": "Same comment as above", "url": "https://github.com/eclipse-openj9/openj9/pull/10748#discussion_r499859977", "createdAt": "2020-10-05T20:41:29Z", "author": {"login": "mpirvu"}, "path": "runtime/compiler/env/J9CPU.cpp", "diffHunk": "@@ -24,22 +24,19 @@\n #pragma csect(STATIC,\"J9J9CPU#S\")\n #pragma csect(TEST,\"J9J9CPU#T\")\n \n-#include \"control/CompilationRuntime.hpp\"\n-#include \"env/CompilerEnv.hpp\"\n #include \"env/CPU.hpp\"\n-#include \"env/VMJ9.h\"\n-#include \"j9.h\"\n-#include \"j9port.h\"\n+#include \"infra/Assert.hpp\"                         // for TR_ASSERT\n \n-OMRProcessorDesc\n-J9::CPU::getProcessorDescription()\n+const char *\n+J9::CPU::getProcessorVendorId() \n    {\n-#if defined(J9VM_OPT_JITSERVER)\n-   if (auto stream = TR::CompilationInfo::getStream())\n-      {\n-      auto *vmInfo = TR::compInfoPT->getClientData()->getOrCacheVMInfo(stream);\n-      return vmInfo->_processorDescription;\n-      }\n-#endif /* defined(J9VM_OPT_JITSERVER) */\n-   return _processorDescription;\n+   TR_ASSERT(false, \"Vendor ID not defined for this platform!\");\n+   return NULL;\n+   }\n+\n+uint32_t \n+J9::CPU::getProcessorSignature()\n+   {\n+   TR_ASSERT(false, \"Processor Signature not defined for this platform!\"); ", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "9a6fb4804a6ce439b65744c9a1e2dfce5d47f62e"}, "originalPosition": 32}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "9a6fb4804a6ce439b65744c9a1e2dfce5d47f62e", "author": {"user": {"login": "harryyu1994", "name": "Harry Yu"}}, "url": "https://github.com/eclipse-openj9/openj9/commit/9a6fb4804a6ce439b65744c9a1e2dfce5d47f62e", "committedDate": "2020-09-30T00:00:45Z", "message": "JITServer: Eliminate cpu.getProcessorDescription() remote override\n\nThere is only one place in the entire codebase where it makes sense to grab processor description from the client.\nThere is no need to do a remote override for this method unlike the other methods that get called in many places in the codebase.\nEliminate the remote call to client in getProcessorDescription to avoid any confusions and make the code a little bit faster.\n\nSigned-off-by: Harry Yu <harryyu1994@gmail.com>"}, "afterCommit": {"oid": "31d000a2fd113803c59483f3574d9bd66859d453", "author": {"user": {"login": "harryyu1994", "name": "Harry Yu"}}, "url": "https://github.com/eclipse-openj9/openj9/commit/31d000a2fd113803c59483f3574d9bd66859d453", "committedDate": "2020-10-05T22:05:47Z", "message": "JITServer: Eliminate cpu.getProcessorDescription() remote override\n\nThere is only one place in the entire codebase where it makes sense to grab processor description from the client.\nThere is no need to do a remote override for this method unlike the other methods that get called in many places in the codebase.\nEliminate the remote call to client in getProcessorDescription to avoid any confusions and make the code a little bit faster.\n\nSigned-off-by: Harry Yu <harryyu1994@gmail.com>"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "31d000a2fd113803c59483f3574d9bd66859d453", "author": {"user": {"login": "harryyu1994", "name": "Harry Yu"}}, "url": "https://github.com/eclipse-openj9/openj9/commit/31d000a2fd113803c59483f3574d9bd66859d453", "committedDate": "2020-10-05T22:05:47Z", "message": "JITServer: Eliminate cpu.getProcessorDescription() remote override\n\nThere is only one place in the entire codebase where it makes sense to grab processor description from the client.\nThere is no need to do a remote override for this method unlike the other methods that get called in many places in the codebase.\nEliminate the remote call to client in getProcessorDescription to avoid any confusions and make the code a little bit faster.\n\nSigned-off-by: Harry Yu <harryyu1994@gmail.com>"}, "afterCommit": {"oid": "9986ea8d69cb7c895990ade2687c872e5a6cced8", "author": {"user": {"login": "harryyu1994", "name": "Harry Yu"}}, "url": "https://github.com/eclipse-openj9/openj9/commit/9986ea8d69cb7c895990ade2687c872e5a6cced8", "committedDate": "2020-10-07T15:30:04Z", "message": "JITServer: Eliminate cpu.getProcessorDescription() remote override\n\nThere is only one place in the entire codebase where it makes sense to grab processor description from the client.\nThere is no need to do a remote override for this method unlike the other methods that get called in many places in the codebase.\nEliminate the remote call to client in getProcessorDescription to avoid any confusions and make the code a little bit faster.\n\nSigned-off-by: Harry Yu <harryyu1994@gmail.com>"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "9986ea8d69cb7c895990ade2687c872e5a6cced8", "author": {"user": {"login": "harryyu1994", "name": "Harry Yu"}}, "url": "https://github.com/eclipse-openj9/openj9/commit/9986ea8d69cb7c895990ade2687c872e5a6cced8", "committedDate": "2020-10-07T15:30:04Z", "message": "JITServer: Eliminate cpu.getProcessorDescription() remote override\n\nThere is only one place in the entire codebase where it makes sense to grab processor description from the client.\nThere is no need to do a remote override for this method unlike the other methods that get called in many places in the codebase.\nEliminate the remote call to client in getProcessorDescription to avoid any confusions and make the code a little bit faster.\n\nSigned-off-by: Harry Yu <harryyu1994@gmail.com>"}, "afterCommit": {"oid": "36fe929d9c478aecb6556bddbe71b9b671d90d0f", "author": {"user": {"login": "harryyu1994", "name": "Harry Yu"}}, "url": "https://github.com/eclipse-openj9/openj9/commit/36fe929d9c478aecb6556bddbe71b9b671d90d0f", "committedDate": "2020-10-07T15:34:38Z", "message": "JITServer: Eliminate cpu.getProcessorDescription() remote override\n\nThere is only one place in the entire codebase where it makes sense to grab processor description from the client.\nThere is no need to do a remote override for this method unlike the other methods that get called in many places in the codebase.\nEliminate the remote call to client in getProcessorDescription to avoid any confusions and make the code a little bit faster.\n\nSigned-off-by: Harry Yu <harryyu1994@gmail.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "4ca88e951384844ede5fb54211da26846dda3733", "author": {"user": {"login": "harryyu1994", "name": "Harry Yu"}}, "url": "https://github.com/eclipse-openj9/openj9/commit/4ca88e951384844ede5fb54211da26846dda3733", "committedDate": "2020-10-07T16:21:42Z", "message": "JITServer: Eliminate cpu.getProcessorDescription() remote override\n\nThere is only one place in the entire codebase where it makes sense to grab processor description from the client.\nThere is no need to do a remote override for this method unlike the other methods that get called in many places in the codebase.\nEliminate the remote call to client in getProcessorDescription to avoid any confusions and make the code a little bit faster.\n\nSigned-off-by: Harry Yu <harryyu1994@gmail.com>"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "36fe929d9c478aecb6556bddbe71b9b671d90d0f", "author": {"user": {"login": "harryyu1994", "name": "Harry Yu"}}, "url": "https://github.com/eclipse-openj9/openj9/commit/36fe929d9c478aecb6556bddbe71b9b671d90d0f", "committedDate": "2020-10-07T15:34:38Z", "message": "JITServer: Eliminate cpu.getProcessorDescription() remote override\n\nThere is only one place in the entire codebase where it makes sense to grab processor description from the client.\nThere is no need to do a remote override for this method unlike the other methods that get called in many places in the codebase.\nEliminate the remote call to client in getProcessorDescription to avoid any confusions and make the code a little bit faster.\n\nSigned-off-by: Harry Yu <harryyu1994@gmail.com>"}, "afterCommit": {"oid": "4ca88e951384844ede5fb54211da26846dda3733", "author": {"user": {"login": "harryyu1994", "name": "Harry Yu"}}, "url": "https://github.com/eclipse-openj9/openj9/commit/4ca88e951384844ede5fb54211da26846dda3733", "committedDate": "2020-10-07T16:21:42Z", "message": "JITServer: Eliminate cpu.getProcessorDescription() remote override\n\nThere is only one place in the entire codebase where it makes sense to grab processor description from the client.\nThere is no need to do a remote override for this method unlike the other methods that get called in many places in the codebase.\nEliminate the remote call to client in getProcessorDescription to avoid any confusions and make the code a little bit faster.\n\nSigned-off-by: Harry Yu <harryyu1994@gmail.com>"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTA0MjE2MDMw", "url": "https://github.com/eclipse-openj9/openj9/pull/10748#pullrequestreview-504216030", "createdAt": "2020-10-07T19:51:50Z", "commit": {"oid": "4ca88e951384844ede5fb54211da26846dda3733"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 346, "cost": 1, "resetAt": "2021-10-28T18:00:02Z"}}}