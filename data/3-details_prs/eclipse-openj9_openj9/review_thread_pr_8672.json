{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0MzgwNjQzOTU1", "number": 8672, "reviewThreads": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yOFQwMDo1NDo1NFrODjqa4A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yOFQwMDo1NDo1NFrODjqa4A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjM4NzIxNzYwOnYy", "diffSide": "RIGHT", "path": "runtime/compiler/aarch64/codegen/J9ARM64Snippet.cpp", "isResolved": false, "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yOFQwMDo1NDo1NFrOFvmT3w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yOFQwMzoxMjowN1rOFvoT2g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NTQ1NTA3MQ==", "bodyText": "ppc uses ~OBJECT_HEADER_LOCK_RECURSION_MASK which is ~0xF8 for masking.\nhttps://github.com/eclipse/openj9/blob/944f9dd6edf869c6409db6ba367a360cad0dbee7/runtime/compiler/p/codegen/J9TreeEvaluator.cpp#L5925-L5948", "url": "https://github.com/eclipse-openj9/openj9/pull/8672#discussion_r385455071", "createdAt": "2020-02-28T00:54:54Z", "author": {"login": "Akira1Saitoh"}, "path": "runtime/compiler/aarch64/codegen/J9ARM64Snippet.cpp", "diffHunk": "@@ -74,7 +74,7 @@ TR::ARM64MonitorEnterSnippet::emitSnippetBody()\n    *(int32_t *)buffer = TR::InstOpCode::getOpCodeBinaryEncoding(TR::InstOpCode::andimmx);\n    tempReg->setRegisterFieldRD((uint32_t *)buffer);\n    dataReg->setRegisterFieldRN((uint32_t *)buffer);\n-   *(int32_t *)buffer |= 0x196000; // immr=25, imms=24 for 0xFFFFFF80\n+   *(int32_t *)buffer |= 0x79E000; // immr=57, imms=56 for 0xFFFFFFFFFFFFFF80", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "22faf7971cc3c008442f256274c8e97ae12a1044"}, "originalPosition": 5}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NTQ4MzExMA==", "bodyText": "Thank you for pointing that out.\nThe monitorExit side has to use ~OBJECT_HEADER_LOCK_RECURSION_MASK (= ~0xF8) while the monitorEnter side uses ~0x7F.\nUpdated the code.", "url": "https://github.com/eclipse-openj9/openj9/pull/8672#discussion_r385483110", "createdAt": "2020-02-28T02:49:11Z", "author": {"login": "knn-k"}, "path": "runtime/compiler/aarch64/codegen/J9ARM64Snippet.cpp", "diffHunk": "@@ -74,7 +74,7 @@ TR::ARM64MonitorEnterSnippet::emitSnippetBody()\n    *(int32_t *)buffer = TR::InstOpCode::getOpCodeBinaryEncoding(TR::InstOpCode::andimmx);\n    tempReg->setRegisterFieldRD((uint32_t *)buffer);\n    dataReg->setRegisterFieldRN((uint32_t *)buffer);\n-   *(int32_t *)buffer |= 0x196000; // immr=25, imms=24 for 0xFFFFFF80\n+   *(int32_t *)buffer |= 0x79E000; // immr=57, imms=56 for 0xFFFFFFFFFFFFFF80", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NTQ1NTA3MQ=="}, "originalCommit": {"oid": "22faf7971cc3c008442f256274c8e97ae12a1044"}, "originalPosition": 5}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NTQ4NzgzNA==", "bodyText": "In monitorEnter, 32-bit ARM uses ~(OBJECT_HEADER_LOCK_BITS_MASK - OBJECT_HEADER_LOCK_LAST_RECURSION_BIT), which is ~0x7F.\nPower uses LOCK_THREAD_PTR_AND_UPPER_COUNT_BIT_MASK there, which is defined as (LOCK_THREAD_PTR_MASK | OBJECT_HEADER_LOCK_LAST_RECURSION_BIT) = ~0xFF | 0x80.\nIt is confusing, but both resulting in the same mask value.", "url": "https://github.com/eclipse-openj9/openj9/pull/8672#discussion_r385487834", "createdAt": "2020-02-28T03:12:07Z", "author": {"login": "knn-k"}, "path": "runtime/compiler/aarch64/codegen/J9ARM64Snippet.cpp", "diffHunk": "@@ -74,7 +74,7 @@ TR::ARM64MonitorEnterSnippet::emitSnippetBody()\n    *(int32_t *)buffer = TR::InstOpCode::getOpCodeBinaryEncoding(TR::InstOpCode::andimmx);\n    tempReg->setRegisterFieldRD((uint32_t *)buffer);\n    dataReg->setRegisterFieldRN((uint32_t *)buffer);\n-   *(int32_t *)buffer |= 0x196000; // immr=25, imms=24 for 0xFFFFFF80\n+   *(int32_t *)buffer |= 0x79E000; // immr=57, imms=56 for 0xFFFFFFFFFFFFFF80", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NTQ1NTA3MQ=="}, "originalCommit": {"oid": "22faf7971cc3c008442f256274c8e97ae12a1044"}, "originalPosition": 5}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 619, "cost": 1, "resetAt": "2021-11-12T13:16:51Z"}}}