{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0MzYxMDg1NTg5", "number": 8261, "title": "Check if offset is in the SCC before loading it", "bodyText": "Fixes #7890", "createdAt": "2020-01-09T17:57:20Z", "url": "https://github.com/eclipse-openj9/openj9/pull/8261", "merged": true, "mergeCommit": {"oid": "5f90e5e7d8a687898b8cf4f3d67ff6b643863e5a"}, "closed": true, "closedAt": "2020-01-13T15:31:11Z", "author": {"login": "dsouzai"}, "timelineItems": {"totalCount": 8, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABb4t1FgABqjI5MzU5MDI1Njc=", "endCursor": "Y3Vyc29yOnYyOpPPAAABb5-uLfAFqTM0MTk1ODk5OQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "a9b34abc5852aad0225c2276584b379dd3b0e552", "author": {"user": {"login": "dsouzai", "name": "Irwin D'Souza"}}, "url": "https://github.com/eclipse-openj9/openj9/commit/a9b34abc5852aad0225c2276584b379dd3b0e552", "committedDate": "2020-01-09T17:49:44Z", "message": "Check if offset is in SCC before loading it\n\nSigned-off-by: Irwin D'Souza <dsouzai.gh@gmail.com>"}, "afterCommit": {"oid": "f2fbd2d0cac604d94c81f59aa0687baad0dccc4a", "author": {"user": {"login": "dsouzai", "name": "Irwin D'Souza"}}, "url": "https://github.com/eclipse-openj9/openj9/commit/f2fbd2d0cac604d94c81f59aa0687baad0dccc4a", "committedDate": "2020-01-09T17:58:14Z", "message": "Check if offset is in SCC before loading it\n\nSigned-off-by: Irwin D'Souza <dsouzai.gh@gmail.com>"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzQxMjY1MDMx", "url": "https://github.com/eclipse-openj9/openj9/pull/8261#pullrequestreview-341265031", "createdAt": "2020-01-10T16:10:35Z", "commit": {"oid": "f2fbd2d0cac604d94c81f59aa0687baad0dccc4a"}, "state": "COMMENTED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzQxMjcxNTky", "url": "https://github.com/eclipse-openj9/openj9/pull/8261#pullrequestreview-341271592", "createdAt": "2020-01-10T16:20:35Z", "commit": {"oid": "f2fbd2d0cac604d94c81f59aa0687baad0dccc4a"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0xMFQxNjoyMDozNVrOFcZEQw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0xMFQxNjoyMDozNVrOFcZEQw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NTMxNTEzOQ==", "bodyText": "Can I suggest getting the ROM class pointer by doing isOffsetInSharedCache(csInfoClazzOffset, &romClass) instead? It would be a bit more optimal.", "url": "https://github.com/eclipse-openj9/openj9/pull/8261#discussion_r365315139", "createdAt": "2020-01-10T16:20:35Z", "author": {"login": "ymanton"}, "path": "runtime/compiler/runtime/IProfiler.cpp", "diffHunk": "@@ -3147,9 +3147,9 @@ TR_IPBCDataCallGraph::loadFromPersistentCopy(TR_IPBCDataStorageHeader * storage,\n          {\n          J9Class *ramClass = NULL;\n \n-         uintptrj_t csInfoClazz = store->_csInfo.getClazz(i);\n-         if (comp->fej9()->sharedCache()->isPointerInSharedCache((void *)csInfoClazz))\n-            ramClass = ((TR_J9VM *)comp->fej9())->matchRAMclassFromROMclass((J9ROMClass *)comp->fej9()->sharedCache()->pointerFromOffsetInSharedCache(csInfoClazz), comp);\n+         uintptrj_t csInfoClazzOffset = store->_csInfo.getClazz(i);\n+         if (comp->fej9()->sharedCache()->isOffsetInSharedCache(csInfoClazzOffset))\n+            ramClass = ((TR_J9VM *)comp->fej9())->matchRAMclassFromROMclass((J9ROMClass *)comp->fej9()->sharedCache()->pointerFromOffsetInSharedCache(csInfoClazzOffset), comp);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f2fbd2d0cac604d94c81f59aa0687baad0dccc4a"}, "originalPosition": 9}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "260c81962f14e20d93848aecb4de6d7c4f51322c", "author": {"user": {"login": "dsouzai", "name": "Irwin D'Souza"}}, "url": "https://github.com/eclipse-openj9/openj9/commit/260c81962f14e20d93848aecb4de6d7c4f51322c", "committedDate": "2020-01-10T19:40:30Z", "message": "Add isOffsetInSharedCache query\n\nThis query can be used to safeguard code that depends on an offset but\nisn't sure if the offset is within the SCC.\n\nSigned-off-by: Irwin D'Souza <dsouzai.gh@gmail.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b809a9191a34e675f2e2d448a291ae3bb98026b1", "author": {"user": {"login": "dsouzai", "name": "Irwin D'Souza"}}, "url": "https://github.com/eclipse-openj9/openj9/commit/b809a9191a34e675f2e2d448a291ae3bb98026b1", "committedDate": "2020-01-10T19:42:24Z", "message": "Check if offset is in SCC before loading it\n\nSigned-off-by: Irwin D'Souza <dsouzai.gh@gmail.com>"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "f2fbd2d0cac604d94c81f59aa0687baad0dccc4a", "author": {"user": {"login": "dsouzai", "name": "Irwin D'Souza"}}, "url": "https://github.com/eclipse-openj9/openj9/commit/f2fbd2d0cac604d94c81f59aa0687baad0dccc4a", "committedDate": "2020-01-09T17:58:14Z", "message": "Check if offset is in SCC before loading it\n\nSigned-off-by: Irwin D'Souza <dsouzai.gh@gmail.com>"}, "afterCommit": {"oid": "b809a9191a34e675f2e2d448a291ae3bb98026b1", "author": {"user": {"login": "dsouzai", "name": "Irwin D'Souza"}}, "url": "https://github.com/eclipse-openj9/openj9/commit/b809a9191a34e675f2e2d448a291ae3bb98026b1", "committedDate": "2020-01-10T19:42:24Z", "message": "Check if offset is in SCC before loading it\n\nSigned-off-by: Irwin D'Souza <dsouzai.gh@gmail.com>"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzQxNDMwNTY4", "url": "https://github.com/eclipse-openj9/openj9/pull/8261#pullrequestreview-341430568", "createdAt": "2020-01-10T21:26:09Z", "commit": {"oid": "b809a9191a34e675f2e2d448a291ae3bb98026b1"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzQxOTU4OTk5", "url": "https://github.com/eclipse-openj9/openj9/pull/8261#pullrequestreview-341958999", "createdAt": "2020-01-13T16:13:10Z", "commit": {"oid": "b809a9191a34e675f2e2d448a291ae3bb98026b1"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0xM1QxNjoxMzoxMFrOFc8LCA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0xM1QxNjoxMzoxMFrOFc8LCA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NTg5MDMxMg==", "bodyText": "This would be clearer and closer to the truth, if the second parameter type was void **, or uintptrj_t *.", "url": "https://github.com/eclipse-openj9/openj9/pull/8261#discussion_r365890312", "createdAt": "2020-01-13T16:13:10Z", "author": {"login": "keithc-ca"}, "path": "runtime/compiler/env/J9SharedCache.hpp", "diffHunk": "@@ -123,6 +123,15 @@ class TR_J9SharedCache : public TR_SharedCache\n     */\n    virtual bool isPointerInSharedCache(void *ptr, uintptrj_t *cacheOffset = NULL);\n \n+   /**\n+    * \\brief Checks whether the specified offset is within the shared cache.\n+    *\n+    * \\param[in] offset The offset to check.\n+    * \\param[out] ptr If offset is within the shared cache and this parameter is not NULL the result of converting offset into a pointer will be returned here. If offset is not within the shared cache this parameter is ignored.\n+    * \\return True if the offset is within the shared cache, false otherwise.\n+    */\n+   virtual bool isOffsetInSharedCache(uintptrj_t offset, void *ptr = NULL);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b809a9191a34e675f2e2d448a291ae3bb98026b1"}, "originalPosition": 18}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 822, "cost": 1, "resetAt": "2021-10-28T18:00:02Z"}}}