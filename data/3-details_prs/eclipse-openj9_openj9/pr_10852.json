{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTAwMjA5OTc1", "number": 10852, "title": "Ensure AOT Compilation in JIT Dump", "bodyText": "Ensure that if there is a crash during an AOT compilation, the JIT Dump\nperforms an AOT compilation as well.\nSigned-off-by: Irwin D'Souza dsouzai.gh@gmail.com", "createdAt": "2020-10-08T21:51:27Z", "url": "https://github.com/eclipse-openj9/openj9/pull/10852", "merged": true, "mergeCommit": {"oid": "7ec0121607b0c887e34734b06c632060f9e0e273"}, "closed": true, "closedAt": "2020-10-21T20:48:19Z", "author": {"login": "dsouzai"}, "timelineItems": {"totalCount": 5, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdQouRXAH2gAyNTAwMjA5OTc1OjkxMDQxMjM1ZWIzNWI2YjdmNjk0MjczMGMyODk3ZmM1YTlkMjUxODE=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdUzgJ4AFqTUxNDE2NTEwMQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "91041235eb35b6b7f6942730c2897fc5a9d25181", "author": {"user": {"login": "dsouzai", "name": "Irwin D'Souza"}}, "url": "https://github.com/eclipse-openj9/openj9/commit/91041235eb35b6b7f6942730c2897fc5a9d25181", "committedDate": "2020-10-08T21:46:46Z", "message": "JITDump AOT Compile\n\nEnsure that if there is a crash during an AOT compilation, the JIT Dump\nperforms an AOT compilation as well.\n\nSigned-off-by: Irwin D'Souza <dsouzai.gh@gmail.com>"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTA1MTk3NTI4", "url": "https://github.com/eclipse-openj9/openj9/pull/10852#pullrequestreview-505197528", "createdAt": "2020-10-08T22:02:58Z", "commit": {"oid": "91041235eb35b6b7f6942730c2897fc5a9d25181"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wOFQyMjowMjo1OFrOHex9Ig==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wOFQyMjowMjo1OFrOHex9Ig==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMjAzNzc5NA==", "bodyText": "I should note, I don't think this will actually result in an AOT compilation; this is because the method is already in the SCC, so the control code will probably just try to do an AOT load. However, if the AOT compilation was also done in the current JVM, it would be nice to be able to log that compilation as well, though this would require keeping track of the methods that were AOT compiled by the current JVM.", "url": "https://github.com/eclipse-openj9/openj9/pull/10852#discussion_r502037794", "createdAt": "2020-10-08T22:02:58Z", "author": {"login": "dsouzai"}, "path": "runtime/compiler/control/JitDump.cpp", "diffHunk": "@@ -586,15 +586,29 @@ runJitdump(char *label, J9RASdumpContext *context, J9RASdumpAgent *agent)\n                if (!(jittedMethodsOnStack[i]._method))\n                   continue;\n \n+               bool isAOTBody = false;\n+               J9JITExceptionTable *metadata = NULL;\n+               void *startPC = jittedMethodsOnStack[i]._oldStartPC;\n+               if (startPC)\n+                  {\n+                  metadata = jitConfig->jitGetExceptionTableFromPC(crashedThread, (UDATA)startPC);\n+                  if (metadata)\n+                     {\n+                     TR_PersistentJittedBodyInfo *bodyInfo = (TR_PersistentJittedBodyInfo *)metadata->bodyInfo;\n+                     if (bodyInfo)\n+                        isAOTBody = bodyInfo->getIsAotedBody();\n+                     }\n+                  }\n+\n                TR_CompilationErrorCode compErrCode;\n                compErrCode = recompileMethodForLog(\n                   crashedThread,\n                   jittedMethodsOnStack[i]._method,\n                   compInfo,\n-                  frontendOfThread,\n                   jittedMethodsOnStack[i]._optLevel,\n                   false,\n-                  jittedMethodsOnStack[i]._oldStartPC,\n+                  isAOTBody,", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "91041235eb35b6b7f6942730c2897fc5a9d25181"}, "originalPosition": 47}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTEzNzcwMDIy", "url": "https://github.com/eclipse-openj9/openj9/pull/10852#pullrequestreview-513770022", "createdAt": "2020-10-21T14:45:34Z", "commit": {"oid": "91041235eb35b6b7f6942730c2897fc5a9d25181"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTEzODAxNzM1", "url": "https://github.com/eclipse-openj9/openj9/pull/10852#pullrequestreview-513801735", "createdAt": "2020-10-21T15:14:23Z", "commit": {"oid": "91041235eb35b6b7f6942730c2897fc5a9d25181"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yMVQxNToxNDoyM1rOHlxxcA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yMVQxNToxNDoyM1rOHlxxcA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwOTM3NDgzMg==", "bodyText": "How does this work for ordinary methods? Given an TR::IlGeneratorMethodDetails* instance how does one determine if an ordinary method is an AOT method compilation?", "url": "https://github.com/eclipse-openj9/openj9/pull/10852#discussion_r509374832", "createdAt": "2020-10-21T15:14:23Z", "author": {"login": "fjeremic"}, "path": "runtime/compiler/ilgen/J9IlGeneratorMethodDetails.hpp", "diffHunk": "@@ -105,6 +105,7 @@ class OMR_EXTENSIBLE IlGeneratorMethodDetails : public OMR::IlGeneratorMethodDet\n \n    virtual bool isOrdinaryMethod()     const { return true; }\n    virtual bool isJitDumpMethod()      const { return false; }\n+   virtual bool isJitDumpAOTMethod()   const { return false; }", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "91041235eb35b6b7f6942730c2897fc5a9d25181"}, "originalPosition": 4}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTE0MTY1MTAx", "url": "https://github.com/eclipse-openj9/openj9/pull/10852#pullrequestreview-514165101", "createdAt": "2020-10-21T20:36:00Z", "commit": {"oid": "91041235eb35b6b7f6942730c2897fc5a9d25181"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 142, "cost": 1, "resetAt": "2021-10-28T18:00:02Z"}}}