{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDQ5MDk0ODQ3", "number": 10164, "title": "Eliminate Partial Marking Scheme", "bodyText": "In Balanced GC mode, for most of cases we use Copyforward Scheme\n(the most efficient way)to run Partial Garbage Collection. As a\nbackup, Partial Marking Scheme is designed to run in case we can\nnot run Copyforward Scheme( such as no enough free memory,\nJNICritical region in collection set or For generating enough\nestimate data...). Last year we introduce Copyforward MarkCompact\nHybrid mode, which has capability to mark arbitrary regions and\ncopyforward the rest of regions in collection set during PGC.\nso Copyforward MarkCompact Hybrid reduces possibility to use\nPartial Marking Scheme and also could completely replace Partial\nMarking Scheme.\nThis commit try to eliminate Partial Marking Scheme(replace it\nwith Copyforward MarkCompact Hybrid.\n\n- remove XXgc options tarokEnableCopyForwardMarkCompactHybrid and\ntarokDisableCopyForwardMarkCompactHybrid.\n- remove MM_PartialMarkDelegate, MM_PartialMarkingScheme,\nMM_PartialMarkGMPCardCleaner and MM_PartialMarkNoGMPCardCleaner.\n- keep flag _shouldRunCopyForward(when it is false) for distinguishing\nif we need to mark every collection regions.\n\nSigned-off-by: Lin Hu linhu@ca.ibm.com", "createdAt": "2020-07-14T20:23:17Z", "url": "https://github.com/eclipse-openj9/openj9/pull/10164", "merged": true, "mergeCommit": {"oid": "bda9d1a919fc7b76c94b26692aae8aa4b9a4aaed"}, "closed": true, "closedAt": "2020-08-20T13:46:51Z", "author": {"login": "LinHu2016"}, "timelineItems": {"totalCount": 16, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABc08DCdABqjM1NDU3OTk0MTk=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdAeTf0gBqjM2NzE3MDA1OTc=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "35ef93e9a0a31176bc7e5d7e251dec68bce0b2da", "author": {"user": {"login": "LinHu2016", "name": "Lin Hu"}}, "url": "https://github.com/eclipse-openj9/openj9/commit/35ef93e9a0a31176bc7e5d7e251dec68bce0b2da", "committedDate": "2020-07-14T17:47:33Z", "message": "Eliminate Partial Marking Scheme\n\n\tIn Balanced GC mode, for most of cases we use Copyforward Scheme\n\t(the most efficient way)to run Partial Garbage Collection. As a\n\tbackup, Partial Marking Scheme is designed to run in case we can\n\tnot run Copyforward Scheme( such as no enough free memory,\n\tJNICritical region in collection set or For generating enough\n\testimate data...). Last year we introduce Copyforward MarkCompact\n\tHybrid mode, which has capability to mark arbitrary regions and\n\tcopyforward the rest of regions in collection set during PGC.\n\tso Copyforward MarkCompact Hybrid reduces possibility to use\n\tPartial Marking Scheme and also could completely replace Partial\n\tMarking Scheme.\n\tThis commit try to eliminate Partial Marking Scheme(replace it\n\twith Copyforward MarkCompact Hybrid.\n\n\t- remove XXgc options tarokEnableCopyForwardMarkCompactHybrid and\n\ttarokDisableCopyForwardMarkCompactHybrid.\n\t- remove MM_PartialMarkDelegate, MM_PartialMarkingScheme,\n\tMM_PartialMarkGMPCardCleaner and MM_PartialMarkNoGMPCardCleaner.\n\t- keep flag _shouldRunCopyForward(when it is false) for distinguishing\n\tif we need to mark every collection regions.\n\n\nSigned-off-by: Lin Hu <linhu@ca.ibm.com>"}, "afterCommit": {"oid": "e781f9f0b819be2e787d3b78883c479fa29c1a0f", "author": {"user": {"login": "LinHu2016", "name": "Lin Hu"}}, "url": "https://github.com/eclipse-openj9/openj9/commit/e781f9f0b819be2e787d3b78883c479fa29c1a0f", "committedDate": "2020-07-14T20:27:22Z", "message": "Eliminate Partial Marking Scheme\n\n\tIn Balanced GC mode, for most of cases we use Copyforward Scheme\n\t(the most efficient way)to run Partial Garbage Collection. As a\n\tbackup, Partial Marking Scheme is designed to run in case we can\n\tnot run Copyforward Scheme( such as no enough free memory,\n\tJNICritical region in collection set or For generating enough\n\testimate data...). Last year we introduce Copyforward MarkCompact\n\tHybrid mode, which has capability to mark arbitrary regions and\n\tcopyforward the rest of regions in collection set during PGC.\n\tso Copyforward MarkCompact Hybrid reduces possibility to use\n\tPartial Marking Scheme and also could completely replace Partial\n\tMarking Scheme.\n\tThis commit try to eliminate Partial Marking Scheme(replace it\n\twith Copyforward MarkCompact Hybrid.\n\n\t- remove XXgc options tarokEnableCopyForwardMarkCompactHybrid and\n\ttarokDisableCopyForwardMarkCompactHybrid.\n\t- remove MM_PartialMarkDelegate, MM_PartialMarkingScheme,\n\tMM_PartialMarkGMPCardCleaner and MM_PartialMarkNoGMPCardCleaner.\n\t- keep flag _shouldRunCopyForward(when it is false) for distinguishing\n\tif we need to mark every collection regions.\n\n\nSigned-off-by: Lin Hu <linhu@ca.ibm.com>"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDUzNDYxMDM5", "url": "https://github.com/eclipse-openj9/openj9/pull/10164#pullrequestreview-453461039", "createdAt": "2020-07-22T16:00:22Z", "commit": {"oid": "e781f9f0b819be2e787d3b78883c479fa29c1a0f"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yMlQxNjowMDoyMlrOG1pNbA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yMlQxNjowMDoyMlrOG1pNbA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1ODkwMjg5Mg==", "bodyText": "I presume tarokEnableCopyForwardHybrid flag  will be removed altogether (with a followup OMR change)? if so, referring to it in this comment does not make sense.\nAlso the comment referring to non-CopyForwardHybrid also should be removed, right?\nEven explicitely referring to CopyForwardHybrid (as it will stay as the only mode) is redundant. The whole comment should collapse to:\n\"We allow eden regions, which have jniCritical, to be part of nursery collectionSet; those regions would be marked instead of copyforwarded.\"", "url": "https://github.com/eclipse-openj9/openj9/pull/10164#discussion_r458902892", "createdAt": "2020-07-22T16:00:22Z", "author": {"login": "amicic"}, "path": "runtime/gc_vlhgc/CollectionSetDelegate.cpp", "diffHunk": "@@ -166,7 +166,8 @@ MM_CollectionSetDelegate::createNurseryCollectionSet(MM_EnvironmentVLHGC *env)\n \n \t\t\t/* For CopyForwardHybrid mode we allow eden regions, which has jniCritical,to be part of nursery collectionSet, those regions would be marked instead of copyforwarded.\n \t\t\t * For Non CopyForwardHybrid mode we do not check Eden regions with jniCritical here, because we have already set MarkCompact PGC mode for the case in early. */\n-\t\t\tif (region->getRememberedSetCardList()->isAccurate() && (!isSelectionForCopyForward || !regionHasCriticalRegions || (regionHasCriticalRegions && (_extensions->tarokEnableCopyForwardHybrid || (0 != _extensions->fvtest_forceCopyForwardHybridRatio)) && region->isEden()))) {\n+\t\t\t/* _extensions->tarokEnableCopyForwardHybrid always is true */", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "e781f9f0b819be2e787d3b78883c479fa29c1a0f"}, "originalPosition": 12}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDUzNTA2MTA1", "url": "https://github.com/eclipse-openj9/openj9/pull/10164#pullrequestreview-453506105", "createdAt": "2020-07-22T16:52:14Z", "commit": {"oid": "e781f9f0b819be2e787d3b78883c479fa29c1a0f"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yMlQxNjo1MjoxNFrOG1rdUA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yMlQxNjo1MjoxNFrOG1rdUA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1ODkzOTcyOA==", "bodyText": "I remember discussing this long ago... So we agreed even if real hybrid mode was performed (there was real regions that were Marked) we will gather all relevant stats under _copyForwardStats? I think I'm ok with it, I just want to make sure that's what we agreed on and we stick with the decision everywhere (soft ref stats etc). We should probably state it somewhere in the code as well, as a comment (in declaration of _copyForwardStats in EnvVLHGC?).", "url": "https://github.com/eclipse-openj9/openj9/pull/10164#discussion_r458939728", "createdAt": "2020-07-22T16:52:14Z", "author": {"login": "amicic"}, "path": "runtime/gc_vlhgc/RegionBasedOverflowVLHGC.cpp", "diffHunk": "@@ -224,7 +224,7 @@ MM_RegionBasedOverflowVLHGC::overflowItemInternal(MM_EnvironmentBase *env, void\n \t\t\t\t * To avoid adding constructing object \n \t\t\t\t */\n \t\t\t\tenvVLHGC->getGCEnvironment()->_ownableSynchronizerObjectBuffer->add(envVLHGC, objectPtr);\n-\t\t\t\tif (envVLHGC->_cycleState->_shouldRunCopyForward) {\n+\t\t\t\tif (MM_CycleState::CT_PARTIAL_GARBAGE_COLLECTION == envVLHGC->_cycleState->_collectionType) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "e781f9f0b819be2e787d3b78883c479fa29c1a0f"}, "originalPosition": 5}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDUzNTQzMTIy", "url": "https://github.com/eclipse-openj9/openj9/pull/10164#pullrequestreview-453543122", "createdAt": "2020-07-22T17:41:06Z", "commit": {"oid": "e781f9f0b819be2e787d3b78883c479fa29c1a0f"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yMlQxNzo0MTowNlrOG1tQ2A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yMlQxNzo0MTowNlrOG1tQ2A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1ODk2OTMwNA==", "bodyText": "make this C style comment", "url": "https://github.com/eclipse-openj9/openj9/pull/10164#discussion_r458969304", "createdAt": "2020-07-22T17:41:06Z", "author": {"login": "amicic"}, "path": "runtime/gc_vlhgc/IncrementalGenerationalGC.cpp", "diffHunk": "@@ -2428,39 +2318,14 @@ MM_IncrementalGenerationalGC::reportGlobalGCMarkEnd(MM_EnvironmentBase *env)\n \t\t&static_cast<MM_CycleStateVLHGC*>(env->_cycleState)->_vlhgcIncrementStats._workPacketStats);\n }\n \n-void\n-MM_IncrementalGenerationalGC::reportPGCMarkStart(MM_EnvironmentBase *env)\n-{\n-\treportMarkStart(env);\n-\n-\tTRIGGER_J9HOOK_MM_PRIVATE_PGC_MARK_START(\n-\t\t_extensions->privateHookInterface,\n-\t\tenv->getOmrVMThread(),\n-\t\t&static_cast<MM_CycleStateVLHGC*>(env->_cycleState)->_vlhgcIncrementStats._markStats,\n-\t\t&static_cast<MM_CycleStateVLHGC*>(env->_cycleState)->_vlhgcIncrementStats._workPacketStats);\n-}\n-\n-void\n-MM_IncrementalGenerationalGC::reportPGCMarkEnd(MM_EnvironmentBase *env)\n-{\n-\treportMarkEnd(env);\n-\n-\tTRIGGER_J9HOOK_MM_PRIVATE_PGC_MARK_END(\n-\t\t_extensions->privateHookInterface,\n-\t\tenv->getOmrVMThread(),\n-\t\t&static_cast<MM_CycleStateVLHGC*>(env->_cycleState)->_vlhgcIncrementStats._markStats,\n-\t\t&static_cast<MM_CycleStateVLHGC*>(env->_cycleState)->_vlhgcIncrementStats._workPacketStats,\n-\t\t&static_cast<MM_CycleStateVLHGC*>(env->_cycleState)->_vlhgcIncrementStats._irrsStats);\n-}\n-\n void\n MM_IncrementalGenerationalGC::collectorExpanded(MM_EnvironmentBase *envBase, MM_MemorySubSpace *subSpace, UDATA expandSize)\n {\n \tMM_EnvironmentVLHGC* env = MM_EnvironmentVLHGC::getEnvironment(envBase);\n \n \t/* this even can only happen during a copy-forward PGC */\n \tAssert_MM_true(MM_CycleState::CT_PARTIAL_GARBAGE_COLLECTION == env->_cycleState->_collectionType);\n-\tAssert_MM_true(env->_cycleState->_shouldRunCopyForward);\n+\tAssert_MM_true(env->_cycleState->_shouldRunCopyForward); // if _shouldRunCopyForward == false, it is copyforwardhybrid with all regions need to be marked/compacted, for this case we don't need to collectorExpanded.", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "e781f9f0b819be2e787d3b78883c479fa29c1a0f"}, "originalPosition": 235}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "e781f9f0b819be2e787d3b78883c479fa29c1a0f", "author": {"user": {"login": "LinHu2016", "name": "Lin Hu"}}, "url": "https://github.com/eclipse-openj9/openj9/commit/e781f9f0b819be2e787d3b78883c479fa29c1a0f", "committedDate": "2020-07-14T20:27:22Z", "message": "Eliminate Partial Marking Scheme\n\n\tIn Balanced GC mode, for most of cases we use Copyforward Scheme\n\t(the most efficient way)to run Partial Garbage Collection. As a\n\tbackup, Partial Marking Scheme is designed to run in case we can\n\tnot run Copyforward Scheme( such as no enough free memory,\n\tJNICritical region in collection set or For generating enough\n\testimate data...). Last year we introduce Copyforward MarkCompact\n\tHybrid mode, which has capability to mark arbitrary regions and\n\tcopyforward the rest of regions in collection set during PGC.\n\tso Copyforward MarkCompact Hybrid reduces possibility to use\n\tPartial Marking Scheme and also could completely replace Partial\n\tMarking Scheme.\n\tThis commit try to eliminate Partial Marking Scheme(replace it\n\twith Copyforward MarkCompact Hybrid.\n\n\t- remove XXgc options tarokEnableCopyForwardMarkCompactHybrid and\n\ttarokDisableCopyForwardMarkCompactHybrid.\n\t- remove MM_PartialMarkDelegate, MM_PartialMarkingScheme,\n\tMM_PartialMarkGMPCardCleaner and MM_PartialMarkNoGMPCardCleaner.\n\t- keep flag _shouldRunCopyForward(when it is false) for distinguishing\n\tif we need to mark every collection regions.\n\n\nSigned-off-by: Lin Hu <linhu@ca.ibm.com>"}, "afterCommit": {"oid": "9ba9feaa6be17bc504a70bb2d49f9968add11bf5", "author": {"user": {"login": "LinHu2016", "name": "Lin Hu"}}, "url": "https://github.com/eclipse-openj9/openj9/commit/9ba9feaa6be17bc504a70bb2d49f9968add11bf5", "committedDate": "2020-07-23T14:41:18Z", "message": "Eliminate Partial Marking Scheme\n\n\tIn Balanced GC mode, for most of cases we use Copyforward Scheme\n\t(the most efficient way)to run Partial Garbage Collection. As a\n\tbackup, Partial Marking Scheme is designed to run in case we can\n\tnot run Copyforward Scheme( such as no enough free memory,\n\tJNICritical region in collection set or For generating enough\n\testimate data...). Last year we introduce Copyforward MarkCompact\n\tHybrid mode, which has capability to mark arbitrary regions and\n\tcopyforward the rest of regions in collection set during PGC.\n\tso Copyforward MarkCompact Hybrid reduces possibility to use\n\tPartial Marking Scheme and also could completely replace Partial\n\tMarking Scheme.\n\tThis commit try to eliminate Partial Marking Scheme(replace it\n\twith Copyforward MarkCompact Hybrid.\n\n\t- remove XXgc options tarokEnableCopyForwardMarkCompactHybrid and\n\ttarokDisableCopyForwardMarkCompactHybrid.\n\t- remove MM_PartialMarkDelegate, MM_PartialMarkingScheme,\n\tMM_PartialMarkGMPCardCleaner and MM_PartialMarkNoGMPCardCleaner.\n\t- keep flag _shouldRunCopyForward(when it is false) for distinguishing\n\tif we need to mark every collection regions.\n\n\nSigned-off-by: Lin Hu <linhu@ca.ibm.com>"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "9ba9feaa6be17bc504a70bb2d49f9968add11bf5", "author": {"user": {"login": "LinHu2016", "name": "Lin Hu"}}, "url": "https://github.com/eclipse-openj9/openj9/commit/9ba9feaa6be17bc504a70bb2d49f9968add11bf5", "committedDate": "2020-07-23T14:41:18Z", "message": "Eliminate Partial Marking Scheme\n\n\tIn Balanced GC mode, for most of cases we use Copyforward Scheme\n\t(the most efficient way)to run Partial Garbage Collection. As a\n\tbackup, Partial Marking Scheme is designed to run in case we can\n\tnot run Copyforward Scheme( such as no enough free memory,\n\tJNICritical region in collection set or For generating enough\n\testimate data...). Last year we introduce Copyforward MarkCompact\n\tHybrid mode, which has capability to mark arbitrary regions and\n\tcopyforward the rest of regions in collection set during PGC.\n\tso Copyforward MarkCompact Hybrid reduces possibility to use\n\tPartial Marking Scheme and also could completely replace Partial\n\tMarking Scheme.\n\tThis commit try to eliminate Partial Marking Scheme(replace it\n\twith Copyforward MarkCompact Hybrid.\n\n\t- remove XXgc options tarokEnableCopyForwardMarkCompactHybrid and\n\ttarokDisableCopyForwardMarkCompactHybrid.\n\t- remove MM_PartialMarkDelegate, MM_PartialMarkingScheme,\n\tMM_PartialMarkGMPCardCleaner and MM_PartialMarkNoGMPCardCleaner.\n\t- keep flag _shouldRunCopyForward(when it is false) for distinguishing\n\tif we need to mark every collection regions.\n\n\nSigned-off-by: Lin Hu <linhu@ca.ibm.com>"}, "afterCommit": {"oid": "ee27b7ade8b163623c21f346bce7f67fd34aa6c4", "author": {"user": {"login": "LinHu2016", "name": "Lin Hu"}}, "url": "https://github.com/eclipse-openj9/openj9/commit/ee27b7ade8b163623c21f346bce7f67fd34aa6c4", "committedDate": "2020-07-23T17:52:26Z", "message": "Eliminate Partial Marking Scheme\n\n\tIn Balanced GC mode, for most of cases we use Copyforward Scheme\n\t(the most efficient way)to run Partial Garbage Collection. As a\n\tbackup, Partial Marking Scheme is designed to run in case we can\n\tnot run Copyforward Scheme( such as no enough free memory,\n\tJNICritical region in collection set or For generating enough\n\testimate data...). Last year we introduce Copyforward MarkCompact\n\tHybrid mode, which has capability to mark arbitrary regions and\n\tcopyforward the rest of regions in collection set during PGC.\n\tso Copyforward MarkCompact Hybrid reduces possibility to use\n\tPartial Marking Scheme and also could completely replace Partial\n\tMarking Scheme.\n\tThis commit try to eliminate Partial Marking Scheme(replace it\n\twith Copyforward MarkCompact Hybrid.\n\n\t- remove XXgc options tarokEnableCopyForwardMarkCompactHybrid and\n\ttarokDisableCopyForwardMarkCompactHybrid.\n\t- remove MM_PartialMarkDelegate, MM_PartialMarkingScheme,\n\tMM_PartialMarkGMPCardCleaner and MM_PartialMarkNoGMPCardCleaner.\n\t- keep flag _shouldRunCopyForward(when it is false) for distinguishing\n\tif we need to mark every collection regions.\n\n\nSigned-off-by: Lin Hu <linhu@ca.ibm.com>"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "ee27b7ade8b163623c21f346bce7f67fd34aa6c4", "author": {"user": {"login": "LinHu2016", "name": "Lin Hu"}}, "url": "https://github.com/eclipse-openj9/openj9/commit/ee27b7ade8b163623c21f346bce7f67fd34aa6c4", "committedDate": "2020-07-23T17:52:26Z", "message": "Eliminate Partial Marking Scheme\n\n\tIn Balanced GC mode, for most of cases we use Copyforward Scheme\n\t(the most efficient way)to run Partial Garbage Collection. As a\n\tbackup, Partial Marking Scheme is designed to run in case we can\n\tnot run Copyforward Scheme( such as no enough free memory,\n\tJNICritical region in collection set or For generating enough\n\testimate data...). Last year we introduce Copyforward MarkCompact\n\tHybrid mode, which has capability to mark arbitrary regions and\n\tcopyforward the rest of regions in collection set during PGC.\n\tso Copyforward MarkCompact Hybrid reduces possibility to use\n\tPartial Marking Scheme and also could completely replace Partial\n\tMarking Scheme.\n\tThis commit try to eliminate Partial Marking Scheme(replace it\n\twith Copyforward MarkCompact Hybrid.\n\n\t- remove XXgc options tarokEnableCopyForwardMarkCompactHybrid and\n\ttarokDisableCopyForwardMarkCompactHybrid.\n\t- remove MM_PartialMarkDelegate, MM_PartialMarkingScheme,\n\tMM_PartialMarkGMPCardCleaner and MM_PartialMarkNoGMPCardCleaner.\n\t- keep flag _shouldRunCopyForward(when it is false) for distinguishing\n\tif we need to mark every collection regions.\n\n\nSigned-off-by: Lin Hu <linhu@ca.ibm.com>"}, "afterCommit": {"oid": "347e170b9fbe331a44cfcd3133014ded90055015", "author": {"user": {"login": "LinHu2016", "name": "Lin Hu"}}, "url": "https://github.com/eclipse-openj9/openj9/commit/347e170b9fbe331a44cfcd3133014ded90055015", "committedDate": "2020-07-24T14:37:07Z", "message": "Eliminate Partial Marking Scheme\n\n\tIn Balanced GC mode, for most of cases we use Copyforward Scheme\n\t(the most efficient way)to run Partial Garbage Collection. As a\n\tbackup, Partial Marking Scheme is designed to run in case we can\n\tnot run Copyforward Scheme( such as no enough free memory,\n\tJNICritical region in collection set or For generating enough\n\testimate data...). Last year we introduce Copyforward MarkCompact\n\tHybrid mode, which has capability to mark arbitrary regions and\n\tcopyforward the rest of regions in collection set during PGC.\n\tso Copyforward MarkCompact Hybrid reduces possibility to use\n\tPartial Marking Scheme and also could completely replace Partial\n\tMarking Scheme.\n\tThis commit try to eliminate Partial Marking Scheme(replace it\n\twith Copyforward MarkCompact Hybrid.\n\n\t- remove XXgc options tarokEnableCopyForwardMarkCompactHybrid and\n\ttarokDisableCopyForwardMarkCompactHybrid.\n\t- remove MM_PartialMarkDelegate, MM_PartialMarkingScheme,\n\tMM_PartialMarkGMPCardCleaner and MM_PartialMarkNoGMPCardCleaner.\n\t- keep flag _shouldRunCopyForward(when it is false) for distinguishing\n\tif we need to mark every collection regions.\n\n\nSigned-off-by: Lin Hu <linhu@ca.ibm.com>"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDU4NTUxMDQ1", "url": "https://github.com/eclipse-openj9/openj9/pull/10164#pullrequestreview-458551045", "createdAt": "2020-07-30T16:10:30Z", "commit": {"oid": "347e170b9fbe331a44cfcd3133014ded90055015"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDU4NTkxMjYy", "url": "https://github.com/eclipse-openj9/openj9/pull/10164#pullrequestreview-458591262", "createdAt": "2020-07-30T17:01:38Z", "commit": {"oid": "347e170b9fbe331a44cfcd3133014ded90055015"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0zMFQxNzowMTozOFrOG5r7Ew==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0zMFQxNzowMTozOFrOG5r7Ew==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MzE0MTY1MQ==", "bodyText": "please fix alignment for lines below (shift left)", "url": "https://github.com/eclipse-openj9/openj9/pull/10164#discussion_r463141651", "createdAt": "2020-07-30T17:01:38Z", "author": {"login": "dmitripivkine"}, "path": "runtime/gc_vlhgc/IncrementalGenerationalGC.cpp", "diffHunk": "@@ -555,8 +548,6 @@ MM_IncrementalGenerationalGC::heapAddRange(MM_EnvironmentBase *env, MM_MemorySub\n \tif (result) {\n \t\tresult = _globalMarkDelegate.heapAddRange(envVLHGC, subspace, size, lowAddress, highAddress);\n \t\tif (result) {\n-\t\t\tresult = _partialMarkDelegate.heapAddRange(envVLHGC, subspace, size, lowAddress, highAddress);\n-\t\t\tif (result) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "347e170b9fbe331a44cfcd3133014ded90055015"}, "originalPosition": 33}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDU4NTkzMjc0", "url": "https://github.com/eclipse-openj9/openj9/pull/10164#pullrequestreview-458593274", "createdAt": "2020-07-30T17:04:14Z", "commit": {"oid": "347e170b9fbe331a44cfcd3133014ded90055015"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0zMFQxNzowNDoxNFrOG5sA4g==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0zMFQxNzowNDoxNFrOG5sA4g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MzE0MzEzOA==", "bodyText": "please fix alignment for this line (shift right)", "url": "https://github.com/eclipse-openj9/openj9/pull/10164#discussion_r463143138", "createdAt": "2020-07-30T17:04:14Z", "author": {"login": "dmitripivkine"}, "path": "runtime/gc_vlhgc/IncrementalGenerationalGC.cpp", "diffHunk": "@@ -1326,8 +1286,8 @@ MM_IncrementalGenerationalGC::partialGarbageCollectUsingCopyForward(MM_Environme\n \t\testimatedReguiredSurvivorRegions = estimatedReguiredSurvivorRegions * (100 - extensions->fvtest_forceCopyForwardHybridRatio) / 100;\n \t}\n \n-\tif ((_extensions->tarokEnableCopyForwardHybrid || (0 != _extensions->fvtest_forceCopyForwardHybridRatio)) && (_schedulingDelegate.isPGCAbortDuringGMP() || _schedulingDelegate.isFirstPGCAfterGMP()) && (estimatedReguiredSurvivorRegions > freeRegions)) {\n-\t\tdouble edenSurvivorRate = _schedulingDelegate.getAvgEdenSurvivalRateCopyForward(env);\n+\tif ((_schedulingDelegate.isPGCAbortDuringGMP() || _schedulingDelegate.isFirstPGCAfterGMP()) && (estimatedReguiredSurvivorRegions > freeRegions)) {\n+\tdouble edenSurvivorRate = _schedulingDelegate.getAvgEdenSurvivalRateCopyForward(env);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "347e170b9fbe331a44cfcd3133014ded90055015"}, "originalPosition": 117}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDU4NTk3MjAx", "url": "https://github.com/eclipse-openj9/openj9/pull/10164#pullrequestreview-458597201", "createdAt": "2020-07-30T17:09:43Z", "commit": {"oid": "347e170b9fbe331a44cfcd3133014ded90055015"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "347e170b9fbe331a44cfcd3133014ded90055015", "author": {"user": {"login": "LinHu2016", "name": "Lin Hu"}}, "url": "https://github.com/eclipse-openj9/openj9/commit/347e170b9fbe331a44cfcd3133014ded90055015", "committedDate": "2020-07-24T14:37:07Z", "message": "Eliminate Partial Marking Scheme\n\n\tIn Balanced GC mode, for most of cases we use Copyforward Scheme\n\t(the most efficient way)to run Partial Garbage Collection. As a\n\tbackup, Partial Marking Scheme is designed to run in case we can\n\tnot run Copyforward Scheme( such as no enough free memory,\n\tJNICritical region in collection set or For generating enough\n\testimate data...). Last year we introduce Copyforward MarkCompact\n\tHybrid mode, which has capability to mark arbitrary regions and\n\tcopyforward the rest of regions in collection set during PGC.\n\tso Copyforward MarkCompact Hybrid reduces possibility to use\n\tPartial Marking Scheme and also could completely replace Partial\n\tMarking Scheme.\n\tThis commit try to eliminate Partial Marking Scheme(replace it\n\twith Copyforward MarkCompact Hybrid.\n\n\t- remove XXgc options tarokEnableCopyForwardMarkCompactHybrid and\n\ttarokDisableCopyForwardMarkCompactHybrid.\n\t- remove MM_PartialMarkDelegate, MM_PartialMarkingScheme,\n\tMM_PartialMarkGMPCardCleaner and MM_PartialMarkNoGMPCardCleaner.\n\t- keep flag _shouldRunCopyForward(when it is false) for distinguishing\n\tif we need to mark every collection regions.\n\n\nSigned-off-by: Lin Hu <linhu@ca.ibm.com>"}, "afterCommit": {"oid": "eb9c6cc778c571b185aa90760f990ad5926cdde1", "author": {"user": {"login": "LinHu2016", "name": "Lin Hu"}}, "url": "https://github.com/eclipse-openj9/openj9/commit/eb9c6cc778c571b185aa90760f990ad5926cdde1", "committedDate": "2020-08-04T12:55:54Z", "message": "Eliminate Partial Marking Scheme\n\n\tIn Balanced GC mode, for most of cases we use Copyforward Scheme\n\t(the most efficient way)to run Partial Garbage Collection. As a\n\tbackup, Partial Marking Scheme is designed to run in case we can\n\tnot run Copyforward Scheme( such as no enough free memory,\n\tJNICritical region in collection set or For generating enough\n\testimate data...). Last year we introduce Copyforward MarkCompact\n\tHybrid mode, which has capability to mark arbitrary regions and\n\tcopyforward the rest of regions in collection set during PGC.\n\tso Copyforward MarkCompact Hybrid reduces possibility to use\n\tPartial Marking Scheme and also could completely replace Partial\n\tMarking Scheme.\n\tThis commit try to eliminate Partial Marking Scheme(replace it\n\twith Copyforward MarkCompact Hybrid.\n\n\t- remove XXgc options tarokEnableCopyForwardMarkCompactHybrid and\n\ttarokDisableCopyForwardMarkCompactHybrid.\n\t- remove MM_PartialMarkDelegate, MM_PartialMarkingScheme,\n\tMM_PartialMarkGMPCardCleaner and MM_PartialMarkNoGMPCardCleaner.\n\t- keep flag _shouldRunCopyForward(when it is false) for distinguishing\n\tif we need to mark every collection regions.\n\n\nSigned-off-by: Lin Hu <linhu@ca.ibm.com>"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "eb9c6cc778c571b185aa90760f990ad5926cdde1", "author": {"user": {"login": "LinHu2016", "name": "Lin Hu"}}, "url": "https://github.com/eclipse-openj9/openj9/commit/eb9c6cc778c571b185aa90760f990ad5926cdde1", "committedDate": "2020-08-04T12:55:54Z", "message": "Eliminate Partial Marking Scheme\n\n\tIn Balanced GC mode, for most of cases we use Copyforward Scheme\n\t(the most efficient way)to run Partial Garbage Collection. As a\n\tbackup, Partial Marking Scheme is designed to run in case we can\n\tnot run Copyforward Scheme( such as no enough free memory,\n\tJNICritical region in collection set or For generating enough\n\testimate data...). Last year we introduce Copyforward MarkCompact\n\tHybrid mode, which has capability to mark arbitrary regions and\n\tcopyforward the rest of regions in collection set during PGC.\n\tso Copyforward MarkCompact Hybrid reduces possibility to use\n\tPartial Marking Scheme and also could completely replace Partial\n\tMarking Scheme.\n\tThis commit try to eliminate Partial Marking Scheme(replace it\n\twith Copyforward MarkCompact Hybrid.\n\n\t- remove XXgc options tarokEnableCopyForwardMarkCompactHybrid and\n\ttarokDisableCopyForwardMarkCompactHybrid.\n\t- remove MM_PartialMarkDelegate, MM_PartialMarkingScheme,\n\tMM_PartialMarkGMPCardCleaner and MM_PartialMarkNoGMPCardCleaner.\n\t- keep flag _shouldRunCopyForward(when it is false) for distinguishing\n\tif we need to mark every collection regions.\n\n\nSigned-off-by: Lin Hu <linhu@ca.ibm.com>"}, "afterCommit": {"oid": "1bbae1631620ace3bd5e8e43cd243996b63d1ca0", "author": {"user": {"login": "LinHu2016", "name": "Lin Hu"}}, "url": "https://github.com/eclipse-openj9/openj9/commit/1bbae1631620ace3bd5e8e43cd243996b63d1ca0", "committedDate": "2020-08-04T13:01:56Z", "message": "Eliminate Partial Marking Scheme\n\n\tIn Balanced GC mode, for most of cases we use Copyforward Scheme\n\t(the most efficient way)to run Partial Garbage Collection. As a\n\tbackup, Partial Marking Scheme is designed to run in case we can\n\tnot run Copyforward Scheme( such as no enough free memory,\n\tJNICritical region in collection set or For generating enough\n\testimate data...). Last year we introduce Copyforward MarkCompact\n\tHybrid mode, which has capability to mark arbitrary regions and\n\tcopyforward the rest of regions in collection set during PGC.\n\tso Copyforward MarkCompact Hybrid reduces possibility to use\n\tPartial Marking Scheme and also could completely replace Partial\n\tMarking Scheme.\n\tThis commit try to eliminate Partial Marking Scheme(replace it\n\twith Copyforward MarkCompact Hybrid.\n\n\t- remove XXgc options tarokEnableCopyForwardMarkCompactHybrid and\n\ttarokDisableCopyForwardMarkCompactHybrid.\n\t- remove MM_PartialMarkDelegate, MM_PartialMarkingScheme,\n\tMM_PartialMarkGMPCardCleaner and MM_PartialMarkNoGMPCardCleaner.\n\t- keep flag _shouldRunCopyForward(when it is false) for distinguishing\n\tif we need to mark every collection regions.\n\n\nSigned-off-by: Lin Hu <linhu@ca.ibm.com>"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "1bbae1631620ace3bd5e8e43cd243996b63d1ca0", "author": {"user": {"login": "LinHu2016", "name": "Lin Hu"}}, "url": "https://github.com/eclipse-openj9/openj9/commit/1bbae1631620ace3bd5e8e43cd243996b63d1ca0", "committedDate": "2020-08-04T13:01:56Z", "message": "Eliminate Partial Marking Scheme\n\n\tIn Balanced GC mode, for most of cases we use Copyforward Scheme\n\t(the most efficient way)to run Partial Garbage Collection. As a\n\tbackup, Partial Marking Scheme is designed to run in case we can\n\tnot run Copyforward Scheme( such as no enough free memory,\n\tJNICritical region in collection set or For generating enough\n\testimate data...). Last year we introduce Copyforward MarkCompact\n\tHybrid mode, which has capability to mark arbitrary regions and\n\tcopyforward the rest of regions in collection set during PGC.\n\tso Copyforward MarkCompact Hybrid reduces possibility to use\n\tPartial Marking Scheme and also could completely replace Partial\n\tMarking Scheme.\n\tThis commit try to eliminate Partial Marking Scheme(replace it\n\twith Copyforward MarkCompact Hybrid.\n\n\t- remove XXgc options tarokEnableCopyForwardMarkCompactHybrid and\n\ttarokDisableCopyForwardMarkCompactHybrid.\n\t- remove MM_PartialMarkDelegate, MM_PartialMarkingScheme,\n\tMM_PartialMarkGMPCardCleaner and MM_PartialMarkNoGMPCardCleaner.\n\t- keep flag _shouldRunCopyForward(when it is false) for distinguishing\n\tif we need to mark every collection regions.\n\n\nSigned-off-by: Lin Hu <linhu@ca.ibm.com>"}, "afterCommit": {"oid": "a1986bac26a6ed2ae20d8d93105875a8e13cf7f8", "author": {"user": {"login": "LinHu2016", "name": "Lin Hu"}}, "url": "https://github.com/eclipse-openj9/openj9/commit/a1986bac26a6ed2ae20d8d93105875a8e13cf7f8", "committedDate": "2020-08-19T13:46:37Z", "message": "Eliminate Partial Marking Scheme\n\n\tIn Balanced GC mode, for most of cases we use Copyforward Scheme\n\t(the most efficient way)to run Partial Garbage Collection. As a\n\tbackup, Partial Marking Scheme is designed to run in case we can\n\tnot run Copyforward Scheme( such as no enough free memory,\n\tJNICritical region in collection set or For generating enough\n\testimate data...). Last year we introduce Copyforward MarkCompact\n\tHybrid mode, which has capability to mark arbitrary regions and\n\tcopyforward the rest of regions in collection set during PGC.\n\tso Copyforward MarkCompact Hybrid reduces possibility to use\n\tPartial Marking Scheme and also could completely replace Partial\n\tMarking Scheme.\n\tThis commit try to eliminate Partial Marking Scheme(replace it\n\twith Copyforward MarkCompact Hybrid.\n\n\t- remove XXgc options tarokEnableCopyForwardMarkCompactHybrid and\n\ttarokDisableCopyForwardMarkCompactHybrid.\n\t- remove MM_PartialMarkDelegate, MM_PartialMarkingScheme,\n\tMM_PartialMarkGMPCardCleaner and MM_PartialMarkNoGMPCardCleaner.\n\t- keep flag _shouldRunCopyForward(when it is false) for distinguishing\n\tif we need to mark every collection regions.\n\n\nSigned-off-by: Lin Hu <linhu@ca.ibm.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "09cfd724aa3ebbc5a8169721aa26c7064f369e78", "author": {"user": {"login": "LinHu2016", "name": "Lin Hu"}}, "url": "https://github.com/eclipse-openj9/openj9/commit/09cfd724aa3ebbc5a8169721aa26c7064f369e78", "committedDate": "2020-08-19T16:35:01Z", "message": "Eliminate Partial Marking Scheme\n\n\tIn Balanced GC mode, for most of cases we use Copyforward Scheme\n\t(the most efficient way)to run Partial Garbage Collection. As a\n\tbackup, Partial Marking Scheme is designed to run in case we can\n\tnot run Copyforward Scheme( such as no enough free memory,\n\tJNICritical region in collection set or For generating enough\n\testimate data...). Last year we introduce Copyforward MarkCompact\n\tHybrid mode, which has capability to mark arbitrary regions and\n\tcopyforward the rest of regions in collection set during PGC.\n\tso Copyforward MarkCompact Hybrid reduces possibility to use\n\tPartial Marking Scheme and also could completely replace Partial\n\tMarking Scheme.\n\tThis commit try to eliminate Partial Marking Scheme(replace it\n\twith Copyforward MarkCompact Hybrid.\n\n\t- remove XXgc options tarokEnableCopyForwardMarkCompactHybrid and\n\ttarokDisableCopyForwardMarkCompactHybrid.\n\t- remove MM_PartialMarkDelegate, MM_PartialMarkingScheme,\n\tMM_PartialMarkGMPCardCleaner and MM_PartialMarkNoGMPCardCleaner.\n\t- keep flag _shouldRunCopyForward(when it is false) for distinguishing\n\tif we need to mark every collection regions.\n\n\nSigned-off-by: Lin Hu <linhu@ca.ibm.com>"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "a1986bac26a6ed2ae20d8d93105875a8e13cf7f8", "author": {"user": {"login": "LinHu2016", "name": "Lin Hu"}}, "url": "https://github.com/eclipse-openj9/openj9/commit/a1986bac26a6ed2ae20d8d93105875a8e13cf7f8", "committedDate": "2020-08-19T13:46:37Z", "message": "Eliminate Partial Marking Scheme\n\n\tIn Balanced GC mode, for most of cases we use Copyforward Scheme\n\t(the most efficient way)to run Partial Garbage Collection. As a\n\tbackup, Partial Marking Scheme is designed to run in case we can\n\tnot run Copyforward Scheme( such as no enough free memory,\n\tJNICritical region in collection set or For generating enough\n\testimate data...). Last year we introduce Copyforward MarkCompact\n\tHybrid mode, which has capability to mark arbitrary regions and\n\tcopyforward the rest of regions in collection set during PGC.\n\tso Copyforward MarkCompact Hybrid reduces possibility to use\n\tPartial Marking Scheme and also could completely replace Partial\n\tMarking Scheme.\n\tThis commit try to eliminate Partial Marking Scheme(replace it\n\twith Copyforward MarkCompact Hybrid.\n\n\t- remove XXgc options tarokEnableCopyForwardMarkCompactHybrid and\n\ttarokDisableCopyForwardMarkCompactHybrid.\n\t- remove MM_PartialMarkDelegate, MM_PartialMarkingScheme,\n\tMM_PartialMarkGMPCardCleaner and MM_PartialMarkNoGMPCardCleaner.\n\t- keep flag _shouldRunCopyForward(when it is false) for distinguishing\n\tif we need to mark every collection regions.\n\n\nSigned-off-by: Lin Hu <linhu@ca.ibm.com>"}, "afterCommit": {"oid": "09cfd724aa3ebbc5a8169721aa26c7064f369e78", "author": {"user": {"login": "LinHu2016", "name": "Lin Hu"}}, "url": "https://github.com/eclipse-openj9/openj9/commit/09cfd724aa3ebbc5a8169721aa26c7064f369e78", "committedDate": "2020-08-19T16:35:01Z", "message": "Eliminate Partial Marking Scheme\n\n\tIn Balanced GC mode, for most of cases we use Copyforward Scheme\n\t(the most efficient way)to run Partial Garbage Collection. As a\n\tbackup, Partial Marking Scheme is designed to run in case we can\n\tnot run Copyforward Scheme( such as no enough free memory,\n\tJNICritical region in collection set or For generating enough\n\testimate data...). Last year we introduce Copyforward MarkCompact\n\tHybrid mode, which has capability to mark arbitrary regions and\n\tcopyforward the rest of regions in collection set during PGC.\n\tso Copyforward MarkCompact Hybrid reduces possibility to use\n\tPartial Marking Scheme and also could completely replace Partial\n\tMarking Scheme.\n\tThis commit try to eliminate Partial Marking Scheme(replace it\n\twith Copyforward MarkCompact Hybrid.\n\n\t- remove XXgc options tarokEnableCopyForwardMarkCompactHybrid and\n\ttarokDisableCopyForwardMarkCompactHybrid.\n\t- remove MM_PartialMarkDelegate, MM_PartialMarkingScheme,\n\tMM_PartialMarkGMPCardCleaner and MM_PartialMarkNoGMPCardCleaner.\n\t- keep flag _shouldRunCopyForward(when it is false) for distinguishing\n\tif we need to mark every collection regions.\n\n\nSigned-off-by: Lin Hu <linhu@ca.ibm.com>"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 280, "cost": 1, "resetAt": "2021-10-28T17:48:14Z"}}}