{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDQ0OTcxOTE4", "number": 10095, "reviewThreads": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0yM1QyMDozMjoxMVrOFIuqgQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wMS0wNlQxODoyMTo0MVrOFL2sAA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzQ0Njk3NDczOnYy", "diffSide": "RIGHT", "path": "runtime/verbose/verbose.c", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0yM1QyMDozMjoxMVrOIK0OkA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0yM1QyMDozMjoxMVrOIK0OkA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0ODIxMjM2OA==", "bodyText": "This memory needs to be freed when it doesn't fit into the buffer.", "url": "https://github.com/eclipse-openj9/openj9/pull/10095#discussion_r548212368", "createdAt": "2020-12-23T20:32:11Z", "author": {"login": "pshipton"}, "path": "runtime/verbose/verbose.c", "diffHunk": "@@ -1333,6 +1360,46 @@ verboseStackMapFrameVerification(J9HookInterface** hook, UDATA eventNum, void* e\n \treleaseVerboseVerificationBuffer(PORTLIB, &buf, byteArray);\n }\n \n+#if (JAVA_SPEC_VERSION >= 11)\n+static void\n+printModule(J9VMThread* vmThread, char* message, J9Module* module)\n+{\n+\tchar moduleNameBuf[J9VM_PACKAGE_NAME_BUFFER_LENGTH];\n+\tchar *moduleNameUTF = NULL;\n+\tJ9UTF8 *jrtURL = NULL;\n+\tchar* template = \"%s: %s from: %.*s\\n\";\n+\n+\tPORT_ACCESS_FROM_VMC(vmThread);\n+\n+\t/* module name */\n+\tmoduleNameUTF = vmThread->javaVM->internalVMFunctions->copyStringToUTF8WithMemAlloc(", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b08ef1cb7509a616a634b0b02b78a498e1da272c"}, "originalPosition": 78}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzQ0Njk5MDQ5OnYy", "diffSide": "RIGHT", "path": "runtime/verbose/verbose.c", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0yM1QyMDozNTozNVrOIK0YuQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0yM1QyMDozNTozNVrOIK0YuQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0ODIxNDk2OQ==", "bodyText": "I don't understand why this case is needed. It seems the hooks are only registered when VERBOSE_SETTINGS_SET, and registering occurs after parsing all the options, so there is no case when the hooks need to be unregistered. parseVerboseArgumentList() is only called once, and registering the hooks isn't inside a loop.", "url": "https://github.com/eclipse-openj9/openj9/pull/10095#discussion_r548214969", "createdAt": "2020-12-23T20:35:35Z", "author": {"login": "pshipton"}, "path": "runtime/verbose/verbose.c", "diffHunk": "@@ -1122,6 +1136,19 @@ setVerboseState( J9JavaVM *vm, J9VerboseSettings *verboseOptions, char **errorSt\n \t\tvm->verboseStruct->getCfrExceptionDetails = generateJ9CfrExceptionDetails;\n \t\tvm->verboseStruct->getRtvExceptionDetails = generateJ9RtvExceptionDetails;\n \t}\n+\n+#if (JAVA_SPEC_VERSION >= 11)\n+\tif (VERBOSE_SETTINGS_CLEAR == verboseOptions->module) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b08ef1cb7509a616a634b0b02b78a498e1da272c"}, "originalPosition": 48}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzQ0NzA0MTA3OnYy", "diffSide": "RIGHT", "path": "test/functional/cmdLineTests/verbosetest/playlist.xml", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0yM1QyMDo0NjozMFrOIK05KA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0yM1QyMDo0NjozMFrOIK05KA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0ODIyMzI3Mg==", "bodyText": "We don't need to test all these modes. The code doesn't depend on JIT modes, GC policy, compressed or non-compressed. Testing NoOptions should be sufficient.", "url": "https://github.com/eclipse-openj9/openj9/pull/10095#discussion_r548223272", "createdAt": "2020-12-23T20:46:30Z", "author": {"login": "pshipton"}, "path": "test/functional/cmdLineTests/verbosetest/playlist.xml", "diffHunk": "@@ -49,4 +49,34 @@\n \t\t\t<impl>ibm</impl>\n \t\t</impls>\n \t</test>\n+\n+\t<test>\n+\t\t<testCaseName>cmdLineTester_verbosetest_11</testCaseName>\n+\t\t<variations>\n+\t\t\t<variation>NoOptions</variation>\n+\t\t\t<variation>Mode501</variation>", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b08ef1cb7509a616a634b0b02b78a498e1da272c"}, "originalPosition": 18}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzQ3OTc0NjU2OnYy", "diffSide": "RIGHT", "path": "runtime/verbose/verbose.c", "isResolved": true, "comments": {"totalCount": 8, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wMS0wNlQxODoyMTo0MVrOIPRbsg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wMS0wNlQyMjo1ODo0MlrOIPY22A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1Mjg4NTE3MA==", "bodyText": "Is setting VERBOSE_SETTINGS_IGNORE or VERBOSE_SETTINGS_CLEAR still needed, I don't see these used.", "url": "https://github.com/eclipse-openj9/openj9/pull/10095#discussion_r552885170", "createdAt": "2021-01-06T18:21:41Z", "author": {"login": "pshipton"}, "path": "runtime/verbose/verbose.c", "diffHunk": "@@ -633,6 +641,12 @@ parseVerboseArgument(char* options, J9VerboseSettings* verboseOptions, char** er\n \t\t\tverboseOptions->relocations = VERBOSE_SETTINGS_SET;\n \t\t} else if(strcmp(options, OPT_ROMCLASS)==0) {\n \t\t\tverboseOptions->romclass = VERBOSE_SETTINGS_SET;\n+#if (JAVA_SPEC_VERSION >= 11)\n+\t\t} else if(strcmp(options, OPT_NOMODULE)==0) {\n+\t\t\tverboseOptions->module = (VERBOSE_SETTINGS_SET == verboseOptions->module) ? VERBOSE_SETTINGS_IGNORE: VERBOSE_SETTINGS_CLEAR;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ea4cc4ecbe444e557e236b00c774eb79f55003f0"}, "originalPosition": 35}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1MjkxMjIyNw==", "bodyText": "The reason it's needed for nogc and noclass is to support enabling/disabling verbose output at runtime.\nhttps://docs.oracle.com/javase/8/docs/api/java/lang/management/ClassLoadingMXBean.html#setVerbose-boolean-\nhttps://docs.oracle.com/en/java/javase/11/docs/specs/jvmti.html#SetVerboseFlag", "url": "https://github.com/eclipse-openj9/openj9/pull/10095#discussion_r552912227", "createdAt": "2021-01-06T19:14:41Z", "author": {"login": "pshipton"}, "path": "runtime/verbose/verbose.c", "diffHunk": "@@ -633,6 +641,12 @@ parseVerboseArgument(char* options, J9VerboseSettings* verboseOptions, char** er\n \t\t\tverboseOptions->relocations = VERBOSE_SETTINGS_SET;\n \t\t} else if(strcmp(options, OPT_ROMCLASS)==0) {\n \t\t\tverboseOptions->romclass = VERBOSE_SETTINGS_SET;\n+#if (JAVA_SPEC_VERSION >= 11)\n+\t\t} else if(strcmp(options, OPT_NOMODULE)==0) {\n+\t\t\tverboseOptions->module = (VERBOSE_SETTINGS_SET == verboseOptions->module) ? VERBOSE_SETTINGS_IGNORE: VERBOSE_SETTINGS_CLEAR;", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1Mjg4NTE3MA=="}, "originalCommit": {"oid": "ea4cc4ecbe444e557e236b00c774eb79f55003f0"}, "originalPosition": 35}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1Mjk4NDAxMw==", "bodyText": "Thanks I removed that line. The OPT_MODULE input is there so that verbose:nomodule is recognized to match with hotspot.", "url": "https://github.com/eclipse-openj9/openj9/pull/10095#discussion_r552984013", "createdAt": "2021-01-06T22:05:00Z", "author": {"login": "theresa-m"}, "path": "runtime/verbose/verbose.c", "diffHunk": "@@ -633,6 +641,12 @@ parseVerboseArgument(char* options, J9VerboseSettings* verboseOptions, char** er\n \t\t\tverboseOptions->relocations = VERBOSE_SETTINGS_SET;\n \t\t} else if(strcmp(options, OPT_ROMCLASS)==0) {\n \t\t\tverboseOptions->romclass = VERBOSE_SETTINGS_SET;\n+#if (JAVA_SPEC_VERSION >= 11)\n+\t\t} else if(strcmp(options, OPT_NOMODULE)==0) {\n+\t\t\tverboseOptions->module = (VERBOSE_SETTINGS_SET == verboseOptions->module) ? VERBOSE_SETTINGS_IGNORE: VERBOSE_SETTINGS_CLEAR;", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1Mjg4NTE3MA=="}, "originalCommit": {"oid": "ea4cc4ecbe444e557e236b00c774eb79f55003f0"}, "originalPosition": 35}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1Mjk5MTgxOQ==", "bodyText": "I just meant the line should be simplified, like follows. I don't think your change is correct, the test behavior shouldn't change.\nverboseOptions->module = VERBOSE_SETTINGS_IGNORE;", "url": "https://github.com/eclipse-openj9/openj9/pull/10095#discussion_r552991819", "createdAt": "2021-01-06T22:16:36Z", "author": {"login": "pshipton"}, "path": "runtime/verbose/verbose.c", "diffHunk": "@@ -633,6 +641,12 @@ parseVerboseArgument(char* options, J9VerboseSettings* verboseOptions, char** er\n \t\t\tverboseOptions->relocations = VERBOSE_SETTINGS_SET;\n \t\t} else if(strcmp(options, OPT_ROMCLASS)==0) {\n \t\t\tverboseOptions->romclass = VERBOSE_SETTINGS_SET;\n+#if (JAVA_SPEC_VERSION >= 11)\n+\t\t} else if(strcmp(options, OPT_NOMODULE)==0) {\n+\t\t\tverboseOptions->module = (VERBOSE_SETTINGS_SET == verboseOptions->module) ? VERBOSE_SETTINGS_IGNORE: VERBOSE_SETTINGS_CLEAR;", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1Mjg4NTE3MA=="}, "originalCommit": {"oid": "ea4cc4ecbe444e557e236b00c774eb79f55003f0"}, "originalPosition": 35}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1Mjk5NDA1OA==", "bodyText": "hotspot doesn't seem to do anything to disable the module output when both verbose:module and verbose:nomodule are set. Thats likely a mistake though.", "url": "https://github.com/eclipse-openj9/openj9/pull/10095#discussion_r552994058", "createdAt": "2021-01-06T22:22:15Z", "author": {"login": "theresa-m"}, "path": "runtime/verbose/verbose.c", "diffHunk": "@@ -633,6 +641,12 @@ parseVerboseArgument(char* options, J9VerboseSettings* verboseOptions, char** er\n \t\t\tverboseOptions->relocations = VERBOSE_SETTINGS_SET;\n \t\t} else if(strcmp(options, OPT_ROMCLASS)==0) {\n \t\t\tverboseOptions->romclass = VERBOSE_SETTINGS_SET;\n+#if (JAVA_SPEC_VERSION >= 11)\n+\t\t} else if(strcmp(options, OPT_NOMODULE)==0) {\n+\t\t\tverboseOptions->module = (VERBOSE_SETTINGS_SET == verboseOptions->module) ? VERBOSE_SETTINGS_IGNORE: VERBOSE_SETTINGS_CLEAR;", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1Mjg4NTE3MA=="}, "originalCommit": {"oid": "ea4cc4ecbe444e557e236b00c774eb79f55003f0"}, "originalPosition": 35}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1Mjk5NDQ3MQ==", "bodyText": "I'll add that line back in the simplified state.", "url": "https://github.com/eclipse-openj9/openj9/pull/10095#discussion_r552994471", "createdAt": "2021-01-06T22:23:19Z", "author": {"login": "theresa-m"}, "path": "runtime/verbose/verbose.c", "diffHunk": "@@ -633,6 +641,12 @@ parseVerboseArgument(char* options, J9VerboseSettings* verboseOptions, char** er\n \t\t\tverboseOptions->relocations = VERBOSE_SETTINGS_SET;\n \t\t} else if(strcmp(options, OPT_ROMCLASS)==0) {\n \t\t\tverboseOptions->romclass = VERBOSE_SETTINGS_SET;\n+#if (JAVA_SPEC_VERSION >= 11)\n+\t\t} else if(strcmp(options, OPT_NOMODULE)==0) {\n+\t\t\tverboseOptions->module = (VERBOSE_SETTINGS_SET == verboseOptions->module) ? VERBOSE_SETTINGS_IGNORE: VERBOSE_SETTINGS_CLEAR;", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1Mjg4NTE3MA=="}, "originalCommit": {"oid": "ea4cc4ecbe444e557e236b00c774eb79f55003f0"}, "originalPosition": 35}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1Mjk5ODc4Ng==", "bodyText": "-verbose:module,nomodule does do the expected on Hotspot (no module output). I agree -verbose:module -verbose:nomodule showing module output seems like a Hotspot bug.", "url": "https://github.com/eclipse-openj9/openj9/pull/10095#discussion_r552998786", "createdAt": "2021-01-06T22:35:06Z", "author": {"login": "pshipton"}, "path": "runtime/verbose/verbose.c", "diffHunk": "@@ -633,6 +641,12 @@ parseVerboseArgument(char* options, J9VerboseSettings* verboseOptions, char** er\n \t\t\tverboseOptions->relocations = VERBOSE_SETTINGS_SET;\n \t\t} else if(strcmp(options, OPT_ROMCLASS)==0) {\n \t\t\tverboseOptions->romclass = VERBOSE_SETTINGS_SET;\n+#if (JAVA_SPEC_VERSION >= 11)\n+\t\t} else if(strcmp(options, OPT_NOMODULE)==0) {\n+\t\t\tverboseOptions->module = (VERBOSE_SETTINGS_SET == verboseOptions->module) ? VERBOSE_SETTINGS_IGNORE: VERBOSE_SETTINGS_CLEAR;", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1Mjg4NTE3MA=="}, "originalCommit": {"oid": "ea4cc4ecbe444e557e236b00c774eb79f55003f0"}, "originalPosition": 35}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1MzAwNjgwOA==", "bodyText": "Updated.", "url": "https://github.com/eclipse-openj9/openj9/pull/10095#discussion_r553006808", "createdAt": "2021-01-06T22:58:42Z", "author": {"login": "theresa-m"}, "path": "runtime/verbose/verbose.c", "diffHunk": "@@ -633,6 +641,12 @@ parseVerboseArgument(char* options, J9VerboseSettings* verboseOptions, char** er\n \t\t\tverboseOptions->relocations = VERBOSE_SETTINGS_SET;\n \t\t} else if(strcmp(options, OPT_ROMCLASS)==0) {\n \t\t\tverboseOptions->romclass = VERBOSE_SETTINGS_SET;\n+#if (JAVA_SPEC_VERSION >= 11)\n+\t\t} else if(strcmp(options, OPT_NOMODULE)==0) {\n+\t\t\tverboseOptions->module = (VERBOSE_SETTINGS_SET == verboseOptions->module) ? VERBOSE_SETTINGS_IGNORE: VERBOSE_SETTINGS_CLEAR;", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1Mjg4NTE3MA=="}, "originalCommit": {"oid": "ea4cc4ecbe444e557e236b00c774eb79f55003f0"}, "originalPosition": 35}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4906, "cost": 1, "resetAt": "2021-11-12T18:49:56Z"}}}