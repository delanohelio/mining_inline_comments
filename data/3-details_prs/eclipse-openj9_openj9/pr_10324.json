{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDYyODU4NzAw", "number": 10324, "title": "Share the memory allocated by copyStringToUTF8WithMemAlloc", "bodyText": "The intention is to share the memory allocated by\ncopyStringToUTF8WithMemAlloc for the class name string between\nverifyQualifiedName and its caller.\nSigned-off-by: Cheng Jin jincheng@ca.ibm.com", "createdAt": "2020-08-04T15:58:59Z", "url": "https://github.com/eclipse-openj9/openj9/pull/10324", "merged": true, "mergeCommit": {"oid": "5f01dc219067f7b0b62c71baa269cad5fd910c76"}, "closed": true, "closedAt": "2020-08-04T19:09:03Z", "author": {"login": "ChengJin01"}, "timelineItems": {"totalCount": 9, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABc7o1CigBqjM2MjA5NDM5NjM=", "endCursor": "Y3Vyc29yOnYyOpPPAAABc7p0p1AFqTQ2MTAwOTYyNA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "163ea043450e9f347754c53af22ce7ccb78a8588", "author": {"user": {"login": "ChengJin01", "name": "Cheng Jin"}}, "url": "https://github.com/eclipse-openj9/openj9/commit/163ea043450e9f347754c53af22ce7ccb78a8588", "committedDate": "2020-08-04T15:56:18Z", "message": "Share the memory allocated by copyStringToUTF8WithMemAlloc\n\nThe intention is to share the memory allocated by\ncopyStringToUTF8WithMemAlloc for the class name string between\nverifyQualifiedName and its caller.\n\nSigned-off-by: Cheng Jin <jincheng@ca.ibm.com>"}, "afterCommit": {"oid": "3b84ca8efdd45dd6795748fc3393ea69ff623d3c", "author": {"user": {"login": "ChengJin01", "name": "Cheng Jin"}}, "url": "https://github.com/eclipse-openj9/openj9/commit/3b84ca8efdd45dd6795748fc3393ea69ff623d3c", "committedDate": "2020-08-04T16:01:14Z", "message": "Share the memory allocated by copyStringToUTF8WithMemAlloc\n\nThe intention is to share the memory allocated by\ncopyStringToUTF8WithMemAlloc for the class name string between\nverifyQualifiedName and its caller.\n\nSigned-off-by: Cheng Jin <jincheng@ca.ibm.com>"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDYwOTYyNTgw", "url": "https://github.com/eclipse-openj9/openj9/pull/10324#pullrequestreview-460962580", "createdAt": "2020-08-04T16:10:26Z", "commit": {"oid": "3b84ca8efdd45dd6795748fc3393ea69ff623d3c"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0wNFQxNjoxMDoyNlrOG7ndAQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0wNFQxNjoxMDoyNlrOG7ndAQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NTE2NTU2OQ==", "bodyText": "This would read better as an assignment of the constant bit and an if to OR in the second bit.", "url": "https://github.com/eclipse-openj9/openj9/pull/10324#discussion_r465165569", "createdAt": "2020-08-04T16:10:26Z", "author": {"login": "gacholio"}, "path": "runtime/jcl/common/jcldefine.c", "diffHunk": "@@ -95,14 +95,15 @@ defineClassCommon(JNIEnv *env, jobject classLoaderObject,\n \t/* Allocate and initialize a UTF8 copy of the Unicode class-name */\n \tif (NULL != className) {\n \t\tj9object_t classNameObject = J9_JNI_UNWRAP_REFERENCE(className);\n-\t\tutf8Name = (U_8*)vmFuncs->copyStringToUTF8WithMemAlloc(currentThread, classNameObject, J9_STR_NULL_TERMINATE_RESULT | J9_STR_XLAT, \"\", 0, utf8NameStackBuffer, J9VM_PACKAGE_NAME_BUFFER_LENGTH, &utf8Length);\n+\t\tUDATA stringFlags = (validateName ? J9_STR_NULL_TERMINATE_RESULT : (J9_STR_NULL_TERMINATE_RESULT | J9_STR_XLAT));", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "3b84ca8efdd45dd6795748fc3393ea69ff623d3c"}, "originalPosition": 5}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDYwOTY0MDgy", "url": "https://github.com/eclipse-openj9/openj9/pull/10324#pullrequestreview-460964082", "createdAt": "2020-08-04T16:12:11Z", "commit": {"oid": "3b84ca8efdd45dd6795748fc3393ea69ff623d3c"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0wNFQxNjoxMjoxMVrOG7nhrg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0wNFQxNjoxMjoxMVrOG7nhrg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NTE2Njc2Ng==", "bodyText": "Same comment as above - assignment and if.", "url": "https://github.com/eclipse-openj9/openj9/pull/10324#discussion_r465166766", "createdAt": "2020-08-04T16:12:11Z", "author": {"login": "gacholio"}, "path": "runtime/vm/classsupport.c", "diffHunk": "@@ -307,11 +307,19 @@ internalFindClassString(J9VMThread* currentThread, j9object_t moduleName, j9obje\n \t\tchar localBuf[J9VM_PACKAGE_NAME_BUFFER_LENGTH];\n \t\tchar *utf8Name = NULL;\n \t\tUDATA utf8Length = 0;\n+\t\tUDATA stringFlags = ((CLASSNAME_INVALID != allowedBitsForClassName) ? J9_STR_NULL_TERMINATE_RESULT : (J9_STR_NULL_TERMINATE_RESULT | J9_STR_XLAT));", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "3b84ca8efdd45dd6795748fc3393ea69ff623d3c"}, "originalPosition": 4}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDYwOTY1MjEy", "url": "https://github.com/eclipse-openj9/openj9/pull/10324#pullrequestreview-460965212", "createdAt": "2020-08-04T16:13:37Z", "commit": {"oid": "3b84ca8efdd45dd6795748fc3393ea69ff623d3c"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0wNFQxNjoxMzozOFrOG7nlYQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0wNFQxNjoxMzozOFrOG7nlYQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NTE2NzcxMw==", "bodyText": "For consistency with the other code, please declare this as U_8 * and cast it on the assignment, rather than casting the uses.", "url": "https://github.com/eclipse-openj9/openj9/pull/10324#discussion_r465167713", "createdAt": "2020-08-04T16:13:38Z", "author": {"login": "gacholio"}, "path": "runtime/vm/classsupport.c", "diffHunk": "@@ -307,11 +307,19 @@ internalFindClassString(J9VMThread* currentThread, j9object_t moduleName, j9obje\n \t\tchar localBuf[J9VM_PACKAGE_NAME_BUFFER_LENGTH];\n \t\tchar *utf8Name = NULL;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "3b84ca8efdd45dd6795748fc3393ea69ff623d3c"}, "originalPosition": 2}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDYwOTY3NTEx", "url": "https://github.com/eclipse-openj9/openj9/pull/10324#pullrequestreview-460967511", "createdAt": "2020-08-04T16:16:26Z", "commit": {"oid": "3b84ca8efdd45dd6795748fc3393ea69ff623d3c"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0wNFQxNjoxNjoyNlrOG7ntAg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0wNFQxNjoxNjoyNlrOG7ntAg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NTE2OTY2Ng==", "bodyText": "This comment seems out of date - the bcv function has no interaction with this code.", "url": "https://github.com/eclipse-openj9/openj9/pull/10324#discussion_r465169666", "createdAt": "2020-08-04T16:16:26Z", "author": {"login": "gacholio"}, "path": "runtime/vm/stringhelpers.cpp", "diffHunk": "@@ -445,14 +434,10 @@ verifyQualifiedName(J9VMThread *vmThread, j9object_t string, UDATA allowedBitsFo\n \t}\n \n \t/* map the return code against the arity value from checkNameImpl (called by bcvCheckClassName):", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "3b84ca8efdd45dd6795748fc3393ea69ff623d3c"}, "originalPosition": 68}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDYwOTY4MDcx", "url": "https://github.com/eclipse-openj9/openj9/pull/10324#pullrequestreview-460968071", "createdAt": "2020-08-04T16:17:10Z", "commit": {"oid": "3b84ca8efdd45dd6795748fc3393ea69ff623d3c"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0wNFQxNjoxNzoxMFrOG7nuwA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0wNFQxNjoxNzoxMFrOG7nuwA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NTE3MDExMg==", "bodyText": "Please don't include the constant values in the comments.", "url": "https://github.com/eclipse-openj9/openj9/pull/10324#discussion_r465170112", "createdAt": "2020-08-04T16:17:10Z", "author": {"login": "gacholio"}, "path": "runtime/vm/stringhelpers.cpp", "diffHunk": "@@ -445,14 +434,10 @@ verifyQualifiedName(J9VMThread *vmThread, j9object_t string, UDATA allowedBitsFo\n \t}\n \n \t/* map the return code against the arity value from checkNameImpl (called by bcvCheckClassName):\n-\t * 1) if arity = -1, then rc = CLASSNAME_INVALID(0)\n-\t * 2) if arity = 0,  then rc = CLASSNAME_VALID_NON_ARRARY(1)\n-\t * 3) if arity > 0,  then rc = CLASSNAME_VALID_ARRARY(2)\n+\t * 1) if arity = 0,  then rc = CLASSNAME_VALID_NON_ARRARY(1)", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "3b84ca8efdd45dd6795748fc3393ea69ff623d3c"}, "originalPosition": 72}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f149fbc1673b0c61df67c0404d5e1c96a7654fbe", "author": {"user": {"login": "ChengJin01", "name": "Cheng Jin"}}, "url": "https://github.com/eclipse-openj9/openj9/commit/f149fbc1673b0c61df67c0404d5e1c96a7654fbe", "committedDate": "2020-08-04T17:04:02Z", "message": "Share the memory allocated by copyStringToUTF8WithMemAlloc\n\nThe intention is to share the memory allocated by\ncopyStringToUTF8WithMemAlloc for the class name string between\nverifyQualifiedName and its caller.\n\nSigned-off-by: Cheng Jin <jincheng@ca.ibm.com>"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "3b84ca8efdd45dd6795748fc3393ea69ff623d3c", "author": {"user": {"login": "ChengJin01", "name": "Cheng Jin"}}, "url": "https://github.com/eclipse-openj9/openj9/commit/3b84ca8efdd45dd6795748fc3393ea69ff623d3c", "committedDate": "2020-08-04T16:01:14Z", "message": "Share the memory allocated by copyStringToUTF8WithMemAlloc\n\nThe intention is to share the memory allocated by\ncopyStringToUTF8WithMemAlloc for the class name string between\nverifyQualifiedName and its caller.\n\nSigned-off-by: Cheng Jin <jincheng@ca.ibm.com>"}, "afterCommit": {"oid": "f149fbc1673b0c61df67c0404d5e1c96a7654fbe", "author": {"user": {"login": "ChengJin01", "name": "Cheng Jin"}}, "url": "https://github.com/eclipse-openj9/openj9/commit/f149fbc1673b0c61df67c0404d5e1c96a7654fbe", "committedDate": "2020-08-04T17:04:02Z", "message": "Share the memory allocated by copyStringToUTF8WithMemAlloc\n\nThe intention is to share the memory allocated by\ncopyStringToUTF8WithMemAlloc for the class name string between\nverifyQualifiedName and its caller.\n\nSigned-off-by: Cheng Jin <jincheng@ca.ibm.com>"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDYxMDA5NjI0", "url": "https://github.com/eclipse-openj9/openj9/pull/10324#pullrequestreview-461009624", "createdAt": "2020-08-04T17:11:14Z", "commit": {"oid": "f149fbc1673b0c61df67c0404d5e1c96a7654fbe"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 435, "cost": 1, "resetAt": "2021-10-28T17:48:14Z"}}}