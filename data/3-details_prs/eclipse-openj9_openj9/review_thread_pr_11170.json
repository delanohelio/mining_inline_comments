{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTIwMTMzMzg0", "number": 11170, "reviewThreads": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xM1QxNTo1Njo1M1rOE4uLcQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xM1QxNTo1Njo1M1rOE4uLcQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzI3OTEyMzA1OnYy", "diffSide": "RIGHT", "path": "runtime/vm/VMSnapshotImpl.cpp", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xM1QxNTo1Njo1M1rOHyz8LQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xM1QxNjoyMTozMlrOHy04WA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMzA0MTgzNw==", "bodyText": "What is the purpose of changing this cast type?", "url": "https://github.com/eclipse-openj9/openj9/pull/11170#discussion_r523041837", "createdAt": "2020-11-13T15:56:53Z", "author": {"login": "theresa-m"}, "path": "runtime/vm/VMSnapshotImpl.cpp", "diffHunk": "@@ -1398,14 +1414,27 @@ initializeVMSnapshotImpl(J9PortLibrary *portLibrary, BOOLEAN isSnapShotRun, cons\n extern \"C\" void\n setupVMSnapshotImpl(void *vmSnapshotImpl, J9JavaVM* vm)\n {\n-\t((VMSnapshotImpl *)vmSnapshotImpl)->setJ9JavaVM(vm);\n-\tvm->vmSnapshotImplPortLibrary = ((VMSnapshotImpl *)vmSnapshotImpl)->getVMSnapshotImplPortLibrary();\n+\tVMSnapshotImpl *impl = static_cast<VMSnapshotImpl *>(vmSnapshotImpl);\n+\tJ9JavaVM* implVM = impl->getJ9JavaVM();\n+\tif (implVM != NULL) {\n+\t\tif (implVM != vm) {\n+\t\t\t/* Something seriously wrong here! */\n+\t\t\tprintf(\"**** In a Restore run and was passed a different vm pointer.\\n\");\n+\t\t\tprintf(\"**** Expected VMSnapshotImpl->_vm(%p) was (%p)\\n\", implVM, vm);\n+\t\t\tabort();\n+\t\t}\n+\t\t/* No action required */\n+\t} else {\n+\t\t/* Snapshot run - initial set of VM into VMSnapshotImpl*/\n+\t\timpl->setJ9JavaVM(vm);\n+\t}\n+\tvm->vmSnapshotImplPortLibrary = impl->getVMSnapshotImplPortLibrary();\n }\n \n extern \"C\" J9JavaVM *\n getJ9JavaVMFromVMSnapshotImpl(void *vmSnapshotImpl)\n {\n-\treturn ((VMSnapshotImpl *)vmSnapshotImpl)->getJ9JavaVM();\n+\treturn static_cast<VMSnapshotImpl *>(vmSnapshotImpl)->getJ9JavaVM();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "9d9ffac8da88178c6e7033ce07be26fbae521a98"}, "originalPosition": 137}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMzA1NzI0MA==", "bodyText": "This is a cpp file so it should use the c++ casting format.  Also, <static_cast> gives some compile time checking that c-style casts don't, thought that's not really relevant in this case", "url": "https://github.com/eclipse-openj9/openj9/pull/11170#discussion_r523057240", "createdAt": "2020-11-13T16:21:32Z", "author": {"login": "DanHeidinga"}, "path": "runtime/vm/VMSnapshotImpl.cpp", "diffHunk": "@@ -1398,14 +1414,27 @@ initializeVMSnapshotImpl(J9PortLibrary *portLibrary, BOOLEAN isSnapShotRun, cons\n extern \"C\" void\n setupVMSnapshotImpl(void *vmSnapshotImpl, J9JavaVM* vm)\n {\n-\t((VMSnapshotImpl *)vmSnapshotImpl)->setJ9JavaVM(vm);\n-\tvm->vmSnapshotImplPortLibrary = ((VMSnapshotImpl *)vmSnapshotImpl)->getVMSnapshotImplPortLibrary();\n+\tVMSnapshotImpl *impl = static_cast<VMSnapshotImpl *>(vmSnapshotImpl);\n+\tJ9JavaVM* implVM = impl->getJ9JavaVM();\n+\tif (implVM != NULL) {\n+\t\tif (implVM != vm) {\n+\t\t\t/* Something seriously wrong here! */\n+\t\t\tprintf(\"**** In a Restore run and was passed a different vm pointer.\\n\");\n+\t\t\tprintf(\"**** Expected VMSnapshotImpl->_vm(%p) was (%p)\\n\", implVM, vm);\n+\t\t\tabort();\n+\t\t}\n+\t\t/* No action required */\n+\t} else {\n+\t\t/* Snapshot run - initial set of VM into VMSnapshotImpl*/\n+\t\timpl->setJ9JavaVM(vm);\n+\t}\n+\tvm->vmSnapshotImplPortLibrary = impl->getVMSnapshotImplPortLibrary();\n }\n \n extern \"C\" J9JavaVM *\n getJ9JavaVMFromVMSnapshotImpl(void *vmSnapshotImpl)\n {\n-\treturn ((VMSnapshotImpl *)vmSnapshotImpl)->getJ9JavaVM();\n+\treturn static_cast<VMSnapshotImpl *>(vmSnapshotImpl)->getJ9JavaVM();", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMzA0MTgzNw=="}, "originalCommit": {"oid": "9d9ffac8da88178c6e7033ce07be26fbae521a98"}, "originalPosition": 137}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 912, "cost": 1, "resetAt": "2021-11-12T13:16:51Z"}}}