{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTEyNjU2NjEz", "number": 11052, "title": "Improve jps to be able to handle composed arguments", "bodyText": "This patch improves jps to be able to handle composed arguments\nFixes #11036\nSigned-off-by: Alexey Anufriev contact@alexey-anufriev.com", "createdAt": "2020-10-30T00:00:24Z", "url": "https://github.com/eclipse-openj9/openj9/pull/11052", "merged": true, "mergeCommit": {"oid": "a236ce7eec866eed8edad79869f87e7624a72172"}, "closed": true, "closedAt": "2020-11-04T17:02:27Z", "author": {"login": "alexey-anufriev"}, "timelineItems": {"totalCount": 10, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdXbR5sgBqjM5Mzg5MjQ2MjI=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdZQ1kWAFqTUyMzU2MDQ1Mw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "9ccb10ec33de4b0507e2889cdccaef9f1c194761", "author": {"user": {"login": "alexey-anufriev", "name": "Alexey Anufriev"}}, "url": "https://github.com/eclipse-openj9/openj9/commit/9ccb10ec33de4b0507e2889cdccaef9f1c194761", "committedDate": "2020-10-29T23:57:40Z", "message": "This patch improves jps to be able to handle composed arguments\n\nFixes #11036\n\nSigned-off-by: Alexey Anufriev contact@alexey-anufriev.com"}, "afterCommit": {"oid": "f058b3aa172e1f8c692eaa3dd8b5aa1af23fc897", "author": {"user": {"login": "alexey-anufriev", "name": "Alexey Anufriev"}}, "url": "https://github.com/eclipse-openj9/openj9/commit/f058b3aa172e1f8c692eaa3dd8b5aa1af23fc897", "committedDate": "2020-10-30T00:04:15Z", "message": "This patch improves jps to be able to handle composed arguments\n\nFixes #11036\n\nSigned-off-by: Alexey Anufriev <contact@alexey-anufriev.com>"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTIwMzI5NDI5", "url": "https://github.com/eclipse-openj9/openj9/pull/11052#pullrequestreview-520329429", "createdAt": "2020-10-30T01:58:26Z", "commit": {"oid": "f058b3aa172e1f8c692eaa3dd8b5aa1af23fc897"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0zMFQwMTo1ODoyNlrOHq2bLw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0zMFQwMTo1ODoyNlrOHq2bLw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNDY5MzkzNQ==", "bodyText": "-J needs to be a separate argument. It's actually -J<vm option> such as -J-Xmx512m.", "url": "https://github.com/eclipse-openj9/openj9/pull/11052#discussion_r514693935", "createdAt": "2020-10-30T01:58:26Z", "author": {"login": "pshipton"}, "path": "jcl/src/jdk.jcmd/share/classes/openj9/tools/attach/diagnostics/tools/Jps.java", "diffHunk": "@@ -33,12 +33,27 @@\n  * A tool for listing Java processes and their information.\n  *\n  */\n+@SuppressWarnings(\"nls\")\n public class Jps {\n \n+\tprivate static final String DESCRIPTION =\n+\t\t\t\"jps: Print a list of Java processes and information about them%n%n\";\n+\n+\tprivate static final String HELP_TEXT =\n+\t\t\t\"usage: jps [-h] [-J] [-l] [-q] [-m] [-v]%n\" +\n+\t\t\t\"usage: jps [-h] [-Jlqmv]%n%n\" +", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f058b3aa172e1f8c692eaa3dd8b5aa1af23fc897"}, "originalPosition": 20}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTIwNzIxNzQx", "url": "https://github.com/eclipse-openj9/openj9/pull/11052#pullrequestreview-520721741", "createdAt": "2020-10-30T14:28:49Z", "commit": {"oid": "f058b3aa172e1f8c692eaa3dd8b5aa1af23fc897"}, "state": "COMMENTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0zMFQxNDoyODo0OVrOHrRjVg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0zMFQxNDoyOToyMFrOHrRkrA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNTEzODM5MA==", "bodyText": "Since this PR intends to match RI behaviours, this error message can be modified to illegal argument: as well such that the script doesn't have to handle different errors.\n@pshipton any thoughts?", "url": "https://github.com/eclipse-openj9/openj9/pull/11052#discussion_r515138390", "createdAt": "2020-10-30T14:28:49Z", "author": {"login": "JasonFengJ9"}, "path": "jcl/src/jdk.jcmd/share/classes/openj9/tools/attach/diagnostics/tools/Jps.java", "diffHunk": "@@ -68,38 +83,52 @@ public static void main(String[] args) {\n \t\tSystem.exit(rc);\n \t}\n \t\n-\t@SuppressWarnings(\"nls\")\n \tprivate static void parseArguments(String[] args) {\n \t\tprintApplicationArguments = false;\n \t\tprintJvmArguments = false;\n \t\tnoPackageName = true;\n \t\tvmidOnly = false;\n-\t\tfinal String HELPTEXT = \"jps: Print a list of Java processes and information about them%n\"\n-\t\t\t\t+ \"    -J: supply arguments to the Java VM running jps%n\"\n-\t\t\t\t+ \"    -l: print the application package name%n\"\n-\t\t\t\t+ \"    -q: print only the virtual machine identifiers%n\"\n-\t\t\t\t+ \"    -m: print the application arguments%n\"\n-\t\t\t\t+ \"    -v: print the Java VM arguments, including those produced automatically%n\";\n-\t\tfor (String a : args) {\n-\t\t\tswitch (a) {\n-\t\t\tcase \"-l\":\n+\n+\t\tfor (String arg : args) {\n+\t\t\tif (!arg.startsWith(\"-\") || arg.length() == 1) {\n+\t\t\t\tSystem.out.printf(\"malformed argument '%s'%n%n\", arg);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f058b3aa172e1f8c692eaa3dd8b5aa1af23fc897"}, "originalPosition": 58}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNTEzODczMg==", "bodyText": "Do we need different error message here?", "url": "https://github.com/eclipse-openj9/openj9/pull/11052#discussion_r515138732", "createdAt": "2020-10-30T14:29:20Z", "author": {"login": "JasonFengJ9"}, "path": "jcl/src/jdk.jcmd/share/classes/openj9/tools/attach/diagnostics/tools/Jps.java", "diffHunk": "@@ -68,38 +83,52 @@ public static void main(String[] args) {\n \t\tSystem.exit(rc);\n \t}\n \t\n-\t@SuppressWarnings(\"nls\")\n \tprivate static void parseArguments(String[] args) {\n \t\tprintApplicationArguments = false;\n \t\tprintJvmArguments = false;\n \t\tnoPackageName = true;\n \t\tvmidOnly = false;\n-\t\tfinal String HELPTEXT = \"jps: Print a list of Java processes and information about them%n\"\n-\t\t\t\t+ \"    -J: supply arguments to the Java VM running jps%n\"\n-\t\t\t\t+ \"    -l: print the application package name%n\"\n-\t\t\t\t+ \"    -q: print only the virtual machine identifiers%n\"\n-\t\t\t\t+ \"    -m: print the application arguments%n\"\n-\t\t\t\t+ \"    -v: print the Java VM arguments, including those produced automatically%n\";\n-\t\tfor (String a : args) {\n-\t\t\tswitch (a) {\n-\t\t\tcase \"-l\":\n+\n+\t\tfor (String arg : args) {\n+\t\t\tif (!arg.startsWith(\"-\") || arg.length() == 1) {\n+\t\t\t\tSystem.out.printf(\"malformed argument '%s'%n%n\", arg);\n+\t\t\t\tinterruptWithHelpMessage();\n+\t\t\t}\n+\t\t\targ = arg.substring(1);\n+\t\t\tfor (char singleArg : arg.toCharArray()) {\n+\t\t\t\tprocessArgument(singleArg);\n+\t\t\t}\n+\t\t}\n+\t}\n+\n+\tprivate static void processArgument(char arg) {\n+\t\tswitch (arg) {\n+\t\t\tcase 'l':\n \t\t\t\tnoPackageName = false;\n \t\t\t\tbreak;\n-\t\t\tcase \"-m\":\n+\t\t\tcase 'm':\n \t\t\t\tprintApplicationArguments = true;\n \t\t\t\tbreak;\n-\t\t\tcase \"-q\":\n+\t\t\tcase 'q':\n \t\t\t\tvmidOnly = true;\n \t\t\t\tbreak;\n-\t\t\tcase \"-v\":\n+\t\t\tcase 'v':\n \t\t\t\tprintJvmArguments = true;\n \t\t\t\tbreak;\n-\t\t\t\t/* implicitly handle -h and -help via the default case */\n-\t\t\tdefault: \n-\t\t\t\tSystem.out.printf(HELPTEXT);\n-\t\t\t\tSystem.exit(1);\n+\t\t\tcase 'h':\n+\t\t\t\tSystem.out.printf(DESCRIPTION);\n+\t\t\t\tinterruptWithHelpMessage();\n+\t\t\t\tbreak;\n+\t\t\tdefault:\n+\t\t\t\tSystem.out.printf(\"unsupported argument '-%c'%n%n\", arg);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f058b3aa172e1f8c692eaa3dd8b5aa1af23fc897"}, "originalPosition": 94}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "f058b3aa172e1f8c692eaa3dd8b5aa1af23fc897", "author": {"user": {"login": "alexey-anufriev", "name": "Alexey Anufriev"}}, "url": "https://github.com/eclipse-openj9/openj9/commit/f058b3aa172e1f8c692eaa3dd8b5aa1af23fc897", "committedDate": "2020-10-30T00:04:15Z", "message": "This patch improves jps to be able to handle composed arguments\n\nFixes #11036\n\nSigned-off-by: Alexey Anufriev <contact@alexey-anufriev.com>"}, "afterCommit": {"oid": "e0babb1ac07e61106a36239defaad37adc08e20b", "author": {"user": {"login": "alexey-anufriev", "name": "Alexey Anufriev"}}, "url": "https://github.com/eclipse-openj9/openj9/commit/e0babb1ac07e61106a36239defaad37adc08e20b", "committedDate": "2020-11-02T23:01:39Z", "message": "This patch improves jps to be able to handle composed arguments\n\nFixes #11036\n\nSigned-off-by: Alexey Anufriev <contact@alexey-anufriev.com>"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTIyNTI4MDE2", "url": "https://github.com/eclipse-openj9/openj9/pull/11052#pullrequestreview-522528016", "createdAt": "2020-11-03T14:07:35Z", "commit": {"oid": "e0babb1ac07e61106a36239defaad37adc08e20b"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "7d039d09791c5420bfc397ec5772809609d5fb97", "author": {"user": {"login": "alexey-anufriev", "name": "Alexey Anufriev"}}, "url": "https://github.com/eclipse-openj9/openj9/commit/7d039d09791c5420bfc397ec5772809609d5fb97", "committedDate": "2020-11-03T22:18:24Z", "message": "This patch improves jps to be able to handle composed arguments\n\nFixes #11036\n\nSigned-off-by: Alexey Anufriev <contact@alexey-anufriev.com>"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "e0babb1ac07e61106a36239defaad37adc08e20b", "author": {"user": {"login": "alexey-anufriev", "name": "Alexey Anufriev"}}, "url": "https://github.com/eclipse-openj9/openj9/commit/e0babb1ac07e61106a36239defaad37adc08e20b", "committedDate": "2020-11-02T23:01:39Z", "message": "This patch improves jps to be able to handle composed arguments\n\nFixes #11036\n\nSigned-off-by: Alexey Anufriev <contact@alexey-anufriev.com>"}, "afterCommit": {"oid": "7d039d09791c5420bfc397ec5772809609d5fb97", "author": {"user": {"login": "alexey-anufriev", "name": "Alexey Anufriev"}}, "url": "https://github.com/eclipse-openj9/openj9/commit/7d039d09791c5420bfc397ec5772809609d5fb97", "committedDate": "2020-11-03T22:18:24Z", "message": "This patch improves jps to be able to handle composed arguments\n\nFixes #11036\n\nSigned-off-by: Alexey Anufriev <contact@alexey-anufriev.com>"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTIzMzM1NjM5", "url": "https://github.com/eclipse-openj9/openj9/pull/11052#pullrequestreview-523335639", "createdAt": "2020-11-04T12:59:09Z", "commit": {"oid": "7d039d09791c5420bfc397ec5772809609d5fb97"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wNFQxMjo1OTowOVrOHtW_8A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wNFQxMjo1OTowOVrOHtW_8A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNzMyNDc4NA==", "bodyText": "@alexey-anufriev this can stay as [-lqmv] but need a note that -q takes precedence over the other options.", "url": "https://github.com/eclipse-openj9/openj9/pull/11052#discussion_r517324784", "createdAt": "2020-11-04T12:59:09Z", "author": {"login": "JasonFengJ9"}, "path": "jcl/src/jdk.jcmd/share/classes/openj9/tools/attach/diagnostics/tools/Jps.java", "diffHunk": "@@ -33,12 +33,28 @@\n  * A tool for listing Java processes and their information.\n  *\n  */\n+@SuppressWarnings(\"nls\")\n public class Jps {\n \n+\tprivate static final String DESCRIPTION =\n+\t\t\t\"jps: Print a list of Java processes and information about them%n%n\";\n+\n+\tprivate static final String HELP_TEXT =\n+\t\t\t\"Usage:%n\" +\n+\t\t\t\"    jps [-h] [-J<vm option>] [-l] [-q] [-m] [-v]%n\" +\n+\t\t\t\"    jps [-h] [-J<vm option>] [-q] [-lmv]%n%n\" +", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "7d039d09791c5420bfc397ec5772809609d5fb97"}, "originalPosition": 21}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTIzNDA0NjEw", "url": "https://github.com/eclipse-openj9/openj9/pull/11052#pullrequestreview-523404610", "createdAt": "2020-11-04T14:20:11Z", "commit": {"oid": "7d039d09791c5420bfc397ec5772809609d5fb97"}, "state": "COMMENTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wNFQxNDoyMDoxMVrOHtaMTQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wNFQxNDoyMzo1MVrOHtaW_A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNzM3NzEwMQ==", "bodyText": "But q flag composed with any other flag will lead to illegal argument\n\nProbably there was confusion here, #11052 (comment) (I agreed) suggested that q composed with other flags should not be restricted.", "url": "https://github.com/eclipse-openj9/openj9/pull/11052#discussion_r517377101", "createdAt": "2020-11-04T14:20:11Z", "author": {"login": "JasonFengJ9"}, "path": "jcl/src/jdk.jcmd/share/classes/openj9/tools/attach/diagnostics/tools/Jps.java", "diffHunk": "@@ -33,12 +33,28 @@\n  * A tool for listing Java processes and their information.\n  *\n  */\n+@SuppressWarnings(\"nls\")\n public class Jps {\n \n+\tprivate static final String DESCRIPTION =\n+\t\t\t\"jps: Print a list of Java processes and information about them%n%n\";\n+\n+\tprivate static final String HELP_TEXT =\n+\t\t\t\"Usage:%n\" +\n+\t\t\t\"    jps [-h] [-J<vm option>] [-l] [-q] [-m] [-v]%n\" +\n+\t\t\t\"    jps [-h] [-J<vm option>] [-q] [-lmv]%n%n\" +", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNzMyNDc4NA=="}, "originalCommit": {"oid": "7d039d09791c5420bfc397ec5772809609d5fb97"}, "originalPosition": 21}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNzM3OTgzNg==", "bodyText": "Sorry, we don't want to restrict q with other flags though RI does so.\nPlease revert to previous version.", "url": "https://github.com/eclipse-openj9/openj9/pull/11052#discussion_r517379836", "createdAt": "2020-11-04T14:23:51Z", "author": {"login": "JasonFengJ9"}, "path": "jcl/src/jdk.jcmd/share/classes/openj9/tools/attach/diagnostics/tools/Jps.java", "diffHunk": "@@ -68,38 +84,56 @@ public static void main(String[] args) {\n \t\tSystem.exit(rc);\n \t}\n \t\n-\t@SuppressWarnings(\"nls\")\n \tprivate static void parseArguments(String[] args) {\n \t\tprintApplicationArguments = false;\n \t\tprintJvmArguments = false;\n \t\tnoPackageName = true;\n \t\tvmidOnly = false;\n-\t\tfinal String HELPTEXT = \"jps: Print a list of Java processes and information about them%n\"\n-\t\t\t\t+ \"    -J: supply arguments to the Java VM running jps%n\"\n-\t\t\t\t+ \"    -l: print the application package name%n\"\n-\t\t\t\t+ \"    -q: print only the virtual machine identifiers%n\"\n-\t\t\t\t+ \"    -m: print the application arguments%n\"\n-\t\t\t\t+ \"    -v: print the Java VM arguments, including those produced automatically%n\";\n-\t\tfor (String a : args) {\n-\t\t\tswitch (a) {\n-\t\t\tcase \"-l\":\n+\n+\t\tfor (String arg : args) {\n+\t\t\tif (isInvalidArgument(arg)) {\n+\t\t\t\tSystem.out.printf(\"illegal argument: %s%n%n\", arg);\n+\t\t\t\tinterruptWithHelpMessage();\n+\t\t\t}\n+\t\t\targ = arg.substring(1);\n+\t\t\tfor (char singleArg : arg.toCharArray()) {\n+\t\t\t\tprocessArgument(singleArg);\n+\t\t\t}\n+\t\t}\n+\t}\n+\n+\tprivate static boolean isInvalidArgument(String arg) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "7d039d09791c5420bfc397ec5772809609d5fb97"}, "originalPosition": 69}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTIzNTYwNDUz", "url": "https://github.com/eclipse-openj9/openj9/pull/11052#pullrequestreview-523560453", "createdAt": "2020-11-04T17:02:20Z", "commit": {"oid": "7d039d09791c5420bfc397ec5772809609d5fb97"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 61, "cost": 1, "resetAt": "2021-10-28T18:00:02Z"}}}