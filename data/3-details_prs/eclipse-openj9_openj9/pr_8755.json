{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0Mzg0MDUxNDc0", "number": 8755, "title": "Find module with romClass name rather than loadData->className", "bodyText": "The loadData->className may be null. Also check the\nbuildRomClass() result before trying to find the module.\nFixes #8724", "createdAt": "2020-03-05T03:47:18Z", "url": "https://github.com/eclipse-openj9/openj9/pull/8755", "merged": true, "mergeCommit": {"oid": "8b48c8dfec9530870591ebe83b735ff850d64efd"}, "closed": true, "closedAt": "2020-03-09T18:37:06Z", "author": {"login": "pshipton"}, "timelineItems": {"totalCount": 11, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcKjPVUgBqjMwOTk1NTk2NzU=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcMCVnyAFqTM3MTQzMjkwOQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "b11d336fd7bb07c9e571be644c9fa3db2cc6cc77", "author": {"user": {"login": "pshipton", "name": "Peter Shipton"}}, "url": "https://github.com/eclipse-openj9/openj9/commit/b11d336fd7bb07c9e571be644c9fa3db2cc6cc77", "committedDate": "2020-03-05T03:45:20Z", "message": "Check buildRomClass() result before trying to find module\n\nSigned-off-by: Peter Shipton <Peter_Shipton@ca.ibm.com>"}, "afterCommit": {"oid": "f44aae7d42f8a605530c21bc529474e05ddb0b5f", "author": {"user": {"login": "pshipton", "name": "Peter Shipton"}}, "url": "https://github.com/eclipse-openj9/openj9/commit/f44aae7d42f8a605530c21bc529474e05ddb0b5f", "committedDate": "2020-03-05T03:48:29Z", "message": "Check buildRomClass() result before trying to find module\n\nSigned-off-by: Peter Shipton <Peter_Shipton@ca.ibm.com>"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "f44aae7d42f8a605530c21bc529474e05ddb0b5f", "author": {"user": {"login": "pshipton", "name": "Peter Shipton"}}, "url": "https://github.com/eclipse-openj9/openj9/commit/f44aae7d42f8a605530c21bc529474e05ddb0b5f", "committedDate": "2020-03-05T03:48:29Z", "message": "Check buildRomClass() result before trying to find module\n\nSigned-off-by: Peter Shipton <Peter_Shipton@ca.ibm.com>"}, "afterCommit": {"oid": "528a64877b04de797577ce17d13d940706a446ad", "author": {"user": {"login": "pshipton", "name": "Peter Shipton"}}, "url": "https://github.com/eclipse-openj9/openj9/commit/528a64877b04de797577ce17d13d940706a446ad", "committedDate": "2020-03-05T04:34:16Z", "message": "Check buildRomClass() result before trying to find module\n\nSigned-off-by: Peter Shipton <Peter_Shipton@ca.ibm.com>"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzY5MzIxMjUx", "url": "https://github.com/eclipse-openj9/openj9/pull/8755#pullrequestreview-369321251", "createdAt": "2020-03-05T06:28:00Z", "commit": {"oid": "528a64877b04de797577ce17d13d940706a446ad"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wNVQwNjoyODowMFrOFyHszg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wNVQwNjoyODowMFrOFyHszg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4ODA5OTI3OA==", "bodyText": "Can you modify this to check result once around the outside of this if and the next?\nSomething like:\nif (BCT_ERR_NO_ERROR == result) {\n    if ((J2SE_VERSION(vm) >= J2SE_V11)...... {\n    .....\n    if (J9_ARE_ANY_BITS_SET(vm->extendedRuntimeFlags, J9_EXTENDED_RUNTIME_RECREATE_CLASSFILE_ONLOAD)) {\n    }   \n}\nas the J9_EXTENDED_RUNTIME_RECREATE_CLASSFILE_ONLOAD immediately checks for BCT_ERR_NO_ERROR as well", "url": "https://github.com/eclipse-openj9/openj9/pull/8755#discussion_r388099278", "createdAt": "2020-03-05T06:28:00Z", "author": {"login": "DanHeidinga"}, "path": "runtime/bcutil/defineclass.c", "diffHunk": "@@ -764,6 +764,7 @@ callDynamicLoader(J9VMThread *vmThread, J9LoadROMClassData *loadData, U_8 * inte\n \t/* The module of a class transformed by a JVMTI agent needs access to unnamed modules */", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "528a64877b04de797577ce17d13d940706a446ad"}, "originalPosition": 8}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "528a64877b04de797577ce17d13d940706a446ad", "author": {"user": {"login": "pshipton", "name": "Peter Shipton"}}, "url": "https://github.com/eclipse-openj9/openj9/commit/528a64877b04de797577ce17d13d940706a446ad", "committedDate": "2020-03-05T04:34:16Z", "message": "Check buildRomClass() result before trying to find module\n\nSigned-off-by: Peter Shipton <Peter_Shipton@ca.ibm.com>"}, "afterCommit": {"oid": "af25d54e8ac10f32c628f017ad1f0a44ff7c2569", "author": {"user": {"login": "pshipton", "name": "Peter Shipton"}}, "url": "https://github.com/eclipse-openj9/openj9/commit/af25d54e8ac10f32c628f017ad1f0a44ff7c2569", "committedDate": "2020-03-05T16:32:34Z", "message": "Check buildRomClass() result before trying to find module\n\nSigned-off-by: Peter Shipton <Peter_Shipton@ca.ibm.com>"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "af25d54e8ac10f32c628f017ad1f0a44ff7c2569", "author": {"user": {"login": "pshipton", "name": "Peter Shipton"}}, "url": "https://github.com/eclipse-openj9/openj9/commit/af25d54e8ac10f32c628f017ad1f0a44ff7c2569", "committedDate": "2020-03-05T16:32:34Z", "message": "Check buildRomClass() result before trying to find module\n\nSigned-off-by: Peter Shipton <Peter_Shipton@ca.ibm.com>"}, "afterCommit": {"oid": "d3039239d826916d58e2c471f89c3ebdb8db400e", "author": {"user": {"login": "pshipton", "name": "Peter Shipton"}}, "url": "https://github.com/eclipse-openj9/openj9/commit/d3039239d826916d58e2c471f89c3ebdb8db400e", "committedDate": "2020-03-05T19:56:30Z", "message": "Check buildRomClass() result before trying to find module\n\nSigned-off-by: Peter Shipton <Peter_Shipton@ca.ibm.com>"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "d3039239d826916d58e2c471f89c3ebdb8db400e", "author": {"user": {"login": "pshipton", "name": "Peter Shipton"}}, "url": "https://github.com/eclipse-openj9/openj9/commit/d3039239d826916d58e2c471f89c3ebdb8db400e", "committedDate": "2020-03-05T19:56:30Z", "message": "Check buildRomClass() result before trying to find module\n\nSigned-off-by: Peter Shipton <Peter_Shipton@ca.ibm.com>"}, "afterCommit": {"oid": "7643ad750f4b7fb2ff9b4eaa06d70bb9e78c4737", "author": {"user": {"login": "pshipton", "name": "Peter Shipton"}}, "url": "https://github.com/eclipse-openj9/openj9/commit/7643ad750f4b7fb2ff9b4eaa06d70bb9e78c4737", "committedDate": "2020-03-06T03:01:09Z", "message": "Check buildRomClass() result before trying to find module\n\nSigned-off-by: Peter Shipton <Peter_Shipton@ca.ibm.com>"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzcwMDU4NDAz", "url": "https://github.com/eclipse-openj9/openj9/pull/8755#pullrequestreview-370058403", "createdAt": "2020-03-06T03:10:32Z", "commit": {"oid": "7643ad750f4b7fb2ff9b4eaa06d70bb9e78c4737"}, "state": "APPROVED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wNlQwMzoxMDozMlrOFyr7gA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wNlQwMzoxMDozMlrOFyr7gA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4ODY5Mjg2NA==", "bodyText": "Minor nitpick - this line of the if statement is indented to far.  It should be a single tab (or preferably in my view none!).\n\n  \n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            \t\t\t\t&& (classFileBytesReplacedByRIA || classFileBytesReplacedByRCA)\n          \n          \n            \n            \t\t&& (classFileBytesReplacedByRIA || classFileBytesReplacedByRCA)", "url": "https://github.com/eclipse-openj9/openj9/pull/8755#discussion_r388692864", "createdAt": "2020-03-06T03:10:32Z", "author": {"login": "DanHeidinga"}, "path": "runtime/bcutil/defineclass.c", "diffHunk": "@@ -761,20 +761,19 @@ callDynamicLoader(J9VMThread *vmThread, J9LoadROMClassData *loadData, U_8 * inte\n \t\t\tFALSE, /* isIntermediateROMClass */\n \t\t\tlocalBuffer);\n \n-\t/* The module of a class transformed by a JVMTI agent needs access to unnamed modules */\n-\tif ((J2SE_VERSION(vm) >= J2SE_V11)\n-\t\t&& (classFileBytesReplacedByRIA || classFileBytesReplacedByRCA)\n-\t\t&& (NULL != loadData->romClass)\n-\t) {\n-\t\tJ9Module *module = J9_VM_FUNCTION(vmThread, findModuleForPackage)(vmThread, loadData->classLoader,\n-\t\t\t\tloadData->className, (U_32) packageNameLength(loadData->romClass));\n-\t\tif (NULL != module) {\n-\t\t\tmodule->isLoose = TRUE;\n+\tif (BCT_ERR_NO_ERROR == result) {\n+\t\t/* The module of a class transformed by a JVMTI agent needs access to unnamed modules */\n+\t\tif ((J2SE_VERSION(vm) >= J2SE_V11)\n+\t\t\t\t&& (classFileBytesReplacedByRIA || classFileBytesReplacedByRCA)", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "7643ad750f4b7fb2ff9b4eaa06d70bb9e78c4737"}, "originalPosition": 23}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "7643ad750f4b7fb2ff9b4eaa06d70bb9e78c4737", "author": {"user": {"login": "pshipton", "name": "Peter Shipton"}}, "url": "https://github.com/eclipse-openj9/openj9/commit/7643ad750f4b7fb2ff9b4eaa06d70bb9e78c4737", "committedDate": "2020-03-06T03:01:09Z", "message": "Check buildRomClass() result before trying to find module\n\nSigned-off-by: Peter Shipton <Peter_Shipton@ca.ibm.com>"}, "afterCommit": {"oid": "2d2351aa13b66ea012eb28b195e6910b4371f860", "author": {"user": {"login": "pshipton", "name": "Peter Shipton"}}, "url": "https://github.com/eclipse-openj9/openj9/commit/2d2351aa13b66ea012eb28b195e6910b4371f860", "committedDate": "2020-03-06T20:01:32Z", "message": "Find module with romClass name rather than loadData->className\n\nThe loadData->className may be null. Also check the \nbuildRomClass() result before trying to find the module.\n\nSigned-off-by: Peter Shipton <Peter_Shipton@ca.ibm.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e81c2c009a4299d220edf2e95e55ff68fc3c0c8b", "author": {"user": {"login": "pshipton", "name": "Peter Shipton"}}, "url": "https://github.com/eclipse-openj9/openj9/commit/e81c2c009a4299d220edf2e95e55ff68fc3c0c8b", "committedDate": "2020-03-06T20:24:53Z", "message": "Find module with romClass name rather than loadData->className\n\nThe loadData->className may be null. Also check the \nbuildRomClass() result before trying to find the module.\n\nSigned-off-by: Peter Shipton <Peter_Shipton@ca.ibm.com>"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "2d2351aa13b66ea012eb28b195e6910b4371f860", "author": {"user": {"login": "pshipton", "name": "Peter Shipton"}}, "url": "https://github.com/eclipse-openj9/openj9/commit/2d2351aa13b66ea012eb28b195e6910b4371f860", "committedDate": "2020-03-06T20:01:32Z", "message": "Find module with romClass name rather than loadData->className\n\nThe loadData->className may be null. Also check the \nbuildRomClass() result before trying to find the module.\n\nSigned-off-by: Peter Shipton <Peter_Shipton@ca.ibm.com>"}, "afterCommit": {"oid": "e81c2c009a4299d220edf2e95e55ff68fc3c0c8b", "author": {"user": {"login": "pshipton", "name": "Peter Shipton"}}, "url": "https://github.com/eclipse-openj9/openj9/commit/e81c2c009a4299d220edf2e95e55ff68fc3c0c8b", "committedDate": "2020-03-06T20:24:53Z", "message": "Find module with romClass name rather than loadData->className\n\nThe loadData->className may be null. Also check the \nbuildRomClass() result before trying to find the module.\n\nSigned-off-by: Peter Shipton <Peter_Shipton@ca.ibm.com>"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzcxNDMyOTA5", "url": "https://github.com/eclipse-openj9/openj9/pull/8755#pullrequestreview-371432909", "createdAt": "2020-03-09T18:36:36Z", "commit": {"oid": "e81c2c009a4299d220edf2e95e55ff68fc3c0c8b"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 666, "cost": 1, "resetAt": "2021-10-28T18:00:02Z"}}}