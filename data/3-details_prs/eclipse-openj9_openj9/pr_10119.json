{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDQ2MzgzMzAw", "number": 10119, "title": "Duplicate PassThrough nodes when creating acmp fastpaths", "bodyText": "Previously, when inserting fastpaths for acmp in the JIT, PassThrough nodes under new GlRegDeps were commoned with nodes from existing GlRegDeps. This is incorrect because the commoned PassThrough does not anchor its child, which causes it's lifetime to not be extended up to that code point.\nSigned-off-by: Leonardo Banderali leonardo2718@protonmail.com", "createdAt": "2020-07-08T17:26:38Z", "url": "https://github.com/eclipse-openj9/openj9/pull/10119", "merged": true, "mergeCommit": {"oid": "497e3cb06ebc317fefc5b75936124f19e0ac660e"}, "closed": true, "closedAt": "2020-07-13T17:54:58Z", "author": {"login": "Leonardo2718"}, "timelineItems": {"totalCount": 5, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcy-EIFgFqTQ0NDk5MTM4Mw==", "endCursor": "Y3Vyc29yOnYyOpPPAAABczoIP_AFqTQ0NTA2MjI3MA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDQ0OTkxMzgz", "url": "https://github.com/eclipse-openj9/openj9/pull/10119#pullrequestreview-444991383", "createdAt": "2020-07-08T17:40:46Z", "commit": {"oid": "11bd1bedcfd3632627d1b96a2ac9a20ac135d6c4"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wOFQxNzo0MDo0NlrOGuypmg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wOFQxNzo0MDo0NlrOGuypmg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MTcxNzUzMA==", "bodyText": "Rahil @r30shah drew my attention to some code in JProfilingValue.cpp that copies register dependencies.  It calls both setLowGlobalRegisterNumber and setHighGlobalRegisterNumber on the PassThrough node -  I guess to handle the possibility of register pairs.  Should this do the same?", "url": "https://github.com/eclipse-openj9/openj9/pull/10119#discussion_r451717530", "createdAt": "2020-07-08T17:40:46Z", "author": {"login": "hzongaro"}, "path": "runtime/compiler/codegen/J9CodeGenerator.cpp", "diffHunk": "@@ -291,6 +291,14 @@ J9::CodeGenerator::fastpathAcmpHelper(TR::Node *node, TR::TreeTop *tt, const boo\n             TR::Node* temp = expectedDeps->getChild(i);\n             if (temp->getGlobalRegisterNumber() == depNode->getGlobalRegisterNumber())\n                continue;\n+            else if (temp->getOpCodeValue() == TR::PassThrough)\n+               {\n+               // PassThrough nodes cannot be commoned because doing so does not\n+               // actually anchor the child, causing it's lifetime to not be extended\n+               auto regnum = temp->getGlobalRegisterNumber();\n+               temp = TR::Node::create(TR::PassThrough,1, temp->getFirstChild());\n+               temp->setGlobalRegisterNumber(regnum);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "11bd1bedcfd3632627d1b96a2ac9a20ac135d6c4"}, "originalPosition": 10}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "11bd1bedcfd3632627d1b96a2ac9a20ac135d6c4", "author": {"user": {"login": "Leonardo2718", "name": null}}, "url": "https://github.com/eclipse-openj9/openj9/commit/11bd1bedcfd3632627d1b96a2ac9a20ac135d6c4", "committedDate": "2020-07-08T17:23:00Z", "message": "Duplicate PassThrough nodes when creating acmp fastpaths\n\nPreviously, when inserting fastpaths for acmp in the JIT, PassThrough\nnodes under new GlRegDeps were commoned with nodes from existing\nGlRegDeps. This is incorrect because the commoned PassThrough does not\nanchor its child, which causes it's lifetime to not be extended up to\nthat code point.\n\nSigned-off-by: Leonardo Banderali <leonardo2718@protonmail.com>"}, "afterCommit": {"oid": "59f3d5a262102e2216f0c0e1b1f8213b5dcf9c8c", "author": {"user": {"login": "Leonardo2718", "name": null}}, "url": "https://github.com/eclipse-openj9/openj9/commit/59f3d5a262102e2216f0c0e1b1f8213b5dcf9c8c", "committedDate": "2020-07-08T19:21:36Z", "message": "Duplicate PassThrough nodes when creating acmp fastpaths\n\nPreviously, when inserting fastpaths for acmp in the JIT, PassThrough\nnodes under new GlRegDeps were commoned with nodes from existing\nGlRegDeps. This is incorrect because the commoned PassThrough does not\nanchor its child, which causes it's lifetime to not be extended up to\nthat code point.\n\nSigned-off-by: Leonardo Banderali <leonardo2718@protonmail.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ad1604a7a5f81dcec9221bd0618c83bbff0c598a", "author": {"user": {"login": "Leonardo2718", "name": null}}, "url": "https://github.com/eclipse-openj9/openj9/commit/ad1604a7a5f81dcec9221bd0618c83bbff0c598a", "committedDate": "2020-07-08T19:26:02Z", "message": "Duplicate PassThrough nodes when creating acmp fastpaths\n\nPreviously, when inserting fastpaths for acmp in the JIT, PassThrough\nnodes under new GlRegDeps were commoned with nodes from existing\nGlRegDeps. This is incorrect because the commoned PassThrough does not\nanchor its child, which causes it's lifetime to not be extended up to\nthat code point.\n\nSigned-off-by: Leonardo Banderali <leonardo2718@protonmail.com>"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "59f3d5a262102e2216f0c0e1b1f8213b5dcf9c8c", "author": {"user": {"login": "Leonardo2718", "name": null}}, "url": "https://github.com/eclipse-openj9/openj9/commit/59f3d5a262102e2216f0c0e1b1f8213b5dcf9c8c", "committedDate": "2020-07-08T19:21:36Z", "message": "Duplicate PassThrough nodes when creating acmp fastpaths\n\nPreviously, when inserting fastpaths for acmp in the JIT, PassThrough\nnodes under new GlRegDeps were commoned with nodes from existing\nGlRegDeps. This is incorrect because the commoned PassThrough does not\nanchor its child, which causes it's lifetime to not be extended up to\nthat code point.\n\nSigned-off-by: Leonardo Banderali <leonardo2718@protonmail.com>"}, "afterCommit": {"oid": "ad1604a7a5f81dcec9221bd0618c83bbff0c598a", "author": {"user": {"login": "Leonardo2718", "name": null}}, "url": "https://github.com/eclipse-openj9/openj9/commit/ad1604a7a5f81dcec9221bd0618c83bbff0c598a", "committedDate": "2020-07-08T19:26:02Z", "message": "Duplicate PassThrough nodes when creating acmp fastpaths\n\nPreviously, when inserting fastpaths for acmp in the JIT, PassThrough\nnodes under new GlRegDeps were commoned with nodes from existing\nGlRegDeps. This is incorrect because the commoned PassThrough does not\nanchor its child, which causes it's lifetime to not be extended up to\nthat code point.\n\nSigned-off-by: Leonardo Banderali <leonardo2718@protonmail.com>"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDQ1MDYyMjcw", "url": "https://github.com/eclipse-openj9/openj9/pull/10119#pullrequestreview-445062270", "createdAt": "2020-07-08T19:22:12Z", "commit": {"oid": "11bd1bedcfd3632627d1b96a2ac9a20ac135d6c4"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 533, "cost": 1, "resetAt": "2021-10-28T17:48:14Z"}}}