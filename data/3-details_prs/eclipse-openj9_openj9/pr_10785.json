{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDk4MDM1NzQ2", "number": 10785, "title": "Only read J9Method.extra once", "bodyText": "Since J9Method.extra was changed to a volatile in #10672, update code that reads the extra field more than once, as suggested in #10672 (comment).", "createdAt": "2020-10-05T18:25:35Z", "url": "https://github.com/eclipse-openj9/openj9/pull/10785", "merged": true, "mergeCommit": {"oid": "cb21f5621a38d41ae879c3104a21e30777c9073a"}, "closed": true, "closedAt": "2020-10-06T15:44:05Z", "author": {"login": "dsouzai"}, "timelineItems": {"totalCount": 6, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdPoSDKgFqTUwMjMxNjE1MQ==", "endCursor": "Y3Vyc29yOnYyOpPPAAABdPt61AgFqTUwMjUyMTM4NA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTAyMzE2MTUx", "url": "https://github.com/eclipse-openj9/openj9/pull/10785#pullrequestreview-502316151", "createdAt": "2020-10-05T18:32:06Z", "commit": {"oid": "19f1f6790fdffb45980e7c5c48532c7722260019"}, "state": "COMMENTED", "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wNVQxODozMjowNlrOHco7NA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wNVQxODo0MDo0OFrOHcpM2w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5OTc5MjY5Mg==", "bodyText": "Note, this method is called while holding exclusiveVMAccess so it shouldn't matter whether the extra field is reread or not.", "url": "https://github.com/eclipse-openj9/openj9/pull/10785#discussion_r499792692", "createdAt": "2020-10-05T18:32:06Z", "author": {"login": "DanHeidinga"}, "path": "runtime/codert_vm/decomp.cpp", "diffHunk": "@@ -259,10 +259,11 @@ jitResetAllMethods(J9VMThread *currentThread)\n \t\tU_32 methodCount = clazz->romClass->romMethodCount;\n \n \t\twhile (methodCount != 0) {\n-\t\t\tif (0 == ((UDATA)method->extra & J9_STARTPC_NOT_TRANSLATED)) {\n+\t\t\tUDATA extra = (UDATA)method->extra;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "19f1f6790fdffb45980e7c5c48532c7722260019"}, "originalPosition": 5}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5OTc5NDU0MA==", "bodyText": "Similarly, this method is also called under exclusive", "url": "https://github.com/eclipse-openj9/openj9/pull/10785#discussion_r499794540", "createdAt": "2020-10-05T18:35:39Z", "author": {"login": "DanHeidinga"}, "path": "runtime/codert_vm/decomp.cpp", "diffHunk": "@@ -1575,11 +1576,12 @@ static void\n markMethodBreakpointed(J9VMThread * currentThread, J9JITBreakpointedMethod * breakpointedMethod)\n {\n \tJ9Method * method = breakpointedMethod->method;\n+\tvoid * extra = method->extra;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "19f1f6790fdffb45980e7c5c48532c7722260019"}, "originalPosition": 18}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5OTc5NzIxMQ==", "bodyText": "We don't need to introduce a new local for extra here.  Better to reuse frameBuilder:\n\n  \n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            \tUDATA extra = (UDATA)currentMethod->extra;\n          \n          \n            \n            \tif ((extra & J9_STARTPC_NOT_TRANSLATED) != J9_STARTPC_NOT_TRANSLATED) {\n          \n          \n            \n            \t\tframeBuilder = extra;\n          \n          \n            \n            \tUDATA frameBuilder = (UDATA)currentMethod->extra;\n          \n          \n            \n            \tif ((frameBuilder & J9_STARTPC_NOT_TRANSLATED) != J9_STARTPC_NOT_TRANSLATED) {\n          \n      \n    \n    \n  \n\nNote also that this is during class creation so the ramClass hasn't \"escaped\" to anyone else who can modify it yet", "url": "https://github.com/eclipse-openj9/openj9/pull/10785#discussion_r499797211", "createdAt": "2020-10-05T18:40:48Z", "author": {"login": "DanHeidinga"}, "path": "runtime/vm/createramclass.cpp", "diffHunk": "@@ -1127,8 +1127,9 @@ fillJITVTableSlot(J9VMThread *vmStruct, UDATA *currentSlot, J9Method *currentMet\n {\n \tJ9JITConfig *jitConfig = vmStruct->javaVM->jitConfig;\n \tUDATA frameBuilder;\n-\tif (((UDATA)currentMethod->extra & J9_STARTPC_NOT_TRANSLATED) != J9_STARTPC_NOT_TRANSLATED) {\n-\t\tframeBuilder = (UDATA)currentMethod->extra;\n+\tUDATA extra = (UDATA)currentMethod->extra;\n+\tif ((extra & J9_STARTPC_NOT_TRANSLATED) != J9_STARTPC_NOT_TRANSLATED) {\n+\t\tframeBuilder = extra;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "19f1f6790fdffb45980e7c5c48532c7722260019"}, "originalPosition": 8}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "19f1f6790fdffb45980e7c5c48532c7722260019", "author": {"user": {"login": "dsouzai", "name": "Irwin D'Souza"}}, "url": "https://github.com/eclipse-openj9/openj9/commit/19f1f6790fdffb45980e7c5c48532c7722260019", "committedDate": "2020-10-02T20:31:34Z", "message": "Only read J9Method.extra once\n\nSigned-off-by: Irwin D'Souza <dsouzai.gh@gmail.com>"}, "afterCommit": {"oid": "444db2b24da3e67967da09f1502b0d5e46d69455", "author": {"user": {"login": "dsouzai", "name": "Irwin D'Souza"}}, "url": "https://github.com/eclipse-openj9/openj9/commit/444db2b24da3e67967da09f1502b0d5e46d69455", "committedDate": "2020-10-05T20:08:36Z", "message": "Only read J9Method.extra once\n\nSigned-off-by: Irwin D'Souza <dsouzai.gh@gmail.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "0b98c0cdfe4e125ac85320f50e391c33dde096da", "author": {"user": {"login": "dsouzai", "name": "Irwin D'Souza"}}, "url": "https://github.com/eclipse-openj9/openj9/commit/0b98c0cdfe4e125ac85320f50e391c33dde096da", "committedDate": "2020-10-05T21:16:14Z", "message": "Only read J9Method.extra once\n\nSigned-off-by: Irwin D'Souza <dsouzai.gh@gmail.com>"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "444db2b24da3e67967da09f1502b0d5e46d69455", "author": {"user": {"login": "dsouzai", "name": "Irwin D'Souza"}}, "url": "https://github.com/eclipse-openj9/openj9/commit/444db2b24da3e67967da09f1502b0d5e46d69455", "committedDate": "2020-10-05T20:08:36Z", "message": "Only read J9Method.extra once\n\nSigned-off-by: Irwin D'Souza <dsouzai.gh@gmail.com>"}, "afterCommit": {"oid": "0b98c0cdfe4e125ac85320f50e391c33dde096da", "author": {"user": {"login": "dsouzai", "name": "Irwin D'Souza"}}, "url": "https://github.com/eclipse-openj9/openj9/commit/0b98c0cdfe4e125ac85320f50e391c33dde096da", "committedDate": "2020-10-05T21:16:14Z", "message": "Only read J9Method.extra once\n\nSigned-off-by: Irwin D'Souza <dsouzai.gh@gmail.com>"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTAyNTExMTEw", "url": "https://github.com/eclipse-openj9/openj9/pull/10785#pullrequestreview-502511110", "createdAt": "2020-10-06T00:40:53Z", "commit": {"oid": "0b98c0cdfe4e125ac85320f50e391c33dde096da"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTAyNTIxMzg0", "url": "https://github.com/eclipse-openj9/openj9/pull/10785#pullrequestreview-502521384", "createdAt": "2020-10-06T01:16:05Z", "commit": {"oid": "0b98c0cdfe4e125ac85320f50e391c33dde096da"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 380, "cost": 1, "resetAt": "2021-10-28T18:00:02Z"}}}