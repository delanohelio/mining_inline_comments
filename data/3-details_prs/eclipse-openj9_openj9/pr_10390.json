{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDY4MDMxODIw", "number": 10390, "title": "Handle new CPU enum types inside J9CPU.cpp", "bodyText": "New CPU types were introduced in the OMRProcessArchitecture enum and OpenJ9 must be able to handle these new entries. Additionally, this PR also adds on to the  J9::Z::CPU::applyUserOptions() routine by also updating _supportedArch when the CPU level is changed.", "createdAt": "2020-08-14T14:59:04Z", "url": "https://github.com/eclipse-openj9/openj9/pull/10390", "merged": true, "mergeCommit": {"oid": "92fcbf450a942c9b954f91ac17574f78ff9e7477"}, "closed": true, "closedAt": "2020-08-19T19:54:48Z", "author": {"login": "dchopra001"}, "timelineItems": {"totalCount": 6, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABc-11S1AH2gAyNDY4MDMxODIwOjg2ZTQ1ZmUzOWFjODg3OWZiMTNjZjM0ZDIwNGVhOTJkZTgzYzMzNTA=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdAc_c6gFqTQ3MDU1MDc5Nw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "86e45fe39ac8879fb13cf34d204ea92de83c3350", "author": {"user": {"login": "dchopra001", "name": "Dhruv Chopra"}}, "url": "https://github.com/eclipse-openj9/openj9/commit/86e45fe39ac8879fb13cf34d204ea92de83c3350", "committedDate": "2020-08-14T14:52:34Z", "message": "Handle new CPU enum types in test routine\n\nSigned-off-by: Dhruv Chopra <Dhruv.C.Chopra@ibm.com>"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDY3NjYxNzcx", "url": "https://github.com/eclipse-openj9/openj9/pull/10390#pullrequestreview-467661771", "createdAt": "2020-08-14T15:19:23Z", "commit": {"oid": "9c9eebbad1d69bf7f29c964d3f6f47dba1874281"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDY4NTYwNzQ5", "url": "https://github.com/eclipse-openj9/openj9/pull/10390#pullrequestreview-468560749", "createdAt": "2020-08-17T15:21:29Z", "commit": {"oid": "9c9eebbad1d69bf7f29c964d3f6f47dba1874281"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xN1QxNToyMTozMFrOHBtVlw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xN1QxNToyMTozMFrOHBtVlw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MTU1MzQzMQ==", "bodyText": "_supportedArch is supposed to be set by the old implementation. If you are going to set _supportedArch using the new implementation, the tests (old implementation against new implementation) will always pass. This change will invalidate the test because now it's checking new implementation against itself.", "url": "https://github.com/eclipse-openj9/openj9/pull/10390#discussion_r471553431", "createdAt": "2020-08-17T15:21:30Z", "author": {"login": "harryyu1994"}, "path": "runtime/compiler/z/env/J9CPU.cpp", "diffHunk": "@@ -50,19 +50,42 @@ J9::Z::CPU::applyUserOptions()\n    OMRPORT_ACCESS_FROM_OMRPORT(TR::Compiler->omrPortLib);\n \n    if (_processorDescription.processor >= OMR_PROCESSOR_S390_Z10 && TR::Options::getCmdLineOptions()->getOption(TR_DisableZ10))\n-      _processorDescription.processor = OMR_PROCESSOR_S390_FIRST;\n+      {\n+      // Z10 is the minimum supported architecture for the OpenJ9 on Z. So instead of reducing the architecture to Z9 here,\n+      // we go down to Unknown.\n+      _supportedArch = Unknown;\n+      _processorDescription.processor = OMR_PROCESSOR_S390_UNKNOWN;\n+      }\n    else if (_processorDescription.processor >= OMR_PROCESSOR_S390_Z196 && TR::Options::getCmdLineOptions()->getOption(TR_DisableZ196))\n+      {\n+      _supportedArch = z10;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "9c9eebbad1d69bf7f29c964d3f6f47dba1874281"}, "originalPosition": 13}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDY4NTc0NTM1", "url": "https://github.com/eclipse-openj9/openj9/pull/10390#pullrequestreview-468574535", "createdAt": "2020-08-17T15:37:31Z", "commit": {"oid": "9c9eebbad1d69bf7f29c964d3f6f47dba1874281"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "9c9eebbad1d69bf7f29c964d3f6f47dba1874281", "author": {"user": {"login": "dchopra001", "name": "Dhruv Chopra"}}, "url": "https://github.com/eclipse-openj9/openj9/commit/9c9eebbad1d69bf7f29c964d3f6f47dba1874281", "committedDate": "2020-08-14T14:52:58Z", "message": "Update _supportedArch in applyUserOptions\n\nWhen the architecture level is changed inside\nJ9::CPU::applyUserOptions, the original implementation\nthat uses _supportedArch to store the architecture level\nmust also be updated.\n\nSigned-off-by: Dhruv Chopra <Dhruv.C.Chopra@ibm.com>"}, "afterCommit": {"oid": "86e45fe39ac8879fb13cf34d204ea92de83c3350", "author": {"user": {"login": "dchopra001", "name": "Dhruv Chopra"}}, "url": "https://github.com/eclipse-openj9/openj9/commit/86e45fe39ac8879fb13cf34d204ea92de83c3350", "committedDate": "2020-08-14T14:52:34Z", "message": "Handle new CPU enum types in test routine\n\nSigned-off-by: Dhruv Chopra <Dhruv.C.Chopra@ibm.com>"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDcwNTUwNzk3", "url": "https://github.com/eclipse-openj9/openj9/pull/10390#pullrequestreview-470550797", "createdAt": "2020-08-19T15:03:53Z", "commit": {"oid": "86e45fe39ac8879fb13cf34d204ea92de83c3350"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 160, "cost": 1, "resetAt": "2021-10-28T17:48:14Z"}}}