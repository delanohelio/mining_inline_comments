{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDg1NDM4NDEw", "number": 10578, "title": "Remove old processor detection code on Z", "bodyText": "Summary of changes:\n\nRetire old version cpu detection code on Z\nReasons for the removal:\n\nWe kept the old version because we wanted to make sure new version and old version give us the same behaviour\nNow it's been a few month and we don't see any bugs with the new version there's no reason to keep the old version\nAlso we want to prevent developers from using the old version.\n\n\n\nOld design\n\nInitializes the TR_Processor struct via j9port library\n\nInitialization occurs in TR_J9VM::initializeProcessorType()\nobtain cpu information using CPU::TO_PORTLIB_getJ9ProcessorDesc()\nTR::Compiler->target.cpu.setProcessor to set processor\n\n\nFields and methods associated with the old design live in Class CPU\nCommon APIs:\n\nCPU::TO_PORTLIB_getJ9ProcessorDesc()\nj9sysinfo_processor_has_feature(processorDesc, feature) (j9port library API)\nCPU::id()\nCPU::setProcessor(TR_Processor)\n\n\n\nNew design\n\nInitializes the OMRProcessorDesc struct via omrport library\n\nCPU::detect() to initialize OMRProcessorDesc processorDescription\nCPU::applyUserOptions() to apply any debug options after initialization\nTR::Compiler->target.cpu singleton variable that holds the CPU instance\ncomp()->target().cpu per compilation variable which is used for cross-cpu compilation support\n\nFor JIT we initialize comp()->target().cpu with TR::Compiler->target.cpu (Host CPU)\nFor AOT we initialize comp()->target().cpu with TR::Compiler->relocatableTarget.cpu (Portable CPU)\n\n\n\n\nFields and methods associated with the new design live in Class CPU\nCommon APIs:\n\nCPU::supportsFeature(feature)\nCPU::isAtLeast(OMRProcessorArchitecture)\n\n\nBenefits:\n\nCommon to all 3 platforms\nSimpler interface\nCross-CPU compilation support (Use one cpu for AOT and another for JIT)\n\n\n\nDepends on: eclipse/omr#5541\nIssue: #10578\nSigned-off-by: Harry Yu harryyu1994@gmail.com", "createdAt": "2020-09-11T20:37:06Z", "url": "https://github.com/eclipse-openj9/openj9/pull/10578", "merged": true, "mergeCommit": {"oid": "85aa6c320bcff9d9542e31898763ec4a4c5db0f9"}, "closed": true, "closedAt": "2020-09-18T20:09:08Z", "author": {"login": "harryyu1994"}, "timelineItems": {"totalCount": 9, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdH8TpSABqjM3NTgxMTc3MjQ=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdKLTXPgFqTQ5MTc0OTQ4Ng==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "d04f17c33c765476eb7367500ce75ecd3d2a15f8", "author": {"user": {"login": "harryyu1994", "name": "Harry Yu"}}, "url": "https://github.com/eclipse-openj9/openj9/commit/d04f17c33c765476eb7367500ce75ecd3d2a15f8", "committedDate": "2020-09-11T20:35:42Z", "message": "Remove old processor detection code on Z\n\nSigned-off-by: Harry Yu <harryyu1994@gmail.com>"}, "afterCommit": {"oid": "f18065ad8e8cc22b967fa953ac61d19610a0907a", "author": {"user": {"login": "harryyu1994", "name": "Harry Yu"}}, "url": "https://github.com/eclipse-openj9/openj9/commit/f18065ad8e8cc22b967fa953ac61d19610a0907a", "committedDate": "2020-09-11T21:30:15Z", "message": "Remove old processor detection code on Z\n\nSigned-off-by: Harry Yu <harryyu1994@gmail.com>"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "f18065ad8e8cc22b967fa953ac61d19610a0907a", "author": {"user": {"login": "harryyu1994", "name": "Harry Yu"}}, "url": "https://github.com/eclipse-openj9/openj9/commit/f18065ad8e8cc22b967fa953ac61d19610a0907a", "committedDate": "2020-09-11T21:30:15Z", "message": "Remove old processor detection code on Z\n\nSigned-off-by: Harry Yu <harryyu1994@gmail.com>"}, "afterCommit": {"oid": "ee6204fe53153d3ace4d71a6018e69c79d80092b", "author": {"user": {"login": "harryyu1994", "name": "Harry Yu"}}, "url": "https://github.com/eclipse-openj9/openj9/commit/ee6204fe53153d3ace4d71a6018e69c79d80092b", "committedDate": "2020-09-11T21:36:04Z", "message": "Remove old processor detection code on Z\n\nSigned-off-by: Harry Yu <harryyu1994@gmail.com>"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "ee6204fe53153d3ace4d71a6018e69c79d80092b", "author": {"user": {"login": "harryyu1994", "name": "Harry Yu"}}, "url": "https://github.com/eclipse-openj9/openj9/commit/ee6204fe53153d3ace4d71a6018e69c79d80092b", "committedDate": "2020-09-11T21:36:04Z", "message": "Remove old processor detection code on Z\n\nSigned-off-by: Harry Yu <harryyu1994@gmail.com>"}, "afterCommit": {"oid": "4ec45619ee72c9469ea2b8eb7bb384992af7f35c", "author": {"user": {"login": "harryyu1994", "name": "Harry Yu"}}, "url": "https://github.com/eclipse-openj9/openj9/commit/4ec45619ee72c9469ea2b8eb7bb384992af7f35c", "committedDate": "2020-09-11T21:52:33Z", "message": "Remove old processor detection code on Z\n\nSigned-off-by: Harry Yu <harryyu1994@gmail.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "73db8443e2b8331282a1658aec585d2bd0fac154", "author": {"user": {"login": "harryyu1994", "name": "Harry Yu"}}, "url": "https://github.com/eclipse-openj9/openj9/commit/73db8443e2b8331282a1658aec585d2bd0fac154", "committedDate": "2020-09-11T22:19:57Z", "message": "Remove old processor detection code on Z\n\nSigned-off-by: Harry Yu <harryyu1994@gmail.com>"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "4ec45619ee72c9469ea2b8eb7bb384992af7f35c", "author": {"user": {"login": "harryyu1994", "name": "Harry Yu"}}, "url": "https://github.com/eclipse-openj9/openj9/commit/4ec45619ee72c9469ea2b8eb7bb384992af7f35c", "committedDate": "2020-09-11T21:52:33Z", "message": "Remove old processor detection code on Z\n\nSigned-off-by: Harry Yu <harryyu1994@gmail.com>"}, "afterCommit": {"oid": "73db8443e2b8331282a1658aec585d2bd0fac154", "author": {"user": {"login": "harryyu1994", "name": "Harry Yu"}}, "url": "https://github.com/eclipse-openj9/openj9/commit/73db8443e2b8331282a1658aec585d2bd0fac154", "committedDate": "2020-09-11T22:19:57Z", "message": "Remove old processor detection code on Z\n\nSigned-off-by: Harry Yu <harryyu1994@gmail.com>"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDg3OTQzNDI3", "url": "https://github.com/eclipse-openj9/openj9/pull/10578#pullrequestreview-487943427", "createdAt": "2020-09-14T16:25:08Z", "commit": {"oid": "73db8443e2b8331282a1658aec585d2bd0fac154"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xNFQxNjoyNTowOFrOHRdBlw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xNFQxNjoyNTowOFrOHRdBlw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4ODA2MzM4Mw==", "bodyText": "So where are things initialized now? Is it in OMR?", "url": "https://github.com/eclipse-openj9/openj9/pull/10578#discussion_r488063383", "createdAt": "2020-09-14T16:25:08Z", "author": {"login": "fjeremic"}, "path": "runtime/compiler/env/ProcessorDetection.cpp", "diffHunk": "@@ -653,62 +653,12 @@ TR_J9VM::initializeProcessorType()\n    if (TR::Compiler->target.cpu.isZ())\n       {\n #if defined(TR_HOST_S390)\n-      initializeS390ProcessorFeatures();\n-\n #if defined(J9ZOS390)\n       // Cache whether current process is running in Supervisor State (i.e. Control Region of WAS).", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "73db8443e2b8331282a1658aec585d2bd0fac154"}, "originalPosition": 7}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "5817a8e3e544a6c44b656c534729c8f367f5504d", "author": {"user": {"login": "harryyu1994", "name": "Harry Yu"}}, "url": "https://github.com/eclipse-openj9/openj9/commit/5817a8e3e544a6c44b656c534729c8f367f5504d", "committedDate": "2020-09-14T19:52:51Z", "message": "Replace old version CPU detection API with new version for verbose log\n\nSigned-off-by: Harry Yu <harryyu1994@gmail.com>"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "cb101ef7808cabd481d4211f5869d3a9d17abf21", "author": {"user": {"login": "harryyu1994", "name": "Harry Yu"}}, "url": "https://github.com/eclipse-openj9/openj9/commit/cb101ef7808cabd481d4211f5869d3a9d17abf21", "committedDate": "2020-09-14T19:50:44Z", "message": "Replace old version CPU detection API for verbose log\n\nSigned-off-by: Harry Yu <harryyu1994@gmail.com>"}, "afterCommit": {"oid": "5817a8e3e544a6c44b656c534729c8f367f5504d", "author": {"user": {"login": "harryyu1994", "name": "Harry Yu"}}, "url": "https://github.com/eclipse-openj9/openj9/commit/5817a8e3e544a6c44b656c534729c8f367f5504d", "committedDate": "2020-09-14T19:52:51Z", "message": "Replace old version CPU detection API with new version for verbose log\n\nSigned-off-by: Harry Yu <harryyu1994@gmail.com>"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDkxNzQ5NDg2", "url": "https://github.com/eclipse-openj9/openj9/pull/10578#pullrequestreview-491749486", "createdAt": "2020-09-18T20:06:35Z", "commit": {"oid": "5817a8e3e544a6c44b656c534729c8f367f5504d"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2, "cost": 1, "resetAt": "2021-10-28T17:48:14Z"}}}