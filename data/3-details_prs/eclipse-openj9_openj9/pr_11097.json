{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTE1MDEwNzY2", "number": 11097, "title": " Add tests for unresolved value types", "bodyText": "Add tests that perform defaultvalue, withfield, putfield or getfield operations on value types, where the types or fields involved will be unresolved for the first few times that the method that performs the operation is invoked.  This helps to test special JIT handling of these situations in particular.", "createdAt": "2020-11-03T21:52:06Z", "url": "https://github.com/eclipse-openj9/openj9/pull/11097", "merged": true, "mergeCommit": {"oid": "341fc39b510ba3e31d2e30afcae770b59c0f80f6"}, "closed": true, "closedAt": "2020-11-24T15:17:38Z", "author": {"login": "hzongaro"}, "timelineItems": {"totalCount": 11, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdZAcgsgBqjM5NTQ5NTM0Nzc=", "endCursor": "Y3Vyc29yOnYyOpPPAAABddGMS9AFqTUzMTM5NTIxOA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "eb48c5eb70658d2a22c0e7a141900e683be57b1f", "author": {"user": {"login": "hzongaro", "name": "Henry Zongaro"}}, "url": "https://github.com/eclipse-openj9/openj9/commit/eb48c5eb70658d2a22c0e7a141900e683be57b1f", "committedDate": "2020-11-03T21:32:07Z", "message": "Simplify generateClass to accept a class configuration object\n\nThe signature for generateClass was becoming unwieldy, with many String\nand String array arguments.  This is an attempt to simplify that with\na ClassConfiguration argument that provides the various pieces of\nconfiguration information.\n\nSigned-off-by:  Henry Zongaro <zongaro@ca.ibm.com>"}, "afterCommit": {"oid": "491ed392c3b77ee942ab11bec5001b2b20ad2e2d", "author": {"user": {"login": "hzongaro", "name": "Henry Zongaro"}}, "url": "https://github.com/eclipse-openj9/openj9/commit/491ed392c3b77ee942ab11bec5001b2b20ad2e2d", "committedDate": "2020-11-03T21:56:16Z", "message": "Simplify generateClass to accept a class configuration object\n\nThe signature for generateClass was becoming unwieldy, with many String\nand String array arguments.  This is an attempt to simplify that with\na ClassConfiguration argument that provides the various pieces of\nconfiguration information.\n\nSigned-off-by:  Henry Zongaro <zongaro@ca.ibm.com>"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTIzNzIxNTA0", "url": "https://github.com/eclipse-openj9/openj9/pull/11097#pullrequestreview-523721504", "createdAt": "2020-11-04T20:45:24Z", "commit": {"oid": "9520d8c1eea80c7442e0d1741e833718ee72c9ac"}, "state": "COMMENTED", "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wNFQyMDo0NToyNFrOHtpEZw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wNFQyMDo1OTo0M1rOHtpgsQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNzYyMDgzOQ==", "bodyText": "fields is not used in testUnresolvedValueTypeDefaultValue, why is it passed in?", "url": "https://github.com/eclipse-openj9/openj9/pull/11097#discussion_r517620839", "createdAt": "2020-11-04T20:45:24Z", "author": {"login": "a7ehuo"}, "path": "test/functional/Valhalla/src/org/openj9/test/lworld/ValueTypeGenerator.java", "diffHunk": "@@ -380,6 +398,101 @@ private static void testCheckCastRefClassOnNull(ClassWriter cw, String className\n \t\tmv.visitEnd();\n \t}\n \n+\tprivate static void testUnresolvedValueTypeDefaultValue(ClassWriter cw, String className, String valueUsedInCode, String[] fields) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "9520d8c1eea80c7442e0d1741e833718ee72c9ac"}, "originalPosition": 45}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNzYyNDQ4MA==", "bodyText": "Why does passing -1 avoid the execution of GETFIELD?", "url": "https://github.com/eclipse-openj9/openj9/pull/11097#discussion_r517624480", "createdAt": "2020-11-04T20:52:38Z", "author": {"login": "a7ehuo"}, "path": "test/functional/Valhalla/src/org/openj9/test/lworld/ValueTypeTests.java", "diffHunk": "@@ -2460,6 +2460,201 @@ static public void testFlattenedFieldInitSequence() throws Throwable {\n \t\tassertNotNull(getB.invoke(getD.invoke(containerC)));\n \t}\n \t\n+\t/*\n+\t * Test use of DEFAULTVALUE for a value type class that has not been resolved.\n+\t * The method is first called so that the DEFAULTVALUE will not be executed,\n+\t * and the class not resolved, and then called so that the DEFAULTVALUE\n+\t * and class resolution is triggered.\n+\t */\n+\t@Test(priority=1)\n+\tstatic public void testUnresolvedDefaultValueUse() throws Throwable {\n+\t\tString fields[] = {\"x:I\", \"y:I\"};\n+\t\tClass valueClass = ValueTypeGenerator.generateValueClass(\"UnresolvedA\", fields);\n+\t\tString fields2[] = {};\n+\t\tClass usingClass = ValueTypeGenerator.generateRefClass(\"UsingUnresolvedA\", fields2, \"UnresolvedA\");\n+\n+\t\tMethodHandle defaultValueUnresolved = lookup.findStatic(usingClass, \"testUnresolvedValueTypeDefaultValue\", MethodType.methodType(Object.class, int.class));\n+\n+\t\tfor (int i = 0; i < 10; i++) {\n+\t\t\t// Pass zero to avoid execution of DEFAULTVALUE and resolution of value type class\n+\t\t\tassertNull(defaultValueUnresolved.invoke(0));\n+\t\t}\n+\n+\t\tMethodHandle getX = generateGenericGetter(valueClass, \"x\");\n+\t\tMethodHandle getY = generateGenericGetter(valueClass, \"y\");\n+\n+\t\tfor (int i = 0; i < 10; i++) {\n+\t\t\t// Pass one to force execution of DEFAULTVALUE and resolution of value type class\n+\t\t\tObject defaultValue = defaultValueUnresolved.invoke(1);\n+\t\t\tassertNotNull(defaultValue);\n+\t\t\tassertEquals(getX.invoke(defaultValue), Integer.valueOf(0));\n+\t\t\tassertEquals(getY.invoke(defaultValue), Integer.valueOf(0));\n+\t\t}\n+\t}\n+\n+\t@Test(priority=1)\n+\tstatic public void testUnresolvedWithFieldUse() throws Throwable {\n+\t\tString fields[] = {\"x:I\", \"y:I\"};\n+\t\tClass valueClass = ValueTypeGenerator.generateValueClass(\"UnresolvedD\", fields, \"HostD\");\n+\t\tString fields2[] = {};\n+\t\tClass usingClass = ValueTypeGenerator.generateHostRefClass(\"UsingUnresolvedD\", fields2, \"UnresolvedD\", fields);\n+\n+\t\tMethodHandle withFieldUnresolved = lookup.findStatic(usingClass, \"testUnresolvedValueTypeWithField\", MethodType.methodType(Object.class, new Class[] {int.class, Object.class}));\n+\n+\t\tfor (int i = 0; i < 10; i++) {\n+\t\t\t// Pass zero to avoid execution of WITHFIELD and resolution of value type class\n+\t\t\tassertNull(withFieldUnresolved.invoke(0, null));\n+\t\t}\n+\n+\t\tMethodHandle makeDefaultValue = lookup.findStatic(valueClass, \"makeValueTypeDefaultValue\", MethodType.methodType(Object.class));\n+\t\tObject defaultValue = makeDefaultValue.invoke();\n+\n+\t\tMethodHandle getX = generateGenericGetter(valueClass, \"x\");\n+\t\tMethodHandle getY = generateGenericGetter(valueClass, \"y\");\n+\n+\t\tfor (int i = 0; i < 10; i++) {\n+\t\t\t// Pass one to force execution of WITHFIELD and resolution of value type class\n+\t\t\tObject withFieldValue = (withFieldUnresolved.invoke(1, defaultValue));\n+\t\t\tassertEquals(getX.invoke(withFieldValue), Integer.valueOf(1));\n+\t\t\tassertEquals(getY.invoke(withFieldValue), Integer.valueOf(2));\n+\t\t}\n+\t}\n+\n+\tprivate static class UnresolvedClassDesc {\n+\t\tpublic String name;\n+\t\tpublic String[] fields;\n+\t\tpublic UnresolvedClassDesc(String name, String[] fields) {\n+\t\t\tthis.name = name;\n+\t\t\tthis.fields = fields;\n+\t\t}\n+\t}\n+\n+\t/*\n+\t * Test use of GETFIELD operations on the fields of a container class, where\n+\t * the fields are of value type classes that have not been resolved.\n+\t *\n+\t * The method is first called so that the GETFIELD will not be executed, and\n+\t * the class not resolved, and then called so that the GETFIELD and class\n+\t * resolution is triggered.\n+\t */\n+\t@Test(priority=1)\n+\tstatic public void testUnresolvedGetFieldUse() throws Throwable {\n+\t\tUnresolvedClassDesc[] uclassDescArr = new UnresolvedClassDesc[] {\n+\t\t\t\t\t\t\t\tnew UnresolvedClassDesc(\"UnresolvedB1\", new String[] {\"a:I\", \"b:I\"}),\n+\t\t\t\t\t\t\t\tnew UnresolvedClassDesc(\"UnresolvedB2\", new String[] {\"c:I\", \"d:I\"}),\n+\t\t\t\t\t\t\t\tnew UnresolvedClassDesc(\"UnresolvedB3\", new String[] {\"e:I\", \"f:I\"})};\n+\n+\t\tClass[] valueClassArr = new Class[uclassDescArr.length];\n+\t\tString containerFields[] = new String[uclassDescArr.length];\n+\t\tMethodHandle[][] valueFieldGetters = new MethodHandle[uclassDescArr.length][];\n+\n+\t\tfor (int i = 0; i < uclassDescArr.length; i++) {\n+\t\t\tUnresolvedClassDesc desc = uclassDescArr[i];\n+\t\t\tvalueClassArr[i] = ValueTypeGenerator.generateValueClass(desc.name, desc.fields);\n+\t\t\tvalueFieldGetters[i] = new MethodHandle[desc.fields.length];\n+\t\t\tcontainerFields[i] = \"v\"+(i+1)+\":Q\"+desc.name+\";\";\n+\n+\t\t\tfor (int j = 0; j < desc.fields.length; j++) {\n+\t\t\t\tString[] nameAndSig = desc.fields[j].split(\":\");\n+\t\t\t\tvalueFieldGetters[i][j] = generateGenericGetter(valueClassArr[i], nameAndSig[0]);\n+\t\t\t}\n+\t\t}\n+\n+\t\tClass containerClass = ValueTypeGenerator.generateRefClass(\"ContainerForUnresolvedB\", containerFields);\n+\n+\t\tString fieldsUsing[] = {};\n+\t\tClass usingClass = ValueTypeGenerator.generateRefClass(\"UsingUnresolvedB\", fieldsUsing, \"ContainerForUnresolvedB\", containerFields);\n+\n+\t\tMethodHandle getFieldUnresolved = lookup.findStatic(usingClass, \"testUnresolvedValueTypeGetField\",\n+\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tMethodType.methodType(Object.class, new Class[] {int.class, containerClass}));\n+\n+\t\tfor (int i = 0; i < 10; i++) {\n+\t\t\t// Pass -1 to avoid execution of GETFIELD against field that has a value type class\n+\t\t\t// In turn that delays the resolution of the value type class\n+\t\t\tassertNull(getFieldUnresolved.invoke(-1, null));", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "9520d8c1eea80c7442e0d1741e833718ee72c9ac"}, "originalPosition": 115}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNzYyODA4MQ==", "bodyText": "Would adding some java example code on how UnresolvedB* , ContainerForUnresolvedB, UsingUnresolvedB, and getters are defined and used help people follow the test better? Same question on testUnresolvedPutFieldUse.", "url": "https://github.com/eclipse-openj9/openj9/pull/11097#discussion_r517628081", "createdAt": "2020-11-04T20:59:43Z", "author": {"login": "a7ehuo"}, "path": "test/functional/Valhalla/src/org/openj9/test/lworld/ValueTypeTests.java", "diffHunk": "@@ -2460,6 +2460,201 @@ static public void testFlattenedFieldInitSequence() throws Throwable {\n \t\tassertNotNull(getB.invoke(getD.invoke(containerC)));\n \t}\n \t\n+\t/*\n+\t * Test use of DEFAULTVALUE for a value type class that has not been resolved.\n+\t * The method is first called so that the DEFAULTVALUE will not be executed,\n+\t * and the class not resolved, and then called so that the DEFAULTVALUE\n+\t * and class resolution is triggered.\n+\t */\n+\t@Test(priority=1)\n+\tstatic public void testUnresolvedDefaultValueUse() throws Throwable {\n+\t\tString fields[] = {\"x:I\", \"y:I\"};\n+\t\tClass valueClass = ValueTypeGenerator.generateValueClass(\"UnresolvedA\", fields);\n+\t\tString fields2[] = {};\n+\t\tClass usingClass = ValueTypeGenerator.generateRefClass(\"UsingUnresolvedA\", fields2, \"UnresolvedA\");\n+\n+\t\tMethodHandle defaultValueUnresolved = lookup.findStatic(usingClass, \"testUnresolvedValueTypeDefaultValue\", MethodType.methodType(Object.class, int.class));\n+\n+\t\tfor (int i = 0; i < 10; i++) {\n+\t\t\t// Pass zero to avoid execution of DEFAULTVALUE and resolution of value type class\n+\t\t\tassertNull(defaultValueUnresolved.invoke(0));\n+\t\t}\n+\n+\t\tMethodHandle getX = generateGenericGetter(valueClass, \"x\");\n+\t\tMethodHandle getY = generateGenericGetter(valueClass, \"y\");\n+\n+\t\tfor (int i = 0; i < 10; i++) {\n+\t\t\t// Pass one to force execution of DEFAULTVALUE and resolution of value type class\n+\t\t\tObject defaultValue = defaultValueUnresolved.invoke(1);\n+\t\t\tassertNotNull(defaultValue);\n+\t\t\tassertEquals(getX.invoke(defaultValue), Integer.valueOf(0));\n+\t\t\tassertEquals(getY.invoke(defaultValue), Integer.valueOf(0));\n+\t\t}\n+\t}\n+\n+\t@Test(priority=1)\n+\tstatic public void testUnresolvedWithFieldUse() throws Throwable {\n+\t\tString fields[] = {\"x:I\", \"y:I\"};\n+\t\tClass valueClass = ValueTypeGenerator.generateValueClass(\"UnresolvedD\", fields, \"HostD\");\n+\t\tString fields2[] = {};\n+\t\tClass usingClass = ValueTypeGenerator.generateHostRefClass(\"UsingUnresolvedD\", fields2, \"UnresolvedD\", fields);\n+\n+\t\tMethodHandle withFieldUnresolved = lookup.findStatic(usingClass, \"testUnresolvedValueTypeWithField\", MethodType.methodType(Object.class, new Class[] {int.class, Object.class}));\n+\n+\t\tfor (int i = 0; i < 10; i++) {\n+\t\t\t// Pass zero to avoid execution of WITHFIELD and resolution of value type class\n+\t\t\tassertNull(withFieldUnresolved.invoke(0, null));\n+\t\t}\n+\n+\t\tMethodHandle makeDefaultValue = lookup.findStatic(valueClass, \"makeValueTypeDefaultValue\", MethodType.methodType(Object.class));\n+\t\tObject defaultValue = makeDefaultValue.invoke();\n+\n+\t\tMethodHandle getX = generateGenericGetter(valueClass, \"x\");\n+\t\tMethodHandle getY = generateGenericGetter(valueClass, \"y\");\n+\n+\t\tfor (int i = 0; i < 10; i++) {\n+\t\t\t// Pass one to force execution of WITHFIELD and resolution of value type class\n+\t\t\tObject withFieldValue = (withFieldUnresolved.invoke(1, defaultValue));\n+\t\t\tassertEquals(getX.invoke(withFieldValue), Integer.valueOf(1));\n+\t\t\tassertEquals(getY.invoke(withFieldValue), Integer.valueOf(2));\n+\t\t}\n+\t}\n+\n+\tprivate static class UnresolvedClassDesc {\n+\t\tpublic String name;\n+\t\tpublic String[] fields;\n+\t\tpublic UnresolvedClassDesc(String name, String[] fields) {\n+\t\t\tthis.name = name;\n+\t\t\tthis.fields = fields;\n+\t\t}\n+\t}\n+\n+\t/*\n+\t * Test use of GETFIELD operations on the fields of a container class, where\n+\t * the fields are of value type classes that have not been resolved.\n+\t *\n+\t * The method is first called so that the GETFIELD will not be executed, and\n+\t * the class not resolved, and then called so that the GETFIELD and class\n+\t * resolution is triggered.\n+\t */\n+\t@Test(priority=1)\n+\tstatic public void testUnresolvedGetFieldUse() throws Throwable {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "9520d8c1eea80c7442e0d1741e833718ee72c9ac"}, "originalPosition": 82}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "491ed392c3b77ee942ab11bec5001b2b20ad2e2d", "author": {"user": {"login": "hzongaro", "name": "Henry Zongaro"}}, "url": "https://github.com/eclipse-openj9/openj9/commit/491ed392c3b77ee942ab11bec5001b2b20ad2e2d", "committedDate": "2020-11-03T21:56:16Z", "message": "Simplify generateClass to accept a class configuration object\n\nThe signature for generateClass was becoming unwieldy, with many String\nand String array arguments.  This is an attempt to simplify that with\na ClassConfiguration argument that provides the various pieces of\nconfiguration information.\n\nSigned-off-by:  Henry Zongaro <zongaro@ca.ibm.com>"}, "afterCommit": {"oid": "57a652d00483cac5c92f341e93509a40bd5516f2", "author": {"user": {"login": "hzongaro", "name": "Henry Zongaro"}}, "url": "https://github.com/eclipse-openj9/openj9/commit/57a652d00483cac5c92f341e93509a40bd5516f2", "committedDate": "2020-11-06T01:28:04Z", "message": "Simplify generateClass to accept a class configuration object\n\nThe signature for generateClass was becoming unwieldy, with many String\nand String array arguments.  This is an attempt to simplify that with\na ClassConfiguration argument that provides the various pieces of\nconfiguration information.\n\nSigned-off-by:  Henry Zongaro <zongaro@ca.ibm.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "20e8e8a2ffb0b82381bb17fa8a603bfdd4c9f9fb", "author": {"user": {"login": "hzongaro", "name": "Henry Zongaro"}}, "url": "https://github.com/eclipse-openj9/openj9/commit/20e8e8a2ffb0b82381bb17fa8a603bfdd4c9f9fb", "committedDate": "2020-11-06T01:33:22Z", "message": "Add tests for unresolved value types\n\nAdd tests that perform defaultvalue, withfield, putfield or getfield\noperations on value types, where the types or fields involved will be\nunresolved for the first few times that the method that performs the\noperation is invoked.  This helps to test special JIT handling of\nthese situations in particular.\n\nSigned-off-by:  Henry Zongaro <zongaro@ca.ibm.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "981320df6d1cd23fadf8f599b1ccf01978362cdc", "author": {"user": {"login": "hzongaro", "name": "Henry Zongaro"}}, "url": "https://github.com/eclipse-openj9/openj9/commit/981320df6d1cd23fadf8f599b1ccf01978362cdc", "committedDate": "2020-11-06T01:33:30Z", "message": "Simplify generateClass to accept a class configuration object\n\nThe signature for generateClass was becoming unwieldy, with many String\nand String array arguments.  This is an attempt to simplify that with\na ClassConfiguration argument that provides the various pieces of\nconfiguration information.\n\nSigned-off-by:  Henry Zongaro <zongaro@ca.ibm.com>"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "57a652d00483cac5c92f341e93509a40bd5516f2", "author": {"user": {"login": "hzongaro", "name": "Henry Zongaro"}}, "url": "https://github.com/eclipse-openj9/openj9/commit/57a652d00483cac5c92f341e93509a40bd5516f2", "committedDate": "2020-11-06T01:28:04Z", "message": "Simplify generateClass to accept a class configuration object\n\nThe signature for generateClass was becoming unwieldy, with many String\nand String array arguments.  This is an attempt to simplify that with\na ClassConfiguration argument that provides the various pieces of\nconfiguration information.\n\nSigned-off-by:  Henry Zongaro <zongaro@ca.ibm.com>"}, "afterCommit": {"oid": "981320df6d1cd23fadf8f599b1ccf01978362cdc", "author": {"user": {"login": "hzongaro", "name": "Henry Zongaro"}}, "url": "https://github.com/eclipse-openj9/openj9/commit/981320df6d1cd23fadf8f599b1ccf01978362cdc", "committedDate": "2020-11-06T01:33:30Z", "message": "Simplify generateClass to accept a class configuration object\n\nThe signature for generateClass was becoming unwieldy, with many String\nand String array arguments.  This is an attempt to simplify that with\na ClassConfiguration argument that provides the various pieces of\nconfiguration information.\n\nSigned-off-by:  Henry Zongaro <zongaro@ca.ibm.com>"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTI1MzEyMzky", "url": "https://github.com/eclipse-openj9/openj9/pull/11097#pullrequestreview-525312392", "createdAt": "2020-11-06T16:33:52Z", "commit": {"oid": "981320df6d1cd23fadf8f599b1ccf01978362cdc"}, "state": "COMMENTED", "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wNlQxNjozMzo1MlrOHu1Fjw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wNlQxNjozODo0MlrOHu1Q5w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxODg2NjMxOQ==", "bodyText": "instead of duplicating the body, this can  call generateValueClass(String name, String[] fields, String nestHost) with a null nest host", "url": "https://github.com/eclipse-openj9/openj9/pull/11097#discussion_r518866319", "createdAt": "2020-11-06T16:33:52Z", "author": {"login": "tajila"}, "path": "test/functional/Valhalla/src/org/openj9/test/lworld/ValueTypeGenerator.java", "diffHunk": "@@ -921,17 +1117,64 @@ public static void generateClassFile(String name, byte[] bytes) {\n \t}\n \n \tpublic static Class<?> generateValueClass(String name, String[] fields) throws Throwable {\n-\t\tbyte[] bytes = generateClass(name, fields, false, false);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "981320df6d1cd23fadf8f599b1ccf01978362cdc"}, "originalPosition": 232}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxODg2ODM2Nw==", "bodyText": "can you add a comment describing what accessedContainer and valueClassUsedInCode are", "url": "https://github.com/eclipse-openj9/openj9/pull/11097#discussion_r518868367", "createdAt": "2020-11-06T16:37:14Z", "author": {"login": "tajila"}, "path": "test/functional/Valhalla/src/org/openj9/test/lworld/ValueTypeGenerator.java", "diffHunk": "@@ -46,8 +46,91 @@\n \tstatic {\n \t\tgenerator = new ValueTypeGenerator();\n \t}\n-\t\n-\tprivate static byte[] generateClass(String className, String[] fields, boolean isVerifiable, boolean isRef) {\n+\n+\tprivate static class ClassConfiguration {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "981320df6d1cd23fadf8f599b1ccf01978362cdc"}, "originalPosition": 7}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxODg2OTIyMw==", "bodyText": "nitpick: please use the /* style comments", "url": "https://github.com/eclipse-openj9/openj9/pull/11097#discussion_r518869223", "createdAt": "2020-11-06T16:38:42Z", "author": {"login": "tajila"}, "path": "test/functional/Valhalla/src/org/openj9/test/lworld/ValueTypeTests.java", "diffHunk": "@@ -2460,6 +2460,322 @@ static public void testFlattenedFieldInitSequence() throws Throwable {\n \t\tassertNotNull(getB.invoke(getD.invoke(containerC)));\n \t}\n \t\n+\t/*\n+\t * Test use of DEFAULTVALUE for a value type class that has not been resolved.\n+\t * The method is first called so that the DEFAULTVALUE will not be executed,\n+\t * and the class not resolved, and then called so that the DEFAULTVALUE\n+\t * and class resolution is triggered.\n+\t */\n+\t@Test(priority=1)\n+\tstatic public void testUnresolvedDefaultValueUse() throws Throwable {\n+\t\t// Set up classes that look roughly like this:", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "981320df6d1cd23fadf8f599b1ccf01978362cdc"}, "originalPosition": 12}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTI2MzAwNjY0", "url": "https://github.com/eclipse-openj9/openj9/pull/11097#pullrequestreview-526300664", "createdAt": "2020-11-09T14:20:01Z", "commit": {"oid": "981320df6d1cd23fadf8f599b1ccf01978362cdc"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wOVQxNDoyMDowMVrOHvw_mg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wOVQxNDoyMDowMVrOHvw_mg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxOTg0NzgzNA==", "bodyText": "This should be a call to visitNestMember.  I must have messed it up in the process of refactoring code.", "url": "https://github.com/eclipse-openj9/openj9/pull/11097#discussion_r519847834", "createdAt": "2020-11-09T14:20:01Z", "author": {"login": "hzongaro"}, "path": "test/functional/Valhalla/src/org/openj9/test/lworld/ValueTypeGenerator.java", "diffHunk": "@@ -60,6 +143,14 @@\n \t\t}\n \n \t\tcw.visitSource(className + \".java\", null);\n+\n+\t\tif (nestHost != null) {\n+\t\t\tcw.visitNestHost(nestHost);\n+\t\t}\n+\n+\t\tif (valueUsedInCode != null) {\n+\t\t\tcw.visitNestHost(valueUsedInCode);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "981320df6d1cd23fadf8f599b1ccf01978362cdc"}, "originalPosition": 104}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "fbba1911401fd4be37d50554604842503481cb42", "author": {"user": {"login": "hzongaro", "name": "Henry Zongaro"}}, "url": "https://github.com/eclipse-openj9/openj9/commit/fbba1911401fd4be37d50554604842503481cb42", "committedDate": "2020-11-09T15:06:42Z", "message": "Address review comments\n\nAddressed various review comments:\n\n1) Added comments describing accessedContainer and valueClassUsedInCode\nfields of ClassConfiguration;\n2) Replaced line comments with block comments;\n3) Replaced a call to ClassWriter.visitNestHost with a call to\nClassWriter.visitNestMember.\n\nSigned-off-by:  Henry Zongaro <zongaro@ca.ibm.com>"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTMwNDYyMTUx", "url": "https://github.com/eclipse-openj9/openj9/pull/11097#pullrequestreview-530462151", "createdAt": "2020-11-13T22:40:34Z", "commit": {"oid": "fbba1911401fd4be37d50554604842503481cb42"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTMxMzk1MjE4", "url": "https://github.com/eclipse-openj9/openj9/pull/11097#pullrequestreview-531395218", "createdAt": "2020-11-16T14:53:54Z", "commit": {"oid": "fbba1911401fd4be37d50554604842503481cb42"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 104, "cost": 1, "resetAt": "2021-10-28T18:00:02Z"}}}