{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDk2NDM4ODk1", "number": 10761, "title": "Add jextract option to disable buildID check", "bodyText": "Disable check if jextract.disable.J9RAS.buildID.check is set (to any value).\n\nalways query environment pointer before analyzing dump\nclean up jextract support code\ngenerate J9VM_UNIQUE_BUILD_ID randomly for cmake builds\n\nFixes #10676.", "createdAt": "2020-10-01T17:44:35Z", "url": "https://github.com/eclipse-openj9/openj9/pull/10761", "merged": true, "mergeCommit": {"oid": "0d345e18ece69aee50e46313abfba9dceac8f706"}, "closed": true, "closedAt": "2020-10-05T23:59:22Z", "author": {"login": "keithc-ca"}, "timelineItems": {"totalCount": 8, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdOVbuiAFqTUwMDU5NzMwMg==", "endCursor": "Y3Vyc29yOnYyOpPPAAABdPs0aLAFqTUwMjQ5ODQxNA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTAwNTk3MzAy", "url": "https://github.com/eclipse-openj9/openj9/pull/10761#pullrequestreview-500597302", "createdAt": "2020-10-01T18:07:36Z", "commit": {"oid": "c4b4e9cecb78a98b9d88cd211085d810133574f3"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wMVQxODowNzozNlrOHbVlDw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wMVQxODowNzozNlrOHbVlDw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5ODQyNzE1MQ==", "bodyText": "This is using uninitialized variables. Also total is unused outside of this disabled block of code.", "url": "https://github.com/eclipse-openj9/openj9/pull/10761#discussion_r498427151", "createdAt": "2020-10-01T18:07:36Z", "author": {"login": "pshipton"}, "path": "runtime/jextractnatives/jextractnatives.c", "diffHunk": "@@ -461,37 +455,38 @@ flushCache(void)\n /**\n  * This function implements a very simple caching scheme to accelerate the reading of small objects.\n  * A more sophisticated scheme is implemented in the Java code. This cache allows us to bypass\n- * the relatively expensive call-in to Java for most objects. During a normal jextract run we expect \n+ * the relatively expensive call-in to Java for most objects. During a normal jextract run we expect\n  * the cache to have a hit rate of over 90%.\n  */\n-static void \n+static void\n readCachedMemory(UDATA address, void *structure, UDATA size, UDATA *bytesRead)\n {\n-\tstatic UDATA hits, total;\n+\tstatic UDATA hits;\n+\tstatic UDATA total;\n \n \tdbgCacheElement* thisElement = NULL;\n \tUDATA lineStart = address & ~(UDATA)(sizeof(thisElement->data) - 1);\n \tUDATA endAddress = address + size;\n \n #if 0\n-\tif ( ((++total) % (16 * 1024)) == 0) {\n-\t\tdbgPrint(\"Cache hit rate: %.2f\\n\", (float)hits / (float)(total));\n+\tif (((++total) % (16 * 1024)) == 0) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c4b4e9cecb78a98b9d88cd211085d810133574f3"}, "originalPosition": 431}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTAwNjEwMzUy", "url": "https://github.com/eclipse-openj9/openj9/pull/10761#pullrequestreview-500610352", "createdAt": "2020-10-01T18:26:07Z", "commit": {"oid": "c4b4e9cecb78a98b9d88cd211085d810133574f3"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wMVQxODoyNjowN1rOHbWK3A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wMVQxODoyNjowN1rOHbWK3A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5ODQzNjgyOA==", "bodyText": "I think the option to disable the check should be mentioned in this message.", "url": "https://github.com/eclipse-openj9/openj9/pull/10761#discussion_r498436828", "createdAt": "2020-10-01T18:26:07Z", "author": {"login": "pshipton"}, "path": "runtime/jextractnatives/jextractnatives.c", "diffHunk": "@@ -127,70 +120,76 @@ validateDump(JNIEnv *env)\n \t\treturn JNI_FALSE;\n \t}\n \n-#if !defined (J9VM_RAS_EYECATCHERS)\n+#if !defined(J9VM_RAS_EYECATCHERS)\n \t(*env)->ThrowNew(env, errorClazz, \"RAS is not enabled on this platform\");\n \treturn JNI_FALSE;\n #else\n-\n-\n \tfor(;;) {\n \t\tJ9RAS *ras = NULL;\n-\t\tconst char* rasString = \"J9VMRAS\";\n+\t\tconst char *rasString = \"J9VMRAS\";\n \n \t\tif (callFindPattern((U_8*)rasString, sizeof(rasString), 8, startFrom, &eyecatcher)) {\n \t\t\t(*env)->ThrowNew(env, errorClazz, \"An error occurred while searching for the J9VMRAS eyecatcher\");\n \t\t\treturn JNI_FALSE;\n \t\t}\n \n \t\tif (eyecatcher == (jlong)-1) {\n-\t\t\tj9str_printf(PORTLIB, \n-\t\t\t\t\terrBuf, sizeof(errBuf), \n+\t\t\tj9str_printf(PORTLIB,\n+\t\t\t\t\terrBuf, sizeof(errBuf),\n \t\t\t\t\t\"JVM anchor block (J9VMRAS) not found in dump. Dump may be truncated, corrupted or contains a partially initialized JVM.\");\n \t\t\t(*env)->ThrowNew(env, errorClazz, errBuf);\n \t\t\treturn JNI_FALSE;\n \t\t}\n \n-#if !defined (J9VM_ENV_DATA64)\n-\t\tif ( (U_64)eyecatcher > (U_64)0xFFFFFFFF ) {\n-\t\t\tj9str_printf(PORTLIB, \n-\t\t\t\terrBuf, sizeof(errBuf), \n-\t\t\t\t\"J9RAS is out of range for a 32-bit pointer (0x%16.16llx). This version of jextract is incompatible with this dump.\", \n+#if !defined(J9VM_ENV_DATA64)\n+\t\tif ((U_64)eyecatcher > (U_64)0xFFFFFFFF) {\n+\t\t\tj9str_printf(PORTLIB,\n+\t\t\t\terrBuf, sizeof(errBuf),\n+\t\t\t\t\"J9RAS is out of range for a 32-bit pointer (0x%16.16llx). This version of jextract is incompatible with this dump.\",\n \t\t\t\teyecatcher);\n \t\t\t(*env)->ThrowNew(env, errorClazz, errBuf);\n \t\t\treturn JNI_FALSE;\n \t\t}\n #endif\n-\t\t/* Allocate this, since on 64bit platforms we want to know now that we can't allocate\n-\t\t * the scratch space. This allows us to exit early with a simple error message */\n+\t\t/* Allocate this, since on 64-bit platforms we want to know now that we can't allocate\n+\t\t * the scratch space. This allows us to exit early with a simple error message.\n+\t\t */\n \t\tras = dbgMallocAndRead(sizeof(J9RAS), (void *)(UDATA)eyecatcher);\n \t\tif (ras != NULL) {\n \t\t\tif (ras->bitpattern1 == 0xaa55aa55 && ras->bitpattern2 == 0xaa55aa55) {\n \t\t\t\tif (ras->version != J9RASVersion) {\n-\t\t\t\t\tj9str_printf(PORTLIB, \n-\t\t\t\t\t\terrBuf, sizeof(errBuf), \n-\t\t\t\t\t\t\"J9RAS.version is incorrect (found %u, expecting %u). This version of jextract is incompatible with this dump.\", \n+\t\t\t\t\tj9str_printf(PORTLIB,\n+\t\t\t\t\t\terrBuf, sizeof(errBuf),\n+\t\t\t\t\t\t\"J9RAS.version is incorrect (found %u, expecting %u). This version of jextract is incompatible with this dump.\",\n \t\t\t\t\t\tras->version,\n \t\t\t\t\t\tJ9RASVersion);\n \t\t\t\t\t(*env)->ThrowNew(env, errorClazz, errBuf);\n \t\t\t\t\treturn JNI_FALSE;\n \t\t\t\t}\n \t\t\t\tif (ras->length != sizeof(J9RAS)) {\n-\t\t\t\t\tj9str_printf(PORTLIB, \n-\t\t\t\t\t\terrBuf, sizeof(errBuf), \n-\t\t\t\t\t\t\"J9RAS.length is incorrect (found %u, expecting %u). This version of jextract is incompatible with this dump.\", \n+\t\t\t\t\tj9str_printf(PORTLIB,\n+\t\t\t\t\t\terrBuf, sizeof(errBuf),\n+\t\t\t\t\t\t\"J9RAS.length is incorrect (found %u, expecting %u). This version of jextract is incompatible with this dump.\",\n \t\t\t\t\t\tras->length,\n \t\t\t\t\t\tsizeof(J9RAS));\n \t\t\t\t\t(*env)->ThrowNew(env, errorClazz, errBuf);\n \t\t\t\t\treturn JNI_FALSE;\n \t\t\t\t}\n \t\t\t\tif (ras->buildID != J9UniqueBuildID) {\n-\t\t\t\t\tj9str_printf(PORTLIB, \n-\t\t\t\t\t\terrBuf, sizeof(errBuf), \n-\t\t\t\t\t\t\"J9RAS.buildID is incorrect (found %llx, expecting %llx). This version of jextract is incompatible with this dump.\", \n+\t\t\t\t\tj9str_printf(PORTLIB,\n+\t\t\t\t\t\terrBuf, sizeof(errBuf),\n+\t\t\t\t\t\t\"J9RAS.buildID is incorrect (found %llx, expecting %llx). This version of jextract is incompatible with this dump.\",", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c4b4e9cecb78a98b9d88cd211085d810133574f3"}, "originalPosition": 185}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "c4b4e9cecb78a98b9d88cd211085d810133574f3", "author": {"user": {"login": "keithc-ca", "name": "Keith W. Campbell"}}, "url": "https://github.com/eclipse-openj9/openj9/commit/c4b4e9cecb78a98b9d88cd211085d810133574f3", "committedDate": "2020-10-01T17:12:08Z", "message": "Add system property to disable jextract buildID check\n\nDisable check if 'jextract.disable.J9RAS.buildID.check'\nis set (to any value).\n\n* always query environment pointer before analyzing dump\n* clean up jextract support code\n* generate J9VM_UNIQUE_BUILD_ID randomly for cmake builds\n\nSigned-off-by: Keith W. Campbell <keithc@ca.ibm.com>"}, "afterCommit": {"oid": "741c5953c6816da7c5f0dc40071dd65b89c887df", "author": {"user": {"login": "keithc-ca", "name": "Keith W. Campbell"}}, "url": "https://github.com/eclipse-openj9/openj9/commit/741c5953c6816da7c5f0dc40071dd65b89c887df", "committedDate": "2020-10-01T19:39:16Z", "message": "Add jextract option to disable buildID check\n\nDisable check if '-r' option is present.\n\n* always query environment pointer before analyzing dump\n* clean up jextract support code\n* describe all options in '-help' output\n* generate J9VM_UNIQUE_BUILD_ID randomly for cmake builds\n\nSigned-off-by: Keith W. Campbell <keithc@ca.ibm.com>"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTAwNjg0MTY1", "url": "https://github.com/eclipse-openj9/openj9/pull/10761#pullrequestreview-500684165", "createdAt": "2020-10-01T20:13:49Z", "commit": {"oid": "741c5953c6816da7c5f0dc40071dd65b89c887df"}, "state": "COMMENTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wMVQyMDoxMzo0OVrOHbZWbw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wMVQyMDoxNDo0OFrOHbZYVQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5ODQ4ODk0Mw==", "bodyText": "-interactive is no longer useful, it was replaced by DDR. We kept it alive after DDR was available to support the trprint subcommand, but trying to run that, it doesn't seem to work very well any more and I don't think anybody uses it. Bottom line, it shouldn't be included in the help, and I expect we could delete all the associated code.", "url": "https://github.com/eclipse-openj9/openj9/pull/10761#discussion_r498488943", "createdAt": "2020-10-01T20:13:49Z", "author": {"login": "pshipton"}, "path": "jcl/src/openj9.dtfj/share/classes/com/ibm/jvm/j9/dump/extract/Main.java", "diffHunk": "@@ -367,20 +353,18 @@ private static void ensure(boolean condition, String errorMessage) {\n \t}\n \n \tprivate static void usageMessage(String message, int code) {\n-\t\treport(\"Usage: jextract dump_name [output_filename] [options]\"); //$NON-NLS-1$\n-\t\treport(\" output filename defaults to dump_name.zip\"); //$NON-NLS-1$\n-\t\treport(\" options:\"); //$NON-NLS-1$\n-\t\treport(\"   -f executable_name override executable name\"); //$NON-NLS-1$\n-\t\treport(\"   -help              print this usage message\"); //$NON-NLS-1$\n-\t\treport(\"   -v                 enable verbose output\"); //$NON-NLS-1$\n-\t\tif (_throwExceptions) {\n-\t\t\tthrow new JExtractFatalException(message, code);\n-\t\t} else {\n-\t\t\tif (message != null) {\n-\t\t\t\treport(message);\n-\t\t\t}\n-\t\t\tSystem.exit(code);\n-\t\t}\n+\t\treport(\"Usage: jextract [options] dump_name [output_filename]\"); //$NON-NLS-1$\n+\t\treport(\"  output filename defaults to dump_name.zip\"); //$NON-NLS-1$\n+\t\treport(\"  options:\"); //$NON-NLS-1$\n+\t\treport(\"    -e                  throw exceptions instead of calling System.exit()\"); //$NON-NLS-1$\n+\t\treport(\"    -f executable_name  override executable name\"); //$NON-NLS-1$\n+\t\treport(\"    -help               print this usage message\"); //$NON-NLS-1$\n+\t\treport(\"    -interactive        start an interactive session\"); //$NON-NLS-1$", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "741c5953c6816da7c5f0dc40071dd65b89c887df"}, "originalPosition": 123}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5ODQ4OTQyOQ==", "bodyText": "I don't understand the purpose of this, perhaps a more detailed message is appropriate.", "url": "https://github.com/eclipse-openj9/openj9/pull/10761#discussion_r498489429", "createdAt": "2020-10-01T20:14:48Z", "author": {"login": "pshipton"}, "path": "jcl/src/openj9.dtfj/share/classes/com/ibm/jvm/j9/dump/extract/Main.java", "diffHunk": "@@ -367,20 +353,18 @@ private static void ensure(boolean condition, String errorMessage) {\n \t}\n \n \tprivate static void usageMessage(String message, int code) {\n-\t\treport(\"Usage: jextract dump_name [output_filename] [options]\"); //$NON-NLS-1$\n-\t\treport(\" output filename defaults to dump_name.zip\"); //$NON-NLS-1$\n-\t\treport(\" options:\"); //$NON-NLS-1$\n-\t\treport(\"   -f executable_name override executable name\"); //$NON-NLS-1$\n-\t\treport(\"   -help              print this usage message\"); //$NON-NLS-1$\n-\t\treport(\"   -v                 enable verbose output\"); //$NON-NLS-1$\n-\t\tif (_throwExceptions) {\n-\t\t\tthrow new JExtractFatalException(message, code);\n-\t\t} else {\n-\t\t\tif (message != null) {\n-\t\t\t\treport(message);\n-\t\t\t}\n-\t\t\tSystem.exit(code);\n-\t\t}\n+\t\treport(\"Usage: jextract [options] dump_name [output_filename]\"); //$NON-NLS-1$\n+\t\treport(\"  output filename defaults to dump_name.zip\"); //$NON-NLS-1$\n+\t\treport(\"  options:\"); //$NON-NLS-1$\n+\t\treport(\"    -e                  throw exceptions instead of calling System.exit()\"); //$NON-NLS-1$\n+\t\treport(\"    -f executable_name  override executable name\"); //$NON-NLS-1$\n+\t\treport(\"    -help               print this usage message\"); //$NON-NLS-1$\n+\t\treport(\"    -interactive        start an interactive session\"); //$NON-NLS-1$\n+\t\treport(\"    -p prefix           prefix for all paths (absolute or relative)\"); //$NON-NLS-1$\n+\t\treport(\"    -r                  relax version checking\"); //$NON-NLS-1$\n+\t\treport(\"    -v                  enable verbose output\"); //$NON-NLS-1$\n+\t\treport(\"    --                  mark end of options\"); //$NON-NLS-1$", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "741c5953c6816da7c5f0dc40071dd65b89c887df"}, "originalPosition": 127}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "741c5953c6816da7c5f0dc40071dd65b89c887df", "author": {"user": {"login": "keithc-ca", "name": "Keith W. Campbell"}}, "url": "https://github.com/eclipse-openj9/openj9/commit/741c5953c6816da7c5f0dc40071dd65b89c887df", "committedDate": "2020-10-01T19:39:16Z", "message": "Add jextract option to disable buildID check\n\nDisable check if '-r' option is present.\n\n* always query environment pointer before analyzing dump\n* clean up jextract support code\n* describe all options in '-help' output\n* generate J9VM_UNIQUE_BUILD_ID randomly for cmake builds\n\nSigned-off-by: Keith W. Campbell <keithc@ca.ibm.com>"}, "afterCommit": {"oid": "26b7b6c3c3906047f54dc17eb5c696c8809e81bc", "author": {"user": {"login": "keithc-ca", "name": "Keith W. Campbell"}}, "url": "https://github.com/eclipse-openj9/openj9/commit/26b7b6c3c3906047f54dc17eb5c696c8809e81bc", "committedDate": "2020-10-01T20:32:27Z", "message": "Add jextract option to disable buildID check\n\nDisable check if '-r' option is present.\n\n* always query environment pointer before analyzing dump\n* clean up jextract support code\n* describe all options in '-help' output\n* generate J9VM_UNIQUE_BUILD_ID randomly for cmake builds\n\nSigned-off-by: Keith W. Campbell <keithc@ca.ibm.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "d3544d45a0f10ccb31e8a1d5405ed1c0e07b4ca8", "author": {"user": {"login": "keithc-ca", "name": "Keith W. Campbell"}}, "url": "https://github.com/eclipse-openj9/openj9/commit/d3544d45a0f10ccb31e8a1d5405ed1c0e07b4ca8", "committedDate": "2020-10-02T16:06:36Z", "message": "Add jextract option to disable buildID check\n\nDisable check if '-r' option is present.\n\n* always query environment pointer before analyzing dump\n* clean up jextract support code\n* describe all options in '-help' output\n* generate J9VM_UNIQUE_BUILD_ID randomly for cmake builds\n* UMA: generate the same unique buildID for compressed and default\n\nSigned-off-by: Keith W. Campbell <keithc@ca.ibm.com>"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "26b7b6c3c3906047f54dc17eb5c696c8809e81bc", "author": {"user": {"login": "keithc-ca", "name": "Keith W. Campbell"}}, "url": "https://github.com/eclipse-openj9/openj9/commit/26b7b6c3c3906047f54dc17eb5c696c8809e81bc", "committedDate": "2020-10-01T20:32:27Z", "message": "Add jextract option to disable buildID check\n\nDisable check if '-r' option is present.\n\n* always query environment pointer before analyzing dump\n* clean up jextract support code\n* describe all options in '-help' output\n* generate J9VM_UNIQUE_BUILD_ID randomly for cmake builds\n\nSigned-off-by: Keith W. Campbell <keithc@ca.ibm.com>"}, "afterCommit": {"oid": "d3544d45a0f10ccb31e8a1d5405ed1c0e07b4ca8", "author": {"user": {"login": "keithc-ca", "name": "Keith W. Campbell"}}, "url": "https://github.com/eclipse-openj9/openj9/commit/d3544d45a0f10ccb31e8a1d5405ed1c0e07b4ca8", "committedDate": "2020-10-02T16:06:36Z", "message": "Add jextract option to disable buildID check\n\nDisable check if '-r' option is present.\n\n* always query environment pointer before analyzing dump\n* clean up jextract support code\n* describe all options in '-help' output\n* generate J9VM_UNIQUE_BUILD_ID randomly for cmake builds\n* UMA: generate the same unique buildID for compressed and default\n\nSigned-off-by: Keith W. Campbell <keithc@ca.ibm.com>"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTAyNDk4NDE0", "url": "https://github.com/eclipse-openj9/openj9/pull/10761#pullrequestreview-502498414", "createdAt": "2020-10-05T23:59:10Z", "commit": {"oid": "d3544d45a0f10ccb31e8a1d5405ed1c0e07b4ca8"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 353, "cost": 1, "resetAt": "2021-10-28T18:00:02Z"}}}