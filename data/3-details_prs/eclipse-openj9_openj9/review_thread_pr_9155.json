{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDAwMjY4NTI4", "number": 9155, "reviewThreads": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wN1QxMzo0NDowM1rODvkWkQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wOFQwMToxNzoxMVrODvzDcQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjUxMjA1MjY1OnYy", "diffSide": "RIGHT", "path": "runtime/port/unix/j9sysinfo.c", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wN1QxMzo0NDowM1rOGCEOlw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wN1QxNDoxMDoxM1rOGCFamg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNDgxOTYwNw==", "bodyText": "Nitpick - we typically avoid // comments in VM code as not all supported compilers accept them and its easier to blanket ban them then ensure they are only present where in platform-specific code\n\n  \n    \n  \n    \n\n  \n  This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters. Learn more about bidirectional Unicode characters\n\n\n  \n\n\n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            \t\t\t// Cache line size in unavailable on some systems\n          \n          \n            \n            \t\t\t/* Cache line size in unavailable on some systems */", "url": "https://github.com/eclipse-openj9/openj9/pull/9155#discussion_r404819607", "createdAt": "2020-04-07T13:44:03Z", "author": {"login": "DanHeidinga"}, "path": "runtime/port/unix/j9sysinfo.c", "diffHunk": "@@ -1675,8 +1675,11 @@ j9sysinfo_get_cache_info(struct J9PortLibrary *portLibrary, const J9CacheInfoQue\n \t) {\n \t\t/* L1 data cache line size */\n \t\tint32_t rc = (int32_t)sysconf(_SC_LEVEL1_DCACHE_LINESIZE);\n-\t\tif (rc >= 0) {\n+\t\tif (rc > 0) {\n \t\t\tresult = rc;\n+\t\t} else if (rc == 0) {\n+\t\t\t// Cache line size in unavailable on some systems", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "88ef36f44ef0937bbfc888d4a72f7b9f00eaccab"}, "originalPosition": 8}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNDgzOTA2Ng==", "bodyText": "Updated the code as suggested.", "url": "https://github.com/eclipse-openj9/openj9/pull/9155#discussion_r404839066", "createdAt": "2020-04-07T14:10:13Z", "author": {"login": "knn-k"}, "path": "runtime/port/unix/j9sysinfo.c", "diffHunk": "@@ -1675,8 +1675,11 @@ j9sysinfo_get_cache_info(struct J9PortLibrary *portLibrary, const J9CacheInfoQue\n \t) {\n \t\t/* L1 data cache line size */\n \t\tint32_t rc = (int32_t)sysconf(_SC_LEVEL1_DCACHE_LINESIZE);\n-\t\tif (rc >= 0) {\n+\t\tif (rc > 0) {\n \t\t\tresult = rc;\n+\t\t} else if (rc == 0) {\n+\t\t\t// Cache line size in unavailable on some systems", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNDgxOTYwNw=="}, "originalCommit": {"oid": "88ef36f44ef0937bbfc888d4a72f7b9f00eaccab"}, "originalPosition": 8}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjUxMjA1Nzk0OnYy", "diffSide": "RIGHT", "path": "runtime/port/unix/j9sysinfo.c", "isResolved": true, "comments": {"totalCount": 6, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wN1QxMzo0NToxMFrOGCER3Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wOFQwMTo0MDoxMVrOGCcCKg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNDgyMDQ0NQ==", "bodyText": "I had suggested 64 in the issue where this was discussed but have no experience on aarch64 to tell if that's actually reasonable.  Does 64 make sense given the chips that are available?  Would another value be a safer default?", "url": "https://github.com/eclipse-openj9/openj9/pull/9155#discussion_r404820445", "createdAt": "2020-04-07T13:45:10Z", "author": {"login": "DanHeidinga"}, "path": "runtime/port/unix/j9sysinfo.c", "diffHunk": "@@ -1675,8 +1675,11 @@ j9sysinfo_get_cache_info(struct J9PortLibrary *portLibrary, const J9CacheInfoQue\n \t) {\n \t\t/* L1 data cache line size */\n \t\tint32_t rc = (int32_t)sysconf(_SC_LEVEL1_DCACHE_LINESIZE);\n-\t\tif (rc >= 0) {\n+\t\tif (rc > 0) {\n \t\t\tresult = rc;\n+\t\t} else if (rc == 0) {\n+\t\t\t// Cache line size in unavailable on some systems\n+\t\t\tresult = 64;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "88ef36f44ef0937bbfc888d4a72f7b9f00eaccab"}, "originalPosition": 9}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNDgzMTcxOA==", "bodyText": "As I understand it, it's better if the number is too big than too small. If it's too big then a little memory will be wasted, but if it's too small then it will defeat the purpose of the optimization and affect performance.", "url": "https://github.com/eclipse-openj9/openj9/pull/9155#discussion_r404831718", "createdAt": "2020-04-07T14:00:01Z", "author": {"login": "pshipton"}, "path": "runtime/port/unix/j9sysinfo.c", "diffHunk": "@@ -1675,8 +1675,11 @@ j9sysinfo_get_cache_info(struct J9PortLibrary *portLibrary, const J9CacheInfoQue\n \t) {\n \t\t/* L1 data cache line size */\n \t\tint32_t rc = (int32_t)sysconf(_SC_LEVEL1_DCACHE_LINESIZE);\n-\t\tif (rc >= 0) {\n+\t\tif (rc > 0) {\n \t\t\tresult = rc;\n+\t\t} else if (rc == 0) {\n+\t\t\t// Cache line size in unavailable on some systems\n+\t\t\tresult = 64;", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNDgyMDQ0NQ=="}, "originalCommit": {"oid": "88ef36f44ef0937bbfc888d4a72f7b9f00eaccab"}, "originalPosition": 9}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNDgzNzQ2NA==", "bodyText": "The line size of L1 data cache of Cortex-A53 (low-end AArch64 core) is 64 bytes, as stated in http://infocenter.arm.com/help/index.jsp?topic=/com.arm.doc.ddi0500j/BABCFDAH.html.\nOther Cortex-A3x, A5x and A7x chips also seem to have 64 byte cache line in L1 data cache.", "url": "https://github.com/eclipse-openj9/openj9/pull/9155#discussion_r404837464", "createdAt": "2020-04-07T14:07:59Z", "author": {"login": "knn-k"}, "path": "runtime/port/unix/j9sysinfo.c", "diffHunk": "@@ -1675,8 +1675,11 @@ j9sysinfo_get_cache_info(struct J9PortLibrary *portLibrary, const J9CacheInfoQue\n \t) {\n \t\t/* L1 data cache line size */\n \t\tint32_t rc = (int32_t)sysconf(_SC_LEVEL1_DCACHE_LINESIZE);\n-\t\tif (rc >= 0) {\n+\t\tif (rc > 0) {\n \t\t\tresult = rc;\n+\t\t} else if (rc == 0) {\n+\t\t\t// Cache line size in unavailable on some systems\n+\t\t\tresult = 64;", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNDgyMDQ0NQ=="}, "originalCommit": {"oid": "88ef36f44ef0937bbfc888d4a72f7b9f00eaccab"}, "originalPosition": 9}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNTE5OTA5MQ==", "bodyText": "I don't think there is a good reason to choose other line size.  Cortex AArch64 cores seem to have the 64 byte cache lines.\n64 should be better than 0.", "url": "https://github.com/eclipse-openj9/openj9/pull/9155#discussion_r405199091", "createdAt": "2020-04-08T00:59:55Z", "author": {"login": "knn-k"}, "path": "runtime/port/unix/j9sysinfo.c", "diffHunk": "@@ -1675,8 +1675,11 @@ j9sysinfo_get_cache_info(struct J9PortLibrary *portLibrary, const J9CacheInfoQue\n \t) {\n \t\t/* L1 data cache line size */\n \t\tint32_t rc = (int32_t)sysconf(_SC_LEVEL1_DCACHE_LINESIZE);\n-\t\tif (rc >= 0) {\n+\t\tif (rc > 0) {\n \t\t\tresult = rc;\n+\t\t} else if (rc == 0) {\n+\t\t\t// Cache line size in unavailable on some systems\n+\t\t\tresult = 64;", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNDgyMDQ0NQ=="}, "originalCommit": {"oid": "88ef36f44ef0937bbfc888d4a72f7b9f00eaccab"}, "originalPosition": 9}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNTIwMzc1Ng==", "bodyText": "Pls add the information https://github.com/eclipse/openj9/pull/9155/files#r404837464 as a comment in the code for future reference.", "url": "https://github.com/eclipse-openj9/openj9/pull/9155#discussion_r405203756", "createdAt": "2020-04-08T01:18:10Z", "author": {"login": "pshipton"}, "path": "runtime/port/unix/j9sysinfo.c", "diffHunk": "@@ -1675,8 +1675,11 @@ j9sysinfo_get_cache_info(struct J9PortLibrary *portLibrary, const J9CacheInfoQue\n \t) {\n \t\t/* L1 data cache line size */\n \t\tint32_t rc = (int32_t)sysconf(_SC_LEVEL1_DCACHE_LINESIZE);\n-\t\tif (rc >= 0) {\n+\t\tif (rc > 0) {\n \t\t\tresult = rc;\n+\t\t} else if (rc == 0) {\n+\t\t\t// Cache line size in unavailable on some systems\n+\t\t\tresult = 64;", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNDgyMDQ0NQ=="}, "originalCommit": {"oid": "88ef36f44ef0937bbfc888d4a72f7b9f00eaccab"}, "originalPosition": 9}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNTIwOTY0Mg==", "bodyText": "Updated the comment.", "url": "https://github.com/eclipse-openj9/openj9/pull/9155#discussion_r405209642", "createdAt": "2020-04-08T01:40:11Z", "author": {"login": "knn-k"}, "path": "runtime/port/unix/j9sysinfo.c", "diffHunk": "@@ -1675,8 +1675,11 @@ j9sysinfo_get_cache_info(struct J9PortLibrary *portLibrary, const J9CacheInfoQue\n \t) {\n \t\t/* L1 data cache line size */\n \t\tint32_t rc = (int32_t)sysconf(_SC_LEVEL1_DCACHE_LINESIZE);\n-\t\tif (rc >= 0) {\n+\t\tif (rc > 0) {\n \t\t\tresult = rc;\n+\t\t} else if (rc == 0) {\n+\t\t\t// Cache line size in unavailable on some systems\n+\t\t\tresult = 64;", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNDgyMDQ0NQ=="}, "originalCommit": {"oid": "88ef36f44ef0937bbfc888d4a72f7b9f00eaccab"}, "originalPosition": 9}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjUxNDQ2MTI5OnYy", "diffSide": "RIGHT", "path": "runtime/port/unix/j9sysinfo.c", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wOFQwMToxNzoxMVrOGCbqFA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wOFQwMToxNzoxMVrOGCbqFA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNTIwMzQ3Ng==", "bodyText": "Typo in should be is", "url": "https://github.com/eclipse-openj9/openj9/pull/9155#discussion_r405203476", "createdAt": "2020-04-08T01:17:11Z", "author": {"login": "pshipton"}, "path": "runtime/port/unix/j9sysinfo.c", "diffHunk": "@@ -1675,8 +1675,11 @@ j9sysinfo_get_cache_info(struct J9PortLibrary *portLibrary, const J9CacheInfoQue\n \t) {\n \t\t/* L1 data cache line size */\n \t\tint32_t rc = (int32_t)sysconf(_SC_LEVEL1_DCACHE_LINESIZE);\n-\t\tif (rc >= 0) {\n+\t\tif (rc > 0) {\n \t\t\tresult = rc;\n+\t\t} else if (rc == 0) {\n+\t\t\t/* Cache line size in unavailable on some systems */", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "86175da91f7fc0eff778a588fd70bc281c7d7436"}, "originalPosition": 8}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 356, "cost": 1, "resetAt": "2021-11-12T13:16:51Z"}}}