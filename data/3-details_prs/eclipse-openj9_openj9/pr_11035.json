{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTExNzk0NzA4", "number": 11035, "title": "JEP390 implementation", "bodyText": "Parse @ValueBased annotation and add flags for value based classes.\nAdd CML -XX:ValueBasedClassCheck=warn.\nPrint out a warning message for monitorenter on a value based class.\nAdd CML -XX:ValueBasedClassCheck=exception. Throw a\nVirtualMachineError for monitorenter on a value based class.\nAdd VM helper areValueBasedMonitorChecksEnabled().\n\nissue #10620\nSigned-off-by: Hang Shao hangshao@ca.ibm.com", "createdAt": "2020-10-28T19:43:10Z", "url": "https://github.com/eclipse-openj9/openj9/pull/11035", "merged": true, "mergeCommit": {"oid": "a7b7dbe51e2c8801b4f0a22bb98322d7dda76692"}, "closed": true, "closedAt": "2020-11-30T16:51:45Z", "author": {"login": "hangshao0"}, "timelineItems": {"totalCount": 16, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdXDBF0ABqjM5MzMxMDg1ODQ=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdgv9nXgBqjQwNDc0NTQ5MzM=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "b2cfb0da5e6ae81b9d605e507dfb1e1e31ce20db", "author": {"user": {"login": "hangshao0", "name": "Hang Shao"}}, "url": "https://github.com/eclipse-openj9/openj9/commit/b2cfb0da5e6ae81b9d605e507dfb1e1e31ce20db", "committedDate": "2020-10-28T19:41:52Z", "message": "JEP390 implementation\n\n1. Parse @ValueBased annotation and add flags for value based classes.\n2. Add CML -XX:addValueBasedClassChecks=exception. \nPrint out a warning message for monitorenter on a value based class.\n3. Add CML -XX:addValueBasedClassChecks=exception. Throw a\nVirtualMachineError for monitorenter on a value based class.\n\nissue #10620\n\nSigned-off-by: Hang Shao <hangshao@ca.ibm.com>"}, "afterCommit": {"oid": "9a8d048b82e376aa619c6693ff383122336f5562", "author": {"user": {"login": "hangshao0", "name": "Hang Shao"}}, "url": "https://github.com/eclipse-openj9/openj9/commit/9a8d048b82e376aa619c6693ff383122336f5562", "committedDate": "2020-10-28T19:48:06Z", "message": "JEP390 implementation\n\n1. Parse @ValueBased annotation and add flags for value based classes.\n2. Add CML -XX:addValueBasedClassChecks=exception. \nPrint out a warning message for monitorenter on a value based class.\n3. Add CML -XX:addValueBasedClassChecks=exception. Throw a\nVirtualMachineError for monitorenter on a value based class.\n4. Add VM helper areValueBasedMonitorChecksEnabled().\n\nissue #10620\n\nSigned-off-by: Hang Shao <hangshao@ca.ibm.com>"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "9a8d048b82e376aa619c6693ff383122336f5562", "author": {"user": {"login": "hangshao0", "name": "Hang Shao"}}, "url": "https://github.com/eclipse-openj9/openj9/commit/9a8d048b82e376aa619c6693ff383122336f5562", "committedDate": "2020-10-28T19:48:06Z", "message": "JEP390 implementation\n\n1. Parse @ValueBased annotation and add flags for value based classes.\n2. Add CML -XX:addValueBasedClassChecks=exception. \nPrint out a warning message for monitorenter on a value based class.\n3. Add CML -XX:addValueBasedClassChecks=exception. Throw a\nVirtualMachineError for monitorenter on a value based class.\n4. Add VM helper areValueBasedMonitorChecksEnabled().\n\nissue #10620\n\nSigned-off-by: Hang Shao <hangshao@ca.ibm.com>"}, "afterCommit": {"oid": "26e696a6224e1eff156e561495bba638c47e592b", "author": {"user": {"login": "hangshao0", "name": "Hang Shao"}}, "url": "https://github.com/eclipse-openj9/openj9/commit/26e696a6224e1eff156e561495bba638c47e592b", "committedDate": "2020-10-28T19:58:49Z", "message": "JEP390 implementation\n\n1. Parse @ValueBased annotation and add flags for value based classes.\n2. Add CML -XX:addValueBasedClassChecks=warn. \nPrint out a warning message for monitorenter on a value based class.\n3. Add CML -XX:addValueBasedClassChecks=exception. Throw a\nVirtualMachineError for monitorenter on a value based class.\n4. Add VM helper areValueBasedMonitorChecksEnabled().\n\nissue #10620\n\nSigned-off-by: Hang Shao <hangshao@ca.ibm.com>"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTE5Njc0Mjk0", "url": "https://github.com/eclipse-openj9/openj9/pull/11035#pullrequestreview-519674294", "createdAt": "2020-10-29T13:40:38Z", "commit": {"oid": "26e696a6224e1eff156e561495bba638c47e592b"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yOVQxMzo0MDozOFrOHqcS8A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yOVQxMzo0MDozOFrOHqcS8A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNDI2NTg0MA==", "bodyText": "Are we matching the Hotspot option here?   It would be best if we can use the same option so users get a consistent experience.\nIf not, our -XX options start with capital letters (mostly).  Renaming to something like -XX:ValueBasedClassCheck=[exception|warn] would be clearer?\nOr handled with multiple options like:\n-XX[+-]EnableValueBasedClassChecks to enable the checks\n-XX:[+-]ThrowForValueBasedClassChecks to throw an exception\n-XX:[+-]WarnForValueBasedClassChecks to warn", "url": "https://github.com/eclipse-openj9/openj9/pull/11035#discussion_r514265840", "createdAt": "2020-10-29T13:40:38Z", "author": {"login": "DanHeidinga"}, "path": "runtime/oti/jvminit.h", "diffHunk": "@@ -391,6 +391,9 @@ enum INIT_STAGE {\n #define VMOPT_XXDISABLEVALHALLA \"-XX:-EnableValhalla\"\n #endif /* defined(J9VM_OPT_VALHALLA_VALUE_TYPES) */\n \n+#define VMOPT_XXADDVALUEBASEDCLASSCHECKSEXCEPTION \"-XX:addValueBasedClassChecks=exception\"\n+#define VMOPT_XXADDVALUEBASEDCLASSCHECKSWARN \"-XX:addValueBasedClassChecks=warn\"", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "26e696a6224e1eff156e561495bba638c47e592b"}, "originalPosition": 5}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "26e696a6224e1eff156e561495bba638c47e592b", "author": {"user": {"login": "hangshao0", "name": "Hang Shao"}}, "url": "https://github.com/eclipse-openj9/openj9/commit/26e696a6224e1eff156e561495bba638c47e592b", "committedDate": "2020-10-28T19:58:49Z", "message": "JEP390 implementation\n\n1. Parse @ValueBased annotation and add flags for value based classes.\n2. Add CML -XX:addValueBasedClassChecks=warn. \nPrint out a warning message for monitorenter on a value based class.\n3. Add CML -XX:addValueBasedClassChecks=exception. Throw a\nVirtualMachineError for monitorenter on a value based class.\n4. Add VM helper areValueBasedMonitorChecksEnabled().\n\nissue #10620\n\nSigned-off-by: Hang Shao <hangshao@ca.ibm.com>"}, "afterCommit": {"oid": "31edcd3d86e9915c878174b30cff1e1794314a82", "author": {"user": {"login": "hangshao0", "name": "Hang Shao"}}, "url": "https://github.com/eclipse-openj9/openj9/commit/31edcd3d86e9915c878174b30cff1e1794314a82", "committedDate": "2020-10-29T15:55:43Z", "message": "JEP390 implementation\n\n1. Parse @ValueBased annotation and add flags for value based classes.\n2. Add CML -XX:ValueBasedClassCheck=warn. \nPrint out a warning message for monitorenter on a value based class.\n3. Add CML -XX:ValueBasedClassCheck=exception. Throw a\nVirtualMachineError for monitorenter on a value based class.\n4. Add VM helper areValueBasedMonitorChecksEnabled().\n\nissue #10620\n\nSigned-off-by: Hang Shao <hangshao@ca.ibm.com>"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "31edcd3d86e9915c878174b30cff1e1794314a82", "author": {"user": {"login": "hangshao0", "name": "Hang Shao"}}, "url": "https://github.com/eclipse-openj9/openj9/commit/31edcd3d86e9915c878174b30cff1e1794314a82", "committedDate": "2020-10-29T15:55:43Z", "message": "JEP390 implementation\n\n1. Parse @ValueBased annotation and add flags for value based classes.\n2. Add CML -XX:ValueBasedClassCheck=warn. \nPrint out a warning message for monitorenter on a value based class.\n3. Add CML -XX:ValueBasedClassCheck=exception. Throw a\nVirtualMachineError for monitorenter on a value based class.\n4. Add VM helper areValueBasedMonitorChecksEnabled().\n\nissue #10620\n\nSigned-off-by: Hang Shao <hangshao@ca.ibm.com>"}, "afterCommit": {"oid": "5418baab5f05d628de054a776c0f87fe4d73dce4", "author": {"user": {"login": "hangshao0", "name": "Hang Shao"}}, "url": "https://github.com/eclipse-openj9/openj9/commit/5418baab5f05d628de054a776c0f87fe4d73dce4", "committedDate": "2020-10-29T16:04:07Z", "message": "JEP390 implementation\n\n1. Parse @ValueBased annotation and add flags for value based classes.\n2. Add CML -XX:ValueBasedClassCheck=warn. \nPrint out a warning message for monitorenter on a value based class.\n3. Add CML -XX:ValueBasedClassCheck=exception. Throw a\nVirtualMachineError for monitorenter on a value based class.\n4. Add VM helper areValueBasedMonitorChecksEnabled().\n\nissue #10620\n\nSigned-off-by: Hang Shao <hangshao@ca.ibm.com>"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTE5OTAwODk4", "url": "https://github.com/eclipse-openj9/openj9/pull/11035#pullrequestreview-519900898", "createdAt": "2020-10-29T17:18:55Z", "commit": {"oid": "5418baab5f05d628de054a776c0f87fe4d73dce4"}, "state": "COMMENTED", "comments": {"totalCount": 8, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yOVQxNzoxODo1NVrOHqme4Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yOVQxNzozODoyNFrOHqnRUA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNDQzMjczNw==", "bodyText": "I would add a new macro\n#define J9_CLASS_DISALLOWS_LOCKING (J9ClassIsValueType | J9ClassIsValueBased)\n#define J9_DOES_CLASS_DISALLOW_LOCKING(clazz) J9_ARE_ALL_BITS_SET((clazz)->classFlags, J9_CLASS_DISALLOWS_LOCKING)", "url": "https://github.com/eclipse-openj9/openj9/pull/11035#discussion_r514432737", "createdAt": "2020-10-29T17:18:55Z", "author": {"login": "tajila"}, "path": "runtime/oti/j9.h", "diffHunk": "@@ -309,6 +309,7 @@ static const struct { \\\n \t((NULL != (interfaceClass)) && ((J9_ITABLE_INDEX_UNRESOLVED != ((methodIndexAndArgCount) & ~255))))\n \n /* Macros for ValueTypes */", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "5418baab5f05d628de054a776c0f87fe4d73dce4"}, "originalPosition": 3}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNDQzMzI2Nw==", "bodyText": "this should just be !J9_DOES_CLASS_DISALLOW_LOCKING(clazz) no need to add the exception code to the fast path as if this fails it will call the slow path", "url": "https://github.com/eclipse-openj9/openj9/pull/11035#discussion_r514433267", "createdAt": "2020-10-29T17:19:39Z", "author": {"login": "tajila"}, "path": "runtime/oti/ObjectMonitor.hpp", "diffHunk": "@@ -279,10 +280,22 @@ class VM_ObjectMonitor\n \t\tbool locked = false;\n \t\tif (LN_HAS_LOCKWORD(currentThread, object)\n #if defined(J9VM_OPT_VALHALLA_VALUE_TYPES)\n-\t\t&& !J9_IS_J9CLASS_VALUETYPE(J9OBJECT_CLAZZ(currentThread, object))\n+\t\t&& !J9_IS_J9CLASS_VALUETYPE(J9OBJECT_CLAZZ(currentThread, object)", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "5418baab5f05d628de054a776c0f87fe4d73dce4"}, "originalPosition": 13}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNDQzMzU2Nw==", "bodyText": "all the exception code can be put in the slow path", "url": "https://github.com/eclipse-openj9/openj9/pull/11035#discussion_r514433567", "createdAt": "2020-10-29T17:20:05Z", "author": {"login": "tajila"}, "path": "runtime/oti/ObjectMonitor.hpp", "diffHunk": "@@ -279,10 +280,22 @@ class VM_ObjectMonitor\n \t\tbool locked = false;\n \t\tif (LN_HAS_LOCKWORD(currentThread, object)\n #if defined(J9VM_OPT_VALHALLA_VALUE_TYPES)\n-\t\t&& !J9_IS_J9CLASS_VALUETYPE(J9OBJECT_CLAZZ(currentThread, object))\n+\t\t&& !J9_IS_J9CLASS_VALUETYPE(J9OBJECT_CLAZZ(currentThread, object)", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNDQzMzI2Nw=="}, "originalCommit": {"oid": "5418baab5f05d628de054a776c0f87fe4d73dce4"}, "originalPosition": 13}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNDQ0MzU3Mg==", "bodyText": "you can keep the original macro guards, but instead of the VT check it can be a JDK16+ check.", "url": "https://github.com/eclipse-openj9/openj9/pull/11035#discussion_r514443572", "createdAt": "2020-10-29T17:35:09Z", "author": {"login": "tajila"}, "path": "runtime/codert_vm/cnathelp.cpp", "diffHunk": "@@ -1616,12 +1616,16 @@ slow_jitMonitorEnterImpl(J9VMThread *currentThread, bool forMethod)\n \t\t\t\tresolveFrame->specialFrameFlags = (resolveFrame->specialFrameFlags & ~J9_STACK_FLAGS_JIT_FRAME_SUB_TYPE_MASK) | J9_STACK_FLAGS_JIT_FAILED_METHOD_MONITOR_ENTER_RESOLVE;\n \t\t\t}\n \t\t}\n-#if defined(J9VM_OPT_VALHALLA_VALUE_TYPES)", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "5418baab5f05d628de054a776c0f87fe4d73dce4"}, "originalPosition": 4}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNDQ0NDU3MA==", "bodyText": "same here, if jdk16+", "url": "https://github.com/eclipse-openj9/openj9/pull/11035#discussion_r514444570", "createdAt": "2020-10-29T17:36:44Z", "author": {"login": "tajila"}, "path": "runtime/vm/BytecodeAction.hpp", "diffHunk": "@@ -54,9 +54,7 @@ typedef enum {\n \tRUN_METHOD_INTERPRETED,\n \tRUN_JNI_NATIVE,\n \tRUN_METHOD_COMPILED,\n-#if defined(J9VM_OPT_VALHALLA_VALUE_TYPES)", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "5418baab5f05d628de054a776c0f87fe4d73dce4"}, "originalPosition": 4}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNDQ0NDc2Ng==", "bodyText": "here as well", "url": "https://github.com/eclipse-openj9/openj9/pull/11035#discussion_r514444766", "createdAt": "2020-10-29T17:37:02Z", "author": {"login": "tajila"}, "path": "runtime/vm/BytecodeInterpreter.hpp", "diffHunk": "@@ -1557,13 +1557,10 @@ class INTERPRETER_CLASS\n \t\t\t\t\t} else {\n \t\t\t\t\t\t((UDATA*)(((J9SFStackFrame*)_sp) + 1))[-1] |= J9SF_A0_INVISIBLE_TAG;\n \t\t\t\t\t}\n-#if defined(J9VM_OPT_VALHALLA_VALUE_TYPES)", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "5418baab5f05d628de054a776c0f87fe4d73dce4"}, "originalPosition": 4}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNDQ0NTE1OQ==", "bodyText": "and other places in this file too. Essentially we want JDK15 and earlier to remain unaffected", "url": "https://github.com/eclipse-openj9/openj9/pull/11035#discussion_r514445159", "createdAt": "2020-10-29T17:37:42Z", "author": {"login": "tajila"}, "path": "runtime/vm/BytecodeInterpreter.hpp", "diffHunk": "@@ -1557,13 +1557,10 @@ class INTERPRETER_CLASS\n \t\t\t\t\t} else {\n \t\t\t\t\t\t((UDATA*)(((J9SFStackFrame*)_sp) + 1))[-1] |= J9SF_A0_INVISIBLE_TAG;\n \t\t\t\t\t}\n-#if defined(J9VM_OPT_VALHALLA_VALUE_TYPES)", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNDQ0NDc2Ng=="}, "originalCommit": {"oid": "5418baab5f05d628de054a776c0f87fe4d73dce4"}, "originalPosition": 4}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNDQ0NTY0OA==", "bodyText": "needs ifdef jdk16+", "url": "https://github.com/eclipse-openj9/openj9/pull/11035#discussion_r514445648", "createdAt": "2020-10-29T17:38:24Z", "author": {"login": "tajila"}, "path": "runtime/vm/ObjectMonitor.cpp", "diffHunk": "@@ -309,14 +309,26 @@ objectMonitorEnterNonBlocking(J9VMThread *currentThread, j9object_t object)\n {\n \tUDATA result = (UDATA)object;\n \tj9objectmonitor_t volatile *lwEA = VM_ObjectMonitor::inlineGetLockAddress(currentThread, object);\n+\tJ9Class * objClass = J9OBJECT_CLAZZ(currentThread, object);\n \n #if defined(J9VM_OPT_VALHALLA_VALUE_TYPES)\n-\tJ9Class * objClass = J9OBJECT_CLAZZ(currentThread, object);\n \tif (J9_IS_J9CLASS_VALUETYPE(objClass)) {\n \t\tresult = J9_OBJECT_MONITOR_VALUE_TYPE_IMSE;\n \t\tgoto done;\n \t}\n #endif /* J9VM_OPT_VALHALLA_VALUE_TYPES */\t\n+\tif (J9_IS_J9CLASS_VALUEBASED(objClass)) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "5418baab5f05d628de054a776c0f87fe4d73dce4"}, "originalPosition": 13}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "5418baab5f05d628de054a776c0f87fe4d73dce4", "author": {"user": {"login": "hangshao0", "name": "Hang Shao"}}, "url": "https://github.com/eclipse-openj9/openj9/commit/5418baab5f05d628de054a776c0f87fe4d73dce4", "committedDate": "2020-10-29T16:04:07Z", "message": "JEP390 implementation\n\n1. Parse @ValueBased annotation and add flags for value based classes.\n2. Add CML -XX:ValueBasedClassCheck=warn. \nPrint out a warning message for monitorenter on a value based class.\n3. Add CML -XX:ValueBasedClassCheck=exception. Throw a\nVirtualMachineError for monitorenter on a value based class.\n4. Add VM helper areValueBasedMonitorChecksEnabled().\n\nissue #10620\n\nSigned-off-by: Hang Shao <hangshao@ca.ibm.com>"}, "afterCommit": {"oid": "9d011e5b0009030b43c847d407caf90d89af8abe", "author": {"user": {"login": "hangshao0", "name": "Hang Shao"}}, "url": "https://github.com/eclipse-openj9/openj9/commit/9d011e5b0009030b43c847d407caf90d89af8abe", "committedDate": "2020-10-29T19:20:26Z", "message": "JEP390 implementation\n\n1. Parse @ValueBased annotation and add flags for value based classes.\n2. Add CML -XX:ValueBasedClassCheck=warn. \nPrint out a warning message for monitorenter on a value based class.\n3. Add CML -XX:ValueBasedClassCheck=exception. Throw a\nVirtualMachineError for monitorenter on a value based class.\n4. Add VM helper areValueBasedMonitorChecksEnabled().\n\nissue #10620\n\nSigned-off-by: Hang Shao <hangshao@ca.ibm.com>"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "9d011e5b0009030b43c847d407caf90d89af8abe", "author": {"user": {"login": "hangshao0", "name": "Hang Shao"}}, "url": "https://github.com/eclipse-openj9/openj9/commit/9d011e5b0009030b43c847d407caf90d89af8abe", "committedDate": "2020-10-29T19:20:26Z", "message": "JEP390 implementation\n\n1. Parse @ValueBased annotation and add flags for value based classes.\n2. Add CML -XX:ValueBasedClassCheck=warn. \nPrint out a warning message for monitorenter on a value based class.\n3. Add CML -XX:ValueBasedClassCheck=exception. Throw a\nVirtualMachineError for monitorenter on a value based class.\n4. Add VM helper areValueBasedMonitorChecksEnabled().\n\nissue #10620\n\nSigned-off-by: Hang Shao <hangshao@ca.ibm.com>"}, "afterCommit": {"oid": "16a24642df9e3a2e53219e1861747f4c4e1f62a1", "author": {"user": {"login": "hangshao0", "name": "Hang Shao"}}, "url": "https://github.com/eclipse-openj9/openj9/commit/16a24642df9e3a2e53219e1861747f4c4e1f62a1", "committedDate": "2020-10-29T19:25:45Z", "message": "JEP390 implementation\n\n1. Parse @ValueBased annotation and add flags for value based classes.\n2. Add CML -XX:ValueBasedClassCheck=warn. \nPrint out a warning message for monitorenter on a value based class.\n3. Add CML -XX:ValueBasedClassCheck=exception. Throw a\nVirtualMachineError for monitorenter on a value based class.\n4. Add VM helper areValueBasedMonitorChecksEnabled().\n\nissue #10620\n\nSigned-off-by: Hang Shao <hangshao@ca.ibm.com>"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "16a24642df9e3a2e53219e1861747f4c4e1f62a1", "author": {"user": {"login": "hangshao0", "name": "Hang Shao"}}, "url": "https://github.com/eclipse-openj9/openj9/commit/16a24642df9e3a2e53219e1861747f4c4e1f62a1", "committedDate": "2020-10-29T19:25:45Z", "message": "JEP390 implementation\n\n1. Parse @ValueBased annotation and add flags for value based classes.\n2. Add CML -XX:ValueBasedClassCheck=warn. \nPrint out a warning message for monitorenter on a value based class.\n3. Add CML -XX:ValueBasedClassCheck=exception. Throw a\nVirtualMachineError for monitorenter on a value based class.\n4. Add VM helper areValueBasedMonitorChecksEnabled().\n\nissue #10620\n\nSigned-off-by: Hang Shao <hangshao@ca.ibm.com>"}, "afterCommit": {"oid": "583facbd6a9ffcde6935f44095903d67013da6ce", "author": {"user": {"login": "hangshao0", "name": "Hang Shao"}}, "url": "https://github.com/eclipse-openj9/openj9/commit/583facbd6a9ffcde6935f44095903d67013da6ce", "committedDate": "2020-10-29T19:54:11Z", "message": "JEP390 implementation\n\n1. Parse @ValueBased annotation and add flags for value based classes.\n2. Add CML -XX:ValueBasedClassCheck=warn. \nPrint out a warning message for monitorenter on a value based class.\n3. Add CML -XX:ValueBasedClassCheck=exception. Throw a\nVirtualMachineError for monitorenter on a value based class.\n4. Add VM helper areValueBasedMonitorChecksEnabled().\n\nissue #10620\n\nSigned-off-by: Hang Shao <hangshao@ca.ibm.com>"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTIyNTUzMTY2", "url": "https://github.com/eclipse-openj9/openj9/pull/11035#pullrequestreview-522553166", "createdAt": "2020-11-03T14:31:28Z", "commit": {"oid": "583facbd6a9ffcde6935f44095903d67013da6ce"}, "state": "COMMENTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wM1QxNDozMToyOFrOHsxaZA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wM1QxNDozMTo1NlrOHsxbtg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNjcwODk2NA==", "bodyText": "this should be a JDK 16 check as well", "url": "https://github.com/eclipse-openj9/openj9/pull/11035#discussion_r516708964", "createdAt": "2020-11-03T14:31:28Z", "author": {"login": "tajila"}, "path": "runtime/vm/jvminit.c", "diffHunk": "@@ -2358,6 +2364,12 @@ IDATA VMInitStages(J9JavaVM *vm, IDATA stage, void* reserved) {\n \t\t\t\t\tvm->extendedRuntimeFlags2 |= J9_EXTENDED_RUNTIME2_ENABLE_VT_ARRAY_FLATTENING;\n \t\t\t\t}\n \t\t\t}\n+#else /* defined(J9VM_OPT_VALHALLA_VALUE_TYPES) */", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "583facbd6a9ffcde6935f44095903d67013da6ce"}, "originalPosition": 17}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNjcwOTMwMg==", "bodyText": "you can define this in valuetypehelpers.cpp", "url": "https://github.com/eclipse-openj9/openj9/pull/11035#discussion_r516709302", "createdAt": "2020-11-03T14:31:56Z", "author": {"login": "tajila"}, "path": "runtime/vm/jvminit.c", "diffHunk": "@@ -602,6 +602,12 @@ areValueTypesEnabled(J9JavaVM *vm)\n \treturn J9_ARE_ALL_BITS_SET(vm->extendedRuntimeFlags2, J9_EXTENDED_RUNTIME2_ENABLE_VALHALLA);\n }\n \n+BOOLEAN\n+areValueBasedMonitorChecksEnabled(J9JavaVM *vm)", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "583facbd6a9ffcde6935f44095903d67013da6ce"}, "originalPosition": 5}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "583facbd6a9ffcde6935f44095903d67013da6ce", "author": {"user": {"login": "hangshao0", "name": "Hang Shao"}}, "url": "https://github.com/eclipse-openj9/openj9/commit/583facbd6a9ffcde6935f44095903d67013da6ce", "committedDate": "2020-10-29T19:54:11Z", "message": "JEP390 implementation\n\n1. Parse @ValueBased annotation and add flags for value based classes.\n2. Add CML -XX:ValueBasedClassCheck=warn. \nPrint out a warning message for monitorenter on a value based class.\n3. Add CML -XX:ValueBasedClassCheck=exception. Throw a\nVirtualMachineError for monitorenter on a value based class.\n4. Add VM helper areValueBasedMonitorChecksEnabled().\n\nissue #10620\n\nSigned-off-by: Hang Shao <hangshao@ca.ibm.com>"}, "afterCommit": {"oid": "1bfbf423dab778d5940ffb93c163756dacd22a27", "author": {"user": {"login": "hangshao0", "name": "Hang Shao"}}, "url": "https://github.com/eclipse-openj9/openj9/commit/1bfbf423dab778d5940ffb93c163756dacd22a27", "committedDate": "2020-11-03T16:23:00Z", "message": "JEP390 implementation\n\n1. Parse @ValueBased annotation and add flags for value based classes.\n2. Add CML -XX:ValueBasedClassCheck=warn. \nPrint out a warning message for monitorenter on a value based class.\n3. Add CML -XX:ValueBasedClassCheck=exception. Throw a\nVirtualMachineError for monitorenter on a value based class.\n4. Add VM helper areValueBasedMonitorChecksEnabled().\n\nissue #10620\n\nSigned-off-by: Hang Shao <hangshao@ca.ibm.com>"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "1bfbf423dab778d5940ffb93c163756dacd22a27", "author": {"user": {"login": "hangshao0", "name": "Hang Shao"}}, "url": "https://github.com/eclipse-openj9/openj9/commit/1bfbf423dab778d5940ffb93c163756dacd22a27", "committedDate": "2020-11-03T16:23:00Z", "message": "JEP390 implementation\n\n1. Parse @ValueBased annotation and add flags for value based classes.\n2. Add CML -XX:ValueBasedClassCheck=warn. \nPrint out a warning message for monitorenter on a value based class.\n3. Add CML -XX:ValueBasedClassCheck=exception. Throw a\nVirtualMachineError for monitorenter on a value based class.\n4. Add VM helper areValueBasedMonitorChecksEnabled().\n\nissue #10620\n\nSigned-off-by: Hang Shao <hangshao@ca.ibm.com>"}, "afterCommit": {"oid": "ac95aa0f2681a85cc74d2e547f04aeab63d61cf1", "author": {"user": {"login": "hangshao0", "name": "Hang Shao"}}, "url": "https://github.com/eclipse-openj9/openj9/commit/ac95aa0f2681a85cc74d2e547f04aeab63d61cf1", "committedDate": "2020-11-03T16:31:19Z", "message": "JEP390 implementation\n\n1. Parse @ValueBased annotation and add flags for value based classes.\n2. Add CML -XX:ValueBasedClassCheck=warn. \nPrint out a warning message for monitorenter on a value based class.\n3. Add CML -XX:ValueBasedClassCheck=exception. Throw a\nVirtualMachineError for monitorenter on a value based class.\n4. Add VM helper areValueBasedMonitorChecksEnabled().\n\nissue #10620\n\nSigned-off-by: Hang Shao <hangshao@ca.ibm.com>"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTIyODQxNjc1", "url": "https://github.com/eclipse-openj9/openj9/pull/11035#pullrequestreview-522841675", "createdAt": "2020-11-03T20:13:43Z", "commit": {"oid": "ac95aa0f2681a85cc74d2e547f04aeab63d61cf1"}, "state": "APPROVED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wM1QyMDoxMzo0M1rOHs-40A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wM1QyMDoxMzo0M1rOHs-40A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNjkyOTc0NA==", "bodyText": "nitpick \"allows\"", "url": "https://github.com/eclipse-openj9/openj9/pull/11035#discussion_r516929744", "createdAt": "2020-11-03T20:13:43Z", "author": {"login": "tajila"}, "path": "runtime/oti/j9.h", "diffHunk": "@@ -309,6 +309,9 @@ static const struct { \\\n \t((NULL != (interfaceClass)) && ((J9_ITABLE_INDEX_UNRESOLVED != ((methodIndexAndArgCount) & ~255))))\n \n /* Macros for ValueTypes */\n+#define J9_CLASS_DISALLOWS_LOCKING_FLAGS (J9ClassIsValueType | J9ClassIsValueBased)\n+#define J9_CLASS_ALLOW_LOCKING(clazz) J9_ARE_NO_BITS_SET((clazz)->classFlags, J9_CLASS_DISALLOWS_LOCKING_FLAGS)", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ac95aa0f2681a85cc74d2e547f04aeab63d61cf1"}, "originalPosition": 5}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "ac95aa0f2681a85cc74d2e547f04aeab63d61cf1", "author": {"user": {"login": "hangshao0", "name": "Hang Shao"}}, "url": "https://github.com/eclipse-openj9/openj9/commit/ac95aa0f2681a85cc74d2e547f04aeab63d61cf1", "committedDate": "2020-11-03T16:31:19Z", "message": "JEP390 implementation\n\n1. Parse @ValueBased annotation and add flags for value based classes.\n2. Add CML -XX:ValueBasedClassCheck=warn. \nPrint out a warning message for monitorenter on a value based class.\n3. Add CML -XX:ValueBasedClassCheck=exception. Throw a\nVirtualMachineError for monitorenter on a value based class.\n4. Add VM helper areValueBasedMonitorChecksEnabled().\n\nissue #10620\n\nSigned-off-by: Hang Shao <hangshao@ca.ibm.com>"}, "afterCommit": {"oid": "f76621e72fd4794f7d3017ac7107794041974e82", "author": {"user": {"login": "hangshao0", "name": "Hang Shao"}}, "url": "https://github.com/eclipse-openj9/openj9/commit/f76621e72fd4794f7d3017ac7107794041974e82", "committedDate": "2020-11-03T21:46:01Z", "message": "JEP390 implementation\n\n1. Parse @ValueBased annotation and add flags for value based classes.\n2. Add CML -XX:ValueBasedClassCheck=warn. \nPrint out a warning message for monitorenter on a value based class.\n3. Add CML -XX:ValueBasedClassCheck=exception. Throw a\nVirtualMachineError for monitorenter on a value based class.\n4. Add VM helper areValueBasedMonitorChecksEnabled().\n\nissue #10620\n\nSigned-off-by: Hang Shao <hangshao@ca.ibm.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "227754b1ea439b4e3d23cd7fcbcb94c0f8a1d952", "author": {"user": {"login": "hangshao0", "name": "Hang Shao"}}, "url": "https://github.com/eclipse-openj9/openj9/commit/227754b1ea439b4e3d23cd7fcbcb94c0f8a1d952", "committedDate": "2020-11-27T23:15:29Z", "message": "JEP390 implementation\n\n1. Parse @ValueBased annotation and add flags for value based classes.\n2. Add CML -XX:ValueBasedClassCheck=warn. \nPrint out a warning message for monitorenter on a value based class.\n3. Add CML -XX:ValueBasedClassCheck=exception. Throw a\nVirtualMachineError for monitorenter on a value based class.\n4. Add VM helper areValueBasedMonitorChecksEnabled().\n\nissue #10620\n\nSigned-off-by: Hang Shao <hangshao@ca.ibm.com>"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "f76621e72fd4794f7d3017ac7107794041974e82", "author": {"user": {"login": "hangshao0", "name": "Hang Shao"}}, "url": "https://github.com/eclipse-openj9/openj9/commit/f76621e72fd4794f7d3017ac7107794041974e82", "committedDate": "2020-11-03T21:46:01Z", "message": "JEP390 implementation\n\n1. Parse @ValueBased annotation and add flags for value based classes.\n2. Add CML -XX:ValueBasedClassCheck=warn. \nPrint out a warning message for monitorenter on a value based class.\n3. Add CML -XX:ValueBasedClassCheck=exception. Throw a\nVirtualMachineError for monitorenter on a value based class.\n4. Add VM helper areValueBasedMonitorChecksEnabled().\n\nissue #10620\n\nSigned-off-by: Hang Shao <hangshao@ca.ibm.com>"}, "afterCommit": {"oid": "227754b1ea439b4e3d23cd7fcbcb94c0f8a1d952", "author": {"user": {"login": "hangshao0", "name": "Hang Shao"}}, "url": "https://github.com/eclipse-openj9/openj9/commit/227754b1ea439b4e3d23cd7fcbcb94c0f8a1d952", "committedDate": "2020-11-27T23:15:29Z", "message": "JEP390 implementation\n\n1. Parse @ValueBased annotation and add flags for value based classes.\n2. Add CML -XX:ValueBasedClassCheck=warn. \nPrint out a warning message for monitorenter on a value based class.\n3. Add CML -XX:ValueBasedClassCheck=exception. Throw a\nVirtualMachineError for monitorenter on a value based class.\n4. Add VM helper areValueBasedMonitorChecksEnabled().\n\nissue #10620\n\nSigned-off-by: Hang Shao <hangshao@ca.ibm.com>"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 35, "cost": 1, "resetAt": "2021-10-28T18:00:02Z"}}}