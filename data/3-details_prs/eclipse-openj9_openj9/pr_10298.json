{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDU5MjgxNjI5", "number": 10298, "title": "Consolidate AOT Relocation Records", "bodyText": "#4803", "createdAt": "2020-07-30T15:07:13Z", "url": "https://github.com/eclipse-openj9/openj9/pull/10298", "merged": true, "mergeCommit": {"oid": "cb5ba8287d06903efe23cf6e37573dbb062a8e31"}, "closed": true, "closedAt": "2020-08-18T14:48:48Z", "author": {"login": "dsouzai"}, "timelineItems": {"totalCount": 13, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABc5cH7ZAH2gAyNDU5MjgxNjI5OjU1MTlmOWIxMjJmZDFmMjU3YzViNDE3NjljYWE1OWEzMTI5MDE0NWE=", "endCursor": "Y3Vyc29yOnYyOpPPAAABc_8alRgFqTQ2ODkyNTg1Mg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "5519f9b122fd1f257c5b41769caa59a31290145a", "author": {"user": {"login": "dsouzai", "name": "Irwin D'Souza"}}, "url": "https://github.com/eclipse-openj9/openj9/commit/5519f9b122fd1f257c5b41769caa59a31290145a", "committedDate": "2020-07-28T20:05:46Z", "message": "Consolidate TR_ValidateClassByName\n\nRemove the duplicated code that writes the TR_ValidateClassByName\nrelocation header information,and consolidate it in one canonical\nlocation.\n\nSigned-off-by: Irwin D'Souza <dsouzai.gh@gmail.com>"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDY4NjA1NDM0", "url": "https://github.com/eclipse-openj9/openj9/pull/10298#pullrequestreview-468605434", "createdAt": "2020-08-17T16:14:38Z", "commit": {"oid": "4971085e43b142335d3a88c5667d9c157b6ed05f"}, "state": "COMMENTED", "comments": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xN1QxNjoxNDozOFrOHBvd6g==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xN1QxNjoxODo1NVrOHBvncQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MTU4ODMzMA==", "bodyText": "should this be setIsStatic ?", "url": "https://github.com/eclipse-openj9/openj9/pull/10298#discussion_r471588330", "createdAt": "2020-08-17T16:14:38Z", "author": {"login": "mstoodle"}, "path": "runtime/compiler/codegen/J9AheadOfTimeCompile.cpp", "diffHunk": "@@ -611,6 +611,19 @@ J9::AheadOfTimeCompile::initializeCommonAOTRelocationHeader(TR::IteratedExternal\n          }\n          break;\n \n+      case TR_ValidateDefiningClassFromCP:\n+         {\n+         TR_RelocationRecordValidateDefiningClassFromCP *dcpRecord = reinterpret_cast<TR_RelocationRecordValidateDefiningClassFromCP *>(reloRecord);\n+\n+         TR::DefiningClassFromCPRecord *svmRecord = reinterpret_cast<TR::DefiningClassFromCPRecord *>(relocation->getTargetAddress());\n+\n+         dcpRecord->setiSStatic(reloTarget, svmRecord->_isStatic);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "4971085e43b142335d3a88c5667d9c157b6ed05f"}, "originalPosition": 10}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MTU4ODc2Ng==", "bodyText": "similarly here setIsStatic ?", "url": "https://github.com/eclipse-openj9/openj9/pull/10298#discussion_r471588766", "createdAt": "2020-08-17T16:15:21Z", "author": {"login": "mstoodle"}, "path": "runtime/compiler/runtime/RelocationRecord.cpp", "diffHunk": "@@ -3520,26 +3520,77 @@ TR_RelocationRecordValidateClassFromCP::cpIndex(TR_RelocationTarget *reloTarget)\n int32_t\n TR_RelocationRecordValidateDefiningClassFromCP::applyRelocation(TR_RelocationRuntime *reloRuntime, TR_RelocationTarget *reloTarget, uint8_t *reloLocation)\n    {\n-   uint16_t classID = reloTarget->loadUnsigned16b((uint8_t *) &((TR_RelocationRecordValidateDefiningClassFromCPBinaryTemplate *)_record)->_classID);\n-   uint16_t beholderID = reloTarget->loadUnsigned16b((uint8_t *) &((TR_RelocationRecordValidateDefiningClassFromCPBinaryTemplate *)_record)->_beholderID);\n-   uint32_t cpIndex = reloTarget->loadUnsigned32b((uint8_t *) &((TR_RelocationRecordValidateDefiningClassFromCPBinaryTemplate *)_record)->_cpIndex);\n-   bool isStatic = (bool)reloTarget->loadUnsigned8b((uint8_t *) &((TR_RelocationRecordValidateDefiningClassFromCPBinaryTemplate *)_record)->_isStatic);\n-\n-   if (reloRuntime->reloLogger()->logEnabled())\n-      {\n-      reloRuntime->reloLogger()->printf(\"%s\\n\", name());\n-      reloRuntime->reloLogger()->printf(\"\\tapplyRelocation: classID %d\\n\", classID);\n-      reloRuntime->reloLogger()->printf(\"\\tapplyRelocation: beholderID %d\\n\", beholderID);\n-      reloRuntime->reloLogger()->printf(\"\\tapplyRelocation: cpIndex %d\\n\", cpIndex);\n-      reloRuntime->reloLogger()->printf(\"\\tapplyRelocation: isStatic %s\\n\", isStatic ? \"true\" : \"false\");\n-      }\n+   uint16_t classID = this->classID(reloTarget);\n+   uint16_t beholderID = this->beholderID(reloTarget);\n+   uint32_t cpIndex = this->cpIndex(reloTarget);\n+   bool isStatic = this->isStatic(reloTarget);\n \n    if (reloRuntime->comp()->getSymbolValidationManager()->validateDefiningClassFromCPRecord(classID, beholderID, cpIndex, isStatic))\n       return 0;\n    else\n       return compilationAotClassReloFailure;\n    }\n \n+void\n+TR_RelocationRecordValidateDefiningClassFromCP::print(TR_RelocationRuntime *reloRuntime)\n+   {\n+   TR_RelocationTarget *reloTarget = reloRuntime->reloTarget();\n+   TR_RelocationRuntimeLogger *reloLogger = reloRuntime->reloLogger();\n+   TR_RelocationRecord::print(reloRuntime);\n+   reloLogger->printf(\"\\tisStatic %s\\n\", isStatic(reloTarget) ? \"true\" : \"false\");\n+   reloLogger->printf(\"\\tclassID %d\\n\", classID(reloTarget));\n+   reloLogger->printf(\"\\tbeholderID %d\\n\", beholderID(reloTarget));\n+   reloLogger->printf(\"\\tcpindex %d\\n\", cpIndex(reloTarget));\n+   }\n+\n+void\n+TR_RelocationRecordValidateDefiningClassFromCP::setiSStatic(TR_RelocationTarget *reloTarget, bool isStatic)", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "4971085e43b142335d3a88c5667d9c157b6ed05f"}, "originalPosition": 41}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MTU4ODk4Mw==", "bodyText": "last one :) . setIsStatic()", "url": "https://github.com/eclipse-openj9/openj9/pull/10298#discussion_r471588983", "createdAt": "2020-08-17T16:15:45Z", "author": {"login": "mstoodle"}, "path": "runtime/compiler/runtime/RelocationRecord.hpp", "diffHunk": "@@ -1491,6 +1491,20 @@ class TR_RelocationRecordValidateDefiningClassFromCP : public TR_RelocationRecor\n       virtual int32_t bytesInHeaderAndPayload() { return sizeof(TR_RelocationRecordValidateDefiningClassFromCPBinaryTemplate); }\n       virtual void preparePrivateData(TR_RelocationRuntime *reloRuntime, TR_RelocationTarget *reloTarget) {}\n       virtual int32_t applyRelocation(TR_RelocationRuntime *reloRuntime, TR_RelocationTarget *reloTarget, uint8_t *reloLocation);\n+\n+      virtual void print(TR_RelocationRuntime *reloRuntime);\n+\n+      void setiSStatic(TR_RelocationTarget *reloTarget, bool isStatic);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "4971085e43b142335d3a88c5667d9c157b6ed05f"}, "originalPosition": 16}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MTU5MDc2OQ==", "bodyText": "Given the number of places these two are called, I would probably have just spelled out ClassLoader so others don't have to think about what \"CL\" should stand for.", "url": "https://github.com/eclipse-openj9/openj9/pull/10298#discussion_r471590769", "createdAt": "2020-08-17T16:18:55Z", "author": {"login": "mstoodle"}, "path": "runtime/compiler/runtime/RelocationRecord.hpp", "diffHunk": "@@ -1445,6 +1445,17 @@ class TR_RelocationRecordValidateProfiledClass : public TR_RelocationRecord\n       virtual int32_t bytesInHeaderAndPayload() { return sizeof(TR_RelocationRecordValidateProfiledClassBinaryTemplate); }\n       virtual void preparePrivateData(TR_RelocationRuntime *reloRuntime, TR_RelocationTarget *reloTarget) {}\n       virtual int32_t applyRelocation(TR_RelocationRuntime *reloRuntime, TR_RelocationTarget *reloTarget, uint8_t *reloLocation);\n+\n+      virtual void print(TR_RelocationRuntime *reloRuntime);\n+\n+      void setClassID(TR_RelocationTarget *reloTarget, uint16_t classID);\n+      uint16_t classID(TR_RelocationTarget *reloTarget);\n+\n+      void setClassChainOffset(TR_RelocationTarget *reloTarget, uintptr_t classChainOffset);\n+      uintptr_t classChainOffset(TR_RelocationTarget *reloTarget);\n+\n+      void setClassChainOffsetForCL(TR_RelocationTarget *reloTarget, uintptr_t classChainOffsetForCL);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "e2b04448449ebc25b953e3b57e60a002d86c67b1"}, "originalPosition": 13}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDY4NjEwNTQx", "url": "https://github.com/eclipse-openj9/openj9/pull/10298#pullrequestreview-468610541", "createdAt": "2020-08-17T16:21:11Z", "commit": {"oid": "282f74e3769c6464653015ccae0efea3d4e9485f"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "4fef70154a406826c772815ecf8e1433c45a4239", "author": {"user": {"login": "dsouzai", "name": "Irwin D'Souza"}}, "url": "https://github.com/eclipse-openj9/openj9/commit/4fef70154a406826c772815ecf8e1433c45a4239", "committedDate": "2020-08-17T19:56:01Z", "message": "Consolidate TR_ValidateProfiledClass\n\nRemove the duplicated code that writes the TR_ValidateProfiledClass\nrelocation header information,and consolidate it in one canonical\nlocation.\n\nSigned-off-by: Irwin D'Souza <dsouzai.gh@gmail.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e87a128a07a2f9862a96379adf8c10c9d34b6f88", "author": {"user": {"login": "dsouzai", "name": "Irwin D'Souza"}}, "url": "https://github.com/eclipse-openj9/openj9/commit/e87a128a07a2f9862a96379adf8c10c9d34b6f88", "committedDate": "2020-08-17T19:56:02Z", "message": "Consolidate TR_ValidateClassFromCP\n\nRemove the duplicated code that writes the TR_ValidateClassFromCP\nrelocation header information,and consolidate it in one canonical\nlocation.\n\nSigned-off-by: Irwin D'Souza <dsouzai.gh@gmail.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "0cfc524a38c1858d5331f464c7dc4f766623ce75", "author": {"user": {"login": "dsouzai", "name": "Irwin D'Souza"}}, "url": "https://github.com/eclipse-openj9/openj9/commit/0cfc524a38c1858d5331f464c7dc4f766623ce75", "committedDate": "2020-08-17T19:56:02Z", "message": "Consolidate TR_ValidateDefiningClassFromCP\n\nRemove the duplicated code that writes the\nTR_ValidateDefiningClassFromCP relocation header information,\nand consolidate it in one canonical location.\n\nSigned-off-by: Irwin D'Souza <dsouzai.gh@gmail.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "10a0d9da2b8910f8be1e86aed05ae3bad0d7211c", "author": {"user": {"login": "dsouzai", "name": "Irwin D'Souza"}}, "url": "https://github.com/eclipse-openj9/openj9/commit/10a0d9da2b8910f8be1e86aed05ae3bad0d7211c", "committedDate": "2020-08-17T19:56:02Z", "message": "Consolidate TR_ValidateStaticClassFromCP\n\nRemove the duplicated code that writes the\nTR_ValidateStaticClassFromCP relocation header information,\nand consolidate it in one canonical location.\n\nSigned-off-by: Irwin D'Souza <dsouzai.gh@gmail.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c4aa527ac74b9d6a61a9d7dbdd82e7b69eeadd94", "author": {"user": {"login": "dsouzai", "name": "Irwin D'Souza"}}, "url": "https://github.com/eclipse-openj9/openj9/commit/c4aa527ac74b9d6a61a9d7dbdd82e7b69eeadd94", "committedDate": "2020-08-17T19:56:02Z", "message": "Consolidate TR_ValidateArrayClassFromComponentClass\n\nRemove the duplicated code that writes the\nTR_ValidateArrayClassFromComponentClass relocation header\ninformation, and consolidate it in one canonical location.\n\nSigned-off-by: Irwin D'Souza <dsouzai.gh@gmail.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "23260bfdd8c57d632a6eb7b748946d7575160556", "author": {"user": {"login": "dsouzai", "name": "Irwin D'Souza"}}, "url": "https://github.com/eclipse-openj9/openj9/commit/23260bfdd8c57d632a6eb7b748946d7575160556", "committedDate": "2020-08-17T19:56:02Z", "message": "Consolidate TR_ValidateSuperClassFromClass\n\nRemove the duplicated code that writes the\nTR_ValidateSuperClassFromClass relocation header\ninformation, and consolidate it in one canonical location.\n\nSigned-off-by: Irwin D'Souza <dsouzai.gh@gmail.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "d24f37f6735870c6592b941927d753264acfaa10", "author": {"user": {"login": "dsouzai", "name": "Irwin D'Souza"}}, "url": "https://github.com/eclipse-openj9/openj9/commit/d24f37f6735870c6592b941927d753264acfaa10", "committedDate": "2020-08-17T19:56:02Z", "message": "Consolidate TR_ValidateClassInstanceOfClass\n\nRemove the duplicated code that writes the\nTR_ValidateClassInstanceOfClass relocation header\ninformation, and consolidate it in one canonical location.\n\nSigned-off-by: Irwin D'Souza <dsouzai.gh@gmail.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "fa20af01d0f54a6d470ed5f2346c49b65adce61a", "author": {"user": {"login": "dsouzai", "name": "Irwin D'Souza"}}, "url": "https://github.com/eclipse-openj9/openj9/commit/fa20af01d0f54a6d470ed5f2346c49b65adce61a", "committedDate": "2020-08-17T19:56:02Z", "message": "Consolidate TR_ValidateSystemClassByName\n\nRemove the duplicated code that writes the\nTR_ValidateSystemClassByName relocation header\ninformation, and consolidate it in one canonical location.\n\nSigned-off-by: Irwin D'Souza <dsouzai.gh@gmail.com>"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "282f74e3769c6464653015ccae0efea3d4e9485f", "author": {"user": {"login": "dsouzai", "name": "Irwin D'Souza"}}, "url": "https://github.com/eclipse-openj9/openj9/commit/282f74e3769c6464653015ccae0efea3d4e9485f", "committedDate": "2020-07-29T21:25:50Z", "message": "Consolidate TR_ValidateSystemClassByName\n\nRemove the duplicated code that writes the\nTR_ValidateSystemClassByName relocation header\ninformation, and consolidate it in one canonical location.\n\nSigned-off-by: Irwin D'Souza <dsouzai.gh@gmail.com>"}, "afterCommit": {"oid": "fa20af01d0f54a6d470ed5f2346c49b65adce61a", "author": {"user": {"login": "dsouzai", "name": "Irwin D'Souza"}}, "url": "https://github.com/eclipse-openj9/openj9/commit/fa20af01d0f54a6d470ed5f2346c49b65adce61a", "committedDate": "2020-08-17T19:56:02Z", "message": "Consolidate TR_ValidateSystemClassByName\n\nRemove the duplicated code that writes the\nTR_ValidateSystemClassByName relocation header\ninformation, and consolidate it in one canonical location.\n\nSigned-off-by: Irwin D'Souza <dsouzai.gh@gmail.com>"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDY4OTI1ODUy", "url": "https://github.com/eclipse-openj9/openj9/pull/10298#pullrequestreview-468925852", "createdAt": "2020-08-18T01:06:39Z", "commit": {"oid": "fa20af01d0f54a6d470ed5f2346c49b65adce61a"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 415, "cost": 1, "resetAt": "2021-10-28T17:48:14Z"}}}