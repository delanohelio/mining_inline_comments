{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0Mzg0MDUxNDc0", "number": 8755, "reviewThreads": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wNVQwNjoyODowMFrODlTbzQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wNlQwMzoxMDozMlrODlqstw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjQwNDQyMzE3OnYy", "diffSide": "RIGHT", "path": "runtime/bcutil/defineclass.c", "isResolved": false, "comments": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wNVQwNjoyODowMFrOFyHszg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wNVQxOTo1NzoxOVrOFyh8ng==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4ODA5OTI3OA==", "bodyText": "Can you modify this to check result once around the outside of this if and the next?\nSomething like:\nif (BCT_ERR_NO_ERROR == result) {\n    if ((J2SE_VERSION(vm) >= J2SE_V11)...... {\n    .....\n    if (J9_ARE_ANY_BITS_SET(vm->extendedRuntimeFlags, J9_EXTENDED_RUNTIME_RECREATE_CLASSFILE_ONLOAD)) {\n    }   \n}\nas the J9_EXTENDED_RUNTIME_RECREATE_CLASSFILE_ONLOAD immediately checks for BCT_ERR_NO_ERROR as well", "url": "https://github.com/eclipse-openj9/openj9/pull/8755#discussion_r388099278", "createdAt": "2020-03-05T06:28:00Z", "author": {"login": "DanHeidinga"}, "path": "runtime/bcutil/defineclass.c", "diffHunk": "@@ -764,6 +764,7 @@ callDynamicLoader(J9VMThread *vmThread, J9LoadROMClassData *loadData, U_8 * inte\n \t/* The module of a class transformed by a JVMTI agent needs access to unnamed modules */", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "528a64877b04de797577ce17d13d940706a446ad"}, "originalPosition": 8}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4ODQxNDY0OA==", "bodyText": "@DanHeidinga Updated. I expect the (NULL != loadData->romClass) is redundant and can be removed as well, what do you think?\nI was trying to get a JVM created for the user to try. There may be more than one problem, we'll see what happens on a re-run with this change. The machines were busy with nightly testing and I missed the user's timezone window last night.", "url": "https://github.com/eclipse-openj9/openj9/pull/8755#discussion_r388414648", "createdAt": "2020-03-05T16:36:20Z", "author": {"login": "pshipton"}, "path": "runtime/bcutil/defineclass.c", "diffHunk": "@@ -764,6 +764,7 @@ callDynamicLoader(J9VMThread *vmThread, J9LoadROMClassData *loadData, U_8 * inte\n \t/* The module of a class transformed by a JVMTI agent needs access to unnamed modules */", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4ODA5OTI3OA=="}, "originalCommit": {"oid": "528a64877b04de797577ce17d13d940706a446ad"}, "originalPosition": 8}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4ODQyNjczNw==", "bodyText": "I think you're right.  I wonder if we added the null check to satisfy one of the static analysis tools we've run", "url": "https://github.com/eclipse-openj9/openj9/pull/8755#discussion_r388426737", "createdAt": "2020-03-05T16:54:40Z", "author": {"login": "DanHeidinga"}, "path": "runtime/bcutil/defineclass.c", "diffHunk": "@@ -764,6 +764,7 @@ callDynamicLoader(J9VMThread *vmThread, J9LoadROMClassData *loadData, U_8 * inte\n \t/* The module of a class transformed by a JVMTI agent needs access to unnamed modules */", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4ODA5OTI3OA=="}, "originalCommit": {"oid": "528a64877b04de797577ce17d13d940706a446ad"}, "originalPosition": 8}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4ODUyOTMxMA==", "bodyText": "I figured we needed the null check in the absence of checking the result code.", "url": "https://github.com/eclipse-openj9/openj9/pull/8755#discussion_r388529310", "createdAt": "2020-03-05T19:57:19Z", "author": {"login": "pshipton"}, "path": "runtime/bcutil/defineclass.c", "diffHunk": "@@ -764,6 +764,7 @@ callDynamicLoader(J9VMThread *vmThread, J9LoadROMClassData *loadData, U_8 * inte\n \t/* The module of a class transformed by a JVMTI agent needs access to unnamed modules */", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4ODA5OTI3OA=="}, "originalCommit": {"oid": "528a64877b04de797577ce17d13d940706a446ad"}, "originalPosition": 8}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjQwODIzNDc5OnYy", "diffSide": "RIGHT", "path": "runtime/bcutil/defineclass.c", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wNlQwMzoxMDozMlrOFyr7gA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wNlQyMDowMjo0M1rOFzFzuQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4ODY5Mjg2NA==", "bodyText": "Minor nitpick - this line of the if statement is indented to far.  It should be a single tab (or preferably in my view none!).\n\n  \n    \n  \n    \n\n  \n  This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters. Learn more about bidirectional Unicode characters\n\n\n  \n\n\n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            \t\t\t\t&& (classFileBytesReplacedByRIA || classFileBytesReplacedByRCA)\n          \n          \n            \n            \t\t&& (classFileBytesReplacedByRIA || classFileBytesReplacedByRCA)", "url": "https://github.com/eclipse-openj9/openj9/pull/8755#discussion_r388692864", "createdAt": "2020-03-06T03:10:32Z", "author": {"login": "DanHeidinga"}, "path": "runtime/bcutil/defineclass.c", "diffHunk": "@@ -761,20 +761,19 @@ callDynamicLoader(J9VMThread *vmThread, J9LoadROMClassData *loadData, U_8 * inte\n \t\t\tFALSE, /* isIntermediateROMClass */\n \t\t\tlocalBuffer);\n \n-\t/* The module of a class transformed by a JVMTI agent needs access to unnamed modules */\n-\tif ((J2SE_VERSION(vm) >= J2SE_V11)\n-\t\t&& (classFileBytesReplacedByRIA || classFileBytesReplacedByRCA)\n-\t\t&& (NULL != loadData->romClass)\n-\t) {\n-\t\tJ9Module *module = J9_VM_FUNCTION(vmThread, findModuleForPackage)(vmThread, loadData->classLoader,\n-\t\t\t\tloadData->className, (U_32) packageNameLength(loadData->romClass));\n-\t\tif (NULL != module) {\n-\t\t\tmodule->isLoose = TRUE;\n+\tif (BCT_ERR_NO_ERROR == result) {\n+\t\t/* The module of a class transformed by a JVMTI agent needs access to unnamed modules */\n+\t\tif ((J2SE_VERSION(vm) >= J2SE_V11)\n+\t\t\t\t&& (classFileBytesReplacedByRIA || classFileBytesReplacedByRCA)", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "7643ad750f4b7fb2ff9b4eaa06d70bb9e78c4737"}, "originalPosition": 23}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4OTExNjg1Nw==", "bodyText": "Seems Eclipses likes to indent by 2 tabs. I've removed one.", "url": "https://github.com/eclipse-openj9/openj9/pull/8755#discussion_r389116857", "createdAt": "2020-03-06T20:02:43Z", "author": {"login": "pshipton"}, "path": "runtime/bcutil/defineclass.c", "diffHunk": "@@ -761,20 +761,19 @@ callDynamicLoader(J9VMThread *vmThread, J9LoadROMClassData *loadData, U_8 * inte\n \t\t\tFALSE, /* isIntermediateROMClass */\n \t\t\tlocalBuffer);\n \n-\t/* The module of a class transformed by a JVMTI agent needs access to unnamed modules */\n-\tif ((J2SE_VERSION(vm) >= J2SE_V11)\n-\t\t&& (classFileBytesReplacedByRIA || classFileBytesReplacedByRCA)\n-\t\t&& (NULL != loadData->romClass)\n-\t) {\n-\t\tJ9Module *module = J9_VM_FUNCTION(vmThread, findModuleForPackage)(vmThread, loadData->classLoader,\n-\t\t\t\tloadData->className, (U_32) packageNameLength(loadData->romClass));\n-\t\tif (NULL != module) {\n-\t\t\tmodule->isLoose = TRUE;\n+\tif (BCT_ERR_NO_ERROR == result) {\n+\t\t/* The module of a class transformed by a JVMTI agent needs access to unnamed modules */\n+\t\tif ((J2SE_VERSION(vm) >= J2SE_V11)\n+\t\t\t\t&& (classFileBytesReplacedByRIA || classFileBytesReplacedByRCA)", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4ODY5Mjg2NA=="}, "originalCommit": {"oid": "7643ad750f4b7fb2ff9b4eaa06d70bb9e78c4737"}, "originalPosition": 23}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 655, "cost": 1, "resetAt": "2021-11-12T13:16:51Z"}}}