{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDMzODA5NTIw", "number": 9865, "title": "Support JEP383 (Part 2) and CDS natives", "bodyText": "Refer to the individual commits for more details.\nCDS: Class Data Sharing.\nFixes #9849, and unreported JDK15 compilation issues.\nThe following are implemented since they are invoked during the build process:\n\nJVM_IsCDSDumpingEnabled\nJVM_IsCDSSharingEnabled\nLookup.ensureInitialized\nMethodHandle.viewAsType\n\nThe remaining dependencies are introduced as stubs.\nRelated: #9625\nSigned-off-by: Babneet Singh sbabneet@ca.ibm.com", "createdAt": "2020-06-12T17:43:56Z", "url": "https://github.com/eclipse-openj9/openj9/pull/9865", "merged": true, "mergeCommit": {"oid": "67d95007db2f90637d05a2b2ce4386f9271f4873"}, "closed": true, "closedAt": "2020-06-24T02:54:07Z", "author": {"login": "babsingh"}, "timelineItems": {"totalCount": 9, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcqmj3SABqjM0MzkzODUxOTc=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcuQ-UggFqTQzNjI4OTY3OA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "c075faae80ecd6f99595348b30bb2e7cdca86171", "author": {"user": {"login": "babsingh", "name": "Babneet Singh"}}, "url": "https://github.com/eclipse-openj9/openj9/commit/c075faae80ecd6f99595348b30bb2e7cdca86171", "committedDate": "2020-06-12T16:05:06Z", "message": "Implement method ensureInitialized in class Lookup to support Java 15\n\nSigned-off-by: Babneet Singh <sbabneet@ca.ibm.com>"}, "afterCommit": {"oid": "c6ff813463f624c59a2e9a9d750b75f0a3f0d3ed", "author": {"user": {"login": "babsingh", "name": "Babneet Singh"}}, "url": "https://github.com/eclipse-openj9/openj9/commit/c6ff813463f624c59a2e9a9d750b75f0a3f0d3ed", "committedDate": "2020-06-12T17:22:57Z", "message": "Implement method ensureInitialized in class Lookup to support Java 15\n\nSigned-off-by: Babneet Singh <sbabneet@ca.ibm.com>"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDM0MjY0MjU5", "url": "https://github.com/eclipse-openj9/openj9/pull/9865#pullrequestreview-434264259", "createdAt": "2020-06-19T18:16:38Z", "commit": {"oid": "c6ff813463f624c59a2e9a9d750b75f0a3f0d3ed"}, "state": "COMMENTED", "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xOVQxODoxNjozOVrOGmdj3A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xOVQxODoyMTo1MFrOGmdsDQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0Mjk4MzM4OA==", "bodyText": "Pls add a blank line.", "url": "https://github.com/eclipse-openj9/openj9/pull/9865#discussion_r442983388", "createdAt": "2020-06-19T18:16:39Z", "author": {"login": "pshipton"}, "path": "jcl/src/java.base/share/classes/java/lang/invoke/InfoFromMemberName.java", "diffHunk": "@@ -21,3 +21,46 @@\n  *\n  * SPDX-License-Identifier: EPL-2.0 OR Apache-2.0 OR GPL-2.0 WITH Classpath-exception-2.0 OR LicenseRef-GPL-2.0 WITH Assembly-exception\n  *******************************************************************************/\n+/*[IF Java15]*/\n+package java.lang.invoke;\n+\n+import java.lang.invoke.MethodHandles.Lookup;\n+import java.lang.reflect.Member;\n+\n+class InfoFromMemberName implements MethodHandleInfo {\n+\tInfoFromMemberName(Lookup lookup, MemberName member, byte kind) {\n+\t\tthrow OpenJDKCompileStub.OpenJDKCompileStubThrowError();\n+\t}\n+\n+\t@Override\n+\tpublic Class<?> getDeclaringClass() {\n+\t\tthrow OpenJDKCompileStub.OpenJDKCompileStubThrowError();\n+\t}\n+\n+\t@Override\n+\tpublic String getName() {\n+\t\tthrow OpenJDKCompileStub.OpenJDKCompileStubThrowError();\n+\t}\n+\n+\t@Override\n+\tpublic MethodType getMethodType() {\n+\t\tthrow OpenJDKCompileStub.OpenJDKCompileStubThrowError();\n+\n+\t}\n+\n+\t@Override\n+\tpublic int getModifiers() {\n+\t\tthrow OpenJDKCompileStub.OpenJDKCompileStubThrowError();\n+\t}\n+\n+\t@Override\n+\tpublic int getReferenceKind() {\n+\t\tthrow OpenJDKCompileStub.OpenJDKCompileStubThrowError();\n+\t}\n+\n+\t@Override\n+\tpublic <T extends Member> T reflectAs(Class<T> expected, Lookup lookup) {\n+\t\tthrow OpenJDKCompileStub.OpenJDKCompileStubThrowError();\n+\t}\n+}\n+/* [ENDIF] Java15 */", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c6ff813463f624c59a2e9a9d750b75f0a3f0d3ed"}, "originalPosition": 55}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0Mjk4MzczNQ==", "bodyText": "Java 10 is no longer supported, these could all be inside [IF Java 11]", "url": "https://github.com/eclipse-openj9/openj9/pull/9865#discussion_r442983735", "createdAt": "2020-06-19T18:17:32Z", "author": {"login": "pshipton"}, "path": "jcl/src/java.base/share/classes/java/lang/invoke/MemberName.java", "diffHunk": "@@ -97,6 +97,8 @@ String getMethodDescriptor() {\n \tpublic Class<?> getDeclaringClass() {\n \t\tthrow OpenJDKCompileStub.OpenJDKCompileStubThrowError();\n \t}\n+\t/*[ENDIF] Java10 */", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c6ff813463f624c59a2e9a9d750b75f0a3f0d3ed"}, "originalPosition": 4}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0Mjk4NTQ4NQ==", "bodyText": "The external messages need to be declared via preprocessor MSG on the line above, otherwise the messages won't be in the build.  The ExternalMessages-MasterIndex.properties file is just for tracking the indexes, it doesn't go into the build.", "url": "https://github.com/eclipse-openj9/openj9/pull/9865#discussion_r442985485", "createdAt": "2020-06-19T18:21:50Z", "author": {"login": "pshipton"}, "path": "jcl/src/java.base/share/classes/java/lang/invoke/MethodHandles.java", "diffHunk": "@@ -2313,6 +2317,19 @@ ClassDefiner makeHiddenClassDefiner(String name, byte[] template) {\n \t\t\tClassDefiner definer = new ClassDefiner(name, template, this);\n \t\t\treturn definer;\n \t\t}\n+\t\t\n+\t\tpublic Class<?> ensureInitialized(Class<?> cls) throws IllegalArgumentException, IllegalAccessException {\n+\t\t\tif (cls.isArray()) {\n+\t\t\t\tthrow new IllegalArgumentException(com.ibm.oti.util.Msg.getString(\"K0683\", cls));", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c6ff813463f624c59a2e9a9d750b75f0a3f0d3ed"}, "originalPosition": 18}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "7f264ca4d59c0c6362bae48db35508f01b9c433d", "author": {"user": {"login": "babsingh", "name": "Babneet Singh"}}, "url": "https://github.com/eclipse-openj9/openj9/commit/7f264ca4d59c0c6362bae48db35508f01b9c433d", "committedDate": "2020-06-19T20:31:49Z", "message": "Support JEP383 (Part 2) and CDS natives (Java 15)\n\n1. Add a stub for class InfoFromMemberName\n2. Add a stub for JVM_RegisterLambdaProxyClassForArchiving\n3. Add a stub for JVM_LookupLambdaProxyClassFromArchive\n4. Implement JVM_IsCDSDumpingEnabled\n5. Implement JVM_IsCDSSharingEnabled\n6. Add a MemberName field in class DirectMethodHandle\n7. Add stub method MemberName.getReferenceKind\n8. Add stub method MethodHandleNatives.refKindIsMethod\n9. Add stub method MethodHandleNatives.refKindIsConstructor\n10. Add stub method MethodHandles.collectReturnValue\n11. Implement method ensureInitialized in class Lookup\n\nSigned-off-by: Babneet Singh <sbabneet@ca.ibm.com>"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "c6ff813463f624c59a2e9a9d750b75f0a3f0d3ed", "author": {"user": {"login": "babsingh", "name": "Babneet Singh"}}, "url": "https://github.com/eclipse-openj9/openj9/commit/c6ff813463f624c59a2e9a9d750b75f0a3f0d3ed", "committedDate": "2020-06-12T17:22:57Z", "message": "Implement method ensureInitialized in class Lookup to support Java 15\n\nSigned-off-by: Babneet Singh <sbabneet@ca.ibm.com>"}, "afterCommit": {"oid": "7f264ca4d59c0c6362bae48db35508f01b9c433d", "author": {"user": {"login": "babsingh", "name": "Babneet Singh"}}, "url": "https://github.com/eclipse-openj9/openj9/commit/7f264ca4d59c0c6362bae48db35508f01b9c433d", "committedDate": "2020-06-19T20:31:49Z", "message": "Support JEP383 (Part 2) and CDS natives (Java 15)\n\n1. Add a stub for class InfoFromMemberName\n2. Add a stub for JVM_RegisterLambdaProxyClassForArchiving\n3. Add a stub for JVM_LookupLambdaProxyClassFromArchive\n4. Implement JVM_IsCDSDumpingEnabled\n5. Implement JVM_IsCDSSharingEnabled\n6. Add a MemberName field in class DirectMethodHandle\n7. Add stub method MemberName.getReferenceKind\n8. Add stub method MethodHandleNatives.refKindIsMethod\n9. Add stub method MethodHandleNatives.refKindIsConstructor\n10. Add stub method MethodHandles.collectReturnValue\n11. Implement method ensureInitialized in class Lookup\n\nSigned-off-by: Babneet Singh <sbabneet@ca.ibm.com>"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDM1MDM1NTc1", "url": "https://github.com/eclipse-openj9/openj9/pull/9865#pullrequestreview-435035575", "createdAt": "2020-06-22T15:26:47Z", "commit": {"oid": "7f264ca4d59c0c6362bae48db35508f01b9c433d"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yMlQxNToyNjo0N1rOGnFyMw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yMlQxNToyNjo0N1rOGnFyMw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MzY0MjQxOQ==", "bodyText": "Now it seems there is an extra blank line.", "url": "https://github.com/eclipse-openj9/openj9/pull/9865#discussion_r443642419", "createdAt": "2020-06-22T15:26:47Z", "author": {"login": "pshipton"}, "path": "jcl/src/java.base/share/classes/java/lang/invoke/InfoFromMemberName.java", "diffHunk": "@@ -21,3 +21,47 @@\n  *\n  * SPDX-License-Identifier: EPL-2.0 OR Apache-2.0 OR GPL-2.0 WITH Classpath-exception-2.0 OR LicenseRef-GPL-2.0 WITH Assembly-exception\n  *******************************************************************************/\n+/*[IF Java15]*/\n+package java.lang.invoke;\n+\n+import java.lang.invoke.MethodHandles.Lookup;\n+import java.lang.reflect.Member;\n+\n+class InfoFromMemberName implements MethodHandleInfo {\n+\tInfoFromMemberName(Lookup lookup, MemberName member, byte kind) {\n+\t\tthrow OpenJDKCompileStub.OpenJDKCompileStubThrowError();\n+\t}\n+\n+\t@Override\n+\tpublic Class<?> getDeclaringClass() {\n+\t\tthrow OpenJDKCompileStub.OpenJDKCompileStubThrowError();\n+\t}\n+\n+\t@Override\n+\tpublic String getName() {\n+\t\tthrow OpenJDKCompileStub.OpenJDKCompileStubThrowError();\n+\t}\n+\n+\t@Override\n+\tpublic MethodType getMethodType() {\n+\t\tthrow OpenJDKCompileStub.OpenJDKCompileStubThrowError();\n+\n+\t}\n+\n+\t@Override\n+\tpublic int getModifiers() {\n+\t\tthrow OpenJDKCompileStub.OpenJDKCompileStubThrowError();\n+\t}\n+\n+\t@Override\n+\tpublic int getReferenceKind() {\n+\t\tthrow OpenJDKCompileStub.OpenJDKCompileStubThrowError();\n+\t}\n+\n+\t@Override\n+\tpublic <T extends Member> T reflectAs(Class<T> expected, Lookup lookup) {\n+\t\tthrow OpenJDKCompileStub.OpenJDKCompileStubThrowError();\n+\t}\n+}\n+/*[ENDIF] Java15 */\n+", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "7f264ca4d59c0c6362bae48db35508f01b9c433d"}, "originalPosition": 56}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "3d3d9739907d3119e740c561c2da7e55880d3dd1", "author": {"user": {"login": "babsingh", "name": "Babneet Singh"}}, "url": "https://github.com/eclipse-openj9/openj9/commit/3d3d9739907d3119e740c561c2da7e55880d3dd1", "committedDate": "2020-06-22T16:01:30Z", "message": "Implement MethodHandle.viewAsType\n\nTemporarily support MethodHandle.viewAsType until OpenJ9 adopts OpenJDK\nMethodHandles.\n\nSigned-off-by: Babneet Singh <sbabneet@ca.ibm.com>"}, "afterCommit": {"oid": "4fcfd236e5c8d0fbab4bf605ee65435da00c6ace", "author": {"user": {"login": "babsingh", "name": "Babneet Singh"}}, "url": "https://github.com/eclipse-openj9/openj9/commit/4fcfd236e5c8d0fbab4bf605ee65435da00c6ace", "committedDate": "2020-06-22T16:03:37Z", "message": "Implement MethodHandle.viewAsType\n\nTemporarily support MethodHandle.viewAsType until OpenJ9 adopts OpenJDK\nMethodHandles.\n\nSigned-off-by: Babneet Singh <sbabneet@ca.ibm.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "0df4485a8083b0f40c066267bfab7677732ddda5", "author": {"user": {"login": "babsingh", "name": "Babneet Singh"}}, "url": "https://github.com/eclipse-openj9/openj9/commit/0df4485a8083b0f40c066267bfab7677732ddda5", "committedDate": "2020-06-22T16:15:46Z", "message": "Implement MethodHandle.viewAsType\n\nHack implementation for MethodHandle.viewAsType until OpenJ9 adopts OpenJDK\nMethodHandles.\n\nSigned-off-by: Babneet Singh <sbabneet@ca.ibm.com>"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "4fcfd236e5c8d0fbab4bf605ee65435da00c6ace", "author": {"user": {"login": "babsingh", "name": "Babneet Singh"}}, "url": "https://github.com/eclipse-openj9/openj9/commit/4fcfd236e5c8d0fbab4bf605ee65435da00c6ace", "committedDate": "2020-06-22T16:03:37Z", "message": "Implement MethodHandle.viewAsType\n\nTemporarily support MethodHandle.viewAsType until OpenJ9 adopts OpenJDK\nMethodHandles.\n\nSigned-off-by: Babneet Singh <sbabneet@ca.ibm.com>"}, "afterCommit": {"oid": "0df4485a8083b0f40c066267bfab7677732ddda5", "author": {"user": {"login": "babsingh", "name": "Babneet Singh"}}, "url": "https://github.com/eclipse-openj9/openj9/commit/0df4485a8083b0f40c066267bfab7677732ddda5", "committedDate": "2020-06-22T16:15:46Z", "message": "Implement MethodHandle.viewAsType\n\nHack implementation for MethodHandle.viewAsType until OpenJ9 adopts OpenJDK\nMethodHandles.\n\nSigned-off-by: Babneet Singh <sbabneet@ca.ibm.com>"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDM2Mjg5Njc4", "url": "https://github.com/eclipse-openj9/openj9/pull/9865#pullrequestreview-436289678", "createdAt": "2020-06-24T02:53:09Z", "commit": {"oid": "0df4485a8083b0f40c066267bfab7677732ddda5"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 670, "cost": 1, "resetAt": "2021-10-28T17:48:14Z"}}}