{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDMzODkxNjMw", "number": 9870, "title": "Modified printJITServerMsgStats to print at shutdown on server", "bodyText": "To trigger the jitDump use the option -Xdump:jit:events=user from the server side\nand then run the Java client and then  kill -3 (pidof jitserver). This will print\nthe message stats received by the server at shutdown.\nissue: #9708\nSigned-off-by: Eman Elsabban eman.elsaban1@gmail.com", "createdAt": "2020-06-12T21:27:06Z", "url": "https://github.com/eclipse-openj9/openj9/pull/9870", "merged": true, "mergeCommit": {"oid": "4d401926c8d089c02e5eeb0c052523d6072e8b0d"}, "closed": true, "closedAt": "2020-06-18T13:08:47Z", "author": {"login": "EmanElsaban"}, "timelineItems": {"totalCount": 5, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcqpwFmABqjM0Mzk5OTU0ODA=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcsMY7FAFqTQzMjU2ODQxMg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "dd1e433560b4a9c27540ee157fcd525672200dbd", "author": {"user": {"login": "EmanElsaban", "name": "Eman Elsabban"}}, "url": "https://github.com/eclipse-openj9/openj9/commit/dd1e433560b4a9c27540ee157fcd525672200dbd", "committedDate": "2020-06-12T21:11:00Z", "message": "Modified the method printJITServerMsgStats to print at shutdown on server side\n\nTo trigger the jitDump use the option -Xdump:jit:events=user from the server side\nand then run the Java client and then  kill -3 <pidof jitserver>. This will print\nthe message stats received by the server at shutdown.\nissue: #9708\n\nSigned-off-by: Eman Elsabban <eman.elsaban1@gmail.com>"}, "afterCommit": {"oid": "7501f63bbddb3f95c219403577ea49afe245a439", "author": {"user": {"login": "EmanElsaban", "name": "Eman Elsabban"}}, "url": "https://github.com/eclipse-openj9/openj9/commit/7501f63bbddb3f95c219403577ea49afe245a439", "committedDate": "2020-06-12T21:28:11Z", "message": "Modified printJITServerMsgStats to print at shutdown on server\n\nTo trigger the jitDump use the option -Xdump:jit:events=user from the server side\nand then run the Java client and then  kill -3 <pidof jitserver>. This will print\nthe message stats received by the server at shutdown.\nissue: #9708\n\nSigned-off-by: Eman Elsabban <eman.elsaban1@gmail.com>"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDMyNDUxNjg4", "url": "https://github.com/eclipse-openj9/openj9/pull/9870#pullrequestreview-432451688", "createdAt": "2020-06-17T14:19:51Z", "commit": {"oid": "7501f63bbddb3f95c219403577ea49afe245a439"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xN1QxNDoxOTo1MVrOGlIDKw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xN1QxNDoxOTo1MVrOGlIDKw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MTU4MjM3OQ==", "bodyText": "If MESSAGE_SIZE_STATS is not defined, the for loop above will go over all the messages, but print nothing and at the very end it will print \"Total number of messages: 0\"\nI would include the for loop and this last printf message into the block protected by ifdef.\nAlso, add a comment to the #endif so that we know what should be paired with:\n#if defined(MESSAGE_SIZE_STATS)\n...\n#endif // defined(MESSAGE_SIZE_STATS)", "url": "https://github.com/eclipse-openj9/openj9/pull/9870#discussion_r441582379", "createdAt": "2020-06-17T14:19:51Z", "author": {"login": "mpirvu"}, "path": "runtime/compiler/control/JITServerHelpers.cpp", "diffHunk": "@@ -121,33 +121,56 @@ JITServerHelpers::insertIntoOOSequenceEntryList(ClientSessionData *clientData, T\n    }\n \n void\n-JITServerHelpers::printJITServerMsgStats(J9JITConfig *jitConfig)\n+JITServerHelpers::printJITServerMsgStats(J9JITConfig *jitConfig, TR::CompilationInfo *compInfo)\n    {\n-   int totalMsgCount = 0;\t   \n+   unsigned totalMsgCount = 0;\t   \n    PORT_ACCESS_FROM_JITCONFIG(jitConfig);\n    j9tty_printf(PORTLIB, \"JITServer Message Type Statistics:\\n\");\n    j9tty_printf(PORTLIB, \"Type# #called\");\n-#ifdef MESSAGE_SIZE_STATS\n+#ifdef MESSAGE_SIZE_STATS  \n    j9tty_printf(PORTLIB, \"\\t\\tMax\\t\\tMin\\t\\tMean\\t\\tStdDev\\t\\tSum\");\n #endif\n    j9tty_printf(PORTLIB, \"\\t\\tTypeName\\n\");\n-   for (int i = 0; i < JITServer::MessageType_ARRAYSIZE; ++i)\n+   if (compInfo->getPersistentInfo()->getRemoteCompilationMode() == JITServer::CLIENT)\n       {\n-      if (JITServerHelpers::serverMsgTypeCount[i] > 0)\n+      for (int i = 0; i < JITServer::MessageType_ARRAYSIZE; ++i)\n          {\n-         j9tty_printf(PORTLIB, \"#%04d %7u\", i, JITServerHelpers::serverMsgTypeCount[i]);\n+         if (JITServerHelpers::serverMsgTypeCount[i] > 0)\n+            {\n+            j9tty_printf(PORTLIB, \"#%04d %7u\", i, JITServerHelpers::serverMsgTypeCount[i]);\n #ifdef MESSAGE_SIZE_STATS            \n-         j9tty_printf(PORTLIB, \"\\t%f\\t%f\\t%f\\t%f\\t%f\", JITServer::CommunicationStream::collectMsgStat[i].maxVal(), \n+            j9tty_printf(PORTLIB, \"\\t%f\\t%f\\t%f\\t%f\\t%f\", JITServer::CommunicationStream::collectMsgStat[i].maxVal(), \n                      JITServer::CommunicationStream::collectMsgStat[i].minVal(), JITServer::CommunicationStream::collectMsgStat[i].mean(),\n                      JITServer::CommunicationStream::collectMsgStat[i].stddev(), JITServer::CommunicationStream::collectMsgStat[i].sum());\n #endif\n-         j9tty_printf(PORTLIB, \"\\t\\t%s\\n\", JITServer::messageNames[i]);\n-         totalMsgCount += JITServerHelpers::serverMsgTypeCount[i];\n+            j9tty_printf(PORTLIB, \"\\t\\t%s\\n\", JITServer::messageNames[i]);\n+            totalMsgCount += JITServerHelpers::serverMsgTypeCount[i];\n+            }\n          }\n+      if (JITServerHelpers::serverMsgTypeCount[0])\n+         j9tty_printf(PORTLIB, \"Total number of messages: %d. Average number of messages per compilation:%f\\n\", totalMsgCount, totalMsgCount/float(JITServerHelpers::serverMsgTypeCount[0]));\n       }\n-   if (JITServerHelpers::serverMsgTypeCount[0])\n-       j9tty_printf(PORTLIB, \"Total number of messages: %d. Average number of messages per compilation:%f\\n\", totalMsgCount, totalMsgCount/float(JITServerHelpers::serverMsgTypeCount[0]));\n+   else if (compInfo->getPersistentInfo()->getRemoteCompilationMode() == JITServer::SERVER)\n+      {\n+      // to print in server, run ./jitserver -Xdump:jit:events=user\n+      // then kill -3 <pidof jitserver>\n+      for (int i = 0; i < JITServer::MessageType_ARRAYSIZE; ++i)\n+         {\n+#ifdef MESSAGE_SIZE_STATS  \n+         if (JITServer::CommunicationStream::collectMsgStat[i].samples() > 0)\n+            { \n+            j9tty_printf(PORTLIB, \"#%04d %7u\", i, JITServer::CommunicationStream::collectMsgStat[i].samples());            \n+            j9tty_printf(PORTLIB, \"\\t%f\\t%f\\t%f\\t%f\\t%f\", JITServer::CommunicationStream::collectMsgStat[i].maxVal(), \n+                     JITServer::CommunicationStream::collectMsgStat[i].minVal(), JITServer::CommunicationStream::collectMsgStat[i].mean(),\n+                     JITServer::CommunicationStream::collectMsgStat[i].stddev(), JITServer::CommunicationStream::collectMsgStat[i].sum());\n \n+            j9tty_printf(PORTLIB, \"\\t\\t%s\\n\", JITServer::messageNames[i]);\n+            totalMsgCount += JITServer::CommunicationStream::collectMsgStat[i].samples();\n+#endif\n+            }\n+         }\n+      j9tty_printf(PORTLIB, \"Total number of messages: %u\\n\", totalMsgCount);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "7501f63bbddb3f95c219403577ea49afe245a439"}, "originalPosition": 63}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "facc2a4f131c7ed906ed67bbf98f722c0cec73c7", "author": {"user": {"login": "EmanElsaban", "name": "Eman Elsabban"}}, "url": "https://github.com/eclipse-openj9/openj9/commit/facc2a4f131c7ed906ed67bbf98f722c0cec73c7", "committedDate": "2020-06-17T15:36:08Z", "message": "Modified printJITServerMsgStats to print at shutdown on server\n\nTo trigger the jitDump use the option -Xdump:jit:events=user from the server side\nand then run the Java client and then  kill -3 <pidof jitserver>. This will print\nthe message stats received by the server at shutdown.\nissue: #9708\n\nSigned-off-by: Eman Elsabban <eman.elsaban1@gmail.com>"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "7501f63bbddb3f95c219403577ea49afe245a439", "author": {"user": {"login": "EmanElsaban", "name": "Eman Elsabban"}}, "url": "https://github.com/eclipse-openj9/openj9/commit/7501f63bbddb3f95c219403577ea49afe245a439", "committedDate": "2020-06-12T21:28:11Z", "message": "Modified printJITServerMsgStats to print at shutdown on server\n\nTo trigger the jitDump use the option -Xdump:jit:events=user from the server side\nand then run the Java client and then  kill -3 <pidof jitserver>. This will print\nthe message stats received by the server at shutdown.\nissue: #9708\n\nSigned-off-by: Eman Elsabban <eman.elsaban1@gmail.com>"}, "afterCommit": {"oid": "facc2a4f131c7ed906ed67bbf98f722c0cec73c7", "author": {"user": {"login": "EmanElsaban", "name": "Eman Elsabban"}}, "url": "https://github.com/eclipse-openj9/openj9/commit/facc2a4f131c7ed906ed67bbf98f722c0cec73c7", "committedDate": "2020-06-17T15:36:08Z", "message": "Modified printJITServerMsgStats to print at shutdown on server\n\nTo trigger the jitDump use the option -Xdump:jit:events=user from the server side\nand then run the Java client and then  kill -3 <pidof jitserver>. This will print\nthe message stats received by the server at shutdown.\nissue: #9708\n\nSigned-off-by: Eman Elsabban <eman.elsaban1@gmail.com>"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDMyNTY4NDEy", "url": "https://github.com/eclipse-openj9/openj9/pull/9870#pullrequestreview-432568412", "createdAt": "2020-06-17T16:24:50Z", "commit": {"oid": "facc2a4f131c7ed906ed67bbf98f722c0cec73c7"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 678, "cost": 1, "resetAt": "2021-10-28T17:48:14Z"}}}