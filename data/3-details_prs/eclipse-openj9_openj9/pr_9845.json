{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDMyNzMwMjA4", "number": 9845, "title": "Ensure enough space is allocated for the unique cache id", "bodyText": "Don't compute the cache unique id for layer 0\n\nfix J9SHR_UNIQUE_CACHE_ID_BUFSIZE - it was too small\nuse a format with fixed field widths so the length of the unique id does not depend on things like the length of the lower layer cache file\nuse return value of generateCacheUniqueID() instead of using strlen()\n\nFixes #9838.", "createdAt": "2020-06-10T22:15:35Z", "url": "https://github.com/eclipse-openj9/openj9/pull/9845", "merged": true, "mergeCommit": {"oid": "dd683f6c5e62d10938b61696297b7d16b648ed40"}, "closed": true, "closedAt": "2020-06-17T01:35:12Z", "author": {"login": "keithc-ca"}, "timelineItems": {"totalCount": 7, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcr5Ik9gBqjM0NTAyMDU1Njk=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcr_qWRAFqTQzMTk5OTQ0OQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "a35c5bee28351f07aded3848fdd263e8e53474bb", "author": {"user": {"login": "keithc-ca", "name": "Keith W. Campbell"}}, "url": "https://github.com/eclipse-openj9/openj9/commit/a35c5bee28351f07aded3848fdd263e8e53474bb", "committedDate": "2020-06-10T22:09:47Z", "message": "Ensure enough space is allocated for the unique cache id\n\nSigned-off-by: Keith W. Campbell <keithc@ca.ibm.com>"}, "afterCommit": {"oid": "d221f0258f29e1ebd0a4b0f8984a8a3346aa5450", "author": {"user": {"login": "keithc-ca", "name": "Keith W. Campbell"}}, "url": "https://github.com/eclipse-openj9/openj9/commit/d221f0258f29e1ebd0a4b0f8984a8a3346aa5450", "committedDate": "2020-06-16T17:57:57Z", "message": "Don't compute the cache unique id for layer 0\n\n* fix J9SHR_UNIQUE_CACHE_ID_BUFSIZE - it was too small\n\n* use a format with fixed field widths so the length of the unique id\n  does not depend on things like the length of the lower layer cache\n  file\n\n* use return value of generateCacheUniqueID() instead of using strlen()\n\nSigned-off-by: Keith W. Campbell <keithc@ca.ibm.com>"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDMxNzg1NzA1", "url": "https://github.com/eclipse-openj9/openj9/pull/9845#pullrequestreview-431785705", "createdAt": "2020-06-16T18:30:49Z", "commit": {"oid": "d221f0258f29e1ebd0a4b0f8984a8a3346aa5450"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xNlQxODozMDo0OVrOGkoJ1A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xNlQxODozMDo0OVrOGkoJ1A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MTA1OTc5Ng==", "bodyText": "\"We don't need to compute the cache id for layer 0\" should be:\n\"We don't need to compute the cache id for the top layer\".\nThe cache ID is needed only by its higher layer. Top layer does not have a higher layer, so no need to compute cache id for the top layer.", "url": "https://github.com/eclipse-openj9/openj9/pull/9845#discussion_r441059796", "createdAt": "2020-06-16T18:30:49Z", "author": {"login": "hangshao0"}, "path": "runtime/shared_common/CompositeCache.cpp", "diffHunk": "@@ -1711,7 +1711,8 @@ SH_CompositeCacheImpl::startup(J9VMThread* currentThread, J9SharedClassPreinitCo\n \t}\n \tif (rc == CC_STARTUP_OK) {\n \t\t_started = true;\n-\t\tif (NULL == cacheMemory) {\n+\t\t/* We don't need to compute the cache id for layer 0. */", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d221f0258f29e1ebd0a4b0f8984a8a3346aa5450"}, "originalPosition": 5}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDMxNzg3NDUy", "url": "https://github.com/eclipse-openj9/openj9/pull/9845#pullrequestreview-431787452", "createdAt": "2020-06-16T18:33:08Z", "commit": {"oid": "d221f0258f29e1ebd0a4b0f8984a8a3346aa5450"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xNlQxODozMzowOVrOGkoO_w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xNlQxODozMzowOVrOGkoO_w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MTA2MTExOQ==", "bodyText": "J9SHR_UNIQUE_CACHE_ID_BUFSIZE or J9SHR_CACHE_UNIQUE_ID_BUFSIZE ? The function name is generateCacheUniqueID", "url": "https://github.com/eclipse-openj9/openj9/pull/9845#discussion_r441061119", "createdAt": "2020-06-16T18:33:09Z", "author": {"login": "hangshao0"}, "path": "runtime/shared_common/CacheMap.hpp", "diffHunk": "@@ -39,7 +39,18 @@\n #define CM_CACHE_CORRUPT -2\n #define CM_CACHE_STORE_PREREQ_ID_FAILED -3\n \n-#define J9SHR_UNIQUE_CACHE_ID_BUFSIZE  (J9SH_MAXPATH + 35)\n+/*\n+ * The maximum width of the hexadecimal representation of a value of type 'T'.\n+ */\n+#define J9HEX_WIDTH(T) (2 * sizeof(T))\n+\n+/*\n+ * A unique cache id is a path followed by six hexadecimal values,\n+ * the first two of which express 64-bits values and the remaining\n+ * four express UDATA values. Additionally, there are six separator\n+ * characters and a terminating NUL character.\n+ */\n+#define J9SHR_UNIQUE_CACHE_ID_BUFSIZE (J9SH_MAXPATH + (2 * J9HEX_WIDTH(U_64)) + (4 * J9HEX_WIDTH(UDATA)) + 6 + 1)", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d221f0258f29e1ebd0a4b0f8984a8a3346aa5450"}, "originalPosition": 16}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "773f6c86d99df63c98f71c0d368eccbdf7d613be", "author": {"user": {"login": "keithc-ca", "name": "Keith W. Campbell"}}, "url": "https://github.com/eclipse-openj9/openj9/commit/773f6c86d99df63c98f71c0d368eccbdf7d613be", "committedDate": "2020-06-16T18:54:14Z", "message": "Don't compute the cache unique id for the top layer\n\n* fix J9SHR_UNIQUE_CACHE_ID_BUFSIZE - it was too small\n\n* use a format with fixed field widths so the length of the unique id\n  does not depend on things like the length of the lower layer cache\n  file\n\n* use return value of generateCacheUniqueID() instead of using strlen()\n\nSigned-off-by: Keith W. Campbell <keithc@ca.ibm.com>"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "d221f0258f29e1ebd0a4b0f8984a8a3346aa5450", "author": {"user": {"login": "keithc-ca", "name": "Keith W. Campbell"}}, "url": "https://github.com/eclipse-openj9/openj9/commit/d221f0258f29e1ebd0a4b0f8984a8a3346aa5450", "committedDate": "2020-06-16T17:57:57Z", "message": "Don't compute the cache unique id for layer 0\n\n* fix J9SHR_UNIQUE_CACHE_ID_BUFSIZE - it was too small\n\n* use a format with fixed field widths so the length of the unique id\n  does not depend on things like the length of the lower layer cache\n  file\n\n* use return value of generateCacheUniqueID() instead of using strlen()\n\nSigned-off-by: Keith W. Campbell <keithc@ca.ibm.com>"}, "afterCommit": {"oid": "773f6c86d99df63c98f71c0d368eccbdf7d613be", "author": {"user": {"login": "keithc-ca", "name": "Keith W. Campbell"}}, "url": "https://github.com/eclipse-openj9/openj9/commit/773f6c86d99df63c98f71c0d368eccbdf7d613be", "committedDate": "2020-06-16T18:54:14Z", "message": "Don't compute the cache unique id for the top layer\n\n* fix J9SHR_UNIQUE_CACHE_ID_BUFSIZE - it was too small\n\n* use a format with fixed field widths so the length of the unique id\n  does not depend on things like the length of the lower layer cache\n  file\n\n* use return value of generateCacheUniqueID() instead of using strlen()\n\nSigned-off-by: Keith W. Campbell <keithc@ca.ibm.com>"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDMxODI3MDIz", "url": "https://github.com/eclipse-openj9/openj9/pull/9845#pullrequestreview-431827023", "createdAt": "2020-06-16T19:29:29Z", "commit": {"oid": "773f6c86d99df63c98f71c0d368eccbdf7d613be"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDMxOTk5NDQ5", "url": "https://github.com/eclipse-openj9/openj9/pull/9845#pullrequestreview-431999449", "createdAt": "2020-06-17T01:35:06Z", "commit": {"oid": "773f6c86d99df63c98f71c0d368eccbdf7d613be"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 651, "cost": 1, "resetAt": "2021-10-28T17:48:14Z"}}}