{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0MzY1NDkwMTA5", "number": 8364, "title": "Avoid control flow for copying heap allocations to temporaries", "bodyText": "Updates of all the temporaries that contain the address of a candidate object for cold block heapification are currently guarded with ifacmpne instructions.  In order to simplify the control flow graph produced for heapification before cold blocks, replace the conditional update of each\ntemporary with an unconditional store using the result of an aternary instruction that either updates the temporary with the heap object address or with the current contents of the temporary unconditionally.  This update is inserted into the start of the cold block rather than in\na new block preceding the cold block.\nThis is only done if code generation supports ternary opcodes.  If ternary opcodes are not supported, ifacmpne checks are still generated instead.  The ifacmpne checks can also be forced by setting the environment variable TR_disableTernaryOpForEA.\nSigned-off-by:  Henry Zongaro zongaro@ca.ibm.com", "createdAt": "2020-01-21T20:14:22Z", "url": "https://github.com/eclipse-openj9/openj9/pull/8364", "merged": true, "mergeCommit": {"oid": "03d14e68dd97216f253c6d586f5793f43f4f0e84"}, "closed": true, "closedAt": "2020-01-23T20:50:04Z", "author": {"login": "hzongaro"}, "timelineItems": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABb9LahXAFqTM0NzM0ODE3NQ==", "endCursor": "Y3Vyc29yOnYyOpPPAAABb9OL81AFqTM0NzQ5NDQzOA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzQ3MzQ4MTc1", "url": "https://github.com/eclipse-openj9/openj9/pull/8364#pullrequestreview-347348175", "createdAt": "2020-01-23T14:42:13Z", "commit": {"oid": "3cf0f8593cd3eff46f166ec95f02e6d1cd9ba07a"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0yM1QxNDo0MjoxNFrOFhAlgA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0yM1QxNDo0MjoxNFrOFhAlgA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MDE1NjkyOA==", "bodyText": "In an off-line conversation, Andrew @andrewcraik recommended that I try to pull the code that appears between the two blocks of code guarded by tests of useTernaryOp into a separate method, which would then be called in both cases. That would allow the two blocks of code for the !useTernaryOp case to be merged, improving readability.\nAndrew, I've made that change in commit f66b989.  If you are OK with that change, I will merge the two commits.", "url": "https://github.com/eclipse-openj9/openj9/pull/8364#discussion_r370156928", "createdAt": "2020-01-23T14:42:14Z", "author": {"login": "hzongaro"}, "path": "runtime/compiler/optimizer/EscapeAnalysis.cpp", "diffHunk": "@@ -7450,29 +7506,32 @@ void TR_EscapeAnalysis::heapifyBeforeColdBlocks(Candidate *candidate)\n            initStoreTree->join(nextToStart);\n            }", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "3cf0f8593cd3eff46f166ec95f02e6d1cd9ba07a"}, "originalPosition": 145}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "0b0d112b967fef968e6f2be074750d6956952fa5", "author": {"user": {"login": "hzongaro", "name": "Henry Zongaro"}}, "url": "https://github.com/eclipse-openj9/openj9/commit/0b0d112b967fef968e6f2be074750d6956952fa5", "committedDate": "2020-01-23T14:52:13Z", "message": "Avoid control flow for copying heap allocations to temporaries\n\nUpdates of all the temporaries that contain the address of a candidate\nobject for cold block heapification are currently guarded with ifacmpne\ninstructions.  In order to simplify the control flow graph produced for\nheapification before cold blocks, replace the conditional update of each\ntemporary with an unconditional store using the result of an aternary\ninstruction that either updates the temporary with the heap object\naddress or with the current contents of the temporary unconditionally.\nThis update is inserted into the start of the cold block rather than in\na new block preceding the cold block.\n\nThis is only done if code generation supports ternary opcodes.  If\nternary opcodes are not supported, ifacmpne checks are still generated\ninstead.  The ifacmpne checks can also be forced by setting the\nenvironment variable TR_disableTernaryOpForEA.\n\nSigned-off-by:  Henry Zongaro <zongaro@ca.ibm.com>"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "f66b989d4f9d4b3335a84fb5723074da03ab862f", "author": {"user": {"login": "hzongaro", "name": "Henry Zongaro"}}, "url": "https://github.com/eclipse-openj9/openj9/commit/f66b989d4f9d4b3335a84fb5723074da03ab862f", "committedDate": "2020-01-22T16:29:16Z", "message": "Refactor code storing heapified objects in cold blocks\n\nIn order to make code more readable, gathered together code that\nstored addresses of heapified objects into temporaries into two\nblocks - one for using aternary and one for generating code without\nuse of aternary.\n\nSigned-off-by:  Henry Zongaro <zongaro@ca.ibm.com>"}, "afterCommit": {"oid": "0b0d112b967fef968e6f2be074750d6956952fa5", "author": {"user": {"login": "hzongaro", "name": "Henry Zongaro"}}, "url": "https://github.com/eclipse-openj9/openj9/commit/0b0d112b967fef968e6f2be074750d6956952fa5", "committedDate": "2020-01-23T14:52:13Z", "message": "Avoid control flow for copying heap allocations to temporaries\n\nUpdates of all the temporaries that contain the address of a candidate\nobject for cold block heapification are currently guarded with ifacmpne\ninstructions.  In order to simplify the control flow graph produced for\nheapification before cold blocks, replace the conditional update of each\ntemporary with an unconditional store using the result of an aternary\ninstruction that either updates the temporary with the heap object\naddress or with the current contents of the temporary unconditionally.\nThis update is inserted into the start of the cold block rather than in\na new block preceding the cold block.\n\nThis is only done if code generation supports ternary opcodes.  If\nternary opcodes are not supported, ifacmpne checks are still generated\ninstead.  The ifacmpne checks can also be forced by setting the\nenvironment variable TR_disableTernaryOpForEA.\n\nSigned-off-by:  Henry Zongaro <zongaro@ca.ibm.com>"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzQ3NDk0NDM4", "url": "https://github.com/eclipse-openj9/openj9/pull/8364#pullrequestreview-347494438", "createdAt": "2020-01-23T17:56:02Z", "commit": {"oid": "0b0d112b967fef968e6f2be074750d6956952fa5"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 899, "cost": 1, "resetAt": "2021-10-28T18:00:02Z"}}}