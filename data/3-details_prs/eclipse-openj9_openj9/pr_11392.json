{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTMzOTc2NTg2", "number": 11392, "title": "Store client's VM phase in JITServer client session", "bodyText": "Server needs to know when client is in startup phase,\nso that it can insert JIT hints for compilations that\nare expensive, i.e. hot/scorching compilations or\nmemory/cpu intensive ones.\nThis commit stores whether this information in the client session.\nCloses: #11386", "createdAt": "2020-12-07T22:03:56Z", "url": "https://github.com/eclipse-openj9/openj9/pull/11392", "merged": true, "mergeCommit": {"oid": "43960bfdc18da2072ed67b2360f2c7b53f6e6b8a"}, "closed": true, "closedAt": "2020-12-09T00:25:27Z", "author": {"login": "dmitry-ten"}, "timelineItems": {"totalCount": 9, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdj9TP0gBqjQwODE5Njg1Nzk=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdkP6OegFqTU0NzU5MDk3MA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "9fb4aa70b281699759196596fb8c3c43b7abc7bb", "author": {"user": {"login": "dmitry-ten", "name": "Dmitry Ten"}}, "url": "https://github.com/eclipse-openj9/openj9/commit/9fb4aa70b281699759196596fb8c3c43b7abc7bb", "committedDate": "2020-12-07T21:09:07Z", "message": "Store client's VM phase in JITServer client session\n\nServer needs to know when client is in startup phase,\nso that it can insert JIT hints for compilations that\nare memory and cpu expensive. This commit stores\nwhether the client is in startup in the client session.\n\nSigned-off-by: dmitry-ten <candalistic@gmail.com>"}, "afterCommit": {"oid": "65633e99e6b7ec67d8cd3f415b15ae55d6f639cc", "author": {"user": {"login": "dmitry-ten", "name": "Dmitry Ten"}}, "url": "https://github.com/eclipse-openj9/openj9/commit/65633e99e6b7ec67d8cd3f415b15ae55d6f639cc", "committedDate": "2020-12-07T22:29:44Z", "message": "Store client's VM phase in JITServer client session\n\nServer needs to know when client is in startup phase,\nso that it can insert JIT hints for compilations that\nare memory and cpu expensive. This commit stores\nwhether the client is in startup in the client session.\n\nSigned-off-by: dmitry-ten <candalistic@gmail.com>"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "65633e99e6b7ec67d8cd3f415b15ae55d6f639cc", "author": {"user": {"login": "dmitry-ten", "name": "Dmitry Ten"}}, "url": "https://github.com/eclipse-openj9/openj9/commit/65633e99e6b7ec67d8cd3f415b15ae55d6f639cc", "committedDate": "2020-12-07T22:29:44Z", "message": "Store client's VM phase in JITServer client session\n\nServer needs to know when client is in startup phase,\nso that it can insert JIT hints for compilations that\nare memory and cpu expensive. This commit stores\nwhether the client is in startup in the client session.\n\nSigned-off-by: dmitry-ten <candalistic@gmail.com>"}, "afterCommit": {"oid": "8fd16a04785c697484096493327cd270b948c0e9", "author": {"user": {"login": "dmitry-ten", "name": "Dmitry Ten"}}, "url": "https://github.com/eclipse-openj9/openj9/commit/8fd16a04785c697484096493327cd270b948c0e9", "committedDate": "2020-12-07T22:31:50Z", "message": "Store client's VM phase in JITServer client session\n\nServer needs to know when client is in startup phase,\nso that it can insert JIT hints for compilations that\nare expensive, i.e. hot/scorching compilations or\nmemory/cpu intensive ones.\nThis commit stores whether this information in the client session.\n\nSigned-off-by: Dmitry Ten <Dmitry.Ten@ibm.com>"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "8fd16a04785c697484096493327cd270b948c0e9", "author": {"user": {"login": "dmitry-ten", "name": "Dmitry Ten"}}, "url": "https://github.com/eclipse-openj9/openj9/commit/8fd16a04785c697484096493327cd270b948c0e9", "committedDate": "2020-12-07T22:31:50Z", "message": "Store client's VM phase in JITServer client session\n\nServer needs to know when client is in startup phase,\nso that it can insert JIT hints for compilations that\nare expensive, i.e. hot/scorching compilations or\nmemory/cpu intensive ones.\nThis commit stores whether this information in the client session.\n\nSigned-off-by: Dmitry Ten <Dmitry.Ten@ibm.com>"}, "afterCommit": {"oid": "2cb1351945d7b5ea75eb45361fa5a737606d932f", "author": {"user": {"login": "dmitry-ten", "name": "Dmitry Ten"}}, "url": "https://github.com/eclipse-openj9/openj9/commit/2cb1351945d7b5ea75eb45361fa5a737606d932f", "committedDate": "2020-12-07T22:33:21Z", "message": "Store client's VM phase in JITServer client session\n\nServer needs to know when client is in startup phase,\nso that it can insert JIT hints for compilations that\nare expensive, i.e. hot/scorching compilations or\nmemory/cpu intensive ones.\nThis commit stores whether this information in the client session.\n\nSigned-off-by: Dmitry Ten <Dmitry.Ten@ibm.com>"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTQ2NzAxNTI1", "url": "https://github.com/eclipse-openj9/openj9/pull/11392#pullrequestreview-546701525", "createdAt": "2020-12-08T02:39:32Z", "commit": {"oid": "2cb1351945d7b5ea75eb45361fa5a737606d932f"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0wOFQwMjozOTozMlrOIBEO9A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0wOFQwMjo0NDoxMlrOIBEVkg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNzk4ODg1Mg==", "bodyText": "Please remove !", "url": "https://github.com/eclipse-openj9/openj9/pull/11392#discussion_r537988852", "createdAt": "2020-12-08T02:39:32Z", "author": {"login": "mpirvu"}, "path": "runtime/compiler/env/J9VMEnv.cpp", "diffHunk": "@@ -508,3 +508,15 @@ J9::VMEnv::getInterpreterVTableOffset()\n #endif /* defined(J9VM_OPT_JITSERVER) */\n    return sizeof(J9Class);\n    }\n+\n+bool\n+J9::VMEnv::isVMInStartupPhase(J9JITConfig *jitConfig)\n+   {\n+#if defined(J9VM_OPT_JITSERVER)\n+   if (auto stream = TR::CompilationInfo::getStream())\n+      {\n+      return TR::compInfoPT->getClientData()->isInStartupPhase();\n+      }\n+#endif /* defined(J9VM_OPT_JITSERVER) */\n+   return !jitConfig->javaVM->phase != J9VM_PHASE_NOT_STARTUP;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "2cb1351945d7b5ea75eb45361fa5a737606d932f"}, "originalPosition": 14}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNzk5MDA3NQ==", "bodyText": "I don't think we need a monitor just to get/set a boolean. Such operations are atomic anyway.", "url": "https://github.com/eclipse-openj9/openj9/pull/11392#discussion_r537990075", "createdAt": "2020-12-08T02:42:50Z", "author": {"login": "mpirvu"}, "path": "runtime/compiler/runtime/JITClientSession.cpp", "diffHunk": "@@ -73,6 +74,7 @@ ClientSessionData::ClientSessionData(uint64_t clientUID, uint32_t seqNo) :\n    TR::SymbolValidationManager::populateSystemClassesNotWorthRemembering(this);\n \n    _wellKnownClassesMonitor = TR::Monitor::create(\"JIT-JITServerWellKnownClassesMonitor\");\n+   _startupPhaseMonitor = TR::Monitor::create(\"JIT-JITServerStartupPhaseMonitor\");", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "2cb1351945d7b5ea75eb45361fa5a737606d932f"}, "originalPosition": 14}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNzk5MDU0Ng==", "bodyText": "This could be marked const", "url": "https://github.com/eclipse-openj9/openj9/pull/11392#discussion_r537990546", "createdAt": "2020-12-08T02:44:12Z", "author": {"login": "mpirvu"}, "path": "runtime/compiler/runtime/JITClientSession.hpp", "diffHunk": "@@ -454,6 +454,10 @@ class ClientSessionData\n    void cacheWellKnownClassChainOffsets(unsigned int includedClasses, size_t numClasses,\n                                         const uintptr_t *classChainOffsets, const void *wellKnownClassChainOffsets);\n \n+   TR::Monitor *getStartupPhaseMonitor() { return _startupPhaseMonitor; }\n+   bool isInStartupPhase();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "2cb1351945d7b5ea75eb45361fa5a737606d932f"}, "originalPosition": 5}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "2cb1351945d7b5ea75eb45361fa5a737606d932f", "author": {"user": {"login": "dmitry-ten", "name": "Dmitry Ten"}}, "url": "https://github.com/eclipse-openj9/openj9/commit/2cb1351945d7b5ea75eb45361fa5a737606d932f", "committedDate": "2020-12-07T22:33:21Z", "message": "Store client's VM phase in JITServer client session\n\nServer needs to know when client is in startup phase,\nso that it can insert JIT hints for compilations that\nare expensive, i.e. hot/scorching compilations or\nmemory/cpu intensive ones.\nThis commit stores whether this information in the client session.\n\nSigned-off-by: Dmitry Ten <Dmitry.Ten@ibm.com>"}, "afterCommit": {"oid": "3492c0aba06cd5a1650d538f06a5b483bd50e8bf", "author": {"user": {"login": "dmitry-ten", "name": "Dmitry Ten"}}, "url": "https://github.com/eclipse-openj9/openj9/commit/3492c0aba06cd5a1650d538f06a5b483bd50e8bf", "committedDate": "2020-12-08T16:11:11Z", "message": "Store client's VM phase in JITServer client session\n\nServer needs to know when client is in startup phase,\nso that it can insert JIT hints for compilations that\nare expensive, i.e. hot/scorching compilations or\nmemory/cpu intensive ones.\nThis commit stores whether this information in the client session.\n\nSigned-off-by: Dmitry Ten <Dmitry.Ten@ibm.com>"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "3492c0aba06cd5a1650d538f06a5b483bd50e8bf", "author": {"user": {"login": "dmitry-ten", "name": "Dmitry Ten"}}, "url": "https://github.com/eclipse-openj9/openj9/commit/3492c0aba06cd5a1650d538f06a5b483bd50e8bf", "committedDate": "2020-12-08T16:11:11Z", "message": "Store client's VM phase in JITServer client session\n\nServer needs to know when client is in startup phase,\nso that it can insert JIT hints for compilations that\nare expensive, i.e. hot/scorching compilations or\nmemory/cpu intensive ones.\nThis commit stores whether this information in the client session.\n\nSigned-off-by: Dmitry Ten <Dmitry.Ten@ibm.com>"}, "afterCommit": {"oid": "189f550f400334b6487c627c208e1569ff9d944e", "author": {"user": {"login": "dmitry-ten", "name": "Dmitry Ten"}}, "url": "https://github.com/eclipse-openj9/openj9/commit/189f550f400334b6487c627c208e1569ff9d944e", "committedDate": "2020-12-08T19:44:35Z", "message": "Store client's VM phase in JITServer client session\n\nServer needs to know when client is in startup phase,\nso that it can insert JIT hints for compilations that\nare expensive, i.e. hot/scorching compilations or\nmemory/cpu intensive ones.\nThis commit stores whether this information in the client session.\n\nSigned-off-by: Dmitry Ten <Dmitry.Ten@ibm.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "71a01792f3c757924a1dba0f5ae5b7a7e1e7e4b4", "author": {"user": {"login": "dmitry-ten", "name": "Dmitry Ten"}}, "url": "https://github.com/eclipse-openj9/openj9/commit/71a01792f3c757924a1dba0f5ae5b7a7e1e7e4b4", "committedDate": "2020-12-08T19:47:47Z", "message": "Store client's VM phase in JITServer client session\n\nServer needs to know when client is in startup phase,\nso that it can insert JIT hints for compilations that\nare expensive, i.e. hot/scorching compilations or\nmemory/cpu intensive ones.\nThis commit stores whether this information in the client session.\n\nSigned-off-by: Dmitry Ten <Dmitry.Ten@ibm.com>"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "189f550f400334b6487c627c208e1569ff9d944e", "author": {"user": {"login": "dmitry-ten", "name": "Dmitry Ten"}}, "url": "https://github.com/eclipse-openj9/openj9/commit/189f550f400334b6487c627c208e1569ff9d944e", "committedDate": "2020-12-08T19:44:35Z", "message": "Store client's VM phase in JITServer client session\n\nServer needs to know when client is in startup phase,\nso that it can insert JIT hints for compilations that\nare expensive, i.e. hot/scorching compilations or\nmemory/cpu intensive ones.\nThis commit stores whether this information in the client session.\n\nSigned-off-by: Dmitry Ten <Dmitry.Ten@ibm.com>"}, "afterCommit": {"oid": "71a01792f3c757924a1dba0f5ae5b7a7e1e7e4b4", "author": {"user": {"login": "dmitry-ten", "name": "Dmitry Ten"}}, "url": "https://github.com/eclipse-openj9/openj9/commit/71a01792f3c757924a1dba0f5ae5b7a7e1e7e4b4", "committedDate": "2020-12-08T19:47:47Z", "message": "Store client's VM phase in JITServer client session\n\nServer needs to know when client is in startup phase,\nso that it can insert JIT hints for compilations that\nare expensive, i.e. hot/scorching compilations or\nmemory/cpu intensive ones.\nThis commit stores whether this information in the client session.\n\nSigned-off-by: Dmitry Ten <Dmitry.Ten@ibm.com>"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTQ3NTkwOTcw", "url": "https://github.com/eclipse-openj9/openj9/pull/11392#pullrequestreview-547590970", "createdAt": "2020-12-08T20:10:41Z", "commit": {"oid": "71a01792f3c757924a1dba0f5ae5b7a7e1e7e4b4"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1464, "cost": 1, "resetAt": "2021-10-28T17:48:14Z"}}}