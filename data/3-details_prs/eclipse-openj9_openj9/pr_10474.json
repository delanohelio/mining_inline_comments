{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDc0ODE4NjYy", "number": 10474, "title": "Get target JITServer's CPU before CG object is created", "bodyText": "This is needed so that the codegen is able to set the correct\nflags when initializing.\nSigned-off-by: Dhruv Chopra Dhruv.C.Chopra@ibm.com", "createdAt": "2020-08-27T16:34:42Z", "url": "https://github.com/eclipse-openj9/openj9/pull/10474", "merged": true, "mergeCommit": {"oid": "d3b01bf0e8294d70ed354fbad36ba88f2510234f"}, "closed": true, "closedAt": "2020-09-02T14:31:51Z", "author": {"login": "dchopra001"}, "timelineItems": {"totalCount": 9, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdDDHfHABqjM3MDA0OTY1MTg=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdDFlgZAFqTQ3NzAxODUxNw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "9c5f917d74f2d515bebdd408e19a651d82b18d1f", "author": {"user": {"login": "dchopra001", "name": "Dhruv Chopra"}}, "url": "https://github.com/eclipse-openj9/openj9/commit/9c5f917d74f2d515bebdd408e19a651d82b18d1f", "committedDate": "2020-08-27T16:34:08Z", "message": "Get target JITServer's CPU before CG object is created\n\nThis is needed so that the codegen is able to set the correct\nflags when initializing.\n\nSigned-off-by: Dhruv Chopra <Dhruv.C.Chopra@ibm.com>"}, "afterCommit": {"oid": "dec5738e333a95a270d60eff324927707c6bcf10", "author": {"user": {"login": "dchopra001", "name": "Dhruv Chopra"}}, "url": "https://github.com/eclipse-openj9/openj9/commit/dec5738e333a95a270d60eff324927707c6bcf10", "committedDate": "2020-08-27T16:36:43Z", "message": "Get target JITServer's CPU before CG object is created\n\nThis is needed so that the codegen is able to set the correct\nflags when initializing.\n\nSigned-off-by: Dhruv Chopra <Dhruv.C.Chopra@ibm.com>"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDc2OTAxMjE4", "url": "https://github.com/eclipse-openj9/openj9/pull/10474#pullrequestreview-476901218", "createdAt": "2020-08-27T16:43:29Z", "commit": {"oid": "dec5738e333a95a270d60eff324927707c6bcf10"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yN1QxNjo0MzoyOVrOHIYr2g==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yN1QxNjo0MzoyOVrOHIYr2g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3ODU1NTA5OA==", "bodyText": "if (((TR_J9VMBase *)fe)->isAOT_DEPRECATED_DO_NOT_USE() && TR::Compiler->target.cpu.isX86())\n      _target = TR::Compiler->relocatableTarget;\nI think this needs to be moved out as well (It looks like you already added code outside the constructor but didn't remove it from here)", "url": "https://github.com/eclipse-openj9/openj9/pull/10474#discussion_r478555098", "createdAt": "2020-08-27T16:43:29Z", "author": {"login": "harryyu1994"}, "path": "runtime/compiler/compile/J9Compilation.cpp", "diffHunk": "@@ -183,21 +185,9 @@ J9::Compilation::Compilation(int32_t id,\n #endif /* defined(J9VM_OPT_JITSERVER) */\n    _osrProhibitedOverRangeOfTrees(false)\n    {\n-#if defined(J9VM_OPT_JITSERVER)\n-   // In JITServer, we would like to use JITClient's processor info for the compilation\n-   // The following code effectively replaces the cpu with client's cpu through the getProcessorDescription() that has JITServer support\n-   if (self()->getPersistentInfo()->getRemoteCompilationMode() == JITServer::SERVER)\n+   if (((TR_J9VMBase *)fe)->isAOT_DEPRECATED_DO_NOT_USE() && TR::Compiler->target.cpu.isX86())", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "dec5738e333a95a270d60eff324927707c6bcf10"}, "originalPosition": 28}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "dec5738e333a95a270d60eff324927707c6bcf10", "author": {"user": {"login": "dchopra001", "name": "Dhruv Chopra"}}, "url": "https://github.com/eclipse-openj9/openj9/commit/dec5738e333a95a270d60eff324927707c6bcf10", "committedDate": "2020-08-27T16:36:43Z", "message": "Get target JITServer's CPU before CG object is created\n\nThis is needed so that the codegen is able to set the correct\nflags when initializing.\n\nSigned-off-by: Dhruv Chopra <Dhruv.C.Chopra@ibm.com>"}, "afterCommit": {"oid": "e7c02f3c6e8fc77822ef63d4a1f97866c019ec93", "author": {"user": {"login": "dchopra001", "name": "Dhruv Chopra"}}, "url": "https://github.com/eclipse-openj9/openj9/commit/e7c02f3c6e8fc77822ef63d4a1f97866c019ec93", "committedDate": "2020-08-27T16:50:46Z", "message": "Get target JITServer's CPU before CG object is created\n\nThis is needed so that the codegen is able to set the correct\nflags when initializing.\n\nSigned-off-by: Dhruv Chopra <Dhruv.C.Chopra@ibm.com>"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDc2OTAzNjM4", "url": "https://github.com/eclipse-openj9/openj9/pull/10474#pullrequestreview-476903638", "createdAt": "2020-08-27T16:46:21Z", "commit": {"oid": "dec5738e333a95a270d60eff324927707c6bcf10"}, "state": "COMMENTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yN1QxNjo0NjoyMlrOHIYyxA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yN1QxNjo1NzoxMVrOHIZLdA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3ODU1Njg2OA==", "bodyText": "Here we are ignoring the parameter target and set our own. It may be nicer for the caller to set the parameter to TR::Compiler->relocatableTarget when we have AOT compilations under x86.", "url": "https://github.com/eclipse-openj9/openj9/pull/10474#discussion_r478556868", "createdAt": "2020-08-27T16:46:22Z", "author": {"login": "mpirvu"}, "path": "runtime/compiler/compile/J9Compilation.cpp", "diffHunk": "@@ -183,21 +185,9 @@ J9::Compilation::Compilation(int32_t id,\n #endif /* defined(J9VM_OPT_JITSERVER) */\n    _osrProhibitedOverRangeOfTrees(false)\n    {\n-#if defined(J9VM_OPT_JITSERVER)\n-   // In JITServer, we would like to use JITClient's processor info for the compilation\n-   // The following code effectively replaces the cpu with client's cpu through the getProcessorDescription() that has JITServer support\n-   if (self()->getPersistentInfo()->getRemoteCompilationMode() == JITServer::SERVER)\n+   if (((TR_J9VMBase *)fe)->isAOT_DEPRECATED_DO_NOT_USE() && TR::Compiler->target.cpu.isX86())\n       {\n-      OMRProcessorDesc JITClientProcessorDesc = TR::Compiler->target.cpu.getProcessorDescription();\n-      _target.cpu = TR::CPU(JITClientProcessorDesc);\n-      }\n-   else\n-#endif /* defined(J9VM_OPT_JITSERVER) */\n-      {\n-      if (((TR_J9VMBase *)fe)->isAOT_DEPRECATED_DO_NOT_USE() && TR::Compiler->target.cpu.isX86())\n-         {\n-         _target = TR::Compiler->relocatableTarget;\n-         }\n+      _target = TR::Compiler->relocatableTarget;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "dec5738e333a95a270d60eff324927707c6bcf10"}, "originalPosition": 40}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3ODU2MzE4OA==", "bodyText": "Why is the cast needed? Isn't target a TR::Environment variable?", "url": "https://github.com/eclipse-openj9/openj9/pull/10474#discussion_r478563188", "createdAt": "2020-08-27T16:57:11Z", "author": {"login": "mpirvu"}, "path": "runtime/compiler/control/CompilationThread.cpp", "diffHunk": "@@ -8513,7 +8531,8 @@ TR::CompilationInfoPerThreadBase::wrappedCompile(J9PortLibrary *portLib, void *\n                p->_dispatchRegion,\n                p->trMemory(),\n                p->_optimizationPlan,\n-               reloRuntime);\n+               reloRuntime,\n+               static_cast<TR::Environment *>(&target));", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "e7c02f3c6e8fc77822ef63d4a1f97866c019ec93"}, "originalPosition": 31}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDc2OTUyMjk2", "url": "https://github.com/eclipse-openj9/openj9/pull/10474#pullrequestreview-476952296", "createdAt": "2020-08-27T17:52:12Z", "commit": {"oid": "e7c02f3c6e8fc77822ef63d4a1f97866c019ec93"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "2b4a2d734a9c6c7ca2662af754b30ba44f21d257", "author": {"user": {"login": "dchopra001", "name": "Dhruv Chopra"}}, "url": "https://github.com/eclipse-openj9/openj9/commit/2b4a2d734a9c6c7ca2662af754b30ba44f21d257", "committedDate": "2020-08-27T19:13:59Z", "message": "Get target JITServer's CPU before CG object is created\n\nThis is needed so that the codegen is able to set the correct\nflags when initializing.\n\nSigned-off-by: Dhruv Chopra <Dhruv.C.Chopra@ibm.com>"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "e7c02f3c6e8fc77822ef63d4a1f97866c019ec93", "author": {"user": {"login": "dchopra001", "name": "Dhruv Chopra"}}, "url": "https://github.com/eclipse-openj9/openj9/commit/e7c02f3c6e8fc77822ef63d4a1f97866c019ec93", "committedDate": "2020-08-27T16:50:46Z", "message": "Get target JITServer's CPU before CG object is created\n\nThis is needed so that the codegen is able to set the correct\nflags when initializing.\n\nSigned-off-by: Dhruv Chopra <Dhruv.C.Chopra@ibm.com>"}, "afterCommit": {"oid": "2b4a2d734a9c6c7ca2662af754b30ba44f21d257", "author": {"user": {"login": "dchopra001", "name": "Dhruv Chopra"}}, "url": "https://github.com/eclipse-openj9/openj9/commit/2b4a2d734a9c6c7ca2662af754b30ba44f21d257", "committedDate": "2020-08-27T19:13:59Z", "message": "Get target JITServer's CPU before CG object is created\n\nThis is needed so that the codegen is able to set the correct\nflags when initializing.\n\nSigned-off-by: Dhruv Chopra <Dhruv.C.Chopra@ibm.com>"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDc3MDEwMjc3", "url": "https://github.com/eclipse-openj9/openj9/pull/10474#pullrequestreview-477010277", "createdAt": "2020-08-27T19:16:48Z", "commit": {"oid": "2b4a2d734a9c6c7ca2662af754b30ba44f21d257"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDc3MDE4NTE3", "url": "https://github.com/eclipse-openj9/openj9/pull/10474#pullrequestreview-477018517", "createdAt": "2020-08-27T19:29:30Z", "commit": {"oid": "2b4a2d734a9c6c7ca2662af754b30ba44f21d257"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 251, "cost": 1, "resetAt": "2021-10-28T17:48:14Z"}}}