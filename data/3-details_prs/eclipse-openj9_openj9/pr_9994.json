{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDM4ODU2ODM2", "number": 9994, "title": "Use _NSGetEnviron() on OSX to retrieve environ", "bodyText": "As per: #7247\nDirect access to environ on OSX should use _NSGetEnviron, as environ is only directly accessible via that environment\nsubroutine from shared libraries and bundles since Mac OS X 10.5 (Leopard).\nThis change likely does not fix the crash noted in the issue, but makes access to environ available from shared libraries and bundles.\n\nenviron is a list of strings that is made available when a process begins. Each string has the convention \"name=value\" which is set in the user environment.\nenviron can be directly accessed, except from shared libraries and bundles, since it is only available to the loader ld when a complete program is being linked. The environment routines getenv, setenv and putenv can be used to access environ whether referenced by the loader or in shared libraries and bundles. If direct access to environ is needed in shared libraries or bundles for OSX, _NSGetEnviron (defined in crt_externs.h) can be used to retrieve environ at runtime.\nSource: https://opensource.apple.com/source/Libc/Libc-1353.41.1/man/FreeBSD/environ.7.auto.html\nSome other info: https://www.gnu.org/software/gnulib/manual/gnulib.html#environ\ncrt_externs.h: https://opensource.apple.com/source/Libc/Libc-1353.41.1/sys/crt_externs.c.auto.html", "createdAt": "2020-06-23T22:28:01Z", "url": "https://github.com/eclipse-openj9/openj9/pull/9994", "merged": true, "mergeCommit": {"oid": "0606174bd898b28531f89460c57411072c3b29da"}, "closed": true, "closedAt": "2020-06-24T14:03:28Z", "author": {"login": "sharon-wang"}, "timelineItems": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcuOhsGAFqTQzNjIzODE3NQ==", "endCursor": "Y3Vyc29yOnYyOpPPAAABcuaemMgFqTQzNjY3MjU2NQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDM2MjM4MTc1", "url": "https://github.com/eclipse-openj9/openj9/pull/9994#pullrequestreview-436238175", "createdAt": "2020-06-24T00:02:03Z", "commit": {"oid": "5520232b6302671cfffaa55c0cfc6eae452daedc"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yNFQwMDowMjowM1rOGn-h9Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yNFQwMDowMjowM1rOGn-h9Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NDU3MjE0OQ==", "bodyText": "Bit of a nitpick - usually we label the else as well\n\n  \n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            #else\n          \n          \n            \n            #else /* defined(OSX) */", "url": "https://github.com/eclipse-openj9/openj9/pull/9994#discussion_r444572149", "createdAt": "2020-06-24T00:02:03Z", "author": {"login": "DanHeidinga"}, "path": "runtime/vm/rasdump.c", "diffHunk": "@@ -289,7 +293,12 @@ configureRasDump(J9JavaVM *vm)\n void\n J9RASInitialize(J9JavaVM* javaVM)\n {\n+#if defined(OSX)\n+\tchar **environ = *_NSGetEnviron();\n+#else", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "5520232b6302671cfffaa55c0cfc6eae452daedc"}, "originalPosition": 17}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "d07d9e01520a87a4877db427a921a5ad58e5c369", "author": {"user": {"login": "sharon-wang", "name": "Sharon Wang"}}, "url": "https://github.com/eclipse-openj9/openj9/commit/d07d9e01520a87a4877db427a921a5ad58e5c369", "committedDate": "2020-06-24T01:44:16Z", "message": "Use _NSGetEnviron() on OSX to retrieve environ\n\nDirect access to `environ` on OSX should use _NSGetEnviron(), as\n`environ` is only directly accessible via that environment\nsubroutine from shared libraries and bundles.\n\n---\n\n`environ` is a list of strings that is made available when a\nprocess begins. Each string has the convention \"name=value\" which\nis set in the user environment.\n\n`environ` can be directly accessed, except from shared libraries\nand bundles, since it is only available to the loader `ld` when a\ncomplete program is being linked. The environment routines\n`getenv`, `setenv` and `putenv` can be used to access `environ`\nwhether referenced by the loader or in shared libraries and\nbundles. If direct access to `environ` is needed in shared\nlibraries or bundles for OSX, `_NSGetEnviron` (defined in\n`crt_externs.h`) can be used to retrieve `environ` at runtime.\n\nSource: https://opensource.apple.com/source/Libc/Libc-1353.41.1/man/FreeBSD/environ.7.auto.html\n\nSigned-off-by: Sharon Wang <sharon-wang-cpsc@outlook.com>"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "5520232b6302671cfffaa55c0cfc6eae452daedc", "author": {"user": {"login": "sharon-wang", "name": "Sharon Wang"}}, "url": "https://github.com/eclipse-openj9/openj9/commit/5520232b6302671cfffaa55c0cfc6eae452daedc", "committedDate": "2020-06-23T19:31:53Z", "message": "Use _NSGetEnviron() on OSX to retrieve environ\n\nDirect access to `environ` on OSX should use _NSGetEnviron(), as\n`environ` is only directly accessible via that environment\nsubroutine from shared libraries and bundles.\n\n---\n\n`environ` is a list of strings that is made available when a\nprocess begins. Each string has the convention \"name=value\" which\nis set in the user environment.\n\n`environ` can be directly accessed, except from shared libraries\nand bundles, since it is only available to the loader `ld` when a\ncomplete program is being linked. The environment routines\n`getenv`, `setenv` and `putenv` can be used to access `environ`\nwhether referenced by the loader or in shared libraries and\nbundles. If direct access to `environ` is needed in shared\nlibraries or bundles for OSX, `_NSGetEnviron` (defined in\n`crt_externs.h`) can be used to retrieve `environ` at runtime.\n\nSource: https://opensource.apple.com/source/Libc/Libc-1353.41.1/man/FreeBSD/environ.7.auto.html\n\nSigned-off-by: Sharon Wang <sharon-wang-cpsc@outlook.com>"}, "afterCommit": {"oid": "d07d9e01520a87a4877db427a921a5ad58e5c369", "author": {"user": {"login": "sharon-wang", "name": "Sharon Wang"}}, "url": "https://github.com/eclipse-openj9/openj9/commit/d07d9e01520a87a4877db427a921a5ad58e5c369", "committedDate": "2020-06-24T01:44:16Z", "message": "Use _NSGetEnviron() on OSX to retrieve environ\n\nDirect access to `environ` on OSX should use _NSGetEnviron(), as\n`environ` is only directly accessible via that environment\nsubroutine from shared libraries and bundles.\n\n---\n\n`environ` is a list of strings that is made available when a\nprocess begins. Each string has the convention \"name=value\" which\nis set in the user environment.\n\n`environ` can be directly accessed, except from shared libraries\nand bundles, since it is only available to the loader `ld` when a\ncomplete program is being linked. The environment routines\n`getenv`, `setenv` and `putenv` can be used to access `environ`\nwhether referenced by the loader or in shared libraries and\nbundles. If direct access to `environ` is needed in shared\nlibraries or bundles for OSX, `_NSGetEnviron` (defined in\n`crt_externs.h`) can be used to retrieve `environ` at runtime.\n\nSource: https://opensource.apple.com/source/Libc/Libc-1353.41.1/man/FreeBSD/environ.7.auto.html\n\nSigned-off-by: Sharon Wang <sharon-wang-cpsc@outlook.com>"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDM2NjcyNTY1", "url": "https://github.com/eclipse-openj9/openj9/pull/9994#pullrequestreview-436672565", "createdAt": "2020-06-24T13:57:33Z", "commit": {"oid": "d07d9e01520a87a4877db427a921a5ad58e5c369"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 602, "cost": 1, "resetAt": "2021-10-28T17:48:14Z"}}}