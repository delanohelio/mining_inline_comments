{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDQyMjU2Njg0", "number": 10061, "title": "Add native stubs for vector API support", "bodyText": "Add native stubs for vector API support\nSigned-off-by: Tobi Ajila atobia@ca.ibm.com", "createdAt": "2020-06-30T19:48:06Z", "url": "https://github.com/eclipse-openj9/openj9/pull/10061", "merged": true, "mergeCommit": {"oid": "cfa18decfbed3ffec1aa6e2cd89df02f1c448c04"}, "closed": true, "closedAt": "2020-11-27T20:41:56Z", "author": {"login": "tajila"}, "timelineItems": {"totalCount": 11, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdJ3_cnABqjM3ODAwMjA2Nzg=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdgp4SYABqjQwNDY2ODk5NDY=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "6f845178d0778e2eca57a1f36fe33162695f9263", "author": {"user": {"login": "tajila", "name": "Tobi"}}, "url": "https://github.com/eclipse-openj9/openj9/commit/6f845178d0778e2eca57a1f36fe33162695f9263", "committedDate": "2020-06-30T19:35:43Z", "message": "Add native stubs for vector API support\n\nSigned-off-by: Tobi Ajila <atobia@ca.ibm.com>"}, "afterCommit": {"oid": "a58e49e2b34214426ea7bc62dcf110ccff595f31", "author": {"user": {"login": "tajila", "name": "Tobi"}}, "url": "https://github.com/eclipse-openj9/openj9/commit/a58e49e2b34214426ea7bc62dcf110ccff595f31", "committedDate": "2020-09-17T21:36:22Z", "message": "Add native stubs for vector API support\n\nSigned-off-by: Tobi Ajila <atobia@ca.ibm.com>"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "a58e49e2b34214426ea7bc62dcf110ccff595f31", "author": {"user": {"login": "tajila", "name": "Tobi"}}, "url": "https://github.com/eclipse-openj9/openj9/commit/a58e49e2b34214426ea7bc62dcf110ccff595f31", "committedDate": "2020-09-17T21:36:22Z", "message": "Add native stubs for vector API support\n\nSigned-off-by: Tobi Ajila <atobia@ca.ibm.com>"}, "afterCommit": {"oid": "001f78b8746dec66bf6b563e6e5f48d482523799", "author": {"user": {"login": "tajila", "name": "Tobi"}}, "url": "https://github.com/eclipse-openj9/openj9/commit/001f78b8746dec66bf6b563e6e5f48d482523799", "committedDate": "2020-09-17T21:50:41Z", "message": "Add native stubs for vector API support\n\nSigned-off-by: Tobi Ajila <atobia@ca.ibm.com>"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "001f78b8746dec66bf6b563e6e5f48d482523799", "author": {"user": {"login": "tajila", "name": "Tobi"}}, "url": "https://github.com/eclipse-openj9/openj9/commit/001f78b8746dec66bf6b563e6e5f48d482523799", "committedDate": "2020-09-17T21:50:41Z", "message": "Add native stubs for vector API support\n\nSigned-off-by: Tobi Ajila <atobia@ca.ibm.com>"}, "afterCommit": {"oid": "58af7d3b922f9025dd39357473e85ea3e0242bec", "author": {"user": {"login": "tajila", "name": "Tobi"}}, "url": "https://github.com/eclipse-openj9/openj9/commit/58af7d3b922f9025dd39357473e85ea3e0242bec", "committedDate": "2020-11-26T20:42:44Z", "message": "Add native stubs for vector API support\n\nSigned-off-by: Tobi Ajila <atobia@ca.ibm.com>"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "58af7d3b922f9025dd39357473e85ea3e0242bec", "author": {"user": {"login": "tajila", "name": "Tobi"}}, "url": "https://github.com/eclipse-openj9/openj9/commit/58af7d3b922f9025dd39357473e85ea3e0242bec", "committedDate": "2020-11-26T20:42:44Z", "message": "Add native stubs for vector API support\n\nSigned-off-by: Tobi Ajila <atobia@ca.ibm.com>"}, "afterCommit": {"oid": "11adc28b2fa7abd153ec6d92dfecd2b8edb19ba9", "author": {"user": {"login": "tajila", "name": "Tobi"}}, "url": "https://github.com/eclipse-openj9/openj9/commit/11adc28b2fa7abd153ec6d92dfecd2b8edb19ba9", "committedDate": "2020-11-26T20:46:04Z", "message": "Add native stubs for vector API support\n\nSigned-off-by: Tobi Ajila <atobia@ca.ibm.com>"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "11adc28b2fa7abd153ec6d92dfecd2b8edb19ba9", "author": {"user": {"login": "tajila", "name": "Tobi"}}, "url": "https://github.com/eclipse-openj9/openj9/commit/11adc28b2fa7abd153ec6d92dfecd2b8edb19ba9", "committedDate": "2020-11-26T20:46:04Z", "message": "Add native stubs for vector API support\n\nSigned-off-by: Tobi Ajila <atobia@ca.ibm.com>"}, "afterCommit": {"oid": "1536f340d30edeac2c603d2366ccc964ce65563b", "author": {"user": {"login": "tajila", "name": "Tobi"}}, "url": "https://github.com/eclipse-openj9/openj9/commit/1536f340d30edeac2c603d2366ccc964ce65563b", "committedDate": "2020-11-26T20:48:58Z", "message": "Add native stubs for vector API support\n\nSigned-off-by: Tobi Ajila <atobia@ca.ibm.com>"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTM5NTU1NzY4", "url": "https://github.com/eclipse-openj9/openj9/pull/10061#pullrequestreview-539555768", "createdAt": "2020-11-26T21:34:54Z", "commit": {"oid": "1536f340d30edeac2c603d2366ccc964ce65563b"}, "state": "COMMENTED", "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0yNlQyMTozNDo1NFrOH6nvOQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0yNlQyMTozODoxNVrOH6nyIg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMTIzMDUyMQ==", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n             * Copyright (c) 1998, 2020 IBM Corp. and others\n          \n          \n            \n             * Copyright (c) 2020, 2020 IBM Corp. and others", "url": "https://github.com/eclipse-openj9/openj9/pull/10061#discussion_r531230521", "createdAt": "2020-11-26T21:34:54Z", "author": {"login": "DanHeidinga"}, "path": "runtime/jcl/common/vectornatives.cpp", "diffHunk": "@@ -0,0 +1,73 @@\n+/*******************************************************************************\n+ * Copyright (c) 1998, 2020 IBM Corp. and others", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "1536f340d30edeac2c603d2366ccc964ce65563b"}, "originalPosition": 2}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMTIzMTA4NA==", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            \t\tJ9Class *elementType = J9VMJAVALANGCLASS_VMREF(currentThread, classObj);\n          \n          \n            \n            \t\tJ9Class *elementType = J9VM_J9CLASS_FROM_HEAPCLASS(currentThread, classObj);", "url": "https://github.com/eclipse-openj9/openj9/pull/10061#discussion_r531231084", "createdAt": "2020-11-26T21:37:16Z", "author": {"login": "DanHeidinga"}, "path": "runtime/jcl/common/vectornatives.cpp", "diffHunk": "@@ -0,0 +1,73 @@\n+/*******************************************************************************\n+ * Copyright (c) 1998, 2020 IBM Corp. and others\n+ *\n+ * This program and the accompanying materials are made available under\n+ * the terms of the Eclipse Public License 2.0 which accompanies this\n+ * distribution and is available at https://www.eclipse.org/legal/epl-2.0/\n+ * or the Apache License, Version 2.0 which accompanies this distribution and\n+ * is available at https://www.apache.org/licenses/LICENSE-2.0.\n+ *\n+ * This Source Code may also be made available under the following\n+ * Secondary Licenses when the conditions for such availability set\n+ * forth in the Eclipse Public License, v. 2.0 are satisfied: GNU\n+ * General Public License, version 2 with the GNU Classpath\n+ * Exception [1] and GNU General Public License, version 2 with the\n+ * OpenJDK Assembly Exception [2].\n+ *\n+ * [1] https://www.gnu.org/software/classpath/license.html\n+ * [2] http://openjdk.java.net/legal/assembly-exception.html\n+ *\n+ * SPDX-License-Identifier: EPL-2.0 OR Apache-2.0 OR GPL-2.0 WITH Classpath-exception-2.0 OR LicenseRef-GPL-2.0 WITH Assembly-exception\n+ *******************************************************************************/\n+#include \"j9.h\"\n+#include \"jclprots.h\"\n+#include \"j9protos.h\"\n+\n+/* TODO this will be replaced by a call that can determine\n+ * the correct size on each platform\n+ */\n+#define MAX_VECTOR_REGISTER_SIZE 128\n+\n+extern \"C\" {\n+\n+jint JNICALL\n+Java_jdk_internal_vm_vector_VectorSupport_registerNatives(JNIEnv *env, jclass clazz)\n+{\n+\treturn 0;\n+}\n+\n+jint JNICALL\n+Java_jdk_internal_vm_vector_VectorSupport_getMaxLaneCount(JNIEnv *env, jclass clazz, jclass elementType)\n+{\n+\tJ9VMThread *currentThread = (J9VMThread *) env;\n+\tJ9JavaVM *vm = currentThread->javaVM;\n+\tJ9InternalVMFunctions *vmFuncs = vm->internalVMFunctions;\n+\tjint laneCount = 0;\n+\n+\tvmFuncs->internalEnterVMFromJNI(currentThread);\n+\tj9object_t classObj = J9_JNI_UNWRAP_REFERENCE(elementType);\n+\tif (NULL == classObj) {\n+\t\tvmFuncs->setCurrentException(currentThread, J9VMCONSTANTPOOL_JAVALANGNULLPOINTEREXCEPTION, NULL);\n+\t} else {\n+\t\tJ9Class *elementType = J9VMJAVALANGCLASS_VMREF(currentThread, classObj);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "1536f340d30edeac2c603d2366ccc964ce65563b"}, "originalPosition": 52}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMTIzMTI2Ng==", "bodyText": "Should char be supported here?", "url": "https://github.com/eclipse-openj9/openj9/pull/10061#discussion_r531231266", "createdAt": "2020-11-26T21:38:15Z", "author": {"login": "DanHeidinga"}, "path": "runtime/jcl/common/vectornatives.cpp", "diffHunk": "@@ -0,0 +1,73 @@\n+/*******************************************************************************\n+ * Copyright (c) 1998, 2020 IBM Corp. and others\n+ *\n+ * This program and the accompanying materials are made available under\n+ * the terms of the Eclipse Public License 2.0 which accompanies this\n+ * distribution and is available at https://www.eclipse.org/legal/epl-2.0/\n+ * or the Apache License, Version 2.0 which accompanies this distribution and\n+ * is available at https://www.apache.org/licenses/LICENSE-2.0.\n+ *\n+ * This Source Code may also be made available under the following\n+ * Secondary Licenses when the conditions for such availability set\n+ * forth in the Eclipse Public License, v. 2.0 are satisfied: GNU\n+ * General Public License, version 2 with the GNU Classpath\n+ * Exception [1] and GNU General Public License, version 2 with the\n+ * OpenJDK Assembly Exception [2].\n+ *\n+ * [1] https://www.gnu.org/software/classpath/license.html\n+ * [2] http://openjdk.java.net/legal/assembly-exception.html\n+ *\n+ * SPDX-License-Identifier: EPL-2.0 OR Apache-2.0 OR GPL-2.0 WITH Classpath-exception-2.0 OR LicenseRef-GPL-2.0 WITH Assembly-exception\n+ *******************************************************************************/\n+#include \"j9.h\"\n+#include \"jclprots.h\"\n+#include \"j9protos.h\"\n+\n+/* TODO this will be replaced by a call that can determine\n+ * the correct size on each platform\n+ */\n+#define MAX_VECTOR_REGISTER_SIZE 128\n+\n+extern \"C\" {\n+\n+jint JNICALL\n+Java_jdk_internal_vm_vector_VectorSupport_registerNatives(JNIEnv *env, jclass clazz)\n+{\n+\treturn 0;\n+}\n+\n+jint JNICALL\n+Java_jdk_internal_vm_vector_VectorSupport_getMaxLaneCount(JNIEnv *env, jclass clazz, jclass elementType)\n+{\n+\tJ9VMThread *currentThread = (J9VMThread *) env;\n+\tJ9JavaVM *vm = currentThread->javaVM;\n+\tJ9InternalVMFunctions *vmFuncs = vm->internalVMFunctions;\n+\tjint laneCount = 0;\n+\n+\tvmFuncs->internalEnterVMFromJNI(currentThread);\n+\tj9object_t classObj = J9_JNI_UNWRAP_REFERENCE(elementType);\n+\tif (NULL == classObj) {\n+\t\tvmFuncs->setCurrentException(currentThread, J9VMCONSTANTPOOL_JAVALANGNULLPOINTEREXCEPTION, NULL);\n+\t} else {\n+\t\tJ9Class *elementType = J9VMJAVALANGCLASS_VMREF(currentThread, classObj);\n+\n+\t\tif (elementType == vm->byteReflectClass) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "1536f340d30edeac2c603d2366ccc964ce65563b"}, "originalPosition": 54}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "1536f340d30edeac2c603d2366ccc964ce65563b", "author": {"user": {"login": "tajila", "name": "Tobi"}}, "url": "https://github.com/eclipse-openj9/openj9/commit/1536f340d30edeac2c603d2366ccc964ce65563b", "committedDate": "2020-11-26T20:48:58Z", "message": "Add native stubs for vector API support\n\nSigned-off-by: Tobi Ajila <atobia@ca.ibm.com>"}, "afterCommit": {"oid": "be3357a70aa2b60fabd6482bb2185b5838dce838", "author": {"user": {"login": "tajila", "name": "Tobi"}}, "url": "https://github.com/eclipse-openj9/openj9/commit/be3357a70aa2b60fabd6482bb2185b5838dce838", "committedDate": "2020-11-26T21:45:20Z", "message": "Add native stubs for vector API support\n\nSigned-off-by: Tobi Ajila <atobia@ca.ibm.com>"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTM5NjgzMDc2", "url": "https://github.com/eclipse-openj9/openj9/pull/10061#pullrequestreview-539683076", "createdAt": "2020-11-27T03:02:58Z", "commit": {"oid": "be3357a70aa2b60fabd6482bb2185b5838dce838"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTM5Njg0MzY0", "url": "https://github.com/eclipse-openj9/openj9/pull/10061#pullrequestreview-539684364", "createdAt": "2020-11-27T03:08:20Z", "commit": {"oid": "be3357a70aa2b60fabd6482bb2185b5838dce838"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0yN1QwMzowODoyMFrOH6vr1A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0yN1QwMzowODoyMFrOH6vr1A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMTM2MDcyNA==", "bodyText": "Actually, this might need to be only included on jdk16+.  Maybe use similar code to the jdk9+ example below in the file:\n# We'd like to use GREATER_EQUAL here (and below), but that operator requires\n# cmake version 3.7 or better; the minimum version we require is 3.4.\t# cmake version 3.7 or better; the minimum version we require is 3.4.\nif(NOT JAVA_SPEC_VERSION LESS 16)\n\t# sources for Java 16+\n\ttarget_sources(jclse\n\t\tPRIVATE\n\t\t\t${CMAKE_CURRENT_SOURCE_DIR}/common/java_lang_invoke_VarHandle.c\n\t\t\t${CMAKE_CURRENT_SOURCE_DIR}/common/java_lang_StackWalker.cpp\n\t)\nendif()\n\n@dnakamura do you have a better suggestion for how to handle a jdk16+ only source file?", "url": "https://github.com/eclipse-openj9/openj9/pull/10061#discussion_r531360724", "createdAt": "2020-11-27T03:08:20Z", "author": {"login": "DanHeidinga"}, "path": "runtime/jcl/CMakeLists.txt", "diffHunk": "@@ -157,6 +157,7 @@ target_sources(jclse\n \t\t${CMAKE_CURRENT_SOURCE_DIR}/common/system.c\n \t\t${CMAKE_CURRENT_SOURCE_DIR}/common/thread.cpp\n \t\t${CMAKE_CURRENT_SOURCE_DIR}/common/unsafe_mem.c\n+\t\t${CMAKE_CURRENT_SOURCE_DIR}/common/vectornatives.cpp", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "be3357a70aa2b60fabd6482bb2185b5838dce838"}, "originalPosition": 4}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "cc17240db5f376d9a435ffa058f98ba9c690caf7", "author": {"user": {"login": "tajila", "name": "Tobi"}}, "url": "https://github.com/eclipse-openj9/openj9/commit/cc17240db5f376d9a435ffa058f98ba9c690caf7", "committedDate": "2020-11-27T16:10:09Z", "message": "Add native stubs for vector API support\n\nSigned-off-by: Tobi Ajila <atobia@ca.ibm.com>"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "be3357a70aa2b60fabd6482bb2185b5838dce838", "author": {"user": {"login": "tajila", "name": "Tobi"}}, "url": "https://github.com/eclipse-openj9/openj9/commit/be3357a70aa2b60fabd6482bb2185b5838dce838", "committedDate": "2020-11-26T21:45:20Z", "message": "Add native stubs for vector API support\n\nSigned-off-by: Tobi Ajila <atobia@ca.ibm.com>"}, "afterCommit": {"oid": "cc17240db5f376d9a435ffa058f98ba9c690caf7", "author": {"user": {"login": "tajila", "name": "Tobi"}}, "url": "https://github.com/eclipse-openj9/openj9/commit/cc17240db5f376d9a435ffa058f98ba9c690caf7", "committedDate": "2020-11-27T16:10:09Z", "message": "Add native stubs for vector API support\n\nSigned-off-by: Tobi Ajila <atobia@ca.ibm.com>"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 484, "cost": 1, "resetAt": "2021-10-28T17:48:14Z"}}}