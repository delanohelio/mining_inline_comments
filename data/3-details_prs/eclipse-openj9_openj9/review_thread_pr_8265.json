{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0MzYxMTQ2ODY0", "number": 8265, "reviewThreads": {"totalCount": 8, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xOVQyMTo1OTozMFrODhPMkg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yMFQxNzoxMzowMVrODhm-Tw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjM2MTc4NTc4OnYy", "diffSide": "RIGHT", "path": "runtime/jcl/common/mgmtosext.c", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xOVQyMTo1OTozMFrOFr5MAg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yMFQxNTowMzozMVrOFsW2Zw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MTU3MDA1MA==", "bodyText": "This variable should be initialized.", "url": "https://github.com/eclipse-openj9/openj9/pull/8265#discussion_r381570050", "createdAt": "2020-02-19T21:59:30Z", "author": {"login": "pshipton"}, "path": "runtime/jcl/common/mgmtosext.c", "diffHunk": "@@ -79,6 +79,32 @@ Java_com_ibm_lang_management_internal_ExtendedOperatingSystemMXBeanImpl_getProce\n \treturn (0 == rc)? (jlong) size: (jlong) -1;\n }\n \n+jdouble JNICALL\n+Java_com_ibm_lang_management_internal_ExtendedOperatingSystemMXBeanImpl_getSystemCpuLoadImpl(JNIEnv *env, jobject instance) {\n+\tPORT_ACCESS_FROM_ENV(env);\n+\tdouble cpuLoad;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "1748d2fab82fd236c71ab5785cb520e1cfc59fb9"}, "originalPosition": 14}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MjA1NjAzOQ==", "bodyText": "Fixed in e200fcd", "url": "https://github.com/eclipse-openj9/openj9/pull/8265#discussion_r382056039", "createdAt": "2020-02-20T15:03:31Z", "author": {"login": "fjeremic"}, "path": "runtime/jcl/common/mgmtosext.c", "diffHunk": "@@ -79,6 +79,32 @@ Java_com_ibm_lang_management_internal_ExtendedOperatingSystemMXBeanImpl_getProce\n \treturn (0 == rc)? (jlong) size: (jlong) -1;\n }\n \n+jdouble JNICALL\n+Java_com_ibm_lang_management_internal_ExtendedOperatingSystemMXBeanImpl_getSystemCpuLoadImpl(JNIEnv *env, jobject instance) {\n+\tPORT_ACCESS_FROM_ENV(env);\n+\tdouble cpuLoad;", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MTU3MDA1MA=="}, "originalCommit": {"oid": "1748d2fab82fd236c71ab5785cb520e1cfc59fb9"}, "originalPosition": 14}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjM2MTgxMDA1OnYy", "diffSide": "RIGHT", "path": "runtime/oti/j9port_generated.h", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xOVQyMjowODoyMlrOFr5b7A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yMFQxNTowMzoyOFrOFsW2PQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MTU3NDEyNA==", "bodyText": "I don't see why this is needed, the code could call omrsysinfo directly. I assume the existing macros were added to avoid having to change all the OpenJ9 code to call omr. Perhaps subsequent changes have followed the same pattern for no reason, but it would be clearer to call omr directly for anything new.", "url": "https://github.com/eclipse-openj9/openj9/pull/8265#discussion_r381574124", "createdAt": "2020-02-19T22:08:22Z", "author": {"login": "pshipton"}, "path": "runtime/oti/j9port_generated.h", "diffHunk": "@@ -620,6 +620,7 @@ extern J9_CFUNC int32_t j9port_isCompatible(struct J9PortLibraryVersion *expecte\n #define j9sysinfo_get_groupname(param1,param2) OMRPORT_FROM_J9PORT(privatePortLibrary)->sysinfo_get_groupname(OMRPORT_FROM_J9PORT(privatePortLibrary),param1,param2)\n #define j9sysinfo_get_load_average(param1) OMRPORT_FROM_J9PORT(privatePortLibrary)->sysinfo_get_load_average(OMRPORT_FROM_J9PORT(privatePortLibrary),param1)\n #define j9sysinfo_get_CPU_utilization(param1) OMRPORT_FROM_J9PORT(privatePortLibrary)->sysinfo_get_CPU_utilization(OMRPORT_FROM_J9PORT(privatePortLibrary),param1)\n+#define j9sysinfo_get_CPU_load(param1) OMRPORT_FROM_J9PORT(privatePortLibrary)->sysinfo_get_CPU_load(OMRPORT_FROM_J9PORT(privatePortLibrary),param1)", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "1748d2fab82fd236c71ab5785cb520e1cfc59fb9"}, "originalPosition": 11}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MjA1NTk5Nw==", "bodyText": "I agree. I wondered that myself. Fixed in e200fcd", "url": "https://github.com/eclipse-openj9/openj9/pull/8265#discussion_r382055997", "createdAt": "2020-02-20T15:03:28Z", "author": {"login": "fjeremic"}, "path": "runtime/oti/j9port_generated.h", "diffHunk": "@@ -620,6 +620,7 @@ extern J9_CFUNC int32_t j9port_isCompatible(struct J9PortLibraryVersion *expecte\n #define j9sysinfo_get_groupname(param1,param2) OMRPORT_FROM_J9PORT(privatePortLibrary)->sysinfo_get_groupname(OMRPORT_FROM_J9PORT(privatePortLibrary),param1,param2)\n #define j9sysinfo_get_load_average(param1) OMRPORT_FROM_J9PORT(privatePortLibrary)->sysinfo_get_load_average(OMRPORT_FROM_J9PORT(privatePortLibrary),param1)\n #define j9sysinfo_get_CPU_utilization(param1) OMRPORT_FROM_J9PORT(privatePortLibrary)->sysinfo_get_CPU_utilization(OMRPORT_FROM_J9PORT(privatePortLibrary),param1)\n+#define j9sysinfo_get_CPU_load(param1) OMRPORT_FROM_J9PORT(privatePortLibrary)->sysinfo_get_CPU_load(OMRPORT_FROM_J9PORT(privatePortLibrary),param1)", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MTU3NDEyNA=="}, "originalCommit": {"oid": "1748d2fab82fd236c71ab5785cb520e1cfc59fb9"}, "originalPosition": 11}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjM2NTYzMzYxOnYy", "diffSide": "RIGHT", "path": "runtime/jcl/common/mgmtosext.c", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yMFQxNjo1OToyMFrOFsbeEg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yMFQxNzowNzoxM1rOFsbv8w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MjEzMTczMA==", "bodyText": "should be PORTLIB, I think portLibrary won't be defined.", "url": "https://github.com/eclipse-openj9/openj9/pull/8265#discussion_r382131730", "createdAt": "2020-02-20T16:59:20Z", "author": {"login": "rwy0717"}, "path": "runtime/jcl/common/mgmtosext.c", "diffHunk": "@@ -79,6 +79,33 @@ Java_com_ibm_lang_management_internal_ExtendedOperatingSystemMXBeanImpl_getProce\n \treturn (0 == rc)? (jlong) size: (jlong) -1;\n }\n \n+jdouble JNICALL\n+Java_com_ibm_lang_management_internal_ExtendedOperatingSystemMXBeanImpl_getSystemCpuLoadImpl(JNIEnv *env, jobject instance) {\n+\tPORT_ACCESS_FROM_ENV(env);\n+   OMRPORT_ACCESS_FROM_J9PORT(portLibrary);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "65fb41926e591fa183c419a8e3e09fcaa56b5140"}, "originalPosition": 14}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MjEzNjMwNw==", "bodyText": "Fixed in e200fcd", "url": "https://github.com/eclipse-openj9/openj9/pull/8265#discussion_r382136307", "createdAt": "2020-02-20T17:07:13Z", "author": {"login": "fjeremic"}, "path": "runtime/jcl/common/mgmtosext.c", "diffHunk": "@@ -79,6 +79,33 @@ Java_com_ibm_lang_management_internal_ExtendedOperatingSystemMXBeanImpl_getProce\n \treturn (0 == rc)? (jlong) size: (jlong) -1;\n }\n \n+jdouble JNICALL\n+Java_com_ibm_lang_management_internal_ExtendedOperatingSystemMXBeanImpl_getSystemCpuLoadImpl(JNIEnv *env, jobject instance) {\n+\tPORT_ACCESS_FROM_ENV(env);\n+   OMRPORT_ACCESS_FROM_J9PORT(portLibrary);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MjEzMTczMA=="}, "originalCommit": {"oid": "65fb41926e591fa183c419a8e3e09fcaa56b5140"}, "originalPosition": 14}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjM2NTY2NTQyOnYy", "diffSide": "RIGHT", "path": "jcl/src/jdk.management/share/classes/com/ibm/lang/management/internal/ExtendedOperatingSystemMXBeanImpl.java", "isResolved": true, "comments": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yMFQxNzowODoxNlrOFsbyLg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yNVQwMDo1NTowOFrOFt1Ntw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MjEzNjg3OA==", "bodyText": "This method can be static.", "url": "https://github.com/eclipse-openj9/openj9/pull/8265#discussion_r382136878", "createdAt": "2020-02-20T17:08:16Z", "author": {"login": "keithc-ca"}, "path": "jcl/src/jdk.management/share/classes/com/ibm/lang/management/internal/ExtendedOperatingSystemMXBeanImpl.java", "diffHunk": "@@ -426,9 +424,11 @@ public final long getProcessVirtualMemorySize() {\n \t */\n \t@Override\n \tpublic final double getSystemCpuLoad() {\n-\t\treturn cpuUtilizationHelper.getSystemCpuLoad();\n+\t\treturn this.getSystemCpuLoadImpl();\n \t}\n \n+\tprivate native double getSystemCpuLoadImpl();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "e200fcd0089727bb8c11ffa2d51bc48880865951"}, "originalPosition": 25}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MjE1ODkxOA==", "bodyText": "The reason this was not done was to remain consistent with the other APIs within this same class. For example, by the same logic the following APIs could be made static as well:\nhttps://github.com/eclipse/openj9/blob/0ae4f22e2d7769fb2796382ef2b33bcacb749ff2/jcl/src/jdk.management/share/classes/com/ibm/lang/management/internal/ExtendedOperatingSystemMXBeanImpl.java#L338\nhttps://github.com/eclipse/openj9/blob/0ae4f22e2d7769fb2796382ef2b33bcacb749ff2/jcl/src/jdk.management/share/classes/com/ibm/lang/management/internal/ExtendedOperatingSystemMXBeanImpl.java#L353\nhttps://github.com/eclipse/openj9/blob/0ae4f22e2d7769fb2796382ef2b33bcacb749ff2/jcl/src/jdk.management/share/classes/com/ibm/lang/management/internal/ExtendedOperatingSystemMXBeanImpl.java#L391\nhttps://github.com/eclipse/openj9/blob/0ae4f22e2d7769fb2796382ef2b33bcacb749ff2/jcl/src/jdk.management/share/classes/com/ibm/lang/management/internal/ExtendedOperatingSystemMXBeanImpl.java#L422\netc. (there are dozens more). As such making this new API static would be inconsistent with the others. Would it be reasonable to not deviate from these other similar APIs, and instead open up an issue to bulk-change them all to be static?", "url": "https://github.com/eclipse-openj9/openj9/pull/8265#discussion_r382158918", "createdAt": "2020-02-20T17:48:58Z", "author": {"login": "fjeremic"}, "path": "jcl/src/jdk.management/share/classes/com/ibm/lang/management/internal/ExtendedOperatingSystemMXBeanImpl.java", "diffHunk": "@@ -426,9 +424,11 @@ public final long getProcessVirtualMemorySize() {\n \t */\n \t@Override\n \tpublic final double getSystemCpuLoad() {\n-\t\treturn cpuUtilizationHelper.getSystemCpuLoad();\n+\t\treturn this.getSystemCpuLoadImpl();\n \t}\n \n+\tprivate native double getSystemCpuLoadImpl();", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MjEzNjg3OA=="}, "originalCommit": {"oid": "e200fcd0089727bb8c11ffa2d51bc48880865951"}, "originalPosition": 25}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MzQyNTEwMQ==", "bodyText": "I'm fine with following the pattern and opening an issue to clean up later (unless a static native is more expensive than a non-static one).", "url": "https://github.com/eclipse-openj9/openj9/pull/8265#discussion_r383425101", "createdAt": "2020-02-24T18:04:54Z", "author": {"login": "keithc-ca"}, "path": "jcl/src/jdk.management/share/classes/com/ibm/lang/management/internal/ExtendedOperatingSystemMXBeanImpl.java", "diffHunk": "@@ -426,9 +424,11 @@ public final long getProcessVirtualMemorySize() {\n \t */\n \t@Override\n \tpublic final double getSystemCpuLoad() {\n-\t\treturn cpuUtilizationHelper.getSystemCpuLoad();\n+\t\treturn this.getSystemCpuLoadImpl();\n \t}\n \n+\tprivate native double getSystemCpuLoadImpl();", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MjEzNjg3OA=="}, "originalCommit": {"oid": "e200fcd0089727bb8c11ffa2d51bc48880865951"}, "originalPosition": 25}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MzYwMjEwMw==", "bodyText": "I've opened up #8647 to track this work. Thanks for identifying the opportunity.", "url": "https://github.com/eclipse-openj9/openj9/pull/8265#discussion_r383602103", "createdAt": "2020-02-25T00:55:08Z", "author": {"login": "fjeremic"}, "path": "jcl/src/jdk.management/share/classes/com/ibm/lang/management/internal/ExtendedOperatingSystemMXBeanImpl.java", "diffHunk": "@@ -426,9 +424,11 @@ public final long getProcessVirtualMemorySize() {\n \t */\n \t@Override\n \tpublic final double getSystemCpuLoad() {\n-\t\treturn cpuUtilizationHelper.getSystemCpuLoad();\n+\t\treturn this.getSystemCpuLoadImpl();\n \t}\n \n+\tprivate native double getSystemCpuLoadImpl();", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MjEzNjg3OA=="}, "originalCommit": {"oid": "e200fcd0089727bb8c11ffa2d51bc48880865951"}, "originalPosition": 25}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjM2NTY2NjY3OnYy", "diffSide": "RIGHT", "path": "runtime/jcl/common/mgmtosext.c", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yMFQxNzowODozOFrOFsby5w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yMFQxNzo0NDozN1rOFsc_Dw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MjEzNzA2Mw==", "bodyText": "Inconsistent indentation.", "url": "https://github.com/eclipse-openj9/openj9/pull/8265#discussion_r382137063", "createdAt": "2020-02-20T17:08:38Z", "author": {"login": "keithc-ca"}, "path": "runtime/jcl/common/mgmtosext.c", "diffHunk": "@@ -79,6 +79,33 @@ Java_com_ibm_lang_management_internal_ExtendedOperatingSystemMXBeanImpl_getProce\n \treturn (0 == rc)? (jlong) size: (jlong) -1;\n }\n \n+jdouble JNICALL\n+Java_com_ibm_lang_management_internal_ExtendedOperatingSystemMXBeanImpl_getSystemCpuLoadImpl(JNIEnv *env, jobject instance) {\n+\tPORT_ACCESS_FROM_ENV(env);\n+   OMRPORT_ACCESS_FROM_J9PORT(PORTLIB);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "e200fcd0089727bb8c11ffa2d51bc48880865951"}, "originalPosition": 14}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MjE1NjU1OQ==", "bodyText": "Fixed in force-push.", "url": "https://github.com/eclipse-openj9/openj9/pull/8265#discussion_r382156559", "createdAt": "2020-02-20T17:44:37Z", "author": {"login": "fjeremic"}, "path": "runtime/jcl/common/mgmtosext.c", "diffHunk": "@@ -79,6 +79,33 @@ Java_com_ibm_lang_management_internal_ExtendedOperatingSystemMXBeanImpl_getProce\n \treturn (0 == rc)? (jlong) size: (jlong) -1;\n }\n \n+jdouble JNICALL\n+Java_com_ibm_lang_management_internal_ExtendedOperatingSystemMXBeanImpl_getSystemCpuLoadImpl(JNIEnv *env, jobject instance) {\n+\tPORT_ACCESS_FROM_ENV(env);\n+   OMRPORT_ACCESS_FROM_J9PORT(PORTLIB);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MjEzNzA2Mw=="}, "originalCommit": {"oid": "e200fcd0089727bb8c11ffa2d51bc48880865951"}, "originalPosition": 14}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjM2NTY3MTgyOnYy", "diffSide": "RIGHT", "path": "runtime/oti/j9port_generated.h", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yMFQxNzoxMDoxNlrOFsb2Lw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yMFQxNzo0NDozNVrOFsc-8Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MjEzNzkwMw==", "bodyText": "Please undo this change - the file is otherwise unmodified.", "url": "https://github.com/eclipse-openj9/openj9/pull/8265#discussion_r382137903", "createdAt": "2020-02-20T17:10:16Z", "author": {"login": "keithc-ca"}, "path": "runtime/oti/j9port_generated.h", "diffHunk": "@@ -1,5 +1,5 @@\n /*******************************************************************************\n- * Copyright (c) 1991, 2019 IBM Corp. and others\n+ * Copyright (c) 1991, 2020 IBM Corp. and others", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "e200fcd0089727bb8c11ffa2d51bc48880865951"}, "originalPosition": 3}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MjE1NjUyOQ==", "bodyText": "Fixed in force-push.", "url": "https://github.com/eclipse-openj9/openj9/pull/8265#discussion_r382156529", "createdAt": "2020-02-20T17:44:35Z", "author": {"login": "fjeremic"}, "path": "runtime/oti/j9port_generated.h", "diffHunk": "@@ -1,5 +1,5 @@\n /*******************************************************************************\n- * Copyright (c) 1991, 2019 IBM Corp. and others\n+ * Copyright (c) 1991, 2020 IBM Corp. and others", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MjEzNzkwMw=="}, "originalCommit": {"oid": "e200fcd0089727bb8c11ffa2d51bc48880865951"}, "originalPosition": 3}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjM2NTY3MzY2OnYy", "diffSide": "RIGHT", "path": "runtime/oti/jclprots.h", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yMFQxNzoxMDo1MFrOFsb3SQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yMFQxNzoxMDo1MFrOFsb3SQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MjEzODE4NQ==", "bodyText": "The signature will need to be updated if made static.", "url": "https://github.com/eclipse-openj9/openj9/pull/8265#discussion_r382138185", "createdAt": "2020-02-20T17:10:50Z", "author": {"login": "keithc-ca"}, "path": "runtime/oti/jclprots.h", "diffHunk": "@@ -140,8 +140,8 @@ extern J9_CFUNC jlong JNICALL\n Java_com_ibm_lang_management_internal_ExtendedOperatingSystemMXBeanImpl_getProcessPrivateMemorySizeImpl (JNIEnv *env, jobject instance);\n extern J9_CFUNC jlong JNICALL\n Java_com_ibm_lang_management_internal_ExtendedOperatingSystemMXBeanImpl_getProcessPhysicalMemorySizeImpl (JNIEnv *env, jobject instance);\n-extern J9_CFUNC jobject JNICALL\n-Java_com_ibm_lang_management_internal_SysinfoCpuTime_getCpuUtilizationImpl (JNIEnv *env, jclass clazz);\n+extern J9_CFUNC jdouble JNICALL\n+Java_com_ibm_lang_management_internal_ExtendedOperatingSystemMXBeanImpl_getSystemCpuLoadImpl (JNIEnv *env, jobject instance);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "e200fcd0089727bb8c11ffa2d51bc48880865951"}, "originalPosition": 14}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjM2NTY4MTQzOnYy", "diffSide": "RIGHT", "path": "test/functional/JLM_Tests/src/org/openj9/test/management/TestGetSystemCpuLoad.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yMFQxNzoxMzowMVrOFsb8Cw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yMFQxNzo0NTowM1rOFsc_-g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MjEzOTQwMw==", "bodyText": "Why is this public and not private?", "url": "https://github.com/eclipse-openj9/openj9/pull/8265#discussion_r382139403", "createdAt": "2020-02-20T17:13:01Z", "author": {"login": "keithc-ca"}, "path": "test/functional/JLM_Tests/src/org/openj9/test/management/TestGetSystemCpuLoad.java", "diffHunk": "@@ -38,97 +38,63 @@\n \n \t/* convert ns to ms and round up */\n \tprivate static final long MINIMUM_INTERVAL = (long) Math.ceil(CpuLoadCalculationConstants.MINIMUM_INTERVAL / 1e6);\n-\tprivate boolean supported;\n-\tprivate final double MIN_LOAD = 0.0;\n-\tprivate final double MAX_LOAD = 1.0;\n-\tprivate final double NO_ERROR = -100; /* should never get this */\n-\n-\t@BeforeMethod\n-\tprotected void setUp() throws Exception {\n-\t\tString osName = System.getProperty(\"os.name\");\n-\t\tif ((null == osName) || osName.equalsIgnoreCase(\"z/OS\")) {\n-\t\t\tsupported = false;\n-\t\t} else {\n-\t\t\tsupported = true;\n-\t\t}\n-\t}\n+\tprivate static final double MIN_LOAD = 0.0;\n+\tprivate static final double MAX_LOAD = 1.0;\n+\tprivate static final double NO_ERROR = -100; /* should never get this */\n \n \t@Test\n \tpublic void testSingleCpuLoadObject() {\n \t\tlogger.debug(\"Starting testSingleCpuLoadObject\");\n-\t\tcom.ibm.lang.management.OperatingSystemMXBean ibmBean;\n \t\ttry {\n-\t\t\tibmBean = ManagementFactory.getPlatformMXBean(com.ibm.lang.management.OperatingSystemMXBean.class);\n+\t\t\tcom.ibm.lang.management.OperatingSystemMXBean ibmBean = ManagementFactory.getPlatformMXBean(com.ibm.lang.management.OperatingSystemMXBean.class);\n+\t\t\ttestMxBeanImpl(ibmBean);\n \t\t} catch (IllegalArgumentException e) {\n \t\t\tAssert.fail(\"com.ibm.lang.management.OperatingSystemMXBean is not available\" + e, e);\n-\t\t\treturn;\n \t\t}\n-\t\tdouble load = ibmBean.getSystemCpuLoad();\n-\t\tif (!supported) {\n-\t\t\tvalidateLoad(load, true, CpuLoadCalculationConstants.UNSUPPORTED_VALUE, \"initial call\");\n-\t\t\treturn;\n-\t\t} else {\n-\t\t\tvalidateLoad(load, true, CpuLoadCalculationConstants.ERROR_VALUE, \"initial call\");\n-\t\t}\n-\t\tload = ibmBean.getSystemCpuLoad();\n-\t\tif (load < 0.0) { /* normal case (insufficient time since last call) */\n-\t\t\tvalidateLoad(load, true, CpuLoadCalculationConstants.ERROR_VALUE, \"call getSystemCpuLoad immediately after the previous call\");\n-\t\t} else { /* possible but unlikely: test stalled for an extended time */\n-\t\t\tvalidateLoad(load, false, NO_ERROR, \"call getSystemCpuLoad immediately after the previous call\");\n-\t\t}\n-\n-\t\tdelayMillis(MINIMUM_INTERVAL);\n-\t\tload = ibmBean.getSystemCpuLoad();\n-\t\tvalidateLoad(load, false, NO_ERROR, \"call getSystemCpuLoad after the minumum interval\");\n-\n-\t\tdelayMillis(1000);\n-\t\tload = ibmBean.getSystemCpuLoad();\n-\t\tvalidateLoad(load, false, NO_ERROR, \"call getSystemCpuLoad 1 second after previous call\");\n-\n-\t\tdelayMillis(1);\n-\t\tload = ibmBean.getSystemCpuLoad();\n-\t\tvalidateLoad(load, false, NO_ERROR, \"call getSystemCpuLoad 1 millisecond after previous call\");\n \t}\n \n \t@Test\n \tpublic void testMxBean() {\n \t\tlogger.debug(\"Starting testMxBean\");\n \t\tjava.lang.management.OperatingSystemMXBean osBean = ManagementFactory.getOperatingSystemMXBean();\n \t\tString beanClass = osBean.getClass().getName();\n-\t\tlogger.debug(\"osBean class=\" + beanClass);\n+\t\tlogger.debug(\"osBean class = \" + beanClass);\n \t\tClass<?> ibmBeanClass = com.ibm.lang.management.OperatingSystemMXBean.class;\n \n \t\tif (ibmBeanClass.isInstance(osBean)) {\n-\t\t\tcom.ibm.lang.management.OperatingSystemMXBean ibmBean1 =\n-\t\t\t\t\t(com.ibm.lang.management.OperatingSystemMXBean) osBean;\n-\t\t\tdouble load = ibmBean1.getSystemCpuLoad();\n-\t\t\tif (!supported) {\n-\t\t\t\tvalidateLoad(load, true, CpuLoadCalculationConstants.UNSUPPORTED_VALUE, \"initial getSystemCpuLoad\");\n-\t\t\t\treturn;\n-\t\t\t} else if (load < 0.0) { /* normal case (insufficient time since last call) */\n-\t\t\t\tvalidateLoad(load, true, CpuLoadCalculationConstants.ERROR_VALUE, \"initial getSystemCpuLoad\");\n-\t\t\t} else {\n-\t\t\t\tvalidateLoad(load, false, NO_ERROR, \"initial getSystemCpuLoad\");\n-\t\t\t}\n-\t\t\tdelayMillis(MINIMUM_INTERVAL);\n-\t\t\tload = ibmBean1.getSystemCpuLoad();\n-\t\t\tvalidateLoad(load, false, NO_ERROR, \"getSystemCpuLoad after the minumum interval\");\n-\n-\t\t\tload = ibmBean1.getSystemCpuLoad();\n-\t\t\tvalidateLoad(load, false, NO_ERROR, \"getSystemCpuLoad again\");\n-\n-\t\t\tdelayMillis(MINIMUM_INTERVAL);\n-\t\t\tload = ibmBean1.getSystemCpuLoad();\n-\t\t\tvalidateLoad(load, false, NO_ERROR, \"getSystemCpuLoad again\");\n-\n-\t\t\tdelayMillis(1000);\n-\t\t\tload = ibmBean1.getSystemCpuLoad();\n-\t\t\tvalidateLoad(load, false, NO_ERROR, \"getSystemCpuLoad after 1 second\");\n+\t\t\ttestMxBeanImpl((com.ibm.lang.management.OperatingSystemMXBean)osBean);\n \t\t} else {\n \t\t\tAssert.fail(\"OperatingSystemMXBean is wrong type: \" + osBean.getClass().getName());\n \t\t}\n \t}\n \n+\tpublic static void testMxBeanImpl(com.ibm.lang.management.OperatingSystemMXBean ibmBean) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "e200fcd0089727bb8c11ffa2d51bc48880865951"}, "originalPosition": 109}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MjE1Njc5NA==", "bodyText": "Fixed in force-push.", "url": "https://github.com/eclipse-openj9/openj9/pull/8265#discussion_r382156794", "createdAt": "2020-02-20T17:45:03Z", "author": {"login": "fjeremic"}, "path": "test/functional/JLM_Tests/src/org/openj9/test/management/TestGetSystemCpuLoad.java", "diffHunk": "@@ -38,97 +38,63 @@\n \n \t/* convert ns to ms and round up */\n \tprivate static final long MINIMUM_INTERVAL = (long) Math.ceil(CpuLoadCalculationConstants.MINIMUM_INTERVAL / 1e6);\n-\tprivate boolean supported;\n-\tprivate final double MIN_LOAD = 0.0;\n-\tprivate final double MAX_LOAD = 1.0;\n-\tprivate final double NO_ERROR = -100; /* should never get this */\n-\n-\t@BeforeMethod\n-\tprotected void setUp() throws Exception {\n-\t\tString osName = System.getProperty(\"os.name\");\n-\t\tif ((null == osName) || osName.equalsIgnoreCase(\"z/OS\")) {\n-\t\t\tsupported = false;\n-\t\t} else {\n-\t\t\tsupported = true;\n-\t\t}\n-\t}\n+\tprivate static final double MIN_LOAD = 0.0;\n+\tprivate static final double MAX_LOAD = 1.0;\n+\tprivate static final double NO_ERROR = -100; /* should never get this */\n \n \t@Test\n \tpublic void testSingleCpuLoadObject() {\n \t\tlogger.debug(\"Starting testSingleCpuLoadObject\");\n-\t\tcom.ibm.lang.management.OperatingSystemMXBean ibmBean;\n \t\ttry {\n-\t\t\tibmBean = ManagementFactory.getPlatformMXBean(com.ibm.lang.management.OperatingSystemMXBean.class);\n+\t\t\tcom.ibm.lang.management.OperatingSystemMXBean ibmBean = ManagementFactory.getPlatformMXBean(com.ibm.lang.management.OperatingSystemMXBean.class);\n+\t\t\ttestMxBeanImpl(ibmBean);\n \t\t} catch (IllegalArgumentException e) {\n \t\t\tAssert.fail(\"com.ibm.lang.management.OperatingSystemMXBean is not available\" + e, e);\n-\t\t\treturn;\n \t\t}\n-\t\tdouble load = ibmBean.getSystemCpuLoad();\n-\t\tif (!supported) {\n-\t\t\tvalidateLoad(load, true, CpuLoadCalculationConstants.UNSUPPORTED_VALUE, \"initial call\");\n-\t\t\treturn;\n-\t\t} else {\n-\t\t\tvalidateLoad(load, true, CpuLoadCalculationConstants.ERROR_VALUE, \"initial call\");\n-\t\t}\n-\t\tload = ibmBean.getSystemCpuLoad();\n-\t\tif (load < 0.0) { /* normal case (insufficient time since last call) */\n-\t\t\tvalidateLoad(load, true, CpuLoadCalculationConstants.ERROR_VALUE, \"call getSystemCpuLoad immediately after the previous call\");\n-\t\t} else { /* possible but unlikely: test stalled for an extended time */\n-\t\t\tvalidateLoad(load, false, NO_ERROR, \"call getSystemCpuLoad immediately after the previous call\");\n-\t\t}\n-\n-\t\tdelayMillis(MINIMUM_INTERVAL);\n-\t\tload = ibmBean.getSystemCpuLoad();\n-\t\tvalidateLoad(load, false, NO_ERROR, \"call getSystemCpuLoad after the minumum interval\");\n-\n-\t\tdelayMillis(1000);\n-\t\tload = ibmBean.getSystemCpuLoad();\n-\t\tvalidateLoad(load, false, NO_ERROR, \"call getSystemCpuLoad 1 second after previous call\");\n-\n-\t\tdelayMillis(1);\n-\t\tload = ibmBean.getSystemCpuLoad();\n-\t\tvalidateLoad(load, false, NO_ERROR, \"call getSystemCpuLoad 1 millisecond after previous call\");\n \t}\n \n \t@Test\n \tpublic void testMxBean() {\n \t\tlogger.debug(\"Starting testMxBean\");\n \t\tjava.lang.management.OperatingSystemMXBean osBean = ManagementFactory.getOperatingSystemMXBean();\n \t\tString beanClass = osBean.getClass().getName();\n-\t\tlogger.debug(\"osBean class=\" + beanClass);\n+\t\tlogger.debug(\"osBean class = \" + beanClass);\n \t\tClass<?> ibmBeanClass = com.ibm.lang.management.OperatingSystemMXBean.class;\n \n \t\tif (ibmBeanClass.isInstance(osBean)) {\n-\t\t\tcom.ibm.lang.management.OperatingSystemMXBean ibmBean1 =\n-\t\t\t\t\t(com.ibm.lang.management.OperatingSystemMXBean) osBean;\n-\t\t\tdouble load = ibmBean1.getSystemCpuLoad();\n-\t\t\tif (!supported) {\n-\t\t\t\tvalidateLoad(load, true, CpuLoadCalculationConstants.UNSUPPORTED_VALUE, \"initial getSystemCpuLoad\");\n-\t\t\t\treturn;\n-\t\t\t} else if (load < 0.0) { /* normal case (insufficient time since last call) */\n-\t\t\t\tvalidateLoad(load, true, CpuLoadCalculationConstants.ERROR_VALUE, \"initial getSystemCpuLoad\");\n-\t\t\t} else {\n-\t\t\t\tvalidateLoad(load, false, NO_ERROR, \"initial getSystemCpuLoad\");\n-\t\t\t}\n-\t\t\tdelayMillis(MINIMUM_INTERVAL);\n-\t\t\tload = ibmBean1.getSystemCpuLoad();\n-\t\t\tvalidateLoad(load, false, NO_ERROR, \"getSystemCpuLoad after the minumum interval\");\n-\n-\t\t\tload = ibmBean1.getSystemCpuLoad();\n-\t\t\tvalidateLoad(load, false, NO_ERROR, \"getSystemCpuLoad again\");\n-\n-\t\t\tdelayMillis(MINIMUM_INTERVAL);\n-\t\t\tload = ibmBean1.getSystemCpuLoad();\n-\t\t\tvalidateLoad(load, false, NO_ERROR, \"getSystemCpuLoad again\");\n-\n-\t\t\tdelayMillis(1000);\n-\t\t\tload = ibmBean1.getSystemCpuLoad();\n-\t\t\tvalidateLoad(load, false, NO_ERROR, \"getSystemCpuLoad after 1 second\");\n+\t\t\ttestMxBeanImpl((com.ibm.lang.management.OperatingSystemMXBean)osBean);\n \t\t} else {\n \t\t\tAssert.fail(\"OperatingSystemMXBean is wrong type: \" + osBean.getClass().getName());\n \t\t}\n \t}\n \n+\tpublic static void testMxBeanImpl(com.ibm.lang.management.OperatingSystemMXBean ibmBean) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MjEzOTQwMw=="}, "originalCommit": {"oid": "e200fcd0089727bb8c11ffa2d51bc48880865951"}, "originalPosition": 109}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 736, "cost": 1, "resetAt": "2021-11-12T13:16:51Z"}}}