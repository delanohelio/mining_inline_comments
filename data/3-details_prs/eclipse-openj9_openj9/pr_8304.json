{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0MzYyOTc2OTgx", "number": 8304, "title": "AArch64: Save parameters to the stack in FSD mode", "bodyText": "In the method prologue, we need to save parameters passed\nin linkage registers to the stack when in FSD mode as other platforms do.\nThis commit adds saveParametersToStack function to PrivateLinkage class\nfor this purpose.\nThis commit also modifies copyParametersToHomeLocation function not to\nsave parameter if parms are saved by saveParametersToStack.\nsaveParametersToStack is almost same as current copyParametersToHomeLocation, but\ncopyParametersToHomeLocation will be extended to support GRA. I believe it is simpler not\nto mix up these 2 functions.\nSigned-off-by: Akira Saitoh saiaki@jp.ibm.com", "createdAt": "2020-01-15T06:24:32Z", "url": "https://github.com/eclipse-openj9/openj9/pull/8304", "merged": true, "mergeCommit": {"oid": "1ae5654cf79de053c96737b16acdac5acfb09389"}, "closed": true, "closedAt": "2020-01-16T06:31:39Z", "author": {"login": "Akira1Saitoh"}, "timelineItems": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABb6fWTIgH2gAyMzYyOTc2OTgxOmFmOWQ3NDUwNjU3MGNjNjU3MmU3ODAyNTQ2NjFlNjIxZThhNzFhMWE=", "endCursor": "Y3Vyc29yOnYyOpPPAAABb6xaC6AFqTM0MzY1Mjk4Ng==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "af9d74506570cc6572e780254661e621e8a71a1a", "author": {"user": {"login": "Akira1Saitoh", "name": "Akira Saito"}}, "url": "https://github.com/eclipse-openj9/openj9/commit/af9d74506570cc6572e780254661e621e8a71a1a", "committedDate": "2020-01-15T06:13:57Z", "message": "AArch64: Save parameters to the stack in FSD mode\n\nIn the method prologue, we need to save parameters passed\nin linkage registers to the stack when in FSD mode as other platforms do.\nThis commit adds `saveParametersToStack` function to PrivateLinkage class\nfor this purpose.\nThis commit modifies `copyParametersToHomeLocation` function not to\nsave parameter if parms are saved by `saveParametersToStack`.\n\nSigned-off-by: Akira Saitoh <saiaki@jp.ibm.com>"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzQzNjUyOTg2", "url": "https://github.com/eclipse-openj9/openj9/pull/8304#pullrequestreview-343652986", "createdAt": "2020-01-16T03:16:19Z", "commit": {"oid": "af9d74506570cc6572e780254661e621e8a71a1a"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0xNlQwMzoxNjoxOVrOFeM6Jg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0xNlQwMzoxNjoxOVrOFeM6Jg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NzIxMzA5NA==", "bodyText": "Do you need to execute this loop with parmIterator when parmsHaveBeenStored is true?", "url": "https://github.com/eclipse-openj9/openj9/pull/8304#discussion_r367213094", "createdAt": "2020-01-16T03:16:19Z", "author": {"login": "knn-k"}, "path": "runtime/compiler/aarch64/codegen/ARM64PrivateLinkage.cpp", "diffHunk": "@@ -1353,6 +1358,55 @@ J9::ARM64::PrivateLinkage::copyParametersToHomeLocation(TR::Instruction *cursor)\n    return cursor;\n    }\n \n+/**\n+ * A more optimal implementation of this function will be required when GRA is enabled.\n+ * See OpenJ9 issue #6657.  Also consider merging with loadStackParametersToLinkageRegisters.\n+ */\n+TR::Instruction *\n+J9::ARM64::PrivateLinkage::copyParametersToHomeLocation(TR::Instruction *cursor, bool parmsHaveBeenStored)\n+   {\n+   TR::Machine *machine = cg()->machine();\n+   TR::ARM64LinkageProperties& properties = getProperties();\n+   TR::RealRegister *javaSP = machine->getRealRegister(properties.getStackPointerRegister());       // x20\n+\n+   TR::ResolvedMethodSymbol *bodySymbol = comp()->getJittedMethodSymbol();\n+   ListIterator<TR::ParameterSymbol> parmIterator(&(bodySymbol->getParameterList()));\n+   TR::ParameterSymbol *parmCursor;\n+\n+   // Store to stack all parameters passed in linkage registers\n+   //\n+   for (parmCursor = parmIterator.getFirst();\n+        parmCursor != NULL;\n+        parmCursor = parmIterator.getNext())\n+      {\n+      if (parmCursor->isParmPassedInRegister())\n+         {\n+         if (!parmsHaveBeenStored)", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "af9d74506570cc6572e780254661e621e8a71a1a"}, "originalPosition": 73}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 856, "cost": 1, "resetAt": "2021-10-28T18:00:02Z"}}}