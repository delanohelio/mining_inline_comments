{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTIwMTMzMzg0", "number": 11170, "title": "Ensure we don't crash when image not present", "bodyText": "Refactor the VMSnapshotImpl destructor to skip most of\nthe implementation if the _vm is null. This likely\nindicates that we're shutting down from a partially\ninitialized state - likely due to a missing image\nfile.\nSome additional refactoring to make the code slightly\nclearer about which state we're in (restore / snapshot)\nand what the expected behaviour is.\nSigned-off-by: Dan Heidinga heidinga@redhat.com", "createdAt": "2020-11-12T20:16:52Z", "url": "https://github.com/eclipse-openj9/openj9/pull/11170", "merged": true, "mergeCommit": {"oid": "75aeda98cf7965e74bfdd9fec231d403c81e5c3c"}, "closed": true, "closedAt": "2020-11-13T17:02:58Z", "author": {"login": "DanHeidinga"}, "timelineItems": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdb4YvjAH2gAyNTIwMTMzMzg0OjlkOWZmYWM4ZGE4ODE3OGM2ZTcwMzNjZTA3YmUyNmZiYWU1MjFhOTg=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdcKKAtAFqTUzMDIzMTY0Ng==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "9d9ffac8da88178c6e7033ce07be26fbae521a98", "author": {"user": {"login": "DanHeidinga", "name": "Dan Heidinga"}}, "url": "https://github.com/eclipse-openj9/openj9/commit/9d9ffac8da88178c6e7033ce07be26fbae521a98", "committedDate": "2020-11-12T20:14:54Z", "message": "Ensure we don't crash when image not present\n\nRefactor the VMSnapshotImpl destructor to skip most of\nthe implementation if the `_vm` is null. This likely\nindicates that we're shutting down from a partially\ninitialized state - likely due to a missing image\nfile.\n\nSome additional refactoring to make the code slightly\nclearer about which state we're in (restore / snapshot)\nand what the expected behaviour is.\n\nSigned-off-by: Dan Heidinga <heidinga@redhat.com>"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTMwMTgyMTA3", "url": "https://github.com/eclipse-openj9/openj9/pull/11170#pullrequestreview-530182107", "createdAt": "2020-11-13T15:56:53Z", "commit": {"oid": "9d9ffac8da88178c6e7033ce07be26fbae521a98"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xM1QxNTo1Njo1M1rOHyz8LQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xM1QxNTo1Njo1M1rOHyz8LQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMzA0MTgzNw==", "bodyText": "What is the purpose of changing this cast type?", "url": "https://github.com/eclipse-openj9/openj9/pull/11170#discussion_r523041837", "createdAt": "2020-11-13T15:56:53Z", "author": {"login": "theresa-m"}, "path": "runtime/vm/VMSnapshotImpl.cpp", "diffHunk": "@@ -1398,14 +1414,27 @@ initializeVMSnapshotImpl(J9PortLibrary *portLibrary, BOOLEAN isSnapShotRun, cons\n extern \"C\" void\n setupVMSnapshotImpl(void *vmSnapshotImpl, J9JavaVM* vm)\n {\n-\t((VMSnapshotImpl *)vmSnapshotImpl)->setJ9JavaVM(vm);\n-\tvm->vmSnapshotImplPortLibrary = ((VMSnapshotImpl *)vmSnapshotImpl)->getVMSnapshotImplPortLibrary();\n+\tVMSnapshotImpl *impl = static_cast<VMSnapshotImpl *>(vmSnapshotImpl);\n+\tJ9JavaVM* implVM = impl->getJ9JavaVM();\n+\tif (implVM != NULL) {\n+\t\tif (implVM != vm) {\n+\t\t\t/* Something seriously wrong here! */\n+\t\t\tprintf(\"**** In a Restore run and was passed a different vm pointer.\\n\");\n+\t\t\tprintf(\"**** Expected VMSnapshotImpl->_vm(%p) was (%p)\\n\", implVM, vm);\n+\t\t\tabort();\n+\t\t}\n+\t\t/* No action required */\n+\t} else {\n+\t\t/* Snapshot run - initial set of VM into VMSnapshotImpl*/\n+\t\timpl->setJ9JavaVM(vm);\n+\t}\n+\tvm->vmSnapshotImplPortLibrary = impl->getVMSnapshotImplPortLibrary();\n }\n \n extern \"C\" J9JavaVM *\n getJ9JavaVMFromVMSnapshotImpl(void *vmSnapshotImpl)\n {\n-\treturn ((VMSnapshotImpl *)vmSnapshotImpl)->getJ9JavaVM();\n+\treturn static_cast<VMSnapshotImpl *>(vmSnapshotImpl)->getJ9JavaVM();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "9d9ffac8da88178c6e7033ce07be26fbae521a98"}, "originalPosition": 137}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTMwMjA2ODQ1", "url": "https://github.com/eclipse-openj9/openj9/pull/11170#pullrequestreview-530206845", "createdAt": "2020-11-13T16:27:07Z", "commit": {"oid": "9d9ffac8da88178c6e7033ce07be26fbae521a98"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTMwMjMxNjQ2", "url": "https://github.com/eclipse-openj9/openj9/pull/11170#pullrequestreview-530231646", "createdAt": "2020-11-13T16:57:06Z", "commit": {"oid": "9d9ffac8da88178c6e7033ce07be26fbae521a98"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1560, "cost": 1, "resetAt": "2021-10-28T17:48:14Z"}}}