{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDgzOTk3MDE0", "number": 10563, "title": "Capture the errors in enum_const_value of RuntimeVisibleAnnotations", "bodyText": "The change is to capture the errors specific to the index\nto the constant pool set in enum_const_value of the\nRuntimeVisibleAnnotations attribute.\nSigned-off-by: Cheng Jin jincheng@ca.ibm.com", "createdAt": "2020-09-10T15:24:45Z", "url": "https://github.com/eclipse-openj9/openj9/pull/10563", "merged": true, "mergeCommit": {"oid": "44bbe6ab75f988b19fed1e45b7cdc17613a2f22d"}, "closed": true, "closedAt": "2020-09-10T19:16:12Z", "author": {"login": "ChengJin01"}, "timelineItems": {"totalCount": 7, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdHi6mWgFqTQ4NjA4MTgzNA==", "endCursor": "Y3Vyc29yOnYyOpPPAAABdHlx7wAFqTQ4NjIzNzkyMg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDg2MDgxODM0", "url": "https://github.com/eclipse-openj9/openj9/pull/10563#pullrequestreview-486081834", "createdAt": "2020-09-10T15:55:29Z", "commit": {"oid": "6c3629eac201fbd7eeee205df78d097ddf176d5d"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xMFQxNTo1NToyOVrOHP60Mg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xMFQxNTo1NToyOVrOHP60Mg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NjQ1NDMyMg==", "bodyText": "Please format these properly (space after if) and don't use ! for zero tests in new code.", "url": "https://github.com/eclipse-openj9/openj9/pull/10563#discussion_r486454322", "createdAt": "2020-09-10T15:55:29Z", "author": {"login": "gacholio"}, "path": "runtime/bcutil/cfreader.c", "diffHunk": "@@ -3470,15 +3481,30 @@ readAnnotationElement(J9CfrClassFile * classfile, J9CfrAnnotationElement ** pAnn\n \t\tbreak;\n \t\t\t\n \tcase 'e':\n+\t{\n+\t\tJ9CfrConstantPoolInfo* cpBase = classfile->constantPool;\n+\t\tU_16 cpCount = classfile->constantPoolCount;\n+\t\tU_16 typeNameIndex = 0;\n+\t\tU_16 constNameIndex = 0;\n+\n \t\tif (!ALLOC_CAST(element, J9CfrAnnotationElementEnum, J9CfrAnnotationElement)) {\n \t\t\treturn -2;\n \t\t}\n \n \t\tCHECK_EOF(4);\n \t\tNEXT_U16(((J9CfrAnnotationElementEnum *)element)->typeNameIndex, index);\n \t\tNEXT_U16(((J9CfrAnnotationElementEnum *)element)->constNameIndex, index);\n+\t\t\n+\t\ttypeNameIndex = ((J9CfrAnnotationElementEnum *)element)->typeNameIndex;\n+\t\tconstNameIndex = ((J9CfrAnnotationElementEnum *)element)->constNameIndex;\n+\t\tif(!typeNameIndex || (typeNameIndex >= cpCount) || !constNameIndex || (constNameIndex >= cpCount)) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "6c3629eac201fbd7eeee205df78d097ddf176d5d"}, "originalPosition": 326}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "6c3629eac201fbd7eeee205df78d097ddf176d5d", "author": {"user": {"login": "ChengJin01", "name": "Cheng Jin"}}, "url": "https://github.com/eclipse-openj9/openj9/commit/6c3629eac201fbd7eeee205df78d097ddf176d5d", "committedDate": "2020-09-10T15:23:24Z", "message": "Capture the errors in enum_const_value of RuntimeVisibleAnnotations\n\nThe change is to capture the errors specific to the index\nto the constant pool set in enum_const_value of the\nRuntimeVisibleAnnotations attribute.\n\nSigned-off-by: Cheng Jin <jincheng@ca.ibm.com>"}, "afterCommit": {"oid": "2e3c95af8a6c35f9b03cff1a3f2a15564c48c79b", "author": {"user": {"login": "ChengJin01", "name": "Cheng Jin"}}, "url": "https://github.com/eclipse-openj9/openj9/commit/2e3c95af8a6c35f9b03cff1a3f2a15564c48c79b", "committedDate": "2020-09-10T15:59:06Z", "message": "Capture the errors in enum_const_value of RuntimeVisibleAnnotations\n\nThe change is to capture the errors specific to the index\nto the constant pool set in enum_const_value of the\nRuntimeVisibleAnnotations attribute.\n\nSigned-off-by: Cheng Jin <jincheng@ca.ibm.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "034442a0fcbd9e533b8a4674bab34c04807d48bc", "author": {"user": {"login": "ChengJin01", "name": "Cheng Jin"}}, "url": "https://github.com/eclipse-openj9/openj9/commit/034442a0fcbd9e533b8a4674bab34c04807d48bc", "committedDate": "2020-09-10T16:01:51Z", "message": "Capture the errors in enum_const_value of RuntimeVisibleAnnotations\n\nThe change is to capture the errors specific to the index\nto the constant pool set in enum_const_value of the\nRuntimeVisibleAnnotations attribute.\n\nSigned-off-by: Cheng Jin <jincheng@ca.ibm.com>"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "2e3c95af8a6c35f9b03cff1a3f2a15564c48c79b", "author": {"user": {"login": "ChengJin01", "name": "Cheng Jin"}}, "url": "https://github.com/eclipse-openj9/openj9/commit/2e3c95af8a6c35f9b03cff1a3f2a15564c48c79b", "committedDate": "2020-09-10T15:59:06Z", "message": "Capture the errors in enum_const_value of RuntimeVisibleAnnotations\n\nThe change is to capture the errors specific to the index\nto the constant pool set in enum_const_value of the\nRuntimeVisibleAnnotations attribute.\n\nSigned-off-by: Cheng Jin <jincheng@ca.ibm.com>"}, "afterCommit": {"oid": "034442a0fcbd9e533b8a4674bab34c04807d48bc", "author": {"user": {"login": "ChengJin01", "name": "Cheng Jin"}}, "url": "https://github.com/eclipse-openj9/openj9/commit/034442a0fcbd9e533b8a4674bab34c04807d48bc", "committedDate": "2020-09-10T16:01:51Z", "message": "Capture the errors in enum_const_value of RuntimeVisibleAnnotations\n\nThe change is to capture the errors specific to the index\nto the constant pool set in enum_const_value of the\nRuntimeVisibleAnnotations attribute.\n\nSigned-off-by: Cheng Jin <jincheng@ca.ibm.com>"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDg2MDkwODQw", "url": "https://github.com/eclipse-openj9/openj9/pull/10563#pullrequestreview-486090840", "createdAt": "2020-09-10T16:04:19Z", "commit": {"oid": "034442a0fcbd9e533b8a4674bab34c04807d48bc"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDg2MTQxNzQw", "url": "https://github.com/eclipse-openj9/openj9/pull/10563#pullrequestreview-486141740", "createdAt": "2020-09-10T17:08:29Z", "commit": {"oid": "034442a0fcbd9e533b8a4674bab34c04807d48bc"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xMFQxNzowODoyOVrOHP9snQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xMFQxNzowODoyOVrOHP9snQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NjUwMTUzMw==", "bodyText": "Does this behaviour apply across all supported JDK levels - 8, 11 & 15?  Does the RI report the errors for these cases in all releases?", "url": "https://github.com/eclipse-openj9/openj9/pull/10563#discussion_r486501533", "createdAt": "2020-09-10T17:08:29Z", "author": {"login": "DanHeidinga"}, "path": "runtime/bcutil/cfreader.c", "diffHunk": "@@ -448,6 +448,17 @@ readAttributes(J9CfrClassFile * classfile, J9CfrAttribute *** pAttributes, U_32\n \t\t\t\tU_32 cursor = 0;\n \t\t\t\tTrc_BCU_MalformedAnnotation(address);\n \n+\t\t\t\t/* Capture the errors with type_name_index & const_name_index in enum_const_value against the VM Spec */\n+\t\t\t\tif (BCT_ERR_INVALID_ANNOTATION_BAD_CP_INDEX_OUT_OF_RANGE == result) {\n+\t\t\t\t\terrorCode = J9NLS_CFR_ERR_BAD_INDEX__ID;\n+\t\t\t\t\toffset = address;\n+\t\t\t\t\tgoto _errorFound;\n+\t\t\t\t} else if (BCT_ERR_INVALID_ANNOTATION_BAD_CP_UTF8_STRING == result) {\n+\t\t\t\t\terrorCode = J9NLS_CFR_ERR_BAD_NAME_INDEX__ID;\n+\t\t\t\t\toffset = address;\n+\t\t\t\t\tgoto _errorFound;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "034442a0fcbd9e533b8a4674bab34c04807d48bc"}, "originalPosition": 21}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDg2MjM3OTIy", "url": "https://github.com/eclipse-openj9/openj9/pull/10563#pullrequestreview-486237922", "createdAt": "2020-09-10T19:15:44Z", "commit": {"oid": "034442a0fcbd9e533b8a4674bab34c04807d48bc"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4989, "cost": 1, "resetAt": "2021-10-28T18:54:27Z"}}}