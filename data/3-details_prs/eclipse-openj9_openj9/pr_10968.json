{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTA4MzYyOTYy", "number": 10968, "title": "Add new `allSegmentsInMemorySegmentListDo` api to iterate segments ", "bodyText": "The new api iterates through all the J9MemorySegments in a given\nJ9MemorySegmentList and passes them to a callback function.  This\nallows arbitrary operations to be performed on the segment.\nI've validated this with adhoc tests that print the segments and\nremove bits from them.\nThe API is intended to help the snapshot work but as it's common\nand can be put immediately into master, that's my preference to\navoid porting it over later.\nThere's a second commit with an example of a debug helper callback I've needed.", "createdAt": "2020-10-22T15:06:52Z", "url": "https://github.com/eclipse-openj9/openj9/pull/10968", "merged": true, "mergeCommit": {"oid": "bc6beec20ae81b022adc9b4303100f8c2a8ae1c6"}, "closed": true, "closedAt": "2020-10-22T18:38:11Z", "author": {"login": "DanHeidinga"}, "timelineItems": {"totalCount": 5, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdVDPoZAH2gAyNTA4MzYyOTYyOmYzMTZlNWMzZGNlMjY4MDI3Yzk5MDFlZTE5Y2Y0ZmU0ZTEyZTk0ZDU=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdVERpAAFqTUxNDg5NDAyNw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "f316e5c3dce268027c9901ee19cf4fe4e12e94d5", "author": {"user": {"login": "DanHeidinga", "name": "Dan Heidinga"}}, "url": "https://github.com/eclipse-openj9/openj9/commit/f316e5c3dce268027c9901ee19cf4fe4e12e94d5", "committedDate": "2020-10-22T14:56:26Z", "message": "Add new `allSegmentsInMemorySegmentListDo` api to iterate segments\n\nThe new api iterates through all the J9MemorySegments in a given\nJ9MemorySegmentList and passes them to a callback function.  This\nallows arbitrary operations to be performed on the segment.\n\nI've validated this with adhoc tests that print the segments and\nremove bits from them.\n\nThe API is intended to help the `snapshot` work but as it's common\nand can be put immediately into `master`, that's my preference to\navoid porting it over later.\n\nSigned-off-by: Dan Heidinga <heidinga@redhat.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "5137b3881115a294a4ea7f5fc0bb3344d808c669", "author": {"user": {"login": "DanHeidinga", "name": "Dan Heidinga"}}, "url": "https://github.com/eclipse-openj9/openj9/commit/5137b3881115a294a4ea7f5fc0bb3344d808c669", "committedDate": "2020-10-22T15:05:01Z", "message": "Debug helper callback function to print known J9MemorySegment types\n\nSigned-off-by: Dan Heidinga <heidinga@redhat.com>"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTE0ODc5MTU3", "url": "https://github.com/eclipse-openj9/openj9/pull/10968#pullrequestreview-514879157", "createdAt": "2020-10-22T15:53:01Z", "commit": {"oid": "5137b3881115a294a4ea7f5fc0bb3344d808c669"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yMlQxNTo1MzowMVrOHmonsg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yMlQxNTo1MzowMVrOHmonsg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMDI3MzQ1OA==", "bodyText": "Extra line.", "url": "https://github.com/eclipse-openj9/openj9/pull/10968#discussion_r510273458", "createdAt": "2020-10-22T15:53:01Z", "author": {"login": "gacholio"}, "path": "runtime/vm/segment.c", "diffHunk": "@@ -196,10 +196,27 @@ void freeMemorySegmentList(J9JavaVM *javaVM,J9MemorySegmentList *segmentList)\n \tj9mem_free_memory(segmentList);\n }\n \n+void\n+allSegmentsInMemorySegmentListDo(J9MemorySegmentList *segmentList, void (* segmentCallback)(J9MemorySegment*, void*), void *userData)\n+{\n+\tAssert_VM_notNull(segmentList);\n+\tAssert_VM_notNull(segmentCallback);\n+\tif (!J9_MEMORY_SEGMENT_LINEAR_LINKED_LIST_IS_EMPTY(segmentList->nextSegment)) {\n+\t\tJ9MemorySegment *segment = J9_MEMORY_SEGMENT_LINEAR_LINKED_LIST_START_DO(segmentList->nextSegment);\n+\n+\t\twhile (segment != NULL) {\n+\t\t\tsegmentCallback(segment, userData);\n+\t\t\tsegment = J9_MEMORY_SEGMENT_LINEAR_LINKED_LIST_NEXT_DO(segmentList->nextSegment, segment);\n+\t\t}\n+\n+\t}\n+", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "5137b3881115a294a4ea7f5fc0bb3344d808c669"}, "originalPosition": 34}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "8e73ee3cc16452ad0cdd79dda564a45fc3303f59", "author": {"user": {"login": "DanHeidinga", "name": "Dan Heidinga"}}, "url": "https://github.com/eclipse-openj9/openj9/commit/8e73ee3cc16452ad0cdd79dda564a45fc3303f59", "committedDate": "2020-10-22T16:00:45Z", "message": "Remove extra blank lines\n\nSigned-off-by: Dan Heidinga <heidinga@redhat.com>"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTE0ODk0MDI3", "url": "https://github.com/eclipse-openj9/openj9/pull/10968#pullrequestreview-514894027", "createdAt": "2020-10-22T16:08:32Z", "commit": {"oid": "5137b3881115a294a4ea7f5fc0bb3344d808c669"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 250, "cost": 1, "resetAt": "2021-10-28T18:00:02Z"}}}