{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTQ3MDk0NDY2", "number": 11554, "title": "Add FSD support for AOT", "bodyText": "Depends on (and therefore contains commits from) #11553\nDepends on (and therefore contains commits from) #11879\nDepends on eclipse/omr#5814\nThis PR contains the changes necessary for enabling FSD for AOT:\n\nAdds Breakpoint Guard relocations\nAdds Feature Flag validation for FSD\nImproves FSD performance by no longer emitting method enter/exit hooks as these events are dealt with using involuntary OSR\nModifies how a TR_MethodPointer relocation materializes a method pointer\n\nCloses #11376", "createdAt": "2020-12-30T21:33:00Z", "url": "https://github.com/eclipse-openj9/openj9/pull/11554", "merged": true, "mergeCommit": {"oid": "f7a57f56865b487310e02965e14c828b015758c8"}, "closed": true, "closedAt": "2021-03-02T14:21:09Z", "author": {"login": "dsouzai"}, "timelineItems": {"totalCount": 40, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdt8Rv3gBqjQxODIwNTcxMTU=", "endCursor": "Y3Vyc29yOnYyOpPPAAABd_DDc8gFqTYwMTM1MTEyNg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "3f7a6aa2c37f93947a70a9e97ee7adc8d2aca17d", "author": {"user": {"login": "dsouzai", "name": "Irwin D'Souza"}}, "url": "https://github.com/eclipse-openj9/openj9/commit/3f7a6aa2c37f93947a70a9e97ee7adc8d2aca17d", "committedDate": "2020-12-30T21:19:14Z", "message": "Increment JITServer Minor Version\n\nChange in relocation requires a change to the minor version.\n\nSigned-off-by: Irwin D'Souza <dsouzai.gh@gmail.com>"}, "afterCommit": {"oid": "252a33302d0de9f471d6899ab7e9528727389d44", "author": {"user": {"login": "dsouzai", "name": "Irwin D'Souza"}}, "url": "https://github.com/eclipse-openj9/openj9/commit/252a33302d0de9f471d6899ab7e9528727389d44", "committedDate": "2021-01-07T22:43:16Z", "message": "Increment JITServer Minor Version\n\nChange in relocation requires a change to the minor version.\n\nSigned-off-by: Irwin D'Souza <dsouzai.gh@gmail.com>"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "252a33302d0de9f471d6899ab7e9528727389d44", "author": {"user": {"login": "dsouzai", "name": "Irwin D'Souza"}}, "url": "https://github.com/eclipse-openj9/openj9/commit/252a33302d0de9f471d6899ab7e9528727389d44", "committedDate": "2021-01-07T22:43:16Z", "message": "Increment JITServer Minor Version\n\nChange in relocation requires a change to the minor version.\n\nSigned-off-by: Irwin D'Souza <dsouzai.gh@gmail.com>"}, "afterCommit": {"oid": "4c569cec084861efe8e1bc0b641c78cc0d01ab3c", "author": {"user": {"login": "dsouzai", "name": "Irwin D'Souza"}}, "url": "https://github.com/eclipse-openj9/openj9/commit/4c569cec084861efe8e1bc0b641c78cc0d01ab3c", "committedDate": "2021-01-08T19:30:54Z", "message": "Increment JITServer Minor Version\n\nChange in relocation requires a change to the minor version.\n\nSigned-off-by: Irwin D'Souza <dsouzai.gh@gmail.com>"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "4c569cec084861efe8e1bc0b641c78cc0d01ab3c", "author": {"user": {"login": "dsouzai", "name": "Irwin D'Souza"}}, "url": "https://github.com/eclipse-openj9/openj9/commit/4c569cec084861efe8e1bc0b641c78cc0d01ab3c", "committedDate": "2021-01-08T19:30:54Z", "message": "Increment JITServer Minor Version\n\nChange in relocation requires a change to the minor version.\n\nSigned-off-by: Irwin D'Souza <dsouzai.gh@gmail.com>"}, "afterCommit": {"oid": "66f5f47a82fb59b45f069dc181308910e93f4b8b", "author": {"user": {"login": "dsouzai", "name": "Irwin D'Souza"}}, "url": "https://github.com/eclipse-openj9/openj9/commit/66f5f47a82fb59b45f069dc181308910e93f4b8b", "committedDate": "2021-01-14T16:38:06Z", "message": "Increment JITServer Minor Version\n\nChange in relocation requires a change to the minor version.\n\nSigned-off-by: Irwin D'Souza <dsouzai.gh@gmail.com>"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "66f5f47a82fb59b45f069dc181308910e93f4b8b", "author": {"user": {"login": "dsouzai", "name": "Irwin D'Souza"}}, "url": "https://github.com/eclipse-openj9/openj9/commit/66f5f47a82fb59b45f069dc181308910e93f4b8b", "committedDate": "2021-01-14T16:38:06Z", "message": "Increment JITServer Minor Version\n\nChange in relocation requires a change to the minor version.\n\nSigned-off-by: Irwin D'Souza <dsouzai.gh@gmail.com>"}, "afterCommit": {"oid": "080645b90f5a5b447e583fce8eeee84257fc633a", "author": {"user": {"login": "dsouzai", "name": "Irwin D'Souza"}}, "url": "https://github.com/eclipse-openj9/openj9/commit/080645b90f5a5b447e583fce8eeee84257fc633a", "committedDate": "2021-01-14T17:12:29Z", "message": "Increment JITServer Minor Version\n\nChange in relocation requires a change to the minor version.\n\nSigned-off-by: Irwin D'Souza <dsouzai.gh@gmail.com>"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "080645b90f5a5b447e583fce8eeee84257fc633a", "author": {"user": {"login": "dsouzai", "name": "Irwin D'Souza"}}, "url": "https://github.com/eclipse-openj9/openj9/commit/080645b90f5a5b447e583fce8eeee84257fc633a", "committedDate": "2021-01-14T17:12:29Z", "message": "Increment JITServer Minor Version\n\nChange in relocation requires a change to the minor version.\n\nSigned-off-by: Irwin D'Souza <dsouzai.gh@gmail.com>"}, "afterCommit": {"oid": "fab721f2a959dc1124701c17d5b228a371436fd3", "author": {"user": {"login": "dsouzai", "name": "Irwin D'Souza"}}, "url": "https://github.com/eclipse-openj9/openj9/commit/fab721f2a959dc1124701c17d5b228a371436fd3", "committedDate": "2021-01-15T22:00:16Z", "message": "Increment JITServer Minor Version\n\nChange in relocation requires a change to the minor version.\n\nSigned-off-by: Irwin D'Souza <dsouzai.gh@gmail.com>"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "fab721f2a959dc1124701c17d5b228a371436fd3", "author": {"user": {"login": "dsouzai", "name": "Irwin D'Souza"}}, "url": "https://github.com/eclipse-openj9/openj9/commit/fab721f2a959dc1124701c17d5b228a371436fd3", "committedDate": "2021-01-15T22:00:16Z", "message": "Increment JITServer Minor Version\n\nChange in relocation requires a change to the minor version.\n\nSigned-off-by: Irwin D'Souza <dsouzai.gh@gmail.com>"}, "afterCommit": {"oid": "7f9f1c191e6bf155d99a7bfe90ee6a2877e60c80", "author": {"user": {"login": "dsouzai", "name": "Irwin D'Souza"}}, "url": "https://github.com/eclipse-openj9/openj9/commit/7f9f1c191e6bf155d99a7bfe90ee6a2877e60c80", "committedDate": "2021-01-15T22:09:57Z", "message": "Increment JITServer Minor Version\n\nChange in relocation requires a change to the minor version.\n\nSigned-off-by: Irwin D'Souza <dsouzai.gh@gmail.com>"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "7f9f1c191e6bf155d99a7bfe90ee6a2877e60c80", "author": {"user": {"login": "dsouzai", "name": "Irwin D'Souza"}}, "url": "https://github.com/eclipse-openj9/openj9/commit/7f9f1c191e6bf155d99a7bfe90ee6a2877e60c80", "committedDate": "2021-01-15T22:09:57Z", "message": "Increment JITServer Minor Version\n\nChange in relocation requires a change to the minor version.\n\nSigned-off-by: Irwin D'Souza <dsouzai.gh@gmail.com>"}, "afterCommit": {"oid": "9ccd2004b45fe3ba93c2c6f33874d5c58da4016b", "author": {"user": {"login": "dsouzai", "name": "Irwin D'Souza"}}, "url": "https://github.com/eclipse-openj9/openj9/commit/9ccd2004b45fe3ba93c2c6f33874d5c58da4016b", "committedDate": "2021-01-20T16:25:34Z", "message": "Increment JITServer Minor Version\n\nChange in relocation requires a change to the minor version.\n\nSigned-off-by: Irwin D'Souza <dsouzai.gh@gmail.com>"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "9ccd2004b45fe3ba93c2c6f33874d5c58da4016b", "author": {"user": {"login": "dsouzai", "name": "Irwin D'Souza"}}, "url": "https://github.com/eclipse-openj9/openj9/commit/9ccd2004b45fe3ba93c2c6f33874d5c58da4016b", "committedDate": "2021-01-20T16:25:34Z", "message": "Increment JITServer Minor Version\n\nChange in relocation requires a change to the minor version.\n\nSigned-off-by: Irwin D'Souza <dsouzai.gh@gmail.com>"}, "afterCommit": {"oid": "69b3a7b0886ec4abd7bbcda3f5823ed5d3d03974", "author": {"user": {"login": "dsouzai", "name": "Irwin D'Souza"}}, "url": "https://github.com/eclipse-openj9/openj9/commit/69b3a7b0886ec4abd7bbcda3f5823ed5d3d03974", "committedDate": "2021-01-21T22:49:41Z", "message": "Increment JITServer Minor Version\n\nChange in relocation requires a change to the minor version.\n\nSigned-off-by: Irwin D'Souza <dsouzai.gh@gmail.com>"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "69b3a7b0886ec4abd7bbcda3f5823ed5d3d03974", "author": {"user": {"login": "dsouzai", "name": "Irwin D'Souza"}}, "url": "https://github.com/eclipse-openj9/openj9/commit/69b3a7b0886ec4abd7bbcda3f5823ed5d3d03974", "committedDate": "2021-01-21T22:49:41Z", "message": "Increment JITServer Minor Version\n\nChange in relocation requires a change to the minor version.\n\nSigned-off-by: Irwin D'Souza <dsouzai.gh@gmail.com>"}, "afterCommit": {"oid": "ccc02b6ec67a2bb4ab253badd0ceed93a8d131f2", "author": {"user": {"login": "dsouzai", "name": "Irwin D'Souza"}}, "url": "https://github.com/eclipse-openj9/openj9/commit/ccc02b6ec67a2bb4ab253badd0ceed93a8d131f2", "committedDate": "2021-01-25T15:40:17Z", "message": "Increment JITServer Minor Version\n\nChange in relocation requires a change to the minor version.\n\nSigned-off-by: Irwin D'Souza <dsouzai.gh@gmail.com>"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "ccc02b6ec67a2bb4ab253badd0ceed93a8d131f2", "author": {"user": {"login": "dsouzai", "name": "Irwin D'Souza"}}, "url": "https://github.com/eclipse-openj9/openj9/commit/ccc02b6ec67a2bb4ab253badd0ceed93a8d131f2", "committedDate": "2021-01-25T15:40:17Z", "message": "Increment JITServer Minor Version\n\nChange in relocation requires a change to the minor version.\n\nSigned-off-by: Irwin D'Souza <dsouzai.gh@gmail.com>"}, "afterCommit": {"oid": "1f159fa19427a49d68883cb635460e57d0916cd2", "author": {"user": {"login": "dsouzai", "name": "Irwin D'Souza"}}, "url": "https://github.com/eclipse-openj9/openj9/commit/1f159fa19427a49d68883cb635460e57d0916cd2", "committedDate": "2021-01-29T15:15:19Z", "message": "Increment JITServer Minor Version\n\nChange in relocation requires a change to the minor version.\n\nSigned-off-by: Irwin D'Souza <dsouzai.gh@gmail.com>"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "1f159fa19427a49d68883cb635460e57d0916cd2", "author": {"user": {"login": "dsouzai", "name": "Irwin D'Souza"}}, "url": "https://github.com/eclipse-openj9/openj9/commit/1f159fa19427a49d68883cb635460e57d0916cd2", "committedDate": "2021-01-29T15:15:19Z", "message": "Increment JITServer Minor Version\n\nChange in relocation requires a change to the minor version.\n\nSigned-off-by: Irwin D'Souza <dsouzai.gh@gmail.com>"}, "afterCommit": {"oid": "803a57af245cabf85e69f5c9fb63a7ab80ff03c0", "author": {"user": {"login": "dsouzai", "name": "Irwin D'Souza"}}, "url": "https://github.com/eclipse-openj9/openj9/commit/803a57af245cabf85e69f5c9fb63a7ab80ff03c0", "committedDate": "2021-01-29T15:23:56Z", "message": "Increment JITServer Minor Version\n\nChange in relocation requires a change to the minor version.\n\nSigned-off-by: Irwin D'Souza <dsouzai.gh@gmail.com>"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "803a57af245cabf85e69f5c9fb63a7ab80ff03c0", "author": {"user": {"login": "dsouzai", "name": "Irwin D'Souza"}}, "url": "https://github.com/eclipse-openj9/openj9/commit/803a57af245cabf85e69f5c9fb63a7ab80ff03c0", "committedDate": "2021-01-29T15:23:56Z", "message": "Increment JITServer Minor Version\n\nChange in relocation requires a change to the minor version.\n\nSigned-off-by: Irwin D'Souza <dsouzai.gh@gmail.com>"}, "afterCommit": {"oid": "dd6f692bf13339ea04809af9580b34e4c5fe32fc", "author": {"user": {"login": "dsouzai", "name": "Irwin D'Souza"}}, "url": "https://github.com/eclipse-openj9/openj9/commit/dd6f692bf13339ea04809af9580b34e4c5fe32fc", "committedDate": "2021-02-05T18:34:52Z", "message": "Increment JITServer Minor Version\n\nChange in relocation requires a change to the minor version.\n\nSigned-off-by: Irwin D'Souza <dsouzai.gh@gmail.com>"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "dd6f692bf13339ea04809af9580b34e4c5fe32fc", "author": {"user": {"login": "dsouzai", "name": "Irwin D'Souza"}}, "url": "https://github.com/eclipse-openj9/openj9/commit/dd6f692bf13339ea04809af9580b34e4c5fe32fc", "committedDate": "2021-02-05T18:34:52Z", "message": "Increment JITServer Minor Version\n\nChange in relocation requires a change to the minor version.\n\nSigned-off-by: Irwin D'Souza <dsouzai.gh@gmail.com>"}, "afterCommit": {"oid": "8df7e82a62547b5a33bf6c8d5e8ac95791af47c3", "author": {"user": {"login": "dsouzai", "name": "Irwin D'Souza"}}, "url": "https://github.com/eclipse-openj9/openj9/commit/8df7e82a62547b5a33bf6c8d5e8ac95791af47c3", "committedDate": "2021-02-08T22:36:01Z", "message": "Update JITServer minor version\n\nChanges to the relo infra requires updating the JITServer minor version.\n\nSigned-off-by: Irwin D'Souza <dsouzai.gh@gmail.com>"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "8df7e82a62547b5a33bf6c8d5e8ac95791af47c3", "author": {"user": {"login": "dsouzai", "name": "Irwin D'Souza"}}, "url": "https://github.com/eclipse-openj9/openj9/commit/8df7e82a62547b5a33bf6c8d5e8ac95791af47c3", "committedDate": "2021-02-08T22:36:01Z", "message": "Update JITServer minor version\n\nChanges to the relo infra requires updating the JITServer minor version.\n\nSigned-off-by: Irwin D'Souza <dsouzai.gh@gmail.com>"}, "afterCommit": {"oid": "e5505132759954bdd80f606304dbaa2b2f5b37c1", "author": {"user": {"login": "dsouzai", "name": "Irwin D'Souza"}}, "url": "https://github.com/eclipse-openj9/openj9/commit/e5505132759954bdd80f606304dbaa2b2f5b37c1", "committedDate": "2021-02-09T15:13:05Z", "message": "Update Copyrights\n\nSigned-off-by: Irwin D'Souza <dsouzai.gh@gmail.com>"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTg3MjM0NTEy", "url": "https://github.com/eclipse-openj9/openj9/pull/11554#pullrequestreview-587234512", "createdAt": "2021-02-10T04:07:02Z", "commit": {"oid": "02911c8ed0e4b6a8ce4c3afe77122f8bf5987427"}, "state": "COMMENTED", "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wMi0xMFQwNDowNzowMlrOIi3fXA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wMi0xMFQxNToyNjo1MlrOIjPcgw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU3MzQzMTY0NA==", "bodyText": "This may need corresponding changes in JITClientCommitVirtualGuard", "url": "https://github.com/eclipse-openj9/openj9/pull/11554#discussion_r573431644", "createdAt": "2021-02-10T04:07:02Z", "author": {"login": "mpirvu"}, "path": "runtime/compiler/env/CHTable.cpp", "diffHunk": "@@ -618,12 +618,17 @@ TR_CHTable::commitVirtualGuard(TR_VirtualGuard *info, List<TR_VirtualGuardSite>\n       TR_ResolvedMethod *breakpointedMethod = comp->getInlinedResolvedMethod(info->getCalleeIndex());\n       TR_OpaqueMethodBlock *method = breakpointedMethod->getPersistentIdentifier();\n       if (comp->fej9()->isMethodBreakpointed(method))\n+         {\n          nopAssumptionIsValid = false;\n-      ListIterator<TR_VirtualGuardSite> it(&sites);\n-      for (TR_VirtualGuardSite *site = it.getFirst(); site; site = it.getNext())\n+         }\n+      else\n          {\n-         TR_PatchNOPedGuardSiteOnMethodBreakPoint\n-            ::make(comp->fe(), comp->trPersistentMemory(), method, site->getLocation(), site->getDestination(), comp->getMetadataAssumptionList());\n+         ListIterator<TR_VirtualGuardSite> it(&sites);\n+         for (TR_VirtualGuardSite *site = it.getFirst(); site; site = it.getNext())\n+            {\n+            TR_PatchNOPedGuardSiteOnMethodBreakPoint\n+               ::make(comp->fe(), comp->trPersistentMemory(), method, site->getLocation(), site->getDestination(), comp->getMetadataAssumptionList());\n+            }", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "02911c8ed0e4b6a8ce4c3afe77122f8bf5987427"}, "originalPosition": 18}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU3MzQzNjQyMQ==", "bodyText": "I am guessing that those two bits are J9_JIT_METADATA_WIDE_EXCEPTIONS | J9_JIT_METADATA_HAS_BYTECODE_PC\nmaybe we can use code like below  numExcptionRanges &= ~(J9_JIT_METADATA_WIDE_EXCEPTIONS | J9_JIT_METADATA_HAS_BYTECODE_PC); to make it more explicit?", "url": "https://github.com/eclipse-openj9/openj9/pull/11554#discussion_r573436421", "createdAt": "2021-02-10T04:24:39Z", "author": {"login": "mpirvu"}, "path": "runtime/compiler/runtime/RelocationRuntime.cpp", "diffHunk": "@@ -544,37 +544,16 @@ TR_RelocationRuntime::relocateAOTCodeAndData(U_8 *tempDataStart,\n             }\n          }\n \n-#if 0\n-      // add this in later...\n-      /* Perform meta-data relocations */\n-      if (_aotMethodHeaderEntry->offsetToMetaDataRelocations != 0)\n-         {\n-         TR_RelocationRecordBinaryTemplate * binaryReloRecords = (TR_RelocationRecordBinaryTemplate * )((U_8 *)_aotMethodHeaderEntry - sizeof(J9JITDataCacheHeader) + _aotMethodHeaderEntry->offsetToMetaDataRelocationItems);\n-         TR_RelocationRecordGroup reloGroup(binaryReloRecords);\n-         int rc = reloGroup.applyRelocations(this, reloTarget, _exceptionTable);\n-         if (rc != 0)\n-            {\n-            _relocationStatus = RelocationFailure;\n-            return;\n-            }\n-         }\n-#endif\n-\n       reloTarget()->flushCache(codeStart, _aotMethodHeaderEntry->compileMethodCodeSize);\n \n-#if 1\n       // replace this with meta-data relocations above when we implement it\n \n       /* Fix up inlined exception table ram method entries if wide */\n       if (((UDATA)_exceptionTable->numExcptionRanges) & J9_JIT_METADATA_WIDE_EXCEPTIONS)\n          {\n          // Highest 2 bits indicate wide exceptions and FSD, unset them and extract\n          // the number of exception ranges\n-         UDATA numExcptionRanges = ((UDATA)_exceptionTable->numExcptionRanges) & 0x7fff;\n-#if defined(J9VM_OPT_JITSERVER)\n-         if (_comp->getOption(TR_FullSpeedDebug))\n-            numExcptionRanges &= ~(J9_JIT_METADATA_WIDE_EXCEPTIONS | J9_JIT_METADATA_HAS_BYTECODE_PC);\n-#endif /* defined(J9VM_OPT_JITSERVER) */\n+         uint16_t numExcptionRanges = _exceptionTable->numExcptionRanges & 0x3fff;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "bb86cf5cab7341f2698c08e2f3e5d46f6562b64a"}, "originalPosition": 35}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU3MzgyNDEzMQ==", "bodyText": "I think a comment is warranted here explaining why we exclude FSD from doing warm AOT", "url": "https://github.com/eclipse-openj9/openj9/pull/11554#discussion_r573824131", "createdAt": "2021-02-10T15:26:52Z", "author": {"login": "mpirvu"}, "path": "runtime/compiler/control/CompilationThread.cpp", "diffHunk": "@@ -8182,7 +8182,8 @@ TR::CompilationInfoPerThreadBase::wrappedCompile(J9PortLibrary *portLib, void *\n             TR_ASSERT(!that->_methodBeingCompiled->isOutOfProcessCompReq(), \"JITServer should not change options passed by client\");\n #endif /* defined(J9VM_OPT_JITSERVER) */\n             bool aotCompilationReUpgradedToWarm = false;\n-            if (that->_methodBeingCompiled->_useAotCompilation)\n+            if (that->_methodBeingCompiled->_useAotCompilation\n+                && !TR::Options::getCmdLineOptions()->getOption(TR_FullSpeedDebug))", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "755fedeb5c841c06d0a4bc18e4335645317b1d05"}, "originalPosition": 6}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "e5505132759954bdd80f606304dbaa2b2f5b37c1", "author": {"user": {"login": "dsouzai", "name": "Irwin D'Souza"}}, "url": "https://github.com/eclipse-openj9/openj9/commit/e5505132759954bdd80f606304dbaa2b2f5b37c1", "committedDate": "2021-02-09T15:13:05Z", "message": "Update Copyrights\n\nSigned-off-by: Irwin D'Souza <dsouzai.gh@gmail.com>"}, "afterCommit": {"oid": "33bad76388de71aa004e07be78b7ab8c9e92b9fb", "author": {"user": {"login": "dsouzai", "name": "Irwin D'Souza"}}, "url": "https://github.com/eclipse-openj9/openj9/commit/33bad76388de71aa004e07be78b7ab8c9e92b9fb", "committedDate": "2021-02-10T16:28:01Z", "message": "Update Copyrights\n\nSigned-off-by: Irwin D'Souza <dsouzai.gh@gmail.com>"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "33bad76388de71aa004e07be78b7ab8c9e92b9fb", "author": {"user": {"login": "dsouzai", "name": "Irwin D'Souza"}}, "url": "https://github.com/eclipse-openj9/openj9/commit/33bad76388de71aa004e07be78b7ab8c9e92b9fb", "committedDate": "2021-02-10T16:28:01Z", "message": "Update Copyrights\n\nSigned-off-by: Irwin D'Souza <dsouzai.gh@gmail.com>"}, "afterCommit": {"oid": "0d6a0022269347d0b22782677c889a3751cefe6a", "author": {"user": {"login": "dsouzai", "name": "Irwin D'Souza"}}, "url": "https://github.com/eclipse-openj9/openj9/commit/0d6a0022269347d0b22782677c889a3751cefe6a", "committedDate": "2021-02-10T18:16:07Z", "message": "Update Copyrights\n\nSigned-off-by: Irwin D'Souza <dsouzai.gh@gmail.com>"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTg4NzA0Njg1", "url": "https://github.com/eclipse-openj9/openj9/pull/11554#pullrequestreview-588704685", "createdAt": "2021-02-11T15:49:43Z", "commit": {"oid": "0d6a0022269347d0b22782677c889a3751cefe6a"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "0d6a0022269347d0b22782677c889a3751cefe6a", "author": {"user": {"login": "dsouzai", "name": "Irwin D'Souza"}}, "url": "https://github.com/eclipse-openj9/openj9/commit/0d6a0022269347d0b22782677c889a3751cefe6a", "committedDate": "2021-02-10T18:16:07Z", "message": "Update Copyrights\n\nSigned-off-by: Irwin D'Souza <dsouzai.gh@gmail.com>"}, "afterCommit": {"oid": "a4fab1f898e9daecdc58dfdd5c850bc8508804b5", "author": {"user": {"login": "dsouzai", "name": "Irwin D'Souza"}}, "url": "https://github.com/eclipse-openj9/openj9/commit/a4fab1f898e9daecdc58dfdd5c850bc8508804b5", "committedDate": "2021-02-11T16:16:37Z", "message": "Update Copyrights\n\nSigned-off-by: Irwin D'Souza <dsouzai.gh@gmail.com>"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTg5MDM4OTAz", "url": "https://github.com/eclipse-openj9/openj9/pull/11554#pullrequestreview-589038903", "createdAt": "2021-02-11T22:24:46Z", "commit": {"oid": "23d89a50e80c81fa91d55122299f6c83a321bcc8"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wMi0xMVQyMjoyNDo0NlrOIkPNdg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wMi0xMVQyMjoyNDo0NlrOIkPNdg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU3NDg2ODg1NA==", "bodyText": "This commit deserves a non-empty message summarizing these changes :) .", "url": "https://github.com/eclipse-openj9/openj9/pull/11554#discussion_r574868854", "createdAt": "2021-02-11T22:24:46Z", "author": {"login": "mstoodle"}, "path": "runtime/compiler/codegen/J9AheadOfTimeCompile.cpp", "diffHunk": "@@ -1150,6 +1150,18 @@ J9::AheadOfTimeCompile::initializeCommonAOTRelocationHeader(TR::IteratedExternal\n          }\n          break;\n \n+      case TR_Breakpoint:", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "23d89a50e80c81fa91d55122299f6c83a321bcc8"}, "originalPosition": 4}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTkxNzAwMzcw", "url": "https://github.com/eclipse-openj9/openj9/pull/11554#pullrequestreview-591700370", "createdAt": "2021-02-16T23:05:14Z", "commit": {"oid": "13eecaf41e75acf030a9fb7ab8cb8f8e35450989"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wMi0xNlQyMzowNToxNFrOImdjxg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wMi0xNlQyMzowNTozOVrOImdkiQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU3NzIwMTA5NA==", "bodyText": "imo a better way to do this would be to create a new relocation record that does the inlining relocation as you want it, rather than using the existing MethodPointer relocation. That would avoid storing empty payload data as a flag to \"process this one differently\".", "url": "https://github.com/eclipse-openj9/openj9/pull/11554#discussion_r577201094", "createdAt": "2021-02-16T23:05:14Z", "author": {"login": "mstoodle"}, "path": "runtime/compiler/codegen/J9AheadOfTimeCompile.cpp", "diffHunk": "@@ -546,12 +546,27 @@ J9::AheadOfTimeCompile::initializeCommonAOTRelocationHeader(TR::IteratedExternal\n          if (aconstNode->getOpCodeValue() == TR::loadaddr)\n             j9method = reinterpret_cast<TR_OpaqueMethodBlock *>(aconstNode->getSymbolReference()->getSymbol()->castToStaticSymbol()->getStaticAddress());\n \n-         TR_OpaqueClassBlock *j9class = fej9->getClassFromMethodBlock(j9method);\n+         TR_InlinedCallSite & ics = comp->getInlinedCallSite(inlinedSiteIndex);\n+         TR_ResolvedMethod *inlinedMethod = ((TR_AOTMethodInfo *)ics._methodInfo)->resolvedMethod;\n+         TR_OpaqueMethodBlock *inlinedJ9Method = inlinedMethod->getPersistentIdentifier();\n \n-         uintptr_t classChainOffsetOfCLInSharedCache = sharedCache->getClassChainOffsetOfIdentifyingLoaderForClazzInSharedCache(j9class);\n-         uintptr_t classChainForInlinedMethodOffsetInSharedCache = self()->getClassChainOffset(j9class);\n+         uintptr_t classChainOffsetOfCLInSharedCache = 0;\n+         uintptr_t classChainForInlinedMethodOffsetInSharedCache = 0;\n+         uintptr_t vTableOffset = 0;\n \n-         uintptr_t vTableOffset = static_cast<uintptr_t>(fej9->getInterpreterVTableSlot(j9method, j9class));\n+         /* If the j9method from the aconst node is the same as the j9method at\n+          * inlined call site at inlinedSiteIndex, don't set the remaining fields\n+          * in the binary template; at relo time, the inlined site index is\n+          * sufficient to materialize the j9method pointer\n+          */\n+         if (j9method != inlinedJ9Method)", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "13eecaf41e75acf030a9fb7ab8cb8f8e35450989"}, "originalPosition": 21}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU3NzIwMTI4OQ==", "bodyText": "Please improve the commit summary \"MethodPointer Relo Change\" isn't the most generic you could have made it, but I think you could do better.", "url": "https://github.com/eclipse-openj9/openj9/pull/11554#discussion_r577201289", "createdAt": "2021-02-16T23:05:39Z", "author": {"login": "mstoodle"}, "path": "runtime/compiler/codegen/J9AheadOfTimeCompile.cpp", "diffHunk": "@@ -546,12 +546,27 @@ J9::AheadOfTimeCompile::initializeCommonAOTRelocationHeader(TR::IteratedExternal\n          if (aconstNode->getOpCodeValue() == TR::loadaddr)\n             j9method = reinterpret_cast<TR_OpaqueMethodBlock *>(aconstNode->getSymbolReference()->getSymbol()->castToStaticSymbol()->getStaticAddress());\n \n-         TR_OpaqueClassBlock *j9class = fej9->getClassFromMethodBlock(j9method);\n+         TR_InlinedCallSite & ics = comp->getInlinedCallSite(inlinedSiteIndex);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "13eecaf41e75acf030a9fb7ab8cb8f8e35450989"}, "originalPosition": 5}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "04c099af026cbc7609fdf89aa4c11b1d995bf4a1", "author": {"user": {"login": "dsouzai", "name": "Irwin D'Souza"}}, "url": "https://github.com/eclipse-openj9/openj9/commit/04c099af026cbc7609fdf89aa4c11b1d995bf4a1", "committedDate": "2021-02-17T18:59:10Z", "message": "Add BreakPoint Guard relocation\n\nThere will be a TR_BreakpointGuard created for every single inlined\nsite. This relocation record grabs the J9Method from the recently\nrelocated inlining table in the metadata assocated with the inlined site\nspecified in the record, and creates necessary method breakpoint runtime\nassumption. If the method has already been breakpointed, the\nrelolocation is patched to jump to the guard's destination.\n\nSigned-off-by: Irwin D'Souza <dsouzai.gh@gmail.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c1883f88a2e44f16c18ccc810d8484bd7b527a68", "author": {"user": {"login": "dsouzai", "name": "Irwin D'Souza"}}, "url": "https://github.com/eclipse-openj9/openj9/commit/c1883f88a2e44f16c18ccc810d8484bd7b527a68", "committedDate": "2021-02-17T19:02:52Z", "message": "Refactor method breakpoint hook\n\nThe code that compensated all the runtime assumptions that get fired on\na method breakpoint did not have any tracing. Addtionally, it is\nconceptually very similar to what has to happen for the assumptions\nduring class redefinition. Therefore, this commit refactors the method\nbreakpoint hook to be more consistent with the rest of the runtime\nassumption compensation mechanism.\n\nSigned-off-by: Irwin D'Souza <dsouzai.gh@gmail.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "5fce7993bbfc672e88537f4f2c2b103425b33147", "author": {"user": {"login": "dsouzai", "name": "Irwin D'Souza"}}, "url": "https://github.com/eclipse-openj9/openj9/commit/5fce7993bbfc672e88537f4f2c2b103425b33147", "committedDate": "2021-02-17T19:04:40Z", "message": "Enable FSD for AOT Compilations\n\nThis commit enables AOT compilations in FSD mode. However, if fields are\nbeing watched, then AOT compilation is disabled. This is because there\nis no benefit to having an AOT body with field watch as it increases\nthe validation complexity, and in case the fields being watched changes\nfrom run to run, the AOT body cannot be loaded.\n\nThis commit also adds FSD to the feature flags; this ensures that if the\nSCC contains code that was generated when running in FSD mode, it is\nonly loaded when the JVM is running in FSD mode (and vice versa).\n\nSigned-off-by: Irwin D'Souza <dsouzai.gh@gmail.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "869c82b7b5147749048b98e96032da011247a010", "author": {"user": {"login": "dsouzai", "name": "Irwin D'Souza"}}, "url": "https://github.com/eclipse-openj9/openj9/commit/869c82b7b5147749048b98e96032da011247a010", "committedDate": "2021-02-17T19:08:22Z", "message": "Improve FSD Startup Performance\n\nThis commit adds a couple of improvements. Firstly, under FSD there is\nno need to emit method enter/exit hooks because the events are hooked\nvia involuntary OSR. Secondly, don't generate AOT warm compilations\nduring startup. When FSD is enabled, involuntary OSR is also enabled.\nThis means that the code size increases because of all of the catch\nblock + code blocks, and the data size increases because of the\nadditional information required in the the J9JITExceptionTable. This\nmeans that for applications that do not use a very large SCC, the\nnumber of methods that can now be put into the SCC reduces. In this\nscenario, startup is dominated by the number of AOT loads can that be\nperformed rather than code quality. Therefore, disabling AOT Warm\nduring startup disables inlining, thus dramatically reducing the code\n& data size.\n\nSigned-off-by: Irwin D'Souza <dsouzai.gh@gmail.com>"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "a4fab1f898e9daecdc58dfdd5c850bc8508804b5", "author": {"user": {"login": "dsouzai", "name": "Irwin D'Souza"}}, "url": "https://github.com/eclipse-openj9/openj9/commit/a4fab1f898e9daecdc58dfdd5c850bc8508804b5", "committedDate": "2021-02-11T16:16:37Z", "message": "Update Copyrights\n\nSigned-off-by: Irwin D'Souza <dsouzai.gh@gmail.com>"}, "afterCommit": {"oid": "5870afe30755263b53dcb528fef9505cf5b991fb", "author": {"user": {"login": "dsouzai", "name": "Irwin D'Souza"}}, "url": "https://github.com/eclipse-openj9/openj9/commit/5870afe30755263b53dcb528fef9505cf5b991fb", "committedDate": "2021-02-17T19:08:57Z", "message": "Update Copyrights\n\nSigned-off-by: Irwin D'Souza <dsouzai.gh@gmail.com>"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "5870afe30755263b53dcb528fef9505cf5b991fb", "author": {"user": {"login": "dsouzai", "name": "Irwin D'Souza"}}, "url": "https://github.com/eclipse-openj9/openj9/commit/5870afe30755263b53dcb528fef9505cf5b991fb", "committedDate": "2021-02-17T19:08:57Z", "message": "Update Copyrights\n\nSigned-off-by: Irwin D'Souza <dsouzai.gh@gmail.com>"}, "afterCommit": {"oid": "d11a837eafbc2a6a2406558cce5d4defaaa09ac9", "author": {"user": {"login": "dsouzai", "name": "Irwin D'Souza"}}, "url": "https://github.com/eclipse-openj9/openj9/commit/d11a837eafbc2a6a2406558cce5d4defaaa09ac9", "committedDate": "2021-02-17T21:54:18Z", "message": "Update Copyrights\n\nSigned-off-by: Irwin D'Souza <dsouzai.gh@gmail.com>"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTkzMzcyOTkx", "url": "https://github.com/eclipse-openj9/openj9/pull/11554#pullrequestreview-593372991", "createdAt": "2021-02-18T15:57:47Z", "commit": {"oid": "75acda74099cd2581eecf411e14ecf3214d49e88"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wMi0xOFQxNTo1Nzo0N1rOInvGZA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wMi0xOFQxNTo1Nzo0N1rOInvGZA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU3ODUzNzA2MA==", "bodyText": "would you please add an assert on the else here that\nreloPrivatData->_clazz == reinterpret_cast<TR_OpaqueClassBlock *>(-1)", "url": "https://github.com/eclipse-openj9/openj9/pull/11554#discussion_r578537060", "createdAt": "2021-02-18T15:57:47Z", "author": {"login": "mstoodle"}, "path": "runtime/compiler/runtime/RelocationRecord.cpp", "diffHunk": "@@ -5684,6 +5687,74 @@ TR_RelocationRecordMethodPointer::activatePointer(TR_RelocationRuntime *reloRunt\n       registerHCRAssumption(reloRuntime, reloLocation);\n    }\n \n+char *\n+TR_RelocationRecordInlinedMethodPointer::name()\n+   {\n+   return \"TR_InlinedMethodPointer\";\n+   }\n+\n+void\n+TR_RelocationRecordInlinedMethodPointer::preparePrivateData(TR_RelocationRuntime *reloRuntime, TR_RelocationTarget *reloTarget)\n+   {\n+   TR_RelocationRecordPointerPrivateData *reloPrivateData = &(privateData()->pointer);\n+      J9Method *inlinedMethod =\n+            reinterpret_cast<J9Method *>(\n+               getInlinedSiteMethod(reloRuntime, inlinedSiteIndex(reloTarget)));\n+\n+   if (inlinedMethod != reinterpret_cast<J9Method *>(-1))\n+      {\n+      reloPrivateData->_activatePointer = true;\n+      reloPrivateData->_clazz = reinterpret_cast<TR_OpaqueClassBlock *>(J9_CLASS_FROM_METHOD(inlinedMethod));\n+      reloPrivateData->_pointer = reinterpret_cast<uintptr_t>(inlinedMethod);\n+      reloPrivateData->_needUnloadAssumption =\n+            !reloRuntime->fej9()->sameClassLoaders(\n+               reloPrivateData->_clazz,\n+               reloRuntime->comp()->getCurrentMethod()->classOfMethod());\n+\n+      RELO_LOG(reloRuntime->reloLogger(), 6,\"\\tpreparePrivateData: pointer %p\\n\", reloPrivateData->_pointer);\n+      }\n+   else\n+      {\n+      reloPrivateData->_activatePointer = false;\n+      reloPrivateData->_clazz = reinterpret_cast<TR_OpaqueClassBlock *>(-1);\n+      reloPrivateData->_pointer = static_cast<uintptr_t>(-1);\n+      reloPrivateData->_needUnloadAssumption = false;\n+\n+      RELO_LOG(reloRuntime->reloLogger(), 6,\"\\tpreparePrivateData: invalid site\\n\");\n+      }\n+   }\n+\n+int32_t\n+TR_RelocationRecordInlinedMethodPointer::applyRelocation(TR_RelocationRuntime *reloRuntime, TR_RelocationTarget *reloTarget, uint8_t *reloLocation)\n+   {\n+   TR_RelocationRecordPointerPrivateData *reloPrivateData = &(privateData()->pointer);\n+\n+   /* Apply relocation */\n+   reloTarget->storePointer((uint8_t *)reloPrivateData->_pointer, reloLocation);\n+\n+   if (reloPrivateData->_activatePointer)\n+      {\n+      /* Add class unload assumptions if needed */\n+      if (reloPrivateData->_needUnloadAssumption)\n+         reloTarget->addPICtoPatchPtrOnClassUnload(reloPrivateData->_clazz, reloLocation);\n+\n+      /* Add HCR assumptions if needed */\n+      if (reloRuntime->options()->getOption(TR_EnableHCR))\n+         {\n+         createClassRedefinitionPicSite(\n+                  reinterpret_cast<void *>(reloPrivateData->_pointer),\n+                  reinterpret_cast<void *>(reloLocation),\n+                  sizeof(uintptr_t),\n+                  false,\n+                  reloRuntime->comp()->getMetadataAssumptionList());\n+\n+         reloRuntime->comp()->setHasClassRedefinitionAssumptions();\n+         }\n+      }", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "75acda74099cd2581eecf411e14ecf3214d49e88"}, "originalPosition": 77}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "52388222d7526df0b2f4c0fa4bf102b74b75d5b1", "author": {"user": {"login": "dsouzai", "name": "Irwin D'Souza"}}, "url": "https://github.com/eclipse-openj9/openj9/commit/52388222d7526df0b2f4c0fa4bf102b74b75d5b1", "committedDate": "2021-02-18T16:20:15Z", "message": "Add Inlined Method Pointer relo record\n\nThe TR_MethodPointer relocation record is more general and assumes that\nthe method pointer to be relocated may not be named in the bytecodes (ie\ncame from profiling). However, often the method pointer will already\nexist in the inlining table in the J9JITExceptionTable. Therefore, this\ncommit adds a new relocation record to use the J9Method pointer from the\ninlining table if the method pointer to be relocated does exist in the\ntable.\n\nSigned-off-by: Irwin D'Souza <dsouzai.gh@gmail.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c90f393805fb6cb06d23fdfb40d00f7e9adfdecc", "author": {"user": {"login": "dsouzai", "name": "Irwin D'Souza"}}, "url": "https://github.com/eclipse-openj9/openj9/commit/c90f393805fb6cb06d23fdfb40d00f7e9adfdecc", "committedDate": "2021-02-18T16:20:17Z", "message": "Conditionally Transmute TR_MethodPointer to TR_InlinedMethodPointer\n\nTo ensure that a method pointer is relocated with the correct relocation\nrecord, J9::AheadOfTimeCompile::interceptAOTRelocation is used to\nintercept a TR_MethodPointer relocation record and transmute it to\nTR_InlinedMethodPointer if the J9Method pointer in the inlining\ntable at the inlined site index specified by the aconst node associated\nwith the TR_MethodPointer relocation record is the same as the J9Method\npointer associated with the aconst node.\n\nSigned-off-by: Irwin D'Souza <dsouzai.gh@gmail.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f7d2400dd4ac527320e673507df079dd402f8de5", "author": {"user": {"login": "dsouzai", "name": "Irwin D'Souza"}}, "url": "https://github.com/eclipse-openj9/openj9/commit/f7d2400dd4ac527320e673507df079dd402f8de5", "committedDate": "2021-02-18T16:20:17Z", "message": "Update JITServer minor version\n\nChanges to the relo infra requires updating the JITServer minor version.\n\nSigned-off-by: Irwin D'Souza <dsouzai.gh@gmail.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c42e01c60d8540d1c6ed9a4dee2709bc279d73c5", "author": {"user": {"login": "dsouzai", "name": "Irwin D'Souza"}}, "url": "https://github.com/eclipse-openj9/openj9/commit/c42e01c60d8540d1c6ed9a4dee2709bc279d73c5", "committedDate": "2021-02-18T16:20:17Z", "message": "Add ability to disable AOT under FSD\n\nSigned-off-by: Irwin D'Souza <dsouzai.gh@gmail.com>"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "d11a837eafbc2a6a2406558cce5d4defaaa09ac9", "author": {"user": {"login": "dsouzai", "name": "Irwin D'Souza"}}, "url": "https://github.com/eclipse-openj9/openj9/commit/d11a837eafbc2a6a2406558cce5d4defaaa09ac9", "committedDate": "2021-02-17T21:54:18Z", "message": "Update Copyrights\n\nSigned-off-by: Irwin D'Souza <dsouzai.gh@gmail.com>"}, "afterCommit": {"oid": "4a69430d1d1603f0a4a8666a6ca4ed21fedce751", "author": {"user": {"login": "dsouzai", "name": "Irwin D'Souza"}}, "url": "https://github.com/eclipse-openj9/openj9/commit/4a69430d1d1603f0a4a8666a6ca4ed21fedce751", "committedDate": "2021-02-18T16:20:17Z", "message": "Update Copyrights\n\nSigned-off-by: Irwin D'Souza <dsouzai.gh@gmail.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "fb2aad19fdaba0eeb7ce02e2c85c445b00a14977", "author": {"user": {"login": "dsouzai", "name": "Irwin D'Souza"}}, "url": "https://github.com/eclipse-openj9/openj9/commit/fb2aad19fdaba0eeb7ce02e2c85c445b00a14977", "committedDate": "2021-02-19T14:55:48Z", "message": "Update Copyrights\n\nSigned-off-by: Irwin D'Souza <dsouzai.gh@gmail.com>"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "4a69430d1d1603f0a4a8666a6ca4ed21fedce751", "author": {"user": {"login": "dsouzai", "name": "Irwin D'Souza"}}, "url": "https://github.com/eclipse-openj9/openj9/commit/4a69430d1d1603f0a4a8666a6ca4ed21fedce751", "committedDate": "2021-02-18T16:20:17Z", "message": "Update Copyrights\n\nSigned-off-by: Irwin D'Souza <dsouzai.gh@gmail.com>"}, "afterCommit": {"oid": "fb2aad19fdaba0eeb7ce02e2c85c445b00a14977", "author": {"user": {"login": "dsouzai", "name": "Irwin D'Souza"}}, "url": "https://github.com/eclipse-openj9/openj9/commit/fb2aad19fdaba0eeb7ce02e2c85c445b00a14977", "committedDate": "2021-02-19T14:55:48Z", "message": "Update Copyrights\n\nSigned-off-by: Irwin D'Souza <dsouzai.gh@gmail.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "3afec7da8a5a144511fa0193378d4cd00c2c0fb6", "author": {"user": {"login": "dsouzai", "name": "Irwin D'Souza"}}, "url": "https://github.com/eclipse-openj9/openj9/commit/3afec7da8a5a144511fa0193378d4cd00c2c0fb6", "committedDate": "2021-02-25T22:12:14Z", "message": "Disable Recompilation under FSD & Sync Compilation\n\nAn app thread that blocks on compilation releases VM Access. If class\nredefinition occurs during a recompilation, the application thread\ncan no longer OSR out to the interpreter; it is forced to return to\nthe oldStartPC (to jump to a helper) which may not necessarily be\nvalid. Therefore, this commit disables recompilation if the JIT is\ndoing synchronous compilation in FSD mode.\n\nIn a normal run, compilations occur asynchronously. However, there\nare circumstances where a recompilation must be done synchronously.\nThey have to do with method invalidation, specifically preexistence\nand HCR. However, in FSD, preexistence is disabled, and HCR is\nimplemented using involuntary OSR. Therefore, the only\ncircumstance under which sync recompilations can occur under FSD is\nwhen explicitly requested (via counts or disableAsyncCompilation).\n\nSigned-off-by: Irwin D'Souza <dsouzai.gh@gmail.com>"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NjAwOTMxOTYx", "url": "https://github.com/eclipse-openj9/openj9/pull/11554#pullrequestreview-600931961", "createdAt": "2021-03-01T16:34:38Z", "commit": {"oid": "3afec7da8a5a144511fa0193378d4cd00c2c0fb6"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NjAxMjE2NTQx", "url": "https://github.com/eclipse-openj9/openj9/pull/11554#pullrequestreview-601216541", "createdAt": "2021-03-01T22:15:38Z", "commit": {"oid": "3afec7da8a5a144511fa0193378d4cd00c2c0fb6"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wMy0wMVQyMjoxNTozOFrOIt-_vw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wMy0wMVQyMjoxNTozOFrOIt-_vw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU4NTA4ODk1OQ==", "bodyText": "We need to change the definition at JITServer which now reads:\nbool\nTR_J9SharedCacheServerVM::methodsCanBeInlinedEvenIfEventHooksEnabled()\n   {\n   return true;\n   }\n\nThe complication is that we are returning the value from the global options, so I am proposing to add a comp parameter which can be used to retrieve the options: comp->getOption(TR_FullSpeedDebug)", "url": "https://github.com/eclipse-openj9/openj9/pull/11554#discussion_r585088959", "createdAt": "2021-03-01T22:15:38Z", "author": {"login": "mpirvu"}, "path": "runtime/compiler/env/VMJ9.cpp", "diffHunk": "@@ -8254,7 +8254,7 @@ TR_J9SharedCacheVM::canMethodExitEventBeHooked()\n bool\n TR_J9SharedCacheVM::methodsCanBeInlinedEvenIfEventHooksEnabled()\n    {\n-   return true;\n+   return !TR::Options::getCmdLineOptions()->getOption(TR_FullSpeedDebug);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "3afec7da8a5a144511fa0193378d4cd00c2c0fb6"}, "originalPosition": 5}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "6e15af8fa2a907dea4f78cda8bf953e2c0af41a5", "author": {"user": {"login": "dsouzai", "name": "Irwin D'Souza"}}, "url": "https://github.com/eclipse-openj9/openj9/commit/6e15af8fa2a907dea4f78cda8bf953e2c0af41a5", "committedDate": "2021-03-01T22:58:01Z", "message": "Use comp object parameter to methodsCanBeInlinedEvenIfEventHooksEnabled\n\nIn order to ensure that JITServer is consistent with the client, update\nthe methodsCanBeInlinedEvenIfEventHooksEnabled to take in the comp\nobject as a parameter, which can be used to check whether FSD is\nenabled, rather than using the global options object.\n\nSigned-off-by: Irwin D'Souza <dsouzai.gh@gmail.com>"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NjAxMzUxMTI2", "url": "https://github.com/eclipse-openj9/openj9/pull/11554#pullrequestreview-601351126", "createdAt": "2021-03-02T02:27:57Z", "commit": {"oid": "6e15af8fa2a907dea4f78cda8bf953e2c0af41a5"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1426, "cost": 1, "resetAt": "2021-10-28T17:48:14Z"}}}