{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDY4MzAxODE3", "number": 10395, "reviewThreads": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xN1QxNTozNDo1NVrOEZGOQg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xN1QxNTozNTozNFrOEZGPaw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjk0NzUxODEwOnYy", "diffSide": "RIGHT", "path": "runtime/compiler/runtime/RuntimeAssumptions.cpp", "isResolved": true, "comments": {"totalCount": 6, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xN1QxNTozNDo1NVrOHBt5GQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xN1QyMDoxNzowOFrOHB5bHw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MTU2MjUyMQ==", "bodyText": "This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters. Learn more about bidirectional Unicode characters\n\n\n  \n\n\n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n               TR_ASSERT_FATAL((void*)_key != NULL, \"Attempt to reclaim an already freed _key\");\n          \n          \n            \n               TR_ASSERT_FATAL(reinterpret_cast<void *>(_key) != NULL, \"Attempt to reclaim an already freed _key\");", "url": "https://github.com/eclipse-openj9/openj9/pull/10395#discussion_r471562521", "createdAt": "2020-08-17T15:34:55Z", "author": {"login": "dsouzai"}, "path": "runtime/compiler/runtime/RuntimeAssumptions.cpp", "diffHunk": "@@ -85,10 +85,10 @@ TR_PatchNOPedGuardSiteOnClassPreInitialize::hashCode(char *sig, uint32_t sigLen)\n void\n TR_PatchNOPedGuardSiteOnClassPreInitialize::reclaim()\n    {\n-   TR_ASSERT_FATAL(_key != NULL, \"Attempt to reclaim an already freed _key\");\n+   TR_ASSERT_FATAL((void*)_key != NULL, \"Attempt to reclaim an already freed _key\");", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "156e26459cc9b7ea45f35f1e18f9a3b356a669ad"}, "originalPosition": 5}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MTU3NDE1NA==", "bodyText": "I suggest that neither of those changes are appropriate. The field _key is declared with type uintptr_t (a scalar type): 0 is the right value for a freed key.\nTR_ASSERT_FATAL(0 != _key, \"Attempt to reclaim an already freed _key\");", "url": "https://github.com/eclipse-openj9/openj9/pull/10395#discussion_r471574154", "createdAt": "2020-08-17T15:51:50Z", "author": {"login": "keithc-ca"}, "path": "runtime/compiler/runtime/RuntimeAssumptions.cpp", "diffHunk": "@@ -85,10 +85,10 @@ TR_PatchNOPedGuardSiteOnClassPreInitialize::hashCode(char *sig, uint32_t sigLen)\n void\n TR_PatchNOPedGuardSiteOnClassPreInitialize::reclaim()\n    {\n-   TR_ASSERT_FATAL(_key != NULL, \"Attempt to reclaim an already freed _key\");\n+   TR_ASSERT_FATAL((void*)_key != NULL, \"Attempt to reclaim an already freed _key\");", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MTU2MjUyMQ=="}, "originalCommit": {"oid": "156e26459cc9b7ea45f35f1e18f9a3b356a669ad"}, "originalPosition": 5}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MTU4OTY5NQ==", "bodyText": "The ISO C++ standard defers to the ISO C standard, which gives no guarantees on the behavior of (u)intptr_t except that pointers to void may be converted to and from it. It is not guaranteed that all-zero pointers retain the same value when converted to (u)intptr_t. Furthermore, it is not guaranteed that null pointers are represented as all zeroes in the first place. However, as a practical matter, current implementations directly copy the byte representation as an integer, allow integer operations on them, represent null pointers as all zeroes, and are unlikely to change any of those behaviors or make optimization decisions based on them.\nIn conclusion, the cast is more correct, but any of these three alternatives are likely to be equivalent in practice.", "url": "https://github.com/eclipse-openj9/openj9/pull/10395#discussion_r471589695", "createdAt": "2020-08-17T16:16:58Z", "author": {"login": "Hello71"}, "path": "runtime/compiler/runtime/RuntimeAssumptions.cpp", "diffHunk": "@@ -85,10 +85,10 @@ TR_PatchNOPedGuardSiteOnClassPreInitialize::hashCode(char *sig, uint32_t sigLen)\n void\n TR_PatchNOPedGuardSiteOnClassPreInitialize::reclaim()\n    {\n-   TR_ASSERT_FATAL(_key != NULL, \"Attempt to reclaim an already freed _key\");\n+   TR_ASSERT_FATAL((void*)_key != NULL, \"Attempt to reclaim an already freed _key\");", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MTU2MjUyMQ=="}, "originalCommit": {"oid": "156e26459cc9b7ea45f35f1e18f9a3b356a669ad"}, "originalPosition": 5}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MTY2Mzk2OQ==", "bodyText": "If (0 != (uintptr_t)NULL) then we'll have lots of broken code.\nI still favour 0, for consistency with other places that use uintptr_t.\n_key is not a pointer, so none of the properties of pointers are relevant.", "url": "https://github.com/eclipse-openj9/openj9/pull/10395#discussion_r471663969", "createdAt": "2020-08-17T17:58:23Z", "author": {"login": "keithc-ca"}, "path": "runtime/compiler/runtime/RuntimeAssumptions.cpp", "diffHunk": "@@ -85,10 +85,10 @@ TR_PatchNOPedGuardSiteOnClassPreInitialize::hashCode(char *sig, uint32_t sigLen)\n void\n TR_PatchNOPedGuardSiteOnClassPreInitialize::reclaim()\n    {\n-   TR_ASSERT_FATAL(_key != NULL, \"Attempt to reclaim an already freed _key\");\n+   TR_ASSERT_FATAL((void*)_key != NULL, \"Attempt to reclaim an already freed _key\");", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MTU2MjUyMQ=="}, "originalCommit": {"oid": "156e26459cc9b7ea45f35f1e18f9a3b356a669ad"}, "originalPosition": 5}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MTc1MDcwMg==", "bodyText": "yeah, I think we can ignore (0 != (uintptr_t)NULL) for now. it would break a huge amount of existing code in other projects too, and AFAIK doesn't have any good optimization rationale. @dsouzai are you OK with 0 != _key here?", "url": "https://github.com/eclipse-openj9/openj9/pull/10395#discussion_r471750702", "createdAt": "2020-08-17T20:15:37Z", "author": {"login": "Hello71"}, "path": "runtime/compiler/runtime/RuntimeAssumptions.cpp", "diffHunk": "@@ -85,10 +85,10 @@ TR_PatchNOPedGuardSiteOnClassPreInitialize::hashCode(char *sig, uint32_t sigLen)\n void\n TR_PatchNOPedGuardSiteOnClassPreInitialize::reclaim()\n    {\n-   TR_ASSERT_FATAL(_key != NULL, \"Attempt to reclaim an already freed _key\");\n+   TR_ASSERT_FATAL((void*)_key != NULL, \"Attempt to reclaim an already freed _key\");", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MTU2MjUyMQ=="}, "originalCommit": {"oid": "156e26459cc9b7ea45f35f1e18f9a3b356a669ad"}, "originalPosition": 5}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MTc1MTQ1NQ==", "bodyText": "Yeah no issues.", "url": "https://github.com/eclipse-openj9/openj9/pull/10395#discussion_r471751455", "createdAt": "2020-08-17T20:17:08Z", "author": {"login": "dsouzai"}, "path": "runtime/compiler/runtime/RuntimeAssumptions.cpp", "diffHunk": "@@ -85,10 +85,10 @@ TR_PatchNOPedGuardSiteOnClassPreInitialize::hashCode(char *sig, uint32_t sigLen)\n void\n TR_PatchNOPedGuardSiteOnClassPreInitialize::reclaim()\n    {\n-   TR_ASSERT_FATAL(_key != NULL, \"Attempt to reclaim an already freed _key\");\n+   TR_ASSERT_FATAL((void*)_key != NULL, \"Attempt to reclaim an already freed _key\");", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MTU2MjUyMQ=="}, "originalCommit": {"oid": "156e26459cc9b7ea45f35f1e18f9a3b356a669ad"}, "originalPosition": 5}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjk0NzUyMTA3OnYy", "diffSide": "RIGHT", "path": "runtime/compiler/runtime/RuntimeAssumptions.cpp", "isResolved": true, "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xN1QxNTozNTozNFrOHBt6-g==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xN1QxNjoxOTo1NVrOHBvpww==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MTU2MzAwMg==", "bodyText": "This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters. Learn more about bidirectional Unicode characters\n\n\n  \n\n\n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n               _key = (uintptr_t)(void*)0;\n          \n          \n            \n               _key = 0;\n          \n      \n    \n    \n  \n\n_key is of type uintptr_t so a 0 is fine.", "url": "https://github.com/eclipse-openj9/openj9/pull/10395#discussion_r471563002", "createdAt": "2020-08-17T15:35:34Z", "author": {"login": "dsouzai"}, "path": "runtime/compiler/runtime/RuntimeAssumptions.cpp", "diffHunk": "@@ -85,10 +85,10 @@ TR_PatchNOPedGuardSiteOnClassPreInitialize::hashCode(char *sig, uint32_t sigLen)\n void\n TR_PatchNOPedGuardSiteOnClassPreInitialize::reclaim()\n    {\n-   TR_ASSERT_FATAL(_key != NULL, \"Attempt to reclaim an already freed _key\");\n+   TR_ASSERT_FATAL((void*)_key != NULL, \"Attempt to reclaim an already freed _key\");\n \n    jitPersistentFree((void*)_key);\n-   _key = 0;\n+   _key = (uintptr_t)(void*)0;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "156e26459cc9b7ea45f35f1e18f9a3b356a669ad"}, "originalPosition": 9}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MTU5MTExNg==", "bodyText": "See my other comment, but in brief, I believe this is not strictly correct according to the standard, similar to void *p; memset(&p, 0, sizeof(p)); being an incorrect way to initialize a null pointer to void.", "url": "https://github.com/eclipse-openj9/openj9/pull/10395#discussion_r471591116", "createdAt": "2020-08-17T16:19:28Z", "author": {"login": "Hello71"}, "path": "runtime/compiler/runtime/RuntimeAssumptions.cpp", "diffHunk": "@@ -85,10 +85,10 @@ TR_PatchNOPedGuardSiteOnClassPreInitialize::hashCode(char *sig, uint32_t sigLen)\n void\n TR_PatchNOPedGuardSiteOnClassPreInitialize::reclaim()\n    {\n-   TR_ASSERT_FATAL(_key != NULL, \"Attempt to reclaim an already freed _key\");\n+   TR_ASSERT_FATAL((void*)_key != NULL, \"Attempt to reclaim an already freed _key\");\n \n    jitPersistentFree((void*)_key);\n-   _key = 0;\n+   _key = (uintptr_t)(void*)0;", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MTU2MzAwMg=="}, "originalCommit": {"oid": "156e26459cc9b7ea45f35f1e18f9a3b356a669ad"}, "originalPosition": 9}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MTU5MTM2Mw==", "bodyText": "But, again, as a practical matter, it's unlikely to make a difference.", "url": "https://github.com/eclipse-openj9/openj9/pull/10395#discussion_r471591363", "createdAt": "2020-08-17T16:19:55Z", "author": {"login": "Hello71"}, "path": "runtime/compiler/runtime/RuntimeAssumptions.cpp", "diffHunk": "@@ -85,10 +85,10 @@ TR_PatchNOPedGuardSiteOnClassPreInitialize::hashCode(char *sig, uint32_t sigLen)\n void\n TR_PatchNOPedGuardSiteOnClassPreInitialize::reclaim()\n    {\n-   TR_ASSERT_FATAL(_key != NULL, \"Attempt to reclaim an already freed _key\");\n+   TR_ASSERT_FATAL((void*)_key != NULL, \"Attempt to reclaim an already freed _key\");\n \n    jitPersistentFree((void*)_key);\n-   _key = 0;\n+   _key = (uintptr_t)(void*)0;", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MTU2MzAwMg=="}, "originalCommit": {"oid": "156e26459cc9b7ea45f35f1e18f9a3b356a669ad"}, "originalPosition": 9}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4699, "cost": 1, "resetAt": "2021-11-12T18:49:56Z"}}}