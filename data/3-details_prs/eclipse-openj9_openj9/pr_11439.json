{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTM2MjUzMzY5", "number": 11439, "title": "Update docker container script for use with OpenJ9 builds", "bodyText": "update jenkins container build for centos6.10\nupdate repos to alternate now that os is end of life\nupdate namespace to reference new repo location\nmove perms adjusting to end of dockerfile so all content is owned by $user\ncomment out freemarker requirement as its no longer in use\nremove non-existent ius-release-el6.rpm\nmodified SDK location as builds were modified to reference $USER_HOME/bootjdks/\n\nSigned-off-by: Joe deKoning joe_dekoning@ca.ibm.com", "createdAt": "2020-12-10T21:00:15Z", "url": "https://github.com/eclipse-openj9/openj9/pull/11439", "merged": true, "mergeCommit": {"oid": "1bf187d15991fb4bad8c312aa425959a033f1d04"}, "closed": true, "closedAt": "2021-05-28T13:24:59Z", "author": {"login": "jdekonin"}, "timelineItems": {"totalCount": 19, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdk53e7ABqjQwOTcyMjgwNjY=", "endCursor": "Y3Vyc29yOnYyOpPPAAABebMl8dgFqTY3MTI5Njc2NA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "d99d810b43048c13c38ce8009f996e033bf073a2", "author": {"user": {"login": "jdekonin", "name": "Joe deKoning"}}, "url": "https://github.com/eclipse-openj9/openj9/commit/d99d810b43048c13c38ce8009f996e033bf073a2", "committedDate": "2020-12-10T20:58:25Z", "message": "Update docker container script for use with OpenJ9 builds\n\n* update jenkins container build for centos6.10\n* update git version\n* update to url for autoconf\n* update repos to alernates now that os is end of life\n\nSigned-off-by: Joe deKoning <joe_dekoning@ca.ibm.com>"}, "afterCommit": {"oid": "212df13bb3902d793f5b48a8000bef74b92efbb9", "author": {"user": {"login": "jdekonin", "name": "Joe deKoning"}}, "url": "https://github.com/eclipse-openj9/openj9/commit/212df13bb3902d793f5b48a8000bef74b92efbb9", "committedDate": "2020-12-10T21:02:01Z", "message": "Update docker container script for use with OpenJ9 builds\n\n* update jenkins container build for centos6.10\n* update git version\n* update to url for autoconf\n* update repos to alternate now that os is end of life\n* modify centos FROM which changed supported format\n\nSigned-off-by: Joe deKoning <joe_dekoning@ca.ibm.com>"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "212df13bb3902d793f5b48a8000bef74b92efbb9", "author": {"user": {"login": "jdekonin", "name": "Joe deKoning"}}, "url": "https://github.com/eclipse-openj9/openj9/commit/212df13bb3902d793f5b48a8000bef74b92efbb9", "committedDate": "2020-12-10T21:02:01Z", "message": "Update docker container script for use with OpenJ9 builds\n\n* update jenkins container build for centos6.10\n* update git version\n* update to url for autoconf\n* update repos to alternate now that os is end of life\n* modify centos FROM which changed supported format\n\nSigned-off-by: Joe deKoning <joe_dekoning@ca.ibm.com>"}, "afterCommit": {"oid": "8605127d73de53023d41d9764caf084d5632b0e0", "author": {"user": {"login": "jdekonin", "name": "Joe deKoning"}}, "url": "https://github.com/eclipse-openj9/openj9/commit/8605127d73de53023d41d9764caf084d5632b0e0", "committedDate": "2020-12-10T21:04:04Z", "message": "Update docker container script for use with OpenJ9 builds\n\n* update jenkins container build for centos6.10\n* update git version\n* update to url for autoconf\n* update repos to alternate now that os is end of life\n* modify centos FROM which changed supported format\n\nSigned-off-by: Joe deKoning <joe_dekoning@ca.ibm.com>"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "8605127d73de53023d41d9764caf084d5632b0e0", "author": {"user": {"login": "jdekonin", "name": "Joe deKoning"}}, "url": "https://github.com/eclipse-openj9/openj9/commit/8605127d73de53023d41d9764caf084d5632b0e0", "committedDate": "2020-12-10T21:04:04Z", "message": "Update docker container script for use with OpenJ9 builds\n\n* update jenkins container build for centos6.10\n* update git version\n* update to url for autoconf\n* update repos to alternate now that os is end of life\n* modify centos FROM which changed supported format\n\nSigned-off-by: Joe deKoning <joe_dekoning@ca.ibm.com>"}, "afterCommit": {"oid": "df6390138125032a2ad6011549b7cf501413c760", "author": {"user": {"login": "jdekonin", "name": "Joe deKoning"}}, "url": "https://github.com/eclipse-openj9/openj9/commit/df6390138125032a2ad6011549b7cf501413c760", "committedDate": "2020-12-11T20:02:40Z", "message": "Update docker container script for use with OpenJ9 builds\n\n* update jenkins container build for centos6.10\n* update git version\n* update to url for autoconf\n* update repos to alternate now that os is end of life\n* modify centos FROM which changed supported format\n\nSigned-off-by: Joe deKoning <joe_dekoning@ca.ibm.com>"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "df6390138125032a2ad6011549b7cf501413c760", "author": {"user": {"login": "jdekonin", "name": "Joe deKoning"}}, "url": "https://github.com/eclipse-openj9/openj9/commit/df6390138125032a2ad6011549b7cf501413c760", "committedDate": "2020-12-11T20:02:40Z", "message": "Update docker container script for use with OpenJ9 builds\n\n* update jenkins container build for centos6.10\n* update git version\n* update to url for autoconf\n* update repos to alternate now that os is end of life\n* modify centos FROM which changed supported format\n\nSigned-off-by: Joe deKoning <joe_dekoning@ca.ibm.com>"}, "afterCommit": {"oid": "dc1d01a45d8b15f0825337065beb7bdf0c64c340", "author": {"user": {"login": "jdekonin", "name": "Joe deKoning"}}, "url": "https://github.com/eclipse-openj9/openj9/commit/dc1d01a45d8b15f0825337065beb7bdf0c64c340", "committedDate": "2021-05-12T13:49:59Z", "message": "Update docker container script for use with OpenJ9 builds\n\n* update jenkins container build for centos6.10\n* update git version\n* update to url for autoconf\n* update repos to alternate now that os is end of life\n* modify centos FROM which changed supported format\n\nSigned-off-by: Joe deKoning <joe_dekoning@ca.ibm.com>"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "dc1d01a45d8b15f0825337065beb7bdf0c64c340", "author": {"user": {"login": "jdekonin", "name": "Joe deKoning"}}, "url": "https://github.com/eclipse-openj9/openj9/commit/dc1d01a45d8b15f0825337065beb7bdf0c64c340", "committedDate": "2021-05-12T13:49:59Z", "message": "Update docker container script for use with OpenJ9 builds\n\n* update jenkins container build for centos6.10\n* update git version\n* update to url for autoconf\n* update repos to alternate now that os is end of life\n* modify centos FROM which changed supported format\n\nSigned-off-by: Joe deKoning <joe_dekoning@ca.ibm.com>"}, "afterCommit": {"oid": "24dfa611361c35dc2b121c8054c469e6c8845cdb", "author": {"user": {"login": "jdekonin", "name": "Joe deKoning"}}, "url": "https://github.com/eclipse-openj9/openj9/commit/24dfa611361c35dc2b121c8054c469e6c8845cdb", "committedDate": "2021-05-14T17:28:54Z", "message": "Update docker container script for use with OpenJ9 builds\n\n* update jenkins container build for centos6.10\n* update git version\n* update repos to alternate now that os is end of life\n* modify centos FROM which changed supported format\n\nSigned-off-by: Joe deKoning <joe_dekoning@ca.ibm.com>"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "24dfa611361c35dc2b121c8054c469e6c8845cdb", "author": {"user": {"login": "jdekonin", "name": "Joe deKoning"}}, "url": "https://github.com/eclipse-openj9/openj9/commit/24dfa611361c35dc2b121c8054c469e6c8845cdb", "committedDate": "2021-05-14T17:28:54Z", "message": "Update docker container script for use with OpenJ9 builds\n\n* update jenkins container build for centos6.10\n* update git version\n* update repos to alternate now that os is end of life\n* modify centos FROM which changed supported format\n\nSigned-off-by: Joe deKoning <joe_dekoning@ca.ibm.com>"}, "afterCommit": {"oid": "30ebdf25291e941eb4cc2f84b1f6e8835980bb4c", "author": {"user": {"login": "jdekonin", "name": "Joe deKoning"}}, "url": "https://github.com/eclipse-openj9/openj9/commit/30ebdf25291e941eb4cc2f84b1f6e8835980bb4c", "committedDate": "2021-05-14T17:35:25Z", "message": "Update docker container script for use with OpenJ9 builds\n\n* update jenkins container build for centos6.10\n* update git version\n* update repos to alternate now that os is end of life\n* modify centos FROM which changed supported format\n\nSigned-off-by: Joe deKoning <joe_dekoning@ca.ibm.com>"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "30ebdf25291e941eb4cc2f84b1f6e8835980bb4c", "author": {"user": {"login": "jdekonin", "name": "Joe deKoning"}}, "url": "https://github.com/eclipse-openj9/openj9/commit/30ebdf25291e941eb4cc2f84b1f6e8835980bb4c", "committedDate": "2021-05-14T17:35:25Z", "message": "Update docker container script for use with OpenJ9 builds\n\n* update jenkins container build for centos6.10\n* update git version\n* update repos to alternate now that os is end of life\n* modify centos FROM which changed supported format\n\nSigned-off-by: Joe deKoning <joe_dekoning@ca.ibm.com>"}, "afterCommit": {"oid": "fa0877e787498f589b0e154929e9be4d70fc7ed0", "author": {"user": {"login": "jdekonin", "name": "Joe deKoning"}}, "url": "https://github.com/eclipse-openj9/openj9/commit/fa0877e787498f589b0e154929e9be4d70fc7ed0", "committedDate": "2021-05-14T17:36:53Z", "message": "Update docker container script for use with OpenJ9 builds\n\n* update jenkins container build for centos6.10\n* update repos to alternate now that os is end of life\n* modify centos FROM which changed supported format\n* revert namespace change as that shouldn't have been updated\n\nSigned-off-by: Joe deKoning <joe_dekoning@ca.ibm.com>"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "fa0877e787498f589b0e154929e9be4d70fc7ed0", "author": {"user": {"login": "jdekonin", "name": "Joe deKoning"}}, "url": "https://github.com/eclipse-openj9/openj9/commit/fa0877e787498f589b0e154929e9be4d70fc7ed0", "committedDate": "2021-05-14T17:36:53Z", "message": "Update docker container script for use with OpenJ9 builds\n\n* update jenkins container build for centos6.10\n* update repos to alternate now that os is end of life\n* modify centos FROM which changed supported format\n* revert namespace change as that shouldn't have been updated\n\nSigned-off-by: Joe deKoning <joe_dekoning@ca.ibm.com>"}, "afterCommit": {"oid": "4dc6a24f14de5fdab9a726fbe8c513e5e7270cb8", "author": {"user": {"login": "jdekonin", "name": "Joe deKoning"}}, "url": "https://github.com/eclipse-openj9/openj9/commit/4dc6a24f14de5fdab9a726fbe8c513e5e7270cb8", "committedDate": "2021-05-14T17:45:50Z", "message": "Update docker container script for use with OpenJ9 builds\n\n* update jenkins container build for centos6.10\n* update repos to alternate now that os is end of life\n* modify centos FROM which changed supported format\n* revert namespace change as that shouldn't have been updated\n* move perms adjusting to end of dockerfile so all content is owned by $user\n\nSigned-off-by: Joe deKoning <joe_dekoning@ca.ibm.com>"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NjYyMzQ2OTA4", "url": "https://github.com/eclipse-openj9/openj9/pull/11439#pullrequestreview-662346908", "createdAt": "2021-05-18T16:54:02Z", "commit": {"oid": "4dc6a24f14de5fdab9a726fbe8c513e5e7270cb8"}, "state": "COMMENTED", "comments": {"totalCount": 6, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wNS0xOFQxNjo1NDowMlrOJdLz7A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wNS0xOFQxNzoyNToyNlrOJdNHUQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDYzNDU4MTk5Ng==", "bodyText": "This change doesn't appear to be necessary: the tag 'centos:6.10' is available.", "url": "https://github.com/eclipse-openj9/openj9/pull/11439#discussion_r634581996", "createdAt": "2021-05-18T16:54:02Z", "author": {"login": "keithc-ca"}, "path": "buildenv/docker/mkdocker.sh", "diffHunk": "@@ -219,12 +220,22 @@ if [ $cuda != no ] ; then\n   echo \"FROM nvidia/cuda:${cuda}-devel-ubuntu16.04 AS cuda-dev\"\n   echo \"\"\n fi\n+if [ $dist = centos ] ; then\n+  echo \"FROM $dist:$dist$version\"\n+else\n   echo \"FROM $dist:$version\"\n+fi", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "4dc6a24f14de5fdab9a726fbe8c513e5e7270cb8"}, "originalPosition": 43}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDYzNDU4ODIwOQ==", "bodyText": "Why do we care about the shell prompt string?\nMuch escaping can be avoided by using single quotes ('); the $ should be escaped, though.\nThe two limits can be changed in one command: ulimit -n 2048 -u 32000.", "url": "https://github.com/eclipse-openj9/openj9/pull/11439#discussion_r634588209", "createdAt": "2021-05-18T17:02:41Z", "author": {"login": "keithc-ca"}, "path": "buildenv/docker/mkdocker.sh", "diffHunk": "@@ -532,32 +543,33 @@ prepare_user() {\n create_user() {\n   echo \"\"\n   echo \"# Add user home and copy authorized_keys and known_hosts.\"\n-  echo \"RUN useradd -ms /bin/bash $user \\\\\"\n+  echo \"RUN useradd -ms /bin/bash --uid $userid $user \\\\\"\n   echo \" && mkdir /home/$user/.ssh \\\\\"\n   echo \" && chmod 700 /home/$user/.ssh\"\n   echo \"COPY authorized_keys known_hosts /home/$user/.ssh/\"\n-  echo \"RUN chown -R $user:$user /home/$user \\\\\"\n-  echo \" && chmod 600 /home/$user/.ssh/authorized_keys /home/$user/.ssh/known_hosts\"\n+  echo \"RUN chmod 600 /home/$user/.ssh/authorized_keys /home/$user/.ssh/known_hosts \\\\\"\n+  echo \" && echo \\\"PS1=\\\\\\\"\\\\u:DOCKER-CONTAINER $ \\\\\\\"\\\" > /home/$user/.bashrc \\\\\"\n+  echo \" && echo \\\"ulimit -u 32000\\\" >> /home/$user/.bashrc \\\\\"\n+  echo \" && echo \\\"ulimit -n 2048\\\" >> /home/$user/.bashrc\"", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "4dc6a24f14de5fdab9a726fbe8c513e5e7270cb8"}, "originalPosition": 73}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDYzNDYwMDUwOQ==", "bodyText": "CUDA should be selected for ppc64le and x86, independent of the O/S.", "url": "https://github.com/eclipse-openj9/openj9/pull/11439#discussion_r634600509", "createdAt": "2021-05-18T17:21:12Z", "author": {"login": "keithc-ca"}, "path": "buildenv/jenkins/docker-nodes/jenkinsfile-build-container.groovy", "diffHunk": "@@ -42,9 +42,9 @@ if (\"${OS}\" == \"unknown\" || !(validArch.contains(ARCH))) {\n }\n \n def BUILD_OPTS = \"\"\n-if (\"${OS}\" == \"centos6.9\") {\n+if (\"${OS}\" == \"centos6.10\") {\n     if (\"${ARCH}\" == \"x86\") {\n-        BUILD_OPTS = \"--dist=centos --version=6.9\"\n+        BUILD_OPTS = \"--dist=centos --version=6.10 --cuda\"", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "4dc6a24f14de5fdab9a726fbe8c513e5e7270cb8"}, "originalPosition": 8}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDYzNDYwMDk5NQ==", "bodyText": "This is the namespace at dockerhub, right?", "url": "https://github.com/eclipse-openj9/openj9/pull/11439#discussion_r634600995", "createdAt": "2021-05-18T17:21:58Z", "author": {"login": "keithc-ca"}, "path": "buildenv/jenkins/docker-nodes/jenkinsfile-build-container.groovy", "diffHunk": "@@ -62,7 +62,7 @@ if (\"${BUILD_OPTS}\" == \"\") {\n }\n \n def NODE = (params.NODE) ? params.NODE : \"sw.tool.docker && hw.arch.${ARCH}\"\n-def NAMESPACE = (params.NAMESPACE) ? params.NAMESPACE : \"eclipse-openj9\"\n+def NAMESPACE = (params.NAMESPACE) ? params.NAMESPACE : \"openj9\"", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "4dc6a24f14de5fdab9a726fbe8c513e5e7270cb8"}, "originalPosition": 17}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDYzNDYwMTc1MA==", "bodyText": "Why is this needed? Don't the default repo configurations work?", "url": "https://github.com/eclipse-openj9/openj9/pull/11439#discussion_r634601750", "createdAt": "2021-05-18T17:23:03Z", "author": {"login": "keithc-ca"}, "path": "buildenv/docker/mkdocker.sh", "diffHunk": "@@ -219,12 +220,22 @@ if [ $cuda != no ] ; then\n   echo \"FROM nvidia/cuda:${cuda}-devel-ubuntu16.04 AS cuda-dev\"\n   echo \"\"\n fi\n+if [ $dist = centos ] ; then\n+  echo \"FROM $dist:$dist$version\"\n+else\n   echo \"FROM $dist:$version\"\n+fi\n }\n \n install_centos_packages() {\n+if [ $version = 6.10 ] ; then\n+  echo \"RUN sed -i -e 's|mirrorlist|#mirrorlist|' \\\\\"\n+  echo \"           -e 's|#baseurl=http://mirror.centos.org/centos/\\$releasever|baseurl=https://vault.centos.org/6.10|' \\\\\"\n+  echo \"           /etc/yum.repos.d/CentOS-Base.repo\"\n+  echo \"\"\n+fi", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "4dc6a24f14de5fdab9a726fbe8c513e5e7270cb8"}, "originalPosition": 52}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDYzNDYwMzM0NQ==", "bodyText": "Does buildenv/ansible/roles/openj9-from-sources/tasks/main.yml need to change too?", "url": "https://github.com/eclipse-openj9/openj9/pull/11439#discussion_r634603345", "createdAt": "2021-05-18T17:25:26Z", "author": {"login": "keithc-ca"}, "path": "buildenv/docker/mkdocker.sh", "diffHunk": "@@ -532,32 +543,33 @@ prepare_user() {\n create_user() {\n   echo \"\"\n   echo \"# Add user home and copy authorized_keys and known_hosts.\"\n-  echo \"RUN useradd -ms /bin/bash $user \\\\\"\n+  echo \"RUN useradd -ms /bin/bash --uid $userid $user \\\\\"\n   echo \" && mkdir /home/$user/.ssh \\\\\"\n   echo \" && chmod 700 /home/$user/.ssh\"\n   echo \"COPY authorized_keys known_hosts /home/$user/.ssh/\"\n-  echo \"RUN chown -R $user:$user /home/$user \\\\\"\n-  echo \" && chmod 600 /home/$user/.ssh/authorized_keys /home/$user/.ssh/known_hosts\"\n+  echo \"RUN chmod 600 /home/$user/.ssh/authorized_keys /home/$user/.ssh/known_hosts \\\\\"\n+  echo \" && echo \\\"PS1=\\\\\\\"\\\\u:DOCKER-CONTAINER $ \\\\\\\"\\\" > /home/$user/.bashrc \\\\\"\n+  echo \" && echo \\\"ulimit -u 32000\\\" >> /home/$user/.bashrc \\\\\"\n+  echo \" && echo \\\"ulimit -n 2048\\\" >> /home/$user/.bashrc\"\n+}\n+\n+adjust_user_directory_perms() {\n+  echo \"RUN chown -R $user:$user /home/$user\"\n }\n \n install_freemarker() {\n   echo \"\"\n   local freemarker_version=2.3.8\n-  echo \"# Download and extract freemarker.jar to /root/freemarker.jar.\"\n-  echo \"RUN mkdir -p /root \\\\\"\n-  echo \" && cd /root \\\\\"\n+  echo \"# Download and extract freemarker.jar to /home/$user/freemarker.jar.\"", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "4dc6a24f14de5fdab9a726fbe8c513e5e7270cb8"}, "originalPosition": 86}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "4dc6a24f14de5fdab9a726fbe8c513e5e7270cb8", "author": {"user": {"login": "jdekonin", "name": "Joe deKoning"}}, "url": "https://github.com/eclipse-openj9/openj9/commit/4dc6a24f14de5fdab9a726fbe8c513e5e7270cb8", "committedDate": "2021-05-14T17:45:50Z", "message": "Update docker container script for use with OpenJ9 builds\n\n* update jenkins container build for centos6.10\n* update repos to alternate now that os is end of life\n* modify centos FROM which changed supported format\n* revert namespace change as that shouldn't have been updated\n* move perms adjusting to end of dockerfile so all content is owned by $user\n\nSigned-off-by: Joe deKoning <joe_dekoning@ca.ibm.com>"}, "afterCommit": {"oid": "b51d668322ab259e81c3fda831180c8056b56ab1", "author": {"user": {"login": "jdekonin", "name": "Joe deKoning"}}, "url": "https://github.com/eclipse-openj9/openj9/commit/b51d668322ab259e81c3fda831180c8056b56ab1", "committedDate": "2021-05-26T21:51:36Z", "message": "Update docker container script for use with OpenJ9 builds\n\n* update jenkins container build for centos6.10\n* update repos to alternate now that os is end of life\n* update namespace to reference new repo location\n* move perms adjusting to end of dockerfile so all content is owned by $user\n* comment out freemarker requirement as its no longer in use\n* remove non-existent ius-release-el6.rpm\n* modified SDK location as builds were modified to reference $USER_HOME/bootjdks/\n\nSigned-off-by: Joe deKoning <joe_dekoning@ca.ibm.com>"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "b51d668322ab259e81c3fda831180c8056b56ab1", "author": {"user": {"login": "jdekonin", "name": "Joe deKoning"}}, "url": "https://github.com/eclipse-openj9/openj9/commit/b51d668322ab259e81c3fda831180c8056b56ab1", "committedDate": "2021-05-26T21:51:36Z", "message": "Update docker container script for use with OpenJ9 builds\n\n* update jenkins container build for centos6.10\n* update repos to alternate now that os is end of life\n* update namespace to reference new repo location\n* move perms adjusting to end of dockerfile so all content is owned by $user\n* comment out freemarker requirement as its no longer in use\n* remove non-existent ius-release-el6.rpm\n* modified SDK location as builds were modified to reference $USER_HOME/bootjdks/\n\nSigned-off-by: Joe deKoning <joe_dekoning@ca.ibm.com>"}, "afterCommit": {"oid": "367bf68e3396e4032dd7d65be9993b36dccf80c0", "author": {"user": {"login": "jdekonin", "name": "Joe deKoning"}}, "url": "https://github.com/eclipse-openj9/openj9/commit/367bf68e3396e4032dd7d65be9993b36dccf80c0", "committedDate": "2021-05-27T02:09:37Z", "message": "Update docker container script for use with OpenJ9 builds\n\n* update jenkins container build for centos6.10\n* update repos to alternate now that os is end of life\n* update namespace to reference new repo location\n* move perms adjusting to end of dockerfile so all content is owned by $user\n* comment out freemarker requirement as its no longer in use\n* remove non-existent ius-release-el6.rpm\n* modified SDK location as builds were modified to reference $USER_HOME/bootjdks/\n\nSigned-off-by: Joe deKoning <joe_dekoning@ca.ibm.com>"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "367bf68e3396e4032dd7d65be9993b36dccf80c0", "author": {"user": {"login": "jdekonin", "name": "Joe deKoning"}}, "url": "https://github.com/eclipse-openj9/openj9/commit/367bf68e3396e4032dd7d65be9993b36dccf80c0", "committedDate": "2021-05-27T02:09:37Z", "message": "Update docker container script for use with OpenJ9 builds\n\n* update jenkins container build for centos6.10\n* update repos to alternate now that os is end of life\n* update namespace to reference new repo location\n* move perms adjusting to end of dockerfile so all content is owned by $user\n* comment out freemarker requirement as its no longer in use\n* remove non-existent ius-release-el6.rpm\n* modified SDK location as builds were modified to reference $USER_HOME/bootjdks/\n\nSigned-off-by: Joe deKoning <joe_dekoning@ca.ibm.com>"}, "afterCommit": {"oid": "76db7afff254ae22071c15755ef61542626db6a4", "author": {"user": {"login": "jdekonin", "name": "Joe deKoning"}}, "url": "https://github.com/eclipse-openj9/openj9/commit/76db7afff254ae22071c15755ef61542626db6a4", "committedDate": "2021-05-27T02:21:52Z", "message": "Update docker container script for use with OpenJ9 builds\n\n* update jenkins container build for centos6.10\n* update repos to alternate now that os is end of life\n* update namespace to reference new repo location\n* move perms adjusting to end of dockerfile so all content is owned by $user\n* comment out freemarker requirement as its no longer in use\n* remove non-existent ius-release-el6.rpm\n* modified SDK location as builds were modified to reference $USER_HOME/bootjdks/\n\nSigned-off-by: Joe deKoning <joe_dekoning@ca.ibm.com>"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NjcwMzU1NTIy", "url": "https://github.com/eclipse-openj9/openj9/pull/11439#pullrequestreview-670355522", "createdAt": "2021-05-27T15:48:04Z", "commit": {"oid": "76db7afff254ae22071c15755ef61542626db6a4"}, "state": "COMMENTED", "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wNS0yN1QxNTo0ODowNFrOJjEaZw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wNS0yN1QxNTo1MDoxOFrOJjEhww==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDY0MDc1MjIzMQ==", "bodyText": "This could be simplified so it doesn't need to mention individual files:\n  chmod -R go= /home/$user/.ssh", "url": "https://github.com/eclipse-openj9/openj9/pull/11439#discussion_r640752231", "createdAt": "2021-05-27T15:48:04Z", "author": {"login": "keithc-ca"}, "path": "buildenv/docker/mkdocker.sh", "diffHunk": "@@ -532,32 +536,31 @@ prepare_user() {\n create_user() {\n   echo \"\"\n   echo \"# Add user home and copy authorized_keys and known_hosts.\"\n-  echo \"RUN useradd -ms /bin/bash $user \\\\\"\n+  echo \"RUN useradd -ms /bin/bash --uid $userid $user \\\\\"\n   echo \" && mkdir /home/$user/.ssh \\\\\"\n   echo \" && chmod 700 /home/$user/.ssh\"\n   echo \"COPY authorized_keys known_hosts /home/$user/.ssh/\"\n-  echo \"RUN chown -R $user:$user /home/$user \\\\\"\n-  echo \" && chmod 600 /home/$user/.ssh/authorized_keys /home/$user/.ssh/known_hosts\"\n+  echo \"RUN chmod 600 /home/$user/.ssh/authorized_keys /home/$user/.ssh/known_hosts \\\\\"", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "76db7afff254ae22071c15755ef61542626db6a4"}, "originalPosition": 63}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDY0MDc1MzQ4Mw==", "bodyText": "I'd prefer to see this controlled by an option, say, --freemarker.", "url": "https://github.com/eclipse-openj9/openj9/pull/11439#discussion_r640753483", "createdAt": "2021-05-27T15:49:32Z", "author": {"login": "keithc-ca"}, "path": "buildenv/docker/mkdocker.sh", "diffHunk": "@@ -671,7 +674,7 @@ print_dockerfile() {\n if [ $cuda != no ] ; then\n   install_cuda\n fi\n-  install_freemarker\n+  #install_freemarker", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "76db7afff254ae22071c15755ef61542626db6a4"}, "originalPosition": 109}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDY0MDc1NDExNQ==", "bodyText": "Is the slash in /https intentional?", "url": "https://github.com/eclipse-openj9/openj9/pull/11439#discussion_r640754115", "createdAt": "2021-05-27T15:50:18Z", "author": {"login": "keithc-ca"}, "path": "buildenv/jenkins/docker-nodes/README.md", "diffHunk": "@@ -34,32 +34,32 @@ same environment every time.\n |:---------:|:------------:|:-------------:|:-------------:|\n | Ubuntu16  |  Test Only   | Build & Test  |   Test Only   |\n | Ubuntu18  |  Test Only   |   Test Only   |   Test Only   |\n-| Centos6.9 | Build & Test | Not Available | Not Available |\n+| Centos6   | Build & Test | Not Available | Not Available |\n | Centos7   | To be Added  |  To be Added  | Build & Test  |\n | Windows   | To be Added  | Not Available | Not Available |\n \n ## Eclipse OpenJ9 CI\n Generated Dockerfiles are used by two Jenkins jobs at Eclipse to\n-build docker images. The first [job](https://ci.eclipse.org/openj9/view/Build/job/Build-Jenkins-Agent-Container/) is run manually\n+build docker images. The first [job](/https://openj9-jenkins.osuosl.org/job/Build-Jenkins-Agent-Container/) is run manually", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "76db7afff254ae22071c15755ef61542626db6a4"}, "originalPosition": 12}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "76db7afff254ae22071c15755ef61542626db6a4", "author": {"user": {"login": "jdekonin", "name": "Joe deKoning"}}, "url": "https://github.com/eclipse-openj9/openj9/commit/76db7afff254ae22071c15755ef61542626db6a4", "committedDate": "2021-05-27T02:21:52Z", "message": "Update docker container script for use with OpenJ9 builds\n\n* update jenkins container build for centos6.10\n* update repos to alternate now that os is end of life\n* update namespace to reference new repo location\n* move perms adjusting to end of dockerfile so all content is owned by $user\n* comment out freemarker requirement as its no longer in use\n* remove non-existent ius-release-el6.rpm\n* modified SDK location as builds were modified to reference $USER_HOME/bootjdks/\n\nSigned-off-by: Joe deKoning <joe_dekoning@ca.ibm.com>"}, "afterCommit": {"oid": "cf51c6e8e0801cddf5a12f78ff50b48817ae2e00", "author": {"user": {"login": "jdekonin", "name": "Joe deKoning"}}, "url": "https://github.com/eclipse-openj9/openj9/commit/cf51c6e8e0801cddf5a12f78ff50b48817ae2e00", "committedDate": "2021-05-27T21:00:28Z", "message": "Update docker container script for use with OpenJ9 builds\n\n* update jenkins container build for centos6.10\n* update repos to alternate now that os is end of life\n* update namespace to reference new repo location\n** add epel repo to get libdwarf\n* move perms adjusting to end of dockerfile so all content is owned by $user\n* make freemarker option\n* remove non-existent ius-release-el6.rpm\n* modified SDK location as builds were modified to reference $USER_HOME/bootjdks/\n\nSigned-off-by: Joe deKoning <joe_dekoning@ca.ibm.com>"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NjcwNjQ4MTYz", "url": "https://github.com/eclipse-openj9/openj9/pull/11439#pullrequestreview-670648163", "createdAt": "2021-05-27T21:16:35Z", "commit": {"oid": "cf51c6e8e0801cddf5a12f78ff50b48817ae2e00"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wNS0yN1QyMToxNjozNVrOJjR3ug==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wNS0yN1QyMToxNjozNVrOJjR3ug==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDY0MDk3MjczMA==", "bodyText": "The options were listed in alphabetical order, and the variables and cases were ordered likewise.", "url": "https://github.com/eclipse-openj9/openj9/pull/11439#discussion_r640972730", "createdAt": "2021-05-27T21:16:35Z", "author": {"login": "keithc-ca"}, "path": "buildenv/docker/mkdocker.sh", "diffHunk": "@@ -33,16 +33,17 @@ usage() {\n   echo \"  --arch=...     specify the processor architecture (default: host architecture)\"\n   echo \"  --build        build the docker image (overrides '--print')\"\n   echo \"  --cuda         include CUDA header files\"\n+  echo \"  --freemarker   include freemarker.jar\"", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "cf51c6e8e0801cddf5a12f78ff50b48817ae2e00"}, "originalPosition": 4}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NjcwNjU2MDU1", "url": "https://github.com/eclipse-openj9/openj9/pull/11439#pullrequestreview-670656055", "createdAt": "2021-05-27T21:26:08Z", "commit": {"oid": "cf51c6e8e0801cddf5a12f78ff50b48817ae2e00"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wNS0yN1QyMToyNjowOFrOJjSPCA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wNS0yN1QyMToyNjowOFrOJjSPCA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDY0MDk3ODY5Ng==", "bodyText": "What is this for? Isn't it redundant with the -y option in yum install -y?", "url": "https://github.com/eclipse-openj9/openj9/pull/11439#discussion_r640978696", "createdAt": "2021-05-27T21:26:08Z", "author": {"login": "keithc-ca"}, "path": "buildenv/docker/mkdocker.sh", "diffHunk": "@@ -223,10 +229,15 @@ fi\n }\n \n install_centos_packages() {\n-  echo \"RUN yum -y update \\\\\"\n-if [ $version = 6.9 ] ; then\n-  echo \" && yum -y install https://repo.ius.io/ius-release-el6.rpm \\\\\"\n+if [ $version = 6 ] ; then\n+  echo \"RUN sed -i -e 's|mirrorlist|#mirrorlist|' \\\\\"\n+  echo \"           -e 's|#baseurl=http://mirror.centos.org/centos/\\$releasever|baseurl=https://vault.centos.org/6.10|' \\\\\"\n+  echo \"           /etc/yum.repos.d/CentOS-Base.repo\"\n+  echo \"\"\n fi\n+  echo \"RUN yum -y update \\\\\"\n+  echo \" && echo \"assumeyes=1\" >> /etc/yum.conf \\\\\"", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "cf51c6e8e0801cddf5a12f78ff50b48817ae2e00"}, "originalPosition": 68}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "3b548d51cc02031024938279a66421f458b7144a", "author": {"user": {"login": "jdekonin", "name": "Joe deKoning"}}, "url": "https://github.com/eclipse-openj9/openj9/commit/3b548d51cc02031024938279a66421f458b7144a", "committedDate": "2021-05-27T21:36:40Z", "message": "Update docker container script for use with OpenJ9 builds\n\n* update jenkins container build for centos6.10\n* update repos to alternate now that os is end of life\n* update namespace to reference new repo location\n** add epel repo to get libdwarf\n* move perms adjusting to end of dockerfile so all content is owned by $user\n* make freemarker option\n* remove non-existent ius-release-el6.rpm\n* modified SDK location as builds were modified to reference $USER_HOME/bootjdks/\n\nSigned-off-by: Joe deKoning <joe_dekoning@ca.ibm.com>"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "cf51c6e8e0801cddf5a12f78ff50b48817ae2e00", "author": {"user": {"login": "jdekonin", "name": "Joe deKoning"}}, "url": "https://github.com/eclipse-openj9/openj9/commit/cf51c6e8e0801cddf5a12f78ff50b48817ae2e00", "committedDate": "2021-05-27T21:00:28Z", "message": "Update docker container script for use with OpenJ9 builds\n\n* update jenkins container build for centos6.10\n* update repos to alternate now that os is end of life\n* update namespace to reference new repo location\n** add epel repo to get libdwarf\n* move perms adjusting to end of dockerfile so all content is owned by $user\n* make freemarker option\n* remove non-existent ius-release-el6.rpm\n* modified SDK location as builds were modified to reference $USER_HOME/bootjdks/\n\nSigned-off-by: Joe deKoning <joe_dekoning@ca.ibm.com>"}, "afterCommit": {"oid": "3b548d51cc02031024938279a66421f458b7144a", "author": {"user": {"login": "jdekonin", "name": "Joe deKoning"}}, "url": "https://github.com/eclipse-openj9/openj9/commit/3b548d51cc02031024938279a66421f458b7144a", "committedDate": "2021-05-27T21:36:40Z", "message": "Update docker container script for use with OpenJ9 builds\n\n* update jenkins container build for centos6.10\n* update repos to alternate now that os is end of life\n* update namespace to reference new repo location\n** add epel repo to get libdwarf\n* move perms adjusting to end of dockerfile so all content is owned by $user\n* make freemarker option\n* remove non-existent ius-release-el6.rpm\n* modified SDK location as builds were modified to reference $USER_HOME/bootjdks/\n\nSigned-off-by: Joe deKoning <joe_dekoning@ca.ibm.com>"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NjcxMjk2NzY0", "url": "https://github.com/eclipse-openj9/openj9/pull/11439#pullrequestreview-671296764", "createdAt": "2021-05-28T13:24:39Z", "commit": {"oid": "3b548d51cc02031024938279a66421f458b7144a"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1497, "cost": 1, "resetAt": "2021-10-28T17:48:14Z"}}}