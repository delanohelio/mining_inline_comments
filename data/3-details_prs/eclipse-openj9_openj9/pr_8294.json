{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0MzYyMzYxNDcy", "number": 8294, "title": "Improve handling of endianness", "bodyText": "Add native function isBigEndian in JITHelpers.java following the implementation of Java_sun_misc_Unsafe_isBigEndian0.\n\n\nReplace IS_PLATFORM_LITTLE_ENDIAN with the new implemented function isBigEndian in JITHelpers.java and remove IS_PLATFORM_LITTLE_ENDIAN relevant code.\n\n\nUse putByteInArrayByIndex function to put the zero byte into the right index into char[], instead of checking the byteOrder and then doing &= 0x00FF or &= 0xFF00\n\n\nInline and fold away java/nio/ByteOrder.nativeOrder and java/nio/Bits.byteOrder. The reason I inline and fold away java/nio/Bits.byteOrder is that JDK8 calls Bits.byteOrder in ByteOrder.nativeOrder instead of ByteOrder.NATIVE_ORDER, which is a static field in JDK11.\n\n\nCloses: #4741", "createdAt": "2020-01-13T22:55:06Z", "url": "https://github.com/eclipse-openj9/openj9/pull/8294", "merged": true, "mergeCommit": {"oid": "9de47a97ad4629ca517e861c5e8e822d93d00176"}, "closed": true, "closedAt": "2020-02-07T17:08:15Z", "author": {"login": "simonameng"}, "timelineItems": {"totalCount": 15, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABb6E1edABqjI5NDUxMjI5OTM=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcBxq9ugFqTM1NDc4NjcwNw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "518543c844b9ce49487683f9068268be3a841d52", "author": {"user": {"login": "simonameng", "name": "Simona Meng"}}, "url": "https://github.com/eclipse-openj9/openj9/commit/518543c844b9ce49487683f9068268be3a841d52", "committedDate": "2020-01-13T22:34:40Z", "message": "Inline and fold away 'nativeOrder' and 'byteOrder' function\n\nAdd `java/nio/ByteOrder/nativeOrder` and `java/nio/Bits/byteOrder` to the j9 method list. Add them to the worth inlining list and 'foldFinalFieldsIn' list.\n\nSigned-off-by: simonameng <simonameng97@gmail.com>"}, "afterCommit": {"oid": "d4392cee695a6ea4b9bf8a4a5ec74f556be39875", "author": {"user": {"login": "simonameng", "name": "Simona Meng"}}, "url": "https://github.com/eclipse-openj9/openj9/commit/d4392cee695a6ea4b9bf8a4a5ec74f556be39875", "committedDate": "2020-01-13T23:20:04Z", "message": "Change copyright\n\nChange copyright to 2020 for involved files.\n\nSigned-off-by: simonameng <simonameng97@gmail.com>"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzQ2ODEyNTcw", "url": "https://github.com/eclipse-openj9/openj9/pull/8294#pullrequestreview-346812570", "createdAt": "2020-01-22T18:38:05Z", "commit": {"oid": "d4392cee695a6ea4b9bf8a4a5ec74f556be39875"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0yMlQxODozODowNlrOFgmuew==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0yMlQxODozODowNlrOFgmuew==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2OTczMzI0Mw==", "bodyText": "why is this better? having a static final with no depenencies in the JCL should be more predictable. The static final here is also a primitive type so can be constant folded unlike nativeOrder() which returns an object so we can only get a known object constraint. This doesn't seem like an improvement...", "url": "https://github.com/eclipse-openj9/openj9/pull/8294#discussion_r369733243", "createdAt": "2020-01-22T18:38:06Z", "author": {"login": "andrewcraik"}, "path": "jcl/src/java.base/share/classes/com/ibm/jit/JITHelpers.java", "diffHunk": "@@ -462,7 +462,7 @@ public char byteToCharUnsigned(byte b) {\n \tpublic native boolean acmplt(Object lhs, Object rhs);\n \n \tprivate static long storeBits(long dest, int width, long value, int vwidth, int offset) {\n-\t\tint offsetToModify = IS_PLATFORM_LITTLE_ENDIAN ? ((offset * vwidth) % width) : ((width - 1) - ((offset * vwidth) % width));\n+\t\tint offsetToModify = (ByteOrder.nativeOrder() == ByteOrder.LITTLE_ENDIAN) ? ((offset * vwidth) % width) : ((width - 1) - ((offset * vwidth) % width));", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d4392cee695a6ea4b9bf8a4a5ec74f556be39875"}, "originalPosition": 30}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzQ2ODEzOTIz", "url": "https://github.com/eclipse-openj9/openj9/pull/8294#pullrequestreview-346813923", "createdAt": "2020-01-22T18:40:15Z", "commit": {"oid": "d4392cee695a6ea4b9bf8a4a5ec74f556be39875"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzUwOTg5MTA4", "url": "https://github.com/eclipse-openj9/openj9/pull/8294#pullrequestreview-350989108", "createdAt": "2020-01-30T17:03:16Z", "commit": {"oid": "96acf7873b40ded103b16ad8c160fbc8fd1bb6ff"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzU0NzA4Njcw", "url": "https://github.com/eclipse-openj9/openj9/pull/8294#pullrequestreview-354708670", "createdAt": "2020-02-06T19:22:37Z", "commit": {"oid": "96acf7873b40ded103b16ad8c160fbc8fd1bb6ff"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzU0NzEzOTQy", "url": "https://github.com/eclipse-openj9/openj9/pull/8294#pullrequestreview-354713942", "createdAt": "2020-02-06T19:30:37Z", "commit": {"oid": "96acf7873b40ded103b16ad8c160fbc8fd1bb6ff"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "96acf7873b40ded103b16ad8c160fbc8fd1bb6ff", "author": {"user": {"login": "simonameng", "name": "Simona Meng"}}, "url": "https://github.com/eclipse-openj9/openj9/commit/96acf7873b40ded103b16ad8c160fbc8fd1bb6ff", "committedDate": "2020-01-30T15:13:31Z", "message": "Add native function 'isBigEndian' in JITHelpers.java\n\nAdd native function 'isBigEndian' in 'JITHelpers.java' following the implementation of 'Java_sun_misc_Unsafe_isBigEndian0' for consistency. Because 'Unsafe.isBigEndian' is introduced for Java9+ only. We cannot use the function directly.\n\nSigned-off-by: simonameng <simonameng97@gmail.com>"}, "afterCommit": {"oid": "15d15b015a7887092fc5db812eaa548ec371646d", "author": {"user": {"login": "simonameng", "name": "Simona Meng"}}, "url": "https://github.com/eclipse-openj9/openj9/commit/15d15b015a7887092fc5db812eaa548ec371646d", "committedDate": "2020-02-06T20:14:14Z", "message": "Add native function 'isBigEndian' in JITHelpers.java\n\nAdd native function 'isBigEndian' in 'JITHelpers.java' following the implementation of 'Java_sun_misc_Unsafe_isBigEndian0' for consistency. Because 'Unsafe.isBigEndian' is introduced for Java9+ only. We cannot use the function directly.\n\nAlso, deprecate 'runtime/jcl/uma/jithelpers_jni_exports.xml' in favor of the new implemented function 'isBigEndian'.\n\nSigned-off-by: simonameng <simonameng97@gmail.com>"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "15d15b015a7887092fc5db812eaa548ec371646d", "author": {"user": {"login": "simonameng", "name": "Simona Meng"}}, "url": "https://github.com/eclipse-openj9/openj9/commit/15d15b015a7887092fc5db812eaa548ec371646d", "committedDate": "2020-02-06T20:14:14Z", "message": "Add native function 'isBigEndian' in JITHelpers.java\n\nAdd native function 'isBigEndian' in 'JITHelpers.java' following the implementation of 'Java_sun_misc_Unsafe_isBigEndian0' for consistency. Because 'Unsafe.isBigEndian' is introduced for Java9+ only. We cannot use the function directly.\n\nAlso, deprecate 'runtime/jcl/uma/jithelpers_jni_exports.xml' in favor of the new implemented function 'isBigEndian'.\n\nSigned-off-by: simonameng <simonameng97@gmail.com>"}, "afterCommit": {"oid": "4fd0f9e23d52ad0cf51d5280520479fb65f47623", "author": {"user": {"login": "simonameng", "name": "Simona Meng"}}, "url": "https://github.com/eclipse-openj9/openj9/commit/4fd0f9e23d52ad0cf51d5280520479fb65f47623", "committedDate": "2020-02-06T21:00:22Z", "message": "Add native function 'isBigEndian' in JITHelpers.java\n\nAdd native function 'isBigEndian' following the implementation of 'Java_sun_misc_Unsafe_isBigEndian0'.\n\nDeprecate `IS_PLATFORM_LITTLE_ENDIAN` with `isBigEndian` function.\n\nSigned-off-by: simonameng <simonameng97@gmail.com>"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "4fd0f9e23d52ad0cf51d5280520479fb65f47623", "author": {"user": {"login": "simonameng", "name": "Simona Meng"}}, "url": "https://github.com/eclipse-openj9/openj9/commit/4fd0f9e23d52ad0cf51d5280520479fb65f47623", "committedDate": "2020-02-06T21:00:22Z", "message": "Add native function 'isBigEndian' in JITHelpers.java\n\nAdd native function 'isBigEndian' following the implementation of 'Java_sun_misc_Unsafe_isBigEndian0'.\n\nDeprecate `IS_PLATFORM_LITTLE_ENDIAN` with `isBigEndian` function.\n\nSigned-off-by: simonameng <simonameng97@gmail.com>"}, "afterCommit": {"oid": "54938c0c0d31ff50115ac0984eab8caf5e555a45", "author": {"user": {"login": "simonameng", "name": "Simona Meng"}}, "url": "https://github.com/eclipse-openj9/openj9/commit/54938c0c0d31ff50115ac0984eab8caf5e555a45", "committedDate": "2020-02-06T21:04:02Z", "message": "Add native function 'isBigEndian' in JITHelpers.java\n\nAdd native function 'isBigEndian' following the implementation of 'Java_sun_misc_Unsafe_isBigEndian0'.\n\nDeprecate `IS_PLATFORM_LITTLE_ENDIAN` with `isBigEndian` function.\n\nSigned-off-by: simonameng <simonameng97@gmail.com>"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "54938c0c0d31ff50115ac0984eab8caf5e555a45", "author": {"user": {"login": "simonameng", "name": "Simona Meng"}}, "url": "https://github.com/eclipse-openj9/openj9/commit/54938c0c0d31ff50115ac0984eab8caf5e555a45", "committedDate": "2020-02-06T21:04:02Z", "message": "Add native function 'isBigEndian' in JITHelpers.java\n\nAdd native function 'isBigEndian' following the implementation of 'Java_sun_misc_Unsafe_isBigEndian0'.\n\nDeprecate `IS_PLATFORM_LITTLE_ENDIAN` with `isBigEndian` function.\n\nSigned-off-by: simonameng <simonameng97@gmail.com>"}, "afterCommit": {"oid": "ca2381c0bac08bd5f96ae731c8f6d413b772a132", "author": {"user": {"login": "simonameng", "name": "Simona Meng"}}, "url": "https://github.com/eclipse-openj9/openj9/commit/ca2381c0bac08bd5f96ae731c8f6d413b772a132", "committedDate": "2020-02-06T21:06:21Z", "message": "Add native function 'isBigEndian' in JITHelpers.java\n\nAdd native function 'isBigEndian' following the implementation of 'Java_sun_misc_Unsafe_isBigEndian0'.\n\nDeprecate `IS_PLATFORM_LITTLE_ENDIAN` with `isBigEndian` function.\n\nSigned-off-by: simonameng <simonameng97@gmail.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e572188cf2091a26587e720125bb85105af029fd", "author": {"user": {"login": "simonameng", "name": "Simona Meng"}}, "url": "https://github.com/eclipse-openj9/openj9/commit/e572188cf2091a26587e720125bb85105af029fd", "committedDate": "2020-02-06T21:24:20Z", "message": "Use 'putByteInArrayByIndex' in Test_JITHelpers.java\n\nUse `putByteInArrayByIndex` function to put the zero byte into the\nright index of `char[]`, instead of checking the `byteOrder` and\nthen doing `&= 0x00FF` or `&= 0xFF00`\n\nSigned-off-by: simonameng <simonameng97@gmail.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "3b10478d58186d4999a928b4b94144b676946904", "author": {"user": {"login": "simonameng", "name": "Simona Meng"}}, "url": "https://github.com/eclipse-openj9/openj9/commit/3b10478d58186d4999a928b4b94144b676946904", "committedDate": "2020-02-06T21:25:23Z", "message": "Inline and fold away 'nativeOrder' and 'byteOrder' function\n\nAdd `nativeOrder` and `byteOrder` to j9 method list, worth inlining\nlist and 'foldFinalFieldsIn' list.\n\nChange copyright in relevant files.\n\nSigned-off-by: simonameng <simonameng97@gmail.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c3b31dfd306d222a956ce4dd122bd8f1f0aa1b09", "author": {"user": {"login": "simonameng", "name": "Simona Meng"}}, "url": "https://github.com/eclipse-openj9/openj9/commit/c3b31dfd306d222a956ce4dd122bd8f1f0aa1b09", "committedDate": "2020-02-06T21:26:07Z", "message": "Add native function 'isBigEndian' in JITHelpers.java\n\nAdd native function 'isBigEndian' following the implementation\nof 'Java_sun_misc_Unsafe_isBigEndian0'.\n\nDeprecate `IS_PLATFORM_LITTLE_ENDIAN` with `isBigEndian` function.\n\nSigned-off-by: simonameng <simonameng97@gmail.com>"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "ca2381c0bac08bd5f96ae731c8f6d413b772a132", "author": {"user": {"login": "simonameng", "name": "Simona Meng"}}, "url": "https://github.com/eclipse-openj9/openj9/commit/ca2381c0bac08bd5f96ae731c8f6d413b772a132", "committedDate": "2020-02-06T21:06:21Z", "message": "Add native function 'isBigEndian' in JITHelpers.java\n\nAdd native function 'isBigEndian' following the implementation of 'Java_sun_misc_Unsafe_isBigEndian0'.\n\nDeprecate `IS_PLATFORM_LITTLE_ENDIAN` with `isBigEndian` function.\n\nSigned-off-by: simonameng <simonameng97@gmail.com>"}, "afterCommit": {"oid": "c3b31dfd306d222a956ce4dd122bd8f1f0aa1b09", "author": {"user": {"login": "simonameng", "name": "Simona Meng"}}, "url": "https://github.com/eclipse-openj9/openj9/commit/c3b31dfd306d222a956ce4dd122bd8f1f0aa1b09", "committedDate": "2020-02-06T21:26:07Z", "message": "Add native function 'isBigEndian' in JITHelpers.java\n\nAdd native function 'isBigEndian' following the implementation\nof 'Java_sun_misc_Unsafe_isBigEndian0'.\n\nDeprecate `IS_PLATFORM_LITTLE_ENDIAN` with `isBigEndian` function.\n\nSigned-off-by: simonameng <simonameng97@gmail.com>"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzU0Nzg2NzA3", "url": "https://github.com/eclipse-openj9/openj9/pull/8294#pullrequestreview-354786707", "createdAt": "2020-02-06T21:32:17Z", "commit": {"oid": "ca2381c0bac08bd5f96ae731c8f6d413b772a132"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 846, "cost": 1, "resetAt": "2021-10-28T18:00:02Z"}}}