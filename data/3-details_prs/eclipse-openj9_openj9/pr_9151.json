{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDAwMTM0OTY5", "number": 9151, "title": "AArch64: DDR: Implement StackWalker.java and MethodMetaData.java", "bodyText": "This commit implements aarch64 specific code for StackWalker.java and MethodMetaData.java.\nCo-authored-by: KONNO Kazuhiro konno@jp.ibm.com\nSigned-off-by: Akira Saitoh saiaki@jp.ibm.com", "createdAt": "2020-04-07T09:00:52Z", "url": "https://github.com/eclipse-openj9/openj9/pull/9151", "merged": true, "mergeCommit": {"oid": "9df3430d489c0c99a1fc495661aeb40d165d7f39"}, "closed": true, "closedAt": "2020-04-09T18:11:22Z", "author": {"login": "Akira1Saitoh"}, "timelineItems": {"totalCount": 7, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcVjZ6EABqjMyMTMwMTQyMjY=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcWAjTzgFqTM5MTAyMDE5Ng==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "3049e70f78ba8dc19001b2e860dc6a9fc1292377", "author": {"user": {"login": "Akira1Saitoh", "name": "Akira Saito"}}, "url": "https://github.com/eclipse-openj9/openj9/commit/3049e70f78ba8dc19001b2e860dc6a9fc1292377", "committedDate": "2020-04-07T08:50:32Z", "message": "AArch64: Fix jitCalleeSavedRegisterList\n\nThis commit adds r29-r31 to `jitCalleeSavedRegisterList` for aarch64\nbecause `CLEAR_LOCAL_REGISTER_MAP_ENTRIES` expects `jitCalleeSavedRegisterList` to\nhave (`J9SW_POTENTIAL_SAVED_REGISTERS` - `J9SW_JIT_CALLEE_PRESERVED_SIZE`) elements.\n\nSigned-off-by: Akira Saitoh <saiaki@jp.ibm.com>"}, "afterCommit": {"oid": "bb9f4d74ea6426869fcdedae21d4d08b72401725", "author": {"user": {"login": "Akira1Saitoh", "name": "Akira Saito"}}, "url": "https://github.com/eclipse-openj9/openj9/commit/bb9f4d74ea6426869fcdedae21d4d08b72401725", "committedDate": "2020-04-07T03:01:05Z", "message": "AArch64: DDR: Implement StackWalker.java and MethodMetaData.java\n\nThis commit implements aarch64 specific code for StackWalker.java and MethodMetaData.java.\n\nCo-authored-by: KONNO Kazuhiro <konno@jp.ibm.com>\n\nSigned-off-by: Akira Saitoh <saiaki@jp.ibm.com>"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzg5OTUwOTQ1", "url": "https://github.com/eclipse-openj9/openj9/pull/9151#pullrequestreview-389950945", "createdAt": "2020-04-08T13:02:04Z", "commit": {"oid": "bb9f4d74ea6426869fcdedae21d4d08b72401725"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzg5OTgyNzQy", "url": "https://github.com/eclipse-openj9/openj9/pull/9151#pullrequestreview-389982742", "createdAt": "2020-04-08T13:38:46Z", "commit": {"oid": "bb9f4d74ea6426869fcdedae21d4d08b72401725"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wOFQxMzozODo0NlrOGCvsfw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wOFQxMzo0NzoyNlrOGCwEsg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNTUzMTc3NQ==", "bodyText": "What is the intent here? If the goal is to select just 16 bits, the constant must change to 0xFFFF0000L.\nsavedGPRs = registerSaveDescription.bitAnd(0xFFFF0000L);\n\nIf we want 24 bits, the mask should be 0xFFFFFFFFFFFF0000L.\nsavedGPRs = registerSaveDescription.bitAnd(0xFFFFFFFFFFFF0000L);\n\nAlso notice there's no need to construct the intermediate UDATA object.", "url": "https://github.com/eclipse-openj9/openj9/pull/9151#discussion_r405531775", "createdAt": "2020-04-08T13:38:46Z", "author": {"login": "keithc-ca"}, "path": "debugtools/DDR_VM/src/com/ibm/j9ddr/vm29/j9/stackwalker/MethodMetaData.java", "diffHunk": "@@ -516,6 +516,27 @@ public void jitAddSpilledRegisters(WalkState walkState, VoidPointer stackMap) th\n \t\t\t\t\t}\n \t\t\t\t\twhile (! savedGPRs.eq(0));\n \t\t\t\t}\n+\t\t\t} else if (J9ConfigFlags.arch_aarch64) {\n+\t\t\t\tsavedGPRs = registerSaveDescription.bitAnd(new UDATA(0xFFFF0000));", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "bb9f4d74ea6426869fcdedae21d4d08b72401725"}, "originalPosition": 12}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNTUzNjYxOA==", "bodyText": "It doesn't appear that i is needed.\nAlso, please fix formatting:\n\tif (!savedGPRs.eq(0)) {\n\t\tsaveOffset = registerSaveDescription.bitAnd(0xFFFF);\n\t\tsaveCursor = walkState.bp.subOffset(saveOffset);\n\t\tdo {\n\t\t\tif (savedGPRs.anyBitsIn(1)) {\n\t\t\t\twalkState.registerEAs[mapCursor] = saveCursor;\n\t\t\t\tsaveCursor = saveCursor.add(1);\n\t\t\t}\n\t\t\t++mapCursor;\n\t\t\tsavedGPRs = savedGPRs.rightShift(1);\n\t\t} while (!savedGPRs.eq(0));\n\t}", "url": "https://github.com/eclipse-openj9/openj9/pull/9151#discussion_r405536618", "createdAt": "2020-04-08T13:45:34Z", "author": {"login": "keithc-ca"}, "path": "debugtools/DDR_VM/src/com/ibm/j9ddr/vm29/j9/stackwalker/MethodMetaData.java", "diffHunk": "@@ -516,6 +516,27 @@ public void jitAddSpilledRegisters(WalkState walkState, VoidPointer stackMap) th\n \t\t\t\t\t}\n \t\t\t\t\twhile (! savedGPRs.eq(0));\n \t\t\t\t}\n+\t\t\t} else if (J9ConfigFlags.arch_aarch64) {\n+\t\t\t\tsavedGPRs = registerSaveDescription.bitAnd(new UDATA(0xFFFF0000));\n+\n+\t\t\t\tif (! savedGPRs.eq(0))\n+\t\t\t\t{\n+\t\t\t\t\tsaveOffset = registerSaveDescription.bitAnd(new UDATA(0xFFFF));\n+\t\t\t\t\tsaveCursor = walkState.bp.subOffset(saveOffset);\n+\t\t\t\t\tU8 i = new U8(1);\n+\t\t\t\t\tdo\n+\t\t\t\t\t{\n+\t\t\t\t\t\tif (savedGPRs.anyBitsIn(1))\n+\t\t\t\t\t\t{\n+\t\t\t\t\t\t\twalkState.registerEAs[mapCursor] = saveCursor;\n+\t\t\t\t\t\t\tsaveCursor = saveCursor.add(1);\n+\t\t\t\t\t\t}\n+\t\t\t\t\t\ti = i.add(1);\n+\t\t\t\t\t\t++mapCursor;\n+\t\t\t\t\t\tsavedGPRs = savedGPRs.rightShift(1);\n+\t\t\t\t\t}\n+\t\t\t\t\twhile (! savedGPRs.eq(0));\n+\t\t\t\t}", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "bb9f4d74ea6426869fcdedae21d4d08b72401725"}, "originalPosition": 31}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNTUzNzk3MA==", "bodyText": "Please format comment with * beginning the second and subsequent lines.\n\t/* AArch64 data resolve shape\n\t * 29 integer registers (not saving x29/x30/x31)\n\t */", "url": "https://github.com/eclipse-openj9/openj9/pull/9151#discussion_r405537970", "createdAt": "2020-04-08T13:47:26Z", "author": {"login": "keithc-ca"}, "path": "debugtools/DDR_VM/src/com/ibm/j9ddr/vm29/j9/stackwalker/MethodMetaData.java", "diffHunk": "@@ -569,6 +590,11 @@ public UDATA getJitDataResolvePushes() throws CorruptDataException {\n \t\t\t\t   12 slots saved integer registers\n \t\t\t\t*/\n \t\t\t\treturn new UDATA(12);\n+\t\t\t} else if (J9ConfigFlags.arch_aarch64) {\n+\t\t\t\t/* AArch64 data resolve shape\n+\t\t\t\t   29 integer registers (not saving x29/x30/x31)\n+\t\t\t\t*/", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "bb9f4d74ea6426869fcdedae21d4d08b72401725"}, "originalPosition": 42}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "dc7aef7d86c7ad6820cf0c77f82491ba831b92df", "author": {"user": {"login": "Akira1Saitoh", "name": "Akira Saito"}}, "url": "https://github.com/eclipse-openj9/openj9/commit/dc7aef7d86c7ad6820cf0c77f82491ba831b92df", "committedDate": "2020-04-09T00:41:38Z", "message": "AArch64: DDR: Implement StackWalker.java and MethodMetaData.java\n\nThis commit implements aarch64 specific code for StackWalker.java and MethodMetaData.java.\n\nCo-authored-by: KONNO Kazuhiro <konno@jp.ibm.com>\n\nSigned-off-by: Akira Saitoh <saiaki@jp.ibm.com>"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "bb9f4d74ea6426869fcdedae21d4d08b72401725", "author": {"user": {"login": "Akira1Saitoh", "name": "Akira Saito"}}, "url": "https://github.com/eclipse-openj9/openj9/commit/bb9f4d74ea6426869fcdedae21d4d08b72401725", "committedDate": "2020-04-07T03:01:05Z", "message": "AArch64: DDR: Implement StackWalker.java and MethodMetaData.java\n\nThis commit implements aarch64 specific code for StackWalker.java and MethodMetaData.java.\n\nCo-authored-by: KONNO Kazuhiro <konno@jp.ibm.com>\n\nSigned-off-by: Akira Saitoh <saiaki@jp.ibm.com>"}, "afterCommit": {"oid": "dc7aef7d86c7ad6820cf0c77f82491ba831b92df", "author": {"user": {"login": "Akira1Saitoh", "name": "Akira Saito"}}, "url": "https://github.com/eclipse-openj9/openj9/commit/dc7aef7d86c7ad6820cf0c77f82491ba831b92df", "committedDate": "2020-04-09T00:41:38Z", "message": "AArch64: DDR: Implement StackWalker.java and MethodMetaData.java\n\nThis commit implements aarch64 specific code for StackWalker.java and MethodMetaData.java.\n\nCo-authored-by: KONNO Kazuhiro <konno@jp.ibm.com>\n\nSigned-off-by: Akira Saitoh <saiaki@jp.ibm.com>"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzkwNzMyMTc5", "url": "https://github.com/eclipse-openj9/openj9/pull/9151#pullrequestreview-390732179", "createdAt": "2020-04-09T12:05:59Z", "commit": {"oid": "dc7aef7d86c7ad6820cf0c77f82491ba831b92df"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzkxMDIwMTk2", "url": "https://github.com/eclipse-openj9/openj9/pull/9151#pullrequestreview-391020196", "createdAt": "2020-04-09T18:10:59Z", "commit": {"oid": "dc7aef7d86c7ad6820cf0c77f82491ba831b92df"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1207, "cost": 1, "resetAt": "2021-10-28T17:48:14Z"}}}