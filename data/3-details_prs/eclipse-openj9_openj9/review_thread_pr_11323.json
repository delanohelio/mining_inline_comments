{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTMwNTIyMTQ1", "number": 11323, "reviewThreads": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0wMVQyMzo0OToxNVrOE_Yvmw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0wMlQwMDoxMToyNlrOE_ZFxA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzM0OTAxMTQ3OnYy", "diffSide": "RIGHT", "path": "runtime/compiler/control/CompilationRuntime.hpp", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0wMVQyMzo0OToxNVrOH9EgzQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0wMVQyMzo0OToxNVrOH9EgzQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMzc5OTExNw==", "bodyText": "We could mark this one as const", "url": "https://github.com/eclipse-openj9/openj9/pull/11323#discussion_r533799117", "createdAt": "2020-12-01T23:49:15Z", "author": {"login": "mpirvu"}, "path": "runtime/compiler/control/CompilationRuntime.hpp", "diffHunk": "@@ -1048,6 +1048,9 @@ class CompilationInfo\n    void  addJITServerSslCert(const std::string &cert) { _sslCerts.push_back(cert); }\n    const std::string &getJITServerSslRootCerts() const { return _sslRootCerts; }\n    void  setJITServerSslRootCerts(const std::string &cert) { _sslRootCerts = cert; }\n+\n+   bool serverHasLowPhysicalMemory() { return _serverHasLowPhysicalMemory; }", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "02384daf5119b242a252705725f0cc0f0b636bdf"}, "originalPosition": 5}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzM0OTA0MTg4OnYy", "diffSide": "RIGHT", "path": "runtime/compiler/control/CompilationThread.cpp", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0wMlQwMDowMDo0NVrOH9Ex7A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0wMlQwMDowMDo0NVrOH9Ex7A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMzgwMzUwMA==", "bodyText": "I would move this piece of code up where the 'NO' decisions are taken. As it is now, we may take the path that leads to TR_yes above.", "url": "https://github.com/eclipse-openj9/openj9/pull/11323#discussion_r533803500", "createdAt": "2020-12-02T00:00:45Z", "author": {"login": "mpirvu"}, "path": "runtime/compiler/control/CompilationThread.cpp", "diffHunk": "@@ -549,6 +549,10 @@ TR_YesNoMaybe TR::CompilationInfo::shouldActivateNewCompThread()\n #if defined(J9VM_OPT_JITSERVER)\n       else if (getPersistentInfo()->getRemoteCompilationMode() == JITServer::CLIENT && JITServerHelpers::isServerAvailable())\n          {\n+         // If the available memory on the server is low, do not activate more threads", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "02384daf5119b242a252705725f0cc0f0b636bdf"}, "originalPosition": 4}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzM0OTA2ODIwOnYy", "diffSide": "RIGHT", "path": "runtime/compiler/control/CompilationThread.cpp", "isResolved": false, "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0wMlQwMDoxMToyNlrOH9FAvg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0wMlQxMzoxNzoxOFrOH9adqg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMzgwNzI5NA==", "bodyText": "TR_VerboseLog::writeLineLocked needs another %s for the new string. It gets tricky though due to the ifdef. I am ok with being a little imprecise and say just \"LowPhysicalMem\", but the decision should come from either the local JVM and or the remote server:\nbool lowPhysicalMem = compInfo->getSuspendThreadDueToLowPhysicalMemory();\n#if defined(J9VM_OPT_JITSERVER)\nlowPhysicalMem = lowPhysicalMem || compInfo->serverHasLowPhysicalMemory();\n#endif", "url": "https://github.com/eclipse-openj9/openj9/pull/11323#discussion_r533807294", "createdAt": "2020-12-02T00:11:26Z", "author": {"login": "mpirvu"}, "path": "runtime/compiler/control/CompilationThread.cpp", "diffHunk": "@@ -4406,7 +4415,11 @@ TR::CompilationInfoPerThread::processEntry(TR_MethodToBeCompiled &entry, J9::J9S\n             compInfo->getQueueWeight(),\n             compInfo->getNumCompThreadsActive(),\n             compInfo->getRampDownMCT() ? \"RampDownMCT\" : \"\",\n-            compInfo->getSuspendThreadDueToLowPhysicalMemory() ? \"LowPhysicalMem\" : \"\");\n+            compInfo->getSuspendThreadDueToLowPhysicalMemory() ? \"LowPhysicalMem\" : \"\",\n+#if defined(J9VM_OPT_JITSERVER)\n+            compInfo->serverHasLowPhysicalMemory() ? \"ServerLowPhysicalMem\" : \"\"", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "02384daf5119b242a252705725f0cc0f0b636bdf"}, "originalPosition": 46}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMzgyMDU2NQ==", "bodyText": "Yeah, or we could print an empty string if JITServer is not enabled:\n   compInfo->getRampDownMCT() ? \"RampDownMCT\" : \"\",\n   compInfo->getSuspendThreadDueToLowPhysicalMemory() ? \"LowPhysicalMem\" : \"\",\n#if defined(J9VM_OPT_JITSERVER)\n   compInfo->serverHasLowPhysicalMemory() ? \"ServerLowPhysicalMem\" :\n#endif\n    \"\"", "url": "https://github.com/eclipse-openj9/openj9/pull/11323#discussion_r533820565", "createdAt": "2020-12-02T00:49:23Z", "author": {"login": "dmitry-ten"}, "path": "runtime/compiler/control/CompilationThread.cpp", "diffHunk": "@@ -4406,7 +4415,11 @@ TR::CompilationInfoPerThread::processEntry(TR_MethodToBeCompiled &entry, J9::J9S\n             compInfo->getQueueWeight(),\n             compInfo->getNumCompThreadsActive(),\n             compInfo->getRampDownMCT() ? \"RampDownMCT\" : \"\",\n-            compInfo->getSuspendThreadDueToLowPhysicalMemory() ? \"LowPhysicalMem\" : \"\");\n+            compInfo->getSuspendThreadDueToLowPhysicalMemory() ? \"LowPhysicalMem\" : \"\",\n+#if defined(J9VM_OPT_JITSERVER)\n+            compInfo->serverHasLowPhysicalMemory() ? \"ServerLowPhysicalMem\" : \"\"", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMzgwNzI5NA=="}, "originalCommit": {"oid": "02384daf5119b242a252705725f0cc0f0b636bdf"}, "originalPosition": 46}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNDE1ODc2Mg==", "bodyText": "I am fine either way", "url": "https://github.com/eclipse-openj9/openj9/pull/11323#discussion_r534158762", "createdAt": "2020-12-02T13:17:18Z", "author": {"login": "mpirvu"}, "path": "runtime/compiler/control/CompilationThread.cpp", "diffHunk": "@@ -4406,7 +4415,11 @@ TR::CompilationInfoPerThread::processEntry(TR_MethodToBeCompiled &entry, J9::J9S\n             compInfo->getQueueWeight(),\n             compInfo->getNumCompThreadsActive(),\n             compInfo->getRampDownMCT() ? \"RampDownMCT\" : \"\",\n-            compInfo->getSuspendThreadDueToLowPhysicalMemory() ? \"LowPhysicalMem\" : \"\");\n+            compInfo->getSuspendThreadDueToLowPhysicalMemory() ? \"LowPhysicalMem\" : \"\",\n+#if defined(J9VM_OPT_JITSERVER)\n+            compInfo->serverHasLowPhysicalMemory() ? \"ServerLowPhysicalMem\" : \"\"", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMzgwNzI5NA=="}, "originalCommit": {"oid": "02384daf5119b242a252705725f0cc0f0b636bdf"}, "originalPosition": 46}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 992, "cost": 1, "resetAt": "2021-11-12T13:16:51Z"}}}