{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0MzY2NTkzMjI1", "number": 8391, "title": "JEP 359 cfdumper support", "bodyText": "Fixes: #7945\ndepends on JEP 359 part 1: #8061\ndepends on JEP 359 part 2: #8351\nSigned-off-by: Theresa Mammarella Theresa.T.Mammarella@ibm.com", "createdAt": "2020-01-23T22:14:58Z", "url": "https://github.com/eclipse-openj9/openj9/pull/8391", "merged": true, "mergeCommit": {"oid": "d76de472f7a985a780e2ba7fca4b6fbe2de0f2de"}, "closed": true, "closedAt": "2020-02-15T02:48:26Z", "author": {"login": "theresa-m"}, "timelineItems": {"totalCount": 11, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABb9R7lvgBqjI5NzU0ODE1MDU=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcETpdyAH2gAyMzY2NTkzMjI1OmJiMjljYTVjMDUyZmI4MDM5YzY5YzllZmJiMzljN2NhNDUzYjcwNjE=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "218b501e5a7c9de72d01be3bf74aa4a4a2270c0a", "author": {"user": {"login": "theresa-m", "name": "Theresa Mammarella"}}, "url": "https://github.com/eclipse-openj9/openj9/commit/218b501e5a7c9de72d01be3bf74aa4a4a2270c0a", "committedDate": "2020-01-23T21:59:49Z", "message": "JEP 359 cfdumper support\n\nSigned-off-by: Theresa Mammarella <Theresa.T.Mammarella@ibm.com>"}, "afterCommit": {"oid": "234637713f11baaf591d89247e4ed5ce3105b4cd", "author": {"user": {"login": "theresa-m", "name": "Theresa Mammarella"}}, "url": "https://github.com/eclipse-openj9/openj9/commit/234637713f11baaf591d89247e4ed5ce3105b4cd", "committedDate": "2020-01-23T22:17:40Z", "message": "JEP 359 cfdumper support\n\nSigned-off-by: Theresa Mammarella <Theresa.T.Mammarella@ibm.com>"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "234637713f11baaf591d89247e4ed5ce3105b4cd", "author": {"user": {"login": "theresa-m", "name": "Theresa Mammarella"}}, "url": "https://github.com/eclipse-openj9/openj9/commit/234637713f11baaf591d89247e4ed5ce3105b4cd", "committedDate": "2020-01-23T22:17:40Z", "message": "JEP 359 cfdumper support\n\nSigned-off-by: Theresa Mammarella <Theresa.T.Mammarella@ibm.com>"}, "afterCommit": {"oid": "668dd4e5d94459742b22ea4437cd816a94d58f3b", "author": {"user": {"login": "theresa-m", "name": "Theresa Mammarella"}}, "url": "https://github.com/eclipse-openj9/openj9/commit/668dd4e5d94459742b22ea4437cd816a94d58f3b", "committedDate": "2020-01-29T21:27:30Z", "message": "JEP 359 cfdumper support\n\nSigned-off-by: Theresa Mammarella <Theresa.T.Mammarella@ibm.com>"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "668dd4e5d94459742b22ea4437cd816a94d58f3b", "author": {"user": {"login": "theresa-m", "name": "Theresa Mammarella"}}, "url": "https://github.com/eclipse-openj9/openj9/commit/668dd4e5d94459742b22ea4437cd816a94d58f3b", "committedDate": "2020-01-29T21:27:30Z", "message": "JEP 359 cfdumper support\n\nSigned-off-by: Theresa Mammarella <Theresa.T.Mammarella@ibm.com>"}, "afterCommit": {"oid": "88d94b7a04654ce27c8728da0092f9e339b4107b", "author": {"user": {"login": "theresa-m", "name": "Theresa Mammarella"}}, "url": "https://github.com/eclipse-openj9/openj9/commit/88d94b7a04654ce27c8728da0092f9e339b4107b", "committedDate": "2020-02-09T07:06:15Z", "message": "JEP 359 cfdumper support\n\nSigned-off-by: Theresa Mammarella <Theresa.T.Mammarella@ibm.com>"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "88d94b7a04654ce27c8728da0092f9e339b4107b", "author": {"user": {"login": "theresa-m", "name": "Theresa Mammarella"}}, "url": "https://github.com/eclipse-openj9/openj9/commit/88d94b7a04654ce27c8728da0092f9e339b4107b", "committedDate": "2020-02-09T07:06:15Z", "message": "JEP 359 cfdumper support\n\nSigned-off-by: Theresa Mammarella <Theresa.T.Mammarella@ibm.com>"}, "afterCommit": {"oid": "d14d8d1c9ba094259e2cfa3581b92a945bac5bf4", "author": {"user": {"login": "theresa-m", "name": "Theresa Mammarella"}}, "url": "https://github.com/eclipse-openj9/openj9/commit/d14d8d1c9ba094259e2cfa3581b92a945bac5bf4", "committedDate": "2020-02-10T14:05:29Z", "message": "JEP 359 cfdumper support\n\nSigned-off-by: Theresa Mammarella <Theresa.T.Mammarella@ibm.com>"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzU4MjkxNTM3", "url": "https://github.com/eclipse-openj9/openj9/pull/8391#pullrequestreview-358291537", "createdAt": "2020-02-13T15:07:13Z", "commit": {"oid": "d14d8d1c9ba094259e2cfa3581b92a945bac5bf4"}, "state": "COMMENTED", "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xM1QxNTowNzoxM1rOFpXXCQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xM1QxNToxMzowMFrOFpXlIQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3ODkxODY2NQ==", "bodyText": "Do the typeAnnotations need to be analyzed here as well?  Same for the component annotations?   Otherwise I'm not sure how their UTF8s get added", "url": "https://github.com/eclipse-openj9/openj9/pull/8391#discussion_r378918665", "createdAt": "2020-02-13T15:07:13Z", "author": {"login": "DanHeidinga"}, "path": "runtime/bcutil/ClassFileWriter.cpp", "diffHunk": "@@ -493,6 +498,37 @@ ClassFileWriter::analyzeMethods()\n \t}\n }\n \n+void\n+ClassFileWriter::analyzeRecordAttribute()\n+{\n+\taddEntry((void *) &RECORD, 0, CFR_CONSTANT_Utf8);\n+\n+\t/* first 4 bytes contains number of record components */\n+\tU_32 numberOfRecords = getNumberOfRecordComponents(_romClass);\n+\tJ9ROMRecordComponentShape* recordComponent = recordComponentStartDo(_romClass);\n+\tfor (U_32 i = 0; i < numberOfRecords; i++) {\n+\n+\t\t/* record component name and signature */\n+\t\taddEntry(J9ROMRECORDCOMPONENTSHAPE_NAME(recordComponent), 0, CFR_CONSTANT_Utf8);\n+\t\taddEntry(J9ROMRECORDCOMPONENTSHAPE_SIGNATURE(recordComponent), 0, CFR_CONSTANT_Utf8);\n+\n+\t\t/* analyze attributes */\n+\t\tif (recordComponentHasSignature(recordComponent)) {\n+\t\t\tJ9UTF8* genericSignature = getRecordComponentGenericSignature(recordComponent);\n+\t\t\taddEntry((void *) &SIGNATURE, 0, CFR_CONSTANT_Utf8);\n+\t\t\taddEntry(genericSignature, 0, CFR_CONSTANT_Utf8);\n+\t\t}\n+\t\tif (recordComponentHasAnnotations(recordComponent)) {\n+\t\t\taddEntry((void *) &RUNTIME_VISIBLE_ANNOTATIONS, 0, CFR_CONSTANT_Utf8);\n+\t\t}\n+\t\tif (recordComponentHasTypeAnnotations(recordComponent)) {\n+\t\t\taddEntry((void *) &RUNTIME_VISIBLE_TYPE_ANNOTATIONS, 0, CFR_CONSTANT_Utf8);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d14d8d1c9ba094259e2cfa3581b92a945bac5bf4"}, "originalPosition": 54}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3ODkyMTMxNQ==", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            \t * Write zero as a placeholder for length. */\n          \n          \n            \n            \t * Write zero as a placeholder for length. \n          \n          \n            \n            \t */", "url": "https://github.com/eclipse-openj9/openj9/pull/8391#discussion_r378921315", "createdAt": "2020-02-13T15:11:33Z", "author": {"login": "DanHeidinga"}, "path": "runtime/bcutil/ClassFileWriter.cpp", "diffHunk": "@@ -1041,6 +1080,67 @@ ClassFileWriter::writeAttributes()\n \t\t\t}\n \t\t}\n \t}\n+\n+\t/* record attribute */\n+\tif (J9_ARE_ANY_BITS_SET(_romClass->extraModifiers, J9AccRecord)) {\n+\t\twriteRecordAttribute();\n+\t}\n+}\n+\n+void ClassFileWriter::writeRecordAttribute()\n+{\n+\t/* Write header - size calculation will be written specially at the end.\n+\t * Write zero as a placeholder for length. */", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d14d8d1c9ba094259e2cfa3581b92a945bac5bf4"}, "originalPosition": 88}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3ODkyMjI3Mw==", "bodyText": "please assign initial values", "url": "https://github.com/eclipse-openj9/openj9/pull/8391#discussion_r378922273", "createdAt": "2020-02-13T15:13:00Z", "author": {"login": "DanHeidinga"}, "path": "runtime/util/romclasswalk.c", "diffHunk": "@@ -701,6 +701,68 @@ static void allSlotsInConstantPoolDo(J9ROMClass* romClass, J9ROMClassWalkCallbac\n \t}\n }\n \n+static UDATA\n+allSlotsInRecordComponentDo(J9ROMClass* romClass, J9ROMRecordComponentShape* recordComponent, J9ROMClassWalkCallbacks* callbacks, void* userData) {\n+\tBOOLEAN rangeValid;\n+\tU_32 attributeFlags;\n+\tJ9ROMNameAndSignature *recordComponentNAS;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d14d8d1c9ba094259e2cfa3581b92a945bac5bf4"}, "originalPosition": 15}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "d14d8d1c9ba094259e2cfa3581b92a945bac5bf4", "author": {"user": {"login": "theresa-m", "name": "Theresa Mammarella"}}, "url": "https://github.com/eclipse-openj9/openj9/commit/d14d8d1c9ba094259e2cfa3581b92a945bac5bf4", "committedDate": "2020-02-10T14:05:29Z", "message": "JEP 359 cfdumper support\n\nSigned-off-by: Theresa Mammarella <Theresa.T.Mammarella@ibm.com>"}, "afterCommit": {"oid": "b41b7148492ce6f8c73fb35b3719b5632e125616", "author": {"user": {"login": "theresa-m", "name": "Theresa Mammarella"}}, "url": "https://github.com/eclipse-openj9/openj9/commit/b41b7148492ce6f8c73fb35b3719b5632e125616", "committedDate": "2020-02-13T17:23:58Z", "message": "JEP 359 cfdumper support\n\nSigned-off-by: Theresa Mammarella <Theresa.T.Mammarella@ibm.com>"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzU4NDQ5Mjgw", "url": "https://github.com/eclipse-openj9/openj9/pull/8391#pullrequestreview-358449280", "createdAt": "2020-02-13T18:25:43Z", "commit": {"oid": "b41b7148492ce6f8c73fb35b3719b5632e125616"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xM1QxODoyNTo0NFrOFpesnw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xM1QxODoyNTo0NFrOFpesnw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3OTAzODg3OQ==", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            \t * Stored as U32 in the ROM class, U16 in class file. */\n          \n          \n            \n            \t * Stored as U32 in the ROM class, U16 in class file.\n          \n          \n            \n            \t */", "url": "https://github.com/eclipse-openj9/openj9/pull/8391#discussion_r379038879", "createdAt": "2020-02-13T18:25:44Z", "author": {"login": "DanHeidinga"}, "path": "runtime/bcutil/ClassFileWriter.cpp", "diffHunk": "@@ -1041,6 +1080,68 @@ ClassFileWriter::writeAttributes()\n \t\t\t}\n \t\t}\n \t}\n+\n+\t/* record attribute */\n+\tif (J9_ARE_ANY_BITS_SET(_romClass->extraModifiers, J9AccRecord)) {\n+\t\twriteRecordAttribute();\n+\t}\n+}\n+\n+void ClassFileWriter::writeRecordAttribute()\n+{\n+\t/* Write header - size calculation will be written specially at the end.\n+\t * Write zero as a placeholder for length.\n+\t */\n+\twriteU16(indexForUTF8((J9UTF8 *) &RECORD));\n+\tU_8* recordAttributeLengthAddr = _classFileCursor;\n+\twriteU32(0);\n+\tU_8* startLengthCalculationAddr = _classFileCursor;\n+\t\n+\t/* write number of record components (components_count).\n+\t * Stored as U32 in the ROM class, U16 in class file. */", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b41b7148492ce6f8c73fb35b3719b5632e125616"}, "originalPosition": 96}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "3d8c9bd0bba514b1bb5a4bb2ea515d925811c6b6", "author": {"user": {"login": "theresa-m", "name": "Theresa Mammarella"}}, "url": "https://github.com/eclipse-openj9/openj9/commit/3d8c9bd0bba514b1bb5a4bb2ea515d925811c6b6", "committedDate": "2020-02-13T18:49:41Z", "message": "Update runtime/bcutil/ClassFileWriter.cpp\n\nCo-Authored-By: Dan Heidinga <daniel_heidinga@ca.ibm.com>"}, "afterCommit": {"oid": "dfbd5fcf01c00920193a8a964fca042762189c50", "author": {"user": {"login": "theresa-m", "name": "Theresa Mammarella"}}, "url": "https://github.com/eclipse-openj9/openj9/commit/dfbd5fcf01c00920193a8a964fca042762189c50", "committedDate": "2020-02-13T18:50:28Z", "message": "JEP 359 cfdumper support\n\nSigned-off-by: Theresa Mammarella <Theresa.T.Mammarella@ibm.com>"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "dfbd5fcf01c00920193a8a964fca042762189c50", "author": {"user": {"login": "theresa-m", "name": "Theresa Mammarella"}}, "url": "https://github.com/eclipse-openj9/openj9/commit/dfbd5fcf01c00920193a8a964fca042762189c50", "committedDate": "2020-02-13T18:50:28Z", "message": "JEP 359 cfdumper support\n\nSigned-off-by: Theresa Mammarella <Theresa.T.Mammarella@ibm.com>"}, "afterCommit": {"oid": "c7f78a392701a06476ed4d56ebd6614b21bf8573", "author": {"user": {"login": "theresa-m", "name": "Theresa Mammarella"}}, "url": "https://github.com/eclipse-openj9/openj9/commit/c7f78a392701a06476ed4d56ebd6614b21bf8573", "committedDate": "2020-02-14T07:14:44Z", "message": "JEP 359 cfdumper support\n\nSigned-off-by: Theresa Mammarella <Theresa.T.Mammarella@ibm.com>"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "c7f78a392701a06476ed4d56ebd6614b21bf8573", "author": {"user": {"login": "theresa-m", "name": "Theresa Mammarella"}}, "url": "https://github.com/eclipse-openj9/openj9/commit/c7f78a392701a06476ed4d56ebd6614b21bf8573", "committedDate": "2020-02-14T07:14:44Z", "message": "JEP 359 cfdumper support\n\nSigned-off-by: Theresa Mammarella <Theresa.T.Mammarella@ibm.com>"}, "afterCommit": {"oid": "bb29ca5c052fb8039c69c9efbb39c7ca453b7061", "author": {"user": {"login": "theresa-m", "name": "Theresa Mammarella"}}, "url": "https://github.com/eclipse-openj9/openj9/commit/bb29ca5c052fb8039c69c9efbb39c7ca453b7061", "committedDate": "2020-02-14T18:15:16Z", "message": "JEP 359 cfdumper support\n\nSigned-off-by: Theresa Mammarella <Theresa.T.Mammarella@ibm.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "bb29ca5c052fb8039c69c9efbb39c7ca453b7061", "author": {"user": {"login": "theresa-m", "name": "Theresa Mammarella"}}, "url": "https://github.com/eclipse-openj9/openj9/commit/bb29ca5c052fb8039c69c9efbb39c7ca453b7061", "committedDate": "2020-02-14T18:15:16Z", "message": "JEP 359 cfdumper support\n\nSigned-off-by: Theresa Mammarella <Theresa.T.Mammarella@ibm.com>"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 917, "cost": 1, "resetAt": "2021-10-28T18:00:02Z"}}}