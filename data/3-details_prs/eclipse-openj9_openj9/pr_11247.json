{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTI1OTExMDQz", "number": 11247, "title": "Add ability to activate CH Table at an arbitrary point", "bodyText": "The CHT is augmented to have a notion of a state. By default, the state is active. However, this PR adds the infrastructure to allow the CH Table to be initially inactive, and activated at a later point in JVM execution. The API to activate the CH Table assumes a stop the world event where the class hierarchy isn't changing. It then calls a helper method which is recursive, as follows:\n\nAdd superclasses\nAdd interfaces implemented\nTrigger class load hook\nTrigger class preinitialize hook\nAdd array class\n\nThis code is mostly a port from the snapshot branch.", "createdAt": "2020-11-23T18:15:14Z", "url": "https://github.com/eclipse-openj9/openj9/pull/11247", "merged": true, "mergeCommit": {"oid": "7264964d9269f1d0cc8f33f9db37d1a30695bbf4"}, "closed": true, "closedAt": "2020-12-07T16:10:28Z", "author": {"login": "dsouzai"}, "timelineItems": {"totalCount": 12, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdiQNCfgFqTU0MjkzNTgxOQ==", "endCursor": "Y3Vyc29yOnYyOpPPAAABdj33mzAFqTU0NjMwMDAzMQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTQyOTM1ODE5", "url": "https://github.com/eclipse-openj9/openj9/pull/11247#pullrequestreview-542935819", "createdAt": "2020-12-02T15:12:55Z", "commit": {"oid": "e589b6b7e84f4e33a22fa2a30b33eaa3031518fa"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0wMlQxNToxMjo1NVrOH9fsIA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0wMlQxNToxMzoyMlrOH9ftYw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNDI0NDM4NA==", "bodyText": "For completeness, add activationFailed ?", "url": "https://github.com/eclipse-openj9/openj9/pull/11247#discussion_r534244384", "createdAt": "2020-12-02T15:12:55Z", "author": {"login": "0xdaryl"}, "path": "runtime/compiler/env/PersistentCHTable.hpp", "diffHunk": "@@ -46,6 +46,24 @@ namespace TR { class ResolvedMethodSymbol; }\n \n class TR_PersistentCHTable\n    {\n+   private:\n+   /**\n+    * @brief Enum to denote the state of the CH Table:\n+    *\n+    *        active: Data in the CH Table can be used and updated.\n+    *        activating: CH Table is in the process of being activated;\n+    *                    this state is used when the CH Table is\n+    *                    being populated in the restore run.\n+    *        reset: CH Table is not active.", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "e589b6b7e84f4e33a22fa2a30b33eaa3031518fa"}, "originalPosition": 12}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNDI0NDcwNw==", "bodyText": "Should reset be first to match the ordering in the enum?", "url": "https://github.com/eclipse-openj9/openj9/pull/11247#discussion_r534244707", "createdAt": "2020-12-02T15:13:22Z", "author": {"login": "0xdaryl"}, "path": "runtime/compiler/env/PersistentCHTable.hpp", "diffHunk": "@@ -46,6 +46,24 @@ namespace TR { class ResolvedMethodSymbol; }\n \n class TR_PersistentCHTable\n    {\n+   private:\n+   /**\n+    * @brief Enum to denote the state of the CH Table:\n+    *\n+    *        active: Data in the CH Table can be used and updated.\n+    *        activating: CH Table is in the process of being activated;\n+    *                    this state is used when the CH Table is\n+    *                    being populated in the restore run.\n+    *        reset: CH Table is not active.", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "e589b6b7e84f4e33a22fa2a30b33eaa3031518fa"}, "originalPosition": 12}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "feffd039c2a010d5ca1b8b977a7f9149f5e29913", "author": {"user": {"login": "dsouzai", "name": "Irwin D'Souza"}}, "url": "https://github.com/eclipse-openj9/openj9/commit/feffd039c2a010d5ca1b8b977a7f9149f5e29913", "committedDate": "2020-12-02T16:32:26Z", "message": "Add _status field\n\nAdd field that will be used to determine whether the CH Table is active\nor not.\n\nSigned-off-by: Irwin D'Souza <dsouzai.gh@gmail.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "52dbc2588c216981daa12d676fcd98116ac91c87", "author": {"user": {"login": "dsouzai", "name": "Irwin D'Souza"}}, "url": "https://github.com/eclipse-openj9/openj9/commit/52dbc2588c216981daa12d676fcd98116ac91c87", "committedDate": "2020-12-02T16:32:27Z", "message": "Disable CH Opts if CHT is not active\n\nSigned-off-by: Irwin D'Souza <dsouzai.gh@gmail.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "9b6d5974bf29f56f5dd81d8080d6c48d7dd26ff7", "author": {"user": {"login": "dsouzai", "name": "Irwin D'Souza"}}, "url": "https://github.com/eclipse-openj9/openj9/commit/9b6d5974bf29f56f5dd81d8080d6c48d7dd26ff7", "committedDate": "2020-12-02T16:32:27Z", "message": "Refactor jitHookClassLoad\n\nSigned-off-by: Irwin D'Souza <dsouzai.gh@gmail.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "fccb45befc4c7f5db5c3570cae50287dbde39e96", "author": {"user": {"login": "dsouzai", "name": "Irwin D'Souza"}}, "url": "https://github.com/eclipse-openj9/openj9/commit/fccb45befc4c7f5db5c3570cae50287dbde39e96", "committedDate": "2020-12-02T16:32:27Z", "message": "Refactor jitHookClassPreinitialize\n\nSigned-off-by: Irwin D'Souza <dsouzai.gh@gmail.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a621c7c9c17e73a1206c380ca1b78f370bd7f82f", "author": {"user": {"login": "dsouzai", "name": "Irwin D'Souza"}}, "url": "https://github.com/eclipse-openj9/openj9/commit/a621c7c9c17e73a1206c380ca1b78f370bd7f82f", "committedDate": "2020-12-02T16:32:27Z", "message": "Ensure CHT is active in class unload hooks\n\nSigned-off-by: Irwin D'Souza <dsouzai.gh@gmail.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "1f8972a66141270d335d24e00183042286d2c233", "author": {"user": {"login": "dsouzai", "name": "Irwin D'Souza"}}, "url": "https://github.com/eclipse-openj9/openj9/commit/1f8972a66141270d335d24e00183042286d2c233", "committedDate": "2020-12-02T16:32:27Z", "message": "Ensure CHT is active in class redef hooks\n\nSigned-off-by: Irwin D'Souza <dsouzai.gh@gmail.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f01a06c54b6512519edbba9fb15c4d388a2df5bf", "author": {"user": {"login": "dsouzai", "name": "Irwin D'Souza"}}, "url": "https://github.com/eclipse-openj9/openj9/commit/f01a06c54b6512519edbba9fb15c4d388a2df5bf", "committedDate": "2020-12-02T16:32:27Z", "message": "Add sanity checks to CHT APIs\n\nEnsure that the CHT APIs are aware of the status of the CHT.\n\nSigned-off-by: Irwin D'Souza <dsouzai.gh@gmail.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "1e1398ea8436d4b450baf2d8789a1f19ee997f5d", "author": {"user": {"login": "dsouzai", "name": "Irwin D'Souza"}}, "url": "https://github.com/eclipse-openj9/openj9/commit/1e1398ea8436d4b450baf2d8789a1f19ee997f5d", "committedDate": "2020-12-02T16:32:27Z", "message": "Add ability to activate CH Table\n\nThis commit adds an API to activate the the CH Table. This only makes\nsense in the context of Snapshot/Restore. It assumes a stop the world\nevent where the class hierarchy isn't changing. It then calls a helper\nmethod which is recursive, as follows:\n\n1. Add superclasses\n2. Add interfaces implemented\n3. Trigger class load hook\n4. Trigger class preinitialize hook\n5. Add array class\n\nSigned-off-by: Irwin D'Souza <dsouzai.gh@gmail.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "043c3c65ba6a7889d13137fccdf5885a384e3e2e", "author": {"user": {"login": "dsouzai", "name": "Irwin D'Souza"}}, "url": "https://github.com/eclipse-openj9/openj9/commit/043c3c65ba6a7889d13137fccdf5885a384e3e2e", "committedDate": "2020-12-02T16:32:37Z", "message": "Abstract away check for whether recompilation is allowed\n\nSigned-off-by: Irwin D'Souza <dsouzai.gh@gmail.com>"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "0efdded6403247d28fca53431cb1a2abe4487fdf", "author": {"user": {"login": "dsouzai", "name": "Irwin D'Souza"}}, "url": "https://github.com/eclipse-openj9/openj9/commit/0efdded6403247d28fca53431cb1a2abe4487fdf", "committedDate": "2020-11-20T18:11:37Z", "message": "Abstract away check for whether recompilation is allowed\n\nSigned-off-by: Irwin D'Souza <dsouzai.gh@gmail.com>"}, "afterCommit": {"oid": "043c3c65ba6a7889d13137fccdf5885a384e3e2e", "author": {"user": {"login": "dsouzai", "name": "Irwin D'Souza"}}, "url": "https://github.com/eclipse-openj9/openj9/commit/043c3c65ba6a7889d13137fccdf5885a384e3e2e", "committedDate": "2020-12-02T16:32:37Z", "message": "Abstract away check for whether recompilation is allowed\n\nSigned-off-by: Irwin D'Souza <dsouzai.gh@gmail.com>"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTQ2MzAwMDMx", "url": "https://github.com/eclipse-openj9/openj9/pull/11247#pullrequestreview-546300031", "createdAt": "2020-12-07T16:10:06Z", "commit": {"oid": "043c3c65ba6a7889d13137fccdf5885a384e3e2e"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1627, "cost": 1, "resetAt": "2021-10-28T17:48:14Z"}}}