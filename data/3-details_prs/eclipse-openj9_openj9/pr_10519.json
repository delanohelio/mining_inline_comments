{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDc4NzkzMjcz", "number": 10519, "title": "Exploit prefixed instruction in IPIC sequence on POWER10", "bodyText": "Previously, either pTOC entry or long sequence are used in gettting\nthe snippet address. Prefixed instruction can be used for the same\npurpose nicely on P10 without pTOC.\nCorrespondingly, interface snippet emitting needs to change. In\nparticular, CallSitePatching needs to be adjusted as well.\nSigned-off-by: Julian Wang zlwang@ca.ibm.com", "createdAt": "2020-09-03T17:57:30Z", "url": "https://github.com/eclipse-openj9/openj9/pull/10519", "merged": true, "mergeCommit": {"oid": "65765ef2d09399c7594f156cf3962e3fb165c449"}, "closed": true, "closedAt": "2020-09-09T19:22:51Z", "author": {"login": "zl-wang"}, "timelineItems": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdFZYWmgFqTQ4MjI2OTg4NA==", "endCursor": "Y3Vyc29yOnYyOpPPAAABdHQkvZgH2gAyNDc4NzkzMjczOmE0ZTRmMmVmMDllNDM0MjZmZjQ3MTY3YjNjNmJmN2YzNmIxNDMwZDg=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDgyMjY5ODg0", "url": "https://github.com/eclipse-openj9/openj9/pull/10519#pullrequestreview-482269884", "createdAt": "2020-09-03T23:40:47Z", "commit": {"oid": "fcd9772caa2b5650cd593722e4619d49caf0f528"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0wM1QyMzo0MDo0N1rOHM60iQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0wM1QyMzo0MDo0N1rOHM60iQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MzMwODY4MQ==", "bodyText": "Should not it be shift left by 14, not 16 ?", "url": "https://github.com/eclipse-openj9/openj9/pull/10519#discussion_r483308681", "createdAt": "2020-09-03T23:40:47Z", "author": {"login": "gita-omr"}, "path": "runtime/compiler/runtime/Trampoline.cpp", "diffHunk": "@@ -480,25 +480,36 @@ bool ppcCodePatching(void *method, void *callSite, void *currentPC, void *curren\n \n          oldBits = *(int32_t *)((uint8_t *)callSite - encodingStartOffset);     // The load of the first IPIC cache slot or rldimi\n #if defined(TR_TARGET_64BIT)\n-         if (((oldBits>>26) & 0x0000003F) != 30)\n+         if (TR::Compiler->target.cpu.isAtLeast(OMR_PROCESSOR_PPC_P10))\n             {\n-            // PTOC was used, oldBits is ld\n-            currentDistance = oldBits<<16>>16;\n-            if (((oldBits>>16) & 0x0000001F) == 12)\n-               {\n-               oldBits = *(int32_t *)((uint8_t *)callSite - encodingStartOffset - 4);\n-               currentDistance += oldBits<<16;\n-               }\n-            patchAddr = *(uint8_t **)(*(intptr_t *)extra + currentDistance);\n+            // oldBits is the latter half of paddi\n+            distance = ((*(int32_t *)((uint8_t *)callSite - encodingStartOffset - 4)) & 0x0003FFFF) << 16;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "fcd9772caa2b5650cd593722e4619d49caf0f528"}, "originalPosition": 16}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "fcd9772caa2b5650cd593722e4619d49caf0f528", "author": {"user": {"login": "zl-wang", "name": "Julian Wang"}}, "url": "https://github.com/eclipse-openj9/openj9/commit/fcd9772caa2b5650cd593722e4619d49caf0f528", "committedDate": "2020-09-03T20:25:55Z", "message": "Exploit prefixed instruction in IPIC sequence on POWER10\n\nPreviously, either pTOC entry or long sequence are used in gettting\nthe snippet address. Prefixed instruction can be used for the same\npurpose nicely on P10 without pTOC.\n\nCorrespondingly, interface snippet emitting needs to change. In\nparticular, CallSitePatching needs to be adjusted as well.\n\nSigned-off-by: Julian Wang <zlwang@ca.ibm.com>"}, "afterCommit": {"oid": "50ba021366e5ab23b4f275a0753912d611cccc39", "author": {"user": {"login": "zl-wang", "name": "Julian Wang"}}, "url": "https://github.com/eclipse-openj9/openj9/commit/50ba021366e5ab23b4f275a0753912d611cccc39", "committedDate": "2020-09-04T19:00:08Z", "message": "Exploit prefixed instruction in IPIC sequence on POWER10\n\nPreviously, either pTOC entry or long sequence are used in gettting\nthe snippet address. Prefixed instruction can be used for the same\npurpose nicely on P10 without pTOC.\n\nCorrespondingly, interface snippet emitting needs to change. In\nparticular, CallSitePatching needs to be adjusted as well.\n\nType-casting for the top 18-bit offset to avoid potential loss of bits.\n\nSigned-off-by: Julian Wang <zlwang@ca.ibm.com>"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "50ba021366e5ab23b4f275a0753912d611cccc39", "author": {"user": {"login": "zl-wang", "name": "Julian Wang"}}, "url": "https://github.com/eclipse-openj9/openj9/commit/50ba021366e5ab23b4f275a0753912d611cccc39", "committedDate": "2020-09-04T19:00:08Z", "message": "Exploit prefixed instruction in IPIC sequence on POWER10\n\nPreviously, either pTOC entry or long sequence are used in gettting\nthe snippet address. Prefixed instruction can be used for the same\npurpose nicely on P10 without pTOC.\n\nCorrespondingly, interface snippet emitting needs to change. In\nparticular, CallSitePatching needs to be adjusted as well.\n\nType-casting for the top 18-bit offset to avoid potential loss of bits.\n\nSigned-off-by: Julian Wang <zlwang@ca.ibm.com>"}, "afterCommit": {"oid": "a4e4f2ef09e43426ff47167b3c6bf7f36b1430d8", "author": {"user": {"login": "zl-wang", "name": "Julian Wang"}}, "url": "https://github.com/eclipse-openj9/openj9/commit/a4e4f2ef09e43426ff47167b3c6bf7f36b1430d8", "committedDate": "2020-09-09T18:33:19Z", "message": "Exploit prefixed instruction in IPIC sequence on POWER10\n\nPreviously, either pTOC entry or long sequence are used in gettting\nthe snippet address. Prefixed instruction can be used for the same\npurpose nicely on P10 without pTOC.\n\nCorrespondingly, interface snippet emitting needs to change. In\nparticular, CallSitePatching needs to be adjusted as well.\n\nType-casting for the top 18-bit offset to avoid potential loss of bits.\n\nSplit the code to make it clearer.\n\nSigned-off-by: Julian Wang <zlwang@ca.ibm.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a4e4f2ef09e43426ff47167b3c6bf7f36b1430d8", "author": {"user": {"login": "zl-wang", "name": "Julian Wang"}}, "url": "https://github.com/eclipse-openj9/openj9/commit/a4e4f2ef09e43426ff47167b3c6bf7f36b1430d8", "committedDate": "2020-09-09T18:33:19Z", "message": "Exploit prefixed instruction in IPIC sequence on POWER10\n\nPreviously, either pTOC entry or long sequence are used in gettting\nthe snippet address. Prefixed instruction can be used for the same\npurpose nicely on P10 without pTOC.\n\nCorrespondingly, interface snippet emitting needs to change. In\nparticular, CallSitePatching needs to be adjusted as well.\n\nType-casting for the top 18-bit offset to avoid potential loss of bits.\n\nSplit the code to make it clearer.\n\nSigned-off-by: Julian Wang <zlwang@ca.ibm.com>"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4939, "cost": 1, "resetAt": "2021-10-28T18:54:27Z"}}}