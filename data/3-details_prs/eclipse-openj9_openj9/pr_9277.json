{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDA1MzI0MjY5", "number": 9277, "title": "Disable JProfiling and JitProfiling for JITServer", "bodyText": "JProfiling and JitProfiling are not supported by JITServer.\nJProfiling is disabled by setting an option,\nbut for JitProfiling need to ensure that TR_PersistentProfileInfo\nrecords do not get created and set pointers to them to NULL\non the server, if they do get created.", "createdAt": "2020-04-17T20:23:27Z", "url": "https://github.com/eclipse-openj9/openj9/pull/9277", "merged": true, "mergeCommit": {"oid": "db73f469dfc925f5000e1979ca38bb6200d56c33"}, "closed": true, "closedAt": "2020-04-28T01:14:44Z", "author": {"login": "dmitry-ten"}, "timelineItems": {"totalCount": 12, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcYoH34ABqjMyNDYwMzIzMzQ=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcbzKcOAFqTQwMTE5MzgyMQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "3c768d5a01bc78df39a4cc249b647a3c821bfe17", "author": {"user": {"login": "dmitry-ten", "name": "Dmitry Ten"}}, "url": "https://github.com/eclipse-openj9/openj9/commit/3c768d5a01bc78df39a4cc249b647a3c821bfe17", "committedDate": "2020-04-16T18:16:46Z", "message": "Disable JProfiling and JitProfiling for JITServer\n\nJProfiling and JitProfiling are not supported by JITServer.\nJProfiling is disabled by setting an option,\nbut for JitProfiling need to ensure that `TR_PersistentProfileInfo`\nrecords do not get created and set pointers to them to NULL\non the server, if they do get created.\n\nSigned-off-by: Dmitry Ten <Dmitry.Ten@ibm.com>"}, "afterCommit": {"oid": "abd0dce5dcf40f6305afc93c48e8d765000cd368", "author": {"user": {"login": "dmitry-ten", "name": "Dmitry Ten"}}, "url": "https://github.com/eclipse-openj9/openj9/commit/abd0dce5dcf40f6305afc93c48e8d765000cd368", "committedDate": "2020-04-17T21:24:43Z", "message": "Disable JProfiling and JitProfiling for JITServer\n\nJProfiling and JitProfiling are not supported by JITServer.\nJProfiling is disabled by setting an option,\nbut for JitProfiling need to ensure that `TR_PersistentProfileInfo`\nrecords do not get created and set pointers to them to NULL\non the server, if they do get created.\n\nSigned-off-by: Dmitry Ten <Dmitry.Ten@ibm.com>"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "abd0dce5dcf40f6305afc93c48e8d765000cd368", "author": {"user": {"login": "dmitry-ten", "name": "Dmitry Ten"}}, "url": "https://github.com/eclipse-openj9/openj9/commit/abd0dce5dcf40f6305afc93c48e8d765000cd368", "committedDate": "2020-04-17T21:24:43Z", "message": "Disable JProfiling and JitProfiling for JITServer\n\nJProfiling and JitProfiling are not supported by JITServer.\nJProfiling is disabled by setting an option,\nbut for JitProfiling need to ensure that `TR_PersistentProfileInfo`\nrecords do not get created and set pointers to them to NULL\non the server, if they do get created.\n\nSigned-off-by: Dmitry Ten <Dmitry.Ten@ibm.com>"}, "afterCommit": {"oid": "0978498444b103b0c7776e6b3c7ef20bf602355b", "author": {"user": {"login": "dmitry-ten", "name": "Dmitry Ten"}}, "url": "https://github.com/eclipse-openj9/openj9/commit/0978498444b103b0c7776e6b3c7ef20bf602355b", "committedDate": "2020-04-17T21:27:37Z", "message": "Disable JProfiling and JitProfiling for JITServer\n\nJProfiling and JitProfiling are not supported by JITServer.\nJProfiling is disabled by setting an option,\nbut for JitProfiling need to ensure that `TR_PersistentProfileInfo`\nrecords do not get created and set pointers to them to NULL\non the server, if they do get created.\n\nSigned-off-by: Dmitry Ten <Dmitry.Ten@ibm.com>"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzk1NzkyOTA5", "url": "https://github.com/eclipse-openj9/openj9/pull/9277#pullrequestreview-395792909", "createdAt": "2020-04-17T21:49:40Z", "commit": {"oid": "0978498444b103b0c7776e6b3c7ef20bf602355b"}, "state": "COMMENTED", "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0xN1QyMTo0OTo0MFrOGHeHZw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0xN1QyMjoxMzozMFrOGHen1w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMDQ4NjYzMQ==", "bodyText": "Below, we check for _methodInfo->isProfilingDisabled()\nThis is set in the constructor\nTR_PersistentMethodInfo::TR_PersistentMethodInfo(TR::Compilation *comp)\n{\n...\n  if (comp->getOption(TR_DisableProfiling))\n      {\n      setDisableProfiling();\n      }\n...\n}\n\nSo, if we disabled profiling we don't need anything else in this method.", "url": "https://github.com/eclipse-openj9/openj9/pull/9277#discussion_r410486631", "createdAt": "2020-04-17T21:49:40Z", "author": {"login": "mpirvu"}, "path": "runtime/compiler/control/J9Recompilation.cpp", "diffHunk": "@@ -341,6 +349,14 @@ J9::Recompilation::endOfCompilation()\n bool\n J9::Recompilation::switchToProfiling(uint32_t f, uint32_t c)\n    {\n+   // JITServer doesn't support JitProfiling\n+#if defined(J9VM_OPT_JITSERVER)", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "0978498444b103b0c7776e6b3c7ef20bf602355b"}, "originalPosition": 25}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMDQ5MTk1NQ==", "bodyText": "I scanned the code and as far as I can tell optimizationPlan->insertInstrumentation() is false if getOption(TR_DisableProfiling) is true. Thus, we don't need the check on JITServer::SERVER or JITServer::CLIENT", "url": "https://github.com/eclipse-openj9/openj9/pull/9277#discussion_r410491955", "createdAt": "2020-04-17T22:04:00Z", "author": {"login": "mpirvu"}, "path": "runtime/compiler/control/J9Recompilation.cpp", "diffHunk": "@@ -126,10 +126,18 @@ J9::Recompilation::setupMethodInfo()\n \n    // TR_Controller is being used and has provided a compilation plan.  Use it to setup the compilation\n    //\n+   // JITServer does not support JitProfiling\n+   bool performProfiling = (optimizationPlan->insertInstrumentation() != 0);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "0978498444b103b0c7776e6b3c7ef20bf602355b"}, "originalPosition": 5}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMDQ5NDkzNQ==", "bodyText": "I would use do this in J9Options.cpp in J9::Options::setupJITServerOptions()\nAlso add  self()->setOption(TR_EnableJProfiling, false); as I don't see it.", "url": "https://github.com/eclipse-openj9/openj9/pull/9277#discussion_r410494935", "createdAt": "2020-04-17T22:13:30Z", "author": {"login": "mpirvu"}, "path": "runtime/compiler/control/rossa.cpp", "diffHunk": "@@ -1586,6 +1586,14 @@ onLoadInternal(\n       ((TR_JitPrivateConfig*)(jitConfig->privateConfig))->iProfiler = NULL;\n       }\n \n+#if defined(J9VM_OPT_JITSERVER)\n+   // JITServer doesn't support JProfiling\n+   if (persistentMemory->getPersistentInfo()->getRemoteCompilationMode() == JITServer::CLIENT\n+       || persistentMemory->getPersistentInfo()->getRemoteCompilationMode() == JITServer::SERVER)\n+      {\n+      TR::Options::getCmdLineOptions()->setOption(TR_DisableJProfilerThread);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "0978498444b103b0c7776e6b3c7ef20bf602355b"}, "originalPosition": 9}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzk4NDUzNDYz", "url": "https://github.com/eclipse-openj9/openj9/pull/9277#pullrequestreview-398453463", "createdAt": "2020-04-22T18:13:57Z", "commit": {"oid": "2531084e9ff338fd408f10cc3e395544c382d2a7"}, "state": "COMMENTED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "2531084e9ff338fd408f10cc3e395544c382d2a7", "author": {"user": {"login": "dmitry-ten", "name": "Dmitry Ten"}}, "url": "https://github.com/eclipse-openj9/openj9/commit/2531084e9ff338fd408f10cc3e395544c382d2a7", "committedDate": "2020-04-22T17:56:28Z", "message": "Try to simplify the commit\n\nSigned-off-by: Dmitry Ten <Dmitry.Ten@ibm.com>"}, "afterCommit": {"oid": "7cd89d4e4a2c2f1b465e0718bc3f0dbe90f47314", "author": {"user": {"login": "dmitry-ten", "name": "Dmitry Ten"}}, "url": "https://github.com/eclipse-openj9/openj9/commit/7cd89d4e4a2c2f1b465e0718bc3f0dbe90f47314", "committedDate": "2020-04-24T20:31:56Z", "message": "Try to simplify the commit\n\nSigned-off-by: Dmitry Ten <Dmitry.Ten@ibm.com>"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "7cd89d4e4a2c2f1b465e0718bc3f0dbe90f47314", "author": {"user": {"login": "dmitry-ten", "name": "Dmitry Ten"}}, "url": "https://github.com/eclipse-openj9/openj9/commit/7cd89d4e4a2c2f1b465e0718bc3f0dbe90f47314", "committedDate": "2020-04-24T20:31:56Z", "message": "Try to simplify the commit\n\nSigned-off-by: Dmitry Ten <Dmitry.Ten@ibm.com>"}, "afterCommit": {"oid": "f7f046275553d3bf719cb9d0c48a8f29be338f15", "author": {"user": {"login": "dmitry-ten", "name": "Dmitry Ten"}}, "url": "https://github.com/eclipse-openj9/openj9/commit/f7f046275553d3bf719cb9d0c48a8f29be338f15", "committedDate": "2020-04-24T20:32:46Z", "message": "Try to simplify the commit\n\nSigned-off-by: Dmitry Ten <Dmitry.Ten@ibm.com>"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "f7f046275553d3bf719cb9d0c48a8f29be338f15", "author": {"user": {"login": "dmitry-ten", "name": "Dmitry Ten"}}, "url": "https://github.com/eclipse-openj9/openj9/commit/f7f046275553d3bf719cb9d0c48a8f29be338f15", "committedDate": "2020-04-24T20:32:46Z", "message": "Try to simplify the commit\n\nSigned-off-by: Dmitry Ten <Dmitry.Ten@ibm.com>"}, "afterCommit": {"oid": "6ce4d60de6ac3614699ef9f6ef1d0c4303fb0719", "author": {"user": {"login": "dmitry-ten", "name": "Dmitry Ten"}}, "url": "https://github.com/eclipse-openj9/openj9/commit/6ce4d60de6ac3614699ef9f6ef1d0c4303fb0719", "committedDate": "2020-04-24T21:18:18Z", "message": "Disable JProfiling and JitProfiling for JITServer\n\nJProfiling and JitProfiling are not supported by JITServer.\nJProfiling is disabled by setting an option,\nbut for JitProfiling need to ensure that `TR_PersistentProfileInfo`\nrecords do not get created and set pointers to them to NULL\non the server, if they do get created.\n\nSigned-off-by: Dmitry Ten <Dmitry.Ten@ibm.com>"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "6ce4d60de6ac3614699ef9f6ef1d0c4303fb0719", "author": {"user": {"login": "dmitry-ten", "name": "Dmitry Ten"}}, "url": "https://github.com/eclipse-openj9/openj9/commit/6ce4d60de6ac3614699ef9f6ef1d0c4303fb0719", "committedDate": "2020-04-24T21:18:18Z", "message": "Disable JProfiling and JitProfiling for JITServer\n\nJProfiling and JitProfiling are not supported by JITServer.\nJProfiling is disabled by setting an option,\nbut for JitProfiling need to ensure that `TR_PersistentProfileInfo`\nrecords do not get created and set pointers to them to NULL\non the server, if they do get created.\n\nSigned-off-by: Dmitry Ten <Dmitry.Ten@ibm.com>"}, "afterCommit": {"oid": "389fa38d601a2cd06d3ad665e79546ded21208ba", "author": {"user": {"login": "dmitry-ten", "name": "Dmitry Ten"}}, "url": "https://github.com/eclipse-openj9/openj9/commit/389fa38d601a2cd06d3ad665e79546ded21208ba", "committedDate": "2020-04-24T21:25:54Z", "message": "Disable JProfiling and JitProfiling for JITServer\n\nJProfiling and JitProfiling are not supported by JITServer.\nJProfiling is disabled by setting an option,\nbut for JitProfiling need to ensure that `TR_PersistentProfileInfo`\nrecords do not get created and set pointers to them to NULL\non the server, if they do get created.\n\nSigned-off-by: Dmitry Ten <Dmitry.Ten@ibm.com>"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDAwMzExOTA0", "url": "https://github.com/eclipse-openj9/openj9/pull/9277#pullrequestreview-400311904", "createdAt": "2020-04-24T22:48:13Z", "commit": {"oid": "389fa38d601a2cd06d3ad665e79546ded21208ba"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "aafdf81c440d71ca5ccbda9e1fa5411ac3946895", "author": {"user": {"login": "dmitry-ten", "name": "Dmitry Ten"}}, "url": "https://github.com/eclipse-openj9/openj9/commit/aafdf81c440d71ca5ccbda9e1fa5411ac3946895", "committedDate": "2020-04-27T16:02:46Z", "message": "Disable JProfiling and JitProfiling for JITServer\n\nJProfiling and JitProfiling are not supported by JITServer.\nJProfiling is disabled by setting an option,\nbut for JitProfiling need to ensure that `TR_PersistentProfileInfo`\nrecords do not get created and set pointers to them to NULL\non the server, if they do get created.\n\nSigned-off-by: Dmitry Ten <Dmitry.Ten@ibm.com>"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "389fa38d601a2cd06d3ad665e79546ded21208ba", "author": {"user": {"login": "dmitry-ten", "name": "Dmitry Ten"}}, "url": "https://github.com/eclipse-openj9/openj9/commit/389fa38d601a2cd06d3ad665e79546ded21208ba", "committedDate": "2020-04-24T21:25:54Z", "message": "Disable JProfiling and JitProfiling for JITServer\n\nJProfiling and JitProfiling are not supported by JITServer.\nJProfiling is disabled by setting an option,\nbut for JitProfiling need to ensure that `TR_PersistentProfileInfo`\nrecords do not get created and set pointers to them to NULL\non the server, if they do get created.\n\nSigned-off-by: Dmitry Ten <Dmitry.Ten@ibm.com>"}, "afterCommit": {"oid": "aafdf81c440d71ca5ccbda9e1fa5411ac3946895", "author": {"user": {"login": "dmitry-ten", "name": "Dmitry Ten"}}, "url": "https://github.com/eclipse-openj9/openj9/commit/aafdf81c440d71ca5ccbda9e1fa5411ac3946895", "committedDate": "2020-04-27T16:02:46Z", "message": "Disable JProfiling and JitProfiling for JITServer\n\nJProfiling and JitProfiling are not supported by JITServer.\nJProfiling is disabled by setting an option,\nbut for JitProfiling need to ensure that `TR_PersistentProfileInfo`\nrecords do not get created and set pointers to them to NULL\non the server, if they do get created.\n\nSigned-off-by: Dmitry Ten <Dmitry.Ten@ibm.com>"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDAxMTkzODIx", "url": "https://github.com/eclipse-openj9/openj9/pull/9277#pullrequestreview-401193821", "createdAt": "2020-04-27T17:58:36Z", "commit": {"oid": "aafdf81c440d71ca5ccbda9e1fa5411ac3946895"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1012, "cost": 1, "resetAt": "2021-10-28T17:48:14Z"}}}