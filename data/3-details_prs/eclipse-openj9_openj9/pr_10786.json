{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDk4MDQyNzY1", "number": 10786, "title": "Use client address of prepareForOSR helper", "bodyText": "On Power, the entry point of the method needs to be stored\nin gr12 register. Current relocation infrastructure cannot\nrelocate the helper address that's stored in a non-call instruction,\nso JITServer just fetches the helper address from the client and sets\nit in the helpers table.", "createdAt": "2020-10-05T18:39:33Z", "url": "https://github.com/eclipse-openj9/openj9/pull/10786", "merged": true, "mergeCommit": {"oid": "ac1cca161b2ed2ea789e33038b9a4396a34c650c"}, "closed": true, "closedAt": "2020-10-07T14:33:07Z", "author": {"login": "dmitry-ten"}, "timelineItems": {"totalCount": 20, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdPpL7RAFqTUwMjM2MjA5MQ==", "endCursor": "Y3Vyc29yOnYyOpPPAAABdP8uRugFqTUwMzI0OTEyNA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTAyMzYyMDkx", "url": "https://github.com/eclipse-openj9/openj9/pull/10786#pullrequestreview-502362091", "createdAt": "2020-10-05T19:38:37Z", "commit": {"oid": "72b125571f27afe03897bce5987cd62591ab4de0"}, "state": "COMMENTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wNVQxOTozODozN1rOHcrDkQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wNVQxOTo0NDo1NVrOHcrP5A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5OTgyNzYwMQ==", "bodyText": "In other parts of the code I see the following parameters being passed:\nfindOrCreateRuntimeHelper(TR_prepareForOSR, false, false, true);\nThis is the meaning of the parameters:\nTR::SymbolReference *\nOMR::SymbolReferenceTable::findOrCreateRuntimeHelper(TR_RuntimeHelper index,\n                                                     bool             canGCandReturn,\n                                                     bool             canGCandExcept,\n                                                     bool             preservesAllRegisters)\n\nIs there a reason you used false for preserveAllregisters?", "url": "https://github.com/eclipse-openj9/openj9/pull/10786#discussion_r499827601", "createdAt": "2020-10-05T19:38:37Z", "author": {"login": "mpirvu"}, "path": "runtime/compiler/control/JITClientCompilationThread.cpp", "diffHunk": "@@ -465,6 +465,7 @@ handleServerMessage(JITServer::ClientStream *client, TR_J9VM *fe, JITServer::Mes\n          vmInfo._interpreterVTableOffset = TR::Compiler->vm.getInterpreterVTableOffset();\n          vmInfo._maxHeapSizeInBytes = TR::Compiler->vm.maxHeapSizeInBytes();\n          vmInfo._enableGlobalLockReservation = vmThread->javaVM->enableGlobalLockReservation;\n+         vmInfo._prepareForOSRHelper = comp->getSymRefTab()->findOrCreateRuntimeHelper(TR_prepareForOSR, false, false, false)->getMethodAddress();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "72b125571f27afe03897bce5987cd62591ab4de0"}, "originalPosition": 4}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5OTgzMDc1Ng==", "bodyText": "Is this runtimeHelpers global? If so, it's not going to work.", "url": "https://github.com/eclipse-openj9/openj9/pull/10786#discussion_r499830756", "createdAt": "2020-10-05T19:44:55Z", "author": {"login": "mpirvu"}, "path": "runtime/compiler/runtime/JITClientSession.cpp", "diffHunk": "@@ -406,6 +406,7 @@ ClientSessionData::getOrCacheVMInfo(JITServer::ServerStream *stream)\n       auto recv = stream->read<VMInfo, std::vector<CacheDescriptor> >();\n       _vmInfo = new (PERSISTENT_NEW) VMInfo(std::get<0>(recv));\n       _vmInfo->_j9SharedClassCacheDescriptorList = reconstructJ9SharedClassCacheDescriptorList(std::get<1>(recv));\n+      runtimeHelpers.setAddress(TR_prepareForOSR, _vmInfo->_prepareForOSRHelper);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "72b125571f27afe03897bce5987cd62591ab4de0"}, "originalPosition": 4}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "72b125571f27afe03897bce5987cd62591ab4de0", "author": {"user": {"login": "dmitry-ten", "name": "Dmitry Ten"}}, "url": "https://github.com/eclipse-openj9/openj9/commit/72b125571f27afe03897bce5987cd62591ab4de0", "committedDate": "2020-10-05T18:34:12Z", "message": "Use client address of prepareForOSR helper\n\nOn Power, the entry point of the method needs to be stored\nin `gr12` register. Current relocation infrastructure cannot\nrelocate the helper address that's stored in a non-call instruction,\nso JITServer just fetches the helper address from the client and sets\nit in the helpers table.\n\nSigned-off-by: Dmitry Ten <Dmitry.Ten@ibm.com>"}, "afterCommit": {"oid": "ff052dd57536adeaf1dda6928b0e117a6a55f38f", "author": {"user": {"login": "dmitry-ten", "name": "Dmitry Ten"}}, "url": "https://github.com/eclipse-openj9/openj9/commit/ff052dd57536adeaf1dda6928b0e117a6a55f38f", "committedDate": "2020-10-05T20:55:30Z", "message": "Use client address of prepareForOSR helper\n\nOn Power, the entry point of the method needs to be stored\nin `gr12` register. Current relocation infrastructure cannot\nrelocate the helper address that's stored in a non-call instruction,\nso JITServer just fetches the helper address from the client and sets\nit in the helpers table.\n\nSigned-off-by: Dmitry Ten <Dmitry.Ten@ibm.com>"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "ff052dd57536adeaf1dda6928b0e117a6a55f38f", "author": {"user": {"login": "dmitry-ten", "name": "Dmitry Ten"}}, "url": "https://github.com/eclipse-openj9/openj9/commit/ff052dd57536adeaf1dda6928b0e117a6a55f38f", "committedDate": "2020-10-05T20:55:30Z", "message": "Use client address of prepareForOSR helper\n\nOn Power, the entry point of the method needs to be stored\nin `gr12` register. Current relocation infrastructure cannot\nrelocate the helper address that's stored in a non-call instruction,\nso JITServer just fetches the helper address from the client and sets\nit in the helpers table.\n\nSigned-off-by: Dmitry Ten <Dmitry.Ten@ibm.com>"}, "afterCommit": {"oid": "e0cb3e39ec5eb798167b4f7202beb5d2cc901211", "author": {"user": {"login": "dmitry-ten", "name": "Dmitry Ten"}}, "url": "https://github.com/eclipse-openj9/openj9/commit/e0cb3e39ec5eb798167b4f7202beb5d2cc901211", "committedDate": "2020-10-06T04:20:17Z", "message": "Use client address of prepareForOSR helper\n\nOn Power, the entry point of the method needs to be stored\nin `gr12` register. Current relocation infrastructure cannot\nrelocate the helper address that's stored in a non-call instruction,\nso JITServer just fetches the helper address from the client and sets\nit in the helpers table.\n\nSigned-off-by: Dmitry Ten <Dmitry.Ten@ibm.com>"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "e0cb3e39ec5eb798167b4f7202beb5d2cc901211", "author": {"user": {"login": "dmitry-ten", "name": "Dmitry Ten"}}, "url": "https://github.com/eclipse-openj9/openj9/commit/e0cb3e39ec5eb798167b4f7202beb5d2cc901211", "committedDate": "2020-10-06T04:20:17Z", "message": "Use client address of prepareForOSR helper\n\nOn Power, the entry point of the method needs to be stored\nin `gr12` register. Current relocation infrastructure cannot\nrelocate the helper address that's stored in a non-call instruction,\nso JITServer just fetches the helper address from the client and sets\nit in the helpers table.\n\nSigned-off-by: Dmitry Ten <Dmitry.Ten@ibm.com>"}, "afterCommit": {"oid": "63ed0ff20226a3784e200c539697083497657fff", "author": {"user": {"login": "dmitry-ten", "name": "Dmitry Ten"}}, "url": "https://github.com/eclipse-openj9/openj9/commit/63ed0ff20226a3784e200c539697083497657fff", "committedDate": "2020-10-06T13:57:00Z", "message": "Fetch addresses of helper methods from the client\n\nOn Power, the entry point of the method needs to be stored in `gr12` register.\nCurrent relocation infrastructure cannot relocate the helper address\nthat's stored in a non-call instruction,\nso this commit adds functionality to fetch the helper address from the\nclient and store it in the server-side cache.\n\nSigned-off-by: Dmitry Ten <Dmitry.Ten@ibm.com>"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "63ed0ff20226a3784e200c539697083497657fff", "author": {"user": {"login": "dmitry-ten", "name": "Dmitry Ten"}}, "url": "https://github.com/eclipse-openj9/openj9/commit/63ed0ff20226a3784e200c539697083497657fff", "committedDate": "2020-10-06T13:57:00Z", "message": "Fetch addresses of helper methods from the client\n\nOn Power, the entry point of the method needs to be stored in `gr12` register.\nCurrent relocation infrastructure cannot relocate the helper address\nthat's stored in a non-call instruction,\nso this commit adds functionality to fetch the helper address from the\nclient and store it in the server-side cache.\n\nSigned-off-by: Dmitry Ten <Dmitry.Ten@ibm.com>"}, "afterCommit": {"oid": "eabde637fbf5a181197ce34557658d843786452b", "author": {"user": {"login": "dmitry-ten", "name": "Dmitry Ten"}}, "url": "https://github.com/eclipse-openj9/openj9/commit/eabde637fbf5a181197ce34557658d843786452b", "committedDate": "2020-10-06T14:05:41Z", "message": "Fetch addresses of helper methods from the client\n\nOn Power, the entry point of the method needs to be stored in `gr12` register.\nCurrent relocation infrastructure cannot relocate the helper address\nthat's stored in a non-call instruction,\nso this commit adds functionality to fetch the helper address from the\nclient and store it in the server-side cache.\n\nSigned-off-by: Dmitry Ten <Dmitry.Ten@ibm.com>"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "eabde637fbf5a181197ce34557658d843786452b", "author": {"user": {"login": "dmitry-ten", "name": "Dmitry Ten"}}, "url": "https://github.com/eclipse-openj9/openj9/commit/eabde637fbf5a181197ce34557658d843786452b", "committedDate": "2020-10-06T14:05:41Z", "message": "Fetch addresses of helper methods from the client\n\nOn Power, the entry point of the method needs to be stored in `gr12` register.\nCurrent relocation infrastructure cannot relocate the helper address\nthat's stored in a non-call instruction,\nso this commit adds functionality to fetch the helper address from the\nclient and store it in the server-side cache.\n\nSigned-off-by: Dmitry Ten <Dmitry.Ten@ibm.com>"}, "afterCommit": {"oid": "fca47708dcc069530abb7f6331f6e6712dc4f586", "author": {"user": {"login": "dmitry-ten", "name": "Dmitry Ten"}}, "url": "https://github.com/eclipse-openj9/openj9/commit/fca47708dcc069530abb7f6331f6e6712dc4f586", "committedDate": "2020-10-06T14:08:35Z", "message": "Fetch addresses of helper methods from the client\n\nOn Power, the entry point of the method needs to be stored in `gr12` register.\nCurrent relocation infrastructure cannot relocate the helper address\nthat's stored in a non-call instruction,\nso this commit adds functionality to fetch the helper address from the\nclient and store it in the server-side cache.\n\nSigned-off-by: Dmitry Ten <Dmitry.Ten@ibm.com>"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "fca47708dcc069530abb7f6331f6e6712dc4f586", "author": {"user": {"login": "dmitry-ten", "name": "Dmitry Ten"}}, "url": "https://github.com/eclipse-openj9/openj9/commit/fca47708dcc069530abb7f6331f6e6712dc4f586", "committedDate": "2020-10-06T14:08:35Z", "message": "Fetch addresses of helper methods from the client\n\nOn Power, the entry point of the method needs to be stored in `gr12` register.\nCurrent relocation infrastructure cannot relocate the helper address\nthat's stored in a non-call instruction,\nso this commit adds functionality to fetch the helper address from the\nclient and store it in the server-side cache.\n\nSigned-off-by: Dmitry Ten <Dmitry.Ten@ibm.com>"}, "afterCommit": {"oid": "5b7f2c04e4eafc173e1765654ce43bc5852b3823", "author": {"user": {"login": "dmitry-ten", "name": "Dmitry Ten"}}, "url": "https://github.com/eclipse-openj9/openj9/commit/5b7f2c04e4eafc173e1765654ce43bc5852b3823", "committedDate": "2020-10-06T14:24:17Z", "message": "Fetch addresses of helper methods from the client\n\nOn Power, the entry point of the method needs to be stored in `gr12` register.\nCurrent relocation infrastructure cannot relocate the helper address\nthat's stored in a non-call instruction,\nso this commit adds functionality to fetch the helper address from the\nclient and store it in the server-side cache.\n\nSigned-off-by: Dmitry Ten <Dmitry.Ten@ibm.com>"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTAyNTc2ODYz", "url": "https://github.com/eclipse-openj9/openj9/pull/10786#pullrequestreview-502576863", "createdAt": "2020-10-06T04:35:18Z", "commit": {"oid": "e0cb3e39ec5eb798167b4f7202beb5d2cc901211"}, "state": "COMMENTED", "comments": {"totalCount": 7, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wNlQwNDozNToxOFrOHc1naQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wNlQxNDoyODowOVrOHdJ5dQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMDAwMDYxNw==", "bodyText": "New message means a minor version increment", "url": "https://github.com/eclipse-openj9/openj9/pull/10786#discussion_r500000617", "createdAt": "2020-10-06T04:35:18Z", "author": {"login": "mpirvu"}, "path": "runtime/compiler/net/MessageTypes.hpp", "diffHunk": "@@ -218,9 +218,10 @@ enum MessageType : uint16_t\n    CompInfo_setInvocationCountAtomic,\n    CompInfo_isClassSpecial,\n    CompInfo_getJ9MethodStartPC,\n+   CompInfo_getHelperMethod,", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "e0cb3e39ec5eb798167b4f7202beb5d2cc901211"}, "originalPosition": 4}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMDAwMTcyNw==", "bodyText": "This needs to be deleted", "url": "https://github.com/eclipse-openj9/openj9/pull/10786#discussion_r500001727", "createdAt": "2020-10-06T04:40:13Z", "author": {"login": "mpirvu"}, "path": "runtime/compiler/runtime/JITClientSession.hpp", "diffHunk": "@@ -336,6 +336,7 @@ class ClientSessionData\n       TR_OpaqueClassBlock *_srConstructorAccessorClass;\n #endif // J9VM_OPT_SIDECAR\n       U_32 _extendedRuntimeFlags2;\n+      void *_prepareForOSRHelper;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "e0cb3e39ec5eb798167b4f7202beb5d2cc901211"}, "originalPosition": 4}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMDMwOTY3OQ==", "bodyText": "This code is obsolete in the new implementation", "url": "https://github.com/eclipse-openj9/openj9/pull/10786#discussion_r500309679", "createdAt": "2020-10-06T14:04:33Z", "author": {"login": "mpirvu"}, "path": "runtime/compiler/control/JITClientCompilationThread.cpp", "diffHunk": "@@ -465,6 +465,7 @@ handleServerMessage(JITServer::ClientStream *client, TR_J9VM *fe, JITServer::Mes\n          vmInfo._interpreterVTableOffset = TR::Compiler->vm.getInterpreterVTableOffset();\n          vmInfo._maxHeapSizeInBytes = TR::Compiler->vm.maxHeapSizeInBytes();\n          vmInfo._enableGlobalLockReservation = vmThread->javaVM->enableGlobalLockReservation;\n+         vmInfo._prepareForOSRHelper = comp->getSymRefTab()->findOrCreateRuntimeHelper(TR_prepareForOSR, false, false, false)->getMethodAddress();", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5OTgyNzYwMQ=="}, "originalCommit": {"oid": "72b125571f27afe03897bce5987cd62591ab4de0"}, "originalPosition": 4}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMDMxMjM0Ng==", "bodyText": "Also, maybe CompInfo_getHelperAddress is more suitable for a name.", "url": "https://github.com/eclipse-openj9/openj9/pull/10786#discussion_r500312346", "createdAt": "2020-10-06T14:07:15Z", "author": {"login": "mpirvu"}, "path": "runtime/compiler/net/MessageTypes.hpp", "diffHunk": "@@ -218,9 +218,10 @@ enum MessageType : uint16_t\n    CompInfo_setInvocationCountAtomic,\n    CompInfo_isClassSpecial,\n    CompInfo_getJ9MethodStartPC,\n+   CompInfo_getHelperMethod,", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMDAwMDYxNw=="}, "originalCommit": {"oid": "e0cb3e39ec5eb798167b4f7202beb5d2cc901211"}, "originalPosition": 4}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMDMxNTQ5OQ==", "bodyText": "More descriptive names: getRuntimeHelperAddress and setRuntimeHelperAddress", "url": "https://github.com/eclipse-openj9/openj9/pull/10786#discussion_r500315499", "createdAt": "2020-10-06T14:10:21Z", "author": {"login": "mpirvu"}, "path": "runtime/compiler/runtime/JITClientSession.hpp", "diffHunk": "@@ -437,6 +437,9 @@ class ClientSessionData\n \n    TR::SymbolValidationManager::SystemClassNotWorthRemembering *getSystemClassesNotWorthRemembering() { return _systemClassesNotWorthRemembering; }\n \n+   void *getRuntimeHelper(TR_RuntimeHelper helper) { return _runtimeHelpers[helper]; }", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "fca47708dcc069530abb7f6331f6e6712dc4f586"}, "originalPosition": 4}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMDMyMzcwMw==", "bodyText": "I would like to limit the overhead for the non-jitserver path, so auto compInfoPT = TR::compInfoPT; should be computed after if (compInfo->getPersistentInfo()->getRemoteCompilationMode() == JITServer::SERVER\nFor the JITServer path, is it all possible that compInfoPT does not exist? I am guessing not because at JITServer most of the code is executed during a compilation.", "url": "https://github.com/eclipse-openj9/openj9/pull/10786#discussion_r500323703", "createdAt": "2020-10-06T14:19:00Z", "author": {"login": "mpirvu"}, "path": "runtime/compiler/runtime/Runtime.cpp", "diffHunk": "@@ -167,6 +168,29 @@ void* TR_RuntimeHelperTable::getFunctionPointer(TR_RuntimeHelper h)\n \n void* TR_RuntimeHelperTable::getFunctionEntryPointOrConst(TR_RuntimeHelper h)\n    {\n+#if defined(J9VM_OPT_JITSERVER)\n+   TR::CompilationInfo *compInfo = getCompilationInfo(jitConfig);\n+   auto compInfoPT = TR::compInfoPT;\n+   if (compInfo->getPersistentInfo()->getRemoteCompilationMode() == JITServer::SERVER &&", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "fca47708dcc069530abb7f6331f6e6712dc4f586"}, "originalPosition": 15}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMDMzMjkxNw==", "bodyText": "The stream should be available from CompInfoPT->getMethodToBeCompiled()->_stream or something like that", "url": "https://github.com/eclipse-openj9/openj9/pull/10786#discussion_r500332917", "createdAt": "2020-10-06T14:28:09Z", "author": {"login": "mpirvu"}, "path": "runtime/compiler/runtime/Runtime.cpp", "diffHunk": "@@ -167,6 +168,29 @@ void* TR_RuntimeHelperTable::getFunctionPointer(TR_RuntimeHelper h)\n \n void* TR_RuntimeHelperTable::getFunctionEntryPointOrConst(TR_RuntimeHelper h)\n    {\n+#if defined(J9VM_OPT_JITSERVER) && defined(TR_HOST_POWER)\n+   TR::CompilationInfo *compInfo = getCompilationInfo(jitConfig);\n+   auto compInfoPT = TR::compInfoPT;\n+   if (compInfo->getPersistentInfo()->getRemoteCompilationMode() == JITServer::SERVER &&\n+       compInfoPT)\n+      {\n+      // Return the client-side helper address\n+      // Get cached value if it exists, otherwise make remote and cache\n+      void *helperAddress = compInfoPT->getClientData()->getRuntimeHelper(h);\n+      if (helperAddress)\n+         return helperAddress;\n+      auto stream = TR::CompilationInfo::getStream();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "5b7f2c04e4eafc173e1765654ce43bc5852b3823"}, "originalPosition": 23}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "5b7f2c04e4eafc173e1765654ce43bc5852b3823", "author": {"user": {"login": "dmitry-ten", "name": "Dmitry Ten"}}, "url": "https://github.com/eclipse-openj9/openj9/commit/5b7f2c04e4eafc173e1765654ce43bc5852b3823", "committedDate": "2020-10-06T14:24:17Z", "message": "Fetch addresses of helper methods from the client\n\nOn Power, the entry point of the method needs to be stored in `gr12` register.\nCurrent relocation infrastructure cannot relocate the helper address\nthat's stored in a non-call instruction,\nso this commit adds functionality to fetch the helper address from the\nclient and store it in the server-side cache.\n\nSigned-off-by: Dmitry Ten <Dmitry.Ten@ibm.com>"}, "afterCommit": {"oid": "c7301e25eb9b6abcd32cf20db177326840bdf5bc", "author": {"user": {"login": "dmitry-ten", "name": "Dmitry Ten"}}, "url": "https://github.com/eclipse-openj9/openj9/commit/c7301e25eb9b6abcd32cf20db177326840bdf5bc", "committedDate": "2020-10-06T14:47:32Z", "message": "Fetch addresses of helper methods from the client\n\nOn Power, the entry point of the method needs to be stored in `gr12` register.\nCurrent relocation infrastructure cannot relocate the helper address\nthat's stored in a non-call instruction,\nso this commit adds functionality to fetch the helper address from the\nclient and store it in the server-side cache.\n\nSigned-off-by: Dmitry Ten <Dmitry.Ten@ibm.com>"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTAzMDUwNDQ5", "url": "https://github.com/eclipse-openj9/openj9/pull/10786#pullrequestreview-503050449", "createdAt": "2020-10-06T14:49:58Z", "commit": {"oid": "c7301e25eb9b6abcd32cf20db177326840bdf5bc"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wNlQxNDo0OTo1OFrOHdLMSg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wNlQxNDo0OTo1OFrOHdLMSg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMDM1NDEyMg==", "bodyText": "People reading the code may wonder why we do this only for Power, so it's better to have a comment explaining why", "url": "https://github.com/eclipse-openj9/openj9/pull/10786#discussion_r500354122", "createdAt": "2020-10-06T14:49:58Z", "author": {"login": "mpirvu"}, "path": "runtime/compiler/runtime/Runtime.cpp", "diffHunk": "@@ -167,6 +170,29 @@ void* TR_RuntimeHelperTable::getFunctionPointer(TR_RuntimeHelper h)\n \n void* TR_RuntimeHelperTable::getFunctionEntryPointOrConst(TR_RuntimeHelper h)\n    {\n+#if defined(J9VM_OPT_JITSERVER) && defined(TR_HOST_POWER)", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c7301e25eb9b6abcd32cf20db177326840bdf5bc"}, "originalPosition": 14}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "c7301e25eb9b6abcd32cf20db177326840bdf5bc", "author": {"user": {"login": "dmitry-ten", "name": "Dmitry Ten"}}, "url": "https://github.com/eclipse-openj9/openj9/commit/c7301e25eb9b6abcd32cf20db177326840bdf5bc", "committedDate": "2020-10-06T14:47:32Z", "message": "Fetch addresses of helper methods from the client\n\nOn Power, the entry point of the method needs to be stored in `gr12` register.\nCurrent relocation infrastructure cannot relocate the helper address\nthat's stored in a non-call instruction,\nso this commit adds functionality to fetch the helper address from the\nclient and store it in the server-side cache.\n\nSigned-off-by: Dmitry Ten <Dmitry.Ten@ibm.com>"}, "afterCommit": {"oid": "6fea33eac04f81c6d903585b5f9f8c06a82dfcf3", "author": {"user": {"login": "dmitry-ten", "name": "Dmitry Ten"}}, "url": "https://github.com/eclipse-openj9/openj9/commit/6fea33eac04f81c6d903585b5f9f8c06a82dfcf3", "committedDate": "2020-10-06T15:02:45Z", "message": "Fetch addresses of helper methods from the client\n\nOn Power, the entry point of the method needs to be stored in `gr12` register.\nCurrent relocation infrastructure cannot relocate the helper address\nthat's stored in a non-call instruction,\nso this commit adds functionality to fetch the helper address from the\nclient and store it in the server-side cache.\n\nSigned-off-by: Dmitry Ten <Dmitry.Ten@ibm.com>"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "6fea33eac04f81c6d903585b5f9f8c06a82dfcf3", "author": {"user": {"login": "dmitry-ten", "name": "Dmitry Ten"}}, "url": "https://github.com/eclipse-openj9/openj9/commit/6fea33eac04f81c6d903585b5f9f8c06a82dfcf3", "committedDate": "2020-10-06T15:02:45Z", "message": "Fetch addresses of helper methods from the client\n\nOn Power, the entry point of the method needs to be stored in `gr12` register.\nCurrent relocation infrastructure cannot relocate the helper address\nthat's stored in a non-call instruction,\nso this commit adds functionality to fetch the helper address from the\nclient and store it in the server-side cache.\n\nSigned-off-by: Dmitry Ten <Dmitry.Ten@ibm.com>"}, "afterCommit": {"oid": "0369f73fb1aa14d082c1d555123df29b030702d2", "author": {"user": {"login": "dmitry-ten", "name": "Dmitry Ten"}}, "url": "https://github.com/eclipse-openj9/openj9/commit/0369f73fb1aa14d082c1d555123df29b030702d2", "committedDate": "2020-10-06T15:06:09Z", "message": "Fetch addresses of helper methods from the client\n\nOn Power, the entry point of the method needs to be stored in `gr12` register.\nCurrent relocation infrastructure cannot relocate the helper address\nthat's stored in a non-call instruction,\nso this commit adds functionality to fetch the helper address from the\nclient and store it in the server-side cache.\n\nSigned-off-by: Dmitry Ten <Dmitry.Ten@ibm.com>"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "0369f73fb1aa14d082c1d555123df29b030702d2", "author": {"user": {"login": "dmitry-ten", "name": "Dmitry Ten"}}, "url": "https://github.com/eclipse-openj9/openj9/commit/0369f73fb1aa14d082c1d555123df29b030702d2", "committedDate": "2020-10-06T15:06:09Z", "message": "Fetch addresses of helper methods from the client\n\nOn Power, the entry point of the method needs to be stored in `gr12` register.\nCurrent relocation infrastructure cannot relocate the helper address\nthat's stored in a non-call instruction,\nso this commit adds functionality to fetch the helper address from the\nclient and store it in the server-side cache.\n\nSigned-off-by: Dmitry Ten <Dmitry.Ten@ibm.com>"}, "afterCommit": {"oid": "f3627fe3c69da806705230b86aef6bc6fc465c3c", "author": {"user": {"login": "dmitry-ten", "name": "Dmitry Ten"}}, "url": "https://github.com/eclipse-openj9/openj9/commit/f3627fe3c69da806705230b86aef6bc6fc465c3c", "committedDate": "2020-10-06T15:17:29Z", "message": "Fetch addresses of helper methods from the client\n\nOn Power, the entry point of the method needs to be stored in `gr12` register.\nCurrent relocation infrastructure cannot relocate the helper address\nthat's stored in a non-call instruction,\nso this commit adds functionality to fetch the helper address from the\nclient and store it in the server-side cache.\n\nSigned-off-by: Dmitry Ten <Dmitry.Ten@ibm.com>"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "f3627fe3c69da806705230b86aef6bc6fc465c3c", "author": {"user": {"login": "dmitry-ten", "name": "Dmitry Ten"}}, "url": "https://github.com/eclipse-openj9/openj9/commit/f3627fe3c69da806705230b86aef6bc6fc465c3c", "committedDate": "2020-10-06T15:17:29Z", "message": "Fetch addresses of helper methods from the client\n\nOn Power, the entry point of the method needs to be stored in `gr12` register.\nCurrent relocation infrastructure cannot relocate the helper address\nthat's stored in a non-call instruction,\nso this commit adds functionality to fetch the helper address from the\nclient and store it in the server-side cache.\n\nSigned-off-by: Dmitry Ten <Dmitry.Ten@ibm.com>"}, "afterCommit": {"oid": "06a7d5b6a890525b13e920073ae7e447b11da121", "author": {"user": {"login": "dmitry-ten", "name": "Dmitry Ten"}}, "url": "https://github.com/eclipse-openj9/openj9/commit/06a7d5b6a890525b13e920073ae7e447b11da121", "committedDate": "2020-10-06T15:19:21Z", "message": "Fetch addresses of helper methods from the client\n\nOn Power, the entry point of the method needs to be stored in `gr12` register.\nCurrent relocation infrastructure cannot relocate the helper address\nthat's stored in a non-call instruction,\nso this commit adds functionality to fetch the helper address from the\nclient and store it in the server-side cache.\n\nSigned-off-by: Dmitry Ten <Dmitry.Ten@ibm.com>"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "06a7d5b6a890525b13e920073ae7e447b11da121", "author": {"user": {"login": "dmitry-ten", "name": "Dmitry Ten"}}, "url": "https://github.com/eclipse-openj9/openj9/commit/06a7d5b6a890525b13e920073ae7e447b11da121", "committedDate": "2020-10-06T15:19:21Z", "message": "Fetch addresses of helper methods from the client\n\nOn Power, the entry point of the method needs to be stored in `gr12` register.\nCurrent relocation infrastructure cannot relocate the helper address\nthat's stored in a non-call instruction,\nso this commit adds functionality to fetch the helper address from the\nclient and store it in the server-side cache.\n\nSigned-off-by: Dmitry Ten <Dmitry.Ten@ibm.com>"}, "afterCommit": {"oid": "20717b43af16a597b62168ed95338b99dde641ab", "author": {"user": {"login": "dmitry-ten", "name": "Dmitry Ten"}}, "url": "https://github.com/eclipse-openj9/openj9/commit/20717b43af16a597b62168ed95338b99dde641ab", "committedDate": "2020-10-06T15:25:21Z", "message": "Fetch addresses of helper methods from the client\n\nOn Power, the entry point of the method needs to be stored in `gr12` register.\nCurrent relocation infrastructure cannot relocate the helper address\nthat's stored in a non-call instruction,\nso this commit adds functionality to fetch the helper address from the\nclient and store it in the server-side cache.\n\nSigned-off-by: Dmitry Ten <Dmitry.Ten@ibm.com>"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "20717b43af16a597b62168ed95338b99dde641ab", "author": {"user": {"login": "dmitry-ten", "name": "Dmitry Ten"}}, "url": "https://github.com/eclipse-openj9/openj9/commit/20717b43af16a597b62168ed95338b99dde641ab", "committedDate": "2020-10-06T15:25:21Z", "message": "Fetch addresses of helper methods from the client\n\nOn Power, the entry point of the method needs to be stored in `gr12` register.\nCurrent relocation infrastructure cannot relocate the helper address\nthat's stored in a non-call instruction,\nso this commit adds functionality to fetch the helper address from the\nclient and store it in the server-side cache.\n\nSigned-off-by: Dmitry Ten <Dmitry.Ten@ibm.com>"}, "afterCommit": {"oid": "437e9bc7f975c5cec04397ec7043fd1aaf0ea371", "author": {"user": {"login": "dmitry-ten", "name": "Dmitry Ten"}}, "url": "https://github.com/eclipse-openj9/openj9/commit/437e9bc7f975c5cec04397ec7043fd1aaf0ea371", "committedDate": "2020-10-06T17:02:57Z", "message": "Fetch addresses of helper methods from the client\n\nOn Power, the entry point of the method needs to be stored in `gr12`\nregister.\nCurrent relocation infrastructure cannot relocate the helper address\nthat's stored in a non-call instruction,\nso this commit adds functionality to fetch the helper address from the\nclient and store it in the server-side cache.\n\nSigned-off-by: Dmitry Ten <Dmitry.Ten@ibm.com>"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTAzMjM0ODA0", "url": "https://github.com/eclipse-openj9/openj9/pull/10786#pullrequestreview-503234804", "createdAt": "2020-10-06T18:13:37Z", "commit": {"oid": "437e9bc7f975c5cec04397ec7043fd1aaf0ea371"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ce731705d3c414efbbb381d85c6a876f7c0e0d89", "author": {"user": {"login": "dmitry-ten", "name": "Dmitry Ten"}}, "url": "https://github.com/eclipse-openj9/openj9/commit/ce731705d3c414efbbb381d85c6a876f7c0e0d89", "committedDate": "2020-10-06T18:15:27Z", "message": "Fetch addresses of helper methods from the client\n\nOn Power, the entry point of the method needs to be stored in `gr12`\nregister.\nCurrent relocation infrastructure cannot relocate the helper address\nthat's stored in a non-call instruction,\nso this commit adds functionality to fetch the helper address from the\nclient and store it in the server-side cache.\n\nSigned-off-by: Dmitry Ten <Dmitry.Ten@ibm.com>"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "437e9bc7f975c5cec04397ec7043fd1aaf0ea371", "author": {"user": {"login": "dmitry-ten", "name": "Dmitry Ten"}}, "url": "https://github.com/eclipse-openj9/openj9/commit/437e9bc7f975c5cec04397ec7043fd1aaf0ea371", "committedDate": "2020-10-06T17:02:57Z", "message": "Fetch addresses of helper methods from the client\n\nOn Power, the entry point of the method needs to be stored in `gr12`\nregister.\nCurrent relocation infrastructure cannot relocate the helper address\nthat's stored in a non-call instruction,\nso this commit adds functionality to fetch the helper address from the\nclient and store it in the server-side cache.\n\nSigned-off-by: Dmitry Ten <Dmitry.Ten@ibm.com>"}, "afterCommit": {"oid": "ce731705d3c414efbbb381d85c6a876f7c0e0d89", "author": {"user": {"login": "dmitry-ten", "name": "Dmitry Ten"}}, "url": "https://github.com/eclipse-openj9/openj9/commit/ce731705d3c414efbbb381d85c6a876f7c0e0d89", "committedDate": "2020-10-06T18:15:27Z", "message": "Fetch addresses of helper methods from the client\n\nOn Power, the entry point of the method needs to be stored in `gr12`\nregister.\nCurrent relocation infrastructure cannot relocate the helper address\nthat's stored in a non-call instruction,\nso this commit adds functionality to fetch the helper address from the\nclient and store it in the server-side cache.\n\nSigned-off-by: Dmitry Ten <Dmitry.Ten@ibm.com>"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTAzMjQ5MTI0", "url": "https://github.com/eclipse-openj9/openj9/pull/10786#pullrequestreview-503249124", "createdAt": "2020-10-06T18:30:57Z", "commit": {"oid": "ce731705d3c414efbbb381d85c6a876f7c0e0d89"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 385, "cost": 1, "resetAt": "2021-10-28T18:00:02Z"}}}