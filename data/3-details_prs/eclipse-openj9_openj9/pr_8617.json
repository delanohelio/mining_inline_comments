{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0Mzc3NTY0MTk1", "number": 8617, "title": "CPU cache line size for Linux aarch64", "bodyText": "This commit adds code to j9sysinfo_get_cache_info() so that Linux\nAArch64 systems can answer the L1 data cache line size.\nThe information is used by protectedInitializeJavaVM() in\nruntime/vm/jvminit.c.\nSigned-off-by: KONNO Kazuhiro konno@jp.ibm.com", "createdAt": "2020-02-20T05:52:17Z", "url": "https://github.com/eclipse-openj9/openj9/pull/8617", "merged": true, "mergeCommit": {"oid": "0942b265160b1b5cce426245e42db6a6aa684353"}, "closed": true, "closedAt": "2020-03-16T03:24:23Z", "author": {"login": "knn-k"}, "timelineItems": {"totalCount": 9, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcGJDHzgFqTM2MTgwOTg3Mg==", "endCursor": "Y3Vyc29yOnYyOpPPAAABcNQgSrgFqTM3NDMwNjk4MA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzYxODA5ODcy", "url": "https://github.com/eclipse-openj9/openj9/pull/8617#pullrequestreview-361809872", "createdAt": "2020-02-20T10:58:31Z", "commit": {"oid": "cdb8f937a8f37b78e4f869ae1def70ee29ab327f"}, "state": "COMMENTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yMFQxMDo1ODozMVrOFsPAwA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yMFQxMTowMTo0NlrOFsPHiA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MTkyNzYxNg==", "bodyText": "Is this meant to apply to all LINUXes or just to linux on aarch64?  Other architectures look up the _DCACHE data in other ways", "url": "https://github.com/eclipse-openj9/openj9/pull/8617#discussion_r381927616", "createdAt": "2020-02-20T10:58:31Z", "author": {"login": "DanHeidinga"}, "path": "runtime/port/unix/j9sysinfo.c", "diffHunk": "@@ -1668,6 +1668,17 @@ j9sysinfo_get_cache_info(struct J9PortLibrary *portLibrary, const J9CacheInfoQue\n \t\t\tomrcpu_get_cache_line_size(&result);\n #endif\n \t\t}\n+#elif defined(LINUX) && defined(_SC_LEVEL1_DCACHE_LINESIZE)", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "cdb8f937a8f37b78e4f869ae1def70ee29ab327f"}, "originalPosition": 11}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MTkyOTM1Mg==", "bodyText": "Can you implementation used on x86 be extended to aarch64 (assuming that's the problem you're trying to solve)?\nIt currently looks up the DCACHE info here and caches it in a port global:\nhttps://github.com/eclipse/openj9/blob/cdb8f937a8f37b78e4f869ae1def70ee29ab327f/runtime/port/unix/j9sysinfo.c#L1335-L1340\nIn fact, there's already a mostly common place to look this data up:\nhttps://github.com/eclipse/openj9/blob/cdb8f937a8f37b78e4f869ae1def70ee29ab327f/runtime/port/unix/j9sysinfo.c#L1645-L1649", "url": "https://github.com/eclipse-openj9/openj9/pull/8617#discussion_r381929352", "createdAt": "2020-02-20T11:01:46Z", "author": {"login": "DanHeidinga"}, "path": "runtime/port/unix/j9sysinfo.c", "diffHunk": "@@ -1668,6 +1668,17 @@ j9sysinfo_get_cache_info(struct J9PortLibrary *portLibrary, const J9CacheInfoQue\n \t\t\tomrcpu_get_cache_line_size(&result);\n #endif\n \t\t}\n+#elif defined(LINUX) && defined(_SC_LEVEL1_DCACHE_LINESIZE)\n+\tif (query->cmd == J9PORT_CACHEINFO_QUERY_LINESIZE\n+\t    && query->cacheType == J9PORT_CACHEINFO_DCACHE\n+\t    && query->level == 1) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "cdb8f937a8f37b78e4f869ae1def70ee29ab327f"}, "originalPosition": 14}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzczNjMxMTI4", "url": "https://github.com/eclipse-openj9/openj9/pull/8617#pullrequestreview-373631128", "createdAt": "2020-03-12T14:57:08Z", "commit": {"oid": "cdb8f937a8f37b78e4f869ae1def70ee29ab327f"}, "state": "COMMENTED", "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xMlQxNDo1NzowOFrOF1iNzA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xMlQxNTowMToxMVrOF1iY9A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MTY3OTQzNg==", "bodyText": "This needs to be limited to the aarch64 platform or the value will be calculated twice on linux platforms - once in the code above and then again here.", "url": "https://github.com/eclipse-openj9/openj9/pull/8617#discussion_r391679436", "createdAt": "2020-03-12T14:57:08Z", "author": {"login": "DanHeidinga"}, "path": "runtime/port/unix/j9sysinfo.c", "diffHunk": "@@ -1668,6 +1668,17 @@ j9sysinfo_get_cache_info(struct J9PortLibrary *portLibrary, const J9CacheInfoQue\n \t\t\tomrcpu_get_cache_line_size(&result);\n #endif\n \t\t}\n+#elif defined(LINUX) && defined(_SC_LEVEL1_DCACHE_LINESIZE)", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MTkyNzYxNg=="}, "originalCommit": {"oid": "cdb8f937a8f37b78e4f869ae1def70ee29ab327f"}, "originalPosition": 11}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MTY4MDU0OA==", "bodyText": "This should write to a different local and only modify result on success as that will remove the need for the other else block.  Note, result is initialized to J9PORT_ERROR_SYSINFO_NOT_SUPPORTED at the start of the function", "url": "https://github.com/eclipse-openj9/openj9/pull/8617#discussion_r391680548", "createdAt": "2020-03-12T14:58:46Z", "author": {"login": "DanHeidinga"}, "path": "runtime/port/unix/j9sysinfo.c", "diffHunk": "@@ -1668,6 +1668,17 @@ j9sysinfo_get_cache_info(struct J9PortLibrary *portLibrary, const J9CacheInfoQue\n \t\t\tomrcpu_get_cache_line_size(&result);\n #endif\n \t\t}\n+#elif defined(LINUX) && defined(_SC_LEVEL1_DCACHE_LINESIZE)\n+\tif (query->cmd == J9PORT_CACHEINFO_QUERY_LINESIZE\n+\t    && query->cacheType == J9PORT_CACHEINFO_DCACHE\n+\t    && query->level == 1) {\n+\t\tresult = (int32_t)sysconf(_SC_LEVEL1_DCACHE_LINESIZE);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "cdb8f937a8f37b78e4f869ae1def70ee29ab327f"}, "originalPosition": 15}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MTY4MjI5Mg==", "bodyText": "Sorry @knn-k, just getting back to this after finishing the JDK14 reviews.\nFor this PR, please limit this to the aarch64 platform.  As a follow on task, it might be worth looking at modifying the x86 implementation to use sysconf for the dcache as well but I don't want to hold up the arm work for that.", "url": "https://github.com/eclipse-openj9/openj9/pull/8617#discussion_r391682292", "createdAt": "2020-03-12T15:01:11Z", "author": {"login": "DanHeidinga"}, "path": "runtime/port/unix/j9sysinfo.c", "diffHunk": "@@ -1668,6 +1668,17 @@ j9sysinfo_get_cache_info(struct J9PortLibrary *portLibrary, const J9CacheInfoQue\n \t\t\tomrcpu_get_cache_line_size(&result);\n #endif\n \t\t}\n+#elif defined(LINUX) && defined(_SC_LEVEL1_DCACHE_LINESIZE)\n+\tif (query->cmd == J9PORT_CACHEINFO_QUERY_LINESIZE\n+\t    && query->cacheType == J9PORT_CACHEINFO_DCACHE\n+\t    && query->level == 1) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MTkyOTM1Mg=="}, "originalCommit": {"oid": "cdb8f937a8f37b78e4f869ae1def70ee29ab327f"}, "originalPosition": 14}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "cdb8f937a8f37b78e4f869ae1def70ee29ab327f", "author": {"user": {"login": "knn-k", "name": "KONNO Kazuhiro"}}, "url": "https://github.com/eclipse-openj9/openj9/commit/cdb8f937a8f37b78e4f869ae1def70ee29ab327f", "committedDate": "2020-02-20T05:46:41Z", "message": "CPU cache line size for Linux\n\nThis commit adds code to j9sysinfo_get_cache_info() so that Linux\nsystems can answer the L1 data cache line size.\n\nThe information is used by protectedInitializeJavaVM() in\nruntime/vm/jvminit.c.\n\nSigned-off-by: KONNO Kazuhiro <konno@jp.ibm.com>"}, "afterCommit": {"oid": "3ef6f0109b65a4772983e6d6e827eb9db7c71b85", "author": {"user": {"login": "knn-k", "name": "KONNO Kazuhiro"}}, "url": "https://github.com/eclipse-openj9/openj9/commit/3ef6f0109b65a4772983e6d6e827eb9db7c71b85", "committedDate": "2020-03-13T05:33:12Z", "message": "CPU cache line size for Linux AArch64\n\nThis commit adds code to j9sysinfo_get_cache_info() so that Linux\nAArch64 systems can answer the L1 data cache line size.\n\nThe information is used by protectedInitializeJavaVM() in\nruntime/vm/jvminit.c.\n\nSigned-off-by: KONNO Kazuhiro <konno@jp.ibm.com>"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzc0Mjg1ODUy", "url": "https://github.com/eclipse-openj9/openj9/pull/8617#pullrequestreview-374285852", "createdAt": "2020-03-13T13:11:00Z", "commit": {"oid": "3ef6f0109b65a4772983e6d6e827eb9db7c71b85"}, "state": "APPROVED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xM1QxMzoxMTowMFrOF2DCKw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xM1QxMzoxMTowMFrOF2DCKw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MjIxNzEzMQ==", "bodyText": "Formatting nitpick - in vm code we tend to bracket conditionals so no one has to try to figure out order of operations in their heads.\n\n  \n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            \tif (query->cmd == J9PORT_CACHEINFO_QUERY_LINESIZE\n          \n          \n            \n            \t    && query->cacheType == J9PORT_CACHEINFO_DCACHE\n          \n          \n            \n            \t    && query->level == 1) {\n          \n          \n            \n            \tif ((query->cmd == J9PORT_CACHEINFO_QUERY_LINESIZE)\n          \n          \n            \n            \t&& (query->cacheType == J9PORT_CACHEINFO_DCACHE)\n          \n          \n            \n            \t&& (query->level == 1)\n          \n          \n            \n            \t) {", "url": "https://github.com/eclipse-openj9/openj9/pull/8617#discussion_r392217131", "createdAt": "2020-03-13T13:11:00Z", "author": {"login": "DanHeidinga"}, "path": "runtime/port/unix/j9sysinfo.c", "diffHunk": "@@ -1668,6 +1668,16 @@ j9sysinfo_get_cache_info(struct J9PortLibrary *portLibrary, const J9CacheInfoQue\n \t\t\tomrcpu_get_cache_line_size(&result);\n #endif\n \t\t}\n+#elif defined(LINUX) && defined(J9AARCH64)\n+\tif (query->cmd == J9PORT_CACHEINFO_QUERY_LINESIZE\n+\t    && query->cacheType == J9PORT_CACHEINFO_DCACHE\n+\t    && query->level == 1) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "3ef6f0109b65a4772983e6d6e827eb9db7c71b85"}, "originalPosition": 14}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a637d46787a17a47b2425f2609cb8a77573d6050", "author": {"user": {"login": "knn-k", "name": "KONNO Kazuhiro"}}, "url": "https://github.com/eclipse-openj9/openj9/commit/a637d46787a17a47b2425f2609cb8a77573d6050", "committedDate": "2020-03-13T13:22:36Z", "message": "CPU cache line size for Linux AArch64\n\nThis commit adds code to j9sysinfo_get_cache_info() so that Linux\nAArch64 systems can answer the L1 data cache line size.\n\nThe information is used by protectedInitializeJavaVM() in\nruntime/vm/jvminit.c.\n\nSigned-off-by: KONNO Kazuhiro <konno@jp.ibm.com>"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "3ef6f0109b65a4772983e6d6e827eb9db7c71b85", "author": {"user": {"login": "knn-k", "name": "KONNO Kazuhiro"}}, "url": "https://github.com/eclipse-openj9/openj9/commit/3ef6f0109b65a4772983e6d6e827eb9db7c71b85", "committedDate": "2020-03-13T05:33:12Z", "message": "CPU cache line size for Linux AArch64\n\nThis commit adds code to j9sysinfo_get_cache_info() so that Linux\nAArch64 systems can answer the L1 data cache line size.\n\nThe information is used by protectedInitializeJavaVM() in\nruntime/vm/jvminit.c.\n\nSigned-off-by: KONNO Kazuhiro <konno@jp.ibm.com>"}, "afterCommit": {"oid": "a637d46787a17a47b2425f2609cb8a77573d6050", "author": {"user": {"login": "knn-k", "name": "KONNO Kazuhiro"}}, "url": "https://github.com/eclipse-openj9/openj9/commit/a637d46787a17a47b2425f2609cb8a77573d6050", "committedDate": "2020-03-13T13:22:36Z", "message": "CPU cache line size for Linux AArch64\n\nThis commit adds code to j9sysinfo_get_cache_info() so that Linux\nAArch64 systems can answer the L1 data cache line size.\n\nThe information is used by protectedInitializeJavaVM() in\nruntime/vm/jvminit.c.\n\nSigned-off-by: KONNO Kazuhiro <konno@jp.ibm.com>"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzc0MzAwOTU2", "url": "https://github.com/eclipse-openj9/openj9/pull/8617#pullrequestreview-374300956", "createdAt": "2020-03-13T13:32:31Z", "commit": {"oid": "a637d46787a17a47b2425f2609cb8a77573d6050"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xM1QxMzozMjozMVrOF2Dv7w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xM1QxMzozMjozMVrOF2Dv7w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MjIyODg0Nw==", "bodyText": "Sorry, this is using spaces to indent the subsequent lines.  The VM uses tabs and puts the ) { on a new line.\n\n  \n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            \tif ((query->cmd == J9PORT_CACHEINFO_QUERY_LINESIZE)\n          \n          \n            \n            \t    && (query->cacheType == J9PORT_CACHEINFO_DCACHE)\n          \n          \n            \n            \t    && (query->level == 1)) {\n          \n          \n            \n            \tif ((query->cmd == J9PORT_CACHEINFO_QUERY_LINESIZE)\n          \n          \n            \n            \t&& (query->cacheType == J9PORT_CACHEINFO_DCACHE)\n          \n          \n            \n            \t&& (query->level == 1)\n          \n          \n            \n            \t) {", "url": "https://github.com/eclipse-openj9/openj9/pull/8617#discussion_r392228847", "createdAt": "2020-03-13T13:32:31Z", "author": {"login": "DanHeidinga"}, "path": "runtime/port/unix/j9sysinfo.c", "diffHunk": "@@ -1668,6 +1668,16 @@ j9sysinfo_get_cache_info(struct J9PortLibrary *portLibrary, const J9CacheInfoQue\n \t\t\tomrcpu_get_cache_line_size(&result);\n #endif\n \t\t}\n+#elif defined(LINUX) && defined(J9AARCH64)\n+\tif ((query->cmd == J9PORT_CACHEINFO_QUERY_LINESIZE)\n+\t    && (query->cacheType == J9PORT_CACHEINFO_DCACHE)\n+\t    && (query->level == 1)) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "a637d46787a17a47b2425f2609cb8a77573d6050"}, "originalPosition": 14}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "078394b778c0ce2a022bc596b74523a49a20c183", "author": {"user": {"login": "knn-k", "name": "KONNO Kazuhiro"}}, "url": "https://github.com/eclipse-openj9/openj9/commit/078394b778c0ce2a022bc596b74523a49a20c183", "committedDate": "2020-03-13T13:34:48Z", "message": "Update runtime/port/unix/j9sysinfo.c\n\nCo-Authored-By: Dan Heidinga <daniel_heidinga@ca.ibm.com>"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzc0MzA2OTgw", "url": "https://github.com/eclipse-openj9/openj9/pull/8617#pullrequestreview-374306980", "createdAt": "2020-03-13T13:40:51Z", "commit": {"oid": "078394b778c0ce2a022bc596b74523a49a20c183"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 578, "cost": 1, "resetAt": "2021-10-28T18:00:02Z"}}}