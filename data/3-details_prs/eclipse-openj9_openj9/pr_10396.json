{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDY4NDkyMDQ4", "number": 10396, "title": "Report Monitor References in gc-end", "bodyText": "Report Monitor References in following types of GC operations:\nmark,scavenge,mark increment, copy forward\nDepends on: eclipse/omr#5472\nSigned-off-by: Enson Guo enson.guo@ibm.com", "createdAt": "2020-08-16T20:28:15Z", "url": "https://github.com/eclipse-openj9/openj9/pull/10396", "merged": true, "mergeCommit": {"oid": "000f5fa40d644d02dbd31cd017ed3152edc8212e"}, "closed": true, "closedAt": "2020-09-02T13:33:22Z", "author": {"login": "gza060625"}, "timelineItems": {"totalCount": 12, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABc_mENVABqjM2NTk3MDQyNDU=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdE8FXlAFqTQ4MDgyMzExOQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "a3c8c03f49bd8f89f95812eb26ac3b272dc59094", "author": {"user": null}, "url": "https://github.com/eclipse-openj9/openj9/commit/a3c8c03f49bd8f89f95812eb26ac3b272dc59094", "committedDate": "2020-08-16T22:59:35Z", "message": "Final?\n\nSigned-off-by: Enson Guo <enson.guo@ibm.com>"}, "afterCommit": {"oid": "3268e0d62bfe89022ae8f3620ad0db980a9b8d43", "author": {"user": null}, "url": "https://github.com/eclipse-openj9/openj9/commit/3268e0d62bfe89022ae8f3620ad0db980a9b8d43", "committedDate": "2020-08-16T23:01:29Z", "message": "VGCL: report Monitor References\n\nReport Monitor References in following types of GC operations:\n\tmark,scavenge,mark increment, copy forward\n\nSigned-off-by: Enson Guo <enson.guo@ibm.com>"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "3268e0d62bfe89022ae8f3620ad0db980a9b8d43", "author": {"user": null}, "url": "https://github.com/eclipse-openj9/openj9/commit/3268e0d62bfe89022ae8f3620ad0db980a9b8d43", "committedDate": "2020-08-16T23:01:29Z", "message": "VGCL: report Monitor References\n\nReport Monitor References in following types of GC operations:\n\tmark,scavenge,mark increment, copy forward\n\nSigned-off-by: Enson Guo <enson.guo@ibm.com>"}, "afterCommit": {"oid": "8737d4f893c881790f01bc9b41ef1635be8db1e1", "author": {"user": null}, "url": "https://github.com/eclipse-openj9/openj9/commit/8737d4f893c881790f01bc9b41ef1635be8db1e1", "committedDate": "2020-08-19T22:52:12Z", "message": "VGCL: report Monitor References\n\nReport Monitor References in following types of GC operations:\n\tmark,scavenge,mark increment, copy forward\n\nSigned-off-by: Enson Guo <enson.guo@ibm.com>"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDc1NzkyMzEy", "url": "https://github.com/eclipse-openj9/openj9/pull/10396#pullrequestreview-475792312", "createdAt": "2020-08-26T19:24:48Z", "commit": {"oid": "8737d4f893c881790f01bc9b41ef1635be8db1e1"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yNlQxOToyNDo0OFrOHHagvQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yNlQxOToyODoxOFrOHHaoHQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NzUzNjQ0NQ==", "bodyText": "Should this be += 1?", "url": "https://github.com/eclipse-openj9/openj9/pull/10396#discussion_r477536445", "createdAt": "2020-08-26T19:24:48Z", "author": {"login": "RSalman"}, "path": "runtime/gc_vlhgc/GlobalMarkingScheme.cpp", "diffHunk": "@@ -1192,8 +1192,10 @@ class MM_GlobalMarkingSchemeRootClearer : public MM_RootScanner\n \n \tvirtual void doMonitorReference(J9ObjectMonitor *objectMonitor, GC_HashTableIterator *monitorReferenceIterator) {\n \t\tJ9ThreadAbstractMonitor * monitor = (J9ThreadAbstractMonitor*)objectMonitor->monitor;\n+\t\tMM_EnvironmentVLHGC::getEnvironment(_env)->_markVLHGCStats._monitorReferenceCandidates = 1;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "8737d4f893c881790f01bc9b41ef1635be8db1e1"}, "originalPosition": 4}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NzUzODMzMw==", "bodyText": "No need for new line here", "url": "https://github.com/eclipse-openj9/openj9/pull/10396#discussion_r477538333", "createdAt": "2020-08-26T19:28:18Z", "author": {"login": "RSalman"}, "path": "runtime/gc_stats/ScavengerJavaStats.cpp", "diffHunk": "@@ -65,4 +73,8 @@ MM_ScavengerJavaStats::mergeOwnableSynchronizerCounts(MM_ScavengerJavaStats *sta\n \t_ownableSynchronizerCandidates += statsToMerge->_ownableSynchronizerCandidates;\n \t_ownableSynchronizerTotalSurvived += statsToMerge->_ownableSynchronizerTotalSurvived;\n \t_ownableSynchronizerNurserySurvived += statsToMerge->_ownableSynchronizerNurserySurvived;\n+\n+\t_monitorReferenceCleared += statsToMerge->_monitorReferenceCleared;\n+\t_monitorReferenceCandidates += statsToMerge->_monitorReferenceCandidates;\n+", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "8737d4f893c881790f01bc9b41ef1635be8db1e1"}, "originalPosition": 44}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "8737d4f893c881790f01bc9b41ef1635be8db1e1", "author": {"user": null}, "url": "https://github.com/eclipse-openj9/openj9/commit/8737d4f893c881790f01bc9b41ef1635be8db1e1", "committedDate": "2020-08-19T22:52:12Z", "message": "VGCL: report Monitor References\n\nReport Monitor References in following types of GC operations:\n\tmark,scavenge,mark increment, copy forward\n\nSigned-off-by: Enson Guo <enson.guo@ibm.com>"}, "afterCommit": {"oid": "e1d47f68d9bedb52f576ef40fca90c4f356c4930", "author": {"user": null}, "url": "https://github.com/eclipse-openj9/openj9/commit/e1d47f68d9bedb52f576ef40fca90c4f356c4930", "committedDate": "2020-08-26T19:44:57Z", "message": "VGCL: report Monitor References\n\nReport Monitor References in following types of GC operations:\n\tmark,scavenge,mark increment, copy forward\n\nSigned-off-by: Enson Guo <enson.guo@ibm.com>"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDc1ODE0MDYw", "url": "https://github.com/eclipse-openj9/openj9/pull/10396#pullrequestreview-475814060", "createdAt": "2020-08-26T19:57:30Z", "commit": {"oid": "8737d4f893c881790f01bc9b41ef1635be8db1e1"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 5, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yNlQxOTo1OTo0N1rOHHbpxg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yNlQyMDozNDozNlrOHHcu0g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NzU1NTE0Mg==", "bodyText": "Comments on the above 2 lines should not mention \"marking\", should be changed to say \"during scavenge\" or \"for the cycle\"", "url": "https://github.com/eclipse-openj9/openj9/pull/10396#discussion_r477555142", "createdAt": "2020-08-26T19:59:47Z", "author": {"login": "RSalman"}, "path": "runtime/gc_stats/ScavengerJavaStats.hpp", "diffHunk": "@@ -58,6 +58,9 @@ class MM_ScavengerJavaStats\n \tMM_ReferenceStats _softReferenceStats;  /**< Soft reference stats for the cycle */\n \tMM_ReferenceStats _phantomReferenceStats;  /**< Phantom reference stats for the cycle */\n \n+\tUDATA _monitorReferenceCleared; /**< The number of monitor references that have been cleared during marking */\n+\tUDATA _monitorReferenceCandidates; /**< The number of monitor references that have been visited in monitor table during marking */\n+", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "e1d47f68d9bedb52f576ef40fca90c4f356c4930"}, "originalPosition": 14}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NzU1NjUyOA==", "bodyText": "monitor ref clear should not be in this method", "url": "https://github.com/eclipse-openj9/openj9/pull/10396#discussion_r477556528", "createdAt": "2020-08-26T20:02:22Z", "author": {"login": "RSalman"}, "path": "runtime/gc_stats/ScavengerJavaStats.cpp", "diffHunk": "@@ -57,6 +62,9 @@ MM_ScavengerJavaStats::clearOwnableSynchronizerCounts()\n \t_ownableSynchronizerCandidates = 0;\n \t_ownableSynchronizerTotalSurvived = 0;\n \t_ownableSynchronizerNurserySurvived = 0;\n+\n+\t_monitorReferenceCleared = 0;\n+\t_monitorReferenceCandidates = 0;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "e1d47f68d9bedb52f576ef40fca90c4f356c4930"}, "originalPosition": 33}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NzU2MDc2Ng==", "bodyText": "MM_ScavengerJavaStats::clear() is sufficient", "url": "https://github.com/eclipse-openj9/openj9/pull/10396#discussion_r477560766", "createdAt": "2020-08-26T20:11:07Z", "author": {"login": "RSalman"}, "path": "runtime/gc_stats/ScavengerJavaStats.cpp", "diffHunk": "@@ -57,6 +62,9 @@ MM_ScavengerJavaStats::clearOwnableSynchronizerCounts()\n \t_ownableSynchronizerCandidates = 0;\n \t_ownableSynchronizerTotalSurvived = 0;\n \t_ownableSynchronizerNurserySurvived = 0;\n+\n+\t_monitorReferenceCleared = 0;\n+\t_monitorReferenceCandidates = 0;", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NzU1NjUyOA=="}, "originalCommit": {"oid": "e1d47f68d9bedb52f576ef40fca90c4f356c4930"}, "originalPosition": 33}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NzU2MzQyMw==", "bodyText": "Extra new line should be removed here", "url": "https://github.com/eclipse-openj9/openj9/pull/10396#discussion_r477563423", "createdAt": "2020-08-26T20:16:22Z", "author": {"login": "RSalman"}, "path": "runtime/gc_stats/MarkVLHGCStats.hpp", "diffHunk": "@@ -126,6 +132,10 @@ class MM_MarkVLHGCStats : public MM_MarkVLHGCStatsCore\n \t\t_stringConstantsCleared += statsToMerge->_stringConstantsCleared;\n \t\t_stringConstantsCandidates += statsToMerge->_stringConstantsCandidates;\n \n+", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "e1d47f68d9bedb52f576ef40fca90c4f356c4930"}, "originalPosition": 32}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NzU3MjgxOA==", "bodyText": "I would swap this line and line 311, var declaration/initialization should come first in a case like this", "url": "https://github.com/eclipse-openj9/openj9/pull/10396#discussion_r477572818", "createdAt": "2020-08-26T20:34:36Z", "author": {"login": "RSalman"}, "path": "runtime/gc_glue_java/MarkingSchemeRootClearer.cpp", "diffHunk": "@@ -306,9 +306,12 @@ MM_MarkingSchemeRootClearer::scanOwnableSynchronizerObjects(MM_EnvironmentBase *\n void\n MM_MarkingSchemeRootClearer::doMonitorReference(J9ObjectMonitor *objectMonitor, GC_HashTableIterator *monitorReferenceIterator)\n {\n+\t_env->getGCEnvironment()->_markJavaStats._monitorReferenceCandidates += 1;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "e1d47f68d9bedb52f576ef40fca90c4f356c4930"}, "originalPosition": 4}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "e1d47f68d9bedb52f576ef40fca90c4f356c4930", "author": {"user": null}, "url": "https://github.com/eclipse-openj9/openj9/commit/e1d47f68d9bedb52f576ef40fca90c4f356c4930", "committedDate": "2020-08-26T19:44:57Z", "message": "VGCL: report Monitor References\n\nReport Monitor References in following types of GC operations:\n\tmark,scavenge,mark increment, copy forward\n\nSigned-off-by: Enson Guo <enson.guo@ibm.com>"}, "afterCommit": {"oid": "a271bc7c55d62937bb2561f8833ac4713ccd0303", "author": {"user": null}, "url": "https://github.com/eclipse-openj9/openj9/commit/a271bc7c55d62937bb2561f8833ac4713ccd0303", "committedDate": "2020-08-27T17:02:26Z", "message": "VGCL: report Monitor References\n\nReport Monitor References in following types of GC operations:\n\tmark,scavenge,mark increment, copy forward\n\nSigned-off-by: Enson Guo <enson.guo@ibm.com>"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDc4MjU3OTQy", "url": "https://github.com/eclipse-openj9/openj9/pull/10396#pullrequestreview-478257942", "createdAt": "2020-08-31T01:18:08Z", "commit": {"oid": "ad023b2e405300e319bff32e728bd1cfef2defab"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0zMVQwMToxODowOFrOHJnWVQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0zMVQwMToxODowOFrOHJnWVQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3OTg0MzkyNQ==", "bodyText": "@RSalman Should I delete these two lines? type=\"scavenge\" works without them. I believe they are merged in here:\nhttps://github.com/eclipse/openj9/blob/ad023b2e405300e319bff32e728bd1cfef2defab/runtime/gc_glue_java/ScavengerDelegate.cpp#L227\nWould like to confirm with you.", "url": "https://github.com/eclipse-openj9/openj9/pull/10396#discussion_r479843925", "createdAt": "2020-08-31T01:18:08Z", "author": {"login": "gza060625"}, "path": "runtime/gc_stats/ScavengerJavaStats.cpp", "diffHunk": "@@ -65,4 +71,8 @@ MM_ScavengerJavaStats::mergeOwnableSynchronizerCounts(MM_ScavengerJavaStats *sta\n \t_ownableSynchronizerCandidates += statsToMerge->_ownableSynchronizerCandidates;\n \t_ownableSynchronizerTotalSurvived += statsToMerge->_ownableSynchronizerTotalSurvived;\n \t_ownableSynchronizerNurserySurvived += statsToMerge->_ownableSynchronizerNurserySurvived;\n+\n+\t// _monitorReferenceCleared += statsToMerge->_monitorReferenceCleared;\n+\t// _monitorReferenceCandidates += statsToMerge->_monitorReferenceCandidates;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ad023b2e405300e319bff32e728bd1cfef2defab"}, "originalPosition": 41}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDgwMDE0MDE0", "url": "https://github.com/eclipse-openj9/openj9/pull/10396#pullrequestreview-480014014", "createdAt": "2020-09-01T18:35:31Z", "commit": {"oid": "43648b4bc636e6527511c94f6cd5c136644bc9f6"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0wMVQxODozNTozMVrOHLDSiw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0wMVQxODozNzoxMlrOHLDWNA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MTM1MDI4Mw==", "bodyText": "Please remove surrounding new lines, that matches more with rest of the method formatting", "url": "https://github.com/eclipse-openj9/openj9/pull/10396#discussion_r481350283", "createdAt": "2020-09-01T18:35:31Z", "author": {"login": "RSalman"}, "path": "runtime/gc_glue_java/ScavengerRootClearer.hpp", "diffHunk": "@@ -188,12 +188,16 @@ class MM_ScavengerRootClearer : public MM_RootScanner\n \t\tbool const compressed = _extensions->compressObjectReferences();\n \t\tJ9ThreadAbstractMonitor * monitor = (J9ThreadAbstractMonitor*)objectMonitor->monitor;\n \t\tomrobjectptr_t objectPtr = (omrobjectptr_t )monitor->userData;\n+\n+\t\t_env->getGCEnvironment()->_scavengerJavaStats._monitorReferenceCandidates += 1;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "43648b4bc636e6527511c94f6cd5c136644bc9f6"}, "originalPosition": 5}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MTM1MTIyMA==", "bodyText": "This new line should be removed", "url": "https://github.com/eclipse-openj9/openj9/pull/10396#discussion_r481351220", "createdAt": "2020-09-01T18:37:12Z", "author": {"login": "RSalman"}, "path": "runtime/gc_stats/ScavengerJavaStats.cpp", "diffHunk": "@@ -57,6 +62,7 @@ MM_ScavengerJavaStats::clearOwnableSynchronizerCounts()\n \t_ownableSynchronizerCandidates = 0;\n \t_ownableSynchronizerTotalSurvived = 0;\n \t_ownableSynchronizerNurserySurvived = 0;\n+", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "43648b4bc636e6527511c94f6cd5c136644bc9f6"}, "originalPosition": 31}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "6d0cdeeb66da767c30ecd36c785f15f596bccc0f", "author": {"user": null}, "url": "https://github.com/eclipse-openj9/openj9/commit/6d0cdeeb66da767c30ecd36c785f15f596bccc0f", "committedDate": "2020-09-01T18:56:32Z", "message": "VGCL: report Monitor References\n\nReport Monitor References in following types of GC operations:\n\tmark,scavenge,mark increment, copy forward\n\nSigned-off-by: Enson Guo <enson.guo@ibm.com>"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "3e32b670729cf2485f0f54ac9f5a245d8188fbc6", "author": {"user": null}, "url": "https://github.com/eclipse-openj9/openj9/commit/3e32b670729cf2485f0f54ac9f5a245d8188fbc6", "committedDate": "2020-09-01T18:46:07Z", "message": "space\n\nSigned-off-by: Enson Guo <enson.guo@ibm.com>"}, "afterCommit": {"oid": "6d0cdeeb66da767c30ecd36c785f15f596bccc0f", "author": {"user": null}, "url": "https://github.com/eclipse-openj9/openj9/commit/6d0cdeeb66da767c30ecd36c785f15f596bccc0f", "committedDate": "2020-09-01T18:56:32Z", "message": "VGCL: report Monitor References\n\nReport Monitor References in following types of GC operations:\n\tmark,scavenge,mark increment, copy forward\n\nSigned-off-by: Enson Guo <enson.guo@ibm.com>"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDgwMTA2MzM5", "url": "https://github.com/eclipse-openj9/openj9/pull/10396#pullrequestreview-480106339", "createdAt": "2020-09-01T20:52:15Z", "commit": {"oid": "6d0cdeeb66da767c30ecd36c785f15f596bccc0f"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDgwODIzMTE5", "url": "https://github.com/eclipse-openj9/openj9/pull/10396#pullrequestreview-480823119", "createdAt": "2020-09-02T13:33:06Z", "commit": {"oid": "6d0cdeeb66da767c30ecd36c785f15f596bccc0f"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 168, "cost": 1, "resetAt": "2021-10-28T17:48:14Z"}}}