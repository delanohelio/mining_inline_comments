{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDc0ODE4NjYy", "number": 10474, "reviewThreads": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yN1QxNjo0MzoyOVrOEdTb1A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yN1QxNjo1NzoxMVrOEdTvsA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjk5MTYyNTgwOnYy", "diffSide": "RIGHT", "path": "runtime/compiler/compile/J9Compilation.cpp", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yN1QxNjo0MzoyOVrOHIYr2g==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yN1QxNjo1MTozNVrOHIY-2A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3ODU1NTA5OA==", "bodyText": "if (((TR_J9VMBase *)fe)->isAOT_DEPRECATED_DO_NOT_USE() && TR::Compiler->target.cpu.isX86())\n      _target = TR::Compiler->relocatableTarget;\nI think this needs to be moved out as well (It looks like you already added code outside the constructor but didn't remove it from here)", "url": "https://github.com/eclipse-openj9/openj9/pull/10474#discussion_r478555098", "createdAt": "2020-08-27T16:43:29Z", "author": {"login": "harryyu1994"}, "path": "runtime/compiler/compile/J9Compilation.cpp", "diffHunk": "@@ -183,21 +185,9 @@ J9::Compilation::Compilation(int32_t id,\n #endif /* defined(J9VM_OPT_JITSERVER) */\n    _osrProhibitedOverRangeOfTrees(false)\n    {\n-#if defined(J9VM_OPT_JITSERVER)\n-   // In JITServer, we would like to use JITClient's processor info for the compilation\n-   // The following code effectively replaces the cpu with client's cpu through the getProcessorDescription() that has JITServer support\n-   if (self()->getPersistentInfo()->getRemoteCompilationMode() == JITServer::SERVER)\n+   if (((TR_J9VMBase *)fe)->isAOT_DEPRECATED_DO_NOT_USE() && TR::Compiler->target.cpu.isX86())", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "dec5738e333a95a270d60eff324927707c6bcf10"}, "originalPosition": 28}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3ODU1OTk2MA==", "bodyText": "Sorry forgot about this! Fixed in e7c02f3.", "url": "https://github.com/eclipse-openj9/openj9/pull/10474#discussion_r478559960", "createdAt": "2020-08-27T16:51:35Z", "author": {"login": "dchopra001"}, "path": "runtime/compiler/compile/J9Compilation.cpp", "diffHunk": "@@ -183,21 +185,9 @@ J9::Compilation::Compilation(int32_t id,\n #endif /* defined(J9VM_OPT_JITSERVER) */\n    _osrProhibitedOverRangeOfTrees(false)\n    {\n-#if defined(J9VM_OPT_JITSERVER)\n-   // In JITServer, we would like to use JITClient's processor info for the compilation\n-   // The following code effectively replaces the cpu with client's cpu through the getProcessorDescription() that has JITServer support\n-   if (self()->getPersistentInfo()->getRemoteCompilationMode() == JITServer::SERVER)\n+   if (((TR_J9VMBase *)fe)->isAOT_DEPRECATED_DO_NOT_USE() && TR::Compiler->target.cpu.isX86())", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3ODU1NTA5OA=="}, "originalCommit": {"oid": "dec5738e333a95a270d60eff324927707c6bcf10"}, "originalPosition": 28}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjk5MTYzNzI1OnYy", "diffSide": "RIGHT", "path": "runtime/compiler/compile/J9Compilation.cpp", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yN1QxNjo0NjoyMlrOHIYyxA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yN1QxNjo0NjoyMlrOHIYyxA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3ODU1Njg2OA==", "bodyText": "Here we are ignoring the parameter target and set our own. It may be nicer for the caller to set the parameter to TR::Compiler->relocatableTarget when we have AOT compilations under x86.", "url": "https://github.com/eclipse-openj9/openj9/pull/10474#discussion_r478556868", "createdAt": "2020-08-27T16:46:22Z", "author": {"login": "mpirvu"}, "path": "runtime/compiler/compile/J9Compilation.cpp", "diffHunk": "@@ -183,21 +185,9 @@ J9::Compilation::Compilation(int32_t id,\n #endif /* defined(J9VM_OPT_JITSERVER) */\n    _osrProhibitedOverRangeOfTrees(false)\n    {\n-#if defined(J9VM_OPT_JITSERVER)\n-   // In JITServer, we would like to use JITClient's processor info for the compilation\n-   // The following code effectively replaces the cpu with client's cpu through the getProcessorDescription() that has JITServer support\n-   if (self()->getPersistentInfo()->getRemoteCompilationMode() == JITServer::SERVER)\n+   if (((TR_J9VMBase *)fe)->isAOT_DEPRECATED_DO_NOT_USE() && TR::Compiler->target.cpu.isX86())\n       {\n-      OMRProcessorDesc JITClientProcessorDesc = TR::Compiler->target.cpu.getProcessorDescription();\n-      _target.cpu = TR::CPU(JITClientProcessorDesc);\n-      }\n-   else\n-#endif /* defined(J9VM_OPT_JITSERVER) */\n-      {\n-      if (((TR_J9VMBase *)fe)->isAOT_DEPRECATED_DO_NOT_USE() && TR::Compiler->target.cpu.isX86())\n-         {\n-         _target = TR::Compiler->relocatableTarget;\n-         }\n+      _target = TR::Compiler->relocatableTarget;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "dec5738e333a95a270d60eff324927707c6bcf10"}, "originalPosition": 40}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjk5MTY3NjY0OnYy", "diffSide": "RIGHT", "path": "runtime/compiler/control/CompilationThread.cpp", "isResolved": true, "comments": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yN1QxNjo1NzoxMVrOHIZLdA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yN1QxOToxNDo0M1rOHIdzvg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3ODU2MzE4OA==", "bodyText": "Why is the cast needed? Isn't target a TR::Environment variable?", "url": "https://github.com/eclipse-openj9/openj9/pull/10474#discussion_r478563188", "createdAt": "2020-08-27T16:57:11Z", "author": {"login": "mpirvu"}, "path": "runtime/compiler/control/CompilationThread.cpp", "diffHunk": "@@ -8513,7 +8531,8 @@ TR::CompilationInfoPerThreadBase::wrappedCompile(J9PortLibrary *portLib, void *\n                p->_dispatchRegion,\n                p->trMemory(),\n                p->_optimizationPlan,\n-               reloRuntime);\n+               reloRuntime,\n+               static_cast<TR::Environment *>(&target));", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "e7c02f3c6e8fc77822ef63d4a1f97866c019ec93"}, "originalPosition": 31}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3ODU2OTUxNg==", "bodyText": "This was needed to cast it to a pointer to a TR::Environment.", "url": "https://github.com/eclipse-openj9/openj9/pull/10474#discussion_r478569516", "createdAt": "2020-08-27T17:08:02Z", "author": {"login": "dchopra001"}, "path": "runtime/compiler/control/CompilationThread.cpp", "diffHunk": "@@ -8513,7 +8531,8 @@ TR::CompilationInfoPerThreadBase::wrappedCompile(J9PortLibrary *portLib, void *\n                p->_dispatchRegion,\n                p->trMemory(),\n                p->_optimizationPlan,\n-               reloRuntime);\n+               reloRuntime,\n+               static_cast<TR::Environment *>(&target));", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3ODU2MzE4OA=="}, "originalCommit": {"oid": "e7c02f3c6e8fc77822ef63d4a1f97866c019ec93"}, "originalPosition": 31}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3ODYyMzYzNQ==", "bodyText": "Isn't &target of type TR::Environment * though?", "url": "https://github.com/eclipse-openj9/openj9/pull/10474#discussion_r478623635", "createdAt": "2020-08-27T18:45:29Z", "author": {"login": "dsouzai"}, "path": "runtime/compiler/control/CompilationThread.cpp", "diffHunk": "@@ -8513,7 +8531,8 @@ TR::CompilationInfoPerThreadBase::wrappedCompile(J9PortLibrary *portLib, void *\n                p->_dispatchRegion,\n                p->trMemory(),\n                p->_optimizationPlan,\n-               reloRuntime);\n+               reloRuntime,\n+               static_cast<TR::Environment *>(&target));", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3ODU2MzE4OA=="}, "originalCommit": {"oid": "e7c02f3c6e8fc77822ef63d4a1f97866c019ec93"}, "originalPosition": 31}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3ODYzOTAzOA==", "bodyText": "Yeah, I can't recall why I added this initially now. But I've removed the case here: 2b4a2d7", "url": "https://github.com/eclipse-openj9/openj9/pull/10474#discussion_r478639038", "createdAt": "2020-08-27T19:14:43Z", "author": {"login": "dchopra001"}, "path": "runtime/compiler/control/CompilationThread.cpp", "diffHunk": "@@ -8513,7 +8531,8 @@ TR::CompilationInfoPerThreadBase::wrappedCompile(J9PortLibrary *portLib, void *\n                p->_dispatchRegion,\n                p->trMemory(),\n                p->_optimizationPlan,\n-               reloRuntime);\n+               reloRuntime,\n+               static_cast<TR::Environment *>(&target));", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3ODU2MzE4OA=="}, "originalCommit": {"oid": "e7c02f3c6e8fc77822ef63d4a1f97866c019ec93"}, "originalPosition": 31}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4755, "cost": 1, "resetAt": "2021-11-12T18:49:56Z"}}}