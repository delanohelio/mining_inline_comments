{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDQ0OTcxOTE4", "number": 10095, "title": "verbose:module/nomodule option implementation", "bodyText": "Fixes: #9248\nDocs issue: eclipse-openj9/openj9-docs#593\nHotspot -verbose:module output format:\n[0.034s][info][module,load] java.base location: jrt:/java.base\n[0.035s][info][module,load] jdk.jlink location: jrt:/jdk.jlink\n[0.035s][info][module,load] java.net.http location: jrt:/java.net.http\n[0.035s][info][module,load] java.security.jgss location: jrt:/java.security.jgss\n[0.035s][info][module,load] java.transaction.xa location: jrt:/java.transaction.xa\n[0.036s][info][module,load] jdk.internal.jvmstat location: jrt:/jdk.internal.jvmstat\n\nOpenJ9 output format (similar to OpenJ9 verbose:class):\nmodule load: java.base from: jrt:/java.base\nmodule load: jdk.dynalink from: jrt:/jdk.dynalink\nmodule load: jdk.httpserver from: jrt:/jdk.httpserver\nmodule load: jdk.unsupported from: jrt:/jdk.unsupported\nmodule load: openj9.dtfj from: jrt:/openj9.dtfj\nmodule load: jdk.jdwp.agent from: jrt:/jdk.jdwp.agent\nmodule load: jdk.localedata from: jrt:/jdk.localedata\nmodule load: jdk.zipfs from: jrt:/jdk.zipfs\n\nSigned-off-by: Theresa Mammarella Theresa.T.Mammarella@ibm.com", "createdAt": "2020-07-06T19:55:31Z", "url": "https://github.com/eclipse-openj9/openj9/pull/10095", "merged": true, "mergeCommit": {"oid": "a355c88e97f5547997f444fd02c6d2a50fe3db0a"}, "closed": true, "closedAt": "2021-01-07T04:15:39Z", "author": {"login": "theresa-m"}, "timelineItems": {"totalCount": 13, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcyW1sHgBqjM1MTc0NDEwMDM=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdtsOiqAFqTU2MzE5OTg4NQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "d48b579fa22ba57867ca4df66305ca14c98ea963", "author": {"user": {"login": "theresa-m", "name": "Theresa Mammarella"}}, "url": "https://github.com/eclipse-openj9/openj9/commit/d48b579fa22ba57867ca4df66305ca14c98ea963", "committedDate": "2020-07-06T19:53:08Z", "message": "verbose:module/nomodule option implementation\n\nSigned-off-by: Theresa Mammarella <Theresa.T.Mammarella@ibm.com>"}, "afterCommit": {"oid": "de71cca307acc92567b3035fa5c10e10a1c75c3a", "author": {"user": {"login": "theresa-m", "name": "Theresa Mammarella"}}, "url": "https://github.com/eclipse-openj9/openj9/commit/de71cca307acc92567b3035fa5c10e10a1c75c3a", "committedDate": "2020-07-06T19:58:43Z", "message": "verbose:module/nomodule option implementation\n\nSigned-off-by: Theresa Mammarella <Theresa.T.Mammarella@ibm.com>"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "de71cca307acc92567b3035fa5c10e10a1c75c3a", "author": {"user": {"login": "theresa-m", "name": "Theresa Mammarella"}}, "url": "https://github.com/eclipse-openj9/openj9/commit/de71cca307acc92567b3035fa5c10e10a1c75c3a", "committedDate": "2020-07-06T19:58:43Z", "message": "verbose:module/nomodule option implementation\n\nSigned-off-by: Theresa Mammarella <Theresa.T.Mammarella@ibm.com>"}, "afterCommit": {"oid": "b08ef1cb7509a616a634b0b02b78a498e1da272c", "author": {"user": {"login": "theresa-m", "name": "Theresa Mammarella"}}, "url": "https://github.com/eclipse-openj9/openj9/commit/b08ef1cb7509a616a634b0b02b78a498e1da272c", "committedDate": "2020-08-10T15:36:02Z", "message": "verbose:module/nomodule option implementation\n\nSigned-off-by: Theresa Mammarella <Theresa.T.Mammarella@ibm.com>"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTU4MjE1ODc1", "url": "https://github.com/eclipse-openj9/openj9/pull/10095#pullrequestreview-558215875", "createdAt": "2020-12-23T20:31:59Z", "commit": {"oid": "b08ef1cb7509a616a634b0b02b78a498e1da272c"}, "state": "COMMENTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0yM1QyMDozMjoxMVrOIK0OkA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0yM1QyMDozNTozNVrOIK0YuQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0ODIxMjM2OA==", "bodyText": "This memory needs to be freed when it doesn't fit into the buffer.", "url": "https://github.com/eclipse-openj9/openj9/pull/10095#discussion_r548212368", "createdAt": "2020-12-23T20:32:11Z", "author": {"login": "pshipton"}, "path": "runtime/verbose/verbose.c", "diffHunk": "@@ -1333,6 +1360,46 @@ verboseStackMapFrameVerification(J9HookInterface** hook, UDATA eventNum, void* e\n \treleaseVerboseVerificationBuffer(PORTLIB, &buf, byteArray);\n }\n \n+#if (JAVA_SPEC_VERSION >= 11)\n+static void\n+printModule(J9VMThread* vmThread, char* message, J9Module* module)\n+{\n+\tchar moduleNameBuf[J9VM_PACKAGE_NAME_BUFFER_LENGTH];\n+\tchar *moduleNameUTF = NULL;\n+\tJ9UTF8 *jrtURL = NULL;\n+\tchar* template = \"%s: %s from: %.*s\\n\";\n+\n+\tPORT_ACCESS_FROM_VMC(vmThread);\n+\n+\t/* module name */\n+\tmoduleNameUTF = vmThread->javaVM->internalVMFunctions->copyStringToUTF8WithMemAlloc(", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b08ef1cb7509a616a634b0b02b78a498e1da272c"}, "originalPosition": 78}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0ODIxNDk2OQ==", "bodyText": "I don't understand why this case is needed. It seems the hooks are only registered when VERBOSE_SETTINGS_SET, and registering occurs after parsing all the options, so there is no case when the hooks need to be unregistered. parseVerboseArgumentList() is only called once, and registering the hooks isn't inside a loop.", "url": "https://github.com/eclipse-openj9/openj9/pull/10095#discussion_r548214969", "createdAt": "2020-12-23T20:35:35Z", "author": {"login": "pshipton"}, "path": "runtime/verbose/verbose.c", "diffHunk": "@@ -1122,6 +1136,19 @@ setVerboseState( J9JavaVM *vm, J9VerboseSettings *verboseOptions, char **errorSt\n \t\tvm->verboseStruct->getCfrExceptionDetails = generateJ9CfrExceptionDetails;\n \t\tvm->verboseStruct->getRtvExceptionDetails = generateJ9RtvExceptionDetails;\n \t}\n+\n+#if (JAVA_SPEC_VERSION >= 11)\n+\tif (VERBOSE_SETTINGS_CLEAR == verboseOptions->module) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b08ef1cb7509a616a634b0b02b78a498e1da272c"}, "originalPosition": 48}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTU4MjIxMjI0", "url": "https://github.com/eclipse-openj9/openj9/pull/10095#pullrequestreview-558221224", "createdAt": "2020-12-23T20:46:30Z", "commit": {"oid": "b08ef1cb7509a616a634b0b02b78a498e1da272c"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0yM1QyMDo0NjozMFrOIK05KA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0yM1QyMDo0NjozMFrOIK05KA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0ODIyMzI3Mg==", "bodyText": "We don't need to test all these modes. The code doesn't depend on JIT modes, GC policy, compressed or non-compressed. Testing NoOptions should be sufficient.", "url": "https://github.com/eclipse-openj9/openj9/pull/10095#discussion_r548223272", "createdAt": "2020-12-23T20:46:30Z", "author": {"login": "pshipton"}, "path": "test/functional/cmdLineTests/verbosetest/playlist.xml", "diffHunk": "@@ -49,4 +49,34 @@\n \t\t\t<impl>ibm</impl>\n \t\t</impls>\n \t</test>\n+\n+\t<test>\n+\t\t<testCaseName>cmdLineTester_verbosetest_11</testCaseName>\n+\t\t<variations>\n+\t\t\t<variation>NoOptions</variation>\n+\t\t\t<variation>Mode501</variation>", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b08ef1cb7509a616a634b0b02b78a498e1da272c"}, "originalPosition": 18}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "b08ef1cb7509a616a634b0b02b78a498e1da272c", "author": {"user": {"login": "theresa-m", "name": "Theresa Mammarella"}}, "url": "https://github.com/eclipse-openj9/openj9/commit/b08ef1cb7509a616a634b0b02b78a498e1da272c", "committedDate": "2020-08-10T15:36:02Z", "message": "verbose:module/nomodule option implementation\n\nSigned-off-by: Theresa Mammarella <Theresa.T.Mammarella@ibm.com>"}, "afterCommit": {"oid": "2d94c21397bdb4648973c53d88a6d5e8ceff5499", "author": {"user": {"login": "theresa-m", "name": "Theresa Mammarella"}}, "url": "https://github.com/eclipse-openj9/openj9/commit/2d94c21397bdb4648973c53d88a6d5e8ceff5499", "committedDate": "2021-01-06T17:08:06Z", "message": "verbose:module/nomodule option implementation\n\nSigned-off-by: Theresa Mammarella <Theresa.T.Mammarella@ibm.com>"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "2d94c21397bdb4648973c53d88a6d5e8ceff5499", "author": {"user": {"login": "theresa-m", "name": "Theresa Mammarella"}}, "url": "https://github.com/eclipse-openj9/openj9/commit/2d94c21397bdb4648973c53d88a6d5e8ceff5499", "committedDate": "2021-01-06T17:08:06Z", "message": "verbose:module/nomodule option implementation\n\nSigned-off-by: Theresa Mammarella <Theresa.T.Mammarella@ibm.com>"}, "afterCommit": {"oid": "44b3e7790e4d01035b2f6b021a6158841f632e27", "author": {"user": {"login": "theresa-m", "name": "Theresa Mammarella"}}, "url": "https://github.com/eclipse-openj9/openj9/commit/44b3e7790e4d01035b2f6b021a6158841f632e27", "committedDate": "2021-01-06T17:33:18Z", "message": "verbose:module/nomodule option implementation\n\nSigned-off-by: Theresa Mammarella <tmammare@redhat.com>"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "44b3e7790e4d01035b2f6b021a6158841f632e27", "author": {"user": {"login": "theresa-m", "name": "Theresa Mammarella"}}, "url": "https://github.com/eclipse-openj9/openj9/commit/44b3e7790e4d01035b2f6b021a6158841f632e27", "committedDate": "2021-01-06T17:33:18Z", "message": "verbose:module/nomodule option implementation\n\nSigned-off-by: Theresa Mammarella <tmammare@redhat.com>"}, "afterCommit": {"oid": "837addf109e4d904019aab5c217f70327eb6191e", "author": {"user": {"login": "theresa-m", "name": "Theresa Mammarella"}}, "url": "https://github.com/eclipse-openj9/openj9/commit/837addf109e4d904019aab5c217f70327eb6191e", "committedDate": "2021-01-06T17:37:49Z", "message": "verbose:module/nomodule option implementation\n\nSigned-off-by: Theresa Mammarella <tmammare@redhat.com>"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "837addf109e4d904019aab5c217f70327eb6191e", "author": {"user": {"login": "theresa-m", "name": "Theresa Mammarella"}}, "url": "https://github.com/eclipse-openj9/openj9/commit/837addf109e4d904019aab5c217f70327eb6191e", "committedDate": "2021-01-06T17:37:49Z", "message": "verbose:module/nomodule option implementation\n\nSigned-off-by: Theresa Mammarella <tmammare@redhat.com>"}, "afterCommit": {"oid": "ea4cc4ecbe444e557e236b00c774eb79f55003f0", "author": {"user": {"login": "theresa-m", "name": "Theresa Mammarella"}}, "url": "https://github.com/eclipse-openj9/openj9/commit/ea4cc4ecbe444e557e236b00c774eb79f55003f0", "committedDate": "2021-01-06T17:39:46Z", "message": "verbose:module/nomodule option implementation\n\nSigned-off-by: Theresa Mammarella <tmammare@redhat.com>"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTYyOTM5NDk0", "url": "https://github.com/eclipse-openj9/openj9/pull/10095#pullrequestreview-562939494", "createdAt": "2021-01-06T18:21:41Z", "commit": {"oid": "ea4cc4ecbe444e557e236b00c774eb79f55003f0"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wMS0wNlQxODoyMTo0MVrOIPRbsg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wMS0wNlQxODoyMTo0MVrOIPRbsg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1Mjg4NTE3MA==", "bodyText": "Is setting VERBOSE_SETTINGS_IGNORE or VERBOSE_SETTINGS_CLEAR still needed, I don't see these used.", "url": "https://github.com/eclipse-openj9/openj9/pull/10095#discussion_r552885170", "createdAt": "2021-01-06T18:21:41Z", "author": {"login": "pshipton"}, "path": "runtime/verbose/verbose.c", "diffHunk": "@@ -633,6 +641,12 @@ parseVerboseArgument(char* options, J9VerboseSettings* verboseOptions, char** er\n \t\t\tverboseOptions->relocations = VERBOSE_SETTINGS_SET;\n \t\t} else if(strcmp(options, OPT_ROMCLASS)==0) {\n \t\t\tverboseOptions->romclass = VERBOSE_SETTINGS_SET;\n+#if (JAVA_SPEC_VERSION >= 11)\n+\t\t} else if(strcmp(options, OPT_NOMODULE)==0) {\n+\t\t\tverboseOptions->module = (VERBOSE_SETTINGS_SET == verboseOptions->module) ? VERBOSE_SETTINGS_IGNORE: VERBOSE_SETTINGS_CLEAR;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ea4cc4ecbe444e557e236b00c774eb79f55003f0"}, "originalPosition": 35}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "ea4cc4ecbe444e557e236b00c774eb79f55003f0", "author": {"user": {"login": "theresa-m", "name": "Theresa Mammarella"}}, "url": "https://github.com/eclipse-openj9/openj9/commit/ea4cc4ecbe444e557e236b00c774eb79f55003f0", "committedDate": "2021-01-06T17:39:46Z", "message": "verbose:module/nomodule option implementation\n\nSigned-off-by: Theresa Mammarella <tmammare@redhat.com>"}, "afterCommit": {"oid": "5112b84cea85ffe5226719b145883d2763b482c3", "author": {"user": {"login": "theresa-m", "name": "Theresa Mammarella"}}, "url": "https://github.com/eclipse-openj9/openj9/commit/5112b84cea85ffe5226719b145883d2763b482c3", "committedDate": "2021-01-06T22:03:24Z", "message": "verbose:module/nomodule option implementation\n\nSigned-off-by: Theresa Mammarella <tmammare@redhat.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a56a38a3d4a0dd6c67e224ced5a34a0de69b3ad7", "author": {"user": {"login": "theresa-m", "name": "Theresa Mammarella"}}, "url": "https://github.com/eclipse-openj9/openj9/commit/a56a38a3d4a0dd6c67e224ced5a34a0de69b3ad7", "committedDate": "2021-01-06T22:58:33Z", "message": "verbose:module/nomodule option implementation\n\nSigned-off-by: Theresa Mammarella <tmammare@redhat.com>"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "5112b84cea85ffe5226719b145883d2763b482c3", "author": {"user": {"login": "theresa-m", "name": "Theresa Mammarella"}}, "url": "https://github.com/eclipse-openj9/openj9/commit/5112b84cea85ffe5226719b145883d2763b482c3", "committedDate": "2021-01-06T22:03:24Z", "message": "verbose:module/nomodule option implementation\n\nSigned-off-by: Theresa Mammarella <tmammare@redhat.com>"}, "afterCommit": {"oid": "a56a38a3d4a0dd6c67e224ced5a34a0de69b3ad7", "author": {"user": {"login": "theresa-m", "name": "Theresa Mammarella"}}, "url": "https://github.com/eclipse-openj9/openj9/commit/a56a38a3d4a0dd6c67e224ced5a34a0de69b3ad7", "committedDate": "2021-01-06T22:58:33Z", "message": "verbose:module/nomodule option implementation\n\nSigned-off-by: Theresa Mammarella <tmammare@redhat.com>"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTYzMTk5ODg1", "url": "https://github.com/eclipse-openj9/openj9/pull/10095#pullrequestreview-563199885", "createdAt": "2021-01-07T04:15:32Z", "commit": {"oid": "a56a38a3d4a0dd6c67e224ced5a34a0de69b3ad7"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 504, "cost": 1, "resetAt": "2021-10-28T17:48:14Z"}}}