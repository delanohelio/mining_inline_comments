{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDI2ODI4MzY5", "number": 9775, "reviewThreads": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wOFQxNzoyODo0NlrOEDjXYg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wOFQxNzo0MTo0NVrOEDjqDg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjcyMTYwNjEwOnYy", "diffSide": "RIGHT", "path": "runtime/tests/port/si.c", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wOFQxNzoyODo0NlrOGgosvw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wOFQxNzozNjo1MFrOGgpATQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNjg3NDQzMQ==", "bodyText": "Please add comments here and on #endif: /* defined(RISCV64) */.", "url": "https://github.com/eclipse-openj9/openj9/pull/9775#discussion_r436874431", "createdAt": "2020-06-08T17:28:46Z", "author": {"login": "keithc-ca"}, "path": "runtime/tests/port/si.c", "diffHunk": "@@ -2183,9 +2183,17 @@ j9sysinfo_test_get_l1dcache_line_size(struct J9PortLibrary *portLibrary)\n \tcQuery.level = 1;\n \tcQuery.cacheType = J9PORT_CACHEINFO_DCACHE;\n \trc = j9sysinfo_get_cache_info(&cQuery);\n-#if !(defined(J9ARM) || defined(RISCV64))\n+#if !(defined(J9ARM))\n \tif (rc < 0) {\n+#if defined(RISCV64)\n+\t\toutputComment(PORTLIB, \"j9sysinfo_get_cache_info is not supported on this platform\\n\");\n+\t\tif (J9PORT_ERROR_SYSINFO_NOT_SUPPORTED != rc) {\n+\t\t\toutputErrorMessage(PORTTEST_ERROR_ARGS, \"j9sysinfo_get_cache_info should have returned %d but returned %d\\n\", \n+\t\t\t\tJ9PORT_ERROR_SYSINFO_NOT_SUPPORTED, rc);\n+\t\t}\n+#else", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "4b2c869e0662aa576fa6840859752f56b8165b31"}, "originalPosition": 13}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNjg3OTQzNw==", "bodyText": "Added as suggested above.", "url": "https://github.com/eclipse-openj9/openj9/pull/9775#discussion_r436879437", "createdAt": "2020-06-08T17:36:50Z", "author": {"login": "ChengJin01"}, "path": "runtime/tests/port/si.c", "diffHunk": "@@ -2183,9 +2183,17 @@ j9sysinfo_test_get_l1dcache_line_size(struct J9PortLibrary *portLibrary)\n \tcQuery.level = 1;\n \tcQuery.cacheType = J9PORT_CACHEINFO_DCACHE;\n \trc = j9sysinfo_get_cache_info(&cQuery);\n-#if !(defined(J9ARM) || defined(RISCV64))\n+#if !(defined(J9ARM))\n \tif (rc < 0) {\n+#if defined(RISCV64)\n+\t\toutputComment(PORTLIB, \"j9sysinfo_get_cache_info is not supported on this platform\\n\");\n+\t\tif (J9PORT_ERROR_SYSINFO_NOT_SUPPORTED != rc) {\n+\t\t\toutputErrorMessage(PORTTEST_ERROR_ARGS, \"j9sysinfo_get_cache_info should have returned %d but returned %d\\n\", \n+\t\t\t\tJ9PORT_ERROR_SYSINFO_NOT_SUPPORTED, rc);\n+\t\t}\n+#else", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNjg3NDQzMQ=="}, "originalCommit": {"oid": "4b2c869e0662aa576fa6840859752f56b8165b31"}, "originalPosition": 13}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjcyMTYwNzM1OnYy", "diffSide": "RIGHT", "path": "runtime/tests/port/si.c", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wOFQxNzoyOTowN1rOGgotmQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wOFQxNzozNzowMFrOGgpApQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNjg3NDY0OQ==", "bodyText": "Please remove the unnecessary pareentheses.", "url": "https://github.com/eclipse-openj9/openj9/pull/9775#discussion_r436874649", "createdAt": "2020-06-08T17:29:07Z", "author": {"login": "keithc-ca"}, "path": "runtime/tests/port/si.c", "diffHunk": "@@ -2183,9 +2183,17 @@ j9sysinfo_test_get_l1dcache_line_size(struct J9PortLibrary *portLibrary)\n \tcQuery.level = 1;\n \tcQuery.cacheType = J9PORT_CACHEINFO_DCACHE;\n \trc = j9sysinfo_get_cache_info(&cQuery);\n-#if !(defined(J9ARM) || defined(RISCV64))\n+#if !(defined(J9ARM))", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "4b2c869e0662aa576fa6840859752f56b8165b31"}, "originalPosition": 5}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNjg3OTUyNQ==", "bodyText": "Fixed.", "url": "https://github.com/eclipse-openj9/openj9/pull/9775#discussion_r436879525", "createdAt": "2020-06-08T17:37:00Z", "author": {"login": "ChengJin01"}, "path": "runtime/tests/port/si.c", "diffHunk": "@@ -2183,9 +2183,17 @@ j9sysinfo_test_get_l1dcache_line_size(struct J9PortLibrary *portLibrary)\n \tcQuery.level = 1;\n \tcQuery.cacheType = J9PORT_CACHEINFO_DCACHE;\n \trc = j9sysinfo_get_cache_info(&cQuery);\n-#if !(defined(J9ARM) || defined(RISCV64))\n+#if !(defined(J9ARM))", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNjg3NDY0OQ=="}, "originalCommit": {"oid": "4b2c869e0662aa576fa6840859752f56b8165b31"}, "originalPosition": 5}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjcyMTYxMjEwOnYy", "diffSide": "RIGHT", "path": "runtime/tests/port/si.c", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wOFQxNzozMDoyMlrOGgowkA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wOFQxNzozNzowNVrOGgpAzw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNjg3NTQwOA==", "bodyText": "Please update the comment to match the #if condition and restore the spaces (here and on the #endif).\n#else /* !defined(J9ARM) */", "url": "https://github.com/eclipse-openj9/openj9/pull/9775#discussion_r436875408", "createdAt": "2020-06-08T17:30:22Z", "author": {"login": "keithc-ca"}, "path": "runtime/tests/port/si.c", "diffHunk": "@@ -2199,13 +2207,13 @@ j9sysinfo_test_get_l1dcache_line_size(struct J9PortLibrary *portLibrary)\n \t\t\t\t\tl1DcacheSize, rc);\n \t\t}\n \t}\n-#else /* !(defined(J9ARM) || defined(RISCV64)) */\n+#else /*!(defined(J9ARM))*/", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "4b2c869e0662aa576fa6840859752f56b8165b31"}, "originalPosition": 24}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNjg3OTU2Nw==", "bodyText": "Fixed.", "url": "https://github.com/eclipse-openj9/openj9/pull/9775#discussion_r436879567", "createdAt": "2020-06-08T17:37:05Z", "author": {"login": "ChengJin01"}, "path": "runtime/tests/port/si.c", "diffHunk": "@@ -2199,13 +2207,13 @@ j9sysinfo_test_get_l1dcache_line_size(struct J9PortLibrary *portLibrary)\n \t\t\t\t\tl1DcacheSize, rc);\n \t\t}\n \t}\n-#else /* !(defined(J9ARM) || defined(RISCV64)) */\n+#else /*!(defined(J9ARM))*/", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNjg3NTQwOA=="}, "originalCommit": {"oid": "4b2c869e0662aa576fa6840859752f56b8165b31"}, "originalPosition": 24}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjcyMTY1MzkwOnYy", "diffSide": "RIGHT", "path": "runtime/port/unix/j9sysinfo.c", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wOFQxNzo0MTo0NVrOGgpK3g==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wOFQxNzo0NjowM1rOGgpUNw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNjg4MjE0Mg==", "bodyText": "This deserves a comment too (/* defined(RISCV64) */) - I should have mentioned it in the previous review.", "url": "https://github.com/eclipse-openj9/openj9/pull/9775#discussion_r436882142", "createdAt": "2020-06-08T17:41:45Z", "author": {"login": "keithc-ca"}, "path": "runtime/port/unix/j9sysinfo.c", "diffHunk": "@@ -1719,6 +1719,17 @@ j9sysinfo_get_cache_info(struct J9PortLibrary *portLibrary, const J9CacheInfoQue\n \tcase J9PORT_CACHEINFO_QUERY_LINESIZE:\n \tcase J9PORT_CACHEINFO_QUERY_CACHESIZE:\n \t\tresult =  getCacheSize(portLibrary, query->cpu, query->level, query->cacheType, query->cmd);\n+\n+#if defined(RISCV64)\n+\t/* The L1 data cache at \"cache/index1\" is set up from \"/sys/devices/system/cpu/cpu1\" on some Linux distro\n+\t * (e.g. Debian_riscv) rather than \"/sys/devices/system/cpu/cpu0\" in which \"cache/index1\" doesn't exist.\n+\t * Note: this is a temporary solution specific to Debian_riscv which won't be used or simply\n+\t * removed once we confirm \"cpu0/cache/index1\" does exist on the latest version of Debian_riscv.\n+\t */\n+\tif (result < 0) {\n+\t\tresult =  getCacheSize(portLibrary, query->cpu + 1, query->level, query->cacheType, query->cmd);\n+\t}\n+#endif", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "673481b287e61194c96f0daa89d0e813450870fd"}, "originalPosition": 14}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNjg4NDUzNQ==", "bodyText": "Fixed.", "url": "https://github.com/eclipse-openj9/openj9/pull/9775#discussion_r436884535", "createdAt": "2020-06-08T17:46:03Z", "author": {"login": "ChengJin01"}, "path": "runtime/port/unix/j9sysinfo.c", "diffHunk": "@@ -1719,6 +1719,17 @@ j9sysinfo_get_cache_info(struct J9PortLibrary *portLibrary, const J9CacheInfoQue\n \tcase J9PORT_CACHEINFO_QUERY_LINESIZE:\n \tcase J9PORT_CACHEINFO_QUERY_CACHESIZE:\n \t\tresult =  getCacheSize(portLibrary, query->cpu, query->level, query->cacheType, query->cmd);\n+\n+#if defined(RISCV64)\n+\t/* The L1 data cache at \"cache/index1\" is set up from \"/sys/devices/system/cpu/cpu1\" on some Linux distro\n+\t * (e.g. Debian_riscv) rather than \"/sys/devices/system/cpu/cpu0\" in which \"cache/index1\" doesn't exist.\n+\t * Note: this is a temporary solution specific to Debian_riscv which won't be used or simply\n+\t * removed once we confirm \"cpu0/cache/index1\" does exist on the latest version of Debian_riscv.\n+\t */\n+\tif (result < 0) {\n+\t\tresult =  getCacheSize(portLibrary, query->cpu + 1, query->level, query->cacheType, query->cmd);\n+\t}\n+#endif", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNjg4MjE0Mg=="}, "originalCommit": {"oid": "673481b287e61194c96f0daa89d0e813450870fd"}, "originalPosition": 14}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 110, "cost": 1, "resetAt": "2021-11-12T13:16:51Z"}}}