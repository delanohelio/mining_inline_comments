{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDE4MjYxMzAx", "number": 9571, "title": "Replace CPU APIs on Power", "bodyText": "depends on: #9571\nSigned-off-by: Harry Yu harryyu1994@gmail.com", "createdAt": "2020-05-14T21:42:32Z", "url": "https://github.com/eclipse-openj9/openj9/pull/9571", "merged": true, "mergeCommit": {"oid": "89b56ca9e444cc86bd240eb84772c8f59a873f76"}, "closed": true, "closedAt": "2020-06-19T21:22:12Z", "author": {"login": "harryyu1994"}, "timelineItems": {"totalCount": 25, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABchZQA1ABqjMzMzkxNzE1MTc=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcsNZBngBqjM0NTQ2ODQ2NTc=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "9b61b19d3eac212dad22325c9160f9c26e2a2531", "author": {"user": {"login": "harryyu1994", "name": "Harry Yu"}}, "url": "https://github.com/eclipse-openj9/openj9/commit/9b61b19d3eac212dad22325c9160f9c26e2a2531", "committedDate": "2020-05-14T21:39:53Z", "message": "Replace CPU APIs on Power\n\nSigned-off-by: Harry Yu <harryyu1994@gmail.com>"}, "afterCommit": {"oid": "f3d0ab4d755951222e829a1aa771f2140fd13b56", "author": {"user": {"login": "harryyu1994", "name": "Harry Yu"}}, "url": "https://github.com/eclipse-openj9/openj9/commit/f3d0ab4d755951222e829a1aa771f2140fd13b56", "committedDate": "2020-05-15T03:10:18Z", "message": "Replace CPU APIs on Power\n\nSigned-off-by: Harry Yu <harryyu1994@gmail.com>"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "6bbc5c9233afbd0dd811d46de9927285a8a9c46e", "author": {"user": {"login": "harryyu1994", "name": "Harry Yu"}}, "url": "https://github.com/eclipse-openj9/openj9/commit/6bbc5c9233afbd0dd811d46de9927285a8a9c46e", "committedDate": "2020-05-15T04:12:24Z", "message": "fix"}, "afterCommit": {"oid": "fac8fd2517bec9513d8781ce9b4fefd4d376eb67", "author": {"user": {"login": "harryyu1994", "name": "Harry Yu"}}, "url": "https://github.com/eclipse-openj9/openj9/commit/fac8fd2517bec9513d8781ce9b4fefd4d376eb67", "committedDate": "2020-05-15T04:22:38Z", "message": "Replace CPU APIs on Power\n\nSigned-off-by: Harry Yu <harryyu1994@gmail.com>"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "07cd6bea893e9f56e167bee9574219cbb3fdb73e", "author": {"user": {"login": "harryyu1994", "name": "Harry Yu"}}, "url": "https://github.com/eclipse-openj9/openj9/commit/07cd6bea893e9f56e167bee9574219cbb3fdb73e", "committedDate": "2020-05-19T21:54:34Z", "message": "fix copyright"}, "afterCommit": {"oid": "2f87d233b709d1efc35d6897c3702e6b3d8a12e6", "author": {"user": {"login": "harryyu1994", "name": "Harry Yu"}}, "url": "https://github.com/eclipse-openj9/openj9/commit/2f87d233b709d1efc35d6897c3702e6b3d8a12e6", "committedDate": "2020-05-20T01:25:43Z", "message": "Replace CPU APIs on Power\n\nSigned-off-by: Harry Yu <harryyu1994@gmail.com>"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDE1Mjk0OTA3", "url": "https://github.com/eclipse-openj9/openj9/pull/9571#pullrequestreview-415294907", "createdAt": "2020-05-20T12:46:56Z", "commit": {"oid": "2f87d233b709d1efc35d6897c3702e6b3d8a12e6"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDE3MDkwMzE5", "url": "https://github.com/eclipse-openj9/openj9/pull/9571#pullrequestreview-417090319", "createdAt": "2020-05-22T17:54:06Z", "commit": {"oid": "6e51e55db5951e370649e5966d134a43c826722a"}, "state": "COMMENTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yMlQxNzo1NDowNlrOGZfXWQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yMlQxNzo1ODoyMVrOGZfeLQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyOTM4MTQ2NQ==", "bodyText": "This sequence is executed very very early. Is TR::Compiler->target already set at this point?\nAlso, there is no value in having this as a static because the code is executed exactly once.", "url": "https://github.com/eclipse-openj9/openj9/pull/9571#discussion_r429381465", "createdAt": "2020-05-22T17:54:06Z", "author": {"login": "mpirvu"}, "path": "runtime/compiler/control/DLLMain.cpp", "diffHunk": "@@ -204,8 +204,7 @@ IDATA J9VMDllMain(J9JavaVM* vm, IDATA stage, void * reserved)\n             //if disableDualTLH is specified, revert back to old semantics.\n             // Do not batch clear, JIT has to zeroinit all code on TLH.\n             //Non P6, P7 and up are allowed to batch clear however.\n-            TR_Processor ptype = TR_J9VMBase::getPPCProcessorType();\n-            static bool disableZeroedTLHPages =  disableDualTLH && (((notlhPrefetch >= 0) || (ptype != TR_PPCp6 && ptype != TR_PPCp7)));\n+            static bool disableZeroedTLHPages = disableDualTLH && (((notlhPrefetch >= 0) || (!TR::Compiler->target.cpu.is(OMR_PROCESSOR_PPC_P6) && !TR::Compiler->target.cpu.is(OMR_PROCESSOR_PPC_P7))));", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "6e51e55db5951e370649e5966d134a43c826722a"}, "originalPosition": 6}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyOTM4MzIxMw==", "bodyText": "Is there another PR that needs to be delivered first for this issue to be solved?\nIf not, what happens if we deliver this PR in this form?", "url": "https://github.com/eclipse-openj9/openj9/pull/9571#discussion_r429383213", "createdAt": "2020-05-22T17:58:21Z", "author": {"login": "mpirvu"}, "path": "runtime/compiler/control/J9Options.cpp", "diffHunk": "@@ -1809,9 +1809,10 @@ J9::Options::fePreProcess(void * base)\n #if defined(TR_HOST_X86) || defined(TR_HOST_POWER) || defined(TR_HOST_S390)\n    bool preferTLHPrefetch;\n #if defined(TR_HOST_POWER)\n-   TR_Processor proc = TR_J9VMBase::getPPCProcessorType();\n-   preferTLHPrefetch = proc >= TR_PPCp6 && proc <= TR_PPCp7;\n+   // TODO: processor id() is not initialized at this point. Once we swtich to the new api this problem will go away\n+   preferTLHPrefetch = (TR::Compiler->target.cpu.id() >= TR_PPCp6) && (TR::Compiler->target.cpu.id() <= TR_PPCp7);\n #elif defined(TR_HOST_S390)\n+   // TODO: processor arch is not initialized at this point. Once we switch to the new api this problem will go away", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "6e51e55db5951e370649e5966d134a43c826722a"}, "originalPosition": 9}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "6547faf42c6424e22011fba5d466709102111fdf", "author": {"user": {"login": "harryyu1994", "name": "Harry Yu"}}, "url": "https://github.com/eclipse-openj9/openj9/commit/6547faf42c6424e22011fba5d466709102111fdf", "committedDate": "2020-05-22T18:44:27Z", "message": "fix 3"}, "afterCommit": {"oid": "0da3d734db137cd5d2e19d8310ec68f6b9aabdab", "author": {"user": {"login": "harryyu1994", "name": "Harry Yu"}}, "url": "https://github.com/eclipse-openj9/openj9/commit/0da3d734db137cd5d2e19d8310ec68f6b9aabdab", "committedDate": "2020-05-23T03:20:11Z", "message": "Replace CPU APIs on Power\n\nSigned-off-by: Harry Yu <harryyu1994@gmail.com>"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDE4Mzc2Njc1", "url": "https://github.com/eclipse-openj9/openj9/pull/9571#pullrequestreview-418376675", "createdAt": "2020-05-26T14:49:52Z", "commit": {"oid": "0da3d734db137cd5d2e19d8310ec68f6b9aabdab"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yNlQxNDo0OTo1M1rOGah70A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yNlQxNDo1MzozNVrOGaiHKQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMDQ3MjE0NA==", "bodyText": "Does this work correctly? You seem to be setting the TR_Processor returned by id(), but then using the Port library's processor enum to perform the check...", "url": "https://github.com/eclipse-openj9/openj9/pull/9571#discussion_r430472144", "createdAt": "2020-05-26T14:49:53Z", "author": {"login": "aviansie-ben"}, "path": "runtime/compiler/control/DLLMain.cpp", "diffHunk": "@@ -204,8 +204,8 @@ IDATA J9VMDllMain(J9JavaVM* vm, IDATA stage, void * reserved)\n             //if disableDualTLH is specified, revert back to old semantics.\n             // Do not batch clear, JIT has to zeroinit all code on TLH.\n             //Non P6, P7 and up are allowed to batch clear however.\n-            TR_Processor ptype = TR_J9VMBase::getPPCProcessorType();\n-            static bool disableZeroedTLHPages =  disableDualTLH && (((notlhPrefetch >= 0) || (ptype != TR_PPCp6 && ptype != TR_PPCp7)));\n+            TR::Compiler->target.cpu.setProcessor(TR_J9VMBase::getPPCProcessorType());\n+            bool disableZeroedTLHPages = disableDualTLH && (((notlhPrefetch >= 0) || (!TR::Compiler->target.cpu.is(OMR_PROCESSOR_PPC_P6) && !TR::Compiler->target.cpu.is(OMR_PROCESSOR_PPC_P7))));", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "0da3d734db137cd5d2e19d8310ec68f6b9aabdab"}, "originalPosition": 7}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMDQ3NTA0OQ==", "bodyText": "This (and the other checks like it) look like they've always been incorrect to me. It looks like we should be checking whether we're at least POWER8 to use the mtvsr* instructions instead of whether we're exactly POWER8.\n@zl-wang Do you know if this was intentional?", "url": "https://github.com/eclipse-openj9/openj9/pull/9571#discussion_r430475049", "createdAt": "2020-05-26T14:53:35Z", "author": {"login": "aviansie-ben"}, "path": "runtime/compiler/p/codegen/DFPTreeEvaluator.cpp", "diffHunk": "@@ -109,7 +109,7 @@ static void overlapDFPOperandAndPrecisionLoad(\n       TR::CodeGenerator *cg)\n    {\n    // check for direct move\n-   bool p8DirectMoveTest = cg->comp()->target().cpu.id() == TR_PPCp8;\n+   bool p8DirectMoveTest = cg->comp()->target().cpu.is(OMR_PROCESSOR_PPC_P8);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "0da3d734db137cd5d2e19d8310ec68f6b9aabdab"}, "originalPosition": 5}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDE4NzI4NzY4", "url": "https://github.com/eclipse-openj9/openj9/pull/9571#pullrequestreview-418728768", "createdAt": "2020-05-26T22:44:16Z", "commit": {"oid": "0da3d734db137cd5d2e19d8310ec68f6b9aabdab"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "0da3d734db137cd5d2e19d8310ec68f6b9aabdab", "author": {"user": {"login": "harryyu1994", "name": "Harry Yu"}}, "url": "https://github.com/eclipse-openj9/openj9/commit/0da3d734db137cd5d2e19d8310ec68f6b9aabdab", "committedDate": "2020-05-23T03:20:11Z", "message": "Replace CPU APIs on Power\n\nSigned-off-by: Harry Yu <harryyu1994@gmail.com>"}, "afterCommit": {"oid": "66879b6e7b31ca17179b16d594a16ceaed37f591", "author": {"user": {"login": "harryyu1994", "name": "Harry Yu"}}, "url": "https://github.com/eclipse-openj9/openj9/commit/66879b6e7b31ca17179b16d594a16ceaed37f591", "committedDate": "2020-05-28T21:33:49Z", "message": "Replace CPU APIs on Power\n\nSigned-off-by: Harry Yu <harryyu1994@gmail.com>"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "66879b6e7b31ca17179b16d594a16ceaed37f591", "author": {"user": {"login": "harryyu1994", "name": "Harry Yu"}}, "url": "https://github.com/eclipse-openj9/openj9/commit/66879b6e7b31ca17179b16d594a16ceaed37f591", "committedDate": "2020-05-28T21:33:49Z", "message": "Replace CPU APIs on Power\n\nSigned-off-by: Harry Yu <harryyu1994@gmail.com>"}, "afterCommit": {"oid": "86cbc18574858b69961e2f0f5e084024fca62977", "author": {"user": {"login": "harryyu1994", "name": "Harry Yu"}}, "url": "https://github.com/eclipse-openj9/openj9/commit/86cbc18574858b69961e2f0f5e084024fca62977", "committedDate": "2020-06-06T18:58:31Z", "message": "Replace CPU APIs on Power\n\nSigned-off-by: Harry Yu <harryyu1994@gmail.com>"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "86cbc18574858b69961e2f0f5e084024fca62977", "author": {"user": {"login": "harryyu1994", "name": "Harry Yu"}}, "url": "https://github.com/eclipse-openj9/openj9/commit/86cbc18574858b69961e2f0f5e084024fca62977", "committedDate": "2020-06-06T18:58:31Z", "message": "Replace CPU APIs on Power\n\nSigned-off-by: Harry Yu <harryyu1994@gmail.com>"}, "afterCommit": {"oid": "4ec4cb99784b1a17060eaf31d0977941fee5b130", "author": {"user": {"login": "harryyu1994", "name": "Harry Yu"}}, "url": "https://github.com/eclipse-openj9/openj9/commit/4ec4cb99784b1a17060eaf31d0977941fee5b130", "committedDate": "2020-06-08T15:19:23Z", "message": "Replace CPU APIs on Power\n\nSigned-off-by: Harry Yu <harryyu1994@gmail.com>"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "4ec4cb99784b1a17060eaf31d0977941fee5b130", "author": {"user": {"login": "harryyu1994", "name": "Harry Yu"}}, "url": "https://github.com/eclipse-openj9/openj9/commit/4ec4cb99784b1a17060eaf31d0977941fee5b130", "committedDate": "2020-06-08T15:19:23Z", "message": "Replace CPU APIs on Power\n\nSigned-off-by: Harry Yu <harryyu1994@gmail.com>"}, "afterCommit": {"oid": "85498e04327ce1f5a94535ca539477319c42dafb", "author": {"user": {"login": "harryyu1994", "name": "Harry Yu"}}, "url": "https://github.com/eclipse-openj9/openj9/commit/85498e04327ce1f5a94535ca539477319c42dafb", "committedDate": "2020-06-08T15:22:37Z", "message": "Replace CPU APIs on Power\n\nSigned-off-by: Harry Yu <harryyu1994@gmail.com>"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "85498e04327ce1f5a94535ca539477319c42dafb", "author": {"user": {"login": "harryyu1994", "name": "Harry Yu"}}, "url": "https://github.com/eclipse-openj9/openj9/commit/85498e04327ce1f5a94535ca539477319c42dafb", "committedDate": "2020-06-08T15:22:37Z", "message": "Replace CPU APIs on Power\n\nSigned-off-by: Harry Yu <harryyu1994@gmail.com>"}, "afterCommit": {"oid": "a304536a58b197d48f505b9f0b75537d729e1437", "author": {"user": {"login": "harryyu1994", "name": "Harry Yu"}}, "url": "https://github.com/eclipse-openj9/openj9/commit/a304536a58b197d48f505b9f0b75537d729e1437", "committedDate": "2020-06-09T20:13:43Z", "message": "Replace CPU APIs on Power\n\nSigned-off-by: Harry Yu <harryyu1994@gmail.com>"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "a304536a58b197d48f505b9f0b75537d729e1437", "author": {"user": {"login": "harryyu1994", "name": "Harry Yu"}}, "url": "https://github.com/eclipse-openj9/openj9/commit/a304536a58b197d48f505b9f0b75537d729e1437", "committedDate": "2020-06-09T20:13:43Z", "message": "Replace CPU APIs on Power\n\nSigned-off-by: Harry Yu <harryyu1994@gmail.com>"}, "afterCommit": {"oid": "367cedd85cc2ab1a9f1036251addd677cf3eaf5b", "author": {"user": {"login": "harryyu1994", "name": "Harry Yu"}}, "url": "https://github.com/eclipse-openj9/openj9/commit/367cedd85cc2ab1a9f1036251addd677cf3eaf5b", "committedDate": "2020-06-10T18:48:09Z", "message": "Replace CPU APIs on Power\n\nSigned-off-by: Harry Yu <harryyu1994@gmail.com>"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "a18a82704c4c41d3ee09404fdc53d2d0fe6dfc0a", "author": {"user": {"login": "harryyu1994", "name": "Harry Yu"}}, "url": "https://github.com/eclipse-openj9/openj9/commit/a18a82704c4c41d3ee09404fdc53d2d0fe6dfc0a", "committedDate": "2020-06-10T18:54:03Z", "message": "Disable cpu assert tests for JITServer\n\nSigned-off-by: Harry Yu <harryyu1994@gmail.com>"}, "afterCommit": {"oid": "d2c8a0261cb8ed09d462f32c94be7db4d7f3e30c", "author": {"user": {"login": "harryyu1994", "name": "Harry Yu"}}, "url": "https://github.com/eclipse-openj9/openj9/commit/d2c8a0261cb8ed09d462f32c94be7db4d7f3e30c", "committedDate": "2020-06-10T21:00:44Z", "message": "Replace CPU APIs on Power\n\nSigned-off-by: Harry Yu <harryyu1994@gmail.com>"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "d2c8a0261cb8ed09d462f32c94be7db4d7f3e30c", "author": {"user": {"login": "harryyu1994", "name": "Harry Yu"}}, "url": "https://github.com/eclipse-openj9/openj9/commit/d2c8a0261cb8ed09d462f32c94be7db4d7f3e30c", "committedDate": "2020-06-10T21:00:44Z", "message": "Replace CPU APIs on Power\n\nSigned-off-by: Harry Yu <harryyu1994@gmail.com>"}, "afterCommit": {"oid": "84065b5cec9c545e3718226e977b3fd7f61c3abe", "author": {"user": {"login": "harryyu1994", "name": "Harry Yu"}}, "url": "https://github.com/eclipse-openj9/openj9/commit/84065b5cec9c545e3718226e977b3fd7f61c3abe", "committedDate": "2020-06-11T01:40:23Z", "message": "Replace CPU APIs on Power\n\nSigned-off-by: Harry Yu <harryyu1994@gmail.com>"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDI5MDE2NDg1", "url": "https://github.com/eclipse-openj9/openj9/pull/9571#pullrequestreview-429016485", "createdAt": "2020-06-11T15:19:15Z", "commit": {"oid": "84065b5cec9c545e3718226e977b3fd7f61c3abe"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "84065b5cec9c545e3718226e977b3fd7f61c3abe", "author": {"user": {"login": "harryyu1994", "name": "Harry Yu"}}, "url": "https://github.com/eclipse-openj9/openj9/commit/84065b5cec9c545e3718226e977b3fd7f61c3abe", "committedDate": "2020-06-11T01:40:23Z", "message": "Replace CPU APIs on Power\n\nSigned-off-by: Harry Yu <harryyu1994@gmail.com>"}, "afterCommit": {"oid": "65e8cb6ae9542e34d35f55fa843293fb6a9455ae", "author": {"user": {"login": "harryyu1994", "name": "Harry Yu"}}, "url": "https://github.com/eclipse-openj9/openj9/commit/65e8cb6ae9542e34d35f55fa843293fb6a9455ae", "committedDate": "2020-06-11T16:57:48Z", "message": "Replace CPU APIs on Power\n\nSigned-off-by: Harry Yu <harryyu1994@gmail.com>"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDMxMDg1MTEw", "url": "https://github.com/eclipse-openj9/openj9/pull/9571#pullrequestreview-431085110", "createdAt": "2020-06-16T00:46:21Z", "commit": {"oid": "65e8cb6ae9542e34d35f55fa843293fb6a9455ae"}, "state": "COMMENTED", "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xNlQwMDo0NjoyMVrOGkHauw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xNlQwMTo0OToyMVrOGkIcCw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MDUyMzQ1MQ==", "bodyText": "It's minor, just curious why we need to say (!customP4 || (customP4 && ...)) ?", "url": "https://github.com/eclipse-openj9/openj9/pull/9571#discussion_r440523451", "createdAt": "2020-06-16T00:46:21Z", "author": {"login": "gita-omr"}, "path": "runtime/compiler/runtime/Trampoline.cpp", "diffHunk": "@@ -101,7 +97,7 @@ void ppcCreateHelperTrampolines(uint8_t *trampPtr, int32_t numHelpers)\n \n             // Now, if highest bit is on we need to clear the sign extend bits on 64bit CPUs\n             // ** POWER4 pref fix **\n-            if( (helper & 0x80000000) && (!customP4 || proc == TR_PPCgp))\n+            if( (helper & 0x80000000) && (!customP4 || (customP4 && TR::comp()->target().cpu.is(OMR_PROCESSOR_PPC_GP))))", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "65e8cb6ae9542e34d35f55fa843293fb6a9455ae"}, "originalPosition": 23}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MDUyNzQwOA==", "bodyText": "The same as above re checking customP4 twice. Also, not sure the transformation is equivalent. If customP4 == false, proc = TR_DefaultPPCProcessor, which is not the same as TR_PPCgp. Which means the if() will not be true.", "url": "https://github.com/eclipse-openj9/openj9/pull/9571#discussion_r440527408", "createdAt": "2020-06-16T01:00:49Z", "author": {"login": "gita-omr"}, "path": "runtime/compiler/runtime/Trampoline.cpp", "diffHunk": "@@ -183,7 +177,7 @@ void ppcCreateMethodTrampoline(void *trampPtr, void *startPC, void *method)\n \n             // Now, if highest bit is on we need to clear the sign extend bits on 64bit CPUs\n             // ** POWER4 pref fix **\n-            if ( (dispatcher & 0x80000000) && proc == TR_PPCgp)\n+            if ( (dispatcher & 0x80000000) && (!customP4 || (customP4 && TR::comp()->target().cpu.is(OMR_PROCESSOR_PPC_GP))))", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "65e8cb6ae9542e34d35f55fa843293fb6a9455ae"}, "originalPosition": 41}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MDU0MDE3MQ==", "bodyText": "Why did we delete all other similar style methods but left this one?", "url": "https://github.com/eclipse-openj9/openj9/pull/9571#discussion_r440540171", "createdAt": "2020-06-16T01:49:21Z", "author": {"login": "gita-omr"}, "path": "runtime/compiler/p/env/J9CPU.hpp", "diffHunk": "@@ -53,16 +53,18 @@ class OMR_EXTENSIBLE CPU : public J9::CPU\n    CPU(const OMRProcessorDesc& processorDescription) : J9::CPU(processorDescription) {}\n \n public:\n-   bool getPPCSupportsVMX();\n-   bool getPPCSupportsVSX();\n-   bool getPPCSupportsAES();\n-   bool getPPCSupportsTM();\n \n-   bool hasPopulationCountInstruction();\n-   bool supportsDecimalFloatingPoint();\n+   bool supportsFeature(uint32_t feature);\n+   bool supports_feature_test(uint32_t feature);\n \n    bool isCompatible(const OMRProcessorDesc& processorDescription);\n    OMRProcessorDesc getProcessorDescription();\n+\n+   bool is(OMRProcessorArchitecture p);\n+   bool isAtLeast(OMRProcessorArchitecture p);\n+   bool isAtMost(OMRProcessorArchitecture p);\n+\n+   bool getPPCSupportsVSX();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "65e8cb6ae9542e34d35f55fa843293fb6a9455ae"}, "originalPosition": 21}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDMxODYwMTQ1", "url": "https://github.com/eclipse-openj9/openj9/pull/9571#pullrequestreview-431860145", "createdAt": "2020-06-16T20:19:28Z", "commit": {"oid": "6e89c708276264530865afffd64e68d8d11d87bf"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xNlQyMDoxOToyOFrOGkrqsw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xNlQyMDoxOToyOFrOGkrqsw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MTExNzM2Mw==", "bodyText": "Just trying to understand: why would supportsFeature be removed if you introduced calls to it in this PR?\nAlso, if supports_feature_test is only used within this class, can we make it private?", "url": "https://github.com/eclipse-openj9/openj9/pull/9571#discussion_r441117363", "createdAt": "2020-06-16T20:19:28Z", "author": {"login": "gita-omr"}, "path": "runtime/compiler/p/env/J9CPU.cpp", "diffHunk": "@@ -26,84 +26,92 @@\n #include \"j9.h\"\n #include \"j9port.h\"\n \n-\n+// supportsFeature and supports_feature_test will be removed when old_apis are no longer needed", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "6e89c708276264530865afffd64e68d8d11d87bf"}, "originalPosition": 5}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDMxODkzNzQy", "url": "https://github.com/eclipse-openj9/openj9/pull/9571#pullrequestreview-431893742", "createdAt": "2020-06-16T21:09:46Z", "commit": {"oid": "d971f5a70789e74fe7f3adeda8705ca11825e082"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c59e7d4734db673d97a8e9b2c71e66bb3d7161e2", "author": {"user": {"login": "harryyu1994", "name": "Harry Yu"}}, "url": "https://github.com/eclipse-openj9/openj9/commit/c59e7d4734db673d97a8e9b2c71e66bb3d7161e2", "committedDate": "2020-06-17T17:34:30Z", "message": "Replace CPU APIs on Power\n\nSigned-off-by: Harry Yu <harryyu1994@gmail.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "db1e26ca6b13d1c3352d85bbb2ee7e80fbaad48d", "author": {"user": {"login": "harryyu1994", "name": "Harry Yu"}}, "url": "https://github.com/eclipse-openj9/openj9/commit/db1e26ca6b13d1c3352d85bbb2ee7e80fbaad48d", "committedDate": "2020-06-17T17:34:37Z", "message": "Clean up runtime/Trampoline.cpp\n\nSigned-off-by: Harry Yu <harryyu1994@gmail.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "dbc5a34bcce160a6ddf47459cd5b641417f4fb27", "author": {"user": {"login": "harryyu1994", "name": "Harry Yu"}}, "url": "https://github.com/eclipse-openj9/openj9/commit/dbc5a34bcce160a6ddf47459cd5b641417f4fb27", "committedDate": "2020-06-17T17:34:37Z", "message": "Make supports_feature_test private\n\nSigned-off-by: Harry Yu <harryyu1994@gmail.com>"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "d971f5a70789e74fe7f3adeda8705ca11825e082", "author": {"user": {"login": "harryyu1994", "name": "Harry Yu"}}, "url": "https://github.com/eclipse-openj9/openj9/commit/d971f5a70789e74fe7f3adeda8705ca11825e082", "committedDate": "2020-06-16T20:30:38Z", "message": "Make supports_feature_test private\n\nSigned-off-by: Harry Yu <harryyu1994@gmail.com>"}, "afterCommit": {"oid": "dbc5a34bcce160a6ddf47459cd5b641417f4fb27", "author": {"user": {"login": "harryyu1994", "name": "Harry Yu"}}, "url": "https://github.com/eclipse-openj9/openj9/commit/dbc5a34bcce160a6ddf47459cd5b641417f4fb27", "committedDate": "2020-06-17T17:34:37Z", "message": "Make supports_feature_test private\n\nSigned-off-by: Harry Yu <harryyu1994@gmail.com>"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 938, "cost": 1, "resetAt": "2021-10-28T17:48:14Z"}}}