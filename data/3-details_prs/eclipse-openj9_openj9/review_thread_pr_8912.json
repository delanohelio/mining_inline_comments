{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0MzkwNzM0NDM5", "number": 8912, "reviewThreads": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xOVQxNDowMjoxNFrODphT4A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xOVQxNDowMzozN1rODphWQQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjQ0ODYzOTY4OnYy", "diffSide": "RIGHT", "path": "runtime/j9vm/jvm.c", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xOVQxNDowMjoxNVrOF4vzJA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xOVQxNDo0Mzo1NlrOF4xwRw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NTA0NzcxNg==", "bodyText": "After entering the VM, you will certainly have VM access, so there's no need to test here.", "url": "https://github.com/eclipse-openj9/openj9/pull/8912#discussion_r395047716", "createdAt": "2020-03-19T14:02:15Z", "author": {"login": "gacholio"}, "path": "runtime/j9vm/jvm.c", "diffHunk": "@@ -3589,13 +3589,24 @@ JVM_LoadLibrary(const char* libName)\n \tJ9JavaVM* javaVM = (J9JavaVM*)BFUjavaVM;\n \tJ9InternalVMFunctions* vmFuncs = javaVM->internalVMFunctions;\n \tJ9VMThread* currentThread = vmFuncs->currentVMThread(javaVM);\n+\tUDATA flagVMAccess = 0;\n \n-\tTrc_SC_LoadLibrary_Entry(libName);\n+\tTrc_SC_LoadLibrary_Entry(currentThread, libName);\n+\tvmFuncs->internalEnterVMFromJNI(currentThread);\n+\tflagVMAccess = currentThread->publicFlags & J9_PUBLIC_FLAGS_VM_ACCESS;\n+\tTrc_SC_LoadLibrary_FlagVMAccess(currentThread, flagVMAccess);\n+\tif (0 != flagVMAccess) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ee489697ccb944cc9d9a18800c2e27eb633dd7c8"}, "originalPosition": 11}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NTA3OTc1MQ==", "bodyText": "Removed the flag and check.", "url": "https://github.com/eclipse-openj9/openj9/pull/8912#discussion_r395079751", "createdAt": "2020-03-19T14:43:56Z", "author": {"login": "JasonFengJ9"}, "path": "runtime/j9vm/jvm.c", "diffHunk": "@@ -3589,13 +3589,24 @@ JVM_LoadLibrary(const char* libName)\n \tJ9JavaVM* javaVM = (J9JavaVM*)BFUjavaVM;\n \tJ9InternalVMFunctions* vmFuncs = javaVM->internalVMFunctions;\n \tJ9VMThread* currentThread = vmFuncs->currentVMThread(javaVM);\n+\tUDATA flagVMAccess = 0;\n \n-\tTrc_SC_LoadLibrary_Entry(libName);\n+\tTrc_SC_LoadLibrary_Entry(currentThread, libName);\n+\tvmFuncs->internalEnterVMFromJNI(currentThread);\n+\tflagVMAccess = currentThread->publicFlags & J9_PUBLIC_FLAGS_VM_ACCESS;\n+\tTrc_SC_LoadLibrary_FlagVMAccess(currentThread, flagVMAccess);\n+\tif (0 != flagVMAccess) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NTA0NzcxNg=="}, "originalCommit": {"oid": "ee489697ccb944cc9d9a18800c2e27eb633dd7c8"}, "originalPosition": 11}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjQ0ODY0Mzg3OnYy", "diffSide": "RIGHT", "path": "runtime/j9vm/jvm.c", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xOVQxNDowMzowN1rOF4v1zA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xOVQxNDo0NjoxNlrOF4x3AA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NTA0ODM5Ng==", "bodyText": "I thought we weren't supposed to change tracepoint parameters. Given how infrequently this code will be used, I suggest leaving them as noEnv.", "url": "https://github.com/eclipse-openj9/openj9/pull/8912#discussion_r395048396", "createdAt": "2020-03-19T14:03:07Z", "author": {"login": "gacholio"}, "path": "runtime/j9vm/jvm.c", "diffHunk": "@@ -3589,13 +3589,24 @@ JVM_LoadLibrary(const char* libName)\n \tJ9JavaVM* javaVM = (J9JavaVM*)BFUjavaVM;\n \tJ9InternalVMFunctions* vmFuncs = javaVM->internalVMFunctions;\n \tJ9VMThread* currentThread = vmFuncs->currentVMThread(javaVM);\n+\tUDATA flagVMAccess = 0;\n \n-\tTrc_SC_LoadLibrary_Entry(libName);\n+\tTrc_SC_LoadLibrary_Entry(currentThread, libName);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ee489697ccb944cc9d9a18800c2e27eb633dd7c8"}, "originalPosition": 7}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NTA4MTQ3Mg==", "bodyText": "A new tracepoint is required if there is a signature change such as the types, order and total number of format specifiers in the Template.\nChanges to the Tracepoint Type, Overhead, Level and NoEnv parameters, and cosmetic changes to the text in the Template can be made without adding a new tracepoint.\nAgreed that this is not a hot path, leaving them as noEnv.", "url": "https://github.com/eclipse-openj9/openj9/pull/8912#discussion_r395081472", "createdAt": "2020-03-19T14:46:16Z", "author": {"login": "JasonFengJ9"}, "path": "runtime/j9vm/jvm.c", "diffHunk": "@@ -3589,13 +3589,24 @@ JVM_LoadLibrary(const char* libName)\n \tJ9JavaVM* javaVM = (J9JavaVM*)BFUjavaVM;\n \tJ9InternalVMFunctions* vmFuncs = javaVM->internalVMFunctions;\n \tJ9VMThread* currentThread = vmFuncs->currentVMThread(javaVM);\n+\tUDATA flagVMAccess = 0;\n \n-\tTrc_SC_LoadLibrary_Entry(libName);\n+\tTrc_SC_LoadLibrary_Entry(currentThread, libName);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NTA0ODM5Ng=="}, "originalCommit": {"oid": "ee489697ccb944cc9d9a18800c2e27eb633dd7c8"}, "originalPosition": 7}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjQ0ODY0NTc3OnYy", "diffSide": "RIGHT", "path": "runtime/j9vm/jvm.c", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xOVQxNDowMzozN1rOF4v3Eg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xOVQxNDo0NzowMVrOF4x5AQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NTA0ODcyMg==", "bodyText": "No need to acquire here - exit will work regardless.", "url": "https://github.com/eclipse-openj9/openj9/pull/8912#discussion_r395048722", "createdAt": "2020-03-19T14:03:37Z", "author": {"login": "gacholio"}, "path": "runtime/j9vm/jvm.c", "diffHunk": "@@ -3589,13 +3589,24 @@ JVM_LoadLibrary(const char* libName)\n \tJ9JavaVM* javaVM = (J9JavaVM*)BFUjavaVM;\n \tJ9InternalVMFunctions* vmFuncs = javaVM->internalVMFunctions;\n \tJ9VMThread* currentThread = vmFuncs->currentVMThread(javaVM);\n+\tUDATA flagVMAccess = 0;\n \n-\tTrc_SC_LoadLibrary_Entry(libName);\n+\tTrc_SC_LoadLibrary_Entry(currentThread, libName);\n+\tvmFuncs->internalEnterVMFromJNI(currentThread);\n+\tflagVMAccess = currentThread->publicFlags & J9_PUBLIC_FLAGS_VM_ACCESS;\n+\tTrc_SC_LoadLibrary_FlagVMAccess(currentThread, flagVMAccess);\n+\tif (0 != flagVMAccess) {\n+\t\tvmFuncs->internalReleaseVMAccess(currentThread);\n+\t}\n \tif (vmFuncs->registerBootstrapLibrary(currentThread, libName, &nativeLibrary, FALSE) == J9NATIVELIB_LOAD_OK) {\n \t\tresult = (void*)nativeLibrary->handle;\n \t}\n+\tif (0 != flagVMAccess) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ee489697ccb944cc9d9a18800c2e27eb633dd7c8"}, "originalPosition": 17}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NTA4MTk4NQ==", "bodyText": "Removed the VM access acquiring.\nPlease have another look.", "url": "https://github.com/eclipse-openj9/openj9/pull/8912#discussion_r395081985", "createdAt": "2020-03-19T14:47:01Z", "author": {"login": "JasonFengJ9"}, "path": "runtime/j9vm/jvm.c", "diffHunk": "@@ -3589,13 +3589,24 @@ JVM_LoadLibrary(const char* libName)\n \tJ9JavaVM* javaVM = (J9JavaVM*)BFUjavaVM;\n \tJ9InternalVMFunctions* vmFuncs = javaVM->internalVMFunctions;\n \tJ9VMThread* currentThread = vmFuncs->currentVMThread(javaVM);\n+\tUDATA flagVMAccess = 0;\n \n-\tTrc_SC_LoadLibrary_Entry(libName);\n+\tTrc_SC_LoadLibrary_Entry(currentThread, libName);\n+\tvmFuncs->internalEnterVMFromJNI(currentThread);\n+\tflagVMAccess = currentThread->publicFlags & J9_PUBLIC_FLAGS_VM_ACCESS;\n+\tTrc_SC_LoadLibrary_FlagVMAccess(currentThread, flagVMAccess);\n+\tif (0 != flagVMAccess) {\n+\t\tvmFuncs->internalReleaseVMAccess(currentThread);\n+\t}\n \tif (vmFuncs->registerBootstrapLibrary(currentThread, libName, &nativeLibrary, FALSE) == J9NATIVELIB_LOAD_OK) {\n \t\tresult = (void*)nativeLibrary->handle;\n \t}\n+\tif (0 != flagVMAccess) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NTA0ODcyMg=="}, "originalCommit": {"oid": "ee489697ccb944cc9d9a18800c2e27eb633dd7c8"}, "originalPosition": 17}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 565, "cost": 1, "resetAt": "2021-11-12T13:16:51Z"}}}