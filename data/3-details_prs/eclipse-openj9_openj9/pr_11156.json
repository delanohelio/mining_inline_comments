{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTE5NDU0NDY5", "number": 11156, "title": "Convert the property value from the platform encoding to MUTF8 string", "bodyText": "The change is to convert the property value string from the platform\nencoding to the modified UTF8 to adapt to the OS locale setting.\nFixes: #11139\nSigned-off-by: Cheng Jin jincheng@ca.ibm.com", "createdAt": "2020-11-11T21:14:11Z", "url": "https://github.com/eclipse-openj9/openj9/pull/11156", "merged": true, "mergeCommit": {"oid": "d903b2b698e6e5f90ba554dae07a448d3bd3f3a8"}, "closed": true, "closedAt": "2020-11-12T16:08:54Z", "author": {"login": "ChengJin01"}, "timelineItems": {"totalCount": 16, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdbk9o9AFqTUyODU1Mjc5MA==", "endCursor": "Y3Vyc29yOnYyOpPPAAABdb03GJAFqTUyOTI0NDcwNg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTI4NTUyNzkw", "url": "https://github.com/eclipse-openj9/openj9/pull/11156#pullrequestreview-528552790", "createdAt": "2020-11-11T21:37:05Z", "commit": {"oid": "8fc5773e427a2df3f8afb9392694e3a0545ce4d8"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xMVQyMTozNzowNVrOHxfLcA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xMVQyMTozNzowNVrOHxfLcA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMTY1MzEwNA==", "bodyText": "This is incorrect - should be pool_removeElement.", "url": "https://github.com/eclipse-openj9/openj9/pull/11156#discussion_r521653104", "createdAt": "2020-11-11T21:37:05Z", "author": {"login": "gacholio"}, "path": "runtime/vm/vmprops.c", "diffHunk": "@@ -1040,13 +1040,22 @@ getJ9VMVersionString(J9JavaVM *vm) {\n UDATA\n addSystemProperty(J9JavaVM * vm, const char* propName,  const char* propValue, UDATA flags)\n {\n+\tchar *convertedPropValue = NULL;\n \tJ9VMSystemProperty* newProp = pool_newElement(vm->systemProperties);\n \tif (NULL == newProp) {\n \t\treturn J9SYSPROP_ERROR_OUT_OF_MEMORY;\n \t}\n \n+\t/* Convert the value string from the platform encoding to the modified UTF8 */\n+\tconvertedPropValue = (char *)getMUtf8String(vm, propValue, strlen(propValue));\n+\tif (NULL == convertedPropValue) {\n+\t\tPORT_ACCESS_FROM_JAVAVM(vm);\n+\t\tj9mem_free_memory(newProp);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "8fc5773e427a2df3f8afb9392694e3a0545ce4d8"}, "originalPosition": 21}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTI4NTUzMDM4", "url": "https://github.com/eclipse-openj9/openj9/pull/11156#pullrequestreview-528553038", "createdAt": "2020-11-11T21:37:27Z", "commit": {"oid": "8fc5773e427a2df3f8afb9392694e3a0545ce4d8"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xMVQyMTozNzoyOFrOHxfMdw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xMVQyMTozNzoyOFrOHxfMdw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMTY1MzM2Nw==", "bodyText": "This is going to be a little trickier. Sometimes the arguments to addSystemProperty() are already converted to utf8.\nSee https://github.com/eclipse/openj9/blob/master/runtime/vm/vmprops.c#L856-L861\nand https://github.com/eclipse/openj9/blob/master/runtime/vm/vmprops.c#L907\nEither the callers of addSystemProperty() need to pass in a new argument to indicate the value should be converted, or the conversion needs to be done elsewhere before addSystemProperty() is called.", "url": "https://github.com/eclipse-openj9/openj9/pull/11156#discussion_r521653367", "createdAt": "2020-11-11T21:37:28Z", "author": {"login": "pshipton"}, "path": "runtime/vm/vmprops.c", "diffHunk": "@@ -1040,13 +1040,22 @@ getJ9VMVersionString(J9JavaVM *vm) {\n UDATA\n addSystemProperty(J9JavaVM * vm, const char* propName,  const char* propValue, UDATA flags)\n {\n+\tchar *convertedPropValue = NULL;\n \tJ9VMSystemProperty* newProp = pool_newElement(vm->systemProperties);\n \tif (NULL == newProp) {\n \t\treturn J9SYSPROP_ERROR_OUT_OF_MEMORY;\n \t}\n \n+\t/* Convert the value string from the platform encoding to the modified UTF8 */\n+\tconvertedPropValue = (char *)getMUtf8String(vm, propValue, strlen(propValue));", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "8fc5773e427a2df3f8afb9392694e3a0545ce4d8"}, "originalPosition": 18}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "8fc5773e427a2df3f8afb9392694e3a0545ce4d8", "author": {"user": {"login": "ChengJin01", "name": "Cheng Jin"}}, "url": "https://github.com/eclipse-openj9/openj9/commit/8fc5773e427a2df3f8afb9392694e3a0545ce4d8", "committedDate": "2020-11-11T21:09:29Z", "message": "Convert the property value from the platform encoding to MUTF8 string\n\nThe change is to convert the property value string from the platform\nencoding to the modified UTF8 to adapt to the OS locale setting.\n\nFixes: #11139\n\nSigned-off-by: Cheng Jin <jincheng@ca.ibm.com>"}, "afterCommit": {"oid": "30329871ee1a60edf626ffa8e542638851913045", "author": {"user": {"login": "ChengJin01", "name": "Cheng Jin"}}, "url": "https://github.com/eclipse-openj9/openj9/commit/30329871ee1a60edf626ffa8e542638851913045", "committedDate": "2020-11-11T22:15:02Z", "message": "Convert the property value from the platform encoding to MUTF8 string\n\nThe change is to convert the property value string from the platform\nencoding to the modified UTF8 to adapt to the OS locale setting.\n\nFixes: #11139\n\nSigned-off-by: Cheng Jin <jincheng@ca.ibm.com>"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTI4NTkzNzE3", "url": "https://github.com/eclipse-openj9/openj9/pull/11156#pullrequestreview-528593717", "createdAt": "2020-11-11T22:53:35Z", "commit": {"oid": "30329871ee1a60edf626ffa8e542638851913045"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xMVQyMjo1MzozNVrOHxhOEg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xMVQyMjo1MzozNVrOHxhOEg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMTY4NjU0Ng==", "bodyText": "The places that use this need to pass the J9SYSPROP_FLAG_VALUE_ALLOCATED flag to addSystemProperty() so the memory is freed.", "url": "https://github.com/eclipse-openj9/openj9/pull/11156#discussion_r521686546", "createdAt": "2020-11-11T22:53:35Z", "author": {"login": "pshipton"}, "path": "runtime/vm/vmprops.c", "diffHunk": "@@ -152,6 +152,11 @@ getOptionArg(J9JavaVM *vm, IDATA argIndex, UDATA optionNameLen)\n \t}\n \n _end:\n+\tif (NULL != optionArg) {\n+\t\t/* Convert the value string from the platform encoding to the modified UTF8 */\n+\t\toptionArg = (char *)getMUtf8String(vm, optionArg, strlen(optionArg));", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "30329871ee1a60edf626ffa8e542638851913045"}, "originalPosition": 13}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "30329871ee1a60edf626ffa8e542638851913045", "author": {"user": {"login": "ChengJin01", "name": "Cheng Jin"}}, "url": "https://github.com/eclipse-openj9/openj9/commit/30329871ee1a60edf626ffa8e542638851913045", "committedDate": "2020-11-11T22:15:02Z", "message": "Convert the property value from the platform encoding to MUTF8 string\n\nThe change is to convert the property value string from the platform\nencoding to the modified UTF8 to adapt to the OS locale setting.\n\nFixes: #11139\n\nSigned-off-by: Cheng Jin <jincheng@ca.ibm.com>"}, "afterCommit": {"oid": "96784bbac3e5bc47e3d5ce369403492bc1cc9573", "author": {"user": {"login": "ChengJin01", "name": "Cheng Jin"}}, "url": "https://github.com/eclipse-openj9/openj9/commit/96784bbac3e5bc47e3d5ce369403492bc1cc9573", "committedDate": "2020-11-11T23:09:34Z", "message": "Convert the property value from the platform encoding to MUTF8 string\n\nThe change is to convert the property value string from the platform\nencoding to the modified UTF8 to adapt to the OS locale setting.\n\nFixes: #11139\n\nSigned-off-by: Cheng Jin <jincheng@ca.ibm.com>"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "96784bbac3e5bc47e3d5ce369403492bc1cc9573", "author": {"user": {"login": "ChengJin01", "name": "Cheng Jin"}}, "url": "https://github.com/eclipse-openj9/openj9/commit/96784bbac3e5bc47e3d5ce369403492bc1cc9573", "committedDate": "2020-11-11T23:09:34Z", "message": "Convert the property value from the platform encoding to MUTF8 string\n\nThe change is to convert the property value string from the platform\nencoding to the modified UTF8 to adapt to the OS locale setting.\n\nFixes: #11139\n\nSigned-off-by: Cheng Jin <jincheng@ca.ibm.com>"}, "afterCommit": {"oid": "be15e82436188b0c87dbb989d38e8377a9dedb58", "author": {"user": {"login": "ChengJin01", "name": "Cheng Jin"}}, "url": "https://github.com/eclipse-openj9/openj9/commit/be15e82436188b0c87dbb989d38e8377a9dedb58", "committedDate": "2020-11-11T23:38:29Z", "message": "Convert the property value from the platform encoding to MUTF8 string\n\nThe change is to convert the property value string from the platform\nencoding to the modified UTF8 to adapt to the OS locale setting.\n\nFixes: #11139\n\nSigned-off-by: Cheng Jin <jincheng@ca.ibm.com>"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "be15e82436188b0c87dbb989d38e8377a9dedb58", "author": {"user": {"login": "ChengJin01", "name": "Cheng Jin"}}, "url": "https://github.com/eclipse-openj9/openj9/commit/be15e82436188b0c87dbb989d38e8377a9dedb58", "committedDate": "2020-11-11T23:38:29Z", "message": "Convert the property value from the platform encoding to MUTF8 string\n\nThe change is to convert the property value string from the platform\nencoding to the modified UTF8 to adapt to the OS locale setting.\n\nFixes: #11139\n\nSigned-off-by: Cheng Jin <jincheng@ca.ibm.com>"}, "afterCommit": {"oid": "7b2e824030689adfa86045ba633c9b28b27fea9b", "author": {"user": {"login": "ChengJin01", "name": "Cheng Jin"}}, "url": "https://github.com/eclipse-openj9/openj9/commit/7b2e824030689adfa86045ba633c9b28b27fea9b", "committedDate": "2020-11-11T23:48:43Z", "message": "Convert the property value from the platform encoding to MUTF8 string\n\nThe change is to convert the property value string from the platform\nencoding to the modified UTF8 to adapt to the OS locale setting.\n\nFixes: #11139\n\nSigned-off-by: Cheng Jin <jincheng@ca.ibm.com>"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTI4NjM2NjA5", "url": "https://github.com/eclipse-openj9/openj9/pull/11156#pullrequestreview-528636609", "createdAt": "2020-11-11T23:52:00Z", "commit": {"oid": "7b2e824030689adfa86045ba633c9b28b27fea9b"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xMVQyMzo1MjowMFrOHxir4g==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xMVQyMzo1MjowMFrOHxir4g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMTcxMDU2Mg==", "bodyText": "Above there is a case that does goto _end which needs to free optionArg", "url": "https://github.com/eclipse-openj9/openj9/pull/11156#discussion_r521710562", "createdAt": "2020-11-11T23:52:00Z", "author": {"login": "pshipton"}, "path": "runtime/vm/vmprops.c", "diffHunk": "@@ -309,6 +316,8 @@ addPropertyForOptionWithModuleListArg(J9JavaVM *vm, const char *optionName, IDAT\n \t\t\t\t\t}\n \t\t\t\t}\n \t\t\t\tCONSUME_ARG(j9vm_args, argIndex);\n+\n+\t\t\t\tj9mem_free_memory(optionArg);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "7b2e824030689adfa86045ba633c9b28b27fea9b"}, "originalPosition": 44}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "7b2e824030689adfa86045ba633c9b28b27fea9b", "author": {"user": {"login": "ChengJin01", "name": "Cheng Jin"}}, "url": "https://github.com/eclipse-openj9/openj9/commit/7b2e824030689adfa86045ba633c9b28b27fea9b", "committedDate": "2020-11-11T23:48:43Z", "message": "Convert the property value from the platform encoding to MUTF8 string\n\nThe change is to convert the property value string from the platform\nencoding to the modified UTF8 to adapt to the OS locale setting.\n\nFixes: #11139\n\nSigned-off-by: Cheng Jin <jincheng@ca.ibm.com>"}, "afterCommit": {"oid": "ae8da52d92f15640045fe29ba9290fea1854d4e7", "author": {"user": {"login": "ChengJin01", "name": "Cheng Jin"}}, "url": "https://github.com/eclipse-openj9/openj9/commit/ae8da52d92f15640045fe29ba9290fea1854d4e7", "committedDate": "2020-11-12T00:01:18Z", "message": "Convert the property value from the platform encoding to MUTF8 string\n\nThe change is to convert the property value string from the platform\nencoding to the modified UTF8 to adapt to the OS locale setting.\n\nFixes: #11139\n\nSigned-off-by: Cheng Jin <jincheng@ca.ibm.com>"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "ae8da52d92f15640045fe29ba9290fea1854d4e7", "author": {"user": {"login": "ChengJin01", "name": "Cheng Jin"}}, "url": "https://github.com/eclipse-openj9/openj9/commit/ae8da52d92f15640045fe29ba9290fea1854d4e7", "committedDate": "2020-11-12T00:01:18Z", "message": "Convert the property value from the platform encoding to MUTF8 string\n\nThe change is to convert the property value string from the platform\nencoding to the modified UTF8 to adapt to the OS locale setting.\n\nFixes: #11139\n\nSigned-off-by: Cheng Jin <jincheng@ca.ibm.com>"}, "afterCommit": {"oid": "0c59946fdbc16ad2ac90c0a476c45b253b2edad1", "author": {"user": {"login": "ChengJin01", "name": "Cheng Jin"}}, "url": "https://github.com/eclipse-openj9/openj9/commit/0c59946fdbc16ad2ac90c0a476c45b253b2edad1", "committedDate": "2020-11-12T00:03:08Z", "message": "Convert the property value from the platform encoding to MUTF8 string\n\nThe change is to convert the property value string from the platform\nencoding to the modified UTF8 to adapt to the OS locale setting.\n\nFixes: #11139\n\nSigned-off-by: Cheng Jin <jincheng@ca.ibm.com>"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTI4NjU2NDAz", "url": "https://github.com/eclipse-openj9/openj9/pull/11156#pullrequestreview-528656403", "createdAt": "2020-11-12T00:45:56Z", "commit": {"oid": "0c59946fdbc16ad2ac90c0a476c45b253b2edad1"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xMlQwMDo0NTo1NlrOHxklrg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xMlQwMDo0NTo1NlrOHxklrg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMTc0MTc0Mg==", "bodyText": "There are 4 places calling this, why only comment one of them?", "url": "https://github.com/eclipse-openj9/openj9/pull/11156#discussion_r521741742", "createdAt": "2020-11-12T00:45:56Z", "author": {"login": "pshipton"}, "path": "runtime/vm/vmprops.c", "diffHunk": "@@ -370,6 +381,7 @@ addPropertiesForOptionWithAssignArg(J9JavaVM *vm, const char *optionName, UDATA\n \t\tUDATA indexLen = 1;\n \n \t\tdo {\n+\t\t\t/* The allocated return value for optionArg needs to be freed after use */", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "0c59946fdbc16ad2ac90c0a476c45b253b2edad1"}, "originalPosition": 67}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "0c59946fdbc16ad2ac90c0a476c45b253b2edad1", "author": {"user": {"login": "ChengJin01", "name": "Cheng Jin"}}, "url": "https://github.com/eclipse-openj9/openj9/commit/0c59946fdbc16ad2ac90c0a476c45b253b2edad1", "committedDate": "2020-11-12T00:03:08Z", "message": "Convert the property value from the platform encoding to MUTF8 string\n\nThe change is to convert the property value string from the platform\nencoding to the modified UTF8 to adapt to the OS locale setting.\n\nFixes: #11139\n\nSigned-off-by: Cheng Jin <jincheng@ca.ibm.com>"}, "afterCommit": {"oid": "00742e1656ee8b67a97eb4720cb30bfc65efff58", "author": {"user": {"login": "ChengJin01", "name": "Cheng Jin"}}, "url": "https://github.com/eclipse-openj9/openj9/commit/00742e1656ee8b67a97eb4720cb30bfc65efff58", "committedDate": "2020-11-12T01:01:41Z", "message": "Convert the property value from the platform encoding to MUTF8 string\n\nThe change is to convert the property value string from the platform\nencoding to the modified UTF8 to adapt to the OS locale setting.\n\nFixes: #11139\n\nSigned-off-by: Cheng Jin <jincheng@ca.ibm.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a1828265d4db88473cf2283e84a2a3661bfe7c5f", "author": {"user": {"login": "ChengJin01", "name": "Cheng Jin"}}, "url": "https://github.com/eclipse-openj9/openj9/commit/a1828265d4db88473cf2283e84a2a3661bfe7c5f", "committedDate": "2020-11-12T01:04:45Z", "message": "Convert the property value from the platform encoding to MUTF8 string\n\nThe change is to convert the property value string from the platform\nencoding to the modified UTF8 to adapt to the OS locale setting.\n\nFixes: #11139\n\nSigned-off-by: Cheng Jin <jincheng@ca.ibm.com>"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "00742e1656ee8b67a97eb4720cb30bfc65efff58", "author": {"user": {"login": "ChengJin01", "name": "Cheng Jin"}}, "url": "https://github.com/eclipse-openj9/openj9/commit/00742e1656ee8b67a97eb4720cb30bfc65efff58", "committedDate": "2020-11-12T01:01:41Z", "message": "Convert the property value from the platform encoding to MUTF8 string\n\nThe change is to convert the property value string from the platform\nencoding to the modified UTF8 to adapt to the OS locale setting.\n\nFixes: #11139\n\nSigned-off-by: Cheng Jin <jincheng@ca.ibm.com>"}, "afterCommit": {"oid": "a1828265d4db88473cf2283e84a2a3661bfe7c5f", "author": {"user": {"login": "ChengJin01", "name": "Cheng Jin"}}, "url": "https://github.com/eclipse-openj9/openj9/commit/a1828265d4db88473cf2283e84a2a3661bfe7c5f", "committedDate": "2020-11-12T01:04:45Z", "message": "Convert the property value from the platform encoding to MUTF8 string\n\nThe change is to convert the property value string from the platform\nencoding to the modified UTF8 to adapt to the OS locale setting.\n\nFixes: #11139\n\nSigned-off-by: Cheng Jin <jincheng@ca.ibm.com>"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTI5MjM3NDMx", "url": "https://github.com/eclipse-openj9/openj9/pull/11156#pullrequestreview-529237431", "createdAt": "2020-11-12T16:01:11Z", "commit": {"oid": "a1828265d4db88473cf2283e84a2a3661bfe7c5f"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTI5MjQ0NzA2", "url": "https://github.com/eclipse-openj9/openj9/pull/11156#pullrequestreview-529244706", "createdAt": "2020-11-12T16:08:26Z", "commit": {"oid": "a1828265d4db88473cf2283e84a2a3661bfe7c5f"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1541, "cost": 1, "resetAt": "2021-10-28T17:48:14Z"}}}