{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDI2ODI4MzY5", "number": 9775, "title": "Enable using Level 1 data cache on RISC-V specific hardware", "bodyText": "The change is to enable the L1 data cache (no support\non the emulator) on the hardware to ensure it works\nappropriately after setup.\nSigned-off-by: Cheng Jin jincheng@ca.ibm.com", "createdAt": "2020-06-02T21:02:53Z", "url": "https://github.com/eclipse-openj9/openj9/pull/9775", "merged": true, "mergeCommit": {"oid": "18583121a2f8369efe240aa83fdeaaa7a4e068ff"}, "closed": true, "closedAt": "2020-06-09T00:13:17Z", "author": {"login": "ChengJin01"}, "timelineItems": {"totalCount": 8, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcocW1QABqjM0MTM4MzcwMDA=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcpZr3ZgFqTQyNjcwNDcwMw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "98e349b2e89af64f203f7886ae7e05f9f3033ff0", "author": {"user": {"login": "ChengJin01", "name": "Cheng Jin"}}, "url": "https://github.com/eclipse-openj9/openj9/commit/98e349b2e89af64f203f7886ae7e05f9f3033ff0", "committedDate": "2020-06-01T18:53:51Z", "message": "Enable using L1 data cache on RISC-V specific hardware\n\nThe change is to enable the L1 data cache (no support\non the emulator) on the hardware to ensure it works\nappropriately after setup.\n\nSigned-off-by: Cheng Jin <jincheng@ca.ibm.com>"}, "afterCommit": {"oid": "390648f90b43c35d82ff36b4763c487358972945", "author": {"user": {"login": "ChengJin01", "name": "Cheng Jin"}}, "url": "https://github.com/eclipse-openj9/openj9/commit/390648f90b43c35d82ff36b4763c487358972945", "committedDate": "2020-06-06T00:45:06Z", "message": "Enable using L1 data cache on RISC-V specific hardware\n\nThe change is to enable the L1 data cache (no support\non the emulator) on the hardware to ensure it works\nappropriately after setup.\n\nSigned-off-by: Cheng Jin <jincheng@ca.ibm.com>"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "390648f90b43c35d82ff36b4763c487358972945", "author": {"user": {"login": "ChengJin01", "name": "Cheng Jin"}}, "url": "https://github.com/eclipse-openj9/openj9/commit/390648f90b43c35d82ff36b4763c487358972945", "committedDate": "2020-06-06T00:45:06Z", "message": "Enable using L1 data cache on RISC-V specific hardware\n\nThe change is to enable the L1 data cache (no support\non the emulator) on the hardware to ensure it works\nappropriately after setup.\n\nSigned-off-by: Cheng Jin <jincheng@ca.ibm.com>"}, "afterCommit": {"oid": "4b2c869e0662aa576fa6840859752f56b8165b31", "author": {"user": {"login": "ChengJin01", "name": "Cheng Jin"}}, "url": "https://github.com/eclipse-openj9/openj9/commit/4b2c869e0662aa576fa6840859752f56b8165b31", "committedDate": "2020-06-08T17:24:20Z", "message": "Enable using L1 data cache on RISC-V specific hardware\n\nThe change is to enable the L1 data cache (no support\non the emulator) on the hardware to ensure it works\nappropriately after setup.\n\nSigned-off-by: Cheng Jin <jincheng@ca.ibm.com>"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDI2NDYwOTUw", "url": "https://github.com/eclipse-openj9/openj9/pull/9775#pullrequestreview-426460950", "createdAt": "2020-06-08T17:28:45Z", "commit": {"oid": "4b2c869e0662aa576fa6840859752f56b8165b31"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wOFQxNzoyODo0NlrOGgosvw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wOFQxNzozMDoyMlrOGgowkA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNjg3NDQzMQ==", "bodyText": "Please add comments here and on #endif: /* defined(RISCV64) */.", "url": "https://github.com/eclipse-openj9/openj9/pull/9775#discussion_r436874431", "createdAt": "2020-06-08T17:28:46Z", "author": {"login": "keithc-ca"}, "path": "runtime/tests/port/si.c", "diffHunk": "@@ -2183,9 +2183,17 @@ j9sysinfo_test_get_l1dcache_line_size(struct J9PortLibrary *portLibrary)\n \tcQuery.level = 1;\n \tcQuery.cacheType = J9PORT_CACHEINFO_DCACHE;\n \trc = j9sysinfo_get_cache_info(&cQuery);\n-#if !(defined(J9ARM) || defined(RISCV64))\n+#if !(defined(J9ARM))\n \tif (rc < 0) {\n+#if defined(RISCV64)\n+\t\toutputComment(PORTLIB, \"j9sysinfo_get_cache_info is not supported on this platform\\n\");\n+\t\tif (J9PORT_ERROR_SYSINFO_NOT_SUPPORTED != rc) {\n+\t\t\toutputErrorMessage(PORTTEST_ERROR_ARGS, \"j9sysinfo_get_cache_info should have returned %d but returned %d\\n\", \n+\t\t\t\tJ9PORT_ERROR_SYSINFO_NOT_SUPPORTED, rc);\n+\t\t}\n+#else", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "4b2c869e0662aa576fa6840859752f56b8165b31"}, "originalPosition": 13}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNjg3NDY0OQ==", "bodyText": "Please remove the unnecessary pareentheses.", "url": "https://github.com/eclipse-openj9/openj9/pull/9775#discussion_r436874649", "createdAt": "2020-06-08T17:29:07Z", "author": {"login": "keithc-ca"}, "path": "runtime/tests/port/si.c", "diffHunk": "@@ -2183,9 +2183,17 @@ j9sysinfo_test_get_l1dcache_line_size(struct J9PortLibrary *portLibrary)\n \tcQuery.level = 1;\n \tcQuery.cacheType = J9PORT_CACHEINFO_DCACHE;\n \trc = j9sysinfo_get_cache_info(&cQuery);\n-#if !(defined(J9ARM) || defined(RISCV64))\n+#if !(defined(J9ARM))", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "4b2c869e0662aa576fa6840859752f56b8165b31"}, "originalPosition": 5}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNjg3NTQwOA==", "bodyText": "Please update the comment to match the #if condition and restore the spaces (here and on the #endif).\n#else /* !defined(J9ARM) */", "url": "https://github.com/eclipse-openj9/openj9/pull/9775#discussion_r436875408", "createdAt": "2020-06-08T17:30:22Z", "author": {"login": "keithc-ca"}, "path": "runtime/tests/port/si.c", "diffHunk": "@@ -2199,13 +2207,13 @@ j9sysinfo_test_get_l1dcache_line_size(struct J9PortLibrary *portLibrary)\n \t\t\t\t\tl1DcacheSize, rc);\n \t\t}\n \t}\n-#else /* !(defined(J9ARM) || defined(RISCV64)) */\n+#else /*!(defined(J9ARM))*/", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "4b2c869e0662aa576fa6840859752f56b8165b31"}, "originalPosition": 24}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "4b2c869e0662aa576fa6840859752f56b8165b31", "author": {"user": {"login": "ChengJin01", "name": "Cheng Jin"}}, "url": "https://github.com/eclipse-openj9/openj9/commit/4b2c869e0662aa576fa6840859752f56b8165b31", "committedDate": "2020-06-08T17:24:20Z", "message": "Enable using L1 data cache on RISC-V specific hardware\n\nThe change is to enable the L1 data cache (no support\non the emulator) on the hardware to ensure it works\nappropriately after setup.\n\nSigned-off-by: Cheng Jin <jincheng@ca.ibm.com>"}, "afterCommit": {"oid": "673481b287e61194c96f0daa89d0e813450870fd", "author": {"user": {"login": "ChengJin01", "name": "Cheng Jin"}}, "url": "https://github.com/eclipse-openj9/openj9/commit/673481b287e61194c96f0daa89d0e813450870fd", "committedDate": "2020-06-08T17:36:05Z", "message": "Enable using L1 data cache on RISC-V specific hardware\n\nThe change is to enable the L1 data cache (no support\non the emulator) on the hardware to ensure it works\nappropriately after setup.\n\nSigned-off-by: Cheng Jin <jincheng@ca.ibm.com>"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDI2NDcwNzc0", "url": "https://github.com/eclipse-openj9/openj9/pull/9775#pullrequestreview-426470774", "createdAt": "2020-06-08T17:41:45Z", "commit": {"oid": "673481b287e61194c96f0daa89d0e813450870fd"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wOFQxNzo0MTo0NVrOGgpK3g==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wOFQxNzo0MTo0NVrOGgpK3g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNjg4MjE0Mg==", "bodyText": "This deserves a comment too (/* defined(RISCV64) */) - I should have mentioned it in the previous review.", "url": "https://github.com/eclipse-openj9/openj9/pull/9775#discussion_r436882142", "createdAt": "2020-06-08T17:41:45Z", "author": {"login": "keithc-ca"}, "path": "runtime/port/unix/j9sysinfo.c", "diffHunk": "@@ -1719,6 +1719,17 @@ j9sysinfo_get_cache_info(struct J9PortLibrary *portLibrary, const J9CacheInfoQue\n \tcase J9PORT_CACHEINFO_QUERY_LINESIZE:\n \tcase J9PORT_CACHEINFO_QUERY_CACHESIZE:\n \t\tresult =  getCacheSize(portLibrary, query->cpu, query->level, query->cacheType, query->cmd);\n+\n+#if defined(RISCV64)\n+\t/* The L1 data cache at \"cache/index1\" is set up from \"/sys/devices/system/cpu/cpu1\" on some Linux distro\n+\t * (e.g. Debian_riscv) rather than \"/sys/devices/system/cpu/cpu0\" in which \"cache/index1\" doesn't exist.\n+\t * Note: this is a temporary solution specific to Debian_riscv which won't be used or simply\n+\t * removed once we confirm \"cpu0/cache/index1\" does exist on the latest version of Debian_riscv.\n+\t */\n+\tif (result < 0) {\n+\t\tresult =  getCacheSize(portLibrary, query->cpu + 1, query->level, query->cacheType, query->cmd);\n+\t}\n+#endif", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "673481b287e61194c96f0daa89d0e813450870fd"}, "originalPosition": 14}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "24242e7b434dd4cfa67aa74ae046852a69a6c296", "author": {"user": {"login": "ChengJin01", "name": "Cheng Jin"}}, "url": "https://github.com/eclipse-openj9/openj9/commit/24242e7b434dd4cfa67aa74ae046852a69a6c296", "committedDate": "2020-06-08T17:45:27Z", "message": "Enable using L1 data cache on RISC-V specific hardware\n\nThe change is to enable the L1 data cache (no support\non the emulator) on the hardware to ensure it works\nappropriately after setup.\n\nSigned-off-by: Cheng Jin <jincheng@ca.ibm.com>"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "673481b287e61194c96f0daa89d0e813450870fd", "author": {"user": {"login": "ChengJin01", "name": "Cheng Jin"}}, "url": "https://github.com/eclipse-openj9/openj9/commit/673481b287e61194c96f0daa89d0e813450870fd", "committedDate": "2020-06-08T17:36:05Z", "message": "Enable using L1 data cache on RISC-V specific hardware\n\nThe change is to enable the L1 data cache (no support\non the emulator) on the hardware to ensure it works\nappropriately after setup.\n\nSigned-off-by: Cheng Jin <jincheng@ca.ibm.com>"}, "afterCommit": {"oid": "24242e7b434dd4cfa67aa74ae046852a69a6c296", "author": {"user": {"login": "ChengJin01", "name": "Cheng Jin"}}, "url": "https://github.com/eclipse-openj9/openj9/commit/24242e7b434dd4cfa67aa74ae046852a69a6c296", "committedDate": "2020-06-08T17:45:27Z", "message": "Enable using L1 data cache on RISC-V specific hardware\n\nThe change is to enable the L1 data cache (no support\non the emulator) on the hardware to ensure it works\nappropriately after setup.\n\nSigned-off-by: Cheng Jin <jincheng@ca.ibm.com>"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDI2NzA0NzAz", "url": "https://github.com/eclipse-openj9/openj9/pull/9775#pullrequestreview-426704703", "createdAt": "2020-06-09T00:12:31Z", "commit": {"oid": "24242e7b434dd4cfa67aa74ae046852a69a6c296"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 855, "cost": 1, "resetAt": "2021-10-28T17:48:14Z"}}}