{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTMxMzkxMTM5", "number": 11344, "reviewThreads": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0wN1QwOToxNTowNFrOFBrKLQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0wOFQwMToyOToxNlrOFCEtJw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzM3MzAwMDEzOnYy", "diffSide": "RIGHT", "path": "runtime/compiler/runtime/SignalHandler.c", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0wN1QwOToxNTowNFrOIAc5OA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0wOFQwMToyMTo1OFrOIBCcBQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNzM0NDMxMg==", "bodyText": "Mixed styles of declaring pointer variables.\nconst char* infoName; or const char *infoName;", "url": "https://github.com/eclipse-openj9/openj9/pull/11344#discussion_r537344312", "createdAt": "2020-12-07T09:15:04Z", "author": {"login": "knn-k"}, "path": "runtime/compiler/runtime/SignalHandler.c", "diffHunk": "@@ -1850,6 +1850,87 @@ UDATA jitAMD64Handler(J9VMThread* vmThread, U_32 sigType, void *sigInfo)\n \treturn J9PORT_SIG_EXCEPTION_CONTINUE_SEARCH;\n }\n \n+#elif defined(TR_HOST_ARM64) && defined(TR_TARGET_ARM64)\n+\n+extern void jitHandleNullPointerExceptionTrap(void);\n+extern void jitHandleInternalErrorTrap(void);\n+\n+UDATA jitARM64Handler(J9VMThread* vmThread, U_32 sigType, void* sigInfo)\n+{\n+\tPORT_ACCESS_FROM_VMC(vmThread);\n+\n+\tJ9JITExceptionTable *exceptionTable = NULL;\n+\tJ9JITConfig *jitConfig = vmThread->javaVM->jitConfig;\n+\n+\tif (jitConfig) {\n+\t\tconst char* infoName;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "1364db73123569d21bcb8bc13e2c05b182de5a00"}, "originalPosition": 24}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNzk1OTQyOQ==", "bodyText": "Fixed", "url": "https://github.com/eclipse-openj9/openj9/pull/11344#discussion_r537959429", "createdAt": "2020-12-08T01:21:58Z", "author": {"login": "Akira1Saitoh"}, "path": "runtime/compiler/runtime/SignalHandler.c", "diffHunk": "@@ -1850,6 +1850,87 @@ UDATA jitAMD64Handler(J9VMThread* vmThread, U_32 sigType, void *sigInfo)\n \treturn J9PORT_SIG_EXCEPTION_CONTINUE_SEARCH;\n }\n \n+#elif defined(TR_HOST_ARM64) && defined(TR_TARGET_ARM64)\n+\n+extern void jitHandleNullPointerExceptionTrap(void);\n+extern void jitHandleInternalErrorTrap(void);\n+\n+UDATA jitARM64Handler(J9VMThread* vmThread, U_32 sigType, void* sigInfo)\n+{\n+\tPORT_ACCESS_FROM_VMC(vmThread);\n+\n+\tJ9JITExceptionTable *exceptionTable = NULL;\n+\tJ9JITConfig *jitConfig = vmThread->javaVM->jitConfig;\n+\n+\tif (jitConfig) {\n+\t\tconst char* infoName;", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNzM0NDMxMg=="}, "originalCommit": {"oid": "1364db73123569d21bcb8bc13e2c05b182de5a00"}, "originalPosition": 24}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzM3MzAxNjIzOnYy", "diffSide": "RIGHT", "path": "runtime/compiler/runtime/SignalHandler.c", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0wN1QwOToxODo1MFrOIAdCoA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0wOFQwMToyMzoxM1rOIBCd8w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNzM0NjcyMA==", "bodyText": "You may want to define a symbol for a page size.\nIs the size of the first page 64KB?", "url": "https://github.com/eclipse-openj9/openj9/pull/11344#discussion_r537346720", "createdAt": "2020-12-07T09:18:50Z", "author": {"login": "knn-k"}, "path": "runtime/compiler/runtime/SignalHandler.c", "diffHunk": "@@ -1850,6 +1850,87 @@ UDATA jitAMD64Handler(J9VMThread* vmThread, U_32 sigType, void *sigInfo)\n \treturn J9PORT_SIG_EXCEPTION_CONTINUE_SEARCH;\n }\n \n+#elif defined(TR_HOST_ARM64) && defined(TR_TARGET_ARM64)\n+\n+extern void jitHandleNullPointerExceptionTrap(void);\n+extern void jitHandleInternalErrorTrap(void);\n+\n+UDATA jitARM64Handler(J9VMThread* vmThread, U_32 sigType, void* sigInfo)\n+{\n+\tPORT_ACCESS_FROM_VMC(vmThread);\n+\n+\tJ9JITExceptionTable *exceptionTable = NULL;\n+\tJ9JITConfig *jitConfig = vmThread->javaVM->jitConfig;\n+\n+\tif (jitConfig) {\n+\t\tconst char* infoName;\n+\t\tUDATA *pcPtr;\n+\t\tvoid *infoValue;\n+\t\tU_32 infoType;\n+\t\tJ9JITExceptionTable *exceptionTable;\n+\n+\t\tinfoType = j9sig_info(sigInfo, J9PORT_SIG_CONTROL, J9PORT_SIG_CONTROL_PC, &infoName, &infoValue);\n+\t\tif (infoType != J9PORT_SIG_VALUE_ADDRESS) {\n+\t\t\treturn J9PORT_SIG_EXCEPTION_CONTINUE_SEARCH;\n+\t\t}\n+\t\tpcPtr = (UDATA *) infoValue;\n+\n+\t\texceptionTable = jitConfig->jitGetExceptionTableFromPC(vmThread, *pcPtr);\n+\n+\t\tif (!exceptionTable && J9PORT_SIG_FLAG_SIGBUS == sigType) {\n+\t\t   // We might be in a jit helper routine (like arraycopy) so look at the link register as well...\n+\t\t   UDATA *lrPtr;\n+\t\t   /* R30 is LR for aarch64 */\n+\t\t   infoType = j9sig_info(sigInfo, J9PORT_SIG_GPR, 30, &infoName, &infoValue);\n+\t\t   if (infoType != J9PORT_SIG_VALUE_ADDRESS) {\n+\t\t      return J9PORT_SIG_EXCEPTION_CONTINUE_SEARCH;\n+\t\t   }\n+\t\t   lrPtr = (UDATA *) infoValue;\n+\t\t   exceptionTable = jitConfig->jitGetExceptionTableFromPC(vmThread, *lrPtr);\n+\t\t   if (exceptionTable) {\n+\t\t\t\tvmThread->jitException = (J9Object *) (*lrPtr);  /* the lr points at the instruction after the helper call */\n+\t\t\t\t*pcPtr = (UDATA) ((void *) &jitHandleInternalErrorTrap);\n+\t\t\t\treturn J9PORT_SIG_EXCEPTION_CONTINUE_EXECUTION;\n+\t\t   }\n+\t\t}\n+\n+\t\tif (exceptionTable) {\n+\t\t\tswitch (sigType) {\n+\t\t\tcase J9PORT_SIG_FLAG_SIGBUS:\n+\t\t\tcase J9PORT_SIG_FLAG_SIGSEGV:\n+\t\t\t\tinfoType = j9sig_info(sigInfo, J9PORT_SIG_SIGNAL, J9PORT_SIG_SIGNAL_INACCESSIBLE_ADDRESS, &infoName, &infoValue);\n+\t\t\t\tif (sigType == J9PORT_SIG_FLAG_SIGSEGV && infoType == J9PORT_SIG_VALUE_ADDRESS) {\n+\t\t\t\t\tif ( *(UDATA*)infoValue > 0xFFFF ) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "1364db73123569d21bcb8bc13e2c05b182de5a00"}, "originalPosition": 61}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNzk1OTkyMw==", "bodyText": "We assume that the page size is 4KB. Defined NUMBEROFBYTESINACCESSIBLE as 4096 and changed the code to use it.", "url": "https://github.com/eclipse-openj9/openj9/pull/11344#discussion_r537959923", "createdAt": "2020-12-08T01:23:13Z", "author": {"login": "Akira1Saitoh"}, "path": "runtime/compiler/runtime/SignalHandler.c", "diffHunk": "@@ -1850,6 +1850,87 @@ UDATA jitAMD64Handler(J9VMThread* vmThread, U_32 sigType, void *sigInfo)\n \treturn J9PORT_SIG_EXCEPTION_CONTINUE_SEARCH;\n }\n \n+#elif defined(TR_HOST_ARM64) && defined(TR_TARGET_ARM64)\n+\n+extern void jitHandleNullPointerExceptionTrap(void);\n+extern void jitHandleInternalErrorTrap(void);\n+\n+UDATA jitARM64Handler(J9VMThread* vmThread, U_32 sigType, void* sigInfo)\n+{\n+\tPORT_ACCESS_FROM_VMC(vmThread);\n+\n+\tJ9JITExceptionTable *exceptionTable = NULL;\n+\tJ9JITConfig *jitConfig = vmThread->javaVM->jitConfig;\n+\n+\tif (jitConfig) {\n+\t\tconst char* infoName;\n+\t\tUDATA *pcPtr;\n+\t\tvoid *infoValue;\n+\t\tU_32 infoType;\n+\t\tJ9JITExceptionTable *exceptionTable;\n+\n+\t\tinfoType = j9sig_info(sigInfo, J9PORT_SIG_CONTROL, J9PORT_SIG_CONTROL_PC, &infoName, &infoValue);\n+\t\tif (infoType != J9PORT_SIG_VALUE_ADDRESS) {\n+\t\t\treturn J9PORT_SIG_EXCEPTION_CONTINUE_SEARCH;\n+\t\t}\n+\t\tpcPtr = (UDATA *) infoValue;\n+\n+\t\texceptionTable = jitConfig->jitGetExceptionTableFromPC(vmThread, *pcPtr);\n+\n+\t\tif (!exceptionTable && J9PORT_SIG_FLAG_SIGBUS == sigType) {\n+\t\t   // We might be in a jit helper routine (like arraycopy) so look at the link register as well...\n+\t\t   UDATA *lrPtr;\n+\t\t   /* R30 is LR for aarch64 */\n+\t\t   infoType = j9sig_info(sigInfo, J9PORT_SIG_GPR, 30, &infoName, &infoValue);\n+\t\t   if (infoType != J9PORT_SIG_VALUE_ADDRESS) {\n+\t\t      return J9PORT_SIG_EXCEPTION_CONTINUE_SEARCH;\n+\t\t   }\n+\t\t   lrPtr = (UDATA *) infoValue;\n+\t\t   exceptionTable = jitConfig->jitGetExceptionTableFromPC(vmThread, *lrPtr);\n+\t\t   if (exceptionTable) {\n+\t\t\t\tvmThread->jitException = (J9Object *) (*lrPtr);  /* the lr points at the instruction after the helper call */\n+\t\t\t\t*pcPtr = (UDATA) ((void *) &jitHandleInternalErrorTrap);\n+\t\t\t\treturn J9PORT_SIG_EXCEPTION_CONTINUE_EXECUTION;\n+\t\t   }\n+\t\t}\n+\n+\t\tif (exceptionTable) {\n+\t\t\tswitch (sigType) {\n+\t\t\tcase J9PORT_SIG_FLAG_SIGBUS:\n+\t\t\tcase J9PORT_SIG_FLAG_SIGSEGV:\n+\t\t\t\tinfoType = j9sig_info(sigInfo, J9PORT_SIG_SIGNAL, J9PORT_SIG_SIGNAL_INACCESSIBLE_ADDRESS, &infoName, &infoValue);\n+\t\t\t\tif (sigType == J9PORT_SIG_FLAG_SIGSEGV && infoType == J9PORT_SIG_VALUE_ADDRESS) {\n+\t\t\t\t\tif ( *(UDATA*)infoValue > 0xFFFF ) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNzM0NjcyMA=="}, "originalCommit": {"oid": "1364db73123569d21bcb8bc13e2c05b182de5a00"}, "originalPosition": 61}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzM3NzE4NTY3OnYy", "diffSide": "RIGHT", "path": "runtime/compiler/runtime/SignalHandler.c", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0wOFQwMToyOToxNlrOIBCmlA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0wOFQwMTozOTozNVrOIBC1_w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNzk2MjEzMg==", "bodyText": "You need to compare using >= instead of > here.", "url": "https://github.com/eclipse-openj9/openj9/pull/11344#discussion_r537962132", "createdAt": "2020-12-08T01:29:16Z", "author": {"login": "knn-k"}, "path": "runtime/compiler/runtime/SignalHandler.c", "diffHunk": "@@ -1850,6 +1850,87 @@ UDATA jitAMD64Handler(J9VMThread* vmThread, U_32 sigType, void *sigInfo)\n \treturn J9PORT_SIG_EXCEPTION_CONTINUE_SEARCH;\n }\n \n+#elif defined(TR_HOST_ARM64) && defined(TR_TARGET_ARM64)\n+\n+#define NUMBEROFBYTESINACCESSIBLE 4096\n+extern void jitHandleNullPointerExceptionTrap(void);\n+extern void jitHandleInternalErrorTrap(void);\n+\n+UDATA jitARM64Handler(J9VMThread* vmThread, U_32 sigType, void* sigInfo)\n+{\n+\tPORT_ACCESS_FROM_VMC(vmThread);\n+\n+\tJ9JITExceptionTable *exceptionTable = NULL;\n+\tJ9JITConfig *jitConfig = vmThread->javaVM->jitConfig;\n+\n+\tif (jitConfig) {\n+\t\tconst char *infoName;\n+\t\tUDATA *pcPtr;\n+\t\tvoid *infoValue;\n+\t\tU_32 infoType;\n+\t\tJ9JITExceptionTable *exceptionTable;\n+\n+\t\tinfoType = j9sig_info(sigInfo, J9PORT_SIG_CONTROL, J9PORT_SIG_CONTROL_PC, &infoName, &infoValue);\n+\t\tif (infoType != J9PORT_SIG_VALUE_ADDRESS) {\n+\t\t\treturn J9PORT_SIG_EXCEPTION_CONTINUE_SEARCH;\n+\t\t}\n+\t\tpcPtr = (UDATA *) infoValue;\n+\n+\t\texceptionTable = jitConfig->jitGetExceptionTableFromPC(vmThread, *pcPtr);\n+\n+\t\tif (!exceptionTable && J9PORT_SIG_FLAG_SIGBUS == sigType) {\n+\t\t   // We might be in a jit helper routine (like arraycopy) so look at the link register as well...\n+\t\t   UDATA *lrPtr;\n+\t\t   /* R30 is LR for aarch64 */\n+\t\t   infoType = j9sig_info(sigInfo, J9PORT_SIG_GPR, 30, &infoName, &infoValue);\n+\t\t   if (infoType != J9PORT_SIG_VALUE_ADDRESS) {\n+\t\t      return J9PORT_SIG_EXCEPTION_CONTINUE_SEARCH;\n+\t\t   }\n+\t\t   lrPtr = (UDATA *) infoValue;\n+\t\t   exceptionTable = jitConfig->jitGetExceptionTableFromPC(vmThread, *lrPtr);\n+\t\t   if (exceptionTable) {\n+\t\t\t\tvmThread->jitException = (J9Object *) (*lrPtr);  /* the lr points at the instruction after the helper call */\n+\t\t\t\t*pcPtr = (UDATA) ((void *) &jitHandleInternalErrorTrap);\n+\t\t\t\treturn J9PORT_SIG_EXCEPTION_CONTINUE_EXECUTION;\n+\t\t   }\n+\t\t}\n+\n+\t\tif (exceptionTable) {\n+\t\t\tswitch (sigType) {\n+\t\t\tcase J9PORT_SIG_FLAG_SIGBUS:\n+\t\t\tcase J9PORT_SIG_FLAG_SIGSEGV:\n+\t\t\t\tinfoType = j9sig_info(sigInfo, J9PORT_SIG_SIGNAL, J9PORT_SIG_SIGNAL_INACCESSIBLE_ADDRESS, &infoName, &infoValue);\n+\t\t\t\tif (sigType == J9PORT_SIG_FLAG_SIGSEGV && infoType == J9PORT_SIG_VALUE_ADDRESS) {\n+\t\t\t\t\tif ( *(UDATA*)infoValue > NUMBEROFBYTESINACCESSIBLE) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b8616767d1d9709261a179def2707484bdbe6fca"}, "originalPosition": 62}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNzk2NjA3OQ==", "bodyText": "Thanks for pointing it out. Fixed.", "url": "https://github.com/eclipse-openj9/openj9/pull/11344#discussion_r537966079", "createdAt": "2020-12-08T01:39:35Z", "author": {"login": "Akira1Saitoh"}, "path": "runtime/compiler/runtime/SignalHandler.c", "diffHunk": "@@ -1850,6 +1850,87 @@ UDATA jitAMD64Handler(J9VMThread* vmThread, U_32 sigType, void *sigInfo)\n \treturn J9PORT_SIG_EXCEPTION_CONTINUE_SEARCH;\n }\n \n+#elif defined(TR_HOST_ARM64) && defined(TR_TARGET_ARM64)\n+\n+#define NUMBEROFBYTESINACCESSIBLE 4096\n+extern void jitHandleNullPointerExceptionTrap(void);\n+extern void jitHandleInternalErrorTrap(void);\n+\n+UDATA jitARM64Handler(J9VMThread* vmThread, U_32 sigType, void* sigInfo)\n+{\n+\tPORT_ACCESS_FROM_VMC(vmThread);\n+\n+\tJ9JITExceptionTable *exceptionTable = NULL;\n+\tJ9JITConfig *jitConfig = vmThread->javaVM->jitConfig;\n+\n+\tif (jitConfig) {\n+\t\tconst char *infoName;\n+\t\tUDATA *pcPtr;\n+\t\tvoid *infoValue;\n+\t\tU_32 infoType;\n+\t\tJ9JITExceptionTable *exceptionTable;\n+\n+\t\tinfoType = j9sig_info(sigInfo, J9PORT_SIG_CONTROL, J9PORT_SIG_CONTROL_PC, &infoName, &infoValue);\n+\t\tif (infoType != J9PORT_SIG_VALUE_ADDRESS) {\n+\t\t\treturn J9PORT_SIG_EXCEPTION_CONTINUE_SEARCH;\n+\t\t}\n+\t\tpcPtr = (UDATA *) infoValue;\n+\n+\t\texceptionTable = jitConfig->jitGetExceptionTableFromPC(vmThread, *pcPtr);\n+\n+\t\tif (!exceptionTable && J9PORT_SIG_FLAG_SIGBUS == sigType) {\n+\t\t   // We might be in a jit helper routine (like arraycopy) so look at the link register as well...\n+\t\t   UDATA *lrPtr;\n+\t\t   /* R30 is LR for aarch64 */\n+\t\t   infoType = j9sig_info(sigInfo, J9PORT_SIG_GPR, 30, &infoName, &infoValue);\n+\t\t   if (infoType != J9PORT_SIG_VALUE_ADDRESS) {\n+\t\t      return J9PORT_SIG_EXCEPTION_CONTINUE_SEARCH;\n+\t\t   }\n+\t\t   lrPtr = (UDATA *) infoValue;\n+\t\t   exceptionTable = jitConfig->jitGetExceptionTableFromPC(vmThread, *lrPtr);\n+\t\t   if (exceptionTable) {\n+\t\t\t\tvmThread->jitException = (J9Object *) (*lrPtr);  /* the lr points at the instruction after the helper call */\n+\t\t\t\t*pcPtr = (UDATA) ((void *) &jitHandleInternalErrorTrap);\n+\t\t\t\treturn J9PORT_SIG_EXCEPTION_CONTINUE_EXECUTION;\n+\t\t   }\n+\t\t}\n+\n+\t\tif (exceptionTable) {\n+\t\t\tswitch (sigType) {\n+\t\t\tcase J9PORT_SIG_FLAG_SIGBUS:\n+\t\t\tcase J9PORT_SIG_FLAG_SIGSEGV:\n+\t\t\t\tinfoType = j9sig_info(sigInfo, J9PORT_SIG_SIGNAL, J9PORT_SIG_SIGNAL_INACCESSIBLE_ADDRESS, &infoName, &infoValue);\n+\t\t\t\tif (sigType == J9PORT_SIG_FLAG_SIGSEGV && infoType == J9PORT_SIG_VALUE_ADDRESS) {\n+\t\t\t\t\tif ( *(UDATA*)infoValue > NUMBEROFBYTESINACCESSIBLE) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNzk2MjEzMg=="}, "originalCommit": {"oid": "b8616767d1d9709261a179def2707484bdbe6fca"}, "originalPosition": 62}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1006, "cost": 1, "resetAt": "2021-11-12T13:16:51Z"}}}