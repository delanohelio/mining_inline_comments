{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTEwMzE5Mzkz", "number": 11004, "title": "Uncommon autosimd piv loop stride increment node", "bodyText": "If the loop increment node is commoned, then reducing the loop by\nchanging the value of loop stride can cause unwanted bug. This is\npotentially true if the node is commoned for address calculation.\nThis commit uncommon the PIV increment node so that changing the\nstride does not introduce side-effects on commoned nodes.\nFixes #10656\nSigned-off-by: Mohammad Nazmul Alam mohammad.nazmul.alam@ibm.com", "createdAt": "2020-10-26T21:29:54Z", "url": "https://github.com/eclipse-openj9/openj9/pull/11004", "merged": true, "mergeCommit": {"oid": "8401f565b48ffcc51ec114630505f54bb9c30d23"}, "closed": true, "closedAt": "2020-12-04T00:40:26Z", "author": {"login": "mnalam-p"}, "timelineItems": {"totalCount": 21, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdWbpKbAFqTUxNzIwNTM1Nw==", "endCursor": "Y3Vyc29yOnYyOpPPAAABdiHE3xgBqjQwNjA0MDE5OTk=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTE3MjA1MzU3", "url": "https://github.com/eclipse-openj9/openj9/pull/11004#pullrequestreview-517205357", "createdAt": "2020-10-26T21:55:57Z", "commit": {"oid": "d7cf3a1249dec05592fb359439d0c5d7a1758c3a"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yNlQyMTo1NTo1N1rOHoj4rg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yNlQyMTo1NTo1N1rOHoj4rg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMjI5MzAzOA==", "bodyText": "I think this assert was supposed to check if the child is a const.", "url": "https://github.com/eclipse-openj9/openj9/pull/11004#discussion_r512293038", "createdAt": "2020-10-26T21:55:57Z", "author": {"login": "IBMJimmyk"}, "path": "runtime/compiler/optimizer/SPMDParallelizer.cpp", "diffHunk": "@@ -1441,6 +1441,30 @@ bool TR_SPMDKernelParallelizer::processSPMDKernelLoopForSIMDize(TR::Compilation\n             {\n             // increment of PIV\n             traceMsg(comp, \"Reducing the number of iterations of the loop %d at storeNode [%p] by vector length %d \\n\",loop->getNumber(), storeNode, unrollCount);\n+\t    TR_ASSERT_FATAL(storeNode->getFirstChild()->getOpCode().isAdd() || storeNode->getFirstChild()->getOpCode().isSub(), \"PIV increment should be simple (either by add or by sub\");\n+\t    TR_ASSERT_FATAL(storeNode->getFirstChild()->getFirstChild()->getOpCode().isLoad(), \"PIV increment should have load\");\n+\t    TR_ASSERT_FATAL(!storeNode->getFirstChild()->getSecondChild()->getSymbolReference(), \"PIV increment should have const increment value\");", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d7cf3a1249dec05592fb359439d0c5d7a1758c3a"}, "originalPosition": 6}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "d7cf3a1249dec05592fb359439d0c5d7a1758c3a", "author": {"user": {"login": "mnalam-p", "name": null}}, "url": "https://github.com/eclipse-openj9/openj9/commit/d7cf3a1249dec05592fb359439d0c5d7a1758c3a", "committedDate": "2020-10-26T21:26:20Z", "message": "Uncommon AutoSIMD PIV increment node.\n\nIf the loop increment node is commoned, then reducing the loop by\nchanging the value of loop stride can cause unwanted bug. This is\npotentially true if the node is commoned for address calculation.\nThis commit uncommon the PIV increment node so that changing the\nstride does not introduce side-effects on commoned nodes.\n\nFixes #10656\n\nSigned-off-by: Mohammad Nazmul Alam <mohammad.nazmul.alam@ibm.com>"}, "afterCommit": {"oid": "e0bed4ff16a80d8a6af6a4d496449535f1be687c", "author": {"user": {"login": "mnalam-p", "name": null}}, "url": "https://github.com/eclipse-openj9/openj9/commit/e0bed4ff16a80d8a6af6a4d496449535f1be687c", "committedDate": "2020-10-27T19:31:20Z", "message": "Uncommon AutoSIMD PIV increment node.\n\nIf the loop increment node is commoned, then reducing the loop by\nchanging the value of loop stride can cause unwanted bug. This is\npotentially true if the node is commoned for address calculation.\nThis commit uncommon the PIV increment node so that changing the\nstride does not introduce side-effects on commoned nodes.\n\nFixes #10656\n\nSigned-off-by: Mohammad Nazmul Alam <mohammad.nazmul.alam@ibm.com>"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTE4NzA4NjM4", "url": "https://github.com/eclipse-openj9/openj9/pull/11004#pullrequestreview-518708638", "createdAt": "2020-10-28T14:14:59Z", "commit": {"oid": "e0bed4ff16a80d8a6af6a4d496449535f1be687c"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yOFQxNDoxNDo1OVrOHpsMkA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yOFQxNDoxNDo1OVrOHpsMkA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMzQ3Nzc3Ng==", "bodyText": "Maybe I'm missing something, but if the increment is commoned with other uses why does uncommoning just the definition let the vectorization do the right thing but the commoned version does not?", "url": "https://github.com/eclipse-openj9/openj9/pull/11004#discussion_r513477776", "createdAt": "2020-10-28T14:14:59Z", "author": {"login": "andrewcraik"}, "path": "runtime/compiler/optimizer/SPMDParallelizer.cpp", "diffHunk": "@@ -1441,6 +1441,30 @@ bool TR_SPMDKernelParallelizer::processSPMDKernelLoopForSIMDize(TR::Compilation\n             {\n             // increment of PIV\n             traceMsg(comp, \"Reducing the number of iterations of the loop %d at storeNode [%p] by vector length %d \\n\",loop->getNumber(), storeNode, unrollCount);\n+\t    TR_ASSERT_FATAL(storeNode->getFirstChild()->getOpCode().isAdd() || storeNode->getFirstChild()->getOpCode().isSub(), \"PIV increment should be simple (either by add or by sub\");\n+\t    TR_ASSERT_FATAL(storeNode->getFirstChild()->getFirstChild()->getOpCode().isLoad(), \"PIV increment should have load\");\n+\t    TR_ASSERT_FATAL(storeNode->getFirstChild()->getSecondChild()->getOpCode().isLoadConst(), \"PIV increment should have const increment value\");\n+            if (storeNode->getFirstChild()->getReferenceCount() > 1)", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "e0bed4ff16a80d8a6af6a4d496449535f1be687c"}, "originalPosition": 7}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "e0bed4ff16a80d8a6af6a4d496449535f1be687c", "author": {"user": {"login": "mnalam-p", "name": null}}, "url": "https://github.com/eclipse-openj9/openj9/commit/e0bed4ff16a80d8a6af6a4d496449535f1be687c", "committedDate": "2020-10-27T19:31:20Z", "message": "Uncommon AutoSIMD PIV increment node.\n\nIf the loop increment node is commoned, then reducing the loop by\nchanging the value of loop stride can cause unwanted bug. This is\npotentially true if the node is commoned for address calculation.\nThis commit uncommon the PIV increment node so that changing the\nstride does not introduce side-effects on commoned nodes.\n\nFixes #10656\n\nSigned-off-by: Mohammad Nazmul Alam <mohammad.nazmul.alam@ibm.com>"}, "afterCommit": {"oid": "6f097bf9083f47cf554fbf9e1d033bdc3208fcd9", "author": {"user": {"login": "mnalam-p", "name": null}}, "url": "https://github.com/eclipse-openj9/openj9/commit/6f097bf9083f47cf554fbf9e1d033bdc3208fcd9", "committedDate": "2020-11-11T04:45:45Z", "message": "Uncommon AutoSIMD PIV increment node.\n\nIf the loop increment node is commoned, then reducing the loop by\nchanging the value of loop stride can cause unwanted bug. This is\npotentially true if the node is commoned for address calculation.\nThis commit uncommon the PIV increment node so that changing the\nstride does not introduce side-effects on commoned nodes.\n\nFixes #10656\n\nSigned-off-by: Mohammad Nazmul Alam <mohammad.nazmul.alam@ibm.com>"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "6f097bf9083f47cf554fbf9e1d033bdc3208fcd9", "author": {"user": {"login": "mnalam-p", "name": null}}, "url": "https://github.com/eclipse-openj9/openj9/commit/6f097bf9083f47cf554fbf9e1d033bdc3208fcd9", "committedDate": "2020-11-11T04:45:45Z", "message": "Uncommon AutoSIMD PIV increment node.\n\nIf the loop increment node is commoned, then reducing the loop by\nchanging the value of loop stride can cause unwanted bug. This is\npotentially true if the node is commoned for address calculation.\nThis commit uncommon the PIV increment node so that changing the\nstride does not introduce side-effects on commoned nodes.\n\nFixes #10656\n\nSigned-off-by: Mohammad Nazmul Alam <mohammad.nazmul.alam@ibm.com>"}, "afterCommit": {"oid": "be65d7455040a3cabd3392257227469194f55d9e", "author": {"user": {"login": "mnalam-p", "name": null}}, "url": "https://github.com/eclipse-openj9/openj9/commit/be65d7455040a3cabd3392257227469194f55d9e", "committedDate": "2020-11-11T04:47:30Z", "message": "Uncommon AutoSIMD PIV increment node.\n\nIf the loop increment node is commoned, then reducing the loop by\nchanging the value of loop stride can cause unwanted bug. This is\npotentially true if the node is commoned for address calculation.\nThis commit uncommon the PIV increment node so that changing the\nstride does not introduce side-effects on commoned nodes.\n\nFixes #10656\n\nSigned-off-by: Mohammad Nazmul Alam <mohammad.nazmul.alam@ibm.com>"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "be65d7455040a3cabd3392257227469194f55d9e", "author": {"user": {"login": "mnalam-p", "name": null}}, "url": "https://github.com/eclipse-openj9/openj9/commit/be65d7455040a3cabd3392257227469194f55d9e", "committedDate": "2020-11-11T04:47:30Z", "message": "Uncommon AutoSIMD PIV increment node.\n\nIf the loop increment node is commoned, then reducing the loop by\nchanging the value of loop stride can cause unwanted bug. This is\npotentially true if the node is commoned for address calculation.\nThis commit uncommon the PIV increment node so that changing the\nstride does not introduce side-effects on commoned nodes.\n\nFixes #10656\n\nSigned-off-by: Mohammad Nazmul Alam <mohammad.nazmul.alam@ibm.com>"}, "afterCommit": {"oid": "569bef0df6d7adcc9329b75cbd68dab0b4e66fa8", "author": {"user": {"login": "mnalam-p", "name": null}}, "url": "https://github.com/eclipse-openj9/openj9/commit/569bef0df6d7adcc9329b75cbd68dab0b4e66fa8", "committedDate": "2020-11-11T19:32:54Z", "message": "Uncommon AutoSIMD PIV increment node.\n\nIf the loop increment node is commoned, then reducing the loop by\nchanging the value of loop stride can cause unwanted bug. This is\npotentially true if the node is commoned for address calculation.\nThis commit uncommon the PIV increment node so that changing the\nstride does not introduce side-effects on commoned nodes.\n\nFixes #10656\n\nSigned-off-by: Mohammad Nazmul Alam <mohammad.nazmul.alam@ibm.com>"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "569bef0df6d7adcc9329b75cbd68dab0b4e66fa8", "author": {"user": {"login": "mnalam-p", "name": null}}, "url": "https://github.com/eclipse-openj9/openj9/commit/569bef0df6d7adcc9329b75cbd68dab0b4e66fa8", "committedDate": "2020-11-11T19:32:54Z", "message": "Uncommon AutoSIMD PIV increment node.\n\nIf the loop increment node is commoned, then reducing the loop by\nchanging the value of loop stride can cause unwanted bug. This is\npotentially true if the node is commoned for address calculation.\nThis commit uncommon the PIV increment node so that changing the\nstride does not introduce side-effects on commoned nodes.\n\nFixes #10656\n\nSigned-off-by: Mohammad Nazmul Alam <mohammad.nazmul.alam@ibm.com>"}, "afterCommit": {"oid": "67bc45328d190882ba4f565e3f30be59920aa546", "author": {"user": {"login": "mnalam-p", "name": null}}, "url": "https://github.com/eclipse-openj9/openj9/commit/67bc45328d190882ba4f565e3f30be59920aa546", "committedDate": "2020-11-12T16:37:58Z", "message": "Uncommon AutoSIMD PIV increment node.\n\nIf the loop increment node is commoned, then reducing the loop by\nchanging the value of loop stride can cause unwanted bug. This is\npotentially true if the node is commoned for address calculation.\nThis commit uncommon the PIV increment node so that changing the\nstride does not introduce side-effects on commoned nodes.\n\nFixes #10656\n\nSigned-off-by: Mohammad Nazmul Alam <mohammad.nazmul.alam@ibm.com>"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "67bc45328d190882ba4f565e3f30be59920aa546", "author": {"user": {"login": "mnalam-p", "name": null}}, "url": "https://github.com/eclipse-openj9/openj9/commit/67bc45328d190882ba4f565e3f30be59920aa546", "committedDate": "2020-11-12T16:37:58Z", "message": "Uncommon AutoSIMD PIV increment node.\n\nIf the loop increment node is commoned, then reducing the loop by\nchanging the value of loop stride can cause unwanted bug. This is\npotentially true if the node is commoned for address calculation.\nThis commit uncommon the PIV increment node so that changing the\nstride does not introduce side-effects on commoned nodes.\n\nFixes #10656\n\nSigned-off-by: Mohammad Nazmul Alam <mohammad.nazmul.alam@ibm.com>"}, "afterCommit": {"oid": "647469b203bf34d43e0ed390fe8230e27ee5f419", "author": {"user": {"login": "mnalam-p", "name": null}}, "url": "https://github.com/eclipse-openj9/openj9/commit/647469b203bf34d43e0ed390fe8230e27ee5f419", "committedDate": "2020-11-13T04:15:36Z", "message": "Uncommon AutoSIMD PIV increment node.\n\nIf the loop increment node is commoned, then reducing the loop by\nchanging the value of loop stride can cause unwanted bug. This is\npotentially true if the node is commoned for address calculation.\nThis commit uncommon the PIV increment node so that changing the\nstride does not introduce side-effects on commoned nodes.\n\nFixes #10656\n\nSigned-off-by: Mohammad Nazmul Alam <mohammad.nazmul.alam@ibm.com>"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "647469b203bf34d43e0ed390fe8230e27ee5f419", "author": {"user": {"login": "mnalam-p", "name": null}}, "url": "https://github.com/eclipse-openj9/openj9/commit/647469b203bf34d43e0ed390fe8230e27ee5f419", "committedDate": "2020-11-13T04:15:36Z", "message": "Uncommon AutoSIMD PIV increment node.\n\nIf the loop increment node is commoned, then reducing the loop by\nchanging the value of loop stride can cause unwanted bug. This is\npotentially true if the node is commoned for address calculation.\nThis commit uncommon the PIV increment node so that changing the\nstride does not introduce side-effects on commoned nodes.\n\nFixes #10656\n\nSigned-off-by: Mohammad Nazmul Alam <mohammad.nazmul.alam@ibm.com>"}, "afterCommit": {"oid": "8f836f910bafa2fd12f1e2f8da99cdca24b924fc", "author": {"user": {"login": "mnalam-p", "name": null}}, "url": "https://github.com/eclipse-openj9/openj9/commit/8f836f910bafa2fd12f1e2f8da99cdca24b924fc", "committedDate": "2020-11-13T07:28:44Z", "message": "Uncommon AutoSIMD PIV increment node.\n\nIf the loop increment node is commoned, then reducing the loop by\nchanging the value of loop stride can cause unwanted bug. This is\npotentially true if the node is commoned for address calculation.\nThis commit uncommon the PIV increment node so that changing the\nstride does not introduce side-effects on commoned nodes.\n\nFixes #10656\n\nSigned-off-by: Mohammad Nazmul Alam <mohammad.nazmul.alam@ibm.com>"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTMwMjcxMjc2", "url": "https://github.com/eclipse-openj9/openj9/pull/11004#pullrequestreview-530271276", "createdAt": "2020-11-13T17:37:11Z", "commit": {"oid": "8f836f910bafa2fd12f1e2f8da99cdca24b924fc"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTMxOTAxNTIw", "url": "https://github.com/eclipse-openj9/openj9/pull/11004#pullrequestreview-531901520", "createdAt": "2020-11-16T23:18:52Z", "commit": {"oid": "8f836f910bafa2fd12f1e2f8da99cdca24b924fc"}, "state": "COMMENTED", "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xNlQyMzoxODo1MlrOH0bWJg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xNlQyMzoyMjo1OFrOH0btAw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNDczNjAzOA==", "bodyText": "Let's not return the value passed as a parameter. Better to make that function void.", "url": "https://github.com/eclipse-openj9/openj9/pull/11004#discussion_r524736038", "createdAt": "2020-11-16T23:18:52Z", "author": {"login": "gita-omr"}, "path": "runtime/compiler/optimizer/SPMDParallelizer.cpp", "diffHunk": "@@ -1369,6 +1369,30 @@ bool TR_SPMDKernelParallelizer::reductionLoopExitProcessing(TR::Compilation *com\n    return true;\n    }\n \n+TR::Node * replaceAndAnchorOldNode(TR::Compilation *comp, TR::TreeTop *treeTop, TR::Node *parent, TR::Node *oldNode, TR::Node *newNode, int index)\n+   {\n+\t   treeTop->insertBefore(TR::TreeTop::create(comp, TR::Node::create(TR::treetop, 1, oldNode)));\n+\t   oldNode->recursivelyDecReferenceCount();\n+\t   parent->setAndIncChild(index, newNode);\n+\t   return newNode;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "8f836f910bafa2fd12f1e2f8da99cdca24b924fc"}, "originalPosition": 9}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNDczODU2Mw==", "bodyText": "I would rather call it: changeLoopStride.", "url": "https://github.com/eclipse-openj9/openj9/pull/11004#discussion_r524738563", "createdAt": "2020-11-16T23:20:28Z", "author": {"login": "gita-omr"}, "path": "runtime/compiler/optimizer/SPMDParallelizer.cpp", "diffHunk": "@@ -1369,6 +1369,30 @@ bool TR_SPMDKernelParallelizer::reductionLoopExitProcessing(TR::Compilation *com\n    return true;\n    }\n \n+TR::Node * replaceAndAnchorOldNode(TR::Compilation *comp, TR::TreeTop *treeTop, TR::Node *parent, TR::Node *oldNode, TR::Node *newNode, int index)\n+   {\n+\t   treeTop->insertBefore(TR::TreeTop::create(comp, TR::Node::create(TR::treetop, 1, oldNode)));\n+\t   oldNode->recursivelyDecReferenceCount();\n+\t   parent->setAndIncChild(index, newNode);\n+\t   return newNode;\n+   }\n+\n+bool matchIVIncrementPattern(TR::Node *node, TR::SymbolReference *pivSymRef)\n+   {\n+   return (node->getOpCode().isAdd() || node->getOpCode().isSub()) && node->getFirstChild()->getOpCode().isLoad()\n+    && node->getFirstChild()->getSymbolReference() == pivSymRef && node->getSecondChild()->getOpCode().isLoadConst();\n+   }\n+\n+TR::Node * changeIAddISubConstNodeMultiplyBy(TR::Node * parent, int32_t multiple)", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "8f836f910bafa2fd12f1e2f8da99cdca24b924fc"}, "originalPosition": 18}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNDc0MTg5MQ==", "bodyText": "Please fix all the formatting.", "url": "https://github.com/eclipse-openj9/openj9/pull/11004#discussion_r524741891", "createdAt": "2020-11-16T23:22:58Z", "author": {"login": "gita-omr"}, "path": "runtime/compiler/optimizer/SPMDParallelizer.cpp", "diffHunk": "@@ -1427,26 +1451,110 @@ bool TR_SPMDKernelParallelizer::processSPMDKernelLoopForSIMDize(TR::Compilation\n    loop->getBlocks(&blocksInLoop);\n    ListIterator<TR::Block> blocksIt1(&blocksInLoop);\n \n-\n    // SIMD_TODO: improve this code\n \n    for (TR::Block *nextBlock = blocksIt1.getCurrent(); nextBlock; nextBlock=blocksIt1.getNext())\n       {\n+      TR_HashTab* entries = new (comp->trStackMemory()) TR_HashTab(comp->trMemory(), stackAlloc);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "8f836f910bafa2fd12f1e2f8da99cdca24b924fc"}, "originalPosition": 40}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTMxOTA0OTc1", "url": "https://github.com/eclipse-openj9/openj9/pull/11004#pullrequestreview-531904975", "createdAt": "2020-11-16T23:26:42Z", "commit": {"oid": "8f836f910bafa2fd12f1e2f8da99cdca24b924fc"}, "state": "COMMENTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xNlQyMzoyNjo0MlrOH0b8Fg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xNlQyMzoyNzozOFrOH0cACw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNDc0NTc1MA==", "bodyText": "I don't think we should create a hash table for each block. I think we need only one that is cleared on every block.", "url": "https://github.com/eclipse-openj9/openj9/pull/11004#discussion_r524745750", "createdAt": "2020-11-16T23:26:42Z", "author": {"login": "gita-omr"}, "path": "runtime/compiler/optimizer/SPMDParallelizer.cpp", "diffHunk": "@@ -1427,26 +1451,110 @@ bool TR_SPMDKernelParallelizer::processSPMDKernelLoopForSIMDize(TR::Compilation\n    loop->getBlocks(&blocksInLoop);\n    ListIterator<TR::Block> blocksIt1(&blocksInLoop);\n \n-\n    // SIMD_TODO: improve this code\n \n    for (TR::Block *nextBlock = blocksIt1.getCurrent(); nextBlock; nextBlock=blocksIt1.getNext())\n       {\n+      TR_HashTab* entries = new (comp->trStackMemory()) TR_HashTab(comp->trMemory(), stackAlloc);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "8f836f910bafa2fd12f1e2f8da99cdca24b924fc"}, "originalPosition": 40}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNDc0Njc2Mw==", "bodyText": "Since the node is not necessary a store maybe should be named something else.", "url": "https://github.com/eclipse-openj9/openj9/pull/11004#discussion_r524746763", "createdAt": "2020-11-16T23:27:38Z", "author": {"login": "gita-omr"}, "path": "runtime/compiler/optimizer/SPMDParallelizer.cpp", "diffHunk": "@@ -1427,26 +1451,110 @@ bool TR_SPMDKernelParallelizer::processSPMDKernelLoopForSIMDize(TR::Compilation\n    loop->getBlocks(&blocksInLoop);\n    ListIterator<TR::Block> blocksIt1(&blocksInLoop);\n \n-\n    // SIMD_TODO: improve this code\n \n    for (TR::Block *nextBlock = blocksIt1.getCurrent(); nextBlock; nextBlock=blocksIt1.getNext())\n       {\n+      TR_HashTab* entries = new (comp->trStackMemory()) TR_HashTab(comp->trMemory(), stackAlloc);\n       for (TR::TreeTop *tt = nextBlock->getEntry() ; tt != nextBlock->getExit() ; tt = tt->getNextTreeTop())\n          {\n          // identify operation for primary induction variable\n          TR::Node *storeNode = tt->getNode();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "8f836f910bafa2fd12f1e2f8da99cdca24b924fc"}, "originalPosition": 44}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "8f836f910bafa2fd12f1e2f8da99cdca24b924fc", "author": {"user": {"login": "mnalam-p", "name": null}}, "url": "https://github.com/eclipse-openj9/openj9/commit/8f836f910bafa2fd12f1e2f8da99cdca24b924fc", "committedDate": "2020-11-13T07:28:44Z", "message": "Uncommon AutoSIMD PIV increment node.\n\nIf the loop increment node is commoned, then reducing the loop by\nchanging the value of loop stride can cause unwanted bug. This is\npotentially true if the node is commoned for address calculation.\nThis commit uncommon the PIV increment node so that changing the\nstride does not introduce side-effects on commoned nodes.\n\nFixes #10656\n\nSigned-off-by: Mohammad Nazmul Alam <mohammad.nazmul.alam@ibm.com>"}, "afterCommit": {"oid": "849215ce4d438df9f7a8513cb4864d504888f624", "author": {"user": {"login": "mnalam-p", "name": null}}, "url": "https://github.com/eclipse-openj9/openj9/commit/849215ce4d438df9f7a8513cb4864d504888f624", "committedDate": "2020-11-18T03:55:02Z", "message": "Uncommon autosimd piv loop stride increment node\n\nIf the loop increment node is commoned, then reducing the loop by\nchanging the value of loop stride can cause unwanted bug. This is\npotentially true if the node is commoned for address calculation.\nThis commit uncommon the PIV increment node so that changing the\nstride does not introduce side-effects on commoned nodes. Also, the\nfix looks for commoning of ifcmp checks that are commoned with the\nstride calculation and adjust them accordingly.\n\nFixes #10656\n\nSigned-off-by: Mohammad Nazmul Alam <mohammad.nazmul.alam@ibm.com>"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "849215ce4d438df9f7a8513cb4864d504888f624", "author": {"user": {"login": "mnalam-p", "name": null}}, "url": "https://github.com/eclipse-openj9/openj9/commit/849215ce4d438df9f7a8513cb4864d504888f624", "committedDate": "2020-11-18T03:55:02Z", "message": "Uncommon autosimd piv loop stride increment node\n\nIf the loop increment node is commoned, then reducing the loop by\nchanging the value of loop stride can cause unwanted bug. This is\npotentially true if the node is commoned for address calculation.\nThis commit uncommon the PIV increment node so that changing the\nstride does not introduce side-effects on commoned nodes. Also, the\nfix looks for commoning of ifcmp checks that are commoned with the\nstride calculation and adjust them accordingly.\n\nFixes #10656\n\nSigned-off-by: Mohammad Nazmul Alam <mohammad.nazmul.alam@ibm.com>"}, "afterCommit": {"oid": "c3778a76309e1e9693ddc9569362048266b5a657", "author": {"user": {"login": "mnalam-p", "name": null}}, "url": "https://github.com/eclipse-openj9/openj9/commit/c3778a76309e1e9693ddc9569362048266b5a657", "committedDate": "2020-11-18T05:24:57Z", "message": "Uncommon autosimd piv loop stride increment node\n\nIf the loop increment node is commoned, then reducing the loop by\nchanging the value of loop stride can cause unwanted bug. This is\npotentially true if the node is commoned for address calculation.\nThis commit uncommon the PIV increment node so that changing the\nstride does not introduce side-effects on commoned nodes. Also, the\nfix looks for commoning of ifcmp checks that are commoned with the\nstride calculation and adjust them accordingly.\n\nFixes #10656\n\nSigned-off-by: Mohammad Nazmul Alam <mohammad.nazmul.alam@ibm.com>"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTM0NjczNDY0", "url": "https://github.com/eclipse-openj9/openj9/pull/11004#pullrequestreview-534673464", "createdAt": "2020-11-19T17:17:02Z", "commit": {"oid": "c3778a76309e1e9693ddc9569362048266b5a657"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTM0NzkwNzg3", "url": "https://github.com/eclipse-openj9/openj9/pull/11004#pullrequestreview-534790787", "createdAt": "2020-11-19T19:43:32Z", "commit": {"oid": "c3778a76309e1e9693ddc9569362048266b5a657"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xOVQxOTo0MzozMlrOH2u0Lg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xOVQxOTo0MzozMlrOH2u0Lg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNzE1MjE3NA==", "bodyText": "There are still some tabs here that should be replaced with spaces.", "url": "https://github.com/eclipse-openj9/openj9/pull/11004#discussion_r527152174", "createdAt": "2020-11-19T19:43:32Z", "author": {"login": "IBMJimmyk"}, "path": "runtime/compiler/optimizer/SPMDParallelizer.cpp", "diffHunk": "@@ -1369,6 +1369,29 @@ bool TR_SPMDKernelParallelizer::reductionLoopExitProcessing(TR::Compilation *com\n    return true;\n    }\n \n+void TR_SPMDKernelParallelizer::replaceAndAnchorOldNode(TR::Compilation *comp, TR::TreeTop *treeTop, TR::Node *parent, TR::Node *oldNode, TR::Node *newNode, int index)\n+   {\n+\t   treeTop->insertBefore(TR::TreeTop::create(comp, TR::Node::create(TR::treetop, 1, oldNode)));\n+\t   oldNode->recursivelyDecReferenceCount();\n+\t   parent->setAndIncChild(index, newNode);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c3778a76309e1e9693ddc9569362048266b5a657"}, "originalPosition": 8}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "c3778a76309e1e9693ddc9569362048266b5a657", "author": {"user": {"login": "mnalam-p", "name": null}}, "url": "https://github.com/eclipse-openj9/openj9/commit/c3778a76309e1e9693ddc9569362048266b5a657", "committedDate": "2020-11-18T05:24:57Z", "message": "Uncommon autosimd piv loop stride increment node\n\nIf the loop increment node is commoned, then reducing the loop by\nchanging the value of loop stride can cause unwanted bug. This is\npotentially true if the node is commoned for address calculation.\nThis commit uncommon the PIV increment node so that changing the\nstride does not introduce side-effects on commoned nodes. Also, the\nfix looks for commoning of ifcmp checks that are commoned with the\nstride calculation and adjust them accordingly.\n\nFixes #10656\n\nSigned-off-by: Mohammad Nazmul Alam <mohammad.nazmul.alam@ibm.com>"}, "afterCommit": {"oid": "c3f808a708708f4b995036c92f06f40d6e9a0f79", "author": {"user": {"login": "mnalam-p", "name": null}}, "url": "https://github.com/eclipse-openj9/openj9/commit/c3f808a708708f4b995036c92f06f40d6e9a0f79", "committedDate": "2020-11-19T19:50:56Z", "message": "Uncommon autosimd piv loop stride increment node\n\nIf the loop increment node is commoned, then reducing the loop by\nchanging the value of loop stride can cause unwanted bug. This is\npotentially true if the node is commoned with address calculation.\nThis commit uncommon the PIV increment node so that changing the\nstride does not introduce side-effects on commoned nodes. Also, the\nfix looks for commoning of ifcmp checks that are commoned with the\nstride calculation and adjust them accordingly.\n\nFixes #10656\n\nSigned-off-by: Mohammad Nazmul Alam <mohammad.nazmul.alam@ibm.com>"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "c3f808a708708f4b995036c92f06f40d6e9a0f79", "author": {"user": {"login": "mnalam-p", "name": null}}, "url": "https://github.com/eclipse-openj9/openj9/commit/c3f808a708708f4b995036c92f06f40d6e9a0f79", "committedDate": "2020-11-19T19:50:56Z", "message": "Uncommon autosimd piv loop stride increment node\n\nIf the loop increment node is commoned, then reducing the loop by\nchanging the value of loop stride can cause unwanted bug. This is\npotentially true if the node is commoned with address calculation.\nThis commit uncommon the PIV increment node so that changing the\nstride does not introduce side-effects on commoned nodes. Also, the\nfix looks for commoning of ifcmp checks that are commoned with the\nstride calculation and adjust them accordingly.\n\nFixes #10656\n\nSigned-off-by: Mohammad Nazmul Alam <mohammad.nazmul.alam@ibm.com>"}, "afterCommit": {"oid": "4c42985cf58180dfd8d4d43075f89602a8975033", "author": {"user": {"login": "mnalam-p", "name": null}}, "url": "https://github.com/eclipse-openj9/openj9/commit/4c42985cf58180dfd8d4d43075f89602a8975033", "committedDate": "2020-11-27T20:29:22Z", "message": "Uncommon autosimd piv loop stride increment node\n\nIf the loop increment node is commoned, then reducing the loop by\nchanging the value of loop stride can cause unwanted bug. This is\npotentially true if the node is commoned with address calculation.\nThis commit uncommon the PIV increment node so that changing the\nstride does not introduce side-effects on commoned nodes. Also, the\nfix looks for commoning of ifcmp checks that are commoned with the\nstride calculation and adjust them accordingly.\n\nFixes #10656\n\nSigned-off-by: Mohammad Nazmul Alam <mohammad.nazmul.alam@ibm.com>"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "4c42985cf58180dfd8d4d43075f89602a8975033", "author": {"user": {"login": "mnalam-p", "name": null}}, "url": "https://github.com/eclipse-openj9/openj9/commit/4c42985cf58180dfd8d4d43075f89602a8975033", "committedDate": "2020-11-27T20:29:22Z", "message": "Uncommon autosimd piv loop stride increment node\n\nIf the loop increment node is commoned, then reducing the loop by\nchanging the value of loop stride can cause unwanted bug. This is\npotentially true if the node is commoned with address calculation.\nThis commit uncommon the PIV increment node so that changing the\nstride does not introduce side-effects on commoned nodes. Also, the\nfix looks for commoning of ifcmp checks that are commoned with the\nstride calculation and adjust them accordingly.\n\nFixes #10656\n\nSigned-off-by: Mohammad Nazmul Alam <mohammad.nazmul.alam@ibm.com>"}, "afterCommit": {"oid": "4d41e132673f956f65cf6224f68a4ed00483e4ae", "author": {"user": {"login": "mnalam-p", "name": null}}, "url": "https://github.com/eclipse-openj9/openj9/commit/4d41e132673f956f65cf6224f68a4ed00483e4ae", "committedDate": "2020-12-02T03:11:51Z", "message": "Uncommon autosimd piv loop stride increment node\n\nIf the loop increment node is commoned, then reducing the loop by\nchanging the value of loop stride can cause unwanted bug. This is\npotentially true if the node is commoned with address calculation.\nThis commit uncommon the PIV increment node so that changing the\nstride does not introduce side-effects on commoned nodes. Also, the\nfix looks for commoning of ifcmp checks that are commoned with the\nstride calculation and adjust them accordingly.\n\nFixes #10656\n\nSigned-off-by: Mohammad Nazmul Alam <mohammad.nazmul.alam@ibm.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "45e8afc6ac9520f08cb6739f050e16be130b2c12", "author": {"user": {"login": "mnalam-p", "name": null}}, "url": "https://github.com/eclipse-openj9/openj9/commit/45e8afc6ac9520f08cb6739f050e16be130b2c12", "committedDate": "2020-12-02T04:45:03Z", "message": "Uncommon autosimd piv loop stride increment node\n\nIf the loop increment node is commoned, then reducing the loop by\nchanging the value of loop stride can cause unwanted bug. This is\npotentially true if the node is commoned with address calculation.\nThis commit uncommon the PIV increment node so that changing the\nstride does not introduce side-effects on commoned nodes. Also, the\nfix looks for commoning of ifcmp checks that are commoned with the\nstride calculation and adjust them accordingly.\n\nFixes #10656\n\nSigned-off-by: Mohammad Nazmul Alam <mohammad.nazmul.alam@ibm.com>"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "4d41e132673f956f65cf6224f68a4ed00483e4ae", "author": {"user": {"login": "mnalam-p", "name": null}}, "url": "https://github.com/eclipse-openj9/openj9/commit/4d41e132673f956f65cf6224f68a4ed00483e4ae", "committedDate": "2020-12-02T03:11:51Z", "message": "Uncommon autosimd piv loop stride increment node\n\nIf the loop increment node is commoned, then reducing the loop by\nchanging the value of loop stride can cause unwanted bug. This is\npotentially true if the node is commoned with address calculation.\nThis commit uncommon the PIV increment node so that changing the\nstride does not introduce side-effects on commoned nodes. Also, the\nfix looks for commoning of ifcmp checks that are commoned with the\nstride calculation and adjust them accordingly.\n\nFixes #10656\n\nSigned-off-by: Mohammad Nazmul Alam <mohammad.nazmul.alam@ibm.com>"}, "afterCommit": {"oid": "45e8afc6ac9520f08cb6739f050e16be130b2c12", "author": {"user": {"login": "mnalam-p", "name": null}}, "url": "https://github.com/eclipse-openj9/openj9/commit/45e8afc6ac9520f08cb6739f050e16be130b2c12", "committedDate": "2020-12-02T04:45:03Z", "message": "Uncommon autosimd piv loop stride increment node\n\nIf the loop increment node is commoned, then reducing the loop by\nchanging the value of loop stride can cause unwanted bug. This is\npotentially true if the node is commoned with address calculation.\nThis commit uncommon the PIV increment node so that changing the\nstride does not introduce side-effects on commoned nodes. Also, the\nfix looks for commoning of ifcmp checks that are commoned with the\nstride calculation and adjust them accordingly.\n\nFixes #10656\n\nSigned-off-by: Mohammad Nazmul Alam <mohammad.nazmul.alam@ibm.com>"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4, "cost": 1, "resetAt": "2021-10-28T18:00:02Z"}}}