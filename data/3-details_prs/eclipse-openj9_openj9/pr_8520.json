{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0MzcyMDUwNjI3", "number": 8520, "title": "Handle jitNewValue in code generators", "bodyText": "Because newvalue support is not implemented in the code generators, the opcode is lowered to new. When lowering happens, the symbol on the new is set to be the same as the one for newvalue, namely jitNewValue.\nAs a result, new evaluators must check the node's symbol to determine if the allocation is for a value type.\nTo avoid having to implement full support for inline value type allocations, for now, we unconditionally call the JIT helper. While not ideal for performance, it is a necessary step in incrementally implementing value types.\nNote that the AARCH64 code generator already calls whatever helper is set on the new node unconditionally, so no special handling for jitNewValue is required.", "createdAt": "2020-02-06T18:37:19Z", "url": "https://github.com/eclipse-openj9/openj9/pull/8520", "merged": true, "mergeCommit": {"oid": "37f94dc7a840a1928f432d7f97bf69f9a0cf427e"}, "closed": true, "closedAt": "2020-02-14T17:11:40Z", "author": {"login": "Leonardo2718"}, "timelineItems": {"totalCount": 14, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcBxiuYgBqjMwMTU1MzA4OTU=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcDqlDCABqjMwMzE5MzE3OTQ=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "9e1318dafe770180c29e86955ff1bb11b61b6085", "author": {"user": {"login": "Leonardo2718", "name": null}}, "url": "https://github.com/eclipse-openj9/openj9/commit/9e1318dafe770180c29e86955ff1bb11b61b6085", "committedDate": "2020-02-06T18:34:59Z", "message": "Remove unnecessary platform guards on POWER and ARM\n\nSome file in the POWER and ARM code generators are guarded with\nTR_TARGET_ARM and TR_TARGET_POWER, respectively. These are unnecessary\nbecause those files are only ever built on their respective platform.\n\nSigned-off-by: Leonardo Banderali <leonardo2718@protonmail.com>"}, "afterCommit": {"oid": "ec63d09bb1d45d8153cead527d031cba252a8181", "author": {"user": {"login": "Leonardo2718", "name": null}}, "url": "https://github.com/eclipse-openj9/openj9/commit/ec63d09bb1d45d8153cead527d031cba252a8181", "committedDate": "2020-02-06T21:23:07Z", "message": "Remove unnecessary platform guards on POWER and ARM\n\nSome file in the POWER and ARM code generators are guarded with\nTR_TARGET_ARM and TR_TARGET_POWER, respectively. These are unnecessary\nbecause those files are only ever built on their respective platform.\n\nSigned-off-by: Leonardo Banderali <leonardo2718@protonmail.com>"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "ec63d09bb1d45d8153cead527d031cba252a8181", "author": {"user": {"login": "Leonardo2718", "name": null}}, "url": "https://github.com/eclipse-openj9/openj9/commit/ec63d09bb1d45d8153cead527d031cba252a8181", "committedDate": "2020-02-06T21:23:07Z", "message": "Remove unnecessary platform guards on POWER and ARM\n\nSome file in the POWER and ARM code generators are guarded with\nTR_TARGET_ARM and TR_TARGET_POWER, respectively. These are unnecessary\nbecause those files are only ever built on their respective platform.\n\nSigned-off-by: Leonardo Banderali <leonardo2718@protonmail.com>"}, "afterCommit": {"oid": "30d16a67480fedb35a85098fa8b08912d77b5884", "author": {"user": {"login": "Leonardo2718", "name": null}}, "url": "https://github.com/eclipse-openj9/openj9/commit/30d16a67480fedb35a85098fa8b08912d77b5884", "committedDate": "2020-02-06T21:28:44Z", "message": "Remove unnecessary platform guards on POWER and ARM\n\nSome file in the POWER and ARM code generators are guarded with\nTR_TARGET_ARM and TR_TARGET_POWER, respectively. These are unnecessary\nbecause those files are only ever built on their respective platform.\n\nSigned-off-by: Leonardo Banderali <leonardo2718@protonmail.com>"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "30d16a67480fedb35a85098fa8b08912d77b5884", "author": {"user": {"login": "Leonardo2718", "name": null}}, "url": "https://github.com/eclipse-openj9/openj9/commit/30d16a67480fedb35a85098fa8b08912d77b5884", "committedDate": "2020-02-06T21:28:44Z", "message": "Remove unnecessary platform guards on POWER and ARM\n\nSome file in the POWER and ARM code generators are guarded with\nTR_TARGET_ARM and TR_TARGET_POWER, respectively. These are unnecessary\nbecause those files are only ever built on their respective platform.\n\nSigned-off-by: Leonardo Banderali <leonardo2718@protonmail.com>"}, "afterCommit": {"oid": "ecf8e52e205aafdef9718e92b2f1ed5a14a8deff", "author": {"user": {"login": "Leonardo2718", "name": null}}, "url": "https://github.com/eclipse-openj9/openj9/commit/ecf8e52e205aafdef9718e92b2f1ed5a14a8deff", "committedDate": "2020-02-06T21:31:19Z", "message": "Remove unnecessary platform guards on POWER and ARM\n\nSome file in the POWER and ARM code generators are guarded with\nTR_TARGET_ARM and TR_TARGET_POWER, respectively. These are unnecessary\nbecause those files are only ever built on their respective platform.\n\nSigned-off-by: Leonardo Banderali <leonardo2718@protonmail.com>"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzU1OTkxODg4", "url": "https://github.com/eclipse-openj9/openj9/pull/8520#pullrequestreview-355991888", "createdAt": "2020-02-10T14:45:46Z", "commit": {"oid": "ecf8e52e205aafdef9718e92b2f1ed5a14a8deff"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzU2MDQyMjg4", "url": "https://github.com/eclipse-openj9/openj9/pull/8520#pullrequestreview-356042288", "createdAt": "2020-02-10T15:44:31Z", "commit": {"oid": "ecf8e52e205aafdef9718e92b2f1ed5a14a8deff"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xMFQxNTo0NDozMVrOFnrAkA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xMFQxNTo0NDozMVrOFnrAkA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NzE0MzQ0MA==", "bodyText": "Given the PR description this is fine. I hope that this will be refactored into a separate evaluator eventually though.", "url": "https://github.com/eclipse-openj9/openj9/pull/8520#discussion_r377143440", "createdAt": "2020-02-10T15:44:31Z", "author": {"login": "fjeremic"}, "path": "runtime/compiler/z/codegen/J9TreeEvaluator.cpp", "diffHunk": "@@ -2873,7 +2873,13 @@ J9::Z::TreeEvaluator::generateHelperCallForVMNewEvaluators(TR::Node *node, TR::C\n TR::Register *\n J9::Z::TreeEvaluator::newObjectEvaluator(TR::Node * node, TR::CodeGenerator * cg)\n    {\n-   if (cg->comp()->suppressAllocationInlining())\n+   // If the helper symbol set on the node is TR_jitNewValue, we are (expecting to be)\n+   // dealing with a value type. Since we do not fully support value types yet, always\n+   // call the JIT helper to do the allocation.\n+   //\n+   auto* comp = cg->comp();\n+   if (cg->comp()->suppressAllocationInlining() ||\n+       (TR::Compiler->om.areValueTypesEnabled() && node->getSymbolReference() == comp->getSymRefTab()->findOrCreateNewValueSymbolRef(comp->getMethodSymbol())))\n       return generateHelperCallForVMNewEvaluators(node, cg);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ecf8e52e205aafdef9718e92b2f1ed5a14a8deff"}, "originalPosition": 12}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzU2MDQyMzQz", "url": "https://github.com/eclipse-openj9/openj9/pull/8520#pullrequestreview-356042343", "createdAt": "2020-02-10T15:44:35Z", "commit": {"oid": "ecf8e52e205aafdef9718e92b2f1ed5a14a8deff"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzU2MzQ0NTY0", "url": "https://github.com/eclipse-openj9/openj9/pull/8520#pullrequestreview-356344564", "createdAt": "2020-02-10T23:41:53Z", "commit": {"oid": "ecf8e52e205aafdef9718e92b2f1ed5a14a8deff"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "ecf8e52e205aafdef9718e92b2f1ed5a14a8deff", "author": {"user": {"login": "Leonardo2718", "name": null}}, "url": "https://github.com/eclipse-openj9/openj9/commit/ecf8e52e205aafdef9718e92b2f1ed5a14a8deff", "committedDate": "2020-02-06T21:31:19Z", "message": "Remove unnecessary platform guards on POWER and ARM\n\nSome file in the POWER and ARM code generators are guarded with\nTR_TARGET_ARM and TR_TARGET_POWER, respectively. These are unnecessary\nbecause those files are only ever built on their respective platform.\n\nSigned-off-by: Leonardo Banderali <leonardo2718@protonmail.com>"}, "afterCommit": {"oid": "ec8fd520626297089d9794e7c574f3c84ea99070", "author": {"user": {"login": "Leonardo2718", "name": null}}, "url": "https://github.com/eclipse-openj9/openj9/commit/ec8fd520626297089d9794e7c574f3c84ea99070", "committedDate": "2020-02-11T15:51:07Z", "message": "Remove unnecessary platform guards on POWER and ARM\n\nSome file in the POWER and ARM code generators are guarded with\nTR_TARGET_ARM and TR_TARGET_POWER, respectively. These are unnecessary\nbecause those files are only ever built on their respective platform.\n\nSigned-off-by: Leonardo Banderali <leonardo2718@protonmail.com>"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzU3NDQ1Mzk2", "url": "https://github.com/eclipse-openj9/openj9/pull/8520#pullrequestreview-357445396", "createdAt": "2020-02-12T13:23:04Z", "commit": {"oid": "ec8fd520626297089d9794e7c574f3c84ea99070"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xMlQxMzoyMzowNVrOFouTKg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xMlQxMzoyMzowNVrOFouTKg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3ODI0NTkzMA==", "bodyText": "Can you please put the type of TR::Compilation rather than auto - doing so aids readability and ensures that if we need to refactor later we can support from the compiler type checker.", "url": "https://github.com/eclipse-openj9/openj9/pull/8520#discussion_r378245930", "createdAt": "2020-02-12T13:23:05Z", "author": {"login": "andrewcraik"}, "path": "runtime/compiler/p/codegen/J9TreeEvaluator.cpp", "diffHunk": "@@ -2164,7 +2163,13 @@ TR::Register *J9::Power::TreeEvaluator::checkcastAndNULLCHKEvaluator(TR::Node *n\n \n TR::Register *J9::Power::TreeEvaluator::newObjectEvaluator(TR::Node *node, TR::CodeGenerator *cg)\n    {\n-   if (cg->comp()->suppressAllocationInlining())\n+   // If the helper symbol set on the node is TR_newValue, we are (expecting to be)\n+   // dealing with a value type. Since we do not fully support value types yet, always\n+   // call the JIT helper to do the allocation.\n+   //\n+   auto* comp = cg->comp();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ec8fd520626297089d9794e7c574f3c84ea99070"}, "originalPosition": 17}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "005afc1cbbc491923b444121732c537d1c44829c", "author": {"user": {"login": "Leonardo2718", "name": null}}, "url": "https://github.com/eclipse-openj9/openj9/commit/005afc1cbbc491923b444121732c537d1c44829c", "committedDate": "2020-02-12T18:20:13Z", "message": "Add Object Model query to check for value types support\n\nThis new query allows checking for value types support with a function\ncall instead of an #ifdef. Although it is currently a compile type\noption, value types support will eventually be decided at runtime, so\nusing a function call now is preferable to using an #ifdef everywhere.\n\nSigned-off-by: Leonardo Banderali <leonardo2718@protonmail.com>"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "ec8fd520626297089d9794e7c574f3c84ea99070", "author": {"user": {"login": "Leonardo2718", "name": null}}, "url": "https://github.com/eclipse-openj9/openj9/commit/ec8fd520626297089d9794e7c574f3c84ea99070", "committedDate": "2020-02-11T15:51:07Z", "message": "Remove unnecessary platform guards on POWER and ARM\n\nSome file in the POWER and ARM code generators are guarded with\nTR_TARGET_ARM and TR_TARGET_POWER, respectively. These are unnecessary\nbecause those files are only ever built on their respective platform.\n\nSigned-off-by: Leonardo Banderali <leonardo2718@protonmail.com>"}, "afterCommit": {"oid": "c78cc8805fa8d9126c73715a1c9a20d076daeaf1", "author": {"user": {"login": "Leonardo2718", "name": null}}, "url": "https://github.com/eclipse-openj9/openj9/commit/c78cc8805fa8d9126c73715a1c9a20d076daeaf1", "committedDate": "2020-02-12T18:21:28Z", "message": "Remove unnecessary platform guards on POWER and ARM\n\nSome file in the POWER and ARM code generators are guarded with\nTR_TARGET_ARM and TR_TARGET_POWER, respectively. These are unnecessary\nbecause those files are only ever built on their respective platform.\n\nSigned-off-by: Leonardo Banderali <leonardo2718@protonmail.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "1cae75667c752c93b2e193f0eb367690f0d3e092", "author": {"user": {"login": "Leonardo2718", "name": null}}, "url": "https://github.com/eclipse-openj9/openj9/commit/1cae75667c752c93b2e193f0eb367690f0d3e092", "committedDate": "2020-02-12T18:24:09Z", "message": "Handle jitNewValue in code generators\n\nBecause `newvalue` support is not implemented in the code generators,\nthe opcode is lowered to `new`. When lowering happens, the symbol on\nthe `new` is set to be the same as the one for `newvalue`, namely\njitNewValue.\n\nAs a result, `new` evaluators must check the node's symbol to determine\nif the allocation is for a value type.\n\nTo avoid having to implement full support for inline value type\nallocations, for now, we unconditionally call the JIT helper. While not\nideal for performance, it is a necessary step in incrementally\nimplementing value types.\n\nNote that the AARCH64 code generator already calls whatever helper is\nset on the `new` node unconditionally, so no special handling for\njitNewValue is required.\n\nSigned-off-by: Leonardo Banderali <leonardo2718@protonmail.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ad62d30f8fbb78f25cad8e2fba652fc01f827806", "author": {"user": {"login": "Leonardo2718", "name": null}}, "url": "https://github.com/eclipse-openj9/openj9/commit/ad62d30f8fbb78f25cad8e2fba652fc01f827806", "committedDate": "2020-02-12T18:24:14Z", "message": "Remove unnecessary platform guards on POWER and ARM\n\nSome file in the POWER and ARM code generators are guarded with\nTR_TARGET_ARM and TR_TARGET_POWER, respectively. These are unnecessary\nbecause those files are only ever built on their respective platform.\n\nSigned-off-by: Leonardo Banderali <leonardo2718@protonmail.com>"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "c78cc8805fa8d9126c73715a1c9a20d076daeaf1", "author": {"user": {"login": "Leonardo2718", "name": null}}, "url": "https://github.com/eclipse-openj9/openj9/commit/c78cc8805fa8d9126c73715a1c9a20d076daeaf1", "committedDate": "2020-02-12T18:21:28Z", "message": "Remove unnecessary platform guards on POWER and ARM\n\nSome file in the POWER and ARM code generators are guarded with\nTR_TARGET_ARM and TR_TARGET_POWER, respectively. These are unnecessary\nbecause those files are only ever built on their respective platform.\n\nSigned-off-by: Leonardo Banderali <leonardo2718@protonmail.com>"}, "afterCommit": {"oid": "ad62d30f8fbb78f25cad8e2fba652fc01f827806", "author": {"user": {"login": "Leonardo2718", "name": null}}, "url": "https://github.com/eclipse-openj9/openj9/commit/ad62d30f8fbb78f25cad8e2fba652fc01f827806", "committedDate": "2020-02-12T18:24:14Z", "message": "Remove unnecessary platform guards on POWER and ARM\n\nSome file in the POWER and ARM code generators are guarded with\nTR_TARGET_ARM and TR_TARGET_POWER, respectively. These are unnecessary\nbecause those files are only ever built on their respective platform.\n\nSigned-off-by: Leonardo Banderali <leonardo2718@protonmail.com>"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 761, "cost": 1, "resetAt": "2021-10-28T18:00:02Z"}}}