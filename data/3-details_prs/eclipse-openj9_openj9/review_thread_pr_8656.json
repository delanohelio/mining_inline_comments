{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0Mzc5NzQwOTk0", "number": 8656, "reviewThreads": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yNlQxNDozOTo0NFrODjGeuw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yNlQxNzowOTozMFrODjKbpw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjM4MTMyOTIzOnYy", "diffSide": "LEFT", "path": "runtime/compiler/build/toolcfg/gnu/common.mk", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yNlQxNDozOTo0NFrOFuuDXA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yNlQxNjozMzo0MlrOFuy87Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NDUzMzM0MA==", "bodyText": "Don't we need these defines? Are the definitions added in some other place?", "url": "https://github.com/eclipse-openj9/openj9/pull/8656#discussion_r384533340", "createdAt": "2020-02-26T14:39:44Z", "author": {"login": "mpirvu"}, "path": "runtime/compiler/build/toolcfg/gnu/common.mk", "diffHunk": "@@ -138,10 +138,6 @@ ifeq ($(HOST_ARCH),x)\n         CX_DEFINES+=J9HAMMER\n         CX_FLAGS+=-m64 -fPIC\n     endif\n-\n-    ifneq ($(JITSERVER_SUPPORT),)", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b9c1fd8d0bd0668ea3ead295978ad57ab3214b0e"}, "originalPosition": 20}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NDYxMzYxMw==", "bodyText": "This check is for defining the macro JITSERVER_SUPPORT. We should instead use J9VM_OPT_JITSERVER which gets defined in j9cfg.h (when using UMA build system) or by CMakeLists.txt in VM and JIT.\nNormally j9cfg.h gets included via j9.h and any code using J9VM_OPT_JITSERVER should now include j9.h.\nBefore this PR, JIT files didn't include j9.h if there isn't any dependency on it, but with this PR if the JIT files need to see J9VM_OPT_JITSERVER, then j9.h needs to be included.\nA case in point is https://github.com/eclipse/openj9/pull/8656/files#diff-65a548d2a6dcefcbcdd234568cac76ab where I have to explicitly include j9.h.", "url": "https://github.com/eclipse-openj9/openj9/pull/8656#discussion_r384613613", "createdAt": "2020-02-26T16:33:42Z", "author": {"login": "ashu-mehra"}, "path": "runtime/compiler/build/toolcfg/gnu/common.mk", "diffHunk": "@@ -138,10 +138,6 @@ ifeq ($(HOST_ARCH),x)\n         CX_DEFINES+=J9HAMMER\n         CX_FLAGS+=-m64 -fPIC\n     endif\n-\n-    ifneq ($(JITSERVER_SUPPORT),)", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NDUzMzM0MA=="}, "originalCommit": {"oid": "b9c1fd8d0bd0668ea3ead295978ad57ab3214b0e"}, "originalPosition": 20}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjM4MTkyNDQ3OnYy", "diffSide": "RIGHT", "path": "runtime/compiler/CMakeLists.txt", "isResolved": true, "comments": {"totalCount": 10, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yNlQxNjo1NTo0N1rOFuz2Kw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yN1QxNjo0NDo0MFrOFvYt7Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NDYyODI2Nw==", "bodyText": "Isn't this now redundant given J9VM_OPT_JITSERVER is defined in runtime/CMakeLists.txt?", "url": "https://github.com/eclipse-openj9/openj9/pull/8656#discussion_r384628267", "createdAt": "2020-02-26T16:55:47Z", "author": {"login": "keithc-ca"}, "path": "runtime/compiler/CMakeLists.txt", "diffHunk": "@@ -80,10 +80,10 @@ add_custom_command(\n )\n add_custom_target(j9jit_tracegen DEPENDS ${CMAKE_CURRENT_SOURCE_DIR}/env/ut_j9jit.h)\n \n-# JITSERVER_SUPPORT and protobuf\n-if(JITSERVER_SUPPORT)\n+# J9VM_OPT_JITSERVER and protobuf\n+if(J9VM_OPT_JITSERVER)\n \tmessage(STATUS \"JITServer is supported\")\n-\tadd_definitions(-DJITSERVER_SUPPORT)\n+\tadd_definitions(-DJ9VM_OPT_JITSERVER)", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b9c1fd8d0bd0668ea3ead295978ad57ab3214b0e"}, "originalPosition": 17}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NDY3MDQ2MA==", "bodyText": "I am not sure if defines in runtime/CMakeLists.txt propagate to JIT CMakeLists.txt. If so, then yes it should be removed.\n@keithc-ca Can you please confirm it.", "url": "https://github.com/eclipse-openj9/openj9/pull/8656#discussion_r384670460", "createdAt": "2020-02-26T18:09:36Z", "author": {"login": "ashu-mehra"}, "path": "runtime/compiler/CMakeLists.txt", "diffHunk": "@@ -80,10 +80,10 @@ add_custom_command(\n )\n add_custom_target(j9jit_tracegen DEPENDS ${CMAKE_CURRENT_SOURCE_DIR}/env/ut_j9jit.h)\n \n-# JITSERVER_SUPPORT and protobuf\n-if(JITSERVER_SUPPORT)\n+# J9VM_OPT_JITSERVER and protobuf\n+if(J9VM_OPT_JITSERVER)\n \tmessage(STATUS \"JITServer is supported\")\n-\tadd_definitions(-DJITSERVER_SUPPORT)\n+\tadd_definitions(-DJ9VM_OPT_JITSERVER)", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NDYyODI2Nw=="}, "originalCommit": {"oid": "b9c1fd8d0bd0668ea3ead295978ad57ab3214b0e"}, "originalPosition": 17}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NDY4NTg3NA==", "bodyText": "@dnakamura might know off the top of his head, but please try without what I hope is redundant.", "url": "https://github.com/eclipse-openj9/openj9/pull/8656#discussion_r384685874", "createdAt": "2020-02-26T18:37:56Z", "author": {"login": "keithc-ca"}, "path": "runtime/compiler/CMakeLists.txt", "diffHunk": "@@ -80,10 +80,10 @@ add_custom_command(\n )\n add_custom_target(j9jit_tracegen DEPENDS ${CMAKE_CURRENT_SOURCE_DIR}/env/ut_j9jit.h)\n \n-# JITSERVER_SUPPORT and protobuf\n-if(JITSERVER_SUPPORT)\n+# J9VM_OPT_JITSERVER and protobuf\n+if(J9VM_OPT_JITSERVER)\n \tmessage(STATUS \"JITServer is supported\")\n-\tadd_definitions(-DJITSERVER_SUPPORT)\n+\tadd_definitions(-DJ9VM_OPT_JITSERVER)", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NDYyODI2Nw=="}, "originalCommit": {"oid": "b9c1fd8d0bd0668ea3ead295978ad57ab3214b0e"}, "originalPosition": 17}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NDY5Mzc5Nw==", "bodyText": "Instead of using an add_definition the proper way would be to add #cmakedefine J9VM_OPT_JITSERVER to runtime/include/j9cfg.h.in", "url": "https://github.com/eclipse-openj9/openj9/pull/8656#discussion_r384693797", "createdAt": "2020-02-26T18:52:29Z", "author": {"login": "dnakamura"}, "path": "runtime/compiler/CMakeLists.txt", "diffHunk": "@@ -80,10 +80,10 @@ add_custom_command(\n )\n add_custom_target(j9jit_tracegen DEPENDS ${CMAKE_CURRENT_SOURCE_DIR}/env/ut_j9jit.h)\n \n-# JITSERVER_SUPPORT and protobuf\n-if(JITSERVER_SUPPORT)\n+# J9VM_OPT_JITSERVER and protobuf\n+if(J9VM_OPT_JITSERVER)\n \tmessage(STATUS \"JITServer is supported\")\n-\tadd_definitions(-DJITSERVER_SUPPORT)\n+\tadd_definitions(-DJ9VM_OPT_JITSERVER)", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NDYyODI2Nw=="}, "originalCommit": {"oid": "b9c1fd8d0bd0668ea3ead295978ad57ab3214b0e"}, "originalPosition": 17}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NDY5NTI4MA==", "bodyText": "I think that will play better with DDR should J9VM_OPT_JITSERVER ever need to be used there.", "url": "https://github.com/eclipse-openj9/openj9/pull/8656#discussion_r384695280", "createdAt": "2020-02-26T18:55:11Z", "author": {"login": "keithc-ca"}, "path": "runtime/compiler/CMakeLists.txt", "diffHunk": "@@ -80,10 +80,10 @@ add_custom_command(\n )\n add_custom_target(j9jit_tracegen DEPENDS ${CMAKE_CURRENT_SOURCE_DIR}/env/ut_j9jit.h)\n \n-# JITSERVER_SUPPORT and protobuf\n-if(JITSERVER_SUPPORT)\n+# J9VM_OPT_JITSERVER and protobuf\n+if(J9VM_OPT_JITSERVER)\n \tmessage(STATUS \"JITServer is supported\")\n-\tadd_definitions(-DJITSERVER_SUPPORT)\n+\tadd_definitions(-DJ9VM_OPT_JITSERVER)", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NDYyODI2Nw=="}, "originalCommit": {"oid": "b9c1fd8d0bd0668ea3ead295978ad57ab3214b0e"}, "originalPosition": 17}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NDgwMjE3NA==", "bodyText": "@dnakamura how would cmake know whether to define or undef J9VM_OPT_JITSERVER in the generated j9cfg.h file?", "url": "https://github.com/eclipse-openj9/openj9/pull/8656#discussion_r384802174", "createdAt": "2020-02-26T22:19:07Z", "author": {"login": "ashu-mehra"}, "path": "runtime/compiler/CMakeLists.txt", "diffHunk": "@@ -80,10 +80,10 @@ add_custom_command(\n )\n add_custom_target(j9jit_tracegen DEPENDS ${CMAKE_CURRENT_SOURCE_DIR}/env/ut_j9jit.h)\n \n-# JITSERVER_SUPPORT and protobuf\n-if(JITSERVER_SUPPORT)\n+# J9VM_OPT_JITSERVER and protobuf\n+if(J9VM_OPT_JITSERVER)\n \tmessage(STATUS \"JITServer is supported\")\n-\tadd_definitions(-DJITSERVER_SUPPORT)\n+\tadd_definitions(-DJ9VM_OPT_JITSERVER)", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NDYyODI2Nw=="}, "originalCommit": {"oid": "b9c1fd8d0bd0668ea3ead295978ad57ab3214b0e"}, "originalPosition": 17}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NDg0MTAzMw==", "bodyText": "Would I need to add the following towards the end of cmake/caches/common.cmake:\nif (J9VM_OPT_JITSERVER)\n    set(J9VM_OPT_JITSERVER ON CACHE BOOL \"\")\nendif()\n\nand an entry in cmake/options.cmake:\noption(J9VM_OPT_JITSERVER, \"some text\")", "url": "https://github.com/eclipse-openj9/openj9/pull/8656#discussion_r384841033", "createdAt": "2020-02-27T00:03:57Z", "author": {"login": "ashu-mehra"}, "path": "runtime/compiler/CMakeLists.txt", "diffHunk": "@@ -80,10 +80,10 @@ add_custom_command(\n )\n add_custom_target(j9jit_tracegen DEPENDS ${CMAKE_CURRENT_SOURCE_DIR}/env/ut_j9jit.h)\n \n-# JITSERVER_SUPPORT and protobuf\n-if(JITSERVER_SUPPORT)\n+# J9VM_OPT_JITSERVER and protobuf\n+if(J9VM_OPT_JITSERVER)\n \tmessage(STATUS \"JITServer is supported\")\n-\tadd_definitions(-DJITSERVER_SUPPORT)\n+\tadd_definitions(-DJ9VM_OPT_JITSERVER)", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NDYyODI2Nw=="}, "originalCommit": {"oid": "b9c1fd8d0bd0668ea3ead295978ad57ab3214b0e"}, "originalPosition": 17}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NTEyODMxNg==", "bodyText": "In some cmake file, we want\nset(J9VM_OPT_JITSERVER OFF CACHE BOOL \"Enable JIT Server\")\n\nThis tells cmake about the flag so it know what to do with #cmakedefine J9VM_OPT_JITSERVER.\nNotice the default is OFF; it can be modified by a command-line option or via logic in cmake files.", "url": "https://github.com/eclipse-openj9/openj9/pull/8656#discussion_r385128316", "createdAt": "2020-02-27T13:35:06Z", "author": {"login": "keithc-ca"}, "path": "runtime/compiler/CMakeLists.txt", "diffHunk": "@@ -80,10 +80,10 @@ add_custom_command(\n )\n add_custom_target(j9jit_tracegen DEPENDS ${CMAKE_CURRENT_SOURCE_DIR}/env/ut_j9jit.h)\n \n-# JITSERVER_SUPPORT and protobuf\n-if(JITSERVER_SUPPORT)\n+# J9VM_OPT_JITSERVER and protobuf\n+if(J9VM_OPT_JITSERVER)\n \tmessage(STATUS \"JITServer is supported\")\n-\tadd_definitions(-DJITSERVER_SUPPORT)\n+\tadd_definitions(-DJ9VM_OPT_JITSERVER)", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NDYyODI2Nw=="}, "originalCommit": {"oid": "b9c1fd8d0bd0668ea3ead295978ad57ab3214b0e"}, "originalPosition": 17}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NTE0MTYwOQ==", "bodyText": "I think I am getting confused with env variable J9VM_OPT_JITSERVER and cmake variable J9VM_OPT_JITSERVER.\nLets say I have added set(J9VM_OPT_JITSERVER OFF CACHE BOOL \"Enable JIT Server\") to cmake/caches/common.cmake.\nNow if env variable J9VM_OPT_JITSERVER is defined, is that sufficient for cmake to convert #cmakedefine J9VM_OPT_JITSERVER to #define J9VM_OPT_JITSERVER in the header file?", "url": "https://github.com/eclipse-openj9/openj9/pull/8656#discussion_r385141609", "createdAt": "2020-02-27T13:58:27Z", "author": {"login": "ashu-mehra"}, "path": "runtime/compiler/CMakeLists.txt", "diffHunk": "@@ -80,10 +80,10 @@ add_custom_command(\n )\n add_custom_target(j9jit_tracegen DEPENDS ${CMAKE_CURRENT_SOURCE_DIR}/env/ut_j9jit.h)\n \n-# JITSERVER_SUPPORT and protobuf\n-if(JITSERVER_SUPPORT)\n+# J9VM_OPT_JITSERVER and protobuf\n+if(J9VM_OPT_JITSERVER)\n \tmessage(STATUS \"JITServer is supported\")\n-\tadd_definitions(-DJITSERVER_SUPPORT)\n+\tadd_definitions(-DJ9VM_OPT_JITSERVER)", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NDYyODI2Nw=="}, "originalCommit": {"oid": "b9c1fd8d0bd0668ea3ead295978ad57ab3214b0e"}, "originalPosition": 17}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NTIzMjM2NQ==", "bodyText": "In the cmake case, it is not an environment variable, but this command-line option that affects that flag:\nCMAKE_ARGS += -DJ9VM_OPT_JITSERVER=ON", "url": "https://github.com/eclipse-openj9/openj9/pull/8656#discussion_r385232365", "createdAt": "2020-02-27T16:44:40Z", "author": {"login": "keithc-ca"}, "path": "runtime/compiler/CMakeLists.txt", "diffHunk": "@@ -80,10 +80,10 @@ add_custom_command(\n )\n add_custom_target(j9jit_tracegen DEPENDS ${CMAKE_CURRENT_SOURCE_DIR}/env/ut_j9jit.h)\n \n-# JITSERVER_SUPPORT and protobuf\n-if(JITSERVER_SUPPORT)\n+# J9VM_OPT_JITSERVER and protobuf\n+if(J9VM_OPT_JITSERVER)\n \tmessage(STATUS \"JITServer is supported\")\n-\tadd_definitions(-DJITSERVER_SUPPORT)\n+\tadd_definitions(-DJ9VM_OPT_JITSERVER)", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NDYyODI2Nw=="}, "originalCommit": {"oid": "b9c1fd8d0bd0668ea3ead295978ad57ab3214b0e"}, "originalPosition": 17}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjM4MTk3NjcxOnYy", "diffSide": "RIGHT", "path": "runtime/compiler/runtime/CMakeLists.txt", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yNlQxNzowOTozMFrOFu0W-A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yNlQxNzowOTozMFrOFu0W-A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NDYzNjY2NA==", "bodyText": "Can you please fix the inconsistent indentation while you're here.", "url": "https://github.com/eclipse-openj9/openj9/pull/8656#discussion_r384636664", "createdAt": "2020-02-26T17:09:30Z", "author": {"login": "keithc-ca"}, "path": "runtime/compiler/runtime/CMakeLists.txt", "diffHunk": "@@ -60,7 +60,7 @@ j9jit_files(\n \t${omr_SOURCE_DIR}/compiler/runtime/OMRRuntimeAssumptions.cpp\n )\n \n-if(JITSERVER_SUPPORT)\n+if(J9VM_OPT_JITSERVER)\n \tj9jit_files(\n                 runtime/CompileService.cpp\n \t\truntime/JITClientSession.cpp", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b9c1fd8d0bd0668ea3ead295978ad57ab3214b0e"}, "originalPosition": 15}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 611, "cost": 1, "resetAt": "2021-11-12T13:16:51Z"}}}