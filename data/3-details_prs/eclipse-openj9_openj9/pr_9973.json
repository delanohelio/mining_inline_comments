{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDM4MDE2NjE1", "number": 9973, "title": "Do not enter class segment mutex inside read mutex", "bodyText": "We always update the romclass segment at the end of\nSH_CacheMap:findROMClass() if a class is returned. There is no\nneed to update romclass segment in other places in findROMClass().\nFixes #9893\nSigned-off-by: Hang Shao hangshao@ca.ibm.com", "createdAt": "2020-06-22T15:24:14Z", "url": "https://github.com/eclipse-openj9/openj9/pull/9973", "merged": true, "mergeCommit": {"oid": "eab02eb6ca7b7784ece566d37a9d50141bd3aebc"}, "closed": true, "closedAt": "2020-06-22T22:31:01Z", "author": {"login": "hangshao0"}, "timelineItems": {"totalCount": 6, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABctyiNzABqjM0Njg5MTgyODU=", "endCursor": "Y3Vyc29yOnYyOpPPAAABct4nwdgFqTQzNTMxNzY4OA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "f0c3376fd35ef42c016dc38b77a76952bad47b3e", "author": {"user": {"login": "hangshao0", "name": "Hang Shao"}}, "url": "https://github.com/eclipse-openj9/openj9/commit/f0c3376fd35ef42c016dc38b77a76952bad47b3e", "committedDate": "2020-06-22T15:22:38Z", "message": "Do not enter class segment mutex inside read mutex.\n\nWe always update the romclass segment at the end of\nSH_CacheMap:findROMClass() if a class is returned. There is no \nneed to update romclass segment in other places in findROMClass().\n\nFixes #9893\n\nSigned-off-by: Hang Shao <hangshao@ca.ibm.com>"}, "afterCommit": {"oid": "e6ab26f6599b7db8b51767312d4dc13a60f1ebf1", "author": {"user": {"login": "hangshao0", "name": "Hang Shao"}}, "url": "https://github.com/eclipse-openj9/openj9/commit/e6ab26f6599b7db8b51767312d4dc13a60f1ebf1", "committedDate": "2020-06-22T15:25:02Z", "message": "Do not enter class segment mutex inside read mutex\n\nWe always update the romclass segment at the end of\nSH_CacheMap:findROMClass() if a class is returned. There is no \nneed to update romclass segment in other places in findROMClass().\n\nFixes #9893\n\nSigned-off-by: Hang Shao <hangshao@ca.ibm.com>"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "e6ab26f6599b7db8b51767312d4dc13a60f1ebf1", "author": {"user": {"login": "hangshao0", "name": "Hang Shao"}}, "url": "https://github.com/eclipse-openj9/openj9/commit/e6ab26f6599b7db8b51767312d4dc13a60f1ebf1", "committedDate": "2020-06-22T15:25:02Z", "message": "Do not enter class segment mutex inside read mutex\n\nWe always update the romclass segment at the end of\nSH_CacheMap:findROMClass() if a class is returned. There is no \nneed to update romclass segment in other places in findROMClass().\n\nFixes #9893\n\nSigned-off-by: Hang Shao <hangshao@ca.ibm.com>"}, "afterCommit": {"oid": "7934efe4b73b20b6294bb2f502f00e0e98255538", "author": {"user": {"login": "hangshao0", "name": "Hang Shao"}}, "url": "https://github.com/eclipse-openj9/openj9/commit/7934efe4b73b20b6294bb2f502f00e0e98255538", "committedDate": "2020-06-22T15:26:33Z", "message": "Do not enter class segment mutex inside read mutex\n\nWe always update the romclass segment at the end of\nSH_CacheMap:findROMClass() if a class is returned. There is no \nneed to update romclass segment in other places in findROMClass().\n\nFixes #9893\n\nSigned-off-by: Hang Shao <hangshao@ca.ibm.com>"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDM1MTM3Njcz", "url": "https://github.com/eclipse-openj9/openj9/pull/9973#pullrequestreview-435137673", "createdAt": "2020-06-22T17:35:02Z", "commit": {"oid": "7934efe4b73b20b6294bb2f502f00e0e98255538"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yMlQxNzozNTowMlrOGnKiAg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yMlQxNzozNTowMlrOGnKiAg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MzcyMDE5NA==", "bodyText": "Since the code is modified, the constant here and the next change should be on the left.", "url": "https://github.com/eclipse-openj9/openj9/pull/9973#discussion_r443720194", "createdAt": "2020-06-22T17:35:02Z", "author": {"login": "pshipton"}, "path": "runtime/shared_common/CacheMap.cpp", "diffHunk": "@@ -1775,21 +1774,8 @@ SH_CacheMap::runEntryPointChecks(J9VMThread* currentThread, void* address, const\n \t\t\t}\n \t\t}\n \t}\n-\t\n-\tif (!hasClassSegmentMutex) {\n-\t\tif (acquireClassSegmentMutex) {\n-\t\t\tTrc_SHR_Assert_False(_ccHead->hasWriteMutex(currentThread));\n-\t\t\tenterLocalMutex(currentThread, currentThread->javaVM->classMemorySegments->segmentMutex, \"class segment mutex\", \"CM runEntryPointChecks\");\n-\t\t\tclassSegmentMutexAcquired = true;\n-\t\t\thasClassSegmentMutex = true;\n-\t\t}\n-\t}\n-\titemsAdded = refreshHashtables(currentThread, hasClassSegmentMutex);\n-\tif (classSegmentMutexAcquired) {\n-\t\texitLocalMutex(currentThread, currentThread->javaVM->classMemorySegments->segmentMutex, \"class segment mutex\", \"CM runEntryPointChecks\");\n-\t}\n \n-\tif (-1 == itemsAdded) {\n+\tif ((itemsAdded = refreshHashtables(currentThread, hasClassSegmentMutex)) == -1) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "7934efe4b73b20b6294bb2f502f00e0e98255538"}, "originalPosition": 31}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "dce7cb330206829e92f5fa623fb324ffb6fcdaf7", "author": {"user": {"login": "hangshao0", "name": "Hang Shao"}}, "url": "https://github.com/eclipse-openj9/openj9/commit/dce7cb330206829e92f5fa623fb324ffb6fcdaf7", "committedDate": "2020-06-22T17:54:37Z", "message": "Do not enter class segment mutex inside read mutex\n\nWe always update the romclass segment at the end of\nSH_CacheMap:findROMClass() if a class is returned. There is no \nneed to update romclass segment in other places in findROMClass().\n\nFixes #9893\n\nSigned-off-by: Hang Shao <hangshao@ca.ibm.com>"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "7934efe4b73b20b6294bb2f502f00e0e98255538", "author": {"user": {"login": "hangshao0", "name": "Hang Shao"}}, "url": "https://github.com/eclipse-openj9/openj9/commit/7934efe4b73b20b6294bb2f502f00e0e98255538", "committedDate": "2020-06-22T15:26:33Z", "message": "Do not enter class segment mutex inside read mutex\n\nWe always update the romclass segment at the end of\nSH_CacheMap:findROMClass() if a class is returned. There is no \nneed to update romclass segment in other places in findROMClass().\n\nFixes #9893\n\nSigned-off-by: Hang Shao <hangshao@ca.ibm.com>"}, "afterCommit": {"oid": "dce7cb330206829e92f5fa623fb324ffb6fcdaf7", "author": {"user": {"login": "hangshao0", "name": "Hang Shao"}}, "url": "https://github.com/eclipse-openj9/openj9/commit/dce7cb330206829e92f5fa623fb324ffb6fcdaf7", "committedDate": "2020-06-22T17:54:37Z", "message": "Do not enter class segment mutex inside read mutex\n\nWe always update the romclass segment at the end of\nSH_CacheMap:findROMClass() if a class is returned. There is no \nneed to update romclass segment in other places in findROMClass().\n\nFixes #9893\n\nSigned-off-by: Hang Shao <hangshao@ca.ibm.com>"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDM1MzE3Njg4", "url": "https://github.com/eclipse-openj9/openj9/pull/9973#pullrequestreview-435317688", "createdAt": "2020-06-22T22:30:47Z", "commit": {"oid": "dce7cb330206829e92f5fa623fb324ffb6fcdaf7"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 570, "cost": 1, "resetAt": "2021-10-28T17:48:14Z"}}}