{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDk0NDA4OTU3", "number": 10731, "title": "Unify LinkageInfo word initialization", "bodyText": "The Linkage Info word is a 32-bit piece of memory right before the start PC of a compiled body that holds flags describing the body (sampling body, etc) as well as the offset describing the distance between the the Interpreter Entry Point and the JIT Entry Point. The initialization of this word has been done in a very raw manner, dealing directly with the memory rather than using the J9::PrivateLinkage::LinkageInfo abstraction. This PR cleans up this code.\nDepends on eclipse/omr#5583", "createdAt": "2020-09-28T21:21:29Z", "url": "https://github.com/eclipse-openj9/openj9/pull/10731", "merged": true, "mergeCommit": {"oid": "75a730480467a30d155f284d060ecc2af04b243a"}, "closed": true, "closedAt": "2020-10-24T11:35:07Z", "author": {"login": "dsouzai"}, "timelineItems": {"totalCount": 9, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdNZm5nAH2gAyNDk0NDA4OTU3OmU5NTI0OGU5ZGU2MDNlYWVhN2Y0OWE2ZmM0NmE2OGRkMTUwMjMzMGI=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdVpOIJgFqTUxNjI2OTU5Nw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "e95248e9de603eaea7f49a6fc46a68dd1502330b", "author": {"user": {"login": "dsouzai", "name": "Irwin D'Souza"}}, "url": "https://github.com/eclipse-openj9/openj9/commit/e95248e9de603eaea7f49a6fc46a68dd1502330b", "committedDate": "2020-09-28T20:28:22Z", "message": "Add Getters/Setters to LinkageInfo\n\nSigned-off-by: Irwin D'Souza <dsouzai.gh@gmail.com>"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "aa651059f23faf07f9a6f16ec661c3a0abf68fb8", "author": {"user": {"login": "dsouzai", "name": "Irwin D'Souza"}}, "url": "https://github.com/eclipse-openj9/openj9/commit/aa651059f23faf07f9a6f16ec661c3a0abf68fb8", "committedDate": "2020-09-28T20:36:17Z", "message": "Unify LinkageInfo word initialization\n\nSigned-off-by: Irwin D'Souza <dsouzai.gh@gmail.com>"}, "afterCommit": {"oid": "fadf8ce5107c66fa89ee55d9ae80ec650cd0dd15", "author": {"user": {"login": "dsouzai", "name": "Irwin D'Souza"}}, "url": "https://github.com/eclipse-openj9/openj9/commit/fadf8ce5107c66fa89ee55d9ae80ec650cd0dd15", "committedDate": "2020-09-28T21:25:02Z", "message": "Unify LinkageInfo word initialization\n\nSigned-off-by: Irwin D'Souza <dsouzai.gh@gmail.com>"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "fadf8ce5107c66fa89ee55d9ae80ec650cd0dd15", "author": {"user": {"login": "dsouzai", "name": "Irwin D'Souza"}}, "url": "https://github.com/eclipse-openj9/openj9/commit/fadf8ce5107c66fa89ee55d9ae80ec650cd0dd15", "committedDate": "2020-09-28T21:25:02Z", "message": "Unify LinkageInfo word initialization\n\nSigned-off-by: Irwin D'Souza <dsouzai.gh@gmail.com>"}, "afterCommit": {"oid": "bc1780ad3aabeb1289a9c0a2ce5dcc438c5e956d", "author": {"user": {"login": "dsouzai", "name": "Irwin D'Souza"}}, "url": "https://github.com/eclipse-openj9/openj9/commit/bc1780ad3aabeb1289a9c0a2ce5dcc438c5e956d", "committedDate": "2020-09-29T13:54:53Z", "message": "Unify LinkageInfo word initialization\n\nSigned-off-by: Irwin D'Souza <dsouzai.gh@gmail.com>"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTAyMjQ3NjY2", "url": "https://github.com/eclipse-openj9/openj9/pull/10731#pullrequestreview-502247666", "createdAt": "2020-10-05T16:57:04Z", "commit": {"oid": "bc1780ad3aabeb1289a9c0a2ce5dcc438c5e956d"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wNVQxNjo1NzowNFrOHcly-A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wNVQxNjo1NzowNFrOHcly-A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5OTc0MTQzMg==", "bodyText": "I don't think this is correct.  initializeLinkageInfo is in the CodeGenerator class, not Linkage.", "url": "https://github.com/eclipse-openj9/openj9/pull/10731#discussion_r499741432", "createdAt": "2020-10-05T16:57:04Z", "author": {"login": "0xdaryl"}, "path": "runtime/compiler/aarch64/codegen/ARM64PrivateLinkage.cpp", "diffHunk": "@@ -1540,27 +1540,8 @@ void J9::ARM64::PrivateLinkage::performPostBinaryEncoding()\n                    \"Expecting the return type info instruction to be created\");\n \n    TR::ARM64ImmInstruction *linkageInfoWordInstruction = cg()->getReturnTypeInfoInstruction();\n-   uint32_t linkageInfoWord = linkageInfoWordInstruction->getSourceImmediate();\n-\n-   intptr_t jittedMethodEntryAddress = reinterpret_cast<intptr_t>(getJittedMethodEntryPoint()->getBinaryEncoding());\n-   intptr_t interpretedMethodEntryAddress = reinterpret_cast<intptr_t>(getInterpretedMethodEntryPoint()->getBinaryEncoding());\n-\n-   linkageInfoWord = (static_cast<uint32_t>(jittedMethodEntryAddress - interpretedMethodEntryAddress) << 16) | linkageInfoWord;\n+   uint32_t linkageInfoWord = self()->initializeLinkageInfo(linkageInfoWordInstruction->getBinaryEncoding());", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "bc1780ad3aabeb1289a9c0a2ce5dcc438c5e956d"}, "originalPosition": 10}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTAyMjQ4NjY0", "url": "https://github.com/eclipse-openj9/openj9/pull/10731#pullrequestreview-502248664", "createdAt": "2020-10-05T16:58:24Z", "commit": {"oid": "bc1780ad3aabeb1289a9c0a2ce5dcc438c5e956d"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wNVQxNjo1ODoyNFrOHcl17w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wNVQxNjo1ODoyNFrOHcl17w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5OTc0MjE5MQ==", "bodyText": "sp:  Initializes", "url": "https://github.com/eclipse-openj9/openj9/pull/10731#discussion_r499742191", "createdAt": "2020-10-05T16:58:24Z", "author": {"login": "0xdaryl"}, "path": "runtime/compiler/codegen/J9CodeGenerator.hpp", "diffHunk": "@@ -577,6 +577,15 @@ void addMonClass(TR::Node* monNode, TR_OpaqueClassBlock* clazz);\n     */\n    bool supportsStackAllocations() { return false; }\n \n+   /**\n+    * \\brief Intializes the Linkage Info word found before the interpreter entry point.", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "bc1780ad3aabeb1289a9c0a2ce5dcc438c5e956d"}, "originalPosition": 5}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "bc1780ad3aabeb1289a9c0a2ce5dcc438c5e956d", "author": {"user": {"login": "dsouzai", "name": "Irwin D'Souza"}}, "url": "https://github.com/eclipse-openj9/openj9/commit/bc1780ad3aabeb1289a9c0a2ce5dcc438c5e956d", "committedDate": "2020-09-29T13:54:53Z", "message": "Unify LinkageInfo word initialization\n\nSigned-off-by: Irwin D'Souza <dsouzai.gh@gmail.com>"}, "afterCommit": {"oid": "4687e119b6825b7ff520ed92325f9fedcd60a204", "author": {"user": {"login": "dsouzai", "name": "Irwin D'Souza"}}, "url": "https://github.com/eclipse-openj9/openj9/commit/4687e119b6825b7ff520ed92325f9fedcd60a204", "committedDate": "2020-10-05T17:05:22Z", "message": "Unify LinkageInfo word initialization\n\nSigned-off-by: Irwin D'Souza <dsouzai.gh@gmail.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "390f354413d0ceb6d51d58116a7ec5075abf4011", "author": {"user": {"login": "dsouzai", "name": "Irwin D'Souza"}}, "url": "https://github.com/eclipse-openj9/openj9/commit/390f354413d0ceb6d51d58116a7ec5075abf4011", "committedDate": "2020-10-05T17:07:36Z", "message": "Unify LinkageInfo word initialization\n\nSigned-off-by: Irwin D'Souza <dsouzai.gh@gmail.com>"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "4687e119b6825b7ff520ed92325f9fedcd60a204", "author": {"user": {"login": "dsouzai", "name": "Irwin D'Souza"}}, "url": "https://github.com/eclipse-openj9/openj9/commit/4687e119b6825b7ff520ed92325f9fedcd60a204", "committedDate": "2020-10-05T17:05:22Z", "message": "Unify LinkageInfo word initialization\n\nSigned-off-by: Irwin D'Souza <dsouzai.gh@gmail.com>"}, "afterCommit": {"oid": "390f354413d0ceb6d51d58116a7ec5075abf4011", "author": {"user": {"login": "dsouzai", "name": "Irwin D'Souza"}}, "url": "https://github.com/eclipse-openj9/openj9/commit/390f354413d0ceb6d51d58116a7ec5075abf4011", "committedDate": "2020-10-05T17:07:36Z", "message": "Unify LinkageInfo word initialization\n\nSigned-off-by: Irwin D'Souza <dsouzai.gh@gmail.com>"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTE2MjY5NTk3", "url": "https://github.com/eclipse-openj9/openj9/pull/10731#pullrequestreview-516269597", "createdAt": "2020-10-24T11:11:11Z", "commit": {"oid": "390f354413d0ceb6d51d58116a7ec5075abf4011"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 331, "cost": 1, "resetAt": "2021-10-28T18:00:02Z"}}}