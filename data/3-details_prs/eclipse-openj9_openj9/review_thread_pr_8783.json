{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0Mzg1MDE3MzQ0", "number": 8783, "reviewThreads": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wOVQwMzowNjo1MVrODmJmlA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wOVQxMjo1NDozM1rODmRZug==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjQxMzI5ODEyOnYy", "diffSide": "RIGHT", "path": "jcl/src/java.base/share/classes/java/lang/invoke/VarHandle.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wOVQwMzowNjo1MVrOFzZ4LA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wOVQxNjo0Nzo0NlrOFzwsLg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4OTQ0NTY3Ng==", "bodyText": "Rather than creating a new MT here (getter.dropFirstParameterType), can you just copy a subset of the originalMT's parameterArray?\nSomething like\n\n  \n    \n  \n    \n\n  \n  This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters. Learn more about bidirectional Unicode characters\n\n\n  \n\n\n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            \t\tthis.coordinateTypes = getter.dropFirstParameterType().parameterArray();\n          \n          \n            \n            \t\tClass<?>[] getterTypes = getter.parameterArray();\n          \n          \n            \n            \t\tthis.coordinateTypes = Arrays.copyOfRange(getterTypes, 1, getterTypes.length);\n          \n      \n    \n    \n  \n\nThis still has one additional allocation (the getterTypes array) but saves the more costly MT creation", "url": "https://github.com/eclipse-openj9/openj9/pull/8783#discussion_r389445676", "createdAt": "2020-03-09T03:06:51Z", "author": {"login": "DanHeidinga"}, "path": "jcl/src/java.base/share/classes/java/lang/invoke/VarHandle.java", "diffHunk": "@@ -413,12 +413,18 @@ MethodType accessModeType(Class<?> receiver, Class<?> type, Class<?>... args) {\n \t\t}\n \n \t\tthis.fieldType = setter.parameterType(setter.parameterCount() - 1);\n-\t\tthis.coordinateTypes = getter.parameterArray();\n+\t\t\n+\t\t/* The first VarHandle parameter type should be removed from the getter in order to derive\n+\t\t * the coordinate types. \n+\t\t */\n+\t\tthis.coordinateTypes = getter.dropFirstParameterType().parameterArray();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "a108b45bedd8f79a7fcd70986f649487c9a4f5ee"}, "originalPosition": 9}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4OTgxOTQzOA==", "bodyText": "Updated.", "url": "https://github.com/eclipse-openj9/openj9/pull/8783#discussion_r389819438", "createdAt": "2020-03-09T16:47:46Z", "author": {"login": "babsingh"}, "path": "jcl/src/java.base/share/classes/java/lang/invoke/VarHandle.java", "diffHunk": "@@ -413,12 +413,18 @@ MethodType accessModeType(Class<?> receiver, Class<?> type, Class<?>... args) {\n \t\t}\n \n \t\tthis.fieldType = setter.parameterType(setter.parameterCount() - 1);\n-\t\tthis.coordinateTypes = getter.parameterArray();\n+\t\t\n+\t\t/* The first VarHandle parameter type should be removed from the getter in order to derive\n+\t\t * the coordinate types. \n+\t\t */\n+\t\tthis.coordinateTypes = getter.dropFirstParameterType().parameterArray();", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4OTQ0NTY3Ng=="}, "originalCommit": {"oid": "a108b45bedd8f79a7fcd70986f649487c9a4f5ee"}, "originalPosition": 9}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjQxNDU3NTk0OnYy", "diffSide": "RIGHT", "path": "jcl/src/java.base/share/classes/java/lang/invoke/VarHandle.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wOVQxMjo1NDozM1rOFzl0Og==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wOVQxNjo0NzoyNlrOFzwrXQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4OTY0MTI3NA==", "bodyText": "Is getter guaranteed to have at least 1 element at this point?", "url": "https://github.com/eclipse-openj9/openj9/pull/8783#discussion_r389641274", "createdAt": "2020-03-09T12:54:33Z", "author": {"login": "DanHeidinga"}, "path": "jcl/src/java.base/share/classes/java/lang/invoke/VarHandle.java", "diffHunk": "@@ -413,12 +413,19 @@ MethodType accessModeType(Class<?> receiver, Class<?> type, Class<?>... args) {\n \t\t}\n \n \t\tthis.fieldType = setter.parameterType(setter.parameterCount() - 1);\n-\t\tthis.coordinateTypes = getter.parameterArray();\n+\t\t\n+\t\t/* The first VarHandle parameter type should be removed from the getter in order to derive\n+\t\t * the coordinate types. \n+\t\t */\n+\t\tClass<?>[] getterParams = getter.parameterArray();\n+\t\tthis.coordinateTypes = Arrays.copyOfRange(getterParams, 1, getterParams.length);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "34ef5d0b6ff01550e89ef8c0d8f9c733861a291f"}, "originalPosition": 10}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4OTgxOTIyOQ==", "bodyText": "Yes, I believe so. I expect atleast one parameter of type VarHandle for all AccessMode types. Also, copyOfRange correctly returns a zero length array if there is only one parameter.", "url": "https://github.com/eclipse-openj9/openj9/pull/8783#discussion_r389819229", "createdAt": "2020-03-09T16:47:26Z", "author": {"login": "babsingh"}, "path": "jcl/src/java.base/share/classes/java/lang/invoke/VarHandle.java", "diffHunk": "@@ -413,12 +413,19 @@ MethodType accessModeType(Class<?> receiver, Class<?> type, Class<?>... args) {\n \t\t}\n \n \t\tthis.fieldType = setter.parameterType(setter.parameterCount() - 1);\n-\t\tthis.coordinateTypes = getter.parameterArray();\n+\t\t\n+\t\t/* The first VarHandle parameter type should be removed from the getter in order to derive\n+\t\t * the coordinate types. \n+\t\t */\n+\t\tClass<?>[] getterParams = getter.parameterArray();\n+\t\tthis.coordinateTypes = Arrays.copyOfRange(getterParams, 1, getterParams.length);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4OTY0MTI3NA=="}, "originalCommit": {"oid": "34ef5d0b6ff01550e89ef8c0d8f9c733861a291f"}, "originalPosition": 10}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 496, "cost": 1, "resetAt": "2021-11-12T13:16:51Z"}}}