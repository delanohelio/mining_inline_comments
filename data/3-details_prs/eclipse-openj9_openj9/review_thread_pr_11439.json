{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTM2MjUzMzY5", "number": 11439, "reviewThreads": {"totalCount": 11, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wNS0xOFQxNjo1NDowMlrOF_qTaQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wNS0yN1QyMToyNjowOFrOGDrD8g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkNDAyMjk3NzA1OnYy", "diffSide": "RIGHT", "path": "buildenv/docker/mkdocker.sh", "isResolved": true, "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wNS0xOFQxNjo1NDowMlrOJdLz7A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wNS0yNlQyMToyNjoxNlrOJienKQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDYzNDU4MTk5Ng==", "bodyText": "This change doesn't appear to be necessary: the tag 'centos:6.10' is available.", "url": "https://github.com/eclipse-openj9/openj9/pull/11439#discussion_r634581996", "createdAt": "2021-05-18T16:54:02Z", "author": {"login": "keithc-ca"}, "path": "buildenv/docker/mkdocker.sh", "diffHunk": "@@ -219,12 +220,22 @@ if [ $cuda != no ] ; then\n   echo \"FROM nvidia/cuda:${cuda}-devel-ubuntu16.04 AS cuda-dev\"\n   echo \"\"\n fi\n+if [ $dist = centos ] ; then\n+  echo \"FROM $dist:$dist$version\"\n+else\n   echo \"FROM $dist:$version\"\n+fi", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "4dc6a24f14de5fdab9a726fbe8c513e5e7270cb8"}, "originalPosition": 43}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDYzNDg1MTUwNQ==", "bodyText": "When I initially did the tag change and repo change was what I needed to get this functional.  I'll try a run with this and the repo reverted.", "url": "https://github.com/eclipse-openj9/openj9/pull/11439#discussion_r634851505", "createdAt": "2021-05-19T01:24:03Z", "author": {"login": "jdekonin"}, "path": "buildenv/docker/mkdocker.sh", "diffHunk": "@@ -219,12 +220,22 @@ if [ $cuda != no ] ; then\n   echo \"FROM nvidia/cuda:${cuda}-devel-ubuntu16.04 AS cuda-dev\"\n   echo \"\"\n fi\n+if [ $dist = centos ] ; then\n+  echo \"FROM $dist:$dist$version\"\n+else\n   echo \"FROM $dist:$version\"\n+fi", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDYzNDU4MTk5Ng=="}, "originalCommit": {"oid": "4dc6a24f14de5fdab9a726fbe8c513e5e7270cb8"}, "originalPosition": 43}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDY0MDEzMjkwNQ==", "bodyText": "Not required and removed from my next push.", "url": "https://github.com/eclipse-openj9/openj9/pull/11439#discussion_r640132905", "createdAt": "2021-05-26T21:26:16Z", "author": {"login": "jdekonin"}, "path": "buildenv/docker/mkdocker.sh", "diffHunk": "@@ -219,12 +220,22 @@ if [ $cuda != no ] ; then\n   echo \"FROM nvidia/cuda:${cuda}-devel-ubuntu16.04 AS cuda-dev\"\n   echo \"\"\n fi\n+if [ $dist = centos ] ; then\n+  echo \"FROM $dist:$dist$version\"\n+else\n   echo \"FROM $dist:$version\"\n+fi", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDYzNDU4MTk5Ng=="}, "originalCommit": {"oid": "4dc6a24f14de5fdab9a726fbe8c513e5e7270cb8"}, "originalPosition": 43}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkNDAyMzAxNjExOnYy", "diffSide": "RIGHT", "path": "buildenv/docker/mkdocker.sh", "isResolved": true, "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wNS0xOFQxNzowMjo0MVrOJdMMMQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wNS0yNlQyMToyODo1NVrOJiestA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDYzNDU4ODIwOQ==", "bodyText": "Why do we care about the shell prompt string?\nMuch escaping can be avoided by using single quotes ('); the $ should be escaped, though.\nThe two limits can be changed in one command: ulimit -n 2048 -u 32000.", "url": "https://github.com/eclipse-openj9/openj9/pull/11439#discussion_r634588209", "createdAt": "2021-05-18T17:02:41Z", "author": {"login": "keithc-ca"}, "path": "buildenv/docker/mkdocker.sh", "diffHunk": "@@ -532,32 +543,33 @@ prepare_user() {\n create_user() {\n   echo \"\"\n   echo \"# Add user home and copy authorized_keys and known_hosts.\"\n-  echo \"RUN useradd -ms /bin/bash $user \\\\\"\n+  echo \"RUN useradd -ms /bin/bash --uid $userid $user \\\\\"\n   echo \" && mkdir /home/$user/.ssh \\\\\"\n   echo \" && chmod 700 /home/$user/.ssh\"\n   echo \"COPY authorized_keys known_hosts /home/$user/.ssh/\"\n-  echo \"RUN chown -R $user:$user /home/$user \\\\\"\n-  echo \" && chmod 600 /home/$user/.ssh/authorized_keys /home/$user/.ssh/known_hosts\"\n+  echo \"RUN chmod 600 /home/$user/.ssh/authorized_keys /home/$user/.ssh/known_hosts \\\\\"\n+  echo \" && echo \\\"PS1=\\\\\\\"\\\\u:DOCKER-CONTAINER $ \\\\\\\"\\\" > /home/$user/.bashrc \\\\\"\n+  echo \" && echo \\\"ulimit -u 32000\\\" >> /home/$user/.bashrc \\\\\"\n+  echo \" && echo \\\"ulimit -n 2048\\\" >> /home/$user/.bashrc\"", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "4dc6a24f14de5fdab9a726fbe8c513e5e7270cb8"}, "originalPosition": 73}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDYzNDg1MjgwMw==", "bodyText": "I'll play with modifying.  The reason for the shell prompt was so there was an obvious eyecatcher to indicate that the docker container launch worked and that the job is compiling in the container and not the host.  Purely a debugging/confirmation bit of output for the user.", "url": "https://github.com/eclipse-openj9/openj9/pull/11439#discussion_r634852803", "createdAt": "2021-05-19T01:28:41Z", "author": {"login": "jdekonin"}, "path": "buildenv/docker/mkdocker.sh", "diffHunk": "@@ -532,32 +543,33 @@ prepare_user() {\n create_user() {\n   echo \"\"\n   echo \"# Add user home and copy authorized_keys and known_hosts.\"\n-  echo \"RUN useradd -ms /bin/bash $user \\\\\"\n+  echo \"RUN useradd -ms /bin/bash --uid $userid $user \\\\\"\n   echo \" && mkdir /home/$user/.ssh \\\\\"\n   echo \" && chmod 700 /home/$user/.ssh\"\n   echo \"COPY authorized_keys known_hosts /home/$user/.ssh/\"\n-  echo \"RUN chown -R $user:$user /home/$user \\\\\"\n-  echo \" && chmod 600 /home/$user/.ssh/authorized_keys /home/$user/.ssh/known_hosts\"\n+  echo \"RUN chmod 600 /home/$user/.ssh/authorized_keys /home/$user/.ssh/known_hosts \\\\\"\n+  echo \" && echo \\\"PS1=\\\\\\\"\\\\u:DOCKER-CONTAINER $ \\\\\\\"\\\" > /home/$user/.bashrc \\\\\"\n+  echo \" && echo \\\"ulimit -u 32000\\\" >> /home/$user/.bashrc \\\\\"\n+  echo \" && echo \\\"ulimit -n 2048\\\" >> /home/$user/.bashrc\"", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDYzNDU4ODIwOQ=="}, "originalCommit": {"oid": "4dc6a24f14de5fdab9a726fbe8c513e5e7270cb8"}, "originalPosition": 73}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDY0MDEzNDMyNA==", "bodyText": "In my latest push I cleaned up the ulimit required change for an added user, running as root ulimit value are unlimited so no compile issues are seen.  Also removed PS1 as it not added huge value.", "url": "https://github.com/eclipse-openj9/openj9/pull/11439#discussion_r640134324", "createdAt": "2021-05-26T21:28:55Z", "author": {"login": "jdekonin"}, "path": "buildenv/docker/mkdocker.sh", "diffHunk": "@@ -532,32 +543,33 @@ prepare_user() {\n create_user() {\n   echo \"\"\n   echo \"# Add user home and copy authorized_keys and known_hosts.\"\n-  echo \"RUN useradd -ms /bin/bash $user \\\\\"\n+  echo \"RUN useradd -ms /bin/bash --uid $userid $user \\\\\"\n   echo \" && mkdir /home/$user/.ssh \\\\\"\n   echo \" && chmod 700 /home/$user/.ssh\"\n   echo \"COPY authorized_keys known_hosts /home/$user/.ssh/\"\n-  echo \"RUN chown -R $user:$user /home/$user \\\\\"\n-  echo \" && chmod 600 /home/$user/.ssh/authorized_keys /home/$user/.ssh/known_hosts\"\n+  echo \"RUN chmod 600 /home/$user/.ssh/authorized_keys /home/$user/.ssh/known_hosts \\\\\"\n+  echo \" && echo \\\"PS1=\\\\\\\"\\\\u:DOCKER-CONTAINER $ \\\\\\\"\\\" > /home/$user/.bashrc \\\\\"\n+  echo \" && echo \\\"ulimit -u 32000\\\" >> /home/$user/.bashrc \\\\\"\n+  echo \" && echo \\\"ulimit -n 2048\\\" >> /home/$user/.bashrc\"", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDYzNDU4ODIwOQ=="}, "originalCommit": {"oid": "4dc6a24f14de5fdab9a726fbe8c513e5e7270cb8"}, "originalPosition": 73}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkNDAyMzA5MzQzOnYy", "diffSide": "RIGHT", "path": "buildenv/jenkins/docker-nodes/jenkinsfile-build-container.groovy", "isResolved": false, "comments": {"totalCount": 5, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wNS0xOFQxNzoyMToxMlrOJdM8PQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wNS0yOFQxNzoyNToxMFrOJj-jXg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDYzNDYwMDUwOQ==", "bodyText": "CUDA should be selected for ppc64le and x86, independent of the O/S.", "url": "https://github.com/eclipse-openj9/openj9/pull/11439#discussion_r634600509", "createdAt": "2021-05-18T17:21:12Z", "author": {"login": "keithc-ca"}, "path": "buildenv/jenkins/docker-nodes/jenkinsfile-build-container.groovy", "diffHunk": "@@ -42,9 +42,9 @@ if (\"${OS}\" == \"unknown\" || !(validArch.contains(ARCH))) {\n }\n \n def BUILD_OPTS = \"\"\n-if (\"${OS}\" == \"centos6.9\") {\n+if (\"${OS}\" == \"centos6.10\") {\n     if (\"${ARCH}\" == \"x86\") {\n-        BUILD_OPTS = \"--dist=centos --version=6.9\"\n+        BUILD_OPTS = \"--dist=centos --version=6.10 --cuda\"", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "4dc6a24f14de5fdab9a726fbe8c513e5e7270cb8"}, "originalPosition": 8}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDYzNDg1NDM4Nw==", "bodyText": "I'll work in for all platforms.", "url": "https://github.com/eclipse-openj9/openj9/pull/11439#discussion_r634854387", "createdAt": "2021-05-19T01:34:00Z", "author": {"login": "jdekonin"}, "path": "buildenv/jenkins/docker-nodes/jenkinsfile-build-container.groovy", "diffHunk": "@@ -42,9 +42,9 @@ if (\"${OS}\" == \"unknown\" || !(validArch.contains(ARCH))) {\n }\n \n def BUILD_OPTS = \"\"\n-if (\"${OS}\" == \"centos6.9\") {\n+if (\"${OS}\" == \"centos6.10\") {\n     if (\"${ARCH}\" == \"x86\") {\n-        BUILD_OPTS = \"--dist=centos --version=6.9\"\n+        BUILD_OPTS = \"--dist=centos --version=6.10 --cuda\"", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDYzNDYwMDUwOQ=="}, "originalCommit": {"oid": "4dc6a24f14de5fdab9a726fbe8c513e5e7270cb8"}, "originalPosition": 8}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDY0MDEzNjU0Nw==", "bodyText": "I decided against enabling cuda for all platforms here as the files extracted would be from ub16.  I doubt many will be wanting to use ub16 as a container as its out of support.  UB18+ and RH7+ we should likely aim for a version of cuda that would more closely align with the arch and os release.  I think that should be done under a different PR.", "url": "https://github.com/eclipse-openj9/openj9/pull/11439#discussion_r640136547", "createdAt": "2021-05-26T21:33:08Z", "author": {"login": "jdekonin"}, "path": "buildenv/jenkins/docker-nodes/jenkinsfile-build-container.groovy", "diffHunk": "@@ -42,9 +42,9 @@ if (\"${OS}\" == \"unknown\" || !(validArch.contains(ARCH))) {\n }\n \n def BUILD_OPTS = \"\"\n-if (\"${OS}\" == \"centos6.9\") {\n+if (\"${OS}\" == \"centos6.10\") {\n     if (\"${ARCH}\" == \"x86\") {\n-        BUILD_OPTS = \"--dist=centos --version=6.9\"\n+        BUILD_OPTS = \"--dist=centos --version=6.10 --cuda\"", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDYzNDYwMDUwOQ=="}, "originalCommit": {"oid": "4dc6a24f14de5fdab9a726fbe8c513e5e7270cb8"}, "originalPosition": 8}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDY0MDk5NDM2Nw==", "bodyText": "It's only copying some header files from that image; only the version of CUDA should be relevant, but it should probably be updated to a supported OS version.", "url": "https://github.com/eclipse-openj9/openj9/pull/11439#discussion_r640994367", "createdAt": "2021-05-27T21:52:16Z", "author": {"login": "keithc-ca"}, "path": "buildenv/jenkins/docker-nodes/jenkinsfile-build-container.groovy", "diffHunk": "@@ -42,9 +42,9 @@ if (\"${OS}\" == \"unknown\" || !(validArch.contains(ARCH))) {\n }\n \n def BUILD_OPTS = \"\"\n-if (\"${OS}\" == \"centos6.9\") {\n+if (\"${OS}\" == \"centos6.10\") {\n     if (\"${ARCH}\" == \"x86\") {\n-        BUILD_OPTS = \"--dist=centos --version=6.9\"\n+        BUILD_OPTS = \"--dist=centos --version=6.10 --cuda\"", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDYzNDYwMDUwOQ=="}, "originalCommit": {"oid": "4dc6a24f14de5fdab9a726fbe8c513e5e7270cb8"}, "originalPosition": 8}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDY0MTcwNDc5OA==", "bodyText": "I expect we want to stick with version 9.0 for a while, which is only available on ubuntu 16.04; see https://hub.docker.com/r/nvidia/cuda/tags?page=1&ordering=last_updated&name=9.0.", "url": "https://github.com/eclipse-openj9/openj9/pull/11439#discussion_r641704798", "createdAt": "2021-05-28T17:25:10Z", "author": {"login": "keithc-ca"}, "path": "buildenv/jenkins/docker-nodes/jenkinsfile-build-container.groovy", "diffHunk": "@@ -42,9 +42,9 @@ if (\"${OS}\" == \"unknown\" || !(validArch.contains(ARCH))) {\n }\n \n def BUILD_OPTS = \"\"\n-if (\"${OS}\" == \"centos6.9\") {\n+if (\"${OS}\" == \"centos6.10\") {\n     if (\"${ARCH}\" == \"x86\") {\n-        BUILD_OPTS = \"--dist=centos --version=6.9\"\n+        BUILD_OPTS = \"--dist=centos --version=6.10 --cuda\"", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDYzNDYwMDUwOQ=="}, "originalCommit": {"oid": "4dc6a24f14de5fdab9a726fbe8c513e5e7270cb8"}, "originalPosition": 8}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkNDAyMzA5NjczOnYy", "diffSide": "RIGHT", "path": "buildenv/jenkins/docker-nodes/jenkinsfile-build-container.groovy", "isResolved": true, "comments": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wNS0xOFQxNzoyMTo1OFrOJdM-Iw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wNS0yNlQyMTozNDozN1rOJie4TA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDYzNDYwMDk5NQ==", "bodyText": "This is the namespace at dockerhub, right?", "url": "https://github.com/eclipse-openj9/openj9/pull/11439#discussion_r634600995", "createdAt": "2021-05-18T17:21:58Z", "author": {"login": "keithc-ca"}, "path": "buildenv/jenkins/docker-nodes/jenkinsfile-build-container.groovy", "diffHunk": "@@ -62,7 +62,7 @@ if (\"${BUILD_OPTS}\" == \"\") {\n }\n \n def NODE = (params.NODE) ? params.NODE : \"sw.tool.docker && hw.arch.${ARCH}\"\n-def NAMESPACE = (params.NAMESPACE) ? params.NAMESPACE : \"eclipse-openj9\"\n+def NAMESPACE = (params.NAMESPACE) ? params.NAMESPACE : \"openj9\"", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "4dc6a24f14de5fdab9a726fbe8c513e5e7270cb8"}, "originalPosition": 17}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDYzNDYwOTQyNw==", "bodyText": "eclipseopenj9, not openj9?\nhttps://hub.docker.com/r/eclipseopenj9/jenkins-agent-x86-centos6", "url": "https://github.com/eclipse-openj9/openj9/pull/11439#discussion_r634609427", "createdAt": "2021-05-18T17:34:20Z", "author": {"login": "pshipton"}, "path": "buildenv/jenkins/docker-nodes/jenkinsfile-build-container.groovy", "diffHunk": "@@ -62,7 +62,7 @@ if (\"${BUILD_OPTS}\" == \"\") {\n }\n \n def NODE = (params.NODE) ? params.NODE : \"sw.tool.docker && hw.arch.${ARCH}\"\n-def NAMESPACE = (params.NAMESPACE) ? params.NAMESPACE : \"eclipse-openj9\"\n+def NAMESPACE = (params.NAMESPACE) ? params.NAMESPACE : \"openj9\"", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDYzNDYwMDk5NQ=="}, "originalCommit": {"oid": "4dc6a24f14de5fdab9a726fbe8c513e5e7270cb8"}, "originalPosition": 17}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDYzNDg1NDY2NQ==", "bodyText": "Correct, I hadn't had the update from the bugzilla I opened to create that repo until earlier today.  I will correct this as well.", "url": "https://github.com/eclipse-openj9/openj9/pull/11439#discussion_r634854665", "createdAt": "2021-05-19T01:34:58Z", "author": {"login": "jdekonin"}, "path": "buildenv/jenkins/docker-nodes/jenkinsfile-build-container.groovy", "diffHunk": "@@ -62,7 +62,7 @@ if (\"${BUILD_OPTS}\" == \"\") {\n }\n \n def NODE = (params.NODE) ? params.NODE : \"sw.tool.docker && hw.arch.${ARCH}\"\n-def NAMESPACE = (params.NAMESPACE) ? params.NAMESPACE : \"eclipse-openj9\"\n+def NAMESPACE = (params.NAMESPACE) ? params.NAMESPACE : \"openj9\"", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDYzNDYwMDk5NQ=="}, "originalCommit": {"oid": "4dc6a24f14de5fdab9a726fbe8c513e5e7270cb8"}, "originalPosition": 17}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDY0MDEzNzI5Mg==", "bodyText": "Corrected to the location in the bugzilla with in my latest push.  I also fixed the REPOSITORY value for the same reason.", "url": "https://github.com/eclipse-openj9/openj9/pull/11439#discussion_r640137292", "createdAt": "2021-05-26T21:34:37Z", "author": {"login": "jdekonin"}, "path": "buildenv/jenkins/docker-nodes/jenkinsfile-build-container.groovy", "diffHunk": "@@ -62,7 +62,7 @@ if (\"${BUILD_OPTS}\" == \"\") {\n }\n \n def NODE = (params.NODE) ? params.NODE : \"sw.tool.docker && hw.arch.${ARCH}\"\n-def NAMESPACE = (params.NAMESPACE) ? params.NAMESPACE : \"eclipse-openj9\"\n+def NAMESPACE = (params.NAMESPACE) ? params.NAMESPACE : \"openj9\"", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDYzNDYwMDk5NQ=="}, "originalCommit": {"oid": "4dc6a24f14de5fdab9a726fbe8c513e5e7270cb8"}, "originalPosition": 17}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkNDAyMzEwMTY5OnYy", "diffSide": "RIGHT", "path": "buildenv/docker/mkdocker.sh", "isResolved": true, "comments": {"totalCount": 6, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wNS0xOFQxNzoyMzowM1rOJdNBFg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wNS0yN1QyMTo1NTowMVrOJjTQ_A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDYzNDYwMTc1MA==", "bodyText": "Why is this needed? Don't the default repo configurations work?", "url": "https://github.com/eclipse-openj9/openj9/pull/11439#discussion_r634601750", "createdAt": "2021-05-18T17:23:03Z", "author": {"login": "keithc-ca"}, "path": "buildenv/docker/mkdocker.sh", "diffHunk": "@@ -219,12 +220,22 @@ if [ $cuda != no ] ; then\n   echo \"FROM nvidia/cuda:${cuda}-devel-ubuntu16.04 AS cuda-dev\"\n   echo \"\"\n fi\n+if [ $dist = centos ] ; then\n+  echo \"FROM $dist:$dist$version\"\n+else\n   echo \"FROM $dist:$version\"\n+fi\n }\n \n install_centos_packages() {\n+if [ $version = 6.10 ] ; then\n+  echo \"RUN sed -i -e 's|mirrorlist|#mirrorlist|' \\\\\"\n+  echo \"           -e 's|#baseurl=http://mirror.centos.org/centos/\\$releasever|baseurl=https://vault.centos.org/6.10|' \\\\\"\n+  echo \"           /etc/yum.repos.d/CentOS-Base.repo\"\n+  echo \"\"\n+fi", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "4dc6a24f14de5fdab9a726fbe8c513e5e7270cb8"}, "originalPosition": 52}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDYzNDg1MTUxMA==", "bodyText": "When I initially did the tag change and repo change was what I needed to get this functional.  I'll try a run with this and the repo reverted.", "url": "https://github.com/eclipse-openj9/openj9/pull/11439#discussion_r634851510", "createdAt": "2021-05-19T01:24:04Z", "author": {"login": "jdekonin"}, "path": "buildenv/docker/mkdocker.sh", "diffHunk": "@@ -219,12 +220,22 @@ if [ $cuda != no ] ; then\n   echo \"FROM nvidia/cuda:${cuda}-devel-ubuntu16.04 AS cuda-dev\"\n   echo \"\"\n fi\n+if [ $dist = centos ] ; then\n+  echo \"FROM $dist:$dist$version\"\n+else\n   echo \"FROM $dist:$version\"\n+fi\n }\n \n install_centos_packages() {\n+if [ $version = 6.10 ] ; then\n+  echo \"RUN sed -i -e 's|mirrorlist|#mirrorlist|' \\\\\"\n+  echo \"           -e 's|#baseurl=http://mirror.centos.org/centos/\\$releasever|baseurl=https://vault.centos.org/6.10|' \\\\\"\n+  echo \"           /etc/yum.repos.d/CentOS-Base.repo\"\n+  echo \"\"\n+fi", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDYzNDYwMTc1MA=="}, "originalCommit": {"oid": "4dc6a24f14de5fdab9a726fbe8c513e5e7270cb8"}, "originalPosition": 52}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDY0MDEzMzU2Mw==", "bodyText": "CentOS 6 is no longer hosted at mirror.centos.org as per http://mirror.centos.org/centos/6/readme so I modify the system default to redirected to the vault/archive location.", "url": "https://github.com/eclipse-openj9/openj9/pull/11439#discussion_r640133563", "createdAt": "2021-05-26T21:27:30Z", "author": {"login": "jdekonin"}, "path": "buildenv/docker/mkdocker.sh", "diffHunk": "@@ -219,12 +220,22 @@ if [ $cuda != no ] ; then\n   echo \"FROM nvidia/cuda:${cuda}-devel-ubuntu16.04 AS cuda-dev\"\n   echo \"\"\n fi\n+if [ $dist = centos ] ; then\n+  echo \"FROM $dist:$dist$version\"\n+else\n   echo \"FROM $dist:$version\"\n+fi\n }\n \n install_centos_packages() {\n+if [ $version = 6.10 ] ; then\n+  echo \"RUN sed -i -e 's|mirrorlist|#mirrorlist|' \\\\\"\n+  echo \"           -e 's|#baseurl=http://mirror.centos.org/centos/\\$releasever|baseurl=https://vault.centos.org/6.10|' \\\\\"\n+  echo \"           /etc/yum.repos.d/CentOS-Base.repo\"\n+  echo \"\"\n+fi", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDYzNDYwMTc1MA=="}, "originalCommit": {"oid": "4dc6a24f14de5fdab9a726fbe8c513e5e7270cb8"}, "originalPosition": 52}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDY0MDc1NzAzOQ==", "bodyText": "Why are we not heeding the warning in that readme file?\n\nThe whole CentOS 6 is dead and shouldn't be used anywhere at all", "url": "https://github.com/eclipse-openj9/openj9/pull/11439#discussion_r640757039", "createdAt": "2021-05-27T15:53:45Z", "author": {"login": "keithc-ca"}, "path": "buildenv/docker/mkdocker.sh", "diffHunk": "@@ -219,12 +220,22 @@ if [ $cuda != no ] ; then\n   echo \"FROM nvidia/cuda:${cuda}-devel-ubuntu16.04 AS cuda-dev\"\n   echo \"\"\n fi\n+if [ $dist = centos ] ; then\n+  echo \"FROM $dist:$dist$version\"\n+else\n   echo \"FROM $dist:$version\"\n+fi\n }\n \n install_centos_packages() {\n+if [ $version = 6.10 ] ; then\n+  echo \"RUN sed -i -e 's|mirrorlist|#mirrorlist|' \\\\\"\n+  echo \"           -e 's|#baseurl=http://mirror.centos.org/centos/\\$releasever|baseurl=https://vault.centos.org/6.10|' \\\\\"\n+  echo \"           /etc/yum.repos.d/CentOS-Base.repo\"\n+  echo \"\"\n+fi", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDYzNDYwMTc1MA=="}, "originalCommit": {"oid": "4dc6a24f14de5fdab9a726fbe8c513e5e7270cb8"}, "originalPosition": 52}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDY0MDk2NTQyOA==", "bodyText": "We are still using as this is the operating system that is used at Eclipse Adoptium for JDK8 x86(-64) support.", "url": "https://github.com/eclipse-openj9/openj9/pull/11439#discussion_r640965428", "createdAt": "2021-05-27T21:05:17Z", "author": {"login": "jdekonin"}, "path": "buildenv/docker/mkdocker.sh", "diffHunk": "@@ -219,12 +220,22 @@ if [ $cuda != no ] ; then\n   echo \"FROM nvidia/cuda:${cuda}-devel-ubuntu16.04 AS cuda-dev\"\n   echo \"\"\n fi\n+if [ $dist = centos ] ; then\n+  echo \"FROM $dist:$dist$version\"\n+else\n   echo \"FROM $dist:$version\"\n+fi\n }\n \n install_centos_packages() {\n+if [ $version = 6.10 ] ; then\n+  echo \"RUN sed -i -e 's|mirrorlist|#mirrorlist|' \\\\\"\n+  echo \"           -e 's|#baseurl=http://mirror.centos.org/centos/\\$releasever|baseurl=https://vault.centos.org/6.10|' \\\\\"\n+  echo \"           /etc/yum.repos.d/CentOS-Base.repo\"\n+  echo \"\"\n+fi", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDYzNDYwMTc1MA=="}, "originalCommit": {"oid": "4dc6a24f14de5fdab9a726fbe8c513e5e7270cb8"}, "originalPosition": 52}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDY0MDk5NTU4MA==", "bodyText": "Not just jdk8, but jdk11+ as well.", "url": "https://github.com/eclipse-openj9/openj9/pull/11439#discussion_r640995580", "createdAt": "2021-05-27T21:55:01Z", "author": {"login": "pshipton"}, "path": "buildenv/docker/mkdocker.sh", "diffHunk": "@@ -219,12 +220,22 @@ if [ $cuda != no ] ; then\n   echo \"FROM nvidia/cuda:${cuda}-devel-ubuntu16.04 AS cuda-dev\"\n   echo \"\"\n fi\n+if [ $dist = centos ] ; then\n+  echo \"FROM $dist:$dist$version\"\n+else\n   echo \"FROM $dist:$version\"\n+fi\n }\n \n install_centos_packages() {\n+if [ $version = 6.10 ] ; then\n+  echo \"RUN sed -i -e 's|mirrorlist|#mirrorlist|' \\\\\"\n+  echo \"           -e 's|#baseurl=http://mirror.centos.org/centos/\\$releasever|baseurl=https://vault.centos.org/6.10|' \\\\\"\n+  echo \"           /etc/yum.repos.d/CentOS-Base.repo\"\n+  echo \"\"\n+fi", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDYzNDYwMTc1MA=="}, "originalCommit": {"oid": "4dc6a24f14de5fdab9a726fbe8c513e5e7270cb8"}, "originalPosition": 52}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkNDAyMzExMTY4OnYy", "diffSide": "RIGHT", "path": "buildenv/docker/mkdocker.sh", "isResolved": true, "comments": {"totalCount": 7, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wNS0xOFQxNzoyNToyNlrOJdNHUQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wNS0yNlQyMToyOTo1M1rOJieusA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDYzNDYwMzM0NQ==", "bodyText": "Does buildenv/ansible/roles/openj9-from-sources/tasks/main.yml need to change too?", "url": "https://github.com/eclipse-openj9/openj9/pull/11439#discussion_r634603345", "createdAt": "2021-05-18T17:25:26Z", "author": {"login": "keithc-ca"}, "path": "buildenv/docker/mkdocker.sh", "diffHunk": "@@ -532,32 +543,33 @@ prepare_user() {\n create_user() {\n   echo \"\"\n   echo \"# Add user home and copy authorized_keys and known_hosts.\"\n-  echo \"RUN useradd -ms /bin/bash $user \\\\\"\n+  echo \"RUN useradd -ms /bin/bash --uid $userid $user \\\\\"\n   echo \" && mkdir /home/$user/.ssh \\\\\"\n   echo \" && chmod 700 /home/$user/.ssh\"\n   echo \"COPY authorized_keys known_hosts /home/$user/.ssh/\"\n-  echo \"RUN chown -R $user:$user /home/$user \\\\\"\n-  echo \" && chmod 600 /home/$user/.ssh/authorized_keys /home/$user/.ssh/known_hosts\"\n+  echo \"RUN chmod 600 /home/$user/.ssh/authorized_keys /home/$user/.ssh/known_hosts \\\\\"\n+  echo \" && echo \\\"PS1=\\\\\\\"\\\\u:DOCKER-CONTAINER $ \\\\\\\"\\\" > /home/$user/.bashrc \\\\\"\n+  echo \" && echo \\\"ulimit -u 32000\\\" >> /home/$user/.bashrc \\\\\"\n+  echo \" && echo \\\"ulimit -n 2048\\\" >> /home/$user/.bashrc\"\n+}\n+\n+adjust_user_directory_perms() {\n+  echo \"RUN chown -R $user:$user /home/$user\"\n }\n \n install_freemarker() {\n   echo \"\"\n   local freemarker_version=2.3.8\n-  echo \"# Download and extract freemarker.jar to /root/freemarker.jar.\"\n-  echo \"RUN mkdir -p /root \\\\\"\n-  echo \" && cd /root \\\\\"\n+  echo \"# Download and extract freemarker.jar to /home/$user/freemarker.jar.\"", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "4dc6a24f14de5fdab9a726fbe8c513e5e7270cb8"}, "originalPosition": 86}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDYzNDg1NDI3Ng==", "bodyText": "I don't see how that is related to this bit of code?  But I suppose that can be modified as well.  The docker files that were replaced with this script were originally written for the build system to use which uses a basic user and not root user.  The user specific changes from /root -> /home/$user/ will mean a minor change to devs that use these yes, but if they are running as root they should have full access /home/$user/.\nFor freemarker.jar...is this actually a requirement for x/p/z linux platforms any more?", "url": "https://github.com/eclipse-openj9/openj9/pull/11439#discussion_r634854276", "createdAt": "2021-05-19T01:33:32Z", "author": {"login": "jdekonin"}, "path": "buildenv/docker/mkdocker.sh", "diffHunk": "@@ -532,32 +543,33 @@ prepare_user() {\n create_user() {\n   echo \"\"\n   echo \"# Add user home and copy authorized_keys and known_hosts.\"\n-  echo \"RUN useradd -ms /bin/bash $user \\\\\"\n+  echo \"RUN useradd -ms /bin/bash --uid $userid $user \\\\\"\n   echo \" && mkdir /home/$user/.ssh \\\\\"\n   echo \" && chmod 700 /home/$user/.ssh\"\n   echo \"COPY authorized_keys known_hosts /home/$user/.ssh/\"\n-  echo \"RUN chown -R $user:$user /home/$user \\\\\"\n-  echo \" && chmod 600 /home/$user/.ssh/authorized_keys /home/$user/.ssh/known_hosts\"\n+  echo \"RUN chmod 600 /home/$user/.ssh/authorized_keys /home/$user/.ssh/known_hosts \\\\\"\n+  echo \" && echo \\\"PS1=\\\\\\\"\\\\u:DOCKER-CONTAINER $ \\\\\\\"\\\" > /home/$user/.bashrc \\\\\"\n+  echo \" && echo \\\"ulimit -u 32000\\\" >> /home/$user/.bashrc \\\\\"\n+  echo \" && echo \\\"ulimit -n 2048\\\" >> /home/$user/.bashrc\"\n+}\n+\n+adjust_user_directory_perms() {\n+  echo \"RUN chown -R $user:$user /home/$user\"\n }\n \n install_freemarker() {\n   echo \"\"\n   local freemarker_version=2.3.8\n-  echo \"# Download and extract freemarker.jar to /root/freemarker.jar.\"\n-  echo \"RUN mkdir -p /root \\\\\"\n-  echo \" && cd /root \\\\\"\n+  echo \"# Download and extract freemarker.jar to /home/$user/freemarker.jar.\"", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDYzNDYwMzM0NQ=="}, "originalCommit": {"oid": "4dc6a24f14de5fdab9a726fbe8c513e5e7270cb8"}, "originalPosition": 86}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDYzNTQ2NjU2MA==", "bodyText": "x/p/z Linux all use cmake by default. It may be time to remove freemarker from the script.\nOpinions, @pshipton?", "url": "https://github.com/eclipse-openj9/openj9/pull/11439#discussion_r635466560", "createdAt": "2021-05-19T17:57:52Z", "author": {"login": "keithc-ca"}, "path": "buildenv/docker/mkdocker.sh", "diffHunk": "@@ -532,32 +543,33 @@ prepare_user() {\n create_user() {\n   echo \"\"\n   echo \"# Add user home and copy authorized_keys and known_hosts.\"\n-  echo \"RUN useradd -ms /bin/bash $user \\\\\"\n+  echo \"RUN useradd -ms /bin/bash --uid $userid $user \\\\\"\n   echo \" && mkdir /home/$user/.ssh \\\\\"\n   echo \" && chmod 700 /home/$user/.ssh\"\n   echo \"COPY authorized_keys known_hosts /home/$user/.ssh/\"\n-  echo \"RUN chown -R $user:$user /home/$user \\\\\"\n-  echo \" && chmod 600 /home/$user/.ssh/authorized_keys /home/$user/.ssh/known_hosts\"\n+  echo \"RUN chmod 600 /home/$user/.ssh/authorized_keys /home/$user/.ssh/known_hosts \\\\\"\n+  echo \" && echo \\\"PS1=\\\\\\\"\\\\u:DOCKER-CONTAINER $ \\\\\\\"\\\" > /home/$user/.bashrc \\\\\"\n+  echo \" && echo \\\"ulimit -u 32000\\\" >> /home/$user/.bashrc \\\\\"\n+  echo \" && echo \\\"ulimit -n 2048\\\" >> /home/$user/.bashrc\"\n+}\n+\n+adjust_user_directory_perms() {\n+  echo \"RUN chown -R $user:$user /home/$user\"\n }\n \n install_freemarker() {\n   echo \"\"\n   local freemarker_version=2.3.8\n-  echo \"# Download and extract freemarker.jar to /root/freemarker.jar.\"\n-  echo \"RUN mkdir -p /root \\\\\"\n-  echo \" && cd /root \\\\\"\n+  echo \"# Download and extract freemarker.jar to /home/$user/freemarker.jar.\"", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDYzNDYwMzM0NQ=="}, "originalCommit": {"oid": "4dc6a24f14de5fdab9a726fbe8c513e5e7270cb8"}, "originalPosition": 86}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDYzNTUyMTEwNQ==", "bodyText": "How about we comment it out, so it's not installed by default, but a user can uncomment if needed.", "url": "https://github.com/eclipse-openj9/openj9/pull/11439#discussion_r635521105", "createdAt": "2021-05-19T19:20:33Z", "author": {"login": "pshipton"}, "path": "buildenv/docker/mkdocker.sh", "diffHunk": "@@ -532,32 +543,33 @@ prepare_user() {\n create_user() {\n   echo \"\"\n   echo \"# Add user home and copy authorized_keys and known_hosts.\"\n-  echo \"RUN useradd -ms /bin/bash $user \\\\\"\n+  echo \"RUN useradd -ms /bin/bash --uid $userid $user \\\\\"\n   echo \" && mkdir /home/$user/.ssh \\\\\"\n   echo \" && chmod 700 /home/$user/.ssh\"\n   echo \"COPY authorized_keys known_hosts /home/$user/.ssh/\"\n-  echo \"RUN chown -R $user:$user /home/$user \\\\\"\n-  echo \" && chmod 600 /home/$user/.ssh/authorized_keys /home/$user/.ssh/known_hosts\"\n+  echo \"RUN chmod 600 /home/$user/.ssh/authorized_keys /home/$user/.ssh/known_hosts \\\\\"\n+  echo \" && echo \\\"PS1=\\\\\\\"\\\\u:DOCKER-CONTAINER $ \\\\\\\"\\\" > /home/$user/.bashrc \\\\\"\n+  echo \" && echo \\\"ulimit -u 32000\\\" >> /home/$user/.bashrc \\\\\"\n+  echo \" && echo \\\"ulimit -n 2048\\\" >> /home/$user/.bashrc\"\n+}\n+\n+adjust_user_directory_perms() {\n+  echo \"RUN chown -R $user:$user /home/$user\"\n }\n \n install_freemarker() {\n   echo \"\"\n   local freemarker_version=2.3.8\n-  echo \"# Download and extract freemarker.jar to /root/freemarker.jar.\"\n-  echo \"RUN mkdir -p /root \\\\\"\n-  echo \" && cd /root \\\\\"\n+  echo \"# Download and extract freemarker.jar to /home/$user/freemarker.jar.\"", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDYzNDYwMzM0NQ=="}, "originalCommit": {"oid": "4dc6a24f14de5fdab9a726fbe8c513e5e7270cb8"}, "originalPosition": 86}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDYzNTU0MTcxMA==", "bodyText": "If you mean hide the call to install_freemarker like this, I agree:\n# install_freemarker", "url": "https://github.com/eclipse-openj9/openj9/pull/11439#discussion_r635541710", "createdAt": "2021-05-19T19:54:26Z", "author": {"login": "keithc-ca"}, "path": "buildenv/docker/mkdocker.sh", "diffHunk": "@@ -532,32 +543,33 @@ prepare_user() {\n create_user() {\n   echo \"\"\n   echo \"# Add user home and copy authorized_keys and known_hosts.\"\n-  echo \"RUN useradd -ms /bin/bash $user \\\\\"\n+  echo \"RUN useradd -ms /bin/bash --uid $userid $user \\\\\"\n   echo \" && mkdir /home/$user/.ssh \\\\\"\n   echo \" && chmod 700 /home/$user/.ssh\"\n   echo \"COPY authorized_keys known_hosts /home/$user/.ssh/\"\n-  echo \"RUN chown -R $user:$user /home/$user \\\\\"\n-  echo \" && chmod 600 /home/$user/.ssh/authorized_keys /home/$user/.ssh/known_hosts\"\n+  echo \"RUN chmod 600 /home/$user/.ssh/authorized_keys /home/$user/.ssh/known_hosts \\\\\"\n+  echo \" && echo \\\"PS1=\\\\\\\"\\\\u:DOCKER-CONTAINER $ \\\\\\\"\\\" > /home/$user/.bashrc \\\\\"\n+  echo \" && echo \\\"ulimit -u 32000\\\" >> /home/$user/.bashrc \\\\\"\n+  echo \" && echo \\\"ulimit -n 2048\\\" >> /home/$user/.bashrc\"\n+}\n+\n+adjust_user_directory_perms() {\n+  echo \"RUN chown -R $user:$user /home/$user\"\n }\n \n install_freemarker() {\n   echo \"\"\n   local freemarker_version=2.3.8\n-  echo \"# Download and extract freemarker.jar to /root/freemarker.jar.\"\n-  echo \"RUN mkdir -p /root \\\\\"\n-  echo \" && cd /root \\\\\"\n+  echo \"# Download and extract freemarker.jar to /home/$user/freemarker.jar.\"", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDYzNDYwMzM0NQ=="}, "originalCommit": {"oid": "4dc6a24f14de5fdab9a726fbe8c513e5e7270cb8"}, "originalPosition": 86}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDYzNTU0Nzk1NQ==", "bodyText": "Yes, that is what I mean.", "url": "https://github.com/eclipse-openj9/openj9/pull/11439#discussion_r635547955", "createdAt": "2021-05-19T20:05:17Z", "author": {"login": "pshipton"}, "path": "buildenv/docker/mkdocker.sh", "diffHunk": "@@ -532,32 +543,33 @@ prepare_user() {\n create_user() {\n   echo \"\"\n   echo \"# Add user home and copy authorized_keys and known_hosts.\"\n-  echo \"RUN useradd -ms /bin/bash $user \\\\\"\n+  echo \"RUN useradd -ms /bin/bash --uid $userid $user \\\\\"\n   echo \" && mkdir /home/$user/.ssh \\\\\"\n   echo \" && chmod 700 /home/$user/.ssh\"\n   echo \"COPY authorized_keys known_hosts /home/$user/.ssh/\"\n-  echo \"RUN chown -R $user:$user /home/$user \\\\\"\n-  echo \" && chmod 600 /home/$user/.ssh/authorized_keys /home/$user/.ssh/known_hosts\"\n+  echo \"RUN chmod 600 /home/$user/.ssh/authorized_keys /home/$user/.ssh/known_hosts \\\\\"\n+  echo \" && echo \\\"PS1=\\\\\\\"\\\\u:DOCKER-CONTAINER $ \\\\\\\"\\\" > /home/$user/.bashrc \\\\\"\n+  echo \" && echo \\\"ulimit -u 32000\\\" >> /home/$user/.bashrc \\\\\"\n+  echo \" && echo \\\"ulimit -n 2048\\\" >> /home/$user/.bashrc\"\n+}\n+\n+adjust_user_directory_perms() {\n+  echo \"RUN chown -R $user:$user /home/$user\"\n }\n \n install_freemarker() {\n   echo \"\"\n   local freemarker_version=2.3.8\n-  echo \"# Download and extract freemarker.jar to /root/freemarker.jar.\"\n-  echo \"RUN mkdir -p /root \\\\\"\n-  echo \" && cd /root \\\\\"\n+  echo \"# Download and extract freemarker.jar to /home/$user/freemarker.jar.\"", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDYzNDYwMzM0NQ=="}, "originalCommit": {"oid": "4dc6a24f14de5fdab9a726fbe8c513e5e7270cb8"}, "originalPosition": 86}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDY0MDEzNDgzMg==", "bodyText": "Commented out in my latest push.", "url": "https://github.com/eclipse-openj9/openj9/pull/11439#discussion_r640134832", "createdAt": "2021-05-26T21:29:53Z", "author": {"login": "jdekonin"}, "path": "buildenv/docker/mkdocker.sh", "diffHunk": "@@ -532,32 +543,33 @@ prepare_user() {\n create_user() {\n   echo \"\"\n   echo \"# Add user home and copy authorized_keys and known_hosts.\"\n-  echo \"RUN useradd -ms /bin/bash $user \\\\\"\n+  echo \"RUN useradd -ms /bin/bash --uid $userid $user \\\\\"\n   echo \" && mkdir /home/$user/.ssh \\\\\"\n   echo \" && chmod 700 /home/$user/.ssh\"\n   echo \"COPY authorized_keys known_hosts /home/$user/.ssh/\"\n-  echo \"RUN chown -R $user:$user /home/$user \\\\\"\n-  echo \" && chmod 600 /home/$user/.ssh/authorized_keys /home/$user/.ssh/known_hosts\"\n+  echo \"RUN chmod 600 /home/$user/.ssh/authorized_keys /home/$user/.ssh/known_hosts \\\\\"\n+  echo \" && echo \\\"PS1=\\\\\\\"\\\\u:DOCKER-CONTAINER $ \\\\\\\"\\\" > /home/$user/.bashrc \\\\\"\n+  echo \" && echo \\\"ulimit -u 32000\\\" >> /home/$user/.bashrc \\\\\"\n+  echo \" && echo \\\"ulimit -n 2048\\\" >> /home/$user/.bashrc\"\n+}\n+\n+adjust_user_directory_perms() {\n+  echo \"RUN chown -R $user:$user /home/$user\"\n }\n \n install_freemarker() {\n   echo \"\"\n   local freemarker_version=2.3.8\n-  echo \"# Download and extract freemarker.jar to /root/freemarker.jar.\"\n-  echo \"RUN mkdir -p /root \\\\\"\n-  echo \" && cd /root \\\\\"\n+  echo \"# Download and extract freemarker.jar to /home/$user/freemarker.jar.\"", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDYzNDYwMzM0NQ=="}, "originalCommit": {"oid": "4dc6a24f14de5fdab9a726fbe8c513e5e7270cb8"}, "originalPosition": 86}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkNDA2MzYwMzkyOnYy", "diffSide": "RIGHT", "path": "buildenv/docker/mkdocker.sh", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wNS0yN1QxNTo0ODowNFrOJjEaZw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wNS0yN1QyMTowNTowNlrOJjRazg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDY0MDc1MjIzMQ==", "bodyText": "This could be simplified so it doesn't need to mention individual files:\n  chmod -R go= /home/$user/.ssh", "url": "https://github.com/eclipse-openj9/openj9/pull/11439#discussion_r640752231", "createdAt": "2021-05-27T15:48:04Z", "author": {"login": "keithc-ca"}, "path": "buildenv/docker/mkdocker.sh", "diffHunk": "@@ -532,32 +536,31 @@ prepare_user() {\n create_user() {\n   echo \"\"\n   echo \"# Add user home and copy authorized_keys and known_hosts.\"\n-  echo \"RUN useradd -ms /bin/bash $user \\\\\"\n+  echo \"RUN useradd -ms /bin/bash --uid $userid $user \\\\\"\n   echo \" && mkdir /home/$user/.ssh \\\\\"\n   echo \" && chmod 700 /home/$user/.ssh\"\n   echo \"COPY authorized_keys known_hosts /home/$user/.ssh/\"\n-  echo \"RUN chown -R $user:$user /home/$user \\\\\"\n-  echo \" && chmod 600 /home/$user/.ssh/authorized_keys /home/$user/.ssh/known_hosts\"\n+  echo \"RUN chmod 600 /home/$user/.ssh/authorized_keys /home/$user/.ssh/known_hosts \\\\\"", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "76db7afff254ae22071c15755ef61542626db6a4"}, "originalPosition": 63}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDY0MDk2NTMyNg==", "bodyText": "Added to this latest commit.", "url": "https://github.com/eclipse-openj9/openj9/pull/11439#discussion_r640965326", "createdAt": "2021-05-27T21:05:06Z", "author": {"login": "jdekonin"}, "path": "buildenv/docker/mkdocker.sh", "diffHunk": "@@ -532,32 +536,31 @@ prepare_user() {\n create_user() {\n   echo \"\"\n   echo \"# Add user home and copy authorized_keys and known_hosts.\"\n-  echo \"RUN useradd -ms /bin/bash $user \\\\\"\n+  echo \"RUN useradd -ms /bin/bash --uid $userid $user \\\\\"\n   echo \" && mkdir /home/$user/.ssh \\\\\"\n   echo \" && chmod 700 /home/$user/.ssh\"\n   echo \"COPY authorized_keys known_hosts /home/$user/.ssh/\"\n-  echo \"RUN chown -R $user:$user /home/$user \\\\\"\n-  echo \" && chmod 600 /home/$user/.ssh/authorized_keys /home/$user/.ssh/known_hosts\"\n+  echo \"RUN chmod 600 /home/$user/.ssh/authorized_keys /home/$user/.ssh/known_hosts \\\\\"", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDY0MDc1MjIzMQ=="}, "originalCommit": {"oid": "76db7afff254ae22071c15755ef61542626db6a4"}, "originalPosition": 63}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkNDA2MzYxMTg2OnYy", "diffSide": "RIGHT", "path": "buildenv/docker/mkdocker.sh", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wNS0yN1QxNTo0OTozMlrOJjEfSw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wNS0yN1QyMTowNDozN1rOJjRZzg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDY0MDc1MzQ4Mw==", "bodyText": "I'd prefer to see this controlled by an option, say, --freemarker.", "url": "https://github.com/eclipse-openj9/openj9/pull/11439#discussion_r640753483", "createdAt": "2021-05-27T15:49:32Z", "author": {"login": "keithc-ca"}, "path": "buildenv/docker/mkdocker.sh", "diffHunk": "@@ -671,7 +674,7 @@ print_dockerfile() {\n if [ $cuda != no ] ; then\n   install_cuda\n fi\n-  install_freemarker\n+  #install_freemarker", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "76db7afff254ae22071c15755ef61542626db6a4"}, "originalPosition": 109}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDY0MDk2NTA3MA==", "bodyText": "Added to this latest commit.", "url": "https://github.com/eclipse-openj9/openj9/pull/11439#discussion_r640965070", "createdAt": "2021-05-27T21:04:37Z", "author": {"login": "jdekonin"}, "path": "buildenv/docker/mkdocker.sh", "diffHunk": "@@ -671,7 +674,7 @@ print_dockerfile() {\n if [ $cuda != no ] ; then\n   install_cuda\n fi\n-  install_freemarker\n+  #install_freemarker", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDY0MDc1MzQ4Mw=="}, "originalCommit": {"oid": "76db7afff254ae22071c15755ef61542626db6a4"}, "originalPosition": 109}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkNDA2MzYxNTg2OnYy", "diffSide": "RIGHT", "path": "buildenv/jenkins/docker-nodes/README.md", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wNS0yN1QxNTo1MDoxOFrOJjEhww==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wNS0yN1QyMTowNDo1NFrOJjRaew==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDY0MDc1NDExNQ==", "bodyText": "Is the slash in /https intentional?", "url": "https://github.com/eclipse-openj9/openj9/pull/11439#discussion_r640754115", "createdAt": "2021-05-27T15:50:18Z", "author": {"login": "keithc-ca"}, "path": "buildenv/jenkins/docker-nodes/README.md", "diffHunk": "@@ -34,32 +34,32 @@ same environment every time.\n |:---------:|:------------:|:-------------:|:-------------:|\n | Ubuntu16  |  Test Only   | Build & Test  |   Test Only   |\n | Ubuntu18  |  Test Only   |   Test Only   |   Test Only   |\n-| Centos6.9 | Build & Test | Not Available | Not Available |\n+| Centos6   | Build & Test | Not Available | Not Available |\n | Centos7   | To be Added  |  To be Added  | Build & Test  |\n | Windows   | To be Added  | Not Available | Not Available |\n \n ## Eclipse OpenJ9 CI\n Generated Dockerfiles are used by two Jenkins jobs at Eclipse to\n-build docker images. The first [job](https://ci.eclipse.org/openj9/view/Build/job/Build-Jenkins-Agent-Container/) is run manually\n+build docker images. The first [job](/https://openj9-jenkins.osuosl.org/job/Build-Jenkins-Agent-Container/) is run manually", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "76db7afff254ae22071c15755ef61542626db6a4"}, "originalPosition": 12}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDY0MDk2NTI0Mw==", "bodyText": "Accidental, corrected in the latest commit.", "url": "https://github.com/eclipse-openj9/openj9/pull/11439#discussion_r640965243", "createdAt": "2021-05-27T21:04:54Z", "author": {"login": "jdekonin"}, "path": "buildenv/jenkins/docker-nodes/README.md", "diffHunk": "@@ -34,32 +34,32 @@ same environment every time.\n |:---------:|:------------:|:-------------:|:-------------:|\n | Ubuntu16  |  Test Only   | Build & Test  |   Test Only   |\n | Ubuntu18  |  Test Only   |   Test Only   |   Test Only   |\n-| Centos6.9 | Build & Test | Not Available | Not Available |\n+| Centos6   | Build & Test | Not Available | Not Available |\n | Centos7   | To be Added  |  To be Added  | Build & Test  |\n | Windows   | To be Added  | Not Available | Not Available |\n \n ## Eclipse OpenJ9 CI\n Generated Dockerfiles are used by two Jenkins jobs at Eclipse to\n-build docker images. The first [job](https://ci.eclipse.org/openj9/view/Build/job/Build-Jenkins-Agent-Container/) is run manually\n+build docker images. The first [job](/https://openj9-jenkins.osuosl.org/job/Build-Jenkins-Agent-Container/) is run manually", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDY0MDc1NDExNQ=="}, "originalCommit": {"oid": "76db7afff254ae22071c15755ef61542626db6a4"}, "originalPosition": 12}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkNDA2NTAwNTYwOnYy", "diffSide": "RIGHT", "path": "buildenv/docker/mkdocker.sh", "isResolved": true, "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wNS0yN1QyMToxNjozNVrOJjR3ug==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wNS0yN1QyMTo1Mjo1MlrOJjTNXw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDY0MDk3MjczMA==", "bodyText": "The options were listed in alphabetical order, and the variables and cases were ordered likewise.", "url": "https://github.com/eclipse-openj9/openj9/pull/11439#discussion_r640972730", "createdAt": "2021-05-27T21:16:35Z", "author": {"login": "keithc-ca"}, "path": "buildenv/docker/mkdocker.sh", "diffHunk": "@@ -33,16 +33,17 @@ usage() {\n   echo \"  --arch=...     specify the processor architecture (default: host architecture)\"\n   echo \"  --build        build the docker image (overrides '--print')\"\n   echo \"  --cuda         include CUDA header files\"\n+  echo \"  --freemarker   include freemarker.jar\"", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "cf51c6e8e0801cddf5a12f78ff50b48817ae2e00"}, "originalPosition": 4}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDY0MDk4NzQwMQ==", "bodyText": "Moved", "url": "https://github.com/eclipse-openj9/openj9/pull/11439#discussion_r640987401", "createdAt": "2021-05-27T21:38:10Z", "author": {"login": "jdekonin"}, "path": "buildenv/docker/mkdocker.sh", "diffHunk": "@@ -33,16 +33,17 @@ usage() {\n   echo \"  --arch=...     specify the processor architecture (default: host architecture)\"\n   echo \"  --build        build the docker image (overrides '--print')\"\n   echo \"  --cuda         include CUDA header files\"\n+  echo \"  --freemarker   include freemarker.jar\"", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDY0MDk3MjczMA=="}, "originalCommit": {"oid": "cf51c6e8e0801cddf5a12f78ff50b48817ae2e00"}, "originalPosition": 4}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDY0MDk5NDY1NQ==", "bodyText": "I wasn't going to insist, but thanks.", "url": "https://github.com/eclipse-openj9/openj9/pull/11439#discussion_r640994655", "createdAt": "2021-05-27T21:52:52Z", "author": {"login": "keithc-ca"}, "path": "buildenv/docker/mkdocker.sh", "diffHunk": "@@ -33,16 +33,17 @@ usage() {\n   echo \"  --arch=...     specify the processor architecture (default: host architecture)\"\n   echo \"  --build        build the docker image (overrides '--print')\"\n   echo \"  --cuda         include CUDA header files\"\n+  echo \"  --freemarker   include freemarker.jar\"", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDY0MDk3MjczMA=="}, "originalCommit": {"oid": "cf51c6e8e0801cddf5a12f78ff50b48817ae2e00"}, "originalPosition": 4}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkNDA2NTA0NDM0OnYy", "diffSide": "RIGHT", "path": "buildenv/docker/mkdocker.sh", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wNS0yN1QyMToyNjowOFrOJjSPCA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wNS0yN1QyMTo0MDozN1rOJjS2Uw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDY0MDk3ODY5Ng==", "bodyText": "What is this for? Isn't it redundant with the -y option in yum install -y?", "url": "https://github.com/eclipse-openj9/openj9/pull/11439#discussion_r640978696", "createdAt": "2021-05-27T21:26:08Z", "author": {"login": "keithc-ca"}, "path": "buildenv/docker/mkdocker.sh", "diffHunk": "@@ -223,10 +229,15 @@ fi\n }\n \n install_centos_packages() {\n-  echo \"RUN yum -y update \\\\\"\n-if [ $version = 6.9 ] ; then\n-  echo \" && yum -y install https://repo.ius.io/ius-release-el6.rpm \\\\\"\n+if [ $version = 6 ] ; then\n+  echo \"RUN sed -i -e 's|mirrorlist|#mirrorlist|' \\\\\"\n+  echo \"           -e 's|#baseurl=http://mirror.centos.org/centos/\\$releasever|baseurl=https://vault.centos.org/6.10|' \\\\\"\n+  echo \"           /etc/yum.repos.d/CentOS-Base.repo\"\n+  echo \"\"\n fi\n+  echo \"RUN yum -y update \\\\\"\n+  echo \" && echo \"assumeyes=1\" >> /etc/yum.conf \\\\\"", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "cf51c6e8e0801cddf5a12f78ff50b48817ae2e00"}, "originalPosition": 68}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDY0MDk4ODc1NQ==", "bodyText": "The extra line for yum.conf was because I had a failure/prompt with the epel-release repo line.  But I cannot seem to reproduce in a minimal testcase.  I removed.", "url": "https://github.com/eclipse-openj9/openj9/pull/11439#discussion_r640988755", "createdAt": "2021-05-27T21:40:37Z", "author": {"login": "jdekonin"}, "path": "buildenv/docker/mkdocker.sh", "diffHunk": "@@ -223,10 +229,15 @@ fi\n }\n \n install_centos_packages() {\n-  echo \"RUN yum -y update \\\\\"\n-if [ $version = 6.9 ] ; then\n-  echo \" && yum -y install https://repo.ius.io/ius-release-el6.rpm \\\\\"\n+if [ $version = 6 ] ; then\n+  echo \"RUN sed -i -e 's|mirrorlist|#mirrorlist|' \\\\\"\n+  echo \"           -e 's|#baseurl=http://mirror.centos.org/centos/\\$releasever|baseurl=https://vault.centos.org/6.10|' \\\\\"\n+  echo \"           /etc/yum.repos.d/CentOS-Base.repo\"\n+  echo \"\"\n fi\n+  echo \"RUN yum -y update \\\\\"\n+  echo \" && echo \"assumeyes=1\" >> /etc/yum.conf \\\\\"", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDY0MDk3ODY5Ng=="}, "originalCommit": {"oid": "cf51c6e8e0801cddf5a12f78ff50b48817ae2e00"}, "originalPosition": 68}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 867, "cost": 1, "resetAt": "2021-11-12T13:16:51Z"}}}