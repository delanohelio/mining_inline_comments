{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDM1MzQ5NjAx", "number": 9904, "title": "Retrieve info from the client in isClassRefValueType", "bodyText": "The query of isClassRefValueType should be done at the client instead of the server. Sending a message to the client to check if a class reference entry in the constant pool represents a value type class.\nFixes #9892\nSigned-off-by: Annabelle Huo Annabelle.Huo@ibm.com", "createdAt": "2020-06-16T16:59:27Z", "url": "https://github.com/eclipse-openj9/openj9/pull/9904", "merged": true, "mergeCommit": {"oid": "46e5b7746883e7c5b86ae6980a05a9bb8d5f9c62"}, "closed": true, "closedAt": "2020-06-16T23:48:32Z", "author": {"login": "a7ehuo"}, "timelineItems": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcr5WNCAFqTQzMTc1MzYyOA==", "endCursor": "Y3Vyc29yOnYyOpPPAAABcr5mxlABqjM0NTAzMjQzMTc=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDMxNzUzNjI4", "url": "https://github.com/eclipse-openj9/openj9/pull/9904#pullrequestreview-431753628", "createdAt": "2020-06-16T17:53:52Z", "commit": {"oid": "2e6f38680299c86c4f747987ba8838129bc7cf68"}, "state": "APPROVED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xNlQxNzo1Mzo1MlrOGkmuCQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xNlQxNzo1Mzo1MlrOGkmuCQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MTAzNjI5Nw==", "bodyText": "Could we shed one level of indirection by calling comp->fej9()->getJ9JITConfig()->javaVM here?", "url": "https://github.com/eclipse-openj9/openj9/pull/9904#discussion_r441036297", "createdAt": "2020-06-16T17:53:52Z", "author": {"login": "mpirvu"}, "path": "runtime/compiler/env/J9ClassEnv.cpp", "diffHunk": "@@ -735,7 +735,17 @@ J9::ClassEnv::containsZeroOrOneConcreteClass(TR::Compilation *comp, List<TR_Pers\n bool\n J9::ClassEnv::isClassRefValueType(TR::Compilation *comp, TR_OpaqueClassBlock *cpContextClass, int32_t cpIndex)\n    {\n-   J9Class * j9class = reinterpret_cast<J9Class *>(cpContextClass);\n-   J9JavaVM *vm = getJ9JitConfigFromFE(comp->fej9())->javaVM;\n-   return vm->internalVMFunctions->isClassRefQtype(j9class, cpIndex);\n+#if defined(J9VM_OPT_JITSERVER)\n+   if (auto stream = TR::CompilationInfo::getStream())\n+      {\n+      stream->write(JITServer::MessageType::ClassEnv_isClassRefValueType, cpContextClass, cpIndex);\n+      return std::get<0>(stream->read<bool>());\n+      }\n+   else // non-jitserver\n+#endif /* defined(J9VM_OPT_JITSERVER) */\n+      {\n+      J9Class * j9class = reinterpret_cast<J9Class *>(cpContextClass);\n+      J9JavaVM *vm = getJ9JitConfigFromFE(comp->fej9())->javaVM;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "2e6f38680299c86c4f747987ba8838129bc7cf68"}, "originalPosition": 17}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b5bc4e897d607999d1c6462a80fb1886184da4db", "author": {"user": {"login": "a7ehuo", "name": "Annabelle Huo"}}, "url": "https://github.com/eclipse-openj9/openj9/commit/b5bc4e897d607999d1c6462a80fb1886184da4db", "committedDate": "2020-06-16T18:31:26Z", "message": "Retrieve info from the client in isClassRefValueType\n\nThe query of isClassRefValueType should be done at the client\ninstead of the server. Sending a message to the client to\ncheck if a class reference entry in the constant pool\nrepresents a value type class.\n\nFixes #9892\n\nSigned-off-by: Annabelle Huo <Annabelle.Huo@ibm.com>"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "2e6f38680299c86c4f747987ba8838129bc7cf68", "author": {"user": {"login": "a7ehuo", "name": "Annabelle Huo"}}, "url": "https://github.com/eclipse-openj9/openj9/commit/2e6f38680299c86c4f747987ba8838129bc7cf68", "committedDate": "2020-06-16T16:55:24Z", "message": "Retrieve info from the client in isClassRefValueType\n\nThe query of isClassRefValueType should be done at the client\ninstead of the server. Sending a message to the client to\ncheck if a class reference entry in the constant pool\nrepresents a value type class.\n\nFixes #9892\n\nSigned-off-by: Annabelle Huo <Annabelle.Huo@ibm.com>"}, "afterCommit": {"oid": "b5bc4e897d607999d1c6462a80fb1886184da4db", "author": {"user": {"login": "a7ehuo", "name": "Annabelle Huo"}}, "url": "https://github.com/eclipse-openj9/openj9/commit/b5bc4e897d607999d1c6462a80fb1886184da4db", "committedDate": "2020-06-16T18:31:26Z", "message": "Retrieve info from the client in isClassRefValueType\n\nThe query of isClassRefValueType should be done at the client\ninstead of the server. Sending a message to the client to\ncheck if a class reference entry in the constant pool\nrepresents a value type class.\n\nFixes #9892\n\nSigned-off-by: Annabelle Huo <Annabelle.Huo@ibm.com>"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 704, "cost": 1, "resetAt": "2021-10-28T17:48:14Z"}}}