{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0Mzk2OTg4NzI3", "number": 9067, "reviewThreads": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wMlQyMjoxNzoyNFrODuI4nw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wMlQyMjoyMDoyMVrODuI7zA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjQ5NzA2NjU1OnYy", "diffSide": "RIGHT", "path": "runtime/compiler/env/J9ClassEnv.cpp", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wMlQyMjoxNzoyNFrOF_-dgA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wM1QxNDozNjo0M1rOGAYSUQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMjYyNzk2OA==", "bodyText": "You need to include the header file with the definition of TR_PersistentClassInfo", "url": "https://github.com/eclipse-openj9/openj9/pull/9067#discussion_r402627968", "createdAt": "2020-04-02T22:17:24Z", "author": {"login": "mpirvu"}, "path": "runtime/compiler/env/J9ClassEnv.cpp", "diffHunk": "@@ -38,6 +38,8 @@\n #include \"j9fieldsInfo.h\"\n #include \"rommeth.h\"\n \n+class TR_PersistentClassInfo;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "8309612c33ca70889ebea3ceca695805168cff2b"}, "originalPosition": 4}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMzA1MTA4OQ==", "bodyText": "Okay, TR_PersistentClassInfo is defined in RuntimeAssumptions.hpp, added below line in this file.\n#include \"runtime/RuntimeAssumptions.hpp\"", "url": "https://github.com/eclipse-openj9/openj9/pull/9067#discussion_r403051089", "createdAt": "2020-04-03T14:36:43Z", "author": {"login": "chrisc66"}, "path": "runtime/compiler/env/J9ClassEnv.cpp", "diffHunk": "@@ -38,6 +38,8 @@\n #include \"j9fieldsInfo.h\"\n #include \"rommeth.h\"\n \n+class TR_PersistentClassInfo;", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMjYyNzk2OA=="}, "originalCommit": {"oid": "8309612c33ca70889ebea3ceca695805168cff2b"}, "originalPosition": 4}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjQ5NzA3MDYyOnYy", "diffSide": "RIGHT", "path": "runtime/compiler/env/J9ClassEnv.cpp", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wMlQyMjoxODo1M1rOF_-f5A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wMlQyMjoxODo1M1rOF_-f5A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMjYyODU4MA==", "bodyText": "typo: caches --> cached", "url": "https://github.com/eclipse-openj9/openj9/pull/9067#discussion_r402628580", "createdAt": "2020-04-02T22:18:53Z", "author": {"login": "mpirvu"}, "path": "runtime/compiler/env/J9ClassEnv.cpp", "diffHunk": "@@ -642,3 +644,57 @@ J9::ClassEnv::isValueTypeClass(TR_OpaqueClassBlock *clazz)\n    J9Class *j9class = reinterpret_cast<J9Class*>(clazz);\n    return J9_IS_J9CLASS_VALUETYPE(j9class);\n    }\n+\n+bool \n+J9::ClassEnv::containesZeroOrOneConcreteClass(TR::Compilation *comp, List<TR_PersistentClassInfo>* subClasses)\n+   {\n+   int count = 0;\n+#if defined(J9VM_OPT_JITSERVER)\n+   ListIterator<TR_PersistentClassInfo> j(subClasses);\n+   TR_ScratchList<TR_PersistentClassInfo> subClassesNotCached(comp->trMemory());\n+   \n+   // Process classes caches at the server first", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "8309612c33ca70889ebea3ceca695805168cff2b"}, "originalPosition": 22}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjQ5NzA3NDY4OnYy", "diffSide": "RIGHT", "path": "runtime/compiler/env/J9ClassEnv.cpp", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wMlQyMjoyMDoyMVrOF_-iWA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wMlQyMjoyMDoyMVrOF_-iWA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMjYyOTIwOA==", "bodyText": "Please take TR::compInfoPT->getClientData() outside the loop by storing it in a local variable. That TR::compInfoPT is accessing thread local storage which is expensive to get to.", "url": "https://github.com/eclipse-openj9/openj9/pull/9067#discussion_r402629208", "createdAt": "2020-04-02T22:20:21Z", "author": {"login": "mpirvu"}, "path": "runtime/compiler/env/J9ClassEnv.cpp", "diffHunk": "@@ -642,3 +644,57 @@ J9::ClassEnv::isValueTypeClass(TR_OpaqueClassBlock *clazz)\n    J9Class *j9class = reinterpret_cast<J9Class*>(clazz);\n    return J9_IS_J9CLASS_VALUETYPE(j9class);\n    }\n+\n+bool \n+J9::ClassEnv::containesZeroOrOneConcreteClass(TR::Compilation *comp, List<TR_PersistentClassInfo>* subClasses)\n+   {\n+   int count = 0;\n+#if defined(J9VM_OPT_JITSERVER)\n+   ListIterator<TR_PersistentClassInfo> j(subClasses);\n+   TR_ScratchList<TR_PersistentClassInfo> subClassesNotCached(comp->trMemory());\n+   \n+   // Process classes caches at the server first\n+   for (TR_PersistentClassInfo *ptClassInfo = j.getFirst(); ptClassInfo; ptClassInfo = j.getNext())\n+      {\n+      TR_OpaqueClassBlock *clazz = ptClassInfo->getClassId();\n+      J9Class *j9clazz = TR::Compiler->cls.convertClassOffsetToClassPtr(clazz);\n+      auto romClass = JITServerHelpers::getRemoteROMClassIfCached(TR::compInfoPT->getClientData(), j9clazz);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "8309612c33ca70889ebea3ceca695805168cff2b"}, "originalPosition": 27}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 467, "cost": 1, "resetAt": "2021-11-12T13:16:51Z"}}}