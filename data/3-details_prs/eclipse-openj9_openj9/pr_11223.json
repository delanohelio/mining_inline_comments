{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTIzMzY5NDY2", "number": 11223, "title": "Resolve issues when restoring with -Xjit", "bodyText": "Resolve issue when restoring with -Xjit\npromotedMethodOnTransitionFromJIT clobbers the tempslot which is used\nto store the restore BP for the thread.\nRuntimeAssumptions are serialized at JVM shutdown, need to serialize\nthem at image gen time.\nThis PR enables -Xjit as long as direct to JNI is disabled:\nSnapshot:\n/java -Xjit:disableDirectToJNI -Xmx16m -Xms8m -Xgcpolicy:optthruput -Xshare:off -Xsnapshot:file=image,trigger=Hello.snapshot -cp ~/. Hello\nRestore:\n./java -Xjit:disableDirectToJNI -Xmx16m -Xms9m -Xgcpolicy:optthruput -Xshare:off -Xrestore:file=image -cp ~/. Hello\nSigned-off-by: Tobi Ajila atobia@ca.ibm.com", "createdAt": "2020-11-18T17:54:01Z", "url": "https://github.com/eclipse-openj9/openj9/pull/11223", "merged": true, "mergeCommit": {"oid": "b80c63b133ba8d15a8710224a847000abcf36d01"}, "closed": true, "closedAt": "2020-11-27T16:09:08Z", "author": {"login": "tajila"}, "timelineItems": {"totalCount": 9, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABddzYkbABqjQwMTIzOTkxMjg=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdgp2xsgFqTU0MDA3OTU3Ng==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "07a867b68bbfd80c993409ea0b0ae9bb8aa3b273", "author": {"user": {"login": "tajila", "name": "Tobi"}}, "url": "https://github.com/eclipse-openj9/openj9/commit/07a867b68bbfd80c993409ea0b0ae9bb8aa3b273", "committedDate": "2020-11-18T17:53:22Z", "message": "Resolve issue when restoring with -Xjit\n\n`promotedMethodOnTransitionFromJIT` clobbers the tempslot which is used\nto store the restore BP for the thread.\n\nRuntimeAssumptions are serialized at JVM shutdown, need to serialize\nthem at image gen time.\n\nSigned-off-by: Tobi Ajila <atobia@ca.ibm.com>"}, "afterCommit": {"oid": "35cca67baf4c225c28244dd0fd82350eecbd7388", "author": {"user": {"login": "tajila", "name": "Tobi"}}, "url": "https://github.com/eclipse-openj9/openj9/commit/35cca67baf4c225c28244dd0fd82350eecbd7388", "committedDate": "2020-11-18T19:32:52Z", "message": "Resolve issue when restoring with -Xjit\n\n`promotedMethodOnTransitionFromJIT` clobbers the tempslot which is used\nto store the restore BP for the thread.\n\nRuntimeAssumptions are serialized at JVM shutdown, need to serialize\nthem at image gen time.\n\nSigned-off-by: Tobi Ajila <atobia@ca.ibm.com>"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "35cca67baf4c225c28244dd0fd82350eecbd7388", "author": {"user": {"login": "tajila", "name": "Tobi"}}, "url": "https://github.com/eclipse-openj9/openj9/commit/35cca67baf4c225c28244dd0fd82350eecbd7388", "committedDate": "2020-11-18T19:32:52Z", "message": "Resolve issue when restoring with -Xjit\n\n`promotedMethodOnTransitionFromJIT` clobbers the tempslot which is used\nto store the restore BP for the thread.\n\nRuntimeAssumptions are serialized at JVM shutdown, need to serialize\nthem at image gen time.\n\nSigned-off-by: Tobi Ajila <atobia@ca.ibm.com>"}, "afterCommit": {"oid": "7f9adc107ee5fa941f19894b11a14c4d1b10260f", "author": {"user": {"login": "tajila", "name": "Tobi"}}, "url": "https://github.com/eclipse-openj9/openj9/commit/7f9adc107ee5fa941f19894b11a14c4d1b10260f", "committedDate": "2020-11-18T19:35:49Z", "message": "Resolve issue when restoring with -Xjit\n\n`promotedMethodOnTransitionFromJIT` clobbers the tempslot which is used\nto store the restore BP for the thread.\n\nRuntimeAssumptions are serialized at JVM shutdown, need to serialize\nthem at image gen time.\n\nSigned-off-by: Tobi Ajila <atobia@ca.ibm.com>"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "7f9adc107ee5fa941f19894b11a14c4d1b10260f", "author": {"user": {"login": "tajila", "name": "Tobi"}}, "url": "https://github.com/eclipse-openj9/openj9/commit/7f9adc107ee5fa941f19894b11a14c4d1b10260f", "committedDate": "2020-11-18T19:35:49Z", "message": "Resolve issue when restoring with -Xjit\n\n`promotedMethodOnTransitionFromJIT` clobbers the tempslot which is used\nto store the restore BP for the thread.\n\nRuntimeAssumptions are serialized at JVM shutdown, need to serialize\nthem at image gen time.\n\nSigned-off-by: Tobi Ajila <atobia@ca.ibm.com>"}, "afterCommit": {"oid": "ac27bdd850f85c6649163eb7d7327d1e39227295", "author": {"user": {"login": "tajila", "name": "Tobi"}}, "url": "https://github.com/eclipse-openj9/openj9/commit/ac27bdd850f85c6649163eb7d7327d1e39227295", "committedDate": "2020-11-18T19:40:26Z", "message": "Resolve issue when restoring with -Xjit\n\n`promotedMethodOnTransitionFromJIT` clobbers the tempslot which is used\nto store the restore BP for the thread.\n\nRuntimeAssumptions are serialized at JVM shutdown, need to serialize\nthem at image gen time.\n\nThis PR enables -Xjit as long as direct to JNI is disabled:\n\nSnapshot:\n`./java -Xjit:disableDirectToJNI -Xmx16m -Xms8m -Xgcpolicy:optthruput\n-Xshare:off -Xsnapshot:file=image,trigger=Hello.snapshot -cp ~/. Hello`\n\nRestore:\n`./java -Xjit:disableDirectToJNI -Xmx16m -Xms9m -Xgcpolicy:optthruput\n-Xshare:off -Xrestore:file=image -cp ~/. Hello`\n\nSigned-off-by: Tobi Ajila <atobia@ca.ibm.com>"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTMzODU0ODQy", "url": "https://github.com/eclipse-openj9/openj9/pull/11223#pullrequestreview-533854842", "createdAt": "2020-11-18T20:36:57Z", "commit": {"oid": "ac27bdd850f85c6649163eb7d7327d1e39227295"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "ac27bdd850f85c6649163eb7d7327d1e39227295", "author": {"user": {"login": "tajila", "name": "Tobi"}}, "url": "https://github.com/eclipse-openj9/openj9/commit/ac27bdd850f85c6649163eb7d7327d1e39227295", "committedDate": "2020-11-18T19:40:26Z", "message": "Resolve issue when restoring with -Xjit\n\n`promotedMethodOnTransitionFromJIT` clobbers the tempslot which is used\nto store the restore BP for the thread.\n\nRuntimeAssumptions are serialized at JVM shutdown, need to serialize\nthem at image gen time.\n\nThis PR enables -Xjit as long as direct to JNI is disabled:\n\nSnapshot:\n`./java -Xjit:disableDirectToJNI -Xmx16m -Xms8m -Xgcpolicy:optthruput\n-Xshare:off -Xsnapshot:file=image,trigger=Hello.snapshot -cp ~/. Hello`\n\nRestore:\n`./java -Xjit:disableDirectToJNI -Xmx16m -Xms9m -Xgcpolicy:optthruput\n-Xshare:off -Xrestore:file=image -cp ~/. Hello`\n\nSigned-off-by: Tobi Ajila <atobia@ca.ibm.com>"}, "afterCommit": {"oid": "303114f83ceed754059019960c9d7e8e88778f13", "author": {"user": {"login": "tajila", "name": "Tobi"}}, "url": "https://github.com/eclipse-openj9/openj9/commit/303114f83ceed754059019960c9d7e8e88778f13", "committedDate": "2020-11-25T19:04:12Z", "message": "Resolve issue when restoring with -Xjit\n\n`promotedMethodOnTransitionFromJIT` clobbers the tempslot which is used\nto store the restore BP for the thread.\n\nRuntimeAssumptions are serialized at JVM shutdown, need to serialize\nthem at image gen time.\n\nThis PR enables -Xjit as long as direct to JNI is disabled:\n\nSnapshot:\n`./java -Xjit:disableDirectToJNI -Xmx16m -Xms8m -Xgcpolicy:optthruput\n-Xshare:off -Xsnapshot:file=image,trigger=Hello.snapshot -cp ~/. Hello`\n\nRestore:\n`./java -Xjit:disableDirectToJNI -Xmx16m -Xms9m -Xgcpolicy:optthruput\n-Xshare:off -Xrestore:file=image -cp ~/. Hello`\n\nSigned-off-by: Tobi Ajila <atobia@ca.ibm.com>"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTM5NDM0OTkw", "url": "https://github.com/eclipse-openj9/openj9/pull/11223#pullrequestreview-539434990", "createdAt": "2020-11-26T16:06:57Z", "commit": {"oid": "303114f83ceed754059019960c9d7e8e88778f13"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0yNlQxNjowNjo1N1rOH6hOKg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0yNlQxNjowNjo1N1rOH6hOKg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMTEyMzc1NA==", "bodyText": "Can you add a comment describing to the code describing the purpose of this field?", "url": "https://github.com/eclipse-openj9/openj9/pull/11223#discussion_r531123754", "createdAt": "2020-11-26T16:06:57Z", "author": {"login": "DanHeidinga"}, "path": "runtime/oti/j9nonbuilder.h", "diffHunk": "@@ -5034,6 +5034,9 @@ typedef struct J9VMThread {\n #endif /* OMR_GC_COMPRESSED_POINTERS */\n #endif /* OMR_GC_CONCURRENT_SCAVENGER */\n \tUDATA safePointCount;\n+#if defined(J9VM_OPT_SNAPSHOTS)\n+\tUDATA *restoreThreadBP;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "303114f83ceed754059019960c9d7e8e88778f13"}, "originalPosition": 5}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e2578ad54bfd93cf15e11cf51e29bfbc2469da79", "author": {"user": {"login": "tajila", "name": "Tobi"}}, "url": "https://github.com/eclipse-openj9/openj9/commit/e2578ad54bfd93cf15e11cf51e29bfbc2469da79", "committedDate": "2020-11-27T16:05:09Z", "message": "Resolve issue when restoring with -Xjit\n\n`promotedMethodOnTransitionFromJIT` clobbers the tempslot which is used\nto store the restore BP for the thread.\n\nRuntimeAssumptions are serialized at JVM shutdown, need to serialize\nthem at image gen time.\n\nThis PR enables -Xjit as long as direct to JNI is disabled:\n\nSnapshot:\n`./java -Xjit:disableDirectToJNI -Xmx16m -Xms8m -Xgcpolicy:optthruput\n-Xshare:off -Xsnapshot:file=image,trigger=Hello.snapshot -cp ~/. Hello`\n\nRestore:\n`./java -Xjit:disableDirectToJNI -Xmx16m -Xms9m -Xgcpolicy:optthruput\n-Xshare:off -Xrestore:file=image -cp ~/. Hello`\n\nSigned-off-by: Tobi Ajila <atobia@ca.ibm.com>"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "303114f83ceed754059019960c9d7e8e88778f13", "author": {"user": {"login": "tajila", "name": "Tobi"}}, "url": "https://github.com/eclipse-openj9/openj9/commit/303114f83ceed754059019960c9d7e8e88778f13", "committedDate": "2020-11-25T19:04:12Z", "message": "Resolve issue when restoring with -Xjit\n\n`promotedMethodOnTransitionFromJIT` clobbers the tempslot which is used\nto store the restore BP for the thread.\n\nRuntimeAssumptions are serialized at JVM shutdown, need to serialize\nthem at image gen time.\n\nThis PR enables -Xjit as long as direct to JNI is disabled:\n\nSnapshot:\n`./java -Xjit:disableDirectToJNI -Xmx16m -Xms8m -Xgcpolicy:optthruput\n-Xshare:off -Xsnapshot:file=image,trigger=Hello.snapshot -cp ~/. Hello`\n\nRestore:\n`./java -Xjit:disableDirectToJNI -Xmx16m -Xms9m -Xgcpolicy:optthruput\n-Xshare:off -Xrestore:file=image -cp ~/. Hello`\n\nSigned-off-by: Tobi Ajila <atobia@ca.ibm.com>"}, "afterCommit": {"oid": "e2578ad54bfd93cf15e11cf51e29bfbc2469da79", "author": {"user": {"login": "tajila", "name": "Tobi"}}, "url": "https://github.com/eclipse-openj9/openj9/commit/e2578ad54bfd93cf15e11cf51e29bfbc2469da79", "committedDate": "2020-11-27T16:05:09Z", "message": "Resolve issue when restoring with -Xjit\n\n`promotedMethodOnTransitionFromJIT` clobbers the tempslot which is used\nto store the restore BP for the thread.\n\nRuntimeAssumptions are serialized at JVM shutdown, need to serialize\nthem at image gen time.\n\nThis PR enables -Xjit as long as direct to JNI is disabled:\n\nSnapshot:\n`./java -Xjit:disableDirectToJNI -Xmx16m -Xms8m -Xgcpolicy:optthruput\n-Xshare:off -Xsnapshot:file=image,trigger=Hello.snapshot -cp ~/. Hello`\n\nRestore:\n`./java -Xjit:disableDirectToJNI -Xmx16m -Xms9m -Xgcpolicy:optthruput\n-Xshare:off -Xrestore:file=image -cp ~/. Hello`\n\nSigned-off-by: Tobi Ajila <atobia@ca.ibm.com>"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTQwMDc5NTc2", "url": "https://github.com/eclipse-openj9/openj9/pull/11223#pullrequestreview-540079576", "createdAt": "2020-11-27T16:08:45Z", "commit": {"oid": "e2578ad54bfd93cf15e11cf51e29bfbc2469da79"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1611, "cost": 1, "resetAt": "2021-10-28T17:48:14Z"}}}