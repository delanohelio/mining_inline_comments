{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDA0MDEyNDgy", "number": 9255, "title": "Set sampling interval to UDATA_MAX to inform GC sampling is not required", "bodyText": "Set sampling interval to UDATA_MAX to inform GC sampling is not required\nGC need to be informed that the allocation sampling has been disabled, and turn off related GC settings;\nSet sampling interval to UDATA_MAX in three cases:\n\ncan_generate_sampled_object_alloc_events capability is removed;\nJVMTI_EVENT_SAMPLED_OBJECT_ALLOC event is disabled;\nThe JVMTI environment enabled JVMTI_EVENT_SAMPLED_OBJECT_ALLOC is disposed.\n\nRelated #7740 #9254 eclipse/omr#5071\nReviewer: @DanHeidinga\nFYI: @LinHu2016\nSigned-off-by: Jason Feng fengj@ca.ibm.com", "createdAt": "2020-04-15T22:05:40Z", "url": "https://github.com/eclipse-openj9/openj9/pull/9255", "merged": true, "mergeCommit": {"oid": "aa5fc4d99fdd9e0936e53a359974ae6400c336f0"}, "closed": true, "closedAt": "2020-04-17T17:08:17Z", "author": {"login": "JasonFengJ9"}, "timelineItems": {"totalCount": 12, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcX_jAqABqjMyMzc0NDg4NDc=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcYjAGVgFqTM5NTU1MzA4NQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "6fc730e987d20a7aed50f0e409a7c088697fe35e", "author": {"user": {"login": "JasonFengJ9", "name": "Jason Feng"}}, "url": "https://github.com/eclipse-openj9/openj9/commit/6fc730e987d20a7aed50f0e409a7c088697fe35e", "committedDate": "2020-04-15T22:02:04Z", "message": "Set sampling interval to UDATA_MAX to inform GC sampling is not required\n\nGC need to be informed that the allocation sampling has been disabled,\nand turn off related GC settings;\nSet sampling interval to UDATA_MAX in three cases:\n1. can_generate_sampled_object_alloc_events capability is removed;\n2. JVMTI_EVENT_SAMPLED_OBJECT_ALLOC event is disabled;\n3. The JVMTI environment enabled JVMTI_EVENT_SAMPLED_OBJECT_ALLOC is\ndisposed.\n\nSigned-off-by: Jason Feng <fengj@ca.ibm.com>"}, "afterCommit": {"oid": "21d3d29682d83f06d57bab5c1f338a5e12314109", "author": {"user": {"login": "JasonFengJ9", "name": "Jason Feng"}}, "url": "https://github.com/eclipse-openj9/openj9/commit/21d3d29682d83f06d57bab5c1f338a5e12314109", "committedDate": "2020-04-15T22:08:06Z", "message": "Set sampling interval to UDATA_MAX to inform GC sampling is not required\n\nGC need to be informed that the allocation sampling has been disabled,\nand turn off related GC settings;\nSet sampling interval to UDATA_MAX in three cases:\n1. can_generate_sampled_object_alloc_events capability is removed;\n2. JVMTI_EVENT_SAMPLED_OBJECT_ALLOC event is disabled;\n3. The JVMTI environment enabled JVMTI_EVENT_SAMPLED_OBJECT_ALLOC is\ndisposed.\n\nSigned-off-by: Jason Feng <fengj@ca.ibm.com>"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzk0MjY4Mjk0", "url": "https://github.com/eclipse-openj9/openj9/pull/9255#pullrequestreview-394268294", "createdAt": "2020-04-16T03:05:33Z", "commit": {"oid": "21d3d29682d83f06d57bab5c1f338a5e12314109"}, "state": "COMMENTED", "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0xNlQwMzowNTozM1rOGGS2bw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0xNlQwMzozNDoxNVrOGGTT4Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwOTI1MzQ4Nw==", "bodyText": "nitpick\n\n  \n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            \t\t\tif(JVMTI_EVENT_SAMPLED_OBJECT_ALLOC == event_type) {\n          \n          \n            \n            \t\t\tif (JVMTI_EVENT_SAMPLED_OBJECT_ALLOC == event_type) {", "url": "https://github.com/eclipse-openj9/openj9/pull/9255#discussion_r409253487", "createdAt": "2020-04-16T03:05:33Z", "author": {"login": "DanHeidinga"}, "path": "runtime/jvmti/jvmtiEventManagement.c", "diffHunk": "@@ -173,6 +173,14 @@ jvmtiSetEventNotificationMode(jvmtiEnv* env,\n \t\t\t\t\tbreak;\n  \t\t\t}\n \t\t}\n+#if JAVA_SPEC_VERSION >= 11\n+\t\telse if (JVMTI_DISABLE == mode) {\n+\t\t\tif(JVMTI_EVENT_SAMPLED_OBJECT_ALLOC == event_type) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "21d3d29682d83f06d57bab5c1f338a5e12314109"}, "originalPosition": 13}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwOTI1ODI3MA==", "bodyText": "There's a getCurrentThread jvmti helper method to handle unattached threads correctly.  It should probably be used here as well.", "url": "https://github.com/eclipse-openj9/openj9/pull/9255#discussion_r409258270", "createdAt": "2020-04-16T03:23:31Z", "author": {"login": "DanHeidinga"}, "path": "runtime/jvmti/jvmtiCapability.c", "diffHunk": "@@ -478,8 +478,10 @@ jvmtiRelinquishCapabilities(jvmtiEnv* env,\n \n #if JAVA_SPEC_VERSION >= 11\n \t\tif (capabilities_ptr->can_generate_sampled_object_alloc_events) {\n-\t\t\t/* The default sampling interval is not changed. */\n+\t\t\tJ9VMThread *currentThread = vm->internalVMFunctions->currentVMThread(vm);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "21d3d29682d83f06d57bab5c1f338a5e12314109"}, "originalPosition": 5}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwOTI2MTAyNQ==", "bodyText": "Do we need some way to push this out to all the threads? (ie: an async event?) Is this event per thread or global?", "url": "https://github.com/eclipse-openj9/openj9/pull/9255#discussion_r409261025", "createdAt": "2020-04-16T03:34:15Z", "author": {"login": "DanHeidinga"}, "path": "runtime/jvmti/jvmtiHelpers.c", "diffHunk": "@@ -174,13 +175,14 @@ disposeEnvironment(J9JVMTIEnv * j9env, UDATA freeData)\n #if JAVA_SPEC_VERSION >= 11\n \t\tif (j9env->capabilities.can_generate_sampled_object_alloc_events) {\n \t\t\tJ9JVMTI_DATA_FROM_VM(vm)->flags &= ~J9JVMTI_FLAG_SAMPLED_OBJECT_ALLOC_ENABLED;\n+\t\t\t/* Set sampling interval to UDATA_MAX to inform GC that sampling is not required */\n+\t\t\tvm->memoryManagerFunctions->j9gc_set_allocation_sampling_interval(currentThread, UDATA_MAX);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "21d3d29682d83f06d57bab5c1f338a5e12314109"}, "originalPosition": 20}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "21d3d29682d83f06d57bab5c1f338a5e12314109", "author": {"user": {"login": "JasonFengJ9", "name": "Jason Feng"}}, "url": "https://github.com/eclipse-openj9/openj9/commit/21d3d29682d83f06d57bab5c1f338a5e12314109", "committedDate": "2020-04-15T22:08:06Z", "message": "Set sampling interval to UDATA_MAX to inform GC sampling is not required\n\nGC need to be informed that the allocation sampling has been disabled,\nand turn off related GC settings;\nSet sampling interval to UDATA_MAX in three cases:\n1. can_generate_sampled_object_alloc_events capability is removed;\n2. JVMTI_EVENT_SAMPLED_OBJECT_ALLOC event is disabled;\n3. The JVMTI environment enabled JVMTI_EVENT_SAMPLED_OBJECT_ALLOC is\ndisposed.\n\nSigned-off-by: Jason Feng <fengj@ca.ibm.com>"}, "afterCommit": {"oid": "b5bc56d4c1ee750b75e1ca0a99b04f3a948a9748", "author": {"user": {"login": "JasonFengJ9", "name": "Jason Feng"}}, "url": "https://github.com/eclipse-openj9/openj9/commit/b5bc56d4c1ee750b75e1ca0a99b04f3a948a9748", "committedDate": "2020-04-16T11:55:13Z", "message": "Set sampling interval to UDATA_MAX to inform GC sampling is not required\n\nGC need to be informed that the allocation sampling has been disabled,\nand turn off related GC settings;\nSet sampling interval to UDATA_MAX in three cases:\n1. can_generate_sampled_object_alloc_events capability is removed;\n2. JVMTI_EVENT_SAMPLED_OBJECT_ALLOC event is disabled;\n3. The JVMTI environment enabled JVMTI_EVENT_SAMPLED_OBJECT_ALLOC is\ndisposed.\n\nSigned-off-by: Jason Feng <fengj@ca.ibm.com>"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzk0NzA3MDE1", "url": "https://github.com/eclipse-openj9/openj9/pull/9255#pullrequestreview-394707015", "createdAt": "2020-04-16T14:45:00Z", "commit": {"oid": "b5bc56d4c1ee750b75e1ca0a99b04f3a948a9748"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0xNlQxNDo0NTowMFrOGGo5Vw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0xNlQxNDo0NTowMFrOGGo5Vw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwOTYxNDY3OQ==", "bodyText": "If the sampling interval is global, the GC call should be changed to take a VM, not a thread.", "url": "https://github.com/eclipse-openj9/openj9/pull/9255#discussion_r409614679", "createdAt": "2020-04-16T14:45:00Z", "author": {"login": "gacholio"}, "path": "runtime/jvmti/jvmtiCapability.c", "diffHunk": "@@ -478,8 +478,13 @@ jvmtiRelinquishCapabilities(jvmtiEnv* env,\n \n #if JAVA_SPEC_VERSION >= 11\n \t\tif (capabilities_ptr->can_generate_sampled_object_alloc_events) {\n-\t\t\t/* The default sampling interval is not changed. */\n+\t\t\tJ9VMThread *currentThread = NULL;\n \t\t\tjvmtiData->flags &= ~J9JVMTI_FLAG_SAMPLED_OBJECT_ALLOC_ENABLED;\n+\t\t\trc = getCurrentVMThread(vm, &currentThread);\n+\t\t\tif (JVMTI_ERROR_NONE == rc) {\n+\t\t\t\t/* Set sampling interval to UDATA_MAX to inform GC that sampling is not required */\n+\t\t\t\tvm->memoryManagerFunctions->j9gc_set_allocation_sampling_interval(currentThread, UDATA_MAX);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b5bc56d4c1ee750b75e1ca0a99b04f3a948a9748"}, "originalPosition": 10}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "b5bc56d4c1ee750b75e1ca0a99b04f3a948a9748", "author": {"user": {"login": "JasonFengJ9", "name": "Jason Feng"}}, "url": "https://github.com/eclipse-openj9/openj9/commit/b5bc56d4c1ee750b75e1ca0a99b04f3a948a9748", "committedDate": "2020-04-16T11:55:13Z", "message": "Set sampling interval to UDATA_MAX to inform GC sampling is not required\n\nGC need to be informed that the allocation sampling has been disabled,\nand turn off related GC settings;\nSet sampling interval to UDATA_MAX in three cases:\n1. can_generate_sampled_object_alloc_events capability is removed;\n2. JVMTI_EVENT_SAMPLED_OBJECT_ALLOC event is disabled;\n3. The JVMTI environment enabled JVMTI_EVENT_SAMPLED_OBJECT_ALLOC is\ndisposed.\n\nSigned-off-by: Jason Feng <fengj@ca.ibm.com>"}, "afterCommit": {"oid": "0446bd025ed97da972412f7bb390a2d6f7eba132", "author": {"user": {"login": "JasonFengJ9", "name": "Jason Feng"}}, "url": "https://github.com/eclipse-openj9/openj9/commit/0446bd025ed97da972412f7bb390a2d6f7eba132", "committedDate": "2020-04-16T19:29:04Z", "message": "Set sampling interval to UDATA_MAX to inform GC sampling is not required\n\nGC need to be informed that the allocation sampling has been disabled,\nand turn off related GC settings;\nSet sampling interval to UDATA_MAX in three cases:\n1. can_generate_sampled_object_alloc_events capability is removed;\n2. JVMTI_EVENT_SAMPLED_OBJECT_ALLOC event is disabled;\n3. The JVMTI environment enabled JVMTI_EVENT_SAMPLED_OBJECT_ALLOC is\ndisposed.\nAlso changed j9gc_set_allocation_sampling_interval(J9VMThread*, UDATA)\nto j9gc_set_allocation_sampling_interval(J9JavaVM*, UDATA).\n\nSigned-off-by: Jason Feng <fengj@ca.ibm.com>"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "0446bd025ed97da972412f7bb390a2d6f7eba132", "author": {"user": {"login": "JasonFengJ9", "name": "Jason Feng"}}, "url": "https://github.com/eclipse-openj9/openj9/commit/0446bd025ed97da972412f7bb390a2d6f7eba132", "committedDate": "2020-04-16T19:29:04Z", "message": "Set sampling interval to UDATA_MAX to inform GC sampling is not required\n\nGC need to be informed that the allocation sampling has been disabled,\nand turn off related GC settings;\nSet sampling interval to UDATA_MAX in three cases:\n1. can_generate_sampled_object_alloc_events capability is removed;\n2. JVMTI_EVENT_SAMPLED_OBJECT_ALLOC event is disabled;\n3. The JVMTI environment enabled JVMTI_EVENT_SAMPLED_OBJECT_ALLOC is\ndisposed.\nAlso changed j9gc_set_allocation_sampling_interval(J9VMThread*, UDATA)\nto j9gc_set_allocation_sampling_interval(J9JavaVM*, UDATA).\n\nSigned-off-by: Jason Feng <fengj@ca.ibm.com>"}, "afterCommit": {"oid": "47d5475f50a13c3eb994ec5056bdfd3bfedb3e1e", "author": {"user": {"login": "JasonFengJ9", "name": "Jason Feng"}}, "url": "https://github.com/eclipse-openj9/openj9/commit/47d5475f50a13c3eb994ec5056bdfd3bfedb3e1e", "committedDate": "2020-04-17T13:26:08Z", "message": "Set sampling interval to UDATA_MAX to inform GC sampling is not required\n\nGC need to be informed that the allocation sampling has been disabled,\nand turn off related GC settings;\nSet sampling interval to UDATA_MAX in three cases:\n1. can_generate_sampled_object_alloc_events capability is removed;\n2. JVMTI_EVENT_SAMPLED_OBJECT_ALLOC event is disabled;\n3. The JVMTI environment enabled JVMTI_EVENT_SAMPLED_OBJECT_ALLOC is\ndisposed.\nAlso changed j9gc_set_allocation_sampling_interval(J9VMThread*, UDATA)\nto j9gc_set_allocation_sampling_interval(J9JavaVM*, UDATA).\n\nSigned-off-by: Jason Feng <fengj@ca.ibm.com>"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzk1NDcyNjE1", "url": "https://github.com/eclipse-openj9/openj9/pull/9255#pullrequestreview-395472615", "createdAt": "2020-04-17T13:52:22Z", "commit": {"oid": "47d5475f50a13c3eb994ec5056bdfd3bfedb3e1e"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0xN1QxMzo1MjoyM1rOGHO4VQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0xN1QxMzo1MjoyM1rOGHO4VQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMDIzNzAxMw==", "bodyText": "Why is this necessary?", "url": "https://github.com/eclipse-openj9/openj9/pull/9255#discussion_r410237013", "createdAt": "2020-04-17T13:52:23Z", "author": {"login": "gacholio"}, "path": "runtime/jvmti/jvmtiHelpers.c", "diffHunk": "@@ -174,20 +174,25 @@ disposeEnvironment(J9JVMTIEnv * j9env, UDATA freeData)\n #if JAVA_SPEC_VERSION >= 11\n \t\tif (j9env->capabilities.can_generate_sampled_object_alloc_events) {\n \t\t\tJ9JVMTI_DATA_FROM_VM(vm)->flags &= ~J9JVMTI_FLAG_SAMPLED_OBJECT_ALLOC_ENABLED;\n+\t\t\t/* Set sampling interval to UDATA_MAX to inform GC that sampling is not required */\n+\t\t\tvm->memoryManagerFunctions->j9gc_set_allocation_sampling_interval(vm, UDATA_MAX);\n \t\t}\n #endif /* JAVA_SPEC_VERSION >= 11 */\n \n \t\t/* Remove all breakpoints */\n \n-\t\tif (j9env->breakpoints != NULL) {\n+\t\tif (NULL != j9env->breakpoints) {\n \t\t\tJ9VMThread * currentThread = vm->internalVMFunctions->currentVMThread(vm);\n-\t\t\tpool_state poolState;\n-\t\t\tJ9JVMTIAgentBreakpoint * agentBreakpoint = NULL;\n-\n-\t\t\tagentBreakpoint = pool_startDo(j9env->breakpoints, &poolState);\n-\t\t\twhile (agentBreakpoint != NULL) {\n-\t\t\t\tdeleteAgentBreakpoint(currentThread, j9env, agentBreakpoint);\n-\t\t\t\tagentBreakpoint = pool_nextDo(&poolState);\n+\t\t\t/* Ignore the case that currentThread is NULL, i.e., unattached thread */", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "47d5475f50a13c3eb994ec5056bdfd3bfedb3e1e"}, "originalPosition": 28}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "47d5475f50a13c3eb994ec5056bdfd3bfedb3e1e", "author": {"user": {"login": "JasonFengJ9", "name": "Jason Feng"}}, "url": "https://github.com/eclipse-openj9/openj9/commit/47d5475f50a13c3eb994ec5056bdfd3bfedb3e1e", "committedDate": "2020-04-17T13:26:08Z", "message": "Set sampling interval to UDATA_MAX to inform GC sampling is not required\n\nGC need to be informed that the allocation sampling has been disabled,\nand turn off related GC settings;\nSet sampling interval to UDATA_MAX in three cases:\n1. can_generate_sampled_object_alloc_events capability is removed;\n2. JVMTI_EVENT_SAMPLED_OBJECT_ALLOC event is disabled;\n3. The JVMTI environment enabled JVMTI_EVENT_SAMPLED_OBJECT_ALLOC is\ndisposed.\nAlso changed j9gc_set_allocation_sampling_interval(J9VMThread*, UDATA)\nto j9gc_set_allocation_sampling_interval(J9JavaVM*, UDATA).\n\nSigned-off-by: Jason Feng <fengj@ca.ibm.com>"}, "afterCommit": {"oid": "2277a0de2afb9b2655c1d3438afab92741f9e21e", "author": {"user": {"login": "JasonFengJ9", "name": "Jason Feng"}}, "url": "https://github.com/eclipse-openj9/openj9/commit/2277a0de2afb9b2655c1d3438afab92741f9e21e", "committedDate": "2020-04-17T15:02:53Z", "message": "Set sampling interval to UDATA_MAX to inform GC sampling is not required\n\nGC need to be informed that the allocation sampling has been disabled,\nand turn off related GC settings;\nSet sampling interval to UDATA_MAX in three cases:\n1. can_generate_sampled_object_alloc_events capability is removed;\n2. JVMTI_EVENT_SAMPLED_OBJECT_ALLOC event is disabled;\n3. The JVMTI environment enabled JVMTI_EVENT_SAMPLED_OBJECT_ALLOC is\ndisposed.\nAlso changed j9gc_set_allocation_sampling_interval(J9VMThread*, UDATA)\nto j9gc_set_allocation_sampling_interval(J9JavaVM*, UDATA).\n\nSigned-off-by: Jason Feng <fengj@ca.ibm.com>"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzk1NTM3MDE4", "url": "https://github.com/eclipse-openj9/openj9/pull/9255#pullrequestreview-395537018", "createdAt": "2020-04-17T15:07:24Z", "commit": {"oid": "2277a0de2afb9b2655c1d3438afab92741f9e21e"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0xN1QxNTowNzoyNFrOGHR10Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0xN1QxNTowNzoyNFrOGHR10Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMDI4NTUyMQ==", "bodyText": "VM is fetched twice here, in two different ways. Please use a local.", "url": "https://github.com/eclipse-openj9/openj9/pull/9255#discussion_r410285521", "createdAt": "2020-04-17T15:07:24Z", "author": {"login": "gacholio"}, "path": "runtime/jvmti/jvmtiMemory.c", "diffHunk": "@@ -87,19 +87,15 @@ jvmtiSetHeapSamplingInterval(jvmtiEnv *env,\n {\n \tjvmtiError rc = JVMTI_ERROR_NONE;\n \tJ9VMThread *currentThread = NULL;\n-\tJ9JavaVM *vm = JAVAVM_FROM_ENV(env);\n \t\n \tTrc_JVMTI_jvmtiSetHeapSamplingInterval_Entry(env, samplingInterval);\n \t\n \tENSURE_PHASE_ONLOAD_OR_LIVE(env);\n \tENSURE_CAPABILITY(env, can_generate_sampled_object_alloc_events);\n \tENSURE_NON_NEGATIVE(samplingInterval);\n \n-\trc = getCurrentVMThread(vm, &currentThread);\n-\tif ((JVMTI_ERROR_NONE == rc) && (NULL != currentThread)) {\n-\t\t/* No negative samplingInterval, and there is no data lost when jint is casted to UDATA. */\n-\t\tvm->memoryManagerFunctions->j9gc_set_allocation_sampling_interval(currentThread, samplingInterval);\n-\t}\n+\t/* No negative samplingInterval, and there is no data lost when jint is casted to UDATA. */\n+\tcurrentThread->javaVM->memoryManagerFunctions->j9gc_set_allocation_sampling_interval(((J9JVMTIEnv *)env)->vm, samplingInterval);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "2277a0de2afb9b2655c1d3438afab92741f9e21e"}, "originalPosition": 18}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "7f48b86cc3f9874a726a311a1b37027115f57763", "author": {"user": {"login": "JasonFengJ9", "name": "Jason Feng"}}, "url": "https://github.com/eclipse-openj9/openj9/commit/7f48b86cc3f9874a726a311a1b37027115f57763", "committedDate": "2020-04-17T15:23:01Z", "message": "Set sampling interval to UDATA_MAX to inform GC sampling is not required\n\nGC need to be informed that the allocation sampling has been disabled,\nand turn off related GC settings;\nSet sampling interval to UDATA_MAX in three cases:\n1. can_generate_sampled_object_alloc_events capability is removed;\n2. JVMTI_EVENT_SAMPLED_OBJECT_ALLOC event is disabled;\n3. The JVMTI environment enabled JVMTI_EVENT_SAMPLED_OBJECT_ALLOC is\ndisposed.\nAlso changed j9gc_set_allocation_sampling_interval(J9VMThread*, UDATA)\nto j9gc_set_allocation_sampling_interval(J9JavaVM*, UDATA).\n\nSigned-off-by: Jason Feng <fengj@ca.ibm.com>"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "2277a0de2afb9b2655c1d3438afab92741f9e21e", "author": {"user": {"login": "JasonFengJ9", "name": "Jason Feng"}}, "url": "https://github.com/eclipse-openj9/openj9/commit/2277a0de2afb9b2655c1d3438afab92741f9e21e", "committedDate": "2020-04-17T15:02:53Z", "message": "Set sampling interval to UDATA_MAX to inform GC sampling is not required\n\nGC need to be informed that the allocation sampling has been disabled,\nand turn off related GC settings;\nSet sampling interval to UDATA_MAX in three cases:\n1. can_generate_sampled_object_alloc_events capability is removed;\n2. JVMTI_EVENT_SAMPLED_OBJECT_ALLOC event is disabled;\n3. The JVMTI environment enabled JVMTI_EVENT_SAMPLED_OBJECT_ALLOC is\ndisposed.\nAlso changed j9gc_set_allocation_sampling_interval(J9VMThread*, UDATA)\nto j9gc_set_allocation_sampling_interval(J9JavaVM*, UDATA).\n\nSigned-off-by: Jason Feng <fengj@ca.ibm.com>"}, "afterCommit": {"oid": "7f48b86cc3f9874a726a311a1b37027115f57763", "author": {"user": {"login": "JasonFengJ9", "name": "Jason Feng"}}, "url": "https://github.com/eclipse-openj9/openj9/commit/7f48b86cc3f9874a726a311a1b37027115f57763", "committedDate": "2020-04-17T15:23:01Z", "message": "Set sampling interval to UDATA_MAX to inform GC sampling is not required\n\nGC need to be informed that the allocation sampling has been disabled,\nand turn off related GC settings;\nSet sampling interval to UDATA_MAX in three cases:\n1. can_generate_sampled_object_alloc_events capability is removed;\n2. JVMTI_EVENT_SAMPLED_OBJECT_ALLOC event is disabled;\n3. The JVMTI environment enabled JVMTI_EVENT_SAMPLED_OBJECT_ALLOC is\ndisposed.\nAlso changed j9gc_set_allocation_sampling_interval(J9VMThread*, UDATA)\nto j9gc_set_allocation_sampling_interval(J9JavaVM*, UDATA).\n\nSigned-off-by: Jason Feng <fengj@ca.ibm.com>"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzk1NTUzMDg1", "url": "https://github.com/eclipse-openj9/openj9/pull/9255#pullrequestreview-395553085", "createdAt": "2020-04-17T15:27:03Z", "commit": {"oid": "7f48b86cc3f9874a726a311a1b37027115f57763"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1285, "cost": 1, "resetAt": "2021-10-28T17:48:14Z"}}}