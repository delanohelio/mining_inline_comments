{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0Mzk1NzY1OTkx", "number": 9026, "title": "Runtime compressed refs work", "bodyText": "Update RAS code to properly handle mixed mode.\nThe issue was that AIX non-compressed was not copying the RAS structure to virtual memory, resulting in DDR taking forever (i.e. longer than the test timeout) to find the RAS structure.\nAlso fix some compile errors on windows (assuming fj9object_t == U_32 when the compressed compile flag is on).\n[ci skip]\nSigned-off-by: Graham Chapman graham_chapman@ca.ibm.com", "createdAt": "2020-03-30T16:35:23Z", "url": "https://github.com/eclipse-openj9/openj9/pull/9026", "merged": true, "mergeCommit": {"oid": "2ec5ddf137be2ffb7400c04fbbfa56345b8ac1d1"}, "closed": true, "closedAt": "2020-04-01T12:09:44Z", "author": {"login": "gacholio"}, "timelineItems": {"totalCount": 9, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcSxetygBqjMxNzk1NzQ1MDU=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcTyieQgFqTM4Njc3MTkwMA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "0fa64491abfb336f78f2569468dd25d0e3f4a937", "author": {"user": {"login": "gacholio", "name": "Graham Chapman"}}, "url": "https://github.com/eclipse-openj9/openj9/commit/0fa64491abfb336f78f2569468dd25d0e3f4a937", "committedDate": "2020-03-30T16:33:57Z", "message": "Runtime compressed refs work\n\nUpdate RAS code to properly handle mixed mode. The issue was that AIX\nno-compressed was not copying the RAS structure to virtual memory,\nresulting in DDR taking forever (i.e. longer than the test timeout) to\nfind the RAS structure.\n\n[ci skip]\n\nSigned-off-by: Graham Chapman <graham_chapman@ca.ibm.com>"}, "afterCommit": {"oid": "a8db4dc70a83933d964845e5b3725e72ed4834c3", "author": {"user": {"login": "gacholio", "name": "Graham Chapman"}}, "url": "https://github.com/eclipse-openj9/openj9/commit/a8db4dc70a83933d964845e5b3725e72ed4834c3", "committedDate": "2020-03-30T16:55:20Z", "message": "Runtime compressed refs work\n\nUpdate RAS code to properly handle mixed mode.\n\nThe issue was that AIX non-compressed was not copying the RAS structure\nto virtual memory, resulting in DDR taking forever (i.e. longer than the\ntest timeout) to find the RAS structure.\n\n[ci skip]\n\nSigned-off-by: Graham Chapman <graham_chapman@ca.ibm.com>"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "b07b6ad027c734da0d8ccf54533de0f8ec3fa215", "author": {"user": {"login": "gacholio", "name": "Graham Chapman"}}, "url": "https://github.com/eclipse-openj9/openj9/commit/b07b6ad027c734da0d8ccf54533de0f8ec3fa215", "committedDate": "2020-03-30T19:04:13Z", "message": "win\n\nSigned-off-by: Graham Chapman <graham_chapman@ca.ibm.com>"}, "afterCommit": {"oid": "a8b93a8358e09ba88cab2689ce47c2edeb3b40d0", "author": {"user": {"login": "gacholio", "name": "Graham Chapman"}}, "url": "https://github.com/eclipse-openj9/openj9/commit/a8b93a8358e09ba88cab2689ce47c2edeb3b40d0", "committedDate": "2020-03-30T19:19:05Z", "message": "Runtime compressed refs work\n\nUpdate RAS code to properly handle mixed mode.\n\nThe issue was that AIX non-compressed was not copying the RAS structure\nto virtual memory, resulting in DDR taking forever (i.e. longer than the\ntest timeout) to find the RAS structure.\n\nAlso fix some compile errors on windows (assuming fj9object_t == U_32\nwhen the compressed compile flag is on).\n\n[ci skip]\n\nSigned-off-by: Graham Chapman <graham_chapman@ca.ibm.com>"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "a8b93a8358e09ba88cab2689ce47c2edeb3b40d0", "author": {"user": {"login": "gacholio", "name": "Graham Chapman"}}, "url": "https://github.com/eclipse-openj9/openj9/commit/a8b93a8358e09ba88cab2689ce47c2edeb3b40d0", "committedDate": "2020-03-30T19:19:05Z", "message": "Runtime compressed refs work\n\nUpdate RAS code to properly handle mixed mode.\n\nThe issue was that AIX non-compressed was not copying the RAS structure\nto virtual memory, resulting in DDR taking forever (i.e. longer than the\ntest timeout) to find the RAS structure.\n\nAlso fix some compile errors on windows (assuming fj9object_t == U_32\nwhen the compressed compile flag is on).\n\n[ci skip]\n\nSigned-off-by: Graham Chapman <graham_chapman@ca.ibm.com>"}, "afterCommit": {"oid": "72dc1d301d419545a99991cf809f591db4311f93", "author": {"user": {"login": "gacholio", "name": "Graham Chapman"}}, "url": "https://github.com/eclipse-openj9/openj9/commit/72dc1d301d419545a99991cf809f591db4311f93", "committedDate": "2020-03-30T19:54:26Z", "message": "Runtime compressed refs work\n\nUpdate RAS code to properly handle mixed mode.\n\nThe issue was that AIX non-compressed was not copying the RAS structure\nto virtual memory, resulting in DDR taking forever (i.e. longer than the\ntest timeout) to find the RAS structure.\n\nAlso fix some compile errors on windows (assuming fj9object_t == U_32\nwhen the compressed compile flag is on).\n\n[ci skip]\n\nSigned-off-by: Graham Chapman <graham_chapman@ca.ibm.com>"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "72dc1d301d419545a99991cf809f591db4311f93", "author": {"user": {"login": "gacholio", "name": "Graham Chapman"}}, "url": "https://github.com/eclipse-openj9/openj9/commit/72dc1d301d419545a99991cf809f591db4311f93", "committedDate": "2020-03-30T19:54:26Z", "message": "Runtime compressed refs work\n\nUpdate RAS code to properly handle mixed mode.\n\nThe issue was that AIX non-compressed was not copying the RAS structure\nto virtual memory, resulting in DDR taking forever (i.e. longer than the\ntest timeout) to find the RAS structure.\n\nAlso fix some compile errors on windows (assuming fj9object_t == U_32\nwhen the compressed compile flag is on).\n\n[ci skip]\n\nSigned-off-by: Graham Chapman <graham_chapman@ca.ibm.com>"}, "afterCommit": {"oid": "ba8337248c6ccb1b28aec000fa2c6194d8f0ba40", "author": {"user": {"login": "gacholio", "name": "Graham Chapman"}}, "url": "https://github.com/eclipse-openj9/openj9/commit/ba8337248c6ccb1b28aec000fa2c6194d8f0ba40", "committedDate": "2020-03-30T22:31:54Z", "message": "Runtime compressed refs work\n\nUpdate RAS code to properly handle mixed mode.\n\nThe issue was that AIX non-compressed was not copying the RAS structure\nto virtual memory, resulting in DDR taking forever (i.e. longer than the\ntest timeout) to find the RAS structure.\n\nAlso fix some compile errors on windows (assuming fj9object_t == U_32\nwhen the compressed compile flag is on).\n\n[ci skip]\n\nSigned-off-by: Graham Chapman <graham_chapman@ca.ibm.com>"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzg0OTc5Mjk0", "url": "https://github.com/eclipse-openj9/openj9/pull/9026#pullrequestreview-384979294", "createdAt": "2020-03-31T18:05:12Z", "commit": {"oid": "ba8337248c6ccb1b28aec000fa2c6194d8f0ba40"}, "state": "COMMENTED", "comments": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0zMVQxODowNToxMlrOF-h4PA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0zMVQxODo0OTowMVrOF-jf2w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMTExMTEwMA==", "bodyText": "Would it be better to change the definition of referenceSize to be a U_32?", "url": "https://github.com/eclipse-openj9/openj9/pull/9026#discussion_r401111100", "createdAt": "2020-03-31T18:05:12Z", "author": {"login": "DanHeidinga"}, "path": "runtime/vm/resolvefield.cpp", "diffHunk": "@@ -675,7 +675,7 @@ fieldOffsetsStartDo(J9JavaVM *vm, J9ROMClass *romClass, J9Class *superClazz, J9R\n \t\t */\n \t\tif ((LOCKWORD_NEEDED == lockwordNeeded)||(NO_LOCKWORD_NEEDED == lockwordNeeded)) {\n \t\t\tif ((NULL != superClazz) && ((UDATA)-1 != superClazz->lockOffset) && (0 == J9CLASS_DEPTH(superClazz))) {\n-\t\t\t\tU_32 newSuperSize = fieldInfo.getSuperclassFieldsSize() - referenceSize;\n+\t\t\t\tU_32 newSuperSize = fieldInfo.getSuperclassFieldsSize() - (U_32)referenceSize;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ba8337248c6ccb1b28aec000fa2c6194d8f0ba40"}, "originalPosition": 12}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMTEyMTA5MQ==", "bodyText": "Can this move this late?  Its being moved after the if (JNI_OK != configureRasDump(vm)) { call....", "url": "https://github.com/eclipse-openj9/openj9/pull/9026#discussion_r401121091", "createdAt": "2020-03-31T18:22:20Z", "author": {"login": "DanHeidinga"}, "path": "runtime/vm/jvminit.c", "diffHunk": "@@ -6096,6 +6088,12 @@ protectedInitializeJavaVM(J9PortLibrary* portLibrary, void * userData)\n \t}\n \n \t/* Must be done after the compressed/full determination has been made */\n+#ifdef J9VM_RAS_EYECATCHERS\n+\tJ9RASInitialize(vm);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ba8337248c6ccb1b28aec000fa2c6194d8f0ba40"}, "originalPosition": 27}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMTEzMTMyNA==", "bodyText": "This seems like it would make early crashes harder to debug.", "url": "https://github.com/eclipse-openj9/openj9/pull/9026#discussion_r401131324", "createdAt": "2020-03-31T18:38:53Z", "author": {"login": "DanHeidinga"}, "path": "runtime/vm/jvminit.c", "diffHunk": "@@ -6096,6 +6088,12 @@ protectedInitializeJavaVM(J9PortLibrary* portLibrary, void * userData)\n \t}\n \n \t/* Must be done after the compressed/full determination has been made */\n+#ifdef J9VM_RAS_EYECATCHERS\n+\tJ9RASInitialize(vm);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMTEyMTA5MQ=="}, "originalCommit": {"oid": "ba8337248c6ccb1b28aec000fa2c6194d8f0ba40"}, "originalPosition": 27}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMTEzNzYyNw==", "bodyText": "I think I understand the problem now - the major concern is whether other code will be trying to modify the vm->j9ras struct before this happens.", "url": "https://github.com/eclipse-openj9/openj9/pull/9026#discussion_r401137627", "createdAt": "2020-03-31T18:49:01Z", "author": {"login": "DanHeidinga"}, "path": "runtime/vm/jvminit.c", "diffHunk": "@@ -6096,6 +6088,12 @@ protectedInitializeJavaVM(J9PortLibrary* portLibrary, void * userData)\n \t}\n \n \t/* Must be done after the compressed/full determination has been made */\n+#ifdef J9VM_RAS_EYECATCHERS\n+\tJ9RASInitialize(vm);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMTEyMTA5MQ=="}, "originalCommit": {"oid": "ba8337248c6ccb1b28aec000fa2c6194d8f0ba40"}, "originalPosition": 27}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzg1MDYwNDEx", "url": "https://github.com/eclipse-openj9/openj9/pull/9026#pullrequestreview-385060411", "createdAt": "2020-03-31T20:00:25Z", "commit": {"oid": "1bc0becef4a9d25776d39f57e55edadb892ddb38"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "5e4701ef7a2b9d969c0b1eadfd41f020f485abbe", "author": {"user": {"login": "gacholio", "name": "Graham Chapman"}}, "url": "https://github.com/eclipse-openj9/openj9/commit/5e4701ef7a2b9d969c0b1eadfd41f020f485abbe", "committedDate": "2020-03-31T20:08:48Z", "message": "Runtime compressed refs work\n\nUpdate RAS code to properly handle mixed mode.\n\nThe issue was that AIX non-compressed was not copying the RAS structure\nto virtual memory, resulting in DDR taking forever (i.e. longer than the\ntest timeout) to find the RAS structure.\n\nAlso fix some compile errors on windows (assuming fj9object_t == U_32\nwhen the compressed compile flag is on).\n\n[ci skip]\n\nSigned-off-by: Graham Chapman <graham_chapman@ca.ibm.com>"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "1bc0becef4a9d25776d39f57e55edadb892ddb38", "author": {"user": {"login": "gacholio", "name": "Graham Chapman"}}, "url": "https://github.com/eclipse-openj9/openj9/commit/1bc0becef4a9d25776d39f57e55edadb892ddb38", "committedDate": "2020-03-31T19:02:08Z", "message": "review comments\n\nSigned-off-by: Graham Chapman <graham_chapman@ca.ibm.com>"}, "afterCommit": {"oid": "5e4701ef7a2b9d969c0b1eadfd41f020f485abbe", "author": {"user": {"login": "gacholio", "name": "Graham Chapman"}}, "url": "https://github.com/eclipse-openj9/openj9/commit/5e4701ef7a2b9d969c0b1eadfd41f020f485abbe", "committedDate": "2020-03-31T20:08:48Z", "message": "Runtime compressed refs work\n\nUpdate RAS code to properly handle mixed mode.\n\nThe issue was that AIX non-compressed was not copying the RAS structure\nto virtual memory, resulting in DDR taking forever (i.e. longer than the\ntest timeout) to find the RAS structure.\n\nAlso fix some compile errors on windows (assuming fj9object_t == U_32\nwhen the compressed compile flag is on).\n\n[ci skip]\n\nSigned-off-by: Graham Chapman <graham_chapman@ca.ibm.com>"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzg2NzcxOTAw", "url": "https://github.com/eclipse-openj9/openj9/pull/9026#pullrequestreview-386771900", "createdAt": "2020-04-02T20:43:29Z", "commit": {"oid": "5e4701ef7a2b9d969c0b1eadfd41f020f485abbe"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wMlQyMDo0MzoyOVrOF_8WXg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wMlQyMDo0MzoyOVrOF_8WXg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMjU5MzM3NA==", "bodyText": "I think this condition should be:\n\tif (!ALLOCATE_RAS_DATA_IN_SUBALLOCATOR && !J9JAVAVM_COMPRESS_OBJECT_REFERENCES(javaVM)) {\n\nI'll open a PR to fix this shortly.", "url": "https://github.com/eclipse-openj9/openj9/pull/9026#discussion_r402593374", "createdAt": "2020-04-02T20:43:29Z", "author": {"login": "keithc-ca"}, "path": "runtime/vm/rasdump.c", "diffHunk": "@@ -443,8 +445,8 @@ allocateRASStruct(J9JavaVM *javaVM)\n \t *\n \t * Compressed references: the RAS data is relocated to the JVM suballocator once the latter is created.\n \t */\n-#if !defined(USE_STATIC_RAS_STRUCT) && !defined(ALLOCATE_RAS_DATA_IN_SUBALLOCATOR)\n-\tif (!J9JAVAVM_COMPRESS_OBJECT_REFERENCES(javaVM)) {\n+#if !defined(USE_STATIC_RAS_STRUCT)\n+\tif (!(ALLOCATE_RAS_DATA_IN_SUBALLOCATOR && J9JAVAVM_COMPRESS_OBJECT_REFERENCES(javaVM))) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "5e4701ef7a2b9d969c0b1eadfd41f020f485abbe"}, "originalPosition": 34}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1352, "cost": 1, "resetAt": "2021-10-28T17:48:14Z"}}}