{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDQyMjM5NjA2", "number": 10060, "title": "Enable the static verification for unsafe classes", "bodyText": "The change is to enable the static verification for\nunsafe classes (including anoClasses) so as to support\nthe implementation of valueTypes.\nFixes: #9880\nSigned-off-by: Cheng Jin jincheng@ca.ibm.com", "createdAt": "2020-06-30T19:11:23Z", "url": "https://github.com/eclipse-openj9/openj9/pull/10060", "merged": true, "mergeCommit": {"oid": "c1f60e139ad232316d9eac0694cf102a65f9b912"}, "closed": true, "closedAt": "2020-07-03T16:56:33Z", "author": {"login": "ChengJin01"}, "timelineItems": {"totalCount": 16, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcxAKuQgFqTQ0MTc1MDY2Mg==", "endCursor": "Y3Vyc29yOnYyOpPPAAABcxL_NTAFqTQ0MjE0Mjk2NQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDQxNzUwNjYy", "url": "https://github.com/eclipse-openj9/openj9/pull/10060#pullrequestreview-441750662", "createdAt": "2020-07-02T14:47:01Z", "commit": {"oid": "d03865bd3d8a223395cfcd19c438c1f934fa0261"}, "state": "COMMENTED", "comments": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wMlQxNDo0NzowMVrOGsQMoA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wMlQxNTowMDowMlrOGsQvqQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0OTA1NTkwNA==", "bodyText": "Is the cast needed here?", "url": "https://github.com/eclipse-openj9/openj9/pull/10060#discussion_r449055904", "createdAt": "2020-07-02T14:47:01Z", "author": {"login": "DanHeidinga"}, "path": "runtime/bcutil/ROMClassBuilder.cpp", "diffHunk": "@@ -272,8 +272,10 @@ ROMClassBuilder::handleAnonClassName(J9CfrClassFile *classfile, bool *isLambda)\n \t/* Find if there are any Constant_String or CFR_CONSTANT_NameAndType references to the className.\n \t * If there are none we don't need to make a new cpEntry, we can overwrite the existing\n \t * one since the only reference to it is the classRef\n+\t * Note: The check only applies to the existing cpEntries of the constant pool rather than\n+\t * the last cpEntry (not yet initialized) for the anonClassName.\n \t */\n-\tfor (i = 0; i < classfile->constantPoolCount; i++) {\n+\tfor (i = 0; i < (U_32)newUtfCPEntry; i++) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d03865bd3d8a223395cfcd19c438c1f934fa0261"}, "originalPosition": 8}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0OTA1OTI2Mg==", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            \t/* Reset constantPoolCount for the anoClass after the static verification on the class file\n          \n          \n            \n            \t * so as to avoid checking the last cpEntry intended for anonClassName which has not yet been\n          \n          \n            \n            \t * initialized until ROMClassBuilder::handleAnonClassName() is invoked later in building\n          \n          \n            \n            \t * the corresponding ROMClass.\n          \n          \n            \n            \t */\n          \n          \n            \n            \t/* Set constantPoolCount here to take into account the extra cpEntry for the anonClass name.\n          \n          \n            \n            \t * This needs to occur after static verification as the new (last) cpEntry intended for \n          \n          \n            \n            \t  * the anonClassName is not initialized until ROMClassBuilder::handleAnonClassName() is \n          \n          \n            \n            \t  * invoked later in building the corresponding ROMClass.\n          \n          \n            \n            \t */", "url": "https://github.com/eclipse-openj9/openj9/pull/10060#discussion_r449059262", "createdAt": "2020-07-02T14:52:02Z", "author": {"login": "DanHeidinga"}, "path": "runtime/bcutil/cfreader.c", "diffHunk": "@@ -2860,6 +2864,13 @@ j9bcutil_readClassFileBytes(J9PortLibrary *portLib,\n \t}\n \tVERBOSE_END(ParseClassFileVerifyClass);\n \n+\t/* Reset constantPoolCount for the anoClass after the static verification on the class file\n+\t * so as to avoid checking the last cpEntry intended for anonClassName which has not yet been\n+\t * initialized until ROMClassBuilder::handleAnonClassName() is invoked later in building\n+\t * the corresponding ROMClass.\n+\t */", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d03865bd3d8a223395cfcd19c438c1f934fa0261"}, "originalPosition": 34}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0OTA2NDIzNA==", "bodyText": "Ideally, this becomes:\n\n  \n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            \tif (J9_ARE_ANY_BITS_SET(vm->runtimeFlags,J9_RUNTIME_VERIFY)) {\n          \n          \n            \n            \t\tif (J9_ARE_NO_BITS_SET(loadData->options, J9_FINDCLASS_FLAG_UNSAFE)\n          \n          \n            \n            \t\t|| (J2SE_VERSION(vm) == J2SE_18)\n          \n          \n            \n            \t\t|| (J2SE_VERSION(vm) == J2SE_V11)\n          \n          \n            \n            \t\t) {\n          \n          \n            \n            \t\t\ttranslationFlags |= BCT_StaticVerification;\n          \n          \n            \n            \t\t}\n          \n          \n            \n            \tif (J9_ARE_ANY_BITS_SET(vm->runtimeFlags,J9_RUNTIME_VERIFY)) {\n          \n          \n            \n            \t\ttranslationFlags |= BCT_StaticVerification;\n          \n          \n            \n            \t}\n          \n      \n    \n    \n  \n\nI'd like to verify as much of the Unsafe class as possible.", "url": "https://github.com/eclipse-openj9/openj9/pull/10060#discussion_r449064234", "createdAt": "2020-07-02T14:59:05Z", "author": {"login": "DanHeidinga"}, "path": "runtime/bcutil/defineclass.c", "diffHunk": "@@ -511,9 +511,14 @@ internalLoadROMClass(J9VMThread * vmThread, J9LoadROMClassData *loadData, J9Tran\n \t\ttranslationFlags |= stripFlags;\n \t}\n \n-\tif ((0 == (loadData->options & J9_FINDCLASS_FLAG_UNSAFE)) &&\n-\t\t(0 != (vm->runtimeFlags & J9_RUNTIME_VERIFY))) {\n-\t\ttranslationFlags |= BCT_StaticVerification;\n+\t/* Enable the static verification on the unsafe classes (only for Java 8 & 11) */\n+\tif (J9_ARE_ANY_BITS_SET(vm->runtimeFlags,J9_RUNTIME_VERIFY)) {\n+\t\tif (J9_ARE_NO_BITS_SET(loadData->options, J9_FINDCLASS_FLAG_UNSAFE)\n+\t\t|| (J2SE_VERSION(vm) == J2SE_18)\n+\t\t|| (J2SE_VERSION(vm) == J2SE_V11)\n+\t\t) {\n+\t\t\ttranslationFlags |= BCT_StaticVerification;\n+\t\t}", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d03865bd3d8a223395cfcd19c438c1f934fa0261"}, "originalPosition": 14}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0OTA2NDg3Mw==", "bodyText": "I don't understand this change.  What check later in the code are we trying to avoid by this?", "url": "https://github.com/eclipse-openj9/openj9/pull/10060#discussion_r449064873", "createdAt": "2020-07-02T15:00:02Z", "author": {"login": "DanHeidinga"}, "path": "runtime/bcutil/cfreader.c", "diffHunk": "@@ -2643,8 +2643,14 @@ j9bcutil_readClassFileBytes(J9PortLibrary *portLib,\n \t/* Make sure the structure and static verification below uses the class file version\n \t * number. VM version is maintained in vmVersionShifted.\n \t */\n-\tflags &= ~BCT_MajorClassFileVersionMask;\n-\tflags |= ((UDATA) classfile->majorVersion) << BCT_MajorClassFileVersionMaskShift;\n+\tif (J9_ARE_ANY_BITS_SET(findClassFlags, J9_FINDCLASS_FLAG_UNSAFE)\n+\t&& ((vmVersionShifted == BCT_Java8MajorVersionShifted) || (vmVersionShifted == BCT_Java11MajorVersionShifted))\n+\t) {\n+\t\t/* Ignore the check for Unsafe.defineClass() on Java 8 & Java 11 */\n+\t} else {\n+\t\tflags &= ~BCT_MajorClassFileVersionMask;\n+\t\tflags |= ((UDATA) classfile->majorVersion) << BCT_MajorClassFileVersionMaskShift;\n+\t}", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d03865bd3d8a223395cfcd19c438c1f934fa0261"}, "originalPosition": 13}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "d03865bd3d8a223395cfcd19c438c1f934fa0261", "author": {"user": {"login": "ChengJin01", "name": "Cheng Jin"}}, "url": "https://github.com/eclipse-openj9/openj9/commit/d03865bd3d8a223395cfcd19c438c1f934fa0261", "committedDate": "2020-06-30T19:09:20Z", "message": "Enable the static verification for unsafe classes\n\nThe change is to enable the static verification for\nunsafe classes (including anoClasses) so as to support\nthe implementation of valueTypes.\n\nFixes: #9880\n\nSigned-off-by: Cheng Jin <jincheng@ca.ibm.com>"}, "afterCommit": {"oid": "dd775e5e91dc4697322c16de75ef863328565f72", "author": {"user": {"login": "ChengJin01", "name": "Cheng Jin"}}, "url": "https://github.com/eclipse-openj9/openj9/commit/dd775e5e91dc4697322c16de75ef863328565f72", "committedDate": "2020-07-02T15:43:57Z", "message": "Enable the static verification for unsafe classes\n\nThe change is to enable the static verification for\nunsafe classes (including anoClasses) so as to support\nthe implementation of valueTypes.\n\nFixes: #9880\n\nSigned-off-by: Cheng Jin <jincheng@ca.ibm.com>"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "dd775e5e91dc4697322c16de75ef863328565f72", "author": {"user": {"login": "ChengJin01", "name": "Cheng Jin"}}, "url": "https://github.com/eclipse-openj9/openj9/commit/dd775e5e91dc4697322c16de75ef863328565f72", "committedDate": "2020-07-02T15:43:57Z", "message": "Enable the static verification for unsafe classes\n\nThe change is to enable the static verification for\nunsafe classes (including anoClasses) so as to support\nthe implementation of valueTypes.\n\nFixes: #9880\n\nSigned-off-by: Cheng Jin <jincheng@ca.ibm.com>"}, "afterCommit": {"oid": "bccfd57c7fdec64a694fac298db699652494504c", "author": {"user": {"login": "ChengJin01", "name": "Cheng Jin"}}, "url": "https://github.com/eclipse-openj9/openj9/commit/bccfd57c7fdec64a694fac298db699652494504c", "committedDate": "2020-07-02T16:14:08Z", "message": "Enable the static verification for unsafe classes\n\nThe change is to enable the static verification for\nunsafe classes (including anoClasses) so as to support\nthe implementation of valueTypes.\n\nFixes: #9880\n\nSigned-off-by: Cheng Jin <jincheng@ca.ibm.com>"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDQxOTY4NDcx", "url": "https://github.com/eclipse-openj9/openj9/pull/10060#pullrequestreview-441968471", "createdAt": "2020-07-02T19:31:53Z", "commit": {"oid": "bccfd57c7fdec64a694fac298db699652494504c"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wMlQxOTozMTo1M1rOGsaoNA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wMlQxOTozMTo1M1rOGsaoNA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0OTIyNjgwNA==", "bodyText": "The comment can be deleted here as it doesn't match the intention of the code anymore.  Also, nitpick on space between , J9_RUNTIME....\n\n  \n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            \t/* Enable the static verification on the unsafe classes */\n          \n          \n            \n            \tif (J9_ARE_ANY_BITS_SET(vm->runtimeFlags,J9_RUNTIME_VERIFY)) {\n          \n          \n            \n            \tif (J9_ARE_ANY_BITS_SET(vm->runtimeFlags, J9_RUNTIME_VERIFY)) {", "url": "https://github.com/eclipse-openj9/openj9/pull/10060#discussion_r449226804", "createdAt": "2020-07-02T19:31:53Z", "author": {"login": "DanHeidinga"}, "path": "runtime/bcutil/defineclass.c", "diffHunk": "@@ -511,8 +511,8 @@ internalLoadROMClass(J9VMThread * vmThread, J9LoadROMClassData *loadData, J9Tran\n \t\ttranslationFlags |= stripFlags;\n \t}\n \n-\tif ((0 == (loadData->options & J9_FINDCLASS_FLAG_UNSAFE)) &&\n-\t\t(0 != (vm->runtimeFlags & J9_RUNTIME_VERIFY))) {\n+\t/* Enable the static verification on the unsafe classes */\n+\tif (J9_ARE_ANY_BITS_SET(vm->runtimeFlags,J9_RUNTIME_VERIFY)) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "bccfd57c7fdec64a694fac298db699652494504c"}, "originalPosition": 7}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "bccfd57c7fdec64a694fac298db699652494504c", "author": {"user": {"login": "ChengJin01", "name": "Cheng Jin"}}, "url": "https://github.com/eclipse-openj9/openj9/commit/bccfd57c7fdec64a694fac298db699652494504c", "committedDate": "2020-07-02T16:14:08Z", "message": "Enable the static verification for unsafe classes\n\nThe change is to enable the static verification for\nunsafe classes (including anoClasses) so as to support\nthe implementation of valueTypes.\n\nFixes: #9880\n\nSigned-off-by: Cheng Jin <jincheng@ca.ibm.com>"}, "afterCommit": {"oid": "37c0d07bf836a8fccd954a4e6752c5d8fb6f4674", "author": {"user": {"login": "ChengJin01", "name": "Cheng Jin"}}, "url": "https://github.com/eclipse-openj9/openj9/commit/37c0d07bf836a8fccd954a4e6752c5d8fb6f4674", "committedDate": "2020-07-02T20:00:10Z", "message": "Enable the static verification for unsafe classes\n\nThe change is to enable the static verification for\nunsafe classes (including anoClasses) so as to support\nthe implementation of valueTypes.\n\nFixes: #9880\n\nSigned-off-by: Cheng Jin <jincheng@ca.ibm.com>"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDQxOTkxNTkz", "url": "https://github.com/eclipse-openj9/openj9/pull/10060#pullrequestreview-441991593", "createdAt": "2020-07-02T20:14:44Z", "commit": {"oid": "bccfd57c7fdec64a694fac298db699652494504c"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wMlQyMDoxNjozM1rOGsbxRg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wMlQyMDoxNjozM1rOGsbxRg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0OTI0NTUxMA==", "bodyText": "Rather than making this change, which is quite distant from the source of the issue, could staticverify.c checkBytecodeStructure be changed instead?\nSomething like:\nif (info->tag != CFR_CONSTANT_Methodref) {\n\tif (((flags & BCT_MajorClassFileVersionMask) >= BCT_Java8MajorVersionShifted)\n\t&& (bc != CFR_BC_invokevirtual) && (info->tag == CFR_CONSTANT_InterfaceMethodref)\n\t) {\n\t\t/* JVMS 4.9.1 Static Constraints:\n\t\t * The indexbyte operands of each invokespecial and invokestatic instruction must represent\n\t\t * a valid index into the constant_pool table. The constant pool entry referenced by that\n\t\t * index must be either of type CONSTANT_Methodref or of type CONSTANT_InterfaceMethodref.\n\t\t */\n\t\t /* Valid - take no action */\n\t} else {\n\t\tif (flags & BCT_Unsafe) {\n\t\t\t// do any version specific checks here for 8 / 11 / etc that may be needed\n\t\t\t// requires adding a new BCT_Unsafe flag\n\t\t} else {\n\t\t\terrorType = J9NLS_CFR_ERR_BC_NOT_METHODREF__ID;\n\t\t\t/* Jazz 82615: Set the constant pool index to show up in the error message framework */\n\t\t\terrorDataIndex = index;\n\t\t\tgoto _verifyError;\n\t\t}\n\t}\n}", "url": "https://github.com/eclipse-openj9/openj9/pull/10060#discussion_r449245510", "createdAt": "2020-07-02T20:16:33Z", "author": {"login": "DanHeidinga"}, "path": "runtime/bcutil/cfreader.c", "diffHunk": "@@ -2642,9 +2642,13 @@ j9bcutil_readClassFileBytes(J9PortLibrary *portLib,\n \n \t/* Make sure the structure and static verification below uses the class file version\n \t * number. VM version is maintained in vmVersionShifted.\n+\t * Note: ignore the conversion of version to avoid the version check at checkBytecodeStructure\n+\t * in the case of Unsafe.defineClass().\n \t */\n-\tflags &= ~BCT_MajorClassFileVersionMask;\n-\tflags |= ((UDATA) classfile->majorVersion) << BCT_MajorClassFileVersionMaskShift;\n+\tif (J9_ARE_NO_BITS_SET(findClassFlags, J9_FINDCLASS_FLAG_UNSAFE)) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "37c0d07bf836a8fccd954a4e6752c5d8fb6f4674"}, "originalPosition": 9}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "37c0d07bf836a8fccd954a4e6752c5d8fb6f4674", "author": {"user": {"login": "ChengJin01", "name": "Cheng Jin"}}, "url": "https://github.com/eclipse-openj9/openj9/commit/37c0d07bf836a8fccd954a4e6752c5d8fb6f4674", "committedDate": "2020-07-02T20:00:10Z", "message": "Enable the static verification for unsafe classes\n\nThe change is to enable the static verification for\nunsafe classes (including anoClasses) so as to support\nthe implementation of valueTypes.\n\nFixes: #9880\n\nSigned-off-by: Cheng Jin <jincheng@ca.ibm.com>"}, "afterCommit": {"oid": "c2c986546c9884ac221f0c9a4e1cab5fe6f06e9b", "author": {"user": {"login": "ChengJin01", "name": "Cheng Jin"}}, "url": "https://github.com/eclipse-openj9/openj9/commit/c2c986546c9884ac221f0c9a4e1cab5fe6f06e9b", "committedDate": "2020-07-02T20:53:41Z", "message": "Enable the static verification for unsafe classes\n\nThe change is to enable the static verification for\nunsafe classes (including anoClasses) so as to support\nthe implementation of valueTypes.\n\nFixes: #9880\n\nSigned-off-by: Cheng Jin <jincheng@ca.ibm.com>"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "c2c986546c9884ac221f0c9a4e1cab5fe6f06e9b", "author": {"user": {"login": "ChengJin01", "name": "Cheng Jin"}}, "url": "https://github.com/eclipse-openj9/openj9/commit/c2c986546c9884ac221f0c9a4e1cab5fe6f06e9b", "committedDate": "2020-07-02T20:53:41Z", "message": "Enable the static verification for unsafe classes\n\nThe change is to enable the static verification for\nunsafe classes (including anoClasses) so as to support\nthe implementation of valueTypes.\n\nFixes: #9880\n\nSigned-off-by: Cheng Jin <jincheng@ca.ibm.com>"}, "afterCommit": {"oid": "e8373a4bf79dc529bfa117a9a0e718c084eb3404", "author": {"user": {"login": "ChengJin01", "name": "Cheng Jin"}}, "url": "https://github.com/eclipse-openj9/openj9/commit/e8373a4bf79dc529bfa117a9a0e718c084eb3404", "committedDate": "2020-07-02T23:36:02Z", "message": "Enable the static verification for unsafe classes\n\nThe change is to enable the static verification for\nunsafe classes (including anoClasses) so as to support\nthe implementation of valueTypes.\n\nFixes: #9880\n\nSigned-off-by: Cheng Jin <jincheng@ca.ibm.com>"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDQyMDk0NTgy", "url": "https://github.com/eclipse-openj9/openj9/pull/10060#pullrequestreview-442094582", "createdAt": "2020-07-03T01:15:33Z", "commit": {"oid": "e8373a4bf79dc529bfa117a9a0e718c084eb3404"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wM1QwMToxNTozNFrOGsg_Dg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wM1QwMToxNTozNFrOGsg_Dg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0OTMzMDk1OA==", "bodyText": "This overlaps the mask:\n#define BCT_MajorClassFileVersionMask  0xFF000000\n\nNeed to look for free bits earlier in the field", "url": "https://github.com/eclipse-openj9/openj9/pull/10060#discussion_r449330958", "createdAt": "2020-07-03T01:15:34Z", "author": {"login": "DanHeidinga"}, "path": "runtime/oti/j9nonbuilder.h", "diffHunk": "@@ -1966,6 +1966,7 @@ typedef struct J9BCTranslationData {\n #define BCT_AnyPreviewVersion  0x100000\n #define BCT_EnablePreview 0x200000\n #define BCT_DumpMaps  0x40000000\n+#define BCT_Unsafe  0x80000000", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "e8373a4bf79dc529bfa117a9a0e718c084eb3404"}, "originalPosition": 4}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "e8373a4bf79dc529bfa117a9a0e718c084eb3404", "author": {"user": {"login": "ChengJin01", "name": "Cheng Jin"}}, "url": "https://github.com/eclipse-openj9/openj9/commit/e8373a4bf79dc529bfa117a9a0e718c084eb3404", "committedDate": "2020-07-02T23:36:02Z", "message": "Enable the static verification for unsafe classes\n\nThe change is to enable the static verification for\nunsafe classes (including anoClasses) so as to support\nthe implementation of valueTypes.\n\nFixes: #9880\n\nSigned-off-by: Cheng Jin <jincheng@ca.ibm.com>"}, "afterCommit": {"oid": "fa73bfab8a08bbea2c7912623f1c1b6687615631", "author": {"user": {"login": "ChengJin01", "name": "Cheng Jin"}}, "url": "https://github.com/eclipse-openj9/openj9/commit/fa73bfab8a08bbea2c7912623f1c1b6687615631", "committedDate": "2020-07-03T01:28:10Z", "message": "Enable the static verification for unsafe classes\n\nThe change is to enable the static verification for\nunsafe classes (including anoClasses) so as to support\nthe implementation of valueTypes.\n\nFixes: #9880\n\nSigned-off-by: Cheng Jin <jincheng@ca.ibm.com>"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "fa73bfab8a08bbea2c7912623f1c1b6687615631", "author": {"user": {"login": "ChengJin01", "name": "Cheng Jin"}}, "url": "https://github.com/eclipse-openj9/openj9/commit/fa73bfab8a08bbea2c7912623f1c1b6687615631", "committedDate": "2020-07-03T01:28:10Z", "message": "Enable the static verification for unsafe classes\n\nThe change is to enable the static verification for\nunsafe classes (including anoClasses) so as to support\nthe implementation of valueTypes.\n\nFixes: #9880\n\nSigned-off-by: Cheng Jin <jincheng@ca.ibm.com>"}, "afterCommit": {"oid": "caec4dcc0fdcdce7be7228f97d8abe2e1e395b7c", "author": {"user": {"login": "ChengJin01", "name": "Cheng Jin"}}, "url": "https://github.com/eclipse-openj9/openj9/commit/caec4dcc0fdcdce7be7228f97d8abe2e1e395b7c", "committedDate": "2020-07-03T01:31:10Z", "message": "Enable the static verification for unsafe classes\n\nThe change is to enable the static verification for\nunsafe classes (including anoClasses) so as to support\nthe implementation of valueTypes.\n\nFixes: #9880\n\nSigned-off-by: Cheng Jin <jincheng@ca.ibm.com>"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "caec4dcc0fdcdce7be7228f97d8abe2e1e395b7c", "author": {"user": {"login": "ChengJin01", "name": "Cheng Jin"}}, "url": "https://github.com/eclipse-openj9/openj9/commit/caec4dcc0fdcdce7be7228f97d8abe2e1e395b7c", "committedDate": "2020-07-03T01:31:10Z", "message": "Enable the static verification for unsafe classes\n\nThe change is to enable the static verification for\nunsafe classes (including anoClasses) so as to support\nthe implementation of valueTypes.\n\nFixes: #9880\n\nSigned-off-by: Cheng Jin <jincheng@ca.ibm.com>"}, "afterCommit": {"oid": "6f387f13def9c84e7c5bcd232e286d0825945ddf", "author": {"user": {"login": "ChengJin01", "name": "Cheng Jin"}}, "url": "https://github.com/eclipse-openj9/openj9/commit/6f387f13def9c84e7c5bcd232e286d0825945ddf", "committedDate": "2020-07-03T01:40:38Z", "message": "Enable the static verification for unsafe classes\n\nThe change is to enable the static verification for\nunsafe classes (including anoClasses) so as to support\nthe implementation of valueTypes.\n\nFixes: #9880\n\nSigned-off-by: Cheng Jin <jincheng@ca.ibm.com>"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDQyMTM0NDE0", "url": "https://github.com/eclipse-openj9/openj9/pull/10060#pullrequestreview-442134414", "createdAt": "2020-07-03T04:09:23Z", "commit": {"oid": "6f387f13def9c84e7c5bcd232e286d0825945ddf"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wM1QwNDowOToyM1rOGsjHSw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wM1QwNDowOToyM1rOGsjHSw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0OTM2NTgzNQ==", "bodyText": "A name like \"isJava8orLater\" would be clearer.  I'd also put the Unsafe check second.\n\n  \n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            \t\t\t\tBOOLEAN checkFlag = J9_ARE_ANY_BITS_SET(flags, BCT_Unsafe) || ((flags & BCT_MajorClassFileVersionMask) >= BCT_Java8MajorVersionShifted);\n          \n          \n            \n            \t\t\t\tBOOLEAN isJava8OrLater = ((flags & BCT_MajorClassFileVersionMask) >= BCT_Java8MajorVersionShifted) || J9_ARE_ANY_BITS_SET(flags, BCT_Unsafe);", "url": "https://github.com/eclipse-openj9/openj9/pull/10060#discussion_r449365835", "createdAt": "2020-07-03T04:09:23Z", "author": {"login": "DanHeidinga"}, "path": "runtime/bcverify/staticverify.c", "diffHunk": "@@ -857,9 +857,9 @@ checkBytecodeStructure (J9CfrClassFile * classfile, UDATA methodIndex, UDATA len\n \t\t\t}\n \t\t\tinfo = &(classfile->constantPool[index]);\n \t\t\tif (info->tag != CFR_CONSTANT_Methodref) {\n-\t\t\t\tif (((flags & BCT_MajorClassFileVersionMask) >= BCT_Java8MajorVersionShifted)\n-\t\t\t\t&& (bc != CFR_BC_invokevirtual) && (info->tag == CFR_CONSTANT_InterfaceMethodref)\n-\t\t\t\t) {\n+\t\t\t\tBOOLEAN checkFlag = J9_ARE_ANY_BITS_SET(flags, BCT_Unsafe) || ((flags & BCT_MajorClassFileVersionMask) >= BCT_Java8MajorVersionShifted);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "6f387f13def9c84e7c5bcd232e286d0825945ddf"}, "originalPosition": 7}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "bd77169ba84acdd925dc06a6cee775c0157e819f", "author": {"user": {"login": "ChengJin01", "name": "Cheng Jin"}}, "url": "https://github.com/eclipse-openj9/openj9/commit/bd77169ba84acdd925dc06a6cee775c0157e819f", "committedDate": "2020-07-03T04:30:08Z", "message": "Enable the static verification for unsafe classes\n\nThe change is to enable the static verification for\nunsafe classes (including anoClasses) so as to support\nthe implementation of valueTypes.\n\nFixes: #9880\n\nSigned-off-by: Cheng Jin <jincheng@ca.ibm.com>"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "6f387f13def9c84e7c5bcd232e286d0825945ddf", "author": {"user": {"login": "ChengJin01", "name": "Cheng Jin"}}, "url": "https://github.com/eclipse-openj9/openj9/commit/6f387f13def9c84e7c5bcd232e286d0825945ddf", "committedDate": "2020-07-03T01:40:38Z", "message": "Enable the static verification for unsafe classes\n\nThe change is to enable the static verification for\nunsafe classes (including anoClasses) so as to support\nthe implementation of valueTypes.\n\nFixes: #9880\n\nSigned-off-by: Cheng Jin <jincheng@ca.ibm.com>"}, "afterCommit": {"oid": "bd77169ba84acdd925dc06a6cee775c0157e819f", "author": {"user": {"login": "ChengJin01", "name": "Cheng Jin"}}, "url": "https://github.com/eclipse-openj9/openj9/commit/bd77169ba84acdd925dc06a6cee775c0157e819f", "committedDate": "2020-07-03T04:30:08Z", "message": "Enable the static verification for unsafe classes\n\nThe change is to enable the static verification for\nunsafe classes (including anoClasses) so as to support\nthe implementation of valueTypes.\n\nFixes: #9880\n\nSigned-off-by: Cheng Jin <jincheng@ca.ibm.com>"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDQyMTQyOTY1", "url": "https://github.com/eclipse-openj9/openj9/pull/10060#pullrequestreview-442142965", "createdAt": "2020-07-03T04:46:22Z", "commit": {"oid": "bd77169ba84acdd925dc06a6cee775c0157e819f"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 480, "cost": 1, "resetAt": "2021-10-28T17:48:14Z"}}}