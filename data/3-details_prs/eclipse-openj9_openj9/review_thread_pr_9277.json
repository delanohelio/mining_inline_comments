{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDA1MzI0MjY5", "number": 9277, "reviewThreads": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0xN1QyMTo0OTo0MFrODzDiXA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0xN1QyMjoxMzozMFrODzD3jQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjU0ODYxOTE2OnYy", "diffSide": "RIGHT", "path": "runtime/compiler/control/J9Recompilation.cpp", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0xN1QyMTo0OTo0MFrOGHeHZw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0xN1QyMTo0OTo0MFrOGHeHZw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMDQ4NjYzMQ==", "bodyText": "Below, we check for _methodInfo->isProfilingDisabled()\nThis is set in the constructor\nTR_PersistentMethodInfo::TR_PersistentMethodInfo(TR::Compilation *comp)\n{\n...\n  if (comp->getOption(TR_DisableProfiling))\n      {\n      setDisableProfiling();\n      }\n...\n}\n\nSo, if we disabled profiling we don't need anything else in this method.", "url": "https://github.com/eclipse-openj9/openj9/pull/9277#discussion_r410486631", "createdAt": "2020-04-17T21:49:40Z", "author": {"login": "mpirvu"}, "path": "runtime/compiler/control/J9Recompilation.cpp", "diffHunk": "@@ -341,6 +349,14 @@ J9::Recompilation::endOfCompilation()\n bool\n J9::Recompilation::switchToProfiling(uint32_t f, uint32_t c)\n    {\n+   // JITServer doesn't support JitProfiling\n+#if defined(J9VM_OPT_JITSERVER)", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "0978498444b103b0c7776e6b3c7ef20bf602355b"}, "originalPosition": 25}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjU0ODY1NDQ4OnYy", "diffSide": "RIGHT", "path": "runtime/compiler/control/J9Recompilation.cpp", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0xN1QyMjowNDowMFrOGHecMw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0xN1QyMjowNDowMFrOGHecMw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMDQ5MTk1NQ==", "bodyText": "I scanned the code and as far as I can tell optimizationPlan->insertInstrumentation() is false if getOption(TR_DisableProfiling) is true. Thus, we don't need the check on JITServer::SERVER or JITServer::CLIENT", "url": "https://github.com/eclipse-openj9/openj9/pull/9277#discussion_r410491955", "createdAt": "2020-04-17T22:04:00Z", "author": {"login": "mpirvu"}, "path": "runtime/compiler/control/J9Recompilation.cpp", "diffHunk": "@@ -126,10 +126,18 @@ J9::Recompilation::setupMethodInfo()\n \n    // TR_Controller is being used and has provided a compilation plan.  Use it to setup the compilation\n    //\n+   // JITServer does not support JitProfiling\n+   bool performProfiling = (optimizationPlan->insertInstrumentation() != 0);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "0978498444b103b0c7776e6b3c7ef20bf602355b"}, "originalPosition": 5}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjU0ODY3MzQxOnYy", "diffSide": "RIGHT", "path": "runtime/compiler/control/rossa.cpp", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0xN1QyMjoxMzozMFrOGHen1w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0xN1QyMjoxMzozMFrOGHen1w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMDQ5NDkzNQ==", "bodyText": "I would use do this in J9Options.cpp in J9::Options::setupJITServerOptions()\nAlso add  self()->setOption(TR_EnableJProfiling, false); as I don't see it.", "url": "https://github.com/eclipse-openj9/openj9/pull/9277#discussion_r410494935", "createdAt": "2020-04-17T22:13:30Z", "author": {"login": "mpirvu"}, "path": "runtime/compiler/control/rossa.cpp", "diffHunk": "@@ -1586,6 +1586,14 @@ onLoadInternal(\n       ((TR_JitPrivateConfig*)(jitConfig->privateConfig))->iProfiler = NULL;\n       }\n \n+#if defined(J9VM_OPT_JITSERVER)\n+   // JITServer doesn't support JProfiling\n+   if (persistentMemory->getPersistentInfo()->getRemoteCompilationMode() == JITServer::CLIENT\n+       || persistentMemory->getPersistentInfo()->getRemoteCompilationMode() == JITServer::SERVER)\n+      {\n+      TR::Options::getCmdLineOptions()->setOption(TR_DisableJProfilerThread);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "0978498444b103b0c7776e6b3c7ef20bf602355b"}, "originalPosition": 9}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 212, "cost": 1, "resetAt": "2021-11-12T13:16:51Z"}}}