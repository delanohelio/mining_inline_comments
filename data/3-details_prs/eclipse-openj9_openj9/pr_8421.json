{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0MzY3Njk0NDg2", "number": 8421, "title": "Ability to pass extra labels to test jobs if defined in variable file", "bodyText": "Adds the ability to pass parameter LABEL_ADDITION to\nthe test pipelines when extra_test_labels is defined\nin the variable file.\nRefactor some of the code that initializes the test\ntargets.\nRemove default test targets from variable file. Simplifies\nprocessing of tests_targets. All builds are setup to specify\nthe test targets to run so this is unnecessary code.\nKeep sanity and extended definition mapping to functional\ntesting respectively.\n\n[skip ci]\nSigned-off-by: Adam Brousseau adam.brousseau88@gmail.com", "createdAt": "2020-01-27T20:44:00Z", "url": "https://github.com/eclipse-openj9/openj9/pull/8421", "merged": true, "mergeCommit": {"oid": "d2d56b39f1330465f5db6f96a7907cc8e71f1f14"}, "closed": true, "closedAt": "2020-01-31T13:17:37Z", "author": {"login": "AdamBrousseau"}, "timelineItems": {"totalCount": 9, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABb_IRHzABqjI5OTAxMjQwMDI=", "endCursor": "Y3Vyc29yOnYyOpPPAAABb_u_ykAFqTM1MTQ5NzUwMw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "4d80442fff39c0336822bbf2cbe03c95901b5e31", "author": {"user": {"login": "AdamBrousseau", "name": null}}, "url": "https://github.com/eclipse-openj9/openj9/commit/4d80442fff39c0336822bbf2cbe03c95901b5e31", "committedDate": "2020-01-27T20:11:53Z", "message": "Ability to pass extra labels to test jobs if defined in variable file\n\n- Adds the ability to pass parameter LABEL_ADDITION to\n  the test pipelines when extra_test_labels is defined\n  in the variable file.\n- Refactor some of the code that initializes the test\n  targets.\n\n[skip ci]\nSigned-off-by: Adam Brousseau <adam.brousseau88@gmail.com>"}, "afterCommit": {"oid": "7726aa5c1eba0b39993ff86d9316f297ebe58788", "author": {"user": {"login": "AdamBrousseau", "name": null}}, "url": "https://github.com/eclipse-openj9/openj9/commit/7726aa5c1eba0b39993ff86d9316f297ebe58788", "committedDate": "2020-01-29T16:06:53Z", "message": "Ability to pass extra labels to test jobs if defined in variable file\n\n- Adds the ability to pass parameter LABEL_ADDITION to\n  the test pipelines when extra_test_labels is defined\n  in the variable file.\n- Refactor some of the code that initializes the test\n  targets.\n- Remove default test targets from variable file. Simplifies\n  processing of tests_targets. All builds are setup to specify\n  the test targets to run so this is unnecessary code.\n- Keep sanity and extended definition mapping to functional\n  testing respectively.\n\n[skip ci]\nSigned-off-by: Adam Brousseau <adam.brousseau88@gmail.com>"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzUwOTA0MDI5", "url": "https://github.com/eclipse-openj9/openj9/pull/8421#pullrequestreview-350904029", "createdAt": "2020-01-30T15:18:39Z", "commit": {"oid": "7726aa5c1eba0b39993ff86d9316f297ebe58788"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0zMFQxNToxODozOVrOFjuyvw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0zMFQxNTo0MjozNlrOFjvtUw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MzAxMTEzNQ==", "bodyText": "Please combine the 2 case statements, e.g. case ['sanity', 'extended'].", "url": "https://github.com/eclipse-openj9/openj9/pull/8421#discussion_r373011135", "createdAt": "2020-01-30T15:18:39Z", "author": {"login": "vsebe"}, "path": "buildenv/jenkins/common/variables-functions.groovy", "diffHunk": "@@ -637,14 +637,38 @@ def get_date() {\n }\n \n /*\n-* Set TESTS_TARGETS, indicating the level of testing\n-* and sets TEST_FLAG for all targets if defined in variable file\n+* Set TESTS_TARGETS, indicating the level of testing.\n */\n def set_test_targets() {\n-    TESTS_TARGETS = params.TESTS_TARGETS\n-    if (!TESTS_TARGETS) {\n-        // set default TESTS_TARGETS for pipeline job (fetch from variables file)\n-        TESTS_TARGETS = get_default_test_targets()\n+    TESTS_TARGETS = (params.TESTS_TARGETS) ? params.TESTS_TARGETS.trim() : \"none\"\n+    TARGET_NAMES = []\n+\n+    if (TESTS_TARGETS != 'none') {\n+        for (target in TESTS_TARGETS.replaceAll(\"\\\\s\",\"\").toLowerCase().tokenize(',')) {\n+            switch (target) {\n+                case \"sanity\":", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "7726aa5c1eba0b39993ff86d9316f297ebe58788"}, "originalPosition": 19}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MzAxNzA0Nw==", "bodyText": "\"none\" and 'none' be consistent. As there is no no interpolation single quotes will do.", "url": "https://github.com/eclipse-openj9/openj9/pull/8421#discussion_r373017047", "createdAt": "2020-01-30T15:27:55Z", "author": {"login": "vsebe"}, "path": "buildenv/jenkins/common/variables-functions.groovy", "diffHunk": "@@ -637,14 +637,38 @@ def get_date() {\n }\n \n /*\n-* Set TESTS_TARGETS, indicating the level of testing\n-* and sets TEST_FLAG for all targets if defined in variable file\n+* Set TESTS_TARGETS, indicating the level of testing.\n */\n def set_test_targets() {\n-    TESTS_TARGETS = params.TESTS_TARGETS\n-    if (!TESTS_TARGETS) {\n-        // set default TESTS_TARGETS for pipeline job (fetch from variables file)\n-        TESTS_TARGETS = get_default_test_targets()\n+    TESTS_TARGETS = (params.TESTS_TARGETS) ? params.TESTS_TARGETS.trim() : \"none\"", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "7726aa5c1eba0b39993ff86d9316f297ebe58788"}, "originalPosition": 13}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MzAyNDA1OA==", "bodyText": "Extra test labels can be added only in the variables file, no build parameters available. Should users be able to set them in the UI when a build is launched?", "url": "https://github.com/eclipse-openj9/openj9/pull/8421#discussion_r373024058", "createdAt": "2020-01-30T15:39:22Z", "author": {"login": "vsebe"}, "path": "buildenv/jenkins/common/variables-functions.groovy", "diffHunk": "@@ -637,14 +637,38 @@ def get_date() {\n }\n \n /*\n-* Set TESTS_TARGETS, indicating the level of testing\n-* and sets TEST_FLAG for all targets if defined in variable file\n+* Set TESTS_TARGETS, indicating the level of testing.\n */\n def set_test_targets() {\n-    TESTS_TARGETS = params.TESTS_TARGETS\n-    if (!TESTS_TARGETS) {\n-        // set default TESTS_TARGETS for pipeline job (fetch from variables file)\n-        TESTS_TARGETS = get_default_test_targets()\n+    TESTS_TARGETS = (params.TESTS_TARGETS) ? params.TESTS_TARGETS.trim() : \"none\"\n+    TARGET_NAMES = []\n+\n+    if (TESTS_TARGETS != 'none') {\n+        for (target in TESTS_TARGETS.replaceAll(\"\\\\s\",\"\").toLowerCase().tokenize(',')) {\n+            switch (target) {\n+                case \"sanity\":\n+                case \"extended\":\n+                    TARGET_NAMES.add(\"${target}.functional\")\n+                    break\n+                default:\n+                    TARGET_NAMES.add(target)\n+            }\n+        }\n+    }\n+}\n+\n+/*\n+* Set TEST_FLAG for all targets if defined in variable file.\n+* Set EXCLUDED_TESTS if defined in variable file.\n+* Set EXTRA_TEST_LABELS map if defined in variable file.\n+*/\n+def set_test_misc() {\n+    EXTRA_TEST_LABELS = [:]", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "7726aa5c1eba0b39993ff86d9316f297ebe58788"}, "originalPosition": 36}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MzAyNjEzMQ==", "bodyText": "TESTS_TARGETS are set by set_test_targets() function in variables-functions.groovy. This  is not necessary.", "url": "https://github.com/eclipse-openj9/openj9/pull/8421#discussion_r373026131", "createdAt": "2020-01-30T15:42:36Z", "author": {"login": "vsebe"}, "path": "buildenv/jenkins/jobs/pipelines/Pipeline-Build-Test-All.groovy", "diffHunk": "@@ -136,7 +136,7 @@ SHORT_NAMES = ['all' : ['ppc64le_linux','ppc64le_linux_xl','s390x_linux','s390x_\n echo \"Initialize all PARAMETERS...\"\n SETUP_LABEL = (params.SETUP_LABEL) ? params.SETUP_LABEL : \"worker\"\n echo \"Setup SETUP_LABEL:'${SETUP_LABEL}'\"\n-TESTS_TARGETS = (params.TESTS_TARGETS) ? params.TESTS_TARGETS : \"\"\n+TESTS_TARGETS = (params.TESTS_TARGETS) ? params.TESTS_TARGETS : \"none\"", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "7726aa5c1eba0b39993ff86d9316f297ebe58788"}, "originalPosition": 5}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "7726aa5c1eba0b39993ff86d9316f297ebe58788", "author": {"user": {"login": "AdamBrousseau", "name": null}}, "url": "https://github.com/eclipse-openj9/openj9/commit/7726aa5c1eba0b39993ff86d9316f297ebe58788", "committedDate": "2020-01-29T16:06:53Z", "message": "Ability to pass extra labels to test jobs if defined in variable file\n\n- Adds the ability to pass parameter LABEL_ADDITION to\n  the test pipelines when extra_test_labels is defined\n  in the variable file.\n- Refactor some of the code that initializes the test\n  targets.\n- Remove default test targets from variable file. Simplifies\n  processing of tests_targets. All builds are setup to specify\n  the test targets to run so this is unnecessary code.\n- Keep sanity and extended definition mapping to functional\n  testing respectively.\n\n[skip ci]\nSigned-off-by: Adam Brousseau <adam.brousseau88@gmail.com>"}, "afterCommit": {"oid": "e6ea7307cfd7bef9679da9da40453196c52ef81c", "author": {"user": {"login": "AdamBrousseau", "name": null}}, "url": "https://github.com/eclipse-openj9/openj9/commit/e6ea7307cfd7bef9679da9da40453196c52ef81c", "committedDate": "2020-01-30T15:58:20Z", "message": "Ability to pass extra labels to test jobs if defined in variable file\n\n- Adds the ability to pass parameter LABEL_ADDITION to\n  the test pipelines when extra_test_labels is defined\n  in the variable file.\n- Refactor some of the code that initializes the test\n  targets.\n- Remove default test targets from variable file. Simplifies\n  processing of tests_targets. All builds are setup to specify\n  the test targets to run so this is unnecessary code.\n- Keep sanity and extended definition mapping to functional\n  testing respectively.\n\n[skip ci]\nSigned-off-by: Adam Brousseau <adam.brousseau88@gmail.com>"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzUwOTUyNjA0", "url": "https://github.com/eclipse-openj9/openj9/pull/8421#pullrequestreview-350952604", "createdAt": "2020-01-30T16:16:41Z", "commit": {"oid": "e6ea7307cfd7bef9679da9da40453196c52ef81c"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "e6ea7307cfd7bef9679da9da40453196c52ef81c", "author": {"user": {"login": "AdamBrousseau", "name": null}}, "url": "https://github.com/eclipse-openj9/openj9/commit/e6ea7307cfd7bef9679da9da40453196c52ef81c", "committedDate": "2020-01-30T15:58:20Z", "message": "Ability to pass extra labels to test jobs if defined in variable file\n\n- Adds the ability to pass parameter LABEL_ADDITION to\n  the test pipelines when extra_test_labels is defined\n  in the variable file.\n- Refactor some of the code that initializes the test\n  targets.\n- Remove default test targets from variable file. Simplifies\n  processing of tests_targets. All builds are setup to specify\n  the test targets to run so this is unnecessary code.\n- Keep sanity and extended definition mapping to functional\n  testing respectively.\n\n[skip ci]\nSigned-off-by: Adam Brousseau <adam.brousseau88@gmail.com>"}, "afterCommit": {"oid": "fa5cbaf158f4df1d73fcd6808f318e0d015705bf", "author": {"user": {"login": "AdamBrousseau", "name": null}}, "url": "https://github.com/eclipse-openj9/openj9/commit/fa5cbaf158f4df1d73fcd6808f318e0d015705bf", "committedDate": "2020-01-30T16:23:21Z", "message": "Ability to pass extra labels to test jobs if defined in variable file\n\n- Adds the ability to pass parameter LABEL_ADDITION to\n  the test pipelines when extra_test_labels is defined\n  in the variable file.\n- Refactor some of the code that initializes the test\n  targets.\n- Remove default test targets from variable file. Simplifies\n  processing of tests_targets. All builds are setup to specify\n  the test targets to run so this is unnecessary code.\n- Keep sanity and extended definition mapping to functional\n  testing respectively.\n\n[skip ci]\nSigned-off-by: Adam Brousseau <adam.brousseau88@gmail.com>"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "fa5cbaf158f4df1d73fcd6808f318e0d015705bf", "author": {"user": {"login": "AdamBrousseau", "name": null}}, "url": "https://github.com/eclipse-openj9/openj9/commit/fa5cbaf158f4df1d73fcd6808f318e0d015705bf", "committedDate": "2020-01-30T16:23:21Z", "message": "Ability to pass extra labels to test jobs if defined in variable file\n\n- Adds the ability to pass parameter LABEL_ADDITION to\n  the test pipelines when extra_test_labels is defined\n  in the variable file.\n- Refactor some of the code that initializes the test\n  targets.\n- Remove default test targets from variable file. Simplifies\n  processing of tests_targets. All builds are setup to specify\n  the test targets to run so this is unnecessary code.\n- Keep sanity and extended definition mapping to functional\n  testing respectively.\n\n[skip ci]\nSigned-off-by: Adam Brousseau <adam.brousseau88@gmail.com>"}, "afterCommit": {"oid": "d1c6c3137975776a398f8973652f1f3234e03f0d", "author": {"user": {"login": "AdamBrousseau", "name": null}}, "url": "https://github.com/eclipse-openj9/openj9/commit/d1c6c3137975776a398f8973652f1f3234e03f0d", "committedDate": "2020-01-30T16:24:31Z", "message": "Ability to pass extra labels to test jobs if defined in variable file\n\n- Adds the ability to pass parameter LABEL_ADDITION to\n  the test pipelines when extra_test_labels is defined\n  in the variable file.\n- Refactor some of the code that initializes the test\n  targets.\n- Remove default test targets from variable file. Simplifies\n  processing of tests_targets. All builds are setup to specify\n  the test targets to run so this is unnecessary code.\n- Keep sanity and extended definition mapping to functional\n  testing respectively.\n\n[skip ci]\nSigned-off-by: Adam Brousseau <adam.brousseau88@gmail.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c41560218dcd486619c055a0651875fe9f4f936b", "author": {"user": {"login": "AdamBrousseau", "name": null}}, "url": "https://github.com/eclipse-openj9/openj9/commit/c41560218dcd486619c055a0651875fe9f4f936b", "committedDate": "2020-01-30T23:25:54Z", "message": "Ability to pass extra labels to test jobs if defined in variable file\n\n- Adds the ability to pass parameter LABEL_ADDITION to\n  the test pipelines when extra_test_labels is defined\n  in the variable file.\n- Refactor some of the code that initializes the test\n  targets.\n- Remove default test targets from variable file. Simplifies\n  processing of tests_targets. All builds are setup to specify\n  the test targets to run so this is unnecessary code.\n- Keep sanity and extended definition mapping to functional\n  testing respectively.\n\n[skip ci]\nSigned-off-by: Adam Brousseau <adam.brousseau88@gmail.com>"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "d1c6c3137975776a398f8973652f1f3234e03f0d", "author": {"user": {"login": "AdamBrousseau", "name": null}}, "url": "https://github.com/eclipse-openj9/openj9/commit/d1c6c3137975776a398f8973652f1f3234e03f0d", "committedDate": "2020-01-30T16:24:31Z", "message": "Ability to pass extra labels to test jobs if defined in variable file\n\n- Adds the ability to pass parameter LABEL_ADDITION to\n  the test pipelines when extra_test_labels is defined\n  in the variable file.\n- Refactor some of the code that initializes the test\n  targets.\n- Remove default test targets from variable file. Simplifies\n  processing of tests_targets. All builds are setup to specify\n  the test targets to run so this is unnecessary code.\n- Keep sanity and extended definition mapping to functional\n  testing respectively.\n\n[skip ci]\nSigned-off-by: Adam Brousseau <adam.brousseau88@gmail.com>"}, "afterCommit": {"oid": "c41560218dcd486619c055a0651875fe9f4f936b", "author": {"user": {"login": "AdamBrousseau", "name": null}}, "url": "https://github.com/eclipse-openj9/openj9/commit/c41560218dcd486619c055a0651875fe9f4f936b", "committedDate": "2020-01-30T23:25:54Z", "message": "Ability to pass extra labels to test jobs if defined in variable file\n\n- Adds the ability to pass parameter LABEL_ADDITION to\n  the test pipelines when extra_test_labels is defined\n  in the variable file.\n- Refactor some of the code that initializes the test\n  targets.\n- Remove default test targets from variable file. Simplifies\n  processing of tests_targets. All builds are setup to specify\n  the test targets to run so this is unnecessary code.\n- Keep sanity and extended definition mapping to functional\n  testing respectively.\n\n[skip ci]\nSigned-off-by: Adam Brousseau <adam.brousseau88@gmail.com>"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzUxNDk3NTAz", "url": "https://github.com/eclipse-openj9/openj9/pull/8421#pullrequestreview-351497503", "createdAt": "2020-01-31T13:17:28Z", "commit": {"oid": "c41560218dcd486619c055a0651875fe9f4f936b"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 693, "cost": 1, "resetAt": "2021-10-28T18:00:02Z"}}}