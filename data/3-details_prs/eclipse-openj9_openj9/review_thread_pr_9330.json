{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDA3NTk4MDUy", "number": 9330, "reviewThreads": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yM1QwNTozODo0MFrOD1Gc0Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yM1QwNTozODo0MFrOD1Gc0Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjU3MDA2ODAxOnYy", "diffSide": "RIGHT", "path": "runtime/gc_base/StringTable.cpp", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yM1QwNTozODo0MFrOGKXcfA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yM1QxMzo0MjoyMFrOGKosMA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMzUyMzA2OA==", "bodyText": "I'm slightly concerned about the performance implications of this change as this will now call thru:\n MM_ReadBarrierVerifier::preWeakRootSlotRead(J9VMThread *vmThread, j9object_t *srcAddress)\n {\n \tAssert_MM_true(vmThread->javaVM->internalVMFunctions->currentVMThread(vmThread->javaVM) == vmThread);\nand that assert isn't free.\nWhat performance testing do you plan to do for this?", "url": "https://github.com/eclipse-openj9/openj9/pull/9330#discussion_r413523068", "createdAt": "2020-04-23T05:38:40Z", "author": {"login": "DanHeidinga"}, "path": "runtime/gc_base/StringTable.cpp", "diffHunk": "@@ -224,16 +224,7 @@ stringComparatorFn(struct J9AVLTree *tree, struct J9AVLTreeNode *leftNode, struc\n \tstu8Ptr = *((UDATA*) (leftNode+1)); \n \n \t/* Get at the String information  */\n-\tright_s = *(j9object_t *)(rightNode+1);\n-\n-\tif (!isMetronome) {\n-\t\t/* Check if string was copy-forwarded.  Only do this on non-metronome since metronome re-uses the FORWARDED bit */\n-\t\tMM_ScavengerForwardedHeader forwardedHeader(right_s, extensions);\n-\t\tJ9Object* forwardedPtr = forwardedHeader.getForwardedObject();\n-\t\tif (NULL != forwardedPtr) {\n-\t\t\tright_s = forwardedPtr;\n-\t\t}\n-\t}\n+\tright_s = J9WEAKROOT_OBJECT_LOAD_VM(javaVM, (j9object_t *)(rightNode+1));", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "1bbb3dd1514b2cd67e190a1e15d086e9647eb239"}, "originalPosition": 21}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMzgwNTYxNg==", "bodyText": "That is a Verifier path that can be optionally enabled to find any possible anomalies with Read Barrier invocations.\nThe real path for Gencon/Optthruput/Optavgpause is\nMM_StandardAccessBarrier::preWeakRootSlotRead(J9JavaVM *vm, j9object_t *srcAddress)\nwhich is free of that assert.\nEven then, there will be a few more steps (extra 'ifs', method indirections, one being virtual dispatch), before we hit the real code (the check if object is forwarded). But that's a similar overhead we pay for many other reads/stores (for example Monitor Table), for sake of clean/correct code.\nJust in case it's not clear, only two sites in String Table code what is really affected. All other sites are just API renaming.\nBalanced and Metronome for this specific API rely on base MM_ObjectAccessBarrier (which does nothing).", "url": "https://github.com/eclipse-openj9/openj9/pull/9330#discussion_r413805616", "createdAt": "2020-04-23T13:42:20Z", "author": {"login": "amicic"}, "path": "runtime/gc_base/StringTable.cpp", "diffHunk": "@@ -224,16 +224,7 @@ stringComparatorFn(struct J9AVLTree *tree, struct J9AVLTreeNode *leftNode, struc\n \tstu8Ptr = *((UDATA*) (leftNode+1)); \n \n \t/* Get at the String information  */\n-\tright_s = *(j9object_t *)(rightNode+1);\n-\n-\tif (!isMetronome) {\n-\t\t/* Check if string was copy-forwarded.  Only do this on non-metronome since metronome re-uses the FORWARDED bit */\n-\t\tMM_ScavengerForwardedHeader forwardedHeader(right_s, extensions);\n-\t\tJ9Object* forwardedPtr = forwardedHeader.getForwardedObject();\n-\t\tif (NULL != forwardedPtr) {\n-\t\t\tright_s = forwardedPtr;\n-\t\t}\n-\t}\n+\tright_s = J9WEAKROOT_OBJECT_LOAD_VM(javaVM, (j9object_t *)(rightNode+1));", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMzUyMzA2OA=="}, "originalCommit": {"oid": "1bbb3dd1514b2cd67e190a1e15d086e9647eb239"}, "originalPosition": 21}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 241, "cost": 1, "resetAt": "2021-11-12T13:16:51Z"}}}