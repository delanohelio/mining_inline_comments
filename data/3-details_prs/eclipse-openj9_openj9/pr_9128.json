{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0Mzk5MTkxNjYx", "number": 9128, "title": "Special handling of checkcast to value type class", "bodyText": "Checkcast of null to value type class needs to throw\nNullPointerException.\nSigned-off-by: Yi Zhang yizhang@ca.ibm.com", "createdAt": "2020-04-05T18:12:56Z", "url": "https://github.com/eclipse-openj9/openj9/pull/9128", "merged": true, "mergeCommit": {"oid": "ac073cea893f84a5f8fb6a8e4644d974f7179f06"}, "closed": true, "closedAt": "2020-06-15T20:40:27Z", "author": {"login": "cathyzhyi"}, "timelineItems": {"totalCount": 14, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcjyVTMgBqjMzNjQ3MDczNzU=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcnuZwvAFqTQyMzg1MjAxMQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "b5754664f32ba0b1d20ae33653cd7018fb0f026f", "author": {"user": null}, "url": "https://github.com/eclipse-openj9/openj9/commit/b5754664f32ba0b1d20ae33653cd7018fb0f026f", "committedDate": "2020-04-05T18:12:24Z", "message": "Special handling of checkcast to value type class\n\nCheckcast of null to value type class needs to throw\nNullPointerException.\n\nSigned-off-by: Yi Zhang <yizhang@ca.ibm.com>"}, "afterCommit": {"oid": "1299260b2b9dc05786c6b898500524bf276fb185", "author": {"user": null}, "url": "https://github.com/eclipse-openj9/openj9/commit/1299260b2b9dc05786c6b898500524bf276fb185", "committedDate": "2020-05-22T13:30:55Z", "message": "Special handling of checkcast to value type class\n\nCheckcast of null to value type class needs to throw\nNullPointerException.\n\nSigned-off-by: Yi Zhang <yizhang@ca.ibm.com>"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "1299260b2b9dc05786c6b898500524bf276fb185", "author": {"user": null}, "url": "https://github.com/eclipse-openj9/openj9/commit/1299260b2b9dc05786c6b898500524bf276fb185", "committedDate": "2020-05-22T13:30:55Z", "message": "Special handling of checkcast to value type class\n\nCheckcast of null to value type class needs to throw\nNullPointerException.\n\nSigned-off-by: Yi Zhang <yizhang@ca.ibm.com>"}, "afterCommit": {"oid": "54c0d6a00a887be60e3e25c397f92a696ae6e74b", "author": {"user": null}, "url": "https://github.com/eclipse-openj9/openj9/commit/54c0d6a00a887be60e3e25c397f92a696ae6e74b", "committedDate": "2020-05-22T14:14:17Z", "message": "Special handling of checkcast to value type class\n\nCheckcast of null to value type class needs to throw\nNullPointerException.\n\nSigned-off-by: Yi Zhang <yizhang@ca.ibm.com>"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "54c0d6a00a887be60e3e25c397f92a696ae6e74b", "author": {"user": null}, "url": "https://github.com/eclipse-openj9/openj9/commit/54c0d6a00a887be60e3e25c397f92a696ae6e74b", "committedDate": "2020-05-22T14:14:17Z", "message": "Special handling of checkcast to value type class\n\nCheckcast of null to value type class needs to throw\nNullPointerException.\n\nSigned-off-by: Yi Zhang <yizhang@ca.ibm.com>"}, "afterCommit": {"oid": "be25d5e30e4eef1cb0d691c3d9db6b52b6886275", "author": {"user": null}, "url": "https://github.com/eclipse-openj9/openj9/commit/be25d5e30e4eef1cb0d691c3d9db6b52b6886275", "committedDate": "2020-05-22T15:03:27Z", "message": "Special handling of checkcast to value type class\n\nCheckcast of null to value type class needs to throw\nNullPointerException.\n\nSigned-off-by: Yi Zhang <yizhang@ca.ibm.com>"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "be25d5e30e4eef1cb0d691c3d9db6b52b6886275", "author": {"user": null}, "url": "https://github.com/eclipse-openj9/openj9/commit/be25d5e30e4eef1cb0d691c3d9db6b52b6886275", "committedDate": "2020-05-22T15:03:27Z", "message": "Special handling of checkcast to value type class\n\nCheckcast of null to value type class needs to throw\nNullPointerException.\n\nSigned-off-by: Yi Zhang <yizhang@ca.ibm.com>"}, "afterCommit": {"oid": "ab11e38b07fed3bbd5df235a44cc23fd6712e695", "author": {"user": null}, "url": "https://github.com/eclipse-openj9/openj9/commit/ab11e38b07fed3bbd5df235a44cc23fd6712e695", "committedDate": "2020-05-22T16:11:22Z", "message": "Special handling of checkcast to value type class\n\nCheckcast of null to value type class needs to throw\nNullPointerException.\n\nSigned-off-by: Yi Zhang <yizhang@ca.ibm.com>"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "ab11e38b07fed3bbd5df235a44cc23fd6712e695", "author": {"user": null}, "url": "https://github.com/eclipse-openj9/openj9/commit/ab11e38b07fed3bbd5df235a44cc23fd6712e695", "committedDate": "2020-05-22T16:11:22Z", "message": "Special handling of checkcast to value type class\n\nCheckcast of null to value type class needs to throw\nNullPointerException.\n\nSigned-off-by: Yi Zhang <yizhang@ca.ibm.com>"}, "afterCommit": {"oid": "707067e564b5502088eaa7c60c48edfb700361ed", "author": {"user": null}, "url": "https://github.com/eclipse-openj9/openj9/commit/707067e564b5502088eaa7c60c48edfb700361ed", "committedDate": "2020-05-22T16:13:03Z", "message": "Special handling of checkcast to value type class\n\nCheckcast of null to value type class needs to throw\nNullPointerException.\n\nSigned-off-by: Yi Zhang <yizhang@ca.ibm.com>"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDE3MDcxODM5", "url": "https://github.com/eclipse-openj9/openj9/pull/9128#pullrequestreview-417071839", "createdAt": "2020-05-22T17:22:26Z", "commit": {"oid": "707067e564b5502088eaa7c60c48edfb700361ed"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yMlQxNzoyMjoyNlrOGZefrQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yMlQxNzoyMjoyNlrOGZefrQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyOTM2NzIxMw==", "bodyText": "Given value types exist at the OMR level should we contribute the API to OMR and always return false in their implementation for the time being?", "url": "https://github.com/eclipse-openj9/openj9/pull/9128#discussion_r429367213", "createdAt": "2020-05-22T17:22:26Z", "author": {"login": "andrewcraik"}, "path": "runtime/compiler/env/J9ClassEnv.hpp", "diffHunk": "@@ -124,16 +124,31 @@ class OMR_EXTENSIBLE ClassEnv : public OMR::ClassEnvConnector\n    bool isString(TR::Compilation *comp, uintptr_t objectPointer);\n    bool jitStaticsAreSame(TR::Compilation *comp, TR_ResolvedMethod * method1, int32_t cpIndex1, TR_ResolvedMethod * method2, int32_t cpIndex2);\n    bool jitFieldsAreSame(TR::Compilation *comp, TR_ResolvedMethod * method1, int32_t cpIndex1, TR_ResolvedMethod * method2, int32_t cpIndex2, int32_t isStatic);\n+   /*\n+    * \\brief\n+    *    Tells whether a class reference entry in the constant pool represents a value type class.\n+    *\n+    * \\param cpContextClass\n+    *    The class whose constant pool contains the class reference entry being looked at. In another words,\n+    *    it's the class of the method referring to the class reference entry.\n+    *\n+    * \\param cpIndex\n+    *    The constant pool index of the class reference entry.\n+    *\n+    * \\note\n+    *    The class reference entry doesn't need to be resolved because the information is encoded in class name string\n+    */\n+   bool isClassRefValueType(TR_OpaqueClassBlock *cpContextClass, int32_t cpIndex, TR::Compilation * comp);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "707067e564b5502088eaa7c60c48edfb700361ed"}, "originalPosition": 18}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDE3MDcyOTgz", "url": "https://github.com/eclipse-openj9/openj9/pull/9128#pullrequestreview-417072983", "createdAt": "2020-05-22T17:24:24Z", "commit": {"oid": "707067e564b5502088eaa7c60c48edfb700361ed"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yMlQxNzoyNDoyNFrOGZejFw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yMlQxNzoyNDoyNFrOGZejFw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyOTM2ODA4Nw==", "bodyText": "it seems wweird to say the the symbolReference isUnresovled and then as a question about it. A comment to explain this is probably warranted...", "url": "https://github.com/eclipse-openj9/openj9/pull/9128#discussion_r429368087", "createdAt": "2020-05-22T17:24:24Z", "author": {"login": "andrewcraik"}, "path": "runtime/compiler/ilgen/IlGenerator.cpp", "diffHunk": "@@ -564,7 +564,8 @@ TR_J9ByteCodeIlGenerator::genILFromByteCodes()\n \n       if (currNode->getOpCodeValue() == TR::checkcast\n           && currNode->getSecondChild()->getOpCodeValue() == TR::loadaddr\n-          && currNode->getSecondChild()->getSymbolReference()->isUnresolved())\n+          && currNode->getSecondChild()->getSymbolReference()->isUnresolved()\n+          && !TR::Compiler->cls.isClassRefValueType(method()->classOfMethod(), currNode->getSecondChild()->getSymbolReference()->getCPIndex(), comp()))", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "707067e564b5502088eaa7c60c48edfb700361ed"}, "originalPosition": 6}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "707067e564b5502088eaa7c60c48edfb700361ed", "author": {"user": null}, "url": "https://github.com/eclipse-openj9/openj9/commit/707067e564b5502088eaa7c60c48edfb700361ed", "committedDate": "2020-05-22T16:13:03Z", "message": "Special handling of checkcast to value type class\n\nCheckcast of null to value type class needs to throw\nNullPointerException.\n\nSigned-off-by: Yi Zhang <yizhang@ca.ibm.com>"}, "afterCommit": {"oid": "a584fb97300db9d687fccf21131938f7c6e6c48f", "author": {"user": null}, "url": "https://github.com/eclipse-openj9/openj9/commit/a584fb97300db9d687fccf21131938f7c6e6c48f", "committedDate": "2020-05-22T21:26:18Z", "message": "Special handling of checkcast to value type class\n\nCheckcast of null to value type class needs to throw\nNullPointerException.\n\nSigned-off-by: Yi Zhang <yizhang@ca.ibm.com>"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDE3NzQ5Njkw", "url": "https://github.com/eclipse-openj9/openj9/pull/9128#pullrequestreview-417749690", "createdAt": "2020-05-25T14:33:12Z", "commit": {"oid": "a584fb97300db9d687fccf21131938f7c6e6c48f"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yNVQxNDozMzoxMlrOGaDD9A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yNVQxNDozMzoxMlrOGaDD9A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyOTk2NjMyNA==", "bodyText": "This is a bit of a nit, but nearly all the methods in this file that accept a pointer to a TR::Compilation have that in the first argument position.  It feels a little odd seeing it in the last position here, though I see enumerateFields is the same that way.", "url": "https://github.com/eclipse-openj9/openj9/pull/9128#discussion_r429966324", "createdAt": "2020-05-25T14:33:12Z", "author": {"login": "hzongaro"}, "path": "runtime/compiler/env/J9ClassEnv.hpp", "diffHunk": "@@ -124,16 +124,31 @@ class OMR_EXTENSIBLE ClassEnv : public OMR::ClassEnvConnector\n    bool isString(TR::Compilation *comp, uintptr_t objectPointer);\n    bool jitStaticsAreSame(TR::Compilation *comp, TR_ResolvedMethod * method1, int32_t cpIndex1, TR_ResolvedMethod * method2, int32_t cpIndex2);\n    bool jitFieldsAreSame(TR::Compilation *comp, TR_ResolvedMethod * method1, int32_t cpIndex1, TR_ResolvedMethod * method2, int32_t cpIndex2, int32_t isStatic);\n+   /*\n+    * \\brief\n+    *    Tells whether a class reference entry in the constant pool represents a value type class.\n+    *\n+    * \\param cpContextClass\n+    *    The class whose constant pool contains the class reference entry being looked at. In another words,\n+    *    it's the class of the method referring to the class reference entry.\n+    *\n+    * \\param cpIndex\n+    *    The constant pool index of the class reference entry.\n+    *\n+    * \\note\n+    *    The class reference entry doesn't need to be resolved because the information is encoded in class name string\n+    */\n+   bool isClassRefValueType(TR_OpaqueClassBlock *cpContextClass, int32_t cpIndex, TR::Compilation * comp);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "a584fb97300db9d687fccf21131938f7c6e6c48f"}, "originalPosition": 18}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "a584fb97300db9d687fccf21131938f7c6e6c48f", "author": {"user": null}, "url": "https://github.com/eclipse-openj9/openj9/commit/a584fb97300db9d687fccf21131938f7c6e6c48f", "committedDate": "2020-05-22T21:26:18Z", "message": "Special handling of checkcast to value type class\n\nCheckcast of null to value type class needs to throw\nNullPointerException.\n\nSigned-off-by: Yi Zhang <yizhang@ca.ibm.com>"}, "afterCommit": {"oid": "1ad95e48546e57627f6ee55bf8a5daaa9153078f", "author": {"user": null}, "url": "https://github.com/eclipse-openj9/openj9/commit/1ad95e48546e57627f6ee55bf8a5daaa9153078f", "committedDate": "2020-05-25T19:11:59Z", "message": "Special handling of checkcast to value type class\n\nCheckcast of null to value type class needs to throw\nNullPointerException.\n\nSigned-off-by: Yi Zhang <yizhang@ca.ibm.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "749f2eec4e1a7d4c5e11da48e6c418f25faa12b9", "author": {"user": null}, "url": "https://github.com/eclipse-openj9/openj9/commit/749f2eec4e1a7d4c5e11da48e6c418f25faa12b9", "committedDate": "2020-05-27T14:28:23Z", "message": "Special handling of checkcast to value type class\n\nCheckcast of null to value type class needs to throw\nNullPointerException.\n\nSigned-off-by: Yi Zhang <yizhang@ca.ibm.com>"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "1ad95e48546e57627f6ee55bf8a5daaa9153078f", "author": {"user": null}, "url": "https://github.com/eclipse-openj9/openj9/commit/1ad95e48546e57627f6ee55bf8a5daaa9153078f", "committedDate": "2020-05-25T19:11:59Z", "message": "Special handling of checkcast to value type class\n\nCheckcast of null to value type class needs to throw\nNullPointerException.\n\nSigned-off-by: Yi Zhang <yizhang@ca.ibm.com>"}, "afterCommit": {"oid": "749f2eec4e1a7d4c5e11da48e6c418f25faa12b9", "author": {"user": null}, "url": "https://github.com/eclipse-openj9/openj9/commit/749f2eec4e1a7d4c5e11da48e6c418f25faa12b9", "committedDate": "2020-05-27T14:28:23Z", "message": "Special handling of checkcast to value type class\n\nCheckcast of null to value type class needs to throw\nNullPointerException.\n\nSigned-off-by: Yi Zhang <yizhang@ca.ibm.com>"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDE5MjgzMzM3", "url": "https://github.com/eclipse-openj9/openj9/pull/9128#pullrequestreview-419283337", "createdAt": "2020-05-27T14:38:39Z", "commit": {"oid": "749f2eec4e1a7d4c5e11da48e6c418f25faa12b9"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDIzODUyMDEx", "url": "https://github.com/eclipse-openj9/openj9/pull/9128#pullrequestreview-423852011", "createdAt": "2020-06-03T19:12:54Z", "commit": {"oid": "749f2eec4e1a7d4c5e11da48e6c418f25faa12b9"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1184, "cost": 1, "resetAt": "2021-10-28T17:48:14Z"}}}