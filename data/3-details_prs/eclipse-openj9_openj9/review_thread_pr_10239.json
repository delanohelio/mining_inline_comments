{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDU1OTkxNTM2", "number": 10239, "reviewThreads": {"totalCount": 7, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yOVQxOTowMDowM1rOETYrjg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yOVQxOToxODozMVrOETZF7A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjg4NzYyNzY2OnYy", "diffSide": "RIGHT", "path": "jcl/src/java.base/share/classes/java/lang/invoke/MethodHandles.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yOVQxOTowMDowM1rOG5F92w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0zMFQwMzo0MjozN1rOG5R9pw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MjUxOTc3MQ==", "bodyText": "This duplicates the body of defineClass.  Can the Class<?> defineClass(boolean initOption) version forward to this one with a null classData?", "url": "https://github.com/eclipse-openj9/openj9/pull/10239#discussion_r462519771", "createdAt": "2020-07-29T19:00:03Z", "author": {"login": "DanHeidinga"}, "path": "jcl/src/java.base/share/classes/java/lang/invoke/MethodHandles.java", "diffHunk": "@@ -2282,45 +2282,83 @@ int toFlag() {\n \t\t\tprivate final String className;\n \t\t\tprivate final Lookup lookup;\n \t\t\tprivate final int ClassOptFlags;\n+\n \t\t\tClassDefiner(String name, byte[] template, Lookup lookupObj, int flags) {\n \t\t\t\tclassName = name;\n \t\t\t\tclassBytes = template;\n \t\t\t\tlookup = lookupObj;\n \t\t\t\tClassOptFlags = flags;\n \t\t\t}\n+\n \t\t\tClassDefiner(String name, byte[] template, Lookup lookupObj) {\n \t\t\t\tclassName = name;\n \t\t\t\tclassBytes = template;\n \t\t\t\tlookup = lookupObj;\n \t\t\t\tClassOptFlags = 0;\n \t\t\t}\n+\n \t\t\tClass<?> defineClass(boolean initOption) {\n \t\t\t\tClass<?> ret = AccessController.doPrivileged(new PrivilegedAction<Class<?>>() {\n \t\t\t\t\t@Override\n \t\t\t\t\tpublic Class<?> run() {\n \t\t\t\t\t\tJavaLangAccess jlAccess = SharedSecrets.getJavaLangAccess();\n \t\t\t\t\t\tClass<?> lookupClass = lookup.lookupClass();\n-\t\t\t\t\t\treturn jlAccess.defineClass(lookupClass.getClassLoader(), lookupClass, className, classBytes, jlAccess.protectionDomain(lookupClass), initOption, ClassOptFlags, null);\n+\t\t\t\t\t\treturn jlAccess.defineClass(lookupClass.getClassLoader(), lookupClass, className, classBytes,\n+\t\t\t\t\t\t\t\tjlAccess.protectionDomain(lookupClass), initOption, ClassOptFlags, null);\n+\t\t\t\t\t}\n+\t\t\t\t});\n+\t\t\t\treturn ret;\n+\t\t\t}\n+\n+\t\t\tClass<?> defineClass(boolean initOption, Object classData) {\n+\t\t\t\tClass<?> ret = AccessController.doPrivileged(new PrivilegedAction<Class<?>>() {\n+\t\t\t\t\t@Override\n+\t\t\t\t\tpublic Class<?> run() {\n+\t\t\t\t\t\tJavaLangAccess jlAccess = SharedSecrets.getJavaLangAccess();\n+\t\t\t\t\t\tClass<?> lookupClass = lookup.lookupClass();\n+\t\t\t\t\t\treturn jlAccess.defineClass(lookupClass.getClassLoader(), lookupClass, className, classBytes,\n+\t\t\t\t\t\t\t\tjlAccess.protectionDomain(lookupClass), initOption, ClassOptFlags, classData);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "90a8a9312899ed56f7fc04b6a43b9d48364f4182"}, "originalPosition": 40}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MjcxNjMyNw==", "bodyText": "Yes. Addressed in the HEAD commit.", "url": "https://github.com/eclipse-openj9/openj9/pull/10239#discussion_r462716327", "createdAt": "2020-07-30T03:42:37Z", "author": {"login": "babsingh"}, "path": "jcl/src/java.base/share/classes/java/lang/invoke/MethodHandles.java", "diffHunk": "@@ -2282,45 +2282,83 @@ int toFlag() {\n \t\t\tprivate final String className;\n \t\t\tprivate final Lookup lookup;\n \t\t\tprivate final int ClassOptFlags;\n+\n \t\t\tClassDefiner(String name, byte[] template, Lookup lookupObj, int flags) {\n \t\t\t\tclassName = name;\n \t\t\t\tclassBytes = template;\n \t\t\t\tlookup = lookupObj;\n \t\t\t\tClassOptFlags = flags;\n \t\t\t}\n+\n \t\t\tClassDefiner(String name, byte[] template, Lookup lookupObj) {\n \t\t\t\tclassName = name;\n \t\t\t\tclassBytes = template;\n \t\t\t\tlookup = lookupObj;\n \t\t\t\tClassOptFlags = 0;\n \t\t\t}\n+\n \t\t\tClass<?> defineClass(boolean initOption) {\n \t\t\t\tClass<?> ret = AccessController.doPrivileged(new PrivilegedAction<Class<?>>() {\n \t\t\t\t\t@Override\n \t\t\t\t\tpublic Class<?> run() {\n \t\t\t\t\t\tJavaLangAccess jlAccess = SharedSecrets.getJavaLangAccess();\n \t\t\t\t\t\tClass<?> lookupClass = lookup.lookupClass();\n-\t\t\t\t\t\treturn jlAccess.defineClass(lookupClass.getClassLoader(), lookupClass, className, classBytes, jlAccess.protectionDomain(lookupClass), initOption, ClassOptFlags, null);\n+\t\t\t\t\t\treturn jlAccess.defineClass(lookupClass.getClassLoader(), lookupClass, className, classBytes,\n+\t\t\t\t\t\t\t\tjlAccess.protectionDomain(lookupClass), initOption, ClassOptFlags, null);\n+\t\t\t\t\t}\n+\t\t\t\t});\n+\t\t\t\treturn ret;\n+\t\t\t}\n+\n+\t\t\tClass<?> defineClass(boolean initOption, Object classData) {\n+\t\t\t\tClass<?> ret = AccessController.doPrivileged(new PrivilegedAction<Class<?>>() {\n+\t\t\t\t\t@Override\n+\t\t\t\t\tpublic Class<?> run() {\n+\t\t\t\t\t\tJavaLangAccess jlAccess = SharedSecrets.getJavaLangAccess();\n+\t\t\t\t\t\tClass<?> lookupClass = lookup.lookupClass();\n+\t\t\t\t\t\treturn jlAccess.defineClass(lookupClass.getClassLoader(), lookupClass, className, classBytes,\n+\t\t\t\t\t\t\t\tjlAccess.protectionDomain(lookupClass), initOption, ClassOptFlags, classData);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MjUxOTc3MQ=="}, "originalCommit": {"oid": "90a8a9312899ed56f7fc04b6a43b9d48364f4182"}, "originalPosition": 40}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjg4NzYzNjkzOnYy", "diffSide": "RIGHT", "path": "jcl/src/java.base/share/classes/java/lang/invoke/MethodHandles.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yOVQxOTowMjoyOFrOG5GDkA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0zMFQwMzo0MzoyNFrOG5R-Sg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MjUyMTIzMg==", "bodyText": "class data bytes may be confusing given the addition of the classData object", "url": "https://github.com/eclipse-openj9/openj9/pull/10239#discussion_r462521232", "createdAt": "2020-07-29T19:02:28Z", "author": {"login": "DanHeidinga"}, "path": "jcl/src/java.base/share/classes/java/lang/invoke/MethodHandles.java", "diffHunk": "@@ -2282,45 +2282,83 @@ int toFlag() {\n \t\t\tprivate final String className;\n \t\t\tprivate final Lookup lookup;\n \t\t\tprivate final int ClassOptFlags;\n+\n \t\t\tClassDefiner(String name, byte[] template, Lookup lookupObj, int flags) {\n \t\t\t\tclassName = name;\n \t\t\t\tclassBytes = template;\n \t\t\t\tlookup = lookupObj;\n \t\t\t\tClassOptFlags = flags;\n \t\t\t}\n+\n \t\t\tClassDefiner(String name, byte[] template, Lookup lookupObj) {\n \t\t\t\tclassName = name;\n \t\t\t\tclassBytes = template;\n \t\t\t\tlookup = lookupObj;\n \t\t\t\tClassOptFlags = 0;\n \t\t\t}\n+\n \t\t\tClass<?> defineClass(boolean initOption) {\n \t\t\t\tClass<?> ret = AccessController.doPrivileged(new PrivilegedAction<Class<?>>() {\n \t\t\t\t\t@Override\n \t\t\t\t\tpublic Class<?> run() {\n \t\t\t\t\t\tJavaLangAccess jlAccess = SharedSecrets.getJavaLangAccess();\n \t\t\t\t\t\tClass<?> lookupClass = lookup.lookupClass();\n-\t\t\t\t\t\treturn jlAccess.defineClass(lookupClass.getClassLoader(), lookupClass, className, classBytes, jlAccess.protectionDomain(lookupClass), initOption, ClassOptFlags, null);\n+\t\t\t\t\t\treturn jlAccess.defineClass(lookupClass.getClassLoader(), lookupClass, className, classBytes,\n+\t\t\t\t\t\t\t\tjlAccess.protectionDomain(lookupClass), initOption, ClassOptFlags, null);\n+\t\t\t\t\t}\n+\t\t\t\t});\n+\t\t\t\treturn ret;\n+\t\t\t}\n+\n+\t\t\tClass<?> defineClass(boolean initOption, Object classData) {\n+\t\t\t\tClass<?> ret = AccessController.doPrivileged(new PrivilegedAction<Class<?>>() {\n+\t\t\t\t\t@Override\n+\t\t\t\t\tpublic Class<?> run() {\n+\t\t\t\t\t\tJavaLangAccess jlAccess = SharedSecrets.getJavaLangAccess();\n+\t\t\t\t\t\tClass<?> lookupClass = lookup.lookupClass();\n+\t\t\t\t\t\treturn jlAccess.defineClass(lookupClass.getClassLoader(), lookupClass, className, classBytes,\n+\t\t\t\t\t\t\t\tjlAccess.protectionDomain(lookupClass), initOption, ClassOptFlags, classData);\n \t\t\t\t\t}\n \t\t\t\t});\n \t\t\t\treturn ret;\n \t\t\t}\n \t\t}\n+\n \t\t/**\n \t\t * Constructs a new hidden class from an array of class data bytes.\n \t\t * \n-\t\t * @param bytes the class data bytes of the hidden class to be defined.  \n+\t\t * @param bytes the class data bytes of the hidden class to be defined.", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "90a8a9312899ed56f7fc04b6a43b9d48364f4182"}, "originalPosition": 51}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MjcxNjQ5MA==", "bodyText": "Reworded class data bytes to class file bytes in the HEAD commit.", "url": "https://github.com/eclipse-openj9/openj9/pull/10239#discussion_r462716490", "createdAt": "2020-07-30T03:43:24Z", "author": {"login": "babsingh"}, "path": "jcl/src/java.base/share/classes/java/lang/invoke/MethodHandles.java", "diffHunk": "@@ -2282,45 +2282,83 @@ int toFlag() {\n \t\t\tprivate final String className;\n \t\t\tprivate final Lookup lookup;\n \t\t\tprivate final int ClassOptFlags;\n+\n \t\t\tClassDefiner(String name, byte[] template, Lookup lookupObj, int flags) {\n \t\t\t\tclassName = name;\n \t\t\t\tclassBytes = template;\n \t\t\t\tlookup = lookupObj;\n \t\t\t\tClassOptFlags = flags;\n \t\t\t}\n+\n \t\t\tClassDefiner(String name, byte[] template, Lookup lookupObj) {\n \t\t\t\tclassName = name;\n \t\t\t\tclassBytes = template;\n \t\t\t\tlookup = lookupObj;\n \t\t\t\tClassOptFlags = 0;\n \t\t\t}\n+\n \t\t\tClass<?> defineClass(boolean initOption) {\n \t\t\t\tClass<?> ret = AccessController.doPrivileged(new PrivilegedAction<Class<?>>() {\n \t\t\t\t\t@Override\n \t\t\t\t\tpublic Class<?> run() {\n \t\t\t\t\t\tJavaLangAccess jlAccess = SharedSecrets.getJavaLangAccess();\n \t\t\t\t\t\tClass<?> lookupClass = lookup.lookupClass();\n-\t\t\t\t\t\treturn jlAccess.defineClass(lookupClass.getClassLoader(), lookupClass, className, classBytes, jlAccess.protectionDomain(lookupClass), initOption, ClassOptFlags, null);\n+\t\t\t\t\t\treturn jlAccess.defineClass(lookupClass.getClassLoader(), lookupClass, className, classBytes,\n+\t\t\t\t\t\t\t\tjlAccess.protectionDomain(lookupClass), initOption, ClassOptFlags, null);\n+\t\t\t\t\t}\n+\t\t\t\t});\n+\t\t\t\treturn ret;\n+\t\t\t}\n+\n+\t\t\tClass<?> defineClass(boolean initOption, Object classData) {\n+\t\t\t\tClass<?> ret = AccessController.doPrivileged(new PrivilegedAction<Class<?>>() {\n+\t\t\t\t\t@Override\n+\t\t\t\t\tpublic Class<?> run() {\n+\t\t\t\t\t\tJavaLangAccess jlAccess = SharedSecrets.getJavaLangAccess();\n+\t\t\t\t\t\tClass<?> lookupClass = lookup.lookupClass();\n+\t\t\t\t\t\treturn jlAccess.defineClass(lookupClass.getClassLoader(), lookupClass, className, classBytes,\n+\t\t\t\t\t\t\t\tjlAccess.protectionDomain(lookupClass), initOption, ClassOptFlags, classData);\n \t\t\t\t\t}\n \t\t\t\t});\n \t\t\t\treturn ret;\n \t\t\t}\n \t\t}\n+\n \t\t/**\n \t\t * Constructs a new hidden class from an array of class data bytes.\n \t\t * \n-\t\t * @param bytes the class data bytes of the hidden class to be defined.  \n+\t\t * @param bytes the class data bytes of the hidden class to be defined.", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MjUyMTIzMg=="}, "originalCommit": {"oid": "90a8a9312899ed56f7fc04b6a43b9d48364f4182"}, "originalPosition": 51}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjg4NzY0Mjk1OnYy", "diffSide": "RIGHT", "path": "jcl/src/java.base/share/classes/java/lang/invoke/MethodHandles.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yOVQxOTowNDowOFrOG5GHPg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0zMFQwMzo0Mzo1NFrOG5R-sQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MjUyMjE3NA==", "bodyText": "This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters. Learn more about bidirectional Unicode characters\n\n\n  \n\n\n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            \t\t * Constructs a new hidden class from an array of class data bytes.\n          \n          \n            \n            \t\t * Constructs a new hidden class from an array of class file bytes.", "url": "https://github.com/eclipse-openj9/openj9/pull/10239#discussion_r462522174", "createdAt": "2020-07-29T19:04:08Z", "author": {"login": "DanHeidinga"}, "path": "jcl/src/java.base/share/classes/java/lang/invoke/MethodHandles.java", "diffHunk": "@@ -2282,45 +2282,83 @@ int toFlag() {\n \t\t\tprivate final String className;\n \t\t\tprivate final Lookup lookup;\n \t\t\tprivate final int ClassOptFlags;\n+\n \t\t\tClassDefiner(String name, byte[] template, Lookup lookupObj, int flags) {\n \t\t\t\tclassName = name;\n \t\t\t\tclassBytes = template;\n \t\t\t\tlookup = lookupObj;\n \t\t\t\tClassOptFlags = flags;\n \t\t\t}\n+\n \t\t\tClassDefiner(String name, byte[] template, Lookup lookupObj) {\n \t\t\t\tclassName = name;\n \t\t\t\tclassBytes = template;\n \t\t\t\tlookup = lookupObj;\n \t\t\t\tClassOptFlags = 0;\n \t\t\t}\n+\n \t\t\tClass<?> defineClass(boolean initOption) {\n \t\t\t\tClass<?> ret = AccessController.doPrivileged(new PrivilegedAction<Class<?>>() {\n \t\t\t\t\t@Override\n \t\t\t\t\tpublic Class<?> run() {\n \t\t\t\t\t\tJavaLangAccess jlAccess = SharedSecrets.getJavaLangAccess();\n \t\t\t\t\t\tClass<?> lookupClass = lookup.lookupClass();\n-\t\t\t\t\t\treturn jlAccess.defineClass(lookupClass.getClassLoader(), lookupClass, className, classBytes, jlAccess.protectionDomain(lookupClass), initOption, ClassOptFlags, null);\n+\t\t\t\t\t\treturn jlAccess.defineClass(lookupClass.getClassLoader(), lookupClass, className, classBytes,\n+\t\t\t\t\t\t\t\tjlAccess.protectionDomain(lookupClass), initOption, ClassOptFlags, null);\n+\t\t\t\t\t}\n+\t\t\t\t});\n+\t\t\t\treturn ret;\n+\t\t\t}\n+\n+\t\t\tClass<?> defineClass(boolean initOption, Object classData) {\n+\t\t\t\tClass<?> ret = AccessController.doPrivileged(new PrivilegedAction<Class<?>>() {\n+\t\t\t\t\t@Override\n+\t\t\t\t\tpublic Class<?> run() {\n+\t\t\t\t\t\tJavaLangAccess jlAccess = SharedSecrets.getJavaLangAccess();\n+\t\t\t\t\t\tClass<?> lookupClass = lookup.lookupClass();\n+\t\t\t\t\t\treturn jlAccess.defineClass(lookupClass.getClassLoader(), lookupClass, className, classBytes,\n+\t\t\t\t\t\t\t\tjlAccess.protectionDomain(lookupClass), initOption, ClassOptFlags, classData);\n \t\t\t\t\t}\n \t\t\t\t});\n \t\t\t\treturn ret;\n \t\t\t}\n \t\t}\n+\n \t\t/**\n \t\t * Constructs a new hidden class from an array of class data bytes.\n \t\t * \n-\t\t * @param bytes the class data bytes of the hidden class to be defined.  \n+\t\t * @param bytes the class data bytes of the hidden class to be defined.\n \t\t * @param initOption whether to initialize the hidden class.\n \t\t * @param classOptions the {@link ClassOption} to define the hidden class.\n+\t\t * \n \t\t * @return A Lookup object of the newly created hidden class.\n \t\t * @throws IllegalAccessException if this Lookup does not have full privilege access.\n \t\t */\n-\n \t\tpublic Lookup defineHiddenClass(byte[] bytes, boolean initOption, ClassOption... classOptions) throws IllegalAccessException {\n+\t\t\tClassDefiner definer = classDefiner(bytes, classOptions);\n+\t\t\treturn new Lookup(definer.defineClass(initOption));\n+\t\t}\n+\t\t\n+\t\t/**\n+\t\t * Constructs a new hidden class from an array of class data bytes.", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "90a8a9312899ed56f7fc04b6a43b9d48364f4182"}, "originalPosition": 65}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MjcxNjU5Mw==", "bodyText": "Incorporated in the HEAD commit.", "url": "https://github.com/eclipse-openj9/openj9/pull/10239#discussion_r462716593", "createdAt": "2020-07-30T03:43:54Z", "author": {"login": "babsingh"}, "path": "jcl/src/java.base/share/classes/java/lang/invoke/MethodHandles.java", "diffHunk": "@@ -2282,45 +2282,83 @@ int toFlag() {\n \t\t\tprivate final String className;\n \t\t\tprivate final Lookup lookup;\n \t\t\tprivate final int ClassOptFlags;\n+\n \t\t\tClassDefiner(String name, byte[] template, Lookup lookupObj, int flags) {\n \t\t\t\tclassName = name;\n \t\t\t\tclassBytes = template;\n \t\t\t\tlookup = lookupObj;\n \t\t\t\tClassOptFlags = flags;\n \t\t\t}\n+\n \t\t\tClassDefiner(String name, byte[] template, Lookup lookupObj) {\n \t\t\t\tclassName = name;\n \t\t\t\tclassBytes = template;\n \t\t\t\tlookup = lookupObj;\n \t\t\t\tClassOptFlags = 0;\n \t\t\t}\n+\n \t\t\tClass<?> defineClass(boolean initOption) {\n \t\t\t\tClass<?> ret = AccessController.doPrivileged(new PrivilegedAction<Class<?>>() {\n \t\t\t\t\t@Override\n \t\t\t\t\tpublic Class<?> run() {\n \t\t\t\t\t\tJavaLangAccess jlAccess = SharedSecrets.getJavaLangAccess();\n \t\t\t\t\t\tClass<?> lookupClass = lookup.lookupClass();\n-\t\t\t\t\t\treturn jlAccess.defineClass(lookupClass.getClassLoader(), lookupClass, className, classBytes, jlAccess.protectionDomain(lookupClass), initOption, ClassOptFlags, null);\n+\t\t\t\t\t\treturn jlAccess.defineClass(lookupClass.getClassLoader(), lookupClass, className, classBytes,\n+\t\t\t\t\t\t\t\tjlAccess.protectionDomain(lookupClass), initOption, ClassOptFlags, null);\n+\t\t\t\t\t}\n+\t\t\t\t});\n+\t\t\t\treturn ret;\n+\t\t\t}\n+\n+\t\t\tClass<?> defineClass(boolean initOption, Object classData) {\n+\t\t\t\tClass<?> ret = AccessController.doPrivileged(new PrivilegedAction<Class<?>>() {\n+\t\t\t\t\t@Override\n+\t\t\t\t\tpublic Class<?> run() {\n+\t\t\t\t\t\tJavaLangAccess jlAccess = SharedSecrets.getJavaLangAccess();\n+\t\t\t\t\t\tClass<?> lookupClass = lookup.lookupClass();\n+\t\t\t\t\t\treturn jlAccess.defineClass(lookupClass.getClassLoader(), lookupClass, className, classBytes,\n+\t\t\t\t\t\t\t\tjlAccess.protectionDomain(lookupClass), initOption, ClassOptFlags, classData);\n \t\t\t\t\t}\n \t\t\t\t});\n \t\t\t\treturn ret;\n \t\t\t}\n \t\t}\n+\n \t\t/**\n \t\t * Constructs a new hidden class from an array of class data bytes.\n \t\t * \n-\t\t * @param bytes the class data bytes of the hidden class to be defined.  \n+\t\t * @param bytes the class data bytes of the hidden class to be defined.\n \t\t * @param initOption whether to initialize the hidden class.\n \t\t * @param classOptions the {@link ClassOption} to define the hidden class.\n+\t\t * \n \t\t * @return A Lookup object of the newly created hidden class.\n \t\t * @throws IllegalAccessException if this Lookup does not have full privilege access.\n \t\t */\n-\n \t\tpublic Lookup defineHiddenClass(byte[] bytes, boolean initOption, ClassOption... classOptions) throws IllegalAccessException {\n+\t\t\tClassDefiner definer = classDefiner(bytes, classOptions);\n+\t\t\treturn new Lookup(definer.defineClass(initOption));\n+\t\t}\n+\t\t\n+\t\t/**\n+\t\t * Constructs a new hidden class from an array of class data bytes.", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MjUyMjE3NA=="}, "originalCommit": {"oid": "90a8a9312899ed56f7fc04b6a43b9d48364f4182"}, "originalPosition": 65}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjg4NzY0MzkwOnYy", "diffSide": "RIGHT", "path": "jcl/src/java.base/share/classes/java/lang/invoke/MethodHandles.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yOVQxOTowNDoyMlrOG5GHxQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0zMFQwMzo0Mzo1OFrOG5R-yA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MjUyMjMwOQ==", "bodyText": "This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters. Learn more about bidirectional Unicode characters\n\n\n  \n\n\n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            \t\t * @param bytes the class data bytes of the hidden class to be defined.\n          \n          \n            \n            \t\t * @param bytes the class file bytes of the hidden class to be defined.", "url": "https://github.com/eclipse-openj9/openj9/pull/10239#discussion_r462522309", "createdAt": "2020-07-29T19:04:22Z", "author": {"login": "DanHeidinga"}, "path": "jcl/src/java.base/share/classes/java/lang/invoke/MethodHandles.java", "diffHunk": "@@ -2282,45 +2282,83 @@ int toFlag() {\n \t\t\tprivate final String className;\n \t\t\tprivate final Lookup lookup;\n \t\t\tprivate final int ClassOptFlags;\n+\n \t\t\tClassDefiner(String name, byte[] template, Lookup lookupObj, int flags) {\n \t\t\t\tclassName = name;\n \t\t\t\tclassBytes = template;\n \t\t\t\tlookup = lookupObj;\n \t\t\t\tClassOptFlags = flags;\n \t\t\t}\n+\n \t\t\tClassDefiner(String name, byte[] template, Lookup lookupObj) {\n \t\t\t\tclassName = name;\n \t\t\t\tclassBytes = template;\n \t\t\t\tlookup = lookupObj;\n \t\t\t\tClassOptFlags = 0;\n \t\t\t}\n+\n \t\t\tClass<?> defineClass(boolean initOption) {\n \t\t\t\tClass<?> ret = AccessController.doPrivileged(new PrivilegedAction<Class<?>>() {\n \t\t\t\t\t@Override\n \t\t\t\t\tpublic Class<?> run() {\n \t\t\t\t\t\tJavaLangAccess jlAccess = SharedSecrets.getJavaLangAccess();\n \t\t\t\t\t\tClass<?> lookupClass = lookup.lookupClass();\n-\t\t\t\t\t\treturn jlAccess.defineClass(lookupClass.getClassLoader(), lookupClass, className, classBytes, jlAccess.protectionDomain(lookupClass), initOption, ClassOptFlags, null);\n+\t\t\t\t\t\treturn jlAccess.defineClass(lookupClass.getClassLoader(), lookupClass, className, classBytes,\n+\t\t\t\t\t\t\t\tjlAccess.protectionDomain(lookupClass), initOption, ClassOptFlags, null);\n+\t\t\t\t\t}\n+\t\t\t\t});\n+\t\t\t\treturn ret;\n+\t\t\t}\n+\n+\t\t\tClass<?> defineClass(boolean initOption, Object classData) {\n+\t\t\t\tClass<?> ret = AccessController.doPrivileged(new PrivilegedAction<Class<?>>() {\n+\t\t\t\t\t@Override\n+\t\t\t\t\tpublic Class<?> run() {\n+\t\t\t\t\t\tJavaLangAccess jlAccess = SharedSecrets.getJavaLangAccess();\n+\t\t\t\t\t\tClass<?> lookupClass = lookup.lookupClass();\n+\t\t\t\t\t\treturn jlAccess.defineClass(lookupClass.getClassLoader(), lookupClass, className, classBytes,\n+\t\t\t\t\t\t\t\tjlAccess.protectionDomain(lookupClass), initOption, ClassOptFlags, classData);\n \t\t\t\t\t}\n \t\t\t\t});\n \t\t\t\treturn ret;\n \t\t\t}\n \t\t}\n+\n \t\t/**\n \t\t * Constructs a new hidden class from an array of class data bytes.\n \t\t * \n-\t\t * @param bytes the class data bytes of the hidden class to be defined.  \n+\t\t * @param bytes the class data bytes of the hidden class to be defined.\n \t\t * @param initOption whether to initialize the hidden class.\n \t\t * @param classOptions the {@link ClassOption} to define the hidden class.\n+\t\t * \n \t\t * @return A Lookup object of the newly created hidden class.\n \t\t * @throws IllegalAccessException if this Lookup does not have full privilege access.\n \t\t */\n-\n \t\tpublic Lookup defineHiddenClass(byte[] bytes, boolean initOption, ClassOption... classOptions) throws IllegalAccessException {\n+\t\t\tClassDefiner definer = classDefiner(bytes, classOptions);\n+\t\t\treturn new Lookup(definer.defineClass(initOption));\n+\t\t}\n+\t\t\n+\t\t/**\n+\t\t * Constructs a new hidden class from an array of class data bytes.\n+\t\t * \n+\t\t * @param bytes the class data bytes of the hidden class to be defined.", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "90a8a9312899ed56f7fc04b6a43b9d48364f4182"}, "originalPosition": 67}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MjcxNjYxNg==", "bodyText": "Incorporated in the HEAD commit.", "url": "https://github.com/eclipse-openj9/openj9/pull/10239#discussion_r462716616", "createdAt": "2020-07-30T03:43:58Z", "author": {"login": "babsingh"}, "path": "jcl/src/java.base/share/classes/java/lang/invoke/MethodHandles.java", "diffHunk": "@@ -2282,45 +2282,83 @@ int toFlag() {\n \t\t\tprivate final String className;\n \t\t\tprivate final Lookup lookup;\n \t\t\tprivate final int ClassOptFlags;\n+\n \t\t\tClassDefiner(String name, byte[] template, Lookup lookupObj, int flags) {\n \t\t\t\tclassName = name;\n \t\t\t\tclassBytes = template;\n \t\t\t\tlookup = lookupObj;\n \t\t\t\tClassOptFlags = flags;\n \t\t\t}\n+\n \t\t\tClassDefiner(String name, byte[] template, Lookup lookupObj) {\n \t\t\t\tclassName = name;\n \t\t\t\tclassBytes = template;\n \t\t\t\tlookup = lookupObj;\n \t\t\t\tClassOptFlags = 0;\n \t\t\t}\n+\n \t\t\tClass<?> defineClass(boolean initOption) {\n \t\t\t\tClass<?> ret = AccessController.doPrivileged(new PrivilegedAction<Class<?>>() {\n \t\t\t\t\t@Override\n \t\t\t\t\tpublic Class<?> run() {\n \t\t\t\t\t\tJavaLangAccess jlAccess = SharedSecrets.getJavaLangAccess();\n \t\t\t\t\t\tClass<?> lookupClass = lookup.lookupClass();\n-\t\t\t\t\t\treturn jlAccess.defineClass(lookupClass.getClassLoader(), lookupClass, className, classBytes, jlAccess.protectionDomain(lookupClass), initOption, ClassOptFlags, null);\n+\t\t\t\t\t\treturn jlAccess.defineClass(lookupClass.getClassLoader(), lookupClass, className, classBytes,\n+\t\t\t\t\t\t\t\tjlAccess.protectionDomain(lookupClass), initOption, ClassOptFlags, null);\n+\t\t\t\t\t}\n+\t\t\t\t});\n+\t\t\t\treturn ret;\n+\t\t\t}\n+\n+\t\t\tClass<?> defineClass(boolean initOption, Object classData) {\n+\t\t\t\tClass<?> ret = AccessController.doPrivileged(new PrivilegedAction<Class<?>>() {\n+\t\t\t\t\t@Override\n+\t\t\t\t\tpublic Class<?> run() {\n+\t\t\t\t\t\tJavaLangAccess jlAccess = SharedSecrets.getJavaLangAccess();\n+\t\t\t\t\t\tClass<?> lookupClass = lookup.lookupClass();\n+\t\t\t\t\t\treturn jlAccess.defineClass(lookupClass.getClassLoader(), lookupClass, className, classBytes,\n+\t\t\t\t\t\t\t\tjlAccess.protectionDomain(lookupClass), initOption, ClassOptFlags, classData);\n \t\t\t\t\t}\n \t\t\t\t});\n \t\t\t\treturn ret;\n \t\t\t}\n \t\t}\n+\n \t\t/**\n \t\t * Constructs a new hidden class from an array of class data bytes.\n \t\t * \n-\t\t * @param bytes the class data bytes of the hidden class to be defined.  \n+\t\t * @param bytes the class data bytes of the hidden class to be defined.\n \t\t * @param initOption whether to initialize the hidden class.\n \t\t * @param classOptions the {@link ClassOption} to define the hidden class.\n+\t\t * \n \t\t * @return A Lookup object of the newly created hidden class.\n \t\t * @throws IllegalAccessException if this Lookup does not have full privilege access.\n \t\t */\n-\n \t\tpublic Lookup defineHiddenClass(byte[] bytes, boolean initOption, ClassOption... classOptions) throws IllegalAccessException {\n+\t\t\tClassDefiner definer = classDefiner(bytes, classOptions);\n+\t\t\treturn new Lookup(definer.defineClass(initOption));\n+\t\t}\n+\t\t\n+\t\t/**\n+\t\t * Constructs a new hidden class from an array of class data bytes.\n+\t\t * \n+\t\t * @param bytes the class data bytes of the hidden class to be defined.", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MjUyMjMwOQ=="}, "originalCommit": {"oid": "90a8a9312899ed56f7fc04b6a43b9d48364f4182"}, "originalPosition": 67}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjg4NzY3NDM3OnYy", "diffSide": "RIGHT", "path": "jcl/src/java.base/share/classes/java/lang/invoke/MethodHandles.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yOVQxOToxMjozMVrOG5GamQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0zMFQwMzo0NzowN1rOG5SB5A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MjUyNzEyOQ==", "bodyText": "Why an unused parameter?", "url": "https://github.com/eclipse-openj9/openj9/pull/10239#discussion_r462527129", "createdAt": "2020-07-29T19:12:31Z", "author": {"login": "DanHeidinga"}, "path": "jcl/src/java.base/share/classes/java/lang/invoke/MethodHandles.java", "diffHunk": "@@ -5466,12 +5500,96 @@ public Object helper(Object[] arguments) throws Throwable {\n \t}\n \n \t/*[IF Java15]*/\n-\tstatic boolean permuteArgumentChecks(int[] arr, MethodType mt1, MethodType mt2) {\n-\t\tthrow OpenJDKCompileStub.OpenJDKCompileStubThrowError();\n+\t/**\n+\t * Validates that the permute[] specifies a valid permutation from permuteType to handleType.\n+\t * This method throws IllegalArgumentException on failure and returns true on success. This\n+\t * disjointness allows it to be used in asserts.\n+\t * \n+\t * @param permute array specifies the conversion from permuteType to handleType.\n+\t * @param permuteType source method type.\n+\t * @param handleType target method type.\n+\t * \n+\t * @return true on success.\n+\t * @throws IllegalArgumentException on failure.\n+\t */\n+\tstatic boolean permuteArgumentChecks(int[] permute, MethodType permuteType, MethodType handleType) {\n+\t\treturn validatePermutationArray(permuteType, handleType, permute);\n \t}\n \t\n-\tstatic MethodHandle collectReturnValue(MethodHandle mh1, MethodHandle mh2) {\n-\t\tthrow OpenJDKCompileStub.OpenJDKCompileStubThrowError();\n+\t/**\n+\t * Return the classData stored in the accessClass of the Lookup object.\n+\t * \n+\t * @param caller Lookup object used to verify privileged access and retrieve classData.\n+\t * @param unused.", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "90a8a9312899ed56f7fc04b6a43b9d48364f4182"}, "originalPosition": 130}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MjcxNzQxMg==", "bodyText": "RI introduced MethodHandles.classData with an unused String. We had to match the RI in order to support calls from the JEP383 API.", "url": "https://github.com/eclipse-openj9/openj9/pull/10239#discussion_r462717412", "createdAt": "2020-07-30T03:47:07Z", "author": {"login": "babsingh"}, "path": "jcl/src/java.base/share/classes/java/lang/invoke/MethodHandles.java", "diffHunk": "@@ -5466,12 +5500,96 @@ public Object helper(Object[] arguments) throws Throwable {\n \t}\n \n \t/*[IF Java15]*/\n-\tstatic boolean permuteArgumentChecks(int[] arr, MethodType mt1, MethodType mt2) {\n-\t\tthrow OpenJDKCompileStub.OpenJDKCompileStubThrowError();\n+\t/**\n+\t * Validates that the permute[] specifies a valid permutation from permuteType to handleType.\n+\t * This method throws IllegalArgumentException on failure and returns true on success. This\n+\t * disjointness allows it to be used in asserts.\n+\t * \n+\t * @param permute array specifies the conversion from permuteType to handleType.\n+\t * @param permuteType source method type.\n+\t * @param handleType target method type.\n+\t * \n+\t * @return true on success.\n+\t * @throws IllegalArgumentException on failure.\n+\t */\n+\tstatic boolean permuteArgumentChecks(int[] permute, MethodType permuteType, MethodType handleType) {\n+\t\treturn validatePermutationArray(permuteType, handleType, permute);\n \t}\n \t\n-\tstatic MethodHandle collectReturnValue(MethodHandle mh1, MethodHandle mh2) {\n-\t\tthrow OpenJDKCompileStub.OpenJDKCompileStubThrowError();\n+\t/**\n+\t * Return the classData stored in the accessClass of the Lookup object.\n+\t * \n+\t * @param caller Lookup object used to verify privileged access and retrieve classData.\n+\t * @param unused.", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MjUyNzEyOQ=="}, "originalCommit": {"oid": "90a8a9312899ed56f7fc04b6a43b9d48364f4182"}, "originalPosition": 130}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjg4NzY4MzQwOnYy", "diffSide": "RIGHT", "path": "jcl/src/java.base/share/classes/java/lang/Class.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yOVQxOToxNTowN1rOG5GgMw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0zMFQwMzo1NDoxMlrOG5SIRg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MjUyODU2Mw==", "bodyText": "Is this field visible to Reflection in the RI?", "url": "https://github.com/eclipse-openj9/openj9/pull/10239#discussion_r462528563", "createdAt": "2020-07-29T19:15:07Z", "author": {"login": "DanHeidinga"}, "path": "jcl/src/java.base/share/classes/java/lang/Class.java", "diffHunk": "@@ -266,6 +266,10 @@ static Unsafe getUnsafe() {\n \tprivate Class<?> nestHost;\n /*[ENDIF] Java11*/\n \t\n+/*[IF Java15]*/\n+\tprivate transient Object classData;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "90a8a9312899ed56f7fc04b6a43b9d48364f4182"}, "originalPosition": 5}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MjcxOTA0Ng==", "bodyText": "The Class.classData field is listed in Reflection.fieldFilterMap. It gets filtered out from public-view. I don't think it is visible to Reflection in the RI. Assuming, I have correctly read the code.", "url": "https://github.com/eclipse-openj9/openj9/pull/10239#discussion_r462719046", "createdAt": "2020-07-30T03:54:12Z", "author": {"login": "babsingh"}, "path": "jcl/src/java.base/share/classes/java/lang/Class.java", "diffHunk": "@@ -266,6 +266,10 @@ static Unsafe getUnsafe() {\n \tprivate Class<?> nestHost;\n /*[ENDIF] Java11*/\n \t\n+/*[IF Java15]*/\n+\tprivate transient Object classData;", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MjUyODU2Mw=="}, "originalCommit": {"oid": "90a8a9312899ed56f7fc04b6a43b9d48364f4182"}, "originalPosition": 5}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjg4NzY5NTE2OnYy", "diffSide": "RIGHT", "path": "jcl/src/java.base/share/classes/java/lang/invoke/MethodHandles.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yOVQxOToxODozMVrOG5Gnfg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yOVQyMDowMTo1MlrOG5ICSQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MjUzMDQzMA==", "bodyText": "How did we determine that true aka initialize is the right value here?", "url": "https://github.com/eclipse-openj9/openj9/pull/10239#discussion_r462530430", "createdAt": "2020-07-29T19:18:31Z", "author": {"login": "DanHeidinga"}, "path": "jcl/src/java.base/share/classes/java/lang/invoke/MethodHandles.java", "diffHunk": "@@ -2282,45 +2282,83 @@ int toFlag() {\n \t\t\tprivate final String className;\n \t\t\tprivate final Lookup lookup;\n \t\t\tprivate final int ClassOptFlags;\n+\n \t\t\tClassDefiner(String name, byte[] template, Lookup lookupObj, int flags) {\n \t\t\t\tclassName = name;\n \t\t\t\tclassBytes = template;\n \t\t\t\tlookup = lookupObj;\n \t\t\t\tClassOptFlags = flags;\n \t\t\t}\n+\n \t\t\tClassDefiner(String name, byte[] template, Lookup lookupObj) {\n \t\t\t\tclassName = name;\n \t\t\t\tclassBytes = template;\n \t\t\t\tlookup = lookupObj;\n \t\t\t\tClassOptFlags = 0;\n \t\t\t}\n+\n \t\t\tClass<?> defineClass(boolean initOption) {\n \t\t\t\tClass<?> ret = AccessController.doPrivileged(new PrivilegedAction<Class<?>>() {\n \t\t\t\t\t@Override\n \t\t\t\t\tpublic Class<?> run() {\n \t\t\t\t\t\tJavaLangAccess jlAccess = SharedSecrets.getJavaLangAccess();\n \t\t\t\t\t\tClass<?> lookupClass = lookup.lookupClass();\n-\t\t\t\t\t\treturn jlAccess.defineClass(lookupClass.getClassLoader(), lookupClass, className, classBytes, jlAccess.protectionDomain(lookupClass), initOption, ClassOptFlags, null);\n+\t\t\t\t\t\treturn jlAccess.defineClass(lookupClass.getClassLoader(), lookupClass, className, classBytes,\n+\t\t\t\t\t\t\t\tjlAccess.protectionDomain(lookupClass), initOption, ClassOptFlags, null);\n+\t\t\t\t\t}\n+\t\t\t\t});\n+\t\t\t\treturn ret;\n+\t\t\t}\n+\n+\t\t\tClass<?> defineClass(boolean initOption, Object classData) {\n+\t\t\t\tClass<?> ret = AccessController.doPrivileged(new PrivilegedAction<Class<?>>() {\n+\t\t\t\t\t@Override\n+\t\t\t\t\tpublic Class<?> run() {\n+\t\t\t\t\t\tJavaLangAccess jlAccess = SharedSecrets.getJavaLangAccess();\n+\t\t\t\t\t\tClass<?> lookupClass = lookup.lookupClass();\n+\t\t\t\t\t\treturn jlAccess.defineClass(lookupClass.getClassLoader(), lookupClass, className, classBytes,\n+\t\t\t\t\t\t\t\tjlAccess.protectionDomain(lookupClass), initOption, ClassOptFlags, classData);\n \t\t\t\t\t}\n \t\t\t\t});\n \t\t\t\treturn ret;\n \t\t\t}\n \t\t}\n+\n \t\t/**\n \t\t * Constructs a new hidden class from an array of class data bytes.\n \t\t * \n-\t\t * @param bytes the class data bytes of the hidden class to be defined.  \n+\t\t * @param bytes the class data bytes of the hidden class to be defined.\n \t\t * @param initOption whether to initialize the hidden class.\n \t\t * @param classOptions the {@link ClassOption} to define the hidden class.\n+\t\t * \n \t\t * @return A Lookup object of the newly created hidden class.\n \t\t * @throws IllegalAccessException if this Lookup does not have full privilege access.\n \t\t */\n-\n \t\tpublic Lookup defineHiddenClass(byte[] bytes, boolean initOption, ClassOption... classOptions) throws IllegalAccessException {\n+\t\t\tClassDefiner definer = classDefiner(bytes, classOptions);\n+\t\t\treturn new Lookup(definer.defineClass(initOption));\n+\t\t}\n+\t\t\n+\t\t/**\n+\t\t * Constructs a new hidden class from an array of class data bytes.\n+\t\t * \n+\t\t * @param bytes the class data bytes of the hidden class to be defined.\n+\t\t * @param classData the classData to be stored in the hidden class.\n+\t\t * @param classOptions the {@link ClassOption} to define the hidden class.\n+\t\t * \n+\t\t * @return A Lookup object of the newly created hidden class.\n+\t\t * @throws IllegalAccessException if this Lookup does not have full privilege access.\n+\t\t */\n+\t\tLookup defineHiddenClassWithClassData(byte[] bytes, Object classData, ClassOption... classOptions) throws IllegalAccessException {\n+\t\t\tClassDefiner definer = classDefiner(bytes, classOptions);\n+\t\t\treturn new Lookup(definer.defineClass(true, classData));", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "90a8a9312899ed56f7fc04b6a43b9d48364f4182"}, "originalPosition": 76}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MjU1MzY3Mw==", "bodyText": "From the documentation. defineHiddenClassWithClassData is a package private method so its documentation does not get published in the official docs.", "url": "https://github.com/eclipse-openj9/openj9/pull/10239#discussion_r462553673", "createdAt": "2020-07-29T20:01:52Z", "author": {"login": "babsingh"}, "path": "jcl/src/java.base/share/classes/java/lang/invoke/MethodHandles.java", "diffHunk": "@@ -2282,45 +2282,83 @@ int toFlag() {\n \t\t\tprivate final String className;\n \t\t\tprivate final Lookup lookup;\n \t\t\tprivate final int ClassOptFlags;\n+\n \t\t\tClassDefiner(String name, byte[] template, Lookup lookupObj, int flags) {\n \t\t\t\tclassName = name;\n \t\t\t\tclassBytes = template;\n \t\t\t\tlookup = lookupObj;\n \t\t\t\tClassOptFlags = flags;\n \t\t\t}\n+\n \t\t\tClassDefiner(String name, byte[] template, Lookup lookupObj) {\n \t\t\t\tclassName = name;\n \t\t\t\tclassBytes = template;\n \t\t\t\tlookup = lookupObj;\n \t\t\t\tClassOptFlags = 0;\n \t\t\t}\n+\n \t\t\tClass<?> defineClass(boolean initOption) {\n \t\t\t\tClass<?> ret = AccessController.doPrivileged(new PrivilegedAction<Class<?>>() {\n \t\t\t\t\t@Override\n \t\t\t\t\tpublic Class<?> run() {\n \t\t\t\t\t\tJavaLangAccess jlAccess = SharedSecrets.getJavaLangAccess();\n \t\t\t\t\t\tClass<?> lookupClass = lookup.lookupClass();\n-\t\t\t\t\t\treturn jlAccess.defineClass(lookupClass.getClassLoader(), lookupClass, className, classBytes, jlAccess.protectionDomain(lookupClass), initOption, ClassOptFlags, null);\n+\t\t\t\t\t\treturn jlAccess.defineClass(lookupClass.getClassLoader(), lookupClass, className, classBytes,\n+\t\t\t\t\t\t\t\tjlAccess.protectionDomain(lookupClass), initOption, ClassOptFlags, null);\n+\t\t\t\t\t}\n+\t\t\t\t});\n+\t\t\t\treturn ret;\n+\t\t\t}\n+\n+\t\t\tClass<?> defineClass(boolean initOption, Object classData) {\n+\t\t\t\tClass<?> ret = AccessController.doPrivileged(new PrivilegedAction<Class<?>>() {\n+\t\t\t\t\t@Override\n+\t\t\t\t\tpublic Class<?> run() {\n+\t\t\t\t\t\tJavaLangAccess jlAccess = SharedSecrets.getJavaLangAccess();\n+\t\t\t\t\t\tClass<?> lookupClass = lookup.lookupClass();\n+\t\t\t\t\t\treturn jlAccess.defineClass(lookupClass.getClassLoader(), lookupClass, className, classBytes,\n+\t\t\t\t\t\t\t\tjlAccess.protectionDomain(lookupClass), initOption, ClassOptFlags, classData);\n \t\t\t\t\t}\n \t\t\t\t});\n \t\t\t\treturn ret;\n \t\t\t}\n \t\t}\n+\n \t\t/**\n \t\t * Constructs a new hidden class from an array of class data bytes.\n \t\t * \n-\t\t * @param bytes the class data bytes of the hidden class to be defined.  \n+\t\t * @param bytes the class data bytes of the hidden class to be defined.\n \t\t * @param initOption whether to initialize the hidden class.\n \t\t * @param classOptions the {@link ClassOption} to define the hidden class.\n+\t\t * \n \t\t * @return A Lookup object of the newly created hidden class.\n \t\t * @throws IllegalAccessException if this Lookup does not have full privilege access.\n \t\t */\n-\n \t\tpublic Lookup defineHiddenClass(byte[] bytes, boolean initOption, ClassOption... classOptions) throws IllegalAccessException {\n+\t\t\tClassDefiner definer = classDefiner(bytes, classOptions);\n+\t\t\treturn new Lookup(definer.defineClass(initOption));\n+\t\t}\n+\t\t\n+\t\t/**\n+\t\t * Constructs a new hidden class from an array of class data bytes.\n+\t\t * \n+\t\t * @param bytes the class data bytes of the hidden class to be defined.\n+\t\t * @param classData the classData to be stored in the hidden class.\n+\t\t * @param classOptions the {@link ClassOption} to define the hidden class.\n+\t\t * \n+\t\t * @return A Lookup object of the newly created hidden class.\n+\t\t * @throws IllegalAccessException if this Lookup does not have full privilege access.\n+\t\t */\n+\t\tLookup defineHiddenClassWithClassData(byte[] bytes, Object classData, ClassOption... classOptions) throws IllegalAccessException {\n+\t\t\tClassDefiner definer = classDefiner(bytes, classOptions);\n+\t\t\treturn new Lookup(definer.defineClass(true, classData));", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MjUzMDQzMA=="}, "originalCommit": {"oid": "90a8a9312899ed56f7fc04b6a43b9d48364f4182"}, "originalPosition": 76}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4808, "cost": 1, "resetAt": "2021-11-12T18:49:56Z"}}}