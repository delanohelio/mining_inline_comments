{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0Mzg1MDE3MzQ0", "number": 8783, "title": "Fix VarHandle coordinateTypes", "bodyText": "The first VarHandle parameter type should be removed from the getter in\norder to correctly derive the coordinate types.\nSigned-off-by: Babneet Singh sbabneet@ca.ibm.com", "createdAt": "2020-03-06T20:55:32Z", "url": "https://github.com/eclipse-openj9/openj9/pull/8783", "merged": true, "mergeCommit": {"oid": "4156b55a00d539f2e5bd80c03f678a2e8476b0ef"}, "closed": true, "closedAt": "2020-03-09T19:44:33Z", "author": {"login": "babsingh"}, "timelineItems": {"totalCount": 5, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcL1CfIAFqTM3MDg5NzI4Ng==", "endCursor": "Y3Vyc29yOnYyOpPPAAABcMBAGJgFqTM3MTM2Mzc0OQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzcwODk3Mjg2", "url": "https://github.com/eclipse-openj9/openj9/pull/8783#pullrequestreview-370897286", "createdAt": "2020-03-09T03:06:51Z", "commit": {"oid": "a108b45bedd8f79a7fcd70986f649487c9a4f5ee"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wOVQwMzowNjo1MVrOFzZ4LA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wOVQwMzowNjo1MVrOFzZ4LA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4OTQ0NTY3Ng==", "bodyText": "Rather than creating a new MT here (getter.dropFirstParameterType), can you just copy a subset of the originalMT's parameterArray?\nSomething like\n\n  \n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            \t\tthis.coordinateTypes = getter.dropFirstParameterType().parameterArray();\n          \n          \n            \n            \t\tClass<?>[] getterTypes = getter.parameterArray();\n          \n          \n            \n            \t\tthis.coordinateTypes = Arrays.copyOfRange(getterTypes, 1, getterTypes.length);\n          \n      \n    \n    \n  \n\nThis still has one additional allocation (the getterTypes array) but saves the more costly MT creation", "url": "https://github.com/eclipse-openj9/openj9/pull/8783#discussion_r389445676", "createdAt": "2020-03-09T03:06:51Z", "author": {"login": "DanHeidinga"}, "path": "jcl/src/java.base/share/classes/java/lang/invoke/VarHandle.java", "diffHunk": "@@ -413,12 +413,18 @@ MethodType accessModeType(Class<?> receiver, Class<?> type, Class<?>... args) {\n \t\t}\n \n \t\tthis.fieldType = setter.parameterType(setter.parameterCount() - 1);\n-\t\tthis.coordinateTypes = getter.parameterArray();\n+\t\t\n+\t\t/* The first VarHandle parameter type should be removed from the getter in order to derive\n+\t\t * the coordinate types. \n+\t\t */\n+\t\tthis.coordinateTypes = getter.dropFirstParameterType().parameterArray();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "a108b45bedd8f79a7fcd70986f649487c9a4f5ee"}, "originalPosition": 9}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "34ef5d0b6ff01550e89ef8c0d8f9c733861a291f", "author": {"user": {"login": "babsingh", "name": "Babneet Singh"}}, "url": "https://github.com/eclipse-openj9/openj9/commit/34ef5d0b6ff01550e89ef8c0d8f9c733861a291f", "committedDate": "2020-03-09T04:20:07Z", "message": "Fix VarHandle coordinateTypes\n\nThe first VarHandle parameter type should be removed from the getter in\norder to correctly derive the coordinate types.\n\nSigned-off-by: Babneet Singh <sbabneet@ca.ibm.com>"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "a108b45bedd8f79a7fcd70986f649487c9a4f5ee", "author": {"user": {"login": "babsingh", "name": "Babneet Singh"}}, "url": "https://github.com/eclipse-openj9/openj9/commit/a108b45bedd8f79a7fcd70986f649487c9a4f5ee", "committedDate": "2020-03-06T20:03:29Z", "message": "Fix VarHandle coordinateTypes\n\nThe first VarHandle parameter type should be removed from the getter in\norder to correctly derive the coordinate types.\n\nSigned-off-by: Babneet Singh <sbabneet@ca.ibm.com>"}, "afterCommit": {"oid": "34ef5d0b6ff01550e89ef8c0d8f9c733861a291f", "author": {"user": {"login": "babsingh", "name": "Babneet Singh"}}, "url": "https://github.com/eclipse-openj9/openj9/commit/34ef5d0b6ff01550e89ef8c0d8f9c733861a291f", "committedDate": "2020-03-09T04:20:07Z", "message": "Fix VarHandle coordinateTypes\n\nThe first VarHandle parameter type should be removed from the getter in\norder to correctly derive the coordinate types.\n\nSigned-off-by: Babneet Singh <sbabneet@ca.ibm.com>"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzcxMTQxMDY4", "url": "https://github.com/eclipse-openj9/openj9/pull/8783#pullrequestreview-371141068", "createdAt": "2020-03-09T12:54:33Z", "commit": {"oid": "34ef5d0b6ff01550e89ef8c0d8f9c733861a291f"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wOVQxMjo1NDozM1rOFzl0Og==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wOVQxMjo1NDozM1rOFzl0Og==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4OTY0MTI3NA==", "bodyText": "Is getter guaranteed to have at least 1 element at this point?", "url": "https://github.com/eclipse-openj9/openj9/pull/8783#discussion_r389641274", "createdAt": "2020-03-09T12:54:33Z", "author": {"login": "DanHeidinga"}, "path": "jcl/src/java.base/share/classes/java/lang/invoke/VarHandle.java", "diffHunk": "@@ -413,12 +413,19 @@ MethodType accessModeType(Class<?> receiver, Class<?> type, Class<?>... args) {\n \t\t}\n \n \t\tthis.fieldType = setter.parameterType(setter.parameterCount() - 1);\n-\t\tthis.coordinateTypes = getter.parameterArray();\n+\t\t\n+\t\t/* The first VarHandle parameter type should be removed from the getter in order to derive\n+\t\t * the coordinate types. \n+\t\t */\n+\t\tClass<?>[] getterParams = getter.parameterArray();\n+\t\tthis.coordinateTypes = Arrays.copyOfRange(getterParams, 1, getterParams.length);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "34ef5d0b6ff01550e89ef8c0d8f9c733861a291f"}, "originalPosition": 10}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzcxMzYzNzQ5", "url": "https://github.com/eclipse-openj9/openj9/pull/8783#pullrequestreview-371363749", "createdAt": "2020-03-09T17:03:11Z", "commit": {"oid": "34ef5d0b6ff01550e89ef8c0d8f9c733861a291f"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 418, "cost": 1, "resetAt": "2021-10-28T18:00:02Z"}}}