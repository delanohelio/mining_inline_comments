{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDMzODUxMzk5", "number": 9866, "title": "Immediate field handling cleanup on Power", "bodyText": "buildDirectDispatch was incorrectly truncating an immediate value before\ngenerating an lis instruction. This was corrected.\ngeneratePrologue in PPCRecompilation.cpp also had the same problem and has\nbeen corrected.\nAdded in several new asserts to give better information in cases where an out\nof range value is attempted to be used as the immediate value for an\ninstruction.\nSigned-off-by: jimmyk jimmyk@ca.ibm.com", "createdAt": "2020-06-12T19:33:16Z", "url": "https://github.com/eclipse-openj9/openj9/pull/9866", "merged": true, "mergeCommit": {"oid": "a18b8ba01b6c10ab991ba3efc480d5337f65b12a"}, "closed": true, "closedAt": "2020-06-19T00:09:32Z", "author": {"login": "IBMJimmyk"}, "timelineItems": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcqmGvBgH2gAyNDMzODUxMzk5OmYxZWFlNDdjMDlmOGY0NDQ2NGQ3ZjZmOWFlMjFkOWY3YjNhM2ZiNjE=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcr-4YBgFqTQzMTk3MzE2Mw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "f1eae47c09f8f44464d7f6f9ae21d9f7b3a3fb61", "author": {"user": {"login": "IBMJimmyk", "name": "Jimmy K"}}, "url": "https://github.com/eclipse-openj9/openj9/commit/f1eae47c09f8f44464d7f6f9ae21d9f7b3a3fb61", "committedDate": "2020-06-12T17:14:39Z", "message": "Immediate field handling cleanup on Power\n\nbuildDirectDispatch was incorrectly truncating an immediate value before\ngenerating an lis instruction. This was corrected.\n\ngeneratePrologue in PPCRecompilation.cpp also had the same problem and has\nbeen corrected.\n\nAdded in several new asserts to give better information in cases where an out\nof range value is attempted to be used as the immediate value for an\ninstruction.\n\nSigned-off-by: jimmyk <jimmyk@ca.ibm.com>"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDMwNjUzODEx", "url": "https://github.com/eclipse-openj9/openj9/pull/9866#pullrequestreview-430653811", "createdAt": "2020-06-15T13:40:52Z", "commit": {"oid": "f1eae47c09f8f44464d7f6f9ae21d9f7b3a3fb61"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDMxOTczMTYz", "url": "https://github.com/eclipse-openj9/openj9/pull/9866#pullrequestreview-431973163", "createdAt": "2020-06-17T00:10:04Z", "commit": {"oid": "f1eae47c09f8f44464d7f6f9ae21d9f7b3a3fb61"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xN1QwMDoxMDowNVrOGkxQew==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xN1QwMDoxMDowNVrOGkxQew==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MTIwODk1NQ==", "bodyText": "I am not sure the ASSERT above guaranties there is nothing in the upper 32-bits of aValue (intptr_t). I would cast to int16_t to be on a safe side and to reproduce the old behaviour precisely. Or make the ASSERT more clear.", "url": "https://github.com/eclipse-openj9/openj9/pull/9866#discussion_r441208955", "createdAt": "2020-06-17T00:10:05Z", "author": {"login": "gita-omr"}, "path": "runtime/compiler/p/codegen/PPCJNILinkage.cpp", "diffHunk": "@@ -433,8 +433,8 @@ TR::Register *J9::Power::JNILinkage::buildDirectDispatch(TR::Node *callNode)\n \n       // push flags: use lis instead of lis/ori pair since this is a constant. Save one instr\n       aValue = fej9->constJNICallOutFrameFlags();\n-      TR_ASSERT((aValue & ~0x7FFF0000) == 0, \"Length assumption broken.\");\n-      generateTrg1ImmInstruction(cg(), TR::InstOpCode::lis, callNode, gr11Reg, (aValue>>16)&0x0000FFFF);\n+      TR_ASSERT_FATAL((aValue & ~0x7FFF0000) == 0, \"Length assumption broken.\");\n+      generateTrg1ImmInstruction(cg(), TR::InstOpCode::lis, callNode, gr11Reg, aValue>>16);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f1eae47c09f8f44464d7f6f9ae21d9f7b3a3fb61"}, "originalPosition": 7}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 674, "cost": 1, "resetAt": "2021-10-28T17:48:14Z"}}}