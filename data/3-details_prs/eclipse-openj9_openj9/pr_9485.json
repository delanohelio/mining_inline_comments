{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDE0NzgxMzYy", "number": 9485, "title": "Java 15 Use Unsafe.defineAnonyousClass() to define Hidden classes.", "bodyText": "Add implementation of new Hidden class APIs to unblock the JDK15 builds.\nissue #9328\nSigned-off-by: Hang Shao hangshao@ca.ibm.com", "createdAt": "2020-05-07T16:05:50Z", "url": "https://github.com/eclipse-openj9/openj9/pull/9485", "merged": true, "mergeCommit": {"oid": "b1a5855d365cf32129d2c058538e4baa84bed19a"}, "closed": true, "closedAt": "2020-05-21T22:13:41Z", "author": {"login": "hangshao0"}, "timelineItems": {"totalCount": 36, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABces9T2AH2gAyNDE0NzgxMzYyOmQ2Nzc0M2I4OGE5ZTk2ODA2NTI0MDUwNzdlY2EzMjM5MTAxMTk4NDY=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcjlGg3AFqTQxNjUyNjI0OA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "d67743b88a9e9680652405077eca323910119846", "author": {"user": {"login": "pshipton", "name": "Peter Shipton"}}, "url": "https://github.com/eclipse-openj9/openj9/commit/d67743b88a9e9680652405077eca323910119846", "committedDate": "2020-05-06T18:26:36Z", "message": "Java 15 BufferPool class has moved to a different package\n\n[ci skip]\n\nSigned-off-by: Peter Shipton <Peter_Shipton@ca.ibm.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "4ef53540c99199cbd7f3f397924c16d533f357fe", "author": {"user": {"login": "pshipton", "name": "Peter Shipton"}}, "url": "https://github.com/eclipse-openj9/openj9/commit/4ef53540c99199cbd7f3f397924c16d533f357fe", "committedDate": "2020-05-06T18:26:38Z", "message": "Update Java 15 JVM_ Module functions parameters\n\nRelated to 8242452: During module definition, move conversion of\npackages from native to VM\n\nThe signature of JVM_DefineModule has been modified from `..., const\nchar* const* packages, jsize numPackages` to `..., jobjectArray\npackages`.\n\nAlso the package parameter of following has been modified from char* to\njstring.\nJVM_AddModuleExports\nJVM_AddModuleExportsToAllUnnamed\nJVM_AddModuleExportsToAll\n\nFixes #9293\n\nSigned-off-by: Peter Shipton <Peter_Shipton@ca.ibm.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "779f063b73d2f8269164c9bd06866669fbe8ec8d", "author": {"user": {"login": "pshipton", "name": "Peter Shipton"}}, "url": "https://github.com/eclipse-openj9/openj9/commit/779f063b73d2f8269164c9bd06866669fbe8ec8d", "committedDate": "2020-05-06T18:26:39Z", "message": "Java 15 - stub in hidden class support\n\n[ci skip]\n\nSigned-off-by: Peter Shipton <Peter_Shipton@ca.ibm.com>"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDA3NjYzMDk0", "url": "https://github.com/eclipse-openj9/openj9/pull/9485#pullrequestreview-407663094", "createdAt": "2020-05-07T16:58:49Z", "commit": {"oid": "171e3665ca4ef2c5da77cafbd7293d9718f22744"}, "state": "COMMENTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wN1QxNjo1ODo0OVrOGSHvgw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wN1QxNjo1OToyNVrOGSHxAQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMTY1NDQwMw==", "bodyText": "Please add extra parentheses here and in similar tests on lines 391 amd 405.", "url": "https://github.com/eclipse-openj9/openj9/pull/9485#discussion_r421654403", "createdAt": "2020-05-07T16:58:49Z", "author": {"login": "keithc-ca"}, "path": "jcl/src/java.base/share/classes/java/lang/invoke/MethodHandles.java", "diffHunk": "@@ -369,7 +369,7 @@ private static boolean isSamePackage(Class<?> a, Class<?> b){\n \t\t}\n \t\t\n \t\tvoid checkAccess(MethodHandle handle, boolean skipAccessCheckPara) throws IllegalAccessException {\n-\t\t\tif (INTERNAL_PRIVILEGED == accessMode) {\n+\t\t\tif (INTERNAL_PRIVILEGED == accessMode || FULL_ACCESS_MASK == accessMode) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "171e3665ca4ef2c5da77cafbd7293d9718f22744"}, "originalPosition": 5}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMTY1NDc4NQ==", "bodyText": "Please remove the unnecessary initialization.", "url": "https://github.com/eclipse-openj9/openj9/pull/9485#discussion_r421654785", "createdAt": "2020-05-07T16:59:25Z", "author": {"login": "keithc-ca"}, "path": "jcl/src/java.base/share/classes/java/lang/invoke/MethodHandles.java", "diffHunk": "@@ -2256,17 +2256,38 @@ public boolean hasFullPrivilegeAccess() {\n \t\t}\n \n \t\tstatic class ClassDefiner {\n-\t\t\tClass<?> defineClass(boolean option) {\n-\t\t\t\treturn null;\n+\t\t\tprivate byte[] classBytes;\n+\t\t\tprivate String className;\n+\t\t\tprivate Lookup lookup;\n+\t\t\tClassDefiner(String name, byte[] template, Lookup lookupObj) {\n+\t\t\t\tclassName = name;\n+\t\t\t\tclassBytes = template;\n+\t\t\t\tlookup = lookupObj;\n+\t\t\t}\n+\t\t\tClass<?> defineClass(boolean initOption) {\n+\t\t\t\tJavaLangAccess jlAccess = SharedSecrets.getJavaLangAccess();\n+\t\t\t\tClass<?> lookupClass = lookup.lookupClass();\n+\t\t\t\treturn jlAccess.defineClass(lookupClass.getClassLoader(), lookupClass, className, classBytes, jlAccess.protectionDomain(lookupClass), initOption, 0, null);\n \t\t\t}\n \t\t}\n \n \t\tpublic Lookup defineHiddenClass(byte[] bytes, boolean initOption, ClassOption... classOptions) {\n-\t\t\treturn null;\n+\t\t\tClassReader cr = null;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "171e3665ca4ef2c5da77cafbd7293d9718f22744"}, "originalPosition": 50}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDA3NjY2Njky", "url": "https://github.com/eclipse-openj9/openj9/pull/9485#pullrequestreview-407666692", "createdAt": "2020-05-07T17:03:27Z", "commit": {"oid": "171e3665ca4ef2c5da77cafbd7293d9718f22744"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wN1QxNzowMzoyOFrOGSH61Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wN1QxNzowMzoyOFrOGSH61Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMTY1NzMwMQ==", "bodyText": "The class and all its fields should be final.", "url": "https://github.com/eclipse-openj9/openj9/pull/9485#discussion_r421657301", "createdAt": "2020-05-07T17:03:28Z", "author": {"login": "keithc-ca"}, "path": "jcl/src/java.base/share/classes/java/lang/invoke/MethodHandles.java", "diffHunk": "@@ -2256,17 +2256,38 @@ public boolean hasFullPrivilegeAccess() {\n \t\t}\n \n \t\tstatic class ClassDefiner {\n-\t\t\tClass<?> defineClass(boolean option) {\n-\t\t\t\treturn null;\n+\t\t\tprivate byte[] classBytes;\n+\t\t\tprivate String className;\n+\t\t\tprivate Lookup lookup;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "171e3665ca4ef2c5da77cafbd7293d9718f22744"}, "originalPosition": 35}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "171e3665ca4ef2c5da77cafbd7293d9718f22744", "author": {"user": {"login": "hangshao0", "name": "Hang Shao"}}, "url": "https://github.com/eclipse-openj9/openj9/commit/171e3665ca4ef2c5da77cafbd7293d9718f22744", "committedDate": "2020-05-07T16:04:59Z", "message": "Use Unsafe.defineAnonyousClass() to define Hidden classes.\n\nAdd implementation of new Hidden class APIs to unblock the JDK15 builds.\n\nissue #9328\n\nSigned-off-by: Hang Shao <hangshao@ca.ibm.com>"}, "afterCommit": {"oid": "d819802c70261667a2876cbd9aaa3b0302e2ee3f", "author": {"user": {"login": "hangshao0", "name": "Hang Shao"}}, "url": "https://github.com/eclipse-openj9/openj9/commit/d819802c70261667a2876cbd9aaa3b0302e2ee3f", "committedDate": "2020-05-07T18:10:55Z", "message": "Use Unsafe.defineAnonyousClass() to define Hidden classes.\n\nAdd implementation of new Hidden class APIs to unblock the JDK15 builds.\n\nissue #9328\n\nSigned-off-by: Hang Shao <hangshao@ca.ibm.com>"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDA3NzI3MTc5", "url": "https://github.com/eclipse-openj9/openj9/pull/9485#pullrequestreview-407727179", "createdAt": "2020-05-07T18:25:21Z", "commit": {"oid": "d819802c70261667a2876cbd9aaa3b0302e2ee3f"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wN1QxODoyNToyMVrOGSK4rw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wN1QxODoyNToyMVrOGSK4rw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMTcwNTkwMw==", "bodyText": "This should be defined in jcl/src/java.base/share/classes/com/ibm/oti/util/ExternalMessages-MasterIndex.properties.", "url": "https://github.com/eclipse-openj9/openj9/pull/9485#discussion_r421705903", "createdAt": "2020-05-07T18:25:21Z", "author": {"login": "pshipton"}, "path": "jcl/src/java.base/share/classes/java/lang/invoke/MethodHandles.java", "diffHunk": "@@ -2255,18 +2261,39 @@ public boolean hasFullPrivilegeAccess() {\n \t\t\tSTRONG\n \t\t}\n \n-\t\tstatic class ClassDefiner {\n-\t\t\tClass<?> defineClass(boolean option) {\n-\t\t\t\treturn null;\n+\t\tstatic final class ClassDefiner {\n+\t\t\tprivate final byte[] classBytes;\n+\t\t\tprivate final String className;\n+\t\t\tprivate final Lookup lookup;\n+\t\t\tClassDefiner(String name, byte[] template, Lookup lookupObj) {\n+\t\t\t\tclassName = name;\n+\t\t\t\tclassBytes = template;\n+\t\t\t\tlookup = lookupObj;\n+\t\t\t}\n+\t\t\tClass<?> defineClass(boolean initOption) {\n+\t\t\t\tJavaLangAccess jlAccess = SharedSecrets.getJavaLangAccess();\n+\t\t\t\tClass<?> lookupClass = lookup.lookupClass();\n+\t\t\t\treturn jlAccess.defineClass(lookupClass.getClassLoader(), lookupClass, className, classBytes, jlAccess.protectionDomain(lookupClass), initOption, 0, null);\n \t\t\t}\n \t\t}\n \n \t\tpublic Lookup defineHiddenClass(byte[] bytes, boolean initOption, ClassOption... classOptions) {\n-\t\t\treturn null;\n+\t\t\tClassReader cr;\n+\t\t\ttry {\n+\t\t\t\tcr = new ClassReader(bytes);\n+\t\t\t} catch (ArrayIndexOutOfBoundsException e) {\n+\t\t\t\t/*[MSG \"K065Y2\", \"The class byte array is corrupted\"]*/", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d819802c70261667a2876cbd9aaa3b0302e2ee3f"}, "originalPosition": 62}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDA5NzA4NDcz", "url": "https://github.com/eclipse-openj9/openj9/pull/9485#pullrequestreview-409708473", "createdAt": "2020-05-12T05:29:46Z", "commit": {"oid": "d819802c70261667a2876cbd9aaa3b0302e2ee3f"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xMlQwNToyOTo0N1rOGT2lvQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xMlQwNToyOTo0N1rOGT2lvQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMzQ3MDUyNQ==", "bodyText": "@hangshao0 pls wrap this in an AccessController.doPrivileged() to fix some of the test failures.", "url": "https://github.com/eclipse-openj9/openj9/pull/9485#discussion_r423470525", "createdAt": "2020-05-12T05:29:47Z", "author": {"login": "pshipton"}, "path": "jcl/src/java.base/share/classes/java/lang/invoke/MethodHandles.java", "diffHunk": "@@ -2255,18 +2261,39 @@ public boolean hasFullPrivilegeAccess() {\n \t\t\tSTRONG\n \t\t}\n \n-\t\tstatic class ClassDefiner {\n-\t\t\tClass<?> defineClass(boolean option) {\n-\t\t\t\treturn null;\n+\t\tstatic final class ClassDefiner {\n+\t\t\tprivate final byte[] classBytes;\n+\t\t\tprivate final String className;\n+\t\t\tprivate final Lookup lookup;\n+\t\t\tClassDefiner(String name, byte[] template, Lookup lookupObj) {\n+\t\t\t\tclassName = name;\n+\t\t\t\tclassBytes = template;\n+\t\t\t\tlookup = lookupObj;\n+\t\t\t}\n+\t\t\tClass<?> defineClass(boolean initOption) {\n+\t\t\t\tJavaLangAccess jlAccess = SharedSecrets.getJavaLangAccess();\n+\t\t\t\tClass<?> lookupClass = lookup.lookupClass();\n+\t\t\t\treturn jlAccess.defineClass(lookupClass.getClassLoader(), lookupClass, className, classBytes, jlAccess.protectionDomain(lookupClass), initOption, 0, null);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d819802c70261667a2876cbd9aaa3b0302e2ee3f"}, "originalPosition": 52}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDEwMDA4NzU1", "url": "https://github.com/eclipse-openj9/openj9/pull/9485#pullrequestreview-410008755", "createdAt": "2020-05-12T12:53:39Z", "commit": {"oid": "d819802c70261667a2876cbd9aaa3b0302e2ee3f"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xMlQxMjo1MzozOVrOGUFGRg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xMlQxMjo1MzozOVrOGUFGRg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMzcwODIzMA==", "bodyText": "Seems adding this is causing a number of test suite failures, even in jdk11.\nhttps://ci.eclipse.org/openj9/job/Test_openjdk11_j9_sanity.functional_s390x_linux_Personal/413", "url": "https://github.com/eclipse-openj9/openj9/pull/9485#discussion_r423708230", "createdAt": "2020-05-12T12:53:39Z", "author": {"login": "pshipton"}, "path": "jcl/src/java.base/share/classes/java/lang/invoke/MethodHandles.java", "diffHunk": "@@ -369,7 +369,9 @@ private static boolean isSamePackage(Class<?> a, Class<?> b){\n \t\t}\n \t\t\n \t\tvoid checkAccess(MethodHandle handle, boolean skipAccessCheckPara) throws IllegalAccessException {\n-\t\t\tif (INTERNAL_PRIVILEGED == accessMode) {\n+\t\t\tif ((INTERNAL_PRIVILEGED == accessMode)\n+\t\t\t\t|| (FULL_ACCESS_MASK == accessMode)", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d819802c70261667a2876cbd9aaa3b0302e2ee3f"}, "originalPosition": 6}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "d819802c70261667a2876cbd9aaa3b0302e2ee3f", "author": {"user": {"login": "hangshao0", "name": "Hang Shao"}}, "url": "https://github.com/eclipse-openj9/openj9/commit/d819802c70261667a2876cbd9aaa3b0302e2ee3f", "committedDate": "2020-05-07T18:10:55Z", "message": "Use Unsafe.defineAnonyousClass() to define Hidden classes.\n\nAdd implementation of new Hidden class APIs to unblock the JDK15 builds.\n\nissue #9328\n\nSigned-off-by: Hang Shao <hangshao@ca.ibm.com>"}, "afterCommit": {"oid": "f4f8499a80154cdab447f1a798c01781a2f91452", "author": {"user": {"login": "hangshao0", "name": "Hang Shao"}}, "url": "https://github.com/eclipse-openj9/openj9/commit/f4f8499a80154cdab447f1a798c01781a2f91452", "committedDate": "2020-05-12T22:16:06Z", "message": "Use Unsafe.defineAnonyousClass() to define Hidden classes.\n\nAdd implementation of new Hidden class APIs to unblock the JDK15 builds.\n\nissue #9328\n\nSigned-off-by: Hang Shao <hangshao@ca.ibm.com>"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "f4f8499a80154cdab447f1a798c01781a2f91452", "author": {"user": {"login": "hangshao0", "name": "Hang Shao"}}, "url": "https://github.com/eclipse-openj9/openj9/commit/f4f8499a80154cdab447f1a798c01781a2f91452", "committedDate": "2020-05-12T22:16:06Z", "message": "Use Unsafe.defineAnonyousClass() to define Hidden classes.\n\nAdd implementation of new Hidden class APIs to unblock the JDK15 builds.\n\nissue #9328\n\nSigned-off-by: Hang Shao <hangshao@ca.ibm.com>"}, "afterCommit": {"oid": "dab142323c228b28f3ff65915c6af38a1962cb9c", "author": {"user": {"login": "hangshao0", "name": "Hang Shao"}}, "url": "https://github.com/eclipse-openj9/openj9/commit/dab142323c228b28f3ff65915c6af38a1962cb9c", "committedDate": "2020-05-12T22:28:38Z", "message": "Use Unsafe.defineAnonyousClass() to define Hidden classes.\n\nAdd implementation of new Hidden class APIs to unblock the JDK15 builds.\n\nissue #9328\n\nSigned-off-by: Hang Shao <hangshao@ca.ibm.com>"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDExMDg2ODQ1", "url": "https://github.com/eclipse-openj9/openj9/pull/9485#pullrequestreview-411086845", "createdAt": "2020-05-13T16:15:34Z", "commit": {"oid": "dab142323c228b28f3ff65915c6af38a1962cb9c"}, "state": "COMMENTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xM1QxNjoxNTozNFrOGU5TEg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xM1QxNjoyMTozNFrOGU5iZA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNDU2MzQ3NA==", "bodyText": "This local could be pushed before, and reused in, the declaration of vmFuncs.", "url": "https://github.com/eclipse-openj9/openj9/pull/9485#discussion_r424563474", "createdAt": "2020-05-13T16:15:34Z", "author": {"login": "keithc-ca"}, "path": "runtime/jcl/common/java_lang_Class.cpp", "diffHunk": "@@ -1805,13 +1805,26 @@ Java_java_lang_Class_getNestHostImpl(JNIEnv *env, jobject recv)\n \tJ9Class *nestHost = clazz->nestHost;\n \n \tif (NULL == nestHost) {\n-\t\tif (J9_VISIBILITY_ALLOWED == vmFuncs->loadAndVerifyNestHost(currentThread, clazz, J9_LOOK_NO_THROW)) {\n-\t\t\tnestHost = clazz->nestHost;\n+\t\tJ9Class *clazzToUse = clazz;\n+\t\tJ9JavaVM *vm = currentThread->javaVM;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "dab142323c228b28f3ff65915c6af38a1962cb9c"}, "originalPosition": 7}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNDU2NzM5Ng==", "bodyText": "Why not #if JAVA_SPEC_VERSION >= 15 instead of runtime check?", "url": "https://github.com/eclipse-openj9/openj9/pull/9485#discussion_r424567396", "createdAt": "2020-05-13T16:21:34Z", "author": {"login": "keithc-ca"}, "path": "runtime/jcl/common/java_lang_Class.cpp", "diffHunk": "@@ -1805,13 +1805,26 @@ Java_java_lang_Class_getNestHostImpl(JNIEnv *env, jobject recv)\n \tJ9Class *nestHost = clazz->nestHost;\n \n \tif (NULL == nestHost) {\n-\t\tif (J9_VISIBILITY_ALLOWED == vmFuncs->loadAndVerifyNestHost(currentThread, clazz, J9_LOOK_NO_THROW)) {\n-\t\t\tnestHost = clazz->nestHost;\n+\t\tJ9Class *clazzToUse = clazz;\n+\t\tJ9JavaVM *vm = currentThread->javaVM;\n+\t\tif (J2SE_VERSION(vm) >= J2SE_V15) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "dab142323c228b28f3ff65915c6af38a1962cb9c"}, "originalPosition": 8}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "9d734583e83f1df12e0c082b1200ecc0aae06877", "author": {"user": {"login": "hangshao0", "name": "Hang Shao"}}, "url": "https://github.com/eclipse-openj9/openj9/commit/9d734583e83f1df12e0c082b1200ecc0aae06877", "committedDate": "2020-05-13T18:17:28Z", "message": "Use Unsafe.defineAnonyousClass() to define Hidden classes.\n\nAdd implementation of new Hidden class APIs to unblock the JDK15 builds.\n\nissue #9328\n\nSigned-off-by: Hang Shao <hangshao@ca.ibm.com>"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "dab142323c228b28f3ff65915c6af38a1962cb9c", "author": {"user": {"login": "hangshao0", "name": "Hang Shao"}}, "url": "https://github.com/eclipse-openj9/openj9/commit/dab142323c228b28f3ff65915c6af38a1962cb9c", "committedDate": "2020-05-12T22:28:38Z", "message": "Use Unsafe.defineAnonyousClass() to define Hidden classes.\n\nAdd implementation of new Hidden class APIs to unblock the JDK15 builds.\n\nissue #9328\n\nSigned-off-by: Hang Shao <hangshao@ca.ibm.com>"}, "afterCommit": {"oid": "9d734583e83f1df12e0c082b1200ecc0aae06877", "author": {"user": {"login": "hangshao0", "name": "Hang Shao"}}, "url": "https://github.com/eclipse-openj9/openj9/commit/9d734583e83f1df12e0c082b1200ecc0aae06877", "committedDate": "2020-05-13T18:17:28Z", "message": "Use Unsafe.defineAnonyousClass() to define Hidden classes.\n\nAdd implementation of new Hidden class APIs to unblock the JDK15 builds.\n\nissue #9328\n\nSigned-off-by: Hang Shao <hangshao@ca.ibm.com>"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDExNDIyMjgw", "url": "https://github.com/eclipse-openj9/openj9/pull/9485#pullrequestreview-411422280", "createdAt": "2020-05-14T02:23:47Z", "commit": {"oid": "9d734583e83f1df12e0c082b1200ecc0aae06877"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDExODc4OTAy", "url": "https://github.com/eclipse-openj9/openj9/pull/9485#pullrequestreview-411878902", "createdAt": "2020-05-14T14:45:06Z", "commit": {"oid": "9d734583e83f1df12e0c082b1200ecc0aae06877"}, "state": "COMMENTED", "comments": {"totalCount": 9, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xNFQxNDo0NTowNlrOGVfwhw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xNFQxNTo1Mzo1NVrOGVi8RA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNTE5MzYwNw==", "bodyText": "This needs javadoc", "url": "https://github.com/eclipse-openj9/openj9/pull/9485#discussion_r425193607", "createdAt": "2020-05-14T14:45:06Z", "author": {"login": "DanHeidinga"}, "path": "jcl/src/java.base/share/classes/java/lang/invoke/MethodHandles.java", "diffHunk": "@@ -2245,7 +2246,57 @@ public boolean hasFullPrivilegeAccess() {\n \t\t\treturn (!isWeakenedLookup() && (MODULE == (accessMode & MODULE)));\n \t\t}\n \t\t/*[ENDIF] Java14*/\n-\t\t/*[ENDIF]*/\n+\t\t/*[ENDIF] Sidecar19-SE */\n+\t\t\n+\t\t/*[IF Java15]*/\n+\t\t// TODO: implement support for hidden classes.\n+\n+\t\tpublic enum ClassOption {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "9d734583e83f1df12e0c082b1200ecc0aae06877"}, "originalPosition": 27}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNTE5MzcxMw==", "bodyText": "this needs javadoc", "url": "https://github.com/eclipse-openj9/openj9/pull/9485#discussion_r425193713", "createdAt": "2020-05-14T14:45:15Z", "author": {"login": "DanHeidinga"}, "path": "jcl/src/java.base/share/classes/java/lang/invoke/MethodHandles.java", "diffHunk": "@@ -2245,7 +2246,57 @@ public boolean hasFullPrivilegeAccess() {\n \t\t\treturn (!isWeakenedLookup() && (MODULE == (accessMode & MODULE)));\n \t\t}\n \t\t/*[ENDIF] Java14*/\n-\t\t/*[ENDIF]*/\n+\t\t/*[ENDIF] Sidecar19-SE */\n+\t\t\n+\t\t/*[IF Java15]*/\n+\t\t// TODO: implement support for hidden classes.\n+\n+\t\tpublic enum ClassOption {\n+\t\t\tNESTMATE,\n+\t\t\tSTRONG\n+\t\t}\n+\n+\t\tstatic final class ClassDefiner {\n+\t\t\tprivate final byte[] classBytes;\n+\t\t\tprivate final String className;\n+\t\t\tprivate final Lookup lookup;\n+\t\t\tClassDefiner(String name, byte[] template, Lookup lookupObj) {\n+\t\t\t\tclassName = name;\n+\t\t\t\tclassBytes = template;\n+\t\t\t\tlookup = lookupObj;\n+\t\t\t}\n+\t\t\tClass<?> defineClass(boolean initOption) {\n+\t\t\t\tClass<?> ret = AccessController.doPrivileged(new PrivilegedAction<Class<?>>() {\n+\t\t\t\t\t@Override\n+\t\t\t\t\tpublic Class<?> run() {\n+\t\t\t\t\t\tJavaLangAccess jlAccess = SharedSecrets.getJavaLangAccess();\n+\t\t\t\t\t\tClass<?> lookupClass = lookup.lookupClass();\n+\t\t\t\t\t\treturn jlAccess.defineClass(lookupClass.getClassLoader(), lookupClass, className, classBytes, jlAccess.protectionDomain(lookupClass), initOption, 0, null);\n+\t\t\t\t\t}\n+\t\t\t\t});\n+\t\t\t\treturn ret;\n+\t\t\t}\n+\t\t}\n+\n+\t\tpublic Lookup defineHiddenClass(byte[] bytes, boolean initOption, ClassOption... classOptions) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "9d734583e83f1df12e0c082b1200ecc0aae06877"}, "originalPosition": 54}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNTE5NTI3MQ==", "bodyText": "And I assume classOptions will be used later in the complete implementation?", "url": "https://github.com/eclipse-openj9/openj9/pull/9485#discussion_r425195271", "createdAt": "2020-05-14T14:47:16Z", "author": {"login": "DanHeidinga"}, "path": "jcl/src/java.base/share/classes/java/lang/invoke/MethodHandles.java", "diffHunk": "@@ -2245,7 +2246,57 @@ public boolean hasFullPrivilegeAccess() {\n \t\t\treturn (!isWeakenedLookup() && (MODULE == (accessMode & MODULE)));\n \t\t}\n \t\t/*[ENDIF] Java14*/\n-\t\t/*[ENDIF]*/\n+\t\t/*[ENDIF] Sidecar19-SE */\n+\t\t\n+\t\t/*[IF Java15]*/\n+\t\t// TODO: implement support for hidden classes.\n+\n+\t\tpublic enum ClassOption {\n+\t\t\tNESTMATE,\n+\t\t\tSTRONG\n+\t\t}\n+\n+\t\tstatic final class ClassDefiner {\n+\t\t\tprivate final byte[] classBytes;\n+\t\t\tprivate final String className;\n+\t\t\tprivate final Lookup lookup;\n+\t\t\tClassDefiner(String name, byte[] template, Lookup lookupObj) {\n+\t\t\t\tclassName = name;\n+\t\t\t\tclassBytes = template;\n+\t\t\t\tlookup = lookupObj;\n+\t\t\t}\n+\t\t\tClass<?> defineClass(boolean initOption) {\n+\t\t\t\tClass<?> ret = AccessController.doPrivileged(new PrivilegedAction<Class<?>>() {\n+\t\t\t\t\t@Override\n+\t\t\t\t\tpublic Class<?> run() {\n+\t\t\t\t\t\tJavaLangAccess jlAccess = SharedSecrets.getJavaLangAccess();\n+\t\t\t\t\t\tClass<?> lookupClass = lookup.lookupClass();\n+\t\t\t\t\t\treturn jlAccess.defineClass(lookupClass.getClassLoader(), lookupClass, className, classBytes, jlAccess.protectionDomain(lookupClass), initOption, 0, null);\n+\t\t\t\t\t}\n+\t\t\t\t});\n+\t\t\t\treturn ret;\n+\t\t\t}\n+\t\t}\n+\n+\t\tpublic Lookup defineHiddenClass(byte[] bytes, boolean initOption, ClassOption... classOptions) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNTE5MzcxMw=="}, "originalCommit": {"oid": "9d734583e83f1df12e0c082b1200ecc0aae06877"}, "originalPosition": 54}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNTIzMzQ1MQ==", "bodyText": "isCopy is an output parameter.  This code needs to handle the case where the string isn't a copy", "url": "https://github.com/eclipse-openj9/openj9/pull/9485#discussion_r425233451", "createdAt": "2020-05-14T15:37:17Z", "author": {"login": "DanHeidinga"}, "path": "runtime/j9vm/java11vmi.c", "diffHunk": "@@ -710,18 +730,80 @@ allowReadAccessToModule(J9VMThread * currentThread, J9Module * fromModule, J9Mod\n  * @return If successful, returns a java.lang.reflect.Module object. Otherwise, returns NULL.\n  */\n jobject JNICALL\n+#if JAVA_SPEC_VERSION >= 15\n+JVM_DefineModule(JNIEnv * env, jobject module, jboolean isOpen, jstring version, jstring location, jobjectArray packageArray)\n+#else\n JVM_DefineModule(JNIEnv * env, jobject module, jboolean isOpen, jstring version, jstring location, const char* const* packages, jsize numPackages)\n+#endif /* JAVA_SPEC_VERSION >= 15 */\n {\n \tJ9VMThread * const currentThread = (J9VMThread*)env;\n \tJ9JavaVM * vm = currentThread->javaVM;\n \tJ9InternalVMFunctions const * const vmFuncs = vm->internalVMFunctions;\n+#if JAVA_SPEC_VERSION >= 15\n+\tBOOLEAN oom = FALSE;\n+\tBOOLEAN nullPackage = FALSE;\n+\tjsize numPackages = (NULL == packageArray) ? 0 : (*env)->GetArrayLength(env, packageArray);\n+\tPORT_ACCESS_FROM_ENV(env);\n+\tUDATA packagesNumBytes = sizeof(char*) * numPackages;\n+\tconst char* * packages = (const char* *)j9mem_allocate_memory(packagesNumBytes, OMRMEM_CATEGORY_VM);\n+\tif ((*env)->ExceptionCheck(env)) {\n+\t\tgoto cleanup;\n+\t}\n+\n+\tif (NULL != packages) {\n+\t\tjsize pkgIndex = 0;\n+\t\tmemset((void *)packages, 0, packagesNumBytes);\n+\t\tfor (pkgIndex = 0; pkgIndex < numPackages; pkgIndex++) {\n+\t\t\tjobject packageObj = (*env)->GetObjectArrayElement(env, packageArray, pkgIndex);\n+\t\t\tif ((*env)->ExceptionCheck(env)) {\n+\t\t\t\tAssert_SC_unreachable();\n+\t\t\t\tgoto cleanup;\n+\t\t\t}\n+\t\t\tif (NULL != packageObj) {\n+\t\t\t\tjboolean isCopy = JNI_FALSE;\n+\t\t\t\tconst char* packageName = (*env)->GetStringUTFChars(env, packageObj, &isCopy);\n+\t\t\t\t(*env)->DeleteLocalRef(env, packageObj);\n+\n+\t\t\t\tif (NULL == packageName) {\n+\t\t\t\t\toom = TRUE;\n+\t\t\t\t\tbreak;\n+\t\t\t\t}\n+\t\t\t\tif (JNI_FALSE == isCopy) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "9d734583e83f1df12e0c082b1200ecc0aae06877"}, "originalPosition": 76}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNTI0MzQ2OQ==", "bodyText": "It would be more efficient to get vm access earlier and do this with VM calls rather than JNI.  It would also remove the need to assert on the isCopy above by using the copyStringToUTF8Helper helper", "url": "https://github.com/eclipse-openj9/openj9/pull/9485#discussion_r425243469", "createdAt": "2020-05-14T15:50:47Z", "author": {"login": "DanHeidinga"}, "path": "runtime/j9vm/java11vmi.c", "diffHunk": "@@ -710,18 +730,80 @@ allowReadAccessToModule(J9VMThread * currentThread, J9Module * fromModule, J9Mod\n  * @return If successful, returns a java.lang.reflect.Module object. Otherwise, returns NULL.\n  */\n jobject JNICALL\n+#if JAVA_SPEC_VERSION >= 15\n+JVM_DefineModule(JNIEnv * env, jobject module, jboolean isOpen, jstring version, jstring location, jobjectArray packageArray)\n+#else\n JVM_DefineModule(JNIEnv * env, jobject module, jboolean isOpen, jstring version, jstring location, const char* const* packages, jsize numPackages)\n+#endif /* JAVA_SPEC_VERSION >= 15 */\n {\n \tJ9VMThread * const currentThread = (J9VMThread*)env;\n \tJ9JavaVM * vm = currentThread->javaVM;\n \tJ9InternalVMFunctions const * const vmFuncs = vm->internalVMFunctions;\n+#if JAVA_SPEC_VERSION >= 15\n+\tBOOLEAN oom = FALSE;\n+\tBOOLEAN nullPackage = FALSE;\n+\tjsize numPackages = (NULL == packageArray) ? 0 : (*env)->GetArrayLength(env, packageArray);\n+\tPORT_ACCESS_FROM_ENV(env);\n+\tUDATA packagesNumBytes = sizeof(char*) * numPackages;\n+\tconst char* * packages = (const char* *)j9mem_allocate_memory(packagesNumBytes, OMRMEM_CATEGORY_VM);\n+\tif ((*env)->ExceptionCheck(env)) {\n+\t\tgoto cleanup;\n+\t}\n+\n+\tif (NULL != packages) {\n+\t\tjsize pkgIndex = 0;\n+\t\tmemset((void *)packages, 0, packagesNumBytes);\n+\t\tfor (pkgIndex = 0; pkgIndex < numPackages; pkgIndex++) {\n+\t\t\tjobject packageObj = (*env)->GetObjectArrayElement(env, packageArray, pkgIndex);\n+\t\t\tif ((*env)->ExceptionCheck(env)) {\n+\t\t\t\tAssert_SC_unreachable();\n+\t\t\t\tgoto cleanup;\n+\t\t\t}\n+\t\t\tif (NULL != packageObj) {\n+\t\t\t\tjboolean isCopy = JNI_FALSE;\n+\t\t\t\tconst char* packageName = (*env)->GetStringUTFChars(env, packageObj, &isCopy);\n+\t\t\t\t(*env)->DeleteLocalRef(env, packageObj);\n+\n+\t\t\t\tif (NULL == packageName) {\n+\t\t\t\t\toom = TRUE;\n+\t\t\t\t\tbreak;\n+\t\t\t\t}\n+\t\t\t\tif (JNI_FALSE == isCopy) {\n+\t\t\t\t\tAssert_SC_unreachable();\n+\t\t\t\t\tgoto cleanup;\n+\t\t\t\t}\n+\t\t\t\tconvertPackageName((char*)packageName);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "9d734583e83f1df12e0c082b1200ecc0aae06877"}, "originalPosition": 80}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNTI0MzkwNQ==", "bodyText": "same here - keep vm access and use the vm helpers rather than JNI", "url": "https://github.com/eclipse-openj9/openj9/pull/9485#discussion_r425243905", "createdAt": "2020-05-14T15:51:23Z", "author": {"login": "DanHeidinga"}, "path": "runtime/j9vm/java11vmi.c", "diffHunk": "@@ -851,6 +933,29 @@ JVM_DefineModule(JNIEnv * env, jobject module, jboolean isOpen, jstring version,\n #endif /* defined(CALL_BUNDLED_FUNCTIONS_DIRECTLY) */\n \tvmFuncs->internalExitVMToJNI(currentThread);\n \n+#if JAVA_SPEC_VERSION >= 15\n+cleanup:\n+\tif (NULL != packages) {\n+\t\tjsize pkgIndex = 0;\n+\t\tfor (pkgIndex = 0; pkgIndex < numPackages; pkgIndex++) {\n+\t\t\tjobject packageObj = NULL;\n+\t\t\tconst char* packageName = packages[pkgIndex];\n+\t\t\tif (NULL == packageName) {\n+\t\t\t\tbreak;\n+\t\t\t}\n+\n+\t\t\tpackageObj = (*env)->GetObjectArrayElement(env, packageArray, pkgIndex);\n+\t\t\tif ((*env)->ExceptionCheck(env)) {\n+\t\t\t\tAssert_SC_unreachable();\n+\t\t\t\tbreak;\n+\t\t\t}\n+\t\t\t(*env)->ReleaseStringUTFChars(env, packageObj, packageName);\n+\t\t\t(*env)->DeleteLocalRef(env, packageObj);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "9d734583e83f1df12e0c082b1200ecc0aae06877"}, "originalPosition": 136}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNTI0NDM4MA==", "bodyText": "This should also move after getting vm access and use the copyStringToUTF8Helper helper.  Note, there's an J9_STR_XLAT flag that does the . -> / conversion", "url": "https://github.com/eclipse-openj9/openj9/pull/9485#discussion_r425244380", "createdAt": "2020-05-14T15:52:02Z", "author": {"login": "DanHeidinga"}, "path": "runtime/j9vm/java11vmi.c", "diffHunk": "@@ -866,19 +971,46 @@ JVM_DefineModule(JNIEnv * env, jobject module, jboolean isOpen, jstring version,\n  * 4) Package is not defined for fromModule's class loader\n  * 5) Package is not in module fromModule.\n  */\n+#if JAVA_SPEC_VERSION >= 15\n+void JNICALL\n+JVM_AddModuleExports(JNIEnv * env, jobject fromModule, jstring packageObj, jobject toModule)\n+#else\n void JNICALL\n JVM_AddModuleExports(JNIEnv * env, jobject fromModule, const char *package, jobject toModule)\n+#endif /* JAVA_SPEC_VERSION >= 15 */\n {\n \tJ9VMThread * const currentThread = (J9VMThread*)env;\n \tJ9JavaVM const * const vm = currentThread->javaVM;\n \tJ9InternalVMFunctions const * const vmFuncs = vm->internalVMFunctions;\n+#if JAVA_SPEC_VERSION >= 15\n+\tjboolean isCopy = JNI_FALSE;\n+\tconst char* package = (NULL == packageObj) ? NULL : (*env)->GetStringUTFChars(env, packageObj, &isCopy);\n+\tif ((NULL != package) && (JNI_FALSE == isCopy)) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "9d734583e83f1df12e0c082b1200ecc0aae06877"}, "originalPosition": 163}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNTI0NTU2Mw==", "bodyText": "same here as well", "url": "https://github.com/eclipse-openj9/openj9/pull/9485#discussion_r425245563", "createdAt": "2020-05-14T15:53:38Z", "author": {"login": "DanHeidinga"}, "path": "runtime/j9vm/java11vmi.c", "diffHunk": "@@ -913,19 +1056,46 @@ JVM_AddModuleExports(JNIEnv * env, jobject fromModule, const char *package, jobj\n  * 3) Package is not defined for fromModule's class loader\n  * 4) Package is not in module fromModule.\n  */\n+#if JAVA_SPEC_VERSION >= 15\n+void JNICALL\n+JVM_AddModuleExportsToAll(JNIEnv * env, jobject fromModule, jstring packageObj)\n+#else\n void JNICALL\n JVM_AddModuleExportsToAll(JNIEnv * env, jobject fromModule, const char *package)\n+#endif /* JAVA_SPEC_VERSION >= 15 */\n {\n \tJ9VMThread * const currentThread = (J9VMThread*)env;\n \tJ9JavaVM const * const vm = currentThread->javaVM;\n \tJ9InternalVMFunctions const * const vmFuncs = vm->internalVMFunctions;\n+#if JAVA_SPEC_VERSION >= 15\n+\tjboolean isCopy = JNI_FALSE;\n+\tconst char* package = (NULL == packageObj) ? NULL : (*env)->GetStringUTFChars(env, packageObj, &isCopy);\n+\tif ((NULL != package) && (JNI_FALSE == isCopy)) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "9d734583e83f1df12e0c082b1200ecc0aae06877"}, "originalPosition": 234}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNTI0NTc2NA==", "bodyText": "and here", "url": "https://github.com/eclipse-openj9/openj9/pull/9485#discussion_r425245764", "createdAt": "2020-05-14T15:53:55Z", "author": {"login": "DanHeidinga"}, "path": "runtime/j9vm/java11vmi.c", "diffHunk": "@@ -1142,19 +1323,46 @@ JVM_AddModulePackage(JNIEnv * env, jobject module, const char *package)\n  * 2) module is unnamed or\n  * 3) package is not in module\n  */\n+#if JAVA_SPEC_VERSION >= 15\n+void JNICALL\n+JVM_AddModuleExportsToAllUnnamed(JNIEnv * env, jobject fromModule, jstring packageObj)\n+#else\n void JNICALL\n JVM_AddModuleExportsToAllUnnamed(JNIEnv * env, jobject fromModule, const char *package)\n+#endif /* JAVA_SPEC_VERSION >= 15 */\n {\n \tJ9VMThread * const currentThread = (J9VMThread*)env;\n \tJ9JavaVM const * const vm = currentThread->javaVM;\n \tJ9InternalVMFunctions const * const vmFuncs = vm->internalVMFunctions;\n+#if JAVA_SPEC_VERSION >= 15\n+\tjboolean isCopy = JNI_FALSE;\n+\tconst char* package = (NULL == packageObj) ? NULL : (*env)->GetStringUTFChars(env, packageObj, &isCopy);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "9d734583e83f1df12e0c082b1200ecc0aae06877"}, "originalPosition": 304}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "c6bbc4803ce7bb73768bab2002f3ff969913a660", "author": {"user": {"login": "hangshao0", "name": "Hang Shao"}}, "url": "https://github.com/eclipse-openj9/openj9/commit/c6bbc4803ce7bb73768bab2002f3ff969913a660", "committedDate": "2020-05-14T18:21:30Z", "message": "Add Javadoc to ClassOption and defineHiddenClass().\n\nissue #9328\n\nSigned-off-by: Hang Shao <hangshao@ca.ibm.com>"}, "afterCommit": {"oid": "7409156e38579e03b0c51dda66d6e9d2921321c7", "author": {"user": {"login": "hangshao0", "name": "Hang Shao"}}, "url": "https://github.com/eclipse-openj9/openj9/commit/7409156e38579e03b0c51dda66d6e9d2921321c7", "committedDate": "2020-05-14T20:19:11Z", "message": "Use copyStringToUTF8Helper() to copy and covert packageName\n\nissue #9328\n\nSigned-off-by: Hang Shao <hangshao@ca.ibm.com>"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "7409156e38579e03b0c51dda66d6e9d2921321c7", "author": {"user": {"login": "hangshao0", "name": "Hang Shao"}}, "url": "https://github.com/eclipse-openj9/openj9/commit/7409156e38579e03b0c51dda66d6e9d2921321c7", "committedDate": "2020-05-14T20:19:11Z", "message": "Use copyStringToUTF8Helper() to copy and covert packageName\n\nissue #9328\n\nSigned-off-by: Hang Shao <hangshao@ca.ibm.com>"}, "afterCommit": {"oid": "b82465308095552ffedab48004b09f1900cc9dcd", "author": {"user": {"login": "hangshao0", "name": "Hang Shao"}}, "url": "https://github.com/eclipse-openj9/openj9/commit/b82465308095552ffedab48004b09f1900cc9dcd", "committedDate": "2020-05-14T20:21:26Z", "message": "Add Javadoc to ClassOption and defineHiddenClass()\nUse copyStringToUTF8Helper() to copy and covert packageName\n\nissue #9328\n\nSigned-off-by: Hang Shao <hangshao@ca.ibm.com>"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "b82465308095552ffedab48004b09f1900cc9dcd", "author": {"user": {"login": "hangshao0", "name": "Hang Shao"}}, "url": "https://github.com/eclipse-openj9/openj9/commit/b82465308095552ffedab48004b09f1900cc9dcd", "committedDate": "2020-05-14T20:21:26Z", "message": "Add Javadoc to ClassOption and defineHiddenClass()\nUse copyStringToUTF8Helper() to copy and covert packageName\n\nissue #9328\n\nSigned-off-by: Hang Shao <hangshao@ca.ibm.com>"}, "afterCommit": {"oid": "daf4400f83b6f2780731f9af44285689cf8c4876", "author": {"user": {"login": "hangshao0", "name": "Hang Shao"}}, "url": "https://github.com/eclipse-openj9/openj9/commit/daf4400f83b6f2780731f9af44285689cf8c4876", "committedDate": "2020-05-14T20:22:37Z", "message": "Add Javadoc to ClassOption and defineHiddenClass()\n\n1. Add Javadoc to ClassOption and defineHiddenClass()\n2. Use copyStringToUTF8Helper() to copy and covert packageName\n\nissue #9328\n\nSigned-off-by: Hang Shao <hangshao@ca.ibm.com>"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "daf4400f83b6f2780731f9af44285689cf8c4876", "author": {"user": {"login": "hangshao0", "name": "Hang Shao"}}, "url": "https://github.com/eclipse-openj9/openj9/commit/daf4400f83b6f2780731f9af44285689cf8c4876", "committedDate": "2020-05-14T20:22:37Z", "message": "Add Javadoc to ClassOption and defineHiddenClass()\n\n1. Add Javadoc to ClassOption and defineHiddenClass()\n2. Use copyStringToUTF8Helper() to copy and covert packageName\n\nissue #9328\n\nSigned-off-by: Hang Shao <hangshao@ca.ibm.com>"}, "afterCommit": {"oid": "ffb52617650a012067b2a96d8c9d4e6eb6561e24", "author": {"user": {"login": "hangshao0", "name": "Hang Shao"}}, "url": "https://github.com/eclipse-openj9/openj9/commit/ffb52617650a012067b2a96d8c9d4e6eb6561e24", "committedDate": "2020-05-14T20:35:20Z", "message": "Add Javadoc to ClassOption and defineHiddenClass()\n\n1. Add Javadoc to ClassOption and defineHiddenClass()\n2. Use copyStringToUTF8Helper() to copy and covert packageName\n\nissue #9328\n\nSigned-off-by: Hang Shao <hangshao@ca.ibm.com>"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "ffb52617650a012067b2a96d8c9d4e6eb6561e24", "author": {"user": {"login": "hangshao0", "name": "Hang Shao"}}, "url": "https://github.com/eclipse-openj9/openj9/commit/ffb52617650a012067b2a96d8c9d4e6eb6561e24", "committedDate": "2020-05-14T20:35:20Z", "message": "Add Javadoc to ClassOption and defineHiddenClass()\n\n1. Add Javadoc to ClassOption and defineHiddenClass()\n2. Use copyStringToUTF8Helper() to copy and covert packageName\n\nissue #9328\n\nSigned-off-by: Hang Shao <hangshao@ca.ibm.com>"}, "afterCommit": {"oid": "01a489f2e358482ffcfacd7d9a39f53f94a33c7f", "author": {"user": {"login": "hangshao0", "name": "Hang Shao"}}, "url": "https://github.com/eclipse-openj9/openj9/commit/01a489f2e358482ffcfacd7d9a39f53f94a33c7f", "committedDate": "2020-05-14T20:39:45Z", "message": "Add Javadoc to ClassOption and defineHiddenClass()\n\n1. Add Javadoc to ClassOption and defineHiddenClass()\n2. Use copyStringToUTF8Helper() to copy and covert packageName\n\nissue #9328\n\nSigned-off-by: Hang Shao <hangshao@ca.ibm.com>"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "01a489f2e358482ffcfacd7d9a39f53f94a33c7f", "author": {"user": {"login": "hangshao0", "name": "Hang Shao"}}, "url": "https://github.com/eclipse-openj9/openj9/commit/01a489f2e358482ffcfacd7d9a39f53f94a33c7f", "committedDate": "2020-05-14T20:39:45Z", "message": "Add Javadoc to ClassOption and defineHiddenClass()\n\n1. Add Javadoc to ClassOption and defineHiddenClass()\n2. Use copyStringToUTF8Helper() to copy and covert packageName\n\nissue #9328\n\nSigned-off-by: Hang Shao <hangshao@ca.ibm.com>"}, "afterCommit": {"oid": "e3fe7d852f049455738ba053681d498f5d411d92", "author": {"user": {"login": "hangshao0", "name": "Hang Shao"}}, "url": "https://github.com/eclipse-openj9/openj9/commit/e3fe7d852f049455738ba053681d498f5d411d92", "committedDate": "2020-05-14T20:59:33Z", "message": "Add Javadoc to ClassOption and defineHiddenClass()\n\n1. Add Javadoc to ClassOption and defineHiddenClass()\n2. Use copyStringToUTF8Helper() to copy and covert packageName\n\nissue #9328\n\nSigned-off-by: Hang Shao <hangshao@ca.ibm.com>"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDEyMjAyODEw", "url": "https://github.com/eclipse-openj9/openj9/pull/9485#pullrequestreview-412202810", "createdAt": "2020-05-14T21:36:01Z", "commit": {"oid": "e3fe7d852f049455738ba053681d498f5d411d92"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xNFQyMTozNjowMlrOGVvGcQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xNFQyMTozNjowMlrOGVvGcQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNTQ0NDk3Nw==", "bodyText": "See #9292 (comment): using JNI after calling internalEnterVMFromJNI() is not legal.", "url": "https://github.com/eclipse-openj9/openj9/pull/9485#discussion_r425444977", "createdAt": "2020-05-14T21:36:02Z", "author": {"login": "keithc-ca"}, "path": "runtime/j9vm/java11vmi.c", "diffHunk": "@@ -710,18 +711,79 @@ allowReadAccessToModule(J9VMThread * currentThread, J9Module * fromModule, J9Mod\n  * @return If successful, returns a java.lang.reflect.Module object. Otherwise, returns NULL.\n  */\n jobject JNICALL\n+#if JAVA_SPEC_VERSION >= 15\n+JVM_DefineModule(JNIEnv * env, jobject module, jboolean isOpen, jstring version, jstring location, jobjectArray packageArray)\n+#else\n JVM_DefineModule(JNIEnv * env, jobject module, jboolean isOpen, jstring version, jstring location, const char* const* packages, jsize numPackages)\n+#endif /* JAVA_SPEC_VERSION >= 15 */\n {\n \tJ9VMThread * const currentThread = (J9VMThread*)env;\n \tJ9JavaVM * vm = currentThread->javaVM;\n \tJ9InternalVMFunctions const * const vmFuncs = vm->internalVMFunctions;\n+#if JAVA_SPEC_VERSION >= 15\n+\tBOOLEAN oom = FALSE;\n+\tBOOLEAN nullPackage = FALSE;\n+\tjsize numPackages = (NULL == packageArray) ? 0 : (*env)->GetArrayLength(env, packageArray);\n+\tPORT_ACCESS_FROM_ENV(env);\n+\tUDATA packagesNumBytes = sizeof(char*) * numPackages;\n+\tconst char** packages = NULL;\n+#endif /* JAVA_SPEC_VERSION >= 15 */\n \n \tvmFuncs->internalEnterVMFromJNI(currentThread);\n #if defined(CALL_BUNDLED_FUNCTIONS_DIRECTLY)\n \tomrthread_monitor_enter(vm->classLoaderModuleAndLocationMutex);\n #else\n \tf_monitorEnter(vm->classLoaderModuleAndLocationMutex);\n #endif /* defined(CALL_BUNDLED_FUNCTIONS_DIRECTLY) */\n+\n+#if JAVA_SPEC_VERSION >= 15\n+\tif ((*env)->ExceptionCheck(env)) {\n+\t\tgoto done;\n+\t}\n+\tpackages = (const char**)j9mem_allocate_memory(packagesNumBytes, OMRMEM_CATEGORY_VM);\n+\tif (NULL != packages) {\n+\t\tjsize pkgIndex = 0;\n+\t\tmemset((void *)packages, 0, packagesNumBytes);\n+\t\tfor (pkgIndex = 0; pkgIndex < numPackages; pkgIndex++) {\n+\t\t\tjobject packageObj = (*env)->GetObjectArrayElement(env, packageArray, pkgIndex);\n+\t\t\tif ((*env)->ExceptionCheck(env)) {\n+\t\t\t\t(*env)->DeleteLocalRef(env, packageObj);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "e3fe7d852f049455738ba053681d498f5d411d92"}, "originalPosition": 48}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "e3fe7d852f049455738ba053681d498f5d411d92", "author": {"user": {"login": "hangshao0", "name": "Hang Shao"}}, "url": "https://github.com/eclipse-openj9/openj9/commit/e3fe7d852f049455738ba053681d498f5d411d92", "committedDate": "2020-05-14T20:59:33Z", "message": "Add Javadoc to ClassOption and defineHiddenClass()\n\n1. Add Javadoc to ClassOption and defineHiddenClass()\n2. Use copyStringToUTF8Helper() to copy and covert packageName\n\nissue #9328\n\nSigned-off-by: Hang Shao <hangshao@ca.ibm.com>"}, "afterCommit": {"oid": "c7af4815342fbca844bbfb7502dd257c016ac0c1", "author": {"user": {"login": "hangshao0", "name": "Hang Shao"}}, "url": "https://github.com/eclipse-openj9/openj9/commit/c7af4815342fbca844bbfb7502dd257c016ac0c1", "committedDate": "2020-05-14T21:44:02Z", "message": "Add Javadoc to ClassOption and defineHiddenClass()\n\n1. Add Javadoc to ClassOption and defineHiddenClass()\n2. Use copyStringToUTF8Helper() to copy and covert packageName\n\nissue #9328\n\nSigned-off-by: Hang Shao <hangshao@ca.ibm.com>"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "c7af4815342fbca844bbfb7502dd257c016ac0c1", "author": {"user": {"login": "hangshao0", "name": "Hang Shao"}}, "url": "https://github.com/eclipse-openj9/openj9/commit/c7af4815342fbca844bbfb7502dd257c016ac0c1", "committedDate": "2020-05-14T21:44:02Z", "message": "Add Javadoc to ClassOption and defineHiddenClass()\n\n1. Add Javadoc to ClassOption and defineHiddenClass()\n2. Use copyStringToUTF8Helper() to copy and covert packageName\n\nissue #9328\n\nSigned-off-by: Hang Shao <hangshao@ca.ibm.com>"}, "afterCommit": {"oid": "ce8f59bf90dbe10c1ddde6ff4793219870280a69", "author": {"user": {"login": "hangshao0", "name": "Hang Shao"}}, "url": "https://github.com/eclipse-openj9/openj9/commit/ce8f59bf90dbe10c1ddde6ff4793219870280a69", "committedDate": "2020-05-14T22:31:48Z", "message": "Add Javadoc to ClassOption and defineHiddenClass()\n\n1. Add Javadoc to ClassOption and defineHiddenClass()\n2. Use copyStringToUTF8Helper() to copy and covert packageName\n\nissue #9328\n\nSigned-off-by: Hang Shao <hangshao@ca.ibm.com>"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDE1Mjk5Mzgx", "url": "https://github.com/eclipse-openj9/openj9/pull/9485#pullrequestreview-415299381", "createdAt": "2020-05-20T12:52:33Z", "commit": {"oid": "ce8f59bf90dbe10c1ddde6ff4793219870280a69"}, "state": "COMMENTED", "comments": {"totalCount": 7, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yMFQxMjo1MjozM1rOGYKChw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yMFQxMzowNDoyN1rOGYKjoA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNzk4MzQ5NQ==", "bodyText": "Define the variables here and give them safe default values.  Leave the real values until we have vm access below\n\n  \n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            #if JAVA_SPEC_VERSION >= 15\n          \n          \n            \n            \tBOOLEAN oom = FALSE;\n          \n          \n            \n            \tBOOLEAN nullPackage = FALSE;\n          \n          \n            \n            \tjsize numPackages = (NULL == packageArray) ? 0 : (*env)->GetArrayLength(env, packageArray);\n          \n          \n            \n            \tPORT_ACCESS_FROM_ENV(env);\n          \n          \n            \n            \tUDATA packagesNumBytes = sizeof(char*) * numPackages;\n          \n          \n            \n            \tconst char** packages = NULL;\n          \n          \n            \n            \tif ((*env)->ExceptionCheck(env)) {\n          \n          \n            \n            \t\treturn module;\n          \n          \n            \n            \t}\n          \n          \n            \n            #endif /* JAVA_SPEC_VERSION >= 15 */\n          \n          \n            \n            #if JAVA_SPEC_VERSION >= 15\n          \n          \n            \n            \tBOOLEAN oom = FALSE;\n          \n          \n            \n            \tBOOLEAN nullPackage = FALSE;\n          \n          \n            \n            \tjsize numPackages = 0;\n          \n          \n            \n            \tUDATA packagesNumBytes = 0;\n          \n          \n            \n            \tconst char** packages = NULL;\n          \n          \n            \n            \tPORT_ACCESS_FROM_ENV(env);\n          \n          \n            \n            #endif /* JAVA_SPEC_VERSION >= 15 */", "url": "https://github.com/eclipse-openj9/openj9/pull/9485#discussion_r427983495", "createdAt": "2020-05-20T12:52:33Z", "author": {"login": "DanHeidinga"}, "path": "runtime/j9vm/java11vmi.c", "diffHunk": "@@ -710,18 +711,72 @@ allowReadAccessToModule(J9VMThread * currentThread, J9Module * fromModule, J9Mod\n  * @return If successful, returns a java.lang.reflect.Module object. Otherwise, returns NULL.\n  */\n jobject JNICALL\n+#if JAVA_SPEC_VERSION >= 15\n+JVM_DefineModule(JNIEnv * env, jobject module, jboolean isOpen, jstring version, jstring location, jobjectArray packageArray)\n+#else\n JVM_DefineModule(JNIEnv * env, jobject module, jboolean isOpen, jstring version, jstring location, const char* const* packages, jsize numPackages)\n+#endif /* JAVA_SPEC_VERSION >= 15 */\n {\n \tJ9VMThread * const currentThread = (J9VMThread*)env;\n \tJ9JavaVM * vm = currentThread->javaVM;\n \tJ9InternalVMFunctions const * const vmFuncs = vm->internalVMFunctions;\n+#if JAVA_SPEC_VERSION >= 15\n+\tBOOLEAN oom = FALSE;\n+\tBOOLEAN nullPackage = FALSE;\n+\tjsize numPackages = (NULL == packageArray) ? 0 : (*env)->GetArrayLength(env, packageArray);\n+\tPORT_ACCESS_FROM_ENV(env);\n+\tUDATA packagesNumBytes = sizeof(char*) * numPackages;\n+\tconst char** packages = NULL;\n+\tif ((*env)->ExceptionCheck(env)) {\n+\t\treturn module;\n+\t}\n+#endif /* JAVA_SPEC_VERSION >= 15 */", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ce8f59bf90dbe10c1ddde6ff4793219870280a69"}, "originalPosition": 31}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNzk4NDcxMQ==", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            #if JAVA_SPEC_VERSION >= 15\n          \n          \n            \n            \tpackages = (const char**)j9mem_allocate_memory(packagesNumBytes, OMRMEM_CATEGORY_VM);\n          \n          \n            \n            #if JAVA_SPEC_VERSION >= 15\n          \n          \n            \n            \tif (NULL != packageArray) {\n          \n          \n            \n            \t\tnumPackages = J9INDEXABLEOBJECT_SIZE(currentThread, J9_JNI_UNWRAP_REFERENCE (packageArray));\n          \n          \n            \n            \t\tpackagesNumBytes = sizeof(char*) * numPackages;\n          \n          \n            \n            \t}\n          \n          \n            \n            \tpackages = (const char**)j9mem_allocate_memory(packagesNumBytes, OMRMEM_CATEGORY_VM);", "url": "https://github.com/eclipse-openj9/openj9/pull/9485#discussion_r427984711", "createdAt": "2020-05-20T12:54:20Z", "author": {"login": "DanHeidinga"}, "path": "runtime/j9vm/java11vmi.c", "diffHunk": "@@ -710,18 +711,72 @@ allowReadAccessToModule(J9VMThread * currentThread, J9Module * fromModule, J9Mod\n  * @return If successful, returns a java.lang.reflect.Module object. Otherwise, returns NULL.\n  */\n jobject JNICALL\n+#if JAVA_SPEC_VERSION >= 15\n+JVM_DefineModule(JNIEnv * env, jobject module, jboolean isOpen, jstring version, jstring location, jobjectArray packageArray)\n+#else\n JVM_DefineModule(JNIEnv * env, jobject module, jboolean isOpen, jstring version, jstring location, const char* const* packages, jsize numPackages)\n+#endif /* JAVA_SPEC_VERSION >= 15 */\n {\n \tJ9VMThread * const currentThread = (J9VMThread*)env;\n \tJ9JavaVM * vm = currentThread->javaVM;\n \tJ9InternalVMFunctions const * const vmFuncs = vm->internalVMFunctions;\n+#if JAVA_SPEC_VERSION >= 15\n+\tBOOLEAN oom = FALSE;\n+\tBOOLEAN nullPackage = FALSE;\n+\tjsize numPackages = (NULL == packageArray) ? 0 : (*env)->GetArrayLength(env, packageArray);\n+\tPORT_ACCESS_FROM_ENV(env);\n+\tUDATA packagesNumBytes = sizeof(char*) * numPackages;\n+\tconst char** packages = NULL;\n+\tif ((*env)->ExceptionCheck(env)) {\n+\t\treturn module;\n+\t}\n+#endif /* JAVA_SPEC_VERSION >= 15 */\n \n \tvmFuncs->internalEnterVMFromJNI(currentThread);\n #if defined(CALL_BUNDLED_FUNCTIONS_DIRECTLY)\n \tomrthread_monitor_enter(vm->classLoaderModuleAndLocationMutex);\n #else\n \tf_monitorEnter(vm->classLoaderModuleAndLocationMutex);\n #endif /* defined(CALL_BUNDLED_FUNCTIONS_DIRECTLY) */\n+\n+#if JAVA_SPEC_VERSION >= 15\n+\tpackages = (const char**)j9mem_allocate_memory(packagesNumBytes, OMRMEM_CATEGORY_VM);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ce8f59bf90dbe10c1ddde6ff4793219870280a69"}, "originalPosition": 41}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNzk4NTAxNg==", "bodyText": "This saves getting and dropping vm access multiple times - array length and exception check", "url": "https://github.com/eclipse-openj9/openj9/pull/9485#discussion_r427985016", "createdAt": "2020-05-20T12:54:45Z", "author": {"login": "DanHeidinga"}, "path": "runtime/j9vm/java11vmi.c", "diffHunk": "@@ -710,18 +711,72 @@ allowReadAccessToModule(J9VMThread * currentThread, J9Module * fromModule, J9Mod\n  * @return If successful, returns a java.lang.reflect.Module object. Otherwise, returns NULL.\n  */\n jobject JNICALL\n+#if JAVA_SPEC_VERSION >= 15\n+JVM_DefineModule(JNIEnv * env, jobject module, jboolean isOpen, jstring version, jstring location, jobjectArray packageArray)\n+#else\n JVM_DefineModule(JNIEnv * env, jobject module, jboolean isOpen, jstring version, jstring location, const char* const* packages, jsize numPackages)\n+#endif /* JAVA_SPEC_VERSION >= 15 */\n {\n \tJ9VMThread * const currentThread = (J9VMThread*)env;\n \tJ9JavaVM * vm = currentThread->javaVM;\n \tJ9InternalVMFunctions const * const vmFuncs = vm->internalVMFunctions;\n+#if JAVA_SPEC_VERSION >= 15\n+\tBOOLEAN oom = FALSE;\n+\tBOOLEAN nullPackage = FALSE;\n+\tjsize numPackages = (NULL == packageArray) ? 0 : (*env)->GetArrayLength(env, packageArray);\n+\tPORT_ACCESS_FROM_ENV(env);\n+\tUDATA packagesNumBytes = sizeof(char*) * numPackages;\n+\tconst char** packages = NULL;\n+\tif ((*env)->ExceptionCheck(env)) {\n+\t\treturn module;\n+\t}\n+#endif /* JAVA_SPEC_VERSION >= 15 */\n \n \tvmFuncs->internalEnterVMFromJNI(currentThread);\n #if defined(CALL_BUNDLED_FUNCTIONS_DIRECTLY)\n \tomrthread_monitor_enter(vm->classLoaderModuleAndLocationMutex);\n #else\n \tf_monitorEnter(vm->classLoaderModuleAndLocationMutex);\n #endif /* defined(CALL_BUNDLED_FUNCTIONS_DIRECTLY) */\n+\n+#if JAVA_SPEC_VERSION >= 15\n+\tpackages = (const char**)j9mem_allocate_memory(packagesNumBytes, OMRMEM_CATEGORY_VM);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNzk4NDcxMQ=="}, "originalCommit": {"oid": "ce8f59bf90dbe10c1ddde6ff4793219870280a69"}, "originalPosition": 41}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNzk4NzcxNA==", "bodyText": "There's a future optimization here to avoid the allocation and use a stack allocated array for a small number of packages.  Probably worth opening a separate issue for that.", "url": "https://github.com/eclipse-openj9/openj9/pull/9485#discussion_r427987714", "createdAt": "2020-05-20T12:58:26Z", "author": {"login": "DanHeidinga"}, "path": "runtime/j9vm/java11vmi.c", "diffHunk": "@@ -710,18 +711,72 @@ allowReadAccessToModule(J9VMThread * currentThread, J9Module * fromModule, J9Mod\n  * @return If successful, returns a java.lang.reflect.Module object. Otherwise, returns NULL.\n  */\n jobject JNICALL\n+#if JAVA_SPEC_VERSION >= 15\n+JVM_DefineModule(JNIEnv * env, jobject module, jboolean isOpen, jstring version, jstring location, jobjectArray packageArray)\n+#else\n JVM_DefineModule(JNIEnv * env, jobject module, jboolean isOpen, jstring version, jstring location, const char* const* packages, jsize numPackages)\n+#endif /* JAVA_SPEC_VERSION >= 15 */\n {\n \tJ9VMThread * const currentThread = (J9VMThread*)env;\n \tJ9JavaVM * vm = currentThread->javaVM;\n \tJ9InternalVMFunctions const * const vmFuncs = vm->internalVMFunctions;\n+#if JAVA_SPEC_VERSION >= 15\n+\tBOOLEAN oom = FALSE;\n+\tBOOLEAN nullPackage = FALSE;\n+\tjsize numPackages = (NULL == packageArray) ? 0 : (*env)->GetArrayLength(env, packageArray);\n+\tPORT_ACCESS_FROM_ENV(env);\n+\tUDATA packagesNumBytes = sizeof(char*) * numPackages;\n+\tconst char** packages = NULL;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ce8f59bf90dbe10c1ddde6ff4793219870280a69"}, "originalPosition": 27}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNzk4OTgzMA==", "bodyText": "Can this check be moved earlier?  It seems like we do a != NULL check earlier that can be commoned with this", "url": "https://github.com/eclipse-openj9/openj9/pull/9485#discussion_r427989830", "createdAt": "2020-05-20T13:01:22Z", "author": {"login": "DanHeidinga"}, "path": "runtime/j9vm/java11vmi.c", "diffHunk": "@@ -710,18 +711,72 @@ allowReadAccessToModule(J9VMThread * currentThread, J9Module * fromModule, J9Mod\n  * @return If successful, returns a java.lang.reflect.Module object. Otherwise, returns NULL.\n  */\n jobject JNICALL\n+#if JAVA_SPEC_VERSION >= 15\n+JVM_DefineModule(JNIEnv * env, jobject module, jboolean isOpen, jstring version, jstring location, jobjectArray packageArray)\n+#else\n JVM_DefineModule(JNIEnv * env, jobject module, jboolean isOpen, jstring version, jstring location, const char* const* packages, jsize numPackages)\n+#endif /* JAVA_SPEC_VERSION >= 15 */\n {\n \tJ9VMThread * const currentThread = (J9VMThread*)env;\n \tJ9JavaVM * vm = currentThread->javaVM;\n \tJ9InternalVMFunctions const * const vmFuncs = vm->internalVMFunctions;\n+#if JAVA_SPEC_VERSION >= 15\n+\tBOOLEAN oom = FALSE;\n+\tBOOLEAN nullPackage = FALSE;\n+\tjsize numPackages = (NULL == packageArray) ? 0 : (*env)->GetArrayLength(env, packageArray);\n+\tPORT_ACCESS_FROM_ENV(env);\n+\tUDATA packagesNumBytes = sizeof(char*) * numPackages;\n+\tconst char** packages = NULL;\n+\tif ((*env)->ExceptionCheck(env)) {\n+\t\treturn module;\n+\t}\n+#endif /* JAVA_SPEC_VERSION >= 15 */\n \n \tvmFuncs->internalEnterVMFromJNI(currentThread);\n #if defined(CALL_BUNDLED_FUNCTIONS_DIRECTLY)\n \tomrthread_monitor_enter(vm->classLoaderModuleAndLocationMutex);\n #else\n \tf_monitorEnter(vm->classLoaderModuleAndLocationMutex);\n #endif /* defined(CALL_BUNDLED_FUNCTIONS_DIRECTLY) */\n+\n+#if JAVA_SPEC_VERSION >= 15\n+\tpackages = (const char**)j9mem_allocate_memory(packagesNumBytes, OMRMEM_CATEGORY_VM);\n+\tif (NULL != packages) {\n+\t\tjsize pkgIndex = 0;\n+\t\tmemset((void *)packages, 0, packagesNumBytes);\n+\t\tfor (pkgIndex = 0; pkgIndex < numPackages; pkgIndex++) {\n+\t\t\tj9array_t array = (j9array_t)J9_JNI_UNWRAP_REFERENCE(packageArray);\n+\t\t\tj9object_t stringObject = J9JAVAARRAYOFOBJECT_LOAD(currentThread, array, pkgIndex);\n+\t\t\tif (NULL != stringObject) {\n+\t\t\t\tUDATA utfLength = vmFuncs->getStringUTF8Length(currentThread, stringObject) + 1;\n+\t\t\t\tchar *packageName = (char*)j9mem_allocate_memory(utfLength, OMRMEM_CATEGORY_VM);\n+\t\t\t\tif (NULL == packageName) {\n+\t\t\t\t\toom = TRUE;\n+\t\t\t\t\tbreak;\n+\t\t\t\t}\n+\t\t\t\tvmFuncs->copyStringToUTF8Helper(currentThread, stringObject, J9_STR_NULL_TERMINATE_RESULT | J9_STR_XLAT , 0, J9VMJAVALANGSTRING_LENGTH(currentThread, stringObject), packageName, utfLength);\n+\t\t\t\tpackages[pkgIndex] = packageName;\n+\t\t\t} else {\n+\t\t\t\tnullPackage = TRUE;\n+\t\t\t\tbreak;\n+\t\t\t}\n+\t\t}\n+\t}\n+\n+\tif (NULL == packageArray) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ce8f59bf90dbe10c1ddde6ff4793219870280a69"}, "originalPosition": 64}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNzk5MTA0MQ==", "bodyText": "Is the nullPackage variable needed?  Can the exception setting code be moved here and then the code could goto directly the cleanup label?\nIt means there's one less piece of state to keep straight", "url": "https://github.com/eclipse-openj9/openj9/pull/9485#discussion_r427991041", "createdAt": "2020-05-20T13:03:05Z", "author": {"login": "DanHeidinga"}, "path": "runtime/j9vm/java11vmi.c", "diffHunk": "@@ -710,18 +711,72 @@ allowReadAccessToModule(J9VMThread * currentThread, J9Module * fromModule, J9Mod\n  * @return If successful, returns a java.lang.reflect.Module object. Otherwise, returns NULL.\n  */\n jobject JNICALL\n+#if JAVA_SPEC_VERSION >= 15\n+JVM_DefineModule(JNIEnv * env, jobject module, jboolean isOpen, jstring version, jstring location, jobjectArray packageArray)\n+#else\n JVM_DefineModule(JNIEnv * env, jobject module, jboolean isOpen, jstring version, jstring location, const char* const* packages, jsize numPackages)\n+#endif /* JAVA_SPEC_VERSION >= 15 */\n {\n \tJ9VMThread * const currentThread = (J9VMThread*)env;\n \tJ9JavaVM * vm = currentThread->javaVM;\n \tJ9InternalVMFunctions const * const vmFuncs = vm->internalVMFunctions;\n+#if JAVA_SPEC_VERSION >= 15\n+\tBOOLEAN oom = FALSE;\n+\tBOOLEAN nullPackage = FALSE;\n+\tjsize numPackages = (NULL == packageArray) ? 0 : (*env)->GetArrayLength(env, packageArray);\n+\tPORT_ACCESS_FROM_ENV(env);\n+\tUDATA packagesNumBytes = sizeof(char*) * numPackages;\n+\tconst char** packages = NULL;\n+\tif ((*env)->ExceptionCheck(env)) {\n+\t\treturn module;\n+\t}\n+#endif /* JAVA_SPEC_VERSION >= 15 */\n \n \tvmFuncs->internalEnterVMFromJNI(currentThread);\n #if defined(CALL_BUNDLED_FUNCTIONS_DIRECTLY)\n \tomrthread_monitor_enter(vm->classLoaderModuleAndLocationMutex);\n #else\n \tf_monitorEnter(vm->classLoaderModuleAndLocationMutex);\n #endif /* defined(CALL_BUNDLED_FUNCTIONS_DIRECTLY) */\n+\n+#if JAVA_SPEC_VERSION >= 15\n+\tpackages = (const char**)j9mem_allocate_memory(packagesNumBytes, OMRMEM_CATEGORY_VM);\n+\tif (NULL != packages) {\n+\t\tjsize pkgIndex = 0;\n+\t\tmemset((void *)packages, 0, packagesNumBytes);\n+\t\tfor (pkgIndex = 0; pkgIndex < numPackages; pkgIndex++) {\n+\t\t\tj9array_t array = (j9array_t)J9_JNI_UNWRAP_REFERENCE(packageArray);\n+\t\t\tj9object_t stringObject = J9JAVAARRAYOFOBJECT_LOAD(currentThread, array, pkgIndex);\n+\t\t\tif (NULL != stringObject) {\n+\t\t\t\tUDATA utfLength = vmFuncs->getStringUTF8Length(currentThread, stringObject) + 1;\n+\t\t\t\tchar *packageName = (char*)j9mem_allocate_memory(utfLength, OMRMEM_CATEGORY_VM);\n+\t\t\t\tif (NULL == packageName) {\n+\t\t\t\t\toom = TRUE;\n+\t\t\t\t\tbreak;\n+\t\t\t\t}\n+\t\t\t\tvmFuncs->copyStringToUTF8Helper(currentThread, stringObject, J9_STR_NULL_TERMINATE_RESULT | J9_STR_XLAT , 0, J9VMJAVALANGSTRING_LENGTH(currentThread, stringObject), packageName, utfLength);\n+\t\t\t\tpackages[pkgIndex] = packageName;\n+\t\t\t} else {\n+\t\t\t\tnullPackage = TRUE;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ce8f59bf90dbe10c1ddde6ff4793219870280a69"}, "originalPosition": 58}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNzk5MTk2OA==", "bodyText": "similar potential optimization here by keeping a small stack allocated buffer to avoid the malloc", "url": "https://github.com/eclipse-openj9/openj9/pull/9485#discussion_r427991968", "createdAt": "2020-05-20T13:04:27Z", "author": {"login": "DanHeidinga"}, "path": "runtime/j9vm/java11vmi.c", "diffHunk": "@@ -866,19 +932,46 @@ JVM_DefineModule(JNIEnv * env, jobject module, jboolean isOpen, jstring version,\n  * 4) Package is not defined for fromModule's class loader\n  * 5) Package is not in module fromModule.\n  */\n+#if JAVA_SPEC_VERSION >= 15\n+void JNICALL\n+JVM_AddModuleExports(JNIEnv * env, jobject fromModule, jstring packageObj, jobject toModule)\n+#else\n void JNICALL\n JVM_AddModuleExports(JNIEnv * env, jobject fromModule, const char *package, jobject toModule)\n+#endif /* JAVA_SPEC_VERSION >= 15 */\n {\n \tJ9VMThread * const currentThread = (J9VMThread*)env;\n \tJ9JavaVM const * const vm = currentThread->javaVM;\n \tJ9InternalVMFunctions const * const vmFuncs = vm->internalVMFunctions;\n+#if JAVA_SPEC_VERSION >= 15\n+\tconst char *package = NULL;\n+\tPORT_ACCESS_FROM_ENV(env);\n+#endif /* JAVA_SPEC_VERSION >= 15 */\n \n \tvmFuncs->internalEnterVMFromJNI(currentThread);\n #if defined(CALL_BUNDLED_FUNCTIONS_DIRECTLY)\n \tomrthread_monitor_enter(vm->classLoaderModuleAndLocationMutex);\n #else\n \tf_monitorEnter(vm->classLoaderModuleAndLocationMutex);\n #endif /* defined(CALL_BUNDLED_FUNCTIONS_DIRECTLY) */\n+\t\n+#if JAVA_SPEC_VERSION >= 15\n+\tif (NULL != packageObj) {\n+\t\tj9object_t stringObject = J9_JNI_UNWRAP_REFERENCE(packageObj);\n+\t\tUDATA utfLength = vmFuncs->getStringUTF8Length(currentThread, stringObject) + 1;\n+\t\tchar* packageName = (char *)j9mem_allocate_memory(utfLength, OMRMEM_CATEGORY_VM);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ce8f59bf90dbe10c1ddde6ff4793219870280a69"}, "originalPosition": 130}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "ce8f59bf90dbe10c1ddde6ff4793219870280a69", "author": {"user": {"login": "hangshao0", "name": "Hang Shao"}}, "url": "https://github.com/eclipse-openj9/openj9/commit/ce8f59bf90dbe10c1ddde6ff4793219870280a69", "committedDate": "2020-05-14T22:31:48Z", "message": "Add Javadoc to ClassOption and defineHiddenClass()\n\n1. Add Javadoc to ClassOption and defineHiddenClass()\n2. Use copyStringToUTF8Helper() to copy and covert packageName\n\nissue #9328\n\nSigned-off-by: Hang Shao <hangshao@ca.ibm.com>"}, "afterCommit": {"oid": "7cd85a98229bff1358979e3c6331fd39850d1b54", "author": {"user": {"login": "hangshao0", "name": "Hang Shao"}}, "url": "https://github.com/eclipse-openj9/openj9/commit/7cd85a98229bff1358979e3c6331fd39850d1b54", "committedDate": "2020-05-20T15:37:16Z", "message": "Add Javadoc to ClassOption and defineHiddenClass()\n\n1. Add Javadoc to ClassOption and defineHiddenClass()\n2. Use copyStringToUTF8Helper() to copy and covert packageName\n\nissue #9328\n\nSigned-off-by: Hang Shao <hangshao@ca.ibm.com>"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDE1NTQ0NjE1", "url": "https://github.com/eclipse-openj9/openj9/pull/9485#pullrequestreview-415544615", "createdAt": "2020-05-20T17:08:12Z", "commit": {"oid": "7cd85a98229bff1358979e3c6331fd39850d1b54"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "7cd85a98229bff1358979e3c6331fd39850d1b54", "author": {"user": {"login": "hangshao0", "name": "Hang Shao"}}, "url": "https://github.com/eclipse-openj9/openj9/commit/7cd85a98229bff1358979e3c6331fd39850d1b54", "committedDate": "2020-05-20T15:37:16Z", "message": "Add Javadoc to ClassOption and defineHiddenClass()\n\n1. Add Javadoc to ClassOption and defineHiddenClass()\n2. Use copyStringToUTF8Helper() to copy and covert packageName\n\nissue #9328\n\nSigned-off-by: Hang Shao <hangshao@ca.ibm.com>"}, "afterCommit": {"oid": "27972950b3d8f6d7d3ed6cd4f7e1a95645966b7c", "author": {"user": {"login": "hangshao0", "name": "Hang Shao"}}, "url": "https://github.com/eclipse-openj9/openj9/commit/27972950b3d8f6d7d3ed6cd4f7e1a95645966b7c", "committedDate": "2020-05-20T19:55:51Z", "message": "Add Javadoc to ClassOption and defineHiddenClass()\n\n1. Add Javadoc to ClassOption and defineHiddenClass()\n2. Use copyStringToUTF8Helper() to copy and covert packageName\n\nissue #9328\n\nSigned-off-by: Hang Shao <hangshao@ca.ibm.com>"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDE1NzA1Mzg2", "url": "https://github.com/eclipse-openj9/openj9/pull/9485#pullrequestreview-415705386", "createdAt": "2020-05-20T20:52:41Z", "commit": {"oid": "27972950b3d8f6d7d3ed6cd4f7e1a95645966b7c"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yMFQyMDo1Mjo0MVrOGYdZNw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yMFQyMDo1Mjo0MVrOGYdZNw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyODMwMDU5OQ==", "bodyText": "The goto on line 745 should target cleanup to avoid leaking packages.\nThat would be the last use of done; perhaps cleanup should just become done.", "url": "https://github.com/eclipse-openj9/openj9/pull/9485#discussion_r428300599", "createdAt": "2020-05-20T20:52:41Z", "author": {"login": "keithc-ca"}, "path": "runtime/j9vm/java11vmi.c", "diffHunk": "@@ -843,6 +892,17 @@ JVM_DefineModule(JNIEnv * env, jobject module, jboolean isOpen, jstring version,\n \t\t\t}\n \t\t}\n \t}\n+#if JAVA_SPEC_VERSION >= 15\n+cleanup:\n+\tif (NULL != packages) {\n+\t\tjsize pkgIndex = 0;\n+\t\tfor (pkgIndex = 0; pkgIndex < numPackages; pkgIndex++) {\n+\t\t\tconst char* packageName = packages[pkgIndex];\n+\t\t\tj9mem_free_memory((void *)packageName);\n+\t\t}\n+\t\tj9mem_free_memory((void *)packages);\t\t\n+\t}\n+#endif /* JAVA_SPEC_VERSION >= 15 */\n done:", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "27972950b3d8f6d7d3ed6cd4f7e1a95645966b7c"}, "originalPosition": 90}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "27972950b3d8f6d7d3ed6cd4f7e1a95645966b7c", "author": {"user": {"login": "hangshao0", "name": "Hang Shao"}}, "url": "https://github.com/eclipse-openj9/openj9/commit/27972950b3d8f6d7d3ed6cd4f7e1a95645966b7c", "committedDate": "2020-05-20T19:55:51Z", "message": "Add Javadoc to ClassOption and defineHiddenClass()\n\n1. Add Javadoc to ClassOption and defineHiddenClass()\n2. Use copyStringToUTF8Helper() to copy and covert packageName\n\nissue #9328\n\nSigned-off-by: Hang Shao <hangshao@ca.ibm.com>"}, "afterCommit": {"oid": "f656f5705543449e2f6d8aa45af6d05ab48f0d3c", "author": {"user": {"login": "hangshao0", "name": "Hang Shao"}}, "url": "https://github.com/eclipse-openj9/openj9/commit/f656f5705543449e2f6d8aa45af6d05ab48f0d3c", "committedDate": "2020-05-20T21:13:12Z", "message": "Add Javadoc to ClassOption and defineHiddenClass()\n\n1. Add Javadoc to ClassOption and defineHiddenClass()\n2. Use copyStringToUTF8Helper() to copy and covert packageName\n\nissue #9328\n\nSigned-off-by: Hang Shao <hangshao@ca.ibm.com>"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDE1NzI1MTQ0", "url": "https://github.com/eclipse-openj9/openj9/pull/9485#pullrequestreview-415725144", "createdAt": "2020-05-20T21:24:48Z", "commit": {"oid": "f656f5705543449e2f6d8aa45af6d05ab48f0d3c"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "f656f5705543449e2f6d8aa45af6d05ab48f0d3c", "author": {"user": {"login": "hangshao0", "name": "Hang Shao"}}, "url": "https://github.com/eclipse-openj9/openj9/commit/f656f5705543449e2f6d8aa45af6d05ab48f0d3c", "committedDate": "2020-05-20T21:13:12Z", "message": "Add Javadoc to ClassOption and defineHiddenClass()\n\n1. Add Javadoc to ClassOption and defineHiddenClass()\n2. Use copyStringToUTF8Helper() to copy and covert packageName\n\nissue #9328\n\nSigned-off-by: Hang Shao <hangshao@ca.ibm.com>"}, "afterCommit": {"oid": "34cde16abf1fe10e8362652999ecc7da9cc7cf73", "author": {"user": {"login": "hangshao0", "name": "Hang Shao"}}, "url": "https://github.com/eclipse-openj9/openj9/commit/34cde16abf1fe10e8362652999ecc7da9cc7cf73", "committedDate": "2020-05-21T15:24:46Z", "message": "Replace JNI with VM helper API to convert package name. Add new Javadoc\nand implement new API in Java 15.\n\n1. Use copyStringToUTF8Helper() to copy and covert packageName\n2. Add Javadoc to ClassOption and defineHiddenClass().\n3. Add implementation of stringConcatInitialCoder() in Access.java\n\nissue #9328\n\nSigned-off-by: Hang Shao <hangshao@ca.ibm.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "7f8ae5a87834531c11059e7eeffe3e7fe10803b6", "author": {"user": {"login": "hangshao0", "name": "Hang Shao"}}, "url": "https://github.com/eclipse-openj9/openj9/commit/7f8ae5a87834531c11059e7eeffe3e7fe10803b6", "committedDate": "2020-05-21T17:56:48Z", "message": "Use VM helper to convert package name. Implement new API in Java 15.\n\n1. Use copyStringToUTF8Helper() to copy and covert packageName\n2. Add Javadoc to ClassOption and defineHiddenClass().\n3. Add implementation of stringConcatInitialCoder() in Access.java\n\nissue #9328\n\nSigned-off-by: Hang Shao <hangshao@ca.ibm.com>"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "34cde16abf1fe10e8362652999ecc7da9cc7cf73", "author": {"user": {"login": "hangshao0", "name": "Hang Shao"}}, "url": "https://github.com/eclipse-openj9/openj9/commit/34cde16abf1fe10e8362652999ecc7da9cc7cf73", "committedDate": "2020-05-21T15:24:46Z", "message": "Replace JNI with VM helper API to convert package name. Add new Javadoc\nand implement new API in Java 15.\n\n1. Use copyStringToUTF8Helper() to copy and covert packageName\n2. Add Javadoc to ClassOption and defineHiddenClass().\n3. Add implementation of stringConcatInitialCoder() in Access.java\n\nissue #9328\n\nSigned-off-by: Hang Shao <hangshao@ca.ibm.com>"}, "afterCommit": {"oid": "7f8ae5a87834531c11059e7eeffe3e7fe10803b6", "author": {"user": {"login": "hangshao0", "name": "Hang Shao"}}, "url": "https://github.com/eclipse-openj9/openj9/commit/7f8ae5a87834531c11059e7eeffe3e7fe10803b6", "committedDate": "2020-05-21T17:56:48Z", "message": "Use VM helper to convert package name. Implement new API in Java 15.\n\n1. Use copyStringToUTF8Helper() to copy and covert packageName\n2. Add Javadoc to ClassOption and defineHiddenClass().\n3. Add implementation of stringConcatInitialCoder() in Access.java\n\nissue #9328\n\nSigned-off-by: Hang Shao <hangshao@ca.ibm.com>"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDE2NTI2MjQ4", "url": "https://github.com/eclipse-openj9/openj9/pull/9485#pullrequestreview-416526248", "createdAt": "2020-05-21T22:07:02Z", "commit": {"oid": "7f8ae5a87834531c11059e7eeffe3e7fe10803b6"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 886, "cost": 1, "resetAt": "2021-10-28T17:48:14Z"}}}