{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTAzMDgxNTc0", "number": 10882, "title": "Remove references to Weak/SoftCleanable from CleanerShutdown", "bodyText": "WeakCleanable and SoftCleanable are removed in JDK16. The cleanup code\nfor these never worked properly in older versions, obviously it's not\nneeded.\nFixes #10881\nSigned-off-by: Peter Shipton Peter_Shipton@ca.ibm.com", "createdAt": "2020-10-14T03:31:19Z", "url": "https://github.com/eclipse-openj9/openj9/pull/10882", "merged": true, "mergeCommit": {"oid": "2f10c295eda4ec80300898f7dfeb2562135171ac"}, "closed": true, "closedAt": "2020-10-14T20:54:46Z", "author": {"login": "pshipton"}, "timelineItems": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdSddyHgFqTUwODM2MzgxNQ==", "endCursor": "Y3Vyc29yOnYyOpPPAAABdSjki6AFqTUwODcyMDQ5Ng==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTA4MzYzODE1", "url": "https://github.com/eclipse-openj9/openj9/pull/10882#pullrequestreview-508363815", "createdAt": "2020-10-14T13:46:08Z", "commit": {"oid": "66af842da19a9b34f3f1021d54fe98da9e8be813"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xNFQxMzo0NjowOFrOHhT3ww==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xNFQxMzo0NjozMVrOHhT5XQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNDY5MDYyNw==", "bodyText": "I think this should use weakRemove rather than phantomRemove.", "url": "https://github.com/eclipse-openj9/openj9/pull/10882#discussion_r504690627", "createdAt": "2020-10-14T13:46:08Z", "author": {"login": "keithc-ca"}, "path": "jcl/src/java.base/share/classes/jdk/internal/ref/CleanerShutdown.java", "diffHunk": "@@ -49,25 +49,31 @@ public static void shutdownCleaner() {\n \t\t\n \t\ttry {\n \t\t\tMethod phantomRemove = PhantomCleanable.class.getDeclaredMethod(\"remove\", (Class<?>[]) null); //$NON-NLS-1$\n+\t\t\t/*[IF !Java16]*/\n \t\t\tMethod weakRemove = WeakCleanable.class.getDeclaredMethod(\"remove\", (Class<?>[]) null); //$NON-NLS-1$\n \t\t\tMethod softRemove = SoftCleanable.class.getDeclaredMethod(\"remove\", (Class<?>[]) null); //$NON-NLS-1$\n+\t\t\t/*[ENDIF]*/\n \t\t\tAccessController.doPrivileged((PrivilegedAction<Void>) () -> {\n \t\t\t\tphantomRemove.setAccessible(true);\n+\t\t\t\t/*[IF !Java16]*/\n \t\t\t\tweakRemove.setAccessible(true);\n \t\t\t\tsoftRemove.setAccessible(true);\n+\t\t\t\t/*[ENDIF]*/\n \t\t\t\treturn null;\n \t\t\t});\n \t\t\twhile(!commonCleanerImpl.phantomCleanableList.isListEmpty()) {\n \t\t\t\tphantomRemove.invoke(commonCleanerImpl.phantomCleanableList, (Object[]) null);\n \t\t\t}\n \n+\t\t\t/*[IF !Java16]*/\n \t\t\twhile(!commonCleanerImpl.weakCleanableList.isListEmpty()) {\n \t\t\t\tphantomRemove.invoke(commonCleanerImpl.weakCleanableList, (Object[]) null);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "66af842da19a9b34f3f1021d54fe98da9e8be813"}, "originalPosition": 30}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNDY5MTAzNw==", "bodyText": "I think this should use softRemove rather than phantomRemove.", "url": "https://github.com/eclipse-openj9/openj9/pull/10882#discussion_r504691037", "createdAt": "2020-10-14T13:46:31Z", "author": {"login": "keithc-ca"}, "path": "jcl/src/java.base/share/classes/jdk/internal/ref/CleanerShutdown.java", "diffHunk": "@@ -49,25 +49,31 @@ public static void shutdownCleaner() {\n \t\t\n \t\ttry {\n \t\t\tMethod phantomRemove = PhantomCleanable.class.getDeclaredMethod(\"remove\", (Class<?>[]) null); //$NON-NLS-1$\n+\t\t\t/*[IF !Java16]*/\n \t\t\tMethod weakRemove = WeakCleanable.class.getDeclaredMethod(\"remove\", (Class<?>[]) null); //$NON-NLS-1$\n \t\t\tMethod softRemove = SoftCleanable.class.getDeclaredMethod(\"remove\", (Class<?>[]) null); //$NON-NLS-1$\n+\t\t\t/*[ENDIF]*/\n \t\t\tAccessController.doPrivileged((PrivilegedAction<Void>) () -> {\n \t\t\t\tphantomRemove.setAccessible(true);\n+\t\t\t\t/*[IF !Java16]*/\n \t\t\t\tweakRemove.setAccessible(true);\n \t\t\t\tsoftRemove.setAccessible(true);\n+\t\t\t\t/*[ENDIF]*/\n \t\t\t\treturn null;\n \t\t\t});\n \t\t\twhile(!commonCleanerImpl.phantomCleanableList.isListEmpty()) {\n \t\t\t\tphantomRemove.invoke(commonCleanerImpl.phantomCleanableList, (Object[]) null);\n \t\t\t}\n \n+\t\t\t/*[IF !Java16]*/\n \t\t\twhile(!commonCleanerImpl.weakCleanableList.isListEmpty()) {\n \t\t\t\tphantomRemove.invoke(commonCleanerImpl.weakCleanableList, (Object[]) null);\n \t\t\t}\n \n \t\t\twhile(!commonCleanerImpl.softCleanableList.isListEmpty()) {\n \t\t\t\tphantomRemove.invoke(commonCleanerImpl.softCleanableList, (Object[]) null);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "66af842da19a9b34f3f1021d54fe98da9e8be813"}, "originalPosition": 34}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "51a043e4163504f4d4a975ee4f39f04eea7039eb", "author": {"user": {"login": "pshipton", "name": "Peter Shipton"}}, "url": "https://github.com/eclipse-openj9/openj9/commit/51a043e4163504f4d4a975ee4f39f04eea7039eb", "committedDate": "2020-10-14T15:54:03Z", "message": "Remove references to Weak/SoftCleanable from CleanerShutdown\n\nWeakCleanable and SoftCleanable are removed in JDK16. The cleanup code\nfor these never worked properly in older versions, obviously it's not\nneeded.\n\nIssue https://github.com/eclipse/openj9/issues/10881\n\nSigned-off-by: Peter Shipton <Peter_Shipton@ca.ibm.com>"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "66af842da19a9b34f3f1021d54fe98da9e8be813", "author": {"user": {"login": "pshipton", "name": "Peter Shipton"}}, "url": "https://github.com/eclipse-openj9/openj9/commit/66af842da19a9b34f3f1021d54fe98da9e8be813", "committedDate": "2020-10-14T03:30:55Z", "message": "JDK16 Remove references to Weak/SoftCleanable from CleanerShutdown\n\nWeakCleanable and SoftCleanable are removed in JDK16.\n\nIssue https://github.com/eclipse/openj9/issues/10881\n\nSigned-off-by: Peter Shipton <Peter_Shipton@ca.ibm.com>"}, "afterCommit": {"oid": "51a043e4163504f4d4a975ee4f39f04eea7039eb", "author": {"user": {"login": "pshipton", "name": "Peter Shipton"}}, "url": "https://github.com/eclipse-openj9/openj9/commit/51a043e4163504f4d4a975ee4f39f04eea7039eb", "committedDate": "2020-10-14T15:54:03Z", "message": "Remove references to Weak/SoftCleanable from CleanerShutdown\n\nWeakCleanable and SoftCleanable are removed in JDK16. The cleanup code\nfor these never worked properly in older versions, obviously it's not\nneeded.\n\nIssue https://github.com/eclipse/openj9/issues/10881\n\nSigned-off-by: Peter Shipton <Peter_Shipton@ca.ibm.com>"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTA4NzIwNDk2", "url": "https://github.com/eclipse-openj9/openj9/pull/10882#pullrequestreview-508720496", "createdAt": "2020-10-14T20:54:28Z", "commit": {"oid": "51a043e4163504f4d4a975ee4f39f04eea7039eb"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 167, "cost": 1, "resetAt": "2021-10-28T18:00:02Z"}}}