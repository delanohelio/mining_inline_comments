{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0MzU5MDkzMTIy", "number": 8199, "title": "Use compiler-local target environment", "bodyText": "Issue: #8198\nNote, this PR hasn't removed all uses of the global TR::CompilerEnv->target", "createdAt": "2020-01-03T19:16:48Z", "url": "https://github.com/eclipse-openj9/openj9/pull/8199", "merged": true, "mergeCommit": {"oid": "5ea61ceb3d14993e11703dd2b6d4080a2290f087"}, "closed": true, "closedAt": "2020-01-13T16:51:40Z", "author": {"login": "dsouzai"}, "timelineItems": {"totalCount": 9, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABb4t0HAAFqTM0MDcwMzgxOQ==", "endCursor": "Y3Vyc29yOnYyOpPPAAABb5EF5-gBqjI5Mzk2ODUwNzc=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzQwNzAzODE5", "url": "https://github.com/eclipse-openj9/openj9/pull/8199#pullrequestreview-340703819", "createdAt": "2020-01-09T17:50:44Z", "commit": {"oid": "b68bd81fc15387f2c174fb35c0e8d282124f75c3"}, "state": "COMMENTED", "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0wOVQxNzo1MDo0NVrOFb-Xew==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0wOVQxNzo1NTozMlrOFb-flg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NDg3NzY5MQ==", "bodyText": "@0xdaryl @knn-k FYI I'm not sure why we have architecture guards for this. I'm sure ARM/AArch64 could benefit.", "url": "https://github.com/eclipse-openj9/openj9/pull/8199#discussion_r364877691", "createdAt": "2020-01-09T17:50:45Z", "author": {"login": "fjeremic"}, "path": "runtime/compiler/codegen/CodeGenGC.cpp", "diffHunk": "@@ -378,7 +378,7 @@ J9::CodeGenerator::createStackAtlas()\n             localObjectsFound = true;\n             int32_t localObjectAlignment = comp->fej9()->getLocalObjectAlignmentInBytes();\n             if (localObjectAlignment > stackSlotSize &&\n-                (TR::Compiler->target.cpu.isX86() || TR::Compiler->target.cpu.isPower() || TR::Compiler->target.cpu.isZ()))\n+                (comp->target().cpu.isX86() || comp->target().cpu.isPower() || comp->target().cpu.isZ()))", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b68bd81fc15387f2c174fb35c0e8d282124f75c3"}, "originalPosition": 12}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NDg3OTA4Ng==", "bodyText": "This is pretty scary looking code in idiom recognition...", "url": "https://github.com/eclipse-openj9/openj9/pull/8199#discussion_r364879086", "createdAt": "2020-01-09T17:54:00Z", "author": {"login": "fjeremic"}, "path": "runtime/compiler/optimizer/IdiomTransformations.cpp", "diffHunk": "@@ -4712,7 +4712,7 @@ makeCopyingTRTOInduction1Graph(TR::Compilation *c, int32_t ctrl, int32_t pattern\n    tgt->setMinCounts(1, 1, 1);  // minimum ifCount, indirectLoadCount, indirectStoreCount\n    tgt->setHotness(warm, false);\n    static char *versionLengthStr = feGetEnv(\"TR_CopyingTRTOInduction1Graph_versionLength\");\n-   static int   versionLength = versionLengthStr ? atoi(versionLengthStr) : (TR::Compiler->target.cpu.isPower() ? 0 : 8);\n+   static int   versionLength = versionLengthStr ? atoi(versionLengthStr) : (c->target().cpu.isPower() ? 0 : 8);\n    tgt->setVersionLength(versionLength);   // depending on each architecture", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b68bd81fc15387f2c174fb35c0e8d282124f75c3"}, "originalPosition": 76}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NDg3OTc2Ng==", "bodyText": "Do these have to use self()? The one right below just calls comp()", "url": "https://github.com/eclipse-openj9/openj9/pull/8199#discussion_r364879766", "createdAt": "2020-01-09T17:55:32Z", "author": {"login": "fjeremic"}, "path": "runtime/compiler/p/codegen/J9CodeGenerator.cpp", "diffHunk": "@@ -728,9 +728,9 @@ J9::Power::CodeGenerator::insertPrefetchIfNecessary(TR::Node *node, TR::Register\n       }\n    else if (node->getOpCodeValue() == TR::awrtbari &&\n             comp()->getMethodHotness() >= scorching &&\n-            TR::Compiler->target.cpu.id() >= TR_PPCp6 &&\n-              (TR::Compiler->target.is32Bit() ||\n-                (TR::Compiler->target.is64Bit() &&\n+            self()->comp()->target().cpu.id() >= TR_PPCp6 &&\n+              (self()->comp()->target().is32Bit() ||\n+                (self()->comp()->target().is64Bit() &&\n                  comp()->useCompressedPointers() &&", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b68bd81fc15387f2c174fb35c0e8d282124f75c3"}, "originalPosition": 150}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "b68bd81fc15387f2c174fb35c0e8d282124f75c3", "author": {"user": {"login": "dsouzai", "name": "Irwin D'Souza"}}, "url": "https://github.com/eclipse-openj9/openj9/commit/b68bd81fc15387f2c174fb35c0e8d282124f75c3", "committedDate": "2020-01-03T19:34:57Z", "message": "Update copyrights\n\nSigned-off-by: Irwin D'Souza <dsouzai.gh@gmail.com>"}, "afterCommit": {"oid": "50564e70ea4eb51cd6f24423e3912c70f374d68c", "author": {"user": {"login": "dsouzai", "name": "Irwin D'Souza"}}, "url": "https://github.com/eclipse-openj9/openj9/commit/50564e70ea4eb51cd6f24423e3912c70f374d68c", "committedDate": "2020-01-09T21:08:13Z", "message": "Update copyrights\n\nSigned-off-by: Irwin D'Souza <dsouzai.gh@gmail.com>"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzQxMjM4MzI2", "url": "https://github.com/eclipse-openj9/openj9/pull/8199#pullrequestreview-341238326", "createdAt": "2020-01-10T15:31:15Z", "commit": {"oid": "50564e70ea4eb51cd6f24423e3912c70f374d68c"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "20b95129485f285935da74a77b3a6f48b7a83362", "author": {"user": {"login": "dsouzai", "name": "Irwin D'Souza"}}, "url": "https://github.com/eclipse-openj9/openj9/commit/20b95129485f285935da74a77b3a6f48b7a83362", "committedDate": "2020-01-10T19:53:01Z", "message": "Add TR::Compilation parameter\n\nIn order to facilitate the use of the compiler local target environment\nrather than the global target environment, this commit modifies the\nparameter list of a couple of static methods to take a\nTR::Compilation pointer.\n\nSigned-off-by: Irwin D'Souza <dsouzai.gh@gmail.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "fb7b8da08527e52ba78a9a14fd33beff0ff66e13", "author": {"user": {"login": "dsouzai", "name": "Irwin D'Souza"}}, "url": "https://github.com/eclipse-openj9/openj9/commit/fb7b8da08527e52ba78a9a14fd33beff0ff66e13", "committedDate": "2020-01-10T19:53:47Z", "message": "Use compiler local target environment\n\nSigned-off-by: Irwin D'Souza <dsouzai.gh@gmail.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "bcbc48207755785a728b869e8a02623ed7bf8c4a", "author": {"user": {"login": "dsouzai", "name": "Irwin D'Souza"}}, "url": "https://github.com/eclipse-openj9/openj9/commit/bcbc48207755785a728b869e8a02623ed7bf8c4a", "committedDate": "2020-01-10T19:53:47Z", "message": "Remove unnecessary queries of target environment\n\nSigned-off-by: Irwin D'Souza <dsouzai.gh@gmail.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "382887f2d47cc36ed9c92e41c7b69161ec3b8a7c", "author": {"user": {"login": "dsouzai", "name": "Irwin D'Souza"}}, "url": "https://github.com/eclipse-openj9/openj9/commit/382887f2d47cc36ed9c92e41c7b69161ec3b8a7c", "committedDate": "2020-01-10T19:53:47Z", "message": "Remove #if 0 guarded code\n\nSigned-off-by: Irwin D'Souza <dsouzai.gh@gmail.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "4df859b99a86a0e820b4cf5d0e3d6b454016db53", "author": {"user": {"login": "dsouzai", "name": "Irwin D'Souza"}}, "url": "https://github.com/eclipse-openj9/openj9/commit/4df859b99a86a0e820b4cf5d0e3d6b454016db53", "committedDate": "2020-01-10T19:53:48Z", "message": "Update copyrights\n\nSigned-off-by: Irwin D'Souza <dsouzai.gh@gmail.com>"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "50564e70ea4eb51cd6f24423e3912c70f374d68c", "author": {"user": {"login": "dsouzai", "name": "Irwin D'Souza"}}, "url": "https://github.com/eclipse-openj9/openj9/commit/50564e70ea4eb51cd6f24423e3912c70f374d68c", "committedDate": "2020-01-09T21:08:13Z", "message": "Update copyrights\n\nSigned-off-by: Irwin D'Souza <dsouzai.gh@gmail.com>"}, "afterCommit": {"oid": "4df859b99a86a0e820b4cf5d0e3d6b454016db53", "author": {"user": {"login": "dsouzai", "name": "Irwin D'Souza"}}, "url": "https://github.com/eclipse-openj9/openj9/commit/4df859b99a86a0e820b4cf5d0e3d6b454016db53", "committedDate": "2020-01-10T19:53:48Z", "message": "Update copyrights\n\nSigned-off-by: Irwin D'Souza <dsouzai.gh@gmail.com>"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 932, "cost": 1, "resetAt": "2021-10-28T18:00:02Z"}}}