{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDU3NTEzNDM3", "number": 10265, "title": "Switch to using fixedLoadLabelAddressIntoReg when loading snippet addresses", "bodyText": "The Power codegen contains a number of snippets where the address of an area within the snippet would need to be loaded from within mainline code. Previously, this was achieved by having each snippet manually patch mainline code and/or the pTOC to correspond to the correct address. This had several downsides, including introducing a lot of code duplication and making it much more difficult to exploit POWER10's new PC-relative paddi instruction to load such addresses.\nTo address this, these snippets have been updated to make use of the more generic fixedLoadLabelAddressIntoReg helper to load an arbitrary label address into a register. This will work correctly once eclipse/omr#5414 is merged, which moves relocation of pTOC entries containing labels to after snippet emission.", "createdAt": "2020-07-28T03:16:03Z", "url": "https://github.com/eclipse-openj9/openj9/pull/10265", "merged": true, "mergeCommit": {"oid": "04a8b9eb9033e0df0e104a54dec8ad934ce7c26c"}, "closed": true, "closedAt": "2020-08-24T20:11:27Z", "author": {"login": "aviansie-ben"}, "timelineItems": {"totalCount": 7, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABc5bDtLgBqjM1OTU3MjYxMjg=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdAN2eRAFqTQ2OTg0MTk0MA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "3ac704eceee1bb5ff9b6adf5b90deeab13b53f49", "author": {"user": {"login": "aviansie-ben", "name": "Ben Thomas (Aviansie Ben)"}}, "url": "https://github.com/eclipse-openj9/openj9/commit/3ac704eceee1bb5ff9b6adf5b90deeab13b53f49", "committedDate": "2020-07-28T03:06:08Z", "message": "Use fixedLoadLabelAddressIntoReg for PPCInterfaceCallSnippet\n\nPreviously, the address of the PPCInterfaceCallSnippet data section\nwould be loaded in mainline code by having the snippet manually either\npatch instructions in mainline code or fill in the pTOC with the correct\naddress.\n\nIn order to simplify this code and allow exploitation of P10 PC-relative\npaddi, this code has been modified to use the fixedLoadLabelAddressIntoReg\nhelper to accomplish this task.\n\nSigned-off-by: Ben Thomas <ben@benthomas.ca>"}, "afterCommit": {"oid": "2628732dfe516453b63918c8add6f2f4fb140381", "author": {"user": {"login": "aviansie-ben", "name": "Ben Thomas (Aviansie Ben)"}}, "url": "https://github.com/eclipse-openj9/openj9/commit/2628732dfe516453b63918c8add6f2f4fb140381", "committedDate": "2020-07-28T18:50:46Z", "message": "Use fixedLoadLabelAddressIntoReg for PPCInterfaceCallSnippet\n\nPreviously, the address of the PPCInterfaceCallSnippet data section\nwould be loaded in mainline code by having the snippet manually either\npatch instructions in mainline code or fill in the pTOC with the correct\naddress.\n\nIn order to simplify this code and allow exploitation of P10 PC-relative\npaddi, this code has been modified to use the fixedLoadLabelAddressIntoReg\nhelper to accomplish this task.\n\nSigned-off-by: Ben Thomas <ben@benthomas.ca>"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "2628732dfe516453b63918c8add6f2f4fb140381", "author": {"user": {"login": "aviansie-ben", "name": "Ben Thomas (Aviansie Ben)"}}, "url": "https://github.com/eclipse-openj9/openj9/commit/2628732dfe516453b63918c8add6f2f4fb140381", "committedDate": "2020-07-28T18:50:46Z", "message": "Use fixedLoadLabelAddressIntoReg for PPCInterfaceCallSnippet\n\nPreviously, the address of the PPCInterfaceCallSnippet data section\nwould be loaded in mainline code by having the snippet manually either\npatch instructions in mainline code or fill in the pTOC with the correct\naddress.\n\nIn order to simplify this code and allow exploitation of P10 PC-relative\npaddi, this code has been modified to use the fixedLoadLabelAddressIntoReg\nhelper to accomplish this task.\n\nSigned-off-by: Ben Thomas <ben@benthomas.ca>"}, "afterCommit": {"oid": "db165c3057092eff9bfb9524ab29931a9e4e74fa", "author": {"user": {"login": "aviansie-ben", "name": "Ben Thomas (Aviansie Ben)"}}, "url": "https://github.com/eclipse-openj9/openj9/commit/db165c3057092eff9bfb9524ab29931a9e4e74fa", "committedDate": "2020-07-27T20:39:37Z", "message": "Use fixedLoadLabelAddressIntoReg for Power field watch snippets\n\nPreviously, the address of Power static and instance field watch\nsnippets was being loaded into a register by having the snippet manually\npatch mainline code and fill in the pTOC where necessary. This has been\nsimplified by using fixedLoadLabelAddressIntoReg to load the address of\nthe snippet label. In addition to reducing code complexity, this allows\nPC-relative paddi to be used when POWER10 support is enabled.\n\nSigned-off-by: Ben Thomas <ben@benthomas.ca>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "3fb2dfd068ca332095c5ff8948c9f1afa2e9bea6", "author": {"user": {"login": "aviansie-ben", "name": "Ben Thomas (Aviansie Ben)"}}, "url": "https://github.com/eclipse-openj9/openj9/commit/3fb2dfd068ca332095c5ff8948c9f1afa2e9bea6", "committedDate": "2020-08-11T19:55:16Z", "message": "Use fixedLoadLabelAddressIntoReg for Power field watch snippets\n\nPreviously, the address of Power static and instance field watch\nsnippets was being loaded into a register by having the snippet manually\npatch mainline code and fill in the pTOC where necessary. This has been\nsimplified by using fixedLoadLabelAddressIntoReg to load the address of\nthe snippet label. In addition to reducing code complexity, this allows\nPC-relative paddi to be used when POWER10 support is enabled.\n\nSigned-off-by: Ben Thomas <ben@benthomas.ca>"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "db165c3057092eff9bfb9524ab29931a9e4e74fa", "author": {"user": {"login": "aviansie-ben", "name": "Ben Thomas (Aviansie Ben)"}}, "url": "https://github.com/eclipse-openj9/openj9/commit/db165c3057092eff9bfb9524ab29931a9e4e74fa", "committedDate": "2020-07-27T20:39:37Z", "message": "Use fixedLoadLabelAddressIntoReg for Power field watch snippets\n\nPreviously, the address of Power static and instance field watch\nsnippets was being loaded into a register by having the snippet manually\npatch mainline code and fill in the pTOC where necessary. This has been\nsimplified by using fixedLoadLabelAddressIntoReg to load the address of\nthe snippet label. In addition to reducing code complexity, this allows\nPC-relative paddi to be used when POWER10 support is enabled.\n\nSigned-off-by: Ben Thomas <ben@benthomas.ca>"}, "afterCommit": {"oid": "3fb2dfd068ca332095c5ff8948c9f1afa2e9bea6", "author": {"user": {"login": "aviansie-ben", "name": "Ben Thomas (Aviansie Ben)"}}, "url": "https://github.com/eclipse-openj9/openj9/commit/3fb2dfd068ca332095c5ff8948c9f1afa2e9bea6", "committedDate": "2020-08-11T19:55:16Z", "message": "Use fixedLoadLabelAddressIntoReg for Power field watch snippets\n\nPreviously, the address of Power static and instance field watch\nsnippets was being loaded into a register by having the snippet manually\npatch mainline code and fill in the pTOC where necessary. This has been\nsimplified by using fixedLoadLabelAddressIntoReg to load the address of\nthe snippet label. In addition to reducing code complexity, this allows\nPC-relative paddi to be used when POWER10 support is enabled.\n\nSigned-off-by: Ben Thomas <ben@benthomas.ca>"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDY1OTU5NjA5", "url": "https://github.com/eclipse-openj9/openj9/pull/10265#pullrequestreview-465959609", "createdAt": "2020-08-12T14:15:58Z", "commit": {"oid": "3fb2dfd068ca332095c5ff8948c9f1afa2e9bea6"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDY5NzkwNTc1", "url": "https://github.com/eclipse-openj9/openj9/pull/10265#pullrequestreview-469790575", "createdAt": "2020-08-18T20:02:48Z", "commit": {"oid": "3fb2dfd068ca332095c5ff8948c9f1afa2e9bea6"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xOFQyMDowMjo0OFrOHCj6xg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xOFQyMDowMjo0OFrOHCj6xg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MjQ0NzY4Ng==", "bodyText": "I suppose TR::J9WatchedInstanceFieldSnippet::emitSnippetBody()  is still going to happen?", "url": "https://github.com/eclipse-openj9/openj9/pull/10265#discussion_r472447686", "createdAt": "2020-08-18T20:02:48Z", "author": {"login": "gita-omr"}, "path": "runtime/compiler/p/codegen/J9PPCWatchedInstanceFieldSnippet.cpp", "diffHunk": "@@ -1,65 +0,0 @@\n-/*******************************************************************************\n- * Copyright (c) 2019, 2020 IBM Corp. and others\n- *\n- * This program and the accompanying materials are made available under\n- * the terms of the Eclipse Public License 2.0 which accompanies this\n- * distribution and is available at https://www.eclipse.org/legal/epl-2.0/\n- * or the Apache License, Version 2.0 which accompanies this distribution and\n- * is available at https://www.apache.org/licenses/LICENSE-2.0.\n- *\n- * This Source Code may also be made available under the following\n- * Secondary Licenses when the conditions for such availability set\n- * forth in the Eclipse Public License, v. 2.0 are satisfied: GNU\n- * General Public License, version 2 with the GNU Classpath\n- * Exception [1] and GNU General Public License, version 2 with the\n- * OpenJDK Assembly Exception [2].\n- *\n- * [1] https://www.gnu.org/software/classpath/license.html\n- * [2] http://openjdk.java.net/legal/assembly-exception.html\n- *\n- * SPDX-License-Identifier: EPL-2.0 OR Apache-2.0 OR GPL-2.0 WITH Classpath-exception-2.0 OR LicenseRef-GPL-2.0 WITH Assembly-exception\n- *******************************************************************************/\n-\n-#include \"codegen/J9PPCWatchedInstanceFieldSnippet.hpp\"\n-#include \"p/codegen/PPCTableOfConstants.hpp\" //PTOC\n-\n-\n-uint8_t *TR::J9PPCWatchedInstanceFieldSnippet::emitSnippetBody()\n-   {\n-   // Call Base class's emitSnippetBody() to populate the snippet\n-   // Here Binary Buffer will be ahead by the size of the struct J9JITWatchedInstanceFieldData\n-   uint8_t *snippetLocation = (TR::J9WatchedInstanceFieldSnippet::emitSnippetBody() - TR::J9WatchedInstanceFieldSnippet::getLength(0));", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "3fb2dfd068ca332095c5ff8948c9f1afa2e9bea6"}, "originalPosition": 31}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDY5ODQxOTQw", "url": "https://github.com/eclipse-openj9/openj9/pull/10265#pullrequestreview-469841940", "createdAt": "2020-08-18T21:25:30Z", "commit": {"oid": "3fb2dfd068ca332095c5ff8948c9f1afa2e9bea6"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 371, "cost": 1, "resetAt": "2021-10-28T17:48:14Z"}}}