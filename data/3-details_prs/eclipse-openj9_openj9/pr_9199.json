{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDAxNDQ5MjU1", "number": 9199, "title": "Warn when opening a truncated core file", "bodyText": "With this, jdmpview will, like jextract warn about truncated core files:\n$ jdmpview -core aix.core.dmp\nDTFJView version 4.29.5, using DTFJ version 1.12.29003\nLoading image from DTFJ...\n\nWarning: dump file is truncated. Extracted information may be incomplete.\nFor a list of commands, type \"help\"; for how to use \"help\", type \"help help\"\nAvailable contexts (* = currently selected context) : \n\nSource : file:///home/keithc/space/openj9/jdmpview/aix.core.dmp\n\t*0 : PID: 8323202 : No JRE\n\n>", "createdAt": "2020-04-09T14:14:42Z", "url": "https://github.com/eclipse-openj9/openj9/pull/9199", "merged": true, "mergeCommit": {"oid": "e12d1e20dd61e80c47564fbca19390106eaa892c"}, "closed": true, "closedAt": "2020-04-09T19:59:28Z", "author": {"login": "keithc-ca"}, "timelineItems": {"totalCount": 5, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcV9Np-gBqjMyMTg1MDI2MjY=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcWB5PzgFqTM5MTA4MjAzNg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "af854670d6a74e1e659aa5b4d8b26aac082f6a0d", "author": {"user": {"login": "keithc-ca", "name": "Keith W. Campbell"}}, "url": "https://github.com/eclipse-openj9/openj9/commit/af854670d6a74e1e659aa5b4d8b26aac082f6a0d", "committedDate": "2020-04-09T13:45:32Z", "message": "Warn when opening a truncated core file\n\nSigned-off-by: Keith W. Campbell <keithc@ca.ibm.com>"}, "afterCommit": {"oid": "2a30679ccf7548f186c7ebc446de72b871b9b593", "author": {"user": {"login": "keithc-ca", "name": "Keith W. Campbell"}}, "url": "https://github.com/eclipse-openj9/openj9/commit/2a30679ccf7548f186c7ebc446de72b871b9b593", "committedDate": "2020-04-09T14:17:08Z", "message": "Warn when opening a truncated core file\n\nSigned-off-by: Keith W. Campbell <keithc@ca.ibm.com>"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzkwODUxMDYy", "url": "https://github.com/eclipse-openj9/openj9/pull/9199#pullrequestreview-390851062", "createdAt": "2020-04-09T14:35:27Z", "commit": {"oid": "2a30679ccf7548f186c7ebc446de72b871b9b593"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wOVQxNDozNToyN1rOGDbkNA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wOVQxNDozNToyN1rOGDbkNA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNjI1MDU0OA==", "bodyText": "I think there should be a blank line after this warning, to help it stand out from the help text.", "url": "https://github.com/eclipse-openj9/openj9/pull/9199#discussion_r406250548", "createdAt": "2020-04-09T14:35:27Z", "author": {"login": "pshipton"}, "path": "jcl/src/openj9.dtfjview/share/classes/com/ibm/jvm/dtfjview/commands/OpenCommand.java", "diffHunk": "@@ -128,100 +127,113 @@ private void imagesFromCommandLine(String args[]) {\n \t\t\t}\n \t\t}\n \t}\n-\t\n+\n \tprivate ImageFactory getFactory() {\n-\t\tif(factory != null) {\n+\t\tif (factory != null) {\n \t\t\treturn factory;\n \t\t}\n \t\ttry {\n \t\t\tClass<?> factoryClass = Class.forName(factoryName);\n-\t\t\tfactory = (ImageFactory)factoryClass.newInstance();\n+\t\t\tfactory = (ImageFactory) factoryClass.newInstance();\n \t\t} catch (ClassNotFoundException e) {\n \t\t\tout.println(\"ClassNotFoundException while getting ImageFactory: \" + e.getMessage());\n \t\t\tout.println(\"Use -D\" + SYSPROP_FACTORY + \"=<classname> to change the ImageFactory\");\n \t\t\tSystem.exit(JDMPVIEW_SYNTAX_ERROR);\n-\t\t} catch (InstantiationException e) {\n-\t\t\tout.println(\"InstantiationException while getting ImageFactory: \" + e.getMessage());\n+\t\t} catch (ClassCastException e) {\n+\t\t\tout.println(\"ClassCastException while getting ImageFactory: \" + e.getMessage());\n \t\t\tSystem.exit(JDMPVIEW_SYNTAX_ERROR);\n \t\t} catch (IllegalAccessException e) {\n \t\t\tout.println(\"IllegalAccessException while getting ImageFactory: \" + e.getMessage());\n \t\t\tSystem.exit(JDMPVIEW_SYNTAX_ERROR);\n+\t\t} catch (InstantiationException e) {\n+\t\t\tout.println(\"InstantiationException while getting ImageFactory: \" + e.getMessage());\n+\t\t\tSystem.exit(JDMPVIEW_SYNTAX_ERROR);\n \t\t}\n \t\treturn factory;\n \t}\n \t\n \t\n \tprivate void createContexts(Image loadedImage, String coreFilePath) {\n-\t\tif(loadedImage == null) {\n-\t\t\t//cannot create any contexts as an image has not been obtained\n+\t\tif (loadedImage == null) {\n+\t\t\t// cannot create any contexts as an image has not been obtained\n \t\t\treturn;\n \t\t}\n \t\tboolean hasContexts = false;\n \t\tIterator<?> spaces = loadedImage.getAddressSpaces();\n-\t\twhile(spaces.hasNext()) {\n+\t\twhile (spaces.hasNext()) {\n \t\t\tObject o = spaces.next();\n-\t\t\tif(o instanceof ImageAddressSpace) {\n-\t\t\t\tImageAddressSpace space = (ImageAddressSpace) o;\n-\t\t\t\tIterator<?> procs = space.getProcesses();\n-\t\t\t\tif(procs.hasNext()) {\n-\t\t\t\t\twhile(procs.hasNext()) {\n-\t\t\t\t\t\to = procs.next();\n-\t\t\t\t\t\tif(o instanceof ImageProcess) {\n-\t\t\t\t\t\t\tImageProcess proc = (ImageProcess) o;\n-\t\t\t\t\t\t\tIterator<?> runtimes = proc.getRuntimes();\n-\t\t\t\t\t\t\tif(runtimes.hasNext()) {\n-\t\t\t\t\t\t\t\twhile(runtimes.hasNext()) {\n-\t\t\t\t\t\t\t\t\to = runtimes.next();\n-\t\t\t\t\t\t\t\t\tif(o instanceof JavaRuntime) {\n-\t\t\t\t\t\t\t\t\t\tcreateCombinedContext(loadedImage, apiLevelMajor, apiLevelMinor, space, proc, (JavaRuntime)o, coreFilePath);\n-\t\t\t\t\t\t\t\t\t\thasContexts = true;\n-\t\t\t\t\t\t\t\t\t} else if (o instanceof CorruptData) {\n-\t\t\t\t\t\t\t\t\t\tlogger.fine(\"CorruptData encountered in ImageProcess.getRuntimes(): \" + ((CorruptData)o).toString());\n-\t\t\t\t\t\t\t\t\t\tcreateCombinedContext(loadedImage, apiLevelMajor, apiLevelMinor, space, proc, null, coreFilePath);\n-\t\t\t\t\t\t\t\t\t\thasContexts = true;\n-\t\t\t\t\t\t\t\t\t} else {\n-\t\t\t\t\t\t\t\t\t\tlogger.fine(\"Unexpected class encountered in ImageProcess.getRuntimes()\");\n-\t\t\t\t\t\t\t\t\t\tcreateCombinedContext(loadedImage, apiLevelMajor, apiLevelMinor, space, proc, null, coreFilePath);\n-\t\t\t\t\t\t\t\t\t\thasContexts = true;\n-\t\t\t\t\t\t\t\t\t}\n-\t\t\t\t\t\t\t\t}\n-\t\t\t\t\t\t\t} else {\n-\t\t\t\t\t\t\t\t//there are no runtimes so create a context for this process\n-\t\t\t\t\t\t\t\tcreateCombinedContext(loadedImage, apiLevelMajor, apiLevelMinor, space, proc, null, coreFilePath);\n-\t\t\t\t\t\t\t\thasContexts = true;\n-\t\t\t\t\t\t\t}\n-\t\t\t\t\t\t}\n-\t\t\t\t\t}\n-\t\t\t\t} else {\n-\t\t\t\t\t//context with only an address space\n-\t\t\t\t\tcreateCombinedContext(loadedImage, apiLevelMajor, apiLevelMinor, space, null, null, coreFilePath);\n+\t\t\tif (!(o instanceof ImageAddressSpace)) {\n+\t\t\t\t// need a representation of a corrupt context\n+\t\t\t\tlogger.fine(\"Skipping corrupt ImageAddress space\");\n+\t\t\t\tcontinue;\n+\t\t\t}\n+\n+\t\t\tImageAddressSpace space = (ImageAddressSpace) o;\n+\t\t\tIterator<?> procs = space.getProcesses();\n+\t\t\tif (!procs.hasNext()) {\n+\t\t\t\t// context with only an address space\n+\t\t\t\tcreateCombinedContext(loadedImage, apiLevelMajor, apiLevelMinor, space, null, null, coreFilePath);\n+\t\t\t\thasContexts = true;\n+\t\t\t\tcontinue;\n+\t\t\t}\n+\n+\t\t\twhile (procs.hasNext()) {\n+\t\t\t\to = procs.next();\n+\t\t\t\tif (!(o instanceof ImageProcess)) {\n+\t\t\t\t\tcontinue;\n+\t\t\t\t}\n+\n+\t\t\t\tImageProcess proc = (ImageProcess) o;\n+\t\t\t\tIterator<?> runtimes = proc.getRuntimes();\n+\n+\t\t\t\tif (!runtimes.hasNext()) {\n+\t\t\t\t\t// there are no runtimes so create a context for this process\n+\t\t\t\t\tcreateCombinedContext(loadedImage, apiLevelMajor, apiLevelMinor, space, proc, null, coreFilePath);\n \t\t\t\t\thasContexts = true;\n+\t\t\t\t\tcontinue;\n+\t\t\t\t}\n+\n+\t\t\t\twhile (runtimes.hasNext()) {\n+\t\t\t\t\to = runtimes.next();\n+\t\t\t\t\tif (o instanceof JavaRuntime) {\n+\t\t\t\t\t\tcreateCombinedContext(loadedImage, apiLevelMajor, apiLevelMinor, space, proc, (JavaRuntime) o, coreFilePath);\n+\t\t\t\t\t\thasContexts = true;\n+\t\t\t\t\t} else if (o instanceof CorruptData) {\n+\t\t\t\t\t\tlogger.fine(\"CorruptData encountered in ImageProcess.getRuntimes(): \" + o);\n+\t\t\t\t\t\tcreateCombinedContext(loadedImage, apiLevelMajor, apiLevelMinor, space, proc, null, coreFilePath);\n+\t\t\t\t\t\thasContexts = true;\n+\t\t\t\t\t} else {\n+\t\t\t\t\t\tlogger.fine(\"Unexpected class encountered in ImageProcess.getRuntimes()\");\n+\t\t\t\t\t\tcreateCombinedContext(loadedImage, apiLevelMajor, apiLevelMinor, space, proc, null, coreFilePath);\n+\t\t\t\t\t\thasContexts = true;\n+\t\t\t\t\t}\n \t\t\t\t}\n-\t\t\t} else {\n-\t\t\t\t//need a representation of a corrupt context\n-\t\t\t\tlogger.fine(\"Skipping corrupt ImageAddress space\");\n \t\t\t}\n \t\t}\n-\t\tif(!hasContexts) {\n-\t\t\tif(ctx.hasPropertyBeenSet(VERBOSE_MODE_PROPERTY)) {\n-\t\t\t\tout.println(\"Warning : no contexts were found, is this a valid core file ?\");\n+\t\tif (!hasContexts) {\n+\t\t\tif (ctx.hasPropertyBeenSet(VERBOSE_MODE_PROPERTY)) {\n+\t\t\t\tout.println(\"Warning: no contexts were found, is this a valid core file?\");\n+\t\t\t}\n+\t\t} else {\n+\t\t\tif (loadedImage.isTruncated()) {\n+\t\t\t\tout.println(\"Warning: dump file is truncated. Extracted information may be incomplete.\");", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "2a30679ccf7548f186c7ebc446de72b871b9b593"}, "originalPosition": 213}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a8d2bf8a1677fb39d6821ec2a6671b8f7848fa89", "author": {"user": {"login": "keithc-ca", "name": "Keith W. Campbell"}}, "url": "https://github.com/eclipse-openj9/openj9/commit/a8d2bf8a1677fb39d6821ec2a6671b8f7848fa89", "committedDate": "2020-04-09T17:47:58Z", "message": "Warn when opening a truncated core file\n\nSigned-off-by: Keith W. Campbell <keithc@ca.ibm.com>"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "2a30679ccf7548f186c7ebc446de72b871b9b593", "author": {"user": {"login": "keithc-ca", "name": "Keith W. Campbell"}}, "url": "https://github.com/eclipse-openj9/openj9/commit/2a30679ccf7548f186c7ebc446de72b871b9b593", "committedDate": "2020-04-09T14:17:08Z", "message": "Warn when opening a truncated core file\n\nSigned-off-by: Keith W. Campbell <keithc@ca.ibm.com>"}, "afterCommit": {"oid": "a8d2bf8a1677fb39d6821ec2a6671b8f7848fa89", "author": {"user": {"login": "keithc-ca", "name": "Keith W. Campbell"}}, "url": "https://github.com/eclipse-openj9/openj9/commit/a8d2bf8a1677fb39d6821ec2a6671b8f7848fa89", "committedDate": "2020-04-09T17:47:58Z", "message": "Warn when opening a truncated core file\n\nSigned-off-by: Keith W. Campbell <keithc@ca.ibm.com>"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzkxMDgyMDM2", "url": "https://github.com/eclipse-openj9/openj9/pull/9199#pullrequestreview-391082036", "createdAt": "2020-04-09T19:44:52Z", "commit": {"oid": "a8d2bf8a1677fb39d6821ec2a6671b8f7848fa89"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1240, "cost": 1, "resetAt": "2021-10-28T17:48:14Z"}}}