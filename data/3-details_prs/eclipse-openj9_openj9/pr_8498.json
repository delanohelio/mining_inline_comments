{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0MzcxMDE1MTEx", "number": 8498, "title": "Use 25% RAM as default maximum heap size for Java 8", "bodyText": "- new -XX:[+-]OriginalJDK8HeapSizeCompatibilityMode option\n- recognize this option in Java 8 only, ignore in Java 11 and higher\n- use 512m as default for heap size if\n -XX:+OriginalJDK8HeapSizeCompatibilityMode option is\n provided explicitly.\n\nDoc PR eclipse-openj9/openj9-docs#509\nSigned-off-by: Lin Hu linhu@ca.ibm.com", "createdAt": "2020-02-04T19:39:29Z", "url": "https://github.com/eclipse-openj9/openj9/pull/8498", "merged": true, "mergeCommit": {"oid": "c92eff7b1fbec6776b0bab23c083f83dd58bed0d"}, "closed": true, "closedAt": "2020-02-19T22:41:05Z", "author": {"login": "LinHu2016"}, "timelineItems": {"totalCount": 24, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcBG9bcAFqTM1MzI1Mjk2NQ==", "endCursor": "Y3Vyc29yOnYyOpPPAAABcF8G75gFqTM2MTM5Mzk1MQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzUzMjUyOTY1", "url": "https://github.com/eclipse-openj9/openj9/pull/8498#pullrequestreview-353252965", "createdAt": "2020-02-04T19:46:31Z", "commit": {"oid": "4f124948956d1fd99bc3acd2df970f3dbf08f9de"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0wNFQxOTo0NjozMVrOFlhK1g==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0wNFQxOTo0NjozMVrOFlhK1g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NDg4NTA3OA==", "bodyText": "I believe would be better to have <= J2SE_V8", "url": "https://github.com/eclipse-openj9/openj9/pull/8498#discussion_r374885078", "createdAt": "2020-02-04T19:46:31Z", "author": {"login": "dmitripivkine"}, "path": "runtime/gc_base/GCExtensions.cpp", "diffHunk": "@@ -235,6 +236,24 @@ MM_GCExtensions::updateIdentityHashDataForSaltIndex(UDATA index)\n \tgetJavaVM()->identityHashData->hashSaltTable[index] = (U_32)convertValueToHash(getJavaVM(), getJavaVM()->identityHashData->hashSaltTable[index]);\n }\n \n+BOOLEAN\n+MM_GCExtensions::isOriginalJDK8HeapSizeCompatibilityOptionsEanbled(MM_EnvironmentBase* env)\n+{\n+\tJ9JavaVM* vm = (J9JavaVM *)getOmrVM()->_language_vm;\n+\tBOOLEAN enabled = FALSE;\n+\t/* Java 11 or above would ignore VMOPT_XXENABLEORIGINALJDK8HEAPSIZECOMPATIBILITY option */\n+\tif (J2SE_VERSION((J9JavaVM *)getOmrVM()->_language_vm) < J2SE_V11) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "4f124948956d1fd99bc3acd2df970f3dbf08f9de"}, "originalPosition": 26}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzUzMjYxMTU0", "url": "https://github.com/eclipse-openj9/openj9/pull/8498#pullrequestreview-353261154", "createdAt": "2020-02-04T19:59:19Z", "commit": {"oid": "4f124948956d1fd99bc3acd2df970f3dbf08f9de"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0wNFQxOTo1OToxOVrOFlhjxw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0wNFQxOTo1OToxOVrOFlhjxw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NDg5MTQ2Mw==", "bodyText": "This code can be organized better. There is an example from jvminit.c (you don't need else if case):\n\t{\n\t\tIDATA enablePositiveHashCode = FIND_AND_CONSUME_ARG(EXACT_MATCH, VMOPT_XXENABLEPOSITIVEHASHCODE, NULL);\n\t\tIDATA disablePositiveHashCode = FIND_AND_CONSUME_ARG(EXACT_MATCH, VMOPT_XXDISABLEPOSITIVEHASHCODE, NULL);\n\t\tif (enablePositiveHashCode > disablePositiveHashCode) {\n\t\t\tvm->extendedRuntimeFlags |= J9_EXTENDED_RUNTIME_POSITIVE_HASHCODE;\n\t\t} else if (enablePositiveHashCode < disablePositiveHashCode) {\n\t\t\tvm->extendedRuntimeFlags &= ~(UDATA)J9_EXTENDED_RUNTIME_POSITIVE_HASHCODE;\n\t\t}\n\t}", "url": "https://github.com/eclipse-openj9/openj9/pull/8498#discussion_r374891463", "createdAt": "2020-02-04T19:59:19Z", "author": {"login": "dmitripivkine"}, "path": "runtime/gc_base/GCExtensions.cpp", "diffHunk": "@@ -235,6 +236,24 @@ MM_GCExtensions::updateIdentityHashDataForSaltIndex(UDATA index)\n \tgetJavaVM()->identityHashData->hashSaltTable[index] = (U_32)convertValueToHash(getJavaVM(), getJavaVM()->identityHashData->hashSaltTable[index]);\n }\n \n+BOOLEAN\n+MM_GCExtensions::isOriginalJDK8HeapSizeCompatibilityOptionsEanbled(MM_EnvironmentBase* env)\n+{\n+\tJ9JavaVM* vm = (J9JavaVM *)getOmrVM()->_language_vm;\n+\tBOOLEAN enabled = FALSE;\n+\t/* Java 11 or above would ignore VMOPT_XXENABLEORIGINALJDK8HEAPSIZECOMPATIBILITY option */\n+\tif (J2SE_VERSION((J9JavaVM *)getOmrVM()->_language_vm) < J2SE_V11) {\n+\t\tIDATA argIndex = FIND_AND_CONSUME_ARG(EXACT_MATCH, VMOPT_XXENABLEORIGINALJDK8HEAPSIZECOMPATIBILITY, NULL);\n+\t\tif (-1 != argIndex) {\n+\t\t\tIDATA argIndex2 = FIND_AND_CONSUME_ARG(EXACT_MATCH, VMOPT_XXDISABLEORIGINALJDK8HEAPSIZECOMPATIBILITY, NULL);\n+\t\t\tif (argIndex > argIndex2) {\n+\t\t\t\tenabled = TRUE;\n+\t\t\t}\n+\t\t}\n+\t}\n+\treturn enabled;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "4f124948956d1fd99bc3acd2df970f3dbf08f9de"}, "originalPosition": 35}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "4f124948956d1fd99bc3acd2df970f3dbf08f9de", "author": {"user": {"login": "LinHu2016", "name": "Lin Hu"}}, "url": "https://github.com/eclipse-openj9/openj9/commit/4f124948956d1fd99bc3acd2df970f3dbf08f9de", "committedDate": "2020-02-04T19:35:39Z", "message": "Use 25% RAM as default maximum heap size for Java 8\n\n\t- new -XX:[+-]OriginalJDK8HeapSizeCompatibilityMode option\n\t- recognize this option in Java 8 only, ignore in Java 11 and higher\n\t- use 512m as default for heap size if\n\t -XX:+OriginalJDK8HeapSizeCompatibilityMode option is\n\t provided explicitly.\n\nSigned-off-by: Lin Hu <linhu@ca.ibm.com>"}, "afterCommit": {"oid": "982f4d37ae0c355dc61e6c4348578d85918d5fd5", "author": {"user": {"login": "LinHu2016", "name": "Lin Hu"}}, "url": "https://github.com/eclipse-openj9/openj9/commit/982f4d37ae0c355dc61e6c4348578d85918d5fd5", "committedDate": "2020-02-05T16:48:34Z", "message": "Use 25% RAM as default maximum heap size for Java 8\n\n\t- new -XX:[+-]OriginalJDK8HeapSizeCompatibilityMode option\n\t- recognize this option in Java 8 only, ignore in Java 11 and higher\n\t- use 512m as default for heap size if\n\t -XX:+OriginalJDK8HeapSizeCompatibilityMode option is\n\t provided explicitly.\n\nSigned-off-by: Lin Hu <linhu@ca.ibm.com>"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "982f4d37ae0c355dc61e6c4348578d85918d5fd5", "author": {"user": {"login": "LinHu2016", "name": "Lin Hu"}}, "url": "https://github.com/eclipse-openj9/openj9/commit/982f4d37ae0c355dc61e6c4348578d85918d5fd5", "committedDate": "2020-02-05T16:48:34Z", "message": "Use 25% RAM as default maximum heap size for Java 8\n\n\t- new -XX:[+-]OriginalJDK8HeapSizeCompatibilityMode option\n\t- recognize this option in Java 8 only, ignore in Java 11 and higher\n\t- use 512m as default for heap size if\n\t -XX:+OriginalJDK8HeapSizeCompatibilityMode option is\n\t provided explicitly.\n\nSigned-off-by: Lin Hu <linhu@ca.ibm.com>"}, "afterCommit": {"oid": "a35a8d9bd659e5bc789404bea3aaae6618ac15e4", "author": {"user": {"login": "LinHu2016", "name": "Lin Hu"}}, "url": "https://github.com/eclipse-openj9/openj9/commit/a35a8d9bd659e5bc789404bea3aaae6618ac15e4", "committedDate": "2020-02-06T16:12:20Z", "message": "Use 25% RAM as default maximum heap size for Java 8\n\n\t- new -XX:[+-]OriginalJDK8HeapSizeCompatibilityMode option\n\t- recognize this option in Java 8 only, ignore in Java 11 and higher\n\t- use 512m as default for heap size if\n\t -XX:+OriginalJDK8HeapSizeCompatibilityMode option is\n\t provided explicitly.\n\nSigned-off-by: Lin Hu <linhu@ca.ibm.com>"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "a35a8d9bd659e5bc789404bea3aaae6618ac15e4", "author": {"user": {"login": "LinHu2016", "name": "Lin Hu"}}, "url": "https://github.com/eclipse-openj9/openj9/commit/a35a8d9bd659e5bc789404bea3aaae6618ac15e4", "committedDate": "2020-02-06T16:12:20Z", "message": "Use 25% RAM as default maximum heap size for Java 8\n\n\t- new -XX:[+-]OriginalJDK8HeapSizeCompatibilityMode option\n\t- recognize this option in Java 8 only, ignore in Java 11 and higher\n\t- use 512m as default for heap size if\n\t -XX:+OriginalJDK8HeapSizeCompatibilityMode option is\n\t provided explicitly.\n\nSigned-off-by: Lin Hu <linhu@ca.ibm.com>"}, "afterCommit": {"oid": "8ddf7ccccb6cfcd6f807fda68eae0054161c6a06", "author": {"user": {"login": "LinHu2016", "name": "Lin Hu"}}, "url": "https://github.com/eclipse-openj9/openj9/commit/8ddf7ccccb6cfcd6f807fda68eae0054161c6a06", "committedDate": "2020-02-06T16:19:54Z", "message": "Use 25% RAM as default maximum heap size for Java 8\n\n\t- new -XX:[+-]OriginalJDK8HeapSizeCompatibilityMode option\n\t- recognize this option in Java 8 only, ignore in Java 11 and higher\n\t- use 512m as default for heap size if\n\t -XX:+OriginalJDK8HeapSizeCompatibilityMode option is\n\t provided explicitly.\n\nSigned-off-by: Lin Hu <linhu@ca.ibm.com>"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "8ddf7ccccb6cfcd6f807fda68eae0054161c6a06", "author": {"user": {"login": "LinHu2016", "name": "Lin Hu"}}, "url": "https://github.com/eclipse-openj9/openj9/commit/8ddf7ccccb6cfcd6f807fda68eae0054161c6a06", "committedDate": "2020-02-06T16:19:54Z", "message": "Use 25% RAM as default maximum heap size for Java 8\n\n\t- new -XX:[+-]OriginalJDK8HeapSizeCompatibilityMode option\n\t- recognize this option in Java 8 only, ignore in Java 11 and higher\n\t- use 512m as default for heap size if\n\t -XX:+OriginalJDK8HeapSizeCompatibilityMode option is\n\t provided explicitly.\n\nSigned-off-by: Lin Hu <linhu@ca.ibm.com>"}, "afterCommit": {"oid": "cff345594d5506026b31e8bc030e1493ca081a67", "author": {"user": {"login": "LinHu2016", "name": "Lin Hu"}}, "url": "https://github.com/eclipse-openj9/openj9/commit/cff345594d5506026b31e8bc030e1493ca081a67", "committedDate": "2020-02-06T21:47:37Z", "message": "Use 25% RAM as default maximum heap size for Java 8\n\n\t- new -XX:[+-]OriginalJDK8HeapSizeCompatibilityMode option\n\t- recognize this option in Java 8 only, ignore in Java 11 and higher\n\t- use 512m as default for heap size if\n\t -XX:+OriginalJDK8HeapSizeCompatibilityMode option is\n\t provided explicitly.\n\nSigned-off-by: Lin Hu <linhu@ca.ibm.com>"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzU1MjA5MTgy", "url": "https://github.com/eclipse-openj9/openj9/pull/8498#pullrequestreview-355209182", "createdAt": "2020-02-07T14:52:31Z", "commit": {"oid": "cff345594d5506026b31e8bc030e1493ca081a67"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0wN1QxNDo1MjozMlrOFm_h8g==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0wN1QxNDo1MjozMlrOFm_h8g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NjQzMTA5MA==", "bodyText": "This is pure C function, so all declarations must be done at the beginning of the function. This line does not create problem just because it happen still to be in declaration section. But in general the functionality (described in name) is very local to be defined in declaration section. The solution might be wrap this code to extra {``} to define local section.", "url": "https://github.com/eclipse-openj9/openj9/pull/8498#discussion_r376431090", "createdAt": "2020-02-07T14:52:32Z", "author": {"login": "dmitripivkine"}, "path": "runtime/gc_modron_startup/mmparse.cpp", "diffHunk": "@@ -1472,6 +1472,19 @@ gcParseCommandLineAndInitializeWithValues(J9JavaVM *vm, IDATA *memoryParameters)\n \t/* Parse the command line \n \t * Order is important for parameters that match as substrings (-Xmrx/-Xmr)\n \t */\n+\tbool eanbleOriginalJDK8HeapSizeCompatibilityOption = false;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "cff345594d5506026b31e8bc030e1493ca081a67"}, "originalPosition": 11}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzU1MjEwMzk5", "url": "https://github.com/eclipse-openj9/openj9/pull/8498#pullrequestreview-355210399", "createdAt": "2020-02-07T14:54:04Z", "commit": {"oid": "cff345594d5506026b31e8bc030e1493ca081a67"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0wN1QxNDo1NDowNFrOFm_lWw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0wN1QxNDo1NDowNFrOFm_lWw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NjQzMTk2Mw==", "bodyText": "Should it be >= ?!", "url": "https://github.com/eclipse-openj9/openj9/pull/8498#discussion_r376431963", "createdAt": "2020-02-07T14:54:04Z", "author": {"login": "dmitripivkine"}, "path": "runtime/gc_modron_startup/mmparse.cpp", "diffHunk": "@@ -1472,6 +1472,19 @@ gcParseCommandLineAndInitializeWithValues(J9JavaVM *vm, IDATA *memoryParameters)\n \t/* Parse the command line \n \t * Order is important for parameters that match as substrings (-Xmrx/-Xmr)\n \t */\n+\tbool eanbleOriginalJDK8HeapSizeCompatibilityOption = false;\n+\t/* only parse VMOPT_XXENABLEORIGINALJDK8HEAPSIZECOMPATIBILITY option for Java 8 and below */\n+\tif (J2SE_V8 <= J2SE_VERSION((J9JavaVM *)getOmrVM()->_language_vm)) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "cff345594d5506026b31e8bc030e1493ca081a67"}, "originalPosition": 13}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "cff345594d5506026b31e8bc030e1493ca081a67", "author": {"user": {"login": "LinHu2016", "name": "Lin Hu"}}, "url": "https://github.com/eclipse-openj9/openj9/commit/cff345594d5506026b31e8bc030e1493ca081a67", "committedDate": "2020-02-06T21:47:37Z", "message": "Use 25% RAM as default maximum heap size for Java 8\n\n\t- new -XX:[+-]OriginalJDK8HeapSizeCompatibilityMode option\n\t- recognize this option in Java 8 only, ignore in Java 11 and higher\n\t- use 512m as default for heap size if\n\t -XX:+OriginalJDK8HeapSizeCompatibilityMode option is\n\t provided explicitly.\n\nSigned-off-by: Lin Hu <linhu@ca.ibm.com>"}, "afterCommit": {"oid": "6d29e2e3058923c411fca399c9165e503d7a921a", "author": {"user": {"login": "LinHu2016", "name": "Lin Hu"}}, "url": "https://github.com/eclipse-openj9/openj9/commit/6d29e2e3058923c411fca399c9165e503d7a921a", "committedDate": "2020-02-10T16:40:21Z", "message": "Use 25% RAM as default maximum heap size for Java 8\n\n\t- new -XX:[+-]OriginalJDK8HeapSizeCompatibilityMode option\n\t- recognize this option in Java 8 only, ignore in Java 11 and higher\n\t- use 512m as default for heap size if\n\t -XX:+OriginalJDK8HeapSizeCompatibilityMode option is\n\t provided explicitly.\n\nSigned-off-by: Lin Hu <linhu@ca.ibm.com>"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "6d29e2e3058923c411fca399c9165e503d7a921a", "author": {"user": {"login": "LinHu2016", "name": "Lin Hu"}}, "url": "https://github.com/eclipse-openj9/openj9/commit/6d29e2e3058923c411fca399c9165e503d7a921a", "committedDate": "2020-02-10T16:40:21Z", "message": "Use 25% RAM as default maximum heap size for Java 8\n\n\t- new -XX:[+-]OriginalJDK8HeapSizeCompatibilityMode option\n\t- recognize this option in Java 8 only, ignore in Java 11 and higher\n\t- use 512m as default for heap size if\n\t -XX:+OriginalJDK8HeapSizeCompatibilityMode option is\n\t provided explicitly.\n\nSigned-off-by: Lin Hu <linhu@ca.ibm.com>"}, "afterCommit": {"oid": "5276293e3ce6e5ee162d417b0abb28e457b7989a", "author": {"user": {"login": "LinHu2016", "name": "Lin Hu"}}, "url": "https://github.com/eclipse-openj9/openj9/commit/5276293e3ce6e5ee162d417b0abb28e457b7989a", "committedDate": "2020-02-11T15:14:15Z", "message": "Use 25% RAM as default maximum heap size for Java 8\n\n\t- new -XX:[+-]OriginalJDK8HeapSizeCompatibilityMode option\n\t- recognize this option in Java 8 only, ignore in Java 11 and higher\n\t- use 512m as default for heap size if\n\t -XX:+OriginalJDK8HeapSizeCompatibilityMode option is\n\t provided explicitly.\n\nSigned-off-by: Lin Hu <linhu@ca.ibm.com>"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "5276293e3ce6e5ee162d417b0abb28e457b7989a", "author": {"user": {"login": "LinHu2016", "name": "Lin Hu"}}, "url": "https://github.com/eclipse-openj9/openj9/commit/5276293e3ce6e5ee162d417b0abb28e457b7989a", "committedDate": "2020-02-11T15:14:15Z", "message": "Use 25% RAM as default maximum heap size for Java 8\n\n\t- new -XX:[+-]OriginalJDK8HeapSizeCompatibilityMode option\n\t- recognize this option in Java 8 only, ignore in Java 11 and higher\n\t- use 512m as default for heap size if\n\t -XX:+OriginalJDK8HeapSizeCompatibilityMode option is\n\t provided explicitly.\n\nSigned-off-by: Lin Hu <linhu@ca.ibm.com>"}, "afterCommit": {"oid": "73be9312df829309e6896eb1858e168c563d90fc", "author": {"user": {"login": "LinHu2016", "name": "Lin Hu"}}, "url": "https://github.com/eclipse-openj9/openj9/commit/73be9312df829309e6896eb1858e168c563d90fc", "committedDate": "2020-02-12T15:31:36Z", "message": "Use 25% RAM as default maximum heap size for Java 8\n\n\t- new -XX:[+-]OriginalJDK8HeapSizeCompatibilityMode option\n\t- recognize this option in Java 8 only, ignore in Java 11 and higher\n\t- use 512m as default for heap size if\n\t -XX:+OriginalJDK8HeapSizeCompatibilityMode option is\n\t provided explicitly.\n\nSigned-off-by: Lin Hu <linhu@ca.ibm.com>"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "73be9312df829309e6896eb1858e168c563d90fc", "author": {"user": {"login": "LinHu2016", "name": "Lin Hu"}}, "url": "https://github.com/eclipse-openj9/openj9/commit/73be9312df829309e6896eb1858e168c563d90fc", "committedDate": "2020-02-12T15:31:36Z", "message": "Use 25% RAM as default maximum heap size for Java 8\n\n\t- new -XX:[+-]OriginalJDK8HeapSizeCompatibilityMode option\n\t- recognize this option in Java 8 only, ignore in Java 11 and higher\n\t- use 512m as default for heap size if\n\t -XX:+OriginalJDK8HeapSizeCompatibilityMode option is\n\t provided explicitly.\n\nSigned-off-by: Lin Hu <linhu@ca.ibm.com>"}, "afterCommit": {"oid": "a6de33560b02500f070dc42f1432aa9d6c8c0cc3", "author": {"user": {"login": "LinHu2016", "name": "Lin Hu"}}, "url": "https://github.com/eclipse-openj9/openj9/commit/a6de33560b02500f070dc42f1432aa9d6c8c0cc3", "committedDate": "2020-02-12T15:32:46Z", "message": "Use 25% RAM as default maximum heap size for Java 8\n\n\t- new -XX:[+-]OriginalJDK8HeapSizeCompatibilityMode option\n\t- recognize this option in Java 8 only, ignore in Java 11 and higher\n\t- use 512m as default for heap size if\n\t -XX:+OriginalJDK8HeapSizeCompatibilityMode option is\n\t provided explicitly.\n\nSigned-off-by: Lin Hu <linhu@ca.ibm.com>"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "a6de33560b02500f070dc42f1432aa9d6c8c0cc3", "author": {"user": {"login": "LinHu2016", "name": "Lin Hu"}}, "url": "https://github.com/eclipse-openj9/openj9/commit/a6de33560b02500f070dc42f1432aa9d6c8c0cc3", "committedDate": "2020-02-12T15:32:46Z", "message": "Use 25% RAM as default maximum heap size for Java 8\n\n\t- new -XX:[+-]OriginalJDK8HeapSizeCompatibilityMode option\n\t- recognize this option in Java 8 only, ignore in Java 11 and higher\n\t- use 512m as default for heap size if\n\t -XX:+OriginalJDK8HeapSizeCompatibilityMode option is\n\t provided explicitly.\n\nSigned-off-by: Lin Hu <linhu@ca.ibm.com>"}, "afterCommit": {"oid": "d0e29df896398e0abe82cc14787156c6a741496b", "author": {"user": {"login": "LinHu2016", "name": "Lin Hu"}}, "url": "https://github.com/eclipse-openj9/openj9/commit/d0e29df896398e0abe82cc14787156c6a741496b", "committedDate": "2020-02-12T16:21:40Z", "message": "Use 25% RAM as default maximum heap size for Java 8\n\n\t- new -XX:[+-]OriginalJDK8HeapSizeCompatibilityMode option\n\t- recognize this option in Java 8 only, ignore in Java 11 and higher\n\t- use 512m as default for heap size if\n\t -XX:+OriginalJDK8HeapSizeCompatibilityMode option is\n\t provided explicitly.\n\nSigned-off-by: Lin Hu <linhu@ca.ibm.com>"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "d0e29df896398e0abe82cc14787156c6a741496b", "author": {"user": {"login": "LinHu2016", "name": "Lin Hu"}}, "url": "https://github.com/eclipse-openj9/openj9/commit/d0e29df896398e0abe82cc14787156c6a741496b", "committedDate": "2020-02-12T16:21:40Z", "message": "Use 25% RAM as default maximum heap size for Java 8\n\n\t- new -XX:[+-]OriginalJDK8HeapSizeCompatibilityMode option\n\t- recognize this option in Java 8 only, ignore in Java 11 and higher\n\t- use 512m as default for heap size if\n\t -XX:+OriginalJDK8HeapSizeCompatibilityMode option is\n\t provided explicitly.\n\nSigned-off-by: Lin Hu <linhu@ca.ibm.com>"}, "afterCommit": {"oid": "a82e24d10c9464afc3a2009832218e415aa245ce", "author": {"user": {"login": "LinHu2016", "name": "Lin Hu"}}, "url": "https://github.com/eclipse-openj9/openj9/commit/a82e24d10c9464afc3a2009832218e415aa245ce", "committedDate": "2020-02-13T15:09:44Z", "message": "Use 25% RAM as default maximum heap size for Java 8\n\n\t- new -XX:[+-]OriginalJDK8HeapSizeCompatibilityMode option\n\t- recognize this option in Java 8 only, ignore in Java 11 and higher\n\t- use 512m as default for heap size if\n\t -XX:+OriginalJDK8HeapSizeCompatibilityMode option is\n\t provided explicitly.\n\nSigned-off-by: Lin Hu <linhu@ca.ibm.com>"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzU4MzQzMzM3", "url": "https://github.com/eclipse-openj9/openj9/pull/8498#pullrequestreview-358343337", "createdAt": "2020-02-13T16:04:03Z", "commit": {"oid": "a82e24d10c9464afc3a2009832218e415aa245ce"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xM1QxNjowNDowNFrOFpZsRw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xM1QxNjowNDowNFrOFpZsRw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3ODk1Njg3MQ==", "bodyText": "The comment should be indented the same as the code in the block (as it was before).", "url": "https://github.com/eclipse-openj9/openj9/pull/8498#discussion_r378956871", "createdAt": "2020-02-13T16:04:04Z", "author": {"login": "keithc-ca"}, "path": "runtime/gc_base/GCExtensions.cpp", "diffHunk": "@@ -256,8 +254,8 @@ MM_GCExtensions::computeDefaultMaxHeap(MM_EnvironmentBase *env)\n \t}\n \n #if defined(OMR_ENV_DATA64)\n-\tif (J2SE_VERSION((J9JavaVM *)getOmrVM()->_language_vm) >= J2SE_V11) {\n-\t\t/* extend java default max memory to 25% of usable RAM */\n+\tif (!eanbleOriginalJDK8HeapSizeCompatibilityOption) {\n+\t/* extend java default max memory to 25% of usable RAM */", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "a82e24d10c9464afc3a2009832218e415aa245ce"}, "originalPosition": 21}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "a82e24d10c9464afc3a2009832218e415aa245ce", "author": {"user": {"login": "LinHu2016", "name": "Lin Hu"}}, "url": "https://github.com/eclipse-openj9/openj9/commit/a82e24d10c9464afc3a2009832218e415aa245ce", "committedDate": "2020-02-13T15:09:44Z", "message": "Use 25% RAM as default maximum heap size for Java 8\n\n\t- new -XX:[+-]OriginalJDK8HeapSizeCompatibilityMode option\n\t- recognize this option in Java 8 only, ignore in Java 11 and higher\n\t- use 512m as default for heap size if\n\t -XX:+OriginalJDK8HeapSizeCompatibilityMode option is\n\t provided explicitly.\n\nSigned-off-by: Lin Hu <linhu@ca.ibm.com>"}, "afterCommit": {"oid": "48e8b1ee22abeae971017a9668287bc2cd190f7b", "author": {"user": {"login": "LinHu2016", "name": "Lin Hu"}}, "url": "https://github.com/eclipse-openj9/openj9/commit/48e8b1ee22abeae971017a9668287bc2cd190f7b", "committedDate": "2020-02-13T16:45:26Z", "message": "Use 25% RAM as default maximum heap size for Java 8\n\n\t- new -XX:[+-]OriginalJDK8HeapSizeCompatibilityMode option\n\t- recognize this option in Java 8 only, ignore in Java 11 and higher\n\t- use 512m as default for heap size if\n\t -XX:+OriginalJDK8HeapSizeCompatibilityMode option is\n\t provided explicitly.\n\nSigned-off-by: Lin Hu <linhu@ca.ibm.com>"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzYwNDE1MzMy", "url": "https://github.com/eclipse-openj9/openj9/pull/8498#pullrequestreview-360415332", "createdAt": "2020-02-18T15:08:32Z", "commit": {"oid": "48e8b1ee22abeae971017a9668287bc2cd190f7b"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzYxMjY5NTgw", "url": "https://github.com/eclipse-openj9/openj9/pull/8498#pullrequestreview-361269580", "createdAt": "2020-02-19T17:02:42Z", "commit": {"oid": "48e8b1ee22abeae971017a9668287bc2cd190f7b"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xOVQxNzowMjo0MlrOFrvl6A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xOVQxNzowMjo0MlrOFrvl6A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MTQxMjg0MA==", "bodyText": "spelling: eanble -> enable", "url": "https://github.com/eclipse-openj9/openj9/pull/8498#discussion_r381412840", "createdAt": "2020-02-19T17:02:42Z", "author": {"login": "amicic"}, "path": "runtime/gc_base/GCExtensions.cpp", "diffHunk": "@@ -256,7 +254,7 @@ MM_GCExtensions::computeDefaultMaxHeap(MM_EnvironmentBase *env)\n \t}\n \n #if defined(OMR_ENV_DATA64)\n-\tif (J2SE_VERSION((J9JavaVM *)getOmrVM()->_language_vm) >= J2SE_V11) {\n+\tif (!eanbleOriginalJDK8HeapSizeCompatibilityOption) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "48e8b1ee22abeae971017a9668287bc2cd190f7b"}, "originalPosition": 19}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzYxMjcwNzA5", "url": "https://github.com/eclipse-openj9/openj9/pull/8498#pullrequestreview-361270709", "createdAt": "2020-02-19T17:04:09Z", "commit": {"oid": "48e8b1ee22abeae971017a9668287bc2cd190f7b"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xOVQxNzowNDowOVrOFrvpig==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xOVQxNzowNDowOVrOFrvpig==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MTQxMzc3MA==", "bodyText": "wrong spelling of 'enable' at a few spots in this method", "url": "https://github.com/eclipse-openj9/openj9/pull/8498#discussion_r381413770", "createdAt": "2020-02-19T17:04:09Z", "author": {"login": "amicic"}, "path": "runtime/gc_modron_startup/mmparse.cpp", "diffHunk": "@@ -1472,6 +1472,20 @@ gcParseCommandLineAndInitializeWithValues(J9JavaVM *vm, IDATA *memoryParameters)\n \t/* Parse the command line \n \t * Order is important for parameters that match as substrings (-Xmrx/-Xmr)\n \t */\n+\t{\n+\t\tbool eanbleOriginalJDK8HeapSizeCompatibilityOption = false;\n+\t\t/* only parse VMOPT_XXENABLEORIGINALJDK8HEAPSIZECOMPATIBILITY option for Java 8 and below */\n+\t\tif (J2SE_18 >= J2SE_VERSION(vm)) {\n+\n+\t\t\tIDATA eanbled = FIND_AND_CONSUME_ARG(EXACT_MATCH, VMOPT_XXENABLEORIGINALJDK8HEAPSIZECOMPATIBILITY, NULL);\n+\t\t\tIDATA disabled = FIND_AND_CONSUME_ARG(EXACT_MATCH, VMOPT_XXDISABLEORIGINALJDK8HEAPSIZECOMPATIBILITY, NULL);\n+\t\t\tif (eanbled > disabled) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "48e8b1ee22abeae971017a9668287bc2cd190f7b"}, "originalPosition": 18}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzYxMjkxMTgy", "url": "https://github.com/eclipse-openj9/openj9/pull/8498#pullrequestreview-361291182", "createdAt": "2020-02-19T17:31:05Z", "commit": {"oid": "48e8b1ee22abeae971017a9668287bc2cd190f7b"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xOVQxNzozMTowNVrOFrwoyw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xOVQxNzozMTowNVrOFrwoyw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MTQyOTk2Mw==", "bodyText": "I'm fine with removing the call to EnvBase::computeDefaultMaxHeap here. Just commenting for clarification purposes - it will still be called during EnvBase::initialize.", "url": "https://github.com/eclipse-openj9/openj9/pull/8498#discussion_r381429963", "createdAt": "2020-02-19T17:31:05Z", "author": {"login": "amicic"}, "path": "runtime/gc_base/GCExtensions.cpp", "diffHunk": "@@ -235,11 +235,9 @@ MM_GCExtensions::updateIdentityHashDataForSaltIndex(UDATA index)\n }\n \n void\n-MM_GCExtensions::computeDefaultMaxHeap(MM_EnvironmentBase *env)\n+MM_GCExtensions::computeDefaultMaxHeapForJava(bool eanbleOriginalJDK8HeapSizeCompatibilityOption)\n {\n-\tOMRPORT_ACCESS_FROM_OMRPORT(env->getPortLibrary());\n-\n-\tMM_GCExtensionsBase::computeDefaultMaxHeap(env);\n+\tOMRPORT_ACCESS_FROM_OMRVM(_omrVM);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "48e8b1ee22abeae971017a9668287bc2cd190f7b"}, "originalPosition": 10}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "48e8b1ee22abeae971017a9668287bc2cd190f7b", "author": {"user": {"login": "LinHu2016", "name": "Lin Hu"}}, "url": "https://github.com/eclipse-openj9/openj9/commit/48e8b1ee22abeae971017a9668287bc2cd190f7b", "committedDate": "2020-02-13T16:45:26Z", "message": "Use 25% RAM as default maximum heap size for Java 8\n\n\t- new -XX:[+-]OriginalJDK8HeapSizeCompatibilityMode option\n\t- recognize this option in Java 8 only, ignore in Java 11 and higher\n\t- use 512m as default for heap size if\n\t -XX:+OriginalJDK8HeapSizeCompatibilityMode option is\n\t provided explicitly.\n\nSigned-off-by: Lin Hu <linhu@ca.ibm.com>"}, "afterCommit": {"oid": "a2eda64cbbdb38b7e7dbe1b868f4312b5e0feffa", "author": {"user": {"login": "LinHu2016", "name": "Lin Hu"}}, "url": "https://github.com/eclipse-openj9/openj9/commit/a2eda64cbbdb38b7e7dbe1b868f4312b5e0feffa", "committedDate": "2020-02-19T19:00:17Z", "message": "Use 25% RAM as default maximum heap size for Java 8\n\n\t- new -XX:[+-]OriginalJDK8HeapSizeCompatibilityMode option\n\t- recognize this option in Java 8 only, ignore in Java 11 and higher\n\t- use 512m as default for heap size if\n\t -XX:+OriginalJDK8HeapSizeCompatibilityMode option is\n\t provided explicitly.\n\nSigned-off-by: Lin Hu <linhu@ca.ibm.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c560cd75ea7ca9c9f2442d2eab7b1afa8a15af1e", "author": {"user": {"login": "LinHu2016", "name": "Lin Hu"}}, "url": "https://github.com/eclipse-openj9/openj9/commit/c560cd75ea7ca9c9f2442d2eab7b1afa8a15af1e", "committedDate": "2020-02-19T19:14:01Z", "message": "Use 25% RAM as default maximum heap size for Java 8\n\n\t- new -XX:[+-]OriginalJDK8HeapSizeCompatibilityMode option\n\t- recognize this option in Java 8 only, ignore in Java 11 and higher\n\t- use 512m as default for heap size if\n\t -XX:+OriginalJDK8HeapSizeCompatibilityMode option is\n\t provided explicitly.\n\nSigned-off-by: Lin Hu <linhu@ca.ibm.com>"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "a2eda64cbbdb38b7e7dbe1b868f4312b5e0feffa", "author": {"user": {"login": "LinHu2016", "name": "Lin Hu"}}, "url": "https://github.com/eclipse-openj9/openj9/commit/a2eda64cbbdb38b7e7dbe1b868f4312b5e0feffa", "committedDate": "2020-02-19T19:00:17Z", "message": "Use 25% RAM as default maximum heap size for Java 8\n\n\t- new -XX:[+-]OriginalJDK8HeapSizeCompatibilityMode option\n\t- recognize this option in Java 8 only, ignore in Java 11 and higher\n\t- use 512m as default for heap size if\n\t -XX:+OriginalJDK8HeapSizeCompatibilityMode option is\n\t provided explicitly.\n\nSigned-off-by: Lin Hu <linhu@ca.ibm.com>"}, "afterCommit": {"oid": "c560cd75ea7ca9c9f2442d2eab7b1afa8a15af1e", "author": {"user": {"login": "LinHu2016", "name": "Lin Hu"}}, "url": "https://github.com/eclipse-openj9/openj9/commit/c560cd75ea7ca9c9f2442d2eab7b1afa8a15af1e", "committedDate": "2020-02-19T19:14:01Z", "message": "Use 25% RAM as default maximum heap size for Java 8\n\n\t- new -XX:[+-]OriginalJDK8HeapSizeCompatibilityMode option\n\t- recognize this option in Java 8 only, ignore in Java 11 and higher\n\t- use 512m as default for heap size if\n\t -XX:+OriginalJDK8HeapSizeCompatibilityMode option is\n\t provided explicitly.\n\nSigned-off-by: Lin Hu <linhu@ca.ibm.com>"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzYxMzkzOTUx", "url": "https://github.com/eclipse-openj9/openj9/pull/8498#pullrequestreview-361393951", "createdAt": "2020-02-19T19:57:35Z", "commit": {"oid": "c560cd75ea7ca9c9f2442d2eab7b1afa8a15af1e"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 749, "cost": 1, "resetAt": "2021-10-28T18:00:02Z"}}}