{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDQzMjM1MzEx", "number": 10068, "title": "Add ResolveCHK for value types before NULLCHK", "bodyText": "Add ResolveCHK for value types before NULLCHK.\nFixes #10056\nCo-authored-by: Yi Zhang yizhang@ca.ibm.com\nSigned-off-by: Annabelle Huo Annabelle.Huo@ibm.com", "createdAt": "2020-07-02T03:25:26Z", "url": "https://github.com/eclipse-openj9/openj9/pull/10068", "merged": true, "mergeCommit": {"oid": "fdfccf65cf5772a73ff8af74ea0893afd81335ce"}, "closed": true, "closedAt": "2020-07-16T15:27:15Z", "author": {"login": "a7ehuo"}, "timelineItems": {"totalCount": 7, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcxcnkcABqjM1MTIxNDE1OTI=", "endCursor": "Y3Vyc29yOnYyOpPPAAABc07tLCgFqTQ0ODQyNDQ2MQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "093b755c1163b0e87729f6fcd6de96422f1ecad3", "author": {"user": {"login": "a7ehuo", "name": "Annabelle Huo"}}, "url": "https://github.com/eclipse-openj9/openj9/commit/093b755c1163b0e87729f6fcd6de96422f1ecad3", "committedDate": "2020-07-02T03:11:27Z", "message": "Add ResolveCHK for value types before NullCheck\n\nFixes #10056\n\nSigned-off-by: Annabelle Huo <Annabelle.Huo@ibm.com>"}, "afterCommit": {"oid": "17a945bd68f844020a19f4371adb0c5df4c8df85", "author": {"user": {"login": "a7ehuo", "name": "Annabelle Huo"}}, "url": "https://github.com/eclipse-openj9/openj9/commit/17a945bd68f844020a19f4371adb0c5df4c8df85", "committedDate": "2020-07-04T00:07:43Z", "message": "Add ResolveCHK for value types before NULLCHK\n\nFixes #10056\n\nCo-authored-by: Yi Zhang <yizhang@ca.ibm.com>\n\nSigned-off-by: Annabelle Huo <Annabelle.Huo@ibm.com>"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDQzOTU2NjAz", "url": "https://github.com/eclipse-openj9/openj9/pull/10068#pullrequestreview-443956603", "createdAt": "2020-07-07T14:37:55Z", "commit": {"oid": "17a945bd68f844020a19f4371adb0c5df4c8df85"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wN1QxNDozNzo1NlrOGuBrfQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wN1QxNDozNzo1NlrOGuBrfQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MDkxNTE5Nw==", "bodyText": "I suggest you add explicitly that the class has to be resolved unconditionally if it's a value type, regardless of whether the value is null, just to make it clear.", "url": "https://github.com/eclipse-openj9/openj9/pull/10068#discussion_r450915197", "createdAt": "2020-07-07T14:37:56Z", "author": {"login": "hzongaro"}, "path": "runtime/compiler/ilgen/Walker.cpp", "diffHunk": "@@ -2357,7 +2357,8 @@ TR_J9ByteCodeIlGenerator::genCheckCast()\n  * Generate IL for a checkcast bytecode instruction.\n  *\n  * If the class specified in the bytecode is unresolved, this leaves out the\n- * ResolveCHK since it has to be conditional on a non-null object.\n+ * ResolveCHK since it has to be conditional on a non-null object when it is\n+ * not a value type.", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "17a945bd68f844020a19f4371adb0c5df4c8df85"}, "originalPosition": 6}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "17a945bd68f844020a19f4371adb0c5df4c8df85", "author": {"user": {"login": "a7ehuo", "name": "Annabelle Huo"}}, "url": "https://github.com/eclipse-openj9/openj9/commit/17a945bd68f844020a19f4371adb0c5df4c8df85", "committedDate": "2020-07-04T00:07:43Z", "message": "Add ResolveCHK for value types before NULLCHK\n\nFixes #10056\n\nCo-authored-by: Yi Zhang <yizhang@ca.ibm.com>\n\nSigned-off-by: Annabelle Huo <Annabelle.Huo@ibm.com>"}, "afterCommit": {"oid": "5c67553ac4b74a44452e56313dfd253b6c36a85d", "author": {"user": {"login": "a7ehuo", "name": "Annabelle Huo"}}, "url": "https://github.com/eclipse-openj9/openj9/commit/5c67553ac4b74a44452e56313dfd253b6c36a85d", "committedDate": "2020-07-07T15:27:45Z", "message": "Add ResolveCHK for value types before NULLCHK\n\nThe class has to be resolved unconditionally\nif it's a value type, regardless of whether\nthe value is null.\n\nFixes #10056\n\nCo-authored-by: Yi Zhang <yizhang@ca.ibm.com>\n\nSigned-off-by: Annabelle Huo <Annabelle.Huo@ibm.com>"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDQ1NTUzNTUz", "url": "https://github.com/eclipse-openj9/openj9/pull/10068#pullrequestreview-445553553", "createdAt": "2020-07-09T12:09:01Z", "commit": {"oid": "5c67553ac4b74a44452e56313dfd253b6c36a85d"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wOVQxMjowOTowMVrOGvOPeA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wOVQxMjowOTowMVrOGvOPeA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MjE2OTU5Mg==", "bodyText": "Why can we not use loadClassObject here?", "url": "https://github.com/eclipse-openj9/openj9/pull/10068#discussion_r452169592", "createdAt": "2020-07-09T12:09:01Z", "author": {"login": "andrewcraik"}, "path": "runtime/compiler/ilgen/Walker.cpp", "diffHunk": "@@ -2369,13 +2371,26 @@ TR_J9ByteCodeIlGenerator::genCheckCast(int32_t cpIndex)\n    {\n    if (TR::Compiler->om.areValueTypesEnabled() && TR::Compiler->cls.isClassRefValueType(comp(), method()->classOfMethod(), cpIndex))\n       {\n+      void * classObject = method()->getClassFromConstantPool(comp(), cpIndex);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "5c67553ac4b74a44452e56313dfd253b6c36a85d"}, "originalPosition": 13}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e74076f16b1369fd144d388b818cea7ac30b16c4", "author": {"user": {"login": "a7ehuo", "name": "Annabelle Huo"}}, "url": "https://github.com/eclipse-openj9/openj9/commit/e74076f16b1369fd144d388b818cea7ac30b16c4", "committedDate": "2020-07-14T15:35:39Z", "message": "Add ResolveCHK for value types before NULLCHK\n\nThe class has to be resolved unconditionally\nif it is a value type, regardless of whether\nthe value is null.\n\nFixes #10056\n\nCo-authored-by: Yi Zhang <yizhang@ca.ibm.com>\n\nSigned-off-by: Annabelle Huo <Annabelle.Huo@ibm.com>"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "5c67553ac4b74a44452e56313dfd253b6c36a85d", "author": {"user": {"login": "a7ehuo", "name": "Annabelle Huo"}}, "url": "https://github.com/eclipse-openj9/openj9/commit/5c67553ac4b74a44452e56313dfd253b6c36a85d", "committedDate": "2020-07-07T15:27:45Z", "message": "Add ResolveCHK for value types before NULLCHK\n\nThe class has to be resolved unconditionally\nif it's a value type, regardless of whether\nthe value is null.\n\nFixes #10056\n\nCo-authored-by: Yi Zhang <yizhang@ca.ibm.com>\n\nSigned-off-by: Annabelle Huo <Annabelle.Huo@ibm.com>"}, "afterCommit": {"oid": "e74076f16b1369fd144d388b818cea7ac30b16c4", "author": {"user": {"login": "a7ehuo", "name": "Annabelle Huo"}}, "url": "https://github.com/eclipse-openj9/openj9/commit/e74076f16b1369fd144d388b818cea7ac30b16c4", "committedDate": "2020-07-14T15:35:39Z", "message": "Add ResolveCHK for value types before NULLCHK\n\nThe class has to be resolved unconditionally\nif it is a value type, regardless of whether\nthe value is null.\n\nFixes #10056\n\nCo-authored-by: Yi Zhang <yizhang@ca.ibm.com>\n\nSigned-off-by: Annabelle Huo <Annabelle.Huo@ibm.com>"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDQ4NDI0NDYx", "url": "https://github.com/eclipse-openj9/openj9/pull/10068#pullrequestreview-448424461", "createdAt": "2020-07-14T20:03:54Z", "commit": {"oid": "e74076f16b1369fd144d388b818cea7ac30b16c4"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 492, "cost": 1, "resetAt": "2021-10-28T17:48:14Z"}}}