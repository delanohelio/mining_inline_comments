{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDk3MTA2MzI0", "number": 10774, "title": "Allow -Xdump options for jcmd Dump.* commands", "bodyText": "Default system and heap dumps to request=exclusive+prepwalk\nFix a bug reporting an exception when requesting a dump.\nUpdate the tests.\nFixes #10747\nDoc issue eclipse-openj9/openj9-docs#655\nSigned-off-by: Peter Shipton Peter_Shipton@ca.ibm.com", "createdAt": "2020-10-02T19:54:52Z", "url": "https://github.com/eclipse-openj9/openj9/pull/10774", "merged": true, "mergeCommit": {"oid": "3c34548bd12f732f5e5ab00dfa1de701b6689f51"}, "closed": true, "closedAt": "2020-10-07T18:20:00Z", "author": {"login": "pshipton"}, "timelineItems": {"totalCount": 19, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdOrrepgFqTUwMTQxNTI5NA==", "endCursor": "Y3Vyc29yOnYyOpPPAAABdQRKF7AFqTUwNDE1MDU5OA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTAxNDE1Mjk0", "url": "https://github.com/eclipse-openj9/openj9/pull/10774#pullrequestreview-501415294", "createdAt": "2020-10-02T20:05:35Z", "commit": {"oid": "9806852095bf3c334960351e974452052cf3fc71"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wMlQyMDowNTozNVrOHb6J4A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wMlQyMDowNTozNVrOHb6J4A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5OTAyNjQwMA==", "bodyText": "I might set default options for heap dumps as well.\njavacore defaults to exclusive+preempt\nheap defaults to exclusive+compact+prepwalk\nsystem and snap defaults to serial\nSee settings via -Xdump:<type>:defaults", "url": "https://github.com/eclipse-openj9/openj9/pull/10774#discussion_r499026400", "createdAt": "2020-10-02T20:05:35Z", "author": {"login": "pshipton"}, "path": "jcl/src/java.base/share/classes/openj9/internal/tools/attach/target/DiagnosticUtils.java", "diffHunk": "@@ -273,12 +273,37 @@ private static DiagnosticProperties doDump(String diagnosticCommand) {\n \t\t\t}\n \t\t\tif (!dumpType.isEmpty()) {\n \t\t\t\tString request = dumpType;\n-\t\t\t\tif (parts.length == 2) {\n-\t\t\t\t\tString fileDirective = (\"system\".equals(dumpType) && IPC.isZOS) ? \":dsn=\" : \":file=\"; //$NON-NLS-1$ //$NON-NLS-2$ //$NON-NLS-3$\n-\t\t\t\t\trequest += fileDirective + parts[1];\n+\t\t\t\tboolean foundSystemRequest = false;\n+\t\t\t\tboolean heapDump = \"heap\".equals(dumpType);\n+\t\t\t\tboolean systemDump = \"system\".equals(dumpType);\n+\t\t\t\tString options = \"\"; //$NON-NLS-1$\n+\t\t\t\tString separator = \":\"; //$NON-NLS-1$\n+\t\t\t\tfor (int i = 1; i < parts.length; i++) {\n+\t\t\t\t\tString option = parts[i];\n+\t\t\t\t\tboolean isRequest = option.startsWith(\"request=\");\n+\t\t\t\t\tboolean isOpts = option.startsWith(\"opts=\");\n+\t\t\t\t\tif (isRequest || isOpts) { //$NON-NLS-1$ //$NON-NLS-2$\n+\t\t\t\t\t\tif (heapDump && isOpts) {\n+\t\t\t\t\t\t\t// opts= are only valid for heap dumps\n+\t\t\t\t\t\t\tbreak;\n+\t\t\t\t\t\t}\n+\t\t\t\t\t\toptions += separator + option;\n+\t\t\t\t\t\tif (systemDump && isRequest) {\n+\t\t\t\t\t\t\tfoundSystemRequest = true;\n+\t\t\t\t\t\t}\n+\t\t\t\t\t} else {\n+\t\t\t\t\t\tString fileDirective = (systemDump && IPC.isZOS) ? \"dsn=\" : \"file=\"; //$NON-NLS-1$ //$NON-NLS-2$ //$NON-NLS-3$\n+\t\t\t\t\t\toptions += separator + fileDirective + option;\n+\t\t\t\t\t}\n+\t\t\t\t\tseparator = \",\"; //$NON-NLS-1$\n+\t\t\t\t}\n+\t\t\t\tif (systemDump && !foundSystemRequest) {\n+\t\t\t\t\t// default options for a system dump if the user didn't specify\n+\t\t\t\t\toptions += \"request=exclusive+prepwalk\";  //$NON-NLS-1$", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "9806852095bf3c334960351e974452052cf3fc71"}, "originalPosition": 45}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTAxNDE1MzMx", "url": "https://github.com/eclipse-openj9/openj9/pull/10774#pullrequestreview-501415331", "createdAt": "2020-10-02T20:05:39Z", "commit": {"oid": "9806852095bf3c334960351e974452052cf3fc71"}, "state": "COMMENTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wMlQyMDowNTo0MFrOHb6KAQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wMlQyMDowNjoxMVrOHb6KxA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5OTAyNjQzMw==", "bodyText": "System.err.println superfluous?", "url": "https://github.com/eclipse-openj9/openj9/pull/10774#discussion_r499026433", "createdAt": "2020-10-02T20:05:40Z", "author": {"login": "kgibm"}, "path": "jcl/src/java.base/share/classes/openj9/internal/tools/attach/target/DiagnosticUtils.java", "diffHunk": "@@ -273,12 +273,37 @@ private static DiagnosticProperties doDump(String diagnosticCommand) {\n \t\t\t}\n \t\t\tif (!dumpType.isEmpty()) {\n \t\t\t\tString request = dumpType;\n-\t\t\t\tif (parts.length == 2) {\n-\t\t\t\t\tString fileDirective = (\"system\".equals(dumpType) && IPC.isZOS) ? \":dsn=\" : \":file=\"; //$NON-NLS-1$ //$NON-NLS-2$ //$NON-NLS-3$\n-\t\t\t\t\trequest += fileDirective + parts[1];\n+\t\t\t\tboolean foundSystemRequest = false;\n+\t\t\t\tboolean heapDump = \"heap\".equals(dumpType);\n+\t\t\t\tboolean systemDump = \"system\".equals(dumpType);\n+\t\t\t\tString options = \"\"; //$NON-NLS-1$\n+\t\t\t\tString separator = \":\"; //$NON-NLS-1$\n+\t\t\t\tfor (int i = 1; i < parts.length; i++) {\n+\t\t\t\t\tString option = parts[i];\n+\t\t\t\t\tboolean isRequest = option.startsWith(\"request=\");\n+\t\t\t\t\tboolean isOpts = option.startsWith(\"opts=\");\n+\t\t\t\t\tif (isRequest || isOpts) { //$NON-NLS-1$ //$NON-NLS-2$\n+\t\t\t\t\t\tif (heapDump && isOpts) {\n+\t\t\t\t\t\t\t// opts= are only valid for heap dumps\n+\t\t\t\t\t\t\tbreak;\n+\t\t\t\t\t\t}\n+\t\t\t\t\t\toptions += separator + option;\n+\t\t\t\t\t\tif (systemDump && isRequest) {\n+\t\t\t\t\t\t\tfoundSystemRequest = true;\n+\t\t\t\t\t\t}\n+\t\t\t\t\t} else {\n+\t\t\t\t\t\tString fileDirective = (systemDump && IPC.isZOS) ? \"dsn=\" : \"file=\"; //$NON-NLS-1$ //$NON-NLS-2$ //$NON-NLS-3$\n+\t\t\t\t\t\toptions += separator + fileDirective + option;\n+\t\t\t\t\t}\n+\t\t\t\t\tseparator = \",\"; //$NON-NLS-1$\n+\t\t\t\t}\n+\t\t\t\tif (systemDump && !foundSystemRequest) {\n+\t\t\t\t\t// default options for a system dump if the user didn't specify\n+\t\t\t\t\toptions += \"request=exclusive+prepwalk\";  //$NON-NLS-1$\n \t\t\t\t}\n+\t\t\t\tSystem.err.println(\"request + options\");", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "9806852095bf3c334960351e974452052cf3fc71"}, "originalPosition": 47}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5OTAyNjYyOA==", "bodyText": "Shouldn't this be systemDump && isOpts instead?", "url": "https://github.com/eclipse-openj9/openj9/pull/10774#discussion_r499026628", "createdAt": "2020-10-02T20:06:11Z", "author": {"login": "kgibm"}, "path": "jcl/src/java.base/share/classes/openj9/internal/tools/attach/target/DiagnosticUtils.java", "diffHunk": "@@ -273,12 +273,37 @@ private static DiagnosticProperties doDump(String diagnosticCommand) {\n \t\t\t}\n \t\t\tif (!dumpType.isEmpty()) {\n \t\t\t\tString request = dumpType;\n-\t\t\t\tif (parts.length == 2) {\n-\t\t\t\t\tString fileDirective = (\"system\".equals(dumpType) && IPC.isZOS) ? \":dsn=\" : \":file=\"; //$NON-NLS-1$ //$NON-NLS-2$ //$NON-NLS-3$\n-\t\t\t\t\trequest += fileDirective + parts[1];\n+\t\t\t\tboolean foundSystemRequest = false;\n+\t\t\t\tboolean heapDump = \"heap\".equals(dumpType);\n+\t\t\t\tboolean systemDump = \"system\".equals(dumpType);\n+\t\t\t\tString options = \"\"; //$NON-NLS-1$\n+\t\t\t\tString separator = \":\"; //$NON-NLS-1$\n+\t\t\t\tfor (int i = 1; i < parts.length; i++) {\n+\t\t\t\t\tString option = parts[i];\n+\t\t\t\t\tboolean isRequest = option.startsWith(\"request=\");\n+\t\t\t\t\tboolean isOpts = option.startsWith(\"opts=\");\n+\t\t\t\t\tif (isRequest || isOpts) { //$NON-NLS-1$ //$NON-NLS-2$\n+\t\t\t\t\t\tif (heapDump && isOpts) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "9806852095bf3c334960351e974452052cf3fc71"}, "originalPosition": 29}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "051dd03b88dd25f56b962b91efd458294d84bf94", "author": {"user": {"login": "pshipton", "name": "Peter Shipton"}}, "url": "https://github.com/eclipse-openj9/openj9/commit/051dd03b88dd25f56b962b91efd458294d84bf94", "committedDate": "2020-10-02T21:06:37Z", "message": "Fix copy/paste error\n\nSigned-off-by: Peter Shipton <Peter_Shipton@ca.ibm.com>"}, "afterCommit": {"oid": "e8c563bf92adc84f8f0fcc2415db0320f52cf8d4", "author": {"user": {"login": "pshipton", "name": "Peter Shipton"}}, "url": "https://github.com/eclipse-openj9/openj9/commit/e8c563bf92adc84f8f0fcc2415db0320f52cf8d4", "committedDate": "2020-10-02T21:24:23Z", "message": "Allow -Xdump options for jcmd Dump.* commands\n\nDefault system dumps to `request=exclusive+prepwalk`\n\nSigned-off-by: Peter Shipton <Peter_Shipton@ca.ibm.com>"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "e8c563bf92adc84f8f0fcc2415db0320f52cf8d4", "author": {"user": {"login": "pshipton", "name": "Peter Shipton"}}, "url": "https://github.com/eclipse-openj9/openj9/commit/e8c563bf92adc84f8f0fcc2415db0320f52cf8d4", "committedDate": "2020-10-02T21:24:23Z", "message": "Allow -Xdump options for jcmd Dump.* commands\n\nDefault system dumps to `request=exclusive+prepwalk`\n\nSigned-off-by: Peter Shipton <Peter_Shipton@ca.ibm.com>"}, "afterCommit": {"oid": "50e845921fb10676c3d27b7dda7aa08beec8b2f3", "author": {"user": {"login": "pshipton", "name": "Peter Shipton"}}, "url": "https://github.com/eclipse-openj9/openj9/commit/50e845921fb10676c3d27b7dda7aa08beec8b2f3", "committedDate": "2020-10-02T21:37:51Z", "message": "Allow -Xdump options for jcmd Dump.* commands\n\nDefault system dumps to `request=exclusive+prepwalk`\n\nSigned-off-by: Peter Shipton <Peter_Shipton@ca.ibm.com>"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "ce578121807f00c4fa105b4743dc73d698539dd9", "author": {"user": {"login": "pshipton", "name": "Peter Shipton"}}, "url": "https://github.com/eclipse-openj9/openj9/commit/ce578121807f00c4fa105b4743dc73d698539dd9", "committedDate": "2020-10-02T22:03:29Z", "message": "Fix bugs\n\nSigned-off-by: Peter Shipton <Peter_Shipton@ca.ibm.com>"}, "afterCommit": {"oid": "48494220a2b67b0dcba9fe270ec489040f337140", "author": {"user": {"login": "pshipton", "name": "Peter Shipton"}}, "url": "https://github.com/eclipse-openj9/openj9/commit/48494220a2b67b0dcba9fe270ec489040f337140", "committedDate": "2020-10-02T22:14:17Z", "message": "Allow -Xdump options for jcmd Dump.* commands\n\nDefault system dumps to `request=exclusive+prepwalk`\n\nSigned-off-by: Peter Shipton <Peter_Shipton@ca.ibm.com>"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "48494220a2b67b0dcba9fe270ec489040f337140", "author": {"user": {"login": "pshipton", "name": "Peter Shipton"}}, "url": "https://github.com/eclipse-openj9/openj9/commit/48494220a2b67b0dcba9fe270ec489040f337140", "committedDate": "2020-10-02T22:14:17Z", "message": "Allow -Xdump options for jcmd Dump.* commands\n\nDefault system dumps to `request=exclusive+prepwalk`\n\nSigned-off-by: Peter Shipton <Peter_Shipton@ca.ibm.com>"}, "afterCommit": {"oid": "455e70b39ada872874dd4484108ac6babeae6f67", "author": {"user": {"login": "pshipton", "name": "Peter Shipton"}}, "url": "https://github.com/eclipse-openj9/openj9/commit/455e70b39ada872874dd4484108ac6babeae6f67", "committedDate": "2020-10-02T22:16:37Z", "message": "Allow -Xdump options for jcmd Dump.* commands\n\nDefault system and heap dumps to `request=exclusive+prepwalk`\n\nFix a bug reporting an exception when requesting a dump.\n\nSigned-off-by: Peter Shipton <Peter_Shipton@ca.ibm.com>"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTAxNTAxOTY4", "url": "https://github.com/eclipse-openj9/openj9/pull/10774#pullrequestreview-501501968", "createdAt": "2020-10-03T00:15:06Z", "commit": {"oid": "455e70b39ada872874dd4484108ac6babeae6f67"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wM1QwMDoxNTowNlrOHb-WuA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wM1QwMDoxNTowNlrOHb-WuA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5OTA5NTIyNA==", "bodyText": "does the order of these three entries matter? can we turn the <file path> to the similar key=value style, i.e., file=<file path> (dsn=<file path> for zOS)?", "url": "https://github.com/eclipse-openj9/openj9/pull/10774#discussion_r499095224", "createdAt": "2020-10-03T00:15:06Z", "author": {"login": "JasonFengJ9"}, "path": "jcl/src/java.base/share/classes/openj9/internal/tools/attach/target/DiagnosticUtils.java", "diffHunk": "@@ -46,7 +46,9 @@\n \tprivate static final String FORMAT_PREFIX = \" Format: \"; //$NON-NLS-1$\n \n \t@SuppressWarnings(\"nls\")\n-\tprivate static final String FILE_PATH_HELP = \" <file path>%n\"\n+\tprivate static final String DUMP_OPTION_HELP = \" [request=<options>] [opts=<options] [<file path>]%n\"", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "455e70b39ada872874dd4484108ac6babeae6f67"}, "originalPosition": 5}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "0599f016c32749aefd31fda69da20bde37b643eb", "author": {"user": {"login": "pshipton", "name": "Peter Shipton"}}, "url": "https://github.com/eclipse-openj9/openj9/commit/0599f016c32749aefd31fda69da20bde37b643eb", "committedDate": "2020-10-05T19:24:49Z", "message": "Add testing\n\nSigned-off-by: Peter Shipton <Peter_Shipton@ca.ibm.com>"}, "afterCommit": {"oid": "e34fee7af09a9d8f08288df526ad8f3f1293eb2b", "author": {"user": {"login": "pshipton", "name": "Peter Shipton"}}, "url": "https://github.com/eclipse-openj9/openj9/commit/e34fee7af09a9d8f08288df526ad8f3f1293eb2b", "committedDate": "2020-10-05T20:12:15Z", "message": "Allow -Xdump options for jcmd Dump.* commands\n\nDefault system and heap dumps to `request=exclusive+prepwalk`\n\nFix a bug reporting an exception when requesting a dump.\n\nUpdate the tests.\n\nSigned-off-by: Peter Shipton <Peter_Shipton@ca.ibm.com>"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTAyNDAwNzAy", "url": "https://github.com/eclipse-openj9/openj9/pull/10774#pullrequestreview-502400702", "createdAt": "2020-10-05T20:35:50Z", "commit": {"oid": "e34fee7af09a9d8f08288df526ad8f3f1293eb2b"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 5, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wNVQyMDozNTo1MFrOHcs21A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wNVQyMDo1OTowM1rOHctlfg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5OTg1NzEwOA==", "bodyText": "I think this should end with %n (and was probably intended given the line split here).", "url": "https://github.com/eclipse-openj9/openj9/pull/10774#discussion_r499857108", "createdAt": "2020-10-05T20:35:50Z", "author": {"login": "keithc-ca"}, "path": "jcl/src/java.base/share/classes/openj9/internal/tools/attach/target/DiagnosticUtils.java", "diffHunk": "@@ -46,7 +46,9 @@\n \tprivate static final String FORMAT_PREFIX = \" Format: \"; //$NON-NLS-1$\n \n \t@SuppressWarnings(\"nls\")\n-\tprivate static final String FILE_PATH_HELP = \" <file path>%n\"\n+\tprivate static final String DUMP_OPTION_HELP = \" [request=<options>] [opts=<options] [<file path>]%n\"\n+\t\t\t\t+ \" Set optional request= and opts= -Xdump options. The order of the parameters does not matter.%n\"\n+\t\t\t\t+ \" system and heap dumps default to request=exclusive+prepwalk rather than the -Xdump:<type>:defaults setting.%n\"\n \t\t\t\t+ \" <file path> is optional, otherwise a default path/name is used.\"", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "e34fee7af09a9d8f08288df526ad8f3f1293eb2b"}, "originalPosition": 8}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5OTg2MjEzOA==", "bodyText": "The //$NON-NLS-n$ comments don't belong here: they belong on lines 280, 281, 285 & 286 above.", "url": "https://github.com/eclipse-openj9/openj9/pull/10774#discussion_r499862138", "createdAt": "2020-10-05T20:45:48Z", "author": {"login": "keithc-ca"}, "path": "jcl/src/java.base/share/classes/openj9/internal/tools/attach/target/DiagnosticUtils.java", "diffHunk": "@@ -272,17 +274,41 @@ private static DiagnosticProperties doDump(String diagnosticCommand) {\n \t\t\t\t}\n \t\t\t}\n \t\t\tif (!dumpType.isEmpty()) {\n-\t\t\t\tString request = dumpType;\n-\t\t\t\tif (parts.length == 2) {\n-\t\t\t\t\tString fileDirective = (\"system\".equals(dumpType) && IPC.isZOS) ? \":dsn=\" : \":file=\"; //$NON-NLS-1$ //$NON-NLS-2$ //$NON-NLS-3$\n-\t\t\t\t\trequest += fileDirective + parts[1];\n+\t\t\t\tStringBuilder request = new StringBuilder();\n+\t\t\t\trequest.append(dumpType);\n+\t\t\t\tboolean foundRequest = false;\n+\t\t\t\tboolean heapDump = \"heap\".equals(dumpType);\n+\t\t\t\tboolean systemDump = \"system\".equals(dumpType);\n+\t\t\t\tString separator = \":\"; //$NON-NLS-1$\n+\t\t\t\tfor (int i = 1; i < parts.length; i++) {\n+\t\t\t\t\tString option = parts[i];\n+\t\t\t\t\tboolean isRequest = option.startsWith(\"request=\");\n+\t\t\t\t\tboolean isOpts = option.startsWith(\"opts=\");\n+\t\t\t\t\tif (isRequest || isOpts) { //$NON-NLS-1$ //$NON-NLS-2$", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "e34fee7af09a9d8f08288df526ad8f3f1293eb2b"}, "originalPosition": 41}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5OTg2MjY3MA==", "bodyText": "//$NON-NLS-3$ should be removed: there are only two string literals here.", "url": "https://github.com/eclipse-openj9/openj9/pull/10774#discussion_r499862670", "createdAt": "2020-10-05T20:46:49Z", "author": {"login": "keithc-ca"}, "path": "jcl/src/java.base/share/classes/openj9/internal/tools/attach/target/DiagnosticUtils.java", "diffHunk": "@@ -272,17 +274,41 @@ private static DiagnosticProperties doDump(String diagnosticCommand) {\n \t\t\t\t}\n \t\t\t}\n \t\t\tif (!dumpType.isEmpty()) {\n-\t\t\t\tString request = dumpType;\n-\t\t\t\tif (parts.length == 2) {\n-\t\t\t\t\tString fileDirective = (\"system\".equals(dumpType) && IPC.isZOS) ? \":dsn=\" : \":file=\"; //$NON-NLS-1$ //$NON-NLS-2$ //$NON-NLS-3$\n-\t\t\t\t\trequest += fileDirective + parts[1];\n+\t\t\t\tStringBuilder request = new StringBuilder();\n+\t\t\t\trequest.append(dumpType);\n+\t\t\t\tboolean foundRequest = false;\n+\t\t\t\tboolean heapDump = \"heap\".equals(dumpType);\n+\t\t\t\tboolean systemDump = \"system\".equals(dumpType);\n+\t\t\t\tString separator = \":\"; //$NON-NLS-1$\n+\t\t\t\tfor (int i = 1; i < parts.length; i++) {\n+\t\t\t\t\tString option = parts[i];\n+\t\t\t\t\tboolean isRequest = option.startsWith(\"request=\");\n+\t\t\t\t\tboolean isOpts = option.startsWith(\"opts=\");\n+\t\t\t\t\tif (isRequest || isOpts) { //$NON-NLS-1$ //$NON-NLS-2$\n+\t\t\t\t\t\tif (!heapDump && isOpts) {\n+\t\t\t\t\t\t\t// opts= are only valid for heap dumps\n+\t\t\t\t\t\t\tcontinue;\n+\t\t\t\t\t\t}\n+\t\t\t\t\t\trequest.append(separator).append(option);\n+\t\t\t\t\t\tif (isRequest) {\n+\t\t\t\t\t\t\tfoundRequest = true;\n+\t\t\t\t\t\t}\n+\t\t\t\t\t} else {\n+\t\t\t\t\t\tString fileDirective = (systemDump && IPC.isZOS) ? \"dsn=\" : \"file=\"; //$NON-NLS-1$ //$NON-NLS-2$ //$NON-NLS-3$", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "e34fee7af09a9d8f08288df526ad8f3f1293eb2b"}, "originalPosition": 51}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5OTg2NzI1Mw==", "bodyText": "This line is much too long: please split.", "url": "https://github.com/eclipse-openj9/openj9/pull/10774#discussion_r499867253", "createdAt": "2020-10-05T20:55:54Z", "author": {"login": "keithc-ca"}, "path": "test/functional/Java8andUp/src/org/openj9/test/attachAPI/TestJcmd.java", "diffHunk": "@@ -238,6 +240,48 @@ public void testDumps() throws IOException {\n \t\t}\n \t}\n \n+\t@Test\n+\tpublic void testDumpsWithOptions() throws IOException {\n+\t\tString[][] commandsAndDumpTypes = {{DUMP_HEAP, \"Heap\", \"request=exclusive+compact+prepwalk,opts=CLASSIC\"}, {GC_HEAP_DUMP, \"Heap\", \"opts=PHD\"}, {DUMP_JAVA, \"Java\", \"request=serial\"}, {DUMP_SNAP, \"Snap\", \"request=exclusive\"}, {DUMP_SYSTEM, \"System\", \"request=exclusive+compact+prepwalk\"}};", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "e34fee7af09a9d8f08288df526ad8f3f1293eb2b"}, "originalPosition": 15}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5OTg2OTA1NA==", "bodyText": "The help should mention 'opts=..' only for heap dumps.", "url": "https://github.com/eclipse-openj9/openj9/pull/10774#discussion_r499869054", "createdAt": "2020-10-05T20:59:03Z", "author": {"login": "keithc-ca"}, "path": "jcl/src/java.base/share/classes/openj9/internal/tools/attach/target/DiagnosticUtils.java", "diffHunk": "@@ -356,17 +382,17 @@ private static DiagnosticProperties doHelp(String diagnosticCommand) {\n \t\t\t+ \" Options: -l : print information about ownable synchronizers%n\";\n \n \tprivate static final String DIAGNOSTICS_DUMP_HEAP_HELP = \"Create a heap dump.%n\" //$NON-NLS-1$\n-\t\t\t+ FORMAT_PREFIX + DIAGNOSTICS_DUMP_HEAP + FILE_PATH_HELP\n+\t\t\t+ FORMAT_PREFIX + DIAGNOSTICS_DUMP_HEAP + DUMP_OPTION_HELP", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "e34fee7af09a9d8f08288df526ad8f3f1293eb2b"}, "originalPosition": 76}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "e34fee7af09a9d8f08288df526ad8f3f1293eb2b", "author": {"user": {"login": "pshipton", "name": "Peter Shipton"}}, "url": "https://github.com/eclipse-openj9/openj9/commit/e34fee7af09a9d8f08288df526ad8f3f1293eb2b", "committedDate": "2020-10-05T20:12:15Z", "message": "Allow -Xdump options for jcmd Dump.* commands\n\nDefault system and heap dumps to `request=exclusive+prepwalk`\n\nFix a bug reporting an exception when requesting a dump.\n\nUpdate the tests.\n\nSigned-off-by: Peter Shipton <Peter_Shipton@ca.ibm.com>"}, "afterCommit": {"oid": "be2c1a6ecd0748dbd3f94d5bbb078c3f9297e163", "author": {"user": {"login": "pshipton", "name": "Peter Shipton"}}, "url": "https://github.com/eclipse-openj9/openj9/commit/be2c1a6ecd0748dbd3f94d5bbb078c3f9297e163", "committedDate": "2020-10-05T23:51:43Z", "message": "Allow -Xdump options for jcmd Dump.* commands\n\nDefault system and heap dumps to `request=exclusive+prepwalk`\n\nFix a bug reporting an exception when requesting a dump.\n\nUpdate the tests.\n\nSigned-off-by: Peter Shipton <Peter_Shipton@ca.ibm.com>"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "be2c1a6ecd0748dbd3f94d5bbb078c3f9297e163", "author": {"user": {"login": "pshipton", "name": "Peter Shipton"}}, "url": "https://github.com/eclipse-openj9/openj9/commit/be2c1a6ecd0748dbd3f94d5bbb078c3f9297e163", "committedDate": "2020-10-05T23:51:43Z", "message": "Allow -Xdump options for jcmd Dump.* commands\n\nDefault system and heap dumps to `request=exclusive+prepwalk`\n\nFix a bug reporting an exception when requesting a dump.\n\nUpdate the tests.\n\nSigned-off-by: Peter Shipton <Peter_Shipton@ca.ibm.com>"}, "afterCommit": {"oid": "ebe534b4cbc755c27392a9392cde198cddda52cb", "author": {"user": {"login": "pshipton", "name": "Peter Shipton"}}, "url": "https://github.com/eclipse-openj9/openj9/commit/ebe534b4cbc755c27392a9392cde198cddda52cb", "committedDate": "2020-10-06T00:01:07Z", "message": "Allow -Xdump options for jcmd Dump.* commands\n\nDefault system and heap dumps to `request=exclusive+prepwalk`\n\nFix a bug reporting an exception when requesting a dump.\n\nUpdate the tests.\n\nSigned-off-by: Peter Shipton <Peter_Shipton@ca.ibm.com>"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "ebe534b4cbc755c27392a9392cde198cddda52cb", "author": {"user": {"login": "pshipton", "name": "Peter Shipton"}}, "url": "https://github.com/eclipse-openj9/openj9/commit/ebe534b4cbc755c27392a9392cde198cddda52cb", "committedDate": "2020-10-06T00:01:07Z", "message": "Allow -Xdump options for jcmd Dump.* commands\n\nDefault system and heap dumps to `request=exclusive+prepwalk`\n\nFix a bug reporting an exception when requesting a dump.\n\nUpdate the tests.\n\nSigned-off-by: Peter Shipton <Peter_Shipton@ca.ibm.com>"}, "afterCommit": {"oid": "d8bfc33bd470d8bc8e64e785b8d941529132a175", "author": {"user": {"login": "pshipton", "name": "Peter Shipton"}}, "url": "https://github.com/eclipse-openj9/openj9/commit/d8bfc33bd470d8bc8e64e785b8d941529132a175", "committedDate": "2020-10-06T00:06:20Z", "message": "Allow -Xdump options for jcmd Dump.* commands\n\nDefault system and heap dumps to `request=exclusive+prepwalk`\n\nFix a bug reporting an exception when requesting a dump.\n\nUpdate the tests.\n\nSigned-off-by: Peter Shipton <Peter_Shipton@ca.ibm.com>"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTAzMDY2NTYy", "url": "https://github.com/eclipse-openj9/openj9/pull/10774#pullrequestreview-503066562", "createdAt": "2020-10-06T15:04:17Z", "commit": {"oid": "d8bfc33bd470d8bc8e64e785b8d941529132a175"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wNlQxNTowNDoxN1rOHdMBLA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wNlQxNTowNDoxN1rOHdMBLA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMDM2NzY2MA==", "bodyText": "Help for all other commands ends with a final %n; this should too.", "url": "https://github.com/eclipse-openj9/openj9/pull/10774#discussion_r500367660", "createdAt": "2020-10-06T15:04:17Z", "author": {"login": "keithc-ca"}, "path": "jcl/src/java.base/share/classes/openj9/internal/tools/attach/target/DiagnosticUtils.java", "diffHunk": "@@ -356,22 +392,22 @@ private static DiagnosticProperties doHelp(String diagnosticCommand) {\n \t\t\t+ \" Options: -l : print information about ownable synchronizers%n\";\n \n \tprivate static final String DIAGNOSTICS_DUMP_HEAP_HELP = \"Create a heap dump.%n\" //$NON-NLS-1$\n-\t\t\t+ FORMAT_PREFIX + DIAGNOSTICS_DUMP_HEAP + FILE_PATH_HELP\n+\t\t\t+ FORMAT_PREFIX + DIAGNOSTICS_DUMP_HEAP + HEAP_DUMP_OPTION_HELP + HEAPSYSTEM_DUMP_OPTION_HELP + GENERIC_DUMP_OPTION_HELP\n \t\t\t+ DIAGNOSTICS_GC_HEAP_DUMP + \" is an alias for \" + DIAGNOSTICS_DUMP_HEAP; //$NON-NLS-1$", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d8bfc33bd470d8bc8e64e785b8d941529132a175"}, "originalPosition": 93}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "d8bfc33bd470d8bc8e64e785b8d941529132a175", "author": {"user": {"login": "pshipton", "name": "Peter Shipton"}}, "url": "https://github.com/eclipse-openj9/openj9/commit/d8bfc33bd470d8bc8e64e785b8d941529132a175", "committedDate": "2020-10-06T00:06:20Z", "message": "Allow -Xdump options for jcmd Dump.* commands\n\nDefault system and heap dumps to `request=exclusive+prepwalk`\n\nFix a bug reporting an exception when requesting a dump.\n\nUpdate the tests.\n\nSigned-off-by: Peter Shipton <Peter_Shipton@ca.ibm.com>"}, "afterCommit": {"oid": "be029128470aab0b99816eef68654ec0d8d1dd70", "author": {"user": {"login": "pshipton", "name": "Peter Shipton"}}, "url": "https://github.com/eclipse-openj9/openj9/commit/be029128470aab0b99816eef68654ec0d8d1dd70", "committedDate": "2020-10-06T15:36:10Z", "message": "Allow -Xdump options for jcmd Dump.* commands\n\nDefault system and heap dumps to `request=exclusive+prepwalk`\n\nFix a bug reporting an exception when requesting a dump.\n\nUpdate the tests.\n\nSigned-off-by: Peter Shipton <Peter_Shipton@ca.ibm.com>"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "be029128470aab0b99816eef68654ec0d8d1dd70", "author": {"user": {"login": "pshipton", "name": "Peter Shipton"}}, "url": "https://github.com/eclipse-openj9/openj9/commit/be029128470aab0b99816eef68654ec0d8d1dd70", "committedDate": "2020-10-06T15:36:10Z", "message": "Allow -Xdump options for jcmd Dump.* commands\n\nDefault system and heap dumps to `request=exclusive+prepwalk`\n\nFix a bug reporting an exception when requesting a dump.\n\nUpdate the tests.\n\nSigned-off-by: Peter Shipton <Peter_Shipton@ca.ibm.com>"}, "afterCommit": {"oid": "2fcba2e0a39ae37f448fd5928488ad3ff0c9ae2c", "author": {"user": {"login": "pshipton", "name": "Peter Shipton"}}, "url": "https://github.com/eclipse-openj9/openj9/commit/2fcba2e0a39ae37f448fd5928488ad3ff0c9ae2c", "committedDate": "2020-10-06T15:42:12Z", "message": "Allow -Xdump options for jcmd Dump.* commands\n\nDefault system and heap dumps to `request=exclusive+prepwalk`\n\nFix a bug reporting an exception when requesting a dump.\n\nUpdate the tests.\n\nSigned-off-by: Peter Shipton <Peter_Shipton@ca.ibm.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f15577bb3aee2860e638cda623f98209a86edd3b", "author": {"user": {"login": "pshipton", "name": "Peter Shipton"}}, "url": "https://github.com/eclipse-openj9/openj9/commit/f15577bb3aee2860e638cda623f98209a86edd3b", "committedDate": "2020-10-06T16:25:09Z", "message": "Allow -Xdump options for jcmd Dump.* commands\n\nDefault system and heap dumps to `request=exclusive+prepwalk`\n\nFix a bug reporting an exception when requesting a dump.\n\nUpdate the tests.\n\nSigned-off-by: Peter Shipton <Peter_Shipton@ca.ibm.com>"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "2fcba2e0a39ae37f448fd5928488ad3ff0c9ae2c", "author": {"user": {"login": "pshipton", "name": "Peter Shipton"}}, "url": "https://github.com/eclipse-openj9/openj9/commit/2fcba2e0a39ae37f448fd5928488ad3ff0c9ae2c", "committedDate": "2020-10-06T15:42:12Z", "message": "Allow -Xdump options for jcmd Dump.* commands\n\nDefault system and heap dumps to `request=exclusive+prepwalk`\n\nFix a bug reporting an exception when requesting a dump.\n\nUpdate the tests.\n\nSigned-off-by: Peter Shipton <Peter_Shipton@ca.ibm.com>"}, "afterCommit": {"oid": "f15577bb3aee2860e638cda623f98209a86edd3b", "author": {"user": {"login": "pshipton", "name": "Peter Shipton"}}, "url": "https://github.com/eclipse-openj9/openj9/commit/f15577bb3aee2860e638cda623f98209a86edd3b", "committedDate": "2020-10-06T16:25:09Z", "message": "Allow -Xdump options for jcmd Dump.* commands\n\nDefault system and heap dumps to `request=exclusive+prepwalk`\n\nFix a bug reporting an exception when requesting a dump.\n\nUpdate the tests.\n\nSigned-off-by: Peter Shipton <Peter_Shipton@ca.ibm.com>"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTAzMjI3NzE5", "url": "https://github.com/eclipse-openj9/openj9/pull/10774#pullrequestreview-503227719", "createdAt": "2020-10-06T18:04:50Z", "commit": {"oid": "f15577bb3aee2860e638cda623f98209a86edd3b"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wNlQxODowNDo1MVrOHdTybw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wNlQxODowNDo1MVrOHdTybw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMDQ5NDk1OQ==", "bodyText": ": is only appropriate before the first option; subsequent options are separated by ,.\nSorry, I see line 317 now.", "url": "https://github.com/eclipse-openj9/openj9/pull/10774#discussion_r500494959", "createdAt": "2020-10-06T18:04:51Z", "author": {"login": "keithc-ca"}, "path": "jcl/src/java.base/share/classes/openj9/internal/tools/attach/target/DiagnosticUtils.java", "diffHunk": "@@ -272,17 +284,50 @@ private static DiagnosticProperties doDump(String diagnosticCommand) {\n \t\t\t\t}\n \t\t\t}\n \t\t\tif (!dumpType.isEmpty()) {\n-\t\t\t\tString request = dumpType;\n-\t\t\t\tif (parts.length == 2) {\n-\t\t\t\t\tString fileDirective = (\"system\".equals(dumpType) && IPC.isZOS) ? \":dsn=\" : \":file=\"; //$NON-NLS-1$ //$NON-NLS-2$ //$NON-NLS-3$\n-\t\t\t\t\trequest += fileDirective + parts[1];\n+\t\t\t\tStringBuilder request = new StringBuilder();\n+\t\t\t\trequest.append(dumpType);\n+\t\t\t\tString filePath = null;\n+\t\t\t\tboolean foundRequest = false;\n+\t\t\t\tboolean heapDump = \"heap\".equals(dumpType); //$NON-NLS-1$\n+\t\t\t\tboolean systemDump = \"system\".equals(dumpType); //$NON-NLS-1$\n+\t\t\t\tString separator = \":\"; //$NON-NLS-1$", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f15577bb3aee2860e638cda623f98209a86edd3b"}, "originalPosition": 53}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTA0MTUwNTk4", "url": "https://github.com/eclipse-openj9/openj9/pull/10774#pullrequestreview-504150598", "createdAt": "2020-10-07T18:19:26Z", "commit": {"oid": "f15577bb3aee2860e638cda623f98209a86edd3b"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 363, "cost": 1, "resetAt": "2021-10-28T18:00:02Z"}}}