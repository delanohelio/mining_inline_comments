{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDI0MTE3MDYy", "number": 9719, "title": "Fix crash printing to verbose log", "bodyText": "After an AOT Compilation, the compiler either delays the relocation of\nthe body, or the relocation can fail. When this occurs, the\nJ9JITExceptionTable that was allocated has to freed. As part of this\nfreeing process, information is printed out to the verbose log if the\ncode cache verbose options are set. Part of the information that is\nprinted out is the name of the method. This information is retrieved\nfrom the J9JITExceptionTable. However, this information can be NULL\nbecause it gets populated when the table is relocated.\nThis PR adds a NULL check, as well as some sanity checks to ensure\nthat those fields are only NULL in the expected scenarios.", "createdAt": "2020-05-27T21:13:55Z", "url": "https://github.com/eclipse-openj9/openj9/pull/9719", "merged": true, "mergeCommit": {"oid": "f4eebfc680b4ff1a846f8c6e0617e017608f7eea"}, "closed": true, "closedAt": "2020-05-29T14:37:50Z", "author": {"login": "dsouzai"}, "timelineItems": {"totalCount": 6, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABclhkLmAFqTQxOTY3MDEyNQ==", "endCursor": "Y3Vyc29yOnYyOpPPAAABcl5gIhAFqTQyMDYyMjE4MA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDE5NjcwMTI1", "url": "https://github.com/eclipse-openj9/openj9/pull/9719#pullrequestreview-419670125", "createdAt": "2020-05-27T23:07:39Z", "commit": {"oid": "aa554528c3630ebc74ce4ec55abd49b48839414c"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yN1QyMzowNzozOVrOGbgM9w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yN1QyMzowNzozOVrOGbgM9w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMTQ5MjM0Mw==", "bodyText": "If I understand the scenario correctly, these flags will never be seen in the metadata for a \"live\" compiled method. They serve only as a temporary hint passed to addFreeBlock to not print some problematic field. The only downside I see is occupying some bits in the metaData->flags.  If it's not too much hassle, maybe a we should add another parameter to addFreeBlock", "url": "https://github.com/eclipse-openj9/openj9/pull/9719#discussion_r431492343", "createdAt": "2020-05-27T23:07:39Z", "author": {"login": "mpirvu"}, "path": "runtime/compiler/control/CompilationThread.cpp", "diffHunk": "@@ -10371,6 +10371,11 @@ TR::CompilationInfo::compilationEnd(J9VMThread * vmThread, TR::IlGeneratorMethod\n                   J9JITDataCacheHeader *exceptionTableCacheEntry = (J9JITDataCacheHeader *)((U_8 *)cacheEntry + aotMethodHeaderEntry->offsetToExceptionTable);\n                   J9JITExceptionTable *metaData = (J9JITExceptionTable *) (exceptionTableCacheEntry + 1);\n \n+                  if (!canRelocateMethod)", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "aa554528c3630ebc74ce4ec55abd49b48839414c"}, "originalPosition": 4}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ff0fbb35c5153e1c4be0e6acb4b1556ebc518fad", "author": {"user": {"login": "dsouzai", "name": "Irwin D'Souza"}}, "url": "https://github.com/eclipse-openj9/openj9/commit/ff0fbb35c5153e1c4be0e6acb4b1556ebc518fad", "committedDate": "2020-05-28T19:51:13Z", "message": "Don't reset flags field again\n\nWhen the J9JITExceptionTable is allocated, both\nTR_J9ResolvedMethod::allocateException and\nTR_ResolvedRelocatableJ9Method::allocateException memset the allocated\nmemory to 0. Therefore, there is no need to reset the flags to 0 again.\nAdditionally, this prevents any flags from being set in the method that\nallocates the J9JITExceptionTable.\n\nSigned-off-by: Irwin D'Souza <dsouzai.gh@gmail.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e98814bfa3332eba3c2202e3d96dcc5b730d7260", "author": {"user": {"login": "dsouzai", "name": "Irwin D'Souza"}}, "url": "https://github.com/eclipse-openj9/openj9/commit/e98814bfa3332eba3c2202e3d96dcc5b730d7260", "committedDate": "2020-05-28T19:53:19Z", "message": "Don't free twice\n\nIf there is a failure while relocating a method, if the\n_relocationStatus field in TR_RelocationRuntime is set to\nRelocationFailure, during the cleanup addFreeBlock is called. However,\nif the compiled copy of the exception table was used (which can happen\nif disableDelayRelocationForAOTCompilations is specified on the\n-Xjit/-Xaot option), addFreeBlock will also be called in\nCompilationThread.cpp.\n\nWhile currently there might be some implicit coupling that prevents the\ndouble free from happening, this is a bug that's just waiting to show up\nin the future.\n\nSigned-off-by: Irwin D'Souza <dsouzai.gh@gmail.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "5dbbc67cd7f18827c5e724183daf3e86530d21d9", "author": {"user": {"login": "dsouzai", "name": "Irwin D'Souza"}}, "url": "https://github.com/eclipse-openj9/openj9/commit/5dbbc67cd7f18827c5e724183daf3e86530d21d9", "committedDate": "2020-05-28T19:57:49Z", "message": "Fix crash printing to verbose log\n\nAfter an AOT Compilation, the compiler either delays the relocation of\nthe body, or the relocation can fail. When this occurs, the\nJ9JITExceptionTable that was allocated has to freed. As part of this\nfreeing process, information is printed out to the verbose log if the\ncode cache verbose options are set. Part of the information that is\nprinted out is the name of the method. This information is retrieved\nfrom the J9JITExceptionTable. However, this information can be NULL\nbecause it gets populated when the table is relocated.\n\nThis commit adds a NULL check, as well as some sanity checks to ensure\nthat those fields are only NULL in the expected scenarios.\n\nSigned-off-by: Irwin D'Souza <dsouzai.gh@gmail.com>"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "aa554528c3630ebc74ce4ec55abd49b48839414c", "author": {"user": {"login": "dsouzai", "name": "Irwin D'Souza"}}, "url": "https://github.com/eclipse-openj9/openj9/commit/aa554528c3630ebc74ce4ec55abd49b48839414c", "committedDate": "2020-05-27T21:07:38Z", "message": "Fix crash printing to verbose log\n\nAfter an AOT Compilation, the compiler either delays the relocation of\nthe body, or the relocation can fail. When this occurs, the\nJ9JITExceptionTable that was allocated has to freed. As part of this\nfreeing process, information is printed out to the verbose log if the\ncode cache verbose options are set. Part of the information that is\nprinted out is the name of the method. This information is retrieved\nfrom the J9JITExceptionTable. However, this information can be NULL\nbecause it gets populated when the table is relocated.\n\nThis commit adds a NULL check, as well as some sanity checks to ensure\nthat those fields are only NULL in the expected scenarios.\n\nSigned-off-by: Irwin D'Souza <dsouzai.gh@gmail.com>"}, "afterCommit": {"oid": "5dbbc67cd7f18827c5e724183daf3e86530d21d9", "author": {"user": {"login": "dsouzai", "name": "Irwin D'Souza"}}, "url": "https://github.com/eclipse-openj9/openj9/commit/5dbbc67cd7f18827c5e724183daf3e86530d21d9", "committedDate": "2020-05-28T19:57:49Z", "message": "Fix crash printing to verbose log\n\nAfter an AOT Compilation, the compiler either delays the relocation of\nthe body, or the relocation can fail. When this occurs, the\nJ9JITExceptionTable that was allocated has to freed. As part of this\nfreeing process, information is printed out to the verbose log if the\ncode cache verbose options are set. Part of the information that is\nprinted out is the name of the method. This information is retrieved\nfrom the J9JITExceptionTable. However, this information can be NULL\nbecause it gets populated when the table is relocated.\n\nThis commit adds a NULL check, as well as some sanity checks to ensure\nthat those fields are only NULL in the expected scenarios.\n\nSigned-off-by: Irwin D'Souza <dsouzai.gh@gmail.com>"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDIwNjIyMTgw", "url": "https://github.com/eclipse-openj9/openj9/pull/9719#pullrequestreview-420622180", "createdAt": "2020-05-29T03:00:58Z", "commit": {"oid": "5dbbc67cd7f18827c5e724183daf3e86530d21d9"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 788, "cost": 1, "resetAt": "2021-10-28T17:48:14Z"}}}