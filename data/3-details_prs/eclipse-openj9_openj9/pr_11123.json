{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTE2ODYxMTEw", "number": 11123, "title": "Implement java.lang.ref.Reference.refersTo() for Java 16", "bodyText": "Fixes: #11111.", "createdAt": "2020-11-06T16:44:26Z", "url": "https://github.com/eclipse-openj9/openj9/pull/11123", "merged": true, "mergeCommit": {"oid": "e6d96aae8ba54af1924f30b69665d2c305d4cbe0"}, "closed": true, "closedAt": "2020-11-09T21:18:05Z", "author": {"login": "keithc-ca"}, "timelineItems": {"totalCount": 7, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdZ7kEKABqjM5Njg0OTExMzc=", "endCursor": "Y3Vyc29yOnYyOpPPAAABda7fQGAFqTUyNjY2MDU0Ng==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "abe9aade81486aa597fd330e72596fcccc10c6ae", "author": {"user": {"login": "keithc-ca", "name": "Keith W. Campbell"}}, "url": "https://github.com/eclipse-openj9/openj9/commit/abe9aade81486aa597fd330e72596fcccc10c6ae", "committedDate": "2020-11-06T16:29:39Z", "message": "Implement java.lang.ref.Reference.refersTo() for Java 16\n\nSigned-off-by: Keith W. Campbell <keithc@ca.ibm.com>"}, "afterCommit": {"oid": "23571a702fab412bd0e68d623da86a9858162d3d", "author": {"user": {"login": "keithc-ca", "name": "Keith W. Campbell"}}, "url": "https://github.com/eclipse-openj9/openj9/commit/23571a702fab412bd0e68d623da86a9858162d3d", "committedDate": "2020-11-06T18:21:01Z", "message": "Implement java.lang.ref.Reference.refersTo() for Java 16\n\nSigned-off-by: Keith W. Campbell <keithc@ca.ibm.com>"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTI2Mzc0MTU3", "url": "https://github.com/eclipse-openj9/openj9/pull/11123#pullrequestreview-526374157", "createdAt": "2020-11-09T15:32:21Z", "commit": {"oid": "23571a702fab412bd0e68d623da86a9858162d3d"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTI2Mzc5NDM0", "url": "https://github.com/eclipse-openj9/openj9/pull/11123#pullrequestreview-526379434", "createdAt": "2020-11-09T15:37:41Z", "commit": {"oid": "23571a702fab412bd0e68d623da86a9858162d3d"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTI2NTIxNjU4", "url": "https://github.com/eclipse-openj9/openj9/pull/11123#pullrequestreview-526521658", "createdAt": "2020-11-09T18:10:33Z", "commit": {"oid": "23571a702fab412bd0e68d623da86a9858162d3d"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wOVQxODoxMDozM1rOHv7RxQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wOVQxODoxMDozM1rOHv7RxQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMDAxNjMyNQ==", "bodyText": "@RSalman This pattern repeats a few more times in the code.\n\nThis needs to be more generic and refer to SATB barrier, rather than Metronome GC policy\nWe should hide this SATB specialization under the hood of J9VMJAVALANGREFREFERENCE_REFERENT_VM macro", "url": "https://github.com/eclipse-openj9/openj9/pull/11123#discussion_r520016325", "createdAt": "2020-11-09T18:10:33Z", "author": {"login": "amicic"}, "path": "runtime/jcl/common/java_lang_ref_Reference.cpp", "diffHunk": "@@ -63,4 +63,39 @@ Java_java_lang_ref_Reference_waitForReferenceProcessingImpl(JNIEnv *env, jclass\n \treturn result;\n }\n \n+#if JAVA_SPEC_VERSION >= 16\n+JNIEXPORT jboolean JNICALL\n+java_lang_ref_Reference_refersTo(JNIEnv *env, jobject reference, jobject target)\n+{\n+\tJ9VMThread * const currentThread = (J9VMThread *)env;\n+\tJ9JavaVM * const vm = currentThread->javaVM;\n+\tJ9InternalVMFunctions * const vmFuncs = vm->internalVMFunctions;\n+\tjboolean result = JNI_FALSE;\n+\n+\tvmFuncs->internalEnterVMFromJNI(currentThread);\n+\n+\tif (NULL == reference) {\n+\t\tvmFuncs->setCurrentException(currentThread, J9VMCONSTANTPOOL_JAVALANGNULLPOINTEREXCEPTION, NULL);\n+\t} else {\n+\t\tj9object_t j9reference = J9_JNI_UNWRAP_REFERENCE(reference);\n+\t\tj9object_t j9target = (NULL != target) ? J9_JNI_UNWRAP_REFERENCE(target) : NULL;\n+\t\tj9object_t referent = NULL;\n+\n+\t\tif (J9_GC_POLICY_METRONOME == ((OMR_VM *)vm->omrVM)->gcPolicy) {\n+\t\t\treferent = vm->memoryManagerFunctions->j9gc_objaccess_referenceGet(currentThread, j9reference);\n+\t\t} else {\n+\t\t\treferent = J9VMJAVALANGREFREFERENCE_REFERENT_VM(vm, j9reference);\n+\t\t}", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "23571a702fab412bd0e68d623da86a9858162d3d"}, "originalPosition": 33}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ff4b96a34548b6a45a9fca5fe407efbb8b781e7f", "author": {"user": {"login": "keithc-ca", "name": "Keith W. Campbell"}}, "url": "https://github.com/eclipse-openj9/openj9/commit/ff4b96a34548b6a45a9fca5fe407efbb8b781e7f", "committedDate": "2020-11-09T18:54:51Z", "message": "Implement java.lang.ref.Reference.refersTo() for Java 16\n\nSigned-off-by: Keith W. Campbell <keithc@ca.ibm.com>"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "23571a702fab412bd0e68d623da86a9858162d3d", "author": {"user": {"login": "keithc-ca", "name": "Keith W. Campbell"}}, "url": "https://github.com/eclipse-openj9/openj9/commit/23571a702fab412bd0e68d623da86a9858162d3d", "committedDate": "2020-11-06T18:21:01Z", "message": "Implement java.lang.ref.Reference.refersTo() for Java 16\n\nSigned-off-by: Keith W. Campbell <keithc@ca.ibm.com>"}, "afterCommit": {"oid": "ff4b96a34548b6a45a9fca5fe407efbb8b781e7f", "author": {"user": {"login": "keithc-ca", "name": "Keith W. Campbell"}}, "url": "https://github.com/eclipse-openj9/openj9/commit/ff4b96a34548b6a45a9fca5fe407efbb8b781e7f", "committedDate": "2020-11-09T18:54:51Z", "message": "Implement java.lang.ref.Reference.refersTo() for Java 16\n\nSigned-off-by: Keith W. Campbell <keithc@ca.ibm.com>"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTI2NjYwNTQ2", "url": "https://github.com/eclipse-openj9/openj9/pull/11123#pullrequestreview-526660546", "createdAt": "2020-11-09T21:16:15Z", "commit": {"oid": "23571a702fab412bd0e68d623da86a9858162d3d"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 116, "cost": 1, "resetAt": "2021-10-28T18:00:02Z"}}}