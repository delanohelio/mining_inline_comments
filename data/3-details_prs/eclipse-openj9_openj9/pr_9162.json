{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDAwNDU1NDA5", "number": 9162, "title": "Assume java.base for the module of a null caller class", "bodyText": "Assume java.base for the module of a null caller class\nSystem.getCallerClass() might return a null caller class for a caller within a JVMTI callback function when walkStackFrames()/cInterpGetStackClassJEP176Iterator() walked off the end of the stack. Refer #8993 for more info;\nIn such case, assume java.base for the module of such callers.\nNote: this matches the behaviour of com.ibm.oti.vm.VM.getStackClassLoader(depth)\nhttps://github.com/eclipse/openj9/blob/a235102acaeb0cf7dee1bd9590bd714b0daf66eb/runtime/vm/BytecodeInterpreter.hpp#L4099-L4100\ncloses: #8993\nReviewer: @pshipton\nFYI: @DanHeidinga @gacholio\nSigned-off-by: Jason Feng fengj@ca.ibm.com", "createdAt": "2020-04-07T19:22:28Z", "url": "https://github.com/eclipse-openj9/openj9/pull/9162", "merged": true, "mergeCommit": {"oid": "a33cd9900afb6d98b8fc70f621e5d585f6ed83ec"}, "closed": true, "closedAt": "2020-04-08T14:42:19Z", "author": {"login": "JasonFengJ9"}, "timelineItems": {"totalCount": 6, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcVYjzNgFqTM4OTQyOTQyMg==", "endCursor": "Y3Vyc29yOnYyOpPPAAABcVedEuAFqTM4OTYxMzEwOA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzg5NDI5NDIy", "url": "https://github.com/eclipse-openj9/openj9/pull/9162#pullrequestreview-389429422", "createdAt": "2020-04-07T19:35:19Z", "commit": {"oid": "d0ebfe650e436c9fac3a4a3c714ecfd74b560654"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzg5NDcyMjE1", "url": "https://github.com/eclipse-openj9/openj9/pull/9162#pullrequestreview-389472215", "createdAt": "2020-04-07T20:38:37Z", "commit": {"oid": "d0ebfe650e436c9fac3a4a3c714ecfd74b560654"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wN1QyMDozODozN1rOGCVMFg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wN1QyMDozODozN1rOGCVMFg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNTA5NzQ5NA==", "bodyText": "Why add the new API in VM?  Wouldn't doing Class.class.getModule() here work?", "url": "https://github.com/eclipse-openj9/openj9/pull/9162#discussion_r405097494", "createdAt": "2020-04-07T20:38:37Z", "author": {"login": "DanHeidinga"}, "path": "jcl/src/java.base/share/classes/java/lang/Class.java", "diffHunk": "@@ -2019,7 +2019,9 @@ private boolean useModularSearch(String absoluteResName, Module thisModule, Clas\n \tboolean visible = false;\n \n \tif (thisModule.isNamed()) {\n-\t\tfinal Module callerModule = callerClass.getModule();\n+\t\t// when the caller class is null, assuming it is loaded by module java.base\n+\t\t// See https://github.com/eclipse/openj9/issues/8993 for more info\n+\t\tfinal Module callerModule = callerClass == null ? VM.getJavabaseModule() : callerClass.getModule();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d0ebfe650e436c9fac3a4a3c714ecfd74b560654"}, "originalPosition": 7}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "d0ebfe650e436c9fac3a4a3c714ecfd74b560654", "author": {"user": {"login": "JasonFengJ9", "name": "Jason Feng"}}, "url": "https://github.com/eclipse-openj9/openj9/commit/d0ebfe650e436c9fac3a4a3c714ecfd74b560654", "committedDate": "2020-04-07T19:20:06Z", "message": "Assume java.base for the module of a null caller class\n\nSystem.getCallerClass() might return a null caller class for a caller\nwithin a JVMTI callback function when\nwalkStackFrames()/cInterpGetStackClassJEP176Iterator() walked off the\nend of the stack. Refer #8993 for more info;\nIn such case, assume java.base for the module of such callers.\n\nSigned-off-by: Jason Feng <fengj@ca.ibm.com>"}, "afterCommit": {"oid": "530fa285185d07431a4d78df9c94ba6954ff17cd", "author": {"user": {"login": "JasonFengJ9", "name": "Jason Feng"}}, "url": "https://github.com/eclipse-openj9/openj9/commit/530fa285185d07431a4d78df9c94ba6954ff17cd", "committedDate": "2020-04-08T02:10:33Z", "message": "Assume java.base for the module of a null caller class\n\nSystem.getCallerClass() might return a null caller class for a caller\nwithin a JVMTI callback function when\nwalkStackFrames()/cInterpGetStackClassJEP176Iterator() walked off the\nend of the stack. Refer #8993 for more info;\nIn such case, assume java.base for the module of such callers.\n\nSigned-off-by: Jason Feng <fengj@ca.ibm.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "540eb30673d1b84e8c5efbf400e70e98da710fd0", "author": {"user": {"login": "JasonFengJ9", "name": "Jason Feng"}}, "url": "https://github.com/eclipse-openj9/openj9/commit/540eb30673d1b84e8c5efbf400e70e98da710fd0", "committedDate": "2020-04-08T02:14:04Z", "message": "Assume java.base for the module of a null caller class\n\nSystem.getCallerClass() might return a null caller class for a caller\nwithin a JVMTI callback function when\nwalkStackFrames()/cInterpGetStackClassJEP176Iterator() walked off the\nend of the stack. Refer #8993 for more info;\nIn such case, assume java.base for the module of such callers.\n\nSigned-off-by: Jason Feng <fengj@ca.ibm.com>"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "530fa285185d07431a4d78df9c94ba6954ff17cd", "author": {"user": {"login": "JasonFengJ9", "name": "Jason Feng"}}, "url": "https://github.com/eclipse-openj9/openj9/commit/530fa285185d07431a4d78df9c94ba6954ff17cd", "committedDate": "2020-04-08T02:10:33Z", "message": "Assume java.base for the module of a null caller class\n\nSystem.getCallerClass() might return a null caller class for a caller\nwithin a JVMTI callback function when\nwalkStackFrames()/cInterpGetStackClassJEP176Iterator() walked off the\nend of the stack. Refer #8993 for more info;\nIn such case, assume java.base for the module of such callers.\n\nSigned-off-by: Jason Feng <fengj@ca.ibm.com>"}, "afterCommit": {"oid": "540eb30673d1b84e8c5efbf400e70e98da710fd0", "author": {"user": {"login": "JasonFengJ9", "name": "Jason Feng"}}, "url": "https://github.com/eclipse-openj9/openj9/commit/540eb30673d1b84e8c5efbf400e70e98da710fd0", "committedDate": "2020-04-08T02:14:04Z", "message": "Assume java.base for the module of a null caller class\n\nSystem.getCallerClass() might return a null caller class for a caller\nwithin a JVMTI callback function when\nwalkStackFrames()/cInterpGetStackClassJEP176Iterator() walked off the\nend of the stack. Refer #8993 for more info;\nIn such case, assume java.base for the module of such callers.\n\nSigned-off-by: Jason Feng <fengj@ca.ibm.com>"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzg5NjEzMTA4", "url": "https://github.com/eclipse-openj9/openj9/pull/9162#pullrequestreview-389613108", "createdAt": "2020-04-08T02:27:24Z", "commit": {"oid": "540eb30673d1b84e8c5efbf400e70e98da710fd0"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1220, "cost": 1, "resetAt": "2021-10-28T17:48:14Z"}}}