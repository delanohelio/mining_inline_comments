{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDAxMDgxNjg3", "number": 9189, "reviewThreads": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wOVQxMjo0Mzo1OFrODwY5dA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0xM1QyMDowMzoyM1rODxXmHQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjUyMDY2MTY0OnYy", "diffSide": "RIGHT", "path": "runtime/compiler/control/HookedByTheJit.cpp", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wOVQxMjo0Mzo1OFrOGDXEBA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0xM1QxNToxMDozM1rOGEpltA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNjE3Njc3Mg==", "bodyText": "If we take this path at the server something is wrong.\nThus, i would rather place an ASSERT_FATAL here.", "url": "https://github.com/eclipse-openj9/openj9/pull/9189#discussion_r406176772", "createdAt": "2020-04-09T12:43:58Z", "author": {"login": "mpirvu"}, "path": "runtime/compiler/control/HookedByTheJit.cpp", "diffHunk": "@@ -3146,8 +3146,13 @@ void jitIllegalFinalFieldModification(J9VMThread *currentThread, J9Class *fieldC\n    reportHook(currentThread, \"jitIllegalFinalFieldModification\", \"class %p %.*s\", fieldClass, length, className);\n \n    TR::CompilationInfo * compInfo = TR::CompilationInfo::get(jitConfig);\n+\n    TR_RuntimeAssumptionTable * rat = compInfo->getPersistentInfo()->getRuntimeAssumptionTable();\n-   if (rat)\n+   if (rat\n+#if defined(J9VM_OPT_JITSERVER)", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "6ba79f78b4f270b41810882976c9807c306ca999"}, "originalPosition": 8}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNzUyODg4NA==", "bodyText": "We do take this path at the server. Investigating what's wrong here.", "url": "https://github.com/eclipse-openj9/openj9/pull/9189#discussion_r407528884", "createdAt": "2020-04-13T15:10:33Z", "author": {"login": "harryyu1994"}, "path": "runtime/compiler/control/HookedByTheJit.cpp", "diffHunk": "@@ -3146,8 +3146,13 @@ void jitIllegalFinalFieldModification(J9VMThread *currentThread, J9Class *fieldC\n    reportHook(currentThread, \"jitIllegalFinalFieldModification\", \"class %p %.*s\", fieldClass, length, className);\n \n    TR::CompilationInfo * compInfo = TR::CompilationInfo::get(jitConfig);\n+\n    TR_RuntimeAssumptionTable * rat = compInfo->getPersistentInfo()->getRuntimeAssumptionTable();\n-   if (rat)\n+   if (rat\n+#if defined(J9VM_OPT_JITSERVER)", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNjE3Njc3Mg=="}, "originalCommit": {"oid": "6ba79f78b4f270b41810882976c9807c306ca999"}, "originalPosition": 8}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjUyMDY2NzIxOnYy", "diffSide": "LEFT", "path": "runtime/compiler/control/HookedByTheJit.cpp", "isResolved": false, "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wOVQxMjo0NTozOFrOGDXHhg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0xM1QyMDowNTowNlrOGEzW9Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNjE3NzY3MA==", "bodyText": "Why is this code removed. The idea is that, we don't want to update the CHTable at the server because it is not used for compilation anyway.", "url": "https://github.com/eclipse-openj9/openj9/pull/9189#discussion_r406177670", "createdAt": "2020-04-09T12:45:38Z", "author": {"login": "mpirvu"}, "path": "runtime/compiler/control/HookedByTheJit.cpp", "diffHunk": "@@ -3550,9 +3555,6 @@ static bool updateCHTable(J9VMThread * vmThread, J9Class  * cl)\n    TR_PersistentCHTable * table = 0;\n    if (TR::Options::getCmdLineOptions()->allowRecompilation()\n       && !TR::Options::getCmdLineOptions()->getOption(TR_DisableCHOpts)\n-#if defined(J9VM_OPT_JITSERVER)\n-      && compInfo->getPersistentInfo()->getRemoteCompilationMode() != JITServer::SERVER", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "6ba79f78b4f270b41810882976c9807c306ca999"}, "originalPosition": 20}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNzUzMjEzMA==", "bodyText": "I think persistentMemory->getPersistentInfo()->getRuntimeAssumptionTable()->init() is the only place where we call updateCHTable() at the server. Since that's disabled, updateCHTable() is no longer called at the server thus doesn't need a guard.", "url": "https://github.com/eclipse-openj9/openj9/pull/9189#discussion_r407532130", "createdAt": "2020-04-13T15:16:27Z", "author": {"login": "harryyu1994"}, "path": "runtime/compiler/control/HookedByTheJit.cpp", "diffHunk": "@@ -3550,9 +3555,6 @@ static bool updateCHTable(J9VMThread * vmThread, J9Class  * cl)\n    TR_PersistentCHTable * table = 0;\n    if (TR::Options::getCmdLineOptions()->allowRecompilation()\n       && !TR::Options::getCmdLineOptions()->getOption(TR_DisableCHOpts)\n-#if defined(J9VM_OPT_JITSERVER)\n-      && compInfo->getPersistentInfo()->getRemoteCompilationMode() != JITServer::SERVER", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNjE3NzY3MA=="}, "originalCommit": {"oid": "6ba79f78b4f270b41810882976c9807c306ca999"}, "originalPosition": 20}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNzY4ODk0OQ==", "bodyText": "To be sure let's add an ASSERT_FATAL", "url": "https://github.com/eclipse-openj9/openj9/pull/9189#discussion_r407688949", "createdAt": "2020-04-13T20:05:06Z", "author": {"login": "mpirvu"}, "path": "runtime/compiler/control/HookedByTheJit.cpp", "diffHunk": "@@ -3550,9 +3555,6 @@ static bool updateCHTable(J9VMThread * vmThread, J9Class  * cl)\n    TR_PersistentCHTable * table = 0;\n    if (TR::Options::getCmdLineOptions()->allowRecompilation()\n       && !TR::Options::getCmdLineOptions()->getOption(TR_DisableCHOpts)\n-#if defined(J9VM_OPT_JITSERVER)\n-      && compInfo->getPersistentInfo()->getRemoteCompilationMode() != JITServer::SERVER", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNjE3NzY3MA=="}, "originalCommit": {"oid": "6ba79f78b4f270b41810882976c9807c306ca999"}, "originalPosition": 20}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjUzMDkzNDA1OnYy", "diffSide": "RIGHT", "path": "runtime/compiler/control/HookedByTheJit.cpp", "isResolved": false, "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0xM1QyMDowMzoyM1rOGEzTrg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0xNFQwNTozNDowNlrOGE-2xg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNzY4ODExMA==", "bodyText": "compInfo is not defined at this point", "url": "https://github.com/eclipse-openj9/openj9/pull/9189#discussion_r407688110", "createdAt": "2020-04-13T20:03:23Z", "author": {"login": "mpirvu"}, "path": "runtime/compiler/control/HookedByTheJit.cpp", "diffHunk": "@@ -3136,6 +3136,15 @@ void jitMethodBreakpointed(J9VMThread * vmThread, J9Method *j9method)\n  */\n void jitIllegalFinalFieldModification(J9VMThread *currentThread, J9Class *fieldClass)\n    {\n+#if defined(J9VM_OPT_JITSERVER)", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "6276941c3ff42a22b68f64e8216d810819ef227c"}, "originalPosition": 4}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNzgwNTUzNw==", "bodyText": "We should have got the jitConfig like below:\nJ9JITConfig * jitConfig = currentThread->javaVM->jitConfig;\nMaybe it compiles because there is a global somewhere.", "url": "https://github.com/eclipse-openj9/openj9/pull/9189#discussion_r407805537", "createdAt": "2020-04-14T01:04:01Z", "author": {"login": "mpirvu"}, "path": "runtime/compiler/control/HookedByTheJit.cpp", "diffHunk": "@@ -3136,6 +3136,15 @@ void jitMethodBreakpointed(J9VMThread * vmThread, J9Method *j9method)\n  */\n void jitIllegalFinalFieldModification(J9VMThread *currentThread, J9Class *fieldClass)\n    {\n+#if defined(J9VM_OPT_JITSERVER)", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNzY4ODExMA=="}, "originalCommit": {"oid": "6276941c3ff42a22b68f64e8216d810819ef227c"}, "originalPosition": 4}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNzg3NzMxOA==", "bodyText": "Good eye! I can't believe that compiled.", "url": "https://github.com/eclipse-openj9/openj9/pull/9189#discussion_r407877318", "createdAt": "2020-04-14T05:34:06Z", "author": {"login": "harryyu1994"}, "path": "runtime/compiler/control/HookedByTheJit.cpp", "diffHunk": "@@ -3136,6 +3136,15 @@ void jitMethodBreakpointed(J9VMThread * vmThread, J9Method *j9method)\n  */\n void jitIllegalFinalFieldModification(J9VMThread *currentThread, J9Class *fieldClass)\n    {\n+#if defined(J9VM_OPT_JITSERVER)", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNzY4ODExMA=="}, "originalCommit": {"oid": "6276941c3ff42a22b68f64e8216d810819ef227c"}, "originalPosition": 4}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 369, "cost": 1, "resetAt": "2021-11-12T13:16:51Z"}}}