{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0Mzg0OTExMDgw", "number": 8775, "title": "Improve JITServer functional tests and re-enable them", "bodyText": "The patches in this PR 1) make the tests less reliant on timing by making sure the client JVM is constantly generating compilation activity, 2) improve the diagnostic output, and 3) re-enables the tests.", "createdAt": "2020-03-06T16:29:21Z", "url": "https://github.com/eclipse-openj9/openj9/pull/8775", "merged": true, "mergeCommit": {"oid": "ad97b5d181b05202c1d96757080527ffe726f413"}, "closed": true, "closedAt": "2020-04-06T16:40:00Z", "author": {"login": "ymanton"}, "timelineItems": {"totalCount": 8, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcLC5LngBqjMxMDYwNjM5MzA=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcVBc06gFqTM4ODQyNzc5NQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "b93d65077a8b62e56b880d409d532ef843f6cb6b", "author": {"user": {"login": "ymanton", "name": "Younes Manton"}}, "url": "https://github.com/eclipse-openj9/openj9/commit/b93d65077a8b62e56b880d409d532ef843f6cb6b", "committedDate": "2020-03-06T16:23:08Z", "message": "Loop compilation activity in JITServer tests\n\nThese JITServer tests are somewhat sensitive to timing because once\nthe client finishes its work it will exit, but some tests need a long\nrunning client that keeps generating compilation activity while they\nstart/stop/manipulate the server.\n\nThis patch modifies JarTester (the app the client runs) to loop\nforever. JarTester loads and compiles a list of classes via\nshort-lived classloader instances, so simply wrapping that code\nin a loop will allow it to keep generating compilation activity.\n\nSigned-off-by: Younes Manton <ymanton@ca.ibm.com>"}, "afterCommit": {"oid": "16d31df29fa6d7460cdadff40d7d19231a12f8c3", "author": {"user": {"login": "ymanton", "name": "Younes Manton"}}, "url": "https://github.com/eclipse-openj9/openj9/commit/16d31df29fa6d7460cdadff40d7d19231a12f8c3", "committedDate": "2020-03-06T16:41:08Z", "message": "Loop compilation activity in JITServer tests\n\nThese JITServer tests are somewhat sensitive to timing because once\nthe client finishes its work it will exit, but some tests need a long\nrunning client that keeps generating compilation activity while they\nstart/stop/manipulate the server.\n\nThis patch modifies JarTester (the app the client runs) to loop\nforever. JarTester loads and compiles a list of classes via\nshort-lived classloader instances, so simply wrapping that code\nin a loop will allow it to keep generating compilation activity.\n\nSigned-off-by: Younes Manton <ymanton@ca.ibm.com>"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzcwNTAxMzE1", "url": "https://github.com/eclipse-openj9/openj9/pull/8775#pullrequestreview-370501315", "createdAt": "2020-03-06T17:32:27Z", "commit": {"oid": "16d31df29fa6d7460cdadff40d7d19231a12f8c3"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wNlQxNzozMjoyN1rOFzBPvg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wNlQxNzozMjoyN1rOFzBPvg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4OTA0MjExMA==", "bodyText": "If the process runs forever, who shuts it down? Timeout?", "url": "https://github.com/eclipse-openj9/openj9/pull/8775#discussion_r389042110", "createdAt": "2020-03-06T17:32:27Z", "author": {"login": "mpirvu"}, "path": "test/functional/JIT_Test/src/jit/test/jar/ZipTester.java", "diffHunk": "@@ -53,23 +58,31 @@\n \tpublic static void main(String args[]) {\n \t\tnew ZipTester().run(args);\n \t}\n-\t\n+\n \tpublic void run(String args[]) {\n \t\tif (args.length < 1 || args[0].isEmpty()) {\n \t\t\tprintUsageText();\n \t\t\tAssert.fail();\n \t\t}\n \n-\t\tString classFilter = args[0];\n+\t\tString classFilter = \"\";\n+\t\tboolean loopForever = false;\n \t\tint zipFilenameIndex = 0;\n-\t\tif (!classFilter.startsWith(CLASS_FILTER_TAG))\n-\t\t\tclassFilter = \"\";\n-\t\telse {\n-\t\t\tclassFilter = classFilter.substring(CLASS_FILTER_TAG.length());\n-\t\t\tzipFilenameIndex = 1;\n+\n+\t\twhile (args[zipFilenameIndex].startsWith(TAG_PREFIX)) {\n+\t\t\tif (args[zipFilenameIndex].startsWith(CLASS_FILTER_TAG))\n+\t\t\t\tclassFilter = classFilter.substring(CLASS_FILTER_TAG.length());\n+\t\t\telse if (args[zipFilenameIndex].equals(LOOP_FOREVER_TAG))\n+\t\t\t\tloopForever = true;\n+\t\t\tzipFilenameIndex++;\n \t\t}\n \n-\t\tprocess(classFilter, args, zipFilenameIndex);\n+\t\tif (loopForever)\n+\t\t\tlogger.info(LOOP_FOREVER_TAG + \" was specified; test will run continuously until the JVM is terminated.\");\n+\n+\t\tdo {\n+\t\t\tprocess(classFilter, args, zipFilenameIndex);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "16d31df29fa6d7460cdadff40d7d19231a12f8c3"}, "originalPosition": 60}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "3f904def64874be1f75ae0d2c553fb169ea36ee9", "author": {"user": {"login": "ymanton", "name": "Younes Manton"}}, "url": "https://github.com/eclipse-openj9/openj9/commit/3f904def64874be1f75ae0d2c553fb169ea36ee9", "committedDate": "2020-03-19T14:24:12Z", "message": "Improve JITServer test diagnostic messages\n\nThis patch prints more details when things fail and makes it easier\nto distinguish client and server log dumps in the output.\n\nSigned-off-by: Younes Manton <ymanton@ca.ibm.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b93c66bb9072c792af35130697e2385eb3919360", "author": {"user": {"login": "ymanton", "name": "Younes Manton"}}, "url": "https://github.com/eclipse-openj9/openj9/commit/b93c66bb9072c792af35130697e2385eb3919360", "committedDate": "2020-03-19T14:24:12Z", "message": "Handle quoted strings for JITServer test sub-procs\n\nSigned-off-by: Younes Manton <ymanton@ca.ibm.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "8339fd3981eae52e81cdc90f98590a26e9a5a39b", "author": {"user": {"login": "ymanton", "name": "Younes Manton"}}, "url": "https://github.com/eclipse-openj9/openj9/commit/8339fd3981eae52e81cdc90f98590a26e9a5a39b", "committedDate": "2020-03-19T14:24:12Z", "message": "Loop compilation activity in JITServer tests\n\nThese JITServer tests are somewhat sensitive to timing because once\nthe client finishes its work it will exit, but some tests need a long\nrunning client that keeps generating compilation activity while they\nstart/stop/manipulate the server.\n\nThis patch modifies JarTester (the app the client runs) to loop\nforever. JarTester loads and compiles a list of classes via\nshort-lived classloader instances, so simply wrapping that code\nin a loop will allow it to keep generating compilation activity.\n\nSigned-off-by: Younes Manton <ymanton@ca.ibm.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "5116404df610618f90feed284df375bfdeb564d7", "author": {"user": {"login": "ymanton", "name": "Younes Manton"}}, "url": "https://github.com/eclipse-openj9/openj9/commit/5116404df610618f90feed284df375bfdeb564d7", "committedDate": "2020-03-19T14:25:44Z", "message": "Re-enable JITServer functional tests\n\nThese tests were disabled temporarily while a large number of\nfailures were investigated. The suspected bug has since been\nfixed.\n\nSigned-off-by: Younes Manton <ymanton@ca.ibm.com>"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "16d31df29fa6d7460cdadff40d7d19231a12f8c3", "author": {"user": {"login": "ymanton", "name": "Younes Manton"}}, "url": "https://github.com/eclipse-openj9/openj9/commit/16d31df29fa6d7460cdadff40d7d19231a12f8c3", "committedDate": "2020-03-06T16:41:08Z", "message": "Loop compilation activity in JITServer tests\n\nThese JITServer tests are somewhat sensitive to timing because once\nthe client finishes its work it will exit, but some tests need a long\nrunning client that keeps generating compilation activity while they\nstart/stop/manipulate the server.\n\nThis patch modifies JarTester (the app the client runs) to loop\nforever. JarTester loads and compiles a list of classes via\nshort-lived classloader instances, so simply wrapping that code\nin a loop will allow it to keep generating compilation activity.\n\nSigned-off-by: Younes Manton <ymanton@ca.ibm.com>"}, "afterCommit": {"oid": "5116404df610618f90feed284df375bfdeb564d7", "author": {"user": {"login": "ymanton", "name": "Younes Manton"}}, "url": "https://github.com/eclipse-openj9/openj9/commit/5116404df610618f90feed284df375bfdeb564d7", "committedDate": "2020-03-19T14:25:44Z", "message": "Re-enable JITServer functional tests\n\nThese tests were disabled temporarily while a large number of\nfailures were investigated. The suspected bug has since been\nfixed.\n\nSigned-off-by: Younes Manton <ymanton@ca.ibm.com>"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzg4NDI3Nzk1", "url": "https://github.com/eclipse-openj9/openj9/pull/8775#pullrequestreview-388427795", "createdAt": "2020-04-06T16:39:53Z", "commit": {"oid": "5116404df610618f90feed284df375bfdeb564d7"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 405, "cost": 1, "resetAt": "2021-10-28T18:00:02Z"}}}