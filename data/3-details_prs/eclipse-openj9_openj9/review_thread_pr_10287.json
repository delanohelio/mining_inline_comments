{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDU4NjE0MDg2", "number": 10287, "reviewThreads": {"totalCount": 6, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yOVQxODo1MDowMlrOETYeBQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0zMFQxNDoyODo0MlrOETtE4w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjg4NzU5MzAxOnYy", "diffSide": "RIGHT", "path": "runtime/tests/port/si.c", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yOVQxODo1MDowMlrOG5FoEA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yOVQyMDozMjo0NFrOG5JFeg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MjUxNDE5Mg==", "bodyText": "OSX appears to have a similar issue with /tmp being /private/tmp handled above by:\n#if defined(OSX)\n\tconst char *utf8 = \"/private/tmp/j9sysinfo_test_get_cwd3/\";\n#else /* defined(OSX) */\n\nCan this be adapted for Z to always use /SYSTEM/tmp/j9sysinfo_test_get_cwd3/?", "url": "https://github.com/eclipse-openj9/openj9/pull/10287#discussion_r462514192", "createdAt": "2020-07-29T18:50:02Z", "author": {"login": "DanHeidinga"}, "path": "runtime/tests/port/si.c", "diffHunk": "@@ -1892,10 +1892,22 @@ j9sysinfo_test_get_cwd3(struct J9PortLibrary *portLibrary)\n \t} else {\n \t\toutputComment(PORTLIB, \"CWD = %s\\n\", buffer);\n \t}\n-\n-\trc = memcmp(utf8, buffer, strlen(buffer));\n-\tif (0 != rc) {\n-\t\toutputErrorMessage(PORTTEST_ERROR_ARGS, \"invalid directory rc: %d\\n\", rc);\n+\t\n+\t\n+\t{\n+\t\tchar *cmpBuffer = buffer;\n+#if defined(J9ZOS390)\n+\t\t/* On z/OS, the /tmp directory is typically found in /SYSTEM. */", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "dc9120f8ef86f1e967b842bb371b423eabd67fb4"}, "originalPosition": 13}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MjU3MDg3NA==", "bodyText": "It doesn't work on the older machines, but I can do what Keith is suggesting.", "url": "https://github.com/eclipse-openj9/openj9/pull/10287#discussion_r462570874", "createdAt": "2020-07-29T20:32:44Z", "author": {"login": "pshipton"}, "path": "runtime/tests/port/si.c", "diffHunk": "@@ -1892,10 +1892,22 @@ j9sysinfo_test_get_cwd3(struct J9PortLibrary *portLibrary)\n \t} else {\n \t\toutputComment(PORTLIB, \"CWD = %s\\n\", buffer);\n \t}\n-\n-\trc = memcmp(utf8, buffer, strlen(buffer));\n-\tif (0 != rc) {\n-\t\toutputErrorMessage(PORTTEST_ERROR_ARGS, \"invalid directory rc: %d\\n\", rc);\n+\t\n+\t\n+\t{\n+\t\tchar *cmpBuffer = buffer;\n+#if defined(J9ZOS390)\n+\t\t/* On z/OS, the /tmp directory is typically found in /SYSTEM. */", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MjUxNDE5Mg=="}, "originalCommit": {"oid": "dc9120f8ef86f1e967b842bb371b423eabd67fb4"}, "originalPosition": 13}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjg4ODgyMzU1OnYy", "diffSide": "RIGHT", "path": "runtime/tests/port/si.c", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0zMFQwMjo1NToyMVrOG5ROeA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0zMFQwNDoxNDo1MVrOG5Sb3A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MjcwNDI0OA==", "bodyText": "This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters. Learn more about bidirectional Unicode characters\n\n\n  \n\n\n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            \tj9sysinfo_get_cwd(cmpbuf, EsMaxPath);\n          \n          \n            \n            \trc = j9sysinfo_get_cwd(cmpbuf, EsMaxPath);", "url": "https://github.com/eclipse-openj9/openj9/pull/10287#discussion_r462704248", "createdAt": "2020-07-30T02:55:21Z", "author": {"login": "DanHeidinga"}, "path": "runtime/tests/port/si.c", "diffHunk": "@@ -1855,17 +1858,40 @@ j9sysinfo_test_get_cwd3(struct J9PortLibrary *portLibrary)\n \t\t\toutputErrorMessage(PORTTEST_ERROR_ARGS, \"error failed to change current directory rc: %d\\n\", rc);\n \t}\n #else /* defined(WIN32) */\n-#if defined(OSX)\n-\tconst char *utf8 = \"/private/tmp/j9sysinfo_test_get_cwd3/\";\n-#else /* defined(OSX) */\n-\tconst char *utf8 = \"/tmp/j9sysinfo_test_get_cwd3/\";\n-#endif /* defined(OSX) */\n+\tconst char *tmp = \"/tmp/\";\n+\tconst char *utf8 = \"j9sysinfo_test_get_cwd3/\";\n \n \treportTestEntry(portLibrary, testName);\n \n \torig_cwd = (char*)j9mem_allocate_memory( EsMaxPath, OMRMEM_CATEGORY_PORT_LIBRARY );\n \tj9sysinfo_get_cwd(orig_cwd, EsMaxPath);\n \n+\t/* /tmp may be a symlink or similar, get it's actual path first */\n+#if defined(J9ZOS390)\n+\trc = atoe_chdir(tmp);\n+#else /* defined(J9ZOS390) */\n+\trc = chdir(tmp);\n+#endif /* defined(J9ZOS390) */\n+\tif (0 != rc) {\n+\t\toutputErrorMessage(PORTTEST_ERROR_ARGS, \"cd %s failed rc: %d\\n\", tmp, rc);\n+\t} else {\n+\t\toutputComment(portLibrary, \"cd %s\\n\", tmp);\n+\t}\n+\t\n+\tcmpbuf = (char*)j9mem_allocate_memory( EsMaxPath, OMRMEM_CATEGORY_PORT_LIBRARY );\n+\n+\tj9sysinfo_get_cwd(cmpbuf, EsMaxPath);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "802938537dd80b95cad44b1eef66586c7ce2ab8a"}, "originalPosition": 48}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MjcyNDA2MA==", "bodyText": "Updated", "url": "https://github.com/eclipse-openj9/openj9/pull/10287#discussion_r462724060", "createdAt": "2020-07-30T04:14:51Z", "author": {"login": "pshipton"}, "path": "runtime/tests/port/si.c", "diffHunk": "@@ -1855,17 +1858,40 @@ j9sysinfo_test_get_cwd3(struct J9PortLibrary *portLibrary)\n \t\t\toutputErrorMessage(PORTTEST_ERROR_ARGS, \"error failed to change current directory rc: %d\\n\", rc);\n \t}\n #else /* defined(WIN32) */\n-#if defined(OSX)\n-\tconst char *utf8 = \"/private/tmp/j9sysinfo_test_get_cwd3/\";\n-#else /* defined(OSX) */\n-\tconst char *utf8 = \"/tmp/j9sysinfo_test_get_cwd3/\";\n-#endif /* defined(OSX) */\n+\tconst char *tmp = \"/tmp/\";\n+\tconst char *utf8 = \"j9sysinfo_test_get_cwd3/\";\n \n \treportTestEntry(portLibrary, testName);\n \n \torig_cwd = (char*)j9mem_allocate_memory( EsMaxPath, OMRMEM_CATEGORY_PORT_LIBRARY );\n \tj9sysinfo_get_cwd(orig_cwd, EsMaxPath);\n \n+\t/* /tmp may be a symlink or similar, get it's actual path first */\n+#if defined(J9ZOS390)\n+\trc = atoe_chdir(tmp);\n+#else /* defined(J9ZOS390) */\n+\trc = chdir(tmp);\n+#endif /* defined(J9ZOS390) */\n+\tif (0 != rc) {\n+\t\toutputErrorMessage(PORTTEST_ERROR_ARGS, \"cd %s failed rc: %d\\n\", tmp, rc);\n+\t} else {\n+\t\toutputComment(portLibrary, \"cd %s\\n\", tmp);\n+\t}\n+\t\n+\tcmpbuf = (char*)j9mem_allocate_memory( EsMaxPath, OMRMEM_CATEGORY_PORT_LIBRARY );\n+\n+\tj9sysinfo_get_cwd(cmpbuf, EsMaxPath);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MjcwNDI0OA=="}, "originalCommit": {"oid": "802938537dd80b95cad44b1eef66586c7ce2ab8a"}, "originalPosition": 48}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjg5MDk1MDc4OnYy", "diffSide": "RIGHT", "path": "runtime/tests/port/si.c", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0zMFQxNDoyNDo1NVrOG5laLg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0zMFQxNDoyNDo1NVrOG5laLg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MzAzNDkyNg==", "bodyText": "The test cannot continue; suggest goto cleanup; (adding that label and appropriate actions).", "url": "https://github.com/eclipse-openj9/openj9/pull/10287#discussion_r463034926", "createdAt": "2020-07-30T14:24:55Z", "author": {"login": "keithc-ca"}, "path": "runtime/tests/port/si.c", "diffHunk": "@@ -1855,17 +1858,40 @@ j9sysinfo_test_get_cwd3(struct J9PortLibrary *portLibrary)\n \t\t\toutputErrorMessage(PORTTEST_ERROR_ARGS, \"error failed to change current directory rc: %d\\n\", rc);\n \t}\n #else /* defined(WIN32) */\n-#if defined(OSX)\n-\tconst char *utf8 = \"/private/tmp/j9sysinfo_test_get_cwd3/\";\n-#else /* defined(OSX) */\n-\tconst char *utf8 = \"/tmp/j9sysinfo_test_get_cwd3/\";\n-#endif /* defined(OSX) */\n+\tconst char *tmp = \"/tmp/\";\n+\tconst char *utf8 = \"j9sysinfo_test_get_cwd3/\";\n \n \treportTestEntry(portLibrary, testName);\n \n \torig_cwd = (char*)j9mem_allocate_memory( EsMaxPath, OMRMEM_CATEGORY_PORT_LIBRARY );\n \tj9sysinfo_get_cwd(orig_cwd, EsMaxPath);\n \n+\t/* /tmp may be a symlink or similar, get it's actual path first */\n+#if defined(J9ZOS390)\n+\trc = atoe_chdir(tmp);\n+#else /* defined(J9ZOS390) */\n+\trc = chdir(tmp);\n+#endif /* defined(J9ZOS390) */\n+\tif (0 != rc) {\n+\t\toutputErrorMessage(PORTTEST_ERROR_ARGS, \"cd %s failed rc: %d\\n\", tmp, rc);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "6772cda75a82f4915bc49ea7afef7b5f5f63bdc2"}, "originalPosition": 41}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjg5MDk1MjUzOnYy", "diffSide": "RIGHT", "path": "runtime/tests/port/si.c", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0zMFQxNDoyNToxNFrOG5lbOA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0zMFQxNDoyNToxNFrOG5lbOA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MzAzNTE5Mg==", "bodyText": "goto cleanup;", "url": "https://github.com/eclipse-openj9/openj9/pull/10287#discussion_r463035192", "createdAt": "2020-07-30T14:25:14Z", "author": {"login": "keithc-ca"}, "path": "runtime/tests/port/si.c", "diffHunk": "@@ -1855,17 +1858,40 @@ j9sysinfo_test_get_cwd3(struct J9PortLibrary *portLibrary)\n \t\t\toutputErrorMessage(PORTTEST_ERROR_ARGS, \"error failed to change current directory rc: %d\\n\", rc);\n \t}\n #else /* defined(WIN32) */\n-#if defined(OSX)\n-\tconst char *utf8 = \"/private/tmp/j9sysinfo_test_get_cwd3/\";\n-#else /* defined(OSX) */\n-\tconst char *utf8 = \"/tmp/j9sysinfo_test_get_cwd3/\";\n-#endif /* defined(OSX) */\n+\tconst char *tmp = \"/tmp/\";\n+\tconst char *utf8 = \"j9sysinfo_test_get_cwd3/\";\n \n \treportTestEntry(portLibrary, testName);\n \n \torig_cwd = (char*)j9mem_allocate_memory( EsMaxPath, OMRMEM_CATEGORY_PORT_LIBRARY );\n \tj9sysinfo_get_cwd(orig_cwd, EsMaxPath);\n \n+\t/* /tmp may be a symlink or similar, get it's actual path first */\n+#if defined(J9ZOS390)\n+\trc = atoe_chdir(tmp);\n+#else /* defined(J9ZOS390) */\n+\trc = chdir(tmp);\n+#endif /* defined(J9ZOS390) */\n+\tif (0 != rc) {\n+\t\toutputErrorMessage(PORTTEST_ERROR_ARGS, \"cd %s failed rc: %d\\n\", tmp, rc);\n+\t} else {\n+\t\toutputComment(portLibrary, \"cd %s\\n\", tmp);\n+\t}\n+\t\n+\tcmpbuf = (char*)j9mem_allocate_memory( EsMaxPath, OMRMEM_CATEGORY_PORT_LIBRARY );\n+\n+\trc = j9sysinfo_get_cwd(cmpbuf, EsMaxPath);\n+\tif (0 != rc) {\n+\t\toutputErrorMessage(PORTTEST_ERROR_ARGS, \"error failed to get current working directory rc: %d\\n\", rc);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "6772cda75a82f4915bc49ea7afef7b5f5f63bdc2"}, "originalPosition": 50}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjg5MDk1ODgxOnYy", "diffSide": "RIGHT", "path": "runtime/tests/port/si.c", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0zMFQxNDoyNjozMFrOG5lfGg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0zMFQxNDoyNjozMFrOG5lfGg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MzAzNjE4Ng==", "bodyText": "What if strlen(cmpbuf) == 0?", "url": "https://github.com/eclipse-openj9/openj9/pull/10287#discussion_r463036186", "createdAt": "2020-07-30T14:26:30Z", "author": {"login": "keithc-ca"}, "path": "runtime/tests/port/si.c", "diffHunk": "@@ -1855,17 +1858,40 @@ j9sysinfo_test_get_cwd3(struct J9PortLibrary *portLibrary)\n \t\t\toutputErrorMessage(PORTTEST_ERROR_ARGS, \"error failed to change current directory rc: %d\\n\", rc);\n \t}\n #else /* defined(WIN32) */\n-#if defined(OSX)\n-\tconst char *utf8 = \"/private/tmp/j9sysinfo_test_get_cwd3/\";\n-#else /* defined(OSX) */\n-\tconst char *utf8 = \"/tmp/j9sysinfo_test_get_cwd3/\";\n-#endif /* defined(OSX) */\n+\tconst char *tmp = \"/tmp/\";\n+\tconst char *utf8 = \"j9sysinfo_test_get_cwd3/\";\n \n \treportTestEntry(portLibrary, testName);\n \n \torig_cwd = (char*)j9mem_allocate_memory( EsMaxPath, OMRMEM_CATEGORY_PORT_LIBRARY );\n \tj9sysinfo_get_cwd(orig_cwd, EsMaxPath);\n \n+\t/* /tmp may be a symlink or similar, get it's actual path first */\n+#if defined(J9ZOS390)\n+\trc = atoe_chdir(tmp);\n+#else /* defined(J9ZOS390) */\n+\trc = chdir(tmp);\n+#endif /* defined(J9ZOS390) */\n+\tif (0 != rc) {\n+\t\toutputErrorMessage(PORTTEST_ERROR_ARGS, \"cd %s failed rc: %d\\n\", tmp, rc);\n+\t} else {\n+\t\toutputComment(portLibrary, \"cd %s\\n\", tmp);\n+\t}\n+\t\n+\tcmpbuf = (char*)j9mem_allocate_memory( EsMaxPath, OMRMEM_CATEGORY_PORT_LIBRARY );\n+\n+\trc = j9sysinfo_get_cwd(cmpbuf, EsMaxPath);\n+\tif (0 != rc) {\n+\t\toutputErrorMessage(PORTTEST_ERROR_ARGS, \"error failed to get current working directory rc: %d\\n\", rc);\n+\t} else {\n+\t\toutputComment(PORTLIB, \"CWD = %s\\n\", cmpbuf);\n+\t}\n+\tif ('/' != cmpbuf[strlen(cmpbuf) - 1]) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "6772cda75a82f4915bc49ea7afef7b5f5f63bdc2"}, "originalPosition": 54}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjg5MDk2OTMxOnYy", "diffSide": "RIGHT", "path": "runtime/tests/port/si.c", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0zMFQxNDoyODo0MlrOG5lleA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0zMFQxNTo0MjowMlrOG5o0aQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MzAzNzgxNg==", "bodyText": "It would help if this message included the actual and expected directories.", "url": "https://github.com/eclipse-openj9/openj9/pull/10287#discussion_r463037816", "createdAt": "2020-07-30T14:28:42Z", "author": {"login": "keithc-ca"}, "path": "runtime/tests/port/si.c", "diffHunk": "@@ -1893,7 +1919,7 @@ j9sysinfo_test_get_cwd3(struct J9PortLibrary *portLibrary)\n \t\toutputComment(PORTLIB, \"CWD = %s\\n\", buffer);\n \t}\n \n-\trc = memcmp(utf8, buffer, strlen(buffer));\n+\trc = memcmp(cmpbuf, buffer, strlen(buffer));\n \tif (0 != rc) {\n \t\toutputErrorMessage(PORTTEST_ERROR_ARGS, \"invalid directory rc: %d\\n\", rc);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "6772cda75a82f4915bc49ea7afef7b5f5f63bdc2"}, "originalPosition": 70}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MzA5MDc5Mw==", "bodyText": "They are printed by previous statements.", "url": "https://github.com/eclipse-openj9/openj9/pull/10287#discussion_r463090793", "createdAt": "2020-07-30T15:42:02Z", "author": {"login": "pshipton"}, "path": "runtime/tests/port/si.c", "diffHunk": "@@ -1893,7 +1919,7 @@ j9sysinfo_test_get_cwd3(struct J9PortLibrary *portLibrary)\n \t\toutputComment(PORTLIB, \"CWD = %s\\n\", buffer);\n \t}\n \n-\trc = memcmp(utf8, buffer, strlen(buffer));\n+\trc = memcmp(cmpbuf, buffer, strlen(buffer));\n \tif (0 != rc) {\n \t\toutputErrorMessage(PORTTEST_ERROR_ARGS, \"invalid directory rc: %d\\n\", rc);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MzAzNzgxNg=="}, "originalCommit": {"oid": "6772cda75a82f4915bc49ea7afef7b5f5f63bdc2"}, "originalPosition": 70}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4842, "cost": 1, "resetAt": "2021-11-12T18:49:56Z"}}}