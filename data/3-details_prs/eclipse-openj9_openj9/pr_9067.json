{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0Mzk2OTg4NzI3", "number": 9067, "title": "Move FrontEnd containesZeroOrOneConcreteClass into ClassEnv", "bodyText": "This PR contains two parts, add noMultipleConcreteClasses into ClassEnv, and remove noMultipleConcreteClasses from FrontEnd.\nPrevious OpenJ9 PR: #8933\nOMR PR: eclipse/omr#4959\nReference: #8699\nSigned-off-by: Chris Chong Zichun.Chong@ibm.com", "createdAt": "2020-04-01T13:16:56Z", "url": "https://github.com/eclipse-openj9/openj9/pull/9067", "merged": true, "mergeCommit": {"oid": "958d2f9b581efc1ddf774753520d709e64c7d6e7"}, "closed": true, "closedAt": "2020-04-04T19:13:30Z", "author": {"login": "chrisc66"}, "timelineItems": {"totalCount": 9, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcTX_DkABqjMxODc5OTQxMzk=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcUMhvegBqjMxOTg2ODQ2MjM=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "9ccb687a48a48850f8da8163ec15fab6c6a6a008", "author": {"user": {"login": "chrisc66", "name": "Zichun (Chris) Chong"}}, "url": "https://github.com/eclipse-openj9/openj9/commit/9ccb687a48a48850f8da8163ec15fab6c6a6a008", "committedDate": "2020-04-01T13:09:57Z", "message": "Move FrontEnd noMultipleConcreteClasses into ClassEnv\n\nFrontEnd is depreciated, thus moving numConcreteClass\nfrontend query into ClassEnv\n\nSigned-off-by: Chris Chong <Zichun.Chong@ibm.com>"}, "afterCommit": {"oid": "67e5393b7cc22376d5eb68145e8e5af57a60f404", "author": {"user": {"login": "chrisc66", "name": "Zichun (Chris) Chong"}}, "url": "https://github.com/eclipse-openj9/openj9/commit/67e5393b7cc22376d5eb68145e8e5af57a60f404", "committedDate": "2020-04-01T13:47:02Z", "message": "Move FrontEnd noMultipleConcreteClasses into ClassEnv\n\nFrontEnd is depreciated, thus moving numConcreteClass\nfrontend query into ClassEnv\n\nSigned-off-by: Chris Chong <Zichun.Chong@ibm.com>"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "67e5393b7cc22376d5eb68145e8e5af57a60f404", "author": {"user": {"login": "chrisc66", "name": "Zichun (Chris) Chong"}}, "url": "https://github.com/eclipse-openj9/openj9/commit/67e5393b7cc22376d5eb68145e8e5af57a60f404", "committedDate": "2020-04-01T13:47:02Z", "message": "Move FrontEnd noMultipleConcreteClasses into ClassEnv\n\nFrontEnd is depreciated, thus moving numConcreteClass\nfrontend query into ClassEnv\n\nSigned-off-by: Chris Chong <Zichun.Chong@ibm.com>"}, "afterCommit": {"oid": "72a8c8b0d33e07aa62c691826af35dd520e87094", "author": {"user": {"login": "chrisc66", "name": "Zichun (Chris) Chong"}}, "url": "https://github.com/eclipse-openj9/openj9/commit/72a8c8b0d33e07aa62c691826af35dd520e87094", "committedDate": "2020-04-01T14:18:09Z", "message": "Move FrontEnd noMultipleConcreteClasses into ClassEnv\n\nOMR FrontEnd is depreciated\nThus removing noMultipleConcreteClasses frontend query, and\nmove it to ClassEnv\n\nSigned-off-by: Chris Chong <Zichun.Chong@ibm.com>"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "72a8c8b0d33e07aa62c691826af35dd520e87094", "author": {"user": {"login": "chrisc66", "name": "Zichun (Chris) Chong"}}, "url": "https://github.com/eclipse-openj9/openj9/commit/72a8c8b0d33e07aa62c691826af35dd520e87094", "committedDate": "2020-04-01T14:18:09Z", "message": "Move FrontEnd noMultipleConcreteClasses into ClassEnv\n\nOMR FrontEnd is depreciated\nThus removing noMultipleConcreteClasses frontend query, and\nmove it to ClassEnv\n\nSigned-off-by: Chris Chong <Zichun.Chong@ibm.com>"}, "afterCommit": {"oid": "2823d78ac17b00b2a14a7f79fe8f989a705f96c4", "author": {"user": {"login": "chrisc66", "name": "Zichun (Chris) Chong"}}, "url": "https://github.com/eclipse-openj9/openj9/commit/2823d78ac17b00b2a14a7f79fe8f989a705f96c4", "committedDate": "2020-04-01T19:03:35Z", "message": "Move FrontEnd noMultipleConcreteClasses into ClassEnv\n\nOMR FrontEnd is depreciated\nThus removing noMultipleConcreteClasses frontend query, and\nmove it to ClassEnv\n\nSigned-off-by: Chris Chong <Zichun.Chong@ibm.com>"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "2823d78ac17b00b2a14a7f79fe8f989a705f96c4", "author": {"user": {"login": "chrisc66", "name": "Zichun (Chris) Chong"}}, "url": "https://github.com/eclipse-openj9/openj9/commit/2823d78ac17b00b2a14a7f79fe8f989a705f96c4", "committedDate": "2020-04-01T19:03:35Z", "message": "Move FrontEnd noMultipleConcreteClasses into ClassEnv\n\nOMR FrontEnd is depreciated\nThus removing noMultipleConcreteClasses frontend query, and\nmove it to ClassEnv\n\nSigned-off-by: Chris Chong <Zichun.Chong@ibm.com>"}, "afterCommit": {"oid": "8309612c33ca70889ebea3ceca695805168cff2b", "author": {"user": {"login": "chrisc66", "name": "Zichun (Chris) Chong"}}, "url": "https://github.com/eclipse-openj9/openj9/commit/8309612c33ca70889ebea3ceca695805168cff2b", "committedDate": "2020-04-02T14:53:44Z", "message": "Move FrontEnd noMultipleConcreteClasses into ClassEnv\n\nOMR FrontEnd is depreciated\nThus removing noMultipleConcreteClasses frontend query, and\nmove it to ClassEnv\nAlso rename the function to containesZeroOrOneConcreteClass\n\nSigned-off-by: Chris Chong <Zichun.Chong@ibm.com>"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzg2ODE2NDM2", "url": "https://github.com/eclipse-openj9/openj9/pull/9067#pullrequestreview-386816436", "createdAt": "2020-04-02T22:17:24Z", "commit": {"oid": "8309612c33ca70889ebea3ceca695805168cff2b"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wMlQyMjoxNzoyNFrOF_-dgA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wMlQyMjoyMDoyMVrOF_-iWA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMjYyNzk2OA==", "bodyText": "You need to include the header file with the definition of TR_PersistentClassInfo", "url": "https://github.com/eclipse-openj9/openj9/pull/9067#discussion_r402627968", "createdAt": "2020-04-02T22:17:24Z", "author": {"login": "mpirvu"}, "path": "runtime/compiler/env/J9ClassEnv.cpp", "diffHunk": "@@ -38,6 +38,8 @@\n #include \"j9fieldsInfo.h\"\n #include \"rommeth.h\"\n \n+class TR_PersistentClassInfo;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "8309612c33ca70889ebea3ceca695805168cff2b"}, "originalPosition": 4}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMjYyODU4MA==", "bodyText": "typo: caches --> cached", "url": "https://github.com/eclipse-openj9/openj9/pull/9067#discussion_r402628580", "createdAt": "2020-04-02T22:18:53Z", "author": {"login": "mpirvu"}, "path": "runtime/compiler/env/J9ClassEnv.cpp", "diffHunk": "@@ -642,3 +644,57 @@ J9::ClassEnv::isValueTypeClass(TR_OpaqueClassBlock *clazz)\n    J9Class *j9class = reinterpret_cast<J9Class*>(clazz);\n    return J9_IS_J9CLASS_VALUETYPE(j9class);\n    }\n+\n+bool \n+J9::ClassEnv::containesZeroOrOneConcreteClass(TR::Compilation *comp, List<TR_PersistentClassInfo>* subClasses)\n+   {\n+   int count = 0;\n+#if defined(J9VM_OPT_JITSERVER)\n+   ListIterator<TR_PersistentClassInfo> j(subClasses);\n+   TR_ScratchList<TR_PersistentClassInfo> subClassesNotCached(comp->trMemory());\n+   \n+   // Process classes caches at the server first", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "8309612c33ca70889ebea3ceca695805168cff2b"}, "originalPosition": 22}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMjYyOTIwOA==", "bodyText": "Please take TR::compInfoPT->getClientData() outside the loop by storing it in a local variable. That TR::compInfoPT is accessing thread local storage which is expensive to get to.", "url": "https://github.com/eclipse-openj9/openj9/pull/9067#discussion_r402629208", "createdAt": "2020-04-02T22:20:21Z", "author": {"login": "mpirvu"}, "path": "runtime/compiler/env/J9ClassEnv.cpp", "diffHunk": "@@ -642,3 +644,57 @@ J9::ClassEnv::isValueTypeClass(TR_OpaqueClassBlock *clazz)\n    J9Class *j9class = reinterpret_cast<J9Class*>(clazz);\n    return J9_IS_J9CLASS_VALUETYPE(j9class);\n    }\n+\n+bool \n+J9::ClassEnv::containesZeroOrOneConcreteClass(TR::Compilation *comp, List<TR_PersistentClassInfo>* subClasses)\n+   {\n+   int count = 0;\n+#if defined(J9VM_OPT_JITSERVER)\n+   ListIterator<TR_PersistentClassInfo> j(subClasses);\n+   TR_ScratchList<TR_PersistentClassInfo> subClassesNotCached(comp->trMemory());\n+   \n+   // Process classes caches at the server first\n+   for (TR_PersistentClassInfo *ptClassInfo = j.getFirst(); ptClassInfo; ptClassInfo = j.getNext())\n+      {\n+      TR_OpaqueClassBlock *clazz = ptClassInfo->getClassId();\n+      J9Class *j9clazz = TR::Compiler->cls.convertClassOffsetToClassPtr(clazz);\n+      auto romClass = JITServerHelpers::getRemoteROMClassIfCached(TR::compInfoPT->getClientData(), j9clazz);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "8309612c33ca70889ebea3ceca695805168cff2b"}, "originalPosition": 27}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "8309612c33ca70889ebea3ceca695805168cff2b", "author": {"user": {"login": "chrisc66", "name": "Zichun (Chris) Chong"}}, "url": "https://github.com/eclipse-openj9/openj9/commit/8309612c33ca70889ebea3ceca695805168cff2b", "committedDate": "2020-04-02T14:53:44Z", "message": "Move FrontEnd noMultipleConcreteClasses into ClassEnv\n\nOMR FrontEnd is depreciated\nThus removing noMultipleConcreteClasses frontend query, and\nmove it to ClassEnv\nAlso rename the function to containesZeroOrOneConcreteClass\n\nSigned-off-by: Chris Chong <Zichun.Chong@ibm.com>"}, "afterCommit": {"oid": "0d29001b43f44501c642f566b739cbb6baa76805", "author": {"user": {"login": "chrisc66", "name": "Zichun (Chris) Chong"}}, "url": "https://github.com/eclipse-openj9/openj9/commit/0d29001b43f44501c642f566b739cbb6baa76805", "committedDate": "2020-04-03T15:21:05Z", "message": "Move FrontEnd noMultipleConcreteClasses into ClassEnv\n\nOMR FrontEnd is depreciated\nThus removing noMultipleConcreteClasses frontend query, and\nmove it to ClassEnv\nAlso rename the function to containesZeroOrOneConcreteClass\n\nSigned-off-by: Chris Chong <Zichun.Chong@ibm.com>"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzg3NDE2MTU2", "url": "https://github.com/eclipse-openj9/openj9/pull/9067#pullrequestreview-387416156", "createdAt": "2020-04-03T16:42:21Z", "commit": {"oid": "0d29001b43f44501c642f566b739cbb6baa76805"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a49057255cbcae4e22e431b332991037fba0a4ec", "author": {"user": {"login": "chrisc66", "name": "Zichun (Chris) Chong"}}, "url": "https://github.com/eclipse-openj9/openj9/commit/a49057255cbcae4e22e431b332991037fba0a4ec", "committedDate": "2020-04-04T02:59:00Z", "message": "Move FrontEnd noMultipleConcreteClasses into ClassEnv\n\nOMR FrontEnd is depreciated\nThus removing noMultipleConcreteClasses frontend query, and\nmove it to ClassEnv\nAlso rename the function to containesZeroOrOneConcreteClass\n\nSigned-off-by: Chris Chong <Zichun.Chong@ibm.com>"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "0d29001b43f44501c642f566b739cbb6baa76805", "author": {"user": {"login": "chrisc66", "name": "Zichun (Chris) Chong"}}, "url": "https://github.com/eclipse-openj9/openj9/commit/0d29001b43f44501c642f566b739cbb6baa76805", "committedDate": "2020-04-03T15:21:05Z", "message": "Move FrontEnd noMultipleConcreteClasses into ClassEnv\n\nOMR FrontEnd is depreciated\nThus removing noMultipleConcreteClasses frontend query, and\nmove it to ClassEnv\nAlso rename the function to containesZeroOrOneConcreteClass\n\nSigned-off-by: Chris Chong <Zichun.Chong@ibm.com>"}, "afterCommit": {"oid": "a49057255cbcae4e22e431b332991037fba0a4ec", "author": {"user": {"login": "chrisc66", "name": "Zichun (Chris) Chong"}}, "url": "https://github.com/eclipse-openj9/openj9/commit/a49057255cbcae4e22e431b332991037fba0a4ec", "committedDate": "2020-04-04T02:59:00Z", "message": "Move FrontEnd noMultipleConcreteClasses into ClassEnv\n\nOMR FrontEnd is depreciated\nThus removing noMultipleConcreteClasses frontend query, and\nmove it to ClassEnv\nAlso rename the function to containesZeroOrOneConcreteClass\n\nSigned-off-by: Chris Chong <Zichun.Chong@ibm.com>"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1386, "cost": 1, "resetAt": "2021-10-28T17:48:14Z"}}}