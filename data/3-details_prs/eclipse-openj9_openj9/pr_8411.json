{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0MzY3MDU1ODE3", "number": 8411, "title": "Fix jniGetPrimitiveArrayCritical in the case of empty arraylets", "bodyText": "Empty arraylets are treated as discontiguous arraylets. But since\nthey are empty there's no need to copy them in the critical section,\nhowever, jniGetPrimitiveArrayCritical callers expects not NULL\nvalues; therefore, in case of empty arraylets we advance the\npointer ahead of the header and return that address instead of\nNULL which was the case when double mapping was enabled\nFixes: #8386\nSigned-off-by: Igor Braga higorb1@gmail.com", "createdAt": "2020-01-24T23:33:31Z", "url": "https://github.com/eclipse-openj9/openj9/pull/8411", "merged": true, "mergeCommit": {"oid": "0cd87a72b49436f79eb362d30184186acbe6581e"}, "closed": true, "closedAt": "2020-01-28T21:56:04Z", "author": {"login": "bragaigor"}, "timelineItems": {"totalCount": 6, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABb9no_ngBqjI5Nzg5MDMxNzc=", "endCursor": "Y3Vyc29yOnYyOpPPAAABb-1BBTgFqTM0OTU3NDQ4Nw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "7038197f08239fa57d87cfce99f96ecbbb398b64", "author": {"user": {"login": "bragaigor", "name": "Igor Braga"}}, "url": "https://github.com/eclipse-openj9/openj9/commit/7038197f08239fa57d87cfce99f96ecbbb398b64", "committedDate": "2020-01-24T23:21:31Z", "message": "Fix jniGetPrimitiveArrayCritical in the case of empty arraylets\n\nEmpty arraylets are treated as discontiguous arraylets. But since\nthey are empty there's no need to copy them in the critical section,\nhowever, jniGetPrimitiveArrayCritical callers expects not NULL\nvalues; therefore, we in case of empty arraylets we advance the\npointer ahead of the header and return that address.\n\nThis fixes: https://github.com/eclipse/openj9/issues/8386\n\nSigned-off-by: Igor Braga <higorb1@gmail.com>"}, "afterCommit": {"oid": "dfd60d5e2bf1c3ccf7f4955fad0cb3f45d0194b1", "author": {"user": {"login": "bragaigor", "name": "Igor Braga"}}, "url": "https://github.com/eclipse-openj9/openj9/commit/dfd60d5e2bf1c3ccf7f4955fad0cb3f45d0194b1", "committedDate": "2020-01-24T23:34:50Z", "message": "Fix jniGetPrimitiveArrayCritical in the case of empty arraylets\n\nEmpty arraylets are treated as discontiguous arraylets. But since\nthey are empty there's no need to copy them in the critical section,\nhowever, jniGetPrimitiveArrayCritical callers expects not NULL\nvalues; therefore, in case of empty arraylets we advance the\npointer ahead of the header and return that address.\n\nThis fixes: https://github.com/eclipse/openj9/issues/8386\n\nSigned-off-by: Igor Braga <higorb1@gmail.com>"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzQ5NDc3MDA0", "url": "https://github.com/eclipse-openj9/openj9/pull/8411#pullrequestreview-349477004", "createdAt": "2020-01-28T15:40:48Z", "commit": {"oid": "dfd60d5e2bf1c3ccf7f4955fad0cb3f45d0194b1"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0yOFQxNTo0MDo0OFrOFip0Sg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0yOFQxNTo0MDo0OFrOFip0Sg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MTg4MTAzNA==", "bodyText": "I think it should be &indexableObjectModel->getArrayoidPointer(arrayObject) instead of just arrayObject.\nWe go one (the only, empty) arroyid slot past the beginning of the arroyoid, to get to the end of the object.", "url": "https://github.com/eclipse-openj9/openj9/pull/8411#discussion_r371881034", "createdAt": "2020-01-28T15:40:48Z", "author": {"login": "amicic"}, "path": "runtime/gc_vlhgc/VLHGCAccessBarrier.cpp", "diffHunk": "@@ -314,7 +314,10 @@ MM_VLHGCAccessBarrier::jniGetPrimitiveArrayCritical(J9VMThread* vmThread, jarray\n \t\t\t\tGC_SlotObject objectSlot(env->getOmrVM(), &indexableObjectModel->getArrayoidPointer(arrayObject)[0]);\n \t\t\t\tdata = objectSlot.readReferenceFromSlot();\n \t\t\t} else {\n-\t\t\t\t/* Possible to reach here if arraylet leaf has one leaf and no elements in it */\n+\t\t\t\t/* Possible to reach here if arraylet leaf has one leaf and no elements in it.\n+\t\t\t\t * Even though there are no elements in it the caller expects a non NULL value\n+\t\t\t\t * therefore we just return the address after the object header. */\n+\t\t\t\tdata = (void *)GC_SlotObject::addToSlotAddress((fomrobject_t*)arrayObject, 1, env->compressObjectReferences());", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "dfd60d5e2bf1c3ccf7f4955fad0cb3f45d0194b1"}, "originalPosition": 15}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "613be1e32b4d4d883808ffcafa97a8bebfc2aec8", "author": {"user": {"login": "bragaigor", "name": "Igor Braga"}}, "url": "https://github.com/eclipse-openj9/openj9/commit/613be1e32b4d4d883808ffcafa97a8bebfc2aec8", "committedDate": "2020-01-28T16:06:35Z", "message": "Fix jniGetPrimitiveArrayCritical in the case of empty arraylets\n\nEmpty arraylets are treated as discontiguous arraylets. But since\nthey are empty there's no need to copy them in the critical section,\nhowever, jniGetPrimitiveArrayCritical callers expects not NULL\nvalues; therefore, in case of empty arraylets we advance the\npointer ahead of the header and return that address.\n\nThis fixes: https://github.com/eclipse/openj9/issues/8386\n\nSigned-off-by: Igor Braga <higorb1@gmail.com>"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "dfd60d5e2bf1c3ccf7f4955fad0cb3f45d0194b1", "author": {"user": {"login": "bragaigor", "name": "Igor Braga"}}, "url": "https://github.com/eclipse-openj9/openj9/commit/dfd60d5e2bf1c3ccf7f4955fad0cb3f45d0194b1", "committedDate": "2020-01-24T23:34:50Z", "message": "Fix jniGetPrimitiveArrayCritical in the case of empty arraylets\n\nEmpty arraylets are treated as discontiguous arraylets. But since\nthey are empty there's no need to copy them in the critical section,\nhowever, jniGetPrimitiveArrayCritical callers expects not NULL\nvalues; therefore, in case of empty arraylets we advance the\npointer ahead of the header and return that address.\n\nThis fixes: https://github.com/eclipse/openj9/issues/8386\n\nSigned-off-by: Igor Braga <higorb1@gmail.com>"}, "afterCommit": {"oid": "613be1e32b4d4d883808ffcafa97a8bebfc2aec8", "author": {"user": {"login": "bragaigor", "name": "Igor Braga"}}, "url": "https://github.com/eclipse-openj9/openj9/commit/613be1e32b4d4d883808ffcafa97a8bebfc2aec8", "committedDate": "2020-01-28T16:06:35Z", "message": "Fix jniGetPrimitiveArrayCritical in the case of empty arraylets\n\nEmpty arraylets are treated as discontiguous arraylets. But since\nthey are empty there's no need to copy them in the critical section,\nhowever, jniGetPrimitiveArrayCritical callers expects not NULL\nvalues; therefore, in case of empty arraylets we advance the\npointer ahead of the header and return that address.\n\nThis fixes: https://github.com/eclipse/openj9/issues/8386\n\nSigned-off-by: Igor Braga <higorb1@gmail.com>"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzQ5NTY1NDA5", "url": "https://github.com/eclipse-openj9/openj9/pull/8411#pullrequestreview-349565409", "createdAt": "2020-01-28T17:30:26Z", "commit": {"oid": "613be1e32b4d4d883808ffcafa97a8bebfc2aec8"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzQ5NTc0NDg3", "url": "https://github.com/eclipse-openj9/openj9/pull/8411#pullrequestreview-349574487", "createdAt": "2020-01-28T17:44:19Z", "commit": {"oid": "613be1e32b4d4d883808ffcafa97a8bebfc2aec8"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 928, "cost": 1, "resetAt": "2021-10-28T18:00:02Z"}}}