{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDU3NTEwMDAw", "number": 10264, "title": "AArch64: Enable Escape Analysis to allocate objects on stack", "bodyText": "These commits enable Escape Analysis to allocate objects on stack for aarch64.\nAs in below conversation, we add supportsStackAllocation API to code generators. All code generators except ARM override it to return true. Architecture checks for supporting stack allocations in Escape Analysis are replaced with it.\nSigned-off-by: Akira Saitoh saiaki@jp.ibm.com", "createdAt": "2020-07-28T03:03:37Z", "url": "https://github.com/eclipse-openj9/openj9/pull/10264", "merged": true, "mergeCommit": {"oid": "17c7aae1723d3d7917cc09403b047eb4bd2dcb67"}, "closed": true, "closedAt": "2020-08-04T10:46:52Z", "author": {"login": "Akira1Saitoh"}, "timelineItems": {"totalCount": 8, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABc5UZ_FgFqTQ1NjUyNjgzNg==", "endCursor": "Y3Vyc29yOnYyOpPPAAABc7kUX7gFqTQ2MDcwMDc3MA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDU2NTI2ODM2", "url": "https://github.com/eclipse-openj9/openj9/pull/10264#pullrequestreview-456526836", "createdAt": "2020-07-28T11:06:14Z", "commit": {"oid": "7720c4d03a1b7faa0a8a0f410ed9cc53b216d0d8"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yOFQxMTowNjoxNFrOG4HpCw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yOFQxMTowNjoxNFrOG4HpCw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MTQ5ODYzNQ==", "bodyText": "Can this growing list of architecture checks (here and elsewhere in this PR) be replaced with a capability query instead?  What are they really asking:  whether a code generator is capable of mapping local objects to the stack?  If so, I think it would be much cleaner to ask that question of a code generator and have each architecture answer true or false.\n@vijaysun-omr or @andrewcraik any opinion or insight on whether that's what these architecture checks are really for?", "url": "https://github.com/eclipse-openj9/openj9/pull/10264#discussion_r461498635", "createdAt": "2020-07-28T11:06:14Z", "author": {"login": "0xdaryl"}, "path": "runtime/compiler/optimizer/EscapeAnalysis.cpp", "diffHunk": "@@ -133,7 +133,7 @@ TR_EscapeAnalysis::TR_EscapeAnalysis(TR::OptimizationManager *manager)\n    _dememoizationSymRef = NULL;\n \n    _createStackAllocations   = true;\n-   _createLocalObjects       = comp()->target().cpu.isX86() || comp()->target().cpu.isPower() || comp()->target().cpu.isZ();\n+   _createLocalObjects       = comp()->target().cpu.isX86() || comp()->target().cpu.isPower() || comp()->target().cpu.isZ() || comp()->target().cpu.isARM64();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "7720c4d03a1b7faa0a8a0f410ed9cc53b216d0d8"}, "originalPosition": 5}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "7720c4d03a1b7faa0a8a0f410ed9cc53b216d0d8", "author": {"user": {"login": "Akira1Saitoh", "name": "Akira Saito"}}, "url": "https://github.com/eclipse-openj9/openj9/commit/7720c4d03a1b7faa0a8a0f410ed9cc53b216d0d8", "committedDate": "2020-07-28T03:01:53Z", "message": "AArch64: Enable Escape Analysis to allocate objects on stack\n\nThis commit enables Escape Analysis to allocate objects on stack for aarch64.\n\nSigned-off-by: Akira Saitoh <saiaki@jp.ibm.com>"}, "afterCommit": {"oid": "03f90eb73b948ba976a5f9358da6026239aba569", "author": {"user": {"login": "Akira1Saitoh", "name": "Akira Saito"}}, "url": "https://github.com/eclipse-openj9/openj9/commit/03f90eb73b948ba976a5f9358da6026239aba569", "committedDate": "2020-07-28T23:50:03Z", "message": "Replace architecture checks with capability query for stack allocations\n\nReplace architecture checks in Escape Analysis with the capability query\nwhich answers if the code generator supports stack allocations.\n\nSigned-off-by: Akira Saitoh <saiaki@jp.ibm.com>"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDU4NTM3NzE4", "url": "https://github.com/eclipse-openj9/openj9/pull/10264#pullrequestreview-458537718", "createdAt": "2020-07-30T15:54:43Z", "commit": {"oid": "03f90eb73b948ba976a5f9358da6026239aba569"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDYwNDYwNzMy", "url": "https://github.com/eclipse-openj9/openj9/pull/10264#pullrequestreview-460460732", "createdAt": "2020-08-04T02:50:09Z", "commit": {"oid": "03f90eb73b948ba976a5f9358da6026239aba569"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0wNFQwMjo1MDowOVrOG7PKTg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0wNFQwMjo1MDowOVrOG7PKTg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NDc2NzU2Ng==", "bodyText": "This function is declared as private.", "url": "https://github.com/eclipse-openj9/openj9/pull/10264#discussion_r464767566", "createdAt": "2020-08-04T02:50:09Z", "author": {"login": "knn-k"}, "path": "runtime/compiler/z/codegen/J9CodeGenerator.hpp", "diffHunk": "@@ -336,6 +336,11 @@ class OMR_EXTENSIBLE CodeGenerator : public J9::CodeGenerator\n     *     support such by-passes.\n     */\n    bool _ignoreDecimalOverflowException;\n+\n+   /**\n+    * \\brief Determines whether the code generator supports stack allocations\n+    */\n+   bool supportsStackAllocations() { return true; }", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "03f90eb73b948ba976a5f9358da6026239aba569"}, "originalPosition": 8}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "6dd6ad497f0382e6eb9e334039ae049c9190ede0", "author": {"user": {"login": "Akira1Saitoh", "name": "Akira Saito"}}, "url": "https://github.com/eclipse-openj9/openj9/commit/6dd6ad497f0382e6eb9e334039ae049c9190ede0", "committedDate": "2020-08-04T05:06:16Z", "message": "Add a capability query of stack allocations to code generator\n\nThis commit adds `supportsStackAllocations` query to the code generator.\nIt is used to ask if the code generator supports stack allocations.\naarch64/p/x/z code generators return true for this query.\n\nSigned-off-by: Akira Saitoh <saiaki@jp.ibm.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "298c91f344b7f2b22e5135e67bd41b1e28e3cb25", "author": {"user": {"login": "Akira1Saitoh", "name": "Akira Saito"}}, "url": "https://github.com/eclipse-openj9/openj9/commit/298c91f344b7f2b22e5135e67bd41b1e28e3cb25", "committedDate": "2020-08-04T05:06:51Z", "message": "Replace architecture checks with capability query for stack allocations\n\nReplace architecture checks in Escape Analysis with the capability query\nwhich answers if the code generator supports stack allocations.\n\nSigned-off-by: Akira Saitoh <saiaki@jp.ibm.com>"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "03f90eb73b948ba976a5f9358da6026239aba569", "author": {"user": {"login": "Akira1Saitoh", "name": "Akira Saito"}}, "url": "https://github.com/eclipse-openj9/openj9/commit/03f90eb73b948ba976a5f9358da6026239aba569", "committedDate": "2020-07-28T23:50:03Z", "message": "Replace architecture checks with capability query for stack allocations\n\nReplace architecture checks in Escape Analysis with the capability query\nwhich answers if the code generator supports stack allocations.\n\nSigned-off-by: Akira Saitoh <saiaki@jp.ibm.com>"}, "afterCommit": {"oid": "298c91f344b7f2b22e5135e67bd41b1e28e3cb25", "author": {"user": {"login": "Akira1Saitoh", "name": "Akira Saito"}}, "url": "https://github.com/eclipse-openj9/openj9/commit/298c91f344b7f2b22e5135e67bd41b1e28e3cb25", "committedDate": "2020-08-04T05:06:51Z", "message": "Replace architecture checks with capability query for stack allocations\n\nReplace architecture checks in Escape Analysis with the capability query\nwhich answers if the code generator supports stack allocations.\n\nSigned-off-by: Akira Saitoh <saiaki@jp.ibm.com>"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDYwNzAwNzcw", "url": "https://github.com/eclipse-openj9/openj9/pull/10264#pullrequestreview-460700770", "createdAt": "2020-08-04T10:46:27Z", "commit": {"oid": "298c91f344b7f2b22e5135e67bd41b1e28e3cb25"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 368, "cost": 1, "resetAt": "2021-10-28T17:48:14Z"}}}