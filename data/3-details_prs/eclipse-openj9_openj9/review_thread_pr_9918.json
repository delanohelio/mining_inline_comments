{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDM2MDkwMzAx", "number": 9918, "reviewThreads": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xOFQwMTowMDowMVrOEGkFug==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xOFQwMTowMDowMVrOEGkFug==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjc1MzE4MjAyOnYy", "diffSide": "RIGHT", "path": "jcl/src/java.base/share/classes/java/lang/Throwable.java", "isResolved": true, "comments": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xOFQwMTowMDowMVrOGlcHsg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xOFQwMjowMDoxNlrOGldCOg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MTkxMTIxOA==", "bodyText": "This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters. Learn more about bidirectional Unicode characters\n\n\n  \n\n\n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            \t\t// Assign the result to a local variable to avoid race condition\n          \n          \n            \n            \t\t// that stackTrace might be set back to null.\n          \n          \n            \n            \t\t// Assign the result to a local variable to avoid refetching\n          \n          \n            \n            \t\t// the instance variable and any memory ordering issues", "url": "https://github.com/eclipse-openj9/openj9/pull/9918#discussion_r441911218", "createdAt": "2020-06-18T01:00:01Z", "author": {"login": "DanHeidinga"}, "path": "jcl/src/java.base/share/classes/java/lang/Throwable.java", "diffHunk": "@@ -283,16 +283,19 @@ private static int countDuplicates(StackTraceElement[] currentStack, StackTraceE\n  * @return an array of StackTraceElement representing the stack\n  */\n StackTraceElement[] getInternalStackTrace() {\n-\n \tif (disableWritableStackTrace) {\n \t\treturn\tZeroStackTraceElementArray;\n \t}\n \n-\tif (stackTrace == null) {\n-\t\tstackTrace = J9VMInternals.getStackTrace(this, true);\n+\tStackTraceElement[] localstackTrace = stackTrace;\n+\tif (localstackTrace == null) {\n+\t\t// Assign the result to a local variable to avoid race condition\n+\t\t// that stackTrace might be set back to null.", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "44a9dfeed41e0dd4cc6d72989c98a92640def313"}, "originalPosition": 20}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MTkxMTYzNw==", "bodyText": "I think we should reword the comment as I still don't see a race condition.  I'm not convinced my phrasing is better but without knowing what the race is, I'd rather avoid suggesting there is one", "url": "https://github.com/eclipse-openj9/openj9/pull/9918#discussion_r441911637", "createdAt": "2020-06-18T01:01:36Z", "author": {"login": "DanHeidinga"}, "path": "jcl/src/java.base/share/classes/java/lang/Throwable.java", "diffHunk": "@@ -283,16 +283,19 @@ private static int countDuplicates(StackTraceElement[] currentStack, StackTraceE\n  * @return an array of StackTraceElement representing the stack\n  */\n StackTraceElement[] getInternalStackTrace() {\n-\n \tif (disableWritableStackTrace) {\n \t\treturn\tZeroStackTraceElementArray;\n \t}\n \n-\tif (stackTrace == null) {\n-\t\tstackTrace = J9VMInternals.getStackTrace(this, true);\n+\tStackTraceElement[] localstackTrace = stackTrace;\n+\tif (localstackTrace == null) {\n+\t\t// Assign the result to a local variable to avoid race condition\n+\t\t// that stackTrace might be set back to null.", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MTkxMTIxOA=="}, "originalCommit": {"oid": "44a9dfeed41e0dd4cc6d72989c98a92640def313"}, "originalPosition": 20}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MTkyMDQwNw==", "bodyText": "@DanHeidinga Thanks, agreed that this might be a memory ordering issue instead. Updated the comments accordingly.\nPlease start the PR tests.", "url": "https://github.com/eclipse-openj9/openj9/pull/9918#discussion_r441920407", "createdAt": "2020-06-18T01:37:45Z", "author": {"login": "JasonFengJ9"}, "path": "jcl/src/java.base/share/classes/java/lang/Throwable.java", "diffHunk": "@@ -283,16 +283,19 @@ private static int countDuplicates(StackTraceElement[] currentStack, StackTraceE\n  * @return an array of StackTraceElement representing the stack\n  */\n StackTraceElement[] getInternalStackTrace() {\n-\n \tif (disableWritableStackTrace) {\n \t\treturn\tZeroStackTraceElementArray;\n \t}\n \n-\tif (stackTrace == null) {\n-\t\tstackTrace = J9VMInternals.getStackTrace(this, true);\n+\tStackTraceElement[] localstackTrace = stackTrace;\n+\tif (localstackTrace == null) {\n+\t\t// Assign the result to a local variable to avoid race condition\n+\t\t// that stackTrace might be set back to null.", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MTkxMTIxOA=="}, "originalCommit": {"oid": "44a9dfeed41e0dd4cc6d72989c98a92640def313"}, "originalPosition": 20}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MTkyNjIwMg==", "bodyText": "Also changed localstackTrace to localStackTrace.", "url": "https://github.com/eclipse-openj9/openj9/pull/9918#discussion_r441926202", "createdAt": "2020-06-18T02:00:16Z", "author": {"login": "JasonFengJ9"}, "path": "jcl/src/java.base/share/classes/java/lang/Throwable.java", "diffHunk": "@@ -283,16 +283,19 @@ private static int countDuplicates(StackTraceElement[] currentStack, StackTraceE\n  * @return an array of StackTraceElement representing the stack\n  */\n StackTraceElement[] getInternalStackTrace() {\n-\n \tif (disableWritableStackTrace) {\n \t\treturn\tZeroStackTraceElementArray;\n \t}\n \n-\tif (stackTrace == null) {\n-\t\tstackTrace = J9VMInternals.getStackTrace(this, true);\n+\tStackTraceElement[] localstackTrace = stackTrace;\n+\tif (localstackTrace == null) {\n+\t\t// Assign the result to a local variable to avoid race condition\n+\t\t// that stackTrace might be set back to null.", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MTkxMTIxOA=="}, "originalCommit": {"oid": "44a9dfeed41e0dd4cc6d72989c98a92640def313"}, "originalPosition": 20}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 35, "cost": 1, "resetAt": "2021-11-12T13:16:51Z"}}}