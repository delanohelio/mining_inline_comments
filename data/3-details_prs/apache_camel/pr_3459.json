{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0MzU5NDYxMTE3", "number": 3459, "title": "CAMEL-14360 - Allow overriding of message key and partition key for ggregated kafka messages", "bodyText": "PR as requested in CAMEL-14233", "createdAt": "2020-01-06T09:26:31Z", "url": "https://github.com/apache/camel/pull/3459", "merged": true, "mergeCommit": {"oid": "9c2ebca78db194edb554ef29370b7f0ec006bb03"}, "closed": true, "closedAt": "2020-01-09T11:10:43Z", "author": {"login": "rgala"}, "timelineItems": {"totalCount": 11, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABb3oq9CgH2gAyMzU5NDYxMTE3OjRiODNmODM2Zjc3MDljZGYyOTE2ZTI5Y2FlNDJmMGQ3NDdiMjY3NTk=", "endCursor": "Y3Vyc29yOnYyOpPPAAABb4n_rEAFqTM0MDQ0NjI0OQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "4b83f836f7709cdf2916e29cae42f0d747b26759", "author": {"user": {"login": "rgala", "name": "Rafa\u0142 Ga\u0142a"}}, "url": "https://github.com/apache/camel/commit/4b83f836f7709cdf2916e29cae42f0d747b26759", "committedDate": "2020-01-06T09:23:53Z", "message": "CAMEL-14360 - Allow overriding of message key and partition key for aggregated kafka messages"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "78eacbbb3011f6a1962f6eb0fd65cb36cf517819", "author": {"user": {"login": "rgala", "name": "Rafa\u0142 Ga\u0142a"}}, "url": "https://github.com/apache/camel/commit/78eacbbb3011f6a1962f6eb0fd65cb36cf517819", "committedDate": "2020-01-06T09:35:50Z", "message": "CAMEL-14362 - Set metadata for each aggregated kafka message separately"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzM4NTQ1MjE5", "url": "https://github.com/apache/camel/pull/3459#pullrequestreview-338545219", "createdAt": "2020-01-06T09:37:27Z", "commit": {"oid": "78eacbbb3011f6a1962f6eb0fd65cb36cf517819"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzM4NjEwMzI3", "url": "https://github.com/apache/camel/pull/3459#pullrequestreview-338610327", "createdAt": "2020-01-06T12:09:58Z", "commit": {"oid": "78eacbbb3011f6a1962f6eb0fd65cb36cf517819"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0wNlQxMjowOTo1OFrOFacKWw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0wNlQxMjowOTo1OFrOFacKWw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2MzI2ODY5OQ==", "bodyText": "Sorry, I am bit confused here, was there a logical reason to use pair with the message body?", "url": "https://github.com/apache/camel/pull/3459#discussion_r363268699", "createdAt": "2020-01-06T12:09:58Z", "author": {"login": "omarsmak"}, "path": "components/camel-kafka/src/main/java/org/apache/camel/component/kafka/KafkaProducer.java", "diffHunk": "@@ -181,34 +171,67 @@ protected void doStop() throws Exception {\n         if (iterator != null) {\n             final Iterator<Object> msgList = iterator;\n             final String msgTopic = topic;\n-            return new Iterator<ProducerRecord>() {\n+            return new Iterator<Pair<Object, ProducerRecord>>() {\n                 @Override\n                 public boolean hasNext() {\n                     return msgList.hasNext();\n                 }\n \n                 @Override\n-                public ProducerRecord next() {\n+                public Pair<Object, ProducerRecord> next() {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "78eacbbb3011f6a1962f6eb0fd65cb36cf517819"}, "originalPosition": 57}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzM5MDMxMTIw", "url": "https://github.com/apache/camel/pull/3459#pullrequestreview-339031120", "createdAt": "2020-01-07T04:59:25Z", "commit": {"oid": "78eacbbb3011f6a1962f6eb0fd65cb36cf517819"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "3cf11994c53e64a21fcc47d8091405a759ad0390", "author": {"user": {"login": "rgala", "name": "Rafa\u0142 Ga\u0142a"}}, "url": "https://github.com/apache/camel/commit/3cf11994c53e64a21fcc47d8091405a759ad0390", "committedDate": "2020-01-07T06:52:44Z", "message": "CAMEL-14362 - Use KeyValueHolder instead of Pair"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzM5MDgzODU4", "url": "https://github.com/apache/camel/pull/3459#pullrequestreview-339083858", "createdAt": "2020-01-07T08:14:06Z", "commit": {"oid": "3cf11994c53e64a21fcc47d8091405a759ad0390"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzQwNDA1MDU2", "url": "https://github.com/apache/camel/pull/3459#pullrequestreview-340405056", "createdAt": "2020-01-09T09:59:20Z", "commit": {"oid": "3cf11994c53e64a21fcc47d8091405a759ad0390"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0wOVQwOTo1OToyMFrOFbwcpw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0wOVQwOTo1OToyMFrOFbwcpw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NDY0OTYzOQ==", "bodyText": "I wonder if you should also check for instanceof Message here, and if its a message, you can use message -> getExchange to get that to set the exception.", "url": "https://github.com/apache/camel/pull/3459#discussion_r364649639", "createdAt": "2020-01-09T09:59:20Z", "author": {"login": "davsclaus"}, "path": "components/camel-kafka/src/main/java/org/apache/camel/component/kafka/KafkaProducer.java", "diffHunk": "@@ -365,7 +468,9 @@ boolean allSent() {\n         @Override\n         public void onCompletion(RecordMetadata recordMetadata, Exception e) {\n             if (e != null) {\n-                exchange.setException(e);\n+                if(body instanceof Exchange) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "3cf11994c53e64a21fcc47d8091405a759ad0390"}, "originalPosition": 325}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "1bdd508f107ab8398d87512592b478d72e9d56f3", "author": {"user": {"login": "rgala", "name": "Rafa\u0142 Ga\u0142a"}}, "url": "https://github.com/apache/camel/commit/1bdd508f107ab8398d87512592b478d72e9d56f3", "committedDate": "2020-01-09T10:40:49Z", "message": "CMAEL-14362 - Code formatting changes and Exchange retrieval from Message instance"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "fba2855d064994f8b53da760f98a55643c8ecccc", "author": {"user": {"login": "rgala", "name": "Rafa\u0142 Ga\u0142a"}}, "url": "https://github.com/apache/camel/commit/fba2855d064994f8b53da760f98a55643c8ecccc", "committedDate": "2020-01-09T11:05:26Z", "message": "CAMEL-14362 - Additional check for null return value of getExchange"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzQwNDQ2MjQ5", "url": "https://github.com/apache/camel/pull/3459#pullrequestreview-340446249", "createdAt": "2020-01-09T11:10:32Z", "commit": {"oid": "fba2855d064994f8b53da760f98a55643c8ecccc"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2718, "cost": 1, "resetAt": "2021-10-29T17:30:11Z"}}}