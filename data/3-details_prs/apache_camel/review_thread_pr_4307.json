{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDkzNzU1MTE3", "number": 4307, "reviewThreads": {"totalCount": 6, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yOFQwMjo1MjozNlrOEn6Aow==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yOFQwNzoxOTozNFrOEn89xA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzEwMjgwMzU1OnYy", "diffSide": "RIGHT", "path": "core/camel-health/src/main/java/org/apache/camel/impl/health/DefaultHealthCheckRegistry.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yOFQwMjo1MjozNlrOHYs9cw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yOFQwMjo1MjozNlrOHYs9cw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NTY2NDQ5OQ==", "bodyText": "This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters. Learn more about bidirectional Unicode characters\n\n\n  \n\n\n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                    boolean result;\n          \n          \n            \n                    boolean result;", "url": "https://github.com/apache/camel/pull/4307#discussion_r495664499", "createdAt": "2020-09-28T02:52:36Z", "author": {"login": "onderson"}, "path": "core/camel-health/src/main/java/org/apache/camel/impl/health/DefaultHealthCheckRegistry.java", "diffHunk": "@@ -166,66 +166,64 @@ private HealthCheckRepository resolveHealthCheckRepositoryById(String id) {\n \n     @Override\n     public boolean register(Object obj) {\n-        boolean accept = obj instanceof HealthCheck || obj instanceof HealthCheckRepository;\n-        if (!accept) {\n-            throw new IllegalArgumentException();\n-        }\n+        checkIfAccepted(obj);\n+\n+        boolean result;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "e34d0a7c9b653fde2c905e37af9dfd34cbfdb4b5"}, "originalPosition": 10}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzEwMjgwMzU5OnYy", "diffSide": "RIGHT", "path": "core/camel-health/src/main/java/org/apache/camel/impl/health/DefaultHealthCheckRegistry.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yOFQwMjo1MjozOFrOHYs9dw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yOFQwMjo1MjozOFrOHYs9dw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NTY2NDUwMw==", "bodyText": "This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters. Learn more about bidirectional Unicode characters\n\n\n  \n\n\n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                    checkIfAccepted(obj);\n          \n          \n            \n                    boolean result;\n          \n          \n            \n                    checkIfAccepted(obj);", "url": "https://github.com/apache/camel/pull/4307#discussion_r495664503", "createdAt": "2020-09-28T02:52:38Z", "author": {"login": "onderson"}, "path": "core/camel-health/src/main/java/org/apache/camel/impl/health/DefaultHealthCheckRegistry.java", "diffHunk": "@@ -166,66 +166,64 @@ private HealthCheckRepository resolveHealthCheckRepositoryById(String id) {\n \n     @Override\n     public boolean register(Object obj) {\n-        boolean accept = obj instanceof HealthCheck || obj instanceof HealthCheckRepository;\n-        if (!accept) {\n-            throw new IllegalArgumentException();\n-        }\n+        checkIfAccepted(obj);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "e34d0a7c9b653fde2c905e37af9dfd34cbfdb4b5"}, "originalPosition": 8}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzEwMzIwOTU1OnYy", "diffSide": "RIGHT", "path": "core/camel-health/src/main/java/org/apache/camel/impl/health/HealthCheckRegistryRepository.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yOFQwNjo1MjozMVrOHYwiqg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yOFQwNjo1MjozMVrOHYwiqg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NTcyMzE3OA==", "bodyText": "I think orElseGet(Supplier) can be replaced by orElse(fallbackConfiguration) since the fallbackConfiguration does not need to be computed", "url": "https://github.com/apache/camel/pull/4307#discussion_r495723178", "createdAt": "2020-09-28T06:52:31Z", "author": {"login": "lburgazzoli"}, "path": "core/camel-health/src/main/java/org/apache/camel/impl/health/HealthCheckRegistryRepository.java", "diffHunk": "@@ -109,14 +109,10 @@ private HealthCheck toHealthCheck(HealthCheck hc) {\n     }\n \n     private HealthCheckConfiguration matchConfiguration(String id) {\n-        if (configurations != null) {\n-            for (String key : configurations.keySet()) {\n-                if (PatternHelper.matchPattern(id, key)) {\n-                    return configurations.get(key);\n-                }\n-            }\n-        }\n-        return fallbackConfiguration;\n-    }\n \n+        return configurations.values().stream()\n+                .filter(s -> PatternHelper.matchPattern(id, s.getParent()))\n+                .findAny()\n+                .orElseGet(() -> fallbackConfiguration);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "58e39ac8d013eb2a928f193d95394d49179af758"}, "originalPosition": 17}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzEwMzIxOTgzOnYy", "diffSide": "RIGHT", "path": "core/camel-health/src/main/java/org/apache/camel/impl/health/RouteHealthCheck.java", "isResolved": false, "comments": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yOFQwNjo1NjoxOFrOHYwo-w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yOFQwNzoyODowNlrOHYxhcA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NTcyNDc5NQ==", "bodyText": "I's been long time since I've worked on this but I think the else should be preserved as if status.isStarted() returns true, there's no point to check also status.isStopped()", "url": "https://github.com/apache/camel/pull/4307#discussion_r495724795", "createdAt": "2020-09-28T06:56:18Z", "author": {"login": "lburgazzoli"}, "path": "core/camel-health/src/main/java/org/apache/camel/impl/health/RouteHealthCheck.java", "diffHunk": "@@ -54,7 +54,8 @@ protected void doCall(HealthCheckResultBuilder builder, Map<String, Object> opti\n             if (route.getRouteController() != null || route.isAutoStartup()) {\n                 if (status.isStarted()) {\n                     builder.up();\n-                } else if (status.isStopped()) {\n+                }\n+                if (status.isStopped()) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "58e39ac8d013eb2a928f193d95394d49179af758"}, "originalPosition": 6}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NTcyNTQ4NQ==", "bodyText": "Okay, will revert that to previous state. Thanks @lburgazzoli :)", "url": "https://github.com/apache/camel/pull/4307#discussion_r495725485", "createdAt": "2020-09-28T06:58:02Z", "author": {"login": "djoleB"}, "path": "core/camel-health/src/main/java/org/apache/camel/impl/health/RouteHealthCheck.java", "diffHunk": "@@ -54,7 +54,8 @@ protected void doCall(HealthCheckResultBuilder builder, Map<String, Object> opti\n             if (route.getRouteController() != null || route.isAutoStartup()) {\n                 if (status.isStarted()) {\n                     builder.up();\n-                } else if (status.isStopped()) {\n+                }\n+                if (status.isStopped()) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NTcyNDc5NQ=="}, "originalCommit": {"oid": "58e39ac8d013eb2a928f193d95394d49179af758"}, "originalPosition": 6}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NTcyODkzOA==", "bodyText": "I don't think it effectively changes the result in this case but an if else makes it clear that it is either started or stopped whereas a list of is could be confusing like can the status be started and stopped at the same time ?", "url": "https://github.com/apache/camel/pull/4307#discussion_r495728938", "createdAt": "2020-09-28T07:06:01Z", "author": {"login": "lburgazzoli"}, "path": "core/camel-health/src/main/java/org/apache/camel/impl/health/RouteHealthCheck.java", "diffHunk": "@@ -54,7 +54,8 @@ protected void doCall(HealthCheckResultBuilder builder, Map<String, Object> opti\n             if (route.getRouteController() != null || route.isAutoStartup()) {\n                 if (status.isStarted()) {\n                     builder.up();\n-                } else if (status.isStopped()) {\n+                }\n+                if (status.isStopped()) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NTcyNDc5NQ=="}, "originalCommit": {"oid": "58e39ac8d013eb2a928f193d95394d49179af758"}, "originalPosition": 6}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NTczOTI0OA==", "bodyText": "Yes, i agree. Thank for clarifying. :)", "url": "https://github.com/apache/camel/pull/4307#discussion_r495739248", "createdAt": "2020-09-28T07:28:06Z", "author": {"login": "djoleB"}, "path": "core/camel-health/src/main/java/org/apache/camel/impl/health/RouteHealthCheck.java", "diffHunk": "@@ -54,7 +54,8 @@ protected void doCall(HealthCheckResultBuilder builder, Map<String, Object> opti\n             if (route.getRouteController() != null || route.isAutoStartup()) {\n                 if (status.isStarted()) {\n                     builder.up();\n-                } else if (status.isStopped()) {\n+                }\n+                if (status.isStopped()) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NTcyNDc5NQ=="}, "originalCommit": {"oid": "58e39ac8d013eb2a928f193d95394d49179af758"}, "originalPosition": 6}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzEwMzIyNTU3OnYy", "diffSide": "RIGHT", "path": "core/camel-health/src/main/java/org/apache/camel/impl/health/RouteHealthCheck.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yOFQwNjo1ODoyNVrOHYwsYw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yOFQwNjo1ODoyNVrOHYwsYw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NTcyNTY2Nw==", "bodyText": "same as above", "url": "https://github.com/apache/camel/pull/4307#discussion_r495725667", "createdAt": "2020-09-28T06:58:25Z", "author": {"login": "lburgazzoli"}, "path": "core/camel-health/src/main/java/org/apache/camel/impl/health/RouteHealthCheck.java", "diffHunk": "@@ -63,16 +64,16 @@ protected void doCall(HealthCheckResultBuilder builder, Map<String, Object> opti\n                     // if a route is configured to not to automatically start, then the\n                     // route is always up as it is externally managed.\n                     builder.up();\n-                } else if (route.getRouteController() == null) {\n+                }\n+                if (route.getRouteController() == null) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "58e39ac8d013eb2a928f193d95394d49179af758"}, "originalPosition": 16}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzEwMzI4NzcyOnYy", "diffSide": "RIGHT", "path": "core/camel-health/src/main/java/org/apache/camel/impl/health/ContextHealthCheck.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yOFQwNzoxOTozNFrOHYxRBg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yOFQwNzoxOTozNFrOHYxRBg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NTczNTA0Ng==", "bodyText": "I think the else should be kept here too", "url": "https://github.com/apache/camel/pull/4307#discussion_r495735046", "createdAt": "2020-09-28T07:19:34Z", "author": {"login": "lburgazzoli"}, "path": "core/camel-health/src/main/java/org/apache/camel/impl/health/ContextHealthCheck.java", "diffHunk": "@@ -62,7 +62,9 @@ protected void doCall(HealthCheckResultBuilder builder, Map<String, Object> opti\n \n             if (camelContext.getStatus().isStarted()) {\n                 builder.up();\n-            } else if (camelContext.getStatus().isStopped()) {\n+            }\n+\n+            if (camelContext.getStatus().isStopped()) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "1018c88bba2d41de97117df4566cbeec62a78949"}, "originalPosition": 7}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4843, "cost": 1, "resetAt": "2021-11-12T11:18:39Z"}}}