{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0MzU5NDYxMTE3", "number": 3459, "reviewThreads": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0wNlQxMjowOTo1OFrODV9RVg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0wOVQwOTo1OToyMFrODWy7aw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjI0MzUwNTUwOnYy", "diffSide": "RIGHT", "path": "components/camel-kafka/src/main/java/org/apache/camel/component/kafka/KafkaProducer.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0wNlQxMjowOTo1OFrOFacKWw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0wNlQxMjoxNzo0M1rOFacSoA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2MzI2ODY5OQ==", "bodyText": "Sorry, I am bit confused here, was there a logical reason to use pair with the message body?", "url": "https://github.com/apache/camel/pull/3459#discussion_r363268699", "createdAt": "2020-01-06T12:09:58Z", "author": {"login": "omarsmak"}, "path": "components/camel-kafka/src/main/java/org/apache/camel/component/kafka/KafkaProducer.java", "diffHunk": "@@ -181,34 +171,67 @@ protected void doStop() throws Exception {\n         if (iterator != null) {\n             final Iterator<Object> msgList = iterator;\n             final String msgTopic = topic;\n-            return new Iterator<ProducerRecord>() {\n+            return new Iterator<Pair<Object, ProducerRecord>>() {\n                 @Override\n                 public boolean hasNext() {\n                     return msgList.hasNext();\n                 }\n \n                 @Override\n-                public ProducerRecord next() {\n+                public Pair<Object, ProducerRecord> next() {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "78eacbbb3011f6a1962f6eb0fd65cb36cf517819"}, "originalPosition": 57}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2MzI3MDgxNg==", "bodyText": "If the left of pair is instance of Message or Exchange it will then be used to set metadata on this Exchange/Message instance. If this is instance of something else, no metadata will be set at all.\nIf we return only the ProducerRecord, we loose information to what Message/Exchange it refers to and we cannot set metadata returned by Kafka producer.", "url": "https://github.com/apache/camel/pull/3459#discussion_r363270816", "createdAt": "2020-01-06T12:17:43Z", "author": {"login": "rgala"}, "path": "components/camel-kafka/src/main/java/org/apache/camel/component/kafka/KafkaProducer.java", "diffHunk": "@@ -181,34 +171,67 @@ protected void doStop() throws Exception {\n         if (iterator != null) {\n             final Iterator<Object> msgList = iterator;\n             final String msgTopic = topic;\n-            return new Iterator<ProducerRecord>() {\n+            return new Iterator<Pair<Object, ProducerRecord>>() {\n                 @Override\n                 public boolean hasNext() {\n                     return msgList.hasNext();\n                 }\n \n                 @Override\n-                public ProducerRecord next() {\n+                public Pair<Object, ProducerRecord> next() {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2MzI2ODY5OQ=="}, "originalCommit": {"oid": "78eacbbb3011f6a1962f6eb0fd65cb36cf517819"}, "originalPosition": 57}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjI1MjI5Njc1OnYy", "diffSide": "RIGHT", "path": "components/camel-kafka/src/main/java/org/apache/camel/component/kafka/KafkaProducer.java", "isResolved": false, "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0wOVQwOTo1OToyMFrOFbwcpw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0wOVQxMDo1ODoxMFrOFbyJZQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NDY0OTYzOQ==", "bodyText": "I wonder if you should also check for instanceof Message here, and if its a message, you can use message -> getExchange to get that to set the exception.", "url": "https://github.com/apache/camel/pull/3459#discussion_r364649639", "createdAt": "2020-01-09T09:59:20Z", "author": {"login": "davsclaus"}, "path": "components/camel-kafka/src/main/java/org/apache/camel/component/kafka/KafkaProducer.java", "diffHunk": "@@ -365,7 +468,9 @@ boolean allSent() {\n         @Override\n         public void onCompletion(RecordMetadata recordMetadata, Exception e) {\n             if (e != null) {\n-                exchange.setException(e);\n+                if(body instanceof Exchange) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "3cf11994c53e64a21fcc47d8091405a759ad0390"}, "originalPosition": 325}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NDY3Mzc4OQ==", "bodyText": "Added as requested. I also wonder if checking of null result of getExchange would not be a good idea.", "url": "https://github.com/apache/camel/pull/3459#discussion_r364673789", "createdAt": "2020-01-09T10:50:04Z", "author": {"login": "rgala"}, "path": "components/camel-kafka/src/main/java/org/apache/camel/component/kafka/KafkaProducer.java", "diffHunk": "@@ -365,7 +468,9 @@ boolean allSent() {\n         @Override\n         public void onCompletion(RecordMetadata recordMetadata, Exception e) {\n             if (e != null) {\n-                exchange.setException(e);\n+                if(body instanceof Exchange) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NDY0OTYzOQ=="}, "originalCommit": {"oid": "3cf11994c53e64a21fcc47d8091405a759ad0390"}, "originalPosition": 325}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NDY3NzQ3Nw==", "bodyText": "Yeah you can do that", "url": "https://github.com/apache/camel/pull/3459#discussion_r364677477", "createdAt": "2020-01-09T10:58:10Z", "author": {"login": "davsclaus"}, "path": "components/camel-kafka/src/main/java/org/apache/camel/component/kafka/KafkaProducer.java", "diffHunk": "@@ -365,7 +468,9 @@ boolean allSent() {\n         @Override\n         public void onCompletion(RecordMetadata recordMetadata, Exception e) {\n             if (e != null) {\n-                exchange.setException(e);\n+                if(body instanceof Exchange) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NDY0OTYzOQ=="}, "originalCommit": {"oid": "3cf11994c53e64a21fcc47d8091405a759ad0390"}, "originalPosition": 325}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4710, "cost": 1, "resetAt": "2021-11-12T11:18:39Z"}}}