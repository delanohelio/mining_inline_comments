{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0MzYyNDk3NTkz", "number": 3478, "reviewThreads": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0xNFQwODoxNDo0OVrODXwwwg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0xNFQwODoxNTowMVrODXww-Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjI2MjQyNzU0OnYy", "diffSide": "RIGHT", "path": "core/camel-support/src/main/java/org/apache/camel/support/DefaultComponent.java", "isResolved": false, "comments": {"totalCount": 6, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0xNFQwODoxNDo0OVrOFdPARw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0xNFQxMzoyMDo1MVrOFdXMIQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NjE5ODg1NQ==", "bodyText": "The name should have -configurer, eg -component-configurer", "url": "https://github.com/apache/camel/pull/3478#discussion_r366198855", "createdAt": "2020-01-14T08:14:49Z", "author": {"login": "davsclaus"}, "path": "core/camel-support/src/main/java/org/apache/camel/support/DefaultComponent.java", "diffHunk": "@@ -406,17 +407,25 @@ protected void doInit() throws Exception {\n                 name = StringHelper.before(name, \",\");\n             }\n             try {\n+                final Registry registry = getCamelContext().getRegistry();\n                 log.trace(\"Discovering optional component property configurer class for component: {}\", name);\n-                Optional<Class<?>> clazz = getCamelContext().adapt(ExtendedCamelContext.class).getFactoryFinder(RESOURCE_PATH)\n-                        .findOptionalClass(name + \"-component\", null);\n-                clazz.ifPresent(c -> componentPropertyConfigurer = org.apache.camel.support.ObjectHelper.newInstance(c, GeneratedPropertyConfigurer.class));\n+                componentPropertyConfigurer = registry.lookupByNameAndType(name + \"-component\", GeneratedPropertyConfigurer.class);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "5f05f1a0c485177bd0602ac48a6a7c2c674a3643"}, "originalPosition": 47}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NjIwODc3OQ==", "bodyText": "That would introduce a discrepancy between the name of the property file and the name used for the registration of the service in the Camel registry. That would in turn require special code for registering the configurers in Camel Quarkus, which I think we'd like to avoid ( cc @lburgazzoli ?) So if you really want the registry name to have the -configurer suffix, could we please also rename the property files?", "url": "https://github.com/apache/camel/pull/3478#discussion_r366208779", "createdAt": "2020-01-14T08:40:44Z", "author": {"login": "ppalaga"}, "path": "core/camel-support/src/main/java/org/apache/camel/support/DefaultComponent.java", "diffHunk": "@@ -406,17 +407,25 @@ protected void doInit() throws Exception {\n                 name = StringHelper.before(name, \",\");\n             }\n             try {\n+                final Registry registry = getCamelContext().getRegistry();\n                 log.trace(\"Discovering optional component property configurer class for component: {}\", name);\n-                Optional<Class<?>> clazz = getCamelContext().adapt(ExtendedCamelContext.class).getFactoryFinder(RESOURCE_PATH)\n-                        .findOptionalClass(name + \"-component\", null);\n-                clazz.ifPresent(c -> componentPropertyConfigurer = org.apache.camel.support.ObjectHelper.newInstance(c, GeneratedPropertyConfigurer.class));\n+                componentPropertyConfigurer = registry.lookupByNameAndType(name + \"-component\", GeneratedPropertyConfigurer.class);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NjE5ODg1NQ=="}, "originalCommit": {"oid": "5f05f1a0c485177bd0602ac48a6a7c2c674a3643"}, "originalPosition": 47}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NjIzNTEyOQ==", "bodyText": "I have added 14c5188 that renames both the property files and the keys used to register the configurers to the registry.", "url": "https://github.com/apache/camel/pull/3478#discussion_r366235129", "createdAt": "2020-01-14T09:39:13Z", "author": {"login": "ppalaga"}, "path": "core/camel-support/src/main/java/org/apache/camel/support/DefaultComponent.java", "diffHunk": "@@ -406,17 +407,25 @@ protected void doInit() throws Exception {\n                 name = StringHelper.before(name, \",\");\n             }\n             try {\n+                final Registry registry = getCamelContext().getRegistry();\n                 log.trace(\"Discovering optional component property configurer class for component: {}\", name);\n-                Optional<Class<?>> clazz = getCamelContext().adapt(ExtendedCamelContext.class).getFactoryFinder(RESOURCE_PATH)\n-                        .findOptionalClass(name + \"-component\", null);\n-                clazz.ifPresent(c -> componentPropertyConfigurer = org.apache.camel.support.ObjectHelper.newInstance(c, GeneratedPropertyConfigurer.class));\n+                componentPropertyConfigurer = registry.lookupByNameAndType(name + \"-component\", GeneratedPropertyConfigurer.class);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NjE5ODg1NQ=="}, "originalCommit": {"oid": "5f05f1a0c485177bd0602ac48a6a7c2c674a3643"}, "originalPosition": 47}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NjI1NTAyMQ==", "bodyText": "The name of the property file is based on its FQN folder name, where its parent folder name is configurer. Not sure what you do on the quarkus side, but you should not change the APT code", "url": "https://github.com/apache/camel/pull/3478#discussion_r366255021", "createdAt": "2020-01-14T10:19:00Z", "author": {"login": "davsclaus"}, "path": "core/camel-support/src/main/java/org/apache/camel/support/DefaultComponent.java", "diffHunk": "@@ -406,17 +407,25 @@ protected void doInit() throws Exception {\n                 name = StringHelper.before(name, \",\");\n             }\n             try {\n+                final Registry registry = getCamelContext().getRegistry();\n                 log.trace(\"Discovering optional component property configurer class for component: {}\", name);\n-                Optional<Class<?>> clazz = getCamelContext().adapt(ExtendedCamelContext.class).getFactoryFinder(RESOURCE_PATH)\n-                        .findOptionalClass(name + \"-component\", null);\n-                clazz.ifPresent(c -> componentPropertyConfigurer = org.apache.camel.support.ObjectHelper.newInstance(c, GeneratedPropertyConfigurer.class));\n+                componentPropertyConfigurer = registry.lookupByNameAndType(name + \"-component\", GeneratedPropertyConfigurer.class);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NjE5ODg1NQ=="}, "originalCommit": {"oid": "5f05f1a0c485177bd0602ac48a6a7c2c674a3643"}, "originalPosition": 47}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NjMyMTI1Ng==", "bodyText": "OK, let me remove the second commit.\nBack to your original proposal\n\nThe name should have -configurer, eg -component-configurer\n\nCould you please explain why? I just want to understand your motivation.", "url": "https://github.com/apache/camel/pull/3478#discussion_r366321256", "createdAt": "2020-01-14T12:54:16Z", "author": {"login": "ppalaga"}, "path": "core/camel-support/src/main/java/org/apache/camel/support/DefaultComponent.java", "diffHunk": "@@ -406,17 +407,25 @@ protected void doInit() throws Exception {\n                 name = StringHelper.before(name, \",\");\n             }\n             try {\n+                final Registry registry = getCamelContext().getRegistry();\n                 log.trace(\"Discovering optional component property configurer class for component: {}\", name);\n-                Optional<Class<?>> clazz = getCamelContext().adapt(ExtendedCamelContext.class).getFactoryFinder(RESOURCE_PATH)\n-                        .findOptionalClass(name + \"-component\", null);\n-                clazz.ifPresent(c -> componentPropertyConfigurer = org.apache.camel.support.ObjectHelper.newInstance(c, GeneratedPropertyConfigurer.class));\n+                componentPropertyConfigurer = registry.lookupByNameAndType(name + \"-component\", GeneratedPropertyConfigurer.class);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NjE5ODg1NQ=="}, "originalCommit": {"oid": "5f05f1a0c485177bd0602ac48a6a7c2c674a3643"}, "originalPosition": 47}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NjMzMjk2MQ==", "bodyText": "The registry is end user facing and they can register things too, and some register components with foo-component, etc so you end up with naming clashes too.", "url": "https://github.com/apache/camel/pull/3478#discussion_r366332961", "createdAt": "2020-01-14T13:20:51Z", "author": {"login": "davsclaus"}, "path": "core/camel-support/src/main/java/org/apache/camel/support/DefaultComponent.java", "diffHunk": "@@ -406,17 +407,25 @@ protected void doInit() throws Exception {\n                 name = StringHelper.before(name, \",\");\n             }\n             try {\n+                final Registry registry = getCamelContext().getRegistry();\n                 log.trace(\"Discovering optional component property configurer class for component: {}\", name);\n-                Optional<Class<?>> clazz = getCamelContext().adapt(ExtendedCamelContext.class).getFactoryFinder(RESOURCE_PATH)\n-                        .findOptionalClass(name + \"-component\", null);\n-                clazz.ifPresent(c -> componentPropertyConfigurer = org.apache.camel.support.ObjectHelper.newInstance(c, GeneratedPropertyConfigurer.class));\n+                componentPropertyConfigurer = registry.lookupByNameAndType(name + \"-component\", GeneratedPropertyConfigurer.class);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NjE5ODg1NQ=="}, "originalCommit": {"oid": "5f05f1a0c485177bd0602ac48a6a7c2c674a3643"}, "originalPosition": 47}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjI2MjQyODA5OnYy", "diffSide": "RIGHT", "path": "core/camel-support/src/main/java/org/apache/camel/support/DefaultComponent.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0xNFQwODoxNTowMVrOFdPAlg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0xNFQwODoxNTowMVrOFdPAlg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NjE5ODkzNA==", "bodyText": "The name should have -configurer, eg -endpoint-configurer", "url": "https://github.com/apache/camel/pull/3478#discussion_r366198934", "createdAt": "2020-01-14T08:15:01Z", "author": {"login": "davsclaus"}, "path": "core/camel-support/src/main/java/org/apache/camel/support/DefaultComponent.java", "diffHunk": "@@ -406,17 +407,25 @@ protected void doInit() throws Exception {\n                 name = StringHelper.before(name, \",\");\n             }\n             try {\n+                final Registry registry = getCamelContext().getRegistry();\n                 log.trace(\"Discovering optional component property configurer class for component: {}\", name);\n-                Optional<Class<?>> clazz = getCamelContext().adapt(ExtendedCamelContext.class).getFactoryFinder(RESOURCE_PATH)\n-                        .findOptionalClass(name + \"-component\", null);\n-                clazz.ifPresent(c -> componentPropertyConfigurer = org.apache.camel.support.ObjectHelper.newInstance(c, GeneratedPropertyConfigurer.class));\n+                componentPropertyConfigurer = registry.lookupByNameAndType(name + \"-component\", GeneratedPropertyConfigurer.class);\n+                if (componentPropertyConfigurer == null) {\n+                    final Optional<Class<?>> clazz = getCamelContext().adapt(ExtendedCamelContext.class).getFactoryFinder(RESOURCE_PATH)\n+                            .findOptionalClass(name + \"-component\", null);\n+                    clazz.ifPresent(c -> componentPropertyConfigurer = org.apache.camel.support.ObjectHelper.newInstance(c, GeneratedPropertyConfigurer.class));\n+                }\n                 if (log.isDebugEnabled() && componentPropertyConfigurer != null) {\n                     log.debug(\"Discovered component property configurer: {} -> {}\", name, componentPropertyConfigurer);\n                 }\n+\n                 log.trace(\"Discovering optional endpoint property configurer class for component: {}\", name);\n-                clazz = getCamelContext().adapt(ExtendedCamelContext.class).getFactoryFinder(RESOURCE_PATH)\n-                        .findOptionalClass(name + \"-endpoint\", null);\n-                clazz.ifPresent(c -> endpointPropertyConfigurer = org.apache.camel.support.ObjectHelper.newInstance(c, GeneratedPropertyConfigurer.class));\n+                endpointPropertyConfigurer = registry.lookupByNameAndType(name + \"-endpoint\", GeneratedPropertyConfigurer.class);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "5f05f1a0c485177bd0602ac48a6a7c2c674a3643"}, "originalPosition": 61}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4728, "cost": 1, "resetAt": "2021-11-12T11:18:39Z"}}}