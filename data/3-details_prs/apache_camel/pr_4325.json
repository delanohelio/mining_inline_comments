{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDk1NTExODUw", "number": 4325, "title": "camel-platform-http-vertx: handle requests using a thread from the worker pool", "bodyText": "", "createdAt": "2020-09-30T13:31:02Z", "url": "https://github.com/apache/camel/pull/4325", "merged": true, "mergeCommit": {"oid": "57fb9554c7eeb54d6d707f038fc1febf8cab9cb8"}, "closed": true, "closedAt": "2020-09-30T15:41:25Z", "author": {"login": "lburgazzoli"}, "timelineItems": {"totalCount": 6, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdN828VAFqTQ5OTQzMzUzMw==", "endCursor": "Y3Vyc29yOnYyOpPPAAABdN-EbUABqjM4MjQ5NjQyNzA=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDk5NDMzNTMz", "url": "https://github.com/apache/camel/pull/4325#pullrequestreview-499433533", "createdAt": "2020-09-30T13:32:35Z", "commit": {"oid": "5f9173ae44bf2f6dcc5c50e77056b7101ebc1c28"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDk5NDM4MDIw", "url": "https://github.com/apache/camel/pull/4325#pullrequestreview-499438020", "createdAt": "2020-09-30T13:37:05Z", "commit": {"oid": "5f9173ae44bf2f6dcc5c50e77056b7101ebc1c28"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "5f9173ae44bf2f6dcc5c50e77056b7101ebc1c28", "author": {"user": {"login": "lburgazzoli", "name": "Luca Burgazzoli"}}, "url": "https://github.com/apache/camel/commit/5f9173ae44bf2f6dcc5c50e77056b7101ebc1c28", "committedDate": "2020-09-30T13:27:58Z", "message": "camel-platform-http-vertx: handle requests using a thread from the worker pool"}, "afterCommit": {"oid": "b83291ef2b682cf58c2724b238e2e791e4580384", "author": {"user": {"login": "lburgazzoli", "name": "Luca Burgazzoli"}}, "url": "https://github.com/apache/camel/commit/b83291ef2b682cf58c2724b238e2e791e4580384", "committedDate": "2020-09-30T13:39:39Z", "message": "camel-platform-http-vertx: handle requests using a thread from the worker pool"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDk5NDk2MzM4", "url": "https://github.com/apache/camel/pull/4325#pullrequestreview-499496338", "createdAt": "2020-09-30T14:31:37Z", "commit": {"oid": "b83291ef2b682cf58c2724b238e2e791e4580384"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0zMFQxNDozMTozN1rOHagh6g==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0zMFQxNDozMTozN1rOHagh6g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NzU1Nzk5NA==", "bodyText": "You should favour async processor anyway as that makes camel use it where it can", "url": "https://github.com/apache/camel/pull/4325#discussion_r497557994", "createdAt": "2020-09-30T14:31:37Z", "author": {"login": "davsclaus"}, "path": "components/camel-platform-http-vertx/src/main/java/org/apache/camel/component/platform/http/vertx/VertxPlatformHttpConsumer.java", "diffHunk": "@@ -163,6 +146,63 @@ private String configureEndpointPath(PlatformHttpEndpoint endpoint) {\n         return PATH_PARAMETER_PATTERN.matcher(path).replaceAll(\":$1\");\n     }\n \n+    private void handleRequest(RoutingContext ctx) {\n+        final Vertx vertx = ctx.vertx();\n+        final Exchange exchange = toExchange(ctx);\n+\n+        //\n+        // We do not know if any of the processing logic of the route is synchronous or not so we\n+        // need to process the request on a thread on the Vert.x worker pool.\n+        //\n+        // As example, assuming the platform-http component is configured as the transport provider\n+        // for the rest dsl, then the following code may result in a blocking operation that could\n+        // block Vert.x event-loop for too long if the target service takes long to respond, as\n+        // example in case the service is a knative service scaled to zero that could take some time\n+        // to be come available:\n+        //\n+        //     rest(\"/results\")\n+        //         .get(\"/{id}\")\n+        //         .route()\n+        //             .removeHeaders(\"*\", \"CamelHttpPath\")\n+        //             .to(\"rest:get:?bridgeEndpoint=true\");\n+        //\n+        vertx.executeBlocking(\n+                promise -> {\n+                    try {\n+                        createUoW(exchange);\n+\n+                        // no need to use an async processor as the processing happen in\n+                        // a dedicated thread ans it won't block the Vert.x event loop\n+                        getProcessor().process(exchange);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b83291ef2b682cf58c2724b238e2e791e4580384"}, "originalPosition": 66}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "972be666afa90fc4ca32e11341e5915188ae8fa4", "author": {"user": {"login": "lburgazzoli", "name": "Luca Burgazzoli"}}, "url": "https://github.com/apache/camel/commit/972be666afa90fc4ca32e11341e5915188ae8fa4", "committedDate": "2020-09-30T14:57:04Z", "message": "camel-platform-http-vertx: handle requests using a thread from the worker pool"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "b83291ef2b682cf58c2724b238e2e791e4580384", "author": {"user": {"login": "lburgazzoli", "name": "Luca Burgazzoli"}}, "url": "https://github.com/apache/camel/commit/b83291ef2b682cf58c2724b238e2e791e4580384", "committedDate": "2020-09-30T13:39:39Z", "message": "camel-platform-http-vertx: handle requests using a thread from the worker pool"}, "afterCommit": {"oid": "972be666afa90fc4ca32e11341e5915188ae8fa4", "author": {"user": {"login": "lburgazzoli", "name": "Luca Burgazzoli"}}, "url": "https://github.com/apache/camel/commit/972be666afa90fc4ca32e11341e5915188ae8fa4", "committedDate": "2020-09-30T14:57:04Z", "message": "camel-platform-http-vertx: handle requests using a thread from the worker pool"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2854, "cost": 1, "resetAt": "2021-10-29T17:30:11Z"}}}