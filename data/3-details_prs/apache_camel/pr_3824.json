{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDE3NzcwNzM5", "number": 3824, "title": "CAMEL-15057: camel-webhook should start/stop delegate endpoint before\u2026", "bodyText": "\u2026 register webhook.\n[ ] Make sure there is a JIRA issue filed for the change (usually before you start working on it).  Trivial changes like typos do not require a JIRA issue.  Your pull request should address just this issue, without pulling in other changes.\n[ ] Each commit in the pull request should have a meaningful subject line and body.\n[ ] If you're unsure, you can format the pull request title like [CAMEL-XXX] Fixes bug in camel-file component, where you replace CAMEL-XXX with the appropriate JIRA issue.\n[ ] Write a pull request description that is detailed enough to understand what the pull request does, how, and why.\n[ ] Run mvn clean install -Psourcecheck in your module with source check enabled to make sure basic checks pass and there are no checkstyle violations. A more thorough check will be performed on your pull request automatically.\nBelow are the contribution guidelines:\nhttps://github.com/apache/camel/blob/master/CONTRIBUTING.md", "createdAt": "2020-05-14T06:03:21Z", "url": "https://github.com/apache/camel/pull/3824", "merged": true, "mergeCommit": {"oid": "c5c64a901b06f2a8da658193674a3c1ec259e6a2"}, "closed": true, "closedAt": "2020-05-14T07:59:48Z", "author": {"login": "davsclaus"}, "timelineItems": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABchHHDEgH2gAyNDE3NzcwNzM5OmJmMzIyMTI0YjJhMDAwMTYyNWFkYjY1YjY5ZmFjZGZkMDc0ZDNkOWM=", "endCursor": "Y3Vyc29yOnYyOpPPAAABchIYWMgFqTQxMTUzMjY5Mg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "bf322124b2a0001625adb65b69facdfd074d3d9c", "author": {"user": {"login": "davsclaus", "name": "Claus Ibsen"}}, "url": "https://github.com/apache/camel/commit/bf322124b2a0001625adb65b69facdfd074d3d9c", "committedDate": "2020-05-14T06:02:37Z", "message": "CAMEL-15057: camel-webhook should start/stop delegate endpoint before register webhook."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDExNTMyNjky", "url": "https://github.com/apache/camel/pull/3824#pullrequestreview-411532692", "createdAt": "2020-05-14T07:28:52Z", "commit": {"oid": "bf322124b2a0001625adb65b69facdfd074d3d9c"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xNFQwNzoyODo1MlrOGVPZoA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xNFQwNzozMToxOFrOGVPehw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNDkyNTYwMA==", "bodyText": "This might be not necessary here. And it should be in https://github.com/apache/camel/blob/master/core/camel-base/src/main/java/org/apache/camel/impl/engine/AbstractCamelContext.java#L1457", "url": "https://github.com/apache/camel/pull/3824#discussion_r424925600", "createdAt": "2020-05-14T07:28:52Z", "author": {"login": "zhfeng"}, "path": "components/camel-webhook/src/main/java/org/apache/camel/component/webhook/WebhookEndpoint.java", "diffHunk": "@@ -78,10 +79,16 @@ public void afterPropertiesConfigured(CamelContext camelContext) {\n         delegateEndpoint.setWebhookConfiguration(configuration);\n     }\n \n+    @Override\n+    protected void doInit() throws Exception {\n+        super.doInit();\n+        ServiceHelper.initService(delegateEndpoint);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "bf322124b2a0001625adb65b69facdfd074d3d9c"}, "originalPosition": 15}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNDkyNjM1OA==", "bodyText": "if the delegateEndpoint has been stared as this router is added after the camel context started, what would happen ? The endpoint can be started twice ?", "url": "https://github.com/apache/camel/pull/3824#discussion_r424926358", "createdAt": "2020-05-14T07:30:22Z", "author": {"login": "zhfeng"}, "path": "components/camel-webhook/src/main/java/org/apache/camel/component/webhook/WebhookEndpoint.java", "diffHunk": "@@ -78,10 +79,16 @@ public void afterPropertiesConfigured(CamelContext camelContext) {\n         delegateEndpoint.setWebhookConfiguration(configuration);\n     }\n \n+    @Override\n+    protected void doInit() throws Exception {\n+        super.doInit();\n+        ServiceHelper.initService(delegateEndpoint);\n+    }\n+\n     @Override\n     protected void doStart() throws Exception {\n         super.doStart();\n-\n+        ServiceHelper.startService(delegateEndpoint);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "bf322124b2a0001625adb65b69facdfd074d3d9c"}, "originalPosition": 22}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNDkyNjg1NQ==", "bodyText": "Not sure it is safe to stop the endpoint here.", "url": "https://github.com/apache/camel/pull/3824#discussion_r424926855", "createdAt": "2020-05-14T07:31:18Z", "author": {"login": "zhfeng"}, "path": "components/camel-webhook/src/main/java/org/apache/camel/component/webhook/WebhookEndpoint.java", "diffHunk": "@@ -91,11 +98,17 @@ protected void doStart() throws Exception {\n     @Override\n     protected void doStop() throws Exception {\n         super.doStop();\n-\n         if (configuration.isWebhookAutoRegister() && delegateEndpoint != null) {\n             LOG.info(\"Unregistering webhook for endpoint: {}\", delegateEndpoint);\n             delegateEndpoint.unregisterWebhook();\n         }\n+        ServiceHelper.stopService(delegateEndpoint);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "bf322124b2a0001625adb65b69facdfd074d3d9c"}, "originalPosition": 35}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3033, "cost": 1, "resetAt": "2021-10-29T17:30:11Z"}}}