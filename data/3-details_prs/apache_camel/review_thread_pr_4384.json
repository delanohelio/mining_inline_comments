{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDk5MjQ4MjM0", "number": 4384, "reviewThreads": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wOFQwOTowNToxNVrOErhHfQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wOFQwOTowNToxNVrOErhHfQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzE0MDY2ODEzOnYy", "diffSide": "RIGHT", "path": "components/camel-rabbitmq/src/main/java/org/apache/camel/component/rabbitmq/RabbitConsumer.java", "isResolved": true, "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wOFQwOTowNToxNVrOHeU8OA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wOFQxNjo0NTo1OFrOHenYnw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMTU2MjQyNA==", "bodyText": "Just wonder what to do if stop throw an exception, should we silently ignore this?", "url": "https://github.com/apache/camel/pull/4384#discussion_r501562424", "createdAt": "2020-10-08T09:05:15Z", "author": {"login": "davsclaus"}, "path": "components/camel-rabbitmq/src/main/java/org/apache/camel/component/rabbitmq/RabbitConsumer.java", "diffHunk": "@@ -326,9 +340,13 @@ public void reconnect() throws Exception {\n         } else if (channel == null || !isAutomaticRecoveryEnabled()) {\n             LOG.info(\"Attempting to open a new rabbitMQ channel\");\n             Connection conn = consumer.getConnection();\n-            channel = openChannel(conn);\n-            // Register the channel to the tag\n-            start();\n+            try {\n+                stop();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "dd2a73decfcfb58b107f8f79ce2b17f8a58c4ff6"}, "originalPosition": 36}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMTU5NjU0MA==", "bodyText": "The case I had during my integration test was that in the stop(), there is a call to \"basicCancel\", which throws an unhandled exception  (AlreadyClosedException if I recall correctly) if the channel or the connection was already closed (in my case due to the fact I called this.channel.getConnection().close() with the debugger during the handling of the message), which lead to \"start()\" never called, and thus the consumers never handled new message afterward.\nMaybe the exception handling could be more specific to the basicCancel and not on all the \"stop()\", but I thought that start should always be called no matter how stop finishes.\nI'm open to other way of handling that.", "url": "https://github.com/apache/camel/pull/4384#discussion_r501596540", "createdAt": "2020-10-08T09:59:17Z", "author": {"login": "JSchoreels"}, "path": "components/camel-rabbitmq/src/main/java/org/apache/camel/component/rabbitmq/RabbitConsumer.java", "diffHunk": "@@ -326,9 +340,13 @@ public void reconnect() throws Exception {\n         } else if (channel == null || !isAutomaticRecoveryEnabled()) {\n             LOG.info(\"Attempting to open a new rabbitMQ channel\");\n             Connection conn = consumer.getConnection();\n-            channel = openChannel(conn);\n-            // Register the channel to the tag\n-            start();\n+            try {\n+                stop();", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMTU2MjQyNA=="}, "originalCommit": {"oid": "dd2a73decfcfb58b107f8f79ce2b17f8a58c4ff6"}, "originalPosition": 36}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMTg2NDYwNw==", "bodyText": "Yeah that sounds okay lets go with this - its better than whats before", "url": "https://github.com/apache/camel/pull/4384#discussion_r501864607", "createdAt": "2020-10-08T16:45:58Z", "author": {"login": "davsclaus"}, "path": "components/camel-rabbitmq/src/main/java/org/apache/camel/component/rabbitmq/RabbitConsumer.java", "diffHunk": "@@ -326,9 +340,13 @@ public void reconnect() throws Exception {\n         } else if (channel == null || !isAutomaticRecoveryEnabled()) {\n             LOG.info(\"Attempting to open a new rabbitMQ channel\");\n             Connection conn = consumer.getConnection();\n-            channel = openChannel(conn);\n-            // Register the channel to the tag\n-            start();\n+            try {\n+                stop();", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMTU2MjQyNA=="}, "originalCommit": {"oid": "dd2a73decfcfb58b107f8f79ce2b17f8a58c4ff6"}, "originalPosition": 36}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4824, "cost": 1, "resetAt": "2021-11-12T11:18:39Z"}}}