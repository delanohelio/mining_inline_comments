{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0MzYxMzE5Mzg3", "number": 3473, "title": "CAMEL-14387 - fix NPE when client error", "bodyText": "", "createdAt": "2020-01-10T07:47:01Z", "url": "https://github.com/apache/camel/pull/3473", "merged": true, "mergeCommit": {"oid": "0c9c2ec5807d55f992476d373f1bf91f94d93b55"}, "closed": true, "closedAt": "2020-01-10T12:21:20Z", "author": {"login": "jbdefard"}, "timelineItems": {"totalCount": 7, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABb45pT8AH2gAyMzYxMzE5Mzg3OjM4YWY2YzdmOTliMDA5OTVhZDEzOTE1MTM4MTUwYTQ3NjhlMGJjZDE=", "endCursor": "Y3Vyc29yOnYyOpPPAAABb48WElAFqTM0MTA4ODUxOA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "38af6c7f99b00995ad13915138150a4768e0bcd1", "author": {"user": null}, "url": "https://github.com/apache/camel/commit/38af6c7f99b00995ad13915138150a4768e0bcd1", "committedDate": "2020-01-10T07:44:24Z", "message": "fix NPE when client error"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzQwOTk5Nzcx", "url": "https://github.com/apache/camel/pull/3473#pullrequestreview-340999771", "createdAt": "2020-01-10T07:57:47Z", "commit": {"oid": "38af6c7f99b00995ad13915138150a4768e0bcd1"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0xMFQwNzo1Nzo0OFrOFcMfig==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0xMFQwNzo1Nzo0OFrOFcMfig==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NTEwOTEzMA==", "bodyText": "Please run the build with the sourcecheck profile enabled, the static part must be at the end of the imports listing.", "url": "https://github.com/apache/camel/pull/3473#discussion_r365109130", "createdAt": "2020-01-10T07:57:48Z", "author": {"login": "oscerd"}, "path": "components/camel-salesforce/camel-salesforce-component/src/main/java/org/apache/camel/component/salesforce/internal/streaming/SubscriptionHelper.java", "diffHunk": "@@ -16,6 +16,16 @@\n  */\n package org.apache.camel.component.salesforce.internal.streaming;\n \n+import static java.util.concurrent.TimeUnit.MILLISECONDS;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "38af6c7f99b00995ad13915138150a4768e0bcd1"}, "originalPosition": 4}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzQxMDQ3NzQz", "url": "https://github.com/apache/camel/pull/3473#pullrequestreview-341047743", "createdAt": "2020-01-10T09:39:16Z", "commit": {"oid": "38af6c7f99b00995ad13915138150a4768e0bcd1"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0xMFQwOTozOToxNlrOFcOxHQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0xMFQwOTozOToxNlrOFcOxHQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NTE0NjM5Nw==", "bodyText": "What is the reason to add SubscriptionHelper.this for these properties? IMHO it makes the code a bit chaotic, same goes for this.", "url": "https://github.com/apache/camel/pull/3473#discussion_r365146397", "createdAt": "2020-01-10T09:39:16Z", "author": {"login": "omarsmak"}, "path": "components/camel-salesforce/camel-salesforce-component/src/main/java/org/apache/camel/component/salesforce/internal/streaming/SubscriptionHelper.java", "diffHunk": "@@ -99,50 +99,51 @@ public SubscriptionHelper(final SalesforceComponent component) throws Salesforce\n \n         this.listenerMap = new ConcurrentHashMap<>();\n \n-        restartBackoff = new AtomicLong(0);\n-        backoffIncrement = component.getConfig().getBackoffIncrement();\n-        maxBackoff = component.getConfig().getMaxBackoff();\n+        this.restartBackoff = new AtomicLong(0);\n+        this.backoffIncrement = component.getConfig().getBackoffIncrement();\n+        this.maxBackoff = component.getConfig().getMaxBackoff();\n     }\n \n     @Override\n     protected void doStart() throws Exception {\n \n         // create CometD client\n-        this.client = createClient(component);\n+        this.client = createClient(this.component);\n \n         // reset all error conditions\n-        handshakeError = null;\n-        handshakeException = null;\n-        connectError = null;\n-        connectException = null;\n+        this.handshakeError = null;\n+        this.handshakeException = null;\n+        this.connectError = null;\n+        this.connectException = null;\n \n         // listener for handshake error or exception\n-        if (handshakeListener == null) {\n+        if (this.handshakeListener == null) {\n             // first start\n-            handshakeListener = new ClientSessionChannel.MessageListener() {\n-                public void onMessage(ClientSessionChannel channel, Message message) {\n+            this.handshakeListener = new ClientSessionChannel.MessageListener() {\n+                @Override\n+                public void onMessage(final ClientSessionChannel channel, final Message message) {\n                     LOG.debug(\"[CHANNEL:META_HANDSHAKE]: {}\", message);\n \n                     if (!message.isSuccessful()) {\n                         LOG.warn(\"Handshake failure: {}\", message);\n-                        handshakeError = (String)message.get(ERROR_FIELD);\n-                        handshakeException = getFailure(message);\n+                        SubscriptionHelper.this.handshakeError = (String)message.get(ERROR_FIELD);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "38af6c7f99b00995ad13915138150a4768e0bcd1"}, "originalPosition": 78}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "998807e0b4dae8002fcb62bb0a9eaacc8a680ea7", "author": {"user": null}, "url": "https://github.com/apache/camel/commit/998807e0b4dae8002fcb62bb0a9eaacc8a680ea7", "committedDate": "2020-01-10T09:53:38Z", "message": "CAMEL-14387 - fix NPE when client error"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzQxMDczNDA2", "url": "https://github.com/apache/camel/pull/3473#pullrequestreview-341073406", "createdAt": "2020-01-10T10:24:44Z", "commit": {"oid": "998807e0b4dae8002fcb62bb0a9eaacc8a680ea7"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzQxMDc2NDk5", "url": "https://github.com/apache/camel/pull/3473#pullrequestreview-341076499", "createdAt": "2020-01-10T10:30:26Z", "commit": {"oid": "998807e0b4dae8002fcb62bb0a9eaacc8a680ea7"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzQxMDg4NTE4", "url": "https://github.com/apache/camel/pull/3473#pullrequestreview-341088518", "createdAt": "2020-01-10T10:53:06Z", "commit": {"oid": "998807e0b4dae8002fcb62bb0a9eaacc8a680ea7"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2729, "cost": 1, "resetAt": "2021-10-29T17:30:11Z"}}}