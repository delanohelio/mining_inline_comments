{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTEyOTgxMDIx", "number": 4541, "title": "[CAMEL-14003] Add Kubernetes component for the custom resource instance support", "bodyText": "This commit adds the component that handles the Kubernates custom resource instances.\nThe added component name is kubernetes-custom-resources.\nIt supports create, get, list and delete for the custom resource instances.\nIt also supports notifications for the custom resource instance changes.\n\n Make sure there is a JIRA issue filed for the change (usually before you start working on it).  Trivial changes like typos do not require a JIRA issue.  Your pull request should address just this issue, without pulling in other changes.\n Each commit in the pull request should have a meaningful subject line and body.\n If you're unsure, you can format the pull request title like [CAMEL-XXX] Fixes bug in camel-file component, where you replace CAMEL-XXX with the appropriate JIRA issue.\n Write a pull request description that is detailed enough to understand what the pull request does, how, and why.\n Run mvn clean install -Psourcecheck in your module with source check enabled to make sure basic checks pass and there are no checkstyle violations. A more thorough check will be performed on your pull request automatically.\nBelow are the contribution guidelines:\nhttps://github.com/apache/camel/blob/master/CONTRIBUTING.md", "createdAt": "2020-10-30T13:05:59Z", "url": "https://github.com/apache/camel/pull/4541", "merged": true, "mergeCommit": {"oid": "3933825d19c18b3da258e246c871abbb25f1f7b3"}, "closed": true, "closedAt": "2020-11-04T09:40:03Z", "author": {"login": "akihikokuroda"}, "timelineItems": {"totalCount": 13, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdXm5EMgFqTUyMDY2MzIwOQ==", "endCursor": "Y3Vyc29yOnYyOpPPAAABdY6S8OAFqTUyMjU2OTA3Ng==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTIwNjYzMjA5", "url": "https://github.com/apache/camel/pull/4541#pullrequestreview-520663209", "createdAt": "2020-10-30T13:25:24Z", "commit": {"oid": "22400c387df6c0392f85dea22f4aa138639db788"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 10, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0zMFQxMzoyNToyNFrOHrO2OQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0zMFQxMzozNDozNVrOHrPOnQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNTA5NDA3Mw==", "bodyText": "Please avoid using org.json:json, the license is not complaint with ASF, remove this.", "url": "https://github.com/apache/camel/pull/4541#discussion_r515094073", "createdAt": "2020-10-30T13:25:24Z", "author": {"login": "oscerd"}, "path": "components/camel-kubernetes/pom.xml", "diffHunk": "@@ -47,6 +47,15 @@\n             <groupId>org.apache.camel</groupId>\n             <artifactId>camel-cluster</artifactId>\n         </dependency>\n+        <dependency>\n+            <groupId>org.apache.camel</groupId>\n+            <artifactId>camel-util-json</artifactId>\n+        </dependency>\n+        <dependency>\n+            <groupId>org.json</groupId>\n+            <artifactId>json</artifactId>\n+            <version>20200518</version>", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "22400c387df6c0392f85dea22f4aa138639db788"}, "originalPosition": 11}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNTA5NjUyNA==", "bodyText": "Is there a reason for commented part?", "url": "https://github.com/apache/camel/pull/4541#discussion_r515096524", "createdAt": "2020-10-30T13:29:05Z", "author": {"login": "oscerd"}, "path": "components/camel-kubernetes/src/main/java/org/apache/camel/component/kubernetes/customresources/KubernetesCustomResourcesConsumer.java", "diffHunk": "@@ -0,0 +1,193 @@\n+/*\n+ * Licensed to the Apache Software Foundation (ASF) under one or more\n+ * contributor license agreements.  See the NOTICE file distributed with\n+ * this work for additional information regarding copyright ownership.\n+ * The ASF licenses this file to You under the Apache License, Version 2.0\n+ * (the \"License\"); you may not use this file except in compliance with\n+ * the License.  You may obtain a copy of the License at\n+ *\n+ *      http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+package org.apache.camel.component.kubernetes.customresources;\n+\n+import java.util.concurrent.ExecutorService;\n+\n+import io.fabric8.kubernetes.client.KubernetesClientException;\n+import io.fabric8.kubernetes.client.Watch;\n+import io.fabric8.kubernetes.client.Watcher;\n+import io.fabric8.kubernetes.client.dsl.base.CustomResourceDefinitionContext;\n+import io.fabric8.kubernetes.client.dsl.internal.RawCustomResourceOperationsImpl;\n+/*\n+import io.fabric8.kubernetes.api.model.apps.Deployment;\n+import io.fabric8.kubernetes.api.model.apps.DeploymentList;\n+import io.fabric8.kubernetes.api.model.apps.DoneableDeployment;\n+import io.fabric8.kubernetes.client.KubernetesClientException;\n+import io.fabric8.kubernetes.client.Watch;\n+import io.fabric8.kubernetes.client.Watcher;\n+import io.fabric8.kubernetes.client.dsl.NonNamespaceOperation;\n+import io.fabric8.kubernetes.client.dsl.RollableScalableResource;\n+*/\n+import org.apache.camel.Exchange;\n+import org.apache.camel.Processor;\n+import org.apache.camel.component.kubernetes.AbstractKubernetesEndpoint;\n+import org.apache.camel.component.kubernetes.KubernetesConfiguration;\n+import org.apache.camel.component.kubernetes.KubernetesConstants;\n+import org.apache.camel.support.DefaultConsumer;\n+import org.apache.camel.util.ObjectHelper;\n+import org.slf4j.Logger;\n+import org.slf4j.LoggerFactory;\n+\n+public class KubernetesCustomResourcesConsumer extends DefaultConsumer {\n+\n+    private static final Logger LOG = LoggerFactory.getLogger(KubernetesCustomResourcesConsumer.class);\n+\n+    private final Processor processor;\n+    private ExecutorService executor;\n+    private CustomResourcesConsumerTask customResourcesWatcher;\n+\n+    public KubernetesCustomResourcesConsumer(AbstractKubernetesEndpoint endpoint, Processor processor) {\n+        super(endpoint, processor);\n+        this.processor = processor;\n+    }\n+\n+    @Override\n+    public AbstractKubernetesEndpoint getEndpoint() {\n+        return (AbstractKubernetesEndpoint) super.getEndpoint();\n+    }\n+\n+    @Override\n+    protected void doStart() throws Exception {\n+        super.doStart();\n+        executor = getEndpoint().createExecutor();\n+\n+        customResourcesWatcher = new CustomResourcesConsumerTask();\n+        executor.submit(customResourcesWatcher);\n+    }\n+\n+    @Override\n+    protected void doStop() throws Exception {\n+        super.doStop();\n+\n+        LOG.debug(\"Stopping Kubernetes Custom Resources Consumer\");\n+        if (executor != null) {\n+            if (getEndpoint() != null && getEndpoint().getCamelContext() != null) {\n+                if (customResourcesWatcher != null) {\n+                    customResourcesWatcher.getWatch().close();\n+                }\n+                getEndpoint().getCamelContext().getExecutorServiceManager().shutdownNow(executor);\n+            } else {\n+                if (customResourcesWatcher != null) {\n+                    customResourcesWatcher.getWatch().close();\n+                }\n+                executor.shutdownNow();\n+            }\n+        }\n+        executor = null;\n+    }\n+\n+    class CustomResourcesConsumerTask implements Runnable {\n+\n+        private Watch watch;\n+\n+        @Override\n+        public void run() {\n+            RawCustomResourceOperationsImpl w = getEndpoint().getKubernetesClient()\n+                    .customResource(getCRDContext(getEndpoint().getKubernetesConfiguration()));\n+            if (ObjectHelper.isNotEmpty(getEndpoint().getKubernetesConfiguration().getNamespace())) {\n+                LOG.error(\"namespace is not specified.\");\n+            }\n+            String namespace = getEndpoint().getKubernetesConfiguration().getNamespace();\n+            try {\n+                w.watch(namespace, new Watcher<String>() {\n+\n+                    @Override\n+                    public void eventReceived(Action action, String resource) {\n+                        Exchange exchange = getEndpoint().createExchange();\n+                        exchange.getIn().setBody(resource);\n+                        exchange.getIn().setHeader(KubernetesConstants.KUBERNETES_CRD_EVENT_ACTION, action);\n+                        exchange.getIn().setHeader(KubernetesConstants.KUBERNETES_CRD_EVENT_TIMESTAMP,\n+                                System.currentTimeMillis());\n+                        try {\n+                            processor.process(exchange);\n+                        } catch (Exception e) {\n+                            getExceptionHandler().handleException(\"Error during processing\", exchange, e);\n+                        }\n+                    }\n+\n+                    @Override\n+                    public void onClose(KubernetesClientException cause) {\n+                        if (cause != null) {\n+                            LOG.error(cause.getMessage(), cause);\n+                        }\n+\n+                    }\n+                });\n+            } catch (Exception e) {\n+                LOG.error(\"Exception in handling githubsource instance change\", e);\n+            }\n+\n+            /*", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "22400c387df6c0392f85dea22f4aa138639db788"}, "originalPosition": 135}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNTA5NjY4NQ==", "bodyText": "firstVersion is wrong", "url": "https://github.com/apache/camel/pull/4541#discussion_r515096685", "createdAt": "2020-10-30T13:29:20Z", "author": {"login": "oscerd"}, "path": "components/camel-kubernetes/src/main/java/org/apache/camel/component/kubernetes/customresources/KubernetesCustomResourcesEndpoint.java", "diffHunk": "@@ -0,0 +1,51 @@\n+/*\n+ * Licensed to the Apache Software Foundation (ASF) under one or more\n+ * contributor license agreements.  See the NOTICE file distributed with\n+ * this work for additional information regarding copyright ownership.\n+ * The ASF licenses this file to You under the Apache License, Version 2.0\n+ * (the \"License\"); you may not use this file except in compliance with\n+ * the License.  You may obtain a copy of the License at\n+ *\n+ *      http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+package org.apache.camel.component.kubernetes.customresources;\n+\n+import org.apache.camel.Category;\n+import org.apache.camel.Consumer;\n+import org.apache.camel.Processor;\n+import org.apache.camel.Producer;\n+import org.apache.camel.component.kubernetes.AbstractKubernetesEndpoint;\n+import org.apache.camel.component.kubernetes.KubernetesConfiguration;\n+import org.apache.camel.spi.UriEndpoint;\n+\n+/**\n+ * Perform operations on Kubernetes Custom Resources and get notified on Deployment changes.\n+ */\n+@UriEndpoint(firstVersion = \"2.20.0\", scheme = \"kubernetes-custom-resources\", title = \"Kubernetes Custom Resources\",", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "22400c387df6c0392f85dea22f4aa138639db788"}, "originalPosition": 30}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNTA5ODc2OQ==", "bodyText": "Please remove commented imports", "url": "https://github.com/apache/camel/pull/4541#discussion_r515098769", "createdAt": "2020-10-30T13:32:35Z", "author": {"login": "oscerd"}, "path": "components/camel-kubernetes/src/main/java/org/apache/camel/component/kubernetes/customresources/KubernetesCustomResourcesConsumer.java", "diffHunk": "@@ -0,0 +1,193 @@\n+/*\n+ * Licensed to the Apache Software Foundation (ASF) under one or more\n+ * contributor license agreements.  See the NOTICE file distributed with\n+ * this work for additional information regarding copyright ownership.\n+ * The ASF licenses this file to You under the Apache License, Version 2.0\n+ * (the \"License\"); you may not use this file except in compliance with\n+ * the License.  You may obtain a copy of the License at\n+ *\n+ *      http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+package org.apache.camel.component.kubernetes.customresources;\n+\n+import java.util.concurrent.ExecutorService;\n+\n+import io.fabric8.kubernetes.client.KubernetesClientException;\n+import io.fabric8.kubernetes.client.Watch;\n+import io.fabric8.kubernetes.client.Watcher;\n+import io.fabric8.kubernetes.client.dsl.base.CustomResourceDefinitionContext;\n+import io.fabric8.kubernetes.client.dsl.internal.RawCustomResourceOperationsImpl;\n+/*", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "22400c387df6c0392f85dea22f4aa138639db788"}, "originalPosition": 26}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNTA5OTAyOA==", "bodyText": "Please use crdGroup cRDGroup is really ugly to read and see :-)", "url": "https://github.com/apache/camel/pull/4541#discussion_r515099028", "createdAt": "2020-10-30T13:33:01Z", "author": {"login": "oscerd"}, "path": "components/camel-kubernetes/src/main/java/org/apache/camel/component/kubernetes/KubernetesConfiguration.java", "diffHunk": "@@ -105,6 +105,21 @@\n     @UriParam(label = \"advanced\")\n     private Integer connectionTimeout;\n \n+    @UriParam(label = \"consumer\")\n+    private String cRDName;\n+\n+    @UriParam(label = \"consumer\")\n+    private String cRDGroup;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "22400c387df6c0392f85dea22f4aa138639db788"}, "originalPosition": 8}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNTA5OTEyNw==", "bodyText": "crdName", "url": "https://github.com/apache/camel/pull/4541#discussion_r515099127", "createdAt": "2020-10-30T13:33:11Z", "author": {"login": "oscerd"}, "path": "components/camel-kubernetes/src/main/java/org/apache/camel/component/kubernetes/KubernetesConfiguration.java", "diffHunk": "@@ -105,6 +105,21 @@\n     @UriParam(label = \"advanced\")\n     private Integer connectionTimeout;\n \n+    @UriParam(label = \"consumer\")\n+    private String cRDName;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "22400c387df6c0392f85dea22f4aa138639db788"}, "originalPosition": 5}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNTA5OTIxNg==", "bodyText": "crdScope", "url": "https://github.com/apache/camel/pull/4541#discussion_r515099216", "createdAt": "2020-10-30T13:33:20Z", "author": {"login": "oscerd"}, "path": "components/camel-kubernetes/src/main/java/org/apache/camel/component/kubernetes/KubernetesConfiguration.java", "diffHunk": "@@ -105,6 +105,21 @@\n     @UriParam(label = \"advanced\")\n     private Integer connectionTimeout;\n \n+    @UriParam(label = \"consumer\")\n+    private String cRDName;\n+\n+    @UriParam(label = \"consumer\")\n+    private String cRDGroup;\n+\n+    @UriParam(label = \"consumer\")\n+    private String cRDScope;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "22400c387df6c0392f85dea22f4aa138639db788"}, "originalPosition": 11}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNTA5OTI5NQ==", "bodyText": "crdVersion", "url": "https://github.com/apache/camel/pull/4541#discussion_r515099295", "createdAt": "2020-10-30T13:33:27Z", "author": {"login": "oscerd"}, "path": "components/camel-kubernetes/src/main/java/org/apache/camel/component/kubernetes/KubernetesConfiguration.java", "diffHunk": "@@ -105,6 +105,21 @@\n     @UriParam(label = \"advanced\")\n     private Integer connectionTimeout;\n \n+    @UriParam(label = \"consumer\")\n+    private String cRDName;\n+\n+    @UriParam(label = \"consumer\")\n+    private String cRDGroup;\n+\n+    @UriParam(label = \"consumer\")\n+    private String cRDScope;\n+\n+    @UriParam(label = \"consumer\")\n+    private String cRDVersion;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "22400c387df6c0392f85dea22f4aa138639db788"}, "originalPosition": 14}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNTA5OTM3OA==", "bodyText": "crdPlural", "url": "https://github.com/apache/camel/pull/4541#discussion_r515099378", "createdAt": "2020-10-30T13:33:34Z", "author": {"login": "oscerd"}, "path": "components/camel-kubernetes/src/main/java/org/apache/camel/component/kubernetes/KubernetesConfiguration.java", "diffHunk": "@@ -105,6 +105,21 @@\n     @UriParam(label = \"advanced\")\n     private Integer connectionTimeout;\n \n+    @UriParam(label = \"consumer\")\n+    private String cRDName;\n+\n+    @UriParam(label = \"consumer\")\n+    private String cRDGroup;\n+\n+    @UriParam(label = \"consumer\")\n+    private String cRDScope;\n+\n+    @UriParam(label = \"consumer\")\n+    private String cRDVersion;\n+\n+    @UriParam(label = \"consumer\")\n+    private String cRDPlural;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "22400c387df6c0392f85dea22f4aa138639db788"}, "originalPosition": 17}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNTEwMDMxNw==", "bodyText": "No need for this log at info level. Too noisy. At least use debug level.", "url": "https://github.com/apache/camel/pull/4541#discussion_r515100317", "createdAt": "2020-10-30T13:34:35Z", "author": {"login": "oscerd"}, "path": "components/camel-kubernetes/src/main/java/org/apache/camel/component/kubernetes/customresources/KubernetesCustomResourcesProducer.java", "diffHunk": "@@ -0,0 +1,199 @@\n+/*\n+ * Licensed to the Apache Software Foundation (ASF) under one or more\n+ * contributor license agreements.  See the NOTICE file distributed with\n+ * this work for additional information regarding copyright ownership.\n+ * The ASF licenses this file to You under the Apache License, Version 2.0\n+ * (the \"License\"); you may not use this file except in compliance with\n+ * the License.  You may obtain a copy of the License at\n+ *\n+ *      http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+package org.apache.camel.component.kubernetes.customresources;\n+\n+import java.util.Map;\n+\n+import io.fabric8.kubernetes.client.KubernetesClientException;\n+import io.fabric8.kubernetes.client.dsl.base.CustomResourceDefinitionContext;\n+import org.apache.camel.Exchange;\n+import org.apache.camel.Message;\n+import org.apache.camel.component.kubernetes.AbstractKubernetesEndpoint;\n+import org.apache.camel.component.kubernetes.KubernetesConstants;\n+import org.apache.camel.component.kubernetes.KubernetesOperations;\n+import org.apache.camel.support.DefaultProducer;\n+import org.apache.camel.support.MessageHelper;\n+import org.apache.camel.util.ObjectHelper;\n+import org.apache.camel.util.json.JsonArray;\n+import org.apache.camel.util.json.JsonObject;\n+import org.slf4j.Logger;\n+import org.slf4j.LoggerFactory;\n+\n+public class KubernetesCustomResourcesProducer extends DefaultProducer {\n+\n+    private static final Logger LOG = LoggerFactory.getLogger(KubernetesCustomResourcesProducer.class);\n+\n+    public KubernetesCustomResourcesProducer(AbstractKubernetesEndpoint endpoint) {\n+        super(endpoint);\n+    }\n+\n+    @Override\n+    public AbstractKubernetesEndpoint getEndpoint() {\n+        return (AbstractKubernetesEndpoint) super.getEndpoint();\n+    }\n+\n+    @Override\n+    public void process(Exchange exchange) throws Exception {\n+        String operation;\n+\n+        if (ObjectHelper.isEmpty(getEndpoint().getKubernetesConfiguration().getOperation())) {\n+            operation = exchange.getIn().getHeader(KubernetesConstants.KUBERNETES_OPERATION, String.class);\n+        } else {\n+            operation = getEndpoint().getKubernetesConfiguration().getOperation();\n+        }\n+\n+        switch (operation) {\n+\n+            case KubernetesOperations.LIST_CUSTOMRESOURCES:\n+                doList(exchange, operation);\n+                break;\n+\n+            case KubernetesOperations.LIST_CUSTOMRESOURCES_BY_LABELS_OPERATION:\n+                doListByLabels(exchange, operation);\n+                break;\n+\n+            case KubernetesOperations.GET_CUSTOMRESOURCE:\n+                doGet(exchange, operation);\n+                break;\n+\n+            case KubernetesOperations.DELETE_CUSTOMRESOURCE:\n+                doDelete(exchange, operation);\n+                break;\n+\n+            case KubernetesOperations.CREATE_CUSTOMRESOURCE:\n+                doCreate(exchange, operation);\n+                break;\n+\n+            default:\n+                throw new IllegalArgumentException(\"Unsupported operation \" + operation);\n+        }\n+    }\n+\n+    protected void doList(Exchange exchange, String operation) throws Exception {\n+        String namespaceName = exchange.getIn().getHeader(KubernetesConstants.KUBERNETES_NAMESPACE_NAME, String.class);\n+        JsonObject customResourcesListJSON = new JsonObject(\n+                getEndpoint().getKubernetesClient().customResource(getCRDContext(exchange.getIn())).list(namespaceName));\n+        LOG.info(customResourcesListJSON.toString());\n+        JsonArray customResourcesListItems = new JsonArray(customResourcesListJSON.getCollection(\"items\"));\n+\n+        MessageHelper.copyHeaders(exchange.getIn(), exchange.getOut(), true);\n+        exchange.getOut().setBody(customResourcesListItems);\n+    }\n+\n+    protected void doListByLabels(Exchange exchange, String operation) throws Exception {\n+        String namespaceName = exchange.getIn().getHeader(KubernetesConstants.KUBERNETES_NAMESPACE_NAME, String.class);\n+        Map<String, String> labels = exchange.getIn().getHeader(KubernetesConstants.KUBERNETES_CRD_LABELS, Map.class);\n+        JsonObject customResourcesListJSON = new JsonObject(\n+                getEndpoint().getKubernetesClient().customResource(getCRDContext(exchange.getIn())).list(namespaceName));\n+        LOG.info(customResourcesListJSON.toString());\n+        JsonArray customResourcesListItems = new JsonArray(customResourcesListJSON.getCollection(\"items\"));\n+\n+        MessageHelper.copyHeaders(exchange.getIn(), exchange.getOut(), true);\n+        exchange.getOut().setBody(customResourcesListItems);\n+    }\n+\n+    protected void doGet(Exchange exchange, String operation) throws Exception {\n+        String customResourceName = exchange.getIn().getHeader(KubernetesConstants.KUBERNETES_CRD_INSTANCE_NAME, String.class);\n+        String namespaceName = exchange.getIn().getHeader(KubernetesConstants.KUBERNETES_NAMESPACE_NAME, String.class);\n+        if (ObjectHelper.isEmpty(customResourceName)) {\n+            LOG.error(\"Get a specific Deployment require specify a Deployment name\");\n+            throw new IllegalArgumentException(\"Get a specific Deployment require specify a Deployment name\");\n+        }\n+        JsonObject customResourceJSON = new JsonObject();\n+        try {\n+            customResourceJSON = new JsonObject(\n+                    getEndpoint().getKubernetesClient().customResource(getCRDContext(exchange.getIn())).get(namespaceName,\n+                            customResourceName));\n+        } catch (KubernetesClientException e) {\n+            if (e.getCode() == 404) {\n+                LOG.info(\"Custom resource instance not found\", e);\n+            } else {\n+                throw e;\n+            }\n+        }\n+        LOG.info(customResourceJSON.toString());\n+\n+        MessageHelper.copyHeaders(exchange.getIn(), exchange.getOut(), true);\n+        exchange.getOut().setBody(customResourceJSON);\n+    }\n+\n+    protected void doDelete(Exchange exchange, String operation) throws Exception {\n+        String customResourceName = exchange.getIn().getHeader(KubernetesConstants.KUBERNETES_CRD_INSTANCE_NAME, String.class);\n+        String namespaceName = exchange.getIn().getHeader(KubernetesConstants.KUBERNETES_NAMESPACE_NAME, String.class);\n+        if (ObjectHelper.isEmpty(customResourceName)) {\n+            LOG.error(\"Delete a specific deployment require specify a deployment name\");\n+            throw new IllegalArgumentException(\"Delete a specific deployment require specify a deployment name\");\n+        }\n+        if (ObjectHelper.isEmpty(namespaceName)) {\n+            LOG.error(\"Delete a specific deployment require specify a namespace name\");\n+            throw new IllegalArgumentException(\"Delete a specific deployment require specify a namespace name\");\n+        }\n+\n+        JsonObject customResourceJSON = new JsonObject();\n+        try {\n+            customResourceJSON = new JsonObject(\n+                    getEndpoint().getKubernetesClient().customResource(getCRDContext(exchange.getIn())).delete(namespaceName,\n+                            customResourceName));\n+        } catch (KubernetesClientException e) {\n+            if (e.getCode() == 404) {\n+                LOG.info(\"Custom resource instance not found\", e);\n+            } else {\n+                throw e;\n+            }\n+        }\n+\n+        MessageHelper.copyHeaders(exchange.getIn(), exchange.getOut(), true);\n+        exchange.getOut().setBody(customResourceJSON);\n+    }\n+\n+    protected void doCreate(Exchange exchange, String operation) throws Exception {\n+        String customResourceInstance = exchange.getIn().getHeader(KubernetesConstants.KUBERNETES_CRD_INSTANCE, String.class);\n+        String namespaceName = exchange.getIn().getHeader(KubernetesConstants.KUBERNETES_NAMESPACE_NAME, String.class);\n+\n+        JsonObject gitHubSourceJSON = new JsonObject();\n+        try {\n+            gitHubSourceJSON = new JsonObject(\n+                    getEndpoint().getKubernetesClient().customResource(getCRDContext(exchange.getIn())).create(namespaceName,\n+                            customResourceInstance));\n+        } catch (KubernetesClientException e) {\n+            if (e.getCode() == 409) {\n+                LOG.info(\"Custom resoure instance already exists\", e);\n+            } else {\n+                throw e;\n+            }\n+        }\n+        MessageHelper.copyHeaders(exchange.getIn(), exchange.getOut(), true);\n+        exchange.getOut().setBody(gitHubSourceJSON);\n+    }\n+\n+    private CustomResourceDefinitionContext getCRDContext(Message message) {\n+        LOG.info(\"getCRDContext:\" + message.getHeader(KubernetesConstants.KUBERNETES_CRD_NAME, String.class));", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "22400c387df6c0392f85dea22f4aa138639db788"}, "originalPosition": 184}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "4a6afd066b8faa84c68d6ba3a665b85a4c401e5f", "author": {"user": {"login": "akihikokuroda", "name": "Akihiko (Aki) Kuroda"}}, "url": "https://github.com/apache/camel/commit/4a6afd066b8faa84c68d6ba3a665b85a4c401e5f", "committedDate": "2020-10-30T22:19:58Z", "message": "Add kubernetes custom resource component"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f1e9931a7bbc7e9f42a61bf623d1eae6cb6ebce9", "author": {"user": {"login": "akihikokuroda", "name": "Akihiko (Aki) Kuroda"}}, "url": "https://github.com/apache/camel/commit/f1e9931a7bbc7e9f42a61bf623d1eae6cb6ebce9", "committedDate": "2020-10-31T01:10:03Z", "message": "undo some files"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTIxMjI3NTE5", "url": "https://github.com/apache/camel/pull/4541#pullrequestreview-521227519", "createdAt": "2020-11-01T14:03:49Z", "commit": {"oid": "f1e9931a7bbc7e9f42a61bf623d1eae6cb6ebce9"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTIxNDQ1MDIy", "url": "https://github.com/apache/camel/pull/4541#pullrequestreview-521445022", "createdAt": "2020-11-02T09:11:04Z", "commit": {"oid": "f1e9931a7bbc7e9f42a61bf623d1eae6cb6ebce9"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 5, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wMlQwOToxMTowNFrOHr7u0A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wMlQwOTo0MTozNlrOHr81aQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNTgyOTQ1Ng==", "bodyText": "IMHO I'd stop the camel context last after stopping the executor", "url": "https://github.com/apache/camel/pull/4541#discussion_r515829456", "createdAt": "2020-11-02T09:11:04Z", "author": {"login": "omarsmak"}, "path": "components/camel-kubernetes/src/main/java/org/apache/camel/component/kubernetes/customresources/KubernetesCustomResourcesConsumer.java", "diffHunk": "@@ -0,0 +1,145 @@\n+/*\n+ * Licensed to the Apache Software Foundation (ASF) under one or more\n+ * contributor license agreements.  See the NOTICE file distributed with\n+ * this work for additional information regarding copyright ownership.\n+ * The ASF licenses this file to You under the Apache License, Version 2.0\n+ * (the \"License\"); you may not use this file except in compliance with\n+ * the License.  You may obtain a copy of the License at\n+ *\n+ *      http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+package org.apache.camel.component.kubernetes.customresources;\n+\n+import java.util.concurrent.ExecutorService;\n+\n+import io.fabric8.kubernetes.client.KubernetesClientException;\n+import io.fabric8.kubernetes.client.Watch;\n+import io.fabric8.kubernetes.client.Watcher;\n+import io.fabric8.kubernetes.client.dsl.base.CustomResourceDefinitionContext;\n+import io.fabric8.kubernetes.client.dsl.internal.RawCustomResourceOperationsImpl;\n+import org.apache.camel.Exchange;\n+import org.apache.camel.Processor;\n+import org.apache.camel.component.kubernetes.AbstractKubernetesEndpoint;\n+import org.apache.camel.component.kubernetes.KubernetesConfiguration;\n+import org.apache.camel.component.kubernetes.KubernetesConstants;\n+import org.apache.camel.support.DefaultConsumer;\n+import org.apache.camel.util.ObjectHelper;\n+import org.slf4j.Logger;\n+import org.slf4j.LoggerFactory;\n+\n+public class KubernetesCustomResourcesConsumer extends DefaultConsumer {\n+\n+    private static final Logger LOG = LoggerFactory.getLogger(KubernetesCustomResourcesConsumer.class);\n+\n+    private final Processor processor;\n+    private ExecutorService executor;\n+    private CustomResourcesConsumerTask customResourcesWatcher;\n+\n+    public KubernetesCustomResourcesConsumer(AbstractKubernetesEndpoint endpoint, Processor processor) {\n+        super(endpoint, processor);\n+        this.processor = processor;\n+    }\n+\n+    @Override\n+    public AbstractKubernetesEndpoint getEndpoint() {\n+        return (AbstractKubernetesEndpoint) super.getEndpoint();\n+    }\n+\n+    @Override\n+    protected void doStart() throws Exception {\n+        super.doStart();\n+        executor = getEndpoint().createExecutor();\n+\n+        customResourcesWatcher = new CustomResourcesConsumerTask();\n+        executor.submit(customResourcesWatcher);\n+    }\n+\n+    @Override\n+    protected void doStop() throws Exception {\n+        super.doStop();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f1e9931a7bbc7e9f42a61bf623d1eae6cb6ebce9"}, "originalPosition": 65}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNTgyOTkzNg==", "bodyText": "Can we have more meaningful name instead of w?", "url": "https://github.com/apache/camel/pull/4541#discussion_r515829936", "createdAt": "2020-11-02T09:11:56Z", "author": {"login": "omarsmak"}, "path": "components/camel-kubernetes/src/main/java/org/apache/camel/component/kubernetes/customresources/KubernetesCustomResourcesConsumer.java", "diffHunk": "@@ -0,0 +1,145 @@\n+/*\n+ * Licensed to the Apache Software Foundation (ASF) under one or more\n+ * contributor license agreements.  See the NOTICE file distributed with\n+ * this work for additional information regarding copyright ownership.\n+ * The ASF licenses this file to You under the Apache License, Version 2.0\n+ * (the \"License\"); you may not use this file except in compliance with\n+ * the License.  You may obtain a copy of the License at\n+ *\n+ *      http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+package org.apache.camel.component.kubernetes.customresources;\n+\n+import java.util.concurrent.ExecutorService;\n+\n+import io.fabric8.kubernetes.client.KubernetesClientException;\n+import io.fabric8.kubernetes.client.Watch;\n+import io.fabric8.kubernetes.client.Watcher;\n+import io.fabric8.kubernetes.client.dsl.base.CustomResourceDefinitionContext;\n+import io.fabric8.kubernetes.client.dsl.internal.RawCustomResourceOperationsImpl;\n+import org.apache.camel.Exchange;\n+import org.apache.camel.Processor;\n+import org.apache.camel.component.kubernetes.AbstractKubernetesEndpoint;\n+import org.apache.camel.component.kubernetes.KubernetesConfiguration;\n+import org.apache.camel.component.kubernetes.KubernetesConstants;\n+import org.apache.camel.support.DefaultConsumer;\n+import org.apache.camel.util.ObjectHelper;\n+import org.slf4j.Logger;\n+import org.slf4j.LoggerFactory;\n+\n+public class KubernetesCustomResourcesConsumer extends DefaultConsumer {\n+\n+    private static final Logger LOG = LoggerFactory.getLogger(KubernetesCustomResourcesConsumer.class);\n+\n+    private final Processor processor;\n+    private ExecutorService executor;\n+    private CustomResourcesConsumerTask customResourcesWatcher;\n+\n+    public KubernetesCustomResourcesConsumer(AbstractKubernetesEndpoint endpoint, Processor processor) {\n+        super(endpoint, processor);\n+        this.processor = processor;\n+    }\n+\n+    @Override\n+    public AbstractKubernetesEndpoint getEndpoint() {\n+        return (AbstractKubernetesEndpoint) super.getEndpoint();\n+    }\n+\n+    @Override\n+    protected void doStart() throws Exception {\n+        super.doStart();\n+        executor = getEndpoint().createExecutor();\n+\n+        customResourcesWatcher = new CustomResourcesConsumerTask();\n+        executor.submit(customResourcesWatcher);\n+    }\n+\n+    @Override\n+    protected void doStop() throws Exception {\n+        super.doStop();\n+\n+        LOG.debug(\"Stopping Kubernetes Custom Resources Consumer\");\n+        if (executor != null) {\n+            if (getEndpoint() != null && getEndpoint().getCamelContext() != null) {\n+                if (customResourcesWatcher != null) {\n+                    customResourcesWatcher.getWatch().close();\n+                }\n+                getEndpoint().getCamelContext().getExecutorServiceManager().shutdownNow(executor);\n+            } else {\n+                if (customResourcesWatcher != null) {\n+                    customResourcesWatcher.getWatch().close();\n+                }\n+                executor.shutdownNow();\n+            }\n+        }\n+        executor = null;\n+    }\n+\n+    class CustomResourcesConsumerTask implements Runnable {\n+\n+        private Watch watch;\n+\n+        @Override\n+        public void run() {\n+            RawCustomResourceOperationsImpl w = getEndpoint().getKubernetesClient()", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f1e9931a7bbc7e9f42a61bf623d1eae6cb6ebce9"}, "originalPosition": 90}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNTgzOTQ0NA==", "bodyText": "The namespace here is essential for the operation, isn't? If so, can we add checks for the required options (in this operation and the other operation) that being obtained from the headers and throw an exception with meaningful message to the user?", "url": "https://github.com/apache/camel/pull/4541#discussion_r515839444", "createdAt": "2020-11-02T09:28:00Z", "author": {"login": "omarsmak"}, "path": "components/camel-kubernetes/src/main/java/org/apache/camel/component/kubernetes/customresources/KubernetesCustomResourcesProducer.java", "diffHunk": "@@ -0,0 +1,194 @@\n+/*\n+ * Licensed to the Apache Software Foundation (ASF) under one or more\n+ * contributor license agreements.  See the NOTICE file distributed with\n+ * this work for additional information regarding copyright ownership.\n+ * The ASF licenses this file to You under the Apache License, Version 2.0\n+ * (the \"License\"); you may not use this file except in compliance with\n+ * the License.  You may obtain a copy of the License at\n+ *\n+ *      http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+package org.apache.camel.component.kubernetes.customresources;\n+\n+import java.util.Map;\n+\n+import io.fabric8.kubernetes.client.KubernetesClientException;\n+import io.fabric8.kubernetes.client.dsl.base.CustomResourceDefinitionContext;\n+import org.apache.camel.Exchange;\n+import org.apache.camel.Message;\n+import org.apache.camel.component.kubernetes.AbstractKubernetesEndpoint;\n+import org.apache.camel.component.kubernetes.KubernetesConstants;\n+import org.apache.camel.component.kubernetes.KubernetesOperations;\n+import org.apache.camel.support.DefaultProducer;\n+import org.apache.camel.support.MessageHelper;\n+import org.apache.camel.util.ObjectHelper;\n+import org.apache.camel.util.json.JsonArray;\n+import org.apache.camel.util.json.JsonObject;\n+import org.slf4j.Logger;\n+import org.slf4j.LoggerFactory;\n+\n+public class KubernetesCustomResourcesProducer extends DefaultProducer {\n+\n+    private static final Logger LOG = LoggerFactory.getLogger(KubernetesCustomResourcesProducer.class);\n+\n+    public KubernetesCustomResourcesProducer(AbstractKubernetesEndpoint endpoint) {\n+        super(endpoint);\n+    }\n+\n+    @Override\n+    public AbstractKubernetesEndpoint getEndpoint() {\n+        return (AbstractKubernetesEndpoint) super.getEndpoint();\n+    }\n+\n+    @Override\n+    public void process(Exchange exchange) throws Exception {\n+        String operation;\n+\n+        if (ObjectHelper.isEmpty(getEndpoint().getKubernetesConfiguration().getOperation())) {\n+            operation = exchange.getIn().getHeader(KubernetesConstants.KUBERNETES_OPERATION, String.class);\n+        } else {\n+            operation = getEndpoint().getKubernetesConfiguration().getOperation();\n+        }\n+\n+        switch (operation) {\n+\n+            case KubernetesOperations.LIST_CUSTOMRESOURCES:\n+                doList(exchange, operation);\n+                break;\n+\n+            case KubernetesOperations.LIST_CUSTOMRESOURCES_BY_LABELS_OPERATION:\n+                doListByLabels(exchange, operation);\n+                break;\n+\n+            case KubernetesOperations.GET_CUSTOMRESOURCE:\n+                doGet(exchange, operation);\n+                break;\n+\n+            case KubernetesOperations.DELETE_CUSTOMRESOURCE:\n+                doDelete(exchange, operation);\n+                break;\n+\n+            case KubernetesOperations.CREATE_CUSTOMRESOURCE:\n+                doCreate(exchange, operation);\n+                break;\n+\n+            default:\n+                throw new IllegalArgumentException(\"Unsupported operation \" + operation);\n+        }\n+    }\n+\n+    protected void doList(Exchange exchange, String operation) throws Exception {\n+        String namespaceName = exchange.getIn().getHeader(KubernetesConstants.KUBERNETES_NAMESPACE_NAME, String.class);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f1e9931a7bbc7e9f42a61bf623d1eae6cb6ebce9"}, "originalPosition": 87}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNTg0NTY2NQ==", "bodyText": "Apart from my other comment, I think these configurations can be obtained either from the endpoint configurations or the exchange headers, not only the exchange headers, isn't? If so, IMHO, I'd add a logic to first check if these options being set in the exchange headers first and fall back to the endpoint options aka KubernetesConfiguration.", "url": "https://github.com/apache/camel/pull/4541#discussion_r515845665", "createdAt": "2020-11-02T09:38:32Z", "author": {"login": "omarsmak"}, "path": "components/camel-kubernetes/src/main/java/org/apache/camel/component/kubernetes/customresources/KubernetesCustomResourcesProducer.java", "diffHunk": "@@ -0,0 +1,194 @@\n+/*\n+ * Licensed to the Apache Software Foundation (ASF) under one or more\n+ * contributor license agreements.  See the NOTICE file distributed with\n+ * this work for additional information regarding copyright ownership.\n+ * The ASF licenses this file to You under the Apache License, Version 2.0\n+ * (the \"License\"); you may not use this file except in compliance with\n+ * the License.  You may obtain a copy of the License at\n+ *\n+ *      http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+package org.apache.camel.component.kubernetes.customresources;\n+\n+import java.util.Map;\n+\n+import io.fabric8.kubernetes.client.KubernetesClientException;\n+import io.fabric8.kubernetes.client.dsl.base.CustomResourceDefinitionContext;\n+import org.apache.camel.Exchange;\n+import org.apache.camel.Message;\n+import org.apache.camel.component.kubernetes.AbstractKubernetesEndpoint;\n+import org.apache.camel.component.kubernetes.KubernetesConstants;\n+import org.apache.camel.component.kubernetes.KubernetesOperations;\n+import org.apache.camel.support.DefaultProducer;\n+import org.apache.camel.support.MessageHelper;\n+import org.apache.camel.util.ObjectHelper;\n+import org.apache.camel.util.json.JsonArray;\n+import org.apache.camel.util.json.JsonObject;\n+import org.slf4j.Logger;\n+import org.slf4j.LoggerFactory;\n+\n+public class KubernetesCustomResourcesProducer extends DefaultProducer {\n+\n+    private static final Logger LOG = LoggerFactory.getLogger(KubernetesCustomResourcesProducer.class);\n+\n+    public KubernetesCustomResourcesProducer(AbstractKubernetesEndpoint endpoint) {\n+        super(endpoint);\n+    }\n+\n+    @Override\n+    public AbstractKubernetesEndpoint getEndpoint() {\n+        return (AbstractKubernetesEndpoint) super.getEndpoint();\n+    }\n+\n+    @Override\n+    public void process(Exchange exchange) throws Exception {\n+        String operation;\n+\n+        if (ObjectHelper.isEmpty(getEndpoint().getKubernetesConfiguration().getOperation())) {\n+            operation = exchange.getIn().getHeader(KubernetesConstants.KUBERNETES_OPERATION, String.class);\n+        } else {\n+            operation = getEndpoint().getKubernetesConfiguration().getOperation();\n+        }\n+\n+        switch (operation) {\n+\n+            case KubernetesOperations.LIST_CUSTOMRESOURCES:\n+                doList(exchange, operation);\n+                break;\n+\n+            case KubernetesOperations.LIST_CUSTOMRESOURCES_BY_LABELS_OPERATION:\n+                doListByLabels(exchange, operation);\n+                break;\n+\n+            case KubernetesOperations.GET_CUSTOMRESOURCE:\n+                doGet(exchange, operation);\n+                break;\n+\n+            case KubernetesOperations.DELETE_CUSTOMRESOURCE:\n+                doDelete(exchange, operation);\n+                break;\n+\n+            case KubernetesOperations.CREATE_CUSTOMRESOURCE:\n+                doCreate(exchange, operation);\n+                break;\n+\n+            default:\n+                throw new IllegalArgumentException(\"Unsupported operation \" + operation);\n+        }\n+    }\n+\n+    protected void doList(Exchange exchange, String operation) throws Exception {\n+        String namespaceName = exchange.getIn().getHeader(KubernetesConstants.KUBERNETES_NAMESPACE_NAME, String.class);\n+        JsonObject customResourcesListJSON = new JsonObject(\n+                getEndpoint().getKubernetesClient().customResource(getCRDContext(exchange.getIn())).list(namespaceName));\n+        LOG.info(customResourcesListJSON.toString());\n+        JsonArray customResourcesListItems = new JsonArray(customResourcesListJSON.getCollection(\"items\"));\n+\n+        MessageHelper.copyHeaders(exchange.getIn(), exchange.getOut(), true);\n+        exchange.getOut().setBody(customResourcesListItems);\n+    }\n+\n+    protected void doListByLabels(Exchange exchange, String operation) throws Exception {\n+        String namespaceName = exchange.getIn().getHeader(KubernetesConstants.KUBERNETES_NAMESPACE_NAME, String.class);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f1e9931a7bbc7e9f42a61bf623d1eae6cb6ebce9"}, "originalPosition": 98}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNTg0NzUyOQ==", "bodyText": "Also here, if not mistaken, all these options are required for the CRD context, isn't? Then checks here would help if this option is set or not and throw an exception with meaningful message to the user.", "url": "https://github.com/apache/camel/pull/4541#discussion_r515847529", "createdAt": "2020-11-02T09:41:36Z", "author": {"login": "omarsmak"}, "path": "components/camel-kubernetes/src/main/java/org/apache/camel/component/kubernetes/customresources/KubernetesCustomResourcesProducer.java", "diffHunk": "@@ -0,0 +1,194 @@\n+/*\n+ * Licensed to the Apache Software Foundation (ASF) under one or more\n+ * contributor license agreements.  See the NOTICE file distributed with\n+ * this work for additional information regarding copyright ownership.\n+ * The ASF licenses this file to You under the Apache License, Version 2.0\n+ * (the \"License\"); you may not use this file except in compliance with\n+ * the License.  You may obtain a copy of the License at\n+ *\n+ *      http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+package org.apache.camel.component.kubernetes.customresources;\n+\n+import java.util.Map;\n+\n+import io.fabric8.kubernetes.client.KubernetesClientException;\n+import io.fabric8.kubernetes.client.dsl.base.CustomResourceDefinitionContext;\n+import org.apache.camel.Exchange;\n+import org.apache.camel.Message;\n+import org.apache.camel.component.kubernetes.AbstractKubernetesEndpoint;\n+import org.apache.camel.component.kubernetes.KubernetesConstants;\n+import org.apache.camel.component.kubernetes.KubernetesOperations;\n+import org.apache.camel.support.DefaultProducer;\n+import org.apache.camel.support.MessageHelper;\n+import org.apache.camel.util.ObjectHelper;\n+import org.apache.camel.util.json.JsonArray;\n+import org.apache.camel.util.json.JsonObject;\n+import org.slf4j.Logger;\n+import org.slf4j.LoggerFactory;\n+\n+public class KubernetesCustomResourcesProducer extends DefaultProducer {\n+\n+    private static final Logger LOG = LoggerFactory.getLogger(KubernetesCustomResourcesProducer.class);\n+\n+    public KubernetesCustomResourcesProducer(AbstractKubernetesEndpoint endpoint) {\n+        super(endpoint);\n+    }\n+\n+    @Override\n+    public AbstractKubernetesEndpoint getEndpoint() {\n+        return (AbstractKubernetesEndpoint) super.getEndpoint();\n+    }\n+\n+    @Override\n+    public void process(Exchange exchange) throws Exception {\n+        String operation;\n+\n+        if (ObjectHelper.isEmpty(getEndpoint().getKubernetesConfiguration().getOperation())) {\n+            operation = exchange.getIn().getHeader(KubernetesConstants.KUBERNETES_OPERATION, String.class);\n+        } else {\n+            operation = getEndpoint().getKubernetesConfiguration().getOperation();\n+        }\n+\n+        switch (operation) {\n+\n+            case KubernetesOperations.LIST_CUSTOMRESOURCES:\n+                doList(exchange, operation);\n+                break;\n+\n+            case KubernetesOperations.LIST_CUSTOMRESOURCES_BY_LABELS_OPERATION:\n+                doListByLabels(exchange, operation);\n+                break;\n+\n+            case KubernetesOperations.GET_CUSTOMRESOURCE:\n+                doGet(exchange, operation);\n+                break;\n+\n+            case KubernetesOperations.DELETE_CUSTOMRESOURCE:\n+                doDelete(exchange, operation);\n+                break;\n+\n+            case KubernetesOperations.CREATE_CUSTOMRESOURCE:\n+                doCreate(exchange, operation);\n+                break;\n+\n+            default:\n+                throw new IllegalArgumentException(\"Unsupported operation \" + operation);\n+        }\n+    }\n+\n+    protected void doList(Exchange exchange, String operation) throws Exception {\n+        String namespaceName = exchange.getIn().getHeader(KubernetesConstants.KUBERNETES_NAMESPACE_NAME, String.class);\n+        JsonObject customResourcesListJSON = new JsonObject(\n+                getEndpoint().getKubernetesClient().customResource(getCRDContext(exchange.getIn())).list(namespaceName));\n+        LOG.info(customResourcesListJSON.toString());\n+        JsonArray customResourcesListItems = new JsonArray(customResourcesListJSON.getCollection(\"items\"));\n+\n+        MessageHelper.copyHeaders(exchange.getIn(), exchange.getOut(), true);\n+        exchange.getOut().setBody(customResourcesListItems);\n+    }\n+\n+    protected void doListByLabels(Exchange exchange, String operation) throws Exception {\n+        String namespaceName = exchange.getIn().getHeader(KubernetesConstants.KUBERNETES_NAMESPACE_NAME, String.class);\n+        Map<String, String> labels = exchange.getIn().getHeader(KubernetesConstants.KUBERNETES_CRD_LABELS, Map.class);\n+        JsonObject customResourcesListJSON = new JsonObject(\n+                getEndpoint().getKubernetesClient().customResource(getCRDContext(exchange.getIn())).list(namespaceName));\n+        LOG.info(customResourcesListJSON.toString());\n+        JsonArray customResourcesListItems = new JsonArray(customResourcesListJSON.getCollection(\"items\"));\n+\n+        MessageHelper.copyHeaders(exchange.getIn(), exchange.getOut(), true);\n+        exchange.getOut().setBody(customResourcesListItems);\n+    }\n+\n+    protected void doGet(Exchange exchange, String operation) throws Exception {\n+        String customResourceName = exchange.getIn().getHeader(KubernetesConstants.KUBERNETES_CRD_INSTANCE_NAME, String.class);\n+        String namespaceName = exchange.getIn().getHeader(KubernetesConstants.KUBERNETES_NAMESPACE_NAME, String.class);\n+        if (ObjectHelper.isEmpty(customResourceName)) {\n+            LOG.error(\"Get a specific Deployment require specify a Deployment name\");\n+            throw new IllegalArgumentException(\"Get a specific Deployment require specify a Deployment name\");\n+        }\n+        JsonObject customResourceJSON = new JsonObject();\n+        try {\n+            customResourceJSON = new JsonObject(\n+                    getEndpoint().getKubernetesClient().customResource(getCRDContext(exchange.getIn())).get(namespaceName,\n+                            customResourceName));\n+        } catch (KubernetesClientException e) {\n+            if (e.getCode() == 404) {\n+                LOG.info(\"Custom resource instance not found\", e);\n+            } else {\n+                throw e;\n+            }\n+        }\n+        LOG.info(customResourceJSON.toString());\n+\n+        MessageHelper.copyHeaders(exchange.getIn(), exchange.getOut(), true);\n+        exchange.getOut().setBody(customResourceJSON);\n+    }\n+\n+    protected void doDelete(Exchange exchange, String operation) throws Exception {\n+        String customResourceName = exchange.getIn().getHeader(KubernetesConstants.KUBERNETES_CRD_INSTANCE_NAME, String.class);\n+        String namespaceName = exchange.getIn().getHeader(KubernetesConstants.KUBERNETES_NAMESPACE_NAME, String.class);\n+        if (ObjectHelper.isEmpty(customResourceName)) {\n+            LOG.error(\"Delete a specific deployment require specify a deployment name\");\n+            throw new IllegalArgumentException(\"Delete a specific deployment require specify a deployment name\");\n+        }\n+        if (ObjectHelper.isEmpty(namespaceName)) {\n+            LOG.error(\"Delete a specific deployment require specify a namespace name\");\n+            throw new IllegalArgumentException(\"Delete a specific deployment require specify a namespace name\");\n+        }\n+\n+        JsonObject customResourceJSON = new JsonObject();\n+        try {\n+            customResourceJSON = new JsonObject(\n+                    getEndpoint().getKubernetesClient().customResource(getCRDContext(exchange.getIn())).delete(namespaceName,\n+                            customResourceName));\n+        } catch (KubernetesClientException e) {\n+            if (e.getCode() == 404) {\n+                LOG.info(\"Custom resource instance not found\", e);\n+            } else {\n+                throw e;\n+            }\n+        }\n+\n+        MessageHelper.copyHeaders(exchange.getIn(), exchange.getOut(), true);\n+        exchange.getOut().setBody(customResourceJSON);\n+    }\n+\n+    protected void doCreate(Exchange exchange, String operation) throws Exception {\n+        String customResourceInstance = exchange.getIn().getHeader(KubernetesConstants.KUBERNETES_CRD_INSTANCE, String.class);\n+        String namespaceName = exchange.getIn().getHeader(KubernetesConstants.KUBERNETES_NAMESPACE_NAME, String.class);\n+\n+        JsonObject gitHubSourceJSON = new JsonObject();\n+        try {\n+            gitHubSourceJSON = new JsonObject(\n+                    getEndpoint().getKubernetesClient().customResource(getCRDContext(exchange.getIn())).create(namespaceName,\n+                            customResourceInstance));\n+        } catch (KubernetesClientException e) {\n+            if (e.getCode() == 409) {\n+                LOG.info(\"Custom resoure instance already exists\", e);\n+            } else {\n+                throw e;\n+            }\n+        }\n+        MessageHelper.copyHeaders(exchange.getIn(), exchange.getOut(), true);\n+        exchange.getOut().setBody(gitHubSourceJSON);\n+    }\n+\n+    private CustomResourceDefinitionContext getCRDContext(Message message) {\n+        CustomResourceDefinitionContext cRDContext = new CustomResourceDefinitionContext.Builder()\n+                .withName(message.getHeader(KubernetesConstants.KUBERNETES_CRD_NAME, String.class))       // example: \"githubsources.sources.knative.dev\"", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f1e9931a7bbc7e9f42a61bf623d1eae6cb6ebce9"}, "originalPosition": 185}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "7ddee9dd8b14f441ef844cc08d4f2c170104547d", "author": {"user": {"login": "akihikokuroda", "name": "Akihiko (Aki) Kuroda"}}, "url": "https://github.com/apache/camel/commit/7ddee9dd8b14f441ef844cc08d4f2c170104547d", "committedDate": "2020-11-02T19:40:13Z", "message": "review comments"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "54b3fd3e5ff7558d3d579a3f30d122336fdcaddd", "author": {"user": {"login": "akihikokuroda", "name": "Akihiko (Aki) Kuroda"}}, "url": "https://github.com/apache/camel/commit/54b3fd3e5ff7558d3d579a3f30d122336fdcaddd", "committedDate": "2020-11-02T20:29:55Z", "message": "Fix style error"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTIyMjY4NjEw", "url": "https://github.com/apache/camel/pull/4541#pullrequestreview-522268610", "createdAt": "2020-11-03T08:27:55Z", "commit": {"oid": "54b3fd3e5ff7558d3d579a3f30d122336fdcaddd"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wM1QwODoyNzo1NVrOHskK3g==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wM1QwODoyNzo1NVrOHskK3g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNjQ5MTk5OA==", "bodyText": "You can remove LOG.error instances since you are already throwing an exception.", "url": "https://github.com/apache/camel/pull/4541#discussion_r516491998", "createdAt": "2020-11-03T08:27:55Z", "author": {"login": "omarsmak"}, "path": "components/camel-kubernetes/src/main/java/org/apache/camel/component/kubernetes/customresources/KubernetesCustomResourcesProducer.java", "diffHunk": "@@ -0,0 +1,245 @@\n+/*\n+ * Licensed to the Apache Software Foundation (ASF) under one or more\n+ * contributor license agreements.  See the NOTICE file distributed with\n+ * this work for additional information regarding copyright ownership.\n+ * The ASF licenses this file to You under the Apache License, Version 2.0\n+ * (the \"License\"); you may not use this file except in compliance with\n+ * the License.  You may obtain a copy of the License at\n+ *\n+ *      http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+package org.apache.camel.component.kubernetes.customresources;\n+\n+import java.util.Map;\n+\n+import io.fabric8.kubernetes.client.KubernetesClientException;\n+import io.fabric8.kubernetes.client.dsl.base.CustomResourceDefinitionContext;\n+import org.apache.camel.Exchange;\n+import org.apache.camel.Message;\n+import org.apache.camel.component.kubernetes.AbstractKubernetesEndpoint;\n+import org.apache.camel.component.kubernetes.KubernetesConstants;\n+import org.apache.camel.component.kubernetes.KubernetesOperations;\n+import org.apache.camel.support.DefaultProducer;\n+import org.apache.camel.support.MessageHelper;\n+import org.apache.camel.util.ObjectHelper;\n+import org.apache.camel.util.json.JsonArray;\n+import org.apache.camel.util.json.JsonObject;\n+import org.slf4j.Logger;\n+import org.slf4j.LoggerFactory;\n+\n+public class KubernetesCustomResourcesProducer extends DefaultProducer {\n+\n+    private static final Logger LOG = LoggerFactory.getLogger(KubernetesCustomResourcesProducer.class);\n+\n+    public KubernetesCustomResourcesProducer(AbstractKubernetesEndpoint endpoint) {\n+        super(endpoint);\n+    }\n+\n+    @Override\n+    public AbstractKubernetesEndpoint getEndpoint() {\n+        return (AbstractKubernetesEndpoint) super.getEndpoint();\n+    }\n+\n+    @Override\n+    public void process(Exchange exchange) throws Exception {\n+        String operation;\n+        String namespace;\n+\n+        if (ObjectHelper.isEmpty(getEndpoint().getKubernetesConfiguration().getOperation())) {\n+            operation = exchange.getIn().getHeader(KubernetesConstants.KUBERNETES_OPERATION, String.class);\n+        } else {\n+            operation = getEndpoint().getKubernetesConfiguration().getOperation();\n+        }\n+        if (ObjectHelper.isEmpty(getEndpoint().getKubernetesConfiguration().getNamespace())) {\n+            namespace = exchange.getIn().getHeader(KubernetesConstants.KUBERNETES_NAMESPACE_NAME, String.class);\n+        } else {\n+            namespace = getEndpoint().getKubernetesConfiguration().getNamespace();\n+        }\n+        if (ObjectHelper.isEmpty(namespace)) {\n+            throw new IllegalArgumentException(\"Custom Resource producer requires a namespace argument\");\n+        }\n+\n+        switch (operation) {\n+\n+            case KubernetesOperations.LIST_CUSTOMRESOURCES:\n+                doList(exchange, operation);\n+                break;\n+\n+            case KubernetesOperations.LIST_CUSTOMRESOURCES_BY_LABELS_OPERATION:\n+                doListByLabels(exchange, operation);\n+                break;\n+\n+            case KubernetesOperations.GET_CUSTOMRESOURCE:\n+                doGet(exchange, operation);\n+                break;\n+\n+            case KubernetesOperations.DELETE_CUSTOMRESOURCE:\n+                doDelete(exchange, operation);\n+                break;\n+\n+            case KubernetesOperations.CREATE_CUSTOMRESOURCE:\n+                doCreate(exchange, operation);\n+                break;\n+\n+            default:\n+                throw new IllegalArgumentException(\"Unsupported operation \" + operation);\n+        }\n+    }\n+\n+    protected void doList(Exchange exchange, String operation) throws Exception {\n+        String namespaceName = exchange.getIn().getHeader(KubernetesConstants.KUBERNETES_NAMESPACE_NAME, String.class);\n+        JsonObject customResourcesListJSON = new JsonObject(\n+                getEndpoint().getKubernetesClient().customResource(getCRDContext(exchange.getIn())).list(namespaceName));\n+        LOG.info(customResourcesListJSON.toString());\n+\n+        JsonArray customResourcesListItems;\n+        if (customResourcesListJSON.getCollection(\"items\") != null) {\n+            customResourcesListItems = new JsonArray(customResourcesListJSON.getCollection(\"items\"));\n+        } else {\n+            customResourcesListItems = new JsonArray();\n+        }\n+\n+        MessageHelper.copyHeaders(exchange.getIn(), exchange.getOut(), true);\n+        exchange.getOut().setBody(customResourcesListItems);\n+    }\n+\n+    protected void doListByLabels(Exchange exchange, String operation) throws Exception {\n+        String namespaceName = exchange.getIn().getHeader(KubernetesConstants.KUBERNETES_NAMESPACE_NAME, String.class);\n+        Map<String, String> labels = exchange.getIn().getHeader(KubernetesConstants.KUBERNETES_CRD_LABELS, Map.class);\n+        JsonObject customResourcesListJSON = new JsonObject(\n+                getEndpoint().getKubernetesClient().customResource(getCRDContext(exchange.getIn())).list(namespaceName));\n+        LOG.info(customResourcesListJSON.toString());\n+        JsonArray customResourcesListItems = new JsonArray(customResourcesListJSON.getCollection(\"items\"));\n+\n+        MessageHelper.copyHeaders(exchange.getIn(), exchange.getOut(), true);\n+        exchange.getOut().setBody(customResourcesListItems);\n+    }\n+\n+    protected void doGet(Exchange exchange, String operation) throws Exception {\n+        String customResourceName = exchange.getIn().getHeader(KubernetesConstants.KUBERNETES_CRD_INSTANCE_NAME, String.class);\n+        String namespaceName = exchange.getIn().getHeader(KubernetesConstants.KUBERNETES_NAMESPACE_NAME, String.class);\n+        if (ObjectHelper.isEmpty(customResourceName)) {\n+            LOG.error(\"Get a specific Deployment require specify a Deployment name\");", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "54b3fd3e5ff7558d3d579a3f30d122336fdcaddd"}, "originalPosition": 128}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTIyMjcyMDEw", "url": "https://github.com/apache/camel/pull/4541#pullrequestreview-522272010", "createdAt": "2020-11-03T08:32:45Z", "commit": {"oid": "54b3fd3e5ff7558d3d579a3f30d122336fdcaddd"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wM1QwODozMjo0NlrOHskUtA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wM1QwODozMjo0NlrOHskUtA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNjQ5NDUxNg==", "bodyText": "Since you are already obtaining the namespace here, would it be more efficient to just pass the obtained namespace to the functions instead of re-obtaining the namespace again?", "url": "https://github.com/apache/camel/pull/4541#discussion_r516494516", "createdAt": "2020-11-03T08:32:46Z", "author": {"login": "omarsmak"}, "path": "components/camel-kubernetes/src/main/java/org/apache/camel/component/kubernetes/customresources/KubernetesCustomResourcesProducer.java", "diffHunk": "@@ -0,0 +1,245 @@\n+/*\n+ * Licensed to the Apache Software Foundation (ASF) under one or more\n+ * contributor license agreements.  See the NOTICE file distributed with\n+ * this work for additional information regarding copyright ownership.\n+ * The ASF licenses this file to You under the Apache License, Version 2.0\n+ * (the \"License\"); you may not use this file except in compliance with\n+ * the License.  You may obtain a copy of the License at\n+ *\n+ *      http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+package org.apache.camel.component.kubernetes.customresources;\n+\n+import java.util.Map;\n+\n+import io.fabric8.kubernetes.client.KubernetesClientException;\n+import io.fabric8.kubernetes.client.dsl.base.CustomResourceDefinitionContext;\n+import org.apache.camel.Exchange;\n+import org.apache.camel.Message;\n+import org.apache.camel.component.kubernetes.AbstractKubernetesEndpoint;\n+import org.apache.camel.component.kubernetes.KubernetesConstants;\n+import org.apache.camel.component.kubernetes.KubernetesOperations;\n+import org.apache.camel.support.DefaultProducer;\n+import org.apache.camel.support.MessageHelper;\n+import org.apache.camel.util.ObjectHelper;\n+import org.apache.camel.util.json.JsonArray;\n+import org.apache.camel.util.json.JsonObject;\n+import org.slf4j.Logger;\n+import org.slf4j.LoggerFactory;\n+\n+public class KubernetesCustomResourcesProducer extends DefaultProducer {\n+\n+    private static final Logger LOG = LoggerFactory.getLogger(KubernetesCustomResourcesProducer.class);\n+\n+    public KubernetesCustomResourcesProducer(AbstractKubernetesEndpoint endpoint) {\n+        super(endpoint);\n+    }\n+\n+    @Override\n+    public AbstractKubernetesEndpoint getEndpoint() {\n+        return (AbstractKubernetesEndpoint) super.getEndpoint();\n+    }\n+\n+    @Override\n+    public void process(Exchange exchange) throws Exception {\n+        String operation;\n+        String namespace;\n+\n+        if (ObjectHelper.isEmpty(getEndpoint().getKubernetesConfiguration().getOperation())) {\n+            operation = exchange.getIn().getHeader(KubernetesConstants.KUBERNETES_OPERATION, String.class);\n+        } else {\n+            operation = getEndpoint().getKubernetesConfiguration().getOperation();\n+        }\n+        if (ObjectHelper.isEmpty(getEndpoint().getKubernetesConfiguration().getNamespace())) {\n+            namespace = exchange.getIn().getHeader(KubernetesConstants.KUBERNETES_NAMESPACE_NAME, String.class);\n+        } else {\n+            namespace = getEndpoint().getKubernetesConfiguration().getNamespace();\n+        }\n+        if (ObjectHelper.isEmpty(namespace)) {\n+            throw new IllegalArgumentException(\"Custom Resource producer requires a namespace argument\");\n+        }\n+\n+        switch (operation) {\n+\n+            case KubernetesOperations.LIST_CUSTOMRESOURCES:\n+                doList(exchange, operation);\n+                break;\n+\n+            case KubernetesOperations.LIST_CUSTOMRESOURCES_BY_LABELS_OPERATION:\n+                doListByLabels(exchange, operation);\n+                break;\n+\n+            case KubernetesOperations.GET_CUSTOMRESOURCE:\n+                doGet(exchange, operation);\n+                break;\n+\n+            case KubernetesOperations.DELETE_CUSTOMRESOURCE:\n+                doDelete(exchange, operation);\n+                break;\n+\n+            case KubernetesOperations.CREATE_CUSTOMRESOURCE:\n+                doCreate(exchange, operation);\n+                break;\n+\n+            default:\n+                throw new IllegalArgumentException(\"Unsupported operation \" + operation);\n+        }\n+    }\n+\n+    protected void doList(Exchange exchange, String operation) throws Exception {\n+        String namespaceName = exchange.getIn().getHeader(KubernetesConstants.KUBERNETES_NAMESPACE_NAME, String.class);\n+        JsonObject customResourcesListJSON = new JsonObject(\n+                getEndpoint().getKubernetesClient().customResource(getCRDContext(exchange.getIn())).list(namespaceName));\n+        LOG.info(customResourcesListJSON.toString());\n+\n+        JsonArray customResourcesListItems;\n+        if (customResourcesListJSON.getCollection(\"items\") != null) {\n+            customResourcesListItems = new JsonArray(customResourcesListJSON.getCollection(\"items\"));\n+        } else {\n+            customResourcesListItems = new JsonArray();\n+        }\n+\n+        MessageHelper.copyHeaders(exchange.getIn(), exchange.getOut(), true);\n+        exchange.getOut().setBody(customResourcesListItems);\n+    }\n+\n+    protected void doListByLabels(Exchange exchange, String operation) throws Exception {\n+        String namespaceName = exchange.getIn().getHeader(KubernetesConstants.KUBERNETES_NAMESPACE_NAME, String.class);\n+        Map<String, String> labels = exchange.getIn().getHeader(KubernetesConstants.KUBERNETES_CRD_LABELS, Map.class);\n+        JsonObject customResourcesListJSON = new JsonObject(\n+                getEndpoint().getKubernetesClient().customResource(getCRDContext(exchange.getIn())).list(namespaceName));\n+        LOG.info(customResourcesListJSON.toString());\n+        JsonArray customResourcesListItems = new JsonArray(customResourcesListJSON.getCollection(\"items\"));\n+\n+        MessageHelper.copyHeaders(exchange.getIn(), exchange.getOut(), true);\n+        exchange.getOut().setBody(customResourcesListItems);\n+    }\n+\n+    protected void doGet(Exchange exchange, String operation) throws Exception {\n+        String customResourceName = exchange.getIn().getHeader(KubernetesConstants.KUBERNETES_CRD_INSTANCE_NAME, String.class);\n+        String namespaceName = exchange.getIn().getHeader(KubernetesConstants.KUBERNETES_NAMESPACE_NAME, String.class);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "54b3fd3e5ff7558d3d579a3f30d122336fdcaddd"}, "originalPosition": 126}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTIyMjczNTQ0", "url": "https://github.com/apache/camel/pull/4541#pullrequestreview-522273544", "createdAt": "2020-11-03T08:34:56Z", "commit": {"oid": "54b3fd3e5ff7558d3d579a3f30d122336fdcaddd"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wM1QwODozNDo1NlrOHskY9w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wM1QwODozNDo1NlrOHskY9w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNjQ5NTYwNw==", "bodyText": "I think this check here is not needed since you are already checking for the namespace in the process method", "url": "https://github.com/apache/camel/pull/4541#discussion_r516495607", "createdAt": "2020-11-03T08:34:56Z", "author": {"login": "omarsmak"}, "path": "components/camel-kubernetes/src/main/java/org/apache/camel/component/kubernetes/customresources/KubernetesCustomResourcesProducer.java", "diffHunk": "@@ -0,0 +1,245 @@\n+/*\n+ * Licensed to the Apache Software Foundation (ASF) under one or more\n+ * contributor license agreements.  See the NOTICE file distributed with\n+ * this work for additional information regarding copyright ownership.\n+ * The ASF licenses this file to You under the Apache License, Version 2.0\n+ * (the \"License\"); you may not use this file except in compliance with\n+ * the License.  You may obtain a copy of the License at\n+ *\n+ *      http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+package org.apache.camel.component.kubernetes.customresources;\n+\n+import java.util.Map;\n+\n+import io.fabric8.kubernetes.client.KubernetesClientException;\n+import io.fabric8.kubernetes.client.dsl.base.CustomResourceDefinitionContext;\n+import org.apache.camel.Exchange;\n+import org.apache.camel.Message;\n+import org.apache.camel.component.kubernetes.AbstractKubernetesEndpoint;\n+import org.apache.camel.component.kubernetes.KubernetesConstants;\n+import org.apache.camel.component.kubernetes.KubernetesOperations;\n+import org.apache.camel.support.DefaultProducer;\n+import org.apache.camel.support.MessageHelper;\n+import org.apache.camel.util.ObjectHelper;\n+import org.apache.camel.util.json.JsonArray;\n+import org.apache.camel.util.json.JsonObject;\n+import org.slf4j.Logger;\n+import org.slf4j.LoggerFactory;\n+\n+public class KubernetesCustomResourcesProducer extends DefaultProducer {\n+\n+    private static final Logger LOG = LoggerFactory.getLogger(KubernetesCustomResourcesProducer.class);\n+\n+    public KubernetesCustomResourcesProducer(AbstractKubernetesEndpoint endpoint) {\n+        super(endpoint);\n+    }\n+\n+    @Override\n+    public AbstractKubernetesEndpoint getEndpoint() {\n+        return (AbstractKubernetesEndpoint) super.getEndpoint();\n+    }\n+\n+    @Override\n+    public void process(Exchange exchange) throws Exception {\n+        String operation;\n+        String namespace;\n+\n+        if (ObjectHelper.isEmpty(getEndpoint().getKubernetesConfiguration().getOperation())) {\n+            operation = exchange.getIn().getHeader(KubernetesConstants.KUBERNETES_OPERATION, String.class);\n+        } else {\n+            operation = getEndpoint().getKubernetesConfiguration().getOperation();\n+        }\n+        if (ObjectHelper.isEmpty(getEndpoint().getKubernetesConfiguration().getNamespace())) {\n+            namespace = exchange.getIn().getHeader(KubernetesConstants.KUBERNETES_NAMESPACE_NAME, String.class);\n+        } else {\n+            namespace = getEndpoint().getKubernetesConfiguration().getNamespace();\n+        }\n+        if (ObjectHelper.isEmpty(namespace)) {\n+            throw new IllegalArgumentException(\"Custom Resource producer requires a namespace argument\");\n+        }\n+\n+        switch (operation) {\n+\n+            case KubernetesOperations.LIST_CUSTOMRESOURCES:\n+                doList(exchange, operation);\n+                break;\n+\n+            case KubernetesOperations.LIST_CUSTOMRESOURCES_BY_LABELS_OPERATION:\n+                doListByLabels(exchange, operation);\n+                break;\n+\n+            case KubernetesOperations.GET_CUSTOMRESOURCE:\n+                doGet(exchange, operation);\n+                break;\n+\n+            case KubernetesOperations.DELETE_CUSTOMRESOURCE:\n+                doDelete(exchange, operation);\n+                break;\n+\n+            case KubernetesOperations.CREATE_CUSTOMRESOURCE:\n+                doCreate(exchange, operation);\n+                break;\n+\n+            default:\n+                throw new IllegalArgumentException(\"Unsupported operation \" + operation);\n+        }\n+    }\n+\n+    protected void doList(Exchange exchange, String operation) throws Exception {\n+        String namespaceName = exchange.getIn().getHeader(KubernetesConstants.KUBERNETES_NAMESPACE_NAME, String.class);\n+        JsonObject customResourcesListJSON = new JsonObject(\n+                getEndpoint().getKubernetesClient().customResource(getCRDContext(exchange.getIn())).list(namespaceName));\n+        LOG.info(customResourcesListJSON.toString());\n+\n+        JsonArray customResourcesListItems;\n+        if (customResourcesListJSON.getCollection(\"items\") != null) {\n+            customResourcesListItems = new JsonArray(customResourcesListJSON.getCollection(\"items\"));\n+        } else {\n+            customResourcesListItems = new JsonArray();\n+        }\n+\n+        MessageHelper.copyHeaders(exchange.getIn(), exchange.getOut(), true);\n+        exchange.getOut().setBody(customResourcesListItems);\n+    }\n+\n+    protected void doListByLabels(Exchange exchange, String operation) throws Exception {\n+        String namespaceName = exchange.getIn().getHeader(KubernetesConstants.KUBERNETES_NAMESPACE_NAME, String.class);\n+        Map<String, String> labels = exchange.getIn().getHeader(KubernetesConstants.KUBERNETES_CRD_LABELS, Map.class);\n+        JsonObject customResourcesListJSON = new JsonObject(\n+                getEndpoint().getKubernetesClient().customResource(getCRDContext(exchange.getIn())).list(namespaceName));\n+        LOG.info(customResourcesListJSON.toString());\n+        JsonArray customResourcesListItems = new JsonArray(customResourcesListJSON.getCollection(\"items\"));\n+\n+        MessageHelper.copyHeaders(exchange.getIn(), exchange.getOut(), true);\n+        exchange.getOut().setBody(customResourcesListItems);\n+    }\n+\n+    protected void doGet(Exchange exchange, String operation) throws Exception {\n+        String customResourceName = exchange.getIn().getHeader(KubernetesConstants.KUBERNETES_CRD_INSTANCE_NAME, String.class);\n+        String namespaceName = exchange.getIn().getHeader(KubernetesConstants.KUBERNETES_NAMESPACE_NAME, String.class);\n+        if (ObjectHelper.isEmpty(customResourceName)) {\n+            LOG.error(\"Get a specific Deployment require specify a Deployment name\");\n+            throw new IllegalArgumentException(\"Get a specific Deployment require specify a Deployment name\");\n+        }\n+        JsonObject customResourceJSON = new JsonObject();\n+        try {\n+            customResourceJSON = new JsonObject(\n+                    getEndpoint().getKubernetesClient().customResource(getCRDContext(exchange.getIn())).get(namespaceName,\n+                            customResourceName));\n+        } catch (KubernetesClientException e) {\n+            if (e.getCode() == 404) {\n+                LOG.info(\"Custom resource instance not found\", e);\n+            } else {\n+                throw e;\n+            }\n+        }\n+        LOG.info(customResourceJSON.toString());\n+\n+        MessageHelper.copyHeaders(exchange.getIn(), exchange.getOut(), true);\n+        exchange.getOut().setBody(customResourceJSON);\n+    }\n+\n+    protected void doDelete(Exchange exchange, String operation) throws Exception {\n+        String customResourceName = exchange.getIn().getHeader(KubernetesConstants.KUBERNETES_CRD_INSTANCE_NAME, String.class);\n+        String namespaceName = exchange.getIn().getHeader(KubernetesConstants.KUBERNETES_NAMESPACE_NAME, String.class);\n+        if (ObjectHelper.isEmpty(customResourceName)) {\n+            LOG.error(\"Delete a specific deployment require specify a deployment name\");\n+            throw new IllegalArgumentException(\"Delete a specific deployment require specify a deployment name\");\n+        }\n+        if (ObjectHelper.isEmpty(namespaceName)) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "54b3fd3e5ff7558d3d579a3f30d122336fdcaddd"}, "originalPosition": 156}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTIyMjc3MjIy", "url": "https://github.com/apache/camel/pull/4541#pullrequestreview-522277222", "createdAt": "2020-11-03T08:40:29Z", "commit": {"oid": "54b3fd3e5ff7558d3d579a3f30d122336fdcaddd"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "24f01e62ad93d0c0ee7c605d794b70c357c42521", "author": {"user": {"login": "akihikokuroda", "name": "Akihiko (Aki) Kuroda"}}, "url": "https://github.com/apache/camel/commit/24f01e62ad93d0c0ee7c605d794b70c357c42521", "committedDate": "2020-11-03T13:25:27Z", "message": "review comments"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTIyNTY5MDc2", "url": "https://github.com/apache/camel/pull/4541#pullrequestreview-522569076", "createdAt": "2020-11-03T14:46:36Z", "commit": {"oid": "24f01e62ad93d0c0ee7c605d794b70c357c42521"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2811, "cost": 1, "resetAt": "2021-10-29T17:30:11Z"}}}