{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDA1MjIxNzE4", "number": 529, "title": "Add openid connect quickstart test", "bodyText": "Fixes #355\nCheck list:\nYour pull request:\n\n targets the development branch\n uses the 999-SNAPSHOT version of Quarkus\n has tests (mvn clean test)\n works in native (mvn clean package -Pnative)\n has native tests (mvn clean verify -Pnative)\n makes sure the documentation must not be updated\n links the documentation update pull request (if needed)\n updates or creates the README.md file (with build and run instructions)\n\nI would also enjoy improving the documentation for oauth2 mentioned in  #521", "createdAt": "2020-04-17T16:13:13Z", "url": "https://github.com/quarkusio/quarkus-quickstarts/pull/529", "merged": true, "mergeCommit": {"oid": "df79548d95f1feac606085564ba4b3131974733e"}, "closed": true, "closedAt": "2020-10-14T12:21:10Z", "author": {"login": "cemnura"}, "timelineItems": {"totalCount": 13, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcZFHctgFqTM5NTk4NDU4NQ==", "endCursor": "Y3Vyc29yOnYyOpPPAAABdScOZEAFqTUwODI4NTUxMQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzk1OTg0NTg1", "url": "https://github.com/quarkusio/quarkus-quickstarts/pull/529#pullrequestreview-395984585", "createdAt": "2020-04-19T07:06:53Z", "commit": {"oid": "04bead224a4764e09a1230685776e9b98467d2b4"}, "state": "DISMISSED", "comments": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0xOVQwNzowNjo1NFrOGHzdIA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0xOVQwNzoxMDoxNlrOGHzfFQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMDgzNjI1Ng==", "bodyText": "Wondering if this property can use a random port (and set by a Quarkus Test Resource)", "url": "https://github.com/quarkusio/quarkus-quickstarts/pull/529#discussion_r410836256", "createdAt": "2020-04-19T07:06:54Z", "author": {"login": "cescoffier"}, "path": "security-oauth2-quickstart/src/main/resources/application.properties", "diffHunk": "@@ -1,3 +1,4 @@\n-quarkus.oauth2.client-id=client_id\n+quarkus.oauth2.enabled=true\n+quarkus.oauth2.client-id=backend-service\n quarkus.oauth2.client-secret=secret\n-quarkus.oauth2.introspection-url=http://oauth-server/introspect\n\\ No newline at end of file\n+quarkus.oauth2.introspection-url=http://localhost:8180/auth/realms/quarkus/protocol/openid-connect/token/introspect", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "04bead224a4764e09a1230685776e9b98467d2b4"}, "originalPosition": 7}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMDgzNjQ4MQ==", "bodyText": "So we cannot use TestContainer like this, as the lifecycle is different from the Quarkus lifecycle.\nYou need to use a Quarkus Test Resource, and BTW, it will also let you set some properties dynamically.\nCheck how the Kafka quickstart is built as an example.", "url": "https://github.com/quarkusio/quarkus-quickstarts/pull/529#discussion_r410836481", "createdAt": "2020-04-19T07:08:19Z", "author": {"login": "cescoffier"}, "path": "security-oauth2-quickstart/src/test/java/org/acme/security/oauth2/TokenSecuredResourceTest.java", "diffHunk": "@@ -0,0 +1,76 @@\n+package org.acme.security.oauth2;\n+\n+import io.quarkus.test.junit.QuarkusTest;\n+import io.restassured.RestAssured;\n+import org.junit.ClassRule;\n+import org.junit.jupiter.api.Test;\n+import org.testcontainers.containers.BindMode;\n+import org.testcontainers.containers.FixedHostPortGenericContainer;\n+import org.testcontainers.containers.GenericContainer;\n+import org.testcontainers.containers.wait.strategy.Wait;\n+import org.testcontainers.junit.jupiter.Container;\n+import org.testcontainers.junit.jupiter.Testcontainers;\n+\n+@Testcontainers\n+@QuarkusTest\n+public class TokenSecuredResourceTest {\n+\n+    private static final String KEYCLOAK_SERVER_URL = System.getProperty(\"keycloak.url\", \"http://localhost:8180/auth\");", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "04bead224a4764e09a1230685776e9b98467d2b4"}, "originalPosition": 18}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMDgzNjYyOQ==", "bodyText": "This should be moved to a Quarkus Test Resources, and probably bound to a free port.\nAlso, I'm surprised about @ClassRule as it's a Junit 4 annotation.", "url": "https://github.com/quarkusio/quarkus-quickstarts/pull/529#discussion_r410836629", "createdAt": "2020-04-19T07:09:18Z", "author": {"login": "cescoffier"}, "path": "security-oauth2-quickstart/src/test/java/org/acme/security/oauth2/TokenSecuredResourceTest.java", "diffHunk": "@@ -0,0 +1,76 @@\n+package org.acme.security.oauth2;\n+\n+import io.quarkus.test.junit.QuarkusTest;\n+import io.restassured.RestAssured;\n+import org.junit.ClassRule;\n+import org.junit.jupiter.api.Test;\n+import org.testcontainers.containers.BindMode;\n+import org.testcontainers.containers.FixedHostPortGenericContainer;\n+import org.testcontainers.containers.GenericContainer;\n+import org.testcontainers.containers.wait.strategy.Wait;\n+import org.testcontainers.junit.jupiter.Container;\n+import org.testcontainers.junit.jupiter.Testcontainers;\n+\n+@Testcontainers\n+@QuarkusTest\n+public class TokenSecuredResourceTest {\n+\n+    private static final String KEYCLOAK_SERVER_URL = System.getProperty(\"keycloak.url\", \"http://localhost:8180/auth\");\n+    private static final String KEYCLOAK_REALM = \"quarkus\";\n+\n+    @ClassRule\n+    @Container\n+    private static GenericContainer keycloak = new FixedHostPortGenericContainer(\"quay.io/keycloak/keycloak:9.0.3\")", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "04bead224a4764e09a1230685776e9b98467d2b4"}, "originalPosition": 23}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMDgzNjc1Nw==", "bodyText": "What the goal of this file?", "url": "https://github.com/quarkusio/quarkus-quickstarts/pull/529#discussion_r410836757", "createdAt": "2020-04-19T07:10:16Z", "author": {"login": "cescoffier"}, "path": "security-oauth2-quickstart/src/test/resources/.notes", "diffHunk": "@@ -0,0 +1,66 @@\n+curl -X POST \\", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "04bead224a4764e09a1230685776e9b98467d2b4"}, "originalPosition": 1}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "04bead224a4764e09a1230685776e9b98467d2b4", "author": {"user": {"login": "cemnura", "name": "Cem Nura"}}, "url": "https://github.com/quarkusio/quarkus-quickstarts/commit/04bead224a4764e09a1230685776e9b98467d2b4", "committedDate": "2020-04-17T15:47:48Z", "message": "Added test for security-oauth2-quickstart\n\nSigned-off-by: Cem Nura <cem.nura@gmail.com>"}, "afterCommit": {"oid": "a71bc157aea5662057235d503ef7bc1e761e0579", "author": {"user": {"login": "cemnura", "name": "Cem Nura"}}, "url": "https://github.com/quarkusio/quarkus-quickstarts/commit/a71bc157aea5662057235d503ef7bc1e761e0579", "committedDate": "2020-04-20T08:58:36Z", "message": "Added test for security-oauth2-quickstart\n\nSigned-off-by: Cem Nura <cem.nura@gmail.com>"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "a71bc157aea5662057235d503ef7bc1e761e0579", "author": {"user": {"login": "cemnura", "name": "Cem Nura"}}, "url": "https://github.com/quarkusio/quarkus-quickstarts/commit/a71bc157aea5662057235d503ef7bc1e761e0579", "committedDate": "2020-04-20T08:58:36Z", "message": "Added test for security-oauth2-quickstart\n\nSigned-off-by: Cem Nura <cem.nura@gmail.com>"}, "afterCommit": {"oid": "156a80d7f3a07e04b2c06d2aa9e11d88efad2960", "author": {"user": {"login": "cemnura", "name": "Cem Nura"}}, "url": "https://github.com/quarkusio/quarkus-quickstarts/commit/156a80d7f3a07e04b2c06d2aa9e11d88efad2960", "committedDate": "2020-04-20T18:33:41Z", "message": "Added test for security-oauth2-quickstart\n\nSigned-off-by: Cem Nura <cem.nura@gmail.com>"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "156a80d7f3a07e04b2c06d2aa9e11d88efad2960", "author": {"user": {"login": "cemnura", "name": "Cem Nura"}}, "url": "https://github.com/quarkusio/quarkus-quickstarts/commit/156a80d7f3a07e04b2c06d2aa9e11d88efad2960", "committedDate": "2020-04-20T18:33:41Z", "message": "Added test for security-oauth2-quickstart\n\nSigned-off-by: Cem Nura <cem.nura@gmail.com>"}, "afterCommit": {"oid": "c66b83b5aaf1cba3353dc99ef4e0fdf416653346", "author": {"user": {"login": "cemnura", "name": "Cem Nura"}}, "url": "https://github.com/quarkusio/quarkus-quickstarts/commit/c66b83b5aaf1cba3353dc99ef4e0fdf416653346", "committedDate": "2020-10-10T21:25:21Z", "message": "Added openid connect quickstart test\n\nSigned-off-by: Cem Nura <cem.nura@gmail.com>"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "c66b83b5aaf1cba3353dc99ef4e0fdf416653346", "author": {"user": {"login": "cemnura", "name": "Cem Nura"}}, "url": "https://github.com/quarkusio/quarkus-quickstarts/commit/c66b83b5aaf1cba3353dc99ef4e0fdf416653346", "committedDate": "2020-10-10T21:25:21Z", "message": "Added openid connect quickstart test\n\nSigned-off-by: Cem Nura <cem.nura@gmail.com>"}, "afterCommit": {"oid": "7366b62f104951d73a4a7cd8583bed665a5c5412", "author": {"user": {"login": "cemnura", "name": "Cem Nura"}}, "url": "https://github.com/quarkusio/quarkus-quickstarts/commit/7366b62f104951d73a4a7cd8583bed665a5c5412", "committedDate": "2020-10-10T21:31:24Z", "message": "Added openid connect quickstart test\n\nSigned-off-by: Cem Nura <cem.nura@gmail.com>"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTA2MTI3NjM3", "url": "https://github.com/quarkusio/quarkus-quickstarts/pull/529#pullrequestreview-506127637", "createdAt": "2020-10-10T21:30:51Z", "commit": {"oid": "c66b83b5aaf1cba3353dc99ef4e0fdf416653346"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xMFQyMTozMDo1MlrOHfiksg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xMFQyMTozMDo1MlrOHfiksg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMjgzNDM1NA==", "bodyText": "@sberyozkin  This is a demo Keycloak mock server using WireMock for evaluation. Is missing protocol/openid-connect/token path mock.", "url": "https://github.com/quarkusio/quarkus-quickstarts/pull/529#discussion_r502834354", "createdAt": "2020-10-10T21:30:52Z", "author": {"login": "cemnura"}, "path": "security-openid-connect-quickstart/src/test/java/org/acme/security/openid/connect/KeycloakTestResource.java", "diffHunk": "@@ -0,0 +1,92 @@\n+package org.acme.security.openid.connect;\n+\n+import com.github.tomakehurst.wiremock.WireMockServer;\n+import com.github.tomakehurst.wiremock.client.WireMock;\n+import io.quarkus.test.common.QuarkusTestResourceLifecycleManager;\n+\n+import javax.ws.rs.core.MediaType;\n+import java.util.Collections;\n+import java.util.Map;\n+\n+import static com.github.tomakehurst.wiremock.client.WireMock.aResponse;\n+import static com.github.tomakehurst.wiremock.client.WireMock.get;\n+import static com.github.tomakehurst.wiremock.client.WireMock.post;\n+import static com.github.tomakehurst.wiremock.client.WireMock.stubFor;\n+import static com.github.tomakehurst.wiremock.client.WireMock.urlEqualTo;\n+import static com.github.tomakehurst.wiremock.core.WireMockConfiguration.options;\n+\n+public class KeycloakTestResource implements QuarkusTestResourceLifecycleManager {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c66b83b5aaf1cba3353dc99ef4e0fdf416653346"}, "originalPosition": 18}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "7366b62f104951d73a4a7cd8583bed665a5c5412", "author": {"user": {"login": "cemnura", "name": "Cem Nura"}}, "url": "https://github.com/quarkusio/quarkus-quickstarts/commit/7366b62f104951d73a4a7cd8583bed665a5c5412", "committedDate": "2020-10-10T21:31:24Z", "message": "Added openid connect quickstart test\n\nSigned-off-by: Cem Nura <cem.nura@gmail.com>"}, "afterCommit": {"oid": "c2d0cb2643dbcca986b8466281173baf588a350b", "author": {"user": {"login": "cemnura", "name": "Cem Nura"}}, "url": "https://github.com/quarkusio/quarkus-quickstarts/commit/c2d0cb2643dbcca986b8466281173baf588a350b", "committedDate": "2020-10-12T21:18:24Z", "message": "Added openid connect quickstart test\n\nSigned-off-by: Cem Nura <cem.nura@gmail.com>"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTA3NjIyMTA2", "url": "https://github.com/quarkusio/quarkus-quickstarts/pull/529#pullrequestreview-507622106", "createdAt": "2020-10-13T16:27:41Z", "commit": {"oid": "c2d0cb2643dbcca986b8466281173baf588a350b"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xM1QxNjoyNzo0MVrOHgvXLg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xM1QxNjoyNzo0MVrOHgvXLg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNDA5MjQ2Mg==", "bodyText": "@cemnura Can you please have a single test class (say BearerTokenAuthenticationTest) combining both admin and user resources tests - to have KC started and stopped once and avoid some instability.", "url": "https://github.com/quarkusio/quarkus-quickstarts/pull/529#discussion_r504092462", "createdAt": "2020-10-13T16:27:41Z", "author": {"login": "sberyozkin"}, "path": "security-openid-connect-quickstart/src/test/java/org/acme/security/openid/connect/UsersResourceTest.java", "diffHunk": "@@ -0,0 +1,43 @@\n+package org.acme.security.openid.connect;\n+\n+import io.quarkus.test.common.QuarkusTestResource;\n+import io.quarkus.test.junit.QuarkusTest;\n+import io.restassured.RestAssured;\n+import org.eclipse.microprofile.config.inject.ConfigProperty;\n+import org.junit.jupiter.api.Test;\n+\n+@QuarkusTest\n+@QuarkusTestResource(KeycloakServer.class)\n+public class UsersResourceTest {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c2d0cb2643dbcca986b8466281173baf588a350b"}, "originalPosition": 11}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "c2d0cb2643dbcca986b8466281173baf588a350b", "author": {"user": {"login": "cemnura", "name": "Cem Nura"}}, "url": "https://github.com/quarkusio/quarkus-quickstarts/commit/c2d0cb2643dbcca986b8466281173baf588a350b", "committedDate": "2020-10-12T21:18:24Z", "message": "Added openid connect quickstart test\n\nSigned-off-by: Cem Nura <cem.nura@gmail.com>"}, "afterCommit": {"oid": "d4b2ff1a2bf620f350c105f233a56eb9fb79c371", "author": {"user": {"login": "cemnura", "name": "Cem Nura"}}, "url": "https://github.com/quarkusio/quarkus-quickstarts/commit/d4b2ff1a2bf620f350c105f233a56eb9fb79c371", "committedDate": "2020-10-13T22:15:30Z", "message": "Added openid connect quickstart test\n\nSigned-off-by: Cem Nura <cem.nura@gmail.com>"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "d4b2ff1a2bf620f350c105f233a56eb9fb79c371", "author": {"user": {"login": "cemnura", "name": "Cem Nura"}}, "url": "https://github.com/quarkusio/quarkus-quickstarts/commit/d4b2ff1a2bf620f350c105f233a56eb9fb79c371", "committedDate": "2020-10-13T22:15:30Z", "message": "Added openid connect quickstart test\n\nSigned-off-by: Cem Nura <cem.nura@gmail.com>"}, "afterCommit": {"oid": "7571170100331b7067471e8adde056327cc5d61e", "author": {"user": {"login": "cemnura", "name": "Cem Nura"}}, "url": "https://github.com/quarkusio/quarkus-quickstarts/commit/7571170100331b7067471e8adde056327cc5d61e", "committedDate": "2020-10-14T11:18:33Z", "message": "Added openid connect quickstart test\n\nSigned-off-by: Cem Nura <cem.nura@gmail.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "40cdf9d981918d1b9787da242d3816831314519f", "author": {"user": {"login": "cemnura", "name": "Cem Nura"}}, "url": "https://github.com/quarkusio/quarkus-quickstarts/commit/40cdf9d981918d1b9787da242d3816831314519f", "committedDate": "2020-10-14T11:24:01Z", "message": "Added openid connect quickstart test\n\nSigned-off-by: Cem Nura <cem.nura@gmail.com>"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "7571170100331b7067471e8adde056327cc5d61e", "author": {"user": {"login": "cemnura", "name": "Cem Nura"}}, "url": "https://github.com/quarkusio/quarkus-quickstarts/commit/7571170100331b7067471e8adde056327cc5d61e", "committedDate": "2020-10-14T11:18:33Z", "message": "Added openid connect quickstart test\n\nSigned-off-by: Cem Nura <cem.nura@gmail.com>"}, "afterCommit": {"oid": "40cdf9d981918d1b9787da242d3816831314519f", "author": {"user": {"login": "cemnura", "name": "Cem Nura"}}, "url": "https://github.com/quarkusio/quarkus-quickstarts/commit/40cdf9d981918d1b9787da242d3816831314519f", "committedDate": "2020-10-14T11:24:01Z", "message": "Added openid connect quickstart test\n\nSigned-off-by: Cem Nura <cem.nura@gmail.com>"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTA4Mjg1NTEx", "url": "https://github.com/quarkusio/quarkus-quickstarts/pull/529#pullrequestreview-508285511", "createdAt": "2020-10-14T12:20:56Z", "commit": {"oid": "40cdf9d981918d1b9787da242d3816831314519f"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3447, "cost": 1, "resetAt": "2021-11-01T16:37:27Z"}}}