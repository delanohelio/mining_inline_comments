{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDQzNjUyOTc3", "number": 612, "reviewThreads": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wMlQyMDo1Mjo1N1rOELDN4A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wOVQxMTo0MTowMVrOEM25Gw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjgwMDIyNDk2OnYy", "diffSide": "RIGHT", "path": "hibernate-reactive-quickstart/src/main/java/org/acme/hibernate/reactive/FruitMutinyResource.java", "isResolved": true, "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wMlQyMDo1Mjo1N1rOGscscQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wM1QwODo1MTo1OVrOGspA7A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0OTI2MDY1Nw==", "bodyText": "Could the \"get\" method return Uni<List<Fruit>> rather than needing the toArray conversion?", "url": "https://github.com/quarkusio/quarkus-quickstarts/pull/612#discussion_r449260657", "createdAt": "2020-07-02T20:52:57Z", "author": {"login": "Sanne"}, "path": "hibernate-reactive-quickstart/src/main/java/org/acme/hibernate/reactive/FruitMutinyResource.java", "diffHunk": "@@ -25,65 +25,67 @@\n public class FruitMutinyResource {\n \n     @Inject\n-    Uni<Mutiny.Session> mutinySession;\n+    Mutiny.Session mutinySession;\n \n     @GET\n     public Uni<Fruit[]> get() {\n-        return mutinySession.flatMap( session -> session.createNamedQuery( \"Fruits.findAll\", Fruit.class ).getResultList() )\n-                .map( fruits -> fruits.toArray( new Fruit[fruits.size()] ) );\n+        return mutinySession\n+                .createNamedQuery( \"Fruits.findAll\", Fruit.class ).getResultList()\n+                .onItem().apply( fruits -> fruits.toArray( new Fruit[fruits.size()] ) );", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "43cd1781f8c1cbe4f6d67f8f86119c7452dad02f"}, "originalPosition": 13}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0OTM5NTI3Mw==", "bodyText": "I think I tried and didn't work, I'll have a second look.", "url": "https://github.com/quarkusio/quarkus-quickstarts/pull/612#discussion_r449395273", "createdAt": "2020-07-03T06:17:31Z", "author": {"login": "DavideD"}, "path": "hibernate-reactive-quickstart/src/main/java/org/acme/hibernate/reactive/FruitMutinyResource.java", "diffHunk": "@@ -25,65 +25,67 @@\n public class FruitMutinyResource {\n \n     @Inject\n-    Uni<Mutiny.Session> mutinySession;\n+    Mutiny.Session mutinySession;\n \n     @GET\n     public Uni<Fruit[]> get() {\n-        return mutinySession.flatMap( session -> session.createNamedQuery( \"Fruits.findAll\", Fruit.class ).getResultList() )\n-                .map( fruits -> fruits.toArray( new Fruit[fruits.size()] ) );\n+        return mutinySession\n+                .createNamedQuery( \"Fruits.findAll\", Fruit.class ).getResultList()\n+                .onItem().apply( fruits -> fruits.toArray( new Fruit[fruits.size()] ) );", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0OTI2MDY1Nw=="}, "originalCommit": {"oid": "43cd1781f8c1cbe4f6d67f8f86119c7452dad02f"}, "originalPosition": 13}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0OTQ2MjUwOA==", "bodyText": "Yep, it works with List. Nice.\nI think we should update the ORM test as well: https://github.com/quarkusio/quarkus-quickstarts/blob/development/hibernate-orm-quickstart/src/main/java/org/acme/hibernate/orm/FruitResource.java#L37", "url": "https://github.com/quarkusio/quarkus-quickstarts/pull/612#discussion_r449462508", "createdAt": "2020-07-03T08:51:59Z", "author": {"login": "DavideD"}, "path": "hibernate-reactive-quickstart/src/main/java/org/acme/hibernate/reactive/FruitMutinyResource.java", "diffHunk": "@@ -25,65 +25,67 @@\n public class FruitMutinyResource {\n \n     @Inject\n-    Uni<Mutiny.Session> mutinySession;\n+    Mutiny.Session mutinySession;\n \n     @GET\n     public Uni<Fruit[]> get() {\n-        return mutinySession.flatMap( session -> session.createNamedQuery( \"Fruits.findAll\", Fruit.class ).getResultList() )\n-                .map( fruits -> fruits.toArray( new Fruit[fruits.size()] ) );\n+        return mutinySession\n+                .createNamedQuery( \"Fruits.findAll\", Fruit.class ).getResultList()\n+                .onItem().apply( fruits -> fruits.toArray( new Fruit[fruits.size()] ) );", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0OTI2MDY1Nw=="}, "originalCommit": {"oid": "43cd1781f8c1cbe4f6d67f8f86119c7452dad02f"}, "originalPosition": 13}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjgwMDIyNjAzOnYy", "diffSide": "RIGHT", "path": "hibernate-reactive-quickstart/src/main/java/org/acme/hibernate/reactive/FruitMutinyResource.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wMlQyMDo1MzoyMVrOGsctEA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wMlQyMDo1MzoyMVrOGsctEA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0OTI2MDgxNg==", "bodyText": "great, much better!", "url": "https://github.com/quarkusio/quarkus-quickstarts/pull/612#discussion_r449260816", "createdAt": "2020-07-02T20:53:21Z", "author": {"login": "Sanne"}, "path": "hibernate-reactive-quickstart/src/main/java/org/acme/hibernate/reactive/FruitMutinyResource.java", "diffHunk": "@@ -25,65 +25,67 @@\n public class FruitMutinyResource {\n \n     @Inject\n-    Uni<Mutiny.Session> mutinySession;\n+    Mutiny.Session mutinySession;\n \n     @GET\n     public Uni<Fruit[]> get() {\n-        return mutinySession.flatMap( session -> session.createNamedQuery( \"Fruits.findAll\", Fruit.class ).getResultList() )\n-                .map( fruits -> fruits.toArray( new Fruit[fruits.size()] ) );\n+        return mutinySession\n+                .createNamedQuery( \"Fruits.findAll\", Fruit.class ).getResultList()\n+                .onItem().apply( fruits -> fruits.toArray( new Fruit[fruits.size()] ) );\n     }\n \n     @GET\n     @Path(\"{id}\")\n     public Uni<Fruit> getSingle(@PathParam Integer id) {\n-        return mutinySession\n-                .flatMap( session -> session.find( Fruit.class, id ) );\n+        return mutinySession.find( Fruit.class, id );", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "43cd1781f8c1cbe4f6d67f8f86119c7452dad02f"}, "originalPosition": 21}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjgwMDIzMjU1OnYy", "diffSide": "RIGHT", "path": "hibernate-reactive-quickstart/src/main/java/org/acme/hibernate/reactive/FruitMutinyResource.java", "isResolved": true, "comments": {"totalCount": 7, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wMlQyMDo1NTo1OVrOGscxGw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wM1QwODowMjozOVrOGsniIQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0OTI2MTg1MQ==", "bodyText": "I have to admit that even with help from indentation, it's not clear to me to which element of the chain the \"ifNull\" applies here..", "url": "https://github.com/quarkusio/quarkus-quickstarts/pull/612#discussion_r449261851", "createdAt": "2020-07-02T20:55:59Z", "author": {"login": "Sanne"}, "path": "hibernate-reactive-quickstart/src/main/java/org/acme/hibernate/reactive/FruitMutinyResource.java", "diffHunk": "@@ -25,65 +25,67 @@\n public class FruitMutinyResource {\n \n     @Inject\n-    Uni<Mutiny.Session> mutinySession;\n+    Mutiny.Session mutinySession;\n \n     @GET\n     public Uni<Fruit[]> get() {\n-        return mutinySession.flatMap( session -> session.createNamedQuery( \"Fruits.findAll\", Fruit.class ).getResultList() )\n-                .map( fruits -> fruits.toArray( new Fruit[fruits.size()] ) );\n+        return mutinySession\n+                .createNamedQuery( \"Fruits.findAll\", Fruit.class ).getResultList()\n+                .onItem().apply( fruits -> fruits.toArray( new Fruit[fruits.size()] ) );\n     }\n \n     @GET\n     @Path(\"{id}\")\n     public Uni<Fruit> getSingle(@PathParam Integer id) {\n-        return mutinySession\n-                .flatMap( session -> session.find( Fruit.class, id ) );\n+        return mutinySession.find( Fruit.class, id );\n     }\n \n     @POST\n     public Uni<Response> create(Fruit fruit) {\n         if (fruit.getId() != null) {\n             throw new WebApplicationException(\"Id was invalidly set on request.\", 422);\n         }\n+\n         return mutinySession\n-                .flatMap( session -> session.persist( fruit ) )\n-                .flatMap( session -> session.flush() )\n-                .map( ignore -> Response.ok( fruit ).status( 201 ).build() );\n+                .persist( fruit )\n+                .onItem().produceUni( session -> mutinySession.flush() )\n+                .onItem().apply( ignore -> Response.ok( fruit ).status( 201 ).build() );\n     }\n \n     @PUT\n     @Path(\"{id}\")\n-    public Uni<Fruit>  update(@PathParam Integer id, Fruit fruit) {\n+    public Uni<Response> update(@PathParam Integer id, Fruit fruit) {\n         if (fruit.getName() == null) {\n             throw new WebApplicationException(\"Fruit Name was not set on request.\", 422);\n         }\n \n         return mutinySession\n-                .flatMap( session -> session.find( Fruit.class, id )\n-                        .flatMap( entity -> {\n-                            if (entity == null) {\n-                                throw new WebApplicationException(\"Fruit with id of \" + id + \" does not exist.\", 404);\n-                            }\n-                            entity.setName( fruit.getName() );\n-                            return session.flush()\n-                                    .map( ignore -> entity );\n-                        } )\n-                );\n+                .find( Fruit.class, id )\n+                // Found\n+                .onItem().ifNotNull()\n+                    .produceUni( entity -> {\n+                        entity.setName( fruit.getName() );\n+                        return mutinySession.flush()\n+                                .onItem().apply( ignore -> Response.ok( entity ).build() );\n+                    } )\n+                // Not found\n+                .onItem().ifNull()", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "43cd1781f8c1cbe4f6d67f8f86119c7452dad02f"}, "originalPosition": 67}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0OTM5NjE1MQ==", "bodyText": "What do you think it apply to?", "url": "https://github.com/quarkusio/quarkus-quickstarts/pull/612#discussion_r449396151", "createdAt": "2020-07-03T06:20:24Z", "author": {"login": "DavideD"}, "path": "hibernate-reactive-quickstart/src/main/java/org/acme/hibernate/reactive/FruitMutinyResource.java", "diffHunk": "@@ -25,65 +25,67 @@\n public class FruitMutinyResource {\n \n     @Inject\n-    Uni<Mutiny.Session> mutinySession;\n+    Mutiny.Session mutinySession;\n \n     @GET\n     public Uni<Fruit[]> get() {\n-        return mutinySession.flatMap( session -> session.createNamedQuery( \"Fruits.findAll\", Fruit.class ).getResultList() )\n-                .map( fruits -> fruits.toArray( new Fruit[fruits.size()] ) );\n+        return mutinySession\n+                .createNamedQuery( \"Fruits.findAll\", Fruit.class ).getResultList()\n+                .onItem().apply( fruits -> fruits.toArray( new Fruit[fruits.size()] ) );\n     }\n \n     @GET\n     @Path(\"{id}\")\n     public Uni<Fruit> getSingle(@PathParam Integer id) {\n-        return mutinySession\n-                .flatMap( session -> session.find( Fruit.class, id ) );\n+        return mutinySession.find( Fruit.class, id );\n     }\n \n     @POST\n     public Uni<Response> create(Fruit fruit) {\n         if (fruit.getId() != null) {\n             throw new WebApplicationException(\"Id was invalidly set on request.\", 422);\n         }\n+\n         return mutinySession\n-                .flatMap( session -> session.persist( fruit ) )\n-                .flatMap( session -> session.flush() )\n-                .map( ignore -> Response.ok( fruit ).status( 201 ).build() );\n+                .persist( fruit )\n+                .onItem().produceUni( session -> mutinySession.flush() )\n+                .onItem().apply( ignore -> Response.ok( fruit ).status( 201 ).build() );\n     }\n \n     @PUT\n     @Path(\"{id}\")\n-    public Uni<Fruit>  update(@PathParam Integer id, Fruit fruit) {\n+    public Uni<Response> update(@PathParam Integer id, Fruit fruit) {\n         if (fruit.getName() == null) {\n             throw new WebApplicationException(\"Fruit Name was not set on request.\", 422);\n         }\n \n         return mutinySession\n-                .flatMap( session -> session.find( Fruit.class, id )\n-                        .flatMap( entity -> {\n-                            if (entity == null) {\n-                                throw new WebApplicationException(\"Fruit with id of \" + id + \" does not exist.\", 404);\n-                            }\n-                            entity.setName( fruit.getName() );\n-                            return session.flush()\n-                                    .map( ignore -> entity );\n-                        } )\n-                );\n+                .find( Fruit.class, id )\n+                // Found\n+                .onItem().ifNotNull()\n+                    .produceUni( entity -> {\n+                        entity.setName( fruit.getName() );\n+                        return mutinySession.flush()\n+                                .onItem().apply( ignore -> Response.ok( entity ).build() );\n+                    } )\n+                // Not found\n+                .onItem().ifNull()", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0OTI2MTg1MQ=="}, "originalCommit": {"oid": "43cd1781f8c1cbe4f6d67f8f86119c7452dad02f"}, "originalPosition": 67}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0OTQwMDkyNQ==", "bodyText": "What do you think it apply to?\n\nI just realized that I might sound more confrontational than I intended. I'm just trying to understand what you find confusing so that I can think of a better approach", "url": "https://github.com/quarkusio/quarkus-quickstarts/pull/612#discussion_r449400925", "createdAt": "2020-07-03T06:35:00Z", "author": {"login": "DavideD"}, "path": "hibernate-reactive-quickstart/src/main/java/org/acme/hibernate/reactive/FruitMutinyResource.java", "diffHunk": "@@ -25,65 +25,67 @@\n public class FruitMutinyResource {\n \n     @Inject\n-    Uni<Mutiny.Session> mutinySession;\n+    Mutiny.Session mutinySession;\n \n     @GET\n     public Uni<Fruit[]> get() {\n-        return mutinySession.flatMap( session -> session.createNamedQuery( \"Fruits.findAll\", Fruit.class ).getResultList() )\n-                .map( fruits -> fruits.toArray( new Fruit[fruits.size()] ) );\n+        return mutinySession\n+                .createNamedQuery( \"Fruits.findAll\", Fruit.class ).getResultList()\n+                .onItem().apply( fruits -> fruits.toArray( new Fruit[fruits.size()] ) );\n     }\n \n     @GET\n     @Path(\"{id}\")\n     public Uni<Fruit> getSingle(@PathParam Integer id) {\n-        return mutinySession\n-                .flatMap( session -> session.find( Fruit.class, id ) );\n+        return mutinySession.find( Fruit.class, id );\n     }\n \n     @POST\n     public Uni<Response> create(Fruit fruit) {\n         if (fruit.getId() != null) {\n             throw new WebApplicationException(\"Id was invalidly set on request.\", 422);\n         }\n+\n         return mutinySession\n-                .flatMap( session -> session.persist( fruit ) )\n-                .flatMap( session -> session.flush() )\n-                .map( ignore -> Response.ok( fruit ).status( 201 ).build() );\n+                .persist( fruit )\n+                .onItem().produceUni( session -> mutinySession.flush() )\n+                .onItem().apply( ignore -> Response.ok( fruit ).status( 201 ).build() );\n     }\n \n     @PUT\n     @Path(\"{id}\")\n-    public Uni<Fruit>  update(@PathParam Integer id, Fruit fruit) {\n+    public Uni<Response> update(@PathParam Integer id, Fruit fruit) {\n         if (fruit.getName() == null) {\n             throw new WebApplicationException(\"Fruit Name was not set on request.\", 422);\n         }\n \n         return mutinySession\n-                .flatMap( session -> session.find( Fruit.class, id )\n-                        .flatMap( entity -> {\n-                            if (entity == null) {\n-                                throw new WebApplicationException(\"Fruit with id of \" + id + \" does not exist.\", 404);\n-                            }\n-                            entity.setName( fruit.getName() );\n-                            return session.flush()\n-                                    .map( ignore -> entity );\n-                        } )\n-                );\n+                .find( Fruit.class, id )\n+                // Found\n+                .onItem().ifNotNull()\n+                    .produceUni( entity -> {\n+                        entity.setName( fruit.getName() );\n+                        return mutinySession.flush()\n+                                .onItem().apply( ignore -> Response.ok( entity ).build() );\n+                    } )\n+                // Not found\n+                .onItem().ifNull()", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0OTI2MTg1MQ=="}, "originalCommit": {"oid": "43cd1781f8c1cbe4f6d67f8f86119c7452dad02f"}, "originalPosition": 67}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0OTQxNTk5NA==", "bodyText": "Mine was  just a thought about the ifNull API, I'm not sure if there is any thing you can do about it.\nIn particular, it loolks the \"if null\" check could apply on the last produced item: the Response object", "url": "https://github.com/quarkusio/quarkus-quickstarts/pull/612#discussion_r449415994", "createdAt": "2020-07-03T07:14:21Z", "author": {"login": "Sanne"}, "path": "hibernate-reactive-quickstart/src/main/java/org/acme/hibernate/reactive/FruitMutinyResource.java", "diffHunk": "@@ -25,65 +25,67 @@\n public class FruitMutinyResource {\n \n     @Inject\n-    Uni<Mutiny.Session> mutinySession;\n+    Mutiny.Session mutinySession;\n \n     @GET\n     public Uni<Fruit[]> get() {\n-        return mutinySession.flatMap( session -> session.createNamedQuery( \"Fruits.findAll\", Fruit.class ).getResultList() )\n-                .map( fruits -> fruits.toArray( new Fruit[fruits.size()] ) );\n+        return mutinySession\n+                .createNamedQuery( \"Fruits.findAll\", Fruit.class ).getResultList()\n+                .onItem().apply( fruits -> fruits.toArray( new Fruit[fruits.size()] ) );\n     }\n \n     @GET\n     @Path(\"{id}\")\n     public Uni<Fruit> getSingle(@PathParam Integer id) {\n-        return mutinySession\n-                .flatMap( session -> session.find( Fruit.class, id ) );\n+        return mutinySession.find( Fruit.class, id );\n     }\n \n     @POST\n     public Uni<Response> create(Fruit fruit) {\n         if (fruit.getId() != null) {\n             throw new WebApplicationException(\"Id was invalidly set on request.\", 422);\n         }\n+\n         return mutinySession\n-                .flatMap( session -> session.persist( fruit ) )\n-                .flatMap( session -> session.flush() )\n-                .map( ignore -> Response.ok( fruit ).status( 201 ).build() );\n+                .persist( fruit )\n+                .onItem().produceUni( session -> mutinySession.flush() )\n+                .onItem().apply( ignore -> Response.ok( fruit ).status( 201 ).build() );\n     }\n \n     @PUT\n     @Path(\"{id}\")\n-    public Uni<Fruit>  update(@PathParam Integer id, Fruit fruit) {\n+    public Uni<Response> update(@PathParam Integer id, Fruit fruit) {\n         if (fruit.getName() == null) {\n             throw new WebApplicationException(\"Fruit Name was not set on request.\", 422);\n         }\n \n         return mutinySession\n-                .flatMap( session -> session.find( Fruit.class, id )\n-                        .flatMap( entity -> {\n-                            if (entity == null) {\n-                                throw new WebApplicationException(\"Fruit with id of \" + id + \" does not exist.\", 404);\n-                            }\n-                            entity.setName( fruit.getName() );\n-                            return session.flush()\n-                                    .map( ignore -> entity );\n-                        } )\n-                );\n+                .find( Fruit.class, id )\n+                // Found\n+                .onItem().ifNotNull()\n+                    .produceUni( entity -> {\n+                        entity.setName( fruit.getName() );\n+                        return mutinySession.flush()\n+                                .onItem().apply( ignore -> Response.ok( entity ).build() );\n+                    } )\n+                // Not found\n+                .onItem().ifNull()", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0OTI2MTg1MQ=="}, "originalCommit": {"oid": "43cd1781f8c1cbe4f6d67f8f86119c7452dad02f"}, "originalPosition": 67}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0OTQyNTQxMw==", "bodyText": "Do you think something like this is less confusing?\n    // Update the entity\n    Function<Fruit, Uni<Response>> update = entity -> {\n        entity.setName(fruit.getName());\n        return mutinySession.flush()\n                .onItem().apply(ignore -> Response.ok( entity ).build());\n    };\n\n    return mutinySession\n            .find( Fruit.class, id )\n                  // If entity exists then\n                .onItem().ifNotNull()\n                    .produceUni(update)\n                // else\n                .onItem().ifNull()\n                    .continueWith(Response.ok().status( 404 ).build());", "url": "https://github.com/quarkusio/quarkus-quickstarts/pull/612#discussion_r449425413", "createdAt": "2020-07-03T07:36:13Z", "author": {"login": "DavideD"}, "path": "hibernate-reactive-quickstart/src/main/java/org/acme/hibernate/reactive/FruitMutinyResource.java", "diffHunk": "@@ -25,65 +25,67 @@\n public class FruitMutinyResource {\n \n     @Inject\n-    Uni<Mutiny.Session> mutinySession;\n+    Mutiny.Session mutinySession;\n \n     @GET\n     public Uni<Fruit[]> get() {\n-        return mutinySession.flatMap( session -> session.createNamedQuery( \"Fruits.findAll\", Fruit.class ).getResultList() )\n-                .map( fruits -> fruits.toArray( new Fruit[fruits.size()] ) );\n+        return mutinySession\n+                .createNamedQuery( \"Fruits.findAll\", Fruit.class ).getResultList()\n+                .onItem().apply( fruits -> fruits.toArray( new Fruit[fruits.size()] ) );\n     }\n \n     @GET\n     @Path(\"{id}\")\n     public Uni<Fruit> getSingle(@PathParam Integer id) {\n-        return mutinySession\n-                .flatMap( session -> session.find( Fruit.class, id ) );\n+        return mutinySession.find( Fruit.class, id );\n     }\n \n     @POST\n     public Uni<Response> create(Fruit fruit) {\n         if (fruit.getId() != null) {\n             throw new WebApplicationException(\"Id was invalidly set on request.\", 422);\n         }\n+\n         return mutinySession\n-                .flatMap( session -> session.persist( fruit ) )\n-                .flatMap( session -> session.flush() )\n-                .map( ignore -> Response.ok( fruit ).status( 201 ).build() );\n+                .persist( fruit )\n+                .onItem().produceUni( session -> mutinySession.flush() )\n+                .onItem().apply( ignore -> Response.ok( fruit ).status( 201 ).build() );\n     }\n \n     @PUT\n     @Path(\"{id}\")\n-    public Uni<Fruit>  update(@PathParam Integer id, Fruit fruit) {\n+    public Uni<Response> update(@PathParam Integer id, Fruit fruit) {\n         if (fruit.getName() == null) {\n             throw new WebApplicationException(\"Fruit Name was not set on request.\", 422);\n         }\n \n         return mutinySession\n-                .flatMap( session -> session.find( Fruit.class, id )\n-                        .flatMap( entity -> {\n-                            if (entity == null) {\n-                                throw new WebApplicationException(\"Fruit with id of \" + id + \" does not exist.\", 404);\n-                            }\n-                            entity.setName( fruit.getName() );\n-                            return session.flush()\n-                                    .map( ignore -> entity );\n-                        } )\n-                );\n+                .find( Fruit.class, id )\n+                // Found\n+                .onItem().ifNotNull()\n+                    .produceUni( entity -> {\n+                        entity.setName( fruit.getName() );\n+                        return mutinySession.flush()\n+                                .onItem().apply( ignore -> Response.ok( entity ).build() );\n+                    } )\n+                // Not found\n+                .onItem().ifNull()", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0OTI2MTg1MQ=="}, "originalCommit": {"oid": "43cd1781f8c1cbe4f6d67f8f86119c7452dad02f"}, "originalPosition": 67}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0OTQyOTUyMQ==", "bodyText": "I guess it's not correct though, this works because update never returns null so the comment is a bit misleading", "url": "https://github.com/quarkusio/quarkus-quickstarts/pull/612#discussion_r449429521", "createdAt": "2020-07-03T07:45:02Z", "author": {"login": "DavideD"}, "path": "hibernate-reactive-quickstart/src/main/java/org/acme/hibernate/reactive/FruitMutinyResource.java", "diffHunk": "@@ -25,65 +25,67 @@\n public class FruitMutinyResource {\n \n     @Inject\n-    Uni<Mutiny.Session> mutinySession;\n+    Mutiny.Session mutinySession;\n \n     @GET\n     public Uni<Fruit[]> get() {\n-        return mutinySession.flatMap( session -> session.createNamedQuery( \"Fruits.findAll\", Fruit.class ).getResultList() )\n-                .map( fruits -> fruits.toArray( new Fruit[fruits.size()] ) );\n+        return mutinySession\n+                .createNamedQuery( \"Fruits.findAll\", Fruit.class ).getResultList()\n+                .onItem().apply( fruits -> fruits.toArray( new Fruit[fruits.size()] ) );\n     }\n \n     @GET\n     @Path(\"{id}\")\n     public Uni<Fruit> getSingle(@PathParam Integer id) {\n-        return mutinySession\n-                .flatMap( session -> session.find( Fruit.class, id ) );\n+        return mutinySession.find( Fruit.class, id );\n     }\n \n     @POST\n     public Uni<Response> create(Fruit fruit) {\n         if (fruit.getId() != null) {\n             throw new WebApplicationException(\"Id was invalidly set on request.\", 422);\n         }\n+\n         return mutinySession\n-                .flatMap( session -> session.persist( fruit ) )\n-                .flatMap( session -> session.flush() )\n-                .map( ignore -> Response.ok( fruit ).status( 201 ).build() );\n+                .persist( fruit )\n+                .onItem().produceUni( session -> mutinySession.flush() )\n+                .onItem().apply( ignore -> Response.ok( fruit ).status( 201 ).build() );\n     }\n \n     @PUT\n     @Path(\"{id}\")\n-    public Uni<Fruit>  update(@PathParam Integer id, Fruit fruit) {\n+    public Uni<Response> update(@PathParam Integer id, Fruit fruit) {\n         if (fruit.getName() == null) {\n             throw new WebApplicationException(\"Fruit Name was not set on request.\", 422);\n         }\n \n         return mutinySession\n-                .flatMap( session -> session.find( Fruit.class, id )\n-                        .flatMap( entity -> {\n-                            if (entity == null) {\n-                                throw new WebApplicationException(\"Fruit with id of \" + id + \" does not exist.\", 404);\n-                            }\n-                            entity.setName( fruit.getName() );\n-                            return session.flush()\n-                                    .map( ignore -> entity );\n-                        } )\n-                );\n+                .find( Fruit.class, id )\n+                // Found\n+                .onItem().ifNotNull()\n+                    .produceUni( entity -> {\n+                        entity.setName( fruit.getName() );\n+                        return mutinySession.flush()\n+                                .onItem().apply( ignore -> Response.ok( entity ).build() );\n+                    } )\n+                // Not found\n+                .onItem().ifNull()", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0OTI2MTg1MQ=="}, "originalCommit": {"oid": "43cd1781f8c1cbe4f6d67f8f86119c7452dad02f"}, "originalPosition": 67}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0OTQzODI0MQ==", "bodyText": "I checked the documentation and this is the way it is supposed to be used so I think we are good: https://smallrye.io/smallrye-mutiny/#_how_do_i_handle_null\nI will extract the function because I think it makes the code more readable.", "url": "https://github.com/quarkusio/quarkus-quickstarts/pull/612#discussion_r449438241", "createdAt": "2020-07-03T08:02:39Z", "author": {"login": "DavideD"}, "path": "hibernate-reactive-quickstart/src/main/java/org/acme/hibernate/reactive/FruitMutinyResource.java", "diffHunk": "@@ -25,65 +25,67 @@\n public class FruitMutinyResource {\n \n     @Inject\n-    Uni<Mutiny.Session> mutinySession;\n+    Mutiny.Session mutinySession;\n \n     @GET\n     public Uni<Fruit[]> get() {\n-        return mutinySession.flatMap( session -> session.createNamedQuery( \"Fruits.findAll\", Fruit.class ).getResultList() )\n-                .map( fruits -> fruits.toArray( new Fruit[fruits.size()] ) );\n+        return mutinySession\n+                .createNamedQuery( \"Fruits.findAll\", Fruit.class ).getResultList()\n+                .onItem().apply( fruits -> fruits.toArray( new Fruit[fruits.size()] ) );\n     }\n \n     @GET\n     @Path(\"{id}\")\n     public Uni<Fruit> getSingle(@PathParam Integer id) {\n-        return mutinySession\n-                .flatMap( session -> session.find( Fruit.class, id ) );\n+        return mutinySession.find( Fruit.class, id );\n     }\n \n     @POST\n     public Uni<Response> create(Fruit fruit) {\n         if (fruit.getId() != null) {\n             throw new WebApplicationException(\"Id was invalidly set on request.\", 422);\n         }\n+\n         return mutinySession\n-                .flatMap( session -> session.persist( fruit ) )\n-                .flatMap( session -> session.flush() )\n-                .map( ignore -> Response.ok( fruit ).status( 201 ).build() );\n+                .persist( fruit )\n+                .onItem().produceUni( session -> mutinySession.flush() )\n+                .onItem().apply( ignore -> Response.ok( fruit ).status( 201 ).build() );\n     }\n \n     @PUT\n     @Path(\"{id}\")\n-    public Uni<Fruit>  update(@PathParam Integer id, Fruit fruit) {\n+    public Uni<Response> update(@PathParam Integer id, Fruit fruit) {\n         if (fruit.getName() == null) {\n             throw new WebApplicationException(\"Fruit Name was not set on request.\", 422);\n         }\n \n         return mutinySession\n-                .flatMap( session -> session.find( Fruit.class, id )\n-                        .flatMap( entity -> {\n-                            if (entity == null) {\n-                                throw new WebApplicationException(\"Fruit with id of \" + id + \" does not exist.\", 404);\n-                            }\n-                            entity.setName( fruit.getName() );\n-                            return session.flush()\n-                                    .map( ignore -> entity );\n-                        } )\n-                );\n+                .find( Fruit.class, id )\n+                // Found\n+                .onItem().ifNotNull()\n+                    .produceUni( entity -> {\n+                        entity.setName( fruit.getName() );\n+                        return mutinySession.flush()\n+                                .onItem().apply( ignore -> Response.ok( entity ).build() );\n+                    } )\n+                // Not found\n+                .onItem().ifNull()", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0OTI2MTg1MQ=="}, "originalCommit": {"oid": "43cd1781f8c1cbe4f6d67f8f86119c7452dad02f"}, "originalPosition": 67}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjgxOTE3NzIzOnYy", "diffSide": "RIGHT", "path": "hibernate-reactive-quickstart/src/main/java/org/acme/hibernate/reactive/FruitMutinyResource.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wOVQxMTo0MTowMVrOGvNYjw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wOVQxMjo1MjoyNlrOGvPu0g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MjE1NTUzNQ==", "bodyText": "This is perhaps the wrong place, but given it's a quickstart to help people.. why isn't this Multi<Fruit> ? Seems like a weird API if it's only a Uni wrapper for normal blocking models instead of real reactive one.", "url": "https://github.com/quarkusio/quarkus-quickstarts/pull/612#discussion_r452155535", "createdAt": "2020-07-09T11:41:01Z", "author": {"login": "burmanm"}, "path": "hibernate-reactive-quickstart/src/main/java/org/acme/hibernate/reactive/FruitMutinyResource.java", "diffHunk": "@@ -23,67 +30,118 @@\n @Produces(\"application/json\")\n @Consumes(\"application/json\")\n public class FruitMutinyResource {\n+    private static final Logger LOGGER = Logger.getLogger(FruitMutinyResource.class.getName());\n \n     @Inject\n-    Uni<Mutiny.Session> mutinySession;\n+    Mutiny.Session mutinySession;\n \n     @GET\n-    public Uni<Fruit[]> get() {\n-        return mutinySession.flatMap( session -> session.createNamedQuery( \"Fruits.findAll\", Fruit.class ).getResultList() )\n-                .map( fruits -> fruits.toArray( new Fruit[fruits.size()] ) );\n+    public Uni<List<Fruit>> get() {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "a2b2c727075f96cd63b5a22e16466244359785a0"}, "originalPosition": 39}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MjE5NDAwMg==", "bodyText": "At the moment, hibernate reactive returns a Uni for reasons described here: hibernate/hibernate-reactive#49\nBut you are right, we could return a Multi in this case. I think I will update the quickstart calling Session#getResults instead", "url": "https://github.com/quarkusio/quarkus-quickstarts/pull/612#discussion_r452194002", "createdAt": "2020-07-09T12:52:26Z", "author": {"login": "DavideD"}, "path": "hibernate-reactive-quickstart/src/main/java/org/acme/hibernate/reactive/FruitMutinyResource.java", "diffHunk": "@@ -23,67 +30,118 @@\n @Produces(\"application/json\")\n @Consumes(\"application/json\")\n public class FruitMutinyResource {\n+    private static final Logger LOGGER = Logger.getLogger(FruitMutinyResource.class.getName());\n \n     @Inject\n-    Uni<Mutiny.Session> mutinySession;\n+    Mutiny.Session mutinySession;\n \n     @GET\n-    public Uni<Fruit[]> get() {\n-        return mutinySession.flatMap( session -> session.createNamedQuery( \"Fruits.findAll\", Fruit.class ).getResultList() )\n-                .map( fruits -> fruits.toArray( new Fruit[fruits.size()] ) );\n+    public Uni<List<Fruit>> get() {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MjE1NTUzNQ=="}, "originalCommit": {"oid": "a2b2c727075f96cd63b5a22e16466244359785a0"}, "originalPosition": 39}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2326, "cost": 1, "resetAt": "2021-11-13T14:23:39Z"}}}