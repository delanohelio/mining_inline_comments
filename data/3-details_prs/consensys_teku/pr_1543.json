{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0Mzk5OTg2NjI4", "number": 1543, "title": "added peers metric", "bodyText": "Signed-off-by: Sally MacFarlane sally.macfarlane@consensys.net\nAdded metric for peers count #1440", "createdAt": "2020-04-07T01:26:02Z", "url": "https://github.com/ConsenSys/teku/pull/1543", "merged": true, "mergeCommit": {"oid": "ea0bd5a38acf37e73759b62b3f6fa23d84508114"}, "closed": true, "closedAt": "2020-04-07T02:20:20Z", "author": {"login": "macfarla"}, "timelineItems": {"totalCount": 8, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcVI9fnAH2gAyMzk5OTg2NjI4OmU1MzhkYmVlMjkzNzE3NTBlODE2YjgyMThkMjIxYzFmZjRlMGY4MjY=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcVJvFcAFqTM4ODc0MTE1Ng==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "e538dbee29371750e816b8218d221c1ff4e0f826", "author": {"user": {"login": "macfarla", "name": "Sally MacFarlane"}}, "url": "https://github.com/ConsenSys/teku/commit/e538dbee29371750e816b8218d221c1ff4e0f826", "committedDate": "2020-04-07T01:24:54Z", "message": "added peers metric\n\nSigned-off-by: Sally MacFarlane <sally.macfarlane@consensys.net>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "4e82f1d5a7b8ff4c21fe9ece8c6de60f595da777", "author": {"user": {"login": "macfarla", "name": "Sally MacFarlane"}}, "url": "https://github.com/ConsenSys/teku/commit/4e82f1d5a7b8ff4c21fe9ece8c6de60f595da777", "committedDate": "2020-04-07T01:28:45Z", "message": "formatting\n\nSigned-off-by: Sally MacFarlane <sally.macfarlane@consensys.net>"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzg4NzI2NjIy", "url": "https://github.com/ConsenSys/teku/pull/1543#pullrequestreview-388726622", "createdAt": "2020-04-07T01:29:00Z", "commit": {"oid": "e538dbee29371750e816b8218d221c1ff4e0f826"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wN1QwMToyOTowMFrOGBvvKw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wN1QwMToyOTowMFrOGBvvKw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNDQ4Mzg4Mw==", "bodyText": "This feels like the wrong approach.  Rather than a settable gauge you could just use the normal gauge and read from getPeerCount() on demand.", "url": "https://github.com/ConsenSys/teku/pull/1543#discussion_r404483883", "createdAt": "2020-04-07T01:29:00Z", "author": {"login": "ajsutton"}, "path": "networking/p2p/src/main/java/tech/pegasys/artemis/networking/p2p/libp2p/PeerManager.java", "diffHunk": "@@ -59,7 +62,12 @@ public PeerManager(\n     this.reputationManager = reputationManager;\n     this.peerHandlers = peerHandlers;\n     this.rpcHandlers = rpcHandlers;\n-    // TODO - add metrics\n+    peerGauge =\n+        SettableGauge.create(\n+            metricsSystem,\n+            ArtemisMetricCategory.NETWORK,\n+            \"libp2p_peers\",\n+            \"Total number of peers\");", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "e538dbee29371750e816b8218d221c1ff4e0f826"}, "originalPosition": 27}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ac9dc5ed147eb47d8963878b157598c5bc5e7225", "author": {"user": {"login": "macfarla", "name": "Sally MacFarlane"}}, "url": "https://github.com/ConsenSys/teku/commit/ac9dc5ed147eb47d8963878b157598c5bc5e7225", "committedDate": "2020-04-07T01:39:44Z", "message": "use regular gauge\n\nSigned-off-by: Sally MacFarlane <sally.macfarlane@consensys.net>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "fe4fd19a2aa15fceeb66f146232f0647a07a0e95", "author": {"user": {"login": "macfarla", "name": "Sally MacFarlane"}}, "url": "https://github.com/ConsenSys/teku/commit/fe4fd19a2aa15fceeb66f146232f0647a07a0e95", "committedDate": "2020-04-07T01:40:57Z", "message": "use regular gauge\n\nSigned-off-by: Sally MacFarlane <sally.macfarlane@consensys.net>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "fd34c7959ab1aaae11b46b945d5a91f98a8393cd", "author": {"user": {"login": "macfarla", "name": "Sally MacFarlane"}}, "url": "https://github.com/ConsenSys/teku/commit/fd34c7959ab1aaae11b46b945d5a91f98a8393cd", "committedDate": "2020-04-07T01:41:44Z", "message": "Merge branch 'peers-metrics' of github.com:macfarla/teku into peers-metrics"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzg4NzM1NjEy", "url": "https://github.com/ConsenSys/teku/pull/1543#pullrequestreview-388735612", "createdAt": "2020-04-07T01:59:35Z", "commit": {"oid": "fd34c7959ab1aaae11b46b945d5a91f98a8393cd"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzg4NzQxMTU2", "url": "https://github.com/ConsenSys/teku/pull/1543#pullrequestreview-388741156", "createdAt": "2020-04-07T02:19:04Z", "commit": {"oid": "fd34c7959ab1aaae11b46b945d5a91f98a8393cd"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4226, "cost": 1, "resetAt": "2021-11-01T13:51:04Z"}}}