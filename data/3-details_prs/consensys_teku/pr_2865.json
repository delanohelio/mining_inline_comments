{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDk0ODUzNDky", "number": 2865, "title": "Add more constraints around Store.time", "bodyText": "PR Description\nAdd more constraints around initializing and setting Store.time:\n\nWhen recreating the Store from the Database set a lower bound on time based on the latest finalized state\nEnforce constraint that time >= genesisTime in Store constructor\nCheck argument when calling StoreTransaction.setTime\nOnly apply Store.time update if time is increasing\nExit on_tick early if clock time is prior to Store.time\n\nDocumentation\n\n I thought about documentation and added the documentation label to this PR if updates are required.", "createdAt": "2020-09-29T13:58:59Z", "url": "https://github.com/ConsenSys/teku/pull/2865", "merged": true, "mergeCommit": {"oid": "e3e6141d916a6df0d24b0af03928e1abd4c858c0"}, "closed": true, "closedAt": "2020-09-29T17:52:54Z", "author": {"login": "mbaxter"}, "timelineItems": {"totalCount": 8, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdNonUaAH2gAyNDk0ODUzNDkyOjljYThkY2Q0MjA3NjViYmE5NDU1NGFiMjViOGY5ZDE1NDQyMWE2NGY=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdNqbHigH2gAyNDk0ODUzNDkyOmFhM2NiNjM2N2VlMDQwNDY4MDIxOTdhODVkMmZmYjMzNWI0YWEyZWE=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "9ca8dcd420765bba94554ab25b8f9d154421a64f", "author": {"user": {"login": "mbaxter", "name": null}}, "url": "https://github.com/ConsenSys/teku/commit/9ca8dcd420765bba94554ab25b8f9d154421a64f", "committedDate": "2020-09-29T13:57:24Z", "message": "Set time based on the latest finalized state"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDk4NTIyMTgy", "url": "https://github.com/ConsenSys/teku/pull/2865#pullrequestreview-498522182", "createdAt": "2020-09-29T14:19:10Z", "commit": {"oid": "9ca8dcd420765bba94554ab25b8f9d154421a64f"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "14a7ba006ef9e7bf8fc4dfc369886eaa03669b39", "author": {"user": {"login": "mbaxter", "name": null}}, "url": "https://github.com/ConsenSys/teku/commit/14a7ba006ef9e7bf8fc4dfc369886eaa03669b39", "committedDate": "2020-09-29T15:08:44Z", "message": "Add more checks around initializing and setting Store.time"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "19c92f76a11cc85b9a40c434af0c36d4ad20c3c4", "author": {"user": {"login": "mbaxter", "name": null}}, "url": "https://github.com/ConsenSys/teku/commit/19c92f76a11cc85b9a40c434af0c36d4ad20c3c4", "committedDate": "2020-09-29T15:32:14Z", "message": "Add test that retrieves Store from genesis prior to genesis time"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "618aac3e0e26adabdcfd97dc0667b6ac9698c40d", "author": {"user": {"login": "mbaxter", "name": null}}, "url": "https://github.com/ConsenSys/teku/commit/618aac3e0e26adabdcfd97dc0667b6ac9698c40d", "committedDate": "2020-09-29T15:43:41Z", "message": "Update ForkChoiceUtil tests"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDk4NjQzMjkz", "url": "https://github.com/ConsenSys/teku/pull/2865#pullrequestreview-498643293", "createdAt": "2020-09-29T15:56:51Z", "commit": {"oid": "618aac3e0e26adabdcfd97dc0667b6ac9698c40d"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yOVQxNTo1Njo1MVrOHZ1A7A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yOVQxNTo1Njo1MVrOHZ1A7A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5Njg0NTAzNg==", "bodyText": "Should we still not keep the property of not executing on_tick before genesis time?", "url": "https://github.com/ConsenSys/teku/pull/2865#discussion_r496845036", "createdAt": "2020-09-29T15:56:51Z", "author": {"login": "cemozerr"}, "path": "ethereum/core/src/main/java/tech/pegasys/teku/core/ForkChoiceUtil.java", "diffHunk": "@@ -193,7 +193,7 @@ private static boolean should_update_justified_checkpoint(\n    *     <a>https://github.com/ethereum/eth2.0-specs/blob/v0.8.1/specs/core/0_fork-choice.md#on_tick</a>\n    */\n   public static void on_tick(MutableStore store, UInt64 time) {\n-    if (store.getGenesisTime().isGreaterThan(time)) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "618aac3e0e26adabdcfd97dc0667b6ac9698c40d"}, "originalPosition": 4}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDk4NjQ0MTcz", "url": "https://github.com/ConsenSys/teku/pull/2865#pullrequestreview-498644173", "createdAt": "2020-09-29T15:57:48Z", "commit": {"oid": "618aac3e0e26adabdcfd97dc0667b6ac9698c40d"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yOVQxNTo1Nzo0OFrOHZ1Ewg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yOVQxNTo1Nzo0OFrOHZ1Ewg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5Njg0NjAxOA==", "bodyText": "This test seems to be redundant & a bit misleading.", "url": "https://github.com/ConsenSys/teku/pull/2865#discussion_r496846018", "createdAt": "2020-09-29T15:57:48Z", "author": {"login": "cemozerr"}, "path": "ethereum/core/src/test/java/tech/pegasys/teku/core/ForkChoiceUtilTest.java", "diffHunk": "@@ -159,12 +159,22 @@ public void getSlotStartTime_shouldGetCorrectTimePastGenesis() {\n   void on_tick_shouldExitImmediatelyWhenCurrentTimeIsBeforeGenesisTime() {\n     final MutableStore store = mock(MutableStore.class);\n     when(store.getGenesisTime()).thenReturn(UInt64.valueOf(3000));\n-    when(store.getTime()).thenReturn(UInt64.ZERO);\n+    when(store.getTime()).thenReturn(UInt64.valueOf(3000));", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "618aac3e0e26adabdcfd97dc0667b6ac9698c40d"}, "originalPosition": 5}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "aa3cb6367ee04046802197a85d2ffb335b4aa2ea", "author": {"user": {"login": "mbaxter", "name": null}}, "url": "https://github.com/ConsenSys/teku/commit/aa3cb6367ee04046802197a85d2ffb335b4aa2ea", "committedDate": "2020-09-29T16:03:53Z", "message": "Check both time and genesisTime in on_tick"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3467, "cost": 1, "resetAt": "2021-11-01T13:51:04Z"}}}