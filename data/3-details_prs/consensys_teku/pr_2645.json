{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDcyOTkzNTcw", "number": 2645, "title": "Validator client option to subscribe to remote websocket events", "bodyText": "PR Description\n\nRefactored AnticorruptionLayer into BeaconChainEventAdapter\n\nOne implementation uses the EventChannel (as before)\nA new implementation uses the WebSockets subscription to receive events from the beacon node\n\n\nAll the config options and separation of a validator client will be done in a separate PR\n\nFixed Issue(s)\nfixes #2448\nDocumentation\n\n I thought about documentation and added the documentation label to this PR if updates are required.", "createdAt": "2020-08-25T07:10:37Z", "url": "https://github.com/ConsenSys/teku/pull/2645", "merged": true, "mergeCommit": {"oid": "cd5729c192b1d6bfdf27d43a0f5b84d35856c3e7"}, "closed": true, "closedAt": "2020-08-25T22:59:24Z", "author": {"login": "lucassaldanha"}, "timelineItems": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdCSCcvgFqTQ3NDIwMDkyNw==", "endCursor": "Y3Vyc29yOnYyOpPPAAABdCfQB7gH2gAyNDcyOTkzNTcwOjkyZGEwNGNkNDNkMjlkODViMmZjODEyZGI5NjVhNDlmM2EzNjgyOWI=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDc0MjAwOTI3", "url": "https://github.com/ConsenSys/teku/pull/2645#pullrequestreview-474200927", "createdAt": "2020-08-25T07:22:37Z", "commit": {"oid": "5eae9d7af0824262e2ae3e6415f72bedbd66217d"}, "state": "APPROVED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yNVQwNzoyMjozOFrOHGK3mw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yNVQwNzoyMjozOFrOHGK3mw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NjIzMTU3OQ==", "bodyText": "Can just use SafeFuture.COMPLETE", "url": "https://github.com/ConsenSys/teku/pull/2645#discussion_r476231579", "createdAt": "2020-08-25T07:22:38Z", "author": {"login": "ajsutton"}, "path": "validator/eventadapter/src/main/java/tech/pegasys/teku/validator/eventadapter/EventChannelBeaconChainEventAdapter.java", "diffHunk": "@@ -27,12 +29,32 @@\n  * Converts events from the {@link com.google.common.eventbus.EventBus} to the new validator client\n  * {@link tech.pegasys.teku.events.EventChannels}.\n  */\n-class BeaconChainEventAdapter implements SlotEventsChannel, ReorgEventChannel {\n+public class EventChannelBeaconChainEventAdapter\n+    implements SlotEventsChannel, ReorgEventChannel, BeaconChainEventAdapter {\n \n+  private final ServiceConfig config;\n   private final ValidatorTimingChannel validatorTimingChannel;\n \n-  public BeaconChainEventAdapter(final ValidatorTimingChannel validatorTimingChannel) {\n-    this.validatorTimingChannel = validatorTimingChannel;\n+  public EventChannelBeaconChainEventAdapter(final ServiceConfig config) {\n+    this.config = config;\n+    this.validatorTimingChannel =\n+        config.getEventChannels().getPublisher(ValidatorTimingChannel.class);\n+  }\n+\n+  @Override\n+  public SafeFuture<Void> start() {\n+    config.getEventBus().register(this);\n+    config\n+        .getEventChannels()\n+        .subscribe(SlotEventsChannel.class, this)\n+        .subscribe(ReorgEventChannel.class, this);\n+\n+    return SafeFuture.completedFuture(null);\n+  }\n+\n+  @Override\n+  public SafeFuture<Void> stop() {\n+    return SafeFuture.completedFuture(null);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "5eae9d7af0824262e2ae3e6415f72bedbd66217d"}, "originalPosition": 47}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "0338c92373223475e27d83e0edee8d721746559e", "author": {"user": {"login": "lucassaldanha", "name": "Lucas Saldanha"}}, "url": "https://github.com/ConsenSys/teku/commit/0338c92373223475e27d83e0edee8d721746559e", "committedDate": "2020-08-25T22:39:46Z", "message": "Validator client option to subscribe to remove websocket events\n\nSigned-off-by: Lucas Saldanha <lucas.saldanha@consensys.net>"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "5eae9d7af0824262e2ae3e6415f72bedbd66217d", "author": {"user": {"login": "lucassaldanha", "name": "Lucas Saldanha"}}, "url": "https://github.com/ConsenSys/teku/commit/5eae9d7af0824262e2ae3e6415f72bedbd66217d", "committedDate": "2020-08-25T07:07:04Z", "message": "Validator client option to subscribe to remove websocket events\n\nSigned-off-by: Lucas Saldanha <lucas.saldanha@consensys.net>"}, "afterCommit": {"oid": "0338c92373223475e27d83e0edee8d721746559e", "author": {"user": {"login": "lucassaldanha", "name": "Lucas Saldanha"}}, "url": "https://github.com/ConsenSys/teku/commit/0338c92373223475e27d83e0edee8d721746559e", "committedDate": "2020-08-25T22:39:46Z", "message": "Validator client option to subscribe to remove websocket events\n\nSigned-off-by: Lucas Saldanha <lucas.saldanha@consensys.net>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "92da04cd43d29d85b2fc812db965a49f3a36829b", "author": {"user": {"login": "lucassaldanha", "name": "Lucas Saldanha"}}, "url": "https://github.com/ConsenSys/teku/commit/92da04cd43d29d85b2fc812db965a49f3a36829b", "committedDate": "2020-08-25T22:49:39Z", "message": "PR comments"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3528, "cost": 1, "resetAt": "2021-11-01T13:51:04Z"}}}