{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDIwNzAxOTI0", "number": 1827, "title": "Faster G2 cofactor clearing and membership checks", "bodyText": "PR Description\nImplements faster algorithms for G2 cofactor clearing in hash-to-G2, and faster G2 membership tests all round. The membership test uses the method in section 3.1 of https://eprint.iacr.org/2019/814.pdf\nThe speed of hash-to-G2 is more than doubled. Syncing the first 12k blocks of what remains of Schlesi is ~16% faster. The performance improvement will be larger on larger networks.", "createdAt": "2020-05-20T11:55:54Z", "url": "https://github.com/ConsenSys/teku/pull/1827", "merged": true, "mergeCommit": {"oid": "1b1881d59e96fe2dbd388b98c906ed67c53a3e76"}, "closed": true, "closedAt": "2020-05-20T21:09:30Z", "author": {"login": "benjaminion"}, "timelineItems": {"totalCount": 6, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcTveE7AH2gAyNDIwNzAxOTI0OmM2NDAxZDJiNjdlODJjNzVkOTBkY2Q0OTU0OTkzZmVkMTJhMTZmODQ=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcjPhaPAH2gAyNDIwNzAxOTI0Ojc5NGJhYThiNDAwZTA3ZTM5Zjk4ODhlNGU4NjlhNTkxODIxNmJhOGY=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "c6401d2b67e82c75d90dcd4954993fed12a16f84", "author": {"user": {"login": "benjaminion", "name": "Ben Edgington"}}, "url": "https://github.com/ConsenSys/teku/commit/c6401d2b67e82c75d90dcd4954993fed12a16f84", "committedDate": "2020-04-02T17:09:02Z", "message": "Implement fast version of clear_h2()"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "11b2b299f3b0127f2bf85410281ecb42f6a4c377", "author": {"user": {"login": "benjaminion", "name": "Ben Edgington"}}, "url": "https://github.com/ConsenSys/teku/commit/11b2b299f3b0127f2bf85410281ecb42f6a4c377", "committedDate": "2020-04-02T17:20:50Z", "message": "SpotlessApply"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "2f0c316a80d7379d04ec35dc19717868fa7d17c8", "author": {"user": {"login": "benjaminion", "name": "Ben Edgington"}}, "url": "https://github.com/ConsenSys/teku/commit/2f0c316a80d7379d04ec35dc19717868fa7d17c8", "committedDate": "2020-05-20T10:38:57Z", "message": "Faster cofactor clearing and subgroup check for G2"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDE1NjE3OTI0", "url": "https://github.com/ConsenSys/teku/pull/1827#pullrequestreview-415617924", "createdAt": "2020-05-20T18:42:36Z", "commit": {"oid": "2f0c316a80d7379d04ec35dc19717868fa7d17c8"}, "state": "APPROVED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yMFQxODo0MjozNlrOGYZM6Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yMFQxODo1NTowMlrOGYZnzQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyODIzMTkxMw==", "bodyText": "(nit) Might be a good idea to make the methods that are directly used in production public, and either mark the other methods private or keep them package-private and annotate them with @VisibleForTesting.  This just makes it easier to see which methods are internal-only vs used externally.", "url": "https://github.com/ConsenSys/teku/pull/1827#discussion_r428231913", "createdAt": "2020-05-20T18:42:36Z", "author": {"login": "mbaxter"}, "path": "bls/src/main/java/tech/pegasys/teku/bls/hashToG2/Helper.java", "diffHunk": "@@ -54,14 +58,25 @@ static boolean isOnCurve(JacobianPoint p) {\n   /**\n    * Tests whether the given point lies in the G2 group.\n    *\n-   * <p>Once the GLV patent has expired we can replace the qChain with the endomorphism here:\n-   * https://eprint.iacr.org/2019/814.pdf\n-   *\n    * @param p a JacobianPoint\n    * @return true if the point is in G2, false otherwise\n    */\n   static boolean isInG2(JacobianPoint p) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "2f0c316a80d7379d04ec35dc19717868fa7d17c8"}, "originalPosition": 33}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyODIzODc5Nw==", "bodyText": "(optional) Might be worth running this a few times, although looks like we have another test that basically does this already.", "url": "https://github.com/ConsenSys/teku/pull/1827#discussion_r428238797", "createdAt": "2020-05-20T18:55:02Z", "author": {"login": "mbaxter"}, "path": "bls/src/test/java/tech/pegasys/teku/bls/hashToG2/HelperTest.java", "diffHunk": "@@ -206,8 +212,32 @@ void clearH2Test() {\n   }\n \n   @Test\n-  void pointIsInG2() {\n+  void clearH2TestCompare() {\n+    // Check that the implementation of clear_h2() matches the slower method for an arbitrary point\n     JacobianPoint a =\n+        new JacobianPoint(\n+            new FP2Immutable(\n+                \"0x0c8977fab5175ac2f09e5f39e29d016f11c094ef10f237d2a5e23f482d0bfb4466688527cd31685bfe481725c31462cc\",\n+                \"0x0b305838069012861bb63501841c91bd5bc7e1359d44cd196681fb14c03e544c22205bced326d490eb886aaa3ed52918\"),\n+            new FP2Immutable(\n+                \"0x172cf997b3501882861c07e852fadbf5753eb8a3e1d2ce375e6aed07cf9c1b5ff1cbf1124c6e3b0cf4607c683eafd1a4\",\n+                \"0x0d9dacf241a753d55cff6d45b568b716a2ad68ba29d23f92dea6e7cf6ed54e96cdac4a2b95213f93439b946ebc63349c\"),\n+            new FP2Immutable(\n+                \"0x05594bb289f0ebfd8fa3f020c6e1eaf4c49b97d8ccaf3470a3a02da4b3e7104778105bd6c7e0caf97206c77a8b501d4d\",\n+                \"0x0625151f905fad40eb0e2b9b0a46d9afe531256c6d5e39897a27d94700f037a761a741d11275180bd18e620289e02a16\"));\n+    assertEquals(clear_h2_slow(a), clear_h2(a));\n+  }\n+\n+  @Test\n+  void G2MapToInfinityTest() {\n+    // The generator point of G2 is certainly in G2\n+    JacobianPoint g2Generator = new JacobianPoint(ECP2.generator());\n+    assertTrue(g2_map_to_infinity(g2Generator).isInfinity());", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "2f0c316a80d7379d04ec35dc19717868fa7d17c8"}, "originalPosition": 51}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e8a0125e935397831794673f951f21afd5104cd1", "author": {"user": {"login": "benjaminion", "name": "Ben Edgington"}}, "url": "https://github.com/ConsenSys/teku/commit/e8a0125e935397831794673f951f21afd5104cd1", "committedDate": "2020-05-20T20:50:20Z", "message": "Merge branch 'master' into faster-g2"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "794baa8b400e07e39f9888e4e869a5918216ba8f", "author": {"user": {"login": "benjaminion", "name": "Ben Edgington"}}, "url": "https://github.com/ConsenSys/teku/commit/794baa8b400e07e39f9888e4e869a5918216ba8f", "committedDate": "2020-05-20T20:58:30Z", "message": "Merge branch 'master' into faster-g2"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4005, "cost": 1, "resetAt": "2021-11-01T13:51:04Z"}}}