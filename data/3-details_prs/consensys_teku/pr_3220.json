{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTIwODU3ODcz", "number": 3220, "title": "[Issue-3063] Merge initial state options", "bodyText": "PR Description\nMerge --Xws-initial-state weak subjectivity state argument with existing --initial-state argument.\nThis modifies the startup behavior in a few ways:\n\nWe'll now always parse the initial state if it is supplied.  When spinning up an existing database, we check it is consistent with the initial state.  We also use the initial state to modify weak subjectivity options.\nSince we're always running validation against the initial state, when overriding the initial state for custom networks users will have to supply the initial state argument at each startup.\n\nOther changes:\n\nParse NetworkDefinition in NetworkOptions to simplify access to the parsed value.\n\nFixed Issue(s)\nPart of #3063\nDocumentation\nThis PR expands the purpose of the --initial-state flag:  users can pass a genesis state as before, or a more recent state from which to sync.", "createdAt": "2020-11-13T21:21:58Z", "url": "https://github.com/ConsenSys/teku/pull/3220", "merged": true, "mergeCommit": {"oid": "a974e88da33f0619802da5c6139a4031c2b628f8"}, "closed": true, "closedAt": "2020-11-16T23:51:22Z", "author": {"login": "mbaxter"}, "timelineItems": {"totalCount": 10, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdcNvLsgH2gAyNTIwODU3ODczOmYyMTY2MDQ1MzQxYTE1OTVjYzBiMmM4NTRjMDhiMTZmYTU5N2VkNTM=", "endCursor": "Y3Vyc29yOnYyOpPPAAABddNsOxgH2gAyNTIwODU3ODczOmZlYjY0MDE4ZGUyZTFhNTQwOThlM2UzYTc3NTk3Y2M1OGE4ZGZmMzA=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "f2166045341a1595cc0b2c854c08b16fa597ed53", "author": {"user": {"login": "mbaxter", "name": null}}, "url": "https://github.com/ConsenSys/teku/commit/f2166045341a1595cc0b2c854c08b16fa597ed53", "committedDate": "2020-11-13T21:07:25Z", "message": "Create NetworkDefinitionConverter"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "fdeb4434cdbed70864245eeed81ffc18b56d545d", "author": {"user": {"login": "mbaxter", "name": null}}, "url": "https://github.com/ConsenSys/teku/commit/fdeb4434cdbed70864245eeed81ffc18b56d545d", "committedDate": "2020-11-13T21:07:54Z", "message": "Merge --initial-state and --Xws-initial-state options"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "0f31caca54f18419e2a566388684169bab399c2a", "author": {"user": {"login": "mbaxter", "name": null}}, "url": "https://github.com/ConsenSys/teku/commit/0f31caca54f18419e2a566388684169bab399c2a", "committedDate": "2020-11-13T21:44:55Z", "message": "Merge branch 'master' into issue-3063/merge-initial-state-options"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "d421825576b867b8905c58c08337583820198d6d", "author": {"user": {"login": "mbaxter", "name": null}}, "url": "https://github.com/ConsenSys/teku/commit/d421825576b867b8905c58c08337583820198d6d", "committedDate": "2020-11-13T22:11:28Z", "message": "Update test assertions"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "5778c329ab3e60c4057fc9f38cb9fdd7e4bb549f", "author": {"user": {"login": "mbaxter", "name": null}}, "url": "https://github.com/ConsenSys/teku/commit/5778c329ab3e60c4057fc9f38cb9fdd7e4bb549f", "committedDate": "2020-11-16T19:19:52Z", "message": "Merge branch 'master' into issue-3063/merge-initial-state-options"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "9bb3fd0fa47018c8651f7d6250debad1ccc20ecb", "author": {"user": {"login": "mbaxter", "name": null}}, "url": "https://github.com/ConsenSys/teku/commit/9bb3fd0fa47018c8651f7d6250debad1ccc20ecb", "committedDate": "2020-11-16T19:27:54Z", "message": "Cut unused method"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTMxODMwODgz", "url": "https://github.com/ConsenSys/teku/pull/3220#pullrequestreview-531830883", "createdAt": "2020-11-16T22:13:44Z", "commit": {"oid": "9bb3fd0fa47018c8651f7d6250debad1ccc20ecb"}, "state": "APPROVED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xNlQyMjoxMzo0NFrOH0W_vg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xNlQyMjoxMzo0NFrOH0W_vg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNDY2NDc2Ng==", "bodyText": "I don't understand how this error message lines up with the input.  The network definition name would be medalla  or a URL to a custom config file.  I didn't expect the ws checkpoint format to be valid here at all.", "url": "https://github.com/ConsenSys/teku/pull/3220#discussion_r524664766", "createdAt": "2020-11-16T22:13:44Z", "author": {"login": "ajsutton"}, "path": "teku/src/main/java/tech/pegasys/teku/cli/converter/NetworkDefinitionConverter.java", "diffHunk": "@@ -0,0 +1,34 @@\n+/*\n+ * Copyright 2020 ConsenSys AG.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\"); you may not use this file except in compliance with\n+ * the License. You may obtain a copy of the License at\n+ *\n+ * http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software distributed under the License is distributed on\n+ * an \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied. See the License for the\n+ * specific language governing permissions and limitations under the License.\n+ */\n+\n+package tech.pegasys.teku.cli.converter;\n+\n+import static com.google.common.base.Preconditions.checkNotNull;\n+\n+import picocli.CommandLine;\n+import tech.pegasys.teku.util.config.NetworkDefinition;\n+\n+public class NetworkDefinitionConverter implements CommandLine.ITypeConverter<NetworkDefinition> {\n+  public static final String CHECKPOINT_ERROR =\n+      \"Checkpoint arguments should be formatted as <BLOCK_ROOT>:<EPOCH_NUMBER> where blockRoot is a hex-encoded 32 byte value and epochNumber is a number in decimal format\";\n+\n+  @Override\n+  public NetworkDefinition convert(final String networkString) {\n+    try {\n+      checkNotNull(networkString);\n+      return NetworkDefinition.fromCliArg(networkString);\n+    } catch (Throwable e) {\n+      throw new CommandLine.TypeConversionException(CHECKPOINT_ERROR);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "9bb3fd0fa47018c8651f7d6250debad1ccc20ecb"}, "originalPosition": 31}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "73c5693528bd2da79c729c906fde6261206f2d4b", "author": {"user": {"login": "mbaxter", "name": null}}, "url": "https://github.com/ConsenSys/teku/commit/73c5693528bd2da79c729c906fde6261206f2d4b", "committedDate": "2020-11-16T23:27:45Z", "message": "Merge branch 'master' into issue-3063/merge-initial-state-options"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f12f46622f03bfd6784612eaa037a0ac48ccad76", "author": {"user": {"login": "mbaxter", "name": null}}, "url": "https://github.com/ConsenSys/teku/commit/f12f46622f03bfd6784612eaa037a0ac48ccad76", "committedDate": "2020-11-16T23:35:30Z", "message": "Fix NetworkDefinitionConverter error"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "feb64018de2e1a54098e3e3a77597cc58a8dff30", "author": {"user": {"login": "mbaxter", "name": null}}, "url": "https://github.com/ConsenSys/teku/commit/feb64018de2e1a54098e3e3a77597cc58a8dff30", "committedDate": "2020-11-16T23:38:07Z", "message": "Merge branch 'master' into issue-3063/merge-initial-state-options"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4450, "cost": 1, "resetAt": "2021-11-01T13:51:04Z"}}}