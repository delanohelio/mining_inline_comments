{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDk4ODkxNDE0", "number": 2900, "title": "Add Head events to the ChainHeadChannel", "bodyText": "added head events to the http event subscriptions\n\n\nadded a test case to show reorgs coming prior to the head event if both are subscribed\n\n\nRecentChainData now returns the fork choice slot rather than slot from head\n\n\nupdateChainHead will now exit if the original chain head equals the new chain head\n\n\nfixes #2885\nSigned-off-by: Paul Harris paul.harris@consensys.net\nDocumentation\n\n I thought about documentation and added the documentation label to this PR if updates are required.", "createdAt": "2020-10-06T23:34:45Z", "url": "https://github.com/ConsenSys/teku/pull/2900", "merged": true, "mergeCommit": {"oid": "5200124d59ac29d6301129e170b55cfa5b618384"}, "closed": true, "closedAt": "2020-10-07T00:59:10Z", "author": {"login": "rolfyone"}, "timelineItems": {"totalCount": 7, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdQA3L1AH2gAyNDk4ODkxNDE0OjRiYWI0MTdmZjcwNDljODgxZTllMWQ1ZDQ5NjNhODczYjhiY2MyMTI=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdQCGfBgH2gAyNDk4ODkxNDE0OjBkNWY3NWI4YzVlYzIxNTE3MjhjYWU0ZWRjYTg0NGRlYjRlOTJmMzg=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "4bab417ff7049c881e9e1d5d4963a873b8bcc212", "author": {"user": {"login": "rolfyone", "name": "Paul Harris"}}, "url": "https://github.com/ConsenSys/teku/commit/4bab417ff7049c881e9e1d5d4963a873b8bcc212", "committedDate": "2020-10-06T23:20:18Z", "message": "Add Head events to the ChainHeadChannel\n\n - added head events to the http event subscriptions\n\n - added a test case to show reorgs coming prior to the head event if both are subscribed\n\n - RecentChainData now returns the fork choice slot rather than slot from head\n\n - updateChainHead will now exit if the original chain head equals the new chain head\n\n fixes #2885\n\nSigned-off-by: Paul Harris <paul.harris@consensys.net>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "fae202c24d8a98433f90abafe6212cde6445282c", "author": {"user": {"login": "rolfyone", "name": "Paul Harris"}}, "url": "https://github.com/ConsenSys/teku/commit/fae202c24d8a98433f90abafe6212cde6445282c", "committedDate": "2020-10-06T23:39:58Z", "message": "missed file from patch set\n\nSigned-off-by: Paul Harris <paul.harris@consensys.net>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b3d6f1204707b8e5998fe3570f48ba9ef90bbbe9", "author": {"user": {"login": "rolfyone", "name": "Paul Harris"}}, "url": "https://github.com/ConsenSys/teku/commit/b3d6f1204707b8e5998fe3570f48ba9ef90bbbe9", "committedDate": "2020-10-06T23:53:08Z", "message": "Merge remote-tracking branch 'upstream/master' into 2885-chainHead"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTAzNDUyNTA2", "url": "https://github.com/ConsenSys/teku/pull/2900#pullrequestreview-503452506", "createdAt": "2020-10-07T00:44:35Z", "commit": {"oid": "b3d6f1204707b8e5998fe3570f48ba9ef90bbbe9"}, "state": "APPROVED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wN1QwMDo0NDozNVrOHdetUA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wN1QwMDo0NDozNVrOHdetUA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMDY3Mzg3Mg==", "bodyText": "nit: Probably need to make this message clearer:\n\n  \n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                    LOG.trace(\"Not updating chain head\");\n          \n          \n            \n                    LOG.trace(\"Skippping head update because new head is same as previous head\");", "url": "https://github.com/ConsenSys/teku/pull/2900#discussion_r500673872", "createdAt": "2020-10-07T00:44:35Z", "author": {"login": "ajsutton"}, "path": "storage/src/main/java/tech/pegasys/teku/storage/client/RecentChainData.java", "diffHunk": "@@ -242,7 +242,12 @@ private void updateChainHead(\n         LOG.info(\"Skipping head block update to avoid potential rollback of the chain head.\");\n         return;\n       }\n+      if (originalHead.isPresent() && originalHead.get().equals(newChainHead)) {\n+        LOG.trace(\"Not updating chain head\");", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b3d6f1204707b8e5998fe3570f48ba9ef90bbbe9"}, "originalPosition": 5}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "65692a33dbde22904315caaf14b916f1ccdd9390", "author": {"user": {"login": "rolfyone", "name": "Paul Harris"}}, "url": "https://github.com/ConsenSys/teku/commit/65692a33dbde22904315caaf14b916f1ccdd9390", "committedDate": "2020-10-07T00:45:28Z", "message": "Update storage/src/main/java/tech/pegasys/teku/storage/client/RecentChainData.java\n\nCo-authored-by: Adrian Sutton <adrian@symphonious.net>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e21823ea34adeca06c433633c776860d9b86387e", "author": {"user": {"login": "rolfyone", "name": "Paul Harris"}}, "url": "https://github.com/ConsenSys/teku/commit/e21823ea34adeca06c433633c776860d9b86387e", "committedDate": "2020-10-07T00:46:46Z", "message": "Merge remote-tracking branch 'upstream/master' into 2885-chainHead"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "0d5f75b8c5ec2151728cae4edca844deb4e92f38", "author": {"user": {"login": "rolfyone", "name": "Paul Harris"}}, "url": "https://github.com/ConsenSys/teku/commit/0d5f75b8c5ec2151728cae4edca844deb4e92f38", "committedDate": "2020-10-07T00:46:55Z", "message": "Merge branch '2885-chainHead' of https://github.com/rolfyone/artemis into 2885-chainHead"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3498, "cost": 1, "resetAt": "2021-11-01T13:51:04Z"}}}