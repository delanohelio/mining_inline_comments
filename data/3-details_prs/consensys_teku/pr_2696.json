{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDc2MzQyNzYy", "number": 2696, "title": "Check gossip message size by ByteBuf.readableBytes() instead of ByteBuf.capacity()", "bodyText": "PR Description\nByteBuf capacity can potentially be pretty large if reusing pooled buffers, so it's correctly to check ByteBuf.readableBytes() else gossip messages can be unreasonably dropped.\nFixed Issue(s)\n\n\nDocumentation\n\n I thought about documentation and added the documentation label to this PR if updates are required.", "createdAt": "2020-08-31T14:41:06Z", "url": "https://github.com/ConsenSys/teku/pull/2696", "merged": true, "mergeCommit": {"oid": "43aa9b4689def05c3926c8c831056a2c706f5334"}, "closed": true, "closedAt": "2020-08-31T15:47:05Z", "author": {"login": "Nashatyrev"}, "timelineItems": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdETzwyAH2gAyNDc2MzQyNzYyOjljNDA3MTUxYTMyMWZjMzU0NTI0MjI4ZTcyYmJlYWI4YTJkYzkyYTU=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdEUmnqgH2gAyNDc2MzQyNzYyOmFiZjE5ZGM4NzNmMmU4ZWNlNzI3ZWIzZjE0MTY5NTMyYzgwYjQ5NWE=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "9c407151a321fc354524228e72bbeab8a2dc92a5", "author": {"user": {"login": "Nashatyrev", "name": "Anton Nashatyrev"}}, "url": "https://github.com/ConsenSys/teku/commit/9c407151a321fc354524228e72bbeab8a2dc92a5", "committedDate": "2020-08-31T14:37:40Z", "message": "Check gossip message size by ByteBuf.readableBytes() instead of ByteBuf.capacity()"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDc4NjkyMDgy", "url": "https://github.com/ConsenSys/teku/pull/2696#pullrequestreview-478692082", "createdAt": "2020-08-31T14:59:54Z", "commit": {"oid": "9c407151a321fc354524228e72bbeab8a2dc92a5"}, "state": "APPROVED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0zMVQxNDo1OTo1NFrOHJ8afg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0zMVQxNDo1OTo1NFrOHJ8afg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MDE4OTA1NA==", "bodyText": "Might be worth adding a test for this.", "url": "https://github.com/ConsenSys/teku/pull/2696#discussion_r480189054", "createdAt": "2020-08-31T14:59:54Z", "author": {"login": "mbaxter"}, "path": "networking/p2p/src/main/java/tech/pegasys/teku/networking/p2p/libp2p/gossip/GossipHandler.java", "diffHunk": "@@ -54,7 +54,7 @@ public GossipHandler(\n \n   @Override\n   public SafeFuture<ValidationResult> apply(final MessageApi message) {\n-    final int messageSize = message.getData().capacity();\n+    final int messageSize = message.getData().readableBytes();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "9c407151a321fc354524228e72bbeab8a2dc92a5"}, "originalPosition": 5}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "28131e6d3f8ef907aa4cbd16afe5b7b4c77c33a9", "author": {"user": {"login": "Nashatyrev", "name": "Anton Nashatyrev"}}, "url": "https://github.com/ConsenSys/teku/commit/28131e6d3f8ef907aa4cbd16afe5b7b4c77c33a9", "committedDate": "2020-08-31T15:09:58Z", "message": "Add testcase when buffer capacity is larger then max message size while the readable bytes fit the max size"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "abf19dc873f2e8ece727eb3f14169532c80b495a", "author": {"user": {"login": "Nashatyrev", "name": "Anton Nashatyrev"}}, "url": "https://github.com/ConsenSys/teku/commit/abf19dc873f2e8ece727eb3f14169532c80b495a", "committedDate": "2020-08-31T15:33:13Z", "message": "Apply spotless"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3554, "cost": 1, "resetAt": "2021-11-01T13:51:04Z"}}}