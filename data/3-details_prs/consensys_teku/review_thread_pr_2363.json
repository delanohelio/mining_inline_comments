{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDUwMzE5MzQ2", "number": 2363, "reviewThreads": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xNlQxNjozNjoyNFrOEPNffg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xNlQxNzoyMjoyM1rOEPOj_Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjg0Mzg1MTUwOnYy", "diffSide": "RIGHT", "path": "bls/build.gradle", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xNlQxNjozNjoyNFrOGyzLtQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xNlQxODoyNDo0NFrOGy3LUA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NTkyMDU2NQ==", "bodyText": "Seems to be a duplicate line", "url": "https://github.com/ConsenSys/teku/pull/2363#discussion_r455920565", "createdAt": "2020-07-16T16:36:24Z", "author": {"login": "benjaminion"}, "path": "bls/build.gradle", "diffHunk": "@@ -3,6 +3,7 @@ dependencies {\n \n   api 'org.bouncycastle:bcprov-jdk15on'\n \n+  implementation 'org.apache.tuweni:tuweni-bytes'", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "0f7a07bdca097b14ca79a500756a1ecd284d365c"}, "originalPosition": 4}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NTk4NjAwMA==", "bodyText": "Removed.", "url": "https://github.com/ConsenSys/teku/pull/2363#discussion_r455986000", "createdAt": "2020-07-16T18:24:44Z", "author": {"login": "cemozerr"}, "path": "bls/build.gradle", "diffHunk": "@@ -3,6 +3,7 @@ dependencies {\n \n   api 'org.bouncycastle:bcprov-jdk15on'\n \n+  implementation 'org.apache.tuweni:tuweni-bytes'", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NTkyMDU2NQ=="}, "originalCommit": {"oid": "0f7a07bdca097b14ca79a500756a1ecd284d365c"}, "originalPosition": 4}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjg0Mzg2NjE1OnYy", "diffSide": "RIGHT", "path": "ethereum/core/src/main/java/tech/pegasys/teku/core/blockvalidator/BatchSignatureVerifier.java", "isResolved": true, "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xNlQxNjo0MDoxNVrOGyzVCg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xNlQxOToyMjoxNVrOGy5JPQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NTkyMjk1NA==", "bodyText": "I would localize this flag usage inside BLS module only.\nYou may alter  BLS.prepareBatchVerify and BLS.completeBatchVerify behavior based on this flag", "url": "https://github.com/ConsenSys/teku/pull/2363#discussion_r455922954", "createdAt": "2020-07-16T16:40:15Z", "author": {"login": "Nashatyrev"}, "path": "ethereum/core/src/main/java/tech/pegasys/teku/core/blockvalidator/BatchSignatureVerifier.java", "diffHunk": "@@ -68,6 +74,10 @@ public synchronized boolean verify(\n    * instance methods would fail with exception\n    */\n   public synchronized boolean batchVerify() {\n+    if (!BLSConstants.VERIFICATION_ENABLED) {\n+      LOG.warn(\"Skipping bls verification.\");\n+      return true;\n+    }", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "0f7a07bdca097b14ca79a500756a1ecd284d365c"}, "originalPosition": 29}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NjAxMzgwNw==", "bodyText": "Decided to skip on this as discussed offline.", "url": "https://github.com/ConsenSys/teku/pull/2363#discussion_r456013807", "createdAt": "2020-07-16T19:14:36Z", "author": {"login": "cemozerr"}, "path": "ethereum/core/src/main/java/tech/pegasys/teku/core/blockvalidator/BatchSignatureVerifier.java", "diffHunk": "@@ -68,6 +74,10 @@ public synchronized boolean verify(\n    * instance methods would fail with exception\n    */\n   public synchronized boolean batchVerify() {\n+    if (!BLSConstants.VERIFICATION_ENABLED) {\n+      LOG.warn(\"Skipping bls verification.\");\n+      return true;\n+    }", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NTkyMjk1NA=="}, "originalCommit": {"oid": "0f7a07bdca097b14ca79a500756a1ecd284d365c"}, "originalPosition": 29}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NjAxODIzNw==", "bodyText": "I've localized the flag but kept the BLS.prepareBatchVerify functionality the same.", "url": "https://github.com/ConsenSys/teku/pull/2363#discussion_r456018237", "createdAt": "2020-07-16T19:22:15Z", "author": {"login": "cemozerr"}, "path": "ethereum/core/src/main/java/tech/pegasys/teku/core/blockvalidator/BatchSignatureVerifier.java", "diffHunk": "@@ -68,6 +74,10 @@ public synchronized boolean verify(\n    * instance methods would fail with exception\n    */\n   public synchronized boolean batchVerify() {\n+    if (!BLSConstants.VERIFICATION_ENABLED) {\n+      LOG.warn(\"Skipping bls verification.\");\n+      return true;\n+    }", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NTkyMjk1NA=="}, "originalCommit": {"oid": "0f7a07bdca097b14ca79a500756a1ecd284d365c"}, "originalPosition": 29}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjg0Mzg3MTcwOnYy", "diffSide": "RIGHT", "path": "bls/src/main/java/tech/pegasys/teku/bls/BLS.java", "isResolved": true, "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xNlQxNjo0MTo0NlrOGyzYuw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xNlQxOToxODo0MFrOGy5Amg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NTkyMzg5OQ==", "bodyText": "This may be too pernickety, but I'd much rather see the constant named VERIFICATION_DISABLED. This for a couple of reasons:\n\nIt's easy to lose/forget the ! at the start. It's an extra cognitive step (got to work out \"not false\"), and I've seen really stupid errors arise as a result of simple things like this.\nThe normal case is \"enabled\", flagging DISABLED in big letters shows more clearly that this is an exceptional path.", "url": "https://github.com/ConsenSys/teku/pull/2363#discussion_r455923899", "createdAt": "2020-07-16T16:41:46Z", "author": {"login": "benjaminion"}, "path": "bls/src/main/java/tech/pegasys/teku/bls/BLS.java", "diffHunk": "@@ -65,6 +69,10 @@ public static BLSSignature sign(BLSSecretKey secretKey, Bytes message) {\n    * @return True if the verification is successful, false otherwise.\n    */\n   public static boolean verify(BLSPublicKey publicKey, Bytes message, BLSSignature signature) {\n+    if (!BLSConstants.VERIFICATION_ENABLED) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "0f7a07bdca097b14ca79a500756a1ecd284d365c"}, "originalPosition": 22}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NjAxNTk3OA==", "bodyText": "I think it makes a lot of sense.", "url": "https://github.com/ConsenSys/teku/pull/2363#discussion_r456015978", "createdAt": "2020-07-16T19:18:35Z", "author": {"login": "cemozerr"}, "path": "bls/src/main/java/tech/pegasys/teku/bls/BLS.java", "diffHunk": "@@ -65,6 +69,10 @@ public static BLSSignature sign(BLSSecretKey secretKey, Bytes message) {\n    * @return True if the verification is successful, false otherwise.\n    */\n   public static boolean verify(BLSPublicKey publicKey, Bytes message, BLSSignature signature) {\n+    if (!BLSConstants.VERIFICATION_ENABLED) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NTkyMzg5OQ=="}, "originalCommit": {"oid": "0f7a07bdca097b14ca79a500756a1ecd284d365c"}, "originalPosition": 22}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NjAxNjAyNg==", "bodyText": "Done.", "url": "https://github.com/ConsenSys/teku/pull/2363#discussion_r456016026", "createdAt": "2020-07-16T19:18:40Z", "author": {"login": "cemozerr"}, "path": "bls/src/main/java/tech/pegasys/teku/bls/BLS.java", "diffHunk": "@@ -65,6 +69,10 @@ public static BLSSignature sign(BLSSecretKey secretKey, Bytes message) {\n    * @return True if the verification is successful, false otherwise.\n    */\n   public static boolean verify(BLSPublicKey publicKey, Bytes message, BLSSignature signature) {\n+    if (!BLSConstants.VERIFICATION_ENABLED) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NTkyMzg5OQ=="}, "originalCommit": {"oid": "0f7a07bdca097b14ca79a500756a1ecd284d365c"}, "originalPosition": 22}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjg0NDAyNjg1OnYy", "diffSide": "RIGHT", "path": "bls/src/main/java/tech/pegasys/teku/bls/BLS.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xNlQxNzoyMjoyM1rOGy05XA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xNlQxNzoyNTozOVrOGy1BLA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NTk0ODYzNg==", "bodyText": "BTW wouldn't there be a flood of WARN logs when fuzz testing?", "url": "https://github.com/ConsenSys/teku/pull/2363#discussion_r455948636", "createdAt": "2020-07-16T17:22:23Z", "author": {"login": "Nashatyrev"}, "path": "bls/src/main/java/tech/pegasys/teku/bls/BLS.java", "diffHunk": "@@ -130,6 +138,10 @@ public static boolean aggregateVerify(\n    */\n   public static boolean fastAggregateVerify(\n       List<BLSPublicKey> publicKeys, Bytes message, BLSSignature signature) {\n+    if (!BLSConstants.VERIFICATION_ENABLED) {\n+      LOG.warn(\"Skipping bls verification.\");", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "0f7a07bdca097b14ca79a500756a1ecd284d365c"}, "originalPosition": 34}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NTk1MDYzNg==", "bodyText": "I think that's ok. We want to avoid a worst-case scenario in which somebody accidently runs without signature verification in production. Making it very noisy should help with this. I expect that fuzzers should ignore log lines, at least below ERROR level.", "url": "https://github.com/ConsenSys/teku/pull/2363#discussion_r455950636", "createdAt": "2020-07-16T17:25:39Z", "author": {"login": "benjaminion"}, "path": "bls/src/main/java/tech/pegasys/teku/bls/BLS.java", "diffHunk": "@@ -130,6 +138,10 @@ public static boolean aggregateVerify(\n    */\n   public static boolean fastAggregateVerify(\n       List<BLSPublicKey> publicKeys, Bytes message, BLSSignature signature) {\n+    if (!BLSConstants.VERIFICATION_ENABLED) {\n+      LOG.warn(\"Skipping bls verification.\");", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NTk0ODYzNg=="}, "originalCommit": {"oid": "0f7a07bdca097b14ca79a500756a1ecd284d365c"}, "originalPosition": 34}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3401, "cost": 1, "resetAt": "2021-11-12T11:57:46Z"}}}