{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0Mzg0NjIyNDcw", "number": 1307, "reviewThreads": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wNlQxNToyMjoyNVrODl1cPg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wNlQxNToyMjoyNVrODl1cPg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjQwOTk5NDg2OnYy", "diffSide": "RIGHT", "path": "networking/p2p/src/main/java/tech/pegasys/artemis/networking/p2p/libp2p/LibP2PPeer.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wNlQxNToyMjoyNVrOFy8j9w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wN1QwMTo0NDoxNVrOFzL0UQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4ODk2NTM2Nw==", "bodyText": "It seems like we're calling connected.set(false) twice. Is there a specific reason we do that?", "url": "https://github.com/ConsenSys/teku/pull/1307#discussion_r388965367", "createdAt": "2020-03-06T15:22:25Z", "author": {"login": "cemozerr"}, "path": "networking/p2p/src/main/java/tech/pegasys/artemis/networking/p2p/libp2p/LibP2PPeer.java", "diffHunk": "@@ -58,11 +65,29 @@ public boolean isConnected() {\n \n   @Override\n   @SuppressWarnings(\"FutureReturnValueIgnored\")\n-  public void disconnect() {\n+  public void disconnectImmediately() {\n     connected.set(false);\n     connection.close();\n   }\n \n+  @Override\n+  public void disconnectCleanly(final DisconnectRequestHandler.DisconnectReason reason) {\n+    connected.set(false);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "634866ab2aede026311c074ebd55869e5b717a1c"}, "originalPosition": 33}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4OTIxNTMxMw==", "bodyText": "We want to mark the peer as disconnected as soon as we start the clean disconnect process, but also want to do so when we disconnect immediately.  It doesn't make a lot of difference but just avoids us sending a request for blocks to a peer that we've started disconnecting.", "url": "https://github.com/ConsenSys/teku/pull/1307#discussion_r389215313", "createdAt": "2020-03-07T01:44:15Z", "author": {"login": "ajsutton"}, "path": "networking/p2p/src/main/java/tech/pegasys/artemis/networking/p2p/libp2p/LibP2PPeer.java", "diffHunk": "@@ -58,11 +65,29 @@ public boolean isConnected() {\n \n   @Override\n   @SuppressWarnings(\"FutureReturnValueIgnored\")\n-  public void disconnect() {\n+  public void disconnectImmediately() {\n     connected.set(false);\n     connection.close();\n   }\n \n+  @Override\n+  public void disconnectCleanly(final DisconnectRequestHandler.DisconnectReason reason) {\n+    connected.set(false);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4ODk2NTM2Nw=="}, "originalCommit": {"oid": "634866ab2aede026311c074ebd55869e5b717a1c"}, "originalPosition": 33}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2490, "cost": 1, "resetAt": "2021-11-12T11:57:46Z"}}}