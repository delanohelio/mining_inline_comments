{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDQxMjIzNjEz", "number": 2252, "reviewThreads": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yOVQxMzo1MDo1MFrOEJq0cg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yOVQxNDo0MDoyMlrOEJsOzw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjc4NTc0MTk0OnYy", "diffSide": "RIGHT", "path": "storage/src/testFixtures/java/tech/pegasys/teku/storage/server/rocksdb/core/MockRocksDbInstance.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yOVQxMzo1MDo1MFrOGqR7Ew==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yOVQyMToxMDoxMFrOGqiVew==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0Njk4NzAyNw==", "bodyText": "nit: the Streams.peek() method to quote its Javadoc: \"exists mainly to support debugging\", so we might want to stay away from using it in production.", "url": "https://github.com/ConsenSys/teku/pull/2252#discussion_r446987027", "createdAt": "2020-06-29T13:50:50Z", "author": {"login": "cemozerr"}, "path": "storage/src/testFixtures/java/tech/pegasys/teku/storage/server/rocksdb/core/MockRocksDbInstance.java", "diffHunk": "@@ -120,7 +121,9 @@ public static MockRocksDbInstance createEmpty(final Class<? extends Schema> sche\n   public <K, V> Stream<ColumnEntry<K, V>> stream(final RocksDbColumn<K, V> column) {\n     assertOpen();\n     assertValidColumn(column);\n-    return columnData.get(column).entrySet().stream().map(e -> columnEntry(column, e));\n+    return columnData.get(column).entrySet().stream()\n+        .peek(value -> assertOpen())", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f27ef211cd17f1658780d5e7f114de911af7dc17"}, "originalPosition": 14}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NzI1NTkzMQ==", "bodyText": "yep its just so that the Mock db instance behaves 'similar' to the real one, so I think its ok here...", "url": "https://github.com/ConsenSys/teku/pull/2252#discussion_r447255931", "createdAt": "2020-06-29T21:10:10Z", "author": {"login": "rolfyone"}, "path": "storage/src/testFixtures/java/tech/pegasys/teku/storage/server/rocksdb/core/MockRocksDbInstance.java", "diffHunk": "@@ -120,7 +121,9 @@ public static MockRocksDbInstance createEmpty(final Class<? extends Schema> sche\n   public <K, V> Stream<ColumnEntry<K, V>> stream(final RocksDbColumn<K, V> column) {\n     assertOpen();\n     assertValidColumn(column);\n-    return columnData.get(column).entrySet().stream().map(e -> columnEntry(column, e));\n+    return columnData.get(column).entrySet().stream()\n+        .peek(value -> assertOpen())", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0Njk4NzAyNw=="}, "originalCommit": {"oid": "f27ef211cd17f1658780d5e7f114de911af7dc17"}, "originalPosition": 14}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjc4NTk3MzI3OnYy", "diffSide": "RIGHT", "path": "storage/src/main/java/tech/pegasys/teku/storage/server/rocksdb/core/RocksDbIterator.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yOVQxNDo0MDoyMlrOGqUJFQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yOVQxNDo0MDoyMlrOGqUJFQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NzAyMzM4MQ==", "bodyText": "(optional) While we're here:\n\n  \n    \n  \n    \n\n  \n  This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters. Learn more about bidirectional Unicode characters\n\n\n  \n\n\n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                  throw new IllegalStateException(\"Attempt to update a closed transaction\");\n          \n          \n            \n                  throw new IllegalStateException(\"Attempt to update a closed \" + this.getClass().getSimpleName());", "url": "https://github.com/ConsenSys/teku/pull/2252#discussion_r447023381", "createdAt": "2020-06-29T14:40:22Z", "author": {"login": "mbaxter"}, "path": "storage/src/main/java/tech/pegasys/teku/storage/server/rocksdb/core/RocksDbIterator.java", "diffHunk": "@@ -93,6 +100,9 @@ public boolean hasNext() {\n   }\n \n   private void assertOpen() {\n+    if (this.isDatabaseClosed.get()) {\n+      throw new ShuttingDownException();\n+    }\n     if (closed.get()) {\n       throw new IllegalStateException(\"Attempt to update a closed transaction\");", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f27ef211cd17f1658780d5e7f114de911af7dc17"}, "originalPosition": 53}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3480, "cost": 1, "resetAt": "2021-11-12T11:57:46Z"}}}