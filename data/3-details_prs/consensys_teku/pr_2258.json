{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDQxNjk3MTkw", "number": 2258, "title": "[#1980] - validator subcommands status output", "bodyText": "PR Description\nAdd status output to teku validator subcommands. Hidden option -Xconfirm-enabled to be renamed to --verbose-output-enabled and not hidden anymore.\nFixed Issue(s)\nFix issue #1980\nDocumentation\n\n I thought about documentation and added the documentation label to this PR if updates are required.", "createdAt": "2020-06-29T23:20:22Z", "url": "https://github.com/ConsenSys/teku/pull/2258", "merged": true, "mergeCommit": {"oid": "52e96211e02a6cf5b2d5843fed2599ef38163abb"}, "closed": true, "closedAt": "2020-07-06T04:50:12Z", "author": {"login": "usmansaleem"}, "timelineItems": {"totalCount": 19, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcwJesTgH2gAyNDQxNjk3MTkwOmM1NzBiMzhiMDk0YjQ0ZjU5NzhlYWJkMDg3YjVlOTU4N2M5YjY5YmM=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcyJvR6gFqTQ0Mjc3MDY1NQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "c570b38b094b44f5978eabd087b5e9587c9b69bc", "author": {"user": {"login": "usmansaleem", "name": "Usman Saleem"}}, "url": "https://github.com/ConsenSys/teku/commit/c570b38b094b44f5978eabd087b5e9587c9b69bc", "committedDate": "2020-06-29T23:17:07Z", "message": "Deposit Generate Output\n\n -- Log encrypted file status\n\nSigned-off-by: Usman Saleem <usman@usmans.info>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "7df56e1d9f147114896f8fafd3263c61551b34c7", "author": {"user": {"login": "usmansaleem", "name": "Usman Saleem"}}, "url": "https://github.com/ConsenSys/teku/commit/7df56e1d9f147114896f8fafd3263c61551b34c7", "committedDate": "2020-06-29T23:18:29Z", "message": "Merge remote-tracking branch 'upstream/master' into deposit_generation_output\n\nSigned-off-by: Usman Saleem <usman@usmans.info>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "94c651d3061f94209d1b9413756f5912cf0a967d", "author": {"user": {"login": "usmansaleem", "name": "Usman Saleem"}}, "url": "https://github.com/ConsenSys/teku/commit/94c651d3061f94209d1b9413756f5912cf0a967d", "committedDate": "2020-06-29T23:23:00Z", "message": "spotless fix\n\nSigned-off-by: Usman Saleem <usman@usmans.info>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "48ebd11493b2f202a7b66278e556b5a980b70f49", "author": {"user": {"login": "usmansaleem", "name": "Usman Saleem"}}, "url": "https://github.com/ConsenSys/teku/commit/48ebd11493b2f202a7b66278e556b5a980b70f49", "committedDate": "2020-06-29T23:53:13Z", "message": "Update display confirmation with contract address and network\n\nSigned-off-by: Usman Saleem <usman@usmans.info>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e713456147fcdb7e39aca37af5629677b5d37485", "author": {"user": {"login": "usmansaleem", "name": "Usman Saleem"}}, "url": "https://github.com/ConsenSys/teku/commit/e713456147fcdb7e39aca37af5629677b5d37485", "committedDate": "2020-06-30T02:13:35Z", "message": "Display status messages for register deposit\n\nSigned-off-by: Usman Saleem <usman@usmans.info>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "0e6cb4f0a0bd21795030fee3021ef0c4c3ce15b4", "author": {"user": {"login": "usmansaleem", "name": "Usman Saleem"}}, "url": "https://github.com/ConsenSys/teku/commit/0e6cb4f0a0bd21795030fee3021ef0c4c3ce15b4", "committedDate": "2020-07-01T00:16:09Z", "message": "Adding status log in DepositRegisterCommand\n\nSigned-off-by: Usman Saleem <usman@usmans.info>"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDQwNDk5NDU0", "url": "https://github.com/ConsenSys/teku/pull/2258#pullrequestreview-440499454", "createdAt": "2020-07-01T02:04:38Z", "commit": {"oid": "0e6cb4f0a0bd21795030fee3021ef0c4c3ce15b4"}, "state": "COMMENTED", "comments": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wMVQwMjowNDozOFrOGrUU_Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wMVQwMjoxMDo1MVrOGrUbMA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0ODA3NTAwNQ==", "bodyText": "Does there need to be a noOp for error messages as well? Instead of noop method on the SubCommandLogger thinking that NoOp SubCommandLogger that doesn't output would be nicer.", "url": "https://github.com/ConsenSys/teku/pull/2258#discussion_r448075005", "createdAt": "2020-07-01T02:04:38Z", "author": {"login": "jframe"}, "path": "logging/src/main/java/tech/pegasys/teku/logging/SubCommandLogger.java", "diffHunk": "@@ -30,6 +30,10 @@ public void display(final String message) {\n     System.out.println(message);\n   }\n \n+  public void noOp(final String message) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "0e6cb4f0a0bd21795030fee3021ef0c4c3ce15b4"}, "originalPosition": 4}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0ODA3NTg2NQ==", "bodyText": "This I think could be part of the sendDeposit so it could be reused between both commands", "url": "https://github.com/ConsenSys/teku/pull/2258#discussion_r448075865", "createdAt": "2020-07-01T02:07:56Z", "author": {"login": "jframe"}, "path": "teku/src/main/java/tech/pegasys/teku/cli/deposit/DepositGenerateAndRegisterCommand.java", "diffHunk": "@@ -96,8 +97,34 @@ public void run() {\n   @NotNull\n   private Function<ValidatorKeys, SafeFuture<TransactionReceipt>> registerValidator(\n       final RegisterAction registerAction) {\n-    return validatorKey ->\n-        registerAction.sendDeposit(\n-            validatorKey.getValidatorKey(), validatorKey.getWithdrawalKey().getPublicKey());\n+    return validatorKey -> {\n+      final BLSKeyPair validatorKeyPair = validatorKey.getValidatorKey();\n+      final BLSKeyPair withdrawalKeyPair = validatorKey.getWithdrawalKey();\n+      if (displayConfirmation) {\n+        SUB_COMMAND_LOG.display(\n+            String.format(\n+                \"%nSending deposit for Validator Key [%s].%n\",\n+                validatorKeyPair.getPublicKey().toString()));\n+      }\n+\n+      final SafeFuture<TransactionReceipt> transactionReceiptSafeFuture =\n+          registerAction.sendDeposit(validatorKeyPair, withdrawalKeyPair.getPublicKey());\n+\n+      if (displayConfirmation) {\n+        transactionReceiptSafeFuture.finish(\n+            transactionReceipt ->\n+                SUB_COMMAND_LOG.display(\n+                    String.format(\n+                        \"Transaction for Validator Key [%s] Completed. Transaction Hash: [%s]%n\",\n+                        validatorKeyPair.getPublicKey().toString(),\n+                        transactionReceipt.getTransactionHash())),\n+            exception ->\n+                SUB_COMMAND_LOG.error(\n+                    String.format(\n+                        \"Transaction for Validator Key [%s] Failed: Message: [%s]%n\",\n+                        validatorKeyPair.getPublicKey().toString(), exception.getMessage())));\n+      }\n+      return transactionReceiptSafeFuture;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "0e6cb4f0a0bd21795030fee3021ef0c4c3ce15b4"}, "originalPosition": 42}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0ODA3NjIxMg==", "bodyText": "Should be a different flag I think, the displayConfirmation flag seems like different setting to suppressing the output", "url": "https://github.com/ConsenSys/teku/pull/2258#discussion_r448076212", "createdAt": "2020-07-01T02:09:23Z", "author": {"login": "jframe"}, "path": "teku/src/main/java/tech/pegasys/teku/cli/deposit/DepositGenerateAndRegisterCommand.java", "diffHunk": "@@ -96,8 +97,34 @@ public void run() {\n   @NotNull\n   private Function<ValidatorKeys, SafeFuture<TransactionReceipt>> registerValidator(\n       final RegisterAction registerAction) {\n-    return validatorKey ->\n-        registerAction.sendDeposit(\n-            validatorKey.getValidatorKey(), validatorKey.getWithdrawalKey().getPublicKey());\n+    return validatorKey -> {\n+      final BLSKeyPair validatorKeyPair = validatorKey.getValidatorKey();\n+      final BLSKeyPair withdrawalKeyPair = validatorKey.getWithdrawalKey();\n+      if (displayConfirmation) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "0e6cb4f0a0bd21795030fee3021ef0c4c3ce15b4"}, "originalPosition": 18}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0ODA3NjU5Mg==", "bodyText": "commandOuput instead of log? This has different purpose to the main logger", "url": "https://github.com/ConsenSys/teku/pull/2258#discussion_r448076592", "createdAt": "2020-07-01T02:10:51Z", "author": {"login": "jframe"}, "path": "teku/src/main/java/tech/pegasys/teku/cli/deposit/EncryptedKeystoreWriter.java", "diffHunk": "@@ -39,16 +40,19 @@\n   private final String validatorKeyPassword;\n   private final String withdrawalKeyPassword;\n   private final Path outputPath;\n+  private final Consumer<String> log;\n \n   public EncryptedKeystoreWriter(\n       final SecureRandom secureRandom,\n       final String validatorKeyPassword,\n       final String withdrawalKeyPassword,\n-      final Path outputPath) {\n+      final Path outputPath,\n+      final Consumer<String> log) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "0e6cb4f0a0bd21795030fee3021ef0c4c3ce15b4"}, "originalPosition": 20}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e72b4608fdf5bf75cd56df06d494c866de0c9828", "author": {"user": {"login": "usmansaleem", "name": "Usman Saleem"}}, "url": "https://github.com/ConsenSys/teku/commit/e72b4608fdf5bf75cd56df06d494c866de0c9828", "committedDate": "2020-07-02T00:52:24Z", "message": "Refactoring dev cli option displayConfirmation to quiet\n\nSigned-off-by: Usman Saleem <usman@usmans.info>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "7728d3586c27b16c9754da806a369e349e3abebc", "author": {"user": {"login": "usmansaleem", "name": "Usman Saleem"}}, "url": "https://github.com/ConsenSys/teku/commit/7728d3586c27b16c9754da806a369e349e3abebc", "committedDate": "2020-07-02T00:52:37Z", "message": "Merge remote-tracking branch 'upstream/master' into deposit_generation_output\n\nSigned-off-by: Usman Saleem <usman@usmans.info>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "5d8542855e3c2133e84d1bfb07b63eef99fd5095", "author": {"user": {"login": "usmansaleem", "name": "Usman Saleem"}}, "url": "https://github.com/ConsenSys/teku/commit/5d8542855e3c2133e84d1bfb07b63eef99fd5095", "committedDate": "2020-07-03T00:01:21Z", "message": "Merge remote-tracking branch 'upstream/master' into deposit_generation_output\n\nSigned-off-by: Usman Saleem <usman@usmans.info>"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDQyMTQ5NDA2", "url": "https://github.com/ConsenSys/teku/pull/2258#pullrequestreview-442149406", "createdAt": "2020-07-03T05:12:34Z", "commit": {"oid": "5d8542855e3c2133e84d1bfb07b63eef99fd5095"}, "state": "APPROVED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wM1QwNToxMjozNFrOGsj5hw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wM1QwNToxMjozNFrOGsj5hw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0OTM3ODY5NQ==", "bodyText": "nit: Not sure if this should be a hidden option. Seems like a sensible option to have?", "url": "https://github.com/ConsenSys/teku/pull/2258#discussion_r449378695", "createdAt": "2020-07-03T05:12:34Z", "author": {"login": "jframe"}, "path": "teku/src/main/java/tech/pegasys/teku/cli/deposit/DepositGenerateAndRegisterCommand.java", "diffHunk": "@@ -50,11 +50,9 @@\n   @Mixin private GenerateParams generateParams;\n \n   @Option(\n-      names = {\"--Xconfirm-enabled\"},\n-      arity = \"1\",\n-      defaultValue = \"true\",\n+      names = {\"--Xquiet\"},\n       hidden = true)", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "5d8542855e3c2133e84d1bfb07b63eef99fd5095"}, "originalPosition": 8}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "516e18120a4bad782ad8599938f90583f48aea07", "author": {"user": {"login": "usmansaleem", "name": "Usman Saleem"}}, "url": "https://github.com/ConsenSys/teku/commit/516e18120a4bad782ad8599938f90583f48aea07", "committedDate": "2020-07-03T05:43:12Z", "message": "Merge remote-tracking branch 'upstream/master' into deposit_generation_output\n\nSigned-off-by: Usman Saleem <usman@usmans.info>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "808452da029d5acd85e6841873168f4f14c1103b", "author": {"user": {"login": "usmansaleem", "name": "Usman Saleem"}}, "url": "https://github.com/ConsenSys/teku/commit/808452da029d5acd85e6841873168f4f14c1103b", "committedDate": "2020-07-06T00:59:17Z", "message": "Merge remote-tracking branch 'upstream/master' into deposit_generation_output\n\nSigned-off-by: Usman Saleem <usman@usmans.info>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "aec7f47989debd55a0a24dc2f13cb810abe74834", "author": {"user": {"login": "usmansaleem", "name": "Usman Saleem"}}, "url": "https://github.com/ConsenSys/teku/commit/aec7f47989debd55a0a24dc2f13cb810abe74834", "committedDate": "2020-07-06T02:08:56Z", "message": "Renaming -Xconfirm-enabled to --verbose-output-enabled\n\nSigned-off-by: Usman Saleem <usman@usmans.info>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "5d7497b61e6ba4b698c414a86b83bc48b111449c", "author": {"user": {"login": "usmansaleem", "name": "Usman Saleem"}}, "url": "https://github.com/ConsenSys/teku/commit/5d7497b61e6ba4b698c414a86b83bc48b111449c", "committedDate": "2020-07-06T02:13:48Z", "message": "Assigining explicit default value to variable\n\nSigned-off-by: Usman Saleem <usman@usmans.info>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "fb5c7d885a1b465f89bc7abdd2556fcdf88b1493", "author": {"user": {"login": "usmansaleem", "name": "Usman Saleem"}}, "url": "https://github.com/ConsenSys/teku/commit/fb5c7d885a1b465f89bc7abdd2556fcdf88b1493", "committedDate": "2020-07-06T02:16:31Z", "message": "reverting changes in test method names\n\nSigned-off-by: Usman Saleem <usman@usmans.info>"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDQyNzUzMjA0", "url": "https://github.com/ConsenSys/teku/pull/2258#pullrequestreview-442753204", "createdAt": "2020-07-06T03:22:51Z", "commit": {"oid": "fb5c7d885a1b465f89bc7abdd2556fcdf88b1493"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wNlQwMzoyMjo1MlrOGtHtIg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wNlQwMzoyMjo1MlrOGtHtIg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0OTk2NTM0Ng==", "bodyText": "This is misleading.  The transfer is happening on the ETH1 network but this statement is reporting the ETH2 network.  What network the transfer happens on is controlled by what chain the ETH1 endpoint is sync'd to and nothing this tool can do will change that.", "url": "https://github.com/ConsenSys/teku/pull/2258#discussion_r449965346", "createdAt": "2020-07-06T03:22:52Z", "author": {"login": "ajsutton"}, "path": "teku/src/main/java/tech/pegasys/teku/cli/deposit/RegisterAction.java", "diffHunk": "@@ -100,8 +110,10 @@ public void displayConfirmation(final int totalNumberOfDeposits) {\n         consoleAdapter.readLine(\n             \"You are about to submit \"\n                 + transactionPart\n-                + \" of %s Eth. This is irreversible, please make sure you understand the consequences. Are you sure you want to continue? [y/n]\",\n-            eth);\n+                + \" of %s Eth to contract address [%s] on network [%s].\\nThis is irreversible, please make sure you understand the consequences. Are you sure you want to continue? [y/n]\",", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "fb5c7d885a1b465f89bc7abdd2556fcdf88b1493"}, "originalPosition": 67}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c52c1374d968cdfdadb27a016a76dd3c4b6702d0", "author": {"user": {"login": "usmansaleem", "name": "Usman Saleem"}}, "url": "https://github.com/ConsenSys/teku/commit/c52c1374d968cdfdadb27a016a76dd3c4b6702d0", "committedDate": "2020-07-06T04:27:36Z", "message": "review suggestion - taking network out from confirmation message for registration\n\nSigned-off-by: Usman Saleem <usman@usmans.info>"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDQyNzcwNjU1", "url": "https://github.com/ConsenSys/teku/pull/2258#pullrequestreview-442770655", "createdAt": "2020-07-06T04:43:05Z", "commit": {"oid": "c52c1374d968cdfdadb27a016a76dd3c4b6702d0"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3762, "cost": 1, "resetAt": "2021-11-01T13:51:04Z"}}}