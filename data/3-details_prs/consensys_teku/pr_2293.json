{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDQzMTAwMzk4", "number": 2293, "title": "add a metric to track connected eth2 nodes similar to api and console", "bodyText": "added beacon_peer_count to track connections in the same way the API does\n\n\nadded regression test to show metric working.\n\n\nfixes #2177\nSigned-off-by: Paul Harris paul.harris@consensys.net\nDocumentation\n\n I thought about documentation and added the documentation label to this PR if updates are required.", "createdAt": "2020-07-02T00:18:39Z", "url": "https://github.com/ConsenSys/teku/pull/2293", "merged": true, "mergeCommit": {"oid": "6934e34a34c841c8d8c80621f469851b245d5d6e"}, "closed": true, "closedAt": "2020-07-02T02:54:13Z", "author": {"login": "rolfyone"}, "timelineItems": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcwzhpAgH2gAyNDQzMTAwMzk4OjBmY2Y4Y2ZkM2MzYjJhZTRiZTdiYjJjZjM4N2U5Y2Y4MDg2ZmZmNjM=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcw1aagAH2gAyNDQzMTAwMzk4OjIwMDFkNDM5MjAzYjhiMmQxMTFjYTJhNzhjNWU5MGQ4NzA4ZGY4NDU=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "0fcf8cfd3c3b2ae4be7bb2cf387e9cf8086fff63", "author": {"user": {"login": "rolfyone", "name": "Paul Harris"}}, "url": "https://github.com/ConsenSys/teku/commit/0fcf8cfd3c3b2ae4be7bb2cf387e9cf8086fff63", "committedDate": "2020-07-02T00:16:21Z", "message": "add a metric to track connected eth2 nodes similar to api and console\n\n - added beacon_peer_count to track connections in the same way the API does\n\n - added regression test to show metric working.\n\nfixes #2177\n\nSigned-off-by: Paul Harris <paul.harris@consensys.net>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "608534e77c097655ad52c8af53e9f210e42a82ea", "author": {"user": {"login": "rolfyone", "name": "Paul Harris"}}, "url": "https://github.com/ConsenSys/teku/commit/608534e77c097655ad52c8af53e9f210e42a82ea", "committedDate": "2020-07-02T00:23:23Z", "message": "add changelog entry.\n\nSigned-off-by: Paul Harris <paul.harris@consensys.net>"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDQxMjgwMjUw", "url": "https://github.com/ConsenSys/teku/pull/2293#pullrequestreview-441280250", "createdAt": "2020-07-02T00:47:52Z", "commit": {"oid": "608534e77c097655ad52c8af53e9f210e42a82ea"}, "state": "APPROVED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wMlQwMDo0Nzo1MlrOGr5wRw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wMlQwMDo0Nzo1MlrOGr5wRw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0ODY4ODE5OQ==", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                    \"Tracks number of connected peers\",\n          \n          \n            \n                    \"Tracks number of connected peers, verified to be on the same chain\",\n          \n      \n    \n    \n  \n\nWe may need to update the description for the libp2p_peer_count metric as well to make it clear that it's counting connections - otherwise people will just be confused why we have two metrics for the same thing with different values.", "url": "https://github.com/ConsenSys/teku/pull/2293#discussion_r448688199", "createdAt": "2020-07-02T00:47:52Z", "author": {"login": "ajsutton"}, "path": "services/beaconchain/src/main/java/tech/pegasys/teku/services/beaconchain/BeaconChainMetrics.java", "diffHunk": "@@ -104,6 +108,11 @@ public BeaconChainMetrics(\n         \"previous_justified_root\",\n         \"Current previously justified root\",\n         this::getPreviousJustifiedRootValue);\n+    metricsSystem.createGauge(\n+        TekuMetricCategory.BEACON,\n+        \"peer_count\",\n+        \"Tracks number of connected peers\",", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "608534e77c097655ad52c8af53e9f210e42a82ea"}, "originalPosition": 27}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "2001d439203b8b2d111ca2a78c5e90d8708df845", "author": {"user": {"login": "rolfyone", "name": "Paul Harris"}}, "url": "https://github.com/ConsenSys/teku/commit/2001d439203b8b2d111ca2a78c5e90d8708df845", "committedDate": "2020-07-02T02:28:16Z", "message": "review comment addressed.\n\nSigned-off-by: Paul Harris <paul.harris@consensys.net>"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3783, "cost": 1, "resetAt": "2021-11-01T13:51:04Z"}}}