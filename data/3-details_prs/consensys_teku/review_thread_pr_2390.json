{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDUzNzI4Njg4", "number": 2390, "reviewThreads": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yMFQyMTowMTozNVrOEQXrmQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yMFQyMTowMTozNVrOEQXrmQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjg1NjAwNjY1OnYy", "diffSide": "RIGHT", "path": "validator/coordinator/src/main/java/tech/pegasys/teku/validator/coordinator/DepositProvider.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yMFQyMTowMTozNVrOG0fJhA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yMFQyMTowMTozNVrOG0fJhA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NzY4OTQ3Ng==", "bodyText": "Probably should just log an error here and exit rather than throwing.  It should never happen so probably doesn't matter but if the checkpoint state isn't available it's not actually that big a deal - we just won't prune deposits so don't want to be too noisy about it.", "url": "https://github.com/ConsenSys/teku/pull/2390#discussion_r457689476", "createdAt": "2020-07-20T21:01:35Z", "author": {"login": "ajsutton"}, "path": "validator/coordinator/src/main/java/tech/pegasys/teku/validator/coordinator/DepositProvider.java", "diffHunk": "@@ -80,14 +80,22 @@ public synchronized void onDepositsFromBlock(DepositsFromBlockEvent event) {\n   }\n \n   @Override\n-  public synchronized void onNewFinalizedCheckpoint(final Checkpoint checkpoint) {\n-    BeaconState finalizedState =\n-        recentChainData\n-            .getBlockState(checkpoint.getRoot())\n-            .orElseThrow(\n-                () -> new IllegalArgumentException(\"Finalized Checkpoint state can not be found.\"));\n-\n-    depositNavigableMap.headMap(finalizedState.getEth1_deposit_index(), false).clear();\n+  public void onNewFinalizedCheckpoint(final Checkpoint checkpoint) {\n+    recentChainData\n+        .retrieveBlockState(checkpoint.getRoot())\n+        .thenAccept(\n+            finalizedState -> {\n+              if (finalizedState.isEmpty()) {\n+                throw new IllegalStateException(\"Finalized Checkpoint state cannot be found.\");", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "24ca5afde7f5589e6cef577d73362ce45fbff586"}, "originalPosition": 18}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3415, "cost": 1, "resetAt": "2021-11-12T11:57:46Z"}}}