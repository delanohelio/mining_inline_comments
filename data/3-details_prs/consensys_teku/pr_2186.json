{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDM3NjIwNTQ4", "number": 2186, "title": "Use separate transactions when updating finalized state vs hot state", "bodyText": "PR Description\nUse separate database transactions when updating finalised data vs hot data.  This will pave the way for them being in different RocksDB instances in the future.\nIf we crash between writing finalised state and hot state, when we restart and finalise an epoch we'll wind up rewriting the finalised data as part of that update but everything works out.\nFixed Issue(s)\nfixes #2182\nDocumentation\n\n I thought about documentation and added the documentation label to this PR if updates are required.", "createdAt": "2020-06-22T00:09:46Z", "url": "https://github.com/ConsenSys/teku/pull/2186", "merged": true, "mergeCommit": {"oid": "a1598b56e393f5af172b6dc6f0c0740315f42645"}, "closed": true, "closedAt": "2020-06-22T02:57:14Z", "author": {"login": "ajsutton"}, "timelineItems": {"totalCount": 5, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABctlZRfAH2gAyNDM3NjIwNTQ4OjVmYmQyOTViMzE2YTA2NWZmMGM2OGRhMzQ4OGU3ZDllZTNjMjIwMDQ=", "endCursor": "Y3Vyc29yOnYyOpPPAAABctmn9ngFqTQzNDU1NzM1Mg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "5fbd295b316a065ff0c68da3488e7d9ee3c22004", "author": {"user": {"login": "ajsutton", "name": "Adrian Sutton"}}, "url": "https://github.com/ConsenSys/teku/commit/5fbd295b316a065ff0c68da3488e7d9ee3c22004", "committedDate": "2020-06-22T00:06:46Z", "message": "Use separate transactions when updating finalized state vs hot state."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "0d3cf770a2977e295f40b08c39df9b0028490cac", "author": {"user": {"login": "ajsutton", "name": "Adrian Sutton"}}, "url": "https://github.com/ConsenSys/teku/commit/0d3cf770a2977e295f40b08c39df9b0028490cac", "committedDate": "2020-06-22T00:34:38Z", "message": "Split RocksDbDao into separate interfaces for hot, finalized and eth1 data."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "18ea9af6fd3a5d9ed0e758a1c6b91df8bafa4838", "author": {"user": {"login": "ajsutton", "name": "Adrian Sutton"}}, "url": "https://github.com/ConsenSys/teku/commit/18ea9af6fd3a5d9ed0e758a1c6b91df8bafa4838", "committedDate": "2020-06-22T01:13:26Z", "message": "Move latest finalized state to hot dao so it's in sync with finalized checkpoint.\nAdd some comments."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDM0NTU0Njgx", "url": "https://github.com/ConsenSys/teku/pull/2186#pullrequestreview-434554681", "createdAt": "2020-06-22T01:17:24Z", "commit": {"oid": "18ea9af6fd3a5d9ed0e758a1c6b91df8bafa4838"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yMlQwMToxNzoyNFrOGmvjrA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yMlQwMToxNzoyNFrOGmvjrA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MzI3ODI1Mg==", "bodyText": "would commit failure here cause unhandled exceptions?", "url": "https://github.com/ConsenSys/teku/pull/2186#discussion_r443278252", "createdAt": "2020-06-22T01:17:24Z", "author": {"login": "rolfyone"}, "path": "storage/src/main/java/tech/pegasys/teku/storage/server/rocksdb/RocksDbDatabase.java", "diffHunk": "@@ -98,13 +109,14 @@ public void storeGenesis(final UpdatableStore store) {\n         // We need to store the genesis block in both hot and cold storage so that on restart\n         // we're guaranteed to have at least one block / state to load into RecentChainData.\n         // Save to hot storage\n-        updater.addHotBlock(block);\n+        hotUpdater.addHotBlock(block);\n         // Save to cold storage\n-        updater.addFinalizedBlock(block);\n-        putFinalizedState(updater, root, state);\n+        finalizedUpdater.addFinalizedBlock(block);\n+        putFinalizedState(finalizedUpdater, root, state);\n       }\n \n-      updater.commit();\n+      finalizedUpdater.commit();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "18ea9af6fd3a5d9ed0e758a1c6b91df8bafa4838"}, "originalPosition": 89}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDM0NTU3MzUy", "url": "https://github.com/ConsenSys/teku/pull/2186#pullrequestreview-434557352", "createdAt": "2020-06-22T01:32:43Z", "commit": {"oid": "18ea9af6fd3a5d9ed0e758a1c6b91df8bafa4838"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3950, "cost": 1, "resetAt": "2021-11-01T13:51:04Z"}}}