{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0Mzk1MjQzMjUy", "number": 1499, "title": "beaconchain: enable processing of slot heads during sync and improve logging", "bodyText": "PR Description\nThis pull request tries to optimize the event logger in regard to how many lines of logs are produced per event, ideally, not more than 1.\nThis adds more verbosity to the epoch and slot event logs.\nThis fixes the terminal color palette used (white was black somehow).\n\nThis enables the processing of head slots during sync.\n\nThis adds a syncEvent to EventLogger to enable sync status logging during initial synchronization.\n\nFixed Issue(s)\nThis fixes #1497", "createdAt": "2020-03-29T12:28:53Z", "url": "https://github.com/ConsenSys/teku/pull/1499", "merged": true, "mergeCommit": {"oid": "95299a189af6929c435dbe7a000a047959b171ed"}, "closed": true, "closedAt": "2020-03-31T11:18:55Z", "author": {"login": "q9f"}, "timelineItems": {"totalCount": 13, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcSZBtogH2gAyMzk1MjQzMjUyOjU3YTk2ZGQ1MDhhYzdmNjEyZWIwODExZjM5MjAzNjc2NmU5N2M0NmE=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcS9TI7AH2gAyMzk1MjQzMjUyOjZlNDc0ZTNhOWJhZjYyMDk1NjZmZTljMWQwZTE4NzEwNDQ3ZGY5ZDg=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "57a96dd508ac7f612eb0811f392036766e97c46a", "author": {"user": {"login": "q9f", "name": "Afr Schoe"}}, "url": "https://github.com/ConsenSys/teku/commit/57a96dd508ac7f612eb0811f392036766e97c46a", "committedDate": "2020-03-29T12:26:13Z", "message": "logging: condense log output to one-liners\n\nSigned-off-by: /raw PONG _GHMoaCXLT <58883403+q9f@users.noreply.github.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "1efe5d2fedcede2c08a2c3320602ea2363707090", "author": {"user": {"login": "q9f", "name": "Afr Schoe"}}, "url": "https://github.com/ConsenSys/teku/commit/1efe5d2fedcede2c08a2c3320602ea2363707090", "committedDate": "2020-03-29T13:06:32Z", "message": "services/beaconchain: improve verbosity of epoch and slot events\n\nSigned-off-by: /raw PONG _GHMoaCXLT <58883403+q9f@users.noreply.github.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "d9937cfa5cebd3b0d83d94ddb41542fe46df9ace", "author": {"user": {"login": "q9f", "name": "Afr Schoe"}}, "url": "https://github.com/ConsenSys/teku/commit/d9937cfa5cebd3b0d83d94ddb41542fe46df9ace", "committedDate": "2020-03-29T13:26:33Z", "message": "logging: use a standard 8 color terminal palette\n\nSigned-off-by: /raw PONG _GHMoaCXLT <58883403+q9f@users.noreply.github.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "9fb53f4c6215e8cb5a4c49fd9f172a47f69c9079", "author": {"user": {"login": "q9f", "name": "Afr Schoe"}}, "url": "https://github.com/ConsenSys/teku/commit/9fb53f4c6215e8cb5a4c49fd9f172a47f69c9079", "committedDate": "2020-03-29T13:38:33Z", "message": "logging: improve display of shortened root hash\n\nSigned-off-by: /raw PONG _GHMoaCXLT <58883403+q9f@users.noreply.github.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "66e18fa4b681b31f420b8d5c1375fafce1a1c49e", "author": {"user": {"login": "q9f", "name": "Afr Schoe"}}, "url": "https://github.com/ConsenSys/teku/commit/66e18fa4b681b31f420b8d5c1375fafce1a1c49e", "committedDate": "2020-03-29T13:41:33Z", "message": "services/beaconchain: enable processing of slots during sync\n\nSigned-off-by: /raw PONG _GHMoaCXLT <58883403+q9f@users.noreply.github.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f9f5a2f61ed0ffe7f70aa848e4d078578e99f946", "author": {"user": {"login": "q9f", "name": "Afr Schoe"}}, "url": "https://github.com/ConsenSys/teku/commit/f9f5a2f61ed0ffe7f70aa848e4d078578e99f946", "committedDate": "2020-03-29T16:06:32Z", "message": "logging: add a syncEvent to EventLogger\n\nSigned-off-by: /raw PONG _GHMoaCXLT <58883403+q9f@users.noreply.github.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "22929c70b33015f817f6decdadb783de8af2d397", "author": {"user": {"login": "q9f", "name": "Afr Schoe"}}, "url": "https://github.com/ConsenSys/teku/commit/22929c70b33015f817f6decdadb783de8af2d397", "committedDate": "2020-03-29T16:07:14Z", "message": "services/beaconchain: log syncEvent instead of slotEvent during sync\n\nSigned-off-by: /raw PONG _GHMoaCXLT <58883403+q9f@users.noreply.github.com>"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzgzNDczNTk2", "url": "https://github.com/ConsenSys/teku/pull/1499#pullrequestreview-383473596", "createdAt": "2020-03-30T00:12:45Z", "commit": {"oid": "22929c70b33015f817f6decdadb783de8af2d397"}, "state": "COMMENTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0zMFQwMDoxMjo0NVrOF9Wcrw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0zMFQwMTo1OToxNlrOF9XdBA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5OTg3NTI0Nw==", "bodyText": "It doesn't show in the GitHub UI but the second of these asterisks is slightly superscript.  Was that intentional? It's kind of cool but slightly disconcerting...", "url": "https://github.com/ConsenSys/teku/pull/1499#discussion_r399875247", "createdAt": "2020-03-30T00:12:45Z", "author": {"login": "ajsutton"}, "path": "logging/src/main/java/tech/pegasys/teku/logging/EventLogger.java", "diffHunk": "@@ -33,25 +33,52 @@ private EventLogger(final String name) {\n   }\n \n   public void genesisEvent(final Bytes32 hashTreeRoot, final Bytes32 genesisBlockRoot) {\n-    info(\"******* Eth2Genesis Event*******\", Color.WHITE);\n-    log.info(\"Initial state root is {}\", hashTreeRoot.toHexString());\n-    log.info(\"Genesis block root is {}\", genesisBlockRoot.toHexString());\n+    final String genesisEventLog =\n+        String.format(\n+            \"Genesis Event *** Initial state root: %s, Genesis block root: %s\",", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "22929c70b33015f817f6decdadb783de8af2d397"}, "originalPosition": 9}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5OTg5MTcxNg==", "bodyText": "We've wound up re-enabling quite a lot of processing by removing the isSyncActive check here. Time event handling is an area that's still pretty messy (hence the Thread.sleep calls in here) and since our fork choice isn't yet optimised we can wind up failing to keep up with these tick events which cause a bunch of other issues.  The early abort while syncing is a bit of a band-aid fix for that while we work through a complete solution.\nI've played around with it a bit and my suggestion would be 18c0ed2. It still winds up running fork choice on each slot while syncing which hurts at the moment since it's unoptimised but I think gives the results we need without doing any unnecessary work.", "url": "https://github.com/ConsenSys/teku/pull/1499#discussion_r399891716", "createdAt": "2020-03-30T01:59:16Z", "author": {"login": "ajsutton"}, "path": "services/beaconchain/src/main/java/tech/pegasys/artemis/services/beaconchain/BeaconChainController.java", "diffHunk": "@@ -380,7 +380,7 @@ private void onStoreInitialized() {\n \n   @Override\n   public void onTick(Date date) {\n-    if (chainStorageClient.isPreGenesis() || syncService.isSyncActive()) {\n+    if (chainStorageClient.isPreGenesis()) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "22929c70b33015f817f6decdadb783de8af2d397"}, "originalPosition": 5}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "141fe809fdfaaf7aca479154b1325be49c50bd97", "author": {"user": {"login": "q9f", "name": "Afr Schoe"}}, "url": "https://github.com/ConsenSys/teku/commit/141fe809fdfaaf7aca479154b1325be49c50bd97", "committedDate": "2020-03-30T11:52:16Z", "message": "services/beaconchain: tweak onTick logic to reduce processing during sync\n\nSigned-off-by: q9f <58883403+q9f@users.noreply.github.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "19334d27f7b2d2aa569b76589dd329f488bd30f5", "author": {"user": {"login": "q9f", "name": "Afr Schoe"}}, "url": "https://github.com/ConsenSys/teku/commit/19334d27f7b2d2aa569b76589dd329f488bd30f5", "committedDate": "2020-03-30T11:54:30Z", "message": "Merge branch 'master' into q9-logger"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzg0MDcwNDcx", "url": "https://github.com/ConsenSys/teku/pull/1499#pullrequestreview-384070471", "createdAt": "2020-03-30T17:21:56Z", "commit": {"oid": "19334d27f7b2d2aa569b76589dd329f488bd30f5"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "9604f5302ee36ecd7f91ccff31d37e7e8535f640", "author": {"user": {"login": "q9f", "name": "Afr Schoe"}}, "url": "https://github.com/ConsenSys/teku/commit/9604f5302ee36ecd7f91ccff31d37e7e8535f640", "committedDate": "2020-03-30T19:49:11Z", "message": "Resolve conflicts with master"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "6e474e3a9baf6209566fe9c1d0e18710447df9d8", "author": {"user": {"login": "q9f", "name": "Afr Schoe"}}, "url": "https://github.com/ConsenSys/teku/commit/6e474e3a9baf6209566fe9c1d0e18710447df9d8", "committedDate": "2020-03-31T06:41:50Z", "message": "Merge branch 'master' into q9-logger"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4409, "cost": 1, "resetAt": "2021-11-01T13:51:04Z"}}}