{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTAwMzM1NTI5", "number": 2931, "title": "Support standard event source for remote validator", "bodyText": "PR Description\nWhen the web socket end point is not set for a remote validator, it will now use an independent timer and based attestation creation and reorg handling off of the standard API event source.\nThere's quite a few changes but most are just moving around the initialisation code for the validator client so the difference between remote and inprocess setup is contained (and so remote can share a single OkHttpClient instance).\nFixed Issue(s)\n#1918\nDocumentation\n\n I thought about documentation and added the documentation label to this PR if updates are required.", "createdAt": "2020-10-09T04:26:00Z", "url": "https://github.com/ConsenSys/teku/pull/2931", "merged": true, "mergeCommit": {"oid": "d6258f6e457b1eae1d8bea7fd7485579447eae82"}, "closed": true, "closedAt": "2020-10-09T10:25:02Z", "author": {"login": "ajsutton"}, "timelineItems": {"totalCount": 17, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdQqVqjAH2gAyNTAwMzM1NTI5OjQwNjNkMDViNmE1ZjRlNjE0MjA5NjExNmU1ODdlMmE1ZjcxMjVlZDE=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdQzVzmAH2gAyNTAwMzM1NTI5OjFjNjZjYTczMmJmMDQ1ZGU1NGUwOTRhMGZhM2NkMWJkOTA0Zjc0ZTk=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "4063d05b6a5f4e6142096116e587e2a5f7125ed1", "author": {"user": {"login": "ajsutton", "name": "Adrian Sutton"}}, "url": "https://github.com/ConsenSys/teku/commit/4063d05b6a5f4e6142096116e587e2a5f7125ed1", "committedDate": "2020-10-08T23:39:42Z", "message": "Add eventsource client dependency"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b1caff825828485dc89c1a62d58d813eaa9c7afb", "author": {"user": {"login": "ajsutton", "name": "Adrian Sutton"}}, "url": "https://github.com/ConsenSys/teku/commit/b1caff825828485dc89c1a62d58d813eaa9c7afb", "committedDate": "2020-10-09T01:17:24Z", "message": "Introduce independent timer based validator events for remote validators."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "17b937377bb16d9aa6b5e10945fb1df163cb0377", "author": {"user": {"login": "ajsutton", "name": "Adrian Sutton"}}, "url": "https://github.com/ConsenSys/teku/commit/17b937377bb16d9aa6b5e10945fb1df163cb0377", "committedDate": "2020-10-09T03:24:52Z", "message": "Use independent timer automatically if websocket endpoint is not specified."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "2b9d1e984c328765f88e02590125a01648dbd453", "author": {"user": {"login": "ajsutton", "name": "Adrian Sutton"}}, "url": "https://github.com/ConsenSys/teku/commit/2b9d1e984c328765f88e02590125a01648dbd453", "committedDate": "2020-10-09T03:25:16Z", "message": "Merge branch 'master' of github.com:PegaSysEng/teku into remote-validator-event-source"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b8dfcd008d9ac190016966030cb0ebf57a32c48f", "author": {"user": {"login": "ajsutton", "name": "Adrian Sutton"}}, "url": "https://github.com/ConsenSys/teku/commit/b8dfcd008d9ac190016966030cb0ebf57a32c48f", "committedDate": "2020-10-09T03:35:29Z", "message": "Merge branch 'master' of github.com:PegaSysEng/teku into remote-validator-event-source"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b594b32bbd721781bac98fd8d1d64fb3c40694d0", "author": {"user": {"login": "ajsutton", "name": "Adrian Sutton"}}, "url": "https://github.com/ConsenSys/teku/commit/b594b32bbd721781bac98fd8d1d64fb3c40694d0", "committedDate": "2020-10-09T03:57:19Z", "message": "Fix NullPointerException.\nDon't execute tasks if the delayed event runs slightly before it is due."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "bda488dae6925687eca026bb7107dfe46556fba8", "author": {"user": {"login": "ajsutton", "name": "Adrian Sutton"}}, "url": "https://github.com/ConsenSys/teku/commit/bda488dae6925687eca026bb7107dfe46556fba8", "committedDate": "2020-10-09T04:01:53Z", "message": "Don't default current epoch to zero, it may cause us to calculate duties from way too far back."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "56db9f042466d463c8d385a6c0b1b7503e1eec86", "author": {"user": {"login": "ajsutton", "name": "Adrian Sutton"}}, "url": "https://github.com/ConsenSys/teku/commit/56db9f042466d463c8d385a6c0b1b7503e1eec86", "committedDate": "2020-10-09T04:07:01Z", "message": "Add tests."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "49440f12215fc69d9ac6db7f867d002b58ac2b07", "author": {"user": {"login": "ajsutton", "name": "Adrian Sutton"}}, "url": "https://github.com/ConsenSys/teku/commit/49440f12215fc69d9ac6db7f867d002b58ac2b07", "committedDate": "2020-10-09T04:10:16Z", "message": "Move keep-alive thread to EventSourceBeaconChainEventAdapter since it's only needed when that's in use."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "bd76c30c4e212d2c9f5a1883c151a316b98019f9", "author": {"user": {"login": "ajsutton", "name": "Adrian Sutton"}}, "url": "https://github.com/ConsenSys/teku/commit/bd76c30c4e212d2c9f5a1883c151a316b98019f9", "committedDate": "2020-10-09T04:25:41Z", "message": "Add tests for handler and handle invalid messages."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "83742025a5d8d2b92b7e07b6b97b304bb245d4cc", "author": {"user": {"login": "ajsutton", "name": "Adrian Sutton"}}, "url": "https://github.com/ConsenSys/teku/commit/83742025a5d8d2b92b7e07b6b97b304bb245d4cc", "committedDate": "2020-10-09T04:26:22Z", "message": "Merge branch 'master' of github.com:PegaSysEng/teku into remote-validator-event-source"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f1e8eedc9e91b8628e64bf2232ddd9ea24037200", "author": {"user": {"login": "ajsutton", "name": "Adrian Sutton"}}, "url": "https://github.com/ConsenSys/teku/commit/f1e8eedc9e91b8628e64bf2232ddd9ea24037200", "committedDate": "2020-10-09T04:32:31Z", "message": "Remove unused field."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTA1MzgxNDA0", "url": "https://github.com/ConsenSys/teku/pull/2931#pullrequestreview-505381404", "createdAt": "2020-10-09T05:58:06Z", "commit": {"oid": "f1e8eedc9e91b8628e64bf2232ddd9ea24037200"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wOVQwNTo1ODowNlrOHe8Izw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wOVQwNTo1ODowNlrOHe8Izw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMjIwNDYyMw==", "bodyText": "this is basically tech.pegasys.teku.beaconrestapi.handlers.v1.events.EventType - should we use the same?", "url": "https://github.com/ConsenSys/teku/pull/2931#discussion_r502204623", "createdAt": "2020-10-09T05:58:06Z", "author": {"login": "rolfyone"}, "path": "validator/remote/src/main/java/tech/pegasys/teku/validator/remote/EventTypes.java", "diffHunk": "@@ -0,0 +1,19 @@\n+/*\n+ * Copyright 2020 ConsenSys AG.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\"); you may not use this file except in compliance with\n+ * the License. You may obtain a copy of the License at\n+ *\n+ * http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software distributed under the License is distributed on\n+ * an \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied. See the License for the\n+ * specific language governing permissions and limitations under the License.\n+ */\n+\n+package tech.pegasys.teku.validator.remote;\n+\n+public class EventTypes {\n+  public static final String HEAD = \"head\";\n+  public static final String CHAIN_REORG = \"chain_reorg\";\n+}", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f1e8eedc9e91b8628e64bf2232ddd9ea24037200"}, "originalPosition": 19}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTA1MzgxNzQx", "url": "https://github.com/ConsenSys/teku/pull/2931#pullrequestreview-505381741", "createdAt": "2020-10-09T05:59:07Z", "commit": {"oid": "f1e8eedc9e91b8628e64bf2232ddd9ea24037200"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "608c7de0a21e1c3489bb97ebc013753b95dc42b0", "author": {"user": {"login": "ajsutton", "name": "Adrian Sutton"}}, "url": "https://github.com/ConsenSys/teku/commit/608c7de0a21e1c3489bb97ebc013753b95dc42b0", "committedDate": "2020-10-09T09:45:57Z", "message": "Spotless."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "aa21372d0ea07147053ea03f7bd28617f038f07b", "author": {"user": {"login": "ajsutton", "name": "Adrian Sutton"}}, "url": "https://github.com/ConsenSys/teku/commit/aa21372d0ea07147053ea03f7bd28617f038f07b", "committedDate": "2020-10-09T09:53:46Z", "message": "Use EventType."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "1c66ca732bf045de54e094a0fa3cd1bd904f74e9", "author": {"user": {"login": "ajsutton", "name": "Adrian Sutton"}}, "url": "https://github.com/ConsenSys/teku/commit/1c66ca732bf045de54e094a0fa3cd1bd904f74e9", "committedDate": "2020-10-09T10:09:00Z", "message": "Fix tests."}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3327, "cost": 1, "resetAt": "2021-11-01T13:51:04Z"}}}