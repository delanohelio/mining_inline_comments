{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTE4NDExOTY5", "number": 3192, "title": "Make some tests Win compatible", "bodyText": "PR Description\nFixing tests which are failing on Win due to platform specifics\nDocumentation\n\n I thought about documentation and added the documentation label to this PR if updates are required.", "createdAt": "2020-11-10T11:13:41Z", "url": "https://github.com/ConsenSys/teku/pull/3192", "merged": true, "mergeCommit": {"oid": "b792cddc84947fe3ff384c77468c4269bf585982"}, "closed": true, "closedAt": "2020-11-11T08:22:06Z", "author": {"login": "Nashatyrev"}, "timelineItems": {"totalCount": 11, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdbGf8rgH2gAyNTE4NDExOTY5OjBkOWJmOGM5MDBmZDFjMjQ3YjIwZjIxMTJlNzk4NGEzNDc2ODlkMTI=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdbZL_jgH2gAyNTE4NDExOTY5OjYwNjMzZTI5MzNjNWRiMDMzMzk5NzY4YzdlMjY4NjQxODU3NjRlOTY=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "0d9bf8c900fd1c247b20f2112e7984a347689d12", "author": {"user": {"login": "Nashatyrev", "name": "Anton Nashatyrev"}}, "url": "https://github.com/ConsenSys/teku/commit/0d9bf8c900fd1c247b20f2112e7984a347689d12", "committedDate": "2020-11-10T10:07:31Z", "message": "Use system path separator for test"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ccf96d0d7d56d20e379e3769908b08c16bc7df24", "author": {"user": {"login": "Nashatyrev", "name": "Anton Nashatyrev"}}, "url": "https://github.com/ConsenSys/teku/commit/ccf96d0d7d56d20e379e3769908b08c16bc7df24", "committedDate": "2020-11-10T10:16:07Z", "message": "For Windows '.*' files are not hidden so just ignore these cases"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "0af2777a5beef4a2e1f32e683141ca38ed9841df", "author": {"user": {"login": "Nashatyrev", "name": "Anton Nashatyrev"}}, "url": "https://github.com/ConsenSys/teku/commit/0af2777a5beef4a2e1f32e683141ca38ed9841df", "committedDate": "2020-11-10T10:34:27Z", "message": "Creating symbolic links requires elevated privileges on Windows. Without them FileSystemException is thrown. So just catching any IOException on a link creation attempt would handle the Windows case (the test would be ignored)"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "82b6eac730467b8cdcfbe84638391230b1304560", "author": {"user": {"login": "Nashatyrev", "name": "Anton Nashatyrev"}}, "url": "https://github.com/ConsenSys/teku/commit/82b6eac730467b8cdcfbe84638391230b1304560", "committedDate": "2020-11-10T10:40:46Z", "message": "Spotless"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "97f9a676208e23fb973a496e2e179e47e3d1f8a4", "author": {"user": {"login": "Nashatyrev", "name": "Anton Nashatyrev"}}, "url": "https://github.com/ConsenSys/teku/commit/97f9a676208e23fb973a496e2e179e47e3d1f8a4", "committedDate": "2020-11-10T11:08:53Z", "message": "Make comparing multi-line strings cross-platform"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTI3MTA1NTA2", "url": "https://github.com/ConsenSys/teku/pull/3192#pullrequestreview-527105506", "createdAt": "2020-11-10T11:24:13Z", "commit": {"oid": "97f9a676208e23fb973a496e2e179e47e3d1f8a4"}, "state": "APPROVED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xMFQxMToyNDoxM1rOHwYH0A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xMFQxMToyNDoxM1rOHwYH0A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMDQ4ODkxMg==", "bodyText": "hmm, the JavaDoc explicitly says it will throw UnsupportedOperationException if symlinks aren't supported.  Probably should catch both exception types to be safe.", "url": "https://github.com/ConsenSys/teku/pull/3192#discussion_r520488912", "createdAt": "2020-11-10T11:24:13Z", "author": {"login": "ajsutton"}, "path": "util/src/test/java/tech/pegasys/teku/util/config/KeyStoreFilesLocatorTest.java", "diffHunk": "@@ -201,7 +199,7 @@ public void shouldHandleSymlinkedDirectories(@TempDir final Path tempDir) throws\n     try {\n       Files.createSymbolicLink(tempDir.resolve(\"key\"), realKeyDir);\n       Files.createSymbolicLink(tempDir.resolve(\"pass\"), realPassDir);\n-    } catch (UnsupportedOperationException e) {\n+    } catch (IOException e) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "97f9a676208e23fb973a496e2e179e47e3d1f8a4"}, "originalPosition": 66}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "355985a1ed0b2dcd80681bdacf4ed837daf05482", "author": {"user": {"login": "Nashatyrev", "name": "Anton Nashatyrev"}}, "url": "https://github.com/ConsenSys/teku/commit/355985a1ed0b2dcd80681bdacf4ed837daf05482", "committedDate": "2020-11-10T12:45:39Z", "message": "Temporarily adjust test to not fail on Windows"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "5af79c02d2655f5a04d362c64f318724f9bb816c", "author": {"user": {"login": "Nashatyrev", "name": "Anton Nashatyrev"}}, "url": "https://github.com/ConsenSys/teku/commit/5af79c02d2655f5a04d362c64f318724f9bb816c", "committedDate": "2020-11-10T12:52:56Z", "message": "Exclude KeyStoreFilesLocatorTest symlink testcase for Windows platform"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTI3MTc5MjIz", "url": "https://github.com/ConsenSys/teku/pull/3192#pullrequestreview-527179223", "createdAt": "2020-11-10T13:03:38Z", "commit": {"oid": "5af79c02d2655f5a04d362c64f318724f9bb816c"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xMFQxMzowMzozOFrOHwbjmQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xMFQxMzowMzozOFrOHwbjmQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMDU0NTE3Nw==", "bodyText": "This is a temporary change to discuss this test case\n@ajsutton when calling Files.newInputStream(path) with directory path on Windows there is the following exception:\njava.nio.file.AccessDeniedException: C:\\Users\\Admin\\AppData\\Local\\Temp\\junit10004047955021046840\n\n\tat java.base/sun.nio.fs.WindowsException.translateToIOException(WindowsException.java:89)\n\tat java.base/sun.nio.fs.WindowsException.rethrowAsIOException(WindowsException.java:103)\n\tat java.base/sun.nio.fs.WindowsException.rethrowAsIOException(WindowsException.java:108)\n\tat java.base/sun.nio.fs.WindowsFileSystemProvider.newByteChannel(WindowsFileSystemProvider.java:235)\n\tat java.base/java.nio.file.Files.newByteChannel(Files.java:370)\n\tat java.base/java.nio.file.Files.newByteChannel(Files.java:421)\n\tat java.base/java.nio.file.spi.FileSystemProvider.newInputStream(FileSystemProvider.java:420)\n\tat java.base/java.nio.file.Files.newInputStream(Files.java:155)\n\tat tech.pegasys.teku.infrastructure.io.resource.FileResourceLoader.load(FileResourceLoader.java:30)\n\tat tech.pegasys.teku.infrastructure.io.resource.FileResourceLoaderTest.shouldCreateInputStreamWhenPathIsADirectory(FileResourceLoaderTest.java:49)\n\nNot sure I got the rationale behind your comment and what InputStream should be returned in case of directory.\nI would suggest to either return empty when the path is directory or throw an exception.", "url": "https://github.com/ConsenSys/teku/pull/3192#discussion_r520545177", "createdAt": "2020-11-10T13:03:38Z", "author": {"login": "Nashatyrev"}, "path": "infrastructure/io/src/test/java/tech/pegasys/teku/infrastructure/io/resource/FileResourceLoaderTest.java", "diffHunk": "@@ -43,10 +43,7 @@ public void shouldReturnEmptyWhenFileDoesNotExist(@TempDir Path tempDir) throws\n   }\n \n   @Test\n-  public void shouldCreateInputStreamWhenPathIsADirectory(@TempDir Path tempDir) throws Exception {\n-    // We could potentially return empty for directories, but it is going to be confusing for users\n-    // to say we couldn't find something that exists. We should report that we couldn't read it.\n-    assertThat(loader.load(tempDir.toAbsolutePath().toString())).isNotEmpty();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "5af79c02d2655f5a04d362c64f318724f9bb816c"}, "originalPosition": 7}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "fce07bf82bf05bfd01e02b13dca1385d4436bac3", "author": {"user": {"login": "Nashatyrev", "name": "Anton Nashatyrev"}}, "url": "https://github.com/ConsenSys/teku/commit/fce07bf82bf05bfd01e02b13dca1385d4436bac3", "committedDate": "2020-11-11T07:44:01Z", "message": "Adjust FileResourceLoaderTest to work correctly on all platforms"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "60633e2933c5db033399768c7e26864185764e96", "author": {"user": {"login": "Nashatyrev", "name": "Anton Nashatyrev"}}, "url": "https://github.com/ConsenSys/teku/commit/60633e2933c5db033399768c7e26864185764e96", "committedDate": "2020-11-11T07:53:55Z", "message": "Merge branch 'master' into fix/win-keys-file-test"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4422, "cost": 1, "resetAt": "2021-11-01T13:51:04Z"}}}