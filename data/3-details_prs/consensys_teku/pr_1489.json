{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0Mzk0NDgzMDM2", "number": 1489, "title": "Use createUnsignedAttestation when creating attestations in ValidatorCoordinator", "bodyText": "PR Description\nSwitch ValidatorCoordinator over to using ValidatorApiChannel to create unsigned attestations.\nThis is a \"quick and dirty\" switch over so it's still using BeaconState as part of the signing process which shouldn't be available to the validator client and it's still untested.  Will rebuild it properly over in the separate validator client with tests in a follow up PR. This just ensures that our REST API and validator are actually generating attestations the same way.", "createdAt": "2020-03-27T00:06:47Z", "url": "https://github.com/ConsenSys/teku/pull/1489", "merged": true, "mergeCommit": {"oid": "3665a3870cb4d1cdafbaa82ba8dfc4b37930bb83"}, "closed": true, "closedAt": "2020-03-27T00:47:55Z", "author": {"login": "ajsutton"}, "timelineItems": {"totalCount": 6, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcRlKNZAH2gAyMzk0NDgzMDM2OjU2ZTVkZGUxOWNiY2EzMDZjOGZhNWYxZDliY2JmZDhmOGNlMmE5NWQ=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcRlrw2gH2gAyMzk0NDgzMDM2OmFkOTBlZDllNzBkMDdjMjYyM2RhZWViMTc2ZmQ5MTk3YTdiY2RkMWE=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "56e5dde19cbca306c8fa5f1d9bcbfd8f8ce2a95d", "author": {"user": {"login": "ajsutton", "name": "Adrian Sutton"}}, "url": "https://github.com/ConsenSys/teku/commit/56e5dde19cbca306c8fa5f1d9bcbfd8f8ce2a95d", "committedDate": "2020-03-27T00:00:26Z", "message": "Use createUnsignedAttestation when creating attestations in ValidatorCoordinator."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "287e65431e7653e25e2a17164eb4a2c5491bdede", "author": {"user": {"login": "ajsutton", "name": "Adrian Sutton"}}, "url": "https://github.com/ConsenSys/teku/commit/287e65431e7653e25e2a17164eb4a2c5491bdede", "committedDate": "2020-03-27T00:16:00Z", "message": "Use existing bitlist."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzgyNTA4NDMw", "url": "https://github.com/ConsenSys/teku/pull/1489#pullrequestreview-382508430", "createdAt": "2020-03-27T00:27:06Z", "commit": {"oid": "287e65431e7653e25e2a17164eb4a2c5491bdede"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yN1QwMDoyNzowNlrOF8fKvQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yN1QwMDoyNzowNlrOF8fKvQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5ODk2OTUzMw==", "bodyText": "Might be a good idea to name this as dutyFailure or something.", "url": "https://github.com/ConsenSys/teku/pull/1489#discussion_r398969533", "createdAt": "2020-03-27T00:27:06Z", "author": {"login": "cemozerr"}, "path": "logging/src/main/java/tech/pegasys/teku/logging/StatusLogger.java", "diffHunk": "@@ -72,7 +72,7 @@ public void blockCreationFailure(final Exception cause) {\n     log.error(\"Error during block creation\", cause);\n   }\n \n-  public void attestationFailure(final IllegalArgumentException cause) {\n+  public void attestationFailure(final Throwable cause) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "287e65431e7653e25e2a17164eb4a2c5491bdede"}, "originalPosition": 5}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzgyNTEwMTM1", "url": "https://github.com/ConsenSys/teku/pull/1489#pullrequestreview-382510135", "createdAt": "2020-03-27T00:32:54Z", "commit": {"oid": "287e65431e7653e25e2a17164eb4a2c5491bdede"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yN1QwMDozMjo1NFrOF8fQqw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yN1QwMDozMjo1NFrOF8fQqw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5ODk3MTA1MQ==", "bodyText": "Nice.", "url": "https://github.com/ConsenSys/teku/pull/1489#discussion_r398971051", "createdAt": "2020-03-27T00:32:54Z", "author": {"login": "cemozerr"}, "path": "validator/coordinator/src/main/java/tech/pegasys/artemis/validator/coordinator/ValidatorCoordinator.java", "diffHunk": "@@ -197,27 +194,82 @@ public void onAttestationEvent(BroadcastAttestationEvent event) throws IllegalAr\n       }\n \n       // Get attester information to prepare AttestationAggregator for new slot's aggregation\n-      List<AttesterInformation> attesterInformations = committeeAssignments.get(slot);\n+      List<AttesterInformation> attestersInformation = committeeAssignments.get(slot);\n \n       // If our beacon node does have any attestation responsibilities for this slot\n-      if (attesterInformations == null) {\n+      if (attestersInformation == null) {\n         return;\n       }\n \n       // Pass attestationAggregator all the attester information necessary\n       // for aggregation\n-      attestationAggregator.updateAggregatorInformations(attesterInformations);\n-\n-      asyncProduceAttestations(\n-          attesterInformations, headState, getGenericAttestationData(headState, headBlock));\n-\n-      // Save headState to check for slashings\n-      //      this.headState = headState;\n+      attestationAggregator.updateAggregatorInformations(attestersInformation);\n+\n+      final Map<UnsignedLong, List<AttesterInformation>> attestersByCommittee =\n+          attestersInformation.stream()\n+              .collect(Collectors.groupingBy(info -> info.getCommittee().getIndex()));", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "287e65431e7653e25e2a17164eb4a2c5491bdede"}, "originalPosition": 70}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzgyNTEwMTc2", "url": "https://github.com/ConsenSys/teku/pull/1489#pullrequestreview-382510176", "createdAt": "2020-03-27T00:33:02Z", "commit": {"oid": "287e65431e7653e25e2a17164eb4a2c5491bdede"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ad90ed9e70d07c2623daeeb176fd9197a7bcdd1a", "author": {"user": {"login": "ajsutton", "name": "Adrian Sutton"}}, "url": "https://github.com/ConsenSys/teku/commit/ad90ed9e70d07c2623daeeb176fd9197a7bcdd1a", "committedDate": "2020-03-27T00:37:05Z", "message": "Update failed attestation message to match reality."}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4395, "cost": 1, "resetAt": "2021-11-01T13:51:04Z"}}}