{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0Mzg5NjQ0NDI0", "number": 1390, "title": "get unsigned validator block", "bodyText": "addresses #1355", "createdAt": "2020-03-17T06:11:46Z", "url": "https://github.com/ConsenSys/teku/pull/1390", "merged": true, "mergeCommit": {"oid": "dba946a423158ea38924da29af927bdd63f488f9"}, "closed": true, "closedAt": "2020-03-19T02:33:51Z", "author": {"login": "rolfyone"}, "timelineItems": {"totalCount": 16, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcOcdHdAH2gAyMzg5NjQ0NDI0OmI1NDFmMDc2Yjk5OWQyYmYxNzVjOGQ5M2M1ODcwZTkzMzI4ODEzOWI=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcPCfcVAFqTM3NzM4MTg2Mw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "b541f076b999d2bf175c8d93c5870e933288139b", "author": {"user": {"login": "rolfyone", "name": "Paul Harris"}}, "url": "https://github.com/ConsenSys/teku/commit/b541f076b999d2bf175c8d93c5870e933288139b", "committedDate": "2020-03-17T06:10:10Z", "message": "add /validator/block GET endpoint to retrieve an unsigned block.\n\nSigned-off-by: Paul Harris <paul.harris@consensys.net>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "794e7effef5fcddc9180dcf89ee65ea51afe8133", "author": {"user": {"login": "rolfyone", "name": "Paul Harris"}}, "url": "https://github.com/ConsenSys/teku/commit/794e7effef5fcddc9180dcf89ee65ea51afe8133", "committedDate": "2020-03-17T06:10:37Z", "message": "Merge remote-tracking branch 'upstream/master' into 1355-get-validator-block"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b4ae026f55f5b5369a228f2b8a454827d0d43bd8", "author": {"user": {"login": "rolfyone", "name": "Paul Harris"}}, "url": "https://github.com/ConsenSys/teku/commit/b4ae026f55f5b5369a228f2b8a454827d0d43bd8", "committedDate": "2020-03-17T06:15:29Z", "message": "fix build after merge\n\nSigned-off-by: Paul Harris <paul.harris@consensys.net>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "60784b5d3cf8751879d9b4cfdf5b67e15b90746e", "author": {"user": {"login": "rolfyone", "name": "Paul Harris"}}, "url": "https://github.com/ConsenSys/teku/commit/60784b5d3cf8751879d9b4cfdf5b67e15b90746e", "committedDate": "2020-03-17T06:21:52Z", "message": "fix build after merge\n\nSigned-off-by: Paul Harris <paul.harris@consensys.net>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c9a336f1be6bebe5fdd501e2b4734d64c80347ab", "author": {"user": {"login": "rolfyone", "name": "Paul Harris"}}, "url": "https://github.com/ConsenSys/teku/commit/c9a336f1be6bebe5fdd501e2b4734d64c80347ab", "committedDate": "2020-03-18T20:24:13Z", "message": "Merge remote-tracking branch 'upstream/master' into 1355-get-validator-block"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "0888b4548ad4aca3e74eaaf5714c05bc2a7f14d4", "author": {"user": {"login": "rolfyone", "name": "Paul Harris"}}, "url": "https://github.com/ConsenSys/teku/commit/0888b4548ad4aca3e74eaaf5714c05bc2a7f14d4", "committedDate": "2020-03-18T20:33:40Z", "message": "Merge remote-tracking branch 'upstream/master' into 1355-get-validator-block"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "13451ba6e6d3b6cbcaa8b2c8baba1de849ba78cd", "author": {"user": {"login": "rolfyone", "name": "Paul Harris"}}, "url": "https://github.com/ConsenSys/teku/commit/13451ba6e6d3b6cbcaa8b2c8baba1de849ba78cd", "committedDate": "2020-03-18T20:45:16Z", "message": "fix build after merge\n\nSigned-off-by: Paul Harris <paul.harris@consensys.net>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ce5ba39820cbb094d2259871a37ae5a4b4a646eb", "author": {"user": {"login": "rolfyone", "name": "Paul Harris"}}, "url": "https://github.com/ConsenSys/teku/commit/ce5ba39820cbb094d2259871a37ae5a4b4a646eb", "committedDate": "2020-03-18T21:43:31Z", "message": "Merge remote-tracking branch 'upstream/master' into 1355-get-validator-block"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "69b67c1e50f6a3af88c4c96b67a8339ac449e655", "author": {"user": {"login": "rolfyone", "name": "Paul Harris"}}, "url": "https://github.com/ConsenSys/teku/commit/69b67c1e50f6a3af88c4c96b67a8339ac449e655", "committedDate": "2020-03-18T22:15:07Z", "message": "Merge remote-tracking branch 'upstream/master' into 1355-get-validator-block"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "15361ccc729ffd696632f01e2ab1bf51d5e4073d", "author": {"user": {"login": "rolfyone", "name": "Paul Harris"}}, "url": "https://github.com/ConsenSys/teku/commit/15361ccc729ffd696632f01e2ab1bf51d5e4073d", "committedDate": "2020-03-18T22:22:34Z", "message": "Merge remote-tracking branch 'upstream/master' into 1355-get-validator-block"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzc3Mjk1MzM1", "url": "https://github.com/ConsenSys/teku/pull/1390#pullrequestreview-377295335", "createdAt": "2020-03-18T23:01:39Z", "commit": {"oid": "15361ccc729ffd696632f01e2ab1bf51d5e4073d"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xOFQyMzowMTozOVrOF4Z0IQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xOFQyMzowMTozOVrOF4Z0IQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NDY4NzUyMQ==", "bodyText": "We shouldn't be swallowing this exception.  Needs to log it somewhere or rethrow. I suspect it's probably a fairly important error and not something we'd expect.", "url": "https://github.com/ConsenSys/teku/pull/1390#discussion_r394687521", "createdAt": "2020-03-18T23:01:39Z", "author": {"login": "ajsutton"}, "path": "data/provider/src/main/java/tech/pegasys/artemis/api/ValidatorDataProvider.java", "diffHunk": "@@ -0,0 +1,50 @@\n+/*\n+ * Copyright 2020 ConsenSys AG.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\"); you may not use this file except in compliance with\n+ * the License. You may obtain a copy of the License at\n+ *\n+ * http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software distributed under the License is distributed on\n+ * an \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied. See the License for the\n+ * specific language governing permissions and limitations under the License.\n+ */\n+\n+package tech.pegasys.artemis.api;\n+\n+import com.google.common.primitives.UnsignedLong;\n+import java.util.Optional;\n+import tech.pegasys.artemis.api.schema.BLSSignature;\n+import tech.pegasys.artemis.api.schema.BeaconBlock;\n+import tech.pegasys.artemis.validator.coordinator.ValidatorCoordinator;\n+\n+public class ValidatorDataProvider {\n+  private volatile ValidatorCoordinator validatorCoordinator;\n+\n+  public ValidatorDataProvider(ValidatorCoordinator validatorCoordinator) {\n+    this.validatorCoordinator = validatorCoordinator;\n+  }\n+\n+  public Optional<BeaconBlock> getUnsignedBeaconBlockAtSlot(\n+      UnsignedLong slot, BLSSignature randao) {\n+    if (slot == null) {\n+      throw new IllegalArgumentException(\"no slot provided.\");\n+    }\n+    if (randao == null) {\n+      throw new IllegalArgumentException(\"no randao_reveal provided.\");\n+    }\n+\n+    try {\n+      Optional<tech.pegasys.artemis.datastructures.blocks.BeaconBlock> newBlock =\n+          validatorCoordinator.createUnsignedBlock(\n+              slot, tech.pegasys.artemis.util.bls.BLSSignature.fromBytes(randao.getBytes()));\n+      if (newBlock.isPresent()) {\n+        return Optional.of(new BeaconBlock(newBlock.get()));\n+      }\n+    } catch (Exception ex) {\n+      return Optional.empty();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "15361ccc729ffd696632f01e2ab1bf51d5e4073d"}, "originalPosition": 46}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzc3MzMyODA1", "url": "https://github.com/ConsenSys/teku/pull/1390#pullrequestreview-377332805", "createdAt": "2020-03-19T00:17:03Z", "commit": {"oid": "15361ccc729ffd696632f01e2ab1bf51d5e4073d"}, "state": "COMMENTED", "comments": {"totalCount": 5, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xOVQwMDoxNzowNFrOF4bZ3A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xOVQwMDozMzowOFrOF4b7_g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NDcxMzU2NA==", "bodyText": "this should be imported?", "url": "https://github.com/ConsenSys/teku/pull/1390#discussion_r394713564", "createdAt": "2020-03-19T00:17:04Z", "author": {"login": "macfarla"}, "path": "data/beaconrestapi/src/main/java/tech/pegasys/artemis/beaconrestapi/BeaconRestApi.java", "diffHunk": "@@ -163,6 +163,10 @@ private void addValidatorHandlers(DataProvider dataProvider) {\n     ChainDataProvider provider = dataProvider.getChainDataProvider();\n     app.get(GetAttestation.ROUTE, new GetAttestation(provider, jsonProvider));\n     app.get(GetValidators.ROUTE, new GetValidators(provider, jsonProvider));\n+    app.get(\n+        tech.pegasys.artemis.beaconrestapi.handlers.validator.GetBlock.ROUTE,", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "15361ccc729ffd696632f01e2ab1bf51d5e4073d"}, "originalPosition": 5}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NDcxNTM2Nw==", "bodyText": "nit: can bytes32 come first", "url": "https://github.com/ConsenSys/teku/pull/1390#discussion_r394715367", "createdAt": "2020-03-19T00:19:12Z", "author": {"login": "macfarla"}, "path": "data/beaconrestapi/src/main/java/tech/pegasys/artemis/beaconrestapi/SingleQueryParameterUtils.java", "diffHunk": "@@ -18,9 +18,12 @@\n import java.util.Map;\n import org.apache.commons.lang3.StringUtils;\n import org.apache.tuweni.bytes.Bytes32;\n+import tech.pegasys.artemis.api.schema.BLSSignature;\n \n public class SingleQueryParameterUtils {\n \n+  public static final String INVALID_BYTES96_DATA =", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "15361ccc729ffd696632f01e2ab1bf51d5e4073d"}, "originalPosition": 8}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NDcxNTcxNA==", "bodyText": "should this be bytes96? is that why you added it?", "url": "https://github.com/ConsenSys/teku/pull/1390#discussion_r394715714", "createdAt": "2020-03-19T00:19:39Z", "author": {"login": "macfarla"}, "path": "data/beaconrestapi/src/main/java/tech/pegasys/artemis/beaconrestapi/SingleQueryParameterUtils.java", "diffHunk": "@@ -92,4 +95,15 @@ public static Bytes32 getParameterValueAsBytes32(\n       throw new IllegalArgumentException(INVALID_BYTES32_DATA);\n     }\n   }\n+\n+  public static BLSSignature getParameterValueAsBLSSignature(\n+      final Map<String, List<String>> parameterMap, final String key)\n+      throws IllegalArgumentException {\n+    String stringValue = validateQueryParameter(parameterMap, key);\n+    try {\n+      return BLSSignature.fromHexString(stringValue);\n+    } catch (IllegalArgumentException ex) {\n+      throw new IllegalArgumentException(INVALID_BYTES32_DATA);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "15361ccc729ffd696632f01e2ab1bf51d5e4073d"}, "originalPosition": 25}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NDcxNjUwMA==", "bodyText": "oh it's a name collision", "url": "https://github.com/ConsenSys/teku/pull/1390#discussion_r394716500", "createdAt": "2020-03-19T00:20:29Z", "author": {"login": "macfarla"}, "path": "data/beaconrestapi/src/main/java/tech/pegasys/artemis/beaconrestapi/BeaconRestApi.java", "diffHunk": "@@ -163,6 +163,10 @@ private void addValidatorHandlers(DataProvider dataProvider) {\n     ChainDataProvider provider = dataProvider.getChainDataProvider();\n     app.get(GetAttestation.ROUTE, new GetAttestation(provider, jsonProvider));\n     app.get(GetValidators.ROUTE, new GetValidators(provider, jsonProvider));\n+    app.get(\n+        tech.pegasys.artemis.beaconrestapi.handlers.validator.GetBlock.ROUTE,", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NDcxMzU2NA=="}, "originalCommit": {"oid": "15361ccc729ffd696632f01e2ab1bf51d5e4073d"}, "originalPosition": 5}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NDcyMjMwMg==", "bodyText": "96", "url": "https://github.com/ConsenSys/teku/pull/1390#discussion_r394722302", "createdAt": "2020-03-19T00:33:08Z", "author": {"login": "macfarla"}, "path": "data/beaconrestapi/src/test/java/tech/pegasys/artemis/beaconrestapi/SingleQueryParameterUtilsTest.java", "diffHunk": "@@ -116,4 +119,18 @@ public void getParameterAsBytes32_shouldParseHex32String() {\n     Bytes32 result = getParameterValueAsBytes32(data, KEY);\n     assertEquals(bytes32, result);\n   }\n+\n+  @Test\n+  public void getParameterAsBLSSignature_shouldThrowIfCannotParse() {\n+    assertThrows(\n+        IllegalArgumentException.class, () -> getParameterValueAsBytes32(INVALID_DATA, KEY));", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "15361ccc729ffd696632f01e2ab1bf51d5e4073d"}, "originalPosition": 27}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzc3MzQ0MjIw", "url": "https://github.com/ConsenSys/teku/pull/1390#pullrequestreview-377344220", "createdAt": "2020-03-19T00:54:56Z", "commit": {"oid": "15361ccc729ffd696632f01e2ab1bf51d5e4073d"}, "state": "COMMENTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xOVQwMDo1NDo1NlrOF4cRxQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xOVQwMDo1NjoyN1rOF4cTHQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NDcyNzg3Nw==", "bodyText": "do we want them named the same or is it confusing", "url": "https://github.com/ConsenSys/teku/pull/1390#discussion_r394727877", "createdAt": "2020-03-19T00:54:56Z", "author": {"login": "macfarla"}, "path": "data/beaconrestapi/src/main/java/tech/pegasys/artemis/beaconrestapi/BeaconRestApi.java", "diffHunk": "@@ -163,6 +163,10 @@ private void addValidatorHandlers(DataProvider dataProvider) {\n     ChainDataProvider provider = dataProvider.getChainDataProvider();\n     app.get(GetAttestation.ROUTE, new GetAttestation(provider, jsonProvider));\n     app.get(GetValidators.ROUTE, new GetValidators(provider, jsonProvider));\n+    app.get(\n+        tech.pegasys.artemis.beaconrestapi.handlers.validator.GetBlock.ROUTE,", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NDcxMzU2NA=="}, "originalCommit": {"oid": "15361ccc729ffd696632f01e2ab1bf51d5e4073d"}, "originalPosition": 5}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NDcyODIyMQ==", "bodyText": "this naming stuff is getting messy", "url": "https://github.com/ConsenSys/teku/pull/1390#discussion_r394728221", "createdAt": "2020-03-19T00:56:27Z", "author": {"login": "macfarla"}, "path": "data/provider/src/main/java/tech/pegasys/artemis/api/ChainDataProvider.java", "diffHunk": "@@ -73,7 +72,9 @@ public ChainDataProvider(\n \n     Optional<Bytes32> headBlockRoot = chainStorageClient.getBestBlockRoot();\n     Optional<Bytes32> headStateRoot =\n-        headBlockRoot.flatMap(chainStorageClient::getBlockByRoot).map(BeaconBlock::getState_root);\n+        headBlockRoot\n+            .flatMap(chainStorageClient::getBlockByRoot)\n+            .map(tech.pegasys.artemis.datastructures.blocks.BeaconBlock::getState_root);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "15361ccc729ffd696632f01e2ab1bf51d5e4073d"}, "originalPosition": 15}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "aaf20bdeb9a8482022f5f0bda56e9c56df1d5099", "author": {"user": {"login": "rolfyone", "name": "Paul Harris"}}, "url": "https://github.com/ConsenSys/teku/commit/aaf20bdeb9a8482022f5f0bda56e9c56df1d5099", "committedDate": "2020-03-19T02:14:40Z", "message": "changes from review feedback\n\nSigned-off-by: Paul Harris <paul.harris@consensys.net>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "7d64c861058e3b71d586ad7aaeef2ea9333bc619", "author": {"user": {"login": "rolfyone", "name": "Paul Harris"}}, "url": "https://github.com/ConsenSys/teku/commit/7d64c861058e3b71d586ad7aaeef2ea9333bc619", "committedDate": "2020-03-19T02:23:15Z", "message": "Merge remote-tracking branch 'upstream/master' into 1355-get-validator-block"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzc3MzgxODYz", "url": "https://github.com/ConsenSys/teku/pull/1390#pullrequestreview-377381863", "createdAt": "2020-03-19T02:27:16Z", "commit": {"oid": "7d64c861058e3b71d586ad7aaeef2ea9333bc619"}, "state": "APPROVED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xOVQwMjoyNzoxNlrOF4eAGw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xOVQwMjoyNzoxNlrOF4eAGw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NDc1NjEyMw==", "bodyText": "not right now", "url": "https://github.com/ConsenSys/teku/pull/1390#discussion_r394756123", "createdAt": "2020-03-19T02:27:16Z", "author": {"login": "macfarla"}, "path": "data/provider/src/main/java/tech/pegasys/artemis/api/ChainDataProvider.java", "diffHunk": "@@ -73,7 +72,9 @@ public ChainDataProvider(\n \n     Optional<Bytes32> headBlockRoot = chainStorageClient.getBestBlockRoot();\n     Optional<Bytes32> headStateRoot =\n-        headBlockRoot.flatMap(chainStorageClient::getBlockByRoot).map(BeaconBlock::getState_root);\n+        headBlockRoot\n+            .flatMap(chainStorageClient::getBlockByRoot)\n+            .map(tech.pegasys.artemis.datastructures.blocks.BeaconBlock::getState_root);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NDcyODIyMQ=="}, "originalCommit": {"oid": "15361ccc729ffd696632f01e2ab1bf51d5e4073d"}, "originalPosition": 15}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3994, "cost": 1, "resetAt": "2021-11-01T13:51:04Z"}}}