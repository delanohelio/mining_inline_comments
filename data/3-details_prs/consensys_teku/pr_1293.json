{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0Mzg0MDc3NjE4", "number": 1293, "title": "separate rest API from the internal object layer", "bodyText": "Signed-off-by: Paul Harris paul.harris@consensys.net", "createdAt": "2020-03-05T05:37:52Z", "url": "https://github.com/ConsenSys/teku/pull/1293", "merged": true, "mergeCommit": {"oid": "b9706eed82047ac5fda51ba993afda72e0e48689"}, "closed": true, "closedAt": "2020-03-06T02:26:55Z", "author": {"login": "rolfyone"}, "timelineItems": {"totalCount": 9, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcKkyLfgH2gAyMzg0MDc3NjE4OjhhMThlZTZhYWM0NDkxOTA4OGI2MDY2OTVkMjA1OTIwNTQ3NjIyN2M=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcK2pgWAFqTM3MDA0NjQ0OQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "8a18ee6aac44919088b606695d2059205476227c", "author": {"user": {"login": "rolfyone", "name": "Paul Harris"}}, "url": "https://github.com/ConsenSys/teku/commit/8a18ee6aac44919088b606695d2059205476227c", "committedDate": "2020-03-05T05:36:43Z", "message": "begin refactoring the use of internal apis and data structures at the rest api level.\n\nSigned-off-by: Paul Harris <paul.harris@consensys.net>"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzY5OTQ1MDUy", "url": "https://github.com/ConsenSys/teku/pull/1293#pullrequestreview-369945052", "createdAt": "2020-03-05T21:57:47Z", "commit": {"oid": "8a18ee6aac44919088b606695d2059205476227c"}, "state": "COMMENTED", "comments": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wNVQyMTo1Nzo0N1rOFyluJg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wNVQyMTo1OTowMFrOFylwcA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4ODU5MTE0Mg==", "bodyText": "is this how we set caching headers?", "url": "https://github.com/ConsenSys/teku/pull/1293#discussion_r388591142", "createdAt": "2020-03-05T21:57:47Z", "author": {"login": "macfarla"}, "path": "data/beaconrestapi/src/test/java/tech/pegasys/artemis/beaconrestapi/networkhandlers/PeersHandlerTest.java", "diffHunk": "@@ -48,23 +52,26 @@ public void shouldReturnArrayOfPeersIfPresent() throws Exception {\n \n     when(peer1.getId()).thenReturn(nodeId1);\n     when(peer2.getId()).thenReturn(nodeId2);\n-    when(p2PNetwork.streamPeers()).thenReturn(Stream.of(peer1, peer2));\n+    when(p2pNetwork.streamPeers()).thenReturn(Stream.of(peer1, peer2));\n \n     final String response =\n         jsonProvider.objectToJSON(new String[] {peerId1.toBase58(), peerId2.toBase58()});\n \n     peersHandler.handle(context);\n+    verify(context).header(Header.CACHE_CONTROL, CACHE_ONE_MINUTE);\n     verify(context).result(response);\n   }\n \n   @Test\n   public void shouldReturnEmptyPeersArrayIfNoneConnected() throws Exception {\n-    final PeersHandler peersHandler = new PeersHandler(p2PNetwork, jsonProvider);\n+    final NetworkDataProvider network = new NetworkDataProvider(p2pNetwork);\n+    final PeersHandler peersHandler = new PeersHandler(network, jsonProvider);\n     final String response = jsonProvider.objectToJSON(new String[] {});\n \n-    when(p2PNetwork.streamPeers()).thenReturn(Stream.empty());\n+    when(p2pNetwork.streamPeers()).thenReturn(Stream.empty());\n \n     peersHandler.handle(context);\n+    verify(context).header(Header.CACHE_CONTROL, CACHE_ONE_MINUTE);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "8a18ee6aac44919088b606695d2059205476227c"}, "originalPosition": 59}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4ODU5MTI0OA==", "bodyText": "is neat", "url": "https://github.com/ConsenSys/teku/pull/1293#discussion_r388591248", "createdAt": "2020-03-05T21:58:00Z", "author": {"login": "macfarla"}, "path": "data/beaconrestapi/src/test/java/tech/pegasys/artemis/beaconrestapi/networkhandlers/PeersHandlerTest.java", "diffHunk": "@@ -48,23 +52,26 @@ public void shouldReturnArrayOfPeersIfPresent() throws Exception {\n \n     when(peer1.getId()).thenReturn(nodeId1);\n     when(peer2.getId()).thenReturn(nodeId2);\n-    when(p2PNetwork.streamPeers()).thenReturn(Stream.of(peer1, peer2));\n+    when(p2pNetwork.streamPeers()).thenReturn(Stream.of(peer1, peer2));\n \n     final String response =\n         jsonProvider.objectToJSON(new String[] {peerId1.toBase58(), peerId2.toBase58()});\n \n     peersHandler.handle(context);\n+    verify(context).header(Header.CACHE_CONTROL, CACHE_ONE_MINUTE);\n     verify(context).result(response);\n   }\n \n   @Test\n   public void shouldReturnEmptyPeersArrayIfNoneConnected() throws Exception {\n-    final PeersHandler peersHandler = new PeersHandler(p2PNetwork, jsonProvider);\n+    final NetworkDataProvider network = new NetworkDataProvider(p2pNetwork);\n+    final PeersHandler peersHandler = new PeersHandler(network, jsonProvider);\n     final String response = jsonProvider.objectToJSON(new String[] {});\n \n-    when(p2PNetwork.streamPeers()).thenReturn(Stream.empty());\n+    when(p2pNetwork.streamPeers()).thenReturn(Stream.empty());\n \n     peersHandler.handle(context);\n+    verify(context).header(Header.CACHE_CONTROL, CACHE_ONE_MINUTE);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4ODU5MTE0Mg=="}, "originalCommit": {"oid": "8a18ee6aac44919088b606695d2059205476227c"}, "originalPosition": 59}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4ODU5MTU2MQ==", "bodyText": "ooo controversial", "url": "https://github.com/ConsenSys/teku/pull/1293#discussion_r388591561", "createdAt": "2020-03-05T21:58:40Z", "author": {"login": "macfarla"}, "path": "data/beaconrestapi/src/test/java/tech/pegasys/artemis/beaconrestapi/networkhandlers/PeersHandlerTest.java", "diffHunk": "@@ -34,11 +37,12 @@\n public class PeersHandlerTest {\n   private final JsonProvider jsonProvider = new JsonProvider();\n   @Mock Context context;\n-  @Mock P2PNetwork<Peer> p2PNetwork;\n+  @Mock P2PNetwork<Peer> p2pNetwork;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "8a18ee6aac44919088b606695d2059205476227c"}, "originalPosition": 23}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4ODU5MTcyOA==", "bodyText": "are you willing to die on this hill", "url": "https://github.com/ConsenSys/teku/pull/1293#discussion_r388591728", "createdAt": "2020-03-05T21:59:00Z", "author": {"login": "macfarla"}, "path": "data/beaconrestapi/src/test/java/tech/pegasys/artemis/beaconrestapi/networkhandlers/PeersHandlerTest.java", "diffHunk": "@@ -34,11 +37,12 @@\n public class PeersHandlerTest {\n   private final JsonProvider jsonProvider = new JsonProvider();\n   @Mock Context context;\n-  @Mock P2PNetwork<Peer> p2PNetwork;\n+  @Mock P2PNetwork<Peer> p2pNetwork;", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4ODU5MTU2MQ=="}, "originalCommit": {"oid": "8a18ee6aac44919088b606695d2059205476227c"}, "originalPosition": 23}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzY5OTkxNTA1", "url": "https://github.com/ConsenSys/teku/pull/1293#pullrequestreview-369991505", "createdAt": "2020-03-05T23:46:55Z", "commit": {"oid": "8a18ee6aac44919088b606695d2059205476227c"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wNVQyMzo0Njo1NVrOFyoH6Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wNVQyMzo0Njo1NVrOFyoH6Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4ODYzMDUwNQ==", "bodyText": "I like p2pNetwork too. :) And this looks exactly like the kind of hill I would be far more tempted to die on that I should be. :P", "url": "https://github.com/ConsenSys/teku/pull/1293#discussion_r388630505", "createdAt": "2020-03-05T23:46:55Z", "author": {"login": "ajsutton"}, "path": "data/beaconrestapi/src/test/java/tech/pegasys/artemis/beaconrestapi/networkhandlers/PeersHandlerTest.java", "diffHunk": "@@ -34,11 +37,12 @@\n public class PeersHandlerTest {\n   private final JsonProvider jsonProvider = new JsonProvider();\n   @Mock Context context;\n-  @Mock P2PNetwork<Peer> p2PNetwork;\n+  @Mock P2PNetwork<Peer> p2pNetwork;", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4ODU5MTU2MQ=="}, "originalCommit": {"oid": "8a18ee6aac44919088b606695d2059205476227c"}, "originalPosition": 23}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a59109879048f5dcd9d12c5457c9fa5f58df4bc2", "author": {"user": {"login": "rolfyone", "name": "Paul Harris"}}, "url": "https://github.com/ConsenSys/teku/commit/a59109879048f5dcd9d12c5457c9fa5f58df4bc2", "committedDate": "2020-03-06T00:32:48Z", "message": "refactor BeaconCommitteesHandler\n\ncreate a DataProvider abstraction\n\nStart writing tests at the new layer\n\nSigned-off-by: Paul Harris <paul.harris@consensys.net>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b3962745f0d27950f5d550803c5d2288200ecf22", "author": {"user": {"login": "rolfyone", "name": "Paul Harris"}}, "url": "https://github.com/ConsenSys/teku/commit/b3962745f0d27950f5d550803c5d2288200ecf22", "committedDate": "2020-03-06T01:23:26Z", "message": "simplify caching header to just none, or 'finalized' (which i've started at 1 year)\n\nSigned-off-by: Paul Harris <paul.harris@consensys.net>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ef3b4a3473a5daac7ef899a7010a0d3666f218d1", "author": {"user": {"login": "rolfyone", "name": "Paul Harris"}}, "url": "https://github.com/ConsenSys/teku/commit/ef3b4a3473a5daac7ef899a7010a0d3666f218d1", "committedDate": "2020-03-06T01:29:09Z", "message": "spotless\n\nSigned-off-by: Paul Harris <paul.harris@consensys.net>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b90393fee8db0e0a717a809e8e5fb70da48be6e9", "author": {"user": {"login": "rolfyone", "name": "Paul Harris"}}, "url": "https://github.com/ConsenSys/teku/commit/b90393fee8db0e0a717a809e8e5fb70da48be6e9", "committedDate": "2020-03-06T02:00:49Z", "message": "Merge remote-tracking branch 'upstream/master' into refactor-api-layer\n\nSigned-off-by: Paul Harris <paul.harris@consensys.net>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "81fd3460ba8795babe72f66f55c614af234f4484", "author": {"user": {"login": "rolfyone", "name": "Paul Harris"}}, "url": "https://github.com/ConsenSys/teku/commit/81fd3460ba8795babe72f66f55c614af234f4484", "committedDate": "2020-03-06T02:06:05Z", "message": "Merge remote-tracking branch 'upstream/master' into refactor-api-layer"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzcwMDQ2NDQ5", "url": "https://github.com/ConsenSys/teku/pull/1293#pullrequestreview-370046449", "createdAt": "2020-03-06T02:25:32Z", "commit": {"oid": "81fd3460ba8795babe72f66f55c614af234f4484"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4176, "cost": 1, "resetAt": "2021-11-01T13:51:04Z"}}}