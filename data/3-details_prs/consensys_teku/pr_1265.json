{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0MzgyNzY5Nzkz", "number": 1265, "title": "Beacon validators: pagination of results", "bodyText": "Added pagination parameters pageSize and pageToken. Also added totalSize and nextPageToken to the response.\n#1196", "createdAt": "2020-03-03T06:33:48Z", "url": "https://github.com/ConsenSys/teku/pull/1265", "merged": true, "mergeCommit": {"oid": "47f0e41be253a3b31c3f1996ddd28847a5fbc2c6"}, "closed": true, "closedAt": "2020-03-04T23:57:46Z", "author": {"login": "macfarla"}, "timelineItems": {"totalCount": 40, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcJ6hycAH2gAyMzgyNzY5NzkzOjM0YjliMzE4YTNkZmRlZDJlNWM4ZDZjZDRjNGQ2MTNiYzY4MTgwYmY=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcKfztqAFqTM2OTIwNzYwNg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "34b9b318a3dfded2e5c8d6cd4c4d613bc68180bf", "author": {"user": {"login": "macfarla", "name": "Sally MacFarlane"}}, "url": "https://github.com/ConsenSys/teku/commit/34b9b318a3dfded2e5c8d6cd4c4d613bc68180bf", "committedDate": "2020-03-03T04:22:48Z", "message": "added page token and page size params\n\nSigned-off-by: Sally MacFarlane <sally.macfarlane@consensys.net>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "5a30c70e55a24bbc9b7bfcf8239e07d8268effd1", "author": {"user": {"login": "macfarla", "name": "Sally MacFarlane"}}, "url": "https://github.com/ConsenSys/teku/commit/5a30c70e55a24bbc9b7bfcf8239e07d8268effd1", "committedDate": "2020-03-03T05:30:44Z", "message": "pass page params through\n\nSigned-off-by: Sally MacFarlane <sally.macfarlane@consensys.net>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a98047e7bb1b870c2cb0b51a53a19a8a4e0ce1ac", "author": {"user": {"login": "macfarla", "name": "Sally MacFarlane"}}, "url": "https://github.com/ConsenSys/teku/commit/a98047e7bb1b870c2cb0b51a53a19a8a4e0ce1ac", "committedDate": "2020-03-03T06:27:08Z", "message": "added next page token to result\n\nSigned-off-by: Sally MacFarlane <sally.macfarlane@consensys.net>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "4961eb588312376f93f16de1820fd81703c67bae", "author": {"user": {"login": "macfarla", "name": "Sally MacFarlane"}}, "url": "https://github.com/ConsenSys/teku/commit/4961eb588312376f93f16de1820fd81703c67bae", "committedDate": "2020-03-03T06:29:14Z", "message": "Merge branch 'master' of github.com:PegaSysEng/teku into beacon-validators-pagination"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "05376670b0edc46abaf5fe4bc8a24e2ba527badb", "author": {"user": {"login": "macfarla", "name": "Sally MacFarlane"}}, "url": "https://github.com/ConsenSys/teku/commit/05376670b0edc46abaf5fe4bc8a24e2ba527badb", "committedDate": "2020-03-03T06:33:23Z", "message": "stay within the bounds of the list\n\nSigned-off-by: Sally MacFarlane <sally.macfarlane@consensys.net>"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzY3ODM1NTE5", "url": "https://github.com/ConsenSys/teku/pull/1265#pullrequestreview-367835519", "createdAt": "2020-03-03T09:51:06Z", "commit": {"oid": "05376670b0edc46abaf5fe4bc8a24e2ba527badb"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wM1QwOTo1MTowNlrOFw-36A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wM1QwOTo1MTowNlrOFw-36A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NjkwNjA4OA==", "bodyText": "prysm defaults this to 250, i think we should do the same. even if we went as high as 500, just want to make sure that we get that middle ground of 'not too much' data.", "url": "https://github.com/ConsenSys/teku/pull/1265#discussion_r386906088", "createdAt": "2020-03-03T09:51:06Z", "author": {"login": "rolfyone"}, "path": "data/beaconrestapi/src/main/java/tech/pegasys/artemis/beaconrestapi/RestApiConstants.java", "diffHunk": "@@ -18,6 +18,10 @@\n   public static final String SLOT = \"slot\";\n   public static final String EPOCH = \"epoch\";\n   public static final String ACTIVE = \"active\";\n+  public static final String PAGE_SIZE = \"pageSize\";\n+  public static final String PAGE_TOKEN = \"pageToken\";\n+  public static final int PAGE_SIZE_DEFAULT = 20;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "05376670b0edc46abaf5fe4bc8a24e2ba527badb"}, "originalPosition": 6}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzY3ODM2MjEw", "url": "https://github.com/ConsenSys/teku/pull/1265#pullrequestreview-367836210", "createdAt": "2020-03-03T09:52:06Z", "commit": {"oid": "05376670b0edc46abaf5fe4bc8a24e2ba527badb"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wM1QwOTo1MjowN1rOFw-6AA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wM1QwOTo1MjowN1rOFw-6AA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NjkwNjYyNA==", "bodyText": "should comment here that the default pagination is X (ideally reference the variable).", "url": "https://github.com/ConsenSys/teku/pull/1265#discussion_r386906624", "createdAt": "2020-03-03T09:52:07Z", "author": {"login": "rolfyone"}, "path": "data/beaconrestapi/src/main/java/tech/pegasys/artemis/beaconrestapi/beaconhandlers/BeaconValidatorsHandler.java", "diffHunk": "@@ -69,7 +74,13 @@ public BeaconValidatorsHandler(\n         @OpenApiParam(\n             name = ACTIVE,\n             description =\n-                \"If specified, return only validators which are active in the specified epoch\")\n+                \"If specified, return only validators which are active in the specified epoch.\"),\n+        @OpenApiParam(\n+            name = PAGE_SIZE,\n+            description = \"If specified, return only this many results.\"),", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "05376670b0edc46abaf5fe4bc8a24e2ba527badb"}, "originalPosition": 24}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzY3ODU1ODMz", "url": "https://github.com/ConsenSys/teku/pull/1265#pullrequestreview-367855833", "createdAt": "2020-03-03T10:19:30Z", "commit": {"oid": "05376670b0edc46abaf5fe4bc8a24e2ba527badb"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wM1QxMDoxOTozMFrOFw_17Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wM1QxMDoxOTozMFrOFw_17Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NjkyMTk2NQ==", "bodyText": "i'm not sure in the response we want to be using SSZList unless we've got a good reason. we can just use ArrayList and not have the baggage... they serialize the same way\nWe might find this logic to be a useful utility function, passing in a list (I'd probably make it a List, as both SSZVector and SSZList come from Arraylist from memory) and getting a page of data...\nsince it's a list, we could possibly just use list.sublist, and pass it the start and end and return the result of that... also can just return List.of() for empty...", "url": "https://github.com/ConsenSys/teku/pull/1265#discussion_r386921965", "createdAt": "2020-03-03T10:19:30Z", "author": {"login": "rolfyone"}, "path": "data/beaconrestapi/src/main/java/tech/pegasys/artemis/beaconrestapi/schema/BeaconValidatorsResponse.java", "diffHunk": "@@ -18,8 +18,43 @@\n \n public class BeaconValidatorsResponse {\n   public final SSZList<Validator> validatorList;\n+  private int totalSize;\n+  private int nextPageToken;\n \n   public BeaconValidatorsResponse(SSZList<Validator> validatorList) {\n-    this.validatorList = validatorList;\n+    this(validatorList, 20, 0);\n+  }\n+\n+  public BeaconValidatorsResponse(\n+      SSZList<Validator> validatorList, final int pageSize, final int pageToken) {\n+    // first page is pageToken = 0\n+    if (pageSize > 0 && pageToken >= 0) {\n+      int offset = pageToken * pageSize;\n+      SSZList<Validator> pageOfValidators = new SSZList<>(Validator.class, pageSize);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "05376670b0edc46abaf5fe4bc8a24e2ba527badb"}, "originalPosition": 17}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c90d6899dee03d3a02619e4a183ad18bb0b4eac7", "author": {"user": {"login": "macfarla", "name": "Sally MacFarlane"}}, "url": "https://github.com/ConsenSys/teku/commit/c90d6899dee03d3a02619e4a183ad18bb0b4eac7", "committedDate": "2020-03-03T23:07:49Z", "message": "descriptions of params\n\nSigned-off-by: Sally MacFarlane <sally.macfarlane@consensys.net>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "15cce3860ee4b1809060758c6e1ff1877f799f28", "author": {"user": {"login": "macfarla", "name": "Sally MacFarlane"}}, "url": "https://github.com/ConsenSys/teku/commit/15cce3860ee4b1809060758c6e1ff1877f799f28", "committedDate": "2020-03-03T23:07:56Z", "message": "Merge branch 'master' of github.com:PegaSysEng/teku into beacon-validators-pagination"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "1ef4b4a3111c07b51c80ab90b87feb346ed32fbd", "author": {"user": {"login": "macfarla", "name": "Sally MacFarlane"}}, "url": "https://github.com/ConsenSys/teku/commit/1ef4b4a3111c07b51c80ab90b87feb346ed32fbd", "committedDate": "2020-03-03T23:18:01Z", "message": "open api descriptions\n\nSigned-off-by: Sally MacFarlane <sally.macfarlane@consensys.net>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "9b6577ff0094473ca5305b9550171af5dc47bf72", "author": {"user": {"login": "macfarla", "name": "Sally MacFarlane"}}, "url": "https://github.com/ConsenSys/teku/commit/9b6577ff0094473ca5305b9550171af5dc47bf72", "committedDate": "2020-03-04T00:28:35Z", "message": "remove SSZList from response obj\n\nSigned-off-by: Sally MacFarlane <sally.macfarlane@consensys.net>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a41962078ddba389ebb183cfb5713f62eff27c91", "author": {"user": {"login": "macfarla", "name": "Sally MacFarlane"}}, "url": "https://github.com/ConsenSys/teku/commit/a41962078ddba389ebb183cfb5713f62eff27c91", "committedDate": "2020-03-04T00:41:38Z", "message": "added test for out of bounds page params\n\nSigned-off-by: Sally MacFarlane <sally.macfarlane@consensys.net>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f06ab2a26f887b56a098a431608ec40ab557bee7", "author": {"user": {"login": "macfarla", "name": "Sally MacFarlane"}}, "url": "https://github.com/ConsenSys/teku/commit/f06ab2a26f887b56a098a431608ec40ab557bee7", "committedDate": "2020-03-04T01:01:33Z", "message": "more test cases\n\nSigned-off-by: Sally MacFarlane <sally.macfarlane@consensys.net>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "7cf0b0e241e3ac5bb307bcb2e55cb709acd06c90", "author": {"user": {"login": "macfarla", "name": "Sally MacFarlane"}}, "url": "https://github.com/ConsenSys/teku/commit/7cf0b0e241e3ac5bb307bcb2e55cb709acd06c90", "committedDate": "2020-03-04T01:06:24Z", "message": "more test cases\n\nSigned-off-by: Sally MacFarlane <sally.macfarlane@consensys.net>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "afc7449fa1d7b407e9cfb5da0feba0c1025581bb", "author": {"user": {"login": "macfarla", "name": "Sally MacFarlane"}}, "url": "https://github.com/ConsenSys/teku/commit/afc7449fa1d7b407e9cfb5da0feba0c1025581bb", "committedDate": "2020-03-04T01:06:36Z", "message": "Merge branch 'master' of github.com:PegaSysEng/teku into beacon-validators-pagination"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "66ae4c2e7dbd8befa7af1b090c32ecd1e7f9b790", "author": {"user": {"login": "macfarla", "name": "Sally MacFarlane"}}, "url": "https://github.com/ConsenSys/teku/commit/66ae4c2e7dbd8befa7af1b090c32ecd1e7f9b790", "committedDate": "2020-03-04T01:09:31Z", "message": "generalise\n\nSigned-off-by: Sally MacFarlane <sally.macfarlane@consensys.net>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "37a7fd78e8ef40b35d2f0a64b7c7719e0218a445", "author": {"user": {"login": "macfarla", "name": "Sally MacFarlane"}}, "url": "https://github.com/ConsenSys/teku/commit/37a7fd78e8ef40b35d2f0a64b7c7719e0218a445", "committedDate": "2020-03-04T03:12:00Z", "message": "use utils\n\nSigned-off-by: Sally MacFarlane <sally.macfarlane@consensys.net>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "59925052bfc6e6eaf8443c084382439b2373bc6d", "author": {"user": {"login": "macfarla", "name": "Sally MacFarlane"}}, "url": "https://github.com/ConsenSys/teku/commit/59925052bfc6e6eaf8443c084382439b2373bc6d", "committedDate": "2020-03-04T03:34:10Z", "message": "added index to validator response\n\nSigned-off-by: Sally MacFarlane <sally.macfarlane@consensys.net>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c5d5c09c75f70fc338f3765877c5be0222431d5c", "author": {"user": {"login": "macfarla", "name": "Sally MacFarlane"}}, "url": "https://github.com/ConsenSys/teku/commit/c5d5c09c75f70fc338f3765877c5be0222431d5c", "committedDate": "2020-03-04T04:29:53Z", "message": "pass active and epoch params through to reponse creator\n\nSigned-off-by: Sally MacFarlane <sally.macfarlane@consensys.net>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "3bee2ecbd82aa740d44ac692e4afc84942606a24", "author": {"user": {"login": "macfarla", "name": "Sally MacFarlane"}}, "url": "https://github.com/ConsenSys/teku/commit/3bee2ecbd82aa740d44ac692e4afc84942606a24", "committedDate": "2020-03-04T04:29:58Z", "message": "Merge branch 'master' of github.com:PegaSysEng/teku into beacon-validators-pagination"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "993a8a76a9aa7478bcfa8efa6ab5cda0d4036ea4", "author": {"user": {"login": "macfarla", "name": "Sally MacFarlane"}}, "url": "https://github.com/ConsenSys/teku/commit/993a8a76a9aa7478bcfa8efa6ab5cda0d4036ea4", "committedDate": "2020-03-04T04:33:31Z", "message": "merge"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "bb46acb7e1334746ba1dc40b92f25527bd76ad11", "author": {"user": {"login": "macfarla", "name": "Sally MacFarlane"}}, "url": "https://github.com/ConsenSys/teku/commit/bb46acb7e1334746ba1dc40b92f25527bd76ad11", "committedDate": "2020-03-04T04:36:43Z", "message": "changed page size default to 250\n\nSigned-off-by: Sally MacFarlane <sally.macfarlane@consensys.net>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e4c340a9c7a7598fb9bd3c7e25054274ffe4fb41", "author": {"user": {"login": "macfarla", "name": "Sally MacFarlane"}}, "url": "https://github.com/ConsenSys/teku/commit/e4c340a9c7a7598fb9bd3c7e25054274ffe4fb41", "committedDate": "2020-03-04T05:01:54Z", "message": "changed page size default to 250\n\nSigned-off-by: Sally MacFarlane <sally.macfarlane@consensys.net>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "5ae15ee3f22e6caa44dd2a33e6afd15a06d2433c", "author": {"user": {"login": "macfarla", "name": "Sally MacFarlane"}}, "url": "https://github.com/ConsenSys/teku/commit/5ae15ee3f22e6caa44dd2a33e6afd15a06d2433c", "committedDate": "2020-03-04T05:02:28Z", "message": "Merge branch 'beacon-validators-pagination' of github.com:macfarla/teku into beacon-validators-pagination"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "874c90f84d0140b98e41b74ebbf845b71a6a330d", "author": {"user": {"login": "macfarla", "name": "Sally MacFarlane"}}, "url": "https://github.com/ConsenSys/teku/commit/874c90f84d0140b98e41b74ebbf845b71a6a330d", "committedDate": "2020-03-04T05:04:08Z", "message": "Merge branch 'beacon-validators-pagination' of github.com:macfarla/teku into beacon-validators-pagination"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "714e01d159831866e30869c49e73f29e07bf4674", "author": {"user": {"login": "macfarla", "name": "Sally MacFarlane"}}, "url": "https://github.com/ConsenSys/teku/commit/714e01d159831866e30869c49e73f29e07bf4674", "committedDate": "2020-03-04T05:04:30Z", "message": "Merge branch 'beacon-validators-pagination' of github.com:macfarla/teku into beacon-validators-pagination"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "bbcaf814c09c6ca05cba84dec49ab47816769772", "author": {"user": {"login": "macfarla", "name": "Sally MacFarlane"}}, "url": "https://github.com/ConsenSys/teku/commit/bbcaf814c09c6ca05cba84dec49ab47816769772", "committedDate": "2020-03-04T05:14:04Z", "message": "make tests fail more helpfully if page size is wrong\n\nSigned-off-by: Sally MacFarlane <sally.macfarlane@consensys.net>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "29f3fabb96b900defab10f0a402fb5ff51d15b61", "author": {"user": {"login": "macfarla", "name": "Sally MacFarlane"}}, "url": "https://github.com/ConsenSys/teku/commit/29f3fabb96b900defab10f0a402fb5ff51d15b61", "committedDate": "2020-03-04T05:25:45Z", "message": "fix test\n\nSigned-off-by: Sally MacFarlane <sally.macfarlane@consensys.net>"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzY4NTU0ODkw", "url": "https://github.com/ConsenSys/teku/pull/1265#pullrequestreview-368554890", "createdAt": "2020-03-04T07:34:14Z", "commit": {"oid": "29f3fabb96b900defab10f0a402fb5ff51d15b61"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wNFQwNzozNDoxNFrOFxiiaw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wNFQwNzozNDoxNFrOFxiiaw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NzQ5MDQxMQ==", "bodyText": "should probably say 'active' if that's what we're referring to by 'current'?", "url": "https://github.com/ConsenSys/teku/pull/1265#discussion_r387490411", "createdAt": "2020-03-04T07:34:14Z", "author": {"login": "rolfyone"}, "path": "data/beaconrestapi/src/main/java/tech/pegasys/artemis/beaconrestapi/beaconhandlers/BeaconValidatorsHandler.java", "diffHunk": "@@ -65,22 +63,30 @@ public BeaconValidatorsHandler(\n   @OpenApi(\n       path = ROUTE,\n       method = HttpMethod.GET,\n-      summary = \"Get validators from the running beacon node that match the specified query.\",\n+      summary = \"Returns validators that match the specified query.\",\n       tags = {TAG_BEACON},\n       description =\n-          \"Requests validator information. If no parameters specified, all current validators are returned.\",\n+          \"Returns validator information. If no parameters specified, the first page of current validators are returned.\",", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "29f3fabb96b900defab10f0a402fb5ff51d15b61"}, "originalPosition": 21}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzY5MTI3NDkz", "url": "https://github.com/ConsenSys/teku/pull/1265#pullrequestreview-369127493", "createdAt": "2020-03-04T21:14:40Z", "commit": {"oid": "29f3fabb96b900defab10f0a402fb5ff51d15b61"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "efb0012435520a82a4c034c8608347180a1bdfee", "author": {"user": {"login": "macfarla", "name": "Sally MacFarlane"}}, "url": "https://github.com/ConsenSys/teku/commit/efb0012435520a82a4c034c8608347180a1bdfee", "committedDate": "2020-03-04T21:26:59Z", "message": "updated description\n\nSigned-off-by: Sally MacFarlane <sally.macfarlane@consensys.net>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "4db750d20ec59d10ccbecb8a6e848b4a27ab24f9", "author": {"user": {"login": "macfarla", "name": "Sally MacFarlane"}}, "url": "https://github.com/ConsenSys/teku/commit/4db750d20ec59d10ccbecb8a6e848b4a27ab24f9", "committedDate": "2020-03-04T22:12:24Z", "message": "merge\n\nSigned-off-by: Sally MacFarlane <sally.macfarlane@consensys.net>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f71d08ba34ea5ecffeb9200f31a953e5e039d16b", "author": {"user": {"login": "macfarla", "name": "Sally MacFarlane"}}, "url": "https://github.com/ConsenSys/teku/commit/f71d08ba34ea5ecffeb9200f31a953e5e039d16b", "committedDate": "2020-03-04T22:45:12Z", "message": "refactoring - move get_active_validator_count to BeaconStateUtil\n\nSigned-off-by: Sally MacFarlane <sally.macfarlane@consensys.net>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "2c437f3f010629fbe2f33dabac1a47d122ee7cec", "author": {"user": {"login": "macfarla", "name": "Sally MacFarlane"}}, "url": "https://github.com/ConsenSys/teku/commit/2c437f3f010629fbe2f33dabac1a47d122ee7cec", "committedDate": "2020-03-04T23:05:30Z", "message": "total size for active=true\n\nSigned-off-by: Sally MacFarlane <sally.macfarlane@consensys.net>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a3041ee271e1f5d19126916adeec50d396110dc7", "author": {"user": {"login": "macfarla", "name": "Sally MacFarlane"}}, "url": "https://github.com/ConsenSys/teku/commit/a3041ee271e1f5d19126916adeec50d396110dc7", "committedDate": "2020-03-04T23:05:42Z", "message": "Merge branch 'master' of github.com:PegaSysEng/teku into beacon-validators-pagination"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e31c7ebaf06482d521ecc19b1863a51afc2fb815", "author": {"user": {"login": "macfarla", "name": "Sally MacFarlane"}}, "url": "https://github.com/ConsenSys/teku/commit/e31c7ebaf06482d521ecc19b1863a51afc2fb815", "committedDate": "2020-03-04T23:08:08Z", "message": "formatting\n\nSigned-off-by: Sally MacFarlane <sally.macfarlane@consensys.net>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "96c505da6edc9fe872c70e3298caef644ceb62ea", "author": {"user": {"login": "macfarla", "name": "Sally MacFarlane"}}, "url": "https://github.com/ConsenSys/teku/commit/96c505da6edc9fe872c70e3298caef644ceb62ea", "committedDate": "2020-03-04T23:19:44Z", "message": "bad request if illegalArg\n\nSigned-off-by: Sally MacFarlane <sally.macfarlane@consensys.net>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "79db18c6462e3135ad91d0e4aeefe1ceee364456", "author": {"user": {"login": "macfarla", "name": "Sally MacFarlane"}}, "url": "https://github.com/ConsenSys/teku/commit/79db18c6462e3135ad91d0e4aeefe1ceee364456", "committedDate": "2020-03-04T23:46:42Z", "message": "formatting\n\nSigned-off-by: Sally MacFarlane <sally.macfarlane@consensys.net>"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzY5MjA3NjA2", "url": "https://github.com/ConsenSys/teku/pull/1265#pullrequestreview-369207606", "createdAt": "2020-03-04T23:48:51Z", "commit": {"oid": "79db18c6462e3135ad91d0e4aeefe1ceee364456"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wNFQyMzo0ODo1MVrOFyBzMw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wNFQyMzo0ODo1MVrOFyBzMw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4ODAwMjYxMQ==", "bodyText": "@tapanshah21", "url": "https://github.com/ConsenSys/teku/pull/1265#discussion_r388002611", "createdAt": "2020-03-04T23:48:51Z", "author": {"login": "macfarla"}, "path": "data/beaconrestapi/src/test/java/tech/pegasys/artemis/beaconrestapi/beaconhandlers/BeaconValidatorsHandlerTest.java", "diffHunk": "@@ -186,45 +205,105 @@ public void shouldReturnActiveValidatorsWhenQueryByActiveOnly() throws Exception\n     assertEquals(data.get(), jsonProvider.objectToJSON(beaconActiveValidators));\n   }\n \n-  private BeaconState addActiveValidator(final BeaconState beaconState) {\n-    MutableBeaconState beaconStateW = beaconState.createWritableCopy();\n+  @Test\n+  public void shouldReturnSubsetOfValidatorsWhenQueryByEpochAndPageSize() throws Exception {\n+    BeaconValidatorsHandler handler = new BeaconValidatorsHandler(combinedClient, jsonProvider);\n+    final int suppliedPageSizeParam = 10;\n+    when(context.queryParamMap())\n+        .thenReturn(\n+            Map.of(\n+                EPOCH,\n+                List.of(epoch.toString()),\n+                PAGE_SIZE,\n+                List.of(String.valueOf(suppliedPageSizeParam))));\n+    final UnsignedLong slot = BeaconStateUtil.compute_start_slot_at_epoch(epoch);\n \n-    // create an ACTIVE validator and add it to the list\n-    MutableValidator v = DataStructureUtil.randomValidator(88).createWritableCopy();\n-    v.setActivation_eligibility_epoch(UnsignedLong.ZERO);\n-    v.setActivation_epoch(beaconState.getFinalized_checkpoint().getEpoch());\n-    beaconStateW.getValidators().add(v);\n-    return beaconStateW.commitChanges();\n+    when(combinedClient.getBestBlockRoot()).thenReturn(Optional.of(blockRoot));\n+\n+    BeaconValidatorsResponse beaconValidators =\n+        new BeaconValidatorsResponse(\n+            beaconState.getValidators(), false, epoch, suppliedPageSizeParam, PAGE_TOKEN_DEFAULT);\n+\n+    when(combinedClient.getStateAtSlot(slot, blockRoot))\n+        .thenReturn(SafeFuture.completedFuture(Optional.of(beaconState)));\n+\n+    handler.handle(context);\n+\n+    verify(combinedClient).getBestBlockRoot();\n+    verify(combinedClient).getStateAtSlot(slot, blockRoot);\n+    verify(context).result(args.capture());\n+\n+    SafeFuture<String> data = args.getValue();\n+    assertEquals(data.get(), jsonProvider.objectToJSON(beaconValidators));\n   }\n \n   @Test\n-  public void getActiveValidators() {\n-    BeaconState beaconState = DataStructureUtil.randomBeaconState(23);\n-    MutableBeaconState beaconStateW = beaconState.createWritableCopy();\n+  public void shouldReturnSubsetOfValidatorsWhenQueryByEpochAndPageSizeAndPageToken()\n+      throws Exception {\n+    BeaconValidatorsHandler handler = new BeaconValidatorsHandler(combinedClient, jsonProvider);\n+    final int suppliedPageSizeParam = 10;\n+    final int suppliedPageTokenParam = 1;\n+    when(context.queryParamMap())\n+        .thenReturn(\n+            Map.of(\n+                EPOCH,\n+                List.of(epoch.toString()),\n+                PAGE_SIZE,\n+                List.of(String.valueOf(suppliedPageSizeParam)),\n+                PAGE_TOKEN,\n+                List.of(String.valueOf(suppliedPageTokenParam))));\n+    final UnsignedLong slot = BeaconStateUtil.compute_start_slot_at_epoch(epoch);\n \n-    SSZList<Validator> allValidators = beaconState.getValidators();\n-    SSZList<Validator> activeValidators = BeaconValidatorsHandler.getActiveValidators(beaconStateW);\n-    int originalValidatorCount = allValidators.size();\n+    when(combinedClient.getBestBlockRoot()).thenReturn(Optional.of(blockRoot));\n \n-    assertThat(activeValidators.size()).isLessThanOrEqualTo(beaconStateW.getValidators().size());\n+    BeaconValidatorsResponse beaconValidators =\n+        new BeaconValidatorsResponse(\n+            beaconState.getValidators(),\n+            false,\n+            epoch,\n+            suppliedPageSizeParam,\n+            suppliedPageTokenParam);\n+\n+    when(combinedClient.getStateAtSlot(slot, blockRoot))\n+        .thenReturn(SafeFuture.completedFuture(Optional.of(beaconState)));\n+\n+    handler.handle(context);\n+\n+    verify(combinedClient).getBestBlockRoot();\n+    verify(combinedClient).getStateAtSlot(slot, blockRoot);\n+    verify(context).result(args.capture());\n+\n+    SafeFuture<String> data = args.getValue();\n+    assertEquals(data.get(), jsonProvider.objectToJSON(beaconValidators));\n+  }\n+\n+  @Test\n+  public void shouldReturnBadRequestWhenBadEpochParameterSpecified() throws Exception {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "79db18c6462e3135ad91d0e4aeefe1ceee364456"}, "originalPosition": 168}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4152, "cost": 1, "resetAt": "2021-11-01T13:51:04Z"}}}