{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDM4MjI4MDIw", "number": 2195, "reviewThreads": {"totalCount": 10, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yMlQyMzo0MToyNFrOEHw3Ag==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yM1QwMDowMjoxN1rOEHxGGg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjc2NTc2MDAyOnYy", "diffSide": "RIGHT", "path": "storage/src/main/java/tech/pegasys/teku/storage/server/VersionedDatabaseFactory.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yMlQyMzo0MToyNFrOGnUbLA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yMlQyMzo0MToyNFrOGnUbLA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0Mzg4MjI4NA==", "bodyText": "nit: I'd inline versionOptional and just do this on one line.", "url": "https://github.com/ConsenSys/teku/pull/2195#discussion_r443882284", "createdAt": "2020-06-22T23:41:24Z", "author": {"login": "ajsutton"}, "path": "storage/src/main/java/tech/pegasys/teku/storage/server/VersionedDatabaseFactory.java", "diffHunk": "@@ -30,23 +32,38 @@\n   private static final Logger LOG = LogManager.getLogger();\n \n   @VisibleForTesting static final String DB_PATH = \"db\";\n+  @VisibleForTesting static final String ARCHIVE_PATH = \"archive\";\n   @VisibleForTesting static final String DB_VERSION_PATH = \"db.version\";\n \n   private final MetricsSystem metricsSystem;\n   private final File dataDirectory;\n   private final File dbDirectory;\n+  private final File archiveDirectory;\n   private final File dbVersionFile;\n   private final StateStorageMode stateStorageMode;\n+  private final DatabaseVersion createDatabaseVersion;\n \n   public VersionedDatabaseFactory(\n       final MetricsSystem metricsSystem,\n       final String dataPath,\n       final StateStorageMode dataStorageMode) {\n+    this(metricsSystem, dataPath, dataStorageMode, \"3.0\");\n+  }\n+\n+  public VersionedDatabaseFactory(\n+      final MetricsSystem metricsSystem,\n+      final String dataPath,\n+      final StateStorageMode dataStorageMode,\n+      final String createDatabaseVersion) {\n     this.metricsSystem = metricsSystem;\n     this.dataDirectory = Paths.get(dataPath).toFile();\n     this.dbDirectory = this.dataDirectory.toPath().resolve(DB_PATH).toFile();\n+    this.archiveDirectory = this.dataDirectory.toPath().resolve(ARCHIVE_PATH).toFile();\n     this.dbVersionFile = this.dataDirectory.toPath().resolve(DB_VERSION_PATH).toFile();\n     this.stateStorageMode = dataStorageMode;\n+\n+    Optional<DatabaseVersion> versionOptional = DatabaseVersion.fromString(createDatabaseVersion);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "0c2a9f9eec6ee5e8981f35994853b8bd464f0e99"}, "originalPosition": 43}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjc2NTc2MzMxOnYy", "diffSide": "RIGHT", "path": "storage/src/main/java/tech/pegasys/teku/storage/server/VersionedDatabaseFactory.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yMlQyMzo0MzowNVrOGnUdIQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yM1QwMzoyMzo0MFrOGnX63g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0Mzg4Mjc4NQ==", "bodyText": "Probably something to follow up on later but we probably want to reduce the cache capacity and potentially other settings for the archive db since it gets used less often.", "url": "https://github.com/ConsenSys/teku/pull/2195#discussion_r443882785", "createdAt": "2020-06-22T23:43:05Z", "author": {"login": "ajsutton"}, "path": "storage/src/main/java/tech/pegasys/teku/storage/server/VersionedDatabaseFactory.java", "diffHunk": "@@ -75,6 +104,14 @@ private Database createV3Database() {\n     return RocksDbDatabase.createV3(metricsSystem, rocksDbConfiguration, stateStorageMode);\n   }\n \n+  private Database createV4Database() {\n+    return RocksDbDatabase.createV4(\n+        metricsSystem,\n+        RocksDbConfiguration.withDataDirectory(dbDirectory.toPath()),\n+        RocksDbConfiguration.withDataDirectory(archiveDirectory.toPath()),", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "0c2a9f9eec6ee5e8981f35994853b8bd464f0e99"}, "originalPosition": 81}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MzkzOTU1MA==", "bodyText": "#2196", "url": "https://github.com/ConsenSys/teku/pull/2195#discussion_r443939550", "createdAt": "2020-06-23T03:23:40Z", "author": {"login": "rolfyone"}, "path": "storage/src/main/java/tech/pegasys/teku/storage/server/VersionedDatabaseFactory.java", "diffHunk": "@@ -75,6 +104,14 @@ private Database createV3Database() {\n     return RocksDbDatabase.createV3(metricsSystem, rocksDbConfiguration, stateStorageMode);\n   }\n \n+  private Database createV4Database() {\n+    return RocksDbDatabase.createV4(\n+        metricsSystem,\n+        RocksDbConfiguration.withDataDirectory(dbDirectory.toPath()),\n+        RocksDbConfiguration.withDataDirectory(archiveDirectory.toPath()),", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0Mzg4Mjc4NQ=="}, "originalCommit": {"oid": "0c2a9f9eec6ee5e8981f35994853b8bd464f0e99"}, "originalPosition": 81}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjc2NTc2OTEyOnYy", "diffSide": "RIGHT", "path": "storage/src/main/java/tech/pegasys/teku/storage/server/VersionedDatabaseFactory.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yMlQyMzo0NjoyNFrOGnUg0Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yMlQyMzo0NjoyNFrOGnUg0Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0Mzg4MzcyOQ==", "bodyText": "hmm, this (and the one above) should actually be:\n\n  \n    \n  \n    \n\n  \n  This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters. Learn more about bidirectional Unicode characters\n\n\n  \n\n\n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                if (!archiveDirectory.exists() && !archiveDirectory.mkdirs()) {\n          \n          \n            \n                if (!archiveDirectory.mkdirs() && !archiveDirectory.isDirectory()) {\n          \n      \n    \n    \n  \n\nie try to make it and be happy as long as we wind up with a directory.  It's unlikely to matter but this way handles weird corner cases and race conditions better - plus gives a useful error message if it happens to exist as a file instead of a directory.", "url": "https://github.com/ConsenSys/teku/pull/2195#discussion_r443883729", "createdAt": "2020-06-22T23:46:24Z", "author": {"login": "ajsutton"}, "path": "storage/src/main/java/tech/pegasys/teku/storage/server/VersionedDatabaseFactory.java", "diffHunk": "@@ -91,9 +128,16 @@ private void createDirectories() {\n               \"Unable to create the path to store database files at %s\",\n               dbDirectory.getAbsolutePath()));\n     }\n+    if (!archiveDirectory.exists() && !archiveDirectory.mkdirs()) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "0c2a9f9eec6ee5e8981f35994853b8bd464f0e99"}, "originalPosition": 92}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjc2NTc3NTI4OnYy", "diffSide": "RIGHT", "path": "storage/src/main/java/tech/pegasys/teku/storage/server/VersionedDatabaseFactory.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yMlQyMzo0OTozOFrOGnUkmQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yMlQyMzo0OTozOFrOGnUkmQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0Mzg4NDY5Nw==", "bodyText": "Probably shouldn't be hard coding 3.0 here - DatabaseVersion.DEFAULT_VERSION.getValue() would work I think.", "url": "https://github.com/ConsenSys/teku/pull/2195#discussion_r443884697", "createdAt": "2020-06-22T23:49:38Z", "author": {"login": "ajsutton"}, "path": "storage/src/main/java/tech/pegasys/teku/storage/server/VersionedDatabaseFactory.java", "diffHunk": "@@ -30,23 +32,38 @@\n   private static final Logger LOG = LogManager.getLogger();\n \n   @VisibleForTesting static final String DB_PATH = \"db\";\n+  @VisibleForTesting static final String ARCHIVE_PATH = \"archive\";\n   @VisibleForTesting static final String DB_VERSION_PATH = \"db.version\";\n \n   private final MetricsSystem metricsSystem;\n   private final File dataDirectory;\n   private final File dbDirectory;\n+  private final File archiveDirectory;\n   private final File dbVersionFile;\n   private final StateStorageMode stateStorageMode;\n+  private final DatabaseVersion createDatabaseVersion;\n \n   public VersionedDatabaseFactory(\n       final MetricsSystem metricsSystem,\n       final String dataPath,\n       final StateStorageMode dataStorageMode) {\n+    this(metricsSystem, dataPath, dataStorageMode, \"3.0\");", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "0c2a9f9eec6ee5e8981f35994853b8bd464f0e99"}, "originalPosition": 28}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjc2NTc4MTgyOnYy", "diffSide": "RIGHT", "path": "teku/src/main/java/tech/pegasys/teku/cli/options/DataOptions.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yMlQyMzo1MzoxNFrOGnUoig==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yMlQyMzo1MzoxNFrOGnUoig==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0Mzg4NTcwNg==", "bodyText": "This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters. Learn more about bidirectional Unicode characters\n\n\n  \n\n\n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n              private String createDbVersion = \"3.0\";\n          \n          \n            \n              private String createDbVersion = DatabaseVersion.DEFAULT_VERSION.getValue();", "url": "https://github.com/ConsenSys/teku/pull/2195#discussion_r443885706", "createdAt": "2020-06-22T23:53:14Z", "author": {"login": "ajsutton"}, "path": "teku/src/main/java/tech/pegasys/teku/cli/options/DataOptions.java", "diffHunk": "@@ -48,9 +48,9 @@\n       paramLabel = \"<VERSION>\",\n       description = \"Database version to create (3 or 4)\",\n       arity = \"1\",\n-      defaultValue = \"3\",\n+      defaultValue = \"3.0\",\n       hidden = true)\n-  private int createDbVersion = 3;\n+  private String createDbVersion = \"3.0\";", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "0c2a9f9eec6ee5e8981f35994853b8bd464f0e99"}, "originalPosition": 8}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjc2NTc4MjMyOnYy", "diffSide": "RIGHT", "path": "teku/src/main/java/tech/pegasys/teku/cli/options/DataOptions.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yMlQyMzo1MzozMlrOGnUo3g==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yMlQyMzo1MzozMlrOGnUo3g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0Mzg4NTc5MA==", "bodyText": "omit the defaultValue here - the default is taken from the assigned value.", "url": "https://github.com/ConsenSys/teku/pull/2195#discussion_r443885790", "createdAt": "2020-06-22T23:53:32Z", "author": {"login": "ajsutton"}, "path": "teku/src/main/java/tech/pegasys/teku/cli/options/DataOptions.java", "diffHunk": "@@ -48,9 +48,9 @@\n       paramLabel = \"<VERSION>\",\n       description = \"Database version to create (3 or 4)\",\n       arity = \"1\",\n-      defaultValue = \"3\",\n+      defaultValue = \"3.0\",", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "0c2a9f9eec6ee5e8981f35994853b8bd464f0e99"}, "originalPosition": 5}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjc2NTc4NTQ2OnYy", "diffSide": "RIGHT", "path": "teku/src/main/java/tech/pegasys/teku/cli/options/DataOptions.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yMlQyMzo1NToyM1rOGnUqwA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yMlQyMzo1NToyM1rOGnUqwA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0Mzg4NjI3Mg==", "bodyText": "This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters. Learn more about bidirectional Unicode characters\n\n\n  \n\n\n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                  description = \"Database version to create (3 or 4)\",\n          \n          \n            \n                  description = \"Database version to create (3.0 or 4)\",\n          \n      \n    \n    \n  \n\nAlthough potentially we should just make this a DatabaseVersion type?  Having to specify V3 or V4 isn't ideal but for a hidden option it would be fine and makes sure we always have a valid value.", "url": "https://github.com/ConsenSys/teku/pull/2195#discussion_r443886272", "createdAt": "2020-06-22T23:55:23Z", "author": {"login": "ajsutton"}, "path": "teku/src/main/java/tech/pegasys/teku/cli/options/DataOptions.java", "diffHunk": "@@ -48,9 +48,9 @@\n       paramLabel = \"<VERSION>\",\n       description = \"Database version to create (3 or 4)\",", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "0c2a9f9eec6ee5e8981f35994853b8bd464f0e99"}, "originalPosition": 2}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjc2NTc4NzcyOnYy", "diffSide": "RIGHT", "path": "storage/src/main/java/tech/pegasys/teku/storage/server/VersionedDatabaseFactory.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yMlQyMzo1NjozN1rOGnUsIg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yMlQyMzo1NjozN1rOGnUsIg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0Mzg4NjYyNg==", "bodyText": "this.createDatabaseVersion is always set to something non-null in the constructor so don't need the fallback to default here.", "url": "https://github.com/ConsenSys/teku/pull/2195#discussion_r443886626", "createdAt": "2020-06-22T23:56:37Z", "author": {"login": "ajsutton"}, "path": "storage/src/main/java/tech/pegasys/teku/storage/server/VersionedDatabaseFactory.java", "diffHunk": "@@ -107,9 +151,8 @@ private DatabaseVersion getDatabaseVersion() {\n                 \"Unable to read database version from file %s\", dbVersionFile.getAbsolutePath()),\n             e);\n       }\n-    } else {\n-      return DatabaseVersion.DEFAULT_VERSION;\n     }\n+    return Objects.requireNonNullElse(this.createDatabaseVersion, DatabaseVersion.DEFAULT_VERSION);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "0c2a9f9eec6ee5e8981f35994853b8bd464f0e99"}, "originalPosition": 113}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjc2NTc5Njk5OnYy", "diffSide": "RIGHT", "path": "storage/src/main/java/tech/pegasys/teku/storage/server/rocksdb/RocksDbDatabase.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yM1QwMDowMToyN1rOGnUxqA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yM1QwMzoyMzoyMlrOGnX6pQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0Mzg4ODA0MA==", "bodyText": "Probably not for this PR, but I wonder if when storage mode is PRUNE we should skip loading or creating the archive db entirely and just pass in a StubRocksDbAccessor here.  Then it would automatically discard archive state and we avoid the overhead of opening a second RocksDB instance that we never actually use.", "url": "https://github.com/ConsenSys/teku/pull/2195#discussion_r443888040", "createdAt": "2020-06-23T00:01:27Z", "author": {"login": "ajsutton"}, "path": "storage/src/main/java/tech/pegasys/teku/storage/server/rocksdb/RocksDbDatabase.java", "diffHunk": "@@ -65,6 +69,18 @@ public static Database createV3(\n     return createV3(metricsSystem, db, stateStorageMode);\n   }\n \n+  public static Database createV4(\n+      final MetricsSystem metricsSystem,\n+      final RocksDbConfiguration hotConfiguration,\n+      final RocksDbConfiguration finalizedConfiguration,\n+      final StateStorageMode stateStorageMode) {\n+    final RocksDbAccessor hotDb =\n+        RocksDbInstanceFactory.create(hotConfiguration, V4SchemaHot.class);\n+    final RocksDbAccessor finalizedDb =\n+        RocksDbInstanceFactory.create(finalizedConfiguration, V4SchemaFinalized.class);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "0c2a9f9eec6ee5e8981f35994853b8bd464f0e99"}, "originalPosition": 24}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MzkzOTQ5Mw==", "bodyText": "#2197", "url": "https://github.com/ConsenSys/teku/pull/2195#discussion_r443939493", "createdAt": "2020-06-23T03:23:22Z", "author": {"login": "rolfyone"}, "path": "storage/src/main/java/tech/pegasys/teku/storage/server/rocksdb/RocksDbDatabase.java", "diffHunk": "@@ -65,6 +69,18 @@ public static Database createV3(\n     return createV3(metricsSystem, db, stateStorageMode);\n   }\n \n+  public static Database createV4(\n+      final MetricsSystem metricsSystem,\n+      final RocksDbConfiguration hotConfiguration,\n+      final RocksDbConfiguration finalizedConfiguration,\n+      final StateStorageMode stateStorageMode) {\n+    final RocksDbAccessor hotDb =\n+        RocksDbInstanceFactory.create(hotConfiguration, V4SchemaHot.class);\n+    final RocksDbAccessor finalizedDb =\n+        RocksDbInstanceFactory.create(finalizedConfiguration, V4SchemaFinalized.class);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0Mzg4ODA0MA=="}, "originalCommit": {"oid": "0c2a9f9eec6ee5e8981f35994853b8bd464f0e99"}, "originalPosition": 24}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjc2NTc5ODY2OnYy", "diffSide": "RIGHT", "path": "storage/src/main/java/tech/pegasys/teku/storage/server/rocksdb/dataaccess/V4FinalizedRocksDbDao.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yM1QwMDowMjoxN1rOGnUypw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yM1QwMToyNDo0N1rOGnWGKw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0Mzg4ODI5NQ==", "bodyText": "nit: this comment is redundant here.", "url": "https://github.com/ConsenSys/teku/pull/2195#discussion_r443888295", "createdAt": "2020-06-23T00:02:17Z", "author": {"login": "ajsutton"}, "path": "storage/src/main/java/tech/pegasys/teku/storage/server/rocksdb/dataaccess/V4FinalizedRocksDbDao.java", "diffHunk": "@@ -0,0 +1,101 @@\n+/*\n+ * Copyright 2020 ConsenSys AG.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\"); you may not use this file except in compliance with\n+ * the License. You may obtain a copy of the License at\n+ *\n+ * http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software distributed under the License is distributed on\n+ * an \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied. See the License for the\n+ * specific language governing permissions and limitations under the License.\n+ */\n+\n+package tech.pegasys.teku.storage.server.rocksdb.dataaccess;\n+\n+import com.google.common.primitives.UnsignedLong;\n+import java.util.Optional;\n+import org.apache.tuweni.bytes.Bytes32;\n+import tech.pegasys.teku.datastructures.blocks.SignedBeaconBlock;\n+import tech.pegasys.teku.datastructures.state.BeaconState;\n+import tech.pegasys.teku.storage.server.rocksdb.core.ColumnEntry;\n+import tech.pegasys.teku.storage.server.rocksdb.core.RocksDbAccessor;\n+import tech.pegasys.teku.storage.server.rocksdb.schema.V4SchemaFinalized;\n+\n+public class V4FinalizedRocksDbDao implements RocksDbFinalizedDao {\n+  // Persistent data", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "0c2a9f9eec6ee5e8981f35994853b8bd464f0e99"}, "originalPosition": 26}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MzkwOTY3NQ==", "bodyText": "copied from V3, probably redundant there too i guess :)", "url": "https://github.com/ConsenSys/teku/pull/2195#discussion_r443909675", "createdAt": "2020-06-23T01:24:47Z", "author": {"login": "rolfyone"}, "path": "storage/src/main/java/tech/pegasys/teku/storage/server/rocksdb/dataaccess/V4FinalizedRocksDbDao.java", "diffHunk": "@@ -0,0 +1,101 @@\n+/*\n+ * Copyright 2020 ConsenSys AG.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\"); you may not use this file except in compliance with\n+ * the License. You may obtain a copy of the License at\n+ *\n+ * http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software distributed under the License is distributed on\n+ * an \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied. See the License for the\n+ * specific language governing permissions and limitations under the License.\n+ */\n+\n+package tech.pegasys.teku.storage.server.rocksdb.dataaccess;\n+\n+import com.google.common.primitives.UnsignedLong;\n+import java.util.Optional;\n+import org.apache.tuweni.bytes.Bytes32;\n+import tech.pegasys.teku.datastructures.blocks.SignedBeaconBlock;\n+import tech.pegasys.teku.datastructures.state.BeaconState;\n+import tech.pegasys.teku.storage.server.rocksdb.core.ColumnEntry;\n+import tech.pegasys.teku.storage.server.rocksdb.core.RocksDbAccessor;\n+import tech.pegasys.teku.storage.server.rocksdb.schema.V4SchemaFinalized;\n+\n+public class V4FinalizedRocksDbDao implements RocksDbFinalizedDao {\n+  // Persistent data", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0Mzg4ODI5NQ=="}, "originalCommit": {"oid": "0c2a9f9eec6ee5e8981f35994853b8bd464f0e99"}, "originalPosition": 26}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3621, "cost": 1, "resetAt": "2021-11-12T11:57:46Z"}}}