{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDg0NjM2NDM0", "number": 2782, "reviewThreads": {"totalCount": 8, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xNFQwMDo0NDo0OVrOEi7cVw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xNFQwNDoxMjozNlrOEi9Lqw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzA1MDYwOTUxOnYy", "diffSide": "RIGHT", "path": "validator/remote/src/main/java/tech/pegasys/teku/validator/remote/RemoteValidatorApiHandler.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xNFQwMDo0NDo0OVrOHRAyog==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xNFQwMTo0NjowNVrOHRBb2Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NzYwMDgwMg==", "bodyText": "I'm pretty sure this isn't called anywhere currently, because the empty list would cause problems...\nI'm not overly concerned, but when we switch to using this remote implementation it'll need to be resolved.", "url": "https://github.com/ConsenSys/teku/pull/2782#discussion_r487600802", "createdAt": "2020-09-14T00:44:49Z", "author": {"login": "rolfyone"}, "path": "validator/remote/src/main/java/tech/pegasys/teku/validator/remote/RemoteValidatorApiHandler.java", "diffHunk": "@@ -96,6 +97,31 @@ private ForkInfo mapGetForkResponse(final GetForkResponse response) {\n         });\n   }\n \n+  @Override\n+  public SafeFuture<Optional<List<ValidatorDuties>>> getAttestationDuties(\n+      final UInt64 epoch, final Collection<Integer> validatorIndexes) {\n+    return asyncRunner.runAsync(\n+        () -> {\n+          final List<ValidatorDuties> validatorDuties =\n+              apiClient.getAttestationDuties(epoch, validatorIndexes).stream()\n+                  .map(this::mapToApiValidatorDuties)\n+                  .collect(Collectors.toList());\n+\n+          return Optional.of(validatorDuties);\n+        });\n+  }\n+\n+  private ValidatorDuties mapToApiValidatorDuties(final AttesterDuty attesterDuty) {\n+    return ValidatorDuties.withDuties(\n+        attesterDuty.pubkey.asBLSPublicKey(),\n+        attesterDuty.validatorIndex.intValue(),\n+        attesterDuty.committeeIndex.intValue(),\n+        attesterDuty.validatorCommitteeIndex.intValue(),\n+        attesterDuty.committeeLength.intValue(),\n+        List.of(),\n+        attesterDuty.slot);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d635a04cfff9c807e4382c97075bb6e822b6e81b"}, "originalPosition": 34}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NzYxMTM1Mw==", "bodyText": "This would work out better if we split ValidatorDuties into separate parts.", "url": "https://github.com/ConsenSys/teku/pull/2782#discussion_r487611353", "createdAt": "2020-09-14T01:46:05Z", "author": {"login": "ajsutton"}, "path": "validator/remote/src/main/java/tech/pegasys/teku/validator/remote/RemoteValidatorApiHandler.java", "diffHunk": "@@ -96,6 +97,31 @@ private ForkInfo mapGetForkResponse(final GetForkResponse response) {\n         });\n   }\n \n+  @Override\n+  public SafeFuture<Optional<List<ValidatorDuties>>> getAttestationDuties(\n+      final UInt64 epoch, final Collection<Integer> validatorIndexes) {\n+    return asyncRunner.runAsync(\n+        () -> {\n+          final List<ValidatorDuties> validatorDuties =\n+              apiClient.getAttestationDuties(epoch, validatorIndexes).stream()\n+                  .map(this::mapToApiValidatorDuties)\n+                  .collect(Collectors.toList());\n+\n+          return Optional.of(validatorDuties);\n+        });\n+  }\n+\n+  private ValidatorDuties mapToApiValidatorDuties(final AttesterDuty attesterDuty) {\n+    return ValidatorDuties.withDuties(\n+        attesterDuty.pubkey.asBLSPublicKey(),\n+        attesterDuty.validatorIndex.intValue(),\n+        attesterDuty.committeeIndex.intValue(),\n+        attesterDuty.validatorCommitteeIndex.intValue(),\n+        attesterDuty.committeeLength.intValue(),\n+        List.of(),\n+        attesterDuty.slot);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NzYwMDgwMg=="}, "originalCommit": {"oid": "d635a04cfff9c807e4382c97075bb6e822b6e81b"}, "originalPosition": 34}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzA1MDYzODEwOnYy", "diffSide": "RIGHT", "path": "data/beaconrestapi/src/main/java/tech/pegasys/teku/beaconrestapi/ListQueryParameterUtils.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xNFQwMToxMDo1NVrOHRBBwQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xNFQwMjowOToxMVrOHRBtrw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NzYwNDY3Mw==", "bodyText": "Slightly confused that we treat , as an item separator for int lists but not for string lists.  Shouldn't we be consistent?\nOr maybe this method should just be private?", "url": "https://github.com/ConsenSys/teku/pull/2782#discussion_r487604673", "createdAt": "2020-09-14T01:10:55Z", "author": {"login": "ajsutton"}, "path": "data/beaconrestapi/src/main/java/tech/pegasys/teku/beaconrestapi/ListQueryParameterUtils.java", "diffHunk": "@@ -0,0 +1,58 @@\n+/*\n+ * Copyright 2020 ConsenSys AG.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\"); you may not use this file except in compliance with\n+ * the License. You may obtain a copy of the License at\n+ *\n+ * http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software distributed under the License is distributed on\n+ * an \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied. See the License for the\n+ * specific language governing permissions and limitations under the License.\n+ */\n+\n+package tech.pegasys.teku.beaconrestapi;\n+\n+import com.google.common.base.Splitter;\n+import java.util.List;\n+import java.util.Map;\n+import java.util.stream.Collectors;\n+import org.apache.commons.lang3.StringUtils;\n+\n+public class ListQueryParameterUtils {\n+  public static final String MISSING_QUERY_PARAMETER = \"Query parameter %s not found\";\n+  public static final Splitter splitter = Splitter.on(',').trimResults().omitEmptyStrings();\n+\n+  public static List<String> validateQueryParameter(\n+      final Map<String, List<String>> parameterMap, final String key)\n+      throws IllegalArgumentException {\n+    if (parameterMap.containsKey(key)) {\n+      final List<String> values = parameterMap.get(key);\n+      if (values.isEmpty()) {\n+        throw new IllegalArgumentException(String.format(MISSING_QUERY_PARAMETER, key));\n+      }\n+      // if its an array, we should filter any individual empty values out for sanity\n+      return parameterMap.get(key).stream()\n+          .filter(StringUtils::isNotEmpty)\n+          .collect(Collectors.toList());", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ff516b5f8ebbca4fc5502d8ba575bcd50496fc0a"}, "originalPosition": 37}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NzYxNTkxOQ==", "bodyText": "made private", "url": "https://github.com/ConsenSys/teku/pull/2782#discussion_r487615919", "createdAt": "2020-09-14T02:09:11Z", "author": {"login": "rolfyone"}, "path": "data/beaconrestapi/src/main/java/tech/pegasys/teku/beaconrestapi/ListQueryParameterUtils.java", "diffHunk": "@@ -0,0 +1,58 @@\n+/*\n+ * Copyright 2020 ConsenSys AG.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\"); you may not use this file except in compliance with\n+ * the License. You may obtain a copy of the License at\n+ *\n+ * http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software distributed under the License is distributed on\n+ * an \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied. See the License for the\n+ * specific language governing permissions and limitations under the License.\n+ */\n+\n+package tech.pegasys.teku.beaconrestapi;\n+\n+import com.google.common.base.Splitter;\n+import java.util.List;\n+import java.util.Map;\n+import java.util.stream.Collectors;\n+import org.apache.commons.lang3.StringUtils;\n+\n+public class ListQueryParameterUtils {\n+  public static final String MISSING_QUERY_PARAMETER = \"Query parameter %s not found\";\n+  public static final Splitter splitter = Splitter.on(',').trimResults().omitEmptyStrings();\n+\n+  public static List<String> validateQueryParameter(\n+      final Map<String, List<String>> parameterMap, final String key)\n+      throws IllegalArgumentException {\n+    if (parameterMap.containsKey(key)) {\n+      final List<String> values = parameterMap.get(key);\n+      if (values.isEmpty()) {\n+        throw new IllegalArgumentException(String.format(MISSING_QUERY_PARAMETER, key));\n+      }\n+      // if its an array, we should filter any individual empty values out for sanity\n+      return parameterMap.get(key).stream()\n+          .filter(StringUtils::isNotEmpty)\n+          .collect(Collectors.toList());", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NzYwNDY3Mw=="}, "originalCommit": {"oid": "ff516b5f8ebbca4fc5502d8ba575bcd50496fc0a"}, "originalPosition": 37}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzA1MDY0OTIyOnYy", "diffSide": "RIGHT", "path": "data/beaconrestapi/src/test/java/tech/pegasys/teku/beaconrestapi/AbstractBeaconHandlerTest.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xNFQwMToxODo1MVrOHRBHgw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xNFQwMToxODo1MVrOHRBHgw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NzYwNjE0Nw==", "bodyText": "Wes should check the future is actually completed first so we don't hang forever:\n\n  \n    \n  \n    \n\n  \n  This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters. Learn more about bidirectional Unicode characters\n\n\n  \n\n\n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                String data = future.get();\n          \n          \n            \n                assertThat(future).isCompleted();\n          \n          \n            \n                String data = future.join();\n          \n      \n    \n    \n  \n\nThen using join instead of get will let you drop most of the declared exceptions.", "url": "https://github.com/ConsenSys/teku/pull/2782#discussion_r487606147", "createdAt": "2020-09-14T01:18:51Z", "author": {"login": "ajsutton"}, "path": "data/beaconrestapi/src/test/java/tech/pegasys/teku/beaconrestapi/AbstractBeaconHandlerTest.java", "diffHunk": "@@ -57,6 +63,14 @@ protected void verifyStatusCode(final int statusCode) {\n     return jsonProvider.jsonToObject(val, clazz);\n   }\n \n+  protected <T> T getResponseFromFuture(Class<T> clazz)\n+      throws ExecutionException, InterruptedException, JsonProcessingException {\n+    verify(context).result(args.capture());\n+    SafeFuture<String> future = args.getValue();\n+    String data = future.get();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ff516b5f8ebbca4fc5502d8ba575bcd50496fc0a"}, "originalPosition": 42}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzA1MDY1MDc0OnYy", "diffSide": "RIGHT", "path": "data/beaconrestapi/src/test/java/tech/pegasys/teku/beaconrestapi/ListQueryParameterUtilsTest.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xNFQwMToxOTo1NVrOHRBIVw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xNFQwMToxOTo1NVrOHRBIVw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NzYwNjM1OQ==", "bodyText": "We seem to only be testing the integer method, not validateQueryParameter.", "url": "https://github.com/ConsenSys/teku/pull/2782#discussion_r487606359", "createdAt": "2020-09-14T01:19:55Z", "author": {"login": "ajsutton"}, "path": "data/beaconrestapi/src/test/java/tech/pegasys/teku/beaconrestapi/ListQueryParameterUtilsTest.java", "diffHunk": "@@ -0,0 +1,50 @@\n+/*\n+ * Copyright 2020 ConsenSys AG.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\"); you may not use this file except in compliance with\n+ * the License. You may obtain a copy of the License at\n+ *\n+ * http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software distributed under the License is distributed on\n+ * an \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied. See the License for the\n+ * specific language governing permissions and limitations under the License.\n+ */\n+\n+package tech.pegasys.teku.beaconrestapi;\n+\n+import static org.assertj.core.api.Assertions.assertThat;\n+\n+import java.util.List;\n+import java.util.Map;\n+import org.junit.jupiter.api.Test;\n+\n+public class ListQueryParameterUtilsTest {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ff516b5f8ebbca4fc5502d8ba575bcd50496fc0a"}, "originalPosition": 22}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzA1MDY1MzgxOnYy", "diffSide": "RIGHT", "path": "data/provider/src/main/java/tech/pegasys/teku/api/ValidatorDataProvider.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xNFQwMToyMjoyNlrOHRBKEg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xNFQwMjoxMDoxOVrOHRBumQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NzYwNjgwMg==", "bodyText": "Wouldn't Optional.empty() mean the data is unavailable? Should we be returning Optional.of(emptyList())? ie we have supplied all the requested data, there just isn't any.", "url": "https://github.com/ConsenSys/teku/pull/2782#discussion_r487606802", "createdAt": "2020-09-14T01:22:26Z", "author": {"login": "ajsutton"}, "path": "data/provider/src/main/java/tech/pegasys/teku/api/ValidatorDataProvider.java", "diffHunk": "@@ -215,4 +216,32 @@ public void subscribeToPersistentSubnets(final List<SubnetSubscription> subnetSu\n                 .collect(Collectors.toSet());\n     validatorApiChannel.subscribeToPersistentSubnets(internalSubnetSubscriptions);\n   }\n+\n+  public SafeFuture<Optional<List<AttesterDuty>>> getAttesterDuties(\n+      final UInt64 epoch, final List<Integer> indexes) {\n+    if (indexes.isEmpty()) {\n+      return SafeFuture.completedFuture(Optional.empty());", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ff516b5f8ebbca4fc5502d8ba575bcd50496fc0a"}, "originalPosition": 16}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NzYxNjE1Mw==", "bodyText": "We could do that, I had that earlier and changed it when i was testing, but i'll update the test.", "url": "https://github.com/ConsenSys/teku/pull/2782#discussion_r487616153", "createdAt": "2020-09-14T02:10:19Z", "author": {"login": "rolfyone"}, "path": "data/provider/src/main/java/tech/pegasys/teku/api/ValidatorDataProvider.java", "diffHunk": "@@ -215,4 +216,32 @@ public void subscribeToPersistentSubnets(final List<SubnetSubscription> subnetSu\n                 .collect(Collectors.toSet());\n     validatorApiChannel.subscribeToPersistentSubnets(internalSubnetSubscriptions);\n   }\n+\n+  public SafeFuture<Optional<List<AttesterDuty>>> getAttesterDuties(\n+      final UInt64 epoch, final List<Integer> indexes) {\n+    if (indexes.isEmpty()) {\n+      return SafeFuture.completedFuture(Optional.empty());", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NzYwNjgwMg=="}, "originalCommit": {"oid": "ff516b5f8ebbca4fc5502d8ba575bcd50496fc0a"}, "originalPosition": 16}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzA1MDY4NTM0OnYy", "diffSide": "RIGHT", "path": "validator/coordinator/src/main/java/tech/pegasys/teku/validator/coordinator/ValidatorApiHandler.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xNFQwMTo0NToyOFrOHRBbYw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xNFQwMTo0NToyOFrOHRBbYw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NzYxMTIzNQ==", "bodyText": "This method seems to be converting from index, to public key, then a couple of levels down getValidatorDutiesFromState converts from public key back to index.\nGiven we don't need the proposal slots it could just call createValidatorDuties directly and pass an empty map for the proposal slots. Ideally though we'd split the internal representation of ValidatorDuties in two so internally we calculate attestations and proposals separately, then for the existing API we combine them at the API layer.  Currently we're calculating proposer duties when the get attestations endpoint is called.", "url": "https://github.com/ConsenSys/teku/pull/2782#discussion_r487611235", "createdAt": "2020-09-14T01:45:28Z", "author": {"login": "ajsutton"}, "path": "validator/coordinator/src/main/java/tech/pegasys/teku/validator/coordinator/ValidatorApiHandler.java", "diffHunk": "@@ -325,6 +346,16 @@ private boolean headBlockIsTooFarBehind() {\n     return headEpoch.plus(1).isLessThan(currentEpoch);\n   }\n \n+  private List<ValidatorDuties> getValidatorDutiesFromIndexes(\n+      final BeaconState state, final UInt64 epoch, final Collection<Integer> validatorIndexes) {\n+    List<BLSPublicKey> publicKeys =\n+        validatorIndexes.stream()\n+            .map(index -> state.getValidators().get(index))\n+            .map(Validator::getPubkey)\n+            .collect(toList());\n+    return getValidatorDutiesFromState(state, epoch, publicKeys);\n+  }", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ff516b5f8ebbca4fc5502d8ba575bcd50496fc0a"}, "originalPosition": 47}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzA1MDg5MjY2OnYy", "diffSide": "RIGHT", "path": "data/provider/src/test/java/tech/pegasys/teku/api/ValidatorDataProviderTest.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xNFQwNDoxMTowOVrOHRDRQw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xNFQwNDoxMTowOVrOHRDRQw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NzY0MTQxMQ==", "bodyText": "nit:\n\n  \n    \n  \n    \n\n  \n  This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters. Learn more about bidirectional Unicode characters\n\n\n  \n\n\n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                assertThat(future).isCompleted();\n          \n          \n            \n                Optional<List<AttesterDuty>> maybeData = future.join();\n          \n          \n            \n                assertThat(maybeData.isPresent()).isTrue();\n          \n          \n            \n                assertThat(maybeData.get()).isEmpty();\n          \n          \n            \n                assertThatSafeFuture(future).isCompletedWithEmptyOptional();", "url": "https://github.com/ConsenSys/teku/pull/2782#discussion_r487641411", "createdAt": "2020-09-14T04:11:09Z", "author": {"login": "ajsutton"}, "path": "data/provider/src/test/java/tech/pegasys/teku/api/ValidatorDataProviderTest.java", "diffHunk": "@@ -363,6 +365,53 @@ public void submitSignedBlock_shouldReturn500ForInternalError()\n     assertThat(validatorBlockResultSafeFuture.get().getResponseCode()).isEqualTo(500);\n   }\n \n+  @Test\n+  public void getAttesterDuties_shouldHandleEmptyIndexesList() {\n+    final SafeFuture<Optional<List<AttesterDuty>>> future =\n+        provider.getAttesterDuties(UInt64.ONE, List.of());\n+    assertThat(future).isCompleted();\n+    Optional<List<AttesterDuty>> maybeData = future.join();\n+    assertThat(maybeData.isPresent()).isTrue();\n+    assertThat(maybeData.get()).isEmpty();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "07629784c49f3f36f31df7d1c4cbc6f4cf75757d"}, "originalPosition": 27}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzA1MDg5NDUxOnYy", "diffSide": "RIGHT", "path": "validator/coordinator/src/main/java/tech/pegasys/teku/validator/coordinator/ValidatorApiHandler.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xNFQwNDoxMjozNlrOHRDSTA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xNFQwNDoxMjozNlrOHRDSTA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NzY0MTY3Ng==", "bodyText": "This is way into the personal preference category but I tend to use Collections.emptyMap() over Map.of() as it reads better. Works either way though.", "url": "https://github.com/ConsenSys/teku/pull/2782#discussion_r487641676", "createdAt": "2020-09-14T04:12:36Z", "author": {"login": "ajsutton"}, "path": "validator/coordinator/src/main/java/tech/pegasys/teku/validator/coordinator/ValidatorApiHandler.java", "diffHunk": "@@ -345,6 +365,24 @@ private ValidatorDuties getDutiesForValidator(\n         .orElseGet(() -> ValidatorDuties.noDuties(key));\n   }\n \n+  private List<ValidatorDuties> getValidatorDutiesFromIndexes(\n+      final BeaconState state, final UInt64 epoch, final Collection<Integer> validatorIndexes) {\n+    return validatorIndexes.stream()\n+        .map(index -> createValidatorDuties(state, epoch, index))\n+        .collect(toList());\n+  }\n+\n+  private ValidatorDuties createValidatorDuties(\n+      final BeaconState state, final UInt64 epoch, final Integer validatorIndex) {\n+    try {\n+      BLSPublicKey pkey = state.getValidators().get(validatorIndex).getPubkey();\n+      return createValidatorDuties(Map.of(), pkey, state, epoch, validatorIndex);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "07629784c49f3f36f31df7d1c4cbc6f4cf75757d"}, "originalPosition": 42}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3244, "cost": 1, "resetAt": "2021-11-12T11:57:46Z"}}}