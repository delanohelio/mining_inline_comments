{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0Mzg5NjQ0NDI0", "number": 1390, "reviewThreads": {"totalCount": 6, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xOFQyMzowMTozOVrODpTqlw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xOVQwMDo1NjoyN1rODpVM8Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjQ0NjQwNDA3OnYy", "diffSide": "RIGHT", "path": "data/provider/src/main/java/tech/pegasys/artemis/api/ValidatorDataProvider.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xOFQyMzowMTozOVrOF4Z0IQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xOFQyMzowMTozOVrOF4Z0IQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NDY4NzUyMQ==", "bodyText": "We shouldn't be swallowing this exception.  Needs to log it somewhere or rethrow. I suspect it's probably a fairly important error and not something we'd expect.", "url": "https://github.com/ConsenSys/teku/pull/1390#discussion_r394687521", "createdAt": "2020-03-18T23:01:39Z", "author": {"login": "ajsutton"}, "path": "data/provider/src/main/java/tech/pegasys/artemis/api/ValidatorDataProvider.java", "diffHunk": "@@ -0,0 +1,50 @@\n+/*\n+ * Copyright 2020 ConsenSys AG.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\"); you may not use this file except in compliance with\n+ * the License. You may obtain a copy of the License at\n+ *\n+ * http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software distributed under the License is distributed on\n+ * an \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied. See the License for the\n+ * specific language governing permissions and limitations under the License.\n+ */\n+\n+package tech.pegasys.artemis.api;\n+\n+import com.google.common.primitives.UnsignedLong;\n+import java.util.Optional;\n+import tech.pegasys.artemis.api.schema.BLSSignature;\n+import tech.pegasys.artemis.api.schema.BeaconBlock;\n+import tech.pegasys.artemis.validator.coordinator.ValidatorCoordinator;\n+\n+public class ValidatorDataProvider {\n+  private volatile ValidatorCoordinator validatorCoordinator;\n+\n+  public ValidatorDataProvider(ValidatorCoordinator validatorCoordinator) {\n+    this.validatorCoordinator = validatorCoordinator;\n+  }\n+\n+  public Optional<BeaconBlock> getUnsignedBeaconBlockAtSlot(\n+      UnsignedLong slot, BLSSignature randao) {\n+    if (slot == null) {\n+      throw new IllegalArgumentException(\"no slot provided.\");\n+    }\n+    if (randao == null) {\n+      throw new IllegalArgumentException(\"no randao_reveal provided.\");\n+    }\n+\n+    try {\n+      Optional<tech.pegasys.artemis.datastructures.blocks.BeaconBlock> newBlock =\n+          validatorCoordinator.createUnsignedBlock(\n+              slot, tech.pegasys.artemis.util.bls.BLSSignature.fromBytes(randao.getBytes()));\n+      if (newBlock.isPresent()) {\n+        return Optional.of(new BeaconBlock(newBlock.get()));\n+      }\n+    } catch (Exception ex) {\n+      return Optional.empty();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "15361ccc729ffd696632f01e2ab1bf51d5e4073d"}, "originalPosition": 46}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjQ0NjU2NzkyOnYy", "diffSide": "RIGHT", "path": "data/beaconrestapi/src/main/java/tech/pegasys/artemis/beaconrestapi/BeaconRestApi.java", "isResolved": true, "comments": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xOVQwMDoxNzowNFrOF4bZ3A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xOVQwMDo1NDo1NlrOF4cRxQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NDcxMzU2NA==", "bodyText": "this should be imported?", "url": "https://github.com/ConsenSys/teku/pull/1390#discussion_r394713564", "createdAt": "2020-03-19T00:17:04Z", "author": {"login": "macfarla"}, "path": "data/beaconrestapi/src/main/java/tech/pegasys/artemis/beaconrestapi/BeaconRestApi.java", "diffHunk": "@@ -163,6 +163,10 @@ private void addValidatorHandlers(DataProvider dataProvider) {\n     ChainDataProvider provider = dataProvider.getChainDataProvider();\n     app.get(GetAttestation.ROUTE, new GetAttestation(provider, jsonProvider));\n     app.get(GetValidators.ROUTE, new GetValidators(provider, jsonProvider));\n+    app.get(\n+        tech.pegasys.artemis.beaconrestapi.handlers.validator.GetBlock.ROUTE,", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "15361ccc729ffd696632f01e2ab1bf51d5e4073d"}, "originalPosition": 5}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NDcxNjUwMA==", "bodyText": "oh it's a name collision", "url": "https://github.com/ConsenSys/teku/pull/1390#discussion_r394716500", "createdAt": "2020-03-19T00:20:29Z", "author": {"login": "macfarla"}, "path": "data/beaconrestapi/src/main/java/tech/pegasys/artemis/beaconrestapi/BeaconRestApi.java", "diffHunk": "@@ -163,6 +163,10 @@ private void addValidatorHandlers(DataProvider dataProvider) {\n     ChainDataProvider provider = dataProvider.getChainDataProvider();\n     app.get(GetAttestation.ROUTE, new GetAttestation(provider, jsonProvider));\n     app.get(GetValidators.ROUTE, new GetValidators(provider, jsonProvider));\n+    app.get(\n+        tech.pegasys.artemis.beaconrestapi.handlers.validator.GetBlock.ROUTE,", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NDcxMzU2NA=="}, "originalCommit": {"oid": "15361ccc729ffd696632f01e2ab1bf51d5e4073d"}, "originalPosition": 5}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NDcyMzU5MA==", "bodyText": "yeh i'd have to rename it... could possibly call it GetNewBlock to avoid the name collision...", "url": "https://github.com/ConsenSys/teku/pull/1390#discussion_r394723590", "createdAt": "2020-03-19T00:37:48Z", "author": {"login": "rolfyone"}, "path": "data/beaconrestapi/src/main/java/tech/pegasys/artemis/beaconrestapi/BeaconRestApi.java", "diffHunk": "@@ -163,6 +163,10 @@ private void addValidatorHandlers(DataProvider dataProvider) {\n     ChainDataProvider provider = dataProvider.getChainDataProvider();\n     app.get(GetAttestation.ROUTE, new GetAttestation(provider, jsonProvider));\n     app.get(GetValidators.ROUTE, new GetValidators(provider, jsonProvider));\n+    app.get(\n+        tech.pegasys.artemis.beaconrestapi.handlers.validator.GetBlock.ROUTE,", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NDcxMzU2NA=="}, "originalCommit": {"oid": "15361ccc729ffd696632f01e2ab1bf51d5e4073d"}, "originalPosition": 5}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NDcyNzg3Nw==", "bodyText": "do we want them named the same or is it confusing", "url": "https://github.com/ConsenSys/teku/pull/1390#discussion_r394727877", "createdAt": "2020-03-19T00:54:56Z", "author": {"login": "macfarla"}, "path": "data/beaconrestapi/src/main/java/tech/pegasys/artemis/beaconrestapi/BeaconRestApi.java", "diffHunk": "@@ -163,6 +163,10 @@ private void addValidatorHandlers(DataProvider dataProvider) {\n     ChainDataProvider provider = dataProvider.getChainDataProvider();\n     app.get(GetAttestation.ROUTE, new GetAttestation(provider, jsonProvider));\n     app.get(GetValidators.ROUTE, new GetValidators(provider, jsonProvider));\n+    app.get(\n+        tech.pegasys.artemis.beaconrestapi.handlers.validator.GetBlock.ROUTE,", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NDcxMzU2NA=="}, "originalCommit": {"oid": "15361ccc729ffd696632f01e2ab1bf51d5e4073d"}, "originalPosition": 5}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjQ0NjU3ODA1OnYy", "diffSide": "RIGHT", "path": "data/beaconrestapi/src/main/java/tech/pegasys/artemis/beaconrestapi/SingleQueryParameterUtils.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xOVQwMDoxOToxMlrOF4bg5w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xOVQwMDoxOToxMlrOF4bg5w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NDcxNTM2Nw==", "bodyText": "nit: can bytes32 come first", "url": "https://github.com/ConsenSys/teku/pull/1390#discussion_r394715367", "createdAt": "2020-03-19T00:19:12Z", "author": {"login": "macfarla"}, "path": "data/beaconrestapi/src/main/java/tech/pegasys/artemis/beaconrestapi/SingleQueryParameterUtils.java", "diffHunk": "@@ -18,9 +18,12 @@\n import java.util.Map;\n import org.apache.commons.lang3.StringUtils;\n import org.apache.tuweni.bytes.Bytes32;\n+import tech.pegasys.artemis.api.schema.BLSSignature;\n \n public class SingleQueryParameterUtils {\n \n+  public static final String INVALID_BYTES96_DATA =", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "15361ccc729ffd696632f01e2ab1bf51d5e4073d"}, "originalPosition": 8}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjQ0NjU4MDIxOnYy", "diffSide": "RIGHT", "path": "data/beaconrestapi/src/main/java/tech/pegasys/artemis/beaconrestapi/SingleQueryParameterUtils.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xOVQwMDoxOTozOVrOF4biQg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xOVQwMDoxOTozOVrOF4biQg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NDcxNTcxNA==", "bodyText": "should this be bytes96? is that why you added it?", "url": "https://github.com/ConsenSys/teku/pull/1390#discussion_r394715714", "createdAt": "2020-03-19T00:19:39Z", "author": {"login": "macfarla"}, "path": "data/beaconrestapi/src/main/java/tech/pegasys/artemis/beaconrestapi/SingleQueryParameterUtils.java", "diffHunk": "@@ -92,4 +95,15 @@ public static Bytes32 getParameterValueAsBytes32(\n       throw new IllegalArgumentException(INVALID_BYTES32_DATA);\n     }\n   }\n+\n+  public static BLSSignature getParameterValueAsBLSSignature(\n+      final Map<String, List<String>> parameterMap, final String key)\n+      throws IllegalArgumentException {\n+    String stringValue = validateQueryParameter(parameterMap, key);\n+    try {\n+      return BLSSignature.fromHexString(stringValue);\n+    } catch (IllegalArgumentException ex) {\n+      throw new IllegalArgumentException(INVALID_BYTES32_DATA);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "15361ccc729ffd696632f01e2ab1bf51d5e4073d"}, "originalPosition": 25}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjQ0NjYxOTU1OnYy", "diffSide": "RIGHT", "path": "data/beaconrestapi/src/test/java/tech/pegasys/artemis/beaconrestapi/SingleQueryParameterUtilsTest.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xOVQwMDozMzowOFrOF4b7_g==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xOVQwMDozMzowOFrOF4b7_g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NDcyMjMwMg==", "bodyText": "96", "url": "https://github.com/ConsenSys/teku/pull/1390#discussion_r394722302", "createdAt": "2020-03-19T00:33:08Z", "author": {"login": "macfarla"}, "path": "data/beaconrestapi/src/test/java/tech/pegasys/artemis/beaconrestapi/SingleQueryParameterUtilsTest.java", "diffHunk": "@@ -116,4 +119,18 @@ public void getParameterAsBytes32_shouldParseHex32String() {\n     Bytes32 result = getParameterValueAsBytes32(data, KEY);\n     assertEquals(bytes32, result);\n   }\n+\n+  @Test\n+  public void getParameterAsBLSSignature_shouldThrowIfCannotParse() {\n+    assertThrows(\n+        IllegalArgumentException.class, () -> getParameterValueAsBytes32(INVALID_DATA, KEY));", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "15361ccc729ffd696632f01e2ab1bf51d5e4073d"}, "originalPosition": 27}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjQ0NjY1NTg1OnYy", "diffSide": "RIGHT", "path": "data/provider/src/main/java/tech/pegasys/artemis/api/ChainDataProvider.java", "isResolved": true, "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xOVQwMDo1NjoyN1rOF4cTHQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xOVQwMjoyNzoxNlrOF4eAGw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NDcyODIyMQ==", "bodyText": "this naming stuff is getting messy", "url": "https://github.com/ConsenSys/teku/pull/1390#discussion_r394728221", "createdAt": "2020-03-19T00:56:27Z", "author": {"login": "macfarla"}, "path": "data/provider/src/main/java/tech/pegasys/artemis/api/ChainDataProvider.java", "diffHunk": "@@ -73,7 +72,9 @@ public ChainDataProvider(\n \n     Optional<Bytes32> headBlockRoot = chainStorageClient.getBestBlockRoot();\n     Optional<Bytes32> headStateRoot =\n-        headBlockRoot.flatMap(chainStorageClient::getBlockByRoot).map(BeaconBlock::getState_root);\n+        headBlockRoot\n+            .flatMap(chainStorageClient::getBlockByRoot)\n+            .map(tech.pegasys.artemis.datastructures.blocks.BeaconBlock::getState_root);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "15361ccc729ffd696632f01e2ab1bf51d5e4073d"}, "originalPosition": 15}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NDczNjY3Mg==", "bodyText": "any ideas?", "url": "https://github.com/ConsenSys/teku/pull/1390#discussion_r394736672", "createdAt": "2020-03-19T01:21:38Z", "author": {"login": "rolfyone"}, "path": "data/provider/src/main/java/tech/pegasys/artemis/api/ChainDataProvider.java", "diffHunk": "@@ -73,7 +72,9 @@ public ChainDataProvider(\n \n     Optional<Bytes32> headBlockRoot = chainStorageClient.getBestBlockRoot();\n     Optional<Bytes32> headStateRoot =\n-        headBlockRoot.flatMap(chainStorageClient::getBlockByRoot).map(BeaconBlock::getState_root);\n+        headBlockRoot\n+            .flatMap(chainStorageClient::getBlockByRoot)\n+            .map(tech.pegasys.artemis.datastructures.blocks.BeaconBlock::getState_root);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NDcyODIyMQ=="}, "originalCommit": {"oid": "15361ccc729ffd696632f01e2ab1bf51d5e4073d"}, "originalPosition": 15}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NDc1NjEyMw==", "bodyText": "not right now", "url": "https://github.com/ConsenSys/teku/pull/1390#discussion_r394756123", "createdAt": "2020-03-19T02:27:16Z", "author": {"login": "macfarla"}, "path": "data/provider/src/main/java/tech/pegasys/artemis/api/ChainDataProvider.java", "diffHunk": "@@ -73,7 +72,9 @@ public ChainDataProvider(\n \n     Optional<Bytes32> headBlockRoot = chainStorageClient.getBestBlockRoot();\n     Optional<Bytes32> headStateRoot =\n-        headBlockRoot.flatMap(chainStorageClient::getBlockByRoot).map(BeaconBlock::getState_root);\n+        headBlockRoot\n+            .flatMap(chainStorageClient::getBlockByRoot)\n+            .map(tech.pegasys.artemis.datastructures.blocks.BeaconBlock::getState_root);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NDcyODIyMQ=="}, "originalCommit": {"oid": "15361ccc729ffd696632f01e2ab1bf51d5e4073d"}, "originalPosition": 15}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2557, "cost": 1, "resetAt": "2021-11-12T11:57:46Z"}}}