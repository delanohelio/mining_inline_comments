{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTI1NDQxNDQ0", "number": 3281, "title": "verify the unsigned data returned for signing is for the expected slot", "bodyText": "partially addresses #3154\nSigned-off-by: Paul Harris paul.harris@consensys.net\nDocumentation\n\n I thought about documentation and added the documentation label to this PR if updates are required.", "createdAt": "2020-11-23T04:39:28Z", "url": "https://github.com/ConsenSys/teku/pull/3281", "merged": true, "mergeCommit": {"oid": "a370e99df7605855bd7d11bb7b44131935eabf7a"}, "closed": true, "closedAt": "2020-11-23T05:42:44Z", "author": {"login": "rolfyone"}, "timelineItems": {"totalCount": 5, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdfNlkGgH2gAyNTI1NDQxNDQ0OjM0YmM5MzBmZDJhYzAxYjk3ZDhlNmY4NDFhMDFiMWNkNWQ0MzBlZTI=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdfOLlsgH2gAyNTI1NDQxNDQ0OmMyNTdjNmYyMTlkZTcwMTg1ODNmNDE1MGYzZDYzZTg5OTdhNzNkZDQ=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "34bc930fd2ac01b97d8e6f841a01b1cd5d430ee2", "author": {"user": {"login": "rolfyone", "name": "Paul Harris"}}, "url": "https://github.com/ConsenSys/teku/commit/34bc930fd2ac01b97d8e6f841a01b1cd5d430ee2", "committedDate": "2020-11-23T04:38:41Z", "message": "verify the unsigned data returned for signing is for the expected slot\n\npartially addresses #3154\n\nSigned-off-by: Paul Harris <paul.harris@consensys.net>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e89a6d1ff3540d2022f29f8df0edcb47cb8a67f0", "author": {"user": {"login": "rolfyone", "name": "Paul Harris"}}, "url": "https://github.com/ConsenSys/teku/commit/e89a6d1ff3540d2022f29f8df0edcb47cb8a67f0", "committedDate": "2020-11-23T04:39:44Z", "message": "Merge remote-tracking branch 'upstream/master' into 3154"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTM2MTc0NTU4", "url": "https://github.com/ConsenSys/teku/pull/3281#pullrequestreview-536174558", "createdAt": "2020-11-23T04:41:40Z", "commit": {"oid": "e89a6d1ff3540d2022f29f8df0edcb47cb8a67f0"}, "state": "APPROVED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0yM1QwNDo0MTo0MVrOH3_Myg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0yM1QwNDo0MzowN1rOH3_N4g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyODQ2OTE5NA==", "bodyText": "nit:\n\n  \n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                checkArgument(\n          \n          \n            \n                    attestationData.getSlot().equals(slot),\n          \n          \n            \n                    \"Unsigned attestation slot ( \"\n          \n          \n            \n                        + attestationData.getSlot()\n          \n          \n            \n                        + \") does not match expected slot \"\n          \n          \n            \n                        + slot);\n          \n          \n            \n                checkArgument(\n          \n          \n            \n                    attestationData.getSlot().equals(slot),\n          \n          \n            \n                    \"Unsigned attestation slot (%s) does not match expected slot %s\",\n          \n          \n            \n                     attestationData.getSlot(),\n          \n          \n            \n                     slot);", "url": "https://github.com/ConsenSys/teku/pull/3281#discussion_r528469194", "createdAt": "2020-11-23T04:41:41Z", "author": {"login": "ajsutton"}, "path": "validator/client/src/main/java/tech/pegasys/teku/validator/client/duties/AttestationProductionDuty.java", "diffHunk": "@@ -140,6 +141,12 @@ public String getProducedType() {\n       final ForkInfo forkInfo,\n       final AttestationData attestationData,\n       final ValidatorWithCommitteePositionAndIndex validator) {\n+    checkArgument(\n+        attestationData.getSlot().equals(slot),\n+        \"Unsigned attestation slot ( \"\n+            + attestationData.getSlot()\n+            + \") does not match expected slot \"\n+            + slot);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "e89a6d1ff3540d2022f29f8df0edcb47cb8a67f0"}, "originalPosition": 17}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyODQ2OTQ3NA==", "bodyText": "Can use same %s format trick as above to avoid creating the string until its actually needed.\nI'd probably extract the unsignedBlock.orElseThrow below to a variable and then you can just use it directly here as well rather than needing an ifPresent block.", "url": "https://github.com/ConsenSys/teku/pull/3281#discussion_r528469474", "createdAt": "2020-11-23T04:43:07Z", "author": {"login": "ajsutton"}, "path": "validator/client/src/main/java/tech/pegasys/teku/validator/client/duties/BlockProductionDuty.java", "diffHunk": "@@ -96,6 +97,14 @@ public String getProducedType() {\n \n   public SafeFuture<SignedBeaconBlock> signBlock(\n       final ForkInfo forkInfo, final Optional<BeaconBlock> unsignedBlock) {\n+    unsignedBlock.ifPresent(\n+        beaconBlock ->\n+            checkArgument(\n+                beaconBlock.getSlot().equals(slot),\n+                \"Unsigned block slot ( \"\n+                    + beaconBlock.getSlot()\n+                    + \") does not match expected slot \"\n+                    + slot));", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "e89a6d1ff3540d2022f29f8df0edcb47cb8a67f0"}, "originalPosition": 19}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "4f3727b2a7057a9d5da70a423f315e49eafbf079", "author": {"user": {"login": "rolfyone", "name": "Paul Harris"}}, "url": "https://github.com/ConsenSys/teku/commit/4f3727b2a7057a9d5da70a423f315e49eafbf079", "committedDate": "2020-11-23T05:16:31Z", "message": "review comments\n\nSigned-off-by: Paul Harris <paul.harris@consensys.net>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c257c6f219de7018583f4150f3d63e8997a73dd4", "author": {"user": {"login": "rolfyone", "name": "Paul Harris"}}, "url": "https://github.com/ConsenSys/teku/commit/c257c6f219de7018583f4150f3d63e8997a73dd4", "committedDate": "2020-11-23T05:20:13Z", "message": "Merge remote-tracking branch 'upstream/master' into 3154"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4300, "cost": 1, "resetAt": "2021-11-01T13:51:04Z"}}}