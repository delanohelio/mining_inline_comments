{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDYzNjQ1MTI1", "number": 2514, "title": "Added attestation pool size tracking", "bodyText": "Expose the count of the number of attestations in the pending pool.  This is to facilitate a restful API to support ethstats displaying attestations.", "createdAt": "2020-08-05T21:11:27Z", "url": "https://github.com/ConsenSys/teku/pull/2514", "merged": true, "mergeCommit": {"oid": "fe0dc3ed2cd8ea116637c0563e96b72d56282c44"}, "closed": true, "closedAt": "2020-08-11T10:31:57Z", "author": {"login": "rojotek"}, "timelineItems": {"totalCount": 10, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABc8B0BgAH2gAyNDYzNjQ1MTI1OmZkMDIyOGFkNTZiNTYzYjYxZmFhZWI3ZjJiM2NiNTgwNzBhMjliMDA=", "endCursor": "Y3Vyc29yOnYyOpPPAAABc90JJZgH2gAyNDYzNjQ1MTI1OjYyZDc1NTIxNDk1ZTQ3OTY2MWU5ODkzZWZkMWQ1ZDIwYTRiM2E4MDA=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "fd0228ad56b563b61faaeb7f2b3cb58070a29b00", "author": {"user": {"login": "rojotek", "name": "Rob Dawson"}}, "url": "https://github.com/ConsenSys/teku/commit/fd0228ad56b563b61faaeb7f2b3cb58070a29b00", "committedDate": "2020-08-05T21:08:16Z", "message": "Added attestation pool size tracking"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDYyMTAxMTY3", "url": "https://github.com/ConsenSys/teku/pull/2514#pullrequestreview-462101167", "createdAt": "2020-08-06T00:01:03Z", "commit": {"oid": "fd0228ad56b563b61faaeb7f2b3cb58070a29b00"}, "state": "COMMENTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0wNlQwMDowMTowNFrOG8emNA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0wNlQwMDowMToxMFrOG8emUQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NjA2OTA0NA==", "bodyText": "The attestation winds up being added to a set so it deduplicates - we'd need to have the add call return a flag to indicate if the attestation was actually added or not.", "url": "https://github.com/ConsenSys/teku/pull/2514#discussion_r466069044", "createdAt": "2020-08-06T00:01:04Z", "author": {"login": "ajsutton"}, "path": "ethereum/statetransition/src/main/java/tech/pegasys/teku/statetransition/attestation/AggregatingAttestationPool.java", "diffHunk": "@@ -59,6 +62,7 @@ public AggregatingAttestationPool(\n   public synchronized void add(final ValidateableAttestation attestation) {\n     final AttestationData attestationData = attestation.getAttestation().getData();\n     final Bytes32 dataRoot = attestationData.hash_tree_root();\n+    size.getAndIncrement();\n     attestationGroupByDataHash\n         .computeIfAbsent(dataRoot, key -> new MatchingDataAttestationGroup(attestationData))\n         .add(attestation);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "fd0228ad56b563b61faaeb7f2b3cb58070a29b00"}, "originalPosition": 24}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NjA2OTA3Mw==", "bodyText": "Discussed offline but this will need to be a little smarter - attestations.remove will need to return the number of attestations it actually removed because it intelligently handles aggregates.\nSo if I remove an aggregate that includes validators 1,2,3,4,5 it will remove any single attestations for the same data from those validators or any combination thereof.  But it won\u2019t remove an aggregate with 1,2,3,4,5,6 because 6 is still new info.", "url": "https://github.com/ConsenSys/teku/pull/2514#discussion_r466069073", "createdAt": "2020-08-06T00:01:10Z", "author": {"login": "ajsutton"}, "path": "ethereum/statetransition/src/main/java/tech/pegasys/teku/statetransition/attestation/AggregatingAttestationPool.java", "diffHunk": "@@ -90,6 +94,7 @@ public synchronized void remove(final Attestation attestation) {\n       return;\n     }\n     attestations.remove(attestation);\n+    size.decrementAndGet();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "fd0228ad56b563b61faaeb7f2b3cb58070a29b00"}, "originalPosition": 29}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "8d5258415cc3cb2db1db7027124a4f39429675da", "author": {"user": {"login": "rojotek", "name": "Rob Dawson"}}, "url": "https://github.com/ConsenSys/teku/commit/8d5258415cc3cb2db1db7027124a4f39429675da", "committedDate": "2020-08-07T11:33:19Z", "message": "Ensured that the size is tracked properly, and added in API for viewing the same."}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "ed8ab6fba57d6fb8ec556c401dc718545136c8b6", "author": {"user": {"login": "rojotek", "name": "Rob Dawson"}}, "url": "https://github.com/ConsenSys/teku/commit/ed8ab6fba57d6fb8ec556c401dc718545136c8b6", "committedDate": "2020-08-07T11:28:32Z", "message": "Ensured that the size is tracked properly, and added in API for viewing the same."}, "afterCommit": {"oid": "8d5258415cc3cb2db1db7027124a4f39429675da", "author": {"user": {"login": "rojotek", "name": "Rob Dawson"}}, "url": "https://github.com/ConsenSys/teku/commit/8d5258415cc3cb2db1db7027124a4f39429675da", "committedDate": "2020-08-07T11:33:19Z", "message": "Ensured that the size is tracked properly, and added in API for viewing the same."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c497ec1116a049421553fa19a4d7221f52d0753c", "author": {"user": {"login": "ajsutton", "name": "Adrian Sutton"}}, "url": "https://github.com/ConsenSys/teku/commit/c497ec1116a049421553fa19a4d7221f52d0753c", "committedDate": "2020-08-10T01:49:24Z", "message": "Merge branch 'master' of github.com:PegaSysEng/teku into pending-attestation-count"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "d67a9008c63b8182ca50c3119a770df25e9a47b8", "author": {"user": {"login": "rojotek", "name": "Rob Dawson"}}, "url": "https://github.com/ConsenSys/teku/commit/d67a9008c63b8182ca50c3119a770df25e9a47b8", "committedDate": "2020-08-11T02:44:34Z", "message": "Added test around removing across attestation groups, and updated code to ensure it passes."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "6345e0703a6f1be6e49308366b034befa9504dfd", "author": {"user": {"login": "rojotek", "name": "Rob Dawson"}}, "url": "https://github.com/ConsenSys/teku/commit/6345e0703a6f1be6e49308366b034befa9504dfd", "committedDate": "2020-08-11T02:48:33Z", "message": "Merge branch 'master' into pending-attestation-count"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDY0NzEzMTYx", "url": "https://github.com/ConsenSys/teku/pull/2514#pullrequestreview-464713161", "createdAt": "2020-08-11T02:49:27Z", "commit": {"oid": "d67a9008c63b8182ca50c3119a770df25e9a47b8"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "51e7dc8a2eb909162408f8386dfac6182eea3e1b", "author": {"user": {"login": "rojotek", "name": "Rob Dawson"}}, "url": "https://github.com/ConsenSys/teku/commit/51e7dc8a2eb909162408f8386dfac6182eea3e1b", "committedDate": "2020-08-11T10:16:26Z", "message": "Made test match correct code."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "62d75521495e479661e9893efd1d5d20a4b3a800", "author": {"user": {"login": "rojotek", "name": "Rob Dawson"}}, "url": "https://github.com/ConsenSys/teku/commit/62d75521495e479661e9893efd1d5d20a4b3a800", "committedDate": "2020-08-11T10:20:31Z", "message": "Merge branch 'master' into pending-attestation-count"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3729, "cost": 1, "resetAt": "2021-11-01T13:51:04Z"}}}