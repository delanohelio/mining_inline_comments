{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0Mzc2NDAyNTIw", "number": 1187, "reviewThreads": {"totalCount": 6, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xOFQwNToyMjoyMFrODgkGEg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xOFQwNjozMjowOFrODgkuag==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjM1NDcyNDAyOnYy", "diffSide": "RIGHT", "path": "data/beaconrestapi/src/main/java/tech/pegasys/artemis/beaconrestapi/beaconhandlers/FinalizedCheckpointHandler.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xOFQwNToyMjoyMFrOFq1bwA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xOFQwNjoxNDo0NlrOFq2Hkw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MDQ1OTk2OA==", "bodyText": "I've been asked to kill off @NotNull annotations, so we should do that here too.", "url": "https://github.com/ConsenSys/teku/pull/1187#discussion_r380459968", "createdAt": "2020-02-18T05:22:20Z", "author": {"login": "rolfyone"}, "path": "data/beaconrestapi/src/main/java/tech/pegasys/artemis/beaconrestapi/beaconhandlers/FinalizedCheckpointHandler.java", "diffHunk": "@@ -13,36 +13,46 @@\n \n package tech.pegasys.artemis.beaconrestapi.beaconhandlers;\n \n-import java.util.HashMap;\n-import java.util.Map;\n-import tech.pegasys.artemis.beaconrestapi.handlerinterfaces.BeaconRestApiHandler;\n+import static javax.servlet.http.HttpServletResponse.SC_NO_CONTENT;\n+\n+import io.javalin.http.Context;\n+import io.javalin.http.Handler;\n+import io.javalin.plugin.openapi.annotations.HttpMethod;\n+import io.javalin.plugin.openapi.annotations.OpenApi;\n+import io.javalin.plugin.openapi.annotations.OpenApiContent;\n+import io.javalin.plugin.openapi.annotations.OpenApiResponse;\n+import org.jetbrains.annotations.NotNull;\n import tech.pegasys.artemis.datastructures.state.Checkpoint;\n+import tech.pegasys.artemis.provider.JsonProvider;\n import tech.pegasys.artemis.storage.ChainStorageClient;\n import tech.pegasys.artemis.storage.Store;\n \n-public class FinalizedCheckpointHandler implements BeaconRestApiHandler {\n+public class FinalizedCheckpointHandler implements Handler {\n \n   private final ChainStorageClient client;\n \n   public FinalizedCheckpointHandler(ChainStorageClient client) {\n     this.client = client;\n   }\n \n-  @Override\n-  public String getPath() {\n-    return \"/beacon/finalized_checkpoint\";\n-  }\n+  public static final String ROUTE = \"/beacon/finalized_checkpoint\";\n \n+  @OpenApi(\n+      path = ROUTE,\n+      method = HttpMethod.GET,\n+      summary = \"Finalized checkpoint.\",\n+      tags = {\"Node\"},\n+      description = \"Requests that the beacon node give finalized checkpoint info.\",\n+      responses = {\n+        @OpenApiResponse(status = \"200\", content = @OpenApiContent(from = Checkpoint.class)),\n+      })\n   @Override\n-  public Object handleRequest(RequestParams params) {\n+  public void handle(@NotNull Context ctx) throws Exception {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "fda5b4cc3a9e1af5f69486485714815af34e90aa"}, "originalPosition": 47}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MDQ3MTE4Nw==", "bodyText": "done", "url": "https://github.com/ConsenSys/teku/pull/1187#discussion_r380471187", "createdAt": "2020-02-18T06:14:46Z", "author": {"login": "macfarla"}, "path": "data/beaconrestapi/src/main/java/tech/pegasys/artemis/beaconrestapi/beaconhandlers/FinalizedCheckpointHandler.java", "diffHunk": "@@ -13,36 +13,46 @@\n \n package tech.pegasys.artemis.beaconrestapi.beaconhandlers;\n \n-import java.util.HashMap;\n-import java.util.Map;\n-import tech.pegasys.artemis.beaconrestapi.handlerinterfaces.BeaconRestApiHandler;\n+import static javax.servlet.http.HttpServletResponse.SC_NO_CONTENT;\n+\n+import io.javalin.http.Context;\n+import io.javalin.http.Handler;\n+import io.javalin.plugin.openapi.annotations.HttpMethod;\n+import io.javalin.plugin.openapi.annotations.OpenApi;\n+import io.javalin.plugin.openapi.annotations.OpenApiContent;\n+import io.javalin.plugin.openapi.annotations.OpenApiResponse;\n+import org.jetbrains.annotations.NotNull;\n import tech.pegasys.artemis.datastructures.state.Checkpoint;\n+import tech.pegasys.artemis.provider.JsonProvider;\n import tech.pegasys.artemis.storage.ChainStorageClient;\n import tech.pegasys.artemis.storage.Store;\n \n-public class FinalizedCheckpointHandler implements BeaconRestApiHandler {\n+public class FinalizedCheckpointHandler implements Handler {\n \n   private final ChainStorageClient client;\n \n   public FinalizedCheckpointHandler(ChainStorageClient client) {\n     this.client = client;\n   }\n \n-  @Override\n-  public String getPath() {\n-    return \"/beacon/finalized_checkpoint\";\n-  }\n+  public static final String ROUTE = \"/beacon/finalized_checkpoint\";\n \n+  @OpenApi(\n+      path = ROUTE,\n+      method = HttpMethod.GET,\n+      summary = \"Finalized checkpoint.\",\n+      tags = {\"Node\"},\n+      description = \"Requests that the beacon node give finalized checkpoint info.\",\n+      responses = {\n+        @OpenApiResponse(status = \"200\", content = @OpenApiContent(from = Checkpoint.class)),\n+      })\n   @Override\n-  public Object handleRequest(RequestParams params) {\n+  public void handle(@NotNull Context ctx) throws Exception {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MDQ1OTk2OA=="}, "originalCommit": {"oid": "fda5b4cc3a9e1af5f69486485714815af34e90aa"}, "originalPosition": 47}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjM1NDcyNTA1OnYy", "diffSide": "RIGHT", "path": "data/beaconrestapi/src/main/java/tech/pegasys/artemis/beaconrestapi/beaconhandlers/FinalizedCheckpointHandler.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xOFQwNToyMzoxMlrOFq1cZw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xOFQwNjoxNjowMVrOFq2IvA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MDQ2MDEzNQ==", "bodyText": "@OpenApiResponse(status = \"204\") as a response to satisfy below where we're returning SC_NO_CONTENT.", "url": "https://github.com/ConsenSys/teku/pull/1187#discussion_r380460135", "createdAt": "2020-02-18T05:23:12Z", "author": {"login": "rolfyone"}, "path": "data/beaconrestapi/src/main/java/tech/pegasys/artemis/beaconrestapi/beaconhandlers/FinalizedCheckpointHandler.java", "diffHunk": "@@ -13,36 +13,46 @@\n \n package tech.pegasys.artemis.beaconrestapi.beaconhandlers;\n \n-import java.util.HashMap;\n-import java.util.Map;\n-import tech.pegasys.artemis.beaconrestapi.handlerinterfaces.BeaconRestApiHandler;\n+import static javax.servlet.http.HttpServletResponse.SC_NO_CONTENT;\n+\n+import io.javalin.http.Context;\n+import io.javalin.http.Handler;\n+import io.javalin.plugin.openapi.annotations.HttpMethod;\n+import io.javalin.plugin.openapi.annotations.OpenApi;\n+import io.javalin.plugin.openapi.annotations.OpenApiContent;\n+import io.javalin.plugin.openapi.annotations.OpenApiResponse;\n+import org.jetbrains.annotations.NotNull;\n import tech.pegasys.artemis.datastructures.state.Checkpoint;\n+import tech.pegasys.artemis.provider.JsonProvider;\n import tech.pegasys.artemis.storage.ChainStorageClient;\n import tech.pegasys.artemis.storage.Store;\n \n-public class FinalizedCheckpointHandler implements BeaconRestApiHandler {\n+public class FinalizedCheckpointHandler implements Handler {\n \n   private final ChainStorageClient client;\n \n   public FinalizedCheckpointHandler(ChainStorageClient client) {\n     this.client = client;\n   }\n \n-  @Override\n-  public String getPath() {\n-    return \"/beacon/finalized_checkpoint\";\n-  }\n+  public static final String ROUTE = \"/beacon/finalized_checkpoint\";\n \n+  @OpenApi(\n+      path = ROUTE,\n+      method = HttpMethod.GET,\n+      summary = \"Finalized checkpoint.\",\n+      tags = {\"Node\"},\n+      description = \"Requests that the beacon node give finalized checkpoint info.\",\n+      responses = {\n+        @OpenApiResponse(status = \"200\", content = @OpenApiContent(from = Checkpoint.class)),", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "fda5b4cc3a9e1af5f69486485714815af34e90aa"}, "originalPosition": 43}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MDQ3MTQ4NA==", "bodyText": "done", "url": "https://github.com/ConsenSys/teku/pull/1187#discussion_r380471484", "createdAt": "2020-02-18T06:16:01Z", "author": {"login": "macfarla"}, "path": "data/beaconrestapi/src/main/java/tech/pegasys/artemis/beaconrestapi/beaconhandlers/FinalizedCheckpointHandler.java", "diffHunk": "@@ -13,36 +13,46 @@\n \n package tech.pegasys.artemis.beaconrestapi.beaconhandlers;\n \n-import java.util.HashMap;\n-import java.util.Map;\n-import tech.pegasys.artemis.beaconrestapi.handlerinterfaces.BeaconRestApiHandler;\n+import static javax.servlet.http.HttpServletResponse.SC_NO_CONTENT;\n+\n+import io.javalin.http.Context;\n+import io.javalin.http.Handler;\n+import io.javalin.plugin.openapi.annotations.HttpMethod;\n+import io.javalin.plugin.openapi.annotations.OpenApi;\n+import io.javalin.plugin.openapi.annotations.OpenApiContent;\n+import io.javalin.plugin.openapi.annotations.OpenApiResponse;\n+import org.jetbrains.annotations.NotNull;\n import tech.pegasys.artemis.datastructures.state.Checkpoint;\n+import tech.pegasys.artemis.provider.JsonProvider;\n import tech.pegasys.artemis.storage.ChainStorageClient;\n import tech.pegasys.artemis.storage.Store;\n \n-public class FinalizedCheckpointHandler implements BeaconRestApiHandler {\n+public class FinalizedCheckpointHandler implements Handler {\n \n   private final ChainStorageClient client;\n \n   public FinalizedCheckpointHandler(ChainStorageClient client) {\n     this.client = client;\n   }\n \n-  @Override\n-  public String getPath() {\n-    return \"/beacon/finalized_checkpoint\";\n-  }\n+  public static final String ROUTE = \"/beacon/finalized_checkpoint\";\n \n+  @OpenApi(\n+      path = ROUTE,\n+      method = HttpMethod.GET,\n+      summary = \"Finalized checkpoint.\",\n+      tags = {\"Node\"},\n+      description = \"Requests that the beacon node give finalized checkpoint info.\",\n+      responses = {\n+        @OpenApiResponse(status = \"200\", content = @OpenApiContent(from = Checkpoint.class)),", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MDQ2MDEzNQ=="}, "originalCommit": {"oid": "fda5b4cc3a9e1af5f69486485714815af34e90aa"}, "originalPosition": 43}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjM1NDcyNzE4OnYy", "diffSide": "RIGHT", "path": "data/beaconrestapi/src/test/java/tech/pegasys/artemis/beaconrestapi/beaconhandlers/FinalizedCheckpointHandlerTest.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xOFQwNToyNDo1NFrOFq1dsw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xOFQwNjoyMTo1NFrOFq2OTw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MDQ2MDQ2Nw==", "bodyText": "we should have a test that shows the 'no content' response.", "url": "https://github.com/ConsenSys/teku/pull/1187#discussion_r380460467", "createdAt": "2020-02-18T05:24:54Z", "author": {"login": "rolfyone"}, "path": "data/beaconrestapi/src/test/java/tech/pegasys/artemis/beaconrestapi/beaconhandlers/FinalizedCheckpointHandlerTest.java", "diffHunk": "@@ -0,0 +1,45 @@\n+/*\n+ * Copyright 2020 ConsenSys AG.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\"); you may not use this file except in compliance with\n+ * the License. You may obtain a copy of the License at\n+ *\n+ * http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software distributed under the License is distributed on\n+ * an \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied. See the License for the\n+ * specific language governing permissions and limitations under the License.\n+ */\n+\n+package tech.pegasys.artemis.beaconrestapi.beaconhandlers;\n+\n+import static org.mockito.Mockito.verify;\n+import static org.mockito.Mockito.when;\n+\n+import io.javalin.http.Context;\n+import org.junit.jupiter.api.Test;\n+import org.mockito.Mockito;\n+import tech.pegasys.artemis.datastructures.state.Checkpoint;\n+import tech.pegasys.artemis.datastructures.util.DataStructureUtil;\n+import tech.pegasys.artemis.provider.JsonProvider;\n+import tech.pegasys.artemis.storage.ChainStorageClient;\n+import tech.pegasys.artemis.storage.Store;\n+\n+public class FinalizedCheckpointHandlerTest {\n+  private Context mockContext = Mockito.mock(Context.class);\n+  private ChainStorageClient mockClient = Mockito.mock(ChainStorageClient.class);\n+  private Store mockStore = Mockito.mock(Store.class);\n+\n+  private final Checkpoint checkpoint = DataStructureUtil.randomCheckpoint(99);\n+\n+  @Test\n+  public void shouldReturnCheckpoint() throws Exception {\n+    when(mockClient.getStore()).thenReturn(mockStore);\n+    when(mockStore.getFinalizedCheckpoint()).thenReturn(checkpoint);\n+\n+    FinalizedCheckpointHandler handler = new FinalizedCheckpointHandler(mockClient);\n+    handler.handle(mockContext);\n+\n+    verify(mockContext).result(JsonProvider.objectToJSON(checkpoint));\n+  }", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "fda5b4cc3a9e1af5f69486485714815af34e90aa"}, "originalPosition": 44}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MDQ3MjkxMQ==", "bodyText": "done", "url": "https://github.com/ConsenSys/teku/pull/1187#discussion_r380472911", "createdAt": "2020-02-18T06:21:54Z", "author": {"login": "macfarla"}, "path": "data/beaconrestapi/src/test/java/tech/pegasys/artemis/beaconrestapi/beaconhandlers/FinalizedCheckpointHandlerTest.java", "diffHunk": "@@ -0,0 +1,45 @@\n+/*\n+ * Copyright 2020 ConsenSys AG.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\"); you may not use this file except in compliance with\n+ * the License. You may obtain a copy of the License at\n+ *\n+ * http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software distributed under the License is distributed on\n+ * an \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied. See the License for the\n+ * specific language governing permissions and limitations under the License.\n+ */\n+\n+package tech.pegasys.artemis.beaconrestapi.beaconhandlers;\n+\n+import static org.mockito.Mockito.verify;\n+import static org.mockito.Mockito.when;\n+\n+import io.javalin.http.Context;\n+import org.junit.jupiter.api.Test;\n+import org.mockito.Mockito;\n+import tech.pegasys.artemis.datastructures.state.Checkpoint;\n+import tech.pegasys.artemis.datastructures.util.DataStructureUtil;\n+import tech.pegasys.artemis.provider.JsonProvider;\n+import tech.pegasys.artemis.storage.ChainStorageClient;\n+import tech.pegasys.artemis.storage.Store;\n+\n+public class FinalizedCheckpointHandlerTest {\n+  private Context mockContext = Mockito.mock(Context.class);\n+  private ChainStorageClient mockClient = Mockito.mock(ChainStorageClient.class);\n+  private Store mockStore = Mockito.mock(Store.class);\n+\n+  private final Checkpoint checkpoint = DataStructureUtil.randomCheckpoint(99);\n+\n+  @Test\n+  public void shouldReturnCheckpoint() throws Exception {\n+    when(mockClient.getStore()).thenReturn(mockStore);\n+    when(mockStore.getFinalizedCheckpoint()).thenReturn(checkpoint);\n+\n+    FinalizedCheckpointHandler handler = new FinalizedCheckpointHandler(mockClient);\n+    handler.handle(mockContext);\n+\n+    verify(mockContext).result(JsonProvider.objectToJSON(checkpoint));\n+  }", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MDQ2MDQ2Nw=="}, "originalCommit": {"oid": "fda5b4cc3a9e1af5f69486485714815af34e90aa"}, "originalPosition": 44}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjM1NDc3OTY0OnYy", "diffSide": "RIGHT", "path": "data/beaconrestapi/src/test/java/tech/pegasys/artemis/beaconrestapi/beaconhandlers/FinalizedCheckpointHandlerTest.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xOFQwNjowNDo1M1rOFq1-Vg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xOFQwNjoyMTo0NlrOFq2OLA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MDQ2ODgyMg==", "bodyText": "adrian commented elsewhere to avoid using the 'mock' prefix on mock objects, because apparently its not named in that format elsewhere in Teku. I hate it, but passing on the message.", "url": "https://github.com/ConsenSys/teku/pull/1187#discussion_r380468822", "createdAt": "2020-02-18T06:04:53Z", "author": {"login": "rolfyone"}, "path": "data/beaconrestapi/src/test/java/tech/pegasys/artemis/beaconrestapi/beaconhandlers/FinalizedCheckpointHandlerTest.java", "diffHunk": "@@ -0,0 +1,45 @@\n+/*\n+ * Copyright 2020 ConsenSys AG.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\"); you may not use this file except in compliance with\n+ * the License. You may obtain a copy of the License at\n+ *\n+ * http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software distributed under the License is distributed on\n+ * an \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied. See the License for the\n+ * specific language governing permissions and limitations under the License.\n+ */\n+\n+package tech.pegasys.artemis.beaconrestapi.beaconhandlers;\n+\n+import static org.mockito.Mockito.verify;\n+import static org.mockito.Mockito.when;\n+\n+import io.javalin.http.Context;\n+import org.junit.jupiter.api.Test;\n+import org.mockito.Mockito;\n+import tech.pegasys.artemis.datastructures.state.Checkpoint;\n+import tech.pegasys.artemis.datastructures.util.DataStructureUtil;\n+import tech.pegasys.artemis.provider.JsonProvider;\n+import tech.pegasys.artemis.storage.ChainStorageClient;\n+import tech.pegasys.artemis.storage.Store;\n+\n+public class FinalizedCheckpointHandlerTest {\n+  private Context mockContext = Mockito.mock(Context.class);\n+  private ChainStorageClient mockClient = Mockito.mock(ChainStorageClient.class);\n+  private Store mockStore = Mockito.mock(Store.class);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "fda5b4cc3a9e1af5f69486485714815af34e90aa"}, "originalPosition": 31}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MDQ3Mjg3Ng==", "bodyText": "gone", "url": "https://github.com/ConsenSys/teku/pull/1187#discussion_r380472876", "createdAt": "2020-02-18T06:21:46Z", "author": {"login": "macfarla"}, "path": "data/beaconrestapi/src/test/java/tech/pegasys/artemis/beaconrestapi/beaconhandlers/FinalizedCheckpointHandlerTest.java", "diffHunk": "@@ -0,0 +1,45 @@\n+/*\n+ * Copyright 2020 ConsenSys AG.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\"); you may not use this file except in compliance with\n+ * the License. You may obtain a copy of the License at\n+ *\n+ * http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software distributed under the License is distributed on\n+ * an \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied. See the License for the\n+ * specific language governing permissions and limitations under the License.\n+ */\n+\n+package tech.pegasys.artemis.beaconrestapi.beaconhandlers;\n+\n+import static org.mockito.Mockito.verify;\n+import static org.mockito.Mockito.when;\n+\n+import io.javalin.http.Context;\n+import org.junit.jupiter.api.Test;\n+import org.mockito.Mockito;\n+import tech.pegasys.artemis.datastructures.state.Checkpoint;\n+import tech.pegasys.artemis.datastructures.util.DataStructureUtil;\n+import tech.pegasys.artemis.provider.JsonProvider;\n+import tech.pegasys.artemis.storage.ChainStorageClient;\n+import tech.pegasys.artemis.storage.Store;\n+\n+public class FinalizedCheckpointHandlerTest {\n+  private Context mockContext = Mockito.mock(Context.class);\n+  private ChainStorageClient mockClient = Mockito.mock(ChainStorageClient.class);\n+  private Store mockStore = Mockito.mock(Store.class);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MDQ2ODgyMg=="}, "originalCommit": {"oid": "fda5b4cc3a9e1af5f69486485714815af34e90aa"}, "originalPosition": 31}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjM1NDgxNDA4OnYy", "diffSide": "RIGHT", "path": "data/beaconrestapi/src/test/java/tech/pegasys/artemis/beaconrestapi/beaconhandlers/FinalizedCheckpointHandlerTest.java", "isResolved": true, "comments": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xOFQwNjoyNzo0MlrOFq2Tcg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xOFQwNjo1NTo1OFrOFq3GAQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MDQ3NDIyNg==", "bodyText": "So, yes, but check FinalizedCheckpointHandler, not GenesisTimeHandler :)", "url": "https://github.com/ConsenSys/teku/pull/1187#discussion_r380474226", "createdAt": "2020-02-18T06:27:42Z", "author": {"login": "rolfyone"}, "path": "data/beaconrestapi/src/test/java/tech/pegasys/artemis/beaconrestapi/beaconhandlers/FinalizedCheckpointHandlerTest.java", "diffHunk": "@@ -0,0 +1,54 @@\n+/*\n+ * Copyright 2020 ConsenSys AG.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\"); you may not use this file except in compliance with\n+ * the License. You may obtain a copy of the License at\n+ *\n+ * http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software distributed under the License is distributed on\n+ * an \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied. See the License for the\n+ * specific language governing permissions and limitations under the License.\n+ */\n+\n+package tech.pegasys.artemis.beaconrestapi.beaconhandlers;\n+\n+import static javax.servlet.http.HttpServletResponse.SC_NO_CONTENT;\n+import static org.mockito.Mockito.verify;\n+import static org.mockito.Mockito.when;\n+\n+import io.javalin.http.Context;\n+import org.junit.jupiter.api.Test;\n+import org.mockito.Mockito;\n+import tech.pegasys.artemis.datastructures.state.Checkpoint;\n+import tech.pegasys.artemis.datastructures.util.DataStructureUtil;\n+import tech.pegasys.artemis.provider.JsonProvider;\n+import tech.pegasys.artemis.storage.ChainStorageClient;\n+import tech.pegasys.artemis.storage.Store;\n+\n+public class FinalizedCheckpointHandlerTest {\n+  private Context context = Mockito.mock(Context.class);\n+  private ChainStorageClient client = Mockito.mock(ChainStorageClient.class);\n+  private Store store = Mockito.mock(Store.class);\n+\n+  private final Checkpoint checkpoint = DataStructureUtil.randomCheckpoint(99);\n+\n+  @Test\n+  public void shouldReturnCheckpoint() throws Exception {\n+    when(client.getStore()).thenReturn(store);\n+    when(store.getFinalizedCheckpoint()).thenReturn(checkpoint);\n+\n+    FinalizedCheckpointHandler handler = new FinalizedCheckpointHandler(client);\n+    handler.handle(context);\n+\n+    verify(context).result(JsonProvider.objectToJSON(checkpoint));\n+  }\n+\n+  @Test\n+  public void shouldReturnNoContentWhenStoreIsNull() throws Exception {\n+    GenesisTimeHandler handler = new GenesisTimeHandler(null);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b5fd8551eb5b551d905cf66c3a9510a9ea312ab6"}, "originalPosition": 49}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MDQ3NDk3Mg==", "bodyText": "You'll always have a ChainStoreClient.  Pre-genesis that client will have a null Store so I'm not sure this test makes sense.", "url": "https://github.com/ConsenSys/teku/pull/1187#discussion_r380474972", "createdAt": "2020-02-18T06:30:17Z", "author": {"login": "ajsutton"}, "path": "data/beaconrestapi/src/test/java/tech/pegasys/artemis/beaconrestapi/beaconhandlers/FinalizedCheckpointHandlerTest.java", "diffHunk": "@@ -0,0 +1,54 @@\n+/*\n+ * Copyright 2020 ConsenSys AG.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\"); you may not use this file except in compliance with\n+ * the License. You may obtain a copy of the License at\n+ *\n+ * http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software distributed under the License is distributed on\n+ * an \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied. See the License for the\n+ * specific language governing permissions and limitations under the License.\n+ */\n+\n+package tech.pegasys.artemis.beaconrestapi.beaconhandlers;\n+\n+import static javax.servlet.http.HttpServletResponse.SC_NO_CONTENT;\n+import static org.mockito.Mockito.verify;\n+import static org.mockito.Mockito.when;\n+\n+import io.javalin.http.Context;\n+import org.junit.jupiter.api.Test;\n+import org.mockito.Mockito;\n+import tech.pegasys.artemis.datastructures.state.Checkpoint;\n+import tech.pegasys.artemis.datastructures.util.DataStructureUtil;\n+import tech.pegasys.artemis.provider.JsonProvider;\n+import tech.pegasys.artemis.storage.ChainStorageClient;\n+import tech.pegasys.artemis.storage.Store;\n+\n+public class FinalizedCheckpointHandlerTest {\n+  private Context context = Mockito.mock(Context.class);\n+  private ChainStorageClient client = Mockito.mock(ChainStorageClient.class);\n+  private Store store = Mockito.mock(Store.class);\n+\n+  private final Checkpoint checkpoint = DataStructureUtil.randomCheckpoint(99);\n+\n+  @Test\n+  public void shouldReturnCheckpoint() throws Exception {\n+    when(client.getStore()).thenReturn(store);\n+    when(store.getFinalizedCheckpoint()).thenReturn(checkpoint);\n+\n+    FinalizedCheckpointHandler handler = new FinalizedCheckpointHandler(client);\n+    handler.handle(context);\n+\n+    verify(context).result(JsonProvider.objectToJSON(checkpoint));\n+  }\n+\n+  @Test\n+  public void shouldReturnNoContentWhenStoreIsNull() throws Exception {\n+    GenesisTimeHandler handler = new GenesisTimeHandler(null);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MDQ3NDIyNg=="}, "originalCommit": {"oid": "b5fd8551eb5b551d905cf66c3a9510a9ea312ab6"}, "originalPosition": 49}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MDQ3NjIxMw==", "bodyText": "oops. fixed.", "url": "https://github.com/ConsenSys/teku/pull/1187#discussion_r380476213", "createdAt": "2020-02-18T06:32:39Z", "author": {"login": "macfarla"}, "path": "data/beaconrestapi/src/test/java/tech/pegasys/artemis/beaconrestapi/beaconhandlers/FinalizedCheckpointHandlerTest.java", "diffHunk": "@@ -0,0 +1,54 @@\n+/*\n+ * Copyright 2020 ConsenSys AG.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\"); you may not use this file except in compliance with\n+ * the License. You may obtain a copy of the License at\n+ *\n+ * http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software distributed under the License is distributed on\n+ * an \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied. See the License for the\n+ * specific language governing permissions and limitations under the License.\n+ */\n+\n+package tech.pegasys.artemis.beaconrestapi.beaconhandlers;\n+\n+import static javax.servlet.http.HttpServletResponse.SC_NO_CONTENT;\n+import static org.mockito.Mockito.verify;\n+import static org.mockito.Mockito.when;\n+\n+import io.javalin.http.Context;\n+import org.junit.jupiter.api.Test;\n+import org.mockito.Mockito;\n+import tech.pegasys.artemis.datastructures.state.Checkpoint;\n+import tech.pegasys.artemis.datastructures.util.DataStructureUtil;\n+import tech.pegasys.artemis.provider.JsonProvider;\n+import tech.pegasys.artemis.storage.ChainStorageClient;\n+import tech.pegasys.artemis.storage.Store;\n+\n+public class FinalizedCheckpointHandlerTest {\n+  private Context context = Mockito.mock(Context.class);\n+  private ChainStorageClient client = Mockito.mock(ChainStorageClient.class);\n+  private Store store = Mockito.mock(Store.class);\n+\n+  private final Checkpoint checkpoint = DataStructureUtil.randomCheckpoint(99);\n+\n+  @Test\n+  public void shouldReturnCheckpoint() throws Exception {\n+    when(client.getStore()).thenReturn(store);\n+    when(store.getFinalizedCheckpoint()).thenReturn(checkpoint);\n+\n+    FinalizedCheckpointHandler handler = new FinalizedCheckpointHandler(client);\n+    handler.handle(context);\n+\n+    verify(context).result(JsonProvider.objectToJSON(checkpoint));\n+  }\n+\n+  @Test\n+  public void shouldReturnNoContentWhenStoreIsNull() throws Exception {\n+    GenesisTimeHandler handler = new GenesisTimeHandler(null);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MDQ3NDIyNg=="}, "originalCommit": {"oid": "b5fd8551eb5b551d905cf66c3a9510a9ea312ab6"}, "originalPosition": 49}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MDQ4NzE2OQ==", "bodyText": "its the window of time when we can get a 'no_content' result, so i think it's a fair test case now that we're testing against the FinalizedCheckpointHandler.", "url": "https://github.com/ConsenSys/teku/pull/1187#discussion_r380487169", "createdAt": "2020-02-18T06:55:58Z", "author": {"login": "rolfyone"}, "path": "data/beaconrestapi/src/test/java/tech/pegasys/artemis/beaconrestapi/beaconhandlers/FinalizedCheckpointHandlerTest.java", "diffHunk": "@@ -0,0 +1,54 @@\n+/*\n+ * Copyright 2020 ConsenSys AG.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\"); you may not use this file except in compliance with\n+ * the License. You may obtain a copy of the License at\n+ *\n+ * http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software distributed under the License is distributed on\n+ * an \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied. See the License for the\n+ * specific language governing permissions and limitations under the License.\n+ */\n+\n+package tech.pegasys.artemis.beaconrestapi.beaconhandlers;\n+\n+import static javax.servlet.http.HttpServletResponse.SC_NO_CONTENT;\n+import static org.mockito.Mockito.verify;\n+import static org.mockito.Mockito.when;\n+\n+import io.javalin.http.Context;\n+import org.junit.jupiter.api.Test;\n+import org.mockito.Mockito;\n+import tech.pegasys.artemis.datastructures.state.Checkpoint;\n+import tech.pegasys.artemis.datastructures.util.DataStructureUtil;\n+import tech.pegasys.artemis.provider.JsonProvider;\n+import tech.pegasys.artemis.storage.ChainStorageClient;\n+import tech.pegasys.artemis.storage.Store;\n+\n+public class FinalizedCheckpointHandlerTest {\n+  private Context context = Mockito.mock(Context.class);\n+  private ChainStorageClient client = Mockito.mock(ChainStorageClient.class);\n+  private Store store = Mockito.mock(Store.class);\n+\n+  private final Checkpoint checkpoint = DataStructureUtil.randomCheckpoint(99);\n+\n+  @Test\n+  public void shouldReturnCheckpoint() throws Exception {\n+    when(client.getStore()).thenReturn(store);\n+    when(store.getFinalizedCheckpoint()).thenReturn(checkpoint);\n+\n+    FinalizedCheckpointHandler handler = new FinalizedCheckpointHandler(client);\n+    handler.handle(context);\n+\n+    verify(context).result(JsonProvider.objectToJSON(checkpoint));\n+  }\n+\n+  @Test\n+  public void shouldReturnNoContentWhenStoreIsNull() throws Exception {\n+    GenesisTimeHandler handler = new GenesisTimeHandler(null);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MDQ3NDIyNg=="}, "originalCommit": {"oid": "b5fd8551eb5b551d905cf66c3a9510a9ea312ab6"}, "originalPosition": 49}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjM1NDgyNzMwOnYy", "diffSide": "RIGHT", "path": "data/beaconrestapi/src/main/java/tech/pegasys/artemis/beaconrestapi/beaconhandlers/FinalizedCheckpointHandler.java", "isResolved": true, "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xOFQwNjozMjowOFrOFq2aKg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xOFQwNjo1NzoxNlrOFq3Hew==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MDQ3NTk0Ng==", "bodyText": "This needs a return or you'll carry on and throw a NullPointerException on line 55.", "url": "https://github.com/ConsenSys/teku/pull/1187#discussion_r380475946", "createdAt": "2020-02-18T06:32:08Z", "author": {"login": "ajsutton"}, "path": "data/beaconrestapi/src/main/java/tech/pegasys/artemis/beaconrestapi/beaconhandlers/FinalizedCheckpointHandler.java", "diffHunk": "@@ -13,36 +13,46 @@\n \n package tech.pegasys.artemis.beaconrestapi.beaconhandlers;\n \n-import java.util.HashMap;\n-import java.util.Map;\n-import tech.pegasys.artemis.beaconrestapi.handlerinterfaces.BeaconRestApiHandler;\n+import static javax.servlet.http.HttpServletResponse.SC_NO_CONTENT;\n+\n+import io.javalin.http.Context;\n+import io.javalin.http.Handler;\n+import io.javalin.plugin.openapi.annotations.HttpMethod;\n+import io.javalin.plugin.openapi.annotations.OpenApi;\n+import io.javalin.plugin.openapi.annotations.OpenApiContent;\n+import io.javalin.plugin.openapi.annotations.OpenApiResponse;\n import tech.pegasys.artemis.datastructures.state.Checkpoint;\n+import tech.pegasys.artemis.provider.JsonProvider;\n import tech.pegasys.artemis.storage.ChainStorageClient;\n import tech.pegasys.artemis.storage.Store;\n \n-public class FinalizedCheckpointHandler implements BeaconRestApiHandler {\n+public class FinalizedCheckpointHandler implements Handler {\n \n   private final ChainStorageClient client;\n \n   public FinalizedCheckpointHandler(ChainStorageClient client) {\n     this.client = client;\n   }\n \n-  @Override\n-  public String getPath() {\n-    return \"/beacon/finalized_checkpoint\";\n-  }\n+  public static final String ROUTE = \"/beacon/finalized_checkpoint\";\n \n+  @OpenApi(\n+      path = ROUTE,\n+      method = HttpMethod.GET,\n+      summary = \"Finalized checkpoint.\",\n+      tags = {\"Node\"},\n+      description = \"Requests that the beacon node give finalized checkpoint info.\",\n+      responses = {\n+        @OpenApiResponse(status = \"200\", content = @OpenApiContent(from = Checkpoint.class)),\n+        @OpenApiResponse(status = \"204\")\n+      })\n   @Override\n-  public Object handleRequest(RequestParams params) {\n+  public void handle(Context ctx) throws Exception {\n     Store store = client.getStore();\n     if (store == null) {\n-      return null;\n+      ctx.status(SC_NO_CONTENT);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b5fd8551eb5b551d905cf66c3a9510a9ea312ab6"}, "originalPosition": 51}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MDQ3NzUwOQ==", "bodyText": "true. fixed", "url": "https://github.com/ConsenSys/teku/pull/1187#discussion_r380477509", "createdAt": "2020-02-18T06:35:02Z", "author": {"login": "macfarla"}, "path": "data/beaconrestapi/src/main/java/tech/pegasys/artemis/beaconrestapi/beaconhandlers/FinalizedCheckpointHandler.java", "diffHunk": "@@ -13,36 +13,46 @@\n \n package tech.pegasys.artemis.beaconrestapi.beaconhandlers;\n \n-import java.util.HashMap;\n-import java.util.Map;\n-import tech.pegasys.artemis.beaconrestapi.handlerinterfaces.BeaconRestApiHandler;\n+import static javax.servlet.http.HttpServletResponse.SC_NO_CONTENT;\n+\n+import io.javalin.http.Context;\n+import io.javalin.http.Handler;\n+import io.javalin.plugin.openapi.annotations.HttpMethod;\n+import io.javalin.plugin.openapi.annotations.OpenApi;\n+import io.javalin.plugin.openapi.annotations.OpenApiContent;\n+import io.javalin.plugin.openapi.annotations.OpenApiResponse;\n import tech.pegasys.artemis.datastructures.state.Checkpoint;\n+import tech.pegasys.artemis.provider.JsonProvider;\n import tech.pegasys.artemis.storage.ChainStorageClient;\n import tech.pegasys.artemis.storage.Store;\n \n-public class FinalizedCheckpointHandler implements BeaconRestApiHandler {\n+public class FinalizedCheckpointHandler implements Handler {\n \n   private final ChainStorageClient client;\n \n   public FinalizedCheckpointHandler(ChainStorageClient client) {\n     this.client = client;\n   }\n \n-  @Override\n-  public String getPath() {\n-    return \"/beacon/finalized_checkpoint\";\n-  }\n+  public static final String ROUTE = \"/beacon/finalized_checkpoint\";\n \n+  @OpenApi(\n+      path = ROUTE,\n+      method = HttpMethod.GET,\n+      summary = \"Finalized checkpoint.\",\n+      tags = {\"Node\"},\n+      description = \"Requests that the beacon node give finalized checkpoint info.\",\n+      responses = {\n+        @OpenApiResponse(status = \"200\", content = @OpenApiContent(from = Checkpoint.class)),\n+        @OpenApiResponse(status = \"204\")\n+      })\n   @Override\n-  public Object handleRequest(RequestParams params) {\n+  public void handle(Context ctx) throws Exception {\n     Store store = client.getStore();\n     if (store == null) {\n-      return null;\n+      ctx.status(SC_NO_CONTENT);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MDQ3NTk0Ng=="}, "originalCommit": {"oid": "b5fd8551eb5b551d905cf66c3a9510a9ea312ab6"}, "originalPosition": 51}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MDQ4NzU0Nw==", "bodyText": "interesting, i'd have expected the no_content test to fail until that return was there...", "url": "https://github.com/ConsenSys/teku/pull/1187#discussion_r380487547", "createdAt": "2020-02-18T06:57:16Z", "author": {"login": "rolfyone"}, "path": "data/beaconrestapi/src/main/java/tech/pegasys/artemis/beaconrestapi/beaconhandlers/FinalizedCheckpointHandler.java", "diffHunk": "@@ -13,36 +13,46 @@\n \n package tech.pegasys.artemis.beaconrestapi.beaconhandlers;\n \n-import java.util.HashMap;\n-import java.util.Map;\n-import tech.pegasys.artemis.beaconrestapi.handlerinterfaces.BeaconRestApiHandler;\n+import static javax.servlet.http.HttpServletResponse.SC_NO_CONTENT;\n+\n+import io.javalin.http.Context;\n+import io.javalin.http.Handler;\n+import io.javalin.plugin.openapi.annotations.HttpMethod;\n+import io.javalin.plugin.openapi.annotations.OpenApi;\n+import io.javalin.plugin.openapi.annotations.OpenApiContent;\n+import io.javalin.plugin.openapi.annotations.OpenApiResponse;\n import tech.pegasys.artemis.datastructures.state.Checkpoint;\n+import tech.pegasys.artemis.provider.JsonProvider;\n import tech.pegasys.artemis.storage.ChainStorageClient;\n import tech.pegasys.artemis.storage.Store;\n \n-public class FinalizedCheckpointHandler implements BeaconRestApiHandler {\n+public class FinalizedCheckpointHandler implements Handler {\n \n   private final ChainStorageClient client;\n \n   public FinalizedCheckpointHandler(ChainStorageClient client) {\n     this.client = client;\n   }\n \n-  @Override\n-  public String getPath() {\n-    return \"/beacon/finalized_checkpoint\";\n-  }\n+  public static final String ROUTE = \"/beacon/finalized_checkpoint\";\n \n+  @OpenApi(\n+      path = ROUTE,\n+      method = HttpMethod.GET,\n+      summary = \"Finalized checkpoint.\",\n+      tags = {\"Node\"},\n+      description = \"Requests that the beacon node give finalized checkpoint info.\",\n+      responses = {\n+        @OpenApiResponse(status = \"200\", content = @OpenApiContent(from = Checkpoint.class)),\n+        @OpenApiResponse(status = \"204\")\n+      })\n   @Override\n-  public Object handleRequest(RequestParams params) {\n+  public void handle(Context ctx) throws Exception {\n     Store store = client.getStore();\n     if (store == null) {\n-      return null;\n+      ctx.status(SC_NO_CONTENT);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MDQ3NTk0Ng=="}, "originalCommit": {"oid": "b5fd8551eb5b551d905cf66c3a9510a9ea312ab6"}, "originalPosition": 51}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2628, "cost": 1, "resetAt": "2021-11-12T11:57:46Z"}}}