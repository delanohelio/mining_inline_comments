{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDUwMzE5MzQ2", "number": 2363, "title": "Add ability to disable BLS verification for fuzzing ", "bodyText": "PR Description\nAdds the ability to disable BLS verification for fuzzing.\nFixed Issue(s)\n\n\nFixes #1958\nDocumentation\n\n I thought about documentation and added the documentation label to this PR if updates are required.", "createdAt": "2020-07-16T16:13:28Z", "url": "https://github.com/ConsenSys/teku/pull/2363", "merged": true, "mergeCommit": {"oid": "13a323b0264bdcf413aacf34ef943c1b9f2fee86"}, "closed": true, "closedAt": "2020-07-16T19:41:19Z", "author": {"login": "cemozerr"}, "timelineItems": {"totalCount": 14, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABc1hRKggH2gAyNDUwMzE5MzQ2OmJiNmY0YjczMmJmOGM0N2EwOGY2ZTM1YTlhN2MzMWJhM2QzOTBiMWI=", "endCursor": "Y3Vyc29yOnYyOpPPAAABc1kZ-EgH2gAyNDUwMzE5MzQ2Ojc4YmZlYjRjZDg5MDk5MmMwMGU3MGY5NjFjN2MyNmVkMzc1MTUxNjA=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "bb6f4b732bf8c47a08f6e35a9a7c31ba3d390b1b", "author": {"user": {"login": "cemozerr", "name": "Cem Ozer"}}, "url": "https://github.com/ConsenSys/teku/commit/bb6f4b732bf8c47a08f6e35a9a7c31ba3d390b1b", "committedDate": "2020-07-16T15:49:41Z", "message": "Implement fuzzing block validator"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a42f411b2392b52ad95095941410f9089cf4e451", "author": {"user": {"login": "cemozerr", "name": "Cem Ozer"}}, "url": "https://github.com/ConsenSys/teku/commit/a42f411b2392b52ad95095941410f9089cf4e451", "committedDate": "2020-07-16T15:50:16Z", "message": "Disable BLS verification & run spotless"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b0a6db4654db2c61613be6fb96133e78f7c047e2", "author": {"user": {"login": "cemozerr", "name": "Cem Ozer"}}, "url": "https://github.com/ConsenSys/teku/commit/b0a6db4654db2c61613be6fb96133e78f7c047e2", "committedDate": "2020-07-16T16:01:12Z", "message": "Remove fuzzing package"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "4e0faa5ebe8aaa54de123069d6ff75aec00b43f1", "author": {"user": {"login": "cemozerr", "name": "Cem Ozer"}}, "url": "https://github.com/ConsenSys/teku/commit/4e0faa5ebe8aaa54de123069d6ff75aec00b43f1", "committedDate": "2020-07-16T16:11:42Z", "message": "Add test"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "0f7a07bdca097b14ca79a500756a1ecd284d365c", "author": {"user": {"login": "cemozerr", "name": "Cem Ozer"}}, "url": "https://github.com/ConsenSys/teku/commit/0f7a07bdca097b14ca79a500756a1ecd284d365c", "committedDate": "2020-07-16T16:13:36Z", "message": "Merge branch 'master' into implementBLSdisabling"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDUwMDIyNDk4", "url": "https://github.com/ConsenSys/teku/pull/2363#pullrequestreview-450022498", "createdAt": "2020-07-16T16:36:23Z", "commit": {"oid": "0f7a07bdca097b14ca79a500756a1ecd284d365c"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xNlQxNjozNjoyNFrOGyzLtQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xNlQxNjozNjoyNFrOGyzLtQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NTkyMDU2NQ==", "bodyText": "Seems to be a duplicate line", "url": "https://github.com/ConsenSys/teku/pull/2363#discussion_r455920565", "createdAt": "2020-07-16T16:36:24Z", "author": {"login": "benjaminion"}, "path": "bls/build.gradle", "diffHunk": "@@ -3,6 +3,7 @@ dependencies {\n \n   api 'org.bouncycastle:bcprov-jdk15on'\n \n+  implementation 'org.apache.tuweni:tuweni-bytes'", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "0f7a07bdca097b14ca79a500756a1ecd284d365c"}, "originalPosition": 4}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDUwMDI1NTEy", "url": "https://github.com/ConsenSys/teku/pull/2363#pullrequestreview-450025512", "createdAt": "2020-07-16T16:40:15Z", "commit": {"oid": "0f7a07bdca097b14ca79a500756a1ecd284d365c"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xNlQxNjo0MDoxNVrOGyzVCg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xNlQxNjo0MDoxNVrOGyzVCg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NTkyMjk1NA==", "bodyText": "I would localize this flag usage inside BLS module only.\nYou may alter  BLS.prepareBatchVerify and BLS.completeBatchVerify behavior based on this flag", "url": "https://github.com/ConsenSys/teku/pull/2363#discussion_r455922954", "createdAt": "2020-07-16T16:40:15Z", "author": {"login": "Nashatyrev"}, "path": "ethereum/core/src/main/java/tech/pegasys/teku/core/blockvalidator/BatchSignatureVerifier.java", "diffHunk": "@@ -68,6 +74,10 @@ public synchronized boolean verify(\n    * instance methods would fail with exception\n    */\n   public synchronized boolean batchVerify() {\n+    if (!BLSConstants.VERIFICATION_ENABLED) {\n+      LOG.warn(\"Skipping bls verification.\");\n+      return true;\n+    }", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "0f7a07bdca097b14ca79a500756a1ecd284d365c"}, "originalPosition": 29}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDUwMDI2Njg4", "url": "https://github.com/ConsenSys/teku/pull/2363#pullrequestreview-450026688", "createdAt": "2020-07-16T16:41:46Z", "commit": {"oid": "0f7a07bdca097b14ca79a500756a1ecd284d365c"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xNlQxNjo0MTo0NlrOGyzYuw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xNlQxNjo0MTo0NlrOGyzYuw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NTkyMzg5OQ==", "bodyText": "This may be too pernickety, but I'd much rather see the constant named VERIFICATION_DISABLED. This for a couple of reasons:\n\nIt's easy to lose/forget the ! at the start. It's an extra cognitive step (got to work out \"not false\"), and I've seen really stupid errors arise as a result of simple things like this.\nThe normal case is \"enabled\", flagging DISABLED in big letters shows more clearly that this is an exceptional path.", "url": "https://github.com/ConsenSys/teku/pull/2363#discussion_r455923899", "createdAt": "2020-07-16T16:41:46Z", "author": {"login": "benjaminion"}, "path": "bls/src/main/java/tech/pegasys/teku/bls/BLS.java", "diffHunk": "@@ -65,6 +69,10 @@ public static BLSSignature sign(BLSSecretKey secretKey, Bytes message) {\n    * @return True if the verification is successful, false otherwise.\n    */\n   public static boolean verify(BLSPublicKey publicKey, Bytes message, BLSSignature signature) {\n+    if (!BLSConstants.VERIFICATION_ENABLED) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "0f7a07bdca097b14ca79a500756a1ecd284d365c"}, "originalPosition": 22}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDUwMDU4MzIw", "url": "https://github.com/ConsenSys/teku/pull/2363#pullrequestreview-450058320", "createdAt": "2020-07-16T17:22:23Z", "commit": {"oid": "0f7a07bdca097b14ca79a500756a1ecd284d365c"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xNlQxNzoyMjoyM1rOGy05XA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xNlQxNzoyMjoyM1rOGy05XA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NTk0ODYzNg==", "bodyText": "BTW wouldn't there be a flood of WARN logs when fuzz testing?", "url": "https://github.com/ConsenSys/teku/pull/2363#discussion_r455948636", "createdAt": "2020-07-16T17:22:23Z", "author": {"login": "Nashatyrev"}, "path": "bls/src/main/java/tech/pegasys/teku/bls/BLS.java", "diffHunk": "@@ -130,6 +138,10 @@ public static boolean aggregateVerify(\n    */\n   public static boolean fastAggregateVerify(\n       List<BLSPublicKey> publicKeys, Bytes message, BLSSignature signature) {\n+    if (!BLSConstants.VERIFICATION_ENABLED) {\n+      LOG.warn(\"Skipping bls verification.\");", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "0f7a07bdca097b14ca79a500756a1ecd284d365c"}, "originalPosition": 34}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDUwMDYwNDM2", "url": "https://github.com/ConsenSys/teku/pull/2363#pullrequestreview-450060436", "createdAt": "2020-07-16T17:25:10Z", "commit": {"oid": "0f7a07bdca097b14ca79a500756a1ecd284d365c"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "6449a38cfc727dde375e844f7c5c373156c32256", "author": {"user": {"login": "cemozerr", "name": "Cem Ozer"}}, "url": "https://github.com/ConsenSys/teku/commit/6449a38cfc727dde375e844f7c5c373156c32256", "committedDate": "2020-07-16T19:13:32Z", "message": "Add more checks"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "058f9468eec56bdbb0ac1baf094fba3230be2e15", "author": {"user": {"login": "cemozerr", "name": "Cem Ozer"}}, "url": "https://github.com/ConsenSys/teku/commit/058f9468eec56bdbb0ac1baf094fba3230be2e15", "committedDate": "2020-07-16T19:17:50Z", "message": "Switch from ENABLED to DISABLED"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "5f63459cae7738f3ad0463e9c64909b2d4c28b10", "author": {"user": {"login": "cemozerr", "name": "Cem Ozer"}}, "url": "https://github.com/ConsenSys/teku/commit/5f63459cae7738f3ad0463e9c64909b2d4c28b10", "committedDate": "2020-07-16T19:21:10Z", "message": "Localize flag checking"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "78bfeb4cd890992c00e70f961c7c26ed37515160", "author": {"user": {"login": "cemozerr", "name": "Cem Ozer"}}, "url": "https://github.com/ConsenSys/teku/commit/78bfeb4cd890992c00e70f961c7c26ed37515160", "committedDate": "2020-07-16T19:29:01Z", "message": "Run spotless"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3635, "cost": 1, "resetAt": "2021-11-01T13:51:04Z"}}}