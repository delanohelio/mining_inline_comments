{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDE5Mjk5MzY2", "number": 1802, "title": "Should consider peer suitable if head block more than one epoch ahead", "bodyText": "PR Description\nRather than considering sync complete if we have the same finalised epoch as all our peers, consider peers valid sync targets if their head block is more than one epoch ahead of ours.\nThis avoid sync stalling if there are more than 10 non-finalised epochs (as the BlockPropagationManager won't be able to catch up that far).", "createdAt": "2020-05-18T07:01:06Z", "url": "https://github.com/ConsenSys/teku/pull/1802", "merged": true, "mergeCommit": {"oid": "320eaba7966c4d3248cb2138454b076603882a6b"}, "closed": true, "closedAt": "2020-05-18T23:35:37Z", "author": {"login": "ajsutton"}, "timelineItems": {"totalCount": 7, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABciaTllAH2gAyNDE5Mjk5MzY2OmU2ZDhmZTRmNDg0NTZhOGUzMDBlNzk2MWYzM2NjNDUxMTFkZTBhZWY=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcioZhNgH2gAyNDE5Mjk5MzY2OjllMDk0MGQyYjAyZGM5ZmUxZDFhNWE1YTI1YjkzYjM5NDJiNjczZjQ=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "e6d8fe4f48456a8e300e7961f33cc45111de0aef", "author": {"user": {"login": "ajsutton", "name": "Adrian Sutton"}}, "url": "https://github.com/ConsenSys/teku/commit/e6d8fe4f48456a8e300e7961f33cc45111de0aef", "committedDate": "2020-05-18T06:58:26Z", "message": "Should consider peer suitable if head block more than one epoch ahead of ours."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDEzNzk4OTM2", "url": "https://github.com/ConsenSys/teku/pull/1802#pullrequestreview-413798936", "createdAt": "2020-05-18T17:29:42Z", "commit": {"oid": "e6d8fe4f48456a8e300e7961f33cc45111de0aef"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xOFQxNzoyOTo0MlrOGXA72g==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xOFQxNzoyOTo0MlrOGXA72g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNjc4NTc1NA==", "bodyText": "nit: to be more clear\n\n  \n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n              private boolean isMoreThanAnEpochAhead(final Eth2Peer peer) {\n          \n          \n            \n              private boolean isHeadMoreThanAnEpochAhead(final Eth2Peer peer) {", "url": "https://github.com/ConsenSys/teku/pull/1802#discussion_r426785754", "createdAt": "2020-05-18T17:29:42Z", "author": {"login": "cemozerr"}, "path": "sync/src/main/java/tech/pegasys/teku/sync/SyncManager.java", "diffHunk": "@@ -227,6 +231,13 @@ private boolean isPeerSyncSuitable(Eth2Peer peer) {\n         network.getPeerCount(),\n         ourFinalizedEpoch.toString(10));\n     return !peersWithSyncErrors.contains(peer.getId())\n-        && peer.getStatus().getFinalizedEpoch().compareTo(ourFinalizedEpoch) > 0;\n+        && (peer.getStatus().getFinalizedEpoch().compareTo(ourFinalizedEpoch) > 0\n+            || isMoreThanAnEpochAhead(peer));\n+  }\n+\n+  private boolean isMoreThanAnEpochAhead(final Eth2Peer peer) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "e6d8fe4f48456a8e300e7961f33cc45111de0aef"}, "originalPosition": 29}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDEzNzk5Nzg0", "url": "https://github.com/ConsenSys/teku/pull/1802#pullrequestreview-413799784", "createdAt": "2020-05-18T17:30:56Z", "commit": {"oid": "e6d8fe4f48456a8e300e7961f33cc45111de0aef"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "76b90ec582328aadbfe12e511ca4429a2115bb36", "author": {"user": {"login": "cemozerr", "name": "Cem Ozer"}}, "url": "https://github.com/ConsenSys/teku/commit/76b90ec582328aadbfe12e511ca4429a2115bb36", "committedDate": "2020-05-18T17:31:03Z", "message": "Merge branch 'master' into sync-non-finalized"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c1b05120f6472ce02827d5657ed12f690081868a", "author": {"user": {"login": "ajsutton", "name": "Adrian Sutton"}}, "url": "https://github.com/ConsenSys/teku/commit/c1b05120f6472ce02827d5657ed12f690081868a", "committedDate": "2020-05-18T23:21:52Z", "message": "Rename method for clarity."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "32be46a07c105e8bb702b07673cd01c20dd1815b", "author": {"user": {"login": "ajsutton", "name": "Adrian Sutton"}}, "url": "https://github.com/ConsenSys/teku/commit/32be46a07c105e8bb702b07673cd01c20dd1815b", "committedDate": "2020-05-18T23:22:00Z", "message": "Merge branch 'master' of github.com:PegaSysEng/teku into sync-non-finalized"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "9e0940d2b02dc9fe1d1a5a5a25b93b3942b673f4", "author": {"user": {"login": "ajsutton", "name": "Adrian Sutton"}}, "url": "https://github.com/ConsenSys/teku/commit/9e0940d2b02dc9fe1d1a5a5a25b93b3942b673f4", "committedDate": "2020-05-18T23:23:35Z", "message": "Merge branch 'sync-non-finalized' of github.com:ajsutton/teku into sync-non-finalized"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3979, "cost": 1, "resetAt": "2021-11-01T13:51:04Z"}}}