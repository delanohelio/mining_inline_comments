{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDY5ODY2MTMx", "number": 2613, "title": "Use Guava Cache when creating `LimitedMap` rather than `LinkedHashMap`", "bodyText": "PR Description\nSwitched LimitedMap to create a Guava Cache instead of a LinkedHashMap.\nConcurrent access safe by default (and much more efficiently than using synchronizedMap) and will fix an issue where LinkedHashMap was unexpectedly exceeding it's expected maximum size.\nOnly least recently used eviction is supported. This was used in all but one place which never accessed individual items anyway so is unaffected by the change.\nFixed Issue(s)\nfixes #2612\nDocumentation\n\n I thought about documentation and added the documentation label to this PR if updates are required.", "createdAt": "2020-08-19T01:16:57Z", "url": "https://github.com/ConsenSys/teku/pull/2613", "merged": true, "mergeCommit": {"oid": "a74dac8d2950848eaa3bbcdeb842fa8b8c02e266"}, "closed": true, "closedAt": "2020-08-19T04:13:49Z", "author": {"login": "ajsutton"}, "timelineItems": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdARHt3gH2gAyNDY5ODY2MTMxOjQ1YmY3NThlM2JmMWE2MWI0OTQxMTYwMzBlYTFjMTkwYzdkNjg2ZjM=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdATQkqAFqTQ3MDEwMzU5Nw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "45bf758e3bf1a61b494116030ea1c190c7d686f3", "author": {"user": {"login": "ajsutton", "name": "Adrian Sutton"}}, "url": "https://github.com/ConsenSys/teku/commit/45bf758e3bf1a61b494116030ea1c190c7d686f3", "committedDate": "2020-08-19T01:14:03Z", "message": "Use Guava Cache when creating `LimitedMap` rather than `LinkedHashMap`.\nConcurrent access safe by default (and much more efficiently than using synchronizedMap) and will fix an issue where LinkedHashMap was unexpectedly exceeding it's expected maximum size.\nOnly least recently used eviction is supported. This was used in all but one place which never accessed individual items anyway so is unaffected by the change."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDcwMTAzMjI4", "url": "https://github.com/ConsenSys/teku/pull/2613#pullrequestreview-470103228", "createdAt": "2020-08-19T03:42:09Z", "commit": {"oid": "45bf758e3bf1a61b494116030ea1c190c7d686f3"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xOVQwMzo0MjowOVrOHCwMnA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xOVQwMzo0MjowOVrOHCwMnA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MjY0ODg2MA==", "bodyText": "is it worth investigating if we can explicitly make a call to update the accessed time of what we actually want to use?", "url": "https://github.com/ConsenSys/teku/pull/2613#discussion_r472648860", "createdAt": "2020-08-19T03:42:09Z", "author": {"login": "rolfyone"}, "path": "ethereum/statetransition/src/main/java/tech/pegasys/teku/statetransition/OperationPool.java", "diffHunk": "@@ -47,10 +45,12 @@ public OperationPool(Class<T> clazz, OperationStateTransitionValidator<T> operat\n \n   public SSZList<T> getItemsForBlock(BeaconState stateAtBlockSlot) {\n     SSZMutableList<T> itemsToPutInBlock =\n-        SSZList.createMutable(clazz, maxNumberOfElementsInBlock.get(clazz));\n+        SSZList.createMutable(clazz, MAX_NUMBER_OF_ELEMENTS_IN_BLOCK.get(clazz));\n+    // Note that iterating through all items does not affect their access time so we are effectively\n+    // evicting the oldest entries when the size is exceeded as we only ever access via iteration.", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "45bf758e3bf1a61b494116030ea1c190c7d686f3"}, "originalPosition": 30}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDcwMTAzNTk3", "url": "https://github.com/ConsenSys/teku/pull/2613#pullrequestreview-470103597", "createdAt": "2020-08-19T03:43:32Z", "commit": {"oid": "45bf758e3bf1a61b494116030ea1c190c7d686f3"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3503, "cost": 1, "resetAt": "2021-11-01T13:51:04Z"}}}