{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDU4MTA5NDEx", "number": 2468, "title": "startup should fail if storage fails to start in some cases.", "bodyText": "startup now fails if storage causes anything other than a TimeoutException\n\n\nadded regression test to show storage failing for an IOException\n\n\nadded debug trace to include stack trace if context is required.\n\n\nfixes #2368\nSigned-off-by: Paul Harris paul.harris@consensys.net\nDocumentation\n\n I thought about documentation and added the documentation label to this PR if updates are required.", "createdAt": "2020-07-28T23:25:53Z", "url": "https://github.com/ConsenSys/teku/pull/2468", "merged": true, "mergeCommit": {"oid": "ec8325781f4cdbb36f3e740156431769cfabf1a5"}, "closed": true, "closedAt": "2020-07-29T02:20:19Z", "author": {"login": "rolfyone"}, "timelineItems": {"totalCount": 5, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABc5e-VOAH2gAyNDU4MTA5NDExOmYyMGNjZWJjZjhmODdjOTgxOWM0NDBiYWU0YTFmMDA1YzgwYzM3OWE=", "endCursor": "Y3Vyc29yOnYyOpPPAAABc5hRxvgH2gAyNDU4MTA5NDExOmEwYzkyNjkzNDdiYzA3ZGMxYjhiYzc4NGIzNzBmODUwZDU1NGIyN2M=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "f20ccebcf8f87c9819c440bae4a1f005c80c379a", "author": {"user": {"login": "rolfyone", "name": "Paul Harris"}}, "url": "https://github.com/ConsenSys/teku/commit/f20ccebcf8f87c9819c440bae4a1f005c80c379a", "committedDate": "2020-07-28T23:25:00Z", "message": "startup should fail if storage fails to start in some cases.\n\n - startup now fails if storage causes anything other than a TimeoutException\n\n - added regression test to show storage failing for an IOException\n\n - added debug trace to include stack trace if context is required.\n\n fixes #2368\n\nSigned-off-by: Paul Harris <paul.harris@consensys.net>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "dc7aaef4c262e00feb5c40af9d792ca1b5fcb36b", "author": {"user": {"login": "rolfyone", "name": "Paul Harris"}}, "url": "https://github.com/ConsenSys/teku/commit/dc7aaef4c262e00feb5c40af9d792ca1b5fcb36b", "committedDate": "2020-07-28T23:58:46Z", "message": "Merge branch 'master' into 2368"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDU3MTIwNDE3", "url": "https://github.com/ConsenSys/teku/pull/2468#pullrequestreview-457120417", "createdAt": "2020-07-29T00:41:03Z", "commit": {"oid": "dc7aaef4c262e00feb5c40af9d792ca1b5fcb36b"}, "state": "APPROVED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yOVQwMDo0MTowM1rOG4kjdQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yOVQwMDo0MTo0M1rOG4kkJQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MTk3MjM0MQ==", "bodyText": "We don't want to log this to the console.  Just a normal trace log in StorageBackedRecentChainData would be enough. We'll almost certainly hit this at least once during startup because of the order that services start.", "url": "https://github.com/ConsenSys/teku/pull/2468#discussion_r461972341", "createdAt": "2020-07-29T00:41:03Z", "author": {"login": "ajsutton"}, "path": "logging/src/main/java/tech/pegasys/teku/logging/StatusLogger.java", "diffHunk": "@@ -98,6 +98,18 @@ public void beginInitializingChainData() {\n     log.info(\"Initializing storage\");\n   }\n \n+  public void initializingChainDataTimeout() {\n+    log.info(\"storage initialisation timed out, will retry.\");\n+  }", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "dc7aaef4c262e00feb5c40af9d792ca1b5fcb36b"}, "originalPosition": 6}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MTk3MjUxNw==", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                        + \"Is your network set in line with your existing database? \"\n          \n          \n            \n                        + \"Check the existing database matches the current network configuration. \"", "url": "https://github.com/ConsenSys/teku/pull/2468#discussion_r461972517", "createdAt": "2020-07-29T00:41:43Z", "author": {"login": "ajsutton"}, "path": "logging/src/main/java/tech/pegasys/teku/logging/StatusLogger.java", "diffHunk": "@@ -98,6 +98,18 @@ public void beginInitializingChainData() {\n     log.info(\"Initializing storage\");\n   }\n \n+  public void initializingChainDataTimeout() {\n+    log.info(\"storage initialisation timed out, will retry.\");\n+  }\n+\n+  public void fatalErrorInitialisingStorage(Throwable err) {\n+    log.debug(\"Failed to intiailize storage\", err);\n+    log.fatal(\n+        \"Failed to initialize storage. \"\n+            + \"Is your network set in line with your existing database? \"", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "dc7aaef4c262e00feb5c40af9d792ca1b5fcb36b"}, "originalPosition": 12}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e568a15ffa85d23e5dee1850e248c3ad3e4bd4bd", "author": {"user": {"login": "rolfyone", "name": "Paul Harris"}}, "url": "https://github.com/ConsenSys/teku/commit/e568a15ffa85d23e5dee1850e248c3ad3e4bd4bd", "committedDate": "2020-07-29T01:58:26Z", "message": "review feedback.\n\nSigned-off-by: Paul Harris <paul.harris@consensys.net>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a0c9269347bc07dc1b8bc784b370f850d554b27c", "author": {"user": {"login": "rolfyone", "name": "Paul Harris"}}, "url": "https://github.com/ConsenSys/teku/commit/a0c9269347bc07dc1b8bc784b370f850d554b27c", "committedDate": "2020-07-29T02:06:03Z", "message": "Merge remote-tracking branch 'upstream/master' into 2368"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3705, "cost": 1, "resetAt": "2021-11-01T13:51:04Z"}}}