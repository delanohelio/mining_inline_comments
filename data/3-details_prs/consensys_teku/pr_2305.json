{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDQzNzA2NTQx", "number": 2305, "title": "Fix Attestation Invalid Signature Bug", "bodyText": "PR Description\nWe previously didn't categorize missed slots as reorgs, but as a result, we were not recalculating Validator duties correctly on the latest slots of epochs with late-arriving blocks.\nThis PR currently uses inheritance to do a quick fix without intruding with any other modules, but depending on the feedback, we can have a bigger change. For that, we need to answer if we\nshould be considering the head block slot or the node slot as the head slot.\nFixed Issue(s)\n\n\n#2179\nDocumentation\n\n I thought about documentation and added the documentation label to this PR if updates are required.", "createdAt": "2020-07-02T19:36:01Z", "url": "https://github.com/ConsenSys/teku/pull/2305", "merged": true, "mergeCommit": {"oid": "6d117919c19c2440aaf8a6a0b87390447ad1303d"}, "closed": true, "closedAt": "2020-07-02T23:17:37Z", "author": {"login": "cemozerr"}, "timelineItems": {"totalCount": 8, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcxEFGrAH2gAyNDQzNzA2NTQxOjA3NDFlNTEyMGJmODhjMmExZGM3NWFiYWFhYjBkNDk3MTJkNzRiNzM=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcxHM-qgFqTQ0MjA2NTA1Mg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "0741e5120bf88c2a1dc75abaaab0d49712d74b73", "author": {"user": {"login": "cemozerr", "name": "Cem Ozer"}}, "url": "https://github.com/ConsenSys/teku/commit/0741e5120bf88c2a1dc75abaaab0d49712d74b73", "committedDate": "2020-07-02T19:33:34Z", "message": "Make non-intrusive quick fix using inheritance"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b1932b8c6c7155d54316c119d45df32b146c9644", "author": {"user": {"login": "cemozerr", "name": "Cem Ozer"}}, "url": "https://github.com/ConsenSys/teku/commit/b1932b8c6c7155d54316c119d45df32b146c9644", "committedDate": "2020-07-02T19:43:13Z", "message": "Run spotless"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a09d0155f30e23d9f610bcda50706f07c1ddbb2a", "author": {"user": {"login": "cemozerr", "name": "Cem Ozer"}}, "url": "https://github.com/ConsenSys/teku/commit/a09d0155f30e23d9f610bcda50706f07c1ddbb2a", "committedDate": "2020-07-02T20:39:55Z", "message": "Pass nodeslot to process head"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDQyMDE0MjA2", "url": "https://github.com/ConsenSys/teku/pull/2305#pullrequestreview-442014206", "createdAt": "2020-07-02T20:57:31Z", "commit": {"oid": "a09d0155f30e23d9f610bcda50706f07c1ddbb2a"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wMlQyMDo1NzozMVrOGsczVw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wMlQyMDo1NzozMVrOGsczVw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0OTI2MjQyMw==", "bodyText": "I wonder if we should just call this ChainHead or ChainPoint or ChainLink or something...  It's not quite right but I don't really like the proliferation of XandY kind of classes and would love to come up with better names for them.\nPotentially we could just use this class to replace a bunch of them since the slot could just be taken from the state and then be equivalent to SignedBlockAndState which may be what you mean by a bigger refactoring.  Definitely happy to defer that change.", "url": "https://github.com/ConsenSys/teku/pull/2305#discussion_r449262423", "createdAt": "2020-07-02T20:57:31Z", "author": {"login": "ajsutton"}, "path": "storage/src/main/java/tech/pegasys/teku/storage/client/RecentChainData.java", "diffHunk": "@@ -356,4 +357,18 @@ public void onNewFinalizedCheckpoint(Checkpoint finalizedCheckpoint) {\n     finalizedCheckpointChannel.onNewFinalizedCheckpoint(finalizedCheckpoint);\n     forkChoiceStrategy.ifPresent(strategy -> strategy.maybePrune(finalizedCheckpoint.getRoot()));\n   }\n+\n+  private static class SignedBlockAndStateAndSlot extends SignedBlockAndState {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "a09d0155f30e23d9f610bcda50706f07c1ddbb2a"}, "originalPosition": 29}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "8937c882a7e22ac898a7a4971852eaeeba36041c", "author": {"user": {"login": "ajsutton", "name": "Adrian Sutton"}}, "url": "https://github.com/ConsenSys/teku/commit/8937c882a7e22ac898a7a4971852eaeeba36041c", "committedDate": "2020-07-02T22:39:54Z", "message": "Add reorg test for when a slot is filled."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "9fb423ee14ec97c67044763428c1206f5731e1a2", "author": {"user": {"login": "ajsutton", "name": "Adrian Sutton"}}, "url": "https://github.com/ConsenSys/teku/commit/9fb423ee14ec97c67044763428c1206f5731e1a2", "committedDate": "2020-07-02T22:50:06Z", "message": "Add higher level reorg test."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "19c272a41a444d47fc28836d921d1e471cdafa77", "author": {"user": {"login": "ajsutton", "name": "Adrian Sutton"}}, "url": "https://github.com/ConsenSys/teku/commit/19c272a41a444d47fc28836d921d1e471cdafa77", "committedDate": "2020-07-02T22:51:10Z", "message": "Merge branch 'master' of github.com:PegaSysEng/teku into fixAttestationInvalidSignatureError"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDQyMDY1MDUy", "url": "https://github.com/ConsenSys/teku/pull/2305#pullrequestreview-442065052", "createdAt": "2020-07-02T23:11:53Z", "commit": {"oid": "9fb423ee14ec97c67044763428c1206f5731e1a2"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3791, "cost": 1, "resetAt": "2021-11-01T13:51:04Z"}}}