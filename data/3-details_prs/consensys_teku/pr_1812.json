{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDE5ODc4MzEy", "number": 1812, "title": "Rework reference test framework", "bodyText": "PR Description\nRework the reference test framework so that new test cases are automatically picked up and generally make it a little easier to understand where data is coming from.", "createdAt": "2020-05-19T05:00:38Z", "url": "https://github.com/ConsenSys/teku/pull/1812", "merged": true, "mergeCommit": {"oid": "02a0511d7988b72605571e3b5337895055fca96b"}, "closed": true, "closedAt": "2020-05-19T19:03:56Z", "author": {"login": "ajsutton"}, "timelineItems": {"totalCount": 19, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcitMmiAH2gAyNDE5ODc4MzEyOmZhMDVmN2Q2YjQ5M2EzMWQyNGQyOTViNjVhNGQwNWI2MGQyMzI2Yjg=", "endCursor": "Y3Vyc29yOnYyOpPPAAABci40osgFqTQxNDcxNzMzOQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "fa05f7d6b493a31d24d295b65a4d05b60d2326b8", "author": {"user": {"login": "ajsutton", "name": "Adrian Sutton"}}, "url": "https://github.com/ConsenSys/teku/commit/fa05f7d6b493a31d24d295b65a4d05b60d2326b8", "committedDate": "2020-05-19T04:59:00Z", "message": "Generate reference tests to ensure we run them all."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "25d105f27ac2a945bf8028451ebf149b44f42fa1", "author": {"user": {"login": "ajsutton", "name": "Adrian Sutton"}}, "url": "https://github.com/ConsenSys/teku/commit/25d105f27ac2a945bf8028451ebf149b44f42fa1", "committedDate": "2020-05-19T05:09:27Z", "message": "Don't compile the reference tests until we've downloaded them."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "529fb1961040437d7aa22b739b0e15e93c2fe959", "author": {"user": {"login": "ajsutton", "name": "Adrian Sutton"}}, "url": "https://github.com/ConsenSys/teku/commit/529fb1961040437d7aa22b739b0e15e93c2fe959", "committedDate": "2020-05-19T05:23:02Z", "message": "Merge branch 'master' into fix-ref-tests"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "69c7c9a38932ba62506da0d547b15bd6412f066d", "author": {"user": {"login": "ajsutton", "name": "Adrian Sutton"}}, "url": "https://github.com/ConsenSys/teku/commit/69c7c9a38932ba62506da0d547b15bd6412f066d", "committedDate": "2020-05-19T06:03:20Z", "message": "Capture test reports as an artifact."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "68befc9fb3015d5ac9235ee26c9dd0fa7a4c3d57", "author": {"user": {"login": "ajsutton", "name": "Adrian Sutton"}}, "url": "https://github.com/ConsenSys/teku/commit/68befc9fb3015d5ac9235ee26c9dd0fa7a4c3d57", "committedDate": "2020-05-19T06:03:31Z", "message": "Merge branch 'fix-ref-tests' of github.com:ajsutton/teku into fix-ref-tests"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "8dcb702c8c42b3a12c02ec985916fe3760d4f551", "author": {"user": {"login": "ajsutton", "name": "Adrian Sutton"}}, "url": "https://github.com/ConsenSys/teku/commit/8dcb702c8c42b3a12c02ec985916fe3760d4f551", "committedDate": "2020-05-19T06:12:38Z", "message": "Simplify executors."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "df35c3677bdb28b2f5cb3e8f8e60b166f410f843", "author": {"user": {"login": "ajsutton", "name": "Adrian Sutton"}}, "url": "https://github.com/ConsenSys/teku/commit/df35c3677bdb28b2f5cb3e8f8e60b166f410f843", "committedDate": "2020-05-19T08:45:48Z", "message": "Capture test results xml files as a tarball."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "19c27fdd479c809c6a944e54aadbb9e82743bc0d", "author": {"user": {"login": "ajsutton", "name": "Adrian Sutton"}}, "url": "https://github.com/ConsenSys/teku/commit/19c27fdd479c809c6a944e54aadbb9e82743bc0d", "committedDate": "2020-05-19T09:22:33Z", "message": "Standardise approach."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "472d481ca5b3f1caedc07accb3da174c5f69be4d", "author": {"user": {"login": "ajsutton", "name": "Adrian Sutton"}}, "url": "https://github.com/ConsenSys/teku/commit/472d481ca5b3f1caedc07accb3da174c5f69be4d", "committedDate": "2020-05-19T09:25:36Z", "message": "Load ssz roots the modern way."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "87e9ec733cd22fd28c41faf60757c822d2e6d4bb", "author": {"user": {"login": "ajsutton", "name": "Adrian Sutton"}}, "url": "https://github.com/ConsenSys/teku/commit/87e9ec733cd22fd28c41faf60757c822d2e6d4bb", "committedDate": "2020-05-19T09:27:12Z", "message": "Don't capture test XML."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ae1d0726e9d67343d03157a8e78db3d8a16a1a80", "author": {"user": {"login": "ajsutton", "name": "Adrian Sutton"}}, "url": "https://github.com/ConsenSys/teku/commit/ae1d0726e9d67343d03157a8e78db3d8a16a1a80", "committedDate": "2020-05-19T09:34:20Z", "message": "Rename and tidy up."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "549230c63976d30cfd616b202c443b2c9d2e0bbe", "author": {"user": {"login": "ajsutton", "name": "Adrian Sutton"}}, "url": "https://github.com/ConsenSys/teku/commit/549230c63976d30cfd616b202c443b2c9d2e0bbe", "committedDate": "2020-05-19T09:35:39Z", "message": "Dead code."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "8b3c1dd2ea8fc5b07635c8a96aa208819f2e4129", "author": {"user": {"login": "ajsutton", "name": "Adrian Sutton"}}, "url": "https://github.com/ConsenSys/teku/commit/8b3c1dd2ea8fc5b07635c8a96aa208819f2e4129", "committedDate": "2020-05-19T09:47:44Z", "message": "Remove commented out main."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a14d54b5d7548c4c00b917fdd4e32ceaa9d67b6f", "author": {"user": {"login": "ajsutton", "name": "Adrian Sutton"}}, "url": "https://github.com/ConsenSys/teku/commit/a14d54b5d7548c4c00b917fdd4e32ceaa9d67b6f", "committedDate": "2020-05-19T09:50:22Z", "message": "Use loadYaml"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "7ce9c521c17d1564cc29bb7f907b1384c01cbb65", "author": {"user": {"login": "ajsutton", "name": "Adrian Sutton"}}, "url": "https://github.com/ConsenSys/teku/commit/7ce9c521c17d1564cc29bb7f907b1384c01cbb65", "committedDate": "2020-05-19T09:52:03Z", "message": "Remove TODO."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDE0NjM0NTk4", "url": "https://github.com/ConsenSys/teku/pull/1812#pullrequestreview-414634598", "createdAt": "2020-05-19T16:44:58Z", "commit": {"oid": "7ce9c521c17d1564cc29bb7f907b1384c01cbb65"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xOVQxNjo0NDo1OFrOGXpUeQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xOVQxNjo0NDo1OFrOGXpUeQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNzQ0NzQxNw==", "bodyText": "Why are we separating the compiling of reference tests from the Assemble command?", "url": "https://github.com/ConsenSys/teku/pull/1812#discussion_r427447417", "createdAt": "2020-05-19T16:44:58Z", "author": {"login": "cemozerr"}, "path": ".circleci/config.yml", "diffHunk": "@@ -195,11 +196,15 @@ jobs:\n             then\n               ./gradlew --no-daemon expandRefTests\n             fi\n+      - run:", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "7ce9c521c17d1564cc29bb7f907b1384c01cbb65"}, "originalPosition": 21}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDE0NjcyNjMy", "url": "https://github.com/ConsenSys/teku/pull/1812#pullrequestreview-414672632", "createdAt": "2020-05-19T17:33:04Z", "commit": {"oid": "7ce9c521c17d1564cc29bb7f907b1384c01cbb65"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xOVQxNzozMzowNVrOGXrL7w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xOVQxNzozMzowNVrOGXrL7w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNzQ3Nzk5OQ==", "bodyText": "Why are we ignoring these tests?", "url": "https://github.com/ConsenSys/teku/pull/1812#discussion_r427477999", "createdAt": "2020-05-19T17:33:05Z", "author": {"login": "cemozerr"}, "path": "eth-reference-tests/src/referenceTest/java/tech/pegasys/teku/reference/phase0/ssz_static/SszTestExecutor.java", "diffHunk": "@@ -0,0 +1,131 @@\n+/*\n+ * Copyright 2020 ConsenSys AG.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\"); you may not use this file except in compliance with\n+ * the License. You may obtain a copy of the License at\n+ *\n+ * http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software distributed under the License is distributed on\n+ * an \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied. See the License for the\n+ * specific language governing permissions and limitations under the License.\n+ */\n+\n+package tech.pegasys.teku.reference.phase0.ssz_static;\n+\n+import static org.assertj.core.api.Assertions.assertThat;\n+\n+import com.fasterxml.jackson.annotation.JsonProperty;\n+import com.google.common.collect.ImmutableMap;\n+import java.nio.file.Files;\n+import java.nio.file.Path;\n+import org.apache.tuweni.bytes.Bytes;\n+import org.apache.tuweni.bytes.Bytes32;\n+import tech.pegasys.teku.datastructures.blocks.BeaconBlock;\n+import tech.pegasys.teku.datastructures.blocks.BeaconBlockBody;\n+import tech.pegasys.teku.datastructures.blocks.BeaconBlockHeader;\n+import tech.pegasys.teku.datastructures.blocks.Eth1Data;\n+import tech.pegasys.teku.datastructures.blocks.SignedBeaconBlock;\n+import tech.pegasys.teku.datastructures.blocks.SignedBeaconBlockHeader;\n+import tech.pegasys.teku.datastructures.operations.AggregateAndProof;\n+import tech.pegasys.teku.datastructures.operations.Attestation;\n+import tech.pegasys.teku.datastructures.operations.AttestationData;\n+import tech.pegasys.teku.datastructures.operations.AttesterSlashing;\n+import tech.pegasys.teku.datastructures.operations.Deposit;\n+import tech.pegasys.teku.datastructures.operations.DepositData;\n+import tech.pegasys.teku.datastructures.operations.DepositMessage;\n+import tech.pegasys.teku.datastructures.operations.IndexedAttestation;\n+import tech.pegasys.teku.datastructures.operations.ProposerSlashing;\n+import tech.pegasys.teku.datastructures.operations.SignedAggregateAndProof;\n+import tech.pegasys.teku.datastructures.operations.SignedVoluntaryExit;\n+import tech.pegasys.teku.datastructures.operations.VoluntaryExit;\n+import tech.pegasys.teku.datastructures.state.BeaconStateImpl;\n+import tech.pegasys.teku.datastructures.state.Checkpoint;\n+import tech.pegasys.teku.datastructures.state.Fork;\n+import tech.pegasys.teku.datastructures.state.ForkData;\n+import tech.pegasys.teku.datastructures.state.HistoricalBatch;\n+import tech.pegasys.teku.datastructures.state.PendingAttestation;\n+import tech.pegasys.teku.datastructures.state.Validator;\n+import tech.pegasys.teku.datastructures.util.SimpleOffsetSerializer;\n+import tech.pegasys.teku.ethtests.finder.TestDefinition;\n+import tech.pegasys.teku.reference.phase0.TestDataUtils;\n+import tech.pegasys.teku.reference.phase0.TestExecutor;\n+import tech.pegasys.teku.ssz.sos.SimpleOffsetSerializable;\n+import tech.pegasys.teku.util.hashtree.Merkleizable;\n+\n+public class SszTestExecutor<T extends SimpleOffsetSerializable & Merkleizable>\n+    implements TestExecutor {\n+  private final Class<T> clazz;\n+\n+  public static ImmutableMap<String, TestExecutor> SSZ_TEST_TYPES =\n+      ImmutableMap.<String, TestExecutor>builder()\n+          // SSZ Static\n+          .put(\"ssz_static/AggregateAndProof\", new SszTestExecutor<>(AggregateAndProof.class))\n+          .put(\"ssz_static/Attestation\", new SszTestExecutor<>(Attestation.class))\n+          .put(\"ssz_static/AttestationData\", new SszTestExecutor<>(AttestationData.class))\n+          .put(\"ssz_static/AttesterSlashing\", new SszTestExecutor<>(AttesterSlashing.class))\n+          .put(\"ssz_static/BeaconBlock\", new SszTestExecutor<>(BeaconBlock.class))\n+          .put(\"ssz_static/BeaconBlockBody\", new SszTestExecutor<>(BeaconBlockBody.class))\n+          .put(\"ssz_static/BeaconBlockHeader\", new SszTestExecutor<>(BeaconBlockHeader.class))\n+          .put(\"ssz_static/BeaconState\", new SszTestExecutor<>(BeaconStateImpl.class))\n+          .put(\"ssz_static/Checkpoint\", new SszTestExecutor<>(Checkpoint.class))\n+          .put(\"ssz_static/Deposit\", new SszTestExecutor<>(Deposit.class))\n+          .put(\"ssz_static/DepositData\", new SszTestExecutor<>(DepositData.class))\n+          .put(\"ssz_static/DepositMessage\", new SszTestExecutor<>(DepositMessage.class))\n+          .put(\"ssz_static/Eth1Block\", IGNORE_TESTS) // We don't have an Eth1Block structure\n+          .put(\"ssz_static/Eth1Data\", new SszTestExecutor<>(Eth1Data.class))\n+          .put(\"ssz_static/Fork\", new SszTestExecutor<>(Fork.class))\n+          .put(\"ssz_static/ForkData\", new SszTestExecutor<>(ForkData.class))\n+          .put(\"ssz_static/HistoricalBatch\", new SszTestExecutor<>(HistoricalBatch.class))\n+          .put(\"ssz_static/IndexedAttestation\", new SszTestExecutor<>(IndexedAttestation.class))\n+          .put(\"ssz_static/PendingAttestation\", new SszTestExecutor<>(PendingAttestation.class))\n+          .put(\"ssz_static/ProposerSlashing\", new SszTestExecutor<>(ProposerSlashing.class))\n+          .put(\n+              \"ssz_static/SignedAggregateAndProof\",\n+              new SszTestExecutor<>(SignedAggregateAndProof.class))\n+          .put(\"ssz_static/SignedBeaconBlock\", new SszTestExecutor<>(SignedBeaconBlock.class))\n+          .put(\n+              \"ssz_static/SignedBeaconBlockHeader\",\n+              new SszTestExecutor<>(SignedBeaconBlockHeader.class))\n+          .put(\"ssz_static/SignedVoluntaryExit\", new SszTestExecutor<>(SignedVoluntaryExit.class))\n+          .put(\"ssz_static/SigningRoot\", IGNORE_TESTS) // TODO: Should make this work\n+          .put(\"ssz_static/Validator\", new SszTestExecutor<>(Validator.class))\n+          .put(\"ssz_static/VoluntaryExit\", new SszTestExecutor<>(VoluntaryExit.class))\n+\n+          // SSZ Generic\n+          .put(\"ssz_generic/basic_vector\", IGNORE_TESTS)", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "7ce9c521c17d1564cc29bb7f907b1384c01cbb65"}, "originalPosition": 96}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDE0NzEyNzQ4", "url": "https://github.com/ConsenSys/teku/pull/1812#pullrequestreview-414712748", "createdAt": "2020-05-19T18:25:37Z", "commit": {"oid": "7ce9c521c17d1564cc29bb7f907b1384c01cbb65"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xOVQxODoyNTozN1rOGXtMbA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xOVQxODoyNTozN1rOGXtMbA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNzUxMDg5Mg==", "bodyText": "Would it make sense for these TestFinder classes to throw if they don't find any tests? Since that is unexpected.", "url": "https://github.com/ConsenSys/teku/pull/1812#discussion_r427510892", "createdAt": "2020-05-19T18:25:37Z", "author": {"login": "cemozerr"}, "path": "eth-tests/src/main/java/tech/pegasys/teku/ethtests/finder/ShufflingTestFinder.java", "diffHunk": "@@ -0,0 +1,43 @@\n+/*\n+ * Copyright 2020 ConsenSys AG.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\"); you may not use this file except in compliance with\n+ * the License. You may obtain a copy of the License at\n+ *\n+ * http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software distributed under the License is distributed on\n+ * an \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied. See the License for the\n+ * specific language governing permissions and limitations under the License.\n+ */\n+\n+package tech.pegasys.teku.ethtests.finder;\n+\n+import com.google.errorprone.annotations.MustBeClosed;\n+import java.io.IOException;\n+import java.nio.file.Files;\n+import java.nio.file.Path;\n+import java.util.stream.Stream;\n+\n+public class ShufflingTestFinder implements TestFinder {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "7ce9c521c17d1564cc29bb7f907b1384c01cbb65"}, "originalPosition": 22}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDE0NzE3MzM5", "url": "https://github.com/ConsenSys/teku/pull/1812#pullrequestreview-414717339", "createdAt": "2020-05-19T18:31:41Z", "commit": {"oid": "7ce9c521c17d1564cc29bb7f907b1384c01cbb65"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3993, "cost": 1, "resetAt": "2021-11-01T13:51:04Z"}}}