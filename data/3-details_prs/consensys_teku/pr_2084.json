{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDMxMzkzMzIw", "number": 2084, "title": "Use new gossipsub API", "bodyText": "PR Description\nUse new gossipsub API.\nFixed Issue(s)\nFixes #2081\nDocumentation\n\n I thought about documentation and added the documentation label to this PR if updates are required.", "createdAt": "2020-06-08T20:58:13Z", "url": "https://github.com/ConsenSys/teku/pull/2084", "merged": true, "mergeCommit": {"oid": "ede61b3e10ca181f3335f2533af3d31c475e64d4"}, "closed": true, "closedAt": "2020-06-09T15:35:43Z", "author": {"login": "cemozerr"}, "timelineItems": {"totalCount": 13, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcpW4ydgH2gAyNDMxMzkzMzIwOmExYzMxNTlkMjgyMzlmNzk3N2ZjMzY5MDE1NTMxMTI4MmMyZWRjMzA=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcpmV-FAH2gAyNDMxMzkzMzIwOmI3OTRjMWQzODY0Y2VmOGZkNzdjNWUxOGZhMTU4YmZhNGJhOWY4ZGI=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "a1c3159d28239f7977fc3690155311282c2edc30", "author": {"user": {"login": "cemozerr", "name": "Cem Ozer"}}, "url": "https://github.com/ConsenSys/teku/commit/a1c3159d28239f7977fc3690155311282c2edc30", "committedDate": "2020-06-08T20:56:55Z", "message": "Use new gossipsub API"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e6ba3792d577ba58c9f033a62cab4725deb55b22", "author": {"user": {"login": "cemozerr", "name": "Cem Ozer"}}, "url": "https://github.com/ConsenSys/teku/commit/e6ba3792d577ba58c9f033a62cab4725deb55b22", "committedDate": "2020-06-08T21:16:56Z", "message": "Fix test"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "08ccddbae6cd0ff39c140c95f3417e70da09ac77", "author": {"user": {"login": "cemozerr", "name": "Cem Ozer"}}, "url": "https://github.com/ConsenSys/teku/commit/08ccddbae6cd0ff39c140c95f3417e70da09ac77", "committedDate": "2020-06-08T21:21:34Z", "message": "Fix rest of the tests"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "44f4075218fb1647851d5c33805d7e4c17e264d3", "author": {"user": {"login": "cemozerr", "name": "Cem Ozer"}}, "url": "https://github.com/ConsenSys/teku/commit/44f4075218fb1647851d5c33805d7e4c17e264d3", "committedDate": "2020-06-08T20:58:20Z", "message": "Merge branch 'master' into useNewGossipSubApi"}, "afterCommit": {"oid": "08ccddbae6cd0ff39c140c95f3417e70da09ac77", "author": {"user": {"login": "cemozerr", "name": "Cem Ozer"}}, "url": "https://github.com/ConsenSys/teku/commit/08ccddbae6cd0ff39c140c95f3417e70da09ac77", "committedDate": "2020-06-08T21:21:34Z", "message": "Fix rest of the tests"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c211a724aae766bc4f5f27838a9fcf843d124263", "author": {"user": {"login": "cemozerr", "name": "Cem Ozer"}}, "url": "https://github.com/ConsenSys/teku/commit/c211a724aae766bc4f5f27838a9fcf843d124263", "committedDate": "2020-06-08T21:24:52Z", "message": "Merge branch 'master' into useNewGossipSubApi"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b82fab6a83613115642fe169404ef4eed8c71356", "author": {"user": {"login": "cemozerr", "name": "Cem Ozer"}}, "url": "https://github.com/ConsenSys/teku/commit/b82fab6a83613115642fe169404ef4eed8c71356", "committedDate": "2020-06-08T22:19:35Z", "message": "Fix tests"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "dfa6eba65d627480a60ed55464b735b5f3e61894", "author": {"user": {"login": "cemozerr", "name": "Cem Ozer"}}, "url": "https://github.com/ConsenSys/teku/commit/dfa6eba65d627480a60ed55464b735b5f3e61894", "committedDate": "2020-06-08T23:11:22Z", "message": "Revert changes on rejecting unknown block root attestations"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "78c96e81ce2f6922c8adde1183bf5c9d2d6f993a", "author": {"user": {"login": "cemozerr", "name": "Cem Ozer"}}, "url": "https://github.com/ConsenSys/teku/commit/78c96e81ce2f6922c8adde1183bf5c9d2d6f993a", "committedDate": "2020-06-08T23:12:35Z", "message": "Merge branch 'master' into useNewGossipSubApi"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDI2NzE2Njc2", "url": "https://github.com/ConsenSys/teku/pull/2084#pullrequestreview-426716676", "createdAt": "2020-06-09T00:51:15Z", "commit": {"oid": "78c96e81ce2f6922c8adde1183bf5c9d2d6f993a"}, "state": "COMMENTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wOVQwMDo1MToxNVrOGg1GEw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wOVQwMDo1MjoyNFrOGg1HbQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNzA3NzUyMw==", "bodyText": "Probably should restore the old version of this comment:\n\n  \n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                // If it's not in the store, it must not have passed validation.\n          \n          \n            \n                // If it's not in the store, it may not have been processed yet so save for future.", "url": "https://github.com/ConsenSys/teku/pull/2084#discussion_r437077523", "createdAt": "2020-06-09T00:51:15Z", "author": {"login": "ajsutton"}, "path": "networking/eth2/src/main/java/tech/pegasys/teku/networking/eth2/gossip/topics/validation/AttestationValidator.java", "diffHunk": "@@ -111,19 +113,19 @@ ValidationResult singleOrAggregateAttestationChecks(final Attestation attestatio\n     final UnsignedLong currentTimeMillis = secondsToMillis(recentChainData.getStore().getTime());\n     if (isCurrentTimeAfterAttestationPropagationSlotRange(currentTimeMillis, attestation)\n         || isFromFarFuture(attestation, currentTimeMillis)) {\n-      return INVALID;\n+      return IGNORE;\n     }\n     if (isCurrentTimeBeforeMinimumAttestationBroadcastTime(attestation, currentTimeMillis)) {\n-      return SAVED_FOR_FUTURE;\n+      return SAVE_FOR_FUTURE;\n     }\n \n     // The block being voted for (attestation.data.beacon_block_root) passes validation.\n     // It must pass validation to be in the store.\n-    // If it's not in the store, it may not have been processed yet so save for future.\n+    // If it's not in the store, it must not have passed validation.", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "78c96e81ce2f6922c8adde1183bf5c9d2d6f993a"}, "originalPosition": 100}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNzA3Nzg2OQ==", "bodyText": "I'd suggest adding a constructor parameter so each enum value holds it's gossip sub validation result rather than having to switch here. That way it's impossible to have an unknown mapping.", "url": "https://github.com/ConsenSys/teku/pull/2084#discussion_r437077869", "createdAt": "2020-06-09T00:52:24Z", "author": {"login": "ajsutton"}, "path": "networking/eth2/src/main/java/tech/pegasys/teku/networking/eth2/gossip/topics/validation/InternalValidationResult.java", "diffHunk": "@@ -13,8 +13,23 @@\n \n package tech.pegasys.teku.networking.eth2.gossip.topics.validation;\n \n-public enum ValidationResult {\n-  VALID,\n-  SAVED_FOR_FUTURE,\n-  INVALID\n+public enum InternalValidationResult {\n+  ACCEPT,\n+  SAVE_FOR_FUTURE,\n+  IGNORE,\n+  REJECT;\n+\n+  public io.libp2p.core.pubsub.ValidationResult getGossipSubValidationResult() {\n+    switch (this) {\n+      case SAVE_FOR_FUTURE:\n+      case IGNORE:\n+        return io.libp2p.core.pubsub.ValidationResult.Ignore;\n+      case REJECT:\n+        return io.libp2p.core.pubsub.ValidationResult.Invalid;\n+      case ACCEPT:\n+        return io.libp2p.core.pubsub.ValidationResult.Valid;\n+      default:\n+        throw new UnsupportedOperationException(\"Enum missing value\");\n+    }", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "78c96e81ce2f6922c8adde1183bf5c9d2d6f993a"}, "originalPosition": 25}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDI2NzE3NzU0", "url": "https://github.com/ConsenSys/teku/pull/2084#pullrequestreview-426717754", "createdAt": "2020-06-09T00:54:51Z", "commit": {"oid": "78c96e81ce2f6922c8adde1183bf5c9d2d6f993a"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDI2OTA4Mzg4", "url": "https://github.com/ConsenSys/teku/pull/2084#pullrequestreview-426908388", "createdAt": "2020-06-09T08:33:37Z", "commit": {"oid": "78c96e81ce2f6922c8adde1183bf5c9d2d6f993a"}, "state": "APPROVED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wOVQwODozMzozN1rOGg-f1Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wOVQwODozMzozN1rOGg-f1Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNzIzMTU3Mw==", "bodyText": "After the class renaming you can import io.libp2p.core.pubsub.ValidationResult", "url": "https://github.com/ConsenSys/teku/pull/2084#discussion_r437231573", "createdAt": "2020-06-09T08:33:37Z", "author": {"login": "Nashatyrev"}, "path": "networking/eth2/src/main/java/tech/pegasys/teku/networking/eth2/gossip/topics/validation/InternalValidationResult.java", "diffHunk": "@@ -13,8 +13,23 @@\n \n package tech.pegasys.teku.networking.eth2.gossip.topics.validation;\n \n-public enum ValidationResult {\n-  VALID,\n-  SAVED_FOR_FUTURE,\n-  INVALID\n+public enum InternalValidationResult {\n+  ACCEPT,\n+  SAVE_FOR_FUTURE,\n+  IGNORE,\n+  REJECT;\n+\n+  public io.libp2p.core.pubsub.ValidationResult getGossipSubValidationResult() {\n+    switch (this) {\n+      case SAVE_FOR_FUTURE:\n+      case IGNORE:\n+        return io.libp2p.core.pubsub.ValidationResult.Ignore;\n+      case REJECT:\n+        return io.libp2p.core.pubsub.ValidationResult.Invalid;\n+      case ACCEPT:\n+        return io.libp2p.core.pubsub.ValidationResult.Valid;\n+      default:\n+        throw new UnsupportedOperationException(\"Enum missing value\");\n+    }", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNzA3Nzg2OQ=="}, "originalCommit": {"oid": "78c96e81ce2f6922c8adde1183bf5c9d2d6f993a"}, "originalPosition": 25}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "edd8da65a5a2acea6d9102f90ddad60a2af4c598", "author": {"user": {"login": "cemozerr", "name": "Cem Ozer"}}, "url": "https://github.com/ConsenSys/teku/commit/edd8da65a5a2acea6d9102f90ddad60a2af4c598", "committedDate": "2020-06-09T14:42:27Z", "message": "Revert comment & refactor InternalValidationResult"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b794c1d3864cef8fd77c5e18fa158bfa4ba9f8db", "author": {"user": {"login": "cemozerr", "name": "Cem Ozer"}}, "url": "https://github.com/ConsenSys/teku/commit/b794c1d3864cef8fd77c5e18fa158bfa4ba9f8db", "committedDate": "2020-06-09T14:57:22Z", "message": "Merge branch 'master' into useNewGossipSubApi"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3870, "cost": 1, "resetAt": "2021-11-01T13:51:04Z"}}}