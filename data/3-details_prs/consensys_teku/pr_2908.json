{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDk5MzYxMjQ4", "number": 2908, "title": "[QS-9-10] Reject attestations that fail ancestry condition", "bodyText": "PR Description\nReject attestations that fail ancestry condition.\nDocumentation\n\n I thought about documentation and added the documentation label to this PR if updates are required.", "createdAt": "2020-10-07T16:07:18Z", "url": "https://github.com/ConsenSys/teku/pull/2908", "merged": true, "mergeCommit": {"oid": "8e2e8a4782ed13ea6ea99f9d16f355ba436f328d"}, "closed": true, "closedAt": "2020-10-07T20:06:43Z", "author": {"login": "cemozerr"}, "timelineItems": {"totalCount": 7, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdQPPt5AH2gAyNDk5MzYxMjQ4OjA3NGU4MmZiYTliNGU0ZThlMzAyNTE5NGE1NTQwZWE0MWExZTJhZWE=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdQSNQwAH2gAyNDk5MzYxMjQ4OjZiMmMwNDhjNGFhMzFmMjAxY2I3ZTI2Yzg0ZDhlNmE0MzEwNTM0ZDI=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "074e82fba9b4e4e8e3025194a5540ea41a1e2aea", "author": {"user": {"login": "cemozerr", "name": "Cem Ozer"}}, "url": "https://github.com/ConsenSys/teku/commit/074e82fba9b4e4e8e3025194a5540ea41a1e2aea", "committedDate": "2020-10-07T16:05:46Z", "message": "Reject attestations that fail ancestry condition"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "49fa197b1574ebdbed34ebc4ca8a6d72baa1d890", "author": {"user": {"login": "cemozerr", "name": "Cem Ozer"}}, "url": "https://github.com/ConsenSys/teku/commit/49fa197b1574ebdbed34ebc4ca8a6d72baa1d890", "committedDate": "2020-10-07T16:06:31Z", "message": "Run spotless"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "6c69ca5e79fbb4caa405063af2ae17b9b5517c1e", "author": {"user": {"login": "cemozerr", "name": "Cem Ozer"}}, "url": "https://github.com/ConsenSys/teku/commit/6c69ca5e79fbb4caa405063af2ae17b9b5517c1e", "committedDate": "2020-10-07T16:07:32Z", "message": "Merge branch 'master' into qs-9-10/reject-attestations-that-fail-ancestry-condition"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTA0MTMxNTk2", "url": "https://github.com/ConsenSys/teku/pull/2908#pullrequestreview-504131596", "createdAt": "2020-10-07T17:57:15Z", "commit": {"oid": "6c69ca5e79fbb4caa405063af2ae17b9b5517c1e"}, "state": "APPROVED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wN1QxNzo1NzoxNVrOHd_GMw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wN1QxNzo1NzoxNVrOHd_GMw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMTIwNDUzMQ==", "bodyText": "BTW can't it be the concurrency case when recentChainData updates its finalized checkpoint between calls recentChainData.getFinalizedEpoch() and recentChainData.getFinalizedCheckpoint()?\nMay be get recentChainData.getFinalizedCheckpoint() once into local var to be certainly safe on this?", "url": "https://github.com/ConsenSys/teku/pull/2908#discussion_r501204531", "createdAt": "2020-10-07T17:57:15Z", "author": {"login": "Nashatyrev"}, "path": "networking/eth2/src/main/java/tech/pegasys/teku/networking/eth2/gossip/topics/validation/AttestationValidator.java", "diffHunk": "@@ -191,6 +191,21 @@ private InternalValidationResult singleAttestationChecks(final Attestation attes\n                 return REJECT;\n               }\n \n+              // The current finalized_checkpoint is an ancestor of the block defined by\n+              // aggregate.data.beacon_block_root\n+              if (!forkChoiceUtilWrapper\n+                  .get_ancestor(\n+                      recentChainData.getForkChoiceStrategy().orElseThrow(),\n+                      data.getBeacon_block_root(),\n+                      compute_start_slot_at_epoch(recentChainData.getFinalizedEpoch()))\n+                  .map(\n+                      ancestorOfLMDVote ->\n+                          ancestorOfLMDVote.equals(\n+                              recentChainData.getFinalizedCheckpoint().orElseThrow().getRoot()))", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "6c69ca5e79fbb4caa405063af2ae17b9b5517c1e"}, "originalPosition": 14}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "4f64149775a24f5e7ee3909acf5310e6ef411341", "author": {"user": {"login": "cemozerr", "name": "Cem Ozer"}}, "url": "https://github.com/ConsenSys/teku/commit/4f64149775a24f5e7ee3909acf5310e6ef411341", "committedDate": "2020-10-07T19:11:32Z", "message": "Resolve comment"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "080a2ee33daefdcb92b5dfca660e3dc9e91a4684", "author": {"user": {"login": "cemozerr", "name": "Cem Ozer"}}, "url": "https://github.com/ConsenSys/teku/commit/080a2ee33daefdcb92b5dfca660e3dc9e91a4684", "committedDate": "2020-10-07T19:11:32Z", "message": "Run spotless"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "6b2c048c4aa31f201cb7e26c84d8e6a4310534d2", "author": {"user": {"login": "cemozerr", "name": "Cem Ozer"}}, "url": "https://github.com/ConsenSys/teku/commit/6b2c048c4aa31f201cb7e26c84d8e6a4310534d2", "committedDate": "2020-10-07T19:32:48Z", "message": "Merge branch 'master' into qs-9-10/reject-attestations-that-fail-ancestry-condition"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3313, "cost": 1, "resetAt": "2021-11-01T13:51:04Z"}}}