{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDUzODk2NzM3", "number": 2392, "title": "Don't mark peers as permanently unsuitable when they fail to respond to ping", "bodyText": "PR Description\nWhen the network connection is interrupted in a way that the local machine can't immediately detect (e.g. router suddenly powering off) all connected peers wind up being disconnected because they don't respond to pings.  Previously this caused them to be marked as permanently unsuitable and Teku would no longer initiate connections to them (incoming connections would still be accepted).\nNow not responding to pings invokes a temporary penalty but after that Teku will again initiate connections to the peer.  On small networks this significantly improves the ability to recover after a network outage.\nFixed Issue(s)\nfixes #2200\nDocumentation\n\n I thought about documentation and added the documentation label to this PR if updates are required.", "createdAt": "2020-07-20T22:27:41Z", "url": "https://github.com/ConsenSys/teku/pull/2392", "merged": true, "mergeCommit": {"oid": "d19c5059bf53bd14f6bf118cef763172a1cc1bfd"}, "closed": true, "closedAt": "2020-07-21T20:40:46Z", "author": {"login": "ajsutton"}, "timelineItems": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABc25S8CAH2gAyNDUzODk2NzM3OjVmMGVmZjhkZDVlMmI3OWNhNzU0NDVmOWJiYjVjZDZiYmE1MjFkMTM=", "endCursor": "Y3Vyc29yOnYyOpPPAAABc3MSh4gH2gAyNDUzODk2NzM3OjBlOWYxOTYwMWFlODM1MzMyMjFhMTk4NmJmM2ZhYWFjYjQ4NjNmMDI=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "5f0eff8dd5e2b79ca75445f9bbb5cd6bba521d13", "author": {"user": {"login": "ajsutton", "name": "Adrian Sutton"}}, "url": "https://github.com/ConsenSys/teku/commit/5f0eff8dd5e2b79ca75445f9bbb5cd6bba521d13", "committedDate": "2020-07-20T22:23:16Z", "message": "Don't mark peers as permanently unsuitable when they fail to respond to pings."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDUyNTU1OTgz", "url": "https://github.com/ConsenSys/teku/pull/2392#pullrequestreview-452555983", "createdAt": "2020-07-21T15:08:33Z", "commit": {"oid": "5f0eff8dd5e2b79ca75445f9bbb5cd6bba521d13"}, "state": "APPROVED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yMVQxNTowODozNFrOG08mWg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yMVQxNToxMzozNlrOG0804A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1ODE3MTk5NA==", "bodyText": "This is outside the scope of this PR - but seems like this eth2-specific logic (GoodbyeMessage / PING behavior) should be in the eth2 package.", "url": "https://github.com/ConsenSys/teku/pull/2392#discussion_r458171994", "createdAt": "2020-07-21T15:08:34Z", "author": {"login": "mbaxter"}, "path": "networking/p2p/src/main/java/tech/pegasys/teku/networking/p2p/peer/DisconnectReason.java", "diffHunk": "@@ -23,6 +23,7 @@\n   UNABLE_TO_VERIFY_NETWORK(GoodbyeMessage.REASON_UNABLE_TO_VERIFY_NETWORK, true),\n   TOO_MANY_PEERS(GoodbyeMessage.REASON_TOO_MANY_PEERS, false),\n   REMOTE_FAULT(GoodbyeMessage.REASON_FAULT_ERROR, false),\n+  NO_PING_RESPONSES(GoodbyeMessage.REASON_FAULT_ERROR, false),", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "5f0eff8dd5e2b79ca75445f9bbb5cd6bba521d13"}, "originalPosition": 4}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1ODE3NTcxMg==", "bodyText": "Probably worth adding a test + some comments on the situation this fixes.", "url": "https://github.com/ConsenSys/teku/pull/2392#discussion_r458175712", "createdAt": "2020-07-21T15:13:36Z", "author": {"login": "mbaxter"}, "path": "networking/p2p/src/main/java/tech/pegasys/teku/networking/p2p/connection/ReputationManager.java", "diffHunk": "@@ -71,6 +75,9 @@ private Reputation getOrCreateReputation(final PeerAddress peerAddress) {\n   }\n \n   private static class Reputation {\n+    private static final EnumSet<DisconnectReason> LOCAL_TEMPORARY_DISCONNECT_REASONS =", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "5f0eff8dd5e2b79ca75445f9bbb5cd6bba521d13"}, "originalPosition": 16}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ea2aadd50f573eef9e0800aca9f8c77b81d3d106", "author": {"user": {"login": "ajsutton", "name": "Adrian Sutton"}}, "url": "https://github.com/ConsenSys/teku/commit/ea2aadd50f573eef9e0800aca9f8c77b81d3d106", "committedDate": "2020-07-21T20:30:54Z", "message": "Add comments explaining why each reason is not permanent. Add test."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "0e9f19601ae83533221a1986bf3faaacb4863f02", "author": {"user": {"login": "ajsutton", "name": "Adrian Sutton"}}, "url": "https://github.com/ConsenSys/teku/commit/0e9f19601ae83533221a1986bf3faaacb4863f02", "committedDate": "2020-07-21T20:31:01Z", "message": "Merge branch 'master' of github.com:PegaSysEng/teku into temporary-ban-for-no-ping"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3666, "cost": 1, "resetAt": "2021-11-01T13:51:04Z"}}}