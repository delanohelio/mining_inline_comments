{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0Mzc3NDQxMDQ5", "number": 1202, "title": "Change JsonProvider to be non static and use Jackson", "bodyText": "Update JsonProvider to use Jackson instead of Gson.\nfixes #1190", "createdAt": "2020-02-19T23:01:32Z", "url": "https://github.com/ConsenSys/teku/pull/1202", "merged": true, "mergeCommit": {"oid": "afa9209c7824e197f9b700a4fb72af52605ba0cd"}, "closed": true, "closedAt": "2020-02-20T03:30:18Z", "author": {"login": "rolfyone"}, "timelineItems": {"totalCount": 15, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcF9jHUAH2gAyMzc3NDQxMDQ5OmViYmNjMzI4NWJjNzgzOGUwMjM2MzNiZmEzODllODg1OGQ5ZmE3MGU=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcGCQTrgH2gAyMzc3NDQxMDQ5Ojc4NmJjMzU1ZDE4NzY4YWYzMGFmOWZhMGQ5Y2M0NDU4ODc5MmRhYzA=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "ebbcc3285bc7838e023633bfa389e8858d9fa70e", "author": {"user": {"login": "rolfyone", "name": "Paul Harris"}}, "url": "https://github.com/ConsenSys/teku/commit/ebbcc3285bc7838e023633bfa389e8858d9fa70e", "committedDate": "2020-02-19T21:38:16Z", "message": "create the jsonProvider as a Jackson object to ensure we're using the same mapper for the api results as for openApi.\n\nFixes:#1190\nSigned-off-by: Paul Harris <paul.harris@consensys.net>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "fad255793756d3ff6a87d81131b175268ee285cd", "author": {"user": {"login": "rolfyone", "name": "Paul Harris"}}, "url": "https://github.com/ConsenSys/teku/commit/fad255793756d3ff6a87d81131b175268ee285cd", "committedDate": "2020-02-19T22:21:57Z", "message": "Merge remote-tracking branch 'upstream/master' into jacksonProvider"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b8280c3e7ad80f64b0f5e3cab702b2a054d47ae0", "author": {"user": {"login": "rolfyone", "name": "Paul Harris"}}, "url": "https://github.com/ConsenSys/teku/commit/b8280c3e7ad80f64b0f5e3cab702b2a054d47ae0", "committedDate": "2020-02-19T23:15:54Z", "message": "fixes\n\nSigned-off-by: Paul Harris <paul.harris@consensys.net>"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzYxNTA5NTEx", "url": "https://github.com/ConsenSys/teku/pull/1202#pullrequestreview-361509511", "createdAt": "2020-02-19T23:16:50Z", "commit": {"oid": "fad255793756d3ff6a87d81131b175268ee285cd"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e40d2be171f621e77c8032378ac4757150165363", "author": {"user": {"login": "rolfyone", "name": "Paul Harris"}}, "url": "https://github.com/ConsenSys/teku/commit/e40d2be171f621e77c8032378ac4757150165363", "committedDate": "2020-02-19T23:59:51Z", "message": "Merge remote-tracking branch 'upstream/master' into jacksonProvider"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "120f1cfa1ccb3a97e37a8595a94390eda6d9a9ec", "author": {"user": {"login": "rolfyone", "name": "Paul Harris"}}, "url": "https://github.com/ConsenSys/teku/commit/120f1cfa1ccb3a97e37a8595a94390eda6d9a9ec", "committedDate": "2020-02-20T00:02:57Z", "message": "Merge remote-tracking branch 'upstream/master' into jacksonProvider\n\nSigned-off-by: Paul Harris <paul.harris@consensys.net>\n\n# Conflicts:\n#\tdata/beaconrestapi/src/main/java/tech/pegasys/artemis/beaconrestapi/BeaconRestApi.java"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzYxNTI1Nzcy", "url": "https://github.com/ConsenSys/teku/pull/1202#pullrequestreview-361525772", "createdAt": "2020-02-19T23:59:16Z", "commit": {"oid": "b8280c3e7ad80f64b0f5e3cab702b2a054d47ae0"}, "state": "COMMENTED", "comments": {"totalCount": 9, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xOVQyMzo1OToxNlrOFr8Cdg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yMFQwMDowODoyN1rOFr8NGw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MTYxNjc1OA==", "bodyText": "sounds bad", "url": "https://github.com/ConsenSys/teku/pull/1202#discussion_r381616758", "createdAt": "2020-02-19T23:59:16Z", "author": {"login": "macfarla"}, "path": "data/beaconrestapi/src/main/java/tech/pegasys/artemis/beaconrestapi/BeaconRestApi.java", "diffHunk": "@@ -59,9 +61,11 @@ public BeaconRestApi(\n         requestedPortNumber,\n         Javalin.create(\n             config -> {\n-              config.registerPlugin(new OpenApiPlugin(getOpenApiOptions()));\n+              config.registerPlugin(new OpenApiPlugin(getOpenApiOptions(new JsonProvider())));\n               config.defaultContentType = \"application/json\";\n             }));\n+    // TODO because of the static function in getOpenAiOptions, had to pass a new jsonProvider here,\n+    // which means we have 2 instances of the JsonProvider, not 1.", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b8280c3e7ad80f64b0f5e3cab702b2a054d47ae0"}, "originalPosition": 25}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MTYxNjg0Mw==", "bodyText": "stray comment", "url": "https://github.com/ConsenSys/teku/pull/1202#discussion_r381616843", "createdAt": "2020-02-19T23:59:38Z", "author": {"login": "macfarla"}, "path": "data/beaconrestapi/src/main/java/tech/pegasys/artemis/beaconrestapi/BeaconRestApi.java", "diffHunk": "@@ -112,6 +119,8 @@ private static OpenApiOptions getOpenApiOptions() {\n                     .url(\"https://www.apache.org/licenses/LICENSE-2.0.html\"));\n     OpenApiOptions options =\n         new OpenApiOptions(applicationInfo)\n+            //            .jacksonMapper(factory.getObjectMapper())", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b8280c3e7ad80f64b0f5e3cab702b2a054d47ae0"}, "originalPosition": 56}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MTYxODcyMw==", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n              public void UnsignedLongShouldSerializeToJson() throws JsonProcessingException {\n          \n          \n            \n              public void unsignedLongShouldSerializeToJson() throws JsonProcessingException {", "url": "https://github.com/ConsenSys/teku/pull/1202#discussion_r381618723", "createdAt": "2020-02-20T00:05:52Z", "author": {"login": "macfarla"}, "path": "data/provider/src/test/java/tech/pegasys/artemis/provider/JsonProviderTest.java", "diffHunk": "@@ -13,19 +13,60 @@\n \n package tech.pegasys.artemis.provider;\n \n+import static org.junit.jupiter.api.Assertions.assertEquals;\n import static org.junit.jupiter.api.Assertions.assertTrue;\n \n+import com.fasterxml.jackson.core.JsonProcessingException;\n import com.google.common.primitives.UnsignedLong;\n+import java.util.List;\n+import org.apache.tuweni.bytes.Bytes32;\n import org.junit.jupiter.api.Test;\n import tech.pegasys.artemis.datastructures.state.BeaconState;\n import tech.pegasys.artemis.datastructures.util.DataStructureUtil;\n+import tech.pegasys.artemis.util.SSZTypes.SSZVector;\n \n class JsonProviderTest {\n+  JsonProvider jsonProvider = new JsonProvider();\n+  private static final String Q = \"\\\"\";\n \n   @Test\n-  void beaconStateJsonTest() {\n+  public void bytes32ShouldSerializeToJsonAndBack() throws JsonProcessingException {\n+    Bytes32 data = Bytes32.random();\n+    String serialized = jsonProvider.objectToJSON(data);\n+    assertEquals(Q + data.toHexString().toLowerCase() + Q, serialized);\n+\n+    Bytes32 deserialize = jsonProvider.jsonToObject(serialized, Bytes32.class);\n+    assertEquals(data, deserialize);\n+  }\n+\n+  @Test\n+  public void UnsignedLongShouldSerializeToJson() throws JsonProcessingException {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "120f1cfa1ccb3a97e37a8595a94390eda6d9a9ec"}, "originalPosition": 32}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MTYxODc2NA==", "bodyText": "why is this called Q", "url": "https://github.com/ConsenSys/teku/pull/1202#discussion_r381618764", "createdAt": "2020-02-20T00:06:00Z", "author": {"login": "macfarla"}, "path": "data/provider/src/test/java/tech/pegasys/artemis/provider/JsonProviderTest.java", "diffHunk": "@@ -13,19 +13,60 @@\n \n package tech.pegasys.artemis.provider;\n \n+import static org.junit.jupiter.api.Assertions.assertEquals;\n import static org.junit.jupiter.api.Assertions.assertTrue;\n \n+import com.fasterxml.jackson.core.JsonProcessingException;\n import com.google.common.primitives.UnsignedLong;\n+import java.util.List;\n+import org.apache.tuweni.bytes.Bytes32;\n import org.junit.jupiter.api.Test;\n import tech.pegasys.artemis.datastructures.state.BeaconState;\n import tech.pegasys.artemis.datastructures.util.DataStructureUtil;\n+import tech.pegasys.artemis.util.SSZTypes.SSZVector;\n \n class JsonProviderTest {\n+  JsonProvider jsonProvider = new JsonProvider();\n+  private static final String Q = \"\\\"\";", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "120f1cfa1ccb3a97e37a8595a94390eda6d9a9ec"}, "originalPosition": 18}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MTYxODc5NA==", "bodyText": "private final", "url": "https://github.com/ConsenSys/teku/pull/1202#discussion_r381618794", "createdAt": "2020-02-20T00:06:06Z", "author": {"login": "macfarla"}, "path": "data/provider/src/test/java/tech/pegasys/artemis/provider/JsonProviderTest.java", "diffHunk": "@@ -13,19 +13,60 @@\n \n package tech.pegasys.artemis.provider;\n \n+import static org.junit.jupiter.api.Assertions.assertEquals;\n import static org.junit.jupiter.api.Assertions.assertTrue;\n \n+import com.fasterxml.jackson.core.JsonProcessingException;\n import com.google.common.primitives.UnsignedLong;\n+import java.util.List;\n+import org.apache.tuweni.bytes.Bytes32;\n import org.junit.jupiter.api.Test;\n import tech.pegasys.artemis.datastructures.state.BeaconState;\n import tech.pegasys.artemis.datastructures.util.DataStructureUtil;\n+import tech.pegasys.artemis.util.SSZTypes.SSZVector;\n \n class JsonProviderTest {\n+  JsonProvider jsonProvider = new JsonProvider();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "120f1cfa1ccb3a97e37a8595a94390eda6d9a9ec"}, "originalPosition": 17}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MTYxODk3Mg==", "bodyText": "prob can remove empty lines they aren't doing much", "url": "https://github.com/ConsenSys/teku/pull/1202#discussion_r381618972", "createdAt": "2020-02-20T00:06:45Z", "author": {"login": "macfarla"}, "path": "data/provider/src/test/java/tech/pegasys/artemis/provider/JsonProviderTest.java", "diffHunk": "@@ -13,19 +13,60 @@\n \n package tech.pegasys.artemis.provider;\n \n+import static org.junit.jupiter.api.Assertions.assertEquals;\n import static org.junit.jupiter.api.Assertions.assertTrue;\n \n+import com.fasterxml.jackson.core.JsonProcessingException;\n import com.google.common.primitives.UnsignedLong;\n+import java.util.List;\n+import org.apache.tuweni.bytes.Bytes32;\n import org.junit.jupiter.api.Test;\n import tech.pegasys.artemis.datastructures.state.BeaconState;\n import tech.pegasys.artemis.datastructures.util.DataStructureUtil;\n+import tech.pegasys.artemis.util.SSZTypes.SSZVector;\n \n class JsonProviderTest {\n+  JsonProvider jsonProvider = new JsonProvider();\n+  private static final String Q = \"\\\"\";\n \n   @Test\n-  void beaconStateJsonTest() {\n+  public void bytes32ShouldSerializeToJsonAndBack() throws JsonProcessingException {\n+    Bytes32 data = Bytes32.random();\n+    String serialized = jsonProvider.objectToJSON(data);\n+    assertEquals(Q + data.toHexString().toLowerCase() + Q, serialized);\n+\n+    Bytes32 deserialize = jsonProvider.jsonToObject(serialized, Bytes32.class);\n+    assertEquals(data, deserialize);\n+  }\n+\n+  @Test\n+  public void UnsignedLongShouldSerializeToJson() throws JsonProcessingException {\n+    UnsignedLong data = DataStructureUtil.randomUnsignedLong(1111);\n+\n+    String serialized = jsonProvider.objectToJSON(data);\n+    assertEquals(serialized, data.toString());\n+  }\n+\n+  @Test\n+  public void vectorShouldSerializeToJson() throws JsonProcessingException {\n+    SSZVector<String> data = new SSZVector<String>(List.of(\"One\", \"Two\"), String.class);\n+    String serialized = jsonProvider.objectToJSON(data);\n+    assertEquals(serialized, \"[\" + Q + \"One\" + Q + \",\" + Q + \"Two\" + Q + \"]\");\n+  }\n+\n+  @Test\n+  public void stringShouldSerializeToJson() throws JsonProcessingException {\n+    JsonProvider provider = new JsonProvider();\n+", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "120f1cfa1ccb3a97e37a8595a94390eda6d9a9ec"}, "originalPosition": 49}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MTYxOTAxNQ==", "bodyText": "prob can remove empty lines they aren't doing much", "url": "https://github.com/ConsenSys/teku/pull/1202#discussion_r381619015", "createdAt": "2020-02-20T00:06:53Z", "author": {"login": "macfarla"}, "path": "data/provider/src/test/java/tech/pegasys/artemis/provider/JsonProviderTest.java", "diffHunk": "@@ -13,19 +13,60 @@\n \n package tech.pegasys.artemis.provider;\n \n+import static org.junit.jupiter.api.Assertions.assertEquals;\n import static org.junit.jupiter.api.Assertions.assertTrue;\n \n+import com.fasterxml.jackson.core.JsonProcessingException;\n import com.google.common.primitives.UnsignedLong;\n+import java.util.List;\n+import org.apache.tuweni.bytes.Bytes32;\n import org.junit.jupiter.api.Test;\n import tech.pegasys.artemis.datastructures.state.BeaconState;\n import tech.pegasys.artemis.datastructures.util.DataStructureUtil;\n+import tech.pegasys.artemis.util.SSZTypes.SSZVector;\n \n class JsonProviderTest {\n+  JsonProvider jsonProvider = new JsonProvider();\n+  private static final String Q = \"\\\"\";\n \n   @Test\n-  void beaconStateJsonTest() {\n+  public void bytes32ShouldSerializeToJsonAndBack() throws JsonProcessingException {\n+    Bytes32 data = Bytes32.random();\n+    String serialized = jsonProvider.objectToJSON(data);\n+    assertEquals(Q + data.toHexString().toLowerCase() + Q, serialized);\n+\n+    Bytes32 deserialize = jsonProvider.jsonToObject(serialized, Bytes32.class);\n+    assertEquals(data, deserialize);\n+  }\n+\n+  @Test\n+  public void UnsignedLongShouldSerializeToJson() throws JsonProcessingException {\n+    UnsignedLong data = DataStructureUtil.randomUnsignedLong(1111);\n+\n+    String serialized = jsonProvider.objectToJSON(data);\n+    assertEquals(serialized, data.toString());\n+  }\n+\n+  @Test\n+  public void vectorShouldSerializeToJson() throws JsonProcessingException {\n+    SSZVector<String> data = new SSZVector<String>(List.of(\"One\", \"Two\"), String.class);\n+    String serialized = jsonProvider.objectToJSON(data);\n+    assertEquals(serialized, \"[\" + Q + \"One\" + Q + \",\" + Q + \"Two\" + Q + \"]\");\n+  }\n+\n+  @Test\n+  public void stringShouldSerializeToJson() throws JsonProcessingException {\n+    JsonProvider provider = new JsonProvider();\n+\n+    String data = \"test\";\n+", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "120f1cfa1ccb3a97e37a8595a94390eda6d9a9ec"}, "originalPosition": 51}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MTYxOTM5Mw==", "bodyText": "private final", "url": "https://github.com/ConsenSys/teku/pull/1202#discussion_r381619393", "createdAt": "2020-02-20T00:08:11Z", "author": {"login": "macfarla"}, "path": "data/beaconrestapi/src/test/java/tech/pegasys/artemis/beaconrestapi/beaconhandlers/BeaconChainHeadHandlerTest.java", "diffHunk": "@@ -29,6 +29,7 @@\n import tech.pegasys.artemis.storage.ChainStorageClient;\n \n public class BeaconChainHeadHandlerTest {\n+  JsonProvider jsonProvider = new JsonProvider();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "120f1cfa1ccb3a97e37a8595a94390eda6d9a9ec"}, "originalPosition": 4}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MTYxOTQ4Mw==", "bodyText": "private final", "url": "https://github.com/ConsenSys/teku/pull/1202#discussion_r381619483", "createdAt": "2020-02-20T00:08:27Z", "author": {"login": "macfarla"}, "path": "data/beaconrestapi/src/main/java/tech/pegasys/artemis/beaconrestapi/beaconhandlers/VersionHandler.java", "diffHunk": "@@ -25,7 +25,12 @@\n \n public class VersionHandler implements Handler {\n \n+  public VersionHandler(JsonProvider jsonProvider) {\n+    this.jsonProvider = jsonProvider;\n+  }\n+\n   public static final String ROUTE = \"/node/version/\";\n+  JsonProvider jsonProvider;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "120f1cfa1ccb3a97e37a8595a94390eda6d9a9ec"}, "originalPosition": 9}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b525f7c9b6294e27a151e0144dec8f52ddbdbb43", "author": {"user": {"login": "rolfyone", "name": "Paul Harris"}}, "url": "https://github.com/ConsenSys/teku/commit/b525f7c9b6294e27a151e0144dec8f52ddbdbb43", "committedDate": "2020-02-20T00:14:44Z", "message": "Update data/provider/src/test/java/tech/pegasys/artemis/provider/JsonProviderTest.java\n\nCo-Authored-By: Sally MacFarlane <sally.macfarlane@consensys.net>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a2dc3ff74b9a33249cf70342d3b71551ec8d7113", "author": {"user": {"login": "rolfyone", "name": "Paul Harris"}}, "url": "https://github.com/ConsenSys/teku/commit/a2dc3ff74b9a33249cf70342d3b71551ec8d7113", "committedDate": "2020-02-20T00:33:14Z", "message": "changes per review comments.\n\nSigned-off-by: Paul Harris <paul.harris@consensys.net>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "063595153f8f803b5f529502f3f21886b4c1659c", "author": {"user": {"login": "rolfyone", "name": "Paul Harris"}}, "url": "https://github.com/ConsenSys/teku/commit/063595153f8f803b5f529502f3f21886b4c1659c", "committedDate": "2020-02-20T00:33:32Z", "message": "Merge remote-tracking branch 'origin/jacksonProvider' into jacksonProvider"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "0890396d9b24c8627f3a67b6d0907d257a4d6140", "author": {"user": {"login": "rolfyone", "name": "Paul Harris"}}, "url": "https://github.com/ConsenSys/teku/commit/0890396d9b24c8627f3a67b6d0907d257a4d6140", "committedDate": "2020-02-20T01:38:13Z", "message": "Merge remote-tracking branch 'upstream/master' into jacksonProvider"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "48bc579dcd9cbd91b9f47bcb6b6e6c799c5e90fa", "author": {"user": {"login": "rolfyone", "name": "Paul Harris"}}, "url": "https://github.com/ConsenSys/teku/commit/48bc579dcd9cbd91b9f47bcb6b6e6c799c5e90fa", "committedDate": "2020-02-20T02:31:25Z", "message": "acceptance test object needs jackson annotations\n\nSigned-off-by: Paul Harris <paul.harris@consensys.net>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "9451d96be0ce9357f556ba3f78f59414e463c971", "author": {"user": {"login": "rolfyone", "name": "Paul Harris"}}, "url": "https://github.com/ConsenSys/teku/commit/9451d96be0ce9357f556ba3f78f59414e463c971", "committedDate": "2020-02-20T03:02:20Z", "message": "acceptance test object needs jackson annotations\n\nSigned-off-by: Paul Harris <paul.harris@consensys.net>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "9bc6bf43d37ea1140ea2e829081deca09de5ec6b", "author": {"user": {"login": "rolfyone", "name": "Paul Harris"}}, "url": "https://github.com/ConsenSys/teku/commit/9bc6bf43d37ea1140ea2e829081deca09de5ec6b", "committedDate": "2020-02-20T03:06:44Z", "message": "spotless\n\nSigned-off-by: Paul Harris <paul.harris@consensys.net>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "786bc355d18768af30af9fa0d9cc44588792dac0", "author": {"user": {"login": "rolfyone", "name": "Paul Harris"}}, "url": "https://github.com/ConsenSys/teku/commit/786bc355d18768af30af9fa0d9cc44588792dac0", "committedDate": "2020-02-20T03:07:15Z", "message": "Merge remote-tracking branch 'upstream/master' into jacksonProvider"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4072, "cost": 1, "resetAt": "2021-11-01T13:51:04Z"}}}