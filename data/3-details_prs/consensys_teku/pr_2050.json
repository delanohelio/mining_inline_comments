{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDI3NDMzODk0", "number": 2050, "title": "Fix deposit inclusion bug", "bodyText": "PR Description\nTurns out that if our own block's Eth1Data is the last vote necessary to update state eth1 data, we have to foresee this during block production and put deposits into blocks accordingly.\nFixed Issue(s)\nIs another fix for #2014", "createdAt": "2020-06-03T20:24:40Z", "url": "https://github.com/ConsenSys/teku/pull/2050", "merged": true, "mergeCommit": {"oid": "58a325242cbb697fafffb74cd87bfd5fdf68b2da"}, "closed": true, "closedAt": "2020-06-04T16:10:02Z", "author": {"login": "cemozerr"}, "timelineItems": {"totalCount": 5, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcnvTvrAH2gAyNDI3NDMzODk0OmZiYmM5M2EzN2FiYWZjYmRkODI4YTcwMWNjYWUxYmFmNzdmMjQyNmU=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcoAGUIgH2gAyNDI3NDMzODk0OjZlZGQ4NDU0Y2Q0OTVjMjZhNzViZjUxZWRlZTI1ZWQ5OThkZjdkZTg=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "fbbc93a37abafcbdd828a701ccae1baf77f2426e", "author": {"user": {"login": "cemozerr", "name": "Cem Ozer"}}, "url": "https://github.com/ConsenSys/teku/commit/fbbc93a37abafcbdd828a701ccae1baf77f2426e", "committedDate": "2020-06-03T20:16:14Z", "message": "Account for own block eth1data updating deposit count"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a4b882bbf1c1e7214f8492935d35989cb1a7607c", "author": {"user": {"login": "cemozerr", "name": "Cem Ozer"}}, "url": "https://github.com/ConsenSys/teku/commit/a4b882bbf1c1e7214f8492935d35989cb1a7607c", "committedDate": "2020-06-03T20:16:14Z", "message": "Run spotless & fix implicit casting"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b9f833580af63def6a2de914c882e325f0337c59", "author": {"user": {"login": "cemozerr", "name": "Cem Ozer"}}, "url": "https://github.com/ConsenSys/teku/commit/b9f833580af63def6a2de914c882e325f0337c59", "committedDate": "2020-06-03T20:22:33Z", "message": "Fix new tests"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDIzOTk0MjEx", "url": "https://github.com/ConsenSys/teku/pull/2050#pullrequestreview-423994211", "createdAt": "2020-06-03T23:00:31Z", "commit": {"oid": "b9f833580af63def6a2de914c882e325f0337c59"}, "state": "APPROVED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wM1QyMzowMDozMVrOGewZWw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wM1QyMzowMDozMVrOGewZWw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNDkwMzM4Nw==", "bodyText": "nit: shouldn't need to move this assignment to setUp (field can be non-final with an assignment if needed).", "url": "https://github.com/ConsenSys/teku/pull/2050#discussion_r434903387", "createdAt": "2020-06-03T23:00:31Z", "author": {"login": "ajsutton"}, "path": "validator/coordinator/src/test/java/tech/pegasys/teku/validator/coordinator/DepositProviderTest.java", "diffHunk": "@@ -41,23 +41,27 @@\n import tech.pegasys.teku.datastructures.util.OptimizedMerkleTree;\n import tech.pegasys.teku.pow.event.DepositsFromBlockEvent;\n import tech.pegasys.teku.ssz.SSZTypes.SSZList;\n+import tech.pegasys.teku.ssz.SSZTypes.SSZMutableList;\n import tech.pegasys.teku.storage.client.RecentChainData;\n import tech.pegasys.teku.util.config.Constants;\n \n public class DepositProviderTest {\n \n   private final DataStructureUtil dataStructureUtil = new DataStructureUtil();\n   private final RecentChainData recentChainData = mock(RecentChainData.class);\n-  private final BeaconState beaconState = mock(BeaconState.class);\n+  private final BeaconState state = mock(BeaconState.class);\n   private final Eth1DataCache eth1DataCache = mock(Eth1DataCache.class);\n-  private final MerkleTree depositMerkleTree =\n-      new OptimizedMerkleTree(Constants.DEPOSIT_CONTRACT_TREE_DEPTH);\n   private List<tech.pegasys.teku.pow.event.Deposit> allSeenDepositsList;\n   private final DepositProvider depositProvider =\n       new DepositProvider(recentChainData, eth1DataCache);\n+  private final Eth1Data randomEth1Data = dataStructureUtil.randomEth1Data();\n+\n+  private MerkleTree depositMerkleTree;\n \n   @BeforeEach\n   void setUp() {\n+    depositMerkleTree = new OptimizedMerkleTree(Constants.DEPOSIT_CONTRACT_TREE_DEPTH);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b9f833580af63def6a2de914c882e325f0337c59"}, "originalPosition": 26}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "6edd8454cd495c26a75bf51edee25ed998df7de8", "author": {"user": {"login": "cemozerr", "name": "Cem Ozer"}}, "url": "https://github.com/ConsenSys/teku/commit/6edd8454cd495c26a75bf51edee25ed998df7de8", "committedDate": "2020-06-04T15:49:57Z", "message": "Merge branch 'master' into fixDepositInclusionError"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4091, "cost": 1, "resetAt": "2021-11-01T13:51:04Z"}}}