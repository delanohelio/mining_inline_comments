{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDA2NDUyMTIw", "number": 1630, "reviewThreads": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yMVQxNToxODo1NVrOD0TX3w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yMVQxNToyOToyNFrOD0TuFQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjU2MTY5OTUxOnYy", "diffSide": "RIGHT", "path": "ethereum/statetransition/src/main/java/tech/pegasys/artemis/statetransition/genesis/GenesisHandler.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yMVQxNToxODo1NVrOGJLfUw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yMVQxNToxODo1NVrOGJLfUw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMjI3ODYxMQ==", "bodyText": "nice.", "url": "https://github.com/ConsenSys/teku/pull/1630#discussion_r412278611", "createdAt": "2020-04-21T15:18:55Z", "author": {"login": "cemozerr"}, "path": "ethereum/statetransition/src/main/java/tech/pegasys/artemis/statetransition/genesis/GenesisHandler.java", "diffHunk": "@@ -54,16 +56,31 @@ public void onDepositsFromBlock(final DepositsFromBlockEvent event) {\n \n   @Override\n   public void onMinGenesisTimeBlock(MinGenesisTimeBlockEvent event) {\n+    if (!recentChainData.isPreGenesis()) {\n+      return;\n+    }\n+    STATUS_LOG.minGenesisTimeReached();\n     processNewData(event.getBlockHash(), event.getTimestamp(), List.of());\n   }\n \n   private void processNewData(\n       Bytes32 blockHash, UnsignedLong timestamp, List<DepositWithIndex> deposits) {\n+    final int previousValidatorRequirementPercent =\n+        roundPercent(genesisGenerator.getActiveValidatorCount());\n     genesisGenerator.updateCandidateState(blockHash, timestamp, deposits);\n \n-    genesisGenerator\n-        .getGenesisStateIfValid(BeaconStateUtil::is_valid_genesis_state)\n-        .ifPresent(this::eth2Genesis);\n+    final int newActiveValidatorCount = genesisGenerator.getActiveValidatorCount();\n+    if (BeaconStateUtil.is_valid_genesis_state(\n+        genesisGenerator.getGenesisTime(), newActiveValidatorCount)) {\n+      eth2Genesis(genesisGenerator.getGenesisState());\n+    } else if (roundPercent(newActiveValidatorCount) > previousValidatorRequirementPercent) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "a067af24ce420e4cbe30dec048d3838f29cdf2b7"}, "originalPosition": 40}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjU2MTc1NjM3OnYy", "diffSide": "RIGHT", "path": "logging/src/main/java/tech/pegasys/teku/logging/StatusLogger.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yMVQxNToyOToyNFrOGJMBhg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yMVQyMDozMzo0OFrOGJXS7w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMjI4NzM2Ng==", "bodyText": "What's is the reasoning behind getting all the status logs in one place? It seems similar to having all constants in one file, which we seem to not want to be doing going forward.", "url": "https://github.com/ConsenSys/teku/pull/1630#discussion_r412287366", "createdAt": "2020-04-21T15:29:24Z", "author": {"login": "cemozerr"}, "path": "logging/src/main/java/tech/pegasys/teku/logging/StatusLogger.java", "diffHunk": "@@ -60,10 +61,37 @@ public void validatorDepositEncryptedKeystoreWriterFailure(\n   }\n \n   public void beginInitializingChainData() {\n-    log.info(\"Begin initializing chain data from storage\");\n+    log.info(\"Initializing storage\");\n   }\n \n   public void finishInitializingChainData() {\n-    log.info(\"Finish initializing chain data from storage\");\n+    log.info(\"Storage initialization complete\");\n+  }\n+\n+  public void generatingMockStartGenesis(final long genesisTime, final int size) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "a067af24ce420e4cbe30dec048d3838f29cdf2b7"}, "originalPosition": 21}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMjQ3MjA0Nw==", "bodyText": "It wasn't my idea.  At the moment it's a pretty small set so I can live with it but I'm not a huge fan of the approach.", "url": "https://github.com/ConsenSys/teku/pull/1630#discussion_r412472047", "createdAt": "2020-04-21T20:33:48Z", "author": {"login": "ajsutton"}, "path": "logging/src/main/java/tech/pegasys/teku/logging/StatusLogger.java", "diffHunk": "@@ -60,10 +61,37 @@ public void validatorDepositEncryptedKeystoreWriterFailure(\n   }\n \n   public void beginInitializingChainData() {\n-    log.info(\"Begin initializing chain data from storage\");\n+    log.info(\"Initializing storage\");\n   }\n \n   public void finishInitializingChainData() {\n-    log.info(\"Finish initializing chain data from storage\");\n+    log.info(\"Storage initialization complete\");\n+  }\n+\n+  public void generatingMockStartGenesis(final long genesisTime, final int size) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMjI4NzM2Ng=="}, "originalCommit": {"oid": "a067af24ce420e4cbe30dec048d3838f29cdf2b7"}, "originalPosition": 21}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1689, "cost": 1, "resetAt": "2021-11-12T19:05:54Z"}}}