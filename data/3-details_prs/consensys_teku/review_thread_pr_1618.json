{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDA1NzE3Njk4", "number": 1618, "reviewThreads": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yMFQwMDo0NjoxMFrODzf61A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yM1QwMDoxMzozMVrOD1B0yg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjU1MzI2OTMyOnYy", "diffSide": "RIGHT", "path": "artemis/src/main/java/tech/pegasys/artemis/cli/deposit/EncryptedKeystoreWriter.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yMFQwMDo0NjoxMFrOGH_S-Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yMFQwMDo0NjoxMFrOGH_S-Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMTAzMDI2NQ==", "bodyText": "Given that not using the full public key opens up the possibility of overwriting an existing key with a different value, we should add a check in saveKeyStore so that it fails if the file already exists.  The chance of such a conflict is extremely low but given it results in a loss of funds we want to completely eliminate any risk of it.\nGiven how rare the overlap is, just aborting before we send the deposit would be fine.", "url": "https://github.com/ConsenSys/teku/pull/1618#discussion_r411030265", "createdAt": "2020-04-20T00:46:10Z", "author": {"login": "ajsutton"}, "path": "artemis/src/main/java/tech/pegasys/artemis/cli/deposit/EncryptedKeystoreWriter.java", "diffHunk": "@@ -56,18 +56,13 @@ public void writeKeys(final BLSKeyPair validatorKey, final BLSKeyPair withdrawal\n     final KeyStoreData withdrawalKeyStoreData =\n         generateKeystoreData(withdrawalKey, withdrawalKeyPassword);\n \n-    saveKeyStore(\n-        keystoreDirectory.resolve(\"validator_\" + validatorKey.getPublicKey().toString() + \".json\"),\n-        validatorKeyStoreData);\n-    saveKeyStore(\n-        keystoreDirectory.resolve(\n-            \"withdrawal_\" + withdrawalKey.getPublicKey().toString() + \".json\"),\n-        withdrawalKeyStoreData);\n+    saveKeyStore(keystoreDirectory.resolve(\"validator.json\"), validatorKeyStoreData);\n+    saveKeyStore(keystoreDirectory.resolve(\"withdrawal.json\"), withdrawalKeyStoreData);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "03b32062fc046834dd39d3b229c98dc06d0f76f1"}, "originalPosition": 12}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjU1MzMzNjk1OnYy", "diffSide": "RIGHT", "path": "artemis/src/main/java/tech/pegasys/artemis/cli/deposit/EncryptedKeystoreWriter.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yMFQwMToyNjowM1rOGH_0FQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yMFQwMToyNjowM1rOGH_0FQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMTAzODc0MQ==", "bodyText": "instead of directly using substring, may I suggest to introduce a method something on the lines of :\nString trimPublicKey(final String publicKey) {\n  if (publicKey.toLowerCase().startsWith(\"0x\")) {\n    return publicKey.substring(2,9); \n  } \n  return publicKey.substring(0, 7);\n}\n\nas the public key technically can start without \"0x\"", "url": "https://github.com/ConsenSys/teku/pull/1618#discussion_r411038741", "createdAt": "2020-04-20T01:26:03Z", "author": {"login": "usmansaleem"}, "path": "artemis/src/main/java/tech/pegasys/artemis/cli/deposit/EncryptedKeystoreWriter.java", "diffHunk": "@@ -56,18 +56,13 @@ public void writeKeys(final BLSKeyPair validatorKey, final BLSKeyPair withdrawal\n     final KeyStoreData withdrawalKeyStoreData =\n         generateKeystoreData(withdrawalKey, withdrawalKeyPassword);\n \n-    saveKeyStore(\n-        keystoreDirectory.resolve(\"validator_\" + validatorKey.getPublicKey().toString() + \".json\"),\n-        validatorKeyStoreData);\n-    saveKeyStore(\n-        keystoreDirectory.resolve(\n-            \"withdrawal_\" + withdrawalKey.getPublicKey().toString() + \".json\"),\n-        withdrawalKeyStoreData);\n+    saveKeyStore(keystoreDirectory.resolve(\"validator.json\"), validatorKeyStoreData);\n+    saveKeyStore(keystoreDirectory.resolve(\"withdrawal.json\"), withdrawalKeyStoreData);\n   }\n \n   private Path createKeystoreDirectory(final BLSKeyPair validatorKey) {\n     final Path keystoreDirectory =\n-        outputPath.resolve(\"validator_\" + validatorKey.getPublicKey().toString());\n+        outputPath.resolve(\"validator_\" + validatorKey.getPublicKey().toString().substring(2, 9));", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "03b32062fc046834dd39d3b229c98dc06d0f76f1"}, "originalPosition": 18}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjU2OTMxMDE4OnYy", "diffSide": "RIGHT", "path": "artemis/src/main/java/tech/pegasys/artemis/cli/deposit/EncryptedKeystoreWriter.java", "isResolved": true, "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yM1QwMDoxMzozMVrOGKRCRw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yNVQyMjoxMToxN1rOGL7DBA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMzQxODA1NQ==", "bodyText": "Why did these change to using abbreviations instead of the full validator and withdrawal prefix?", "url": "https://github.com/ConsenSys/teku/pull/1618#discussion_r413418055", "createdAt": "2020-04-23T00:13:31Z", "author": {"login": "ajsutton"}, "path": "artemis/src/main/java/tech/pegasys/artemis/cli/deposit/EncryptedKeystoreWriter.java", "diffHunk": "@@ -56,18 +56,18 @@ public void writeKeys(final BLSKeyPair validatorKey, final BLSKeyPair withdrawal\n     final KeyStoreData withdrawalKeyStoreData =\n         generateKeystoreData(withdrawalKey, withdrawalKeyPassword);\n \n-    saveKeyStore(\n-        keystoreDirectory.resolve(\"validator_\" + validatorKey.getPublicKey().toString() + \".json\"),\n-        validatorKeyStoreData);\n-    saveKeyStore(\n-        keystoreDirectory.resolve(\n-            \"withdrawal_\" + withdrawalKey.getPublicKey().toString() + \".json\"),\n-        withdrawalKeyStoreData);\n+    final String validatorFileName =\n+        \"val_\" + trimPublicKey(validatorKey.getPublicKey().toString()) + \".json\";\n+    final String withdrawalFileName =\n+        \"wdr_\" + trimPublicKey(withdrawalKey.getPublicKey().toString()) + \".json\";", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "9061ed04a42ec371cc6d56e44bc7bdf8f15d10d8"}, "originalPosition": 14}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNDQzOTI3NQ==", "bodyText": "I tried to keep it short, shall I restore the full prefix?", "url": "https://github.com/ConsenSys/teku/pull/1618#discussion_r414439275", "createdAt": "2020-04-24T09:39:41Z", "author": {"login": "q9f"}, "path": "artemis/src/main/java/tech/pegasys/artemis/cli/deposit/EncryptedKeystoreWriter.java", "diffHunk": "@@ -56,18 +56,18 @@ public void writeKeys(final BLSKeyPair validatorKey, final BLSKeyPair withdrawal\n     final KeyStoreData withdrawalKeyStoreData =\n         generateKeystoreData(withdrawalKey, withdrawalKeyPassword);\n \n-    saveKeyStore(\n-        keystoreDirectory.resolve(\"validator_\" + validatorKey.getPublicKey().toString() + \".json\"),\n-        validatorKeyStoreData);\n-    saveKeyStore(\n-        keystoreDirectory.resolve(\n-            \"withdrawal_\" + withdrawalKey.getPublicKey().toString() + \".json\"),\n-        withdrawalKeyStoreData);\n+    final String validatorFileName =\n+        \"val_\" + trimPublicKey(validatorKey.getPublicKey().toString()) + \".json\";\n+    final String withdrawalFileName =\n+        \"wdr_\" + trimPublicKey(withdrawalKey.getPublicKey().toString()) + \".json\";", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMzQxODA1NQ=="}, "originalCommit": {"oid": "9061ed04a42ec371cc6d56e44bc7bdf8f15d10d8"}, "originalPosition": 14}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNTE1NDk0OA==", "bodyText": "Yeah unless there's some technical advantage to it being short I'd stick with the full prefix so it's easier for users to understand.", "url": "https://github.com/ConsenSys/teku/pull/1618#discussion_r415154948", "createdAt": "2020-04-25T22:11:17Z", "author": {"login": "ajsutton"}, "path": "artemis/src/main/java/tech/pegasys/artemis/cli/deposit/EncryptedKeystoreWriter.java", "diffHunk": "@@ -56,18 +56,18 @@ public void writeKeys(final BLSKeyPair validatorKey, final BLSKeyPair withdrawal\n     final KeyStoreData withdrawalKeyStoreData =\n         generateKeystoreData(withdrawalKey, withdrawalKeyPassword);\n \n-    saveKeyStore(\n-        keystoreDirectory.resolve(\"validator_\" + validatorKey.getPublicKey().toString() + \".json\"),\n-        validatorKeyStoreData);\n-    saveKeyStore(\n-        keystoreDirectory.resolve(\n-            \"withdrawal_\" + withdrawalKey.getPublicKey().toString() + \".json\"),\n-        withdrawalKeyStoreData);\n+    final String validatorFileName =\n+        \"val_\" + trimPublicKey(validatorKey.getPublicKey().toString()) + \".json\";\n+    final String withdrawalFileName =\n+        \"wdr_\" + trimPublicKey(withdrawalKey.getPublicKey().toString()) + \".json\";", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMzQxODA1NQ=="}, "originalCommit": {"oid": "9061ed04a42ec371cc6d56e44bc7bdf8f15d10d8"}, "originalPosition": 14}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1664, "cost": 1, "resetAt": "2021-11-12T19:05:54Z"}}}