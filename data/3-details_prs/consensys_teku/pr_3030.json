{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTA2OTIxNTEw", "number": 3030, "title": "Fix unhandled exception on stream abort", "bodyText": "PR Description\nFixes the regression introduced in #3001\nA remote party may abruptly close a truncated stream. The Eth2OutgoingRequestHandler.readComplete() generates an error in this case which causes abortRequest() call. RpcResponseDecoder.close() throws unexpected IllegalStateException which is not caught and the responseStream remains uncompleted.\nFixed Issue(s)\nFix #3028\nDocumentation\n\n I thought about documentation and added the documentation label to this PR if updates are required.", "createdAt": "2020-10-20T15:54:21Z", "url": "https://github.com/ConsenSys/teku/pull/3030", "merged": true, "mergeCommit": {"oid": "3775ba50179caf079aa533a2d31f8d876d8da00a"}, "closed": true, "closedAt": "2020-10-20T18:26:35Z", "author": {"login": "Nashatyrev"}, "timelineItems": {"totalCount": 9, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdUamOKAH2gAyNTA2OTIxNTEwOjYwODVkYmI5MGQ1NWMwOGVlMjRjOTZjZDc2ODYwNzk5ODM1ODM4Y2E=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdUcGMvAH2gAyNTA2OTIxNTEwOjk2YjMzZmVmZDYwNGY5NDM3ZmYwNjk3NzZjMzQ1MWRkZjAyYTAyNjQ=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "6085dbb90d55c08ee24c96cd76860799835838ca", "author": {"user": {"login": "Nashatyrev", "name": "Anton Nashatyrev"}}, "url": "https://github.com/ConsenSys/teku/commit/6085dbb90d55c08ee24c96cd76860799835838ca", "committedDate": "2020-10-20T15:35:00Z", "message": "Add a test reproducing the issue"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "616b6d7e80a4c82930003a587c4aa5334c2a7205", "author": {"user": {"login": "Nashatyrev", "name": "Anton Nashatyrev"}}, "url": "https://github.com/ConsenSys/teku/commit/616b6d7e80a4c82930003a587c4aa5334c2a7205", "committedDate": "2020-10-20T15:47:41Z", "message": "Add explicit close() methods to abort decoder and release resources"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "bcc9bdc3d5aba5489524545a3eabfaf10b1feeed", "author": {"user": {"login": "Nashatyrev", "name": "Anton Nashatyrev"}}, "url": "https://github.com/ConsenSys/teku/commit/bcc9bdc3d5aba5489524545a3eabfaf10b1feeed", "committedDate": "2020-10-20T15:48:48Z", "message": "Though the close() method is not expected to throw, use call Future completion in finally block to make 100% sure the critical Future is completed"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "239d715f6ee138aff2735a867592ac2487495f45", "author": {"user": {"login": "Nashatyrev", "name": "Anton Nashatyrev"}}, "url": "https://github.com/ConsenSys/teku/commit/239d715f6ee138aff2735a867592ac2487495f45", "committedDate": "2020-10-20T15:49:59Z", "message": "Spotless apply"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "8eb7ac59e43ad179bc0b30c1cafc825ea9c6c764", "author": {"user": {"login": "Nashatyrev", "name": "Anton Nashatyrev"}}, "url": "https://github.com/ConsenSys/teku/commit/8eb7ac59e43ad179bc0b30c1cafc825ea9c6c764", "committedDate": "2020-10-20T16:01:44Z", "message": "Fix warning."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTEyOTQzNDQ0", "url": "https://github.com/ConsenSys/teku/pull/3030#pullrequestreview-512943444", "createdAt": "2020-10-20T16:54:53Z", "commit": {"oid": "8eb7ac59e43ad179bc0b30c1cafc825ea9c6c764"}, "state": "APPROVED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yMFQxNjo1NjozNFrOHlH_Ng==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yMFQxNjo1NjozNFrOHlH_Ng==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwODY5MDIzMA==", "bodyText": "(nit)\n\n  \n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                    if (broken) throw new CompressionException(\"Compressed stream is broken\");\n          \n          \n            \n                    if (disposed) throw new DisposedDecompressorException();\n          \n          \n            \n                    if (broken) {\n          \n          \n            \n                        throw new CompressionException(\"Compressed stream is broken\");\n          \n          \n            \n                    }\n          \n          \n            \n                    if (disposed) {\n          \n          \n            \n                        throw new DisposedDecompressorException();\n          \n          \n            \n                    }", "url": "https://github.com/ConsenSys/teku/pull/3030#discussion_r508690230", "createdAt": "2020-10-20T16:56:34Z", "author": {"login": "mbaxter"}, "path": "networking/eth2/src/main/java/tech/pegasys/teku/networking/eth2/rpc/core/encodings/compression/snappy/SnappyFramedCompressor.java", "diffHunk": "@@ -103,16 +94,24 @@ public SnappyFramedDecompressor(int uncompressedPayloadSize) {\n \n     @Override\n     public void complete() throws CompressionException {\n-      if (broken) throw new CompressionException(\"Compressed stream is broken\");\n-      if (disposed) throw new DisposedDecompressorException();\n-      disposed = true;\n-      boolean unreturnedFrames = !decodedSnappyFrames.isEmpty();\n+      try {\n+        if (broken) throw new CompressionException(\"Compressed stream is broken\");\n+        if (disposed) throw new DisposedDecompressorException();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "8eb7ac59e43ad179bc0b30c1cafc825ea9c6c764"}, "originalPosition": 42}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "3486b59fcd28376dbc8cdb00433954f127e7d5ca", "author": {"user": {"login": "Nashatyrev", "name": "Anton Nashatyrev"}}, "url": "https://github.com/ConsenSys/teku/commit/3486b59fcd28376dbc8cdb00433954f127e7d5ca", "committedDate": "2020-10-20T17:03:05Z", "message": "Always use blocks for if's\n\nCo-authored-by: mbaxter <meredith.baxter@consensys.net>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e889630dc109ca03938fa8a276f89c09d5f5df16", "author": {"user": {"login": "Nashatyrev", "name": "Anton Nashatyrev"}}, "url": "https://github.com/ConsenSys/teku/commit/e889630dc109ca03938fa8a276f89c09d5f5df16", "committedDate": "2020-10-20T17:19:40Z", "message": "Spotless apply"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "96b33fefd604f9437ff069776c3451ddf02a0264", "author": {"user": {"login": "Nashatyrev", "name": "Anton Nashatyrev"}}, "url": "https://github.com/ConsenSys/teku/commit/96b33fefd604f9437ff069776c3451ddf02a0264", "committedDate": "2020-10-20T17:19:50Z", "message": "Merge remote-tracking branch 'pegasys/master' into fix/unhandled-exception-on-stream-abort"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3225, "cost": 1, "resetAt": "2021-11-01T13:51:04Z"}}}