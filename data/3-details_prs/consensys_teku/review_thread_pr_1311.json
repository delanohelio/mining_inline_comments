{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0Mzg0OTcwNzE4", "number": 1311, "reviewThreads": {"totalCount": 6, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wNlQxOTowMTo1MFrODl6Agg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wNlQyMToxODowNFrODl8ffg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjQxMDc0MzA2OnYy", "diffSide": "RIGHT", "path": "networking/p2p/src/main/java/tech/pegasys/artemis/networking/p2p/libp2p/LibP2PNetwork.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wNlQxOTowMTo1MFrOFzD4VA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wNlQxOTowMTo1MFrOFzD4VA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4OTA4NTI2OA==", "bodyText": "We probably also want to check that this at least looks like a valid ip: InetAddresses.isInetAddress(config.getAdvertisedIp())", "url": "https://github.com/ConsenSys/teku/pull/1311#discussion_r389085268", "createdAt": "2020-03-06T19:01:50Z", "author": {"login": "mbaxter"}, "path": "networking/p2p/src/main/java/tech/pegasys/artemis/networking/p2p/libp2p/LibP2PNetwork.java", "diffHunk": "@@ -153,6 +160,19 @@ public LibP2PNetwork(\n             });\n   }\n \n+  public Multiaddr composeAdvertisedAddr(NetworkConfig config) throws UnknownHostException {\n+    String ip;\n+    if (!config.getAdvertisedIp().trim().isEmpty()) {\n+      ip = config.getAdvertisedIp();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "766144ebd336474d3da49baf33954df414bad797"}, "originalPosition": 30}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjQxMTEzNjQ1OnYy", "diffSide": "RIGHT", "path": "networking/p2p/src/main/java/tech/pegasys/artemis/networking/p2p/libp2p/LibP2PNetwork.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wNlQyMToxMzowNlrOFzHoBQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wNlQyMTo0NzoxM1rOFzIdUA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4OTE0NjYyOQ==", "bodyText": "I'd probably move the exception handling to the composeAdvertisedAddr method", "url": "https://github.com/ConsenSys/teku/pull/1311#discussion_r389146629", "createdAt": "2020-03-06T21:13:06Z", "author": {"login": "mbaxter"}, "path": "networking/p2p/src/main/java/tech/pegasys/artemis/networking/p2p/libp2p/LibP2PNetwork.java", "diffHunk": "@@ -80,7 +83,12 @@ public LibP2PNetwork(\n     this.privKey = config.getPrivateKey();\n     this.nodeId = new LibP2PNodeId(PeerId.fromPubKey(privKey.publicKey()));\n \n-    advertisedAddr = new Multiaddr(\"/ip4/127.0.0.1/tcp/\" + config.getAdvertisedPort());\n+    try {\n+      advertisedAddr = composeAdvertisedAddr(config);\n+    } catch (UnknownHostException err) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "18e5974c3f190ff42a648d2d3530c927101e7871"}, "originalPosition": 24}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4OTE2MDI3Mg==", "bodyText": "done.", "url": "https://github.com/ConsenSys/teku/pull/1311#discussion_r389160272", "createdAt": "2020-03-06T21:47:13Z", "author": {"login": "cemozerr"}, "path": "networking/p2p/src/main/java/tech/pegasys/artemis/networking/p2p/libp2p/LibP2PNetwork.java", "diffHunk": "@@ -80,7 +83,12 @@ public LibP2PNetwork(\n     this.privKey = config.getPrivateKey();\n     this.nodeId = new LibP2PNodeId(PeerId.fromPubKey(privKey.publicKey()));\n \n-    advertisedAddr = new Multiaddr(\"/ip4/127.0.0.1/tcp/\" + config.getAdvertisedPort());\n+    try {\n+      advertisedAddr = composeAdvertisedAddr(config);\n+    } catch (UnknownHostException err) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4OTE0NjYyOQ=="}, "originalCommit": {"oid": "18e5974c3f190ff42a648d2d3530c927101e7871"}, "originalPosition": 24}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjQxMTEzNzk1OnYy", "diffSide": "RIGHT", "path": "networking/p2p/src/main/java/tech/pegasys/artemis/networking/p2p/libp2p/LibP2PNetwork.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wNlQyMToxMzo0NFrOFzHo-g==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wNlQyMTo0NjoxMlrOFzIb9g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4OTE0Njg3NA==", "bodyText": "Maybe just:\n\n  \n    \n  \n    \n\n  \n  This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters. Learn more about bidirectional Unicode characters\n\n\n  \n\n\n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n              public Multiaddr composeAdvertisedAddr(NetworkConfig config) throws UnknownHostException {\n          \n          \n            \n              public Multiaddr getAdvertisedIp(NetworkConfig config) throws UnknownHostException {", "url": "https://github.com/ConsenSys/teku/pull/1311#discussion_r389146874", "createdAt": "2020-03-06T21:13:44Z", "author": {"login": "mbaxter"}, "path": "networking/p2p/src/main/java/tech/pegasys/artemis/networking/p2p/libp2p/LibP2PNetwork.java", "diffHunk": "@@ -153,6 +161,19 @@ public LibP2PNetwork(\n             });\n   }\n \n+  public Multiaddr composeAdvertisedAddr(NetworkConfig config) throws UnknownHostException {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "18e5974c3f190ff42a648d2d3530c927101e7871"}, "originalPosition": 35}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4OTE1OTkyNg==", "bodyText": "done.", "url": "https://github.com/ConsenSys/teku/pull/1311#discussion_r389159926", "createdAt": "2020-03-06T21:46:12Z", "author": {"login": "cemozerr"}, "path": "networking/p2p/src/main/java/tech/pegasys/artemis/networking/p2p/libp2p/LibP2PNetwork.java", "diffHunk": "@@ -153,6 +161,19 @@ public LibP2PNetwork(\n             });\n   }\n \n+  public Multiaddr composeAdvertisedAddr(NetworkConfig config) throws UnknownHostException {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4OTE0Njg3NA=="}, "originalCommit": {"oid": "18e5974c3f190ff42a648d2d3530c927101e7871"}, "originalPosition": 35}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjQxMTEzOTM1OnYy", "diffSide": "RIGHT", "path": "networking/p2p/src/main/java/tech/pegasys/artemis/networking/p2p/network/NetworkConfig.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wNlQyMToxNDoxNFrOFzHpwQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wNlQyMTo0NToyOVrOFzIa8w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4OTE0NzA3Mw==", "bodyText": "This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters. Learn more about bidirectional Unicode characters\n\n\n  \n\n\n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                  throw new RuntimeException(\"Advertised ip is set incorrectly.\");\n          \n          \n            \n                  throw new IllegalArgumentException(\"Advertised ip is set incorrectly.\");", "url": "https://github.com/ConsenSys/teku/pull/1311#discussion_r389147073", "createdAt": "2020-03-06T21:14:14Z", "author": {"login": "mbaxter"}, "path": "networking/p2p/src/main/java/tech/pegasys/artemis/networking/p2p/network/NetworkConfig.java", "diffHunk": "@@ -45,6 +50,15 @@ public NetworkConfig(\n       final boolean logMuxFrames) {\n     this.privateKey = privateKey;\n     this.networkInterface = networkInterface;\n+\n+    if (advertisedIp.trim().isEmpty()) {\n+      this.advertisedIp = Optional.empty();\n+    } else if (!isInetAddress(advertisedIp)) {\n+      throw new RuntimeException(\"Advertised ip is set incorrectly.\");", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "18e5974c3f190ff42a648d2d3530c927101e7871"}, "originalPosition": 35}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4OTE1OTY2Nw==", "bodyText": "done.", "url": "https://github.com/ConsenSys/teku/pull/1311#discussion_r389159667", "createdAt": "2020-03-06T21:45:29Z", "author": {"login": "cemozerr"}, "path": "networking/p2p/src/main/java/tech/pegasys/artemis/networking/p2p/network/NetworkConfig.java", "diffHunk": "@@ -45,6 +50,15 @@ public NetworkConfig(\n       final boolean logMuxFrames) {\n     this.privateKey = privateKey;\n     this.networkInterface = networkInterface;\n+\n+    if (advertisedIp.trim().isEmpty()) {\n+      this.advertisedIp = Optional.empty();\n+    } else if (!isInetAddress(advertisedIp)) {\n+      throw new RuntimeException(\"Advertised ip is set incorrectly.\");", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4OTE0NzA3Mw=="}, "originalCommit": {"oid": "18e5974c3f190ff42a648d2d3530c927101e7871"}, "originalPosition": 35}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjQxMTE0NTA5OnYy", "diffSide": "RIGHT", "path": "networking/p2p/src/main/java/tech/pegasys/artemis/networking/p2p/libp2p/LibP2PNetwork.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wNlQyMToxNjowN1rOFzHtIg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wNlQyMTo0NDo1MVrOFzIaIA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4OTE0NzkzOA==", "bodyText": "This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters. Learn more about bidirectional Unicode characters\n\n\n  \n\n\n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                } else if (NetworkUtility.isNetworkInterfaceAvailable(config.getNetworkInterface())) {\n          \n          \n            \n                } else if (!NetworkUtility.isUnspecifiedAddress(config.getNetworkInterface())) {", "url": "https://github.com/ConsenSys/teku/pull/1311#discussion_r389147938", "createdAt": "2020-03-06T21:16:07Z", "author": {"login": "mbaxter"}, "path": "networking/p2p/src/main/java/tech/pegasys/artemis/networking/p2p/libp2p/LibP2PNetwork.java", "diffHunk": "@@ -153,6 +161,19 @@ public LibP2PNetwork(\n             });\n   }\n \n+  public Multiaddr composeAdvertisedAddr(NetworkConfig config) throws UnknownHostException {\n+    String ip;\n+    if (config.getAdvertisedIp().isPresent()) {\n+      ip = config.getAdvertisedIp().get();\n+    } else if (NetworkUtility.isNetworkInterfaceAvailable(config.getNetworkInterface())) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "18e5974c3f190ff42a648d2d3530c927101e7871"}, "originalPosition": 39}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4OTE1OTQ1Ng==", "bodyText": "done.", "url": "https://github.com/ConsenSys/teku/pull/1311#discussion_r389159456", "createdAt": "2020-03-06T21:44:51Z", "author": {"login": "cemozerr"}, "path": "networking/p2p/src/main/java/tech/pegasys/artemis/networking/p2p/libp2p/LibP2PNetwork.java", "diffHunk": "@@ -153,6 +161,19 @@ public LibP2PNetwork(\n             });\n   }\n \n+  public Multiaddr composeAdvertisedAddr(NetworkConfig config) throws UnknownHostException {\n+    String ip;\n+    if (config.getAdvertisedIp().isPresent()) {\n+      ip = config.getAdvertisedIp().get();\n+    } else if (NetworkUtility.isNetworkInterfaceAvailable(config.getNetworkInterface())) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4OTE0NzkzOA=="}, "originalCommit": {"oid": "18e5974c3f190ff42a648d2d3530c927101e7871"}, "originalPosition": 39}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjQxMTE1MDA2OnYy", "diffSide": "RIGHT", "path": "util/src/main/java/tech/pegasys/artemis/util/network/NetworkUtility.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wNlQyMToxODowNFrOFzHwLg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wNlQyMTo0ODoxNlrOFzIevA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4OTE0ODcxOA==", "bodyText": "(optional) Might be nice to replace \"0.0.0.0\" strings in the codebase with this constant", "url": "https://github.com/ConsenSys/teku/pull/1311#discussion_r389148718", "createdAt": "2020-03-06T21:18:04Z", "author": {"login": "mbaxter"}, "path": "util/src/main/java/tech/pegasys/artemis/util/network/NetworkUtility.java", "diffHunk": "@@ -0,0 +1,104 @@\n+/*\n+ * Copyright 2020 ConsenSys AG.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\"); you may not use this file except in compliance with\n+ * the License. You may obtain a copy of the License at\n+ *\n+ * http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software distributed under the License is distributed on\n+ * an \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied. See the License for the\n+ * specific language governing permissions and limitations under the License.\n+ */\n+\n+package tech.pegasys.artemis.util.network;\n+\n+import com.google.common.base.Suppliers;\n+import java.net.Inet6Address;\n+import java.net.InetAddress;\n+import java.net.InetSocketAddress;\n+import java.net.NetworkInterface;\n+import java.net.SocketException;\n+import java.net.UnknownHostException;\n+import java.util.Enumeration;\n+import java.util.function.Supplier;\n+\n+public class NetworkUtility {\n+  public static final String INADDR_ANY = \"0.0.0.0\";", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "18e5974c3f190ff42a648d2d3530c927101e7871"}, "originalPosition": 27}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4OTE2MDYzNg==", "bodyText": "done.", "url": "https://github.com/ConsenSys/teku/pull/1311#discussion_r389160636", "createdAt": "2020-03-06T21:48:16Z", "author": {"login": "cemozerr"}, "path": "util/src/main/java/tech/pegasys/artemis/util/network/NetworkUtility.java", "diffHunk": "@@ -0,0 +1,104 @@\n+/*\n+ * Copyright 2020 ConsenSys AG.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\"); you may not use this file except in compliance with\n+ * the License. You may obtain a copy of the License at\n+ *\n+ * http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software distributed under the License is distributed on\n+ * an \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied. See the License for the\n+ * specific language governing permissions and limitations under the License.\n+ */\n+\n+package tech.pegasys.artemis.util.network;\n+\n+import com.google.common.base.Suppliers;\n+import java.net.Inet6Address;\n+import java.net.InetAddress;\n+import java.net.InetSocketAddress;\n+import java.net.NetworkInterface;\n+import java.net.SocketException;\n+import java.net.UnknownHostException;\n+import java.util.Enumeration;\n+import java.util.function.Supplier;\n+\n+public class NetworkUtility {\n+  public static final String INADDR_ANY = \"0.0.0.0\";", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4OTE0ODcxOA=="}, "originalCommit": {"oid": "18e5974c3f190ff42a648d2d3530c927101e7871"}, "originalPosition": 27}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2500, "cost": 1, "resetAt": "2021-11-12T11:57:46Z"}}}