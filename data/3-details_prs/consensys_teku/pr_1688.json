{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDEwMjU1MzE3", "number": 1688, "title": "[BC-373] Align Gossip message ID according to the spec", "bodyText": "PR Description\n\nAlign Gossip messageId according to the spec: https://github.com/ethereum/eth2.0-specs/blob/v0.11.1/specs/phase0/p2p-interface.md#topics-and-messages\n\nDepends on #1680\nPending for Libp2p 0.3.4 release to be published", "createdAt": "2020-04-28T17:22:38Z", "url": "https://github.com/ConsenSys/teku/pull/1688", "merged": true, "mergeCommit": {"oid": "35145076179e7440efac0a3438246e6c7d604b89"}, "closed": true, "closedAt": "2020-04-30T10:40:34Z", "author": {"login": "Nashatyrev"}, "timelineItems": {"totalCount": 16, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcbzbgBAH2gAyNDEwMjU1MzE3OjgwODVkNzdmMDYxNmMyNDBkYzQ2Yjk5Zjk5YjE1MmQxOWE1MmE0MTY=", "endCursor": "Y3Vyc29yOnYyOpPPAAABccqbqDgH2gAyNDEwMjU1MzE3OjczMDhmZjRmNjI2ZmI3NWQ1OWNiMTcyM2E0NGY3Mjc5YmNkM2VmY2Q=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "8085d77f0616c240dc46b99f99b152d19a52a416", "author": {"user": {"login": "Nashatyrev", "name": "Anton Nashatyrev"}}, "url": "https://github.com/ConsenSys/teku/commit/8085d77f0616c240dc46b99f99b152d19a52a416", "committedDate": "2020-04-27T18:17:14Z", "message": "Add Gossip options to the NetworkConfig"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "967fa4c6d1d09bb4e0fbee97378ce92b95fc1caf", "author": {"user": {"login": "Nashatyrev", "name": "Anton Nashatyrev"}}, "url": "https://github.com/ConsenSys/teku/commit/967fa4c6d1d09bb4e0fbee97378ce92b95fc1caf", "committedDate": "2020-04-27T18:17:58Z", "message": "Make wire logging options configurable"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "951c81a55c213b32111d8464016358bef20cb144", "author": {"user": {"login": "Nashatyrev", "name": "Anton Nashatyrev"}}, "url": "https://github.com/ConsenSys/teku/commit/951c81a55c213b32111d8464016358bef20cb144", "committedDate": "2020-04-28T09:41:25Z", "message": "Inline option names and default values. Make wire log options hidden"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "cfb16a9657aa4980e8b7b38dc751a552b96e443e", "author": {"user": {"login": "Nashatyrev", "name": "Anton Nashatyrev"}}, "url": "https://github.com/ConsenSys/teku/commit/cfb16a9657aa4980e8b7b38dc751a552b96e443e", "committedDate": "2020-04-28T09:41:34Z", "message": "Merge remote-tracking branch 'pegasys/master' into feature-gossip-options"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f2c92947a4d47982e6e3ce9fe828b1ee6554cf9f", "author": {"user": {"login": "Nashatyrev", "name": "Anton Nashatyrev"}}, "url": "https://github.com/ConsenSys/teku/commit/f2c92947a4d47982e6e3ce9fe828b1ee6554cf9f", "committedDate": "2020-04-28T10:39:31Z", "message": "Move Gossip and WireLogs configs to a separate classes with default instances. Make all the classes back immutable"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "8d7da373f833e5f9911c72146289bfa883e16b89", "author": {"user": {"login": "Nashatyrev", "name": "Anton Nashatyrev"}}, "url": "https://github.com/ConsenSys/teku/commit/8d7da373f833e5f9911c72146289bfa883e16b89", "committedDate": "2020-04-28T10:42:57Z", "message": "Revert accidentally committed change"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "1ec01900560e220f21c5f75c6dab30ffe72607c6", "author": {"user": {"login": "Nashatyrev", "name": "Anton Nashatyrev"}}, "url": "https://github.com/ConsenSys/teku/commit/1ec01900560e220f21c5f75c6dab30ffe72607c6", "committedDate": "2020-04-28T11:09:05Z", "message": "Bump libp2p version to 0.3.4"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c29f44602821a68696ac1934b0a69d2b28a34a15", "author": {"user": {"login": "Nashatyrev", "name": "Anton Nashatyrev"}}, "url": "https://github.com/ConsenSys/teku/commit/c29f44602821a68696ac1934b0a69d2b28a34a15", "committedDate": "2020-04-28T11:09:35Z", "message": "Override gossip messageId accroding to the spec"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "9076a9280a0c3b07bc7ea0fe57bf55a385801acb", "author": {"user": {"login": "Nashatyrev", "name": "Anton Nashatyrev"}}, "url": "https://github.com/ConsenSys/teku/commit/9076a9280a0c3b07bc7ea0fe57bf55a385801acb", "committedDate": "2020-04-28T17:18:29Z", "message": "Move custom Gossip router to a separate class"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a9225dd6d9fc2769b80f56927212e7f74e40bb7f", "author": {"user": {"login": "Nashatyrev", "name": "Anton Nashatyrev"}}, "url": "https://github.com/ConsenSys/teku/commit/a9225dd6d9fc2769b80f56927212e7f74e40bb7f", "committedDate": "2020-04-28T17:37:51Z", "message": "Apply spotless"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDAyMjE2MDMw", "url": "https://github.com/ConsenSys/teku/pull/1688#pullrequestreview-402216030", "createdAt": "2020-04-28T21:12:58Z", "commit": {"oid": "a9225dd6d9fc2769b80f56927212e7f74e40bb7f"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yOFQyMToxMjo1OVrOGNnKMw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yOFQyMToxMjo1OVrOGNnKMw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNjkyNjI1OQ==", "bodyText": "I think this is the wrong base64.  It should be the URL safe variant without padding.  To do that in discv5 I had to use: https://github.com/PegaSysEng/discovery/blob/247107e61cd53ed4c05ea2401985094ae1c3668d/src/main/java/org/ethereum/beacon/discovery/schema/NodeRecord.java#L84", "url": "https://github.com/ConsenSys/teku/pull/1688#discussion_r416926259", "createdAt": "2020-04-28T21:12:59Z", "author": {"login": "ajsutton"}, "path": "networking/p2p/src/main/java/tech/pegasys/artemis/networking/p2p/libp2p/Eth2GossipRouter.java", "diffHunk": "@@ -0,0 +1,30 @@\n+/*\n+ * Copyright 2020 ConsenSys AG.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\"); you may not use this file except in compliance with\n+ * the License. You may obtain a copy of the License at\n+ *\n+ * http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software distributed under the License is distributed on\n+ * an \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied. See the License for the\n+ * specific language governing permissions and limitations under the License.\n+ */\n+\n+package tech.pegasys.artemis.networking.p2p.libp2p;\n+\n+import io.libp2p.pubsub.gossip.GossipRouter;\n+import org.apache.tuweni.crypto.Hash;\n+import org.apache.tuweni.io.Base64;\n+import org.jetbrains.annotations.NotNull;\n+import pubsub.pb.Rpc.Message;\n+\n+/** Customization of a standard Libp2p Gossip router for Eth2 spec */\n+public class Eth2GossipRouter extends GossipRouter {\n+\n+  @NotNull\n+  @Override\n+  protected String getMessageId(@NotNull Message msg) {\n+    return Base64.encodeBytes(Hash.sha2_256(msg.getData().toByteArray()));", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "a9225dd6d9fc2769b80f56927212e7f74e40bb7f"}, "originalPosition": 28}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "5b68c657ac089fbd8db694487750314155160f21", "author": {"user": {"login": "Nashatyrev", "name": "Anton Nashatyrev"}}, "url": "https://github.com/ConsenSys/teku/commit/5b68c657ac089fbd8db694487750314155160f21", "committedDate": "2020-04-29T08:55:58Z", "message": "Fix the wrong Base64"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "79a84503e11917e85395d68756332929f22ba402", "author": {"user": {"login": "Nashatyrev", "name": "Anton Nashatyrev"}}, "url": "https://github.com/ConsenSys/teku/commit/79a84503e11917e85395d68756332929f22ba402", "committedDate": "2020-04-29T09:54:40Z", "message": "Merge remote-tracking branch 'pegasys/master' into feature-eth2-gossip-message-id\n\n# Conflicts:\n#\tartemis/src/test/resources/loggingOptions_config.yaml\n#\tnetworking/p2p/src/main/java/tech/pegasys/artemis/networking/p2p/libp2p/LibP2PNetwork.java"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "648489f9f580701d12455b1672149b4756f98207", "author": {"user": {"login": "Nashatyrev", "name": "Anton Nashatyrev"}}, "url": "https://github.com/ConsenSys/teku/commit/648489f9f580701d12455b1672149b4756f98207", "committedDate": "2020-04-29T10:53:44Z", "message": "Merge branch 'master' into feature-eth2-gossip-message-id"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDAzMTcyMDE2", "url": "https://github.com/ConsenSys/teku/pull/1688#pullrequestreview-403172016", "createdAt": "2020-04-30T03:03:11Z", "commit": {"oid": "648489f9f580701d12455b1672149b4756f98207"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "7308ff4f626fb75d59cb1723a44f7279bcd3efcd", "author": {"user": {"login": "Nashatyrev", "name": "Anton Nashatyrev"}}, "url": "https://github.com/ConsenSys/teku/commit/7308ff4f626fb75d59cb1723a44f7279bcd3efcd", "committedDate": "2020-04-30T10:22:11Z", "message": "Merge branch 'master' into feature-eth2-gossip-message-id"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4138, "cost": 1, "resetAt": "2021-11-01T13:51:04Z"}}}