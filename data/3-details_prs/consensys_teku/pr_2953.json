{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTAxODc2Mjg4", "number": 2953, "title": "Switch validator over to load attestation and block duties separately", "bodyText": "PR Description\nUse the separate APIs to load attestation and block duties rather than the older combined one.\nFixed Issue(s)\n#1918\nDocumentation\n\n I thought about documentation and added the documentation label to this PR if updates are required.", "createdAt": "2020-10-12T23:27:40Z", "url": "https://github.com/ConsenSys/teku/pull/2953", "merged": true, "mergeCommit": {"oid": "bb1d4812be2912faa7ec42736ae656e44be69c7b"}, "closed": true, "closedAt": "2020-10-13T02:50:24Z", "author": {"login": "ajsutton"}, "timelineItems": {"totalCount": 11, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdR8iosgH2gAyNTAxODc2Mjg4OmQ1NzgxNzdlNDk0ZTA1YTBlZjRlNDA4ZDNiNGRmN2ViYWQ5OWNmYzI=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdR-s5VAH2gAyNTAxODc2Mjg4OmFiYjE3NTkyNTY4YmFmZWI1MzM2M2VlYTVmZTE4NjNmNDkwOTkzY2U=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "d578177e494e05a0ef4e408d3b4df7ebad99cfc2", "author": {"user": {"login": "ajsutton", "name": "Adrian Sutton"}}, "url": "https://github.com/ConsenSys/teku/commit/d578177e494e05a0ef4e408d3b4df7ebad99cfc2", "committedDate": "2020-10-12T23:26:05Z", "message": "Switch validator over to load attestation and block duties separately."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "32bb7b391a582e0e344f3c9f022177c68bb13730", "author": {"user": {"login": "ajsutton", "name": "Adrian Sutton"}}, "url": "https://github.com/ConsenSys/teku/commit/32bb7b391a582e0e344f3c9f022177c68bb13730", "committedDate": "2020-10-12T23:57:39Z", "message": "Merge branch 'master' into new-duty-loaders"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTA2OTk2NjM2", "url": "https://github.com/ConsenSys/teku/pull/2953#pullrequestreview-506996636", "createdAt": "2020-10-13T00:37:04Z", "commit": {"oid": "32bb7b391a582e0e344f3c9f022177c68bb13730"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xM1QwMDozNzowNFrOHgRlhA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xM1QwMDozNzowNFrOHgRlhA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMzYwNDYxMg==", "bodyText": "todo without ticket number..", "url": "https://github.com/ConsenSys/teku/pull/2953#discussion_r503604612", "createdAt": "2020-10-13T00:37:04Z", "author": {"login": "rolfyone"}, "path": "validator/client/src/main/java/tech/pegasys/teku/validator/client/AbstractDutyLoader.java", "diffHunk": "@@ -0,0 +1,73 @@\n+/*\n+ * Copyright 2020 ConsenSys AG.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\"); you may not use this file except in compliance with\n+ * the License. You may obtain a copy of the License at\n+ *\n+ * http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software distributed under the License is distributed on\n+ * an \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied. See the License for the\n+ * specific language governing permissions and limitations under the License.\n+ */\n+\n+package tech.pegasys.teku.validator.client;\n+\n+import java.util.Collection;\n+import java.util.List;\n+import java.util.Map;\n+import java.util.Optional;\n+import java.util.function.Supplier;\n+import org.apache.logging.log4j.LogManager;\n+import org.apache.logging.log4j.Logger;\n+import tech.pegasys.teku.bls.BLSPublicKey;\n+import tech.pegasys.teku.infrastructure.async.SafeFuture;\n+import tech.pegasys.teku.infrastructure.unsigned.UInt64;\n+import tech.pegasys.teku.validator.client.duties.ScheduledDuties;\n+\n+public abstract class AbstractDutyLoader<D> implements DutyLoader {\n+\n+  private static final Logger LOG = LogManager.getLogger();\n+  private final Supplier<ScheduledDuties> scheduledDutiesFactory;\n+  protected final Map<BLSPublicKey, Validator> validators;\n+  private final ValidatorIndexProvider validatorIndexProvider;\n+\n+  protected AbstractDutyLoader(\n+      final Supplier<ScheduledDuties> scheduledDutiesFactory,\n+      final Map<BLSPublicKey, Validator> validators,\n+      final ValidatorIndexProvider validatorIndexProvider) {\n+    this.scheduledDutiesFactory = scheduledDutiesFactory;\n+    this.validators = validators;\n+    this.validatorIndexProvider = validatorIndexProvider;\n+    // TODO: Find a new place to set the local_validator_count metric", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "32bb7b391a582e0e344f3c9f022177c68bb13730"}, "originalPosition": 42}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTA2OTk3MTk0", "url": "https://github.com/ConsenSys/teku/pull/2953#pullrequestreview-506997194", "createdAt": "2020-10-13T00:39:09Z", "commit": {"oid": "32bb7b391a582e0e344f3c9f022177c68bb13730"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "180c1b7526d1118996d18415fa33a7c7e8d3089e", "author": {"user": {"login": "ajsutton", "name": "Adrian Sutton"}}, "url": "https://github.com/ConsenSys/teku/commit/180c1b7526d1118996d18415fa33a7c7e8d3089e", "committedDate": "2020-10-13T00:43:18Z", "message": "Restore validator count metric."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e599a7b0f8c6af8b2041a1776eaa6963fd2f9a81", "author": {"user": {"login": "ajsutton", "name": "Adrian Sutton"}}, "url": "https://github.com/ConsenSys/teku/commit/e599a7b0f8c6af8b2041a1776eaa6963fd2f9a81", "committedDate": "2020-10-13T00:43:22Z", "message": "Merge branch 'master' of github.com:PegaSysEng/teku into new-duty-loaders"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b1387764f4d55f955b075b99f892618fe99d8175", "author": {"user": {"login": "ajsutton", "name": "Adrian Sutton"}}, "url": "https://github.com/ConsenSys/teku/commit/b1387764f4d55f955b075b99f892618fe99d8175", "committedDate": "2020-10-13T00:45:09Z", "message": "Merge branch 'new-duty-loaders' of github.com:ajsutton/teku into new-duty-loaders"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b1ba125441da76739bd1107ea57200e3ab8a7d17", "author": {"user": {"login": "ajsutton", "name": "Adrian Sutton"}}, "url": "https://github.com/ConsenSys/teku/commit/b1ba125441da76739bd1107ea57200e3ab8a7d17", "committedDate": "2020-10-13T01:23:48Z", "message": "Replace epoch in URL correctly.\nInclude url in error message when a request fails.\nMap attester duty response to internal representation correctly."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "9d829080c5756f08b88e37e90e7266bb7e203e2e", "author": {"user": {"login": "ajsutton", "name": "Adrian Sutton"}}, "url": "https://github.com/ConsenSys/teku/commit/9d829080c5756f08b88e37e90e7266bb7e203e2e", "committedDate": "2020-10-13T01:35:03Z", "message": "Add tests for the duties api client."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "9814fbed3e64b3370f3b9036e9a5f25f41193f9f", "author": {"user": {"login": "ajsutton", "name": "Adrian Sutton"}}, "url": "https://github.com/ConsenSys/teku/commit/9814fbed3e64b3370f3b9036e9a5f25f41193f9f", "committedDate": "2020-10-13T01:55:17Z", "message": "Throw exception when a bad request response is received so the RetryingDutyLoader can handle it rather than suppressing the exception and reporting chain data unavailable."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "abb17592568bafeb53363eea5fe1863f490993ce", "author": {"user": {"login": "ajsutton", "name": "Adrian Sutton"}}, "url": "https://github.com/ConsenSys/teku/commit/abb17592568bafeb53363eea5fe1863f490993ce", "committedDate": "2020-10-13T01:57:06Z", "message": "Errorprone."}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3347, "cost": 1, "resetAt": "2021-11-01T13:51:04Z"}}}