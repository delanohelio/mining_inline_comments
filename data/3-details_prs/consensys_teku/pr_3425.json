{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTQ2NDIxNDgw", "number": 3425, "title": "Moving all SSZ containers to backing structures (part 1)", "bodyText": "PR Description\nPart of eliminating old SSZ code\n\nParametrizeViewType interface with corresponding ViewRead type (similar to java.lang.Class<T>)\nReplace ContainerViewType constructor with factory method\nGenerate type-safe container base classes and add a generator for them\nMigrate Checkpoint and AttestationData classes to type-safe containers (just for illustration purpose in this PR)\n\nThe major questions are regarding the generated classes:\n\nThey are not expected to be changed often so probably the better place for them is the regular source location (not generated)? In this case you would not need to run the gradle build before your project can be build in IDE after initial clone.\nI've also put classes templates to regular test src folder (not to resources) so they could easily be edited in IDE as regular java classes. Does it look ok?\nIs it generally ok to place the generator and its templates to the test sources? May be testFixtures would be better?\n\nFixed Issue(s)\n\n\nPartially address #2298\nDocumentation\n\n I thought about documentation and added the documentation label to this PR if updates are required.", "createdAt": "2020-12-29T10:17:08Z", "url": "https://github.com/ConsenSys/teku/pull/3425", "merged": true, "mergeCommit": {"oid": "023677c6838de641df6f7307d127d42e11480700"}, "closed": true, "closedAt": "2021-01-12T18:09:08Z", "author": {"login": "Nashatyrev"}, "timelineItems": {"totalCount": 14, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdqo1cfAH2gAyNTQ2NDIxNDgwOjRmNWY4MTkzNDE2YjdkOGE5NzZlNmQ3YTA5NjhkZmNlYjRmMzc4YzY=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdveIkLgH2gAyNTQ2NDIxNDgwOjkxNThjZjNlYmJiZTI4YmM4YzMzZGQyNmRhYzRhODg3NjhjY2IxNTU=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "4f5f8193416b7d8a976e6d7a0968dfceb4f378c6", "author": {"user": {"login": "Nashatyrev", "name": "Anton Nashatyrev"}}, "url": "https://github.com/ConsenSys/teku/commit/4f5f8193416b7d8a976e6d7a0968dfceb4f378c6", "committedDate": "2020-12-28T16:36:38Z", "message": "Generify ViewType, draft"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "01cae46a6d1b2599b2481bb32454a531c71cf108", "author": {"user": {"login": "Nashatyrev", "name": "Anton Nashatyrev"}}, "url": "https://github.com/ConsenSys/teku/commit/01cae46a6d1b2599b2481bb32454a531c71cf108", "committedDate": "2020-12-28T16:59:51Z", "message": "Avoid generify element ViewType in CollectionViewType"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "3e765d620de7191e0c6ca08c9da1cf4c8b86a280", "author": {"user": {"login": "Nashatyrev", "name": "Anton Nashatyrev"}}, "url": "https://github.com/ConsenSys/teku/commit/3e765d620de7191e0c6ca08c9da1cf4c8b86a280", "committedDate": "2020-12-29T10:14:50Z", "message": "Fix ViewType raw usages (assembles)"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "adcc503a13cc221792bf269ccdf4e7b97aa9007d", "author": {"user": {"login": "Nashatyrev", "name": "Anton Nashatyrev"}}, "url": "https://github.com/ConsenSys/teku/commit/adcc503a13cc221792bf269ccdf4e7b97aa9007d", "committedDate": "2020-12-29T10:26:33Z", "message": "Replace ContainerViewType constructor with factory method"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "d1b4ad688ce1786972b8bd35d50a04e837469823", "author": {"user": {"login": "Nashatyrev", "name": "Anton Nashatyrev"}}, "url": "https://github.com/ConsenSys/teku/commit/d1b4ad688ce1786972b8bd35d50a04e837469823", "committedDate": "2020-12-29T14:27:57Z", "message": "Add type-safe container generated classes. Add generator"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "0577ab5a657f9849f275a1e8d34aa95e88d6b74c", "author": {"user": {"login": "Nashatyrev", "name": "Anton Nashatyrev"}}, "url": "https://github.com/ConsenSys/teku/commit/0577ab5a657f9849f275a1e8d34aa95e88d6b74c", "committedDate": "2020-12-29T14:29:18Z", "message": "Migrate Checkpoint and AttestationData classes to type-safe containers"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a1522731cae9d9673623509fff59f39bc6875932", "author": {"user": {"login": "Nashatyrev", "name": "Anton Nashatyrev"}}, "url": "https://github.com/ConsenSys/teku/commit/a1522731cae9d9673623509fff59f39bc6875932", "committedDate": "2020-12-29T15:00:31Z", "message": "Return back the SSZContainer marker interface for now"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "79bb7227ca6c9d1f744185d953e3ad617f649358", "author": {"user": {"login": "Nashatyrev", "name": "Anton Nashatyrev"}}, "url": "https://github.com/ConsenSys/teku/commit/79bb7227ca6c9d1f744185d953e3ad617f649358", "committedDate": "2020-12-29T16:27:55Z", "message": "Fix compile error"}, "afterCommit": {"oid": "a1522731cae9d9673623509fff59f39bc6875932", "author": {"user": {"login": "Nashatyrev", "name": "Anton Nashatyrev"}}, "url": "https://github.com/ConsenSys/teku/commit/a1522731cae9d9673623509fff59f39bc6875932", "committedDate": "2020-12-29T15:00:31Z", "message": "Return back the SSZContainer marker interface for now"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTYxMzk0NzY4", "url": "https://github.com/ConsenSys/teku/pull/3425#pullrequestreview-561394768", "createdAt": "2021-01-04T22:32:30Z", "commit": {"oid": "a1522731cae9d9673623509fff59f39bc6875932"}, "state": "COMMENTED", "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wMS0wNFQyMjozMjozMFrOIODg4Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wMS0wNFQyMzoxMzo1OVrOIOEchQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1MTYwODU0NQ==", "bodyText": "nit: I don't know what's going on with the spacing around those * characters.  Personally I don't feel we need to explicit tell people these are getters and setters, I think they can probably work that out easily enough... :)", "url": "https://github.com/ConsenSys/teku/pull/3425#discussion_r551608545", "createdAt": "2021-01-04T22:32:30Z", "author": {"login": "ajsutton"}, "path": "ethereum/datastructures/src/main/java/tech/pegasys/teku/datastructures/operations/AttestationData.java", "diffHunk": "@@ -120,25 +131,25 @@ public UInt64 getEarliestSlotForForkChoice() {\n     return getSlot().plus(UInt64.ONE).max(getTarget().getEpochStartSlot());\n   }\n \n-  /** ******************* * GETTERS & SETTERS * * ******************* */\n+  /** ****************** * GETTERS & SETTERS * * ******************* */", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "a1522731cae9d9673623509fff59f39bc6875932"}, "originalPosition": 70}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1MTYwODY3NQ==", "bodyText": "It looks like these fields are still required at the moment, but is the ultimate plan to be able to remove them and just use the ssh type descriptor?", "url": "https://github.com/ConsenSys/teku/pull/3425#discussion_r551608675", "createdAt": "2021-01-04T22:32:52Z", "author": {"login": "ajsutton"}, "path": "ethereum/datastructures/src/main/java/tech/pegasys/teku/datastructures/operations/AttestationData.java", "diffHunk": "@@ -66,7 +77,7 @@\n   @SuppressWarnings(\"unused\")\n   private final Checkpoint target = null;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "a1522731cae9d9673623509fff59f39bc6875932"}, "originalPosition": 58}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1MTYyMzgxMw==", "bodyText": "I think I'd move this to a new module just for this generator. Then it can live in the main source tree for that module and we should be able to easily create a Gradle task that regenerates the classes.\nI like having the generated classes checked in given they won't change much - it may be worth having a task in Gradle that tests the generated source hasn't been changed.  It would run the generator, outputting the result to a temp directory and then compare what was generated with what's in the actual source.  That way we'll avoid issues of people modifying the generated source and then those changes being lost on the next regeneration.  Just need to ensure the generated code complies with spotless or it will wind up with different formatting - hopefully that's not too hard (if it is we could potentially do the comparison completely ignoring whitespace and it would still be effective).\nIn terms of template placing, I like that they can be treated as actual java source code so I'd keep them in the same source tree as the generator (so that would wind up being the main tree in the new module).", "url": "https://github.com/ConsenSys/teku/pull/3425#discussion_r551623813", "createdAt": "2021-01-04T23:13:59Z", "author": {"login": "ajsutton"}, "path": "ssz/src/test/java/tech/pegasys/teku/ssz/backing/ContainersGenerator.java", "diffHunk": "@@ -0,0 +1,136 @@\n+/*\n+ * Copyright 2020 ConsenSys AG.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\"); you may not use this file except in compliance with\n+ * the License. You may obtain a copy of the License at\n+ *\n+ * http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software distributed under the License is distributed on\n+ * an \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied. See the License for the\n+ * specific language governing permissions and limitations under the License.\n+ */\n+\n+package tech.pegasys.teku.ssz.backing;\n+\n+import java.io.File;\n+import java.io.IOException;\n+import java.nio.file.Files;\n+import java.nio.file.Path;\n+import java.util.Map;\n+import java.util.stream.Collectors;\n+import java.util.stream.IntStream;\n+\n+public class ContainersGenerator {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "a1522731cae9d9673623509fff59f39bc6875932"}, "originalPosition": 24}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "6711d4d57806ec191c82d8bacb6675f9f194179d", "author": {"user": {"login": "Nashatyrev", "name": "Anton Nashatyrev"}}, "url": "https://github.com/ConsenSys/teku/commit/6711d4d57806ec191c82d8bacb6675f9f194179d", "committedDate": "2021-01-11T19:33:11Z", "message": "Move ContainersGenerator to a separate module. Add a gradle task to generate containers"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f722775a00027f13160e1ee5233c59e2bec0b09b", "author": {"user": {"login": "Nashatyrev", "name": "Anton Nashatyrev"}}, "url": "https://github.com/ConsenSys/teku/commit/f722775a00027f13160e1ee5233c59e2bec0b09b", "committedDate": "2021-01-11T20:00:33Z", "message": "Remove obsolete comment"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTY1ODQwODkw", "url": "https://github.com/ConsenSys/teku/pull/3425#pullrequestreview-565840890", "createdAt": "2021-01-12T00:20:01Z", "commit": {"oid": "6711d4d57806ec191c82d8bacb6675f9f194179d"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "257cd7754cad6b28a8a55169a156c21d2347c475", "author": {"user": {"login": "Nashatyrev", "name": "Anton Nashatyrev"}}, "url": "https://github.com/ConsenSys/teku/commit/257cd7754cad6b28a8a55169a156c21d2347c475", "committedDate": "2021-01-12T16:43:15Z", "message": "Add the test checking that generated source files were not manually modified"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "9158cf3ebbbe28bc8c33dd26dac4a88768ccb155", "author": {"user": {"login": "Nashatyrev", "name": "Anton Nashatyrev"}}, "url": "https://github.com/ConsenSys/teku/commit/9158cf3ebbbe28bc8c33dd26dac4a88768ccb155", "committedDate": "2021-01-12T16:58:11Z", "message": "Merge remote-tracking branch 'ConsenSys/master' into feature/generify-viewtype-simpler-2"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4445, "cost": 1, "resetAt": "2021-11-01T13:51:04Z"}}}