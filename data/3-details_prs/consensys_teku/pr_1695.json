{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDEwNzU0NjYz", "number": 1695, "title": "Publish openapi to gh pages", "bodyText": "PR Description\nAdd CI step to generate Teku OpenAPI doc and publish it to Github pages.\nTwo steps are added:\n\nrunning Teku and extract the OpenAPI JSON spec file.\nBuilds with the installDist task and runs Teku agains a testnet until the OpenAPI doc service is up and wget retrieves the JSON file. Wget retries 20 times by default so it lets some time for the service to be up.\nupdate the github pages branch used as source for the doc site.\nUses a node.js container to run script available on the gh-pages branch in order to update the doc. It then commits and pushes the changes back to this branch using the SSH deploy key.\n\nIMPORTANT: The tag part (creating a named version when a tag is created during release process) is not yet available.\nOnly the latest doc version will be built automatically from master for the moment until this tag CI part is solved.\nIf needed, a named version can be generated manually until we figure this out.\nUntil then, at least we will have the master automatically updating the latest doc version.\nI will come back with a smaller PR to fix the tag part, but this large one will be merged and already updating the doc.\nFixed Issue(s)\nConsenSys/protocol-misc#33", "createdAt": "2020-04-29T14:37:35Z", "url": "https://github.com/ConsenSys/teku/pull/1695", "merged": true, "mergeCommit": {"oid": "0980985d07ec15f7dfcebe315bcb05a4b7276dc0"}, "closed": true, "closedAt": "2020-05-18T07:32:48Z", "author": {"login": "NicolasMassart"}, "timelineItems": {"totalCount": 51, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcXlbPfgH2gAyNDEwNzU0NjYzOjZiYmQ2NWM5ZGU2NWNhNjExMmExMGE4MTU1MzlkMzg3MmM0MjViY2E=", "endCursor": "Y3Vyc29yOnYyOpPPAAABciajD0AH2gAyNDEwNzU0NjYzOmVkMzVlYWJkZjEwN2UxYmJiZGY3NGRmZmMwYzkyZWUwMGM4ODI4NzY=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "6bbd65c9de65ca6112a10a815539d3872c425bca", "author": {"user": {"login": "NicolasMassart", "name": "Nicolas MASSART"}}, "url": "https://github.com/ConsenSys/teku/commit/6bbd65c9de65ca6112a10a815539d3872c425bca", "committedDate": "2020-04-14T15:42:35Z", "message": "test for CI OpenAPI publishing"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f0754a7b2407d4df8586c48967daa540fe54625b", "author": {"user": {"login": "NicolasMassart", "name": "Nicolas MASSART"}}, "url": "https://github.com/ConsenSys/teku/commit/f0754a7b2407d4df8586c48967daa540fe54625b", "committedDate": "2020-04-16T12:19:27Z", "message": "Merge branch 'master' into publish_openapi_to_gh-pages"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f2f1ce585ae15ba5e1884f7d778aac6b2a1b8c4d", "author": {"user": {"login": "NicolasMassart", "name": "Nicolas MASSART"}}, "url": "https://github.com/ConsenSys/teku/commit/f2f1ce585ae15ba5e1884f7d778aac6b2a1b8c4d", "committedDate": "2020-04-16T13:03:43Z", "message": "update pull test branch name"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "4149f3e650d752839137699e6ee0270a3564a580", "author": {"user": {"login": "NicolasMassart", "name": "Nicolas MASSART"}}, "url": "https://github.com/ConsenSys/teku/commit/4149f3e650d752839137699e6ee0270a3564a580", "committedDate": "2020-04-16T13:13:53Z", "message": "remove redoc part as we will use it dynamically"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "26f51e746debe7b6142b047bd81280b30fcfec37", "author": {"user": {"login": "NicolasMassart", "name": "Nicolas MASSART"}}, "url": "https://github.com/ConsenSys/teku/commit/26f51e746debe7b6142b047bd81280b30fcfec37", "committedDate": "2020-04-16T14:49:43Z", "message": "try with a medium executor as small seems to fail"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "4140fb110a2ac103690fe321720130f273de32ae", "author": {"user": {"login": "NicolasMassart", "name": "Nicolas MASSART"}}, "url": "https://github.com/ConsenSys/teku/commit/4140fb110a2ac103690fe321720130f273de32ae", "committedDate": "2020-04-16T20:30:23Z", "message": "test"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "4b4612f7bd4323f56e89cc2ef5b461302a4d4b77", "author": {"user": {"login": "NicolasMassart", "name": "Nicolas MASSART"}}, "url": "https://github.com/ConsenSys/teku/commit/4b4612f7bd4323f56e89cc2ef5b461302a4d4b77", "committedDate": "2020-04-16T20:33:05Z", "message": "test"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "2f21596653ef2d714e6524a0f29875170bbfb78f", "author": {"user": {"login": "NicolasMassart", "name": "Nicolas MASSART"}}, "url": "https://github.com/ConsenSys/teku/commit/2f21596653ef2d714e6524a0f29875170bbfb78f", "committedDate": "2020-04-16T20:35:51Z", "message": "test"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "abcbfcff5139d22453aa99a398a677e4f53a8d48", "author": {"user": {"login": "NicolasMassart", "name": "Nicolas MASSART"}}, "url": "https://github.com/ConsenSys/teku/commit/abcbfcff5139d22453aa99a398a677e4f53a8d48", "committedDate": "2020-04-16T20:50:39Z", "message": "test commit"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "4381bc1dca71cf2a697f8e8b0144c16575024ab0", "author": {"user": {"login": "NicolasMassart", "name": "Nicolas MASSART"}}, "url": "https://github.com/ConsenSys/teku/commit/4381bc1dca71cf2a697f8e8b0144c16575024ab0", "committedDate": "2020-04-16T20:54:38Z", "message": "fix dir"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "1d624184ba529574f707e540c0b6db0a1ebf8eb3", "author": {"user": {"login": "NicolasMassart", "name": "Nicolas MASSART"}}, "url": "https://github.com/ConsenSys/teku/commit/1d624184ba529574f707e540c0b6db0a1ebf8eb3", "committedDate": "2020-04-16T21:06:08Z", "message": "use another key"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b8c0a3933365d0302499145e483bb684391c822b", "author": {"user": {"login": "NicolasMassart", "name": "Nicolas MASSART"}}, "url": "https://github.com/ConsenSys/teku/commit/b8c0a3933365d0302499145e483bb684391c822b", "committedDate": "2020-04-16T21:39:27Z", "message": "tests for ssh"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "65d6c133c3b9cadf5d9d6964117ca91e3c74d76c", "author": {"user": {"login": "NicolasMassart", "name": "Nicolas MASSART"}}, "url": "https://github.com/ConsenSys/teku/commit/65d6c133c3b9cadf5d9d6964117ca91e3c74d76c", "committedDate": "2020-04-16T21:40:12Z", "message": "typo"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c14f66f56e87622c0b994a699e0e593459194475", "author": {"user": {"login": "NicolasMassart", "name": "Nicolas MASSART"}}, "url": "https://github.com/ConsenSys/teku/commit/c14f66f56e87622c0b994a699e0e593459194475", "committedDate": "2020-04-16T21:47:29Z", "message": "test outside an executor"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e41e318071fad73d59322e69c670e16e8ea0e17f", "author": {"user": {"login": "NicolasMassart", "name": "Nicolas MASSART"}}, "url": "https://github.com/ConsenSys/teku/commit/e41e318071fad73d59322e69c670e16e8ea0e17f", "committedDate": "2020-04-27T10:08:04Z", "message": "remove branch filter test"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "9d577515ce7ed4b246da92f05e53b75080eb9a5a", "author": {"user": {"login": "NicolasMassart", "name": "Nicolas MASSART"}}, "url": "https://github.com/ConsenSys/teku/commit/9d577515ce7ed4b246da92f05e53b75080eb9a5a", "committedDate": "2020-04-27T10:11:03Z", "message": "fix job in pipeline"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "20552e5b7890bc43d86aad7812fead392e66e5dc", "author": {"user": {"login": "NicolasMassart", "name": "Nicolas MASSART"}}, "url": "https://github.com/ConsenSys/teku/commit/20552e5b7890bc43d86aad7812fead392e66e5dc", "committedDate": "2020-04-27T10:12:04Z", "message": "i'm not serious, need to focus!"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "78b6af4372067611629f92dfe32d3f53764e340a", "author": {"user": {"login": "NicolasMassart", "name": "Nicolas MASSART"}}, "url": "https://github.com/ConsenSys/teku/commit/78b6af4372067611629f92dfe32d3f53764e340a", "committedDate": "2020-04-27T10:13:00Z", "message": "add executor back"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "84f1acf8fdbceaac6329983ede28dcce3fee5995", "author": {"user": {"login": "benjamincburns", "name": "Benjamin Burns"}}, "url": "https://github.com/ConsenSys/teku/commit/84f1acf8fdbceaac6329983ede28dcce3fee5995", "committedDate": "2020-04-28T21:35:05Z", "message": "fix ssh key, debug failing build step\n\nSigned-off-by: Ben Burns <803016+benjamincburns@users.noreply.github.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "0f74710d6d2d931533fd66206f740bef0ab46951", "author": {"user": {"login": "benjamincburns", "name": "Benjamin Burns"}}, "url": "https://github.com/ConsenSys/teku/commit/0f74710d6d2d931533fd66206f740bef0ab46951", "committedDate": "2020-04-28T21:43:54Z", "message": "more fixes for CircleCI API publish config\n\nSigned-off-by: Ben Burns <803016+benjamincburns@users.noreply.github.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "7413f950cd704358c8ed00aac4a3eef5ce204fe4", "author": {"user": {"login": "benjamincburns", "name": "Benjamin Burns"}}, "url": "https://github.com/ConsenSys/teku/commit/7413f950cd704358c8ed00aac4a3eef5ce204fe4", "committedDate": "2020-04-28T22:13:00Z", "message": "gh-pages publish: only add the api.json file"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "7ec042970adf95fcbd4460bcf4e75eaad6d915e1", "author": {"user": {"login": "NicolasMassart", "name": "Nicolas MASSART"}}, "url": "https://github.com/ConsenSys/teku/commit/7ec042970adf95fcbd4460bcf4e75eaad6d915e1", "committedDate": "2020-04-29T10:10:55Z", "message": "debugging"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ab23f03c0f28ee47c6dcbf42ac0547d632bd710a", "author": {"user": {"login": "NicolasMassart", "name": "Nicolas MASSART"}}, "url": "https://github.com/ConsenSys/teku/commit/ab23f03c0f28ee47c6dcbf42ac0547d632bd710a", "committedDate": "2020-04-29T10:14:36Z", "message": "update executor and commit message"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDAzMDM3Nzkx", "url": "https://github.com/ConsenSys/teku/pull/1695#pullrequestreview-403037791", "createdAt": "2020-04-29T21:04:14Z", "commit": {"oid": "ab23f03c0f28ee47c6dcbf42ac0547d632bd710a"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yOVQyMTowNDoxNFrOGOQ7PQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yOVQyMTowNDoxNFrOGOQ7PQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNzYxMDU1Nw==", "bodyText": "Isn't there a race condition here? We'd need to wait until the rest api service has actually started listening.", "url": "https://github.com/ConsenSys/teku/pull/1695#discussion_r417610557", "createdAt": "2020-04-29T21:04:14Z", "author": {"login": "ajsutton"}, "path": ".circleci/config.yml", "diffHunk": "@@ -266,57 +268,101 @@ jobs:\n             docker login --username \"${DOCKER_USER}\" --password \"${DOCKER_PASSWORD}\"\n             ./gradlew --no-daemon --parallel \"-Pbranch=${CIRCLE_BRANCH}\" dockerUpload\n \n+  publishAPIDoc:\n+    executor: medium_executor\n+    steps:\n+      - prepare\n+      - add_ssh_keys:\n+          fingerprints:\n+            - '45:36:58:67:43:15:c6:5f:2c:58:ec:7f:71:e2:e6:ef'\n+      - run:\n+          name: Build runnable Teku binaries\n+          command: |\n+            ./gradlew --no-daemon --parallel installDist\n+      - run:\n+          name: Extract OpenAPI JSON\n+          command: |\n+            build/install/teku/bin/teku --rest-api-docs-enabled=true &\n+            TEKU_PID=$!\n+            wget -O api.json http://localhost:5051/swagger-docs", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ab23f03c0f28ee47c6dcbf42ac0547d632bd710a"}, "originalPosition": 27}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f907c3fb82fd102892e1cf23c3a898174d799b6b", "author": {"user": {"login": "NicolasMassart", "name": "Nicolas MASSART"}}, "url": "https://github.com/ConsenSys/teku/commit/f907c3fb82fd102892e1cf23c3a898174d799b6b", "committedDate": "2020-05-04T09:40:00Z", "message": "test split jobs"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "18d2bf9d291d4b30eae60a3cbea2d4dbe2c077a4", "author": {"user": {"login": "NicolasMassart", "name": "Nicolas MASSART"}}, "url": "https://github.com/ConsenSys/teku/commit/18d2bf9d291d4b30eae60a3cbea2d4dbe2c077a4", "committedDate": "2020-05-04T09:51:18Z", "message": "fix ci"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "d734d0227a9d81fb7404b79a851fb2841a90b74c", "author": {"user": {"login": "NicolasMassart", "name": "Nicolas MASSART"}}, "url": "https://github.com/ConsenSys/teku/commit/d734d0227a9d81fb7404b79a851fb2841a90b74c", "committedDate": "2020-05-04T09:55:20Z", "message": "update path"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "d7807c451940d62225e30526f2e27b2483e36f47", "author": {"user": {"login": "NicolasMassart", "name": "Nicolas MASSART"}}, "url": "https://github.com/ConsenSys/teku/commit/d7807c451940d62225e30526f2e27b2483e36f47", "committedDate": "2020-05-04T14:15:41Z", "message": "ci process"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "0632fe8a358b9310e4ed2274df70c406b6bd7a69", "author": {"user": {"login": "NicolasMassart", "name": "Nicolas MASSART"}}, "url": "https://github.com/ConsenSys/teku/commit/0632fe8a358b9310e4ed2274df70c406b6bd7a69", "committedDate": "2020-05-04T14:19:23Z", "message": "fix typo"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "6c22d2eaa2709129ba6f77df840fa029b33290c7", "author": {"user": {"login": "NicolasMassart", "name": "Nicolas MASSART"}}, "url": "https://github.com/ConsenSys/teku/commit/6c22d2eaa2709129ba6f77df840fa029b33290c7", "committedDate": "2020-05-04T14:41:04Z", "message": "simple checkout"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e9326d49be0633d140845d369eef35b4a455b8c3", "author": {"user": {"login": "NicolasMassart", "name": "Nicolas MASSART"}}, "url": "https://github.com/ConsenSys/teku/commit/e9326d49be0633d140845d369eef35b4a455b8c3", "committedDate": "2020-05-04T15:33:53Z", "message": "uncomment ci"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "8cdcf982519d204d04e4909b3c7f6d0e1b4ff0cf", "author": {"user": {"login": "NicolasMassart", "name": "Nicolas MASSART"}}, "url": "https://github.com/ConsenSys/teku/commit/8cdcf982519d204d04e4909b3c7f6d0e1b4ff0cf", "committedDate": "2020-05-04T15:40:00Z", "message": "update from master\n\nand add TODO to change before merge"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "73e5d32505b7f8029bfd43acdd9f6a573f30f48c", "author": {"user": {"login": "NicolasMassart", "name": "Nicolas MASSART"}}, "url": "https://github.com/ConsenSys/teku/commit/73e5d32505b7f8029bfd43acdd9f6a573f30f48c", "committedDate": "2020-05-04T17:07:15Z", "message": "Merge branch 'master' into publish_openapi_to_gh-pages\n\n# Conflicts:\n#\t.circleci/config.yml"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "2e41ad9d3a4b4c8681b67fb06b67e985225955c8", "author": {"user": {"login": "NicolasMassart", "name": "Nicolas MASSART"}}, "url": "https://github.com/ConsenSys/teku/commit/2e41ad9d3a4b4c8681b67fb06b67e985225955c8", "committedDate": "2020-05-05T11:40:46Z", "message": "Merge branch 'master' into publish_openapi_to_gh-pages"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "dd25ea105f2f6df899e6ac66f3e5d0eac867392a", "author": {"user": {"login": "NicolasMassart", "name": "Nicolas MASSART"}}, "url": "https://github.com/ConsenSys/teku/commit/dd25ea105f2f6df899e6ac66f3e5d0eac867392a", "committedDate": "2020-05-07T14:57:58Z", "message": "use a testnet to be able to start Teku\n\nbypass #1720"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "7ec3a09ec0ef2a456d2c1eca42cf772f812c89bd", "author": {"user": {"login": "NicolasMassart", "name": "Nicolas MASSART"}}, "url": "https://github.com/ConsenSys/teku/commit/7ec3a09ec0ef2a456d2c1eca42cf772f812c89bd", "committedDate": "2020-05-07T14:58:10Z", "message": "Merge branch 'master' into publish_openapi_to_gh-pages"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "eda07962f228e60e1ae1199b0633fcdfcf2c3f83", "author": {"user": {"login": "NicolasMassart", "name": "Nicolas MASSART"}}, "url": "https://github.com/ConsenSys/teku/commit/eda07962f228e60e1ae1199b0633fcdfcf2c3f83", "committedDate": "2020-05-07T15:35:11Z", "message": "update commit message to show it's from CI"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "360239e2fc456f2dc3449a2a4a8d90a6e35eca98", "author": {"user": {"login": "NicolasMassart", "name": "Nicolas MASSART"}}, "url": "https://github.com/ConsenSys/teku/commit/360239e2fc456f2dc3449a2a4a8d90a6e35eca98", "committedDate": "2020-05-07T19:04:19Z", "message": "try tag filter"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "8a52655d61bca8b018bc010a2e4bd5da5ad9814d", "author": {"user": {"login": "NicolasMassart", "name": "Nicolas MASSART"}}, "url": "https://github.com/ConsenSys/teku/commit/8a52655d61bca8b018bc010a2e4bd5da5ad9814d", "committedDate": "2020-05-07T21:27:29Z", "message": "Update commit message to include CI infos"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "9793f62b147202b6d594e4e3cac00e95f8cc93d9", "author": {"user": {"login": "NicolasMassart", "name": "Nicolas MASSART"}}, "url": "https://github.com/ConsenSys/teku/commit/9793f62b147202b6d594e4e3cac00e95f8cc93d9", "committedDate": "2020-05-07T21:57:43Z", "message": "make sure doc is updated only if everything works\n\nextract and publish API doc only if all tests and publishing worked\notherwise it could be updated even if some tests fails and teku is\nnot published"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "08e639b88cedb74bf5fd2a8772ba25dee9d3abda", "author": {"user": {"login": "NicolasMassart", "name": "Nicolas MASSART"}}, "url": "https://github.com/ConsenSys/teku/commit/08e639b88cedb74bf5fd2a8772ba25dee9d3abda", "committedDate": "2020-05-07T22:05:32Z", "message": "Merge branch 'master' into publish_openapi_to_gh-pages"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "174ea6f4132dd0479052775dc7676824d900ea97", "author": {"user": {"login": "NicolasMassart", "name": "Nicolas MASSART"}}, "url": "https://github.com/ConsenSys/teku/commit/174ea6f4132dd0479052775dc7676824d900ea97", "committedDate": "2020-05-07T22:09:54Z", "message": "make changes ready to merge on master\n\n[skip ci] as we don't want the branch push to update the real doc\nthe update will be triggered when merged on master.\nThe tag part (creating a version when a tag is created) is not yet\navailable. Only the latest will be built automatically for the\nmoment until this tag CI part is solved. Until then at least we will\nhave the master updating the latest doc version. If needed a named\nversion can be generated manually until we figure this out."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c7a5017d67753d86844ea4a2ca9a0c5b33d9ffdb", "author": {"user": {"login": "NicolasMassart", "name": "Nicolas MASSART"}}, "url": "https://github.com/ConsenSys/teku/commit/c7a5017d67753d86844ea4a2ca9a0c5b33d9ffdb", "committedDate": "2020-05-07T22:13:33Z", "message": "small change to update CI\n\nI tried not to fire ci in the previous commit but CI status is needed\nIt will update the doc but as this branch is up to date with master\nit's ok and even a good live test.\nDoc rollback is easy in case of issue."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "d122cd2444f59f1a6cb5056aee4345e1ffea2ddb", "author": {"user": {"login": "NicolasMassart", "name": "Nicolas MASSART"}}, "url": "https://github.com/ConsenSys/teku/commit/d122cd2444f59f1a6cb5056aee4345e1ffea2ddb", "committedDate": "2020-05-07T22:15:44Z", "message": "fix typo\n\nbadly typed save shortcut ctrl+s added an \"s\""}}, {"__typename": "PullRequestCommit", "commit": {"oid": "5cbc8f630052b7274e4d5676007ef7f1a36ace36", "author": {"user": {"login": "NicolasMassart", "name": "Nicolas MASSART"}}, "url": "https://github.com/ConsenSys/teku/commit/5cbc8f630052b7274e4d5676007ef7f1a36ace36", "committedDate": "2020-05-11T09:57:00Z", "message": "Merge branch 'master' into publish_openapi_to_gh-pages"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDA5NzE4OTkw", "url": "https://github.com/ConsenSys/teku/pull/1695#pullrequestreview-409718990", "createdAt": "2020-05-12T05:58:10Z", "commit": {"oid": "5cbc8f630052b7274e4d5676007ef7f1a36ace36"}, "state": "COMMENTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xMlQwNTo1ODoxMFrOGT3HXQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xMlQwNTo1OTowOVrOGT3Iqw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMzQ3OTEzMw==", "bodyText": "This has a race condition because Teku won't be listening the instant it's started.  We need something to retry for a period until the API is actually listening.  I would suggest splitting the script to do that into it's own file so that the circleci config stays as focussed on circleci specific stuff as possible.", "url": "https://github.com/ConsenSys/teku/pull/1695#discussion_r423479133", "createdAt": "2020-05-12T05:58:10Z", "author": {"login": "ajsutton"}, "path": ".circleci/config.yml", "diffHunk": "@@ -266,6 +272,76 @@ jobs:\n             docker login --username \"${DOCKER_USER}\" --password \"${DOCKER_PASSWORD}\"\n             ./gradlew --no-daemon --parallel \"-Pbranch=${CIRCLE_BRANCH}\" dockerUpload\n \n+  extractAPISpec:\n+    executor: medium_executor\n+    steps:\n+      - prepare\n+      - attach_workspace:\n+          at: ~/project\n+      - run:\n+          name: Build runnable Teku binaries\n+          command: |\n+            ./gradlew --no-daemon --parallel installDist\n+      - run:\n+          name: Extract OpenAPI JSON\n+          command: |\n+            build/install/teku/bin/teku --network=schlesi --rest-api-docs-enabled=true &\n+            TEKU_PID=$!\n+            wget -O openapi.json http://localhost:5051/swagger-docs\n+            kill $TEKU_PID", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "5cbc8f630052b7274e4d5676007ef7f1a36ace36"}, "originalPosition": 38}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMzQ3OTQ2Nw==", "bodyText": "Would this be:\ngit checkout \"$BRANCH\" && git pull || git checkout -b \"$BRANCH\"\nie only pull the branch if it already existed.", "url": "https://github.com/ConsenSys/teku/pull/1695#discussion_r423479467", "createdAt": "2020-05-12T05:59:09Z", "author": {"login": "ajsutton"}, "path": ".circleci/config.yml", "diffHunk": "@@ -266,6 +272,76 @@ jobs:\n             docker login --username \"${DOCKER_USER}\" --password \"${DOCKER_PASSWORD}\"\n             ./gradlew --no-daemon --parallel \"-Pbranch=${CIRCLE_BRANCH}\" dockerUpload\n \n+  extractAPISpec:\n+    executor: medium_executor\n+    steps:\n+      - prepare\n+      - attach_workspace:\n+          at: ~/project\n+      - run:\n+          name: Build runnable Teku binaries\n+          command: |\n+            ./gradlew --no-daemon --parallel installDist\n+      - run:\n+          name: Extract OpenAPI JSON\n+          command: |\n+            build/install/teku/bin/teku --network=schlesi --rest-api-docs-enabled=true &\n+            TEKU_PID=$!\n+            wget -O openapi.json http://localhost:5051/swagger-docs\n+            kill $TEKU_PID\n+      - persist_to_workspace:\n+          root: ~/project\n+          paths:\n+            - ./\n+\n+  publishAPIDoc:\n+    executor: node_executor\n+    steps:\n+      - checkout\n+      - attach_workspace:\n+          at: /tmp/project\n+      - add_ssh_keys:\n+          fingerprints:\n+            - '45:36:58:67:43:15:c6:5f:2c:58:ec:7f:71:e2:e6:ef'\n+      - run:\n+          name: Set Git user params\n+          command: |\n+            git config --global user.name $CIRCLE_USERNAME\n+            git config --global user.email \"${CIRCLE_USERNAME}@users.noreply.github.com\"\n+      - run:\n+          name: Chechout GitHub Pages branch\n+          command: |\n+            readonly BRANCH='gh-pages'\n+            git checkout \"$BRANCH\" || git checkout -b \"$BRANCH\"\n+            # pull might fail if the branch was just created\n+            git pull || true", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "5cbc8f630052b7274e4d5676007ef7f1a36ace36"}, "originalPosition": 64}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "3854fc213e52fd84d56ec634731f7478bf99dbf8", "author": {"user": {"login": "NicolasMassart", "name": "Nicolas MASSART"}}, "url": "https://github.com/ConsenSys/teku/commit/3854fc213e52fd84d56ec634731f7478bf99dbf8", "committedDate": "2020-05-14T07:14:42Z", "message": "Merge branch 'master' into publish_openapi_to_gh-pages"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "34f2c606ea1ecc2c6fe22ec1b69deae38e3bd897", "author": {"user": {"login": "NicolasMassart", "name": "Nicolas MASSART"}}, "url": "https://github.com/ConsenSys/teku/commit/34f2c606ea1ecc2c6fe22ec1b69deae38e3bd897", "committedDate": "2020-05-15T21:34:51Z", "message": "update checkout per @benjamincburns comments"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "3d157ecd5824279a22da4a906ee0867a0c8f4822", "author": {"user": {"login": "NicolasMassart", "name": "Nicolas MASSART"}}, "url": "https://github.com/ConsenSys/teku/commit/3d157ecd5824279a22da4a906ee0867a0c8f4822", "committedDate": "2020-05-15T22:04:17Z", "message": "Merge branch 'master' into publish_openapi_to_gh-pages"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDEzMDUxNDg4", "url": "https://github.com/ConsenSys/teku/pull/1695#pullrequestreview-413051488", "createdAt": "2020-05-16T06:07:11Z", "commit": {"oid": "3d157ecd5824279a22da4a906ee0867a0c8f4822"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ed35eabdf107e1bbbdf74dffc0c92ee00c882876", "author": {"user": {"login": "NicolasMassart", "name": "Nicolas MASSART"}}, "url": "https://github.com/ConsenSys/teku/commit/ed35eabdf107e1bbbdf74dffc0c92ee00c882876", "committedDate": "2020-05-18T07:15:20Z", "message": "Merge branch 'master' into publish_openapi_to_gh-pages"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4140, "cost": 1, "resetAt": "2021-11-01T13:51:04Z"}}}