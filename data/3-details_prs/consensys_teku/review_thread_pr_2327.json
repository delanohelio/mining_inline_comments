{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDQ2MzA2OTA5", "number": 2327, "reviewThreads": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wOFQxOTo1NzoyNFrOEMomkw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wOFQyMDowMDoyOFrOEMoqcA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjgxNjgzNjAzOnYy", "diffSide": "RIGHT", "path": "services/beaconchain/src/main/java/tech/pegasys/teku/services/beaconchain/BeaconChainController.java", "isResolved": true, "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wOFQxOTo1NzoyNFrOGu3KNQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xNFQxNToxMzoyM1rOGxYXQQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MTc5MTQxMw==", "bodyText": "We shouldn't be using Instant.now() here - I think date.getTime() was right.", "url": "https://github.com/ConsenSys/teku/pull/2327#discussion_r451791413", "createdAt": "2020-07-08T19:57:24Z", "author": {"login": "ajsutton"}, "path": "services/beaconchain/src/main/java/tech/pegasys/teku/services/beaconchain/BeaconChainController.java", "diffHunk": "@@ -524,7 +525,7 @@ public void onTick(Date date) {\n     if (recentChainData.isPreGenesis()) {\n       return;\n     }\n-    final UnsignedLong currentTime = UnsignedLong.valueOf(date.getTime() / 1000);\n+    final UnsignedLong currentTime = UnsignedLong.valueOf(Instant.now().getEpochSecond());", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "582bf13ca624683687166b49bf09fac08d3b37da"}, "originalPosition": 22}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MTg3ODM4MA==", "bodyText": "Both Instant.now() usages can actually be replaced with timeProvider.getTimeInSeconds() which avoids any need to convert millis to seconds and still uses our abstraction for time.", "url": "https://github.com/ConsenSys/teku/pull/2327#discussion_r451878380", "createdAt": "2020-07-08T23:24:04Z", "author": {"login": "ajsutton"}, "path": "services/beaconchain/src/main/java/tech/pegasys/teku/services/beaconchain/BeaconChainController.java", "diffHunk": "@@ -524,7 +525,7 @@ public void onTick(Date date) {\n     if (recentChainData.isPreGenesis()) {\n       return;\n     }\n-    final UnsignedLong currentTime = UnsignedLong.valueOf(date.getTime() / 1000);\n+    final UnsignedLong currentTime = UnsignedLong.valueOf(Instant.now().getEpochSecond());", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MTc5MTQxMw=="}, "originalCommit": {"oid": "582bf13ca624683687166b49bf09fac08d3b37da"}, "originalPosition": 22}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NDQzMjU3Nw==", "bodyText": "Makes a lot of sense \ud83d\udc4d", "url": "https://github.com/ConsenSys/teku/pull/2327#discussion_r454432577", "createdAt": "2020-07-14T15:13:23Z", "author": {"login": "cemozerr"}, "path": "services/beaconchain/src/main/java/tech/pegasys/teku/services/beaconchain/BeaconChainController.java", "diffHunk": "@@ -524,7 +525,7 @@ public void onTick(Date date) {\n     if (recentChainData.isPreGenesis()) {\n       return;\n     }\n-    final UnsignedLong currentTime = UnsignedLong.valueOf(date.getTime() / 1000);\n+    final UnsignedLong currentTime = UnsignedLong.valueOf(Instant.now().getEpochSecond());", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MTc5MTQxMw=="}, "originalCommit": {"oid": "582bf13ca624683687166b49bf09fac08d3b37da"}, "originalPosition": 22}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjgxNjg0MjQyOnYy", "diffSide": "RIGHT", "path": "logging/src/main/java/tech/pegasys/teku/logging/StatusLogger.java", "isResolved": true, "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wOFQxOTo1OToyNFrOGu3ORA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xNFQxNToxODozNFrOGxYl0A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MTc5MjQ1Mg==", "bodyText": "This doesn't feel like the right solution - I suspect we just needed to specify UTC as the timezone in the call to DateFormatUtils:\n\n  \n    \n  \n    \n\n  \n  This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters. Learn more about bidirectional Unicode characters\n\n\n  \n\n\n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                long hours = timeToGenesis / 3600;\n          \n          \n            \n                long minutes = (timeToGenesis % 3600) / 60;\n          \n          \n            \n                long seconds = timeToGenesis % 60;\n          \n          \n            \n                String timeString = String.format(\"%02d:%02d:%02d\", hours, minutes, seconds);\n          \n          \n            \n                log.info(\"{} until genesis time is reached\", timeString);\n          \n          \n            \n                log.info(\"{} until genesis time is reached\", () -> DateFormatUtils.formatUTC(timeToGenesis * 1000, \"hh:mm:ss\");", "url": "https://github.com/ConsenSys/teku/pull/2327#discussion_r451792452", "createdAt": "2020-07-08T19:59:24Z", "author": {"login": "ajsutton"}, "path": "logging/src/main/java/tech/pegasys/teku/logging/StatusLogger.java", "diffHunk": "@@ -105,9 +105,11 @@ public void generatingMockStartGenesis(final long genesisTime, final int size) {\n   }\n \n   public void timeUntilGenesis(final long timeToGenesis) {\n-    log.info(\n-        \"{} until genesis time is reached\",\n-        () -> DateFormatUtils.format(timeToGenesis * 1000, \"hh:mm:ss\"));\n+    long hours = timeToGenesis / 3600;\n+    long minutes = (timeToGenesis % 3600) / 60;\n+    long seconds = timeToGenesis % 60;\n+    String timeString = String.format(\"%02d:%02d:%02d\", hours, minutes, seconds);\n+    log.info(\"{} until genesis time is reached\", timeString);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "582bf13ca624683687166b49bf09fac08d3b37da"}, "originalPosition": 11}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MTg3NzQwMQ==", "bodyText": "Sorry I'm wrong about this.  The problem is we're trying to use a time formatter to format a duration.  We should be using DurationFormatUtils not DateFormatUtils.  Personally I quite like formatWords version:\n        () -> DurationFormatUtils.formatDurationWords(timeToGenesis * 1000, true, true));\n\nwhich gives:\n1157 days 12 hours 27 minutes 20 seconds until genesis time is reached\nor\n4 seconds until genesis time is reached", "url": "https://github.com/ConsenSys/teku/pull/2327#discussion_r451877401", "createdAt": "2020-07-08T23:21:05Z", "author": {"login": "ajsutton"}, "path": "logging/src/main/java/tech/pegasys/teku/logging/StatusLogger.java", "diffHunk": "@@ -105,9 +105,11 @@ public void generatingMockStartGenesis(final long genesisTime, final int size) {\n   }\n \n   public void timeUntilGenesis(final long timeToGenesis) {\n-    log.info(\n-        \"{} until genesis time is reached\",\n-        () -> DateFormatUtils.format(timeToGenesis * 1000, \"hh:mm:ss\"));\n+    long hours = timeToGenesis / 3600;\n+    long minutes = (timeToGenesis % 3600) / 60;\n+    long seconds = timeToGenesis % 60;\n+    String timeString = String.format(\"%02d:%02d:%02d\", hours, minutes, seconds);\n+    log.info(\"{} until genesis time is reached\", timeString);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MTc5MjQ1Mg=="}, "originalCommit": {"oid": "582bf13ca624683687166b49bf09fac08d3b37da"}, "originalPosition": 11}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NDQzNjMwNA==", "bodyText": "Done.", "url": "https://github.com/ConsenSys/teku/pull/2327#discussion_r454436304", "createdAt": "2020-07-14T15:18:34Z", "author": {"login": "cemozerr"}, "path": "logging/src/main/java/tech/pegasys/teku/logging/StatusLogger.java", "diffHunk": "@@ -105,9 +105,11 @@ public void generatingMockStartGenesis(final long genesisTime, final int size) {\n   }\n \n   public void timeUntilGenesis(final long timeToGenesis) {\n-    log.info(\n-        \"{} until genesis time is reached\",\n-        () -> DateFormatUtils.format(timeToGenesis * 1000, \"hh:mm:ss\"));\n+    long hours = timeToGenesis / 3600;\n+    long minutes = (timeToGenesis % 3600) / 60;\n+    long seconds = timeToGenesis % 60;\n+    String timeString = String.format(\"%02d:%02d:%02d\", hours, minutes, seconds);\n+    log.info(\"{} until genesis time is reached\", timeString);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MTc5MjQ1Mg=="}, "originalCommit": {"oid": "582bf13ca624683687166b49bf09fac08d3b37da"}, "originalPosition": 11}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjgxNjg0NTkyOnYy", "diffSide": "RIGHT", "path": "services/beaconchain/src/main/java/tech/pegasys/teku/services/beaconchain/BeaconChainController.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wOFQyMDowMDoyOFrOGu3QbQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xNFQxNToxODoyOFrOGxYljA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MTc5MzAwNQ==", "bodyText": "Would be nice to avoid using Instant.now() here and get the time via TimeProvider if possible but if it's not available I can live with it since it was already using System.currentTimeMillis.  No real reason I can see to change this though.", "url": "https://github.com/ConsenSys/teku/pull/2327#discussion_r451793005", "createdAt": "2020-07-08T20:00:28Z", "author": {"login": "ajsutton"}, "path": "services/beaconchain/src/main/java/tech/pegasys/teku/services/beaconchain/BeaconChainController.java", "diffHunk": "@@ -506,7 +507,7 @@ private void setupInitialState() {\n \n   private void onStoreInitialized() {\n     UnsignedLong genesisTime = recentChainData.getGenesisTime();\n-    UnsignedLong currentTime = UnsignedLong.valueOf(System.currentTimeMillis() / 1000);\n+    UnsignedLong currentTime = UnsignedLong.valueOf(Instant.now().getEpochSecond());", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "582bf13ca624683687166b49bf09fac08d3b37da"}, "originalPosition": 13}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NDQzNjIzNg==", "bodyText": "Switching to timeProvider.", "url": "https://github.com/ConsenSys/teku/pull/2327#discussion_r454436236", "createdAt": "2020-07-14T15:18:28Z", "author": {"login": "cemozerr"}, "path": "services/beaconchain/src/main/java/tech/pegasys/teku/services/beaconchain/BeaconChainController.java", "diffHunk": "@@ -506,7 +507,7 @@ private void setupInitialState() {\n \n   private void onStoreInitialized() {\n     UnsignedLong genesisTime = recentChainData.getGenesisTime();\n-    UnsignedLong currentTime = UnsignedLong.valueOf(System.currentTimeMillis() / 1000);\n+    UnsignedLong currentTime = UnsignedLong.valueOf(Instant.now().getEpochSecond());", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MTc5MzAwNQ=="}, "originalCommit": {"oid": "582bf13ca624683687166b49bf09fac08d3b37da"}, "originalPosition": 13}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3529, "cost": 1, "resetAt": "2021-11-12T11:57:46Z"}}}