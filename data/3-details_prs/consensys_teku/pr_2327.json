{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDQ2MzA2OTA5", "number": 2327, "title": "Fix incorrect genesis time issue", "bodyText": "PR Description\nFix incorrect genesis time issue\nFixed Issue(s)\n\n\nFixes #2323\nDocumentation\n\n I thought about documentation and added the documentation label to this PR if updates are required.", "createdAt": "2020-07-08T15:08:10Z", "url": "https://github.com/ConsenSys/teku/pull/2327", "merged": true, "mergeCommit": {"oid": "a03ae8c00b2f77509ebe7ef50b20eb720e61de75"}, "closed": true, "closedAt": "2020-07-14T15:40:13Z", "author": {"login": "cemozerr"}, "timelineItems": {"totalCount": 5, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcy_UR-AFqTQ0NTA1MzI0MQ==", "endCursor": "Y3Vyc29yOnYyOpPPAAABc03wHugH2gAyNDQ2MzA2OTA5OjQ2Nzc5OWRhZTU2NzRkNWUyZThiMmRhMWE5NzY5YjQ3MjE0ZGJmZDQ=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDQ1MDUzMjQx", "url": "https://github.com/ConsenSys/teku/pull/2327#pullrequestreview-445053241", "createdAt": "2020-07-08T19:08:28Z", "commit": {"oid": "582bf13ca624683687166b49bf09fac08d3b37da"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDQ1MDg1MTk1", "url": "https://github.com/ConsenSys/teku/pull/2327#pullrequestreview-445085195", "createdAt": "2020-07-08T19:57:24Z", "commit": {"oid": "582bf13ca624683687166b49bf09fac08d3b37da"}, "state": "COMMENTED", "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wOFQxOTo1NzoyNFrOGu3KNQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wOFQyMDowMDoyOFrOGu3QbQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MTc5MTQxMw==", "bodyText": "We shouldn't be using Instant.now() here - I think date.getTime() was right.", "url": "https://github.com/ConsenSys/teku/pull/2327#discussion_r451791413", "createdAt": "2020-07-08T19:57:24Z", "author": {"login": "ajsutton"}, "path": "services/beaconchain/src/main/java/tech/pegasys/teku/services/beaconchain/BeaconChainController.java", "diffHunk": "@@ -524,7 +525,7 @@ public void onTick(Date date) {\n     if (recentChainData.isPreGenesis()) {\n       return;\n     }\n-    final UnsignedLong currentTime = UnsignedLong.valueOf(date.getTime() / 1000);\n+    final UnsignedLong currentTime = UnsignedLong.valueOf(Instant.now().getEpochSecond());", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "582bf13ca624683687166b49bf09fac08d3b37da"}, "originalPosition": 22}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MTc5MjQ1Mg==", "bodyText": "This doesn't feel like the right solution - I suspect we just needed to specify UTC as the timezone in the call to DateFormatUtils:\n\n  \n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                long hours = timeToGenesis / 3600;\n          \n          \n            \n                long minutes = (timeToGenesis % 3600) / 60;\n          \n          \n            \n                long seconds = timeToGenesis % 60;\n          \n          \n            \n                String timeString = String.format(\"%02d:%02d:%02d\", hours, minutes, seconds);\n          \n          \n            \n                log.info(\"{} until genesis time is reached\", timeString);\n          \n          \n            \n                log.info(\"{} until genesis time is reached\", () -> DateFormatUtils.formatUTC(timeToGenesis * 1000, \"hh:mm:ss\");", "url": "https://github.com/ConsenSys/teku/pull/2327#discussion_r451792452", "createdAt": "2020-07-08T19:59:24Z", "author": {"login": "ajsutton"}, "path": "logging/src/main/java/tech/pegasys/teku/logging/StatusLogger.java", "diffHunk": "@@ -105,9 +105,11 @@ public void generatingMockStartGenesis(final long genesisTime, final int size) {\n   }\n \n   public void timeUntilGenesis(final long timeToGenesis) {\n-    log.info(\n-        \"{} until genesis time is reached\",\n-        () -> DateFormatUtils.format(timeToGenesis * 1000, \"hh:mm:ss\"));\n+    long hours = timeToGenesis / 3600;\n+    long minutes = (timeToGenesis % 3600) / 60;\n+    long seconds = timeToGenesis % 60;\n+    String timeString = String.format(\"%02d:%02d:%02d\", hours, minutes, seconds);\n+    log.info(\"{} until genesis time is reached\", timeString);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "582bf13ca624683687166b49bf09fac08d3b37da"}, "originalPosition": 11}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MTc5MzAwNQ==", "bodyText": "Would be nice to avoid using Instant.now() here and get the time via TimeProvider if possible but if it's not available I can live with it since it was already using System.currentTimeMillis.  No real reason I can see to change this though.", "url": "https://github.com/ConsenSys/teku/pull/2327#discussion_r451793005", "createdAt": "2020-07-08T20:00:28Z", "author": {"login": "ajsutton"}, "path": "services/beaconchain/src/main/java/tech/pegasys/teku/services/beaconchain/BeaconChainController.java", "diffHunk": "@@ -506,7 +507,7 @@ private void setupInitialState() {\n \n   private void onStoreInitialized() {\n     UnsignedLong genesisTime = recentChainData.getGenesisTime();\n-    UnsignedLong currentTime = UnsignedLong.valueOf(System.currentTimeMillis() / 1000);\n+    UnsignedLong currentTime = UnsignedLong.valueOf(Instant.now().getEpochSecond());", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "582bf13ca624683687166b49bf09fac08d3b37da"}, "originalPosition": 13}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "6da1921568cfacd2a1afffb605001bc90f30ae43", "author": {"user": {"login": "cemozerr", "name": "Cem Ozer"}}, "url": "https://github.com/ConsenSys/teku/commit/6da1921568cfacd2a1afffb605001bc90f30ae43", "committedDate": "2020-07-14T15:23:22Z", "message": "Fix incorrect genesis time issue"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "582bf13ca624683687166b49bf09fac08d3b37da", "author": {"user": {"login": "cemozerr", "name": "Cem Ozer"}}, "url": "https://github.com/ConsenSys/teku/commit/582bf13ca624683687166b49bf09fac08d3b37da", "committedDate": "2020-07-08T15:08:19Z", "message": "Merge branch 'master' into fixIncorrectGenesisTimeIssue"}, "afterCommit": {"oid": "6da1921568cfacd2a1afffb605001bc90f30ae43", "author": {"user": {"login": "cemozerr", "name": "Cem Ozer"}}, "url": "https://github.com/ConsenSys/teku/commit/6da1921568cfacd2a1afffb605001bc90f30ae43", "committedDate": "2020-07-14T15:23:22Z", "message": "Fix incorrect genesis time issue"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "467799dae5674d5e2e8b2da1a9769b47214dbfd4", "author": {"user": {"login": "cemozerr", "name": "Cem Ozer"}}, "url": "https://github.com/ConsenSys/teku/commit/467799dae5674d5e2e8b2da1a9769b47214dbfd4", "committedDate": "2020-07-14T15:27:29Z", "message": "Run spotless"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3821, "cost": 1, "resetAt": "2021-11-01T13:51:04Z"}}}