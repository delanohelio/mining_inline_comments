{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0Mzk2NzE5OTMy", "number": 1516, "title": "Modify allOf to capture all errors thrown by the futures", "bodyText": "PR Description\nNormally when some futures fail, allOf will return a failed future with a CompletionException that has a root cause of one of those errors.  The other errors are silently ignored.\nThis modified SafeFuture so that when allOf encounters errors, any errors that would have been silently ignored are added as suppressed exceptions to the CompletionException.", "createdAt": "2020-04-01T02:22:36Z", "url": "https://github.com/ConsenSys/teku/pull/1516", "merged": true, "mergeCommit": {"oid": "85cc409127c5ee810a99c90578c8e5be2e8cad3e"}, "closed": true, "closedAt": "2020-04-01T03:05:32Z", "author": {"login": "ajsutton"}, "timelineItems": {"totalCount": 5, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcTOH4DgH2gAyMzk2NzE5OTMyOjc1MDI0ODE4M2QwYTNlMzhjYzRiM2Q3N2Q2ODc1M2Y5NWQwYjZjOWI=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcTOuKQAFqTM4NTIzNTIzOQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "750248183d0a3e38cc4b3d77d68753f95d0b6c9b", "author": {"user": {"login": "ajsutton", "name": "Adrian Sutton"}}, "url": "https://github.com/ConsenSys/teku/commit/750248183d0a3e38cc4b3d77d68753f95d0b6c9b", "committedDate": "2020-04-01T02:17:55Z", "message": "Modify allOf to capture all errors thrown by the futures, not just the first."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "02142b4425fc690e631138237a7bb105da2c8be5", "author": {"user": {"login": "ajsutton", "name": "Adrian Sutton"}}, "url": "https://github.com/ConsenSys/teku/commit/02142b4425fc690e631138237a7bb105da2c8be5", "committedDate": "2020-04-01T02:22:16Z", "message": "Add a success test."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzg1MjM0NDY1", "url": "https://github.com/ConsenSys/teku/pull/1516#pullrequestreview-385234465", "createdAt": "2020-04-01T02:56:56Z", "commit": {"oid": "02142b4425fc690e631138237a7bb105da2c8be5"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wMVQwMjo1Njo1NlrOF-vHvA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wMVQwMjo1Njo1NlrOF-vHvA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMTMyODA2MA==", "bodyText": "lol", "url": "https://github.com/ConsenSys/teku/pull/1516#discussion_r401328060", "createdAt": "2020-04-01T02:56:56Z", "author": {"login": "cemozerr"}, "path": "util/src/test/java/tech/pegasys/artemis/util/async/SafeFutureTest.java", "diffHunk": "@@ -485,6 +485,45 @@ public void fromRunnable_propagatesExceptionalResult() {\n     assertExceptionallyCompletedWith(future, error);\n   }\n \n+  @Test\n+  public void allOf_shouldAddAllSuppressedExceptions() {\n+    final Throwable error1 = new RuntimeException(\"Nope\");\n+    final Throwable error2 = new RuntimeException(\"Oh dear\");", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "02142b4425fc690e631138237a7bb105da2c8be5"}, "originalPosition": 7}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzg1MjM1MTk2", "url": "https://github.com/ConsenSys/teku/pull/1516#pullrequestreview-385235196", "createdAt": "2020-04-01T02:59:36Z", "commit": {"oid": "02142b4425fc690e631138237a7bb105da2c8be5"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wMVQwMjo1OTozNlrOF-vKVA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wMVQwMjo1OTozNlrOF-vKVA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMTMyODcyNA==", "bodyText": "What makes the error1 the root cause here and not the error2?", "url": "https://github.com/ConsenSys/teku/pull/1516#discussion_r401328724", "createdAt": "2020-04-01T02:59:36Z", "author": {"login": "cemozerr"}, "path": "util/src/test/java/tech/pegasys/artemis/util/async/SafeFutureTest.java", "diffHunk": "@@ -485,6 +485,45 @@ public void fromRunnable_propagatesExceptionalResult() {\n     assertExceptionallyCompletedWith(future, error);\n   }\n \n+  @Test\n+  public void allOf_shouldAddAllSuppressedExceptions() {\n+    final Throwable error1 = new RuntimeException(\"Nope\");\n+    final Throwable error2 = new RuntimeException(\"Oh dear\");\n+    final SafeFuture<Void> future1 = new SafeFuture<>();\n+    final SafeFuture<Void> future2 = new SafeFuture<>();\n+    final SafeFuture<Void> future3 = new SafeFuture<>();\n+\n+    final SafeFuture<Void> result = SafeFuture.allOf(future1, future2, future3);\n+    assertThat(result).isNotDone();\n+\n+    future2.completeExceptionally(error2);\n+    assertThat(result).isNotDone();\n+\n+    future3.complete(null);\n+    assertThat(result).isNotDone();\n+\n+    future1.completeExceptionally(error1);\n+\n+    assertThat(result).isCompletedExceptionally();\n+    assertThatThrownBy(result::join).hasSuppressedException(error2);\n+    assertThatThrownBy(result::join).hasRootCause(error1);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "02142b4425fc690e631138237a7bb105da2c8be5"}, "originalPosition": 25}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzg1MjM1MjM5", "url": "https://github.com/ConsenSys/teku/pull/1516#pullrequestreview-385235239", "createdAt": "2020-04-01T02:59:44Z", "commit": {"oid": "02142b4425fc690e631138237a7bb105da2c8be5"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4436, "cost": 1, "resetAt": "2021-11-01T13:51:04Z"}}}