{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTE1NTY1NTM4", "number": 3151, "title": "Check equality of proposer slashing signed block header messages", "bodyText": "PR Description\nFix minor state transition bug: check equality of headers's messages during process_proposer_slashings.\nFixed Issue(s)\n\n\nsigp/beacon-fuzz#90\nDocumentation\n\n I thought about documentation and added the documentation label to this PR if updates are required.", "createdAt": "2020-11-04T18:29:03Z", "url": "https://github.com/ConsenSys/teku/pull/3151", "merged": true, "mergeCommit": {"oid": "7a99cae582f1b6dde421e96b77606a483a6ea37d"}, "closed": true, "closedAt": "2020-11-05T14:16:22Z", "author": {"login": "cemozerr"}, "timelineItems": {"totalCount": 11, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdZSCjGgH2gAyNTE1NTY1NTM4OjRhMmYzNjA4MTdlNmY4MTliMTEwNjRkYmMyMDJjNGQ5Mzk0MWQ4MjY=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdZinHFAH2gAyNTE1NTY1NTM4OmNlMDg1NDk2YzI3NjQwYTIwN2I3OGVlMGNjZTcxOGFhNTZiNjUyMGE=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "4a2f360817e6f819b11064dbc202c4d93941d826", "author": {"user": {"login": "cemozerr", "name": "Cem Ozer"}}, "url": "https://github.com/ConsenSys/teku/commit/4a2f360817e6f819b11064dbc202c4d93941d826", "committedDate": "2020-11-04T18:26:25Z", "message": "Check equality of proposer slashing signed block header messages"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "2fe1e26b7287852895e8bd7700f9bef35cf83cab", "author": {"user": {"login": "cemozerr", "name": "Cem Ozer"}}, "url": "https://github.com/ConsenSys/teku/commit/2fe1e26b7287852895e8bd7700f9bef35cf83cab", "committedDate": "2020-11-04T18:31:54Z", "message": "Run spotless"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f19619d5e802fa10d8797cfeab9c789191d82169", "author": {"user": {"login": "cemozerr", "name": "Cem Ozer"}}, "url": "https://github.com/ConsenSys/teku/commit/f19619d5e802fa10d8797cfeab9c789191d82169", "committedDate": "2020-11-04T18:32:07Z", "message": "Merge branch 'master' into fixMinorStateTransitionBug"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTIzNjQ1NzI1", "url": "https://github.com/ConsenSys/teku/pull/3151#pullrequestreview-523645725", "createdAt": "2020-11-04T18:52:51Z", "commit": {"oid": "f19619d5e802fa10d8797cfeab9c789191d82169"}, "state": "APPROVED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wNFQxODo1Mjo1MVrOHtlang==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wNFQxODo1ODowM1rOHtlm3g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNzU2MDk5MA==", "bodyText": "(nit) We can simplify:\n\n  \n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                            !Objects.equals(\n          \n          \n            \n                                proposerSlashing.getHeader_1().getMessage(),\n          \n          \n            \n                                proposerSlashing.getHeader_2().getMessage()),\n          \n          \n            \n                            !Objects.equals(\n          \n          \n            \n                                header1.getMessage(),\n          \n          \n            \n                                header2.getMessage()),", "url": "https://github.com/ConsenSys/teku/pull/3151#discussion_r517560990", "createdAt": "2020-11-04T18:52:51Z", "author": {"login": "mbaxter"}, "path": "ethereum/core/src/main/java/tech/pegasys/teku/core/operationvalidators/ProposerSlashingStateTransitionValidator.java", "diffHunk": "@@ -45,7 +45,9 @@\n                 ProposerSlashingInvalidReason.PROPOSER_INDICES_DIFFERENT),\n         () ->\n             check(\n-                !Objects.equals(proposerSlashing.getHeader_1(), proposerSlashing.getHeader_2()),\n+                !Objects.equals(\n+                    proposerSlashing.getHeader_1().getMessage(),\n+                    proposerSlashing.getHeader_2().getMessage()),", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f19619d5e802fa10d8797cfeab9c789191d82169"}, "originalPosition": 7}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNzU2NDEyNg==", "bodyText": "(nit) I'd declare the second header as a variable, and assert that the 2 headers are not equal, just so we're being really explicit and verifying our assumptions:\n\n  \n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                ProposerSlashing slashing =\n          \n          \n            \n                    new ProposerSlashing(\n          \n          \n            \n                        new SignedBeaconBlockHeader(\n          \n          \n            \n                            signedBeaconBlockHeader.getMessage(), BLSSignature.random(100)),\n          \n          \n            \n                        signedBeaconBlockHeader);\n          \n          \n            \n                final SignedBeaconBlockHeader header2 = new SignedBeaconBlockHeader(signedBeaconBlockHeader.getMessage(), BLSSignature.random(100);\n          \n          \n            \n                assertThat(header2).isNotEqualTo(signedBeaconBlockHeader);\n          \n          \n            \n                ProposerSlashing slashing =\n          \n          \n            \n                    new ProposerSlashing(\n          \n          \n            \n                        header2,\n          \n          \n            \n                        signedBeaconBlockHeader);", "url": "https://github.com/ConsenSys/teku/pull/3151#discussion_r517564126", "createdAt": "2020-11-04T18:58:03Z", "author": {"login": "mbaxter"}, "path": "networking/eth2/src/test/java/tech/pegasys/teku/networking/eth2/gossip/topics/validation/ProposerSlashingValidatorTest.java", "diffHunk": "@@ -117,4 +119,26 @@ public void shouldIgnoreProposerSlashingForTheSameProposer() throws Exception {\n     assertThat(proposerSlashingValidator.validate(slashing1)).isEqualTo(ACCEPT);\n     assertThat(proposerSlashingValidator.validate(slashing2)).isEqualTo(IGNORE);\n   }\n+\n+  @Test\n+  public void shouldRejectProposerSlashingForTwoSignedHeadersWithSameMessageButDifferentSignature()\n+      throws Exception {\n+    beaconChainUtil.initializeStorage();\n+    beaconChainUtil.createAndImportBlockAtSlot(6);\n+    stateTransitionValidator = new ProposerSlashingStateTransitionValidator();\n+    SignedBeaconBlockHeader signedBeaconBlockHeader =\n+        dataStructureUtil.randomSignedBeaconBlockHeader();\n+    ProposerSlashing slashing =\n+        new ProposerSlashing(\n+            new SignedBeaconBlockHeader(\n+                signedBeaconBlockHeader.getMessage(), BLSSignature.random(100)),\n+            signedBeaconBlockHeader);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f19619d5e802fa10d8797cfeab9c789191d82169"}, "originalPosition": 29}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "342ebfb340808a8fc1601c7c7d4c25f841af36f4", "author": {"user": {"login": "cemozerr", "name": "Cem Ozer"}}, "url": "https://github.com/ConsenSys/teku/commit/342ebfb340808a8fc1601c7c7d4c25f841af36f4", "committedDate": "2020-11-04T19:18:10Z", "message": "Incorporate feedback"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "969e3b9c64bb29ded294a6943ba523a759c3c311", "author": {"user": {"login": "cemozerr", "name": "Cem Ozer"}}, "url": "https://github.com/ConsenSys/teku/commit/969e3b9c64bb29ded294a6943ba523a759c3c311", "committedDate": "2020-11-04T20:22:07Z", "message": "Merge branch 'master' into fixMinorStateTransitionBug"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "9c5c97160d127388a5c90cfebe0f3b40f3039454", "author": {"user": {"login": "cemozerr", "name": "Cem Ozer"}}, "url": "https://github.com/ConsenSys/teku/commit/9c5c97160d127388a5c90cfebe0f3b40f3039454", "committedDate": "2020-11-04T22:07:17Z", "message": "Merge branch 'master' into fixMinorStateTransitionBug"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "60723113ec8595ef29380f4f33096bb5c0b8fc91", "author": {"user": {"login": "cemozerr", "name": "Cem Ozer"}}, "url": "https://github.com/ConsenSys/teku/commit/60723113ec8595ef29380f4f33096bb5c0b8fc91", "committedDate": "2020-11-04T22:31:34Z", "message": "Merge branch 'master' into fixMinorStateTransitionBug"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "07bde0b125fb704269e42a3e4d9d015802794d61", "author": {"user": {"login": "cemozerr", "name": "Cem Ozer"}}, "url": "https://github.com/ConsenSys/teku/commit/07bde0b125fb704269e42a3e4d9d015802794d61", "committedDate": "2020-11-05T03:10:09Z", "message": "Merge branch 'master' into fixMinorStateTransitionBug"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "9ac6fe6341a0883ffc3eb25648df3fb0d3e82638", "author": {"user": {"login": "cemozerr", "name": "Cem Ozer"}}, "url": "https://github.com/ConsenSys/teku/commit/9ac6fe6341a0883ffc3eb25648df3fb0d3e82638", "committedDate": "2020-11-05T13:13:57Z", "message": "Merge branch 'master' into fixMinorStateTransitionBug"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ce085496c27640a207b78ee0cce718aa56b6520a", "author": {"user": {"login": "cemozerr", "name": "Cem Ozer"}}, "url": "https://github.com/ConsenSys/teku/commit/ce085496c27640a207b78ee0cce718aa56b6520a", "committedDate": "2020-11-05T13:44:50Z", "message": "Merge branch 'master' into fixMinorStateTransitionBug"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3305, "cost": 1, "resetAt": "2021-11-01T13:51:04Z"}}}