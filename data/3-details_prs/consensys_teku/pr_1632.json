{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDA2ODI2MjI0", "number": 1632, "title": "Optimize: batch BLS verification ", "bodyText": "PR Description\n\nExtract block verification into a separate class\nOptimize BLS signatures verification by batching them: https://ethresear.ch/t/fast-verification-of-multiple-bls-signatures/5407\nOptimize batch BLS with parallelization\nOptimize batch BLS with doing ate2 instead of ate (not very big gain and only for large batches)\nOptimize batch BLS with eliminating one G2 scalar multiplication for the first element (factor is 1)\n\nBenchmarks:\nIn summary this optimization yields ~x1.5 block processing speedup\nBefore:\nBenchmark                              (validatorsCount)  Mode  Cnt  Score   Error  Units\nTransitionBenchmark.Block.importBlock              16384    ss  250  0,121 \u00b1 0,002   s/op\nTransitionBenchmark.Block.importBlock              32768    ss  250  0,146 \u00b1 0,004   s/op\nTransitionBenchmark.Epoch.importBlock              16384    ss  100  0,266 \u00b1 0,007   s/op\nTransitionBenchmark.Epoch.importBlock              32768    ss  100  0,452 \u00b1 0,009   s/op\n\nAfter:\nBenchmark                              (validatorsCount)  Mode  Cnt  Score   Error  Units\nTransitionBenchmark.Block.importBlock              16384    ss  250  0,072 \u00b1 0,002   s/op\nTransitionBenchmark.Block.importBlock              32768    ss  250  0,104 \u00b1 0,004   s/op\nTransitionBenchmark.Epoch.importBlock              16384    ss  100  0,214 \u00b1 0,007   s/op\nTransitionBenchmark.Epoch.importBlock              32768    ss  100  0,409 \u00b1 0,009   s/op\n\nOther benchmarks\nBelow is the comparison of different variants for different signature batch sizes (ops/sec, larger is better):\n\n\n\nBenchmark\n1\n2\n4\n8\n16\n32\n64\n128\n\n\n\n\nSimple\n38,428\n18,995\n9,429\n4,825\n2,409\n1,201\n0,587\n0,297\n\n\nBatchedNonParallelDoublePairing\n28,973\n19,119\n11,351\n6,332\n3,288\n1,672\n0,841\n0,435\n\n\nBatchedNonParallelSinglePairing\n29,387\n18,675\n10,826\n6,024\n3,042\n1,586\n0,818\n0,421\n\n\nBatchedParallelDoublePairing\n29,505\n19,270\n17,489\n14,503\n10,405\n5,275\n2,980\n1,517\n\n\nBatchedParallelSinglePairing\n29,341\n24,971\n22,318\n16,174\n9,551\n5,459\n2,853\n1,467\n\n\n\nHere is the BLS primitives benchmark results just for referencing them later:\nBenchmark                            Mode  Cnt      Score     Error  Units\nBLSPrimitivesBenchmark.ate1          avgt   10   4934,493 \u00b1 184,762  us/op\nBLSPrimitivesBenchmark.ate1x2Mul     avgt   10   9990,881 \u00b1 342,553  us/op\nBLSPrimitivesBenchmark.ate2          avgt   10   8597,902 \u00b1 218,734  us/op\nBLSPrimitivesBenchmark.bigRandomX64  avgt   10      9,290 \u00b1   0,669  us/op\nBLSPrimitivesBenchmark.fexp          avgt   10   7301,422 \u00b1 419,305  us/op\nBLSPrimitivesBenchmark.g2Mul32       avgt   10    879,418 \u00b1  51,346  us/op\nBLSPrimitivesBenchmark.g2Mul64       avgt   10   1283,652 \u00b1  36,820  us/op\nBLSPrimitivesBenchmark.gtProduct     avgt   10     44,110 \u00b1   1,688  us/op\nBLSPrimitivesBenchmark.hToG2         avgt   10  11058,118 \u00b1 429,275  us/op", "createdAt": "2020-04-21T18:15:07Z", "url": "https://github.com/ConsenSys/teku/pull/1632", "merged": true, "mergeCommit": {"oid": "381b9b5b0b6d14c4afec1f4d03b8dae7ebb17b34"}, "closed": true, "closedAt": "2020-04-25T18:12:09Z", "author": {"login": "Nashatyrev"}, "timelineItems": {"totalCount": 46, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcWMkL0AH2gAyNDA2ODI2MjI0OmMzMzg5OTNhMDU4ZTQ1MDU3M2FhODk2MTA3YzcyYjFmMTYxNDkwYjk=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcbnm-DAFqTQwMDYxODEwMA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "c338993a058e450573aa896107c72b1f161490b9", "author": {"user": {"login": "Nashatyrev", "name": "Anton Nashatyrev"}}, "url": "https://github.com/ConsenSys/teku/commit/c338993a058e450573aa896107c72b1f161490b9", "committedDate": "2020-04-10T08:10:48Z", "message": "Make some bls mikuli members accessible"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "cd30c918a6a7ad645222c575b244141fb286b114", "author": {"user": {"login": "Nashatyrev", "name": "Anton Nashatyrev"}}, "url": "https://github.com/ConsenSys/teku/commit/cd30c918a6a7ad645222c575b244141fb286b114", "committedDate": "2020-04-10T08:11:06Z", "message": "Add batch BLS bench and test"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c2635de483e9a06e3adc6625020a2fca244e1f7c", "author": {"user": {"login": "Nashatyrev", "name": "Anton Nashatyrev"}}, "url": "https://github.com/ConsenSys/teku/commit/c2635de483e9a06e3adc6625020a2fca244e1f7c", "committedDate": "2020-04-16T12:20:06Z", "message": "Fix batch BLS verification"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "6acc934c7212111c7845ce31e7a20362ee6bdd8c", "author": {"user": {"login": "Nashatyrev", "name": "Anton Nashatyrev"}}, "url": "https://github.com/ConsenSys/teku/commit/6acc934c7212111c7845ce31e7a20362ee6bdd8c", "committedDate": "2020-04-17T17:24:50Z", "message": "Merge branch 'master' into optimize-batch-bls"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "18747abb472a527527aa7f378e800d5360df479d", "author": {"user": {"login": "Nashatyrev", "name": "Anton Nashatyrev"}}, "url": "https://github.com/ConsenSys/teku/commit/18747abb472a527527aa7f378e800d5360df479d", "committedDate": "2020-04-17T17:56:13Z", "message": "Separate block processing and validation"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "67c093f4f18998a4ea4a417dfcad96c03cff1b2b", "author": {"user": {"login": "Nashatyrev", "name": "Anton Nashatyrev"}}, "url": "https://github.com/ConsenSys/teku/commit/67c093f4f18998a4ea4a417dfcad96c03cff1b2b", "committedDate": "2020-04-20T10:17:57Z", "message": "Add batch verify methods to BLS"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "92d4ef6b9fd96e57cf857cbccfac28209d264668", "author": {"user": {"login": "Nashatyrev", "name": "Anton Nashatyrev"}}, "url": "https://github.com/ConsenSys/teku/commit/92d4ef6b9fd96e57cf857cbccfac28209d264668", "committedDate": "2020-04-20T11:39:55Z", "message": "Fix BIG constant initialization"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "3726c6a50faa472f911d17233a4012686e465624", "author": {"user": {"login": "Nashatyrev", "name": "Anton Nashatyrev"}}, "url": "https://github.com/ConsenSys/teku/commit/3726c6a50faa472f911d17233a4012686e465624", "committedDate": "2020-04-20T11:40:58Z", "message": "Support aggregated signature verification in batching verification methods"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "fca708f75fe29087e3726de96bd512b0b78b6edd", "author": {"user": {"login": "Nashatyrev", "name": "Anton Nashatyrev"}}, "url": "https://github.com/ConsenSys/teku/commit/fca708f75fe29087e3726de96bd512b0b78b6edd", "committedDate": "2020-04-20T11:44:09Z", "message": "Add BLSSignatureVerifier interface and pass it to spec methods for BLS validation. Add BatchBlockValidator"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "08ac117fe847c000d35ac16ed08d2f15bd34d327", "author": {"user": {"login": "Nashatyrev", "name": "Anton Nashatyrev"}}, "url": "https://github.com/ConsenSys/teku/commit/08ac117fe847c000d35ac16ed08d2f15bd34d327", "committedDate": "2020-04-20T11:45:07Z", "message": "Use BatchBlockValidator in StateTransition by default"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "8d785829464029c7aab1e13db819104346841af0", "author": {"user": {"login": "Nashatyrev", "name": "Anton Nashatyrev"}}, "url": "https://github.com/ConsenSys/teku/commit/8d785829464029c7aab1e13db819104346841af0", "committedDate": "2020-04-20T11:45:45Z", "message": "Adjust BLSBenchmark to use public files. Remove obsolete test"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a19797e00e329c888628e673382665fdf5884543", "author": {"user": {"login": "Nashatyrev", "name": "Anton Nashatyrev"}}, "url": "https://github.com/ConsenSys/teku/commit/a19797e00e329c888628e673382665fdf5884543", "committedDate": "2020-04-21T12:13:11Z", "message": "Get rid of obsolete final exp in BLS batch verify"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "0a070058dd7cf732652fcc85dec9f2ddfe87820c", "author": {"user": {"login": "Nashatyrev", "name": "Anton Nashatyrev"}}, "url": "https://github.com/ConsenSys/teku/commit/0a070058dd7cf732652fcc85dec9f2ddfe87820c", "committedDate": "2020-04-21T12:14:02Z", "message": "Update Block dumps to spec v0.11"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "84880471b996959f85a9d996ba45d7928d06da6d", "author": {"user": {"login": "Nashatyrev", "name": "Anton Nashatyrev"}}, "url": "https://github.com/ConsenSys/teku/commit/84880471b996959f85a9d996ba45d7928d06da6d", "committedDate": "2020-04-21T13:10:04Z", "message": "Make it possible to validate a block with postState: get slot from block"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a605af4561d25b024e3ca8c5c6e53438f7a23e64", "author": {"user": {"login": "Nashatyrev", "name": "Anton Nashatyrev"}}, "url": "https://github.com/ConsenSys/teku/commit/a605af4561d25b024e3ca8c5c6e53438f7a23e64", "committedDate": "2020-04-21T13:20:53Z", "message": "Use SecureRandomProvider insead of Milagro RAND which has issues"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ba949f5696d69c7a3f94e94326ec8854a6de9eee", "author": {"user": {"login": "Nashatyrev", "name": "Anton Nashatyrev"}}, "url": "https://github.com/ConsenSys/teku/commit/ba949f5696d69c7a3f94e94326ec8854a6de9eee", "committedDate": "2020-04-21T13:22:05Z", "message": "Add BLS primitives benchmarks"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "0b8860d0967a16cfed78308b87947c544c57d8e7", "author": {"user": {"login": "Nashatyrev", "name": "Anton Nashatyrev"}}, "url": "https://github.com/ConsenSys/teku/commit/0b8860d0967a16cfed78308b87947c544c57d8e7", "committedDate": "2020-04-21T13:25:46Z", "message": "Update BLSBenchmark"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "420423c8e8382d475d168db7fb07e1bfdbe68b5d", "author": {"user": {"login": "Nashatyrev", "name": "Anton Nashatyrev"}}, "url": "https://github.com/ConsenSys/teku/commit/420423c8e8382d475d168db7fb07e1bfdbe68b5d", "committedDate": "2020-04-21T17:28:34Z", "message": "Remove circle modules dependency"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "bc19834ff5667007e5fe59440855a844e5e8c335", "author": {"user": {"login": "Nashatyrev", "name": "Anton Nashatyrev"}}, "url": "https://github.com/ConsenSys/teku/commit/bc19834ff5667007e5fe59440855a844e5e8c335", "committedDate": "2020-04-21T17:29:31Z", "message": "Add different batch BLS benchmarks"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "da62b32f3ea97c7ada978d6bc09b27f8e0f41815", "author": {"user": {"login": "Nashatyrev", "name": "Anton Nashatyrev"}}, "url": "https://github.com/ConsenSys/teku/commit/da62b32f3ea97c7ada978d6bc09b27f8e0f41815", "committedDate": "2020-04-21T17:38:43Z", "message": "Add a variant of batch BLS verification which uses optimized ate2 pairing. BLS.batchVerify() chooses the fastest option"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "dd53a1de30a60e26fffe07b187b4a92ee867a0dd", "author": {"user": {"login": "Nashatyrev", "name": "Anton Nashatyrev"}}, "url": "https://github.com/ConsenSys/teku/commit/dd53a1de30a60e26fffe07b187b4a92ee867a0dd", "committedDate": "2020-04-21T17:53:42Z", "message": "Fix BLSPrimitivesBenchmark for more stable results"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "db31a9df33b7c69a296e3b5d9cfd2e3d5dad6ed4", "author": {"user": {"login": "Nashatyrev", "name": "Anton Nashatyrev"}}, "url": "https://github.com/ConsenSys/teku/commit/db31a9df33b7c69a296e3b5d9cfd2e3d5dad6ed4", "committedDate": "2020-04-21T18:13:10Z", "message": "Apply Spotless"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f5df28dd65747f666a8111c1e984730eb687dc92", "author": {"user": {"login": "Nashatyrev", "name": "Anton Nashatyrev"}}, "url": "https://github.com/ConsenSys/teku/commit/f5df28dd65747f666a8111c1e984730eb687dc92", "committedDate": "2020-04-21T18:23:22Z", "message": "Temp suppress warning"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "fe7af17762e972acbad13718359dc9ff91dc0f1c", "author": {"user": {"login": "Nashatyrev", "name": "Anton Nashatyrev"}}, "url": "https://github.com/ConsenSys/teku/commit/fe7af17762e972acbad13718359dc9ff91dc0f1c", "committedDate": "2020-04-22T10:51:21Z", "message": "Add a couple of clarification comments"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "89cfb29d63730ef169af2efbf7982c1a751ee132", "author": {"user": {"login": "Nashatyrev", "name": "Anton Nashatyrev"}}, "url": "https://github.com/ConsenSys/teku/commit/89cfb29d63730ef169af2efbf7982c1a751ee132", "committedDate": "2020-04-22T17:23:29Z", "message": "Minor updates"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "0fd56f9089f63f8bfa4b9c5bd1df6355570f9663", "author": {"user": {"login": "Nashatyrev", "name": "Anton Nashatyrev"}}, "url": "https://github.com/ConsenSys/teku/commit/0fd56f9089f63f8bfa4b9c5bd1df6355570f9663", "committedDate": "2020-04-22T17:54:15Z", "message": "Fix the state a block should be validated against"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "0117b888b2ed23ef7aaafc3631b0b642b6e5fe03", "author": {"user": {"login": "Nashatyrev", "name": "Anton Nashatyrev"}}, "url": "https://github.com/ConsenSys/teku/commit/0117b888b2ed23ef7aaafc3631b0b642b6e5fe03", "committedDate": "2020-04-22T19:48:13Z", "message": "Make strict spec block processing methods naming: those which just validate, those which process but not validate, defaults methods which do both"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "4bf903c61f5a4dc48a58001c446c994e4213860c", "author": {"user": {"login": "Nashatyrev", "name": "Anton Nashatyrev"}}, "url": "https://github.com/ConsenSys/teku/commit/4bf903c61f5a4dc48a58001c446c994e4213860c", "committedDate": "2020-04-22T20:05:47Z", "message": "Make the right order of processing and BLS verification for ref tests"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "961d401c564026905e47a4a4ffd10642cf5b2c00", "author": {"user": {"login": "Nashatyrev", "name": "Anton Nashatyrev"}}, "url": "https://github.com/ConsenSys/teku/commit/961d401c564026905e47a4a4ffd10642cf5b2c00", "committedDate": "2020-04-23T09:24:01Z", "message": "Merge remote-tracking branch 'pegasys/master' into optimize-batch-bls"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "20f26c1966520ec50ec60d58e852af6e2536d418", "author": {"user": {"login": "Nashatyrev", "name": "Anton Nashatyrev"}}, "url": "https://github.com/ConsenSys/teku/commit/20f26c1966520ec50ec60d58e852af6e2536d418", "committedDate": "2020-04-23T09:25:44Z", "message": "Add blocks dump for 64K validators"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "faf20516166e1a8b0096d6901c48c567dbc23a73", "author": {"user": {"login": "Nashatyrev", "name": "Anton Nashatyrev"}}, "url": "https://github.com/ConsenSys/teku/commit/faf20516166e1a8b0096d6901c48c567dbc23a73", "committedDate": "2020-04-23T14:29:50Z", "message": "Add some javadoc"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f1b60418d5366471a9789756912fae6dbfc6f073", "author": {"user": {"login": "Nashatyrev", "name": "Anton Nashatyrev"}}, "url": "https://github.com/ConsenSys/teku/commit/f1b60418d5366471a9789756912fae6dbfc6f073", "committedDate": "2020-04-23T16:33:21Z", "message": "Add more javadocs"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e5dea1867d6549fb945ca9747f7e7dab7a35455e", "author": {"user": {"login": "Nashatyrev", "name": "Anton Nashatyrev"}}, "url": "https://github.com/ConsenSys/teku/commit/e5dea1867d6549fb945ca9747f7e7dab7a35455e", "committedDate": "2020-04-23T16:42:07Z", "message": "Create random properly"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "9a529199c77d788614f9f65439cdc7b6718fa0f1", "author": {"user": {"login": "Nashatyrev", "name": "Anton Nashatyrev"}}, "url": "https://github.com/ConsenSys/teku/commit/9a529199c77d788614f9f65439cdc7b6718fa0f1", "committedDate": "2020-04-23T16:58:38Z", "message": "Remove optimization TODO: GT mul is pretty cheap and the gain would be minimal"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "8f598c2fa48e6e7e17fd44940daec20c97867085", "author": {"user": {"login": "Nashatyrev", "name": "Anton Nashatyrev"}}, "url": "https://github.com/ConsenSys/teku/commit/8f598c2fa48e6e7e17fd44940daec20c97867085", "committedDate": "2020-04-23T18:03:08Z", "message": "Add batch BLS verify related unit tests"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "852361f8e1bc64ce4f956cc4b54a46ddca04fa8a", "author": {"user": {"login": "Nashatyrev", "name": "Anton Nashatyrev"}}, "url": "https://github.com/ConsenSys/teku/commit/852361f8e1bc64ce4f956cc4b54a46ddca04fa8a", "committedDate": "2020-04-23T18:13:00Z", "message": "Merge remote-tracking branch 'pegasys/master' into optimize-batch-bls"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "6ed1f4eb62f85f6d4a535ece5e7e77bbbdba305b", "author": {"user": {"login": "Nashatyrev", "name": "Anton Nashatyrev"}}, "url": "https://github.com/ConsenSys/teku/commit/6ed1f4eb62f85f6d4a535ece5e7e77bbbdba305b", "committedDate": "2020-04-23T18:25:35Z", "message": "Fix errorprone warn"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c0548099adb8427faca5a37042e98050a75e62e0", "author": {"user": {"login": "Nashatyrev", "name": "Anton Nashatyrev"}}, "url": "https://github.com/ConsenSys/teku/commit/c0548099adb8427faca5a37042e98050a75e62e0", "committedDate": "2020-04-24T08:47:54Z", "message": "Move equals/hashCode for all AbstractImmutableContainer implementations to superclass"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c3e8c2e34c5af675364f3f771f868209543d5d01", "author": {"user": {"login": "Nashatyrev", "name": "Anton Nashatyrev"}}, "url": "https://github.com/ConsenSys/teku/commit/c3e8c2e34c5af675364f3f771f868209543d5d01", "committedDate": "2020-04-24T11:51:11Z", "message": "Revert accidentally committed change"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDAwMDQ3MjMz", "url": "https://github.com/ConsenSys/teku/pull/1632#pullrequestreview-400047233", "createdAt": "2020-04-24T15:25:38Z", "commit": {"oid": "6ed1f4eb62f85f6d4a535ece5e7e77bbbdba305b"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "d0ce2119608b60b06f78ec9d273153d6b04d3083", "author": {"user": {"login": "Nashatyrev", "name": "Anton Nashatyrev"}}, "url": "https://github.com/ConsenSys/teku/commit/d0ce2119608b60b06f78ec9d273153d6b04d3083", "committedDate": "2020-04-25T11:41:13Z", "message": "Use non-secure Random since hitting Linux secure random issue."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "cce5e0a766a0eab6c149dd8650f3efef80c39c9f", "author": {"user": {"login": "Nashatyrev", "name": "Anton Nashatyrev"}}, "url": "https://github.com/ConsenSys/teku/commit/cce5e0a766a0eab6c149dd8650f3efef80c39c9f", "committedDate": "2020-04-25T11:47:31Z", "message": "Apply spotless"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "157e81dac33be0532bfdfcd9ac06b970215e61a1", "author": {"user": {"login": "Nashatyrev", "name": "Anton Nashatyrev"}}, "url": "https://github.com/ConsenSys/teku/commit/157e81dac33be0532bfdfcd9ac06b970215e61a1", "committedDate": "2020-04-25T14:47:47Z", "message": "Split large test to smaller cases"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "4d82f33da27060ac3eaa9e02216c2d4cbdc5d368", "author": {"user": {"login": "Nashatyrev", "name": "Anton Nashatyrev"}}, "url": "https://github.com/ConsenSys/teku/commit/4d82f33da27060ac3eaa9e02216c2d4cbdc5d368", "committedDate": "2020-04-25T14:47:55Z", "message": "Merge remote-tracking branch 'pegasys/master' into optimize-batch-bls"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "cc733e16da63818508a64fd58a823f2b8c4e8f46", "author": {"user": {"login": "Nashatyrev", "name": "Anton Nashatyrev"}}, "url": "https://github.com/ConsenSys/teku/commit/cc733e16da63818508a64fd58a823f2b8c4e8f46", "committedDate": "2020-04-25T14:53:48Z", "message": "Apply spotless"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDAwNjE4MTAw", "url": "https://github.com/ConsenSys/teku/pull/1632#pullrequestreview-400618100", "createdAt": "2020-04-27T04:26:00Z", "commit": {"oid": "cc733e16da63818508a64fd58a823f2b8c4e8f46"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yN1QwNDoyNjowMFrOGMQJUA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yN1QwNDoyNjowMFrOGMQJUA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNTUwMDYyNA==", "bodyText": "That linux bug was fixed in JDK 7 which we don't support anymore.  Java SecureRandom now uses /dev/urandom.", "url": "https://github.com/ConsenSys/teku/pull/1632#discussion_r415500624", "createdAt": "2020-04-27T04:26:00Z", "author": {"login": "ajsutton"}, "path": "bls/src/main/java/tech/pegasys/artemis/bls/mikuli/BLS12381.java", "diffHunk": "@@ -42,6 +45,43 @@\n  */\n public final class BLS12381 {\n \n+  private static final long MAX_BATCH_VERIFY_RANDOM_MULTIPLIER = Long.MAX_VALUE;\n+\n+  private static Random getRND() {\n+    // Milagro RAND has some issues with generating 'small' random numbers\n+    // and is not thread safe\n+    // Using non-secure random due to the JDK Linux secure random issue:\n+    // https://bugs.java.com/bugdatabase/view_bug.do?bug_id=6521844\n+    // A potential attack here has a very limited application and is not feasible\n+    // Thus using non-secure random doesn't significantly mitigate the security\n+    return ThreadLocalRandom.current();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "cc733e16da63818508a64fd58a823f2b8c4e8f46"}, "originalPosition": 26}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4339, "cost": 1, "resetAt": "2021-11-01T13:51:04Z"}}}