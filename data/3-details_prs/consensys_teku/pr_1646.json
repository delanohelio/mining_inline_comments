{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDA3MDE3Mjc3", "number": 1646, "title": "Update log-destination to use the enumeration for LoggingDestination.", "bodyText": "Addresses #1641\nSigned-off-by: Paul Harris paul.harris@consensys.net", "createdAt": "2020-04-22T03:09:07Z", "url": "https://github.com/ConsenSys/teku/pull/1646", "merged": true, "mergeCommit": {"oid": "f61e0e8b1fdfe9292b1a5a82f7276fef438c4074"}, "closed": true, "closedAt": "2020-04-23T20:53:58Z", "author": {"login": "rolfyone"}, "timelineItems": {"totalCount": 13, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcZ_brBAH2gAyNDA3MDE3Mjc3OjUxZDVkODdmYjhhNDBjNjM3MjM4Mzc4NTEzN2QwYjgwZjYwMDVkZTk=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcajASJAH2gAyNDA3MDE3Mjc3OjBlMDA3YTUxOGU4ZTFiOGUxNWY2NzY3ZTg5OTg4NTQwMDIyNzAwZTE=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "51d5d87fb8a40c6372383785137d0b80f6005de9", "author": {"user": {"login": "rolfyone", "name": "Paul Harris"}}, "url": "https://github.com/ConsenSys/teku/commit/51d5d87fb8a40c6372383785137d0b80f6005de9", "committedDate": "2020-04-22T03:08:26Z", "message": "Update log-destination to use the enumeration for LoggingDestination.\n\nAddresses #1641\n\nSigned-off-by: Paul Harris <paul.harris@consensys.net>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "cfdb93ff37398da408aa8a41a0603c6fc9b03a71", "author": {"user": {"login": "rolfyone", "name": "Paul Harris"}}, "url": "https://github.com/ConsenSys/teku/commit/cfdb93ff37398da408aa8a41a0603c6fc9b03a71", "committedDate": "2020-04-22T03:16:23Z", "message": "Merge remote-tracking branch 'upstream/master' into 1641-log-destination\n\nSigned-off-by: Paul Harris <paul.harris@consensys.net>"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzk3ODE1MDE3", "url": "https://github.com/ConsenSys/teku/pull/1646#pullrequestreview-397815017", "createdAt": "2020-04-22T03:19:50Z", "commit": {"oid": "cfdb93ff37398da408aa8a41a0603c6fc9b03a71"}, "state": "COMMENTED", "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yMlQwMzoxOTo1MFrOGJhfSQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yMlQwMzoyMzoyMVrOGJhjcQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMjYzOTA0OQ==", "bodyText": "Wouldn't it make more sense to just use:\n\n  \n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n              private LoggingDestination logDestination = LoggingDestination.get(DEFAULT_LOG_DESTINATION);\n          \n          \n            \n              private LoggingDestination logDestination = LoggingDestination.DEFAULT_BOTH;", "url": "https://github.com/ConsenSys/teku/pull/1646#discussion_r412639049", "createdAt": "2020-04-22T03:19:50Z", "author": {"login": "ajsutton"}, "path": "artemis/src/main/java/tech/pegasys/artemis/cli/options/LoggingOptions.java", "diffHunk": "@@ -54,9 +55,10 @@\n   @CommandLine.Option(\n       names = {LOG_DESTINATION_OPTION_NAME},\n       paramLabel = \"<LOG_DESTINATION>\",\n-      description = \"Whether a logger is added for the console, the log file, or both\",\n+      description =\n+          \"Whether a logger is added for the console, the log file, or both (Valid values: ${COMPLETION-CANDIDATES})\",\n       arity = \"1\")\n-  private String logDestination = DEFAULT_LOG_DESTINATION;\n+  private LoggingDestination logDestination = LoggingDestination.get(DEFAULT_LOG_DESTINATION);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "cfdb93ff37398da408aa8a41a0603c6fc9b03a71"}, "originalPosition": 26}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMjYzOTIyMQ==", "bodyText": "This probably should specify something that's not the default so we can tell it actually got picked up.", "url": "https://github.com/ConsenSys/teku/pull/1646#discussion_r412639221", "createdAt": "2020-04-22T03:20:25Z", "author": {"login": "ajsutton"}, "path": "artemis/src/test/resources/complete_config.yaml", "diffHunk": "@@ -32,7 +32,7 @@ eth1-endpoint: \"http://localhost:8545\"\n # logging\n log-color-enabled: True\n log-include-events-enabled: True\n-log-destination: \"both\"\n+log-destination: \"DEFAULT_BOTH\"", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "cfdb93ff37398da408aa8a41a0603c6fc9b03a71"}, "originalPosition": 5}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMjY0MDExMw==", "bodyText": "The code that uses this value expects the key not the enum name().  Currently key is internal only so a getter would be needed. I think it happens to work out at the moment but we should actually refer to the same value.  I suspect the key value is no longer relevant and we should just use .valueOf to look up the matching value.  Or just pass LoggingDestination enum through instead of going to String and back if the class path will let us do that.", "url": "https://github.com/ConsenSys/teku/pull/1646#discussion_r412640113", "createdAt": "2020-04-22T03:23:21Z", "author": {"login": "ajsutton"}, "path": "artemis/src/main/java/tech/pegasys/artemis/cli/options/LoggingOptions.java", "diffHunk": "@@ -81,7 +83,7 @@ public boolean isLogIncludeEventsEnabled() {\n   }\n \n   public String getLogDestination() {\n-    return logDestination;\n+    return logDestination.name();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "cfdb93ff37398da408aa8a41a0603c6fc9b03a71"}, "originalPosition": 35}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "2ad796be7bbedb7cb2d98cdccbe76f7d8cf35c3d", "author": {"user": {"login": "rolfyone", "name": "Paul Harris"}}, "url": "https://github.com/ConsenSys/teku/commit/2ad796be7bbedb7cb2d98cdccbe76f7d8cf35c3d", "committedDate": "2020-04-22T21:39:48Z", "message": "Added new tests for LoggingOptions, splitting them out from the old BeaconNodeCommandTest suite.\n\n - new abstract class for commandline tests\n\n - config file test specific to loggingOptions\n\n - addressed review feedback.\n\nSigned-off-by: Paul Harris <paul.harris@consensys.net>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ccdf1d8ccf44200ed52531a8c702f7328e1cb5b4", "author": {"user": {"login": "rolfyone", "name": "Paul Harris"}}, "url": "https://github.com/ConsenSys/teku/commit/ccdf1d8ccf44200ed52531a8c702f7328e1cb5b4", "committedDate": "2020-04-22T22:03:23Z", "message": "Merge remote-tracking branch 'upstream/master' into 1641-log-destination"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a0462bf889e3ccf38d9738b0ef5760002d72548d", "author": {"user": {"login": "rolfyone", "name": "Paul Harris"}}, "url": "https://github.com/ConsenSys/teku/commit/a0462bf889e3ccf38d9738b0ef5760002d72548d", "committedDate": "2020-04-22T22:57:30Z", "message": "Merge remote-tracking branch 'upstream/master' into 1641-log-destination\n\nSigned-off-by: Paul Harris <paul.harris@consensys.net>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "0857c7e716ad95357d016a828067066a1b9f7184", "author": {"user": {"login": "rolfyone", "name": "Paul Harris"}}, "url": "https://github.com/ConsenSys/teku/commit/0857c7e716ad95357d016a828067066a1b9f7184", "committedDate": "2020-04-22T23:14:38Z", "message": "Merge remote-tracking branch 'upstream/master' into 1641-log-destination"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzk4NjczOTk3", "url": "https://github.com/ConsenSys/teku/pull/1646#pullrequestreview-398673997", "createdAt": "2020-04-23T00:07:51Z", "commit": {"oid": "0857c7e716ad95357d016a828067066a1b9f7184"}, "state": "APPROVED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yM1QwMDowNzo1MVrOGKQ6LA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yM1QwMDowNzo1MVrOGKQ6LA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMzQxNTk4MA==", "bodyText": "nit: Can probably undo this change - it should be case insensitive but lowercase will definitely be more common (and more likely to break since the enum name is uppercase)", "url": "https://github.com/ConsenSys/teku/pull/1646#discussion_r413415980", "createdAt": "2020-04-23T00:07:51Z", "author": {"login": "ajsutton"}, "path": "artemis/src/test/resources/complete_config.yaml", "diffHunk": "@@ -32,7 +32,7 @@ eth1-endpoint: \"http://localhost:8545\"\n # logging\n log-color-enabled: True\n log-include-events-enabled: True\n-log-destination: \"both\"\n+log-destination: \"BOTH\"", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "0857c7e716ad95357d016a828067066a1b9f7184"}, "originalPosition": 5}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "df27b96d71f2ac9a1c640112cd614b720860fe53", "author": {"user": {"login": "rolfyone", "name": "Paul Harris"}}, "url": "https://github.com/ConsenSys/teku/commit/df27b96d71f2ac9a1c640112cd614b720860fe53", "committedDate": "2020-04-23T00:25:30Z", "message": "review feedback\n\nSigned-off-by: Paul Harris <paul.harris@consensys.net>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "34e38b819d0d15f3d0a10d0947b7c47d20b6b4e1", "author": {"user": {"login": "rolfyone", "name": "Paul Harris"}}, "url": "https://github.com/ConsenSys/teku/commit/34e38b819d0d15f3d0a10d0947b7c47d20b6b4e1", "committedDate": "2020-04-23T00:25:47Z", "message": "Merge remote-tracking branch 'upstream/master' into 1641-log-destination"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzk5MTM0MTQx", "url": "https://github.com/ConsenSys/teku/pull/1646#pullrequestreview-399134141", "createdAt": "2020-04-23T14:08:17Z", "commit": {"oid": "34e38b819d0d15f3d0a10d0947b7c47d20b6b4e1"}, "state": "APPROVED", "comments": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yM1QxNDowODoxN1rOGKp9wg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yM1QxNDoxOTozMlrOGKqkhQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMzgyNjQ5OA==", "bodyText": "Should this actually be abstract? :D\n\n  \n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            public class AbstractBeaconNodeCommandTest {\n          \n          \n            \n            public abstract class AbstractBeaconNodeCommandTest {", "url": "https://github.com/ConsenSys/teku/pull/1646#discussion_r413826498", "createdAt": "2020-04-23T14:08:17Z", "author": {"login": "mbaxter"}, "path": "artemis/src/test/java/tech/pegasys/artemis/cli/AbstractBeaconNodeCommandTest.java", "diffHunk": "@@ -0,0 +1,60 @@\n+/*\n+ * Copyright 2020 ConsenSys AG.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\"); you may not use this file except in compliance with\n+ * the License. You may obtain a copy of the License at\n+ *\n+ * http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software distributed under the License is distributed on\n+ * an \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied. See the License for the\n+ * specific language governing permissions and limitations under the License.\n+ */\n+\n+package tech.pegasys.artemis.cli;\n+\n+import static org.mockito.Mockito.mock;\n+import static org.mockito.Mockito.verify;\n+import static tech.pegasys.artemis.cli.BeaconNodeCommand.CONFIG_FILE_OPTION_NAME;\n+\n+import java.io.PrintWriter;\n+import java.io.StringWriter;\n+import java.nio.file.Path;\n+import java.util.Collections;\n+import java.util.function.Consumer;\n+import org.junit.jupiter.api.io.TempDir;\n+import org.mockito.ArgumentCaptor;\n+import tech.pegasys.artemis.util.config.ArtemisConfiguration;\n+\n+public class AbstractBeaconNodeCommandTest {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "34e38b819d0d15f3d0a10d0947b7c47d20b6b4e1"}, "originalPosition": 29}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMzgyNzE5Mg==", "bodyText": "Nice call splitting this out \ud83c\udf89", "url": "https://github.com/ConsenSys/teku/pull/1646#discussion_r413827192", "createdAt": "2020-04-23T14:09:03Z", "author": {"login": "mbaxter"}, "path": "artemis/src/test/java/tech/pegasys/artemis/cli/options/LoggingOptionsTest.java", "diffHunk": "@@ -0,0 +1,69 @@\n+/*\n+ * Copyright 2020 ConsenSys AG.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\"); you may not use this file except in compliance with\n+ * the License. You may obtain a copy of the License at\n+ *\n+ * http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software distributed under the License is distributed on\n+ * an \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied. See the License for the\n+ * specific language governing permissions and limitations under the License.\n+ */\n+\n+package tech.pegasys.artemis.cli.options;\n+\n+import static org.assertj.core.api.Assertions.assertThat;\n+import static tech.pegasys.artemis.cli.options.LoggingOptions.LOG_DESTINATION_OPTION_NAME;\n+import static tech.pegasys.artemis.util.config.LoggingDestination.DEFAULT_BOTH;\n+\n+import org.junit.jupiter.api.Test;\n+import tech.pegasys.artemis.cli.AbstractBeaconNodeCommandTest;\n+import tech.pegasys.artemis.util.config.ArtemisConfiguration;\n+import tech.pegasys.artemis.util.config.LoggingDestination;\n+\n+public class LoggingOptionsTest extends AbstractBeaconNodeCommandTest {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "34e38b819d0d15f3d0a10d0947b7c47d20b6b4e1"}, "originalPosition": 25}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMzgyNzk1OA==", "bodyText": "(nit) I think we usually capitalize like:\n\n  \n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n              public void logDestination_ShouldAcceptFileAsDestination() {\n          \n          \n            \n              public void logDestination_shouldAcceptFileAsDestination() {", "url": "https://github.com/ConsenSys/teku/pull/1646#discussion_r413827958", "createdAt": "2020-04-23T14:09:56Z", "author": {"login": "mbaxter"}, "path": "artemis/src/test/java/tech/pegasys/artemis/cli/options/LoggingOptionsTest.java", "diffHunk": "@@ -0,0 +1,69 @@\n+/*\n+ * Copyright 2020 ConsenSys AG.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\"); you may not use this file except in compliance with\n+ * the License. You may obtain a copy of the License at\n+ *\n+ * http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software distributed under the License is distributed on\n+ * an \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied. See the License for the\n+ * specific language governing permissions and limitations under the License.\n+ */\n+\n+package tech.pegasys.artemis.cli.options;\n+\n+import static org.assertj.core.api.Assertions.assertThat;\n+import static tech.pegasys.artemis.cli.options.LoggingOptions.LOG_DESTINATION_OPTION_NAME;\n+import static tech.pegasys.artemis.util.config.LoggingDestination.DEFAULT_BOTH;\n+\n+import org.junit.jupiter.api.Test;\n+import tech.pegasys.artemis.cli.AbstractBeaconNodeCommandTest;\n+import tech.pegasys.artemis.util.config.ArtemisConfiguration;\n+import tech.pegasys.artemis.util.config.LoggingDestination;\n+\n+public class LoggingOptionsTest extends AbstractBeaconNodeCommandTest {\n+\n+  @Test\n+  public void loggingOptions_shouldReadFromConfigurationFile() {\n+    final ArtemisConfiguration config =\n+        getArtemisConfigurationFromFile(\"loggingOptions_config.yaml\");\n+\n+    assertThat(config.getLogDestination()).isEqualTo(LoggingDestination.FILE);\n+    assertThat(config.isLogColorEnabled()).isFalse();\n+    assertThat(config.isLogIncludeEventsEnabled()).isFalse();\n+    assertThat(config.getLogFile()).isEqualTo(\"a.log\");\n+    assertThat(config.getLogFileNamePattern()).isEqualTo(\"a%d.log\");\n+  }\n+\n+  @Test\n+  public void logDestination_shouldHaveSensibleDefaultValue() {\n+    // This is important!\n+    // If it defaults to \"both\" or some other value custom log4j configs get overwritten\n+    beaconNodeCommand.parse(new String[0]);\n+\n+    final ArtemisConfiguration artemisConfiguration = getResultingArtemisConfiguration();\n+    assertThat(artemisConfiguration.getLogDestination()).isEqualTo(DEFAULT_BOTH);\n+  }\n+\n+  @Test\n+  public void logDestination_ShouldAcceptFileAsDestination() {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "34e38b819d0d15f3d0a10d0947b7c47d20b6b4e1"}, "originalPosition": 50}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMzgzNjQyMQ==", "bodyText": "Ultimately,util is the wrong place for logging-specific constants.  But fixing this issue will require a larger refactor.  Will discuss offline when / how to prioritize refactoring.", "url": "https://github.com/ConsenSys/teku/pull/1646#discussion_r413836421", "createdAt": "2020-04-23T14:19:32Z", "author": {"login": "mbaxter"}, "path": "util/src/main/java/tech/pegasys/artemis/util/config/LoggingDestination.java", "diffHunk": "@@ -11,7 +11,7 @@\n  * specific language governing permissions and limitations under the License.\n  */\n \n-package tech.pegasys.teku.logging;\n+package tech.pegasys.artemis.util.config;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "34e38b819d0d15f3d0a10d0947b7c47d20b6b4e1"}, "originalPosition": 5}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e1c687509590c76a595b90b803ac3c941087612f", "author": {"user": {"login": "rolfyone", "name": "Paul Harris"}}, "url": "https://github.com/ConsenSys/teku/commit/e1c687509590c76a595b90b803ac3c941087612f", "committedDate": "2020-04-23T20:34:04Z", "message": "review feedback\n\nSigned-off-by: Paul Harris <paul.harris@consensys.net>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "0e007a518e8e1b8e15f6767e89988540022700e1", "author": {"user": {"login": "rolfyone", "name": "Paul Harris"}}, "url": "https://github.com/ConsenSys/teku/commit/0e007a518e8e1b8e15f6767e89988540022700e1", "committedDate": "2020-04-23T20:35:06Z", "message": "Merge remote-tracking branch 'upstream/master' into 1641-log-destination"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4351, "cost": 1, "resetAt": "2021-11-01T13:51:04Z"}}}