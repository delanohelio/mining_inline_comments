{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTI2MTIzMTc3", "number": 3292, "reviewThreads": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0yNFQwMzoxNTo0NlrOE8gFpQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0yNFQwMzoxNjoxN1rOE8gGAw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzMxODc1NzQ5OnYy", "diffSide": "RIGHT", "path": "validator/client/src/main/java/tech/pegasys/teku/validator/client/AttestationDutyScheduler.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0yNFQwMzoxNTo0NlrOH4qQAQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0yNFQwMzoxNTo0NlrOH4qQAQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyOTE3NDUyOQ==", "bodyText": "This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters. Learn more about bidirectional Unicode characters\n\n\n  \n\n\n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                  LOG.info(\n          \n          \n            \n                      \"current epoch {} could not be verified against the current slot {}, not processing attestation duty\",\n          \n          \n            \n                      getCurrentEpoch().map(UInt64::toString).orElse(\"UNDEFINED\"),\n          \n          \n            \n                      slot);\n          \n          \n            \n                  LOG.info(\n          \n          \n            \n                      \"Not performing attestation duties for slot {} because it is too far ahead of the current slot {}\",\n          \n          \n            \n                      slot,\n          \n          \n            \n                      getCurrentEpoch().map(UInt64::toString).orElse(\"UNDEFINED\"));", "url": "https://github.com/ConsenSys/teku/pull/3292#discussion_r529174529", "createdAt": "2020-11-24T03:15:46Z", "author": {"login": "ajsutton"}, "path": "validator/client/src/main/java/tech/pegasys/teku/validator/client/AttestationDutyScheduler.java", "diffHunk": "@@ -35,14 +39,35 @@ public AttestationDutyScheduler(\n   public void onAttestationCreationDue(final UInt64 slot) {\n     // Check slot being null for the edge case of genesis slot (i.e. slot 0)\n     if (lastAttestationCreationSlot != null && slot.compareTo(lastAttestationCreationSlot) <= 0) {\n+      LOG.debug(\n+          \"lastAttestationCreationSlot {} is ahead of current slot {}, not processing attestation duty.\",\n+          lastAttestationCreationSlot,\n+          slot);\n       return;\n     }\n+\n+    if (!isAbleToVerifyEpoch(slot)) {\n+      LOG.info(\n+          \"current epoch {} could not be verified against the current slot {}, not processing attestation duty\",\n+          getCurrentEpoch().map(UInt64::toString).orElse(\"UNDEFINED\"),\n+          slot);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f0d89d9ae522423bd60161aa0c37ae353b358f4d"}, "originalPosition": 37}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzMxODc1Nzg4OnYy", "diffSide": "RIGHT", "path": "validator/client/src/main/java/tech/pegasys/teku/validator/client/AttestationDutyScheduler.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0yNFQwMzoxNjowNVrOH4qQTQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0yNFQwMzoxNjowNVrOH4qQTQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyOTE3NDYwNQ==", "bodyText": "As above. :)", "url": "https://github.com/ConsenSys/teku/pull/3292#discussion_r529174605", "createdAt": "2020-11-24T03:16:05Z", "author": {"login": "ajsutton"}, "path": "validator/client/src/main/java/tech/pegasys/teku/validator/client/AttestationDutyScheduler.java", "diffHunk": "@@ -35,14 +39,35 @@ public AttestationDutyScheduler(\n   public void onAttestationCreationDue(final UInt64 slot) {\n     // Check slot being null for the edge case of genesis slot (i.e. slot 0)\n     if (lastAttestationCreationSlot != null && slot.compareTo(lastAttestationCreationSlot) <= 0) {\n+      LOG.debug(\n+          \"lastAttestationCreationSlot {} is ahead of current slot {}, not processing attestation duty.\",\n+          lastAttestationCreationSlot,\n+          slot);\n       return;\n     }\n+\n+    if (!isAbleToVerifyEpoch(slot)) {\n+      LOG.info(\n+          \"current epoch {} could not be verified against the current slot {}, not processing attestation duty\",\n+          getCurrentEpoch().map(UInt64::toString).orElse(\"UNDEFINED\"),\n+          slot);\n+      return;\n+    }\n+\n     lastAttestationCreationSlot = slot;\n     notifyDutyQueue(DutyQueue::onAttestationCreationDue, slot);\n   }\n \n   @Override\n   public void onAttestationAggregationDue(final UInt64 slot) {\n+    if (!isAbleToVerifyEpoch(slot)) {\n+      LOG.info(\n+          \"current epoch {} could not be verified against the current slot {}, not processing aggregation duty\",", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f0d89d9ae522423bd60161aa0c37ae353b358f4d"}, "originalPosition": 49}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzMxODc1ODQzOnYy", "diffSide": "RIGHT", "path": "validator/client/src/main/java/tech/pegasys/teku/validator/client/BlockDutyScheduler.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0yNFQwMzoxNjoxN1rOH4qQlw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0yNFQwMzoxNjoxN1rOH4qQlw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyOTE3NDY3OQ==", "bodyText": "Wording tweak again. :)", "url": "https://github.com/ConsenSys/teku/pull/3292#discussion_r529174679", "createdAt": "2020-11-24T03:16:17Z", "author": {"login": "ajsutton"}, "path": "validator/client/src/main/java/tech/pegasys/teku/validator/client/BlockDutyScheduler.java", "diffHunk": "@@ -32,6 +36,14 @@ public BlockDutyScheduler(\n \n   @Override\n   public void onBlockProductionDue(final UInt64 slot) {\n+    if (!isAbleToVerifyEpoch(slot)) {\n+      LOG.info(\n+          \"current epoch {} could not be verified against the current slot {}, not processing block duty\",", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f0d89d9ae522423bd60161aa0c37ae353b358f4d"}, "originalPosition": 27}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2874, "cost": 1, "resetAt": "2021-11-12T11:57:46Z"}}}