{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDk5MzYxMjQ4", "number": 2908, "reviewThreads": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wN1QxNzo1NzoxNVrOErS1Hg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wN1QxNzo1NzoxNVrOErS1Hg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzEzODMyNzM0OnYy", "diffSide": "RIGHT", "path": "networking/eth2/src/main/java/tech/pegasys/teku/networking/eth2/gossip/topics/validation/AttestationValidator.java", "isResolved": true, "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wN1QxNzo1NzoxNVrOHd_GMw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wN1QxOTozMjo0OVrOHeCftg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMTIwNDUzMQ==", "bodyText": "BTW can't it be the concurrency case when recentChainData updates its finalized checkpoint between calls recentChainData.getFinalizedEpoch() and recentChainData.getFinalizedCheckpoint()?\nMay be get recentChainData.getFinalizedCheckpoint() once into local var to be certainly safe on this?", "url": "https://github.com/ConsenSys/teku/pull/2908#discussion_r501204531", "createdAt": "2020-10-07T17:57:15Z", "author": {"login": "Nashatyrev"}, "path": "networking/eth2/src/main/java/tech/pegasys/teku/networking/eth2/gossip/topics/validation/AttestationValidator.java", "diffHunk": "@@ -191,6 +191,21 @@ private InternalValidationResult singleAttestationChecks(final Attestation attes\n                 return REJECT;\n               }\n \n+              // The current finalized_checkpoint is an ancestor of the block defined by\n+              // aggregate.data.beacon_block_root\n+              if (!forkChoiceUtilWrapper\n+                  .get_ancestor(\n+                      recentChainData.getForkChoiceStrategy().orElseThrow(),\n+                      data.getBeacon_block_root(),\n+                      compute_start_slot_at_epoch(recentChainData.getFinalizedEpoch()))\n+                  .map(\n+                      ancestorOfLMDVote ->\n+                          ancestorOfLMDVote.equals(\n+                              recentChainData.getFinalizedCheckpoint().orElseThrow().getRoot()))", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "6c69ca5e79fbb4caa405063af2ae17b9b5517c1e"}, "originalPosition": 14}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMTI0NTQ3Nw==", "bodyText": "Good point. Will make the change.", "url": "https://github.com/ConsenSys/teku/pull/2908#discussion_r501245477", "createdAt": "2020-10-07T19:05:14Z", "author": {"login": "cemozerr"}, "path": "networking/eth2/src/main/java/tech/pegasys/teku/networking/eth2/gossip/topics/validation/AttestationValidator.java", "diffHunk": "@@ -191,6 +191,21 @@ private InternalValidationResult singleAttestationChecks(final Attestation attes\n                 return REJECT;\n               }\n \n+              // The current finalized_checkpoint is an ancestor of the block defined by\n+              // aggregate.data.beacon_block_root\n+              if (!forkChoiceUtilWrapper\n+                  .get_ancestor(\n+                      recentChainData.getForkChoiceStrategy().orElseThrow(),\n+                      data.getBeacon_block_root(),\n+                      compute_start_slot_at_epoch(recentChainData.getFinalizedEpoch()))\n+                  .map(\n+                      ancestorOfLMDVote ->\n+                          ancestorOfLMDVote.equals(\n+                              recentChainData.getFinalizedCheckpoint().orElseThrow().getRoot()))", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMTIwNDUzMQ=="}, "originalCommit": {"oid": "6c69ca5e79fbb4caa405063af2ae17b9b5517c1e"}, "originalPosition": 14}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMTI2MDIxNA==", "bodyText": "Done.", "url": "https://github.com/ConsenSys/teku/pull/2908#discussion_r501260214", "createdAt": "2020-10-07T19:32:49Z", "author": {"login": "cemozerr"}, "path": "networking/eth2/src/main/java/tech/pegasys/teku/networking/eth2/gossip/topics/validation/AttestationValidator.java", "diffHunk": "@@ -191,6 +191,21 @@ private InternalValidationResult singleAttestationChecks(final Attestation attes\n                 return REJECT;\n               }\n \n+              // The current finalized_checkpoint is an ancestor of the block defined by\n+              // aggregate.data.beacon_block_root\n+              if (!forkChoiceUtilWrapper\n+                  .get_ancestor(\n+                      recentChainData.getForkChoiceStrategy().orElseThrow(),\n+                      data.getBeacon_block_root(),\n+                      compute_start_slot_at_epoch(recentChainData.getFinalizedEpoch()))\n+                  .map(\n+                      ancestorOfLMDVote ->\n+                          ancestorOfLMDVote.equals(\n+                              recentChainData.getFinalizedCheckpoint().orElseThrow().getRoot()))", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMTIwNDUzMQ=="}, "originalCommit": {"oid": "6c69ca5e79fbb4caa405063af2ae17b9b5517c1e"}, "originalPosition": 14}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3151, "cost": 1, "resetAt": "2021-11-12T11:57:46Z"}}}