{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0MzgyMTkwMzU4", "number": 1254, "title": "get beacon committees endpoint", "bodyText": "add /beacon/committees endpoint to allow committeeAssignments to be returned.\nadded missing test to show no content for /beacon/state\nUpdated readme which was missing a link to the spec.\nAddresses #1197", "createdAt": "2020-03-02T05:55:49Z", "url": "https://github.com/ConsenSys/teku/pull/1254", "merged": true, "mergeCommit": {"oid": "dacc3a25231905c5d477240a9fbb5d1878bbd3c9"}, "closed": true, "closedAt": "2020-03-03T22:44:10Z", "author": {"login": "rolfyone"}, "timelineItems": {"totalCount": 15, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcJnKi6gH2gAyMzgyMTkwMzU4OjgxZTgwMzc3ODA4YjFiNjQ1NmY3YTFiMTdlNzhjNDY4Zjk3YjIyOTY=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcKKG19gH2gAyMzgyMTkwMzU4OjBlMTEwNGJlZDZkMzRjOTdmY2Q0NGEzOWQxN2VlNjFmMDE2ZDA5MWY=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "81e80377808b1b6456f7a1b17e78c468f97b2296", "author": {"user": {"login": "rolfyone", "name": "Paul Harris"}}, "url": "https://github.com/ConsenSys/teku/commit/81e80377808b1b6456f7a1b17e78c468f97b2296", "committedDate": "2020-03-02T05:49:13Z", "message": "add /beacon/committees endpoint to allow committeeAssignments to be returned.\n\nadded missing test to show no content for /beacon/state\n\nUpdated readme which was missing a link to the spec.\n\nSigned-off-by: Paul Harris <paul.harris@consensys.net>\n\n#1197"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f04b92cf1db69ea3587ab549a57257a1d248d77b", "author": {"user": {"login": "rolfyone", "name": "Paul Harris"}}, "url": "https://github.com/ConsenSys/teku/commit/f04b92cf1db69ea3587ab549a57257a1d248d77b", "committedDate": "2020-03-02T05:49:40Z", "message": "Merge remote-tracking branch 'upstream/master' into 1197-beacon-committees-endpoint"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzY2OTgyNDY3", "url": "https://github.com/ConsenSys/teku/pull/1254#pullrequestreview-366982467", "createdAt": "2020-03-02T07:03:58Z", "commit": {"oid": "f04b92cf1db69ea3587ab549a57257a1d248d77b"}, "state": "COMMENTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wMlQwNzowMzo1OFrOFwVPBg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wMlQwNzowNzo0NlrOFwVS3w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NjIyMzg3OA==", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                  description = \"Request a list of the Committee assignments for a given epoch.\",\n          \n          \n            \n                  description = \"Request a list of the committee assignments for a given epoch.\",", "url": "https://github.com/ConsenSys/teku/pull/1254#discussion_r386223878", "createdAt": "2020-03-02T07:03:58Z", "author": {"login": "macfarla"}, "path": "data/beaconrestapi/src/main/java/tech/pegasys/artemis/beaconrestapi/beaconhandlers/BeaconCommitteesHandler.java", "diffHunk": "@@ -0,0 +1,97 @@\n+/*\n+ * Copyright 2020 ConsenSys AG.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\"); you may not use this file except in compliance with\n+ * the License. You may obtain a copy of the License at\n+ *\n+ * http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software distributed under the License is distributed on\n+ * an \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied. See the License for the\n+ * specific language governing permissions and limitations under the License.\n+ */\n+\n+package tech.pegasys.artemis.beaconrestapi.beaconhandlers;\n+\n+import static javax.servlet.http.HttpServletResponse.SC_BAD_REQUEST;\n+import static javax.servlet.http.HttpServletResponse.SC_NO_CONTENT;\n+import static tech.pegasys.artemis.beaconrestapi.RestApiConstants.EPOCH;\n+import static tech.pegasys.artemis.beaconrestapi.RestApiConstants.NO_CONTENT_PRE_GENESIS;\n+import static tech.pegasys.artemis.beaconrestapi.RestApiConstants.RES_BAD_REQUEST;\n+import static tech.pegasys.artemis.beaconrestapi.RestApiConstants.RES_INTERNAL_ERROR;\n+import static tech.pegasys.artemis.beaconrestapi.RestApiConstants.RES_NO_CONTENT;\n+import static tech.pegasys.artemis.beaconrestapi.RestApiConstants.RES_OK;\n+import static tech.pegasys.artemis.beaconrestapi.RestApiConstants.TAG_BEACON;\n+import static tech.pegasys.artemis.beaconrestapi.RestApiUtils.validateQueryParameter;\n+\n+import com.google.common.primitives.UnsignedLong;\n+import io.javalin.http.Context;\n+import io.javalin.http.Handler;\n+import io.javalin.plugin.openapi.annotations.HttpMethod;\n+import io.javalin.plugin.openapi.annotations.OpenApi;\n+import io.javalin.plugin.openapi.annotations.OpenApiContent;\n+import io.javalin.plugin.openapi.annotations.OpenApiParam;\n+import io.javalin.plugin.openapi.annotations.OpenApiResponse;\n+import java.util.List;\n+import tech.pegasys.artemis.beaconrestapi.schema.BadRequest;\n+import tech.pegasys.artemis.beaconrestapi.schema.CommitteesResponse;\n+import tech.pegasys.artemis.datastructures.state.CommitteeAssignment;\n+import tech.pegasys.artemis.provider.JsonProvider;\n+import tech.pegasys.artemis.storage.CombinedChainDataClient;\n+import tech.pegasys.artemis.util.async.SafeFuture;\n+\n+public class BeaconCommitteesHandler implements Handler {\n+\n+  public static final String ROUTE = \"/beacon/committees\";\n+\n+  private final CombinedChainDataClient combinedClient;\n+  private final JsonProvider jsonProvider;\n+\n+  public BeaconCommitteesHandler(\n+      CombinedChainDataClient combinedClient, JsonProvider jsonProvider) {\n+    this.combinedClient = combinedClient;\n+    this.jsonProvider = jsonProvider;\n+  }\n+\n+  @OpenApi(\n+      path = ROUTE,\n+      method = HttpMethod.GET,\n+      summary = \"Get the committees for all slots and committee indices in a given epoch.\",\n+      tags = {TAG_BEACON},\n+      queryParams = {\n+        @OpenApiParam(\n+            name = EPOCH,\n+            description = \"The epoch for which committees will be returned.\",\n+            required = true),\n+      },\n+      description = \"Request a list of the Committee assignments for a given epoch.\",", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f04b92cf1db69ea3587ab549a57257a1d248d77b"}, "originalPosition": 67}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NjIyNDg2Mw==", "bodyText": "committee assignments?", "url": "https://github.com/ConsenSys/teku/pull/1254#discussion_r386224863", "createdAt": "2020-03-02T07:07:46Z", "author": {"login": "macfarla"}, "path": "data/beaconrestapi/src/main/java/tech/pegasys/artemis/beaconrestapi/beaconhandlers/BeaconCommitteesHandler.java", "diffHunk": "@@ -0,0 +1,97 @@\n+/*\n+ * Copyright 2020 ConsenSys AG.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\"); you may not use this file except in compliance with\n+ * the License. You may obtain a copy of the License at\n+ *\n+ * http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software distributed under the License is distributed on\n+ * an \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied. See the License for the\n+ * specific language governing permissions and limitations under the License.\n+ */\n+\n+package tech.pegasys.artemis.beaconrestapi.beaconhandlers;\n+\n+import static javax.servlet.http.HttpServletResponse.SC_BAD_REQUEST;\n+import static javax.servlet.http.HttpServletResponse.SC_NO_CONTENT;\n+import static tech.pegasys.artemis.beaconrestapi.RestApiConstants.EPOCH;\n+import static tech.pegasys.artemis.beaconrestapi.RestApiConstants.NO_CONTENT_PRE_GENESIS;\n+import static tech.pegasys.artemis.beaconrestapi.RestApiConstants.RES_BAD_REQUEST;\n+import static tech.pegasys.artemis.beaconrestapi.RestApiConstants.RES_INTERNAL_ERROR;\n+import static tech.pegasys.artemis.beaconrestapi.RestApiConstants.RES_NO_CONTENT;\n+import static tech.pegasys.artemis.beaconrestapi.RestApiConstants.RES_OK;\n+import static tech.pegasys.artemis.beaconrestapi.RestApiConstants.TAG_BEACON;\n+import static tech.pegasys.artemis.beaconrestapi.RestApiUtils.validateQueryParameter;\n+\n+import com.google.common.primitives.UnsignedLong;\n+import io.javalin.http.Context;\n+import io.javalin.http.Handler;\n+import io.javalin.plugin.openapi.annotations.HttpMethod;\n+import io.javalin.plugin.openapi.annotations.OpenApi;\n+import io.javalin.plugin.openapi.annotations.OpenApiContent;\n+import io.javalin.plugin.openapi.annotations.OpenApiParam;\n+import io.javalin.plugin.openapi.annotations.OpenApiResponse;\n+import java.util.List;\n+import tech.pegasys.artemis.beaconrestapi.schema.BadRequest;\n+import tech.pegasys.artemis.beaconrestapi.schema.CommitteesResponse;\n+import tech.pegasys.artemis.datastructures.state.CommitteeAssignment;\n+import tech.pegasys.artemis.provider.JsonProvider;\n+import tech.pegasys.artemis.storage.CombinedChainDataClient;\n+import tech.pegasys.artemis.util.async.SafeFuture;\n+\n+public class BeaconCommitteesHandler implements Handler {\n+\n+  public static final String ROUTE = \"/beacon/committees\";\n+\n+  private final CombinedChainDataClient combinedClient;\n+  private final JsonProvider jsonProvider;\n+\n+  public BeaconCommitteesHandler(\n+      CombinedChainDataClient combinedClient, JsonProvider jsonProvider) {\n+    this.combinedClient = combinedClient;\n+    this.jsonProvider = jsonProvider;\n+  }\n+\n+  @OpenApi(\n+      path = ROUTE,\n+      method = HttpMethod.GET,\n+      summary = \"Get the committees for all slots and committee indices in a given epoch.\",", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f04b92cf1db69ea3587ab549a57257a1d248d77b"}, "originalPosition": 59}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "d324f43a774eead142352599bc07d20c791131c7", "author": {"user": {"login": "rolfyone", "name": "Paul Harris"}}, "url": "https://github.com/ConsenSys/teku/commit/d324f43a774eead142352599bc07d20c791131c7", "committedDate": "2020-03-03T02:11:02Z", "message": "Update data/beaconrestapi/src/main/java/tech/pegasys/artemis/beaconrestapi/beaconhandlers/BeaconCommitteesHandler.java\n\nCo-Authored-By: Sally MacFarlane <sally.macfarlane@consensys.net>"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzY3NjcxNTI5", "url": "https://github.com/ConsenSys/teku/pull/1254#pullrequestreview-367671529", "createdAt": "2020-03-03T02:49:54Z", "commit": {"oid": "d324f43a774eead142352599bc07d20c791131c7"}, "state": "COMMENTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wM1QwMjo0OTo1NFrOFw2sHQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wM1QwMjo1MTozN1rOFw2t9Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4Njc3MTk5Nw==", "bodyText": "AssertJ?", "url": "https://github.com/ConsenSys/teku/pull/1254#discussion_r386771997", "createdAt": "2020-03-03T02:49:54Z", "author": {"login": "mark-terry"}, "path": "storage/src/test/java/tech/pegasys/artemis/storage/CombinedChainDataClientTest.java", "diffHunk": "@@ -231,6 +235,16 @@ public void getBlockInEffectAtSlot_returnPreviousBlockWhenSlotWasEmpty() {\n         .isCompletedWithValue(Optional.of(block));\n   }\n \n+  @Test\n+  public void getCommitteesFromStateWithCache_shouldReturnCommitteeAssignments() {\n+    BeaconStateWithCache stateWithCache =\n+        BeaconStateWithCache.fromBeaconState(DataStructureUtil.randomBeaconState(11233));\n+    List<CommitteeAssignment> data =\n+        client.getCommitteesFromStateWithCache(\n+            Optional.of(stateWithCache), stateWithCache.getSlot());\n+    assertEquals(8, data.size());", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d324f43a774eead142352599bc07d20c791131c7"}, "originalPosition": 33}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4Njc3MjQ2OQ==", "bodyText": "When is this null?  If the store is null?", "url": "https://github.com/ConsenSys/teku/pull/1254#discussion_r386772469", "createdAt": "2020-03-03T02:51:37Z", "author": {"login": "mark-terry"}, "path": "storage/src/main/java/tech/pegasys/artemis/storage/CombinedChainDataClient.java", "diffHunk": "@@ -178,4 +185,49 @@ private boolean isFinalized(final UnsignedLong slot) {\n     }\n     return Optional.ofNullable(recentChainData.getBestBlockRoot());\n   }\n+\n+  public boolean isStoreAvailable() {\n+    return (recentChainData.getStore() != null);\n+  }\n+\n+  /**\n+   * Gets a list of CommitteeAssignments for a specified epoch.\n+   *\n+   * @param epoch - the current or historic epoch\n+   * @return list of CommitteeAssignments\n+   */\n+  public SafeFuture<List<CommitteeAssignment>> getCommitteeAssignmentAtEpoch(UnsignedLong epoch) {\n+    final UnsignedLong startingSlot = compute_start_slot_at_epoch(epoch);\n+\n+    SafeFuture<Optional<BeaconState>> future =\n+        getStateAtSlot(startingSlot, recentChainData.getBestBlockRoot());\n+    if (future != null) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d324f43a774eead142352599bc07d20c791131c7"}, "originalPosition": 45}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b32da4dff3744eff536a4ef737858219310c3d20", "author": {"user": {"login": "mark-terry", "name": null}}, "url": "https://github.com/ConsenSys/teku/commit/b32da4dff3744eff536a4ef737858219310c3d20", "committedDate": "2020-03-03T02:55:44Z", "message": "Merge branch 'master' into 1197-beacon-committees-endpoint"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzY3NjY5MDM3", "url": "https://github.com/ConsenSys/teku/pull/1254#pullrequestreview-367669037", "createdAt": "2020-03-03T02:41:33Z", "commit": {"oid": "f04b92cf1db69ea3587ab549a57257a1d248d77b"}, "state": "COMMENTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wM1QwMjo0MTozNFrOFw2j-Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wM1QwMjo1NTo0NVrOFw2x-Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4Njc2OTkxMw==", "bodyText": "You can just use thenApply here and not need to wrap in a completedFuture.", "url": "https://github.com/ConsenSys/teku/pull/1254#discussion_r386769913", "createdAt": "2020-03-03T02:41:34Z", "author": {"login": "ajsutton"}, "path": "storage/src/main/java/tech/pegasys/artemis/storage/CombinedChainDataClient.java", "diffHunk": "@@ -178,4 +185,49 @@ private boolean isFinalized(final UnsignedLong slot) {\n     }\n     return Optional.ofNullable(recentChainData.getBestBlockRoot());\n   }\n+\n+  public boolean isStoreAvailable() {\n+    return (recentChainData.getStore() != null);\n+  }\n+\n+  /**\n+   * Gets a list of CommitteeAssignments for a specified epoch.\n+   *\n+   * @param epoch - the current or historic epoch\n+   * @return list of CommitteeAssignments\n+   */\n+  public SafeFuture<List<CommitteeAssignment>> getCommitteeAssignmentAtEpoch(UnsignedLong epoch) {\n+    final UnsignedLong startingSlot = compute_start_slot_at_epoch(epoch);\n+\n+    SafeFuture<Optional<BeaconState>> future =\n+        getStateAtSlot(startingSlot, recentChainData.getBestBlockRoot());\n+    if (future != null) {\n+      return future\n+          .thenCompose(\n+              optionalState ->\n+                  completedFuture(getCommitteesFromStateWithCache(optionalState, startingSlot)))", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f04b92cf1db69ea3587ab549a57257a1d248d77b"}, "originalPosition": 49}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4Njc3MzQ5Nw==", "bodyText": "Committees are always calculated for one epoch ahead.  So if you want to calculate committees for epoch you need to get the state for epoch - 1.  The exception is epoch 0 which uses genesisState (as does epoch 1).\nSo you are actually able to calculate committees up to one epoch ahead of the current one.", "url": "https://github.com/ConsenSys/teku/pull/1254#discussion_r386773497", "createdAt": "2020-03-03T02:55:45Z", "author": {"login": "ajsutton"}, "path": "storage/src/main/java/tech/pegasys/artemis/storage/CombinedChainDataClient.java", "diffHunk": "@@ -178,4 +185,49 @@ private boolean isFinalized(final UnsignedLong slot) {\n     }\n     return Optional.ofNullable(recentChainData.getBestBlockRoot());\n   }\n+\n+  public boolean isStoreAvailable() {\n+    return (recentChainData.getStore() != null);\n+  }\n+\n+  /**\n+   * Gets a list of CommitteeAssignments for a specified epoch.\n+   *\n+   * @param epoch - the current or historic epoch\n+   * @return list of CommitteeAssignments\n+   */\n+  public SafeFuture<List<CommitteeAssignment>> getCommitteeAssignmentAtEpoch(UnsignedLong epoch) {\n+    final UnsignedLong startingSlot = compute_start_slot_at_epoch(epoch);\n+\n+    SafeFuture<Optional<BeaconState>> future =\n+        getStateAtSlot(startingSlot, recentChainData.getBestBlockRoot());", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f04b92cf1db69ea3587ab549a57257a1d248d77b"}, "originalPosition": 44}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "238c5791afdb0b09ed0fb05b40ac32d962f2a910", "author": {"user": {"login": "rolfyone", "name": "Paul Harris"}}, "url": "https://github.com/ConsenSys/teku/commit/238c5791afdb0b09ed0fb05b40ac32d962f2a910", "committedDate": "2020-03-03T06:50:15Z", "message": "changes per review comments\n\nSigned-off-by: Paul Harris <paul.harris@consensys.net>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "d2a5349cc95e2649328ccd052d57eeb1ac8de61a", "author": {"user": {"login": "rolfyone", "name": "Paul Harris"}}, "url": "https://github.com/ConsenSys/teku/commit/d2a5349cc95e2649328ccd052d57eeb1ac8de61a", "committedDate": "2020-03-03T10:44:01Z", "message": "Merge remote-tracking branch 'upstream/master' into 1197-beacon-committees-endpoint\n\nSigned-off-by: Paul Harris <paul.harris@consensys.net>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "2bde02d21215e8682824b2265d990c872dc3fc1c", "author": {"user": {"login": "rolfyone", "name": "Paul Harris"}}, "url": "https://github.com/ConsenSys/teku/commit/2bde02d21215e8682824b2265d990c872dc3fc1c", "committedDate": "2020-03-03T11:30:04Z", "message": "Merge remote-tracking branch 'upstream/master' into 1197-beacon-committees-endpoint"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzY4MzE5Njc2", "url": "https://github.com/ConsenSys/teku/pull/1254#pullrequestreview-368319676", "createdAt": "2020-03-03T20:59:34Z", "commit": {"oid": "2bde02d21215e8682824b2265d990c872dc3fc1c"}, "state": "COMMENTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wM1QyMDo1OTozNFrOFxWT7g==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wM1QyMDo1OTo1MFrOFxWUag==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NzI5MDA5NA==", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                final UnsignedLong committeesCalculatedAtEpoch = epoch.equals(ZERO) ? ZERO : epoch.minus(ONE);\n          \n          \n            \n                final UnsignedLong epochToCalculateCommittees = epoch.equals(ZERO) ? ZERO : epoch.minus(ONE);", "url": "https://github.com/ConsenSys/teku/pull/1254#discussion_r387290094", "createdAt": "2020-03-03T20:59:34Z", "author": {"login": "macfarla"}, "path": "storage/src/main/java/tech/pegasys/artemis/storage/CombinedChainDataClient.java", "diffHunk": "@@ -178,6 +187,47 @@ private boolean isFinalized(final UnsignedLong slot) {\n     return Optional.ofNullable(recentChainData.getBestBlockRoot());\n   }\n \n+  public boolean isStoreAvailable() {\n+    return (getStore() != null);\n+  }\n+\n+  /**\n+   * Gets a list of CommitteeAssignments for a specified epoch.\n+   *\n+   * @param epoch - the current or historic epoch\n+   * @return list of CommitteeAssignments\n+   */\n+  public SafeFuture<List<CommitteeAssignment>> getCommitteeAssignmentAtEpoch(UnsignedLong epoch) {\n+    final UnsignedLong committeesCalculatedAtEpoch = epoch.equals(ZERO) ? ZERO : epoch.minus(ONE);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "2bde02d21215e8682824b2265d990c872dc3fc1c"}, "originalPosition": 44}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NzI5MDIxOA==", "bodyText": "names are hard. still don't love it", "url": "https://github.com/ConsenSys/teku/pull/1254#discussion_r387290218", "createdAt": "2020-03-03T20:59:50Z", "author": {"login": "macfarla"}, "path": "storage/src/main/java/tech/pegasys/artemis/storage/CombinedChainDataClient.java", "diffHunk": "@@ -178,6 +187,47 @@ private boolean isFinalized(final UnsignedLong slot) {\n     return Optional.ofNullable(recentChainData.getBestBlockRoot());\n   }\n \n+  public boolean isStoreAvailable() {\n+    return (getStore() != null);\n+  }\n+\n+  /**\n+   * Gets a list of CommitteeAssignments for a specified epoch.\n+   *\n+   * @param epoch - the current or historic epoch\n+   * @return list of CommitteeAssignments\n+   */\n+  public SafeFuture<List<CommitteeAssignment>> getCommitteeAssignmentAtEpoch(UnsignedLong epoch) {\n+    final UnsignedLong committeesCalculatedAtEpoch = epoch.equals(ZERO) ? ZERO : epoch.minus(ONE);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NzI5MDA5NA=="}, "originalCommit": {"oid": "2bde02d21215e8682824b2265d990c872dc3fc1c"}, "originalPosition": 44}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "08e613d0fe790740d68f5f36bd221b72b992125c", "author": {"user": {"login": "rolfyone", "name": "Paul Harris"}}, "url": "https://github.com/ConsenSys/teku/commit/08e613d0fe790740d68f5f36bd221b72b992125c", "committedDate": "2020-03-03T22:00:54Z", "message": "Update storage/src/main/java/tech/pegasys/artemis/storage/CombinedChainDataClient.java\n\nCo-Authored-By: Sally MacFarlane <sally.macfarlane@consensys.net>"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzY4MzYyNzcy", "url": "https://github.com/ConsenSys/teku/pull/1254#pullrequestreview-368362772", "createdAt": "2020-03-03T22:09:36Z", "commit": {"oid": "08e613d0fe790740d68f5f36bd221b72b992125c"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "309585c16491fa264b83850c7edb9fa930a21df7", "author": {"user": {"login": "rolfyone", "name": "Paul Harris"}}, "url": "https://github.com/ConsenSys/teku/commit/309585c16491fa264b83850c7edb9fa930a21df7", "committedDate": "2020-03-03T22:24:21Z", "message": "changes from review comments"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "0e1104bed6d34c97fcd44a39d17ee61f016d091f", "author": {"user": {"login": "rolfyone", "name": "Paul Harris"}}, "url": "https://github.com/ConsenSys/teku/commit/0e1104bed6d34c97fcd44a39d17ee61f016d091f", "committedDate": "2020-03-03T22:31:51Z", "message": "spotless"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4144, "cost": 1, "resetAt": "2021-11-01T13:51:04Z"}}}