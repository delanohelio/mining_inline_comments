{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0Mzg0MDc3NjE4", "number": 1293, "reviewThreads": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wNVQyMTo1Nzo0N1rODlmi1w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wNVQyMTo1ODo0MFrODlmjyw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjQwNzU1NDE1OnYy", "diffSide": "RIGHT", "path": "data/beaconrestapi/src/test/java/tech/pegasys/artemis/beaconrestapi/networkhandlers/PeersHandlerTest.java", "isResolved": true, "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wNVQyMTo1Nzo0N1rOFyluJg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wNlQwMDoyMTo1OFrOFyowpQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4ODU5MTE0Mg==", "bodyText": "is this how we set caching headers?", "url": "https://github.com/ConsenSys/teku/pull/1293#discussion_r388591142", "createdAt": "2020-03-05T21:57:47Z", "author": {"login": "macfarla"}, "path": "data/beaconrestapi/src/test/java/tech/pegasys/artemis/beaconrestapi/networkhandlers/PeersHandlerTest.java", "diffHunk": "@@ -48,23 +52,26 @@ public void shouldReturnArrayOfPeersIfPresent() throws Exception {\n \n     when(peer1.getId()).thenReturn(nodeId1);\n     when(peer2.getId()).thenReturn(nodeId2);\n-    when(p2PNetwork.streamPeers()).thenReturn(Stream.of(peer1, peer2));\n+    when(p2pNetwork.streamPeers()).thenReturn(Stream.of(peer1, peer2));\n \n     final String response =\n         jsonProvider.objectToJSON(new String[] {peerId1.toBase58(), peerId2.toBase58()});\n \n     peersHandler.handle(context);\n+    verify(context).header(Header.CACHE_CONTROL, CACHE_ONE_MINUTE);\n     verify(context).result(response);\n   }\n \n   @Test\n   public void shouldReturnEmptyPeersArrayIfNoneConnected() throws Exception {\n-    final PeersHandler peersHandler = new PeersHandler(p2PNetwork, jsonProvider);\n+    final NetworkDataProvider network = new NetworkDataProvider(p2pNetwork);\n+    final PeersHandler peersHandler = new PeersHandler(network, jsonProvider);\n     final String response = jsonProvider.objectToJSON(new String[] {});\n \n-    when(p2PNetwork.streamPeers()).thenReturn(Stream.empty());\n+    when(p2pNetwork.streamPeers()).thenReturn(Stream.empty());\n \n     peersHandler.handle(context);\n+    verify(context).header(Header.CACHE_CONTROL, CACHE_ONE_MINUTE);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "8a18ee6aac44919088b606695d2059205476227c"}, "originalPosition": 59}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4ODU5MTI0OA==", "bodyText": "is neat", "url": "https://github.com/ConsenSys/teku/pull/1293#discussion_r388591248", "createdAt": "2020-03-05T21:58:00Z", "author": {"login": "macfarla"}, "path": "data/beaconrestapi/src/test/java/tech/pegasys/artemis/beaconrestapi/networkhandlers/PeersHandlerTest.java", "diffHunk": "@@ -48,23 +52,26 @@ public void shouldReturnArrayOfPeersIfPresent() throws Exception {\n \n     when(peer1.getId()).thenReturn(nodeId1);\n     when(peer2.getId()).thenReturn(nodeId2);\n-    when(p2PNetwork.streamPeers()).thenReturn(Stream.of(peer1, peer2));\n+    when(p2pNetwork.streamPeers()).thenReturn(Stream.of(peer1, peer2));\n \n     final String response =\n         jsonProvider.objectToJSON(new String[] {peerId1.toBase58(), peerId2.toBase58()});\n \n     peersHandler.handle(context);\n+    verify(context).header(Header.CACHE_CONTROL, CACHE_ONE_MINUTE);\n     verify(context).result(response);\n   }\n \n   @Test\n   public void shouldReturnEmptyPeersArrayIfNoneConnected() throws Exception {\n-    final PeersHandler peersHandler = new PeersHandler(p2PNetwork, jsonProvider);\n+    final NetworkDataProvider network = new NetworkDataProvider(p2pNetwork);\n+    final PeersHandler peersHandler = new PeersHandler(network, jsonProvider);\n     final String response = jsonProvider.objectToJSON(new String[] {});\n \n-    when(p2PNetwork.streamPeers()).thenReturn(Stream.empty());\n+    when(p2pNetwork.streamPeers()).thenReturn(Stream.empty());\n \n     peersHandler.handle(context);\n+    verify(context).header(Header.CACHE_CONTROL, CACHE_ONE_MINUTE);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4ODU5MTE0Mg=="}, "originalCommit": {"oid": "8a18ee6aac44919088b606695d2059205476227c"}, "originalPosition": 59}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4ODY0MDkzMw==", "bodyText": "yep! simpler than i thought", "url": "https://github.com/ConsenSys/teku/pull/1293#discussion_r388640933", "createdAt": "2020-03-06T00:21:58Z", "author": {"login": "rolfyone"}, "path": "data/beaconrestapi/src/test/java/tech/pegasys/artemis/beaconrestapi/networkhandlers/PeersHandlerTest.java", "diffHunk": "@@ -48,23 +52,26 @@ public void shouldReturnArrayOfPeersIfPresent() throws Exception {\n \n     when(peer1.getId()).thenReturn(nodeId1);\n     when(peer2.getId()).thenReturn(nodeId2);\n-    when(p2PNetwork.streamPeers()).thenReturn(Stream.of(peer1, peer2));\n+    when(p2pNetwork.streamPeers()).thenReturn(Stream.of(peer1, peer2));\n \n     final String response =\n         jsonProvider.objectToJSON(new String[] {peerId1.toBase58(), peerId2.toBase58()});\n \n     peersHandler.handle(context);\n+    verify(context).header(Header.CACHE_CONTROL, CACHE_ONE_MINUTE);\n     verify(context).result(response);\n   }\n \n   @Test\n   public void shouldReturnEmptyPeersArrayIfNoneConnected() throws Exception {\n-    final PeersHandler peersHandler = new PeersHandler(p2PNetwork, jsonProvider);\n+    final NetworkDataProvider network = new NetworkDataProvider(p2pNetwork);\n+    final PeersHandler peersHandler = new PeersHandler(network, jsonProvider);\n     final String response = jsonProvider.objectToJSON(new String[] {});\n \n-    when(p2PNetwork.streamPeers()).thenReturn(Stream.empty());\n+    when(p2pNetwork.streamPeers()).thenReturn(Stream.empty());\n \n     peersHandler.handle(context);\n+    verify(context).header(Header.CACHE_CONTROL, CACHE_ONE_MINUTE);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4ODU5MTE0Mg=="}, "originalCommit": {"oid": "8a18ee6aac44919088b606695d2059205476227c"}, "originalPosition": 59}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjQwNzU1NjU5OnYy", "diffSide": "RIGHT", "path": "data/beaconrestapi/src/test/java/tech/pegasys/artemis/beaconrestapi/networkhandlers/PeersHandlerTest.java", "isResolved": true, "comments": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wNVQyMTo1ODo0MFrOFylvyQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wNlQwMDoyMjozNlrOFyoxWQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4ODU5MTU2MQ==", "bodyText": "ooo controversial", "url": "https://github.com/ConsenSys/teku/pull/1293#discussion_r388591561", "createdAt": "2020-03-05T21:58:40Z", "author": {"login": "macfarla"}, "path": "data/beaconrestapi/src/test/java/tech/pegasys/artemis/beaconrestapi/networkhandlers/PeersHandlerTest.java", "diffHunk": "@@ -34,11 +37,12 @@\n public class PeersHandlerTest {\n   private final JsonProvider jsonProvider = new JsonProvider();\n   @Mock Context context;\n-  @Mock P2PNetwork<Peer> p2PNetwork;\n+  @Mock P2PNetwork<Peer> p2pNetwork;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "8a18ee6aac44919088b606695d2059205476227c"}, "originalPosition": 23}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4ODU5MTcyOA==", "bodyText": "are you willing to die on this hill", "url": "https://github.com/ConsenSys/teku/pull/1293#discussion_r388591728", "createdAt": "2020-03-05T21:59:00Z", "author": {"login": "macfarla"}, "path": "data/beaconrestapi/src/test/java/tech/pegasys/artemis/beaconrestapi/networkhandlers/PeersHandlerTest.java", "diffHunk": "@@ -34,11 +37,12 @@\n public class PeersHandlerTest {\n   private final JsonProvider jsonProvider = new JsonProvider();\n   @Mock Context context;\n-  @Mock P2PNetwork<Peer> p2PNetwork;\n+  @Mock P2PNetwork<Peer> p2pNetwork;", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4ODU5MTU2MQ=="}, "originalCommit": {"oid": "8a18ee6aac44919088b606695d2059205476227c"}, "originalPosition": 23}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4ODYzMDUwNQ==", "bodyText": "I like p2pNetwork too. :) And this looks exactly like the kind of hill I would be far more tempted to die on that I should be. :P", "url": "https://github.com/ConsenSys/teku/pull/1293#discussion_r388630505", "createdAt": "2020-03-05T23:46:55Z", "author": {"login": "ajsutton"}, "path": "data/beaconrestapi/src/test/java/tech/pegasys/artemis/beaconrestapi/networkhandlers/PeersHandlerTest.java", "diffHunk": "@@ -34,11 +37,12 @@\n public class PeersHandlerTest {\n   private final JsonProvider jsonProvider = new JsonProvider();\n   @Mock Context context;\n-  @Mock P2PNetwork<Peer> p2PNetwork;\n+  @Mock P2PNetwork<Peer> p2pNetwork;", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4ODU5MTU2MQ=="}, "originalCommit": {"oid": "8a18ee6aac44919088b606695d2059205476227c"}, "originalPosition": 23}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4ODY0MTExMw==", "bodyText": "p2PNetwork is just ugly....", "url": "https://github.com/ConsenSys/teku/pull/1293#discussion_r388641113", "createdAt": "2020-03-06T00:22:36Z", "author": {"login": "rolfyone"}, "path": "data/beaconrestapi/src/test/java/tech/pegasys/artemis/beaconrestapi/networkhandlers/PeersHandlerTest.java", "diffHunk": "@@ -34,11 +37,12 @@\n public class PeersHandlerTest {\n   private final JsonProvider jsonProvider = new JsonProvider();\n   @Mock Context context;\n-  @Mock P2PNetwork<Peer> p2PNetwork;\n+  @Mock P2PNetwork<Peer> p2pNetwork;", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4ODU5MTU2MQ=="}, "originalCommit": {"oid": "8a18ee6aac44919088b606695d2059205476227c"}, "originalPosition": 23}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2734, "cost": 1, "resetAt": "2021-11-12T11:57:46Z"}}}