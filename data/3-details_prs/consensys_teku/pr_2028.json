{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDI2MzQzNTM5", "number": 2028, "title": "Use the fork info at the current time rather than where sync is up to", "bodyText": "PR Description\nThe status message should use the fork version that would be in effect at the current time, not the time of the best head block.\nWhile this means the status still makes two separate calls to chain data, we're guaranteed to get consistent data.  Even if the next fork activates between getting the best state and next fork, the state and nextFork will now match and we'll get the same result.\nAll a bit redundant as there is no next fork yet anyway, but good to be clear about where things should come from.\nFixed Issue(s)\nfixes #1945", "createdAt": "2020-06-02T04:32:56Z", "url": "https://github.com/ConsenSys/teku/pull/2028", "merged": true, "mergeCommit": {"oid": "47127546573cd00f997b1d82ddef2a1daf49f3ce"}, "closed": true, "closedAt": "2020-06-02T20:12:57Z", "author": {"login": "ajsutton"}, "timelineItems": {"totalCount": 5, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcnNC-wgH2gAyNDI2MzQzNTM5OjdiMDg5YzQxNzNiOGM3NWY2N2M1MWY3OTg3NTVmZWQzNTc2ZDk2NDg=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcnaZ-fAH2gAyNDI2MzQzNTM5OmIyMmUzMTEzZDY4MzFhNDYwMjQxODc1ZmIzZWNkODhiYjFiOGQxZTY=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "7b089c4173b8c75f67c51f798755fed3576d9648", "author": {"user": {"login": "ajsutton", "name": "Adrian Sutton"}}, "url": "https://github.com/ConsenSys/teku/commit/7b089c4173b8c75f67c51f798755fed3576d9648", "committedDate": "2020-06-02T04:21:09Z", "message": "Use the fork info at the current time rather than where sync is up to."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDIyNzQ1MjY3", "url": "https://github.com/ConsenSys/teku/pull/2028#pullrequestreview-422745267", "createdAt": "2020-06-02T14:37:32Z", "commit": {"oid": "7b089c4173b8c75f67c51f798755fed3576d9648"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDIyNzI4NjU1", "url": "https://github.com/ConsenSys/teku/pull/2028#pullrequestreview-422728655", "createdAt": "2020-06-02T14:20:14Z", "commit": {"oid": "7b089c4173b8c75f67c51f798755fed3576d9648"}, "state": "APPROVED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wMlQxNDoyMDoxNFrOGd0DoA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wMlQxNDoyMDoxNFrOGd0DoA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMzkxNDc4NA==", "bodyText": "This isn't quite true is it?  There could be an additional fork after the next fork (I assume the \"next fork\" is supposed to be the fork after the head state fork?) that is actually active for the current slot.  I assume at some point we'll have some explicit fork config that we can query ...  Might be worth a comment with caveats + javadoc on getNextFork.   And maybe getCurrentForkInfo should be getHeadForkInfo.", "url": "https://github.com/ConsenSys/teku/pull/2028#discussion_r433914784", "createdAt": "2020-06-02T14:20:14Z", "author": {"login": "mbaxter"}, "path": "storage/src/main/java/tech/pegasys/teku/storage/client/RecentChainData.java", "diffHunk": "@@ -204,6 +205,29 @@ private boolean hasReorgedFrom(\n     return Optional.empty();\n   }\n \n+  /**\n+   * Returns the fork info that applies based on the node's current slot, regardless of where the\n+   * sync progress is up to.", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "7b089c4173b8c75f67c51f798755fed3576d9648"}, "originalPosition": 14}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "fb7a11067f84e3e1841905ad146c20808aff4bc9", "author": {"user": {"login": "ajsutton", "name": "Adrian Sutton"}}, "url": "https://github.com/ConsenSys/teku/commit/fb7a11067f84e3e1841905ad146c20808aff4bc9", "committedDate": "2020-06-02T19:54:53Z", "message": "Rename for clarity."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b22e3113d6831a460241875fb3ecd88bb1b8d1e6", "author": {"user": {"login": "ajsutton", "name": "Adrian Sutton"}}, "url": "https://github.com/ConsenSys/teku/commit/b22e3113d6831a460241875fb3ecd88bb1b8d1e6", "committedDate": "2020-06-02T19:55:02Z", "message": "Merge branch 'master' of github.com:PegaSysEng/teku into status-from-current-time"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4081, "cost": 1, "resetAt": "2021-11-01T13:51:04Z"}}}