{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTMzMzYyNjY4", "number": 3369, "title": "Set the default log file pattern to use the path from the data-path.", "bodyText": "fixes #3360\nSigned-off-by: Paul Harris paul.harris@consensys.net\nDocumentation\n\n I thought about documentation and added the documentation label to this PR if updates are required.", "createdAt": "2020-12-07T04:33:09Z", "url": "https://github.com/ConsenSys/teku/pull/3369", "merged": true, "mergeCommit": {"oid": "5c8accb1dd17babd078d81ca86856eabebdfcf02"}, "closed": true, "closedAt": "2020-12-07T21:21:57Z", "author": {"login": "rolfyone"}, "timelineItems": {"totalCount": 6, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdjt4yCAH2gAyNTMzMzYyNjY4OjYyYWQ4NzMwZGFjNTVmNmZlYzIxZTViODJlMjY0YTZkNTRlNDkyZDY=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdj8Rb6AFqTU0NjU0MzM0Mw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "62ad8730dac55f6fec21e5b82e264a6d54e492d6", "author": {"user": {"login": "rolfyone", "name": "Paul Harris"}}, "url": "https://github.com/ConsenSys/teku/commit/62ad8730dac55f6fec21e5b82e264a6d54e492d6", "committedDate": "2020-12-07T04:32:20Z", "message": "Set the default log file pattern to use the path from the data-path.\n\nfixes #3360\n\nSigned-off-by: Paul Harris <paul.harris@consensys.net>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c6b3a1b25c71d904d8feef179bf8fba1109f25cc", "author": {"user": {"login": "rolfyone", "name": "Paul Harris"}}, "url": "https://github.com/ConsenSys/teku/commit/c6b3a1b25c71d904d8feef179bf8fba1109f25cc", "committedDate": "2020-12-07T05:05:49Z", "message": "Merge remote-tracking branch 'upstream/master' into 3360"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTQ1ODM3MTA4", "url": "https://github.com/ConsenSys/teku/pull/3369#pullrequestreview-545837108", "createdAt": "2020-12-07T05:19:45Z", "commit": {"oid": "c6b3a1b25c71d904d8feef179bf8fba1109f25cc"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0wN1QwNToxOTo0NVrOIAWZog==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0wN1QwNToxOTo0NVrOIAWZog==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNzIzNzkyMg==", "bodyText": "So, turns out this should have taken into account whether it was the validator or not too.  Result should be the same as the default log file but with _%d{yyyy-MM-dd} inserted before the .log extension.", "url": "https://github.com/ConsenSys/teku/pull/3369#discussion_r537237922", "createdAt": "2020-12-07T05:19:45Z", "author": {"login": "ajsutton"}, "path": "teku/src/main/java/tech/pegasys/teku/cli/options/LoggingOptions.java", "diffHunk": "@@ -160,4 +161,15 @@ public static String getDefaultLogFileGivenDataDir(String dataPath, boolean isVa\n       return dataPath + SEP + \"logs\" + SEP + \"teku.log\";\n     }\n   }\n+\n+  public static String getLogPatternGivenDataDir(\n+      final String dataPath, final String logFileNamePattern) {\n+    if (logFileNamePattern.equals(DEFAULT_LOG_PATH_PATTERN)) {\n+      return StringUtils.joinWith(SEP, dataPath, \"logs\", DEFAULT_LOG_FILE_NAME_PATTERN);\n+    }\n+    if (!logFileNamePattern.contains(SEP)) {\n+      return StringUtils.joinWith(SEP, dataPath, \"logs\", logFileNamePattern);\n+    }\n+    return logFileNamePattern;\n+  }", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c6b3a1b25c71d904d8feef179bf8fba1109f25cc"}, "originalPosition": 36}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "eaf716210afe2c20ed9e50dddd01f9e51a70f4ec", "author": {"user": {"login": "rolfyone", "name": "Paul Harris"}}, "url": "https://github.com/ConsenSys/teku/commit/eaf716210afe2c20ed9e50dddd01f9e51a70f4ec", "committedDate": "2020-12-07T05:42:05Z", "message": "initial review feedback\n\nSigned-off-by: Paul Harris <paul.harris@consensys.net>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f762ad8a4ef279003d1feed225654a1c652e122f", "author": {"user": {"login": "rolfyone", "name": "Paul Harris"}}, "url": "https://github.com/ConsenSys/teku/commit/f762ad8a4ef279003d1feed225654a1c652e122f", "committedDate": "2020-12-07T10:16:40Z", "message": "refactor logging pattern into a builder to get better consistency.\n\nSigned-off-by: Paul Harris <paul.harris@consensys.net>"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTQ2NTQzMzQz", "url": "https://github.com/ConsenSys/teku/pull/3369#pullrequestreview-546543343", "createdAt": "2020-12-07T21:16:59Z", "commit": {"oid": "f762ad8a4ef279003d1feed225654a1c652e122f"}, "state": "APPROVED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0wN1QyMToxNjo1OVrOIA7FhQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0wN1QyMToxNjo1OVrOIA7FhQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNzgzODk4MQ==", "bodyText": "Nice. That's going to fix a very common problem for people who just specify the filename instead of the whole path.", "url": "https://github.com/ConsenSys/teku/pull/3369#discussion_r537838981", "createdAt": "2020-12-07T21:16:59Z", "author": {"login": "ajsutton"}, "path": "teku/src/main/java/tech/pegasys/teku/cli/util/LoggingPathBuilder.java", "diffHunk": "@@ -0,0 +1,58 @@\n+/*\n+ * Copyright 2020 ConsenSys AG.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\"); you may not use this file except in compliance with\n+ * the License. You may obtain a copy of the License at\n+ *\n+ * http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software distributed under the License is distributed on\n+ * an \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied. See the License for the\n+ * specific language governing permissions and limitations under the License.\n+ */\n+\n+package tech.pegasys.teku.cli.util;\n+\n+import java.util.Optional;\n+import org.apache.commons.lang3.StringUtils;\n+import tech.pegasys.teku.util.cli.VersionProvider;\n+\n+public class LoggingPathBuilder {\n+  public static final String SEP = System.getProperty(\"file.separator\");\n+  private String defaultPath = VersionProvider.defaultStoragePath();\n+  private Optional<String> dataPath = Optional.empty();\n+  private String fromCommandLine;\n+  private String defaultBasename;\n+\n+  public LoggingPathBuilder defaultBasename(final String defaultBasename) {\n+    this.defaultBasename = defaultBasename;\n+    return this;\n+  }\n+\n+  public LoggingPathBuilder dataPath(final String dataPath) {\n+    this.dataPath = Optional.of(dataPath);\n+    return this;\n+  }\n+\n+  public LoggingPathBuilder fromCommandLine(final String path) {\n+    this.fromCommandLine = path;\n+    return this;\n+  }\n+\n+  public String build() {\n+    if (StringUtils.isNotEmpty(fromCommandLine)) {\n+      if (fromCommandLine.contains(SEP)) {\n+        return fromCommandLine;\n+      } else {\n+        return StringUtils.joinWith(SEP, dataPath.orElse(defaultPath), \"logs\", fromCommandLine);\n+      }", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f762ad8a4ef279003d1feed225654a1c652e122f"}, "originalPosition": 48}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4349, "cost": 1, "resetAt": "2021-11-01T13:51:04Z"}}}