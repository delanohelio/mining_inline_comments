{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDMxMzYxMjEy", "number": 2083, "reviewThreads": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wOVQwMDo1OTowOVrOEDrMEQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wOVQwMTowMToxMlrOEDrNkw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjcyMjg4Nzg1OnYy", "diffSide": "RIGHT", "path": ".circleci/config.yml", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wOVQwMDo1OTowOVrOGg1N-Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wOVQwMDo1OTowOVrOGg1N-Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNzA3OTU0NQ==", "bodyText": "nit:\n\n  \n    \n  \n    \n\n  \n  This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters. Learn more about bidirectional Unicode characters\n\n\n  \n\n\n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                        # retrieve branch to publish to from CIrcle CI env vars and fallback on test-gh-pages\n          \n          \n            \n                        # retrieve branch to publish to from Circle CI env vars and fallback on test-gh-pages", "url": "https://github.com/ConsenSys/teku/pull/2083#discussion_r437079545", "createdAt": "2020-06-09T00:59:09Z", "author": {"login": "ajsutton"}, "path": ".circleci/config.yml", "diffHunk": "@@ -307,53 +307,88 @@ jobs:\n             kill $TEKU_PID\n             exit $EXIT_CODE\n       - store_artifacts:\n-          path: openapi.json\n+          path: ./docs/openapi.json\n       - store_artifacts:\n           path: teku_output.log\n       - persist_to_workspace:\n           root: ~/project\n           paths:\n-            - ./\n+            - ./docs/openapi.json\n \n   publishAPIDoc:\n     executor: node_executor\n     steps:\n+      # This job requires that we checkout current branch first to have all the repos.\n+      # it will not be used directly as we have the saved workspace\n+      # but will enable to checkout gh-pages branch.\n       - checkout\n       - attach_workspace:\n-          at: ~/project\n-      - add_ssh_keys:\n-          fingerprints:\n-            - '45:36:58:67:43:15:c6:5f:2c:58:ec:7f:71:e2:e6:ef'\n+          at: /tmp/workspace\n       - run:\n-          name: Set Git user params\n+          name: checkout gh pages branch and copy files from workspace\n           command: |\n-            git config --global user.name $CIRCLE_USERNAME\n-            git config --global user.email \"${CIRCLE_USERNAME}@users.noreply.github.com\"\n+            # publishing happens by pushing files to gh-pages branch\n+            # retrieve branch to publish to from CIrcle CI env vars and fallback on test-gh-pages", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "3073785aa6f6b04c037607b7e8b17ad62c527dee"}, "originalPosition": 52}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjcyMjg5MDM2OnYy", "diffSide": "RIGHT", "path": ".circleci/config.yml", "isResolved": true, "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wOVQwMTowMDoyN1rOGg1PXg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wOVQxNzo1NzoxOVrOGhV9Yw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNzA3OTkwMg==", "bodyText": "I'd suggest we should fall back to gh-pages so that the code says what it will do in the normal case.  Removing the BRANCH_OVERRIDE is probably ideal if we can so that you don't have to go digging through CircleCI to find out what this will actually do.", "url": "https://github.com/ConsenSys/teku/pull/2083#discussion_r437079902", "createdAt": "2020-06-09T01:00:27Z", "author": {"login": "ajsutton"}, "path": ".circleci/config.yml", "diffHunk": "@@ -307,53 +307,88 @@ jobs:\n             kill $TEKU_PID\n             exit $EXIT_CODE\n       - store_artifacts:\n-          path: openapi.json\n+          path: ./docs/openapi.json\n       - store_artifacts:\n           path: teku_output.log\n       - persist_to_workspace:\n           root: ~/project\n           paths:\n-            - ./\n+            - ./docs/openapi.json\n \n   publishAPIDoc:\n     executor: node_executor\n     steps:\n+      # This job requires that we checkout current branch first to have all the repos.\n+      # it will not be used directly as we have the saved workspace\n+      # but will enable to checkout gh-pages branch.\n       - checkout\n       - attach_workspace:\n-          at: ~/project\n-      - add_ssh_keys:\n-          fingerprints:\n-            - '45:36:58:67:43:15:c6:5f:2c:58:ec:7f:71:e2:e6:ef'\n+          at: /tmp/workspace\n       - run:\n-          name: Set Git user params\n+          name: checkout gh pages branch and copy files from workspace\n           command: |\n-            git config --global user.name $CIRCLE_USERNAME\n-            git config --global user.email \"${CIRCLE_USERNAME}@users.noreply.github.com\"\n+            # publishing happens by pushing files to gh-pages branch\n+            # retrieve branch to publish to from CIrcle CI env vars and fallback on test-gh-pages\n+            # if no var defined\n+            [ -n \"$BRANCH_OVERRIDE\" ] && readonly BRANCH=\"$BRANCH_OVERRIDE\" || readonly BRANCH='test-gh-pages'", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "3073785aa6f6b04c037607b7e8b17ad62c527dee"}, "originalPosition": 54}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNzQ5NDMyNg==", "bodyText": "This code was suggested by @benjamincburns so I would like his opinion on that.", "url": "https://github.com/ConsenSys/teku/pull/2083#discussion_r437494326", "createdAt": "2020-06-09T15:03:23Z", "author": {"login": "NicolasMassart"}, "path": ".circleci/config.yml", "diffHunk": "@@ -307,53 +307,88 @@ jobs:\n             kill $TEKU_PID\n             exit $EXIT_CODE\n       - store_artifacts:\n-          path: openapi.json\n+          path: ./docs/openapi.json\n       - store_artifacts:\n           path: teku_output.log\n       - persist_to_workspace:\n           root: ~/project\n           paths:\n-            - ./\n+            - ./docs/openapi.json\n \n   publishAPIDoc:\n     executor: node_executor\n     steps:\n+      # This job requires that we checkout current branch first to have all the repos.\n+      # it will not be used directly as we have the saved workspace\n+      # but will enable to checkout gh-pages branch.\n       - checkout\n       - attach_workspace:\n-          at: ~/project\n-      - add_ssh_keys:\n-          fingerprints:\n-            - '45:36:58:67:43:15:c6:5f:2c:58:ec:7f:71:e2:e6:ef'\n+          at: /tmp/workspace\n       - run:\n-          name: Set Git user params\n+          name: checkout gh pages branch and copy files from workspace\n           command: |\n-            git config --global user.name $CIRCLE_USERNAME\n-            git config --global user.email \"${CIRCLE_USERNAME}@users.noreply.github.com\"\n+            # publishing happens by pushing files to gh-pages branch\n+            # retrieve branch to publish to from CIrcle CI env vars and fallback on test-gh-pages\n+            # if no var defined\n+            [ -n \"$BRANCH_OVERRIDE\" ] && readonly BRANCH=\"$BRANCH_OVERRIDE\" || readonly BRANCH='test-gh-pages'", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNzA3OTkwMg=="}, "originalCommit": {"oid": "3073785aa6f6b04c037607b7e8b17ad62c527dee"}, "originalPosition": 54}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNzYxNTk3MQ==", "bodyText": "I agree with @ajsutton - his approach is better than the one I suggested.", "url": "https://github.com/ConsenSys/teku/pull/2083#discussion_r437615971", "createdAt": "2020-06-09T17:57:19Z", "author": {"login": "benjamincburns"}, "path": ".circleci/config.yml", "diffHunk": "@@ -307,53 +307,88 @@ jobs:\n             kill $TEKU_PID\n             exit $EXIT_CODE\n       - store_artifacts:\n-          path: openapi.json\n+          path: ./docs/openapi.json\n       - store_artifacts:\n           path: teku_output.log\n       - persist_to_workspace:\n           root: ~/project\n           paths:\n-            - ./\n+            - ./docs/openapi.json\n \n   publishAPIDoc:\n     executor: node_executor\n     steps:\n+      # This job requires that we checkout current branch first to have all the repos.\n+      # it will not be used directly as we have the saved workspace\n+      # but will enable to checkout gh-pages branch.\n       - checkout\n       - attach_workspace:\n-          at: ~/project\n-      - add_ssh_keys:\n-          fingerprints:\n-            - '45:36:58:67:43:15:c6:5f:2c:58:ec:7f:71:e2:e6:ef'\n+          at: /tmp/workspace\n       - run:\n-          name: Set Git user params\n+          name: checkout gh pages branch and copy files from workspace\n           command: |\n-            git config --global user.name $CIRCLE_USERNAME\n-            git config --global user.email \"${CIRCLE_USERNAME}@users.noreply.github.com\"\n+            # publishing happens by pushing files to gh-pages branch\n+            # retrieve branch to publish to from CIrcle CI env vars and fallback on test-gh-pages\n+            # if no var defined\n+            [ -n \"$BRANCH_OVERRIDE\" ] && readonly BRANCH=\"$BRANCH_OVERRIDE\" || readonly BRANCH='test-gh-pages'", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNzA3OTkwMg=="}, "originalCommit": {"oid": "3073785aa6f6b04c037607b7e8b17ad62c527dee"}, "originalPosition": 54}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjcyMjg5MTcxOnYy", "diffSide": "RIGHT", "path": ".circleci/config.yml", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wOVQwMTowMToxMlrOGg1QIw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wOVQxNTowMjoyOFrOGhOfow==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNzA4MDA5OQ==", "bodyText": "Should we delete the existing content first?  Otherwise if a file is moved both versions will stay around forever with one being stale.", "url": "https://github.com/ConsenSys/teku/pull/2083#discussion_r437080099", "createdAt": "2020-06-09T01:01:12Z", "author": {"login": "ajsutton"}, "path": ".circleci/config.yml", "diffHunk": "@@ -307,53 +307,88 @@ jobs:\n             kill $TEKU_PID\n             exit $EXIT_CODE\n       - store_artifacts:\n-          path: openapi.json\n+          path: ./docs/openapi.json\n       - store_artifacts:\n           path: teku_output.log\n       - persist_to_workspace:\n           root: ~/project\n           paths:\n-            - ./\n+            - ./docs/openapi.json\n \n   publishAPIDoc:\n     executor: node_executor\n     steps:\n+      # This job requires that we checkout current branch first to have all the repos.\n+      # it will not be used directly as we have the saved workspace\n+      # but will enable to checkout gh-pages branch.\n       - checkout\n       - attach_workspace:\n-          at: ~/project\n-      - add_ssh_keys:\n-          fingerprints:\n-            - '45:36:58:67:43:15:c6:5f:2c:58:ec:7f:71:e2:e6:ef'\n+          at: /tmp/workspace\n       - run:\n-          name: Set Git user params\n+          name: checkout gh pages branch and copy files from workspace\n           command: |\n-            git config --global user.name $CIRCLE_USERNAME\n-            git config --global user.email \"${CIRCLE_USERNAME}@users.noreply.github.com\"\n+            # publishing happens by pushing files to gh-pages branch\n+            # retrieve branch to publish to from CIrcle CI env vars and fallback on test-gh-pages\n+            # if no var defined\n+            [ -n \"$BRANCH_OVERRIDE\" ] && readonly BRANCH=\"$BRANCH_OVERRIDE\" || readonly BRANCH='test-gh-pages'\n+\n+            # switch to the publishing branch\n+            git checkout \"$BRANCH\"\n+\n+            # copy the content of the docs folder built on the previous job and attached\n+            # using workspace on temp location\n+            # cp with T option to override existing content, specially usefull for latest\n+            cp -aT /tmp/workspace/docs/. .", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "3073785aa6f6b04c037607b7e8b17ad62c527dee"}, "originalPosition": 62}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNzQ5MzY2Nw==", "bodyText": "We want to keep the content to preserve all the specs from previous versions. If any changes are made that require to delete some files from gh-pages branch, it would be done by someone knowing the system and who will be able to update the gh-pages branch manually. It should not be a process that will be used often, so I prefer not to build a complex thing and potential bugs for that.", "url": "https://github.com/ConsenSys/teku/pull/2083#discussion_r437493667", "createdAt": "2020-06-09T15:02:28Z", "author": {"login": "NicolasMassart"}, "path": ".circleci/config.yml", "diffHunk": "@@ -307,53 +307,88 @@ jobs:\n             kill $TEKU_PID\n             exit $EXIT_CODE\n       - store_artifacts:\n-          path: openapi.json\n+          path: ./docs/openapi.json\n       - store_artifacts:\n           path: teku_output.log\n       - persist_to_workspace:\n           root: ~/project\n           paths:\n-            - ./\n+            - ./docs/openapi.json\n \n   publishAPIDoc:\n     executor: node_executor\n     steps:\n+      # This job requires that we checkout current branch first to have all the repos.\n+      # it will not be used directly as we have the saved workspace\n+      # but will enable to checkout gh-pages branch.\n       - checkout\n       - attach_workspace:\n-          at: ~/project\n-      - add_ssh_keys:\n-          fingerprints:\n-            - '45:36:58:67:43:15:c6:5f:2c:58:ec:7f:71:e2:e6:ef'\n+          at: /tmp/workspace\n       - run:\n-          name: Set Git user params\n+          name: checkout gh pages branch and copy files from workspace\n           command: |\n-            git config --global user.name $CIRCLE_USERNAME\n-            git config --global user.email \"${CIRCLE_USERNAME}@users.noreply.github.com\"\n+            # publishing happens by pushing files to gh-pages branch\n+            # retrieve branch to publish to from CIrcle CI env vars and fallback on test-gh-pages\n+            # if no var defined\n+            [ -n \"$BRANCH_OVERRIDE\" ] && readonly BRANCH=\"$BRANCH_OVERRIDE\" || readonly BRANCH='test-gh-pages'\n+\n+            # switch to the publishing branch\n+            git checkout \"$BRANCH\"\n+\n+            # copy the content of the docs folder built on the previous job and attached\n+            # using workspace on temp location\n+            # cp with T option to override existing content, specially usefull for latest\n+            cp -aT /tmp/workspace/docs/. .", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNzA4MDA5OQ=="}, "originalCommit": {"oid": "3073785aa6f6b04c037607b7e8b17ad62c527dee"}, "originalPosition": 62}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3560, "cost": 1, "resetAt": "2021-11-12T11:57:46Z"}}}