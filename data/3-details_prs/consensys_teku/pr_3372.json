{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTMzOTg4MjM2", "number": 3372, "title": "Avoid BigInteger multiplication when calculating base rewards", "bodyText": "PR Description\nPreviously UInt64.times switched to using BigInteger to perform multiplication when either multiplicand is bigger than the square root of UInt64.MAX_VALUE to provide overflow protection.\nEpoch transition multiplies the sum of effective balances by 64 and the effective balances were greater than the square root value, causing the more expensive path to be taken.\nAdd an additional check that if one multiplicand is 64 or less and the other is less than MAX_VALUE / 64, use the fast path as the result is known to not overflow.\nNot a huge performance gain but simple enough.\nDocumentation\n\n I thought about documentation and added the documentation label to this PR if updates are required.", "createdAt": "2020-12-07T22:27:49Z", "url": "https://github.com/ConsenSys/teku/pull/3372", "merged": true, "mergeCommit": {"oid": "5c2d15a8dcf57b52f01d1fac1e13da3c3354fe5a"}, "closed": true, "closedAt": "2020-12-07T22:53:23Z", "author": {"login": "ajsutton"}, "timelineItems": {"totalCount": 6, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdj9QAygH2gAyNTMzOTg4MjM2OjNhZDY2YjU2NmQ3NjRmM2FmMzdkNzUyMjk1YzEyMGI3YmEyZWEzMzM=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdj9e1CAFqTU0NjYwMDM2Ng==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "3ad66b566d764f3af37d752295c120b7ba2ea333", "author": {"user": {"login": "ajsutton", "name": "Adrian Sutton"}}, "url": "https://github.com/ConsenSys/teku/commit/3ad66b566d764f3af37d752295c120b7ba2ea333", "committedDate": "2020-12-07T22:26:17Z", "message": "Avoid BigInteger multiplication when calculating base rewards.\n\nPreviously UInt64.times switched to using BigInteger to perform multiplication when either multiplicand is bigger than the square root of UInt64.MAX_VALUE to provide overflow protection.\nEpoch transition multiplies the sum of effective balances by 64 and the effective balances were greater than the square root value, causing the more expensive path to be taken.\nAdd an additional check that if one multiplicand is 64 or less and the other is less than MAX_VALUE / 64, use the fast path as the result is known to not overflow."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTQ2NTk4MDQ2", "url": "https://github.com/ConsenSys/teku/pull/3372#pullrequestreview-546598046", "createdAt": "2020-12-07T22:39:05Z", "commit": {"oid": "3ad66b566d764f3af37d752295c120b7ba2ea333"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0wN1QyMjozOTowNVrOIA-CCw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0wN1QyMjozOTowNVrOIA-CCw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNzg4NzI0Mw==", "bodyText": "more efficient to store as long and 64L?", "url": "https://github.com/ConsenSys/teku/pull/3372#discussion_r537887243", "createdAt": "2020-12-07T22:39:05Z", "author": {"login": "rolfyone"}, "path": "infrastructure/unsigned/src/main/java/tech/pegasys/teku/infrastructure/unsigned/UInt64.java", "diffHunk": "@@ -37,6 +37,10 @@\n    */\n   static final long SQRT_MAX_VALUE = 4294967295L;\n \n+  static final int SPECIAL_CASE_MULTIPLICAND = 64;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "3ad66b566d764f3af37d752295c120b7ba2ea333"}, "originalPosition": 4}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "8fd542a84fa8ff6fbf1c4efc9d5b94a9e7b06431", "author": {"user": {"login": "ajsutton", "name": "Adrian Sutton"}}, "url": "https://github.com/ConsenSys/teku/commit/8fd542a84fa8ff6fbf1c4efc9d5b94a9e7b06431", "committedDate": "2020-12-07T22:40:18Z", "message": "Use long."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "1c43b463c75d4cade2492f47bdb9eae31956dddf", "author": {"user": {"login": "ajsutton", "name": "Adrian Sutton"}}, "url": "https://github.com/ConsenSys/teku/commit/1c43b463c75d4cade2492f47bdb9eae31956dddf", "committedDate": "2020-12-07T22:40:23Z", "message": "Merge branch 'master' of github.com:ConsenSys/teku into uint64-times"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTQ2NTk5NjQ3", "url": "https://github.com/ConsenSys/teku/pull/3372#pullrequestreview-546599647", "createdAt": "2020-12-07T22:41:31Z", "commit": {"oid": "1c43b463c75d4cade2492f47bdb9eae31956dddf"}, "state": "COMMENTED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTQ2NjAwMzY2", "url": "https://github.com/ConsenSys/teku/pull/3372#pullrequestreview-546600366", "createdAt": "2020-12-07T22:42:28Z", "commit": {"oid": "1c43b463c75d4cade2492f47bdb9eae31956dddf"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4354, "cost": 1, "resetAt": "2021-11-01T13:51:04Z"}}}