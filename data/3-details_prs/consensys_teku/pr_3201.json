{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTE5NTU0MTYw", "number": 3201, "title": "limit the available options for voluntary-exit.", "bodyText": "Signed-off-by: Paul Harris paul.harris@consensys.net\nDocumentation\n\n I thought about documentation and added the documentation label to this PR if updates are required.", "createdAt": "2020-11-12T01:31:38Z", "url": "https://github.com/ConsenSys/teku/pull/3201", "merged": true, "mergeCommit": {"oid": "c90a489b1855028ed5b2e432bbb6fc1c1411910f"}, "closed": true, "closedAt": "2020-11-12T05:09:59Z", "author": {"login": "rolfyone"}, "timelineItems": {"totalCount": 9, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdboTJBAH2gAyNTE5NTU0MTYwOjA0ZGJmMmM3MDAyMzI1YzEwNTRjMzIzOTQwZDg5ZWY1MTA2ZWFmNTE=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdbrRmeAH2gAyNTE5NTU0MTYwOjRjMTA0OGUxNTQwNTYzYTI2YTliMjJiYjZhNzQ0MWY5MWYzYmUxODQ=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "04dbf2c7002325c1054c323940d89ef5106eaf51", "author": {"user": {"login": "rolfyone", "name": "Paul Harris"}}, "url": "https://github.com/ConsenSys/teku/commit/04dbf2c7002325c1054c323940d89ef5106eaf51", "committedDate": "2020-11-12T01:30:18Z", "message": "limit the available options for voluntary-exit.\n\nSigned-off-by: Paul Harris <paul.harris@consensys.net>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "04ac9a15552f8510f547b4c99996f0df53e17a09", "author": {"user": {"login": "rolfyone", "name": "Paul Harris"}}, "url": "https://github.com/ConsenSys/teku/commit/04ac9a15552f8510f547b4c99996f0df53e17a09", "committedDate": "2020-11-12T01:33:36Z", "message": "Merge remote-tracking branch 'upstream/master' into voluntary-exit-cli"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTI4Njc3Nzg3", "url": "https://github.com/ConsenSys/teku/pull/3201#pullrequestreview-528677787", "createdAt": "2020-11-12T01:51:22Z", "commit": {"oid": "04ac9a15552f8510f547b4c99996f0df53e17a09"}, "state": "COMMENTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xMlQwMTo1MToyMlrOHxmIvQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xMlQwMTo1MzoxNFrOHxmK5A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMTc2NzEwMQ==", "bodyText": "This isn't enough.  We also need the options to specify external signers:\n\nvalidators-external-signer-public-keys\n--validators-external-signer-url\n--validators-external-signer-timeout", "url": "https://github.com/ConsenSys/teku/pull/3201#discussion_r521767101", "createdAt": "2020-11-12T01:51:22Z", "author": {"login": "ajsutton"}, "path": "teku/src/main/java/tech/pegasys/teku/cli/options/ValidatorKeysOptions.java", "diffHunk": "@@ -0,0 +1,38 @@\n+/*\n+ * Copyright 2020 ConsenSys AG.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\"); you may not use this file except in compliance with\n+ * the License. You may obtain a copy of the License at\n+ *\n+ * http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software distributed under the License is distributed on\n+ * an \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied. See the License for the\n+ * specific language governing permissions and limitations under the License.\n+ */\n+\n+package tech.pegasys.teku.cli.options;\n+\n+import java.util.ArrayList;\n+import java.util.List;\n+import picocli.CommandLine;\n+import tech.pegasys.teku.config.TekuConfiguration;\n+\n+public class ValidatorKeysOptions {\n+\n+  @CommandLine.Option(\n+      names = {\"--validator-keys\"},\n+      paramLabel = \"<KEY_DIR>:<PASS_DIR> | <KEY_FILE>:<PASS_FILE>\",\n+      description =\n+          \"<KEY_DIR>:<PASS_DIR> will find <KEY_DIR>/**.json, and expect to find <PASS_DIR>/**.txt.\\n\"\n+              + \"<KEY_FILE>:<PASS_FILE> will expect that the file <KEY_FILE> exists, \"\n+              + \"and the file containing the password for it is <PASS_FILE>.\\n\"\n+              + \"The path separator is operating system dependent, and should be ';' in windows rather than ':'.\",\n+      split = \",\",\n+      arity = \"1..*\")\n+  private List<String> validatorKeys = new ArrayList<>();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "04ac9a15552f8510f547b4c99996f0df53e17a09"}, "originalPosition": 33}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMTc2NzY1Mg==", "bodyText": "Probably worth making SlashingProtector an interface so we can just supply a FORBID_ALL option here (validator exit shouldn't ask to sign any attestations or blocks so if it does, slashing protector should reject the request)", "url": "https://github.com/ConsenSys/teku/pull/3201#discussion_r521767652", "createdAt": "2020-11-12T01:53:14Z", "author": {"login": "ajsutton"}, "path": "teku/src/main/java/tech/pegasys/teku/cli/subcommand/VoluntaryExitCommand.java", "diffHunk": "@@ -179,10 +164,10 @@ private void initialise() {\n     }\n     genesisRoot = maybeRoot.get();\n \n-    // get the validator\n-    final Path slashProtectionPath = getSlashingProtectionPath(dataOptions);\n+    // slashing protection won't be looked at, but it is required to create a validator loader.\n+    // No files will be created in the path\n     final SlashingProtector slashingProtector =\n-        new SlashingProtector(new SyncDataAccessor(), slashProtectionPath);\n+        new SlashingProtector(new SyncDataAccessor(), Path.of(\".\"));", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "04ac9a15552f8510f547b4c99996f0df53e17a09"}, "originalPosition": 57}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "4dd095b2942a0b9da7b10be9e33c842357711cea", "author": {"user": {"login": "rolfyone", "name": "Paul Harris"}}, "url": "https://github.com/ConsenSys/teku/commit/4dd095b2942a0b9da7b10be9e33c842357711cea", "committedDate": "2020-11-12T02:53:48Z", "message": "move the external-signer flags so they can be used by the voluntary exit command.\n\nSigned-off-by: Paul Harris <paul.harris@consensys.net>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a592d8ce42808c1616724d7f639aa415509f0f75", "author": {"user": {"login": "rolfyone", "name": "Paul Harris"}}, "url": "https://github.com/ConsenSys/teku/commit/a592d8ce42808c1616724d7f639aa415509f0f75", "committedDate": "2020-11-12T03:27:44Z", "message": "add confirmation to the workflow, and a 'loading configuration' option because it can be slow if many validators are being loaded.\n\nSigned-off-by: Paul Harris <paul.harris@consensys.net>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "5bbb7e188d03e47a3969fc86021a76f9ed6da66f", "author": {"user": {"login": "rolfyone", "name": "Paul Harris"}}, "url": "https://github.com/ConsenSys/teku/commit/5bbb7e188d03e47a3969fc86021a76f9ed6da66f", "committedDate": "2020-11-12T04:12:49Z", "message": "change SlashingProtector to be an interface, and provide a protector that rejects all requests.\n\nSigned-off-by: Paul Harris <paul.harris@consensys.net>"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTI4NzQ1MDI2", "url": "https://github.com/ConsenSys/teku/pull/3201#pullrequestreview-528745026", "createdAt": "2020-11-12T04:40:19Z", "commit": {"oid": "5bbb7e188d03e47a3969fc86021a76f9ed6da66f"}, "state": "APPROVED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xMlQwNDo0MDoxOVrOHxqSHA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xMlQwNDo0MTo0MFrOHxqTVg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMTgzNTAzNg==", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                    \"\\nThese validators won't be able to be re-activated, and withdrawals aren't likely to be possible until Phase 2 of eth2 Mainnet.\");\n          \n          \n            \n                    \"\\nThese validators won't be able to be re-activated, and withdrawals are unlikely to be possible until Phase 2 of eth2 Mainnet.\");", "url": "https://github.com/ConsenSys/teku/pull/3201#discussion_r521835036", "createdAt": "2020-11-12T04:40:19Z", "author": {"login": "ajsutton"}, "path": "teku/src/main/java/tech/pegasys/teku/cli/subcommand/VoluntaryExitCommand.java", "diffHunk": "@@ -98,10 +84,33 @@\n \n   @Override\n   public void run() {\n+    SUB_COMMAND_LOG.display(\"Loading configuration...\");\n     initialise();\n+    confirmExits();\n     getValidatorIndices(blsPublicKeyValidatorMap).forEach(this::submitExitForValidator);\n   }\n \n+  private void confirmExits() {\n+    SUB_COMMAND_LOG.display(\"Exits are going to be generated for validators: \");\n+    SUB_COMMAND_LOG.display(getValidatorAbbreviatedKeys());\n+    SUB_COMMAND_LOG.display(\n+        \"\\nThese validators won't be able to be re-activated, and withdrawals aren't likely to be possible until Phase 2 of eth2 Mainnet.\");", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "5bbb7e188d03e47a3969fc86021a76f9ed6da66f"}, "originalPosition": 78}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMTgzNTM1MA==", "bodyText": "Also, can't hard code \\n - should separate calls to display for each line.", "url": "https://github.com/ConsenSys/teku/pull/3201#discussion_r521835350", "createdAt": "2020-11-12T04:41:40Z", "author": {"login": "ajsutton"}, "path": "teku/src/main/java/tech/pegasys/teku/cli/subcommand/VoluntaryExitCommand.java", "diffHunk": "@@ -98,10 +84,33 @@\n \n   @Override\n   public void run() {\n+    SUB_COMMAND_LOG.display(\"Loading configuration...\");\n     initialise();\n+    confirmExits();\n     getValidatorIndices(blsPublicKeyValidatorMap).forEach(this::submitExitForValidator);\n   }\n \n+  private void confirmExits() {\n+    SUB_COMMAND_LOG.display(\"Exits are going to be generated for validators: \");\n+    SUB_COMMAND_LOG.display(getValidatorAbbreviatedKeys());\n+    SUB_COMMAND_LOG.display(\n+        \"\\nThese validators won't be able to be re-activated, and withdrawals aren't likely to be possible until Phase 2 of eth2 Mainnet.\");", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMTgzNTAzNg=="}, "originalCommit": {"oid": "5bbb7e188d03e47a3969fc86021a76f9ed6da66f"}, "originalPosition": 78}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ec6ec1ba3f134fd78e9a15303d940e25283c50eb", "author": {"user": {"login": "rolfyone", "name": "Paul Harris"}}, "url": "https://github.com/ConsenSys/teku/commit/ec6ec1ba3f134fd78e9a15303d940e25283c50eb", "committedDate": "2020-11-12T04:57:30Z", "message": "review feedback\n\nSigned-off-by: Paul Harris <paul.harris@consensys.net>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "4c1048e1540563a26a9b22bb6a7441f91f3be184", "author": {"user": {"login": "rolfyone", "name": "Paul Harris"}}, "url": "https://github.com/ConsenSys/teku/commit/4c1048e1540563a26a9b22bb6a7441f91f3be184", "committedDate": "2020-11-12T04:58:20Z", "message": "Merge remote-tracking branch 'upstream/master' into voluntary-exit-cli"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4437, "cost": 1, "resetAt": "2021-11-01T13:51:04Z"}}}