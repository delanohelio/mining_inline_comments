{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDM4MTc5MzI5", "number": 2194, "title": "Rework storage tests", "bodyText": "PR Description\nRework storage tests to use StorageSystem test utility.\nDocumentation\n\n I thought about documentation and added the documentation label to this PR if updates are required.", "createdAt": "2020-06-22T21:10:50Z", "url": "https://github.com/ConsenSys/teku/pull/2194", "merged": true, "mergeCommit": {"oid": "a03f80ea16e81c15516d12ec00aa271973e13279"}, "closed": true, "closedAt": "2020-06-23T21:05:38Z", "author": {"login": "mbaxter"}, "timelineItems": {"totalCount": 15, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABct4XL6gH2gAyNDM4MTc5MzI5OmYzZjk3YjkxZWEyZWY4ZmQ5YjBiMDdkYjNlNGYyZTRhZWY5MGYyMDA=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcuMHLbAFqTQzNjE2MjM4Mg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "f3f97b91ea2ef8fd9b0b07db3e4f2e4aef90f200", "author": {"user": {"login": "mbaxter", "name": null}}, "url": "https://github.com/ConsenSys/teku/commit/f3f97b91ea2ef8fd9b0b07db3e4f2e4aef90f200", "committedDate": "2020-06-22T22:12:41Z", "message": "Create StorageSystem interface and add file-backed implementation"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f410e9a4027cc05d6be8552d763fc88d0690ad67", "author": {"user": {"login": "mbaxter", "name": null}}, "url": "https://github.com/ConsenSys/teku/commit/f410e9a4027cc05d6be8552d763fc88d0690ad67", "committedDate": "2020-06-22T22:12:41Z", "message": "Add database accessor to StorageSystem interface"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e5e051cdca1f1f1fa39ade73ac8d07d3ad82d7b2", "author": {"user": {"login": "mbaxter", "name": null}}, "url": "https://github.com/ConsenSys/teku/commit/e5e051cdca1f1f1fa39ade73ac8d07d3ad82d7b2", "committedDate": "2020-06-22T22:12:41Z", "message": "Add DepositStorage API's to StorageSystem"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "bd930142ba2fedeee951fbc30dc3bcc34ae926b8", "author": {"user": {"login": "mbaxter", "name": null}}, "url": "https://github.com/ConsenSys/teku/commit/bd930142ba2fedeee951fbc30dc3bcc34ae926b8", "committedDate": "2020-06-22T22:12:41Z", "message": "Make DepositStorageTest independent of AbstractRocksDbDatabaseTest"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "7bf0e73507bd8b78cbf558cc0b838bdb0c9852f1", "author": {"user": {"login": "mbaxter", "name": null}}, "url": "https://github.com/ConsenSys/teku/commit/7bf0e73507bd8b78cbf558cc0b838bdb0c9852f1", "committedDate": "2020-06-22T22:12:41Z", "message": "Make StorageSystem AutoCloseable"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "9a3bed06c1ef33ed6eb0e86f7004446b0fa28e6e", "author": {"user": {"login": "mbaxter", "name": null}}, "url": "https://github.com/ConsenSys/teku/commit/9a3bed06c1ef33ed6eb0e86f7004446b0fa28e6e", "committedDate": "2020-06-22T22:12:41Z", "message": "Update database tests to use StorageSystem"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e914fbc88c335adce1007285e45a17e6882552be", "author": {"user": {"login": "mbaxter", "name": null}}, "url": "https://github.com/ConsenSys/teku/commit/e914fbc88c335adce1007285e45a17e6882552be", "committedDate": "2020-06-22T22:12:41Z", "message": "Fix finalization logic"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "bcc4d5fae329afb9d1e9e71b4f03b82eafd24baa", "author": {"user": {"login": "mbaxter", "name": null}}, "url": "https://github.com/ConsenSys/teku/commit/bcc4d5fae329afb9d1e9e71b4f03b82eafd24baa", "committedDate": "2020-06-22T20:46:44Z", "message": "Fix finalization logic"}, "afterCommit": {"oid": "e914fbc88c335adce1007285e45a17e6882552be", "author": {"user": {"login": "mbaxter", "name": null}}, "url": "https://github.com/ConsenSys/teku/commit/e914fbc88c335adce1007285e45a17e6882552be", "committedDate": "2020-06-22T22:12:41Z", "message": "Fix finalization logic"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "1ed73ff5c8767cfbe183a81b9c9d06d1da07b751", "author": {"user": {"login": "mbaxter", "name": null}}, "url": "https://github.com/ConsenSys/teku/commit/1ed73ff5c8767cfbe183a81b9c9d06d1da07b751", "committedDate": "2020-06-23T16:42:28Z", "message": "Merge branch 'master' into issue-2037/rework-storage-tests"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "5b7007605c59cf4e20bafcfbbbf04025fb7b3395", "author": {"user": {"login": "mbaxter", "name": null}}, "url": "https://github.com/ConsenSys/teku/commit/5b7007605c59cf4e20bafcfbbbf04025fb7b3395", "committedDate": "2020-06-23T17:25:07Z", "message": "Adapt v4 database tests"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDM2MTI3MjEz", "url": "https://github.com/ConsenSys/teku/pull/2194#pullrequestreview-436127213", "createdAt": "2020-06-23T20:24:18Z", "commit": {"oid": "5b7007605c59cf4e20bafcfbbbf04025fb7b3395"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yM1QyMDoyNDoxOFrOGn5PEQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yM1QyMDoyNDoxOFrOGn5PEQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NDQ4NTM5Mw==", "bodyText": "nit:\n\n  \n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                SignedBlockAndState finalizedBlock = chainBuilder.getBlockAndStateAtSlot(7);\n          \n          \n            \n                SignedBlockAndState finalizedBlock = chainBuilder.getBlockAndStateAtSlot(finalizedSlot);", "url": "https://github.com/ConsenSys/teku/pull/2194#discussion_r444485393", "createdAt": "2020-06-23T20:24:18Z", "author": {"login": "cemozerr"}, "path": "storage/src/test/java/tech/pegasys/teku/storage/server/rocksdb/V3RocksDbDatabaseTest.java", "diffHunk": "@@ -124,10 +121,9 @@ private void testShouldPruneHotBlocksOlderThanFinalizedSlotAfterRestart(\n     final long finalizedSlot = 7;\n     final int hotBlockCount = 3;\n     // Setup chains\n-    final ChainBuilder chain = ChainBuilder.create(VALIDATOR_KEYS);\n-    final SignedBlockAndState genesis = chain.generateGenesis();\n-    chain.generateBlocksUpToSlot(finalizedSlot);\n-    final Checkpoint finalizedCheckpoint = getCheckpointForBlock(chain.getBlockAtSlot(7));\n+    chainBuilder.generateBlocksUpToSlot(finalizedSlot);\n+    SignedBlockAndState finalizedBlock = chainBuilder.getBlockAndStateAtSlot(7);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "5b7007605c59cf4e20bafcfbbbf04025fb7b3395"}, "originalPosition": 67}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDM2MTQ0MjM0", "url": "https://github.com/ConsenSys/teku/pull/2194#pullrequestreview-436144234", "createdAt": "2020-06-23T20:49:01Z", "commit": {"oid": "5b7007605c59cf4e20bafcfbbbf04025fb7b3395"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f5a913b1d0c4eaa56e27caf9720d5450bd328320", "author": {"user": {"login": "mbaxter", "name": null}}, "url": "https://github.com/ConsenSys/teku/commit/f5a913b1d0c4eaa56e27caf9720d5450bd328320", "committedDate": "2020-06-23T20:49:46Z", "message": "Merge branch 'master' into issue-2037/rework-storage-tests"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ce2f68ac86d6f19912158e0799bf034d49b8e452", "author": {"user": {"login": "mbaxter", "name": null}}, "url": "https://github.com/ConsenSys/teku/commit/ce2f68ac86d6f19912158e0799bf034d49b8e452", "committedDate": "2020-06-23T20:51:04Z", "message": "Cut magic number\n\nCo-authored-by: Cem Ozer <cemozer2018@u.northwestern.edu>"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDM2MTYyMzgy", "url": "https://github.com/ConsenSys/teku/pull/2194#pullrequestreview-436162382", "createdAt": "2020-06-23T21:13:18Z", "commit": {"oid": "ce2f68ac86d6f19912158e0799bf034d49b8e452"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3960, "cost": 1, "resetAt": "2021-11-01T13:51:04Z"}}}