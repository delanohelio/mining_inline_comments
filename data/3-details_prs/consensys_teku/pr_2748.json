{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDgxNzQ5NjU2", "number": 2748, "title": "[2722] add GetPeers and GetPeersById api endpoints", "bodyText": "deprecated a number of endpoints that are now served by standard endpoints\n\u00a0\u00a0 - /network/enr -> /eth/v1/node/identity\n\u00a0\u00a0 - /network/listen_addresses -> /eth/v1/node/identity\n\u00a0\u00a0 - /network/listen_port -> /eth/v1/node/identity\n\u00a0\u00a0 - /network/peer_count -> /eth/v1/node/peers\n\u00a0\u00a0 - /network/peer_id -> /eth/v1/node/identity\n\u00a0\u00a0 - /network/peers -> /eth/v1/node/peers\n\n\nprovided /eth/v1/node/peers\n\u00a0\u00a0 - never sets ENR currently, as its a non trivial exercise to retrieve.\n\n\nprovided /eth/v1/node/peers/:peer_id\n\n\nOnly added an integration test for getPeerById, as getPeers is just a case of calling that multiple times.\nSigned-off-by: Paul Harris paul.harris@consensys.net\nDocumentation\n\n I thought about documentation and added the documentation label to this PR if updates are required.", "createdAt": "2020-09-08T03:31:42Z", "url": "https://github.com/ConsenSys/teku/pull/2748", "merged": true, "mergeCommit": {"oid": "8aeb4a0fc98e827f45ac13bd6e63e541cae790c4"}, "closed": true, "closedAt": "2020-09-08T23:38:13Z", "author": {"login": "rolfyone"}, "timelineItems": {"totalCount": 10, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdGvBJHAH2gAyNDgxNzQ5NjU2OjVlYWM3MTE0MWQ4NWQ0NDc1Zjc4M2MxMjZhODk3MzM3MjAzNWIzNGQ=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdHASBBgFqTQ4NDU2MTkzMA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "5eac71141d85d4475f783c126a8973372035b34d", "author": {"user": {"login": "rolfyone", "name": "Paul Harris"}}, "url": "https://github.com/ConsenSys/teku/commit/5eac71141d85d4475f783c126a8973372035b34d", "committedDate": "2020-09-08T03:27:34Z", "message": "add GetPeers and GetPeersById api endpoints\n\n - deprecated a number of endpoints that are now served by standard endpoints\n   - /network/enr -> /eth/v1/node/identity\n   - /network/listen_addresses -> /eth/v1/node/identity\n   - /network/listen_port -> /eth/v1/node/identity\n   - /network/peer_count -> /eth/v1/node/peers\n   - /network/peer_id -> /eth/v1/node/identity\n   - /network/peers -> /eth/v1/node/peers\n\n - provided /eth/v1/node/peers\n   - never sets ENR currently, as its a non trivial exercise to retrieve.\n - provided /eth/v1/node/peers/:peer_id\n\n Only added an integration test for getPeerById, as getPeers is just a case of calling that multiple times.\n\nSigned-off-by: Paul Harris <paul.harris@consensys.net>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "135239aa8ae4b43a4747ed90012eff55fd1e02a9", "author": {"user": {"login": "rolfyone", "name": "Paul Harris"}}, "url": "https://github.com/ConsenSys/teku/commit/135239aa8ae4b43a4747ed90012eff55fd1e02a9", "committedDate": "2020-09-08T03:28:00Z", "message": "Merge remote-tracking branch 'upstream/master' into 2722-node-peers"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDgzNzg1NTc3", "url": "https://github.com/ConsenSys/teku/pull/2748#pullrequestreview-483785577", "createdAt": "2020-09-08T04:22:46Z", "commit": {"oid": "135239aa8ae4b43a4747ed90012eff55fd1e02a9"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0wOFQwNDoyMjo0NlrOHOMMxw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0wOFQwNDoyMjo0NlrOHOMMxw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NDY0MTk5MQ==", "bodyText": "This is definitely not ideal.  It probably should ask the network to convert the peerId into the right type rather than hard coding a LibP2PNodeId.  Probably the simplest thing would be to overload P2PNetwork.getPeer to have a version that takes a string - then the conversion to a NodeId can be done internally.\nShould consider what to do when the peerId isn't valid base58 - probably should return not found.", "url": "https://github.com/ConsenSys/teku/pull/2748#discussion_r484641991", "createdAt": "2020-09-08T04:22:46Z", "author": {"login": "ajsutton"}, "path": "data/provider/src/main/java/tech/pegasys/teku/api/NetworkDataProvider.java", "diffHunk": "@@ -89,4 +94,23 @@ public int getListenPort() {\n   public Metadata getMetadata() {\n     return new Metadata(network.getMetadata());\n   }\n+\n+  public List<tech.pegasys.teku.api.response.v1.node.Peer> getPeers() {\n+    return network.streamPeers().map(this::toPeer).collect(Collectors.toList());\n+  }\n+\n+  public Optional<tech.pegasys.teku.api.response.v1.node.Peer> getPeerById(final String peerId) {\n+    final NodeId nodeId = new LibP2PNodeId(PeerId.fromBase58(peerId));", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "135239aa8ae4b43a4747ed90012eff55fd1e02a9"}, "originalPosition": 27}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "2c33ae18ceb06a3650113f1832d3f025dcb4901a", "author": {"user": {"login": "rolfyone", "name": "Paul Harris"}}, "url": "https://github.com/ConsenSys/teku/commit/2c33ae18ceb06a3650113f1832d3f025dcb4901a", "committedDate": "2020-09-08T10:00:28Z", "message": "review comments\n\nSigned-off-by: Paul Harris <paul.harris@consensys.net>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "3d138ba0b320d309dd82beb878b071ee819f2aee", "author": {"user": {"login": "rolfyone", "name": "Paul Harris"}}, "url": "https://github.com/ConsenSys/teku/commit/3d138ba0b320d309dd82beb878b071ee819f2aee", "committedDate": "2020-09-08T21:04:29Z", "message": "make ENR explicitly nullable.\n\nSigned-off-by: Paul Harris <paul.harris@consensys.net>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b427678dcaf87832db81dad351d71ff6dd359d61", "author": {"user": {"login": "rolfyone", "name": "Paul Harris"}}, "url": "https://github.com/ConsenSys/teku/commit/b427678dcaf87832db81dad351d71ff6dd359d61", "committedDate": "2020-09-08T21:05:18Z", "message": "Merge remote-tracking branch 'upstream/master' into 2722-node-peers"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDg0NTE4NjA4", "url": "https://github.com/ConsenSys/teku/pull/2748#pullrequestreview-484518608", "createdAt": "2020-09-08T21:55:03Z", "commit": {"oid": "b427678dcaf87832db81dad351d71ff6dd359d61"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0wOFQyMTo1NTowNFrOHOvVNA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0wOFQyMTo1NTowNFrOHOvVNA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NTIxNzU4OA==", "bodyText": "This should just delegate to the underlying network\n\n  \n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                return new LibP2PNodeId(PeerId.fromBase58(nodeId));\n          \n          \n            \n                return network.parseNodeId(nodeId);", "url": "https://github.com/ConsenSys/teku/pull/2748#discussion_r485217588", "createdAt": "2020-09-08T21:55:04Z", "author": {"login": "ajsutton"}, "path": "networking/p2p/src/main/java/tech/pegasys/teku/networking/p2p/network/DelegatingP2PNetwork.java", "diffHunk": "@@ -41,6 +43,11 @@ public PeerAddress createPeerAddress(final DiscoveryPeer discoveryPeer) {\n     return network.createPeerAddress(discoveryPeer);\n   }\n \n+  @Override\n+  public NodeId parseNodeId(final String nodeId) {\n+    return new LibP2PNodeId(PeerId.fromBase58(nodeId));", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b427678dcaf87832db81dad351d71ff6dd359d61"}, "originalPosition": 22}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "56f21b41ac3a9c97204e7d87fc93f85ef7c34bb9", "author": {"user": {"login": "rolfyone", "name": "Paul Harris"}}, "url": "https://github.com/ConsenSys/teku/commit/56f21b41ac3a9c97204e7d87fc93f85ef7c34bb9", "committedDate": "2020-09-08T22:53:42Z", "message": "Update networking/p2p/src/main/java/tech/pegasys/teku/networking/p2p/network/DelegatingP2PNetwork.java\n\nCo-authored-by: Adrian Sutton <adrian@symphonious.net>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b69342b8e6c4f1d9c45dd7d2653b19ede3f22fff", "author": {"user": {"login": "rolfyone", "name": "Paul Harris"}}, "url": "https://github.com/ConsenSys/teku/commit/b69342b8e6c4f1d9c45dd7d2653b19ede3f22fff", "committedDate": "2020-09-08T22:58:13Z", "message": "spotless"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDg0NTYxOTMw", "url": "https://github.com/ConsenSys/teku/pull/2748#pullrequestreview-484561930", "createdAt": "2020-09-08T23:34:23Z", "commit": {"oid": "b69342b8e6c4f1d9c45dd7d2653b19ede3f22fff"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3592, "cost": 1, "resetAt": "2021-11-01T13:51:04Z"}}}