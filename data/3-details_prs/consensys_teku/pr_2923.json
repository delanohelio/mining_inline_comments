{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTAwMTg4Mjky", "number": 2923, "title": "[Issue-2273] Disconnect peers for weak-subjectivity check failures", "bodyText": "PR Description\nDisconnect peers that fail any weak subjectivity checks.\nFixed Issue(s)\nPart of #2273\nDocumentation\n\n I thought about documentation and added the documentation label to this PR if updates are required.", "createdAt": "2020-10-08T21:04:44Z", "url": "https://github.com/ConsenSys/teku/pull/2923", "merged": true, "mergeCommit": {"oid": "5237f785642ae1dfa2e3cb426c335fdfe294dbb5"}, "closed": true, "closedAt": "2020-10-12T14:53:24Z", "author": {"login": "mbaxter"}, "timelineItems": {"totalCount": 9, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdQmZ7OAH2gAyNTAwMTg4MjkyOjE5ODQ5MDVmYjQ1MWFkZGY3MTQ5ZmMyMmUzZTQyNzcwZjYyZmVkYjY=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdR0-tBAH2gAyNTAwMTg4MjkyOmRhZjRiM2U5ZTA1OWQwYWU1YjZhNjk5NDA0N2E1YzhmYWI5MjU1YTk=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "1984905fb451addf7149fc22e3e42770f62fedb6", "author": {"user": {"login": "mbaxter", "name": null}}, "url": "https://github.com/ConsenSys/teku/commit/1984905fb451addf7149fc22e3e42770f62fedb6", "committedDate": "2020-10-08T19:04:44Z", "message": "Update PeerSync to handle weak subjectivity errors"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ed5e1a5a69b57d7f8436e7983510389f555ec241", "author": {"user": {"login": "mbaxter", "name": null}}, "url": "https://github.com/ConsenSys/teku/commit/ed5e1a5a69b57d7f8436e7983510389f555ec241", "committedDate": "2020-10-08T20:42:58Z", "message": "Update multipeer sync to handle weak subjectivity errors"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "d27ff128663993eb42744dac1bcb6de1ef1f54ae", "author": {"user": {"login": "mbaxter", "name": null}}, "url": "https://github.com/ConsenSys/teku/commit/d27ff128663993eb42744dac1bcb6de1ef1f54ae", "committedDate": "2020-10-08T20:59:40Z", "message": "Fix threading issue"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTA1MTY2MzYx", "url": "https://github.com/ConsenSys/teku/pull/2923#pullrequestreview-505166361", "createdAt": "2020-10-08T21:07:08Z", "commit": {"oid": "d27ff128663993eb42744dac1bcb6de1ef1f54ae"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wOFQyMTowNzowOFrOHewbWQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wOFQyMTowNzowOFrOHewbWQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMjAxMjc2MQ==", "bodyText": "All blocks in the batch will have come from the same source so we can probably skip the map here.  Otherwise all the other checks and penalties don't work out anyway.", "url": "https://github.com/ConsenSys/teku/pull/2923#discussion_r502012761", "createdAt": "2020-10-08T21:07:08Z", "author": {"login": "ajsutton"}, "path": "sync/src/main/java/tech/pegasys/teku/sync/multipeer/BatchImporter.java", "diffHunk": "@@ -46,19 +50,23 @@ public BatchImporter(final BlockImporter blockImporter, final AsyncRunner asyncR\n    * @return a future reporting the result of the import\n    */\n   public SafeFuture<BatchImportResult> importBatch(final Batch batch) {\n-    // Copy the blocks as we're going to use them from off the event thread.\n+    // Copy the data from batch as we're going to use them from off the event thread.\n     final List<SignedBeaconBlock> blocks = new ArrayList<>(batch.getBlocks());\n+    final Map<SignedBeaconBlock, SyncSource> blockToSource =\n+        blocks.stream().collect(Collectors.toUnmodifiableMap(b -> b, batch::getBlockSource));", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d27ff128663993eb42744dac1bcb6de1ef1f54ae"}, "originalPosition": 25}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "405d3e20027fea7d985e3428096ca95eb8b6e7cc", "author": {"user": {"login": "mbaxter", "name": null}}, "url": "https://github.com/ConsenSys/teku/commit/405d3e20027fea7d985e3428096ca95eb8b6e7cc", "committedDate": "2020-10-08T22:37:59Z", "message": "Simplify multipeer updates"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "fe994874ad542abb0fbdd89d9bb447f43638e4a0", "author": {"user": {"login": "mbaxter", "name": null}}, "url": "https://github.com/ConsenSys/teku/commit/fe994874ad542abb0fbdd89d9bb447f43638e4a0", "committedDate": "2020-10-09T00:55:15Z", "message": "Fix test"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "8e0a862f368c4bc41247a57e929a79fd5d1a1c0d", "author": {"user": {"login": "mbaxter", "name": null}}, "url": "https://github.com/ConsenSys/teku/commit/8e0a862f368c4bc41247a57e929a79fd5d1a1c0d", "committedDate": "2020-10-09T21:59:43Z", "message": "Merge branch 'master' into issue-2273/disconnect-peers-for-ws-check-failure"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTA2MjE4ODg0", "url": "https://github.com/ConsenSys/teku/pull/2923#pullrequestreview-506218884", "createdAt": "2020-10-11T21:40:41Z", "commit": {"oid": "8e0a862f368c4bc41247a57e929a79fd5d1a1c0d"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "daf4b3e9e059d0ae5b6a6994047a5c8fab9255a9", "author": {"user": {"login": "mbaxter", "name": null}}, "url": "https://github.com/ConsenSys/teku/commit/daf4b3e9e059d0ae5b6a6994047a5c8fab9255a9", "committedDate": "2020-10-12T14:37:30Z", "message": "Merge branch 'master' into issue-2273/disconnect-peers-for-ws-check-failure"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3325, "cost": 1, "resetAt": "2021-11-01T13:51:04Z"}}}