{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDI2Mjk3MDEz", "number": 2024, "title": "Improve validator logging", "bodyText": "PR Description\nIntroduce validator event logging to log when validators perform duties. This can be enabled with the --log-include-validator-duties-enabled option and is off by default (it would be very noisy when running a lot of validators).\nImprove the logging output when validators fail to perform duties.\nFixed Issue(s)\nfixes #2019", "createdAt": "2020-06-02T01:29:45Z", "url": "https://github.com/ConsenSys/teku/pull/2024", "merged": true, "mergeCommit": {"oid": "6a00f491bb4f7f97fee1e52837f918256961e09e"}, "closed": true, "closedAt": "2020-06-02T22:50:05Z", "author": {"login": "ajsutton"}, "timelineItems": {"totalCount": 5, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcnKjohAH2gAyNDI2Mjk3MDEzOjFhZmQ1NDBkYzE5ZjMxN2FiNzk0Yjk5OGEwNzAxYmNkOGNjMzYxMjI=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcncwOsgH2gAyNDI2Mjk3MDEzOjc1YTY3YWI0YTc0MThhZmQ1MTk2NDdhNGExZjQyMjk5YmQzNjM3YTc=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "1afd540dc19f317ab794b998a0701bcd8cc36122", "author": {"user": {"login": "ajsutton", "name": "Adrian Sutton"}}, "url": "https://github.com/ConsenSys/teku/commit/1afd540dc19f317ab794b998a0701bcd8cc36122", "committedDate": "2020-06-02T01:27:06Z", "message": "Introduce validator event logging to log when validators perform duties.\nImprove the logging when validators fail to perform duties."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ecd183ddeb32e70787af25e1efebae0ee5b71ba6", "author": {"user": {"login": "ajsutton", "name": "Adrian Sutton"}}, "url": "https://github.com/ConsenSys/teku/commit/ecd183ddeb32e70787af25e1efebae0ee5b71ba6", "committedDate": "2020-06-02T02:00:23Z", "message": "Line things up."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDIzMDg0MDQw", "url": "https://github.com/ConsenSys/teku/pull/2024#pullrequestreview-423084040", "createdAt": "2020-06-02T21:53:30Z", "commit": {"oid": "ecd183ddeb32e70787af25e1efebae0ee5b71ba6"}, "state": "APPROVED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wMlQyMTo1MzozMFrOGeFQlA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wMlQyMjoyNTo1NFrOGeGARg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNDE5NjYyOA==", "bodyText": "Looks like deliverToWithResponse no longer sends errors to the exceptionHandler - is that okay?", "url": "https://github.com/ConsenSys/teku/pull/2024#discussion_r434196628", "createdAt": "2020-06-02T21:53:30Z", "author": {"login": "mbaxter"}, "path": "events/src/main/java/tech/pegasys/teku/events/DirectEventDeliverer.java", "diffHunk": "@@ -67,12 +70,10 @@ protected void deliverTo(final T subscriber, final Method method, final Object[]\n       return (SafeFuture<X>) method.invoke(subscriber, args);\n     } catch (IllegalAccessException e) {\n       incrementCounter(failedEventCounter, subscriber, method);\n-      exceptionHandler.handleException(e, subscriber, method, args);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ecd183ddeb32e70787af25e1efebae0ee5b71ba6"}, "originalPosition": 20}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNDIwODgzOA==", "bodyText": "Do we not want the attestation root here?", "url": "https://github.com/ConsenSys/teku/pull/2024#discussion_r434208838", "createdAt": "2020-06-02T22:25:54Z", "author": {"login": "mbaxter"}, "path": "validator/client/src/main/java/tech/pegasys/teku/validator/client/duties/AttestationProductionDuty.java", "diffHunk": "@@ -111,21 +112,23 @@ public String describe() {\n                     }));\n   }\n \n-  private SafeFuture<Void> signAttestationsForCommittee(\n+  private SafeFuture<DutyResult> signAttestationsForCommittee(\n       final ForkInfo forkInfo, final Committee validators, final Attestation attestation) {\n-    return validators.forEach(\n-        validator -> signAttestationForValidator(forkInfo, attestation, validator));\n+    return DutyResult.combine(\n+        validators.forEach(\n+            validator -> signAttestationForValidator(forkInfo, attestation, validator)));\n   }\n \n-  private SafeFuture<Void> signAttestationForValidator(\n+  private SafeFuture<DutyResult> signAttestationForValidator(\n       final ForkInfo forkInfo,\n       final Attestation attestation,\n       final ValidatorWithCommitteePosition validator) {\n     return validator\n         .getSigner()\n         .signAttestationData(attestation.getData(), forkInfo)\n         .thenApply(signature -> createSignedAttestation(attestation, validator, signature))\n-        .thenAccept(validatorApiChannel::sendSignedAttestation);\n+        .thenAccept(validatorApiChannel::sendSignedAttestation)\n+        .thenApply(__ -> DutyResult.success(attestation.getData().getBeacon_block_root()));", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ecd183ddeb32e70787af25e1efebae0ee5b71ba6"}, "originalPosition": 71}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "237f70fb3668de8edf1226cdff765f14b61acce8", "author": {"user": {"login": "ajsutton", "name": "Adrian Sutton"}}, "url": "https://github.com/ConsenSys/teku/commit/237f70fb3668de8edf1226cdff765f14b61acce8", "committedDate": "2020-06-02T22:33:03Z", "message": "Merge branch 'master' of github.com:PegaSysEng/teku into validator-logging"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "75a67ab4a7418afd519647a4a1f42299bd3637a7", "author": {"user": {"login": "ajsutton", "name": "Adrian Sutton"}}, "url": "https://github.com/ConsenSys/teku/commit/75a67ab4a7418afd519647a4a1f42299bd3637a7", "committedDate": "2020-06-02T22:39:09Z", "message": "Add changelog entry."}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4079, "cost": 1, "resetAt": "2021-11-01T13:51:04Z"}}}