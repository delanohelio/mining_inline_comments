{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDc2MjQ3OTE1", "number": 2695, "reviewThreads": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0zMVQxNTowNzo1MlrOEeWNrA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0zMVQxNTowNzo1MlrOEeWNrA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzAwMjU2Njg0OnYy", "diffSide": "RIGHT", "path": "pow/src/main/java/tech/pegasys/teku/pow/Eth1DepositManager.java", "isResolved": true, "comments": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0zMVQxNTowNzo1MlrOHJ8tyg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0wMVQxMDozMDoxMlrOHKwQvQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MDE5Mzk5NA==", "bodyText": "Should we retry less frequently and log a warning in this case?", "url": "https://github.com/ConsenSys/teku/pull/2695#discussion_r480193994", "createdAt": "2020-08-31T15:07:52Z", "author": {"login": "mbaxter"}, "path": "pow/src/main/java/tech/pegasys/teku/pow/Eth1DepositManager.java", "diffHunk": "@@ -146,8 +146,16 @@ private void preGenesisSubscription(final BigInteger lastProcessedBlockNumber) {\n     return eth1Provider\n         .getLatestEth1Block()\n         .thenApply(EthBlock.Block::getNumber)\n-        .thenApply(number -> number.subtract(Constants.ETH1_FOLLOW_DISTANCE.bigIntegerValue()))\n         .thenApply(UInt64::valueOf)\n+        .thenApply(\n+            number -> {\n+              if (number.isLessThan(Constants.ETH1_FOLLOW_DISTANCE)) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ab1f23168390324e799d413feec2109ff5564582"}, "originalPosition": 8}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MDI0ODExOQ==", "bodyText": "Makes sense, will do that.", "url": "https://github.com/ConsenSys/teku/pull/2695#discussion_r480248119", "createdAt": "2020-08-31T16:33:56Z", "author": {"login": "cemozerr"}, "path": "pow/src/main/java/tech/pegasys/teku/pow/Eth1DepositManager.java", "diffHunk": "@@ -146,8 +146,16 @@ private void preGenesisSubscription(final BigInteger lastProcessedBlockNumber) {\n     return eth1Provider\n         .getLatestEth1Block()\n         .thenApply(EthBlock.Block::getNumber)\n-        .thenApply(number -> number.subtract(Constants.ETH1_FOLLOW_DISTANCE.bigIntegerValue()))\n         .thenApply(UInt64::valueOf)\n+        .thenApply(\n+            number -> {\n+              if (number.isLessThan(Constants.ETH1_FOLLOW_DISTANCE)) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MDE5Mzk5NA=="}, "originalCommit": {"oid": "ab1f23168390324e799d413feec2109ff5564582"}, "originalPosition": 8}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MDQwNTA0NA==", "bodyText": "Not sure we even need a warning - it's a pretty expected condition when using a local test chain.  And we could just start following from 0 now I think about it.  The genesis block of ETH1 is finalized so there's no risk of it being re-orged.  We should then just sit at block 0 until the chain reaches 1024 blocks long where we can carry on as normal.", "url": "https://github.com/ConsenSys/teku/pull/2695#discussion_r480405044", "createdAt": "2020-08-31T21:19:17Z", "author": {"login": "ajsutton"}, "path": "pow/src/main/java/tech/pegasys/teku/pow/Eth1DepositManager.java", "diffHunk": "@@ -146,8 +146,16 @@ private void preGenesisSubscription(final BigInteger lastProcessedBlockNumber) {\n     return eth1Provider\n         .getLatestEth1Block()\n         .thenApply(EthBlock.Block::getNumber)\n-        .thenApply(number -> number.subtract(Constants.ETH1_FOLLOW_DISTANCE.bigIntegerValue()))\n         .thenApply(UInt64::valueOf)\n+        .thenApply(\n+            number -> {\n+              if (number.isLessThan(Constants.ETH1_FOLLOW_DISTANCE)) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MDE5Mzk5NA=="}, "originalCommit": {"oid": "ab1f23168390324e799d413feec2109ff5564582"}, "originalPosition": 8}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MTAzODUyNQ==", "bodyText": "We should then just sit at block 0 until the chain reaches 1024 blocks long where we can carry on as normal.\n\nThat made sense to me, so I made the changes to reflect that.", "url": "https://github.com/ConsenSys/teku/pull/2695#discussion_r481038525", "createdAt": "2020-09-01T10:30:12Z", "author": {"login": "cemozerr"}, "path": "pow/src/main/java/tech/pegasys/teku/pow/Eth1DepositManager.java", "diffHunk": "@@ -146,8 +146,16 @@ private void preGenesisSubscription(final BigInteger lastProcessedBlockNumber) {\n     return eth1Provider\n         .getLatestEth1Block()\n         .thenApply(EthBlock.Block::getNumber)\n-        .thenApply(number -> number.subtract(Constants.ETH1_FOLLOW_DISTANCE.bigIntegerValue()))\n         .thenApply(UInt64::valueOf)\n+        .thenApply(\n+            number -> {\n+              if (number.isLessThan(Constants.ETH1_FOLLOW_DISTANCE)) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MDE5Mzk5NA=="}, "originalCommit": {"oid": "ab1f23168390324e799d413feec2109ff5564582"}, "originalPosition": 8}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3353, "cost": 1, "resetAt": "2021-11-12T11:57:46Z"}}}