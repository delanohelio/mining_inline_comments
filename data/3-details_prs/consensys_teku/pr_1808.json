{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDE5NzgwMjAy", "number": 1808, "title": "1798 - update chainHead to use bestBlockAndState", "bodyText": "changed /beacon/head to use bestBlockAndState also.\n\n\nremoved mocking from the test case to better show what is happening.\n\n\nSigned-off-by: Paul Harris paul.harris@consensys.net", "createdAt": "2020-05-18T22:48:59Z", "url": "https://github.com/ConsenSys/teku/pull/1808", "merged": true, "mergeCommit": {"oid": "e8fc3b5e713a5f420282d21315158ed768f14217"}, "closed": true, "closedAt": "2020-05-18T23:48:00Z", "author": {"login": "rolfyone"}, "timelineItems": {"totalCount": 6, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcin4nvgH2gAyNDE5NzgwMjAyOjRkOThiNjg1MTUzZjlkYmI1NzMwYTE1YjYzZTBjYzg0NWI5ODM3OWU=", "endCursor": "Y3Vyc29yOnYyOpPPAAABciolSJAH2gAyNDE5NzgwMjAyOjA4OTdlNWU0ODVmMDI4OGM3ZTdiMWM1ODBhNDYxMDhiY2VlOTA4NjA=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "4d98b685153f9dbb5730a15b63e0cc845b98379e", "author": {"user": {"login": "rolfyone", "name": "Paul Harris"}}, "url": "https://github.com/ConsenSys/teku/commit/4d98b685153f9dbb5730a15b63e0cc845b98379e", "committedDate": "2020-05-18T22:47:39Z", "message": "1798 - update chainHead to use bestBlockAndState\n\n - changed /beacon/head to use bestBlockAndState also.\n\nSigned-off-by: Paul Harris <paul.harris@consensys.net>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "19d55558d1ceb96a57cdd33e48eb2bfd13d21de6", "author": {"user": {"login": "rolfyone", "name": "Paul Harris"}}, "url": "https://github.com/ConsenSys/teku/commit/19d55558d1ceb96a57cdd33e48eb2bfd13d21de6", "committedDate": "2020-05-18T22:49:23Z", "message": "Merge remote-tracking branch 'upstream/master' into 1798-chainhead"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDEzOTk4NDMw", "url": "https://github.com/ConsenSys/teku/pull/1808#pullrequestreview-413998430", "createdAt": "2020-05-18T23:14:57Z", "commit": {"oid": "19d55558d1ceb96a57cdd33e48eb2bfd13d21de6"}, "state": "APPROVED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xOFQyMzoxNDo1N1rOGXKeJQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xOFQyMzoxNDo1N1rOGXKeJQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNjk0MTk4OQ==", "bodyText": "nit: remove commented out code.", "url": "https://github.com/ConsenSys/teku/pull/1808#discussion_r426941989", "createdAt": "2020-05-18T23:14:57Z", "author": {"login": "ajsutton"}, "path": "data/provider/src/main/java/tech/pegasys/teku/api/ChainDataProvider.java", "diffHunk": "@@ -214,6 +207,10 @@ public boolean isFinalizedEpoch(final UnsignedLong epoch) {\n   }\n \n   public Optional<BeaconChainHead> getHeadState() {\n-    return combinedChainDataClient.getHeadStateFromStore().map(BeaconChainHead::new);\n+    if (!isStoreAvailable()) {\n+      throw new ChainDataUnavailableException();\n+    }\n+    return recentChainData.getBestBlockAndState().map(BeaconChainHead::new);\n+    //    return combinedChainDataClient.getHeadStateFromStore().map(BeaconChainHead::new);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "19d55558d1ceb96a57cdd33e48eb2bfd13d21de6"}, "originalPosition": 31}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "39207f5f31252814d7fde89e200414e2c7657ae7", "author": {"user": {"login": "rolfyone", "name": "Paul Harris"}}, "url": "https://github.com/ConsenSys/teku/commit/39207f5f31252814d7fde89e200414e2c7657ae7", "committedDate": "2020-05-18T23:21:07Z", "message": "code review feedback.\n\nSigned-off-by: Paul Harris <paul.harris@consensys.net>"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDE0MDAyNDU1", "url": "https://github.com/ConsenSys/teku/pull/1808#pullrequestreview-414002455", "createdAt": "2020-05-18T23:26:12Z", "commit": {"oid": "39207f5f31252814d7fde89e200414e2c7657ae7"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "0897e5e485f0288c7e7b1c580a46108bcee90860", "author": {"user": {"login": "rolfyone", "name": "Paul Harris"}}, "url": "https://github.com/ConsenSys/teku/commit/0897e5e485f0288c7e7b1c580a46108bcee90860", "committedDate": "2020-05-18T23:36:26Z", "message": "Merge remote-tracking branch 'upstream/master' into 1798-chainhead"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3987, "cost": 1, "resetAt": "2021-11-01T13:51:04Z"}}}