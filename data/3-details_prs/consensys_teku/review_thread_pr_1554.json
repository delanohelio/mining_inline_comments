{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDAwNjAzNzgz", "number": 1554, "reviewThreads": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wOFQwNjoyNDo0OFrODv2XXw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wOVQwMjoyNjowNlrODwO2TQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjUxNTAwMzgzOnYy", "diffSide": "RIGHT", "path": "artemis/src/test/java/tech/pegasys/artemis/cli/BeaconNodeCommandTest.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wOFQwNjoyNDo0OFrOGCgohA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wOFQwNjoyNDo0OFrOGCgohA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNTI4NDk5Ng==", "bodyText": "interesting - I changed BEACONCHAIN to BEACON", "url": "https://github.com/ConsenSys/teku/pull/1554#discussion_r405284996", "createdAt": "2020-04-08T06:24:48Z", "author": {"login": "macfarla"}, "path": "artemis/src/test/java/tech/pegasys/artemis/cli/BeaconNodeCommandTest.java", "diffHunk": "@@ -228,9 +242,9 @@ private ArtemisConfigurationBuilder expectedConfigurationBuilder() {\n         .setMetricsInterface(\"127.0.0.1\")\n         .setMetricsCategories(Arrays.asList(\"BEACONCHAIN\", \"JVM\", \"PROCESS\"))", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "16bc210cf4b349be51d55bab9d872d3b0830846c"}, "originalPosition": 59}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjUxNTcyOTgxOnYy", "diffSide": "RIGHT", "path": "artemis/src/test/resources/complete_config.toml", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wOFQwOTo1MDo0NFrOGCnrrg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wOFQwOTo1MDo0NFrOGCnrrg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNTQwMDQ5NA==", "bodyText": "@rolfyone Hold on your PR as toml to yaml config changes are coming, the complete_config.toml will be moved, you might be required to update these changes in complete_config.yaml.", "url": "https://github.com/ConsenSys/teku/pull/1554#discussion_r405400494", "createdAt": "2020-04-08T09:50:44Z", "author": {"login": "usmansaleem"}, "path": "artemis/src/test/resources/complete_config.toml", "diffHunk": "@@ -29,6 +29,13 @@ eth1-endpoint=\"http://localhost:8545\"\n # output\n #Xtransaction-record-directory=\"/tmp/teku\"\n \n+# logging\n+log-color-enabled=true", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "16bc210cf4b349be51d55bab9d872d3b0830846c"}, "originalPosition": 5}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjUxNjA0NTkyOnYy", "diffSide": "RIGHT", "path": "util/src/main/java/tech/pegasys/artemis/util/cli/VersionProvider.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wOFQxMToyNDoyM1rOGCqxsA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wOVQwMjoxMjoxM1rOGDHNKg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNTQ1MTE4NA==", "bodyText": "This should be the $XDG_DATA_HOME:\n\n  \n    \n  \n    \n\n  \n  This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters. Learn more about bidirectional Unicode characters\n\n\n  \n\n\n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                return \"~/.teku\";\n          \n          \n            \n                return \"~/.local/share/teku\";\n          \n      \n    \n    \n  \n\n\n$XDG_DATA_HOME defines the base directory relative to which user specific data files should be stored. If $XDG_DATA_HOME is either not set or empty, a default equal to $HOME/.local/share should be used.\n\nhttps://specifications.freedesktop.org/basedir-spec/basedir-spec-latest.html\n\nHistorically, Unix programs were free to spread their data all over the $HOME directory, putting their data in dot-files (files starting with \".\") or subdirectories such as ~/.vimrc and ~/.vim. The new specification is intended to make this behavior more predictable.\n\nhttps://askubuntu.com/questions/14535/whats-the-local-folder-for-in-my-home-directory", "url": "https://github.com/ConsenSys/teku/pull/1554#discussion_r405451184", "createdAt": "2020-04-08T11:24:23Z", "author": {"login": "q9f"}, "path": "util/src/main/java/tech/pegasys/artemis/util/cli/VersionProvider.java", "diffHunk": "@@ -45,6 +45,16 @@ public static String detectJvm() {\n     return detectedVM + \"-java-\" + detectedJavaVersion;\n   }\n \n+  public static String defaultStoragePath() {\n+    final String detectedOS = normalizeOS(normalize(\"os.name\"));\n+    if (detectedOS.equals(\"windows\")) {\n+      return System.getenv(\"LOCALAPPDATA\") + \"/teku\";\n+    } else if (detectedOS.equals(\"osx\")) {\n+      return System.getenv(\"HOME\") + \"/Library/teku\";\n+    }\n+    return \"~/.teku\";", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "16bc210cf4b349be51d55bab9d872d3b0830846c"}, "originalPosition": 11}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNTkxNjk3MA==", "bodyText": "Thanks for the feedback, I appreciate the level of information you've given, it's a compelling argument. I've made a larger change to incorporate your suggestion so that I can test the behaviors and make sure they're what is expected.", "url": "https://github.com/ConsenSys/teku/pull/1554#discussion_r405916970", "createdAt": "2020-04-09T02:12:13Z", "author": {"login": "rolfyone"}, "path": "util/src/main/java/tech/pegasys/artemis/util/cli/VersionProvider.java", "diffHunk": "@@ -45,6 +45,16 @@ public static String detectJvm() {\n     return detectedVM + \"-java-\" + detectedJavaVersion;\n   }\n \n+  public static String defaultStoragePath() {\n+    final String detectedOS = normalizeOS(normalize(\"os.name\"));\n+    if (detectedOS.equals(\"windows\")) {\n+      return System.getenv(\"LOCALAPPDATA\") + \"/teku\";\n+    } else if (detectedOS.equals(\"osx\")) {\n+      return System.getenv(\"HOME\") + \"/Library/teku\";\n+    }\n+    return \"~/.teku\";", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNTQ1MTE4NA=="}, "originalCommit": {"oid": "16bc210cf4b349be51d55bab9d872d3b0830846c"}, "originalPosition": 11}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjUxOTAxNTE3OnYy", "diffSide": "RIGHT", "path": "util/src/test/java/tech/pegasys/artemis/util/cli/VersionProviderTest.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wOVQwMjoyNjowNlrOGDHbTQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wOVQwMjoyNjowNlrOGDHbTQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNTkyMDU4OQ==", "bodyText": "nit: our standard is US spelling ie ize", "url": "https://github.com/ConsenSys/teku/pull/1554#discussion_r405920589", "createdAt": "2020-04-09T02:26:06Z", "author": {"login": "macfarla"}, "path": "util/src/test/java/tech/pegasys/artemis/util/cli/VersionProviderTest.java", "diffHunk": "@@ -0,0 +1,67 @@\n+/*\n+ * Copyright 2020 ConsenSys AG.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\"); you may not use this file except in compliance with\n+ * the License. You may obtain a copy of the License at\n+ *\n+ * http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software distributed under the License is distributed on\n+ * an \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied. See the License for the\n+ * specific language governing permissions and limitations under the License.\n+ */\n+\n+package tech.pegasys.artemis.util.cli;\n+\n+import static org.assertj.core.api.Assertions.assertThat;\n+import static tech.pegasys.artemis.util.cli.VersionProvider.ENV_HOME;\n+import static tech.pegasys.artemis.util.cli.VersionProvider.ENV_LOCALAPPDATA;\n+import static tech.pegasys.artemis.util.cli.VersionProvider.ENV_XDG_DATA_HOME;\n+\n+import java.util.Map;\n+import org.apache.logging.log4j.util.Strings;\n+import org.junit.jupiter.api.Test;\n+\n+class VersionProviderTest {\n+  private final String TEKU = \"/teku\";\n+\n+  @Test\n+  void defaultStoragePath_shouldHandleWindowsPath() {\n+    final String homeFolder = \"c:\\\\users\\\\myUser\\\\AppData\\\\local\";\n+    final Map<String, String> env = Map.of(ENV_LOCALAPPDATA, homeFolder);\n+    assertThat(VersionProvider.defaultStoragePathForNormalisedOS(\"windows\", env))\n+        .isEqualTo(homeFolder + \"\\\\teku\");\n+  }\n+\n+  @Test\n+  void defaultStoragePath_shouldHandleMacPath() {\n+    final String homeFolder = \"/Users/myUser\";\n+    Map<String, String> env = Map.of(ENV_HOME, homeFolder);\n+    assertThat(VersionProvider.defaultStoragePathForNormalisedOS(\"osx\", env))\n+        .isEqualTo(homeFolder + \"/Library\" + TEKU);\n+  }\n+\n+  @Test\n+  void defaultStoragePath_shouldHandleXdgHome() {\n+    final String homeFolder = \"/data/myUser\";\n+    Map<String, String> env = Map.of(ENV_XDG_DATA_HOME, homeFolder);\n+    assertThat(VersionProvider.defaultStoragePathForNormalisedOS(\"linux\", env))", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "e26e19d08a4937eaf814a0d4f92d53b7c7b7d3ea"}, "originalPosition": 48}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3844, "cost": 1, "resetAt": "2021-11-12T11:57:46Z"}}}