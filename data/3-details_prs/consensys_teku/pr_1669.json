{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDA4NzE2Mjg3", "number": 1669, "title": "Add ForkDigestValue to topic names", "bodyText": "PR Description\nAdds ForkDigestValue to topic names\nhttps://pegasys1.atlassian.net/secure/RapidBoard.jspa?rapidView=67&projectKey=BC&modal=detail&selectedIssue=BC-372", "createdAt": "2020-04-24T19:03:45Z", "url": "https://github.com/ConsenSys/teku/pull/1669", "merged": true, "mergeCommit": {"oid": "bcddacb60d745d3892a1b5480a2f566c8d2878ed"}, "closed": true, "closedAt": "2020-04-28T19:48:46Z", "author": {"login": "cemozerr"}, "timelineItems": {"totalCount": 24, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABca2RtmAH2gAyNDA4NzE2Mjg3OjYxNmUyYzVmYjJmZDFjYzgwODc2YzY3MjM5NDUyYzNkYTEwNjE1OTg=", "endCursor": "Y3Vyc29yOnYyOpPPAAABccI0D6AH2gAyNDA4NzE2Mjg3OjAyYmNlZjZlZmU1NGZjNDM1N2JlYTZiNzRmNTg0Y2UzYjg4YjA2YTc=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "616e2c5fb2fd1cc80876c67239452c3da1061598", "author": {"user": {"login": "cemozerr", "name": "Cem Ozer"}}, "url": "https://github.com/ConsenSys/teku/commit/616e2c5fb2fd1cc80876c67239452c3da1061598", "committedDate": "2020-04-24T19:02:20Z", "message": "Add ForkDigestValue to topic names"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDAwMjEyNzcy", "url": "https://github.com/ConsenSys/teku/pull/1669#pullrequestreview-400212772", "createdAt": "2020-04-24T19:24:08Z", "commit": {"oid": "616e2c5fb2fd1cc80876c67239452c3da1061598"}, "state": "COMMENTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yNFQxOToyNDowOFrOGLl-kg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yNFQxOToyNjo0NVrOGLmEMw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNDgwOTc0Ng==", "bodyText": "I'd pass the ForkDigest into the topic handler rather than passing in recentChainData.  We'll need to be able to explicitly create topics for specific forks.", "url": "https://github.com/ConsenSys/teku/pull/1669#discussion_r414809746", "createdAt": "2020-04-24T19:24:08Z", "author": {"login": "mbaxter"}, "path": "networking/eth2/src/main/java/tech/pegasys/artemis/networking/eth2/gossip/topics/BlockTopicHandler.java", "diffHunk": "@@ -21,14 +21,18 @@\n import tech.pegasys.artemis.networking.eth2.gossip.events.GossipedBlockEvent;\n import tech.pegasys.artemis.networking.eth2.gossip.topics.validation.BlockValidationResult;\n import tech.pegasys.artemis.networking.eth2.gossip.topics.validation.BlockValidator;\n+import tech.pegasys.artemis.storage.client.RecentChainData;\n \n public class BlockTopicHandler extends Eth2TopicHandler<SignedBeaconBlock> {\n-  public static final String BLOCKS_TOPIC = \"/eth2/beacon_block/ssz\";\n+  public static String TOPIC_NAME = \"beacon_block\";\n   private final EventBus eventBus;\n   private final BlockValidator blockValidator;\n \n-  public BlockTopicHandler(final EventBus eventBus, final BlockValidator blockValidator) {\n-    super(eventBus);\n+  public BlockTopicHandler(\n+      final EventBus eventBus,\n+      final BlockValidator blockValidator,\n+      final RecentChainData recentChainData) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "616e2c5fb2fd1cc80876c67239452c3da1061598"}, "originalPosition": 17}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNDgxMTE4Nw==", "bodyText": "We'll need to wait for the store to initialize (via recentChainData.subscribeStoreInitialized()) so we can get a correct ForkDigest value.  Otherwise, we may end up setting up meaningless topics for the \"pre-genesis\" fork digest.", "url": "https://github.com/ConsenSys/teku/pull/1669#discussion_r414811187", "createdAt": "2020-04-24T19:26:45Z", "author": {"login": "mbaxter"}, "path": "networking/eth2/src/main/java/tech/pegasys/artemis/networking/eth2/gossip/BlockGossipManager.java", "diffHunk": "@@ -32,8 +33,10 @@\n   public BlockGossipManager(\n       final GossipNetwork gossipNetwork,\n       final EventBus eventBus,\n-      final BlockValidator blockValidator) {\n-    final BlockTopicHandler topicHandler = new BlockTopicHandler(eventBus, blockValidator);\n+      final BlockValidator blockValidator,\n+      final RecentChainData recentChainData) {\n+    final BlockTopicHandler topicHandler =", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "616e2c5fb2fd1cc80876c67239452c3da1061598"}, "originalPosition": 16}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "fd27d6cbc6f1fa75826277d21605d89006608f03", "author": {"user": {"login": "cemozerr", "name": "Cem Ozer"}}, "url": "https://github.com/ConsenSys/teku/commit/fd27d6cbc6f1fa75826277d21605d89006608f03", "committedDate": "2020-04-24T20:06:08Z", "message": "Explicitly pass fork digest to topic handlers"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "1d165aff0ee24ff650035f2438d8633162bbf8c0", "author": {"user": {"login": "cemozerr", "name": "Cem Ozer"}}, "url": "https://github.com/ConsenSys/teku/commit/1d165aff0ee24ff650035f2438d8633162bbf8c0", "committedDate": "2020-04-24T20:29:58Z", "message": "Inhibit access to gossip manager requiring methods before init"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "4eef33940417dde1aa9502e08f803dd3bc5a2930", "author": {"user": {"login": "cemozerr", "name": "Cem Ozer"}}, "url": "https://github.com/ConsenSys/teku/commit/4eef33940417dde1aa9502e08f803dd3bc5a2930", "committedDate": "2020-04-24T20:36:37Z", "message": "Run spotless"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDAwMjcwNDc4", "url": "https://github.com/ConsenSys/teku/pull/1669#pullrequestreview-400270478", "createdAt": "2020-04-24T21:06:00Z", "commit": {"oid": "4eef33940417dde1aa9502e08f803dd3bc5a2930"}, "state": "COMMENTED", "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yNFQyMTowNjowMFrOGLpO1A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yNFQyMToxNjo1NlrOGLpjMA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNDg2MzA2MA==", "bodyText": "I think these GossipManagers need to be volatile.  And we can just check if they're null.", "url": "https://github.com/ConsenSys/teku/pull/1669#discussion_r414863060", "createdAt": "2020-04-24T21:06:00Z", "author": {"login": "mbaxter"}, "path": "networking/eth2/src/main/java/tech/pegasys/artemis/networking/eth2/ActiveEth2Network.java", "diffHunk": "@@ -123,11 +132,21 @@ public BeaconChainMethods getBeaconChainMethods() {\n \n   @Override\n   public void subscribeToAttestationCommitteeTopic(final int committeeIndex) {\n+    if (state.get() != State.RUNNING) {\n+      LOG.warn(\n+          \"Attestation committee can not be subscribed due to Gossip Managers not being initialized\");\n+      return;\n+    }\n     attestationGossipManager.subscribeToCommitteeTopic(committeeIndex);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "4eef33940417dde1aa9502e08f803dd3bc5a2930"}, "originalPosition": 50}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNDg2NDgzMQ==", "bodyText": "I think returning from start() before moving to the RUNNING state violates the intention of the start / stop methods.  You'd expect to be able to successfully stop() the network after successfully starting it.", "url": "https://github.com/ConsenSys/teku/pull/1669#discussion_r414864831", "createdAt": "2020-04-24T21:09:52Z", "author": {"login": "mbaxter"}, "path": "networking/eth2/src/main/java/tech/pegasys/artemis/networking/eth2/ActiveEth2Network.java", "diffHunk": "@@ -63,15 +67,20 @@ public ActiveEth2Network(\n   }\n \n   private void startup() {\n-    state.set(State.RUNNING);\n+    recentChainData.subscribeBestBlockInitialized(this::initGossipManagers);\n+  }\n+\n+  public void initGossipManagers() {\n     BlockValidator blockValidator = new BlockValidator(recentChainData, new StateTransition());\n     AttestationSubnetSubscriptions attestationSubnetSubscriptions =\n         new AttestationSubnetSubscriptions(discoveryNetwork, recentChainData, eventBus);\n-    blockGossipManager = new BlockGossipManager(discoveryNetwork, eventBus, blockValidator);\n+    blockGossipManager =\n+        new BlockGossipManager(discoveryNetwork, eventBus, blockValidator, recentChainData);\n     attestationGossipManager =\n         new AttestationGossipManager(eventBus, attestationSubnetSubscriptions);\n     aggregateGossipManager =\n         new AggregateGossipManager(discoveryNetwork, eventBus, recentChainData);\n+    state.set(State.RUNNING);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "4eef33940417dde1aa9502e08f803dd3bc5a2930"}, "originalPosition": 37}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNDg2ODI3Mg==", "bodyText": "Do we have any tests around the topic format?  Probably worth adding a test here to make sure the topic looks like what we expect.", "url": "https://github.com/ConsenSys/teku/pull/1669#discussion_r414868272", "createdAt": "2020-04-24T21:16:56Z", "author": {"login": "mbaxter"}, "path": "networking/eth2/src/test/java/tech/pegasys/artemis/networking/eth2/gossip/topics/Eth2TopicHandlerTest.java", "diffHunk": "@@ -28,13 +28,17 @@\n import org.junit.jupiter.api.Test;\n import tech.pegasys.artemis.datastructures.operations.Attestation;\n import tech.pegasys.artemis.datastructures.util.DataStructureUtil;\n+import tech.pegasys.artemis.ssz.SSZTypes.Bytes4;\n+import tech.pegasys.artemis.storage.client.RecentChainData;\n \n public class Eth2TopicHandlerTest {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "4eef33940417dde1aa9502e08f803dd3bc5a2930"}, "originalPosition": 7}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "59cbfecd83515507e53d502c7d3bccc9f2f12fce", "author": {"user": {"login": "cemozerr", "name": "Cem Ozer"}}, "url": "https://github.com/ConsenSys/teku/commit/59cbfecd83515507e53d502c7d3bccc9f2f12fce", "committedDate": "2020-04-24T21:22:24Z", "message": "Resolve comments"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e2d819a0b49c82116bf1eba636e30a5cf8650dde", "author": {"user": {"login": "cemozerr", "name": "Cem Ozer"}}, "url": "https://github.com/ConsenSys/teku/commit/e2d819a0b49c82116bf1eba636e30a5cf8650dde", "committedDate": "2020-04-24T21:34:53Z", "message": "Add test for topic format"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDAwMjkyMzky", "url": "https://github.com/ConsenSys/teku/pull/1669#pullrequestreview-400292392", "createdAt": "2020-04-24T21:52:21Z", "commit": {"oid": "e2d819a0b49c82116bf1eba636e30a5cf8650dde"}, "state": "COMMENTED", "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yNFQyMTo1MjoyMVrOGLqh-Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yNFQyMjowNjozMFrOGLq3QA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNDg4NDM0NQ==", "bodyText": "I think there's still some potential messiness when we shutdown: if the gossip managers aren't yet set, we'll get NullPointerException's.", "url": "https://github.com/ConsenSys/teku/pull/1669#discussion_r414884345", "createdAt": "2020-04-24T21:52:21Z", "author": {"login": "mbaxter"}, "path": "networking/eth2/src/main/java/tech/pegasys/artemis/networking/eth2/ActiveEth2Network.java", "diffHunk": "@@ -35,11 +38,14 @@\n import tech.pegasys.artemis.util.async.SafeFuture;\n \n public class ActiveEth2Network extends DelegatingP2PNetwork<Eth2Peer> implements Eth2Network {\n+  private static final Logger LOG = LogManager.getLogger();\n+\n   private final DiscoveryNetwork<?> discoveryNetwork;\n   private final Eth2PeerManager peerManager;\n   private final EventBus eventBus;\n   private final RecentChainData recentChainData;\n   private final AtomicReference<State> state = new AtomicReference<>(State.IDLE);\n+  private final AtomicBoolean gossipManagersInitialized = new AtomicBoolean(false);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "e2d819a0b49c82116bf1eba636e30a5cf8650dde"}, "originalPosition": 23}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNDg4Nzk0MQ==", "bodyText": "I think attestationGossipManager etc still need to be volatile ...", "url": "https://github.com/ConsenSys/teku/pull/1669#discussion_r414887941", "createdAt": "2020-04-24T22:01:36Z", "author": {"login": "mbaxter"}, "path": "networking/eth2/src/main/java/tech/pegasys/artemis/networking/eth2/ActiveEth2Network.java", "diffHunk": "@@ -123,11 +132,21 @@ public BeaconChainMethods getBeaconChainMethods() {\n \n   @Override\n   public void subscribeToAttestationCommitteeTopic(final int committeeIndex) {\n+    if (state.get() != State.RUNNING) {\n+      LOG.warn(\n+          \"Attestation committee can not be subscribed due to Gossip Managers not being initialized\");\n+      return;\n+    }\n     attestationGossipManager.subscribeToCommitteeTopic(committeeIndex);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNDg2MzA2MA=="}, "originalCommit": {"oid": "4eef33940417dde1aa9502e08f803dd3bc5a2930"}, "originalPosition": 50}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNDg4OTc5Mg==", "bodyText": "We should probably validate that the subnetId int is positive", "url": "https://github.com/ConsenSys/teku/pull/1669#discussion_r414889792", "createdAt": "2020-04-24T22:06:30Z", "author": {"login": "mbaxter"}, "path": "networking/eth2/src/main/java/tech/pegasys/artemis/networking/eth2/gossip/topics/AttestationTopicHandler.java", "diffHunk": "@@ -27,29 +27,29 @@\n import tech.pegasys.artemis.datastructures.operations.IndexedAttestation;\n import tech.pegasys.artemis.datastructures.state.BeaconState;\n import tech.pegasys.artemis.datastructures.util.SimpleOffsetSerializer;\n+import tech.pegasys.artemis.ssz.SSZTypes.Bytes4;\n import tech.pegasys.artemis.storage.client.RecentChainData;\n \n public class AttestationTopicHandler extends Eth2TopicHandler<Attestation> {\n \n   private static final Logger LOG = LogManager.getLogger();\n \n-  private final String attestationsTopic;\n   private final RecentChainData recentChainData;\n+  private final UnsignedLong subnetId;\n \n   public AttestationTopicHandler(\n-      final EventBus eventBus, final RecentChainData recentChainData, final UnsignedLong subnetId) {\n-    super(eventBus);\n-    this.attestationsTopic = getTopic(subnetId);\n+      final EventBus eventBus,\n+      final RecentChainData recentChainData,\n+      final UnsignedLong subnetId,\n+      final Bytes4 forkDigest) {\n+    super(eventBus, forkDigest);\n     this.recentChainData = recentChainData;\n-  }\n-\n-  private static String getTopic(final UnsignedLong subnetId) {\n-    return \"/eth2/committee_index\" + toIntExact(subnetId.longValue()) + \"_beacon_attestation/ssz\";\n+    this.subnetId = subnetId;\n   }\n \n   @Override\n-  public String getTopic() {\n-    return attestationsTopic;\n+  public String getTopicName() {\n+    return \"committee_index\" + toIntExact(subnetId.longValue()) + \"_beacon_attestation\";", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "e2d819a0b49c82116bf1eba636e30a5cf8650dde"}, "originalPosition": 36}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "48a49f1c029f0622760c9515699c64dfc3c4e381", "author": {"user": {"login": "cemozerr", "name": "Cem Ozer"}}, "url": "https://github.com/ConsenSys/teku/commit/48a49f1c029f0622760c9515699c64dfc3c4e381", "committedDate": "2020-04-24T22:19:30Z", "message": "Remove atomic boolean & make variables null instead"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "fad6eb85e6da52ff8f76adac490a0f736ce709bc", "author": {"user": {"login": "cemozerr", "name": "Cem Ozer"}}, "url": "https://github.com/ConsenSys/teku/commit/fad6eb85e6da52ff8f76adac490a0f736ce709bc", "committedDate": "2020-04-24T22:29:07Z", "message": "Run spotless"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDAwNTcyODIz", "url": "https://github.com/ConsenSys/teku/pull/1669#pullrequestreview-400572823", "createdAt": "2020-04-27T00:55:02Z", "commit": {"oid": "fad6eb85e6da52ff8f76adac490a0f736ce709bc"}, "state": "COMMENTED", "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yN1QwMDo1NTowMlrOGMMscQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yN1QwMTowNToyMFrOGMM1MQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNTQ0NDA4MQ==", "bodyText": "Doesn't necessarily have to be this PR, but we need to change our startup so that P2P networking is only started after genesis is known.  I suspect a lot of these concerns should all disappear then as the network can be all be at once without having to wait for genesis to init the gossip managers.\nThat said, we are potentially going to have a race condition here because validators should start calculating their duties once genesis is known and subscribing to subnets - we need to make sure the P2P network is fully created before they start doing that and not just ignore the requests to subscribe.  Right now we'll get away with it because validators don't calculate their duties until the first slot.\nI've logged https://pegasys1.atlassian.net/browse/BC-394 and https://pegasys1.atlassian.net/browse/BC-395", "url": "https://github.com/ConsenSys/teku/pull/1669#discussion_r415444081", "createdAt": "2020-04-27T00:55:02Z", "author": {"login": "ajsutton"}, "path": "networking/eth2/src/main/java/tech/pegasys/artemis/networking/eth2/ActiveEth2Network.java", "diffHunk": "@@ -123,11 +132,21 @@ public BeaconChainMethods getBeaconChainMethods() {\n \n   @Override\n   public void subscribeToAttestationCommitteeTopic(final int committeeIndex) {\n+    if (state.get() != State.RUNNING) {\n+      LOG.warn(\n+          \"Attestation committee can not be subscribed due to Gossip Managers not being initialized\");\n+      return;\n+    }\n     attestationGossipManager.subscribeToCommitteeTopic(committeeIndex);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNDg2MzA2MA=="}, "originalCommit": {"oid": "4eef33940417dde1aa9502e08f803dd3bc5a2930"}, "originalPosition": 50}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNTQ0NTc3MA==", "bodyText": "nit: Could we add a toUnprefixedHexString to Bytes4 which calls toUnprefixedHexString on the underlying bytes rather than truncating the first two characters here?", "url": "https://github.com/ConsenSys/teku/pull/1669#discussion_r415445770", "createdAt": "2020-04-27T01:02:44Z", "author": {"login": "ajsutton"}, "path": "networking/eth2/src/main/java/tech/pegasys/artemis/networking/eth2/gossip/topics/Eth2TopicHandler.java", "diffHunk": "@@ -54,7 +58,13 @@ protected Object createEvent(T data) {\n     return data;\n   }\n \n-  public abstract String getTopic();\n+  public String getTopic() {\n+    return \"/eth2/\" + this.getForkDigestString() + \"/\" + getTopicName() + \"/ssz\";\n+  }\n+\n+  private String getForkDigestString() {\n+    return forkDigest.toHexString().substring(2);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "fad6eb85e6da52ff8f76adac490a0f736ce709bc"}, "originalPosition": 30}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNTQ0NjMyMQ==", "bodyText": "nit: I think this should have just been an abstract method in Eth2TopicHandler rather than pulled all the way up to the interface.", "url": "https://github.com/ConsenSys/teku/pull/1669#discussion_r415446321", "createdAt": "2020-04-27T01:05:20Z", "author": {"login": "ajsutton"}, "path": "networking/p2p/src/main/java/tech/pegasys/artemis/networking/p2p/gossip/TopicHandler.java", "diffHunk": "@@ -17,6 +17,8 @@\n \n public interface TopicHandler {\n \n+  String getTopicName();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "fad6eb85e6da52ff8f76adac490a0f736ce709bc"}, "originalPosition": 4}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "6ee14389dcc6e9e6bad4284ec05bda53fb28fc47", "author": {"user": {"login": "cemozerr", "name": "Cem Ozer"}}, "url": "https://github.com/ConsenSys/teku/commit/6ee14389dcc6e9e6bad4284ec05bda53fb28fc47", "committedDate": "2020-04-27T19:28:25Z", "message": "Revert ActiveEth2Network changes related to p2p network start"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "825e0291fdebaff288f6e1b18274289a918d2183", "author": {"user": {"login": "cemozerr", "name": "Cem Ozer"}}, "url": "https://github.com/ConsenSys/teku/commit/825e0291fdebaff288f6e1b18274289a918d2183", "committedDate": "2020-04-27T21:21:54Z", "message": "Merge remote-tracking branch 'remotes/origin/master' into addForkDigestValueToTopicNames\n\n# Conflicts:\n#\tnetworking/eth2/src/main/java/tech/pegasys/artemis/networking/eth2/ActiveEth2Network.java\n#\tnetworking/eth2/src/main/java/tech/pegasys/artemis/networking/eth2/gossip/AttestationSubnetSubscriptions.java\n#\tnetworking/eth2/src/main/java/tech/pegasys/artemis/networking/eth2/gossip/topics/AttestationTopicHandler.java\n#\tnetworking/eth2/src/main/java/tech/pegasys/artemis/networking/eth2/gossip/topics/BlockTopicHandler.java\n#\tnetworking/eth2/src/test/java/tech/pegasys/artemis/networking/eth2/gossip/AttestationGossipManagerTest.java\n#\tnetworking/eth2/src/test/java/tech/pegasys/artemis/networking/eth2/gossip/AttestationSubnetSubscriptionsTest.java\n#\tnetworking/eth2/src/test/java/tech/pegasys/artemis/networking/eth2/gossip/topics/AttestationTopicHandlerTest.java"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "d4d621558aae26a0caeaeb8d7e8e4454e7a2946b", "author": {"user": {"login": "cemozerr", "name": "Cem Ozer"}}, "url": "https://github.com/ConsenSys/teku/commit/d4d621558aae26a0caeaeb8d7e8e4454e7a2946b", "committedDate": "2020-04-27T22:33:42Z", "message": "Fix merge errors"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b3b3dd478619a0c4178501ed9093df9073ddc28f", "author": {"user": {"login": "cemozerr", "name": "Cem Ozer"}}, "url": "https://github.com/ConsenSys/teku/commit/b3b3dd478619a0c4178501ed9093df9073ddc28f", "committedDate": "2020-04-27T22:44:15Z", "message": "Make getTopicName an Eth2TopicHandler abstract method"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a777a2d324c9f60b35ca637e76e5843aa4c16c17", "author": {"user": {"login": "cemozerr", "name": "Cem Ozer"}}, "url": "https://github.com/ConsenSys/teku/commit/a777a2d324c9f60b35ca637e76e5843aa4c16c17", "committedDate": "2020-04-27T23:06:43Z", "message": "Merge branch 'master' into addForkDigestValueToTopicNames"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDAxMzk3MDMz", "url": "https://github.com/ConsenSys/teku/pull/1669#pullrequestreview-401397033", "createdAt": "2020-04-27T23:28:30Z", "commit": {"oid": "a777a2d324c9f60b35ca637e76e5843aa4c16c17"}, "state": "APPROVED", "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yN1QyMzoyODozMFrOGM77Ww==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yN1QyMzo0MDoyNlrOGM8NlA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNjIxNzk0Nw==", "bodyText": "Do we need this now that we only start the network post-genesis?", "url": "https://github.com/ConsenSys/teku/pull/1669#discussion_r416217947", "createdAt": "2020-04-27T23:28:30Z", "author": {"login": "ajsutton"}, "path": "ethereum/datastructures/src/main/java/tech/pegasys/artemis/datastructures/networking/libp2p/rpc/StatusMessage.java", "diffHunk": "@@ -57,7 +57,7 @@ public static StatusMessage createPreGenesisStatus() {\n         UnsignedLong.ZERO);\n   }\n \n-  private static Bytes4 createPreGenesisForkDigest() {\n+  public static Bytes4 createPreGenesisForkDigest() {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "a777a2d324c9f60b35ca637e76e5843aa4c16c17"}, "originalPosition": 5}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNjIyMTIzNQ==", "bodyText": "This still worries me.  I suspect we should be storing a list of topics to subscribe to when we do startup or at least throwing an exception to let the caller know the subscription failed rather than ignoring the request.  At the moment it's only called from the ValidatorApiHandler so throwing an exception probably makes sense so the validator knows it's subscription failed.  It shouldn't hit it at the moment because of the way it manages timing.", "url": "https://github.com/ConsenSys/teku/pull/1669#discussion_r416221235", "createdAt": "2020-04-27T23:36:39Z", "author": {"login": "ajsutton"}, "path": "networking/eth2/src/main/java/tech/pegasys/artemis/networking/eth2/ActiveEth2Network.java", "diffHunk": "@@ -125,11 +131,21 @@ public BeaconChainMethods getBeaconChainMethods() {\n \n   @Override\n   public void subscribeToAttestationCommitteeTopic(final int committeeIndex) {\n+    if (aggregateGossipManager == null) {\n+      LOG.warn(\n+          \"Attestation committee can not be subscribed due to gossip manager not being initialized\");\n+      return;\n+    }", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "a777a2d324c9f60b35ca637e76e5843aa4c16c17"}, "originalPosition": 39}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNjIyMjYxMg==", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                return toHexString().substring(2);\n          \n          \n            \n                return bytes.toUnprefixedHexString()", "url": "https://github.com/ConsenSys/teku/pull/1669#discussion_r416222612", "createdAt": "2020-04-27T23:40:26Z", "author": {"login": "ajsutton"}, "path": "ssz/src/main/java/tech/pegasys/artemis/ssz/SSZTypes/Bytes4.java", "diffHunk": "@@ -98,6 +98,10 @@ public int hashCode() {\n     return Objects.hash(bytes);\n   }\n \n+  public String toUnprefixedHexString() {\n+    return toHexString().substring(2);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "a777a2d324c9f60b35ca637e76e5843aa4c16c17"}, "originalPosition": 5}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "37fbb562f404f75025512a9383b759e6829e8cd9", "author": {"user": {"login": "cemozerr", "name": "Cem Ozer"}}, "url": "https://github.com/ConsenSys/teku/commit/37fbb562f404f75025512a9383b759e6829e8cd9", "committedDate": "2020-04-28T17:44:32Z", "message": "Throw exception when subscription fails"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "6a63ecd3de2b816a815874c61aecee475a336dff", "author": {"user": {"login": "cemozerr", "name": "Cem Ozer"}}, "url": "https://github.com/ConsenSys/teku/commit/6a63ecd3de2b816a815874c61aecee475a336dff", "committedDate": "2020-04-28T17:45:00Z", "message": "Use string method of Bytes"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "9e781c096df20321dd9323f3b92992f10f7994c7", "author": {"user": {"login": "cemozerr", "name": "Cem Ozer"}}, "url": "https://github.com/ConsenSys/teku/commit/9e781c096df20321dd9323f3b92992f10f7994c7", "committedDate": "2020-04-28T17:45:27Z", "message": "Make createPreGenesisForkDigest private"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f4494f4de854ec0d2772ad42b4904bfe8380e639", "author": {"user": {"login": "cemozerr", "name": "Cem Ozer"}}, "url": "https://github.com/ConsenSys/teku/commit/f4494f4de854ec0d2772ad42b4904bfe8380e639", "committedDate": "2020-04-28T18:09:30Z", "message": "Remove unused variable"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "6de90c55d8f10ab9a7b79cbadc31f96932723083", "author": {"user": {"login": "cemozerr", "name": "Cem Ozer"}}, "url": "https://github.com/ConsenSys/teku/commit/6de90c55d8f10ab9a7b79cbadc31f96932723083", "committedDate": "2020-04-28T18:10:11Z", "message": "Merge branch 'master' into addForkDigestValueToTopicNames"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "02bcef6efe54fc4357bea6b74f584ce3b88b06a7", "author": {"user": {"login": "cemozerr", "name": "Cem Ozer"}}, "url": "https://github.com/ConsenSys/teku/commit/02bcef6efe54fc4357bea6b74f584ce3b88b06a7", "committedDate": "2020-04-28T19:12:04Z", "message": "Merge branch 'master' into addForkDigestValueToTopicNames"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4127, "cost": 1, "resetAt": "2021-11-01T13:51:04Z"}}}