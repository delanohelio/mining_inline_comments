{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTIxOTYyNDk1", "number": 3237, "reviewThreads": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xNlQyMzoxNjoyOFrOE5wq7w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xNlQyMzoxNjoyOFrOE5wq7w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzI5MDAxNzExOnYy", "diffSide": "RIGHT", "path": "services/beaconchain/src/main/java/tech/pegasys/teku/services/beaconchain/BeaconChainMetrics.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xNlQyMzoxNjoyOFrOH0bGQQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xNlQyMzoxNjoyOFrOH0bGQQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNDczMTk2OQ==", "bodyText": "I think we should avoid iterating through all the attestations twice. We just need to iterate through once, counting both total validators and correct validators.  Likely that will be easiest if you just an old fashioned for loop rather than streams.", "url": "https://github.com/ConsenSys/teku/pull/3237#discussion_r524731969", "createdAt": "2020-11-16T23:16:28Z", "author": {"login": "ajsutton"}, "path": "services/beaconchain/src/main/java/tech/pegasys/teku/services/beaconchain/BeaconChainMetrics.java", "diffHunk": "@@ -173,15 +194,35 @@ private void updateMetrics(final BeaconState state) {\n   }\n \n   private int getLiveValidators(final SSZList<PendingAttestation> attestations) {\n-    final Map<UInt64, Map<UInt64, Bitlist>> aggregationBitsBySlotAndCommittee = new HashMap<>();\n-    attestations.forEach(\n+    return getNumberOfValidators(attestations, (__) -> true);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "611b9cd8f3553a8218c682699cb1d2e8607401c7"}, "originalPosition": 65}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3033, "cost": 1, "resetAt": "2021-11-12T11:57:46Z"}}}