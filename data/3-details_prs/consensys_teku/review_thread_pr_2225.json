{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDQwMTc0MDYx", "number": 2225, "reviewThreads": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yNlQwMDoxMDo1M1rOEI9r6g==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yNlQwMDoxMDo1M1rOEI9r6g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjc3ODM0NzMwOnYy", "diffSide": "RIGHT", "path": "storage/src/main/java/tech/pegasys/teku/storage/server/rocksdb/core/RocksDbInstanceFactory.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yNlQwMDoxMDo1M1rOGpPzRw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yNlQwOTowNDo0MFrOGpZcsQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NTkwMzY4Nw==", "bodyText": "I did some playing just to see what happens if we make it higher. I think around 256MB has a good mix of the disk being used, might be a better starting point than 8MB...\nI tried with 128MB and there were constant disk flushes happening, 256MB means the WAL buffers fit inside the db write buffer size, and its happier by the looks.\nI could definitely see this being a configurable option for tweaking, i think sync will be when you'd potentially want more buffers so the sync can progress faster...\ngive .setDbWriteBufferSize(268435456L) a go...", "url": "https://github.com/ConsenSys/teku/pull/2225#discussion_r445903687", "createdAt": "2020-06-26T00:10:53Z", "author": {"login": "rolfyone"}, "path": "storage/src/main/java/tech/pegasys/teku/storage/server/rocksdb/core/RocksDbInstanceFactory.java", "diffHunk": "@@ -112,6 +112,7 @@ private static DBOptions createDBOptions(final RocksDbConfiguration configuratio\n         .setBytesPerSync(1048576L)\n         .setWalBytesPerSync(1048576L)\n         .setMaxBackgroundFlushes(2)\n+        .setDbWriteBufferSize(configuration.getCacheCapacity())", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "7212db90d12242461edb2ee9b5b10e2c8eed0fe5"}, "originalPosition": 4}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NjA2MTc0NQ==", "bodyText": "@rolfyone thanks for this investigation! Did it 256M by default", "url": "https://github.com/ConsenSys/teku/pull/2225#discussion_r446061745", "createdAt": "2020-06-26T09:04:40Z", "author": {"login": "Nashatyrev"}, "path": "storage/src/main/java/tech/pegasys/teku/storage/server/rocksdb/core/RocksDbInstanceFactory.java", "diffHunk": "@@ -112,6 +112,7 @@ private static DBOptions createDBOptions(final RocksDbConfiguration configuratio\n         .setBytesPerSync(1048576L)\n         .setWalBytesPerSync(1048576L)\n         .setMaxBackgroundFlushes(2)\n+        .setDbWriteBufferSize(configuration.getCacheCapacity())", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NTkwMzY4Nw=="}, "originalCommit": {"oid": "7212db90d12242461edb2ee9b5b10e2c8eed0fe5"}, "originalPosition": 4}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3468, "cost": 1, "resetAt": "2021-11-12T11:57:46Z"}}}