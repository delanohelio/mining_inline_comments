{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDk4MTcxNTUz", "number": 2881, "title": "Be more lenient when handling gossip errors", "bodyText": "PR Description\nBe more lenient when handling capacity-related errors when processing gossip messages.\nFixed Issue(s)\n\n\nDocumentation\n\n I thought about documentation and added the documentation label to this PR if updates are required.", "createdAt": "2020-10-05T23:22:48Z", "url": "https://github.com/ConsenSys/teku/pull/2881", "merged": true, "mergeCommit": {"oid": "4870891f4c7fe2da6b80c9742a6334be6e36d375"}, "closed": true, "closedAt": "2020-10-06T15:57:00Z", "author": {"login": "mbaxter"}, "timelineItems": {"totalCount": 5, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdPsRwZgH2gAyNDk4MTcxNTUzOmEyMGM4NTMxNzYzNzBjODBhMWJjOWRmOTcwZGVhZGZiZjgzNGU3ZTE=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdP6PQ-AH2gAyNDk4MTcxNTUzOjQ2YzZiZGVhYjJkZjI1ZjBkNmQ1ZDAwYWIyNzU4YzQyMzgzZmFjNTQ=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "a20c853176370c80a1bc9df970deadfbf834e7e1", "author": {"user": {"login": "mbaxter", "name": null}}, "url": "https://github.com/ConsenSys/teku/commit/a20c853176370c80a1bc9df970deadfbf834e7e1", "committedDate": "2020-10-05T23:21:19Z", "message": "Be more lenient when handling gossip errors"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTAyNjkzOTQx", "url": "https://github.com/ConsenSys/teku/pull/2881#pullrequestreview-502693941", "createdAt": "2020-10-06T08:20:30Z", "commit": {"oid": "a20c853176370c80a1bc9df970deadfbf834e7e1"}, "state": "COMMENTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wNlQwODoyMDozMFrOHc7J5A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wNlQwODoyMTo0NVrOHc7NKw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMDA5MTM2NA==", "bodyText": "From my perspective I would Ignore only the cases when we are 100% sure this is not the remote peer guilt.\nI'm almost sure there are still cases when other exceptions could be thrown beside DecodingException and this could be the attack target and in this case the peer would not be banned. IMHO it's better to unfairly ban a honest peer than keep being DoSed by a malicious peer.", "url": "https://github.com/ConsenSys/teku/pull/2881#discussion_r500091364", "createdAt": "2020-10-06T08:20:30Z", "author": {"login": "Nashatyrev"}, "path": "networking/eth2/src/main/java/tech/pegasys/teku/networking/eth2/gossip/topics/Eth2TopicHandler.java", "diffHunk": "@@ -62,15 +62,20 @@ protected abstract void processMessage(\n       final TWrapped message, InternalValidationResult internalValidationResult);\n \n   protected ValidationResult handleMessageProcessingError(Throwable err) {\n+    final ValidationResult response;\n     if (Throwables.getRootCause(err) instanceof DecodingException) {\n       LOG.trace(\"Received malformed gossip message on {}\", getTopic());\n+      response = ValidationResult.Invalid;\n     } else if (Throwables.getRootCause(err) instanceof RejectedExecutionException) {\n       LOG.warn(\n           \"Discarding gossip message for topic {} because the executor queue is full\", getTopic());\n+      response = ValidationResult.Ignore;\n     } else {\n       LOG.warn(\"Encountered exception while processing message for topic {}\", getTopic(), err);\n+      response = ValidationResult.Ignore;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "a20c853176370c80a1bc9df970deadfbf834e7e1"}, "originalPosition": 14}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMDA5MjIwMw==", "bodyText": "BTW I'd fix this check since there are cases when DecodingException is not the innermost. E.g.:\n    } catch (SSZException e) {\n      throw new DecodingException(\"Failed to deserialize value\", e);\n    } catch (Exception e) {\n      throw new DecodingException(\"Encountered exception while deserializing value\", e);\n    }", "url": "https://github.com/ConsenSys/teku/pull/2881#discussion_r500092203", "createdAt": "2020-10-06T08:21:45Z", "author": {"login": "Nashatyrev"}, "path": "networking/eth2/src/main/java/tech/pegasys/teku/networking/eth2/gossip/topics/Eth2TopicHandler.java", "diffHunk": "@@ -62,15 +62,20 @@ protected abstract void processMessage(\n       final TWrapped message, InternalValidationResult internalValidationResult);\n \n   protected ValidationResult handleMessageProcessingError(Throwable err) {\n+    final ValidationResult response;\n     if (Throwables.getRootCause(err) instanceof DecodingException) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "a20c853176370c80a1bc9df970deadfbf834e7e1"}, "originalPosition": 5}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "574be79b16906512f06085d2a6dfa9f9007f27cd", "author": {"user": {"login": "mbaxter", "name": null}}, "url": "https://github.com/ConsenSys/teku/commit/574be79b16906512f06085d2a6dfa9f9007f27cd", "committedDate": "2020-10-06T15:20:46Z", "message": "Fix throwable analysis, be strict on unknown errors, add tests"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTAzMDg2NjU4", "url": "https://github.com/ConsenSys/teku/pull/2881#pullrequestreview-503086658", "createdAt": "2020-10-06T15:23:41Z", "commit": {"oid": "574be79b16906512f06085d2a6dfa9f9007f27cd"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "46c6bdeab2df25f0d6d5d00ab2758c42383fac54", "author": {"user": {"login": "mbaxter", "name": null}}, "url": "https://github.com/ConsenSys/teku/commit/46c6bdeab2df25f0d6d5d00ab2758c42383fac54", "committedDate": "2020-10-06T15:37:16Z", "message": "Merge branch 'master' into qs-1/ignore-gossip-messages-rejected-due-to-capacity"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3482, "cost": 1, "resetAt": "2021-11-01T13:51:04Z"}}}