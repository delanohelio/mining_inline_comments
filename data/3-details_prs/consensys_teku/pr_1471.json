{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0MzkzNzQwNDQ0", "number": 1471, "title": "[BC-312] Update api handling of missing state", "bodyText": "PR Description\nAs a result of PR #1383, it is possible that state may be unavailable.  This PR modifies various REST API's to handle with unavailable state more explicitly.  For API's that rely on state being available, we will now return a 410 Gone status if state is missing.\nThroughout, Optional values are used to represent data that may be missing if state is unavailable.  Some extra checks have been added to make sure that chainhead information is available so we can disambiguate cases where we're missing state vs missing chain head information.", "createdAt": "2020-03-25T18:00:10Z", "url": "https://github.com/ConsenSys/teku/pull/1471", "merged": true, "mergeCommit": {"oid": "1d811b502fe7d4f011f8d58476030673c82adf0f"}, "closed": true, "closedAt": "2020-03-27T15:57:36Z", "author": {"login": "mbaxter"}, "timelineItems": {"totalCount": 29, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcRLTQZgH2gAyMzkzNzQwNDQ0Ojg1NmYzYzljZTc2NmMwY2E4ZjkwNzY1NzNiN2IxZDkwNGEyNzc1MTk=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcRyh_5gH2gAyMzkzNzQwNDQ0OmM2Yjk2ZjY4MjU0ODFkYzU0ODE2Mzk0N2IxZTMxNWQ4ODcxYjg4NDY=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "856f3c9ce766c0ca8f9076573b7b1d904a277519", "author": {"user": {"login": "mbaxter", "name": null}}, "url": "https://github.com/ConsenSys/teku/commit/856f3c9ce766c0ca8f9076573b7b1d904a277519", "committedDate": "2020-03-25T17:52:47Z", "message": "Update validator/duties to handle missing state"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "7d2e140d8ce4f07c845d9dbcadeaabda351ffd83", "author": {"user": {"login": "mbaxter", "name": null}}, "url": "https://github.com/ConsenSys/teku/commit/7d2e140d8ce4f07c845d9dbcadeaabda351ffd83", "committedDate": "2020-03-25T17:52:51Z", "message": "Update /beacon/state handling of missing state"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "0327ebae6457473c1626379f2f4d5b5cf1d9d865", "author": {"user": {"login": "mbaxter", "name": null}}, "url": "https://github.com/ConsenSys/teku/commit/0327ebae6457473c1626379f2f4d5b5cf1d9d865", "committedDate": "2020-03-25T17:52:52Z", "message": "Update /beacon/validators handling of missing state"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "95bde279bdbfb569c530d31cce8a62f5e5b66921", "author": {"user": {"login": "mbaxter", "name": null}}, "url": "https://github.com/ConsenSys/teku/commit/95bde279bdbfb569c530d31cce8a62f5e5b66921", "committedDate": "2020-03-25T17:52:52Z", "message": "Get state root from block rather than state"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c4297c4ab91d49af8a756f55e6de07d79e0cf9e2", "author": {"user": {"login": "mbaxter", "name": null}}, "url": "https://github.com/ConsenSys/teku/commit/c4297c4ab91d49af8a756f55e6de07d79e0cf9e2", "committedDate": "2020-03-25T17:52:52Z", "message": "Update /beacon/validators to return gone status when state is missing"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c2ec7015b6823d212abf15c32693354101806079", "author": {"user": {"login": "mbaxter", "name": null}}, "url": "https://github.com/ConsenSys/teku/commit/c2ec7015b6823d212abf15c32693354101806079", "committedDate": "2020-03-25T17:52:52Z", "message": "Update beacon/committees to handle missing state"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzgxNDcyMTA3", "url": "https://github.com/ConsenSys/teku/pull/1471#pullrequestreview-381472107", "createdAt": "2020-03-25T19:32:30Z", "commit": {"oid": "c2ec7015b6823d212abf15c32693354101806079"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yNVQxOTozMjozMFrOF7rH3g==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yNVQxOTozMjozMFrOF7rH3g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5ODExNjgzMA==", "bodyText": "nit: most of the time function name, then should, like queryBySlot_shouldReturnNoContentIfHeadRootMissing", "url": "https://github.com/ConsenSys/teku/pull/1471#discussion_r398116830", "createdAt": "2020-03-25T19:32:30Z", "author": {"login": "rolfyone"}, "path": "data/beaconrestapi/src/integration-test/java/tech/pegasys/artemis/beaconrestapi/beacon/GetStateIntegrationTest.java", "diffHunk": "@@ -42,6 +48,50 @@ public void shouldReturnNoContentIfStoreNotDefined_queryBySlot() throws Exceptio\n     assertNoContent(response);\n   }\n \n+  @Test\n+  public void shouldReturnNoContentIfHeadRootMissing_queryBySlot() throws Exception {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c2ec7015b6823d212abf15c32693354101806079"}, "originalPosition": 28}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzgxNDcyNDIx", "url": "https://github.com/ConsenSys/teku/pull/1471#pullrequestreview-381472421", "createdAt": "2020-03-25T19:32:59Z", "commit": {"oid": "c2ec7015b6823d212abf15c32693354101806079"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yNVQxOTozMjo1OVrOF7rI0w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yNVQxOTozMjo1OVrOF7rI0w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5ODExNzA3NQ==", "bodyText": "queryBySlot_shouldHandleMissingState", "url": "https://github.com/ConsenSys/teku/pull/1471#discussion_r398117075", "createdAt": "2020-03-25T19:32:59Z", "author": {"login": "rolfyone"}, "path": "data/beaconrestapi/src/integration-test/java/tech/pegasys/artemis/beaconrestapi/beacon/GetStateIntegrationTest.java", "diffHunk": "@@ -42,6 +48,50 @@ public void shouldReturnNoContentIfStoreNotDefined_queryBySlot() throws Exceptio\n     assertNoContent(response);\n   }\n \n+  @Test\n+  public void shouldReturnNoContentIfHeadRootMissing_queryBySlot() throws Exception {\n+    final Store store = mock(Store.class);\n+    when(chainStorageClient.getStore()).thenReturn(store);\n+    when(chainStorageClient.getBestBlockRoot()).thenReturn(Optional.empty());\n+\n+    final Response response = getBySlot(1);\n+    assertNoContent(response);\n+  }\n+\n+  @Test\n+  public void handleMissingState_queryBySlot() throws Exception {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c2ec7015b6823d212abf15c32693354101806079"}, "originalPosition": 38}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzgxNDczMDY2", "url": "https://github.com/ConsenSys/teku/pull/1471#pullrequestreview-381473066", "createdAt": "2020-03-25T19:33:56Z", "commit": {"oid": "c2ec7015b6823d212abf15c32693354101806079"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yNVQxOTozMzo1NlrOF7rK2w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yNVQxOTozMzo1NlrOF7rK2w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5ODExNzU5NQ==", "bodyText": "nit: queryBySlot_shouldReturnNoContentIfHeadRootUnavailable", "url": "https://github.com/ConsenSys/teku/pull/1471#discussion_r398117595", "createdAt": "2020-03-25T19:33:56Z", "author": {"login": "rolfyone"}, "path": "data/beaconrestapi/src/integration-test/java/tech/pegasys/artemis/beaconrestapi/beacon/GetStateRootIntegrationTest.java", "diffHunk": "@@ -33,6 +36,16 @@ public void shouldReturnNoContentIfStoreNotDefined_queryBySlot() throws Exceptio\n     assertNoContent(response);\n   }\n \n+  @Test\n+  public void shouldReturnNoContentIfHeadRootUnavailable_queryBySlot() throws Exception {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c2ec7015b6823d212abf15c32693354101806079"}, "originalPosition": 24}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzgxNDczOTA4", "url": "https://github.com/ConsenSys/teku/pull/1471#pullrequestreview-381473908", "createdAt": "2020-03-25T19:35:08Z", "commit": {"oid": "c2ec7015b6823d212abf15c32693354101806079"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzgxNDc3MTU4", "url": "https://github.com/ConsenSys/teku/pull/1471#pullrequestreview-381477158", "createdAt": "2020-03-25T19:39:58Z", "commit": {"oid": "c2ec7015b6823d212abf15c32693354101806079"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yNVQxOTozOTo1OFrOF7rXvg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yNVQxOTozOTo1OFrOF7rXvg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5ODEyMDg5NA==", "bodyText": "have we removed this test and re-tasked it?\nthe intent of this test was to show that an empty list is returned on an empty list passed in, and that's to be consistent with another API, so we should retain that intent in the testing.", "url": "https://github.com/ConsenSys/teku/pull/1471#discussion_r398120894", "createdAt": "2020-03-25T19:39:58Z", "author": {"login": "rolfyone"}, "path": "data/beaconrestapi/src/test/java/tech/pegasys/artemis/beaconrestapi/handlers/validator/PostDutiesTest.java", "diffHunk": "@@ -58,19 +58,20 @@ public void shouldReturnBadRequestWhenNegativeEpochNumberInBody() throws Excepti\n   }\n \n   @Test\n-  public void shouldReturnEmptyListWhenNoValidatorDuties() throws Exception {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c2ec7015b6823d212abf15c32693354101806079"}, "originalPosition": 31}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzgxNDc4Nzk5", "url": "https://github.com/ConsenSys/teku/pull/1471#pullrequestreview-381478799", "createdAt": "2020-03-25T19:42:29Z", "commit": {"oid": "c2ec7015b6823d212abf15c32693354101806079"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yNVQxOTo0MjoyOVrOF7rdGQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yNVQxOTo0MjoyOVrOF7rdGQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5ODEyMjI2NQ==", "bodyText": "i'd still like a test to show behaviour on future epoch, and we definitely want that not cached", "url": "https://github.com/ConsenSys/teku/pull/1471#discussion_r398122265", "createdAt": "2020-03-25T19:42:29Z", "author": {"login": "rolfyone"}, "path": "data/beaconrestapi/src/test/java/tech/pegasys/artemis/beaconrestapi/handlers/beacon/GetCommitteesTest.java", "diffHunk": "@@ -101,20 +86,21 @@ public void shouldReturnBadRequestWhenNoEpochIsSupplied() throws Exception {\n   }\n \n   @Test\n-  public void shouldReturnEmptyListWhenAFutureEpochIsRequested() throws Exception {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c2ec7015b6823d212abf15c32693354101806079"}, "originalPosition": 44}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzgxNDc5NTM5", "url": "https://github.com/ConsenSys/teku/pull/1471#pullrequestreview-381479539", "createdAt": "2020-03-25T19:43:38Z", "commit": {"oid": "c2ec7015b6823d212abf15c32693354101806079"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yNVQxOTo0MzozOFrOF7rfcg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yNVQxOTo0MzozOFrOF7rfcg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5ODEyMjg2Ng==", "bodyText": "if we're returning a result of 'SC_GONE', that can totally be cached, so this does look like a scenario we want to dig into if cache says none here. We'd be better off not setting the header at all and letting default behaviour happen potentially", "url": "https://github.com/ConsenSys/teku/pull/1471#discussion_r398122866", "createdAt": "2020-03-25T19:43:38Z", "author": {"login": "rolfyone"}, "path": "data/beaconrestapi/src/test/java/tech/pegasys/artemis/beaconrestapi/handlers/beacon/GetCommitteesTest.java", "diffHunk": "@@ -101,20 +86,21 @@ public void shouldReturnBadRequestWhenNoEpochIsSupplied() throws Exception {\n   }\n \n   @Test\n-  public void shouldReturnEmptyListWhenAFutureEpochIsRequested() throws Exception {\n+  public void shouldHandleMissingResult() throws Exception {\n     final GetCommittees handler = new GetCommittees(provider, jsonProvider);\n-    final UnsignedLong futureEpoch = slot.plus(UnsignedLong.valueOf(SLOTS_PER_EPOCH));\n \n+    when(context.queryParamMap()).thenReturn(Map.of(EPOCH, List.of(\"0\")));\n     when(provider.isStoreAvailable()).thenReturn(true);\n-    when(provider.getCommitteesAtEpoch(futureEpoch))\n-        .thenReturn(SafeFuture.completedFuture(List.of()));\n-    when(context.queryParamMap()).thenReturn(Map.of(EPOCH, List.of(futureEpoch.toString())));\n+    when(provider.getCommitteesAtEpoch(ZERO))\n+        .thenReturn(SafeFuture.completedFuture(Optional.empty()));\n     handler.handle(context);\n \n     verify(context).result(args.capture());\n     verify(context).header(Header.CACHE_CONTROL, CACHE_NONE);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c2ec7015b6823d212abf15c32693354101806079"}, "originalPosition": 59}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzgxNDgwNjQy", "url": "https://github.com/ConsenSys/teku/pull/1471#pullrequestreview-381480642", "createdAt": "2020-03-25T19:45:12Z", "commit": {"oid": "c2ec7015b6823d212abf15c32693354101806079"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yNVQxOTo0NToxMlrOF7rjJg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yNVQxOTo0NToxMlrOF7rjJg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5ODEyMzgxNA==", "bodyText": "as long as the slot is historical this is probably ok, might need another test case showing a future slot is not setting SC_GONE", "url": "https://github.com/ConsenSys/teku/pull/1471#discussion_r398123814", "createdAt": "2020-03-25T19:45:12Z", "author": {"login": "rolfyone"}, "path": "data/beaconrestapi/src/test/java/tech/pegasys/artemis/beaconrestapi/handlers/beacon/GetStateTest.java", "diffHunk": "@@ -198,6 +198,6 @@ public void shouldReturnNotFoundWhenQueryByMissingSlot() throws Exception {\n \n     handler.handle(context);\n \n-    verify(context).status(SC_NOT_FOUND);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c2ec7015b6823d212abf15c32693354101806079"}, "originalPosition": 22}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzgxNDgyNjIx", "url": "https://github.com/ConsenSys/teku/pull/1471#pullrequestreview-381482621", "createdAt": "2020-03-25T19:48:07Z", "commit": {"oid": "c2ec7015b6823d212abf15c32693354101806079"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yNVQxOTo0ODowOFrOF7rpgQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yNVQxOTo0ODowOFrOF7rpgQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5ODEyNTQ0MQ==", "bodyText": "nit: static import failedFuture?", "url": "https://github.com/ConsenSys/teku/pull/1471#discussion_r398125441", "createdAt": "2020-03-25T19:48:08Z", "author": {"login": "rolfyone"}, "path": "data/provider/src/main/java/tech/pegasys/artemis/api/ChainDataProvider.java", "diffHunk": "@@ -133,28 +135,39 @@ CombinedChainDataClient getCombinedChainDataClient() {\n     }\n     return combinedChainDataClient\n         .getStateByBlockRoot(blockRoot)\n-        .thenApply(state -> state.map(BeaconState::new))\n-        .exceptionally(err -> Optional.empty());\n+        .thenApply(state -> state.map(BeaconState::new));\n   }\n \n   public SafeFuture<Optional<BeaconState>> getStateAtSlot(UnsignedLong slot) {\n-    if (!isStoreAvailable()) {\n-      return SafeFuture.failedFuture(new ChainDataUnavailableException());\n-    }\n-    return combinedChainDataClient\n-        .getStateAtSlot(slot)\n-        .thenApply(state -> state.map(BeaconState::new))\n-        .exceptionally(err -> Optional.empty());\n+    return SafeFuture.of(\n+        () -> {\n+          if (!isStoreAvailable()) {\n+            return SafeFuture.failedFuture(new ChainDataUnavailableException());", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c2ec7015b6823d212abf15c32693354101806079"}, "originalPosition": 41}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "169ceac812724640cf55a2a96b2ee5c3ba6d9425", "author": {"user": {"login": "mbaxter", "name": null}}, "url": "https://github.com/ConsenSys/teku/commit/169ceac812724640cf55a2a96b2ee5c3ba6d9425", "committedDate": "2020-03-25T22:04:00Z", "message": "If epoch is non-final, return 404 in /beacon/committees"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "25e5916f25a034c9631f7bc1dd8c76017a93a7d1", "author": {"user": {"login": "mbaxter", "name": null}}, "url": "https://github.com/ConsenSys/teku/commit/25e5916f25a034c9631f7bc1dd8c76017a93a7d1", "committedDate": "2020-03-26T15:32:58Z", "message": "Update beacon/state to set status based on finalization status of slot"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ed3ddc805ae9d4a5e0ac320bc53c43ab231a9e3a", "author": {"user": {"login": "mbaxter", "name": null}}, "url": "https://github.com/ConsenSys/teku/commit/ed3ddc805ae9d4a5e0ac320bc53c43ab231a9e3a", "committedDate": "2020-03-26T15:57:01Z", "message": "Update /validator/duties to set status based on epoch finalization"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "61cb397f82425e6dd558817b2508ced781edb128", "author": {"user": {"login": "mbaxter", "name": null}}, "url": "https://github.com/ConsenSys/teku/commit/61cb397f82425e6dd558817b2508ced781edb128", "committedDate": "2020-03-26T16:03:29Z", "message": "Update /validator/duties to return empty list if no keys are supplied"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f45ba697c3486a51f7a8296217c563ceccc52744", "author": {"user": {"login": "mbaxter", "name": null}}, "url": "https://github.com/ConsenSys/teku/commit/f45ba697c3486a51f7a8296217c563ceccc52744", "committedDate": "2020-03-26T17:34:40Z", "message": "Update /beacon/validators to return status depending on finalization"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "1af5b1ab37b4cdd4ef2584acf5d9df46a39cfc35", "author": {"user": {"login": "mbaxter", "name": null}}, "url": "https://github.com/ConsenSys/teku/commit/1af5b1ab37b4cdd4ef2584acf5d9df46a39cfc35", "committedDate": "2020-03-26T18:08:26Z", "message": "Update /beacon/validators to set status based on epoch finalization"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "50927f72e4e8a0d2f64c178bd9ab15bc643a1f75", "author": {"user": {"login": "mbaxter", "name": null}}, "url": "https://github.com/ConsenSys/teku/commit/50927f72e4e8a0d2f64c178bd9ab15bc643a1f75", "committedDate": "2020-03-26T18:09:29Z", "message": "Update /beacon/validators to return empty list if pubkeys is empty"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "16efa4cd32291ce59076c98bcefaa1a18ac3fc7e", "author": {"user": {"login": "mbaxter", "name": null}}, "url": "https://github.com/ConsenSys/teku/commit/16efa4cd32291ce59076c98bcefaa1a18ac3fc7e", "committedDate": "2020-03-26T18:15:50Z", "message": "Run code formatter"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "169831ceb1e572d2eb7df542cc9fcd764190bb5a", "author": {"user": {"login": "mbaxter", "name": null}}, "url": "https://github.com/ConsenSys/teku/commit/169831ceb1e572d2eb7df542cc9fcd764190bb5a", "committedDate": "2020-03-26T18:33:14Z", "message": "Update GetState integration tests"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "63a115b8542a6f7b9c1a6b7392cc350cda12ceb9", "author": {"user": {"login": "mbaxter", "name": null}}, "url": "https://github.com/ConsenSys/teku/commit/63a115b8542a6f7b9c1a6b7392cc350cda12ceb9", "committedDate": "2020-03-26T18:45:03Z", "message": "Merge branch 'master' into bc-312/update-api-handling-of-missing-state"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzgyNDA1ODM3", "url": "https://github.com/ConsenSys/teku/pull/1471#pullrequestreview-382405837", "createdAt": "2020-03-26T20:49:00Z", "commit": {"oid": "63a115b8542a6f7b9c1a6b7392cc350cda12ceb9"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yNlQyMDo0OTowMVrOF8Z2Rg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yNlQyMDo0OTowMVrOF8Z2Rg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5ODg4MjM3NA==", "bodyText": "i wasn't too worried about the literal '1', i was just saying UnsignedLong.ONE could easily be static imported and just ONE...", "url": "https://github.com/ConsenSys/teku/pull/1471#discussion_r398882374", "createdAt": "2020-03-26T20:49:01Z", "author": {"login": "rolfyone"}, "path": "data/beaconrestapi/src/integration-test/java/tech/pegasys/artemis/beaconrestapi/beacon/PostDutiesIntegrationTest.java", "diffHunk": "@@ -36,22 +39,40 @@\n \n   @Test\n   public void shouldReturnNoContentIfStoreNotDefined() throws Exception {\n+    final UnsignedLong epoch = UnsignedLong.ONE;\n     when(chainStorageClient.getStore()).thenReturn(null);\n+    when(chainStorageClient.getFinalizedEpoch()).thenReturn(epoch);\n \n-    final Response response = post(1, keys);\n+    final Response response = post(epoch.intValue(), keys);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "63a115b8542a6f7b9c1a6b7392cc350cda12ceb9"}, "originalPosition": 25}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzgyNDA2ODI5", "url": "https://github.com/ConsenSys/teku/pull/1471#pullrequestreview-382406829", "createdAt": "2020-03-26T20:50:27Z", "commit": {"oid": "63a115b8542a6f7b9c1a6b7392cc350cda12ceb9"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "98247d3f6a97be6cb6d2b50a68b8501858b41781", "author": {"user": {"login": "mbaxter", "name": null}}, "url": "https://github.com/ConsenSys/teku/commit/98247d3f6a97be6cb6d2b50a68b8501858b41781", "committedDate": "2020-03-27T14:17:42Z", "message": "Merge branch 'master' into bc-312/update-api-handling-of-missing-state"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c6b96f6825481dc548163947b1e315d8871b8846", "author": {"user": {"login": "mbaxter", "name": null}}, "url": "https://github.com/ConsenSys/teku/commit/c6b96f6825481dc548163947b1e315d8871b8846", "committedDate": "2020-03-27T15:35:11Z", "message": "Short-circuit empty responses consistently"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4387, "cost": 1, "resetAt": "2021-11-01T13:51:04Z"}}}