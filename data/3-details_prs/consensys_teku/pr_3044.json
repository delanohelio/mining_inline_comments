{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTA3NzgxNTkx", "number": 3044, "title": "Fix non-canonical chain info retrieval for beacon state APIs", "bodyText": "PR Description\nFix non-canonical chain info retrieval for beacon state APIs, and refactor duplicated beacon state endpoint API request handling to one method.\nDocumentation\n\n I thought about documentation and added the documentation label to this PR if updates are required.", "createdAt": "2020-10-21T18:34:20Z", "url": "https://github.com/ConsenSys/teku/pull/3044", "merged": true, "mergeCommit": {"oid": "38ec73ccc72502482481a5b936976acabe20291b"}, "closed": true, "closedAt": "2020-10-21T22:12:56Z", "author": {"login": "cemozerr"}, "timelineItems": {"totalCount": 16, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdUxwGAAH2gAyNTA3NzgxNTkxOmUyMDJmMjY0ZTg3YWYwODI0ZTE2OTBmYTVlYjI0MzJiNzUyZjVjMDA=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdU01_CgFqTUxNDIyMjQyMg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "e202f264e87af0824e1690fa5eb2432b752f5c00", "author": {"user": {"login": "cemozerr", "name": "Cem Ozer"}}, "url": "https://github.com/ConsenSys/teku/commit/e202f264e87af0824e1690fa5eb2432b752f5c00", "committedDate": "2020-10-21T18:33:36Z", "message": "Fix non canonical chain info retrieval for beacon state APIs"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "d48580d017c06426377f7b1f1c16343459845264", "author": {"user": {"login": "cemozerr", "name": "Cem Ozer"}}, "url": "https://github.com/ConsenSys/teku/commit/d48580d017c06426377f7b1f1c16343459845264", "committedDate": "2020-10-21T18:34:26Z", "message": "Merge branch 'master' into fixNonCanonicalBlockAndStateRetrieval"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "414c119ebf1f8fd36f36879654daecc949216050", "author": {"user": {"login": "cemozerr", "name": "Cem Ozer"}}, "url": "https://github.com/ConsenSys/teku/commit/414c119ebf1f8fd36f36879654daecc949216050", "committedDate": "2020-10-21T18:53:31Z", "message": "Remove unused varible"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ea1c99f0924014841b8e866cb26e9816e447d735", "author": {"user": {"login": "cemozerr", "name": "Cem Ozer"}}, "url": "https://github.com/ConsenSys/teku/commit/ea1c99f0924014841b8e866cb26e9816e447d735", "committedDate": "2020-10-21T19:13:36Z", "message": "Fix tests and add improve API handling"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "179415cb2262d79b13052d2efe93eea4d454d726", "author": {"user": {"login": "cemozerr", "name": "Cem Ozer"}}, "url": "https://github.com/ConsenSys/teku/commit/179415cb2262d79b13052d2efe93eea4d454d726", "committedDate": "2020-10-21T19:39:55Z", "message": "Refactor to remove duplicated code"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "2359fea9ae51e9333abb15c7aeca4fff364e64f7", "author": {"user": {"login": "cemozerr", "name": "Cem Ozer"}}, "url": "https://github.com/ConsenSys/teku/commit/2359fea9ae51e9333abb15c7aeca4fff364e64f7", "committedDate": "2020-10-21T19:40:05Z", "message": "Run spotless"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "71cf67609d77387a2ffcc00b1b5a458edc313246", "author": {"user": {"login": "cemozerr", "name": "Cem Ozer"}}, "url": "https://github.com/ConsenSys/teku/commit/71cf67609d77387a2ffcc00b1b5a458edc313246", "committedDate": "2020-10-21T19:55:06Z", "message": "Refactor duplicated error handling"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "45383fb0c45ca4be81d299fe086e7e0ba4fba158", "author": {"user": {"login": "cemozerr", "name": "Cem Ozer"}}, "url": "https://github.com/ConsenSys/teku/commit/45383fb0c45ca4be81d299fe086e7e0ba4fba158", "committedDate": "2020-10-21T19:59:09Z", "message": "Add skipped bits"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "dbce1e81d86b5c8f789b4065841852f37e6029b3", "author": {"user": {"login": "cemozerr", "name": "Cem Ozer"}}, "url": "https://github.com/ConsenSys/teku/commit/dbce1e81d86b5c8f789b4065841852f37e6029b3", "committedDate": "2020-10-21T20:03:49Z", "message": "Remove redundant LOG variables"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "1b3e5c7891c24b7adae1c2144fea62133df6b1b2", "author": {"user": {"login": "cemozerr", "name": "Cem Ozer"}}, "url": "https://github.com/ConsenSys/teku/commit/1b3e5c7891c24b7adae1c2144fea62133df6b1b2", "committedDate": "2020-10-21T20:43:15Z", "message": "Add tests for the abstract handler process state endpoint method"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTE0MTc3MjEw", "url": "https://github.com/ConsenSys/teku/pull/3044#pullrequestreview-514177210", "createdAt": "2020-10-21T20:53:44Z", "commit": {"oid": "1b3e5c7891c24b7adae1c2144fea62133df6b1b2"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yMVQyMDo1Mzo0NVrOHmE6hw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yMVQyMDo1Mzo0NVrOHmE6hw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwOTY4ODQ1NQ==", "bodyText": "should probably ticket this...", "url": "https://github.com/ConsenSys/teku/pull/3044#discussion_r509688455", "createdAt": "2020-10-21T20:53:45Z", "author": {"login": "rolfyone"}, "path": "data/provider/src/main/java/tech/pegasys/teku/api/ChainDataProvider.java", "diffHunk": "@@ -237,6 +274,7 @@ public UInt64 getCurrentEpoch() {\n         .thenApply(stateInternal -> stateInternal.map(BeaconState::new));\n   }\n \n+  // TODO: remove once old API's are removed", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "1b3e5c7891c24b7adae1c2144fea62133df6b1b2"}, "originalPosition": 84}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "0520c433a6842ae05eb4b752bdc581c86107e145", "author": {"user": {"login": "cemozerr", "name": "Cem Ozer"}}, "url": "https://github.com/ConsenSys/teku/commit/0520c433a6842ae05eb4b752bdc581c86107e145", "committedDate": "2020-10-21T20:55:23Z", "message": "Add more tests"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "cd15ebc61199e58433701c39b5b91d8e8e4e4b78", "author": {"user": {"login": "cemozerr", "name": "Cem Ozer"}}, "url": "https://github.com/ConsenSys/teku/commit/cd15ebc61199e58433701c39b5b91d8e8e4e4b78", "committedDate": "2020-10-21T20:55:44Z", "message": "Merge branch 'master' into fixNonCanonicalBlockAndStateRetrieval"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTE0MTc4NzM3", "url": "https://github.com/ConsenSys/teku/pull/3044#pullrequestreview-514178737", "createdAt": "2020-10-21T20:56:05Z", "commit": {"oid": "1b3e5c7891c24b7adae1c2144fea62133df6b1b2"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yMVQyMDo1ODoyMlrOHmFEkw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yMVQyMDo1ODoyMlrOHmFEkw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwOTY5MTAyNw==", "bodyText": "this was wrapped because the tests in the API were attempting to use the api level objects (the api.schema.BeaconState)\nis there a reason we need the internal object?", "url": "https://github.com/ConsenSys/teku/pull/3044#discussion_r509691027", "createdAt": "2020-10-21T20:58:22Z", "author": {"login": "rolfyone"}, "path": "data/beaconrestapi/src/test/java/tech/pegasys/teku/beaconrestapi/handlers/v1/beacon/GetStateFinalityCheckpointsTest.java", "diffHunk": "@@ -22,20 +22,22 @@\n import java.util.Optional;\n import org.junit.jupiter.api.Test;\n import tech.pegasys.teku.api.response.v1.beacon.GetStateFinalityCheckpointsResponse;\n-import tech.pegasys.teku.api.schema.BeaconState;\n+import tech.pegasys.teku.api.schema.Checkpoint;\n import tech.pegasys.teku.beaconrestapi.AbstractBeaconHandlerTest;\n+import tech.pegasys.teku.datastructures.state.BeaconState;\n import tech.pegasys.teku.datastructures.util.DataStructureUtil;\n import tech.pegasys.teku.infrastructure.async.SafeFuture;\n import tech.pegasys.teku.infrastructure.unsigned.UInt64;\n \n public class GetStateFinalityCheckpointsTest extends AbstractBeaconHandlerTest {\n   final DataStructureUtil dataStructureUtil = new DataStructureUtil();\n-  final BeaconState state = new BeaconState(dataStructureUtil.randomBeaconState());\n+  final BeaconState state = dataStructureUtil.randomBeaconState();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "cd15ebc61199e58433701c39b5b91d8e8e4e4b78"}, "originalPosition": 15}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "8af5d265e9ef263dc3e769ad53a46141c094d581", "author": {"user": {"login": "cemozerr", "name": "Cem Ozer"}}, "url": "https://github.com/ConsenSys/teku/commit/8af5d265e9ef263dc3e769ad53a46141c094d581", "committedDate": "2020-10-21T21:45:21Z", "message": "Do not use internal beacon state object"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTE0MjIyNDIy", "url": "https://github.com/ConsenSys/teku/pull/3044#pullrequestreview-514222422", "createdAt": "2020-10-21T22:09:45Z", "commit": {"oid": "8af5d265e9ef263dc3e769ad53a46141c094d581"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3233, "cost": 1, "resetAt": "2021-11-01T13:51:04Z"}}}