{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTM5NzI4MDc5", "number": 8575, "title": "IGNITE-13492: Added snapshot test to ducktests", "bodyText": "Thank you for submitting the pull request to the Apache Ignite.\nIn order to streamline the review of the contribution\nwe ask you to ensure the following steps have been taken:\nThe Contribution Checklist\n\n There is a single JIRA ticket related to the pull request.\n The web-link to the pull request is attached to the JIRA ticket.\n The JIRA ticket has the Patch Available state.\n The pull request body describes changes that have been made.\nThe description explains WHAT and WHY was made instead of HOW.\n The pull request title is treated as the final commit message.\nThe following pattern must be used: IGNITE-XXXX Change summary where XXXX - number of JIRA issue.\n A reviewer has been mentioned through the JIRA comments\n(see the Maintainers list)\n The pull request has been checked by the Teamcity Bot and\nthe green visa attached to the JIRA ticket (see TC.Bot: Check PR)\n\nNotes\n\nHow to Contribute\nCoding abbreviation rules\nCoding Guidelines\nApache Ignite Teamcity Bot\n\nIf you need any help, please email dev@ignite.apache.org or ask an\u0443 advice on http://asf.slack.com #ignite channel.", "createdAt": "2020-12-14T18:51:31Z", "url": "https://github.com/apache/ignite/pull/8575", "merged": true, "mergeCommit": {"oid": "8fa155c0c7f1c9de1be5c82c4a6e1423713dc3de"}, "closed": true, "closedAt": "2021-02-19T13:27:45Z", "author": {"login": "Sega76"}, "timelineItems": {"totalCount": 60, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdmJ8EjgH2gAyNTM5NzI4MDc5OmRkOTYxM2Y4YmE1YWRiYzI5OWIzY2EwYzMyOTBjYTIwZjNiZjFjMDI=", "endCursor": "Y3Vyc29yOnYyOpPPAAABd7ofEHAH2gAyNTM5NzI4MDc5OjdlN2FkY2U2YTg1NGQ3NjVlZTVkOWQzOGY1MzNkZDA4NDU2YzA0NTE=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "dd9613f8ba5adbc299b3ca0c3290ca20f3bf1c02", "author": {"user": {"login": "Sega76", "name": "Sergei Ryzhov"}}, "url": "https://github.com/apache/ignite/commit/dd9613f8ba5adbc299b3ca0c3290ca20f3bf1c02", "committedDate": "2020-12-14T18:21:07Z", "message": "IGNITE-13492: added snapshot test to ducktests"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "9824b2ab177519f2b2993d3f979ce282151f2f2f", "author": {"user": {"login": "Sega76", "name": "Sergei Ryzhov"}}, "url": "https://github.com/apache/ignite/commit/9824b2ab177519f2b2993d3f979ce282151f2f2f", "committedDate": "2020-12-14T18:26:58Z", "message": "Merge remote-tracking branch 'ignite/ignite-ducktape' into IGNITE-13492v1"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTUyMzQzOTky", "url": "https://github.com/apache/ignite/pull/8575#pullrequestreview-552343992", "createdAt": "2020-12-15T11:12:14Z", "commit": {"oid": "9824b2ab177519f2b2993d3f979ce282151f2f2f"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xNVQxMToxMjoxNFrOIGFoKg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xNVQxMToxNDozNVrOIGFt_Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MzI1NDU3MA==", "bodyText": "make it private", "url": "https://github.com/apache/ignite/pull/8575#discussion_r543254570", "createdAt": "2020-12-15T11:12:14Z", "author": {"login": "timoninmaxim"}, "path": "modules/ducktests/tests/ignitetest/services/utils/ignite_aware.py", "diffHunk": "@@ -351,3 +351,25 @@ def __dump_netfilter_settings(node):\n         Reads current netfilter settings on the node for debugging purposes.\n         \"\"\"\n         return str(node.account.ssh_client.exec_command(\"sudo iptables -L -n\")[1].read(), sys.getdefaultencoding())\n+\n+    def restart(self):", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "9824b2ab177519f2b2993d3f979ce282151f2f2f"}, "originalPosition": 5}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MzI1NjA2MQ==", "bodyText": "Use grep with full pattern patching, smth like \"^console_?[0-9]*.log$\". As string \"log\" may match different log files.\nAlternative is using service counter variable that incremented within restart method.", "url": "https://github.com/apache/ignite/pull/8575#discussion_r543256061", "createdAt": "2020-12-15T11:14:35Z", "author": {"login": "timoninmaxim"}, "path": "modules/ducktests/tests/ignitetest/services/utils/ignite_aware.py", "diffHunk": "@@ -351,3 +351,25 @@ def __dump_netfilter_settings(node):\n         Reads current netfilter settings on the node for debugging purposes.\n         \"\"\"\n         return str(node.account.ssh_client.exec_command(\"sudo iptables -L -n\")[1].read(), sys.getdefaultencoding())\n+\n+    def restart(self):\n+        \"\"\"\n+        Restart ignite cluster without cleaning.\n+        \"\"\"\n+        self.stop()\n+        self.rotate_log()\n+        self.start(clean=False)\n+\n+    def rotate_log(self):\n+        \"\"\"\n+        Rotate log file.\n+        \"\"\"\n+        new_log_file = self.STDOUT_STDERR_CAPTURE.replace('.log', '_$N.log')\n+\n+        for node in self.nodes:\n+            node.account.ssh(f'if [ -e {self.STDOUT_STDERR_CAPTURE} ];'\n+                             f'then '\n+                             f'cd {self.LOGS_DIR};'\n+                             f'N=`ls | grep log | wc -l`;'", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "9824b2ab177519f2b2993d3f979ce282151f2f2f"}, "originalPosition": 23}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "0a27f73bd13b600cfc6040714f4c0aaec3ad55e4", "author": {"user": {"login": "Sega76", "name": "Sergei Ryzhov"}}, "url": "https://github.com/apache/ignite/commit/0a27f73bd13b600cfc6040714f4c0aaec3ad55e4", "committedDate": "2020-12-15T12:00:26Z", "message": "IGNITE-13492: fix comments"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "67db514ad25a13f1fea1290e57f61effb5e2798c", "author": {"user": {"login": "Sega76", "name": "Sergei Ryzhov"}}, "url": "https://github.com/apache/ignite/commit/67db514ad25a13f1fea1290e57f61effb5e2798c", "committedDate": "2020-12-15T13:43:16Z", "message": "IGNITE-13492: added version 2.9.0 to snapshot_test.py"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "dc6830c42967b27e10e2afad00472b54c6b17bb3", "author": {"user": {"login": "Sega76", "name": "Sergei Ryzhov"}}, "url": "https://github.com/apache/ignite/commit/dc6830c42967b27e10e2afad00472b54c6b17bb3", "committedDate": "2020-12-19T17:11:52Z", "message": "Merge remote-tracking branch 'ignite/ignite-ducktape' into IGNITE-13492v1\n\n# Conflicts:\n#\tmodules/ducktests/tests/ignitetest/services/utils/ignite_aware.py\n#\tmodules/ducktests/tests/ignitetest/services/utils/ignite_persistence.py"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a1f3c5f177bd9d8ec19538acdd782b2f428673b2", "author": {"user": {"login": "Sega76", "name": "Sergei Ryzhov"}}, "url": "https://github.com/apache/ignite/commit/a1f3c5f177bd9d8ec19538acdd782b2f428673b2", "committedDate": "2020-12-21T09:50:52Z", "message": "IGNITE-13492: remove method ignite_aware.restart()"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "4a23b3ee7ec9305566836e4b3144395abba8ee94", "author": {"user": {"login": "Sega76", "name": "Sergei Ryzhov"}}, "url": "https://github.com/apache/ignite/commit/4a23b3ee7ec9305566836e4b3144395abba8ee94", "committedDate": "2020-12-22T09:55:21Z", "message": "IGNITE-13492: fix slow_suite.yml"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "2069e59a917c72ad1ab10ff1b3a2121d06ad6ced", "author": {"user": {"login": "Sega76", "name": "Sergei Ryzhov"}}, "url": "https://github.com/apache/ignite/commit/2069e59a917c72ad1ab10ff1b3a2121d06ad6ced", "committedDate": "2020-12-22T12:58:43Z", "message": "IGNITE-13492: fix cache_macro.j2"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "4c826693f55a8a2786be435ebb619edcc284fc4c", "author": {"user": {"login": "Sega76", "name": "Sergei Ryzhov"}}, "url": "https://github.com/apache/ignite/commit/4c826693f55a8a2786be435ebb619edcc284fc4c", "committedDate": "2020-12-25T09:05:29Z", "message": "Merge remote-tracking branch 'ignite/ignite-ducktape' into IGNITE-13492v1\n\n# Conflicts:\n#\tmodules/ducktests/tests/ignitetest/services/utils/control_utility.py\n#\tmodules/ducktests/tests/ignitetest/services/utils/ignite_persistence.py"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e340a98840c92dd3dbc237533d55d123d31ff11c", "author": {"user": {"login": "Sega76", "name": "Sergei Ryzhov"}}, "url": "https://github.com/apache/ignite/commit/e340a98840c92dd3dbc237533d55d123d31ff11c", "committedDate": "2020-12-25T09:37:09Z", "message": "IGNITE-13492: resolved conflicts"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "0d27f108d3af0ae91171db067dabffa020fabba2", "author": {"user": {"login": "Sega76", "name": "Sergei Ryzhov"}}, "url": "https://github.com/apache/ignite/commit/0d27f108d3af0ae91171db067dabffa020fabba2", "committedDate": "2020-12-25T10:48:23Z", "message": "IGNITE-13492: resolved conflicts"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "0878384ba0cbb60158abdc3bcb83fa6c1ee7f180", "author": {"user": {"login": "Sega76", "name": "Sergei Ryzhov"}}, "url": "https://github.com/apache/ignite/commit/0878384ba0cbb60158abdc3bcb83fa6c1ee7f180", "committedDate": "2020-12-25T11:23:44Z", "message": "IGNITE-13492: little fix"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTU5NDQwMjA1", "url": "https://github.com/apache/ignite/pull/8575#pullrequestreview-559440205", "createdAt": "2020-12-29T09:07:43Z", "commit": {"oid": "0878384ba0cbb60158abdc3bcb83fa6c1ee7f180"}, "state": "COMMENTED", "comments": {"totalCount": 23, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0yOVQwOTowNzo0NFrOIMKjwQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0yOVQxMDoyMjo1NVrOIMMBsw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0OTYyNjgxNw==", "bodyText": "why \"j\" ? :)\nwhy \"<=\" ?\nany reason to specify \"L\"?", "url": "https://github.com/apache/ignite/pull/8575#discussion_r549626817", "createdAt": "2020-12-29T09:07:44Z", "author": {"login": "anton-vinogradov"}, "path": "modules/ducktests/src/main/java/org/apache/ignite/internal/ducktest/tests/snapshot_test/UuidDataLoaderApplication.java", "diffHunk": "@@ -0,0 +1,46 @@\n+/*\n+ * Licensed to the Apache Software Foundation (ASF) under one or more\n+ * contributor license agreements.  See the NOTICE file distributed with\n+ * this work for additional information regarding copyright ownership.\n+ * The ASF licenses this file to You under the Apache License, Version 2.0\n+ * (the \"License\"); you may not use this file except in compliance with\n+ * the License.  You may obtain a copy of the License at\n+ *\n+ *      http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package org.apache.ignite.internal.ducktest.tests.snapshot_test;\n+\n+import java.util.UUID;\n+import com.fasterxml.jackson.databind.JsonNode;\n+import org.apache.ignite.IgniteDataStreamer;\n+import org.apache.ignite.internal.ducktest.utils.IgniteAwareApplication;\n+\n+/**\n+ * Loading random uuids to cache.\n+ */\n+public class UuidDataLoaderApplication extends IgniteAwareApplication {\n+    /** {@inheritDoc} */\n+    @Override public void run(JsonNode jNode) {\n+        String cacheName = jNode.get(\"cacheName\").asText();\n+\n+        long size = jNode.get(\"size\").asLong();\n+\n+        int dataSize = jNode.get(\"dataSize\").asInt();\n+\n+        markInitialized();\n+\n+        try (IgniteDataStreamer<UUID, byte[]> dataStreamer = ignite.dataStreamer(cacheName)) {\n+            for (long j = 0L; j <= size; j++)", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "0878384ba0cbb60158abdc3bcb83fa6c1ee7f180"}, "originalPosition": 40}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0OTYyNzE1Mg==", "bodyText": "what is \"size\" when we have \"dataSize\"?", "url": "https://github.com/apache/ignite/pull/8575#discussion_r549627152", "createdAt": "2020-12-29T09:08:38Z", "author": {"login": "anton-vinogradov"}, "path": "modules/ducktests/src/main/java/org/apache/ignite/internal/ducktest/tests/snapshot_test/UuidDataLoaderApplication.java", "diffHunk": "@@ -0,0 +1,46 @@\n+/*\n+ * Licensed to the Apache Software Foundation (ASF) under one or more\n+ * contributor license agreements.  See the NOTICE file distributed with\n+ * this work for additional information regarding copyright ownership.\n+ * The ASF licenses this file to You under the Apache License, Version 2.0\n+ * (the \"License\"); you may not use this file except in compliance with\n+ * the License.  You may obtain a copy of the License at\n+ *\n+ *      http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package org.apache.ignite.internal.ducktest.tests.snapshot_test;\n+\n+import java.util.UUID;\n+import com.fasterxml.jackson.databind.JsonNode;\n+import org.apache.ignite.IgniteDataStreamer;\n+import org.apache.ignite.internal.ducktest.utils.IgniteAwareApplication;\n+\n+/**\n+ * Loading random uuids to cache.\n+ */\n+public class UuidDataLoaderApplication extends IgniteAwareApplication {\n+    /** {@inheritDoc} */\n+    @Override public void run(JsonNode jNode) {\n+        String cacheName = jNode.get(\"cacheName\").asText();\n+\n+        long size = jNode.get(\"size\").asLong();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "0878384ba0cbb60158abdc3bcb83fa6c1ee7f180"}, "originalPosition": 33}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0OTYyNzk5MQ==", "bodyText": "what is the reason to have a dedicated \"initialized\" state?", "url": "https://github.com/apache/ignite/pull/8575#discussion_r549627991", "createdAt": "2020-12-29T09:11:30Z", "author": {"login": "anton-vinogradov"}, "path": "modules/ducktests/src/main/java/org/apache/ignite/internal/ducktest/tests/snapshot_test/UuidDataLoaderApplication.java", "diffHunk": "@@ -0,0 +1,46 @@\n+/*\n+ * Licensed to the Apache Software Foundation (ASF) under one or more\n+ * contributor license agreements.  See the NOTICE file distributed with\n+ * this work for additional information regarding copyright ownership.\n+ * The ASF licenses this file to You under the Apache License, Version 2.0\n+ * (the \"License\"); you may not use this file except in compliance with\n+ * the License.  You may obtain a copy of the License at\n+ *\n+ *      http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package org.apache.ignite.internal.ducktest.tests.snapshot_test;\n+\n+import java.util.UUID;\n+import com.fasterxml.jackson.databind.JsonNode;\n+import org.apache.ignite.IgniteDataStreamer;\n+import org.apache.ignite.internal.ducktest.utils.IgniteAwareApplication;\n+\n+/**\n+ * Loading random uuids to cache.\n+ */\n+public class UuidDataLoaderApplication extends IgniteAwareApplication {\n+    /** {@inheritDoc} */\n+    @Override public void run(JsonNode jNode) {\n+        String cacheName = jNode.get(\"cacheName\").asText();\n+\n+        long size = jNode.get(\"size\").asLong();\n+\n+        int dataSize = jNode.get(\"dataSize\").asInt();\n+\n+        markInitialized();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "0878384ba0cbb60158abdc3bcb83fa6c1ee7f180"}, "originalPosition": 37}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0OTYzMDE4NA==", "bodyText": "\"Node\" param description missed", "url": "https://github.com/apache/ignite/pull/8575#discussion_r549630184", "createdAt": "2020-12-29T09:17:57Z", "author": {"login": "anton-vinogradov"}, "path": "modules/ducktests/tests/ignitetest/services/utils/control_utility.py", "diffHunk": "@@ -127,6 +131,65 @@ def tx_kill(self, **kwargs):\n         res = self.__parse_tx_list(output)\n         return res if res else output\n \n+    def validate_indexes(self):\n+        \"\"\"\n+        Validate indexes.\n+        \"\"\"\n+        data = self.__run(\"--cache validate_indexes\")\n+\n+        assert ('no issues found.' in data), data\n+\n+    def idle_verify(self):\n+        \"\"\"\n+        Idle verify.\n+        \"\"\"\n+        data = self.__run(\"--cache idle_verify\")\n+\n+        assert ('idle_verify check has finished, no conflicts have been found.' in data), data\n+\n+    def idle_verify_dump(self, node=None):\n+        \"\"\"\n+        Idle verify dump.", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "0878384ba0cbb60158abdc3bcb83fa6c1ee7f180"}, "originalPosition": 38}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0OTYzMDI4Nw==", "bodyText": "params description missed", "url": "https://github.com/apache/ignite/pull/8575#discussion_r549630287", "createdAt": "2020-12-29T09:18:16Z", "author": {"login": "anton-vinogradov"}, "path": "modules/ducktests/tests/ignitetest/services/utils/control_utility.py", "diffHunk": "@@ -127,6 +131,65 @@ def tx_kill(self, **kwargs):\n         res = self.__parse_tx_list(output)\n         return res if res else output\n \n+    def validate_indexes(self):\n+        \"\"\"\n+        Validate indexes.\n+        \"\"\"\n+        data = self.__run(\"--cache validate_indexes\")\n+\n+        assert ('no issues found.' in data), data\n+\n+    def idle_verify(self):\n+        \"\"\"\n+        Idle verify.\n+        \"\"\"\n+        data = self.__run(\"--cache idle_verify\")\n+\n+        assert ('idle_verify check has finished, no conflicts have been found.' in data), data\n+\n+    def idle_verify_dump(self, node=None):\n+        \"\"\"\n+        Idle verify dump.\n+        \"\"\"\n+        data = self.__run(\"--cache idle_verify --dump\", node=node)\n+\n+        assert ('VisorIdleVerifyDumpTask successfully' in data), data\n+\n+        return re.search(r'/.*.txt', data).group(0)\n+\n+    def snapshot_create(self, snapshot_name: str, sync_mode: bool = True, timeout_sec: int = 60):\n+        \"\"\"\n+        Create snapshot.", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "0878384ba0cbb60158abdc3bcb83fa6c1ee7f180"}, "originalPosition": 48}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0OTYzNTc4OQ==", "bodyText": "any real reason to have sync_mode param when it's always true in code?\nany reason to replace an explicit call of await_snapshot by this param?", "url": "https://github.com/apache/ignite/pull/8575#discussion_r549635789", "createdAt": "2020-12-29T09:35:43Z", "author": {"login": "anton-vinogradov"}, "path": "modules/ducktests/tests/ignitetest/services/utils/control_utility.py", "diffHunk": "@@ -127,6 +131,65 @@ def tx_kill(self, **kwargs):\n         res = self.__parse_tx_list(output)\n         return res if res else output\n \n+    def validate_indexes(self):\n+        \"\"\"\n+        Validate indexes.\n+        \"\"\"\n+        data = self.__run(\"--cache validate_indexes\")\n+\n+        assert ('no issues found.' in data), data\n+\n+    def idle_verify(self):\n+        \"\"\"\n+        Idle verify.\n+        \"\"\"\n+        data = self.__run(\"--cache idle_verify\")\n+\n+        assert ('idle_verify check has finished, no conflicts have been found.' in data), data\n+\n+    def idle_verify_dump(self, node=None):\n+        \"\"\"\n+        Idle verify dump.\n+        \"\"\"\n+        data = self.__run(\"--cache idle_verify --dump\", node=node)\n+\n+        assert ('VisorIdleVerifyDumpTask successfully' in data), data\n+\n+        return re.search(r'/.*.txt', data).group(0)\n+\n+    def snapshot_create(self, snapshot_name: str, sync_mode: bool = True, timeout_sec: int = 60):", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "0878384ba0cbb60158abdc3bcb83fa6c1ee7f180"}, "originalPosition": 46}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0OTYzNTkzMQ==", "bodyText": "success execution assert missed", "url": "https://github.com/apache/ignite/pull/8575#discussion_r549635931", "createdAt": "2020-12-29T09:36:08Z", "author": {"login": "anton-vinogradov"}, "path": "modules/ducktests/tests/ignitetest/services/utils/control_utility.py", "diffHunk": "@@ -127,6 +131,65 @@ def tx_kill(self, **kwargs):\n         res = self.__parse_tx_list(output)\n         return res if res else output\n \n+    def validate_indexes(self):\n+        \"\"\"\n+        Validate indexes.\n+        \"\"\"\n+        data = self.__run(\"--cache validate_indexes\")\n+\n+        assert ('no issues found.' in data), data\n+\n+    def idle_verify(self):\n+        \"\"\"\n+        Idle verify.\n+        \"\"\"\n+        data = self.__run(\"--cache idle_verify\")\n+\n+        assert ('idle_verify check has finished, no conflicts have been found.' in data), data\n+\n+    def idle_verify_dump(self, node=None):\n+        \"\"\"\n+        Idle verify dump.\n+        \"\"\"\n+        data = self.__run(\"--cache idle_verify --dump\", node=node)\n+\n+        assert ('VisorIdleVerifyDumpTask successfully' in data), data\n+\n+        return re.search(r'/.*.txt', data).group(0)\n+\n+    def snapshot_create(self, snapshot_name: str, sync_mode: bool = True, timeout_sec: int = 60):\n+        \"\"\"\n+        Create snapshot.\n+        \"\"\"\n+        res = self.__run(f\"--snapshot create {snapshot_name}\")\n+\n+        if (\"Command [SNAPSHOT] finished with code: 0\" in res) & sync_mode:", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "0878384ba0cbb60158abdc3bcb83fa6c1ee7f180"}, "originalPosition": 52}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0OTY0MTczOA==", "bodyText": "do we really should check the condition \"(0 < start_time < end_time)\" here?\nshould we have an assert here \"(snapshot_name == name)\" instead of check since LastSnapshotName MUST show the last started snapshot name?", "url": "https://github.com/apache/ignite/pull/8575#discussion_r549641738", "createdAt": "2020-12-29T09:54:37Z", "author": {"login": "anton-vinogradov"}, "path": "modules/ducktests/tests/ignitetest/services/utils/control_utility.py", "diffHunk": "@@ -127,6 +131,65 @@ def tx_kill(self, **kwargs):\n         res = self.__parse_tx_list(output)\n         return res if res else output\n \n+    def validate_indexes(self):\n+        \"\"\"\n+        Validate indexes.\n+        \"\"\"\n+        data = self.__run(\"--cache validate_indexes\")\n+\n+        assert ('no issues found.' in data), data\n+\n+    def idle_verify(self):\n+        \"\"\"\n+        Idle verify.\n+        \"\"\"\n+        data = self.__run(\"--cache idle_verify\")\n+\n+        assert ('idle_verify check has finished, no conflicts have been found.' in data), data\n+\n+    def idle_verify_dump(self, node=None):\n+        \"\"\"\n+        Idle verify dump.\n+        \"\"\"\n+        data = self.__run(\"--cache idle_verify --dump\", node=node)\n+\n+        assert ('VisorIdleVerifyDumpTask successfully' in data), data\n+\n+        return re.search(r'/.*.txt', data).group(0)\n+\n+    def snapshot_create(self, snapshot_name: str, sync_mode: bool = True, timeout_sec: int = 60):\n+        \"\"\"\n+        Create snapshot.\n+        \"\"\"\n+        res = self.__run(f\"--snapshot create {snapshot_name}\")\n+\n+        if (\"Command [SNAPSHOT] finished with code: 0\" in res) & sync_mode:\n+            self.await_snapshot(snapshot_name, timeout_sec)\n+\n+    def await_snapshot(self, snapshot_name: str, timeout_sec=60):\n+        \"\"\"\n+        Waiting for the snapshot to complete.\n+        \"\"\"\n+        delta_time = datetime.now() + timedelta(seconds=timeout_sec)\n+\n+        while datetime.now() < delta_time:\n+            for node in self._cluster.nodes:\n+                mbean = JmxClient(node).find_mbean('snapshot')\n+                start_time = int(list(mbean.LastSnapshotStartTime)[0])\n+                end_time = int(list(mbean.LastSnapshotEndTime)[0])\n+                err_msg = list(mbean.LastSnapshotErrorMessage)[0]\n+                name = list(mbean.LastSnapshotName)[0]\n+\n+                if (snapshot_name == name) and (0 < start_time < end_time) and (err_msg == ''):", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "0878384ba0cbb60158abdc3bcb83fa6c1ee7f180"}, "originalPosition": 69}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0OTY0NDYwOQ==", "bodyText": "in java code it looks like LongMetric startTime = mreg0.findMetric(\"LastSnapshotStartTime\");\nwhy it looks so strange - \"int(list(...)[0])\" in python?", "url": "https://github.com/apache/ignite/pull/8575#discussion_r549644609", "createdAt": "2020-12-29T10:03:37Z", "author": {"login": "anton-vinogradov"}, "path": "modules/ducktests/tests/ignitetest/services/utils/control_utility.py", "diffHunk": "@@ -127,6 +131,65 @@ def tx_kill(self, **kwargs):\n         res = self.__parse_tx_list(output)\n         return res if res else output\n \n+    def validate_indexes(self):\n+        \"\"\"\n+        Validate indexes.\n+        \"\"\"\n+        data = self.__run(\"--cache validate_indexes\")\n+\n+        assert ('no issues found.' in data), data\n+\n+    def idle_verify(self):\n+        \"\"\"\n+        Idle verify.\n+        \"\"\"\n+        data = self.__run(\"--cache idle_verify\")\n+\n+        assert ('idle_verify check has finished, no conflicts have been found.' in data), data\n+\n+    def idle_verify_dump(self, node=None):\n+        \"\"\"\n+        Idle verify dump.\n+        \"\"\"\n+        data = self.__run(\"--cache idle_verify --dump\", node=node)\n+\n+        assert ('VisorIdleVerifyDumpTask successfully' in data), data\n+\n+        return re.search(r'/.*.txt', data).group(0)\n+\n+    def snapshot_create(self, snapshot_name: str, sync_mode: bool = True, timeout_sec: int = 60):\n+        \"\"\"\n+        Create snapshot.\n+        \"\"\"\n+        res = self.__run(f\"--snapshot create {snapshot_name}\")\n+\n+        if (\"Command [SNAPSHOT] finished with code: 0\" in res) & sync_mode:\n+            self.await_snapshot(snapshot_name, timeout_sec)\n+\n+    def await_snapshot(self, snapshot_name: str, timeout_sec=60):\n+        \"\"\"\n+        Waiting for the snapshot to complete.\n+        \"\"\"\n+        delta_time = datetime.now() + timedelta(seconds=timeout_sec)\n+\n+        while datetime.now() < delta_time:\n+            for node in self._cluster.nodes:\n+                mbean = JmxClient(node).find_mbean('snapshot')\n+                start_time = int(list(mbean.LastSnapshotStartTime)[0])", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "0878384ba0cbb60158abdc3bcb83fa6c1ee7f180"}, "originalPosition": 64}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0OTY0NTAwMw==", "bodyText": "reason to have slept here?", "url": "https://github.com/apache/ignite/pull/8575#discussion_r549645003", "createdAt": "2020-12-29T10:04:40Z", "author": {"login": "anton-vinogradov"}, "path": "modules/ducktests/tests/ignitetest/services/utils/control_utility.py", "diffHunk": "@@ -127,6 +131,65 @@ def tx_kill(self, **kwargs):\n         res = self.__parse_tx_list(output)\n         return res if res else output\n \n+    def validate_indexes(self):\n+        \"\"\"\n+        Validate indexes.\n+        \"\"\"\n+        data = self.__run(\"--cache validate_indexes\")\n+\n+        assert ('no issues found.' in data), data\n+\n+    def idle_verify(self):\n+        \"\"\"\n+        Idle verify.\n+        \"\"\"\n+        data = self.__run(\"--cache idle_verify\")\n+\n+        assert ('idle_verify check has finished, no conflicts have been found.' in data), data\n+\n+    def idle_verify_dump(self, node=None):\n+        \"\"\"\n+        Idle verify dump.\n+        \"\"\"\n+        data = self.__run(\"--cache idle_verify --dump\", node=node)\n+\n+        assert ('VisorIdleVerifyDumpTask successfully' in data), data\n+\n+        return re.search(r'/.*.txt', data).group(0)\n+\n+    def snapshot_create(self, snapshot_name: str, sync_mode: bool = True, timeout_sec: int = 60):\n+        \"\"\"\n+        Create snapshot.\n+        \"\"\"\n+        res = self.__run(f\"--snapshot create {snapshot_name}\")\n+\n+        if (\"Command [SNAPSHOT] finished with code: 0\" in res) & sync_mode:\n+            self.await_snapshot(snapshot_name, timeout_sec)\n+\n+    def await_snapshot(self, snapshot_name: str, timeout_sec=60):\n+        \"\"\"\n+        Waiting for the snapshot to complete.\n+        \"\"\"\n+        delta_time = datetime.now() + timedelta(seconds=timeout_sec)\n+\n+        while datetime.now() < delta_time:\n+            for node in self._cluster.nodes:\n+                mbean = JmxClient(node).find_mbean('snapshot')\n+                start_time = int(list(mbean.LastSnapshotStartTime)[0])\n+                end_time = int(list(mbean.LastSnapshotEndTime)[0])\n+                err_msg = list(mbean.LastSnapshotErrorMessage)[0]\n+                name = list(mbean.LastSnapshotName)[0]\n+\n+                if (snapshot_name == name) and (0 < start_time < end_time) and (err_msg == ''):\n+                    return\n+\n+            time.sleep(1)", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "0878384ba0cbb60158abdc3bcb83fa6c1ee7f180"}, "originalPosition": 72}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0OTY0NTE2NA==", "bodyText": "it seems we have all the chances to gain \"name\" from one snapshot, \"start_time\" from another, and \"err_msg\" from the third", "url": "https://github.com/apache/ignite/pull/8575#discussion_r549645164", "createdAt": "2020-12-29T10:05:07Z", "author": {"login": "anton-vinogradov"}, "path": "modules/ducktests/tests/ignitetest/services/utils/control_utility.py", "diffHunk": "@@ -127,6 +131,65 @@ def tx_kill(self, **kwargs):\n         res = self.__parse_tx_list(output)\n         return res if res else output\n \n+    def validate_indexes(self):\n+        \"\"\"\n+        Validate indexes.\n+        \"\"\"\n+        data = self.__run(\"--cache validate_indexes\")\n+\n+        assert ('no issues found.' in data), data\n+\n+    def idle_verify(self):\n+        \"\"\"\n+        Idle verify.\n+        \"\"\"\n+        data = self.__run(\"--cache idle_verify\")\n+\n+        assert ('idle_verify check has finished, no conflicts have been found.' in data), data\n+\n+    def idle_verify_dump(self, node=None):\n+        \"\"\"\n+        Idle verify dump.\n+        \"\"\"\n+        data = self.__run(\"--cache idle_verify --dump\", node=node)\n+\n+        assert ('VisorIdleVerifyDumpTask successfully' in data), data\n+\n+        return re.search(r'/.*.txt', data).group(0)\n+\n+    def snapshot_create(self, snapshot_name: str, sync_mode: bool = True, timeout_sec: int = 60):\n+        \"\"\"\n+        Create snapshot.\n+        \"\"\"\n+        res = self.__run(f\"--snapshot create {snapshot_name}\")\n+\n+        if (\"Command [SNAPSHOT] finished with code: 0\" in res) & sync_mode:\n+            self.await_snapshot(snapshot_name, timeout_sec)\n+\n+    def await_snapshot(self, snapshot_name: str, timeout_sec=60):\n+        \"\"\"\n+        Waiting for the snapshot to complete.\n+        \"\"\"\n+        delta_time = datetime.now() + timedelta(seconds=timeout_sec)\n+\n+        while datetime.now() < delta_time:\n+            for node in self._cluster.nodes:\n+                mbean = JmxClient(node).find_mbean('snapshot')\n+                start_time = int(list(mbean.LastSnapshotStartTime)[0])\n+                end_time = int(list(mbean.LastSnapshotEndTime)[0])\n+                err_msg = list(mbean.LastSnapshotErrorMessage)[0]\n+                name = list(mbean.LastSnapshotName)[0]\n+\n+                if (snapshot_name == name) and (0 < start_time < end_time) and (err_msg == ''):\n+                    return\n+\n+            time.sleep(1)\n+\n+        raise TimeoutError(f'LastSnapshotName={name}, '\n+                           f'LastSnapshotStartTime={start_time}, '\n+                           f'LastSnapshotEndTime={end_time}, '\n+                           f'LastSnapshotErrorMessage={err_msg}')", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "0878384ba0cbb60158abdc3bcb83fa6c1ee7f180"}, "originalPosition": 77}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0OTY0NTc1MA==", "bodyText": "what is the difference with \"node.account.externally_routable_ip\" used before?", "url": "https://github.com/apache/ignite/pull/8575#discussion_r549645750", "createdAt": "2020-12-29T10:06:48Z", "author": {"login": "anton-vinogradov"}, "path": "modules/ducktests/tests/ignitetest/services/utils/control_utility.py", "diffHunk": "@@ -248,12 +311,15 @@ def __parse_cluster_state(output):\n \n         return ClusterState(state=state, topology_version=topology, baseline=baseline)\n \n-    def __run(self, cmd):\n-        node = random.choice(self.__alives())\n+    def __run(self, cmd, node=None):\n+        if node is None:\n+            node = random.choice(self.__alives())\n \n         self.logger.debug(f\"Run command {cmd} on node {node.name}\")\n \n-        raw_output = node.account.ssh_capture(self.__form_cmd(node, cmd), allow_fail=True)\n+        node_ip = socket.gethostbyname(node.account.hostname)", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "0878384ba0cbb60158abdc3bcb83fa6c1ee7f180"}, "originalPosition": 95}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0OTY0NjAxMA==", "bodyText": "please explain the changes", "url": "https://github.com/apache/ignite/pull/8575#discussion_r549646010", "createdAt": "2020-12-29T10:07:28Z", "author": {"login": "anton-vinogradov"}, "path": "modules/ducktests/tests/ignitetest/services/utils/jmx_utils.py", "diffHunk": "@@ -76,7 +76,7 @@ def find_mbean(self, pattern, domain='org.apache'):\n         :param domain: Domain of MBean\n         :return: JmxMBean instance\n         \"\"\"\n-        cmd = \"echo $'open %s\\\\n beans -d %s \\\\n close' | %s | grep -o '%s'\" \\\n+        cmd = \"echo $'open %s\\\\n beans -d %s \\\\n close' | %s | grep -o '.*%s$'\" \\", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "0878384ba0cbb60158abdc3bcb83fa6c1ee7f180"}, "originalPosition": 5}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0OTY0NjU0NQ==", "bodyText": "should this be defined at IgnitePathAware?", "url": "https://github.com/apache/ignite/pull/8575#discussion_r549646545", "createdAt": "2020-12-29T10:09:00Z", "author": {"login": "anton-vinogradov"}, "path": "modules/ducktests/tests/ignitetest/services/ignite.py", "diffHunk": "@@ -38,10 +38,47 @@ def __init__(self, context, config, num_nodes, jvm_opts=None, startup_timeout_se\n         super().__init__(context, config, num_nodes, startup_timeout_sec, shutdown_timeout_sec, modules=modules,\n                          jvm_opts=jvm_opts)\n \n+    @property\n+    def database_dir(self):", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "0878384ba0cbb60158abdc3bcb83fa6c1ee7f180"}, "originalPosition": 14}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0OTY0NjkyMQ==", "bodyText": "why this suite is slow? how about to make it fast?", "url": "https://github.com/apache/ignite/pull/8575#discussion_r549646921", "createdAt": "2020-12-29T10:10:12Z", "author": {"login": "anton-vinogradov"}, "path": "modules/ducktests/tests/ignitetest/tests/suites/slow_suite.yml", "diffHunk": "@@ -15,3 +15,6 @@\n \n discovery:\n   - ../discovery_test.py\n+\n+snapshot:\n+  - ../snapshot_test.py", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "0878384ba0cbb60158abdc3bcb83fa6c1ee7f180"}, "originalPosition": 6}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0OTY0NzEzMA==", "bodyText": "Why not LAST version used?", "url": "https://github.com/apache/ignite/pull/8575#discussion_r549647130", "createdAt": "2020-12-29T10:10:51Z", "author": {"login": "anton-vinogradov"}, "path": "modules/ducktests/tests/ignitetest/tests/snapshot_test.py", "diffHunk": "@@ -0,0 +1,119 @@\n+# Licensed to the Apache Software Foundation (ASF) under one or more\n+# contributor license agreements.  See the NOTICE file distributed with\n+# this work for additional information regarding copyright ownership.\n+# The ASF licenses this file to You under the Apache License, Version 2.0\n+# (the \"License\"); you may not use this file except in compliance with\n+# the License.  You may obtain a copy of the License at\n+#\n+#    http://www.apache.org/licenses/LICENSE-2.0\n+#\n+# Unless required by applicable law or agreed to in writing, software\n+# distributed under the License is distributed on an \"AS IS\" BASIS,\n+# WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+# See the License for the specific language governing permissions and\n+# limitations under the License.\n+\n+\"\"\"\n+Module contains snapshot test.\n+\"\"\"\n+from ducktape.mark.resource import cluster\n+\n+from ignitetest.services.ignite import IgniteService\n+from ignitetest.services.ignite_app import IgniteApplicationService\n+from ignitetest.services.utils.control_utility import ControlUtility\n+from ignitetest.services.utils.ignite_configuration import IgniteConfiguration, DataStorageConfiguration\n+from ignitetest.services.utils.ignite_configuration.cache import CacheConfiguration\n+from ignitetest.services.utils.ignite_configuration.data_storage import DataRegionConfiguration\n+from ignitetest.services.utils.ignite_configuration.discovery import from_ignite_cluster\n+from ignitetest.utils import ignite_versions\n+from ignitetest.utils.ignite_test import IgniteTest\n+from ignitetest.utils.version import IgniteVersion, V_2_9_0, DEV_BRANCH\n+\n+\n+# pylint: disable=W0223\n+class SnapshotTest(IgniteTest):\n+    \"\"\"\n+    Test Snapshot.\n+    \"\"\"\n+    NUM_NODES = 4\n+\n+    SNAPSHOT_NAME = \"test_snapshot\"\n+\n+    CACHE_NAME = \"TEST_CACHE\"\n+\n+    @cluster(num_nodes=NUM_NODES)\n+    @ignite_versions(str(DEV_BRANCH), str(V_2_9_0))", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "0878384ba0cbb60158abdc3bcb83fa6c1ee7f180"}, "originalPosition": 45}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0OTY0NzM4NQ==", "bodyText": "used only as default at @cluster", "url": "https://github.com/apache/ignite/pull/8575#discussion_r549647385", "createdAt": "2020-12-29T10:11:44Z", "author": {"login": "anton-vinogradov"}, "path": "modules/ducktests/tests/ignitetest/tests/snapshot_test.py", "diffHunk": "@@ -0,0 +1,119 @@\n+# Licensed to the Apache Software Foundation (ASF) under one or more\n+# contributor license agreements.  See the NOTICE file distributed with\n+# this work for additional information regarding copyright ownership.\n+# The ASF licenses this file to You under the Apache License, Version 2.0\n+# (the \"License\"); you may not use this file except in compliance with\n+# the License.  You may obtain a copy of the License at\n+#\n+#    http://www.apache.org/licenses/LICENSE-2.0\n+#\n+# Unless required by applicable law or agreed to in writing, software\n+# distributed under the License is distributed on an \"AS IS\" BASIS,\n+# WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+# See the License for the specific language governing permissions and\n+# limitations under the License.\n+\n+\"\"\"\n+Module contains snapshot test.\n+\"\"\"\n+from ducktape.mark.resource import cluster\n+\n+from ignitetest.services.ignite import IgniteService\n+from ignitetest.services.ignite_app import IgniteApplicationService\n+from ignitetest.services.utils.control_utility import ControlUtility\n+from ignitetest.services.utils.ignite_configuration import IgniteConfiguration, DataStorageConfiguration\n+from ignitetest.services.utils.ignite_configuration.cache import CacheConfiguration\n+from ignitetest.services.utils.ignite_configuration.data_storage import DataRegionConfiguration\n+from ignitetest.services.utils.ignite_configuration.discovery import from_ignite_cluster\n+from ignitetest.utils import ignite_versions\n+from ignitetest.utils.ignite_test import IgniteTest\n+from ignitetest.utils.version import IgniteVersion, V_2_9_0, DEV_BRANCH\n+\n+\n+# pylint: disable=W0223\n+class SnapshotTest(IgniteTest):\n+    \"\"\"\n+    Test Snapshot.\n+    \"\"\"\n+    NUM_NODES = 4", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "0878384ba0cbb60158abdc3bcb83fa6c1ee7f180"}, "originalPosition": 38}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0OTY0ODUzMw==", "bodyText": "any reason to have this variable?", "url": "https://github.com/apache/ignite/pull/8575#discussion_r549648533", "createdAt": "2020-12-29T10:15:21Z", "author": {"login": "anton-vinogradov"}, "path": "modules/ducktests/tests/ignitetest/tests/snapshot_test.py", "diffHunk": "@@ -0,0 +1,119 @@\n+# Licensed to the Apache Software Foundation (ASF) under one or more\n+# contributor license agreements.  See the NOTICE file distributed with\n+# this work for additional information regarding copyright ownership.\n+# The ASF licenses this file to You under the Apache License, Version 2.0\n+# (the \"License\"); you may not use this file except in compliance with\n+# the License.  You may obtain a copy of the License at\n+#\n+#    http://www.apache.org/licenses/LICENSE-2.0\n+#\n+# Unless required by applicable law or agreed to in writing, software\n+# distributed under the License is distributed on an \"AS IS\" BASIS,\n+# WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+# See the License for the specific language governing permissions and\n+# limitations under the License.\n+\n+\"\"\"\n+Module contains snapshot test.\n+\"\"\"\n+from ducktape.mark.resource import cluster\n+\n+from ignitetest.services.ignite import IgniteService\n+from ignitetest.services.ignite_app import IgniteApplicationService\n+from ignitetest.services.utils.control_utility import ControlUtility\n+from ignitetest.services.utils.ignite_configuration import IgniteConfiguration, DataStorageConfiguration\n+from ignitetest.services.utils.ignite_configuration.cache import CacheConfiguration\n+from ignitetest.services.utils.ignite_configuration.data_storage import DataRegionConfiguration\n+from ignitetest.services.utils.ignite_configuration.discovery import from_ignite_cluster\n+from ignitetest.utils import ignite_versions\n+from ignitetest.utils.ignite_test import IgniteTest\n+from ignitetest.utils.version import IgniteVersion, V_2_9_0, DEV_BRANCH\n+\n+\n+# pylint: disable=W0223\n+class SnapshotTest(IgniteTest):\n+    \"\"\"\n+    Test Snapshot.\n+    \"\"\"\n+    NUM_NODES = 4\n+\n+    SNAPSHOT_NAME = \"test_snapshot\"\n+\n+    CACHE_NAME = \"TEST_CACHE\"\n+\n+    @cluster(num_nodes=NUM_NODES)\n+    @ignite_versions(str(DEV_BRANCH), str(V_2_9_0))\n+    def snapshot_test(self, ignite_version):\n+        \"\"\"\n+        Basic snapshot test.\n+        \"\"\"\n+        data_storage = DataStorageConfiguration(default=DataRegionConfiguration(persistent=True))", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "0878384ba0cbb60158abdc3bcb83fa6c1ee7f180"}, "originalPosition": 50}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0OTY0ODgzMg==", "bodyText": "any reason to have this variable?", "url": "https://github.com/apache/ignite/pull/8575#discussion_r549648832", "createdAt": "2020-12-29T10:16:16Z", "author": {"login": "anton-vinogradov"}, "path": "modules/ducktests/tests/ignitetest/tests/snapshot_test.py", "diffHunk": "@@ -0,0 +1,119 @@\n+# Licensed to the Apache Software Foundation (ASF) under one or more\n+# contributor license agreements.  See the NOTICE file distributed with\n+# this work for additional information regarding copyright ownership.\n+# The ASF licenses this file to You under the Apache License, Version 2.0\n+# (the \"License\"); you may not use this file except in compliance with\n+# the License.  You may obtain a copy of the License at\n+#\n+#    http://www.apache.org/licenses/LICENSE-2.0\n+#\n+# Unless required by applicable law or agreed to in writing, software\n+# distributed under the License is distributed on an \"AS IS\" BASIS,\n+# WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+# See the License for the specific language governing permissions and\n+# limitations under the License.\n+\n+\"\"\"\n+Module contains snapshot test.\n+\"\"\"\n+from ducktape.mark.resource import cluster\n+\n+from ignitetest.services.ignite import IgniteService\n+from ignitetest.services.ignite_app import IgniteApplicationService\n+from ignitetest.services.utils.control_utility import ControlUtility\n+from ignitetest.services.utils.ignite_configuration import IgniteConfiguration, DataStorageConfiguration\n+from ignitetest.services.utils.ignite_configuration.cache import CacheConfiguration\n+from ignitetest.services.utils.ignite_configuration.data_storage import DataRegionConfiguration\n+from ignitetest.services.utils.ignite_configuration.discovery import from_ignite_cluster\n+from ignitetest.utils import ignite_versions\n+from ignitetest.utils.ignite_test import IgniteTest\n+from ignitetest.utils.version import IgniteVersion, V_2_9_0, DEV_BRANCH\n+\n+\n+# pylint: disable=W0223\n+class SnapshotTest(IgniteTest):\n+    \"\"\"\n+    Test Snapshot.\n+    \"\"\"\n+    NUM_NODES = 4\n+\n+    SNAPSHOT_NAME = \"test_snapshot\"\n+\n+    CACHE_NAME = \"TEST_CACHE\"\n+\n+    @cluster(num_nodes=NUM_NODES)\n+    @ignite_versions(str(DEV_BRANCH), str(V_2_9_0))\n+    def snapshot_test(self, ignite_version):\n+        \"\"\"\n+        Basic snapshot test.\n+        \"\"\"\n+        data_storage = DataStorageConfiguration(default=DataRegionConfiguration(persistent=True))\n+\n+        ignite_config = IgniteConfiguration(\n+            version=IgniteVersion(ignite_version),\n+            data_storage=data_storage,\n+            metric_exporter='org.apache.ignite.spi.metric.jmx.JmxMetricExporterSpi',\n+            caches=[CacheConfiguration(name=self.CACHE_NAME, cache_mode='REPLICATED',\n+                                       indexed_types=['java.util.UUID', 'byte[]'])]\n+        )\n+\n+        num_nodes = len(self.test_context.cluster)", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "0878384ba0cbb60158abdc3bcb83fa6c1ee7f180"}, "originalPosition": 60}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0OTY0OTI4Ng==", "bodyText": "why it may take so long time to startup?", "url": "https://github.com/apache/ignite/pull/8575#discussion_r549649286", "createdAt": "2020-12-29T10:17:45Z", "author": {"login": "anton-vinogradov"}, "path": "modules/ducktests/tests/ignitetest/tests/snapshot_test.py", "diffHunk": "@@ -0,0 +1,119 @@\n+# Licensed to the Apache Software Foundation (ASF) under one or more\n+# contributor license agreements.  See the NOTICE file distributed with\n+# this work for additional information regarding copyright ownership.\n+# The ASF licenses this file to You under the Apache License, Version 2.0\n+# (the \"License\"); you may not use this file except in compliance with\n+# the License.  You may obtain a copy of the License at\n+#\n+#    http://www.apache.org/licenses/LICENSE-2.0\n+#\n+# Unless required by applicable law or agreed to in writing, software\n+# distributed under the License is distributed on an \"AS IS\" BASIS,\n+# WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+# See the License for the specific language governing permissions and\n+# limitations under the License.\n+\n+\"\"\"\n+Module contains snapshot test.\n+\"\"\"\n+from ducktape.mark.resource import cluster\n+\n+from ignitetest.services.ignite import IgniteService\n+from ignitetest.services.ignite_app import IgniteApplicationService\n+from ignitetest.services.utils.control_utility import ControlUtility\n+from ignitetest.services.utils.ignite_configuration import IgniteConfiguration, DataStorageConfiguration\n+from ignitetest.services.utils.ignite_configuration.cache import CacheConfiguration\n+from ignitetest.services.utils.ignite_configuration.data_storage import DataRegionConfiguration\n+from ignitetest.services.utils.ignite_configuration.discovery import from_ignite_cluster\n+from ignitetest.utils import ignite_versions\n+from ignitetest.utils.ignite_test import IgniteTest\n+from ignitetest.utils.version import IgniteVersion, V_2_9_0, DEV_BRANCH\n+\n+\n+# pylint: disable=W0223\n+class SnapshotTest(IgniteTest):\n+    \"\"\"\n+    Test Snapshot.\n+    \"\"\"\n+    NUM_NODES = 4\n+\n+    SNAPSHOT_NAME = \"test_snapshot\"\n+\n+    CACHE_NAME = \"TEST_CACHE\"\n+\n+    @cluster(num_nodes=NUM_NODES)\n+    @ignite_versions(str(DEV_BRANCH), str(V_2_9_0))\n+    def snapshot_test(self, ignite_version):\n+        \"\"\"\n+        Basic snapshot test.\n+        \"\"\"\n+        data_storage = DataStorageConfiguration(default=DataRegionConfiguration(persistent=True))\n+\n+        ignite_config = IgniteConfiguration(\n+            version=IgniteVersion(ignite_version),\n+            data_storage=data_storage,\n+            metric_exporter='org.apache.ignite.spi.metric.jmx.JmxMetricExporterSpi',\n+            caches=[CacheConfiguration(name=self.CACHE_NAME, cache_mode='REPLICATED',\n+                                       indexed_types=['java.util.UUID', 'byte[]'])]\n+        )\n+\n+        num_nodes = len(self.test_context.cluster)\n+\n+        service = IgniteService(self.test_context, ignite_config, num_nodes=num_nodes - 1, startup_timeout_sec=180)", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "0878384ba0cbb60158abdc3bcb83fa6c1ee7f180"}, "originalPosition": 62}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0OTY0OTgzNQ==", "bodyText": "why it is assigned here but the next code line does not use it?", "url": "https://github.com/apache/ignite/pull/8575#discussion_r549649835", "createdAt": "2020-12-29T10:19:26Z", "author": {"login": "anton-vinogradov"}, "path": "modules/ducktests/tests/ignitetest/tests/snapshot_test.py", "diffHunk": "@@ -0,0 +1,119 @@\n+# Licensed to the Apache Software Foundation (ASF) under one or more\n+# contributor license agreements.  See the NOTICE file distributed with\n+# this work for additional information regarding copyright ownership.\n+# The ASF licenses this file to You under the Apache License, Version 2.0\n+# (the \"License\"); you may not use this file except in compliance with\n+# the License.  You may obtain a copy of the License at\n+#\n+#    http://www.apache.org/licenses/LICENSE-2.0\n+#\n+# Unless required by applicable law or agreed to in writing, software\n+# distributed under the License is distributed on an \"AS IS\" BASIS,\n+# WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+# See the License for the specific language governing permissions and\n+# limitations under the License.\n+\n+\"\"\"\n+Module contains snapshot test.\n+\"\"\"\n+from ducktape.mark.resource import cluster\n+\n+from ignitetest.services.ignite import IgniteService\n+from ignitetest.services.ignite_app import IgniteApplicationService\n+from ignitetest.services.utils.control_utility import ControlUtility\n+from ignitetest.services.utils.ignite_configuration import IgniteConfiguration, DataStorageConfiguration\n+from ignitetest.services.utils.ignite_configuration.cache import CacheConfiguration\n+from ignitetest.services.utils.ignite_configuration.data_storage import DataRegionConfiguration\n+from ignitetest.services.utils.ignite_configuration.discovery import from_ignite_cluster\n+from ignitetest.utils import ignite_versions\n+from ignitetest.utils.ignite_test import IgniteTest\n+from ignitetest.utils.version import IgniteVersion, V_2_9_0, DEV_BRANCH\n+\n+\n+# pylint: disable=W0223\n+class SnapshotTest(IgniteTest):\n+    \"\"\"\n+    Test Snapshot.\n+    \"\"\"\n+    NUM_NODES = 4\n+\n+    SNAPSHOT_NAME = \"test_snapshot\"\n+\n+    CACHE_NAME = \"TEST_CACHE\"\n+\n+    @cluster(num_nodes=NUM_NODES)\n+    @ignite_versions(str(DEV_BRANCH), str(V_2_9_0))\n+    def snapshot_test(self, ignite_version):\n+        \"\"\"\n+        Basic snapshot test.\n+        \"\"\"\n+        data_storage = DataStorageConfiguration(default=DataRegionConfiguration(persistent=True))\n+\n+        ignite_config = IgniteConfiguration(\n+            version=IgniteVersion(ignite_version),\n+            data_storage=data_storage,\n+            metric_exporter='org.apache.ignite.spi.metric.jmx.JmxMetricExporterSpi',\n+            caches=[CacheConfiguration(name=self.CACHE_NAME, cache_mode='REPLICATED',\n+                                       indexed_types=['java.util.UUID', 'byte[]'])]\n+        )\n+\n+        num_nodes = len(self.test_context.cluster)\n+\n+        service = IgniteService(self.test_context, ignite_config, num_nodes=num_nodes - 1, startup_timeout_sec=180)\n+        service.start()\n+\n+        control_utility = ControlUtility(service, self.test_context)\n+        control_utility.activate()\n+\n+        client_config = IgniteConfiguration(\n+            client_mode=True,\n+            version=IgniteVersion(ignite_version),\n+            discovery_spi=from_ignite_cluster(service),\n+        )\n+\n+        loader = IgniteApplicationService(\n+            self.test_context,\n+            client_config,\n+            java_class_name=\"org.apache.ignite.internal.ducktest.tests.snapshot_test.UuidDataLoaderApplication\",\n+            params={\n+                \"cacheName\": self.CACHE_NAME,\n+                \"size\": 512 * 1024,\n+                \"dataSize\": 1024\n+            },\n+            startup_timeout_sec=180,\n+            shutdown_timeout_sec=300\n+        )\n+\n+        loader.run()\n+\n+        node = service.nodes[0]", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "0878384ba0cbb60158abdc3bcb83fa6c1ee7f180"}, "originalPosition": 89}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0OTY1MDE3Nw==", "bodyText": "Why it streams UUID as a key?", "url": "https://github.com/apache/ignite/pull/8575#discussion_r549650177", "createdAt": "2020-12-29T10:20:40Z", "author": {"login": "anton-vinogradov"}, "path": "modules/ducktests/src/main/java/org/apache/ignite/internal/ducktest/tests/snapshot_test/UuidDataLoaderApplication.java", "diffHunk": "@@ -0,0 +1,46 @@\n+/*\n+ * Licensed to the Apache Software Foundation (ASF) under one or more\n+ * contributor license agreements.  See the NOTICE file distributed with\n+ * this work for additional information regarding copyright ownership.\n+ * The ASF licenses this file to You under the Apache License, Version 2.0\n+ * (the \"License\"); you may not use this file except in compliance with\n+ * the License.  You may obtain a copy of the License at\n+ *\n+ *      http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package org.apache.ignite.internal.ducktest.tests.snapshot_test;\n+\n+import java.util.UUID;\n+import com.fasterxml.jackson.databind.JsonNode;\n+import org.apache.ignite.IgniteDataStreamer;\n+import org.apache.ignite.internal.ducktest.utils.IgniteAwareApplication;\n+\n+/**\n+ * Loading random uuids to cache.\n+ */\n+public class UuidDataLoaderApplication extends IgniteAwareApplication {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "0878384ba0cbb60158abdc3bcb83fa6c1ee7f180"}, "originalPosition": 28}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0OTY1MDg2Nw==", "bodyText": "it performs \"mv\" but has the \"rename*\" name...", "url": "https://github.com/apache/ignite/pull/8575#discussion_r549650867", "createdAt": "2020-12-29T10:22:55Z", "author": {"login": "anton-vinogradov"}, "path": "modules/ducktests/tests/ignitetest/services/ignite.py", "diffHunk": "@@ -38,10 +38,47 @@ def __init__(self, context, config, num_nodes, jvm_opts=None, startup_timeout_se\n         super().__init__(context, config, num_nodes, startup_timeout_sec, shutdown_timeout_sec, modules=modules,\n                          jvm_opts=jvm_opts)\n \n+    @property\n+    def database_dir(self):\n+        \"\"\"\n+        :return: path to database directory\n+        \"\"\"\n+        return os.path.join(self.work_dir, \"db\")\n+\n+    @property\n+    def snapshots_dir(self):\n+        \"\"\"\n+        :return: path to snapshots directory\n+        \"\"\"\n+        return os.path.join(self.work_dir, \"snapshots\")\n+\n     def clean_node(self, node):\n         node.account.kill_java_processes(self.APP_SERVICE_CLASS, clean_shutdown=False, allow_fail=True)\n         node.account.ssh(\"rm -rf -- %s\" % self.persistent_root, allow_fail=False)\n \n+    def rename_database(self, new_name: str):", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "0878384ba0cbb60158abdc3bcb83fa6c1ee7f180"}, "originalPosition": 31}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "de69f734f7e19c6da58616aec987c5f762cfab1e", "author": {"user": {"login": "Sega76", "name": "Sergei Ryzhov"}}, "url": "https://github.com/apache/ignite/commit/de69f734f7e19c6da58616aec987c5f762cfab1e", "committedDate": "2020-12-30T12:13:05Z", "message": "IGNITE-13492: fix comments"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "6879d9966195ea2805571794d8f0b61db8bf6369", "author": {"user": {"login": "Sega76", "name": "Sergei Ryzhov"}}, "url": "https://github.com/apache/ignite/commit/6879d9966195ea2805571794d8f0b61db8bf6369", "committedDate": "2020-12-30T12:17:23Z", "message": "IGNITE-13492: fix comments"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "45ac12509081427332b529646b2a0662e2b847b8", "author": {"user": {"login": "Sega76", "name": "Sergei Ryzhov"}}, "url": "https://github.com/apache/ignite/commit/45ac12509081427332b529646b2a0662e2b847b8", "committedDate": "2021-01-11T13:58:04Z", "message": "IGNITE-13492: fix comments"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "0482fb00d0bacb3213ddebc1efdab9f57183cdeb", "author": {"user": {"login": "Sega76", "name": "Sergei Ryzhov"}}, "url": "https://github.com/apache/ignite/commit/0482fb00d0bacb3213ddebc1efdab9f57183cdeb", "committedDate": "2021-01-11T15:55:08Z", "message": "IGNITE-13492: fix comments"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e820a1971c06364af1184c28acaf0fa703e79e44", "author": {"user": {"login": "Sega76", "name": "Sergei Ryzhov"}}, "url": "https://github.com/apache/ignite/commit/e820a1971c06364af1184c28acaf0fa703e79e44", "committedDate": "2021-01-11T17:16:12Z", "message": "IGNITE-13492: fix comments"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "29f8cf63d7633d43cf8c62d4303ae917cea91bbc", "author": {"user": {"login": "Sega76", "name": "Sergei Ryzhov"}}, "url": "https://github.com/apache/ignite/commit/29f8cf63d7633d43cf8c62d4303ae917cea91bbc", "committedDate": "2021-01-20T10:47:17Z", "message": "IGNITE-13492: fix comments"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTcyMDk2MTYx", "url": "https://github.com/apache/ignite/pull/8575#pullrequestreview-572096161", "createdAt": "2021-01-20T10:49:01Z", "commit": {"oid": "29f8cf63d7633d43cf8c62d4303ae917cea91bbc"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "9b065073014837b567a44fc32b2214ba51ee339d", "author": {"user": {"login": "Sega76", "name": "Sergei Ryzhov"}}, "url": "https://github.com/apache/ignite/commit/9b065073014837b567a44fc32b2214ba51ee339d", "committedDate": "2021-01-23T01:39:11Z", "message": "IGNITE-13492: fix comments"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "31dc3538ba3308bfd3af504bee327d8394aba103", "author": {"user": {"login": "Sega76", "name": "Sergei Ryzhov"}}, "url": "https://github.com/apache/ignite/commit/31dc3538ba3308bfd3af504bee327d8394aba103", "committedDate": "2021-01-23T18:49:01Z", "message": "IGNITE-13492: tests"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "018c2174d63de97426437a55d748fc48f7d00566", "author": {"user": {"login": "Sega76", "name": "Sergei Ryzhov"}}, "url": "https://github.com/apache/ignite/commit/018c2174d63de97426437a55d748fc48f7d00566", "committedDate": "2021-01-24T13:40:29Z", "message": "IGNITE-13492: test"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "d645002f2bb753a816cc39366b52ab957369b2dc", "author": {"user": {"login": "Sega76", "name": "Sergei Ryzhov"}}, "url": "https://github.com/apache/ignite/commit/d645002f2bb753a816cc39366b52ab957369b2dc", "committedDate": "2021-01-24T15:33:51Z", "message": "IGNITE-13492: test"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ea2faf518cc007a716f4c116c65e58539b4ed275", "author": {"user": {"login": "Sega76", "name": "Sergei Ryzhov"}}, "url": "https://github.com/apache/ignite/commit/ea2faf518cc007a716f4c116c65e58539b4ed275", "committedDate": "2021-01-24T15:34:45Z", "message": "IGNITE-13492: test"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "98ef3704e54583b61322fed903769553390ec6c6", "author": {"user": {"login": "Sega76", "name": "Sergei Ryzhov"}}, "url": "https://github.com/apache/ignite/commit/98ef3704e54583b61322fed903769553390ec6c6", "committedDate": "2021-01-24T16:38:00Z", "message": "IGNITE-13492: test"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "588f8ea8de97c018e76b3cc83c9d9042c1fcd53b", "author": {"user": {"login": "Sega76", "name": "Sergei Ryzhov"}}, "url": "https://github.com/apache/ignite/commit/588f8ea8de97c018e76b3cc83c9d9042c1fcd53b", "committedDate": "2021-01-25T10:29:32Z", "message": "IGNITE-13492: fixed DataLoaderApplication for snapshot test"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "745cc20e16c72740274518946244301ab4247343", "author": {"user": {"login": "Sega76", "name": "Sergei Ryzhov"}}, "url": "https://github.com/apache/ignite/commit/745cc20e16c72740274518946244301ab4247343", "committedDate": "2021-01-25T10:53:14Z", "message": "IGNITE-13492: little fix"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c69702a43a4dbe505a0e010f561868ed51d6b9b4", "author": {"user": {"login": "Sega76", "name": "Sergei Ryzhov"}}, "url": "https://github.com/apache/ignite/commit/c69702a43a4dbe505a0e010f561868ed51d6b9b4", "committedDate": "2021-01-25T20:29:48Z", "message": "IGNITE-13492: little fix"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c9cb0422ada0493ba6e14845db69ef1d8c7bab8a", "author": {"user": {"login": "Sega76", "name": "Sergei Ryzhov"}}, "url": "https://github.com/apache/ignite/commit/c9cb0422ada0493ba6e14845db69ef1d8c7bab8a", "committedDate": "2021-01-26T12:14:02Z", "message": "IGNITE-13492: fix licenses"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "d1ffa434027f55f271ce6496a1ab52dd0fdf598b", "author": {"user": {"login": "Sega76", "name": "Sergei Ryzhov"}}, "url": "https://github.com/apache/ignite/commit/d1ffa434027f55f271ce6496a1ab52dd0fdf598b", "committedDate": "2021-01-26T19:41:45Z", "message": "Merge remote-tracking branch 'ignite/ignite-ducktape' into IGNITE-13492v1\n\n# Conflicts:\n#\tmodules/ducktests/tests/ignitetest/services/ignite.py"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e2d15a33bbb9dd9a904253f1ab56c19e59efa57a", "author": {"user": {"login": "Sega76", "name": "Sergei Ryzhov"}}, "url": "https://github.com/apache/ignite/commit/e2d15a33bbb9dd9a904253f1ab56c19e59efa57a", "committedDate": "2021-01-27T12:33:00Z", "message": "IGNITE-13492: little fix"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "794839341db4732313f6be11e05200b3ae5a03c2", "author": {"user": {"login": "Sega76", "name": "Sergei Ryzhov"}}, "url": "https://github.com/apache/ignite/commit/794839341db4732313f6be11e05200b3ae5a03c2", "committedDate": "2021-01-28T00:01:26Z", "message": "IGNITE-13492: little fix"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "2a21c89c6885a82e683b278ae50d59467eb3adb0", "author": {"user": {"login": "Sega76", "name": "Sergei Ryzhov"}}, "url": "https://github.com/apache/ignite/commit/2a21c89c6885a82e683b278ae50d59467eb3adb0", "committedDate": "2021-02-01T18:38:13Z", "message": "IGNITE-13492: fixed modules"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "17035fe602e793c22f3fcef82a044127eee6ac0a", "author": {"user": {"login": "Sega76", "name": "Sergei Ryzhov"}}, "url": "https://github.com/apache/ignite/commit/17035fe602e793c22f3fcef82a044127eee6ac0a", "committedDate": "2021-02-04T22:27:05Z", "message": "IGNITE-13492: fixed classpath for ignite-dev"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ba0e934250bbfd7ece28ca1209c3cb2c7ecac1b3", "author": {"user": {"login": "Sega76", "name": "Sergei Ryzhov"}}, "url": "https://github.com/apache/ignite/commit/ba0e934250bbfd7ece28ca1209c3cb2c7ecac1b3", "committedDate": "2021-02-04T22:43:24Z", "message": "IGNITE-13492: little fix"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "78e5f6dc368e680ab87c9e868011db69ae2e5ef5", "author": {"user": {"login": "Sega76", "name": "Sergei Ryzhov"}}, "url": "https://github.com/apache/ignite/commit/78e5f6dc368e680ab87c9e868011db69ae2e5ef5", "committedDate": "2021-02-05T08:21:42Z", "message": "Merge remote-tracking branch 'ignite/ignite-ducktape' into IGNITE-13492v1\n\n# Conflicts:\n#\tmodules/ducktests/tests/ignitetest/services/utils/control_utility.py\n#\tmodules/ducktests/tests/ignitetest/services/utils/ignite_configuration/__init__.py\n#\tmodules/ducktests/tests/ignitetest/services/utils/path.py"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "2e24c15f1431632ef9ffbe11d706d3818413080f", "author": {"user": {"login": "Sega76", "name": "Sergei Ryzhov"}}, "url": "https://github.com/apache/ignite/commit/2e24c15f1431632ef9ffbe11d706d3818413080f", "committedDate": "2021-02-05T08:28:23Z", "message": "IGNITE-13492: fixed zookeeper dependencies"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c55aefd8fa173efeeee65044c20dbf4d192a63ec", "author": {"user": {"login": "Sega76", "name": "Sergei Ryzhov"}}, "url": "https://github.com/apache/ignite/commit/c55aefd8fa173efeeee65044c20dbf4d192a63ec", "committedDate": "2021-02-08T18:42:47Z", "message": "IGNITE-13492: revert build-classpath.sh"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "d9920bd4ceaf48373ffaff206a7adc3bf8d65029", "author": {"user": {"login": "Sega76", "name": "Sergei Ryzhov"}}, "url": "https://github.com/apache/ignite/commit/d9920bd4ceaf48373ffaff206a7adc3bf8d65029", "committedDate": "2021-02-09T12:51:14Z", "message": "Merge remote-tracking branch 'ignite/ignite-ducktape' into IGNITE-13492v1"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a6b15a5be97b476750311e623a5b27d7b4cf51a3", "author": {"user": {"login": "Sega76", "name": "Sergei Ryzhov"}}, "url": "https://github.com/apache/ignite/commit/a6b15a5be97b476750311e623a5b27d7b4cf51a3", "committedDate": "2021-02-09T12:53:44Z", "message": "IGNITE-13492: added envs EXCLUDE_MODULES to snapshot_test.py"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "f8a09775025c1eca500d9f30346f5f43341fc6a3", "author": {"user": {"login": "Sega76", "name": "Sergei Ryzhov"}}, "url": "https://github.com/apache/ignite/commit/f8a09775025c1eca500d9f30346f5f43341fc6a3", "committedDate": "2021-02-09T06:19:21Z", "message": "IGNITE-13492: fixed for tests"}, "afterCommit": {"oid": "a6b15a5be97b476750311e623a5b27d7b4cf51a3", "author": {"user": {"login": "Sega76", "name": "Sergei Ryzhov"}}, "url": "https://github.com/apache/ignite/commit/a6b15a5be97b476750311e623a5b27d7b4cf51a3", "committedDate": "2021-02-09T12:53:44Z", "message": "IGNITE-13492: added envs EXCLUDE_MODULES to snapshot_test.py"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e7480db51bae1c44e99735d745ad9b856226755e", "author": {"user": {"login": "Sega76", "name": "Sergei Ryzhov"}}, "url": "https://github.com/apache/ignite/commit/e7480db51bae1c44e99735d745ad9b856226755e", "committedDate": "2021-02-10T08:10:01Z", "message": "IGNITE-13492: fix exclude for control_utility"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "0f27a9a758ab8afe2237580270782935aa399aed", "author": {"user": {"login": "Sega76", "name": "Sergei Ryzhov"}}, "url": "https://github.com/apache/ignite/commit/0f27a9a758ab8afe2237580270782935aa399aed", "committedDate": "2021-02-10T10:07:11Z", "message": "IGNITE-13492: fix comments"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTc4MzA5NTEy", "url": "https://github.com/apache/ignite/pull/8575#pullrequestreview-578309512", "createdAt": "2021-01-28T13:03:36Z", "commit": {"oid": "794839341db4732313f6be11e05200b3ae5a03c2"}, "state": "APPROVED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wMS0yOFQxMzowMzozNlrOIb2mPQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wMS0yOFQxMzowMzozNlrOIb2mPQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU2NjA3Njk4OQ==", "bodyText": "valueSizeKb is better imho", "url": "https://github.com/apache/ignite/pull/8575#discussion_r566076989", "createdAt": "2021-01-28T13:03:36Z", "author": {"login": "ivandasch"}, "path": "modules/ducktests/tests/ignitetest/tests/snapshot_test.py", "diffHunk": "@@ -0,0 +1,108 @@\n+# Licensed to the Apache Software Foundation (ASF) under one or more\n+# contributor license agreements.  See the NOTICE file distributed with\n+# this work for additional information regarding copyright ownership.\n+# The ASF licenses this file to You under the Apache License, Version 2.0\n+# (the \"License\"); you may not use this file except in compliance with\n+# the License.  You may obtain a copy of the License at\n+#\n+#    http://www.apache.org/licenses/LICENSE-2.0\n+#\n+# Unless required by applicable law or agreed to in writing, software\n+# distributed under the License is distributed on an \"AS IS\" BASIS,\n+# WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+# See the License for the specific language governing permissions and\n+# limitations under the License.\n+\n+\"\"\"\n+Module contains snapshot test.\n+\"\"\"\n+from ducktape.mark.resource import cluster\n+\n+from ignitetest.services.ignite import IgniteService\n+from ignitetest.services.ignite_app import IgniteApplicationService\n+from ignitetest.services.utils.control_utility import ControlUtility\n+from ignitetest.services.utils.ignite_configuration import IgniteConfiguration, DataStorageConfiguration\n+from ignitetest.services.utils.ignite_configuration.data_storage import DataRegionConfiguration\n+from ignitetest.services.utils.ignite_configuration.discovery import from_ignite_cluster\n+from ignitetest.utils import ignite_versions\n+from ignitetest.utils.ignite_test import IgniteTest\n+from ignitetest.utils.version import IgniteVersion, DEV_BRANCH, LATEST_2_9\n+\n+\n+# pylint: disable=W0223\n+class SnapshotTest(IgniteTest):\n+    \"\"\"\n+    Test Snapshot.\n+    \"\"\"\n+    SNAPSHOT_NAME = \"test_snapshot\"\n+\n+    CACHE_NAME = \"TEST_CACHE\"\n+\n+    @cluster(num_nodes=4)\n+    @ignite_versions(str(DEV_BRANCH), str(LATEST_2_9))\n+    def snapshot_test(self, ignite_version):\n+        \"\"\"\n+        Basic snapshot test.\n+        \"\"\"\n+        ignite_config = IgniteConfiguration(\n+            version=IgniteVersion(ignite_version),\n+            data_storage=DataStorageConfiguration(default=DataRegionConfiguration(persistent=True)),\n+            metric_exporter='org.apache.ignite.spi.metric.jmx.JmxMetricExporterSpi'\n+        )\n+\n+        service = IgniteService(self.test_context, ignite_config, num_nodes=len(self.test_context.cluster) - 1)\n+        service.start()\n+\n+        control_utility = ControlUtility(service, self.test_context)\n+        control_utility.activate()\n+\n+        client_config = IgniteConfiguration(\n+            client_mode=True,\n+            version=IgniteVersion(ignite_version),\n+            discovery_spi=from_ignite_cluster(service)\n+        )\n+\n+        loader = IgniteApplicationService(\n+            self.test_context,\n+            client_config,\n+            java_class_name=\"org.apache.ignite.internal.ducktest.tests.snapshot_test.DataLoaderApplication\",\n+            shutdown_timeout_sec=300,\n+            params={\n+                \"cacheName\": self.CACHE_NAME,\n+                \"interval\": 500_000,\n+                \"dataSizeKB\": 1", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "794839341db4732313f6be11e05200b3ae5a03c2"}, "originalPosition": 73}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "46544e84b34f753271b0c7b63dcd553a73b6be3e", "author": {"user": {"login": "Sega76", "name": "Sergei Ryzhov"}}, "url": "https://github.com/apache/ignite/commit/46544e84b34f753271b0c7b63dcd553a73b6be3e", "committedDate": "2021-02-10T12:25:48Z", "message": "IGNITE-13492: added comment to exclude modules"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "fd6f2fe58e82dcecff18c64137619fbf810d634e", "author": {"user": {"login": "Sega76", "name": "Sergei Ryzhov"}}, "url": "https://github.com/apache/ignite/commit/fd6f2fe58e82dcecff18c64137619fbf810d634e", "committedDate": "2021-02-10T13:02:10Z", "message": "IGNITE-13492: fix comments"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f19e155a85599c16c9343ac3a5d55a13fd1d906d", "author": {"user": {"login": "Sega76", "name": "Sergei Ryzhov"}}, "url": "https://github.com/apache/ignite/commit/f19e155a85599c16c9343ac3a5d55a13fd1d906d", "committedDate": "2021-02-11T11:01:14Z", "message": "Merge remote-tracking branch 'ignite/ignite-ducktape' into IGNITE-13492v1"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "95a7f8a48da5293f398087e24f9da65f5f73de07", "author": {"user": {"login": "Sega76", "name": "Sergei Ryzhov"}}, "url": "https://github.com/apache/ignite/commit/95a7f8a48da5293f398087e24f9da65f5f73de07", "committedDate": "2021-02-16T10:02:18Z", "message": "IGNITE-13492: fix comments"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "0eee25f0df332b85db96e82b2022c1e5ad1ff749", "author": {"user": {"login": "Sega76", "name": "Sergei Ryzhov"}}, "url": "https://github.com/apache/ignite/commit/0eee25f0df332b85db96e82b2022c1e5ad1ff749", "committedDate": "2021-02-16T14:18:24Z", "message": "IGNITE-13492: fix comments"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ade936e55541c44d92109ee731fc684349f49c5f", "author": {"user": {"login": "Sega76", "name": "Sergei Ryzhov"}}, "url": "https://github.com/apache/ignite/commit/ade936e55541c44d92109ee731fc684349f49c5f", "committedDate": "2021-02-17T11:28:18Z", "message": "IGNITE-13492: fix comments"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e99c6796e99a2079ed81a3d1c6c9bab28f000520", "author": {"user": {"login": "Sega76", "name": "Sergei Ryzhov"}}, "url": "https://github.com/apache/ignite/commit/e99c6796e99a2079ed81a3d1c6c9bab28f000520", "committedDate": "2021-02-17T12:34:21Z", "message": "IGNITE-13492: rollback envs"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "2bbee664e66da84d8ce8294e326c56eb916ae358", "author": {"user": {"login": "Sega76", "name": "Sergei Ryzhov"}}, "url": "https://github.com/apache/ignite/commit/2bbee664e66da84d8ce8294e326c56eb916ae358", "committedDate": "2021-02-17T12:34:35Z", "message": "Merge remote-tracking branch 'ignite/ignite-ducktape' into IGNITE-13492v1"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "35721c7ba0e78b881201e4510045f66a907699fb", "author": {"user": {"login": "Sega76", "name": "Sergei Ryzhov"}}, "url": "https://github.com/apache/ignite/commit/35721c7ba0e78b881201e4510045f66a907699fb", "committedDate": "2021-02-17T13:09:48Z", "message": "IGNITE-13492: little fix"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ce9a9c67100a9d0f3e09923eb6b76b2ecfd4ebb0", "author": {"user": {"login": "Sega76", "name": "Sergei Ryzhov"}}, "url": "https://github.com/apache/ignite/commit/ce9a9c67100a9d0f3e09923eb6b76b2ecfd4ebb0", "committedDate": "2021-02-17T16:09:23Z", "message": "IGNITE-13492: fix comments"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c6b89cbcb3ff65e42c31c7b739d5f60879c29fa2", "author": {"user": {"login": "Sega76", "name": "Sergei Ryzhov"}}, "url": "https://github.com/apache/ignite/commit/c6b89cbcb3ff65e42c31c7b739d5f60879c29fa2", "committedDate": "2021-02-17T16:41:06Z", "message": "IGNITE-13492: little fix"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "d1d635f23cf3e07a775ceed269f08f8b20c72eb8", "author": {"user": {"login": "Sega76", "name": "Sergei Ryzhov"}}, "url": "https://github.com/apache/ignite/commit/d1d635f23cf3e07a775ceed269f08f8b20c72eb8", "committedDate": "2021-02-18T20:20:41Z", "message": "IGNITE-13492: fix comments"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "df4a5e105ae19028d52dc03b4575e6ee0c2d5e3b", "author": {"user": {"login": "Sega76", "name": "Sergei Ryzhov"}}, "url": "https://github.com/apache/ignite/commit/df4a5e105ae19028d52dc03b4575e6ee0c2d5e3b", "committedDate": "2021-02-19T08:45:51Z", "message": "IGNITE-13492: fix check index.bin size"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "7e7adce6a854d765ee5d9d38f533dd08456c0451", "author": {"user": {"login": "Sega76", "name": "Sergei Ryzhov"}}, "url": "https://github.com/apache/ignite/commit/7e7adce6a854d765ee5d9d38f533dd08456c0451", "committedDate": "2021-02-19T11:48:54Z", "message": "IGNITE-13492: fix comments"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2254, "cost": 1, "resetAt": "2021-10-29T19:57:52Z"}}}