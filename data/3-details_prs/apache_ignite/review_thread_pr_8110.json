{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDYwODkxMjAy", "number": 8110, "reviewThreads": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0wMlQxODo0MzowMFrOEUaF3w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0wNFQxODo1MjoyOFrOEVICWA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjg5ODM0NDYzOnYy", "diffSide": "RIGHT", "path": "modules/platforms/dotnet/Apache.Ignite.Core.Tests/Binary/EnumsTest.cs", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0wMlQxODo0MzowMFrOG6nBuQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0wM1QwNjo0NDoxN1rOG6t46Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NDExMDAwOQ==", "bodyText": "Optional: it looks like we need to check this:\nAssert.AreSame(binRes.GetBinaryType().GetEnumValues(), binRes.GetBinaryType().GetEnumValues())", "url": "https://github.com/apache/ignite/pull/8110#discussion_r464110009", "createdAt": "2020-08-02T18:43:00Z", "author": {"login": "ashapkin"}, "path": "modules/platforms/dotnet/Apache.Ignite.Core.Tests/Binary/EnumsTest.cs", "diffHunk": "@@ -85,6 +86,11 @@ private static void CheckValue<T>(T val, bool isBinaryEnum = true)\n                 {\n                     Assert.AreEqual(string.Format(\"{0} [typeId={1}, enumValue={2}, enumValueName={3}]\",\n                         typeof(T).FullName, binRes.GetBinaryType().TypeId, binRes.EnumValue, val), binRes.ToString());\n+\n+                    var expectedEnumNames = Enum.GetValues(typeof(T)).OfType<T>().Select(x => x.ToString()).ToList();\n+                    var actualEnumNames = binRes.GetBinaryType().GetEnumValues().Select(v => v.EnumName).ToList();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "7c687a5b19dce97a9ee8d5732e92ae305d823a9d"}, "originalPosition": 14}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NDIyMjQ0MQ==", "bodyText": "I think I understand what you mean - since we cache enum values, we should always return the same collection. However, other nodes may have more values for the same enum (e.g. a newer code version). So the cache we introduced in this change is only for write operations. And when the user asks for all known enum values, we don't use the cache, but load them from the cluster.", "url": "https://github.com/apache/ignite/pull/8110#discussion_r464222441", "createdAt": "2020-08-03T06:44:17Z", "author": {"login": "ptupitsyn"}, "path": "modules/platforms/dotnet/Apache.Ignite.Core.Tests/Binary/EnumsTest.cs", "diffHunk": "@@ -85,6 +86,11 @@ private static void CheckValue<T>(T val, bool isBinaryEnum = true)\n                 {\n                     Assert.AreEqual(string.Format(\"{0} [typeId={1}, enumValue={2}, enumValueName={3}]\",\n                         typeof(T).FullName, binRes.GetBinaryType().TypeId, binRes.EnumValue, val), binRes.ToString());\n+\n+                    var expectedEnumNames = Enum.GetValues(typeof(T)).OfType<T>().Select(x => x.ToString()).ToList();\n+                    var actualEnumNames = binRes.GetBinaryType().GetEnumValues().Select(v => v.EnumName).ToList();", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NDExMDAwOQ=="}, "originalCommit": {"oid": "7c687a5b19dce97a9ee8d5732e92ae305d823a9d"}, "originalPosition": 14}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjkwNTg3MjI0OnYy", "diffSide": "RIGHT", "path": "modules/platforms/dotnet/Apache.Ignite.Core/Impl/Binary/BinaryUtils.cs", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0wNFQxODo1MjoyOFrOG7tMvg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0wNFQxODo1MjoyOFrOG7tMvg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NTI1OTcxMA==", "bodyText": "Should we support long?", "url": "https://github.com/apache/ignite/pull/8110#discussion_r465259710", "createdAt": "2020-08-04T18:52:28Z", "author": {"login": "gurustron"}, "path": "modules/platforms/dotnet/Apache.Ignite.Core/Impl/Binary/BinaryUtils.cs", "diffHunk": "@@ -1749,6 +1753,76 @@ public static TimeSpan LongToTimeSpan(long ms)\n \n             return TimeSpan.FromMilliseconds(ms);\n         }\n+        \n+        /// <summary>\n+        /// Gets the enum values.\n+        /// </summary>\n+        public static IDictionary<string, int> GetEnumValues(Type enumType)\n+        {\n+            Debug.Assert(enumType != null);\n+            Debug.Assert(enumType.IsEnum);\n+            \n+            Dictionary<string,int> res;\n+            if (EnumValues.TryGetValue(enumType, out res))\n+            {\n+                return res;\n+            }\n+\n+            var values = Enum.GetValues(enumType);\n+            res = new Dictionary<string, int>(values.Length);\n+\n+            var underlyingType = Enum.GetUnderlyingType(enumType);\n+\n+            foreach (var value in values)\n+            {\n+                var name = Enum.GetName(enumType, value);\n+                Debug.Assert(name != null);\n+\n+                res[name] = GetEnumValueAsInt(underlyingType, value);\n+            }\n+\n+            EnumValues.Set(enumType, res);\n+            \n+            return res;\n+        }\n+        \n+        /// <summary>\n+        /// Gets the enum value as int.\n+        /// </summary>\n+        private static int GetEnumValueAsInt(Type underlyingType, object value)", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "7c687a5b19dce97a9ee8d5732e92ae305d823a9d"}, "originalPosition": 51}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2788, "cost": 1, "resetAt": "2021-11-12T09:44:50Z"}}}