{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0MzczNTM0Mzgw", "number": 7404, "title": "IGNITE-12433 checking column names for duplicates on create table statement", "bodyText": "", "createdAt": "2020-02-11T08:46:45Z", "url": "https://github.com/apache/ignite/pull/7404", "merged": true, "mergeCommit": {"oid": "ac893ab452f0ea85e5468c71909be9e7c21cec92"}, "closed": true, "closedAt": "2020-02-28T10:10:01Z", "author": {"login": "sergeyuttsel"}, "timelineItems": {"totalCount": 11, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcDNtDjAH2gAyMzczNTM0MzgwOjMwMmIxZGNkODY5ZWQ4MmY5MzEzNDk4MTY4YTRkYzY2ZTZmZTBmZWU=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcIdXS1AH2gAyMzczNTM0MzgwOmI1OGU1MjI3MjJhNTM3ZDg3ZTQzZjJhYjI0Mzc0NzY3NjcyYWVmMDE=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "302b1dcd869ed82f9313498168a4dc66e6fe0fee", "author": {"user": {"login": "sergeyuttsel", "name": "Sergey Uttsel"}}, "url": "https://github.com/apache/ignite/commit/302b1dcd869ed82f9313498168a4dc66e6fe0fee", "committedDate": "2020-02-11T08:45:50Z", "message": "checking column names for duplicates on create table statement"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "49ecf0105361258911842f686d471de2cae0aa20", "author": {"user": {"login": "sergeyuttsel", "name": "Sergey Uttsel"}}, "url": "https://github.com/apache/ignite/commit/49ecf0105361258911842f686d471de2cae0aa20", "committedDate": "2020-02-11T12:08:57Z", "message": "test update"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "0ffbd7142af9c05d6dba61f725cf3566bf7d7532", "author": {"user": {"login": "sergeyuttsel", "name": "Sergey Uttsel"}}, "url": "https://github.com/apache/ignite/commit/0ffbd7142af9c05d6dba61f725cf3566bf7d7532", "committedDate": "2020-02-12T08:05:41Z", "message": "added whitespace"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzU4OTI3NjUz", "url": "https://github.com/apache/ignite/pull/7404#pullrequestreview-358927653", "createdAt": "2020-02-14T13:08:03Z", "commit": {"oid": "0ffbd7142af9c05d6dba61f725cf3566bf7d7532"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xNFQxMzowODowM1rOFp2AZQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xNFQxMzowODowM1rOFp2AZQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3OTQyMDc3Mw==", "bodyText": "You could just analyze return value of cols.put instead of using containsKey", "url": "https://github.com/apache/ignite/pull/7404#discussion_r379420773", "createdAt": "2020-02-14T13:08:03Z", "author": {"login": "joooger"}, "path": "modules/indexing/src/main/java/org/apache/ignite/internal/processors/query/h2/sql/GridSqlQueryParser.java", "diffHunk": "@@ -1181,8 +1181,12 @@ private GridSqlCreateTable parseCreateTable(CreateTable createTbl) {\n \n         LinkedHashMap<String, GridSqlColumn> cols = new LinkedHashMap<>(data.columns.size());\n \n-        for (Column col : data.columns)\n+        for (Column col : data.columns) {\n+            if (cols.containsKey(col.getName()))\n+                throw new IgniteSQLException(\"Duplicate column name: \" + col.getName(), IgniteQueryErrorCode.PARSING);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "0ffbd7142af9c05d6dba61f725cf3566bf7d7532"}, "originalPosition": 7}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzU4OTI4MjUw", "url": "https://github.com/apache/ignite/pull/7404#pullrequestreview-358928250", "createdAt": "2020-02-14T13:09:12Z", "commit": {"oid": "0ffbd7142af9c05d6dba61f725cf3566bf7d7532"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xNFQxMzowOToxMlrOFp2COA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xNFQxMzowOToxMlrOFp2COA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3OTQyMTI0MA==", "bodyText": "Let's add another one check with different type of columns with the same name", "url": "https://github.com/apache/ignite/pull/7404#discussion_r379421240", "createdAt": "2020-02-14T13:09:12Z", "author": {"login": "joooger"}, "path": "modules/indexing/src/test/java/org/apache/ignite/internal/processors/cache/IgniteCacheSqlQueryErrorSelfTest.java", "diffHunk": "@@ -160,6 +160,12 @@ public void testDdlWrongColumnName() throws Exception {\n \n         checkSqlErrorMessage(\"alter table test drop column wrong\",\n             \"Failed to parse query. Column \\\"WRONG\\\" not found\");\n+\n+        checkSqlErrorMessage(\"create table test(id integer primary key, AgE integer, AGe integer)\",\n+            \"Duplicate column name: AGE\");\n+\n+        checkSqlErrorMessage(\"create table test(\\\"id\\\" integer primary key, \\\"age\\\" integer, \\\"age\\\" integer)\",\n+            \"Duplicate column name: age\");", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "0ffbd7142af9c05d6dba61f725cf3566bf7d7532"}, "originalPosition": 9}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzU4OTI4NTI0", "url": "https://github.com/apache/ignite/pull/7404#pullrequestreview-358928524", "createdAt": "2020-02-14T13:09:44Z", "commit": {"oid": "0ffbd7142af9c05d6dba61f725cf3566bf7d7532"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xNFQxMzowOTo0NFrOFp2C8g==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xNFQxMzowOTo0NFrOFp2C8g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3OTQyMTQyNg==", "bodyText": "The same as for IgniteCacheSqlQueryErrorSelfTest.java", "url": "https://github.com/apache/ignite/pull/7404#discussion_r379421426", "createdAt": "2020-02-14T13:09:44Z", "author": {"login": "joooger"}, "path": "modules/clients/src/test/java/org/apache/ignite/jdbc/JdbcErrorsAbstractSelfTest.java", "diffHunk": "@@ -719,6 +719,12 @@ public void testDdlWrongColumnName() throws SQLException {\n \n         checkSqlErrorMessage(\"alter table test drop column wrong\", \"42000\",\n             \"Failed to parse query. Column \\\"WRONG\\\" not found\");\n+\n+        checkSqlErrorMessage(\"create table test(id integer primary key, AgE integer, AGe integer)\", \"42000\",\n+            \"Duplicate column name: AGE\");\n+\n+        checkSqlErrorMessage(\"create table test(\\\"id\\\" integer primary key, \\\"age\\\" integer, \\\"age\\\" integer)\", \"42000\",\n+            \"Duplicate column name: age\");", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "0ffbd7142af9c05d6dba61f725cf3566bf7d7532"}, "originalPosition": 9}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzU4OTI5NzYz", "url": "https://github.com/apache/ignite/pull/7404#pullrequestreview-358929763", "createdAt": "2020-02-14T13:12:04Z", "commit": {"oid": "0ffbd7142af9c05d6dba61f725cf3566bf7d7532"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xNFQxMzoxMjowNFrOFp2Giw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xNFQxMzoxMjowNFrOFp2Giw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3OTQyMjM0Nw==", "bodyText": "do we have specific code for such case or may be we could add it?", "url": "https://github.com/apache/ignite/pull/7404#discussion_r379422347", "createdAt": "2020-02-14T13:12:04Z", "author": {"login": "joooger"}, "path": "modules/indexing/src/main/java/org/apache/ignite/internal/processors/query/h2/sql/GridSqlQueryParser.java", "diffHunk": "@@ -1181,8 +1181,12 @@ private GridSqlCreateTable parseCreateTable(CreateTable createTbl) {\n \n         LinkedHashMap<String, GridSqlColumn> cols = new LinkedHashMap<>(data.columns.size());\n \n-        for (Column col : data.columns)\n+        for (Column col : data.columns) {\n+            if (cols.containsKey(col.getName()))\n+                throw new IgniteSQLException(\"Duplicate column name: \" + col.getName(), IgniteQueryErrorCode.PARSING);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "0ffbd7142af9c05d6dba61f725cf3566bf7d7532"}, "originalPosition": 7}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "15f70e9d1c8fe74d0750476a971c5629063feef7", "author": {"user": {"login": "sergeyuttsel", "name": "Sergey Uttsel"}}, "url": "https://github.com/apache/ignite/commit/15f70e9d1c8fe74d0750476a971c5629063feef7", "committedDate": "2020-02-14T14:40:12Z", "message": "fix after code review"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "fc24384a24fdef32bffff8d20919a499d87e5919", "author": {"user": {"login": "sergeyuttsel", "name": "Sergey Uttsel"}}, "url": "https://github.com/apache/ignite/commit/fc24384a24fdef32bffff8d20919a499d87e5919", "committedDate": "2020-02-17T14:17:12Z", "message": "fix after code review: returned PARSING error instead of TABLE_CREATE_FAILED"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzY1NTM5Njgz", "url": "https://github.com/apache/ignite/pull/7404#pullrequestreview-365539683", "createdAt": "2020-02-27T09:46:50Z", "commit": {"oid": "fc24384a24fdef32bffff8d20919a499d87e5919"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b58e522722a537d87e43f2ab24374767672aef01", "author": {"user": {"login": "sergeyuttsel", "name": "Sergey Uttsel"}}, "url": "https://github.com/apache/ignite/commit/b58e522722a537d87e43f2ab24374767672aef01", "committedDate": "2020-02-27T15:50:10Z", "message": "Merge remote-tracking branch 'apache/master' into ignite-12433"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2808, "cost": 1, "resetAt": "2021-10-29T19:57:52Z"}}}