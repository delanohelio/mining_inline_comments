{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0Mzc1NzU0NDcy", "number": 7434, "reviewThreads": {"totalCount": 8, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xN1QxODoyMDo0OVrODgecUA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yMlQxNjoxNzozMlrODiF7UQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjM1Mzc5NzkyOnYy", "diffSide": "RIGHT", "path": "modules/core/src/main/java/org/apache/ignite/internal/processors/platform/cache/PlatformCache.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xN1QxODoyMDo0OVrOFqs5fA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xN1QxODoyMDo0OVrOFqs5fA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MDMyMDEyNA==", "bodyText": "val == FALSE ? false : true -> val == TRUE ?", "url": "https://github.com/apache/ignite/pull/7434#discussion_r380320124", "createdAt": "2020-02-17T18:20:49Z", "author": {"login": "ptupitsyn"}, "path": "modules/core/src/main/java/org/apache/ignite/internal/processors/platform/cache/PlatformCache.java", "diffHunk": "@@ -1174,6 +1177,11 @@ private void loadCache0(BinaryRawReaderEx reader, boolean loc) {\n             case OP_PRELOAD_PARTITION:\n                 cache.preloadPartition((int)val);\n \n+                return TRUE;\n+\n+            case OP_ENABLE_STATISTICS:\n+                cache.enableStatistics(val == FALSE ? false : true);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b7536bf2acd575cb55b679d70ef0848f93151746"}, "originalPosition": 17}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjM1MzgwNTkxOnYy", "diffSide": "RIGHT", "path": "modules/core/src/main/java/org/apache/ignite/internal/processors/platform/cluster/PlatformClusterGroup.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xN1QxODoyNDozOVrOFqs-QA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xN1QxODoyNDozOVrOFqs-QA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MDMyMTM0NA==", "bodyText": "Please use public API when possible: platformCtx.kernalContext().grid().cluster().enableStatistics(cacheNames, enabled)\nThere is a difference in exception handling and GridKernalGateway.readLock call.", "url": "https://github.com/apache/ignite/pull/7434#discussion_r380321344", "createdAt": "2020-02-17T18:24:39Z", "author": {"login": "ptupitsyn"}, "path": "modules/core/src/main/java/org/apache/ignite/internal/processors/platform/cluster/PlatformClusterGroup.java", "diffHunk": "@@ -356,6 +359,22 @@ public PlatformClusterGroup(PlatformContext platformCtx, ClusterGroupEx prj) {\n                 return TRUE;\n             }\n \n+            case OP_ENABLE_STATISTICS: {\n+                boolean enabled = reader.readBoolean();\n+\n+                int cnt = reader.readInt();\n+\n+                Collection<String> cacheNames = new ArrayList<>(cnt);\n+\n+                for (int i = 0; i < cnt; i++) {\n+                    cacheNames.add(reader.readString());\n+                }\n+\n+                platformCtx.kernalContext().cache().enableStatistics(cacheNames, enabled);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b7536bf2acd575cb55b679d70ef0848f93151746"}, "originalPosition": 25}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjM1MzgwOTAzOnYy", "diffSide": "RIGHT", "path": "modules/platforms/dotnet/Apache.Ignite.Core.Tests/Cache/CacheMetricsTest.cs", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xN1QxODoyNjowOVrOFqtAFw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xN1QxODoyNjowOVrOFqtAFw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MDMyMTgxNQ==", "bodyText": "Redundant blank line", "url": "https://github.com/apache/ignite/pull/7434#discussion_r380321815", "createdAt": "2020-02-17T18:26:09Z", "author": {"login": "ptupitsyn"}, "path": "modules/platforms/dotnet/Apache.Ignite.Core.Tests/Cache/CacheMetricsTest.cs", "diffHunk": "@@ -99,6 +99,28 @@ public void TestGlobalMetrics()\n             Assert.AreEqual(1, remoteMetrics.CachePuts);\n         }\n \n+        /// <summary>\n+        /// Tests the cache metrics enable/disable \n+        /// </summary>\n+        [Test]\n+        public void TestCacheEnableStatistics()\n+        {\n+            TestEnableStatistics(\"cacheEnableStatistics\", (cache, b) => cache.EnableStatistics(b));\n+        }\n+", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b7536bf2acd575cb55b679d70ef0848f93151746"}, "originalPosition": 12}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjM1MzgxMTc0OnYy", "diffSide": "RIGHT", "path": "modules/platforms/dotnet/Apache.Ignite.Core/Impl/Cache/CacheImpl.cs", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xN1QxODoyNzo0M1rOFqtBwQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xN1QxODoyNzo0M1rOFqtBwQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MDMyMjI0MQ==", "bodyText": "enabled ? True : False", "url": "https://github.com/apache/ignite/pull/7434#discussion_r380322241", "createdAt": "2020-02-17T18:27:43Z", "author": {"login": "ptupitsyn"}, "path": "modules/platforms/dotnet/Apache.Ignite.Core/Impl/Cache/CacheImpl.cs", "diffHunk": "@@ -1173,6 +1173,12 @@ public ICacheMetrics GetLocalMetrics()\n             });\n         }\n \n+        /** <inheritDoc /> */\n+        public void EnableStatistics(bool enabled)\n+        {\n+            DoOutInOp((int) CacheOp.EnableStatistics, enabled ? 1 : 0);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b7536bf2acd575cb55b679d70ef0848f93151746"}, "originalPosition": 7}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjM1MzgxMzU4OnYy", "diffSide": "RIGHT", "path": "modules/platforms/dotnet/Apache.Ignite.Core/Impl/Ignite.cs", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xN1QxODoyODo0MVrOFqtCzw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xN1QxODoyODo0MVrOFqtCzw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MDMyMjUxMQ==", "bodyText": "Please add /** <inheritdoc /> */", "url": "https://github.com/apache/ignite/pull/7434#discussion_r380322511", "createdAt": "2020-02-17T18:28:41Z", "author": {"login": "ptupitsyn"}, "path": "modules/platforms/dotnet/Apache.Ignite.Core/Impl/Ignite.cs", "diffHunk": "@@ -639,6 +639,11 @@ public IServices GetServices()\n             return _prj.ForServers().GetServices();\n         }\n \n+        public void EnableStatistics(IEnumerable<string> cacheNames, bool enabled)", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b7536bf2acd575cb55b679d70ef0848f93151746"}, "originalPosition": 4}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjM1MzgxNjY0OnYy", "diffSide": "RIGHT", "path": "modules/platforms/dotnet/Apache.Ignite.Core.Tests/Cache/CacheMetricsTest.cs", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xN1QxODozMDoyN1rOFqtEuQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xN1QxODozMDoyN1rOFqtEuQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MDMyMzAwMQ==", "bodyText": "Please add the following tests additionally:\n\nPass empty cacheNames\nPass non-existent cache names", "url": "https://github.com/apache/ignite/pull/7434#discussion_r380323001", "createdAt": "2020-02-17T18:30:27Z", "author": {"login": "ptupitsyn"}, "path": "modules/platforms/dotnet/Apache.Ignite.Core.Tests/Cache/CacheMetricsTest.cs", "diffHunk": "@@ -99,6 +99,28 @@ public void TestGlobalMetrics()\n             Assert.AreEqual(1, remoteMetrics.CachePuts);\n         }\n \n+        /// <summary>\n+        /// Tests the cache metrics enable/disable \n+        /// </summary>\n+        [Test]\n+        public void TestCacheEnableStatistics()\n+        {\n+            TestEnableStatistics(\"cacheEnableStatistics\", (cache, b) => cache.EnableStatistics(b));\n+        }\n+\n+        \n+        /// <summary>\n+        /// Tests the cache metrics enable/disable \n+        /// </summary>\n+        [Test]\n+        public void TestClusterGroupEnableStatistics()\n+        {\n+            var cacheName = \"clusterEnableStatistics\";\n+            TestEnableStatistics(\n+                cacheName,\n+                (cache, b) => cache.Ignite.GetCluster().EnableStatistics(new[] {cacheName}, b));", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b7536bf2acd575cb55b679d70ef0848f93151746"}, "originalPosition": 23}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjM3MDc1MjQ4OnYy", "diffSide": "RIGHT", "path": "modules/platforms/dotnet/Apache.Ignite.Core.Tests/Cache/CacheMetricsTest.cs", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yMlQxNjoxNjo0M1rOFtLzaQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yMlQxNjoxNjo0M1rOFtLzaQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MjkyMzYyNQ==", "bodyText": "Can you please extract the code below into two separate tests? Something like:\n\nTestClusterEnableStatisticsAllowsEmptyCacheNames\nTestClusterEnableStatisticsThrowsOnInvalidCacheName", "url": "https://github.com/apache/ignite/pull/7434#discussion_r382923625", "createdAt": "2020-02-22T16:16:43Z", "author": {"login": "ptupitsyn"}, "path": "modules/platforms/dotnet/Apache.Ignite.Core.Tests/Cache/CacheMetricsTest.cs", "diffHunk": "@@ -118,6 +120,16 @@ public void TestClusterGroupEnableStatistics()\n             TestEnableStatistics(\n                 cacheName,\n                 (cache, b) => cache.Ignite.GetCluster().EnableStatistics(new[] {cacheName}, b));\n+\n+            var ignite = Ignition.GetIgnite();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b9e40ea47966c6162cc351eda3058a20e851a197"}, "originalPosition": 26}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjM3MDc1MjgxOnYy", "diffSide": "RIGHT", "path": "modules/platforms/dotnet/Apache.Ignite.Core.Tests/Cache/CacheMetricsTest.cs", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yMlQxNjoxNzozMlrOFtLzlg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yMlQxNjoxNzozMlrOFtLzlg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MjkyMzY3MA==", "bodyText": "Let's add an assertion for the exception message. Does it make sense, is it clear enough for the user to fix the issue?", "url": "https://github.com/apache/ignite/pull/7434#discussion_r382923670", "createdAt": "2020-02-22T16:17:32Z", "author": {"login": "ptupitsyn"}, "path": "modules/platforms/dotnet/Apache.Ignite.Core.Tests/Cache/CacheMetricsTest.cs", "diffHunk": "@@ -118,6 +120,16 @@ public void TestClusterGroupEnableStatistics()\n             TestEnableStatistics(\n                 cacheName,\n                 (cache, b) => cache.Ignite.GetCluster().EnableStatistics(new[] {cacheName}, b));\n+\n+            var ignite = Ignition.GetIgnite();\n+            ignite.CreateCache<int, int>(new CacheConfiguration(\"clusterEnableStatsValidName\"));\n+            var cluster = ignite.GetCluster();\n+\n+            Assert.DoesNotThrow(() => cluster.EnableStatistics(Enumerable.Empty<string>(), true));\n+\n+            // Nonexistent cache name\n+            Assert.Throws<IgniteException>(", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b9e40ea47966c6162cc351eda3058a20e851a197"}, "originalPosition": 33}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2557, "cost": 1, "resetAt": "2021-11-12T09:44:50Z"}}}