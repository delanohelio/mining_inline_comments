{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0Mzc5NDcxMTE2", "number": 7471, "reviewThreads": {"totalCount": 12, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wNFQwNzo1ODoyNlrODk8VjA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wNlQxNzoyMzo0OFrODl4NNg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjQwMDYzODg0OnYy", "diffSide": "RIGHT", "path": "modules/core/src/main/java/org/apache/ignite/internal/commandline/ClusterStateChangeCommand.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wNFQwNzo1ODoyNlrOFxjEmg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wNFQwOTozNzowMVrOFxl_7Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NzQ5OTE2Mg==", "bodyText": "Do we need this line? Default force value is false already.", "url": "https://github.com/apache/ignite/pull/7471#discussion_r387499162", "createdAt": "2020-03-04T07:58:26Z", "author": {"login": "nizhikov"}, "path": "modules/core/src/main/java/org/apache/ignite/internal/commandline/ClusterStateChangeCommand.java", "diffHunk": "@@ -91,6 +98,18 @@\n         catch (IllegalArgumentException e) {\n             throw new IllegalArgumentException(\"Can't parse new cluster state. State: \" + s, e);\n         }\n+\n+        force = false;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "fe02d6fd61593375085ae1b2d1f812127cef3569"}, "originalPosition": 51}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NzU0NzExNw==", "bodyText": "Do we need this line? Default force value is false already.\n\nYes, we need this. Commands are statefull unfortunately. Without this, next command usage will go with previous value 'force' param.", "url": "https://github.com/apache/ignite/pull/7471#discussion_r387547117", "createdAt": "2020-03-04T09:37:01Z", "author": {"login": "Vladsz83"}, "path": "modules/core/src/main/java/org/apache/ignite/internal/commandline/ClusterStateChangeCommand.java", "diffHunk": "@@ -91,6 +98,18 @@\n         catch (IllegalArgumentException e) {\n             throw new IllegalArgumentException(\"Can't parse new cluster state. State: \" + s, e);\n         }\n+\n+        force = false;", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NzQ5OTE2Mg=="}, "originalCommit": {"oid": "fe02d6fd61593375085ae1b2d1f812127cef3569"}, "originalPosition": 51}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjQwMDY0MDIyOnYy", "diffSide": "RIGHT", "path": "modules/core/src/main/java/org/apache/ignite/internal/commandline/DeactivateCommand.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wNFQwNzo1ODo1OFrOFxjFcQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wNFQwOTozNzoxN1rOFxmAgg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NzQ5OTM3Nw==", "bodyText": "Do we need this line? Default force value is false already.", "url": "https://github.com/apache/ignite/pull/7471#discussion_r387499377", "createdAt": "2020-03-04T07:58:58Z", "author": {"login": "nizhikov"}, "path": "modules/core/src/main/java/org/apache/ignite/internal/commandline/DeactivateCommand.java", "diffHunk": "@@ -78,6 +81,21 @@\n         return null;\n     }\n \n+    /** {@inheritDoc} */\n+    @Override public void parseArguments(CommandArgIterator argIter) {\n+        force = false;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "fe02d6fd61593375085ae1b2d1f812127cef3569"}, "originalPosition": 49}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NzU0NzI2Ng==", "bodyText": "Do we need this line? Default force value is false already.\n\nYes, we need this. Commands are statefull unfortunately. Without this, next command usage will go with previous value 'force' param.", "url": "https://github.com/apache/ignite/pull/7471#discussion_r387547266", "createdAt": "2020-03-04T09:37:17Z", "author": {"login": "Vladsz83"}, "path": "modules/core/src/main/java/org/apache/ignite/internal/commandline/DeactivateCommand.java", "diffHunk": "@@ -78,6 +81,21 @@\n         return null;\n     }\n \n+    /** {@inheritDoc} */\n+    @Override public void parseArguments(CommandArgIterator argIter) {\n+        force = false;", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NzQ5OTM3Nw=="}, "originalCommit": {"oid": "fe02d6fd61593375085ae1b2d1f812127cef3569"}, "originalPosition": 49}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjQwMDY5MDA5OnYy", "diffSide": "RIGHT", "path": "modules/core/src/main/java/org/apache/ignite/internal/processors/cluster/ChangeGlobalStateMessage.java", "isResolved": false, "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wNFQwODoxODoxMFrOFxjjLg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wNFQwOTo0Njo0MVrOFxmVvQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NzUwNjk5MA==", "bodyText": "Why the default value is true?", "url": "https://github.com/apache/ignite/pull/7471#discussion_r387506990", "createdAt": "2020-03-04T08:18:10Z", "author": {"login": "nizhikov"}, "path": "modules/core/src/main/java/org/apache/ignite/internal/processors/cluster/ChangeGlobalStateMessage.java", "diffHunk": "@@ -71,6 +71,9 @@\n     @GridToStringExclude\n     @Nullable private transient ServiceDeploymentActions serviceDeploymentActions;\n \n+    /** Forced change of cluster state. */\n+    private boolean force = true;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "fe02d6fd61593375085ae1b2d1f812127cef3569"}, "originalPosition": 5}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NzU0ODc4Nw==", "bodyText": "Why the default value is true?\n\nFor backward compatibility and due to general idea. Within this ticket we prevent unsafe deactivation only where required. Most of the deactivation requests are still forced. Like through Ignite, IgniteMXBean, IgniteCluster etc. Also there is usage of this message from another places:\nGridClusterStateProcessor#autoAdjustExchangeActions(), GridClusterStateProcessor#autoAdjustInMemoryClusterState()", "url": "https://github.com/apache/ignite/pull/7471#discussion_r387548787", "createdAt": "2020-03-04T09:39:56Z", "author": {"login": "Vladsz83"}, "path": "modules/core/src/main/java/org/apache/ignite/internal/processors/cluster/ChangeGlobalStateMessage.java", "diffHunk": "@@ -71,6 +71,9 @@\n     @GridToStringExclude\n     @Nullable private transient ServiceDeploymentActions serviceDeploymentActions;\n \n+    /** Forced change of cluster state. */\n+    private boolean force = true;", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NzUwNjk5MA=="}, "originalCommit": {"oid": "fe02d6fd61593375085ae1b2d1f812127cef3569"}, "originalPosition": 5}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NzU1MjcwMQ==", "bodyText": "I think we should make force == false by default and explicitly pass true when required.", "url": "https://github.com/apache/ignite/pull/7471#discussion_r387552701", "createdAt": "2020-03-04T09:46:41Z", "author": {"login": "nizhikov"}, "path": "modules/core/src/main/java/org/apache/ignite/internal/processors/cluster/ChangeGlobalStateMessage.java", "diffHunk": "@@ -71,6 +71,9 @@\n     @GridToStringExclude\n     @Nullable private transient ServiceDeploymentActions serviceDeploymentActions;\n \n+    /** Forced change of cluster state. */\n+    private boolean force = true;", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NzUwNjk5MA=="}, "originalCommit": {"oid": "fe02d6fd61593375085ae1b2d1f812127cef3569"}, "originalPosition": 5}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjQwMDY5Mzc0OnYy", "diffSide": "LEFT", "path": "modules/core/src/main/java/org/apache/ignite/internal/processors/cluster/GridClusterStateProcessor.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wNFQwODoxOToyMlrOFxjlRA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wNFQxMDowNTowOVrOFxm-0Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NzUwNzUyNA==", "bodyText": "Why this deletion?", "url": "https://github.com/apache/ignite/pull/7471#discussion_r387507524", "createdAt": "2020-03-04T08:19:22Z", "author": {"login": "nizhikov"}, "path": "modules/core/src/main/java/org/apache/ignite/internal/processors/cluster/GridClusterStateProcessor.java", "diffHunk": "@@ -924,49 +945,8 @@ protected IgniteCheckedException concurrentStateChangeError(ClusterState state,\n \n     /** {@inheritDoc} */\n     @Override public IgniteInternalFuture<?> changeGlobalState(\n-        final boolean activate,", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "fe02d6fd61593375085ae1b2d1f812127cef3569"}, "originalPosition": 67}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NzU2MzIxNw==", "bodyText": "Why this deletion?\n\nTo simplify and reduce internal API and code base. There were already 2 changeGlobalState(). First, I introduced new one with \u2018force\u2019 not to change previous API. There 3 methods (2 of them deprecated) became a mesh. After all, as it is internal API, I suggest to keep one change-state method. Isn\u2019t it better?", "url": "https://github.com/apache/ignite/pull/7471#discussion_r387563217", "createdAt": "2020-03-04T10:05:09Z", "author": {"login": "Vladsz83"}, "path": "modules/core/src/main/java/org/apache/ignite/internal/processors/cluster/GridClusterStateProcessor.java", "diffHunk": "@@ -924,49 +945,8 @@ protected IgniteCheckedException concurrentStateChangeError(ClusterState state,\n \n     /** {@inheritDoc} */\n     @Override public IgniteInternalFuture<?> changeGlobalState(\n-        final boolean activate,", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NzUwNzUyNA=="}, "originalCommit": {"oid": "fe02d6fd61593375085ae1b2d1f812127cef3569"}, "originalPosition": 67}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjQwMDY5NTU5OnYy", "diffSide": "LEFT", "path": "modules/core/src/main/java/org/apache/ignite/internal/processors/cluster/IGridClusterStateProcessor.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wNFQwODoyMDowMFrOFxjmYw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wNFQxMDowNjowN1rOFxnBHQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NzUwNzgxMQ==", "bodyText": "Why this deletion?", "url": "https://github.com/apache/ignite/pull/7471#discussion_r387507811", "createdAt": "2020-03-04T08:20:00Z", "author": {"login": "nizhikov"}, "path": "modules/core/src/main/java/org/apache/ignite/internal/processors/cluster/IGridClusterStateProcessor.java", "diffHunk": "@@ -108,30 +108,20 @@ boolean onStateChangeMessage(AffinityTopologyVersion topVer,\n     /** */\n     void cacheProcessorStarted();\n \n-    /**\n-     * @param activate New cluster state.\n-     * @param baselineNodes New baseline nodes.\n-     * @param forceChangeBaselineTopology Force change baseline topology.\n-     * @return State change future.\n-     * @deprecated Use {@link #changeGlobalState(ClusterState, Collection, boolean)} instead.\n-     */\n-    @Deprecated\n-    IgniteInternalFuture<?> changeGlobalState(", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "fe02d6fd61593375085ae1b2d1f812127cef3569"}, "originalPosition": 12}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NzU2MzgwNQ==", "bodyText": "Why this deletion?\n\nSame as above (\"To simplify and reduce internal API and code base...\")", "url": "https://github.com/apache/ignite/pull/7471#discussion_r387563805", "createdAt": "2020-03-04T10:06:07Z", "author": {"login": "Vladsz83"}, "path": "modules/core/src/main/java/org/apache/ignite/internal/processors/cluster/IGridClusterStateProcessor.java", "diffHunk": "@@ -108,30 +108,20 @@ boolean onStateChangeMessage(AffinityTopologyVersion topVer,\n     /** */\n     void cacheProcessorStarted();\n \n-    /**\n-     * @param activate New cluster state.\n-     * @param baselineNodes New baseline nodes.\n-     * @param forceChangeBaselineTopology Force change baseline topology.\n-     * @return State change future.\n-     * @deprecated Use {@link #changeGlobalState(ClusterState, Collection, boolean)} instead.\n-     */\n-    @Deprecated\n-    IgniteInternalFuture<?> changeGlobalState(", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NzUwNzgxMQ=="}, "originalCommit": {"oid": "fe02d6fd61593375085ae1b2d1f812127cef3569"}, "originalPosition": 12}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjQwMDcwNDEwOnYy", "diffSide": "RIGHT", "path": "modules/core/src/main/java/org/apache/ignite/internal/processors/rest/client/message/GridClientClusterStateRequestV2.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wNFQwODoyMjo1NVrOFxjrlQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wNFQxMDowNzo0MVrOFxnEhA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NzUwOTE0MQ==", "bodyText": "We should rename this flag to forceDeactivation because it value apply to the deactivation command only.", "url": "https://github.com/apache/ignite/pull/7471#discussion_r387509141", "createdAt": "2020-03-04T08:22:55Z", "author": {"login": "nizhikov"}, "path": "modules/core/src/main/java/org/apache/ignite/internal/processors/rest/client/message/GridClientClusterStateRequestV2.java", "diffHunk": "@@ -0,0 +1,83 @@\n+/*\n+ * Licensed to the Apache Software Foundation (ASF) under one or more\n+ * contributor license agreements.  See the NOTICE file distributed with\n+ * this work for additional information regarding copyright ownership.\n+ * The ASF licenses this file to You under the Apache License, Version 2.0\n+ * (the \"License\"); you may not use this file except in compliance with\n+ * the License.  You may obtain a copy of the License at\n+ *\n+ *      http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package org.apache.ignite.internal.processors.rest.client.message;\n+\n+import java.io.IOException;\n+import java.io.ObjectInput;\n+import java.io.ObjectOutput;\n+import org.apache.ignite.cluster.ClusterState;\n+\n+/**\n+ * Enchanced version of {@link GridClientClusterStateRequest}.\n+ * Introduced to support forced version of the change state command and keep backward compatibility\n+ * with nodes of old version that may occur in cluster at the rolling updates.\n+ */\n+public class GridClientClusterStateRequestV2 extends GridClientClusterStateRequest {\n+    /** */\n+    private static final long serialVersionUID = 0L;\n+\n+    /** Forced change of cluster state. */\n+    private boolean force;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "fe02d6fd61593375085ae1b2d1f812127cef3569"}, "originalPosition": 35}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NzU2NDY3Ng==", "bodyText": "Fixed.", "url": "https://github.com/apache/ignite/pull/7471#discussion_r387564676", "createdAt": "2020-03-04T10:07:41Z", "author": {"login": "Vladsz83"}, "path": "modules/core/src/main/java/org/apache/ignite/internal/processors/rest/client/message/GridClientClusterStateRequestV2.java", "diffHunk": "@@ -0,0 +1,83 @@\n+/*\n+ * Licensed to the Apache Software Foundation (ASF) under one or more\n+ * contributor license agreements.  See the NOTICE file distributed with\n+ * this work for additional information regarding copyright ownership.\n+ * The ASF licenses this file to You under the Apache License, Version 2.0\n+ * (the \"License\"); you may not use this file except in compliance with\n+ * the License.  You may obtain a copy of the License at\n+ *\n+ *      http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package org.apache.ignite.internal.processors.rest.client.message;\n+\n+import java.io.IOException;\n+import java.io.ObjectInput;\n+import java.io.ObjectOutput;\n+import org.apache.ignite.cluster.ClusterState;\n+\n+/**\n+ * Enchanced version of {@link GridClientClusterStateRequest}.\n+ * Introduced to support forced version of the change state command and keep backward compatibility\n+ * with nodes of old version that may occur in cluster at the rolling updates.\n+ */\n+public class GridClientClusterStateRequestV2 extends GridClientClusterStateRequest {\n+    /** */\n+    private static final long serialVersionUID = 0L;\n+\n+    /** Forced change of cluster state. */\n+    private boolean force;", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NzUwOTE0MQ=="}, "originalCommit": {"oid": "fe02d6fd61593375085ae1b2d1f812127cef3569"}, "originalPosition": 35}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjQwMDcwNjcyOnYy", "diffSide": "RIGHT", "path": "modules/core/src/main/java/org/apache/ignite/internal/processors/cluster/IGridClusterStateProcessor.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wNFQwODoyMzo0MlrOFxjtKw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wNFQxMDoxMDoyMVrOFxnKNg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NzUwOTU0Nw==", "bodyText": "We should rename this flag to forceDeactivation because it value applies to the deactivation command only.", "url": "https://github.com/apache/ignite/pull/7471#discussion_r387509547", "createdAt": "2020-03-04T08:23:42Z", "author": {"login": "nizhikov"}, "path": "modules/core/src/main/java/org/apache/ignite/internal/processors/cluster/IGridClusterStateProcessor.java", "diffHunk": "@@ -108,30 +108,20 @@ boolean onStateChangeMessage(AffinityTopologyVersion topVer,\n     /** */\n     void cacheProcessorStarted();\n \n-    /**\n-     * @param activate New cluster state.\n-     * @param baselineNodes New baseline nodes.\n-     * @param forceChangeBaselineTopology Force change baseline topology.\n-     * @return State change future.\n-     * @deprecated Use {@link #changeGlobalState(ClusterState, Collection, boolean)} instead.\n-     */\n-    @Deprecated\n-    IgniteInternalFuture<?> changeGlobalState(\n-        boolean activate,\n-        Collection<? extends BaselineNode> baselineNodes,\n-        boolean forceChangeBaselineTopology\n-    );\n-\n     /**\n      * @param state New cluster state.\n+     * @param force If {@code True} skips checking of the operation safety.", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "fe02d6fd61593375085ae1b2d1f812127cef3569"}, "originalPosition": 20}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NzU2NjEzNA==", "bodyText": "Fixed.", "url": "https://github.com/apache/ignite/pull/7471#discussion_r387566134", "createdAt": "2020-03-04T10:10:21Z", "author": {"login": "Vladsz83"}, "path": "modules/core/src/main/java/org/apache/ignite/internal/processors/cluster/IGridClusterStateProcessor.java", "diffHunk": "@@ -108,30 +108,20 @@ boolean onStateChangeMessage(AffinityTopologyVersion topVer,\n     /** */\n     void cacheProcessorStarted();\n \n-    /**\n-     * @param activate New cluster state.\n-     * @param baselineNodes New baseline nodes.\n-     * @param forceChangeBaselineTopology Force change baseline topology.\n-     * @return State change future.\n-     * @deprecated Use {@link #changeGlobalState(ClusterState, Collection, boolean)} instead.\n-     */\n-    @Deprecated\n-    IgniteInternalFuture<?> changeGlobalState(\n-        boolean activate,\n-        Collection<? extends BaselineNode> baselineNodes,\n-        boolean forceChangeBaselineTopology\n-    );\n-\n     /**\n      * @param state New cluster state.\n+     * @param force If {@code True} skips checking of the operation safety.", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NzUwOTU0Nw=="}, "originalCommit": {"oid": "fe02d6fd61593375085ae1b2d1f812127cef3569"}, "originalPosition": 20}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjQwMDcwODA1OnYy", "diffSide": "RIGHT", "path": "modules/core/src/main/java/org/apache/ignite/internal/processors/cluster/GridClusterStateProcessor.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wNFQwODoyNDowNlrOFxjuBA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wNFQxMDoxMDoyOVrOFxnKcg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NzUwOTc2NA==", "bodyText": "We should rename this flag to forceDeactivation because its value applies to the deactivation command only.", "url": "https://github.com/apache/ignite/pull/7471#discussion_r387509764", "createdAt": "2020-03-04T08:24:06Z", "author": {"login": "nizhikov"}, "path": "modules/core/src/main/java/org/apache/ignite/internal/processors/cluster/GridClusterStateProcessor.java", "diffHunk": "@@ -1045,6 +1025,7 @@ else if (ClusterState.active(state)) {\n     /** */\n     private IgniteInternalFuture<?> changeGlobalState0(\n         ClusterState state,\n+        boolean force,", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "fe02d6fd61593375085ae1b2d1f812127cef3569"}, "originalPosition": 127}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NzU2NjE5NA==", "bodyText": "Fixed.", "url": "https://github.com/apache/ignite/pull/7471#discussion_r387566194", "createdAt": "2020-03-04T10:10:29Z", "author": {"login": "Vladsz83"}, "path": "modules/core/src/main/java/org/apache/ignite/internal/processors/cluster/GridClusterStateProcessor.java", "diffHunk": "@@ -1045,6 +1025,7 @@ else if (ClusterState.active(state)) {\n     /** */\n     private IgniteInternalFuture<?> changeGlobalState0(\n         ClusterState state,\n+        boolean force,", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NzUwOTc2NA=="}, "originalCommit": {"oid": "fe02d6fd61593375085ae1b2d1f812127cef3569"}, "originalPosition": 127}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjQwMDcwODkwOnYy", "diffSide": "RIGHT", "path": "modules/core/src/main/java/org/apache/ignite/internal/processors/cluster/GridClusterStateProcessor.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wNFQwODoyNDoyNlrOFxjujw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wNFQxMDoxMDozOVrOFxnK2g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NzUwOTkwMw==", "bodyText": "We should rename this flag to forceDeactivation because its value applies to the deactivation command only.", "url": "https://github.com/apache/ignite/pull/7471#discussion_r387509903", "createdAt": "2020-03-04T08:24:26Z", "author": {"login": "nizhikov"}, "path": "modules/core/src/main/java/org/apache/ignite/internal/processors/cluster/GridClusterStateProcessor.java", "diffHunk": "@@ -924,49 +945,8 @@ protected IgniteCheckedException concurrentStateChangeError(ClusterState state,\n \n     /** {@inheritDoc} */\n     @Override public IgniteInternalFuture<?> changeGlobalState(\n-        final boolean activate,\n-        Collection<? extends BaselineNode> baselineNodes,\n-        boolean forceChangeBaselineTopology\n-    ) {\n-        return changeGlobalState(activate, baselineNodes, forceChangeBaselineTopology, false);\n-    }\n-\n-    /** {@inheritDoc} */\n-    @Override public IgniteInternalFuture<?> changeGlobalState(\n-        ClusterState state,\n-        Collection<? extends BaselineNode> baselineNodes,\n-        boolean forceChangeBaselineTopology\n-    ) {\n-        return changeGlobalState(state, baselineNodes, forceChangeBaselineTopology, false);\n-    }\n-\n-    /**\n-     * @param activate New activate state.\n-     * @param baselineNodes New BLT nodes.\n-     * @param forceChangeBaselineTopology Force change BLT.\n-     * @param isAutoAdjust Auto adjusting flag.\n-     * @return Global change state future.\n-     * @deprecated Use {@link #changeGlobalState(ClusterState, Collection, boolean, boolean)} instead.\n-     */\n-    @Deprecated\n-    public IgniteInternalFuture<?> changeGlobalState(\n-        final boolean activate,\n-        Collection<? extends BaselineNode> baselineNodes,\n-        boolean forceChangeBaselineTopology,\n-        boolean isAutoAdjust\n-    ) {\n-        return changeGlobalState(activate ? ACTIVE : INACTIVE, baselineNodes, forceChangeBaselineTopology, isAutoAdjust);\n-    }\n-\n-    /**\n-     * @param state New activate state.\n-     * @param baselineNodes New BLT nodes.\n-     * @param forceChangeBaselineTopology Force change BLT.\n-     * @param isAutoAdjust Auto adjusting flag.\n-     * @return Global change state future.\n-     */\n-    public IgniteInternalFuture<?> changeGlobalState(\n         ClusterState state,\n+        boolean force,", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "fe02d6fd61593375085ae1b2d1f812127cef3569"}, "originalPosition": 110}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NzU2NjI5OA==", "bodyText": "Fixed.", "url": "https://github.com/apache/ignite/pull/7471#discussion_r387566298", "createdAt": "2020-03-04T10:10:39Z", "author": {"login": "Vladsz83"}, "path": "modules/core/src/main/java/org/apache/ignite/internal/processors/cluster/GridClusterStateProcessor.java", "diffHunk": "@@ -924,49 +945,8 @@ protected IgniteCheckedException concurrentStateChangeError(ClusterState state,\n \n     /** {@inheritDoc} */\n     @Override public IgniteInternalFuture<?> changeGlobalState(\n-        final boolean activate,\n-        Collection<? extends BaselineNode> baselineNodes,\n-        boolean forceChangeBaselineTopology\n-    ) {\n-        return changeGlobalState(activate, baselineNodes, forceChangeBaselineTopology, false);\n-    }\n-\n-    /** {@inheritDoc} */\n-    @Override public IgniteInternalFuture<?> changeGlobalState(\n-        ClusterState state,\n-        Collection<? extends BaselineNode> baselineNodes,\n-        boolean forceChangeBaselineTopology\n-    ) {\n-        return changeGlobalState(state, baselineNodes, forceChangeBaselineTopology, false);\n-    }\n-\n-    /**\n-     * @param activate New activate state.\n-     * @param baselineNodes New BLT nodes.\n-     * @param forceChangeBaselineTopology Force change BLT.\n-     * @param isAutoAdjust Auto adjusting flag.\n-     * @return Global change state future.\n-     * @deprecated Use {@link #changeGlobalState(ClusterState, Collection, boolean, boolean)} instead.\n-     */\n-    @Deprecated\n-    public IgniteInternalFuture<?> changeGlobalState(\n-        final boolean activate,\n-        Collection<? extends BaselineNode> baselineNodes,\n-        boolean forceChangeBaselineTopology,\n-        boolean isAutoAdjust\n-    ) {\n-        return changeGlobalState(activate ? ACTIVE : INACTIVE, baselineNodes, forceChangeBaselineTopology, isAutoAdjust);\n-    }\n-\n-    /**\n-     * @param state New activate state.\n-     * @param baselineNodes New BLT nodes.\n-     * @param forceChangeBaselineTopology Force change BLT.\n-     * @param isAutoAdjust Auto adjusting flag.\n-     * @return Global change state future.\n-     */\n-    public IgniteInternalFuture<?> changeGlobalState(\n         ClusterState state,\n+        boolean force,", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NzUwOTkwMw=="}, "originalCommit": {"oid": "fe02d6fd61593375085ae1b2d1f812127cef3569"}, "originalPosition": 110}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjQwMDc0MzI2OnYy", "diffSide": "RIGHT", "path": "modules/core/src/main/java/org/apache/ignite/internal/processors/cluster/GridClusterStateProcessor.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wNFQwODozNjoxMVrOFxkDvQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wNFQxMDoxMzo1MFrOFxnR-A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NzUxNTMyNQ==", "bodyText": "We should change \"can\" to \"will\" because there is no case when in-memory data will not be lost after deactivation.\nSo correct message to the user\n`Deactivation stopped. Cluster has in-memory caches(without persistence). During deactivation, in-memory data will be lost.'", "url": "https://github.com/apache/ignite/pull/7471#discussion_r387515325", "createdAt": "2020-03-04T08:36:11Z", "author": {"login": "nizhikov"}, "path": "modules/core/src/main/java/org/apache/ignite/internal/processors/cluster/GridClusterStateProcessor.java", "diffHunk": "@@ -115,6 +118,11 @@\n     /** */\n     private static final String METASTORE_CURR_BLT_KEY = \"metastoreBltKey\";\n \n+    /** Warning of unsafe deactivation. */\n+    public static final String DATA_LOST_ON_DEACTIVATION_WARNING =\n+        \"Cluster has caches configured without persistence. \" +\n+            \"During deactivation in-memory data and objects can be lost!\";", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "fe02d6fd61593375085ae1b2d1f812127cef3569"}, "originalPosition": 29}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NzU2ODEyMA==", "bodyText": "Fixed.", "url": "https://github.com/apache/ignite/pull/7471#discussion_r387568120", "createdAt": "2020-03-04T10:13:50Z", "author": {"login": "Vladsz83"}, "path": "modules/core/src/main/java/org/apache/ignite/internal/processors/cluster/GridClusterStateProcessor.java", "diffHunk": "@@ -115,6 +118,11 @@\n     /** */\n     private static final String METASTORE_CURR_BLT_KEY = \"metastoreBltKey\";\n \n+    /** Warning of unsafe deactivation. */\n+    public static final String DATA_LOST_ON_DEACTIVATION_WARNING =\n+        \"Cluster has caches configured without persistence. \" +\n+            \"During deactivation in-memory data and objects can be lost!\";", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NzUxNTMyNQ=="}, "originalCommit": {"oid": "fe02d6fd61593375085ae1b2d1f812127cef3569"}, "originalPosition": 29}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjQwMDc1NDY3OnYy", "diffSide": "RIGHT", "path": "modules/core/src/main/java/org/apache/ignite/internal/processors/rest/client/message/GridClientClusterStateRequest.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wNFQwODozOTo0NVrOFxkKZw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wNFQxMDoxNDoyNlrOFxnTQg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NzUxNzAzMQ==", "bodyText": "typo: externalization", "url": "https://github.com/apache/ignite/pull/7471#discussion_r387517031", "createdAt": "2020-03-04T08:39:45Z", "author": {"login": "nizhikov"}, "path": "modules/core/src/main/java/org/apache/ignite/internal/processors/rest/client/message/GridClientClusterStateRequest.java", "diffHunk": "@@ -69,6 +70,21 @@ public static GridClientClusterStateRequest state(ClusterState state) {\n         return msg;\n     }\n \n+    /** Default constructor for the exernalization. */", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "fe02d6fd61593375085ae1b2d1f812127cef3569"}, "originalPosition": 15}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NzU2ODQ1MA==", "bodyText": "Fixed.", "url": "https://github.com/apache/ignite/pull/7471#discussion_r387568450", "createdAt": "2020-03-04T10:14:26Z", "author": {"login": "Vladsz83"}, "path": "modules/core/src/main/java/org/apache/ignite/internal/processors/rest/client/message/GridClientClusterStateRequest.java", "diffHunk": "@@ -69,6 +70,21 @@ public static GridClientClusterStateRequest state(ClusterState state) {\n         return msg;\n     }\n \n+    /** Default constructor for the exernalization. */", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NzUxNzAzMQ=="}, "originalCommit": {"oid": "fe02d6fd61593375085ae1b2d1f812127cef3569"}, "originalPosition": 15}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjQxMDQ0NzkwOnYy", "diffSide": "RIGHT", "path": "modules/core/src/main/java/org/apache/ignite/internal/processors/cluster/GridClusterStateProcessor.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wNlQxNzoyMzo0OFrOFzA-eQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wOVQxODoyNTowMVrOFz0TRg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4OTAzNzY4OQ==", "bodyText": "It's not clear why we force deactivation here.", "url": "https://github.com/apache/ignite/pull/7471#discussion_r389037689", "createdAt": "2020-03-06T17:23:48Z", "author": {"login": "nizhikov"}, "path": "modules/core/src/main/java/org/apache/ignite/internal/processors/cluster/GridClusterStateProcessor.java", "diffHunk": "@@ -1617,6 +1643,7 @@ public ExchangeActions autoAdjustExchangeActions(ExchangeActions exchActs) {\n                 ctx.localNodeId(),\n                 null,\n                 ClusterState.active(clusterState.state()) ? clusterState.state() : ACTIVE,\n+                true,", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "e06295902b987a8d9768133114bf5f9bd573903a"}, "originalPosition": 143}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4OTg3ODU5OA==", "bodyText": "It's not clear why we force deactivation here.\n\nAll previous internal changes of cluster state were forced. Thus, all current internal changes of cluster are considered forced. Only the exceptions are the user commands being translated to not-forced internal calls without flag \u2018force\u2019 passed.", "url": "https://github.com/apache/ignite/pull/7471#discussion_r389878598", "createdAt": "2020-03-09T18:25:01Z", "author": {"login": "Vladsz83"}, "path": "modules/core/src/main/java/org/apache/ignite/internal/processors/cluster/GridClusterStateProcessor.java", "diffHunk": "@@ -1617,6 +1643,7 @@ public ExchangeActions autoAdjustExchangeActions(ExchangeActions exchActs) {\n                 ctx.localNodeId(),\n                 null,\n                 ClusterState.active(clusterState.state()) ? clusterState.state() : ACTIVE,\n+                true,", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4OTAzNzY4OQ=="}, "originalCommit": {"oid": "e06295902b987a8d9768133114bf5f9bd573903a"}, "originalPosition": 143}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2562, "cost": 1, "resetAt": "2021-11-12T09:44:50Z"}}}