{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDY0MTE3OTEy", "number": 8128, "title": "IGNITE-12968 Snapshot documentation pages", "bodyText": "Thank you for submitting the pull request to the Apache Ignite.\nIn order to streamline the review of the contribution\nwe ask you to ensure the following steps have been taken:\nThe Contribution Checklist\n\n There is a single JIRA ticket related to the pull request.\n The web-link to the pull request is attached to the JIRA ticket.\n The JIRA ticket has the Patch Available state.\n The pull request body describes changes that have been made.\nThe description explains WHAT and WHY was made instead of HOW.\n The pull request title is treated as the final commit message.\nThe following pattern must be used: IGNITE-XXXX Change summary where XXXX - number of JIRA issue.\n A reviewer has been mentioned through the JIRA comments\n(see the Maintainers list)\n The pull request has been checked by the Teamcity Bot and\nthe green visa attached to the JIRA ticket (see TC.Bot: Check PR)\n\nNotes\n\nHow to Contribute\nCoding abbreviation rules\nCoding Guidelines\nApache Ignite Teamcity Bot\n\nIf you need any help, please email dev@ignite.apache.org or ask an\u0443 advice on http://asf.slack.com #ignite channel.", "createdAt": "2020-08-06T15:59:14Z", "url": "https://github.com/apache/ignite/pull/8128", "merged": true, "mergeCommit": {"oid": "b5c116f844bf02ed5ac992bd5919fbe9151cbd89"}, "closed": true, "closedAt": "2020-09-17T16:22:02Z", "author": {"login": "Mmuzaf"}, "timelineItems": {"totalCount": 11, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdFqMerAH2gAyNDY0MTE3OTEyOjUyY2ZkNmU2YjkyMDJmZWJmYzdkOGE1ZWUwN2UyOGMxYTAyZWVlNDQ=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdJZ4SuAH2gAyNDY0MTE3OTEyOmUwYTc4YWFiY2ZiYzRlMDA1MjY2MmNjNDIwZjlkNmJkYzFjZGRlMzQ=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "52cfd6e6b9202febfc7d8a5ee07e28c1a02eee44", "author": {"user": {"login": "Mmuzaf", "name": "Maxim Muzafarov"}}, "url": "https://github.com/apache/ignite/commit/52cfd6e6b9202febfc7d8a5ee07e28c1a02eee44", "committedDate": "2020-09-04T19:16:30Z", "message": "IGNITE-12968 Add snapshot documentation pages"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "70a69f77e5687f4ea103c2fa68d1c5bac1dc9899", "author": {"user": {"login": "Mmuzaf", "name": "Maxim Muzafarov"}}, "url": "https://github.com/apache/ignite/commit/70a69f77e5687f4ea103c2fa68d1c5bac1dc9899", "committedDate": "2020-09-04T16:54:16Z", "message": "WIP"}, "afterCommit": {"oid": "52cfd6e6b9202febfc7d8a5ee07e28c1a02eee44", "author": {"user": {"login": "Mmuzaf", "name": "Maxim Muzafarov"}}, "url": "https://github.com/apache/ignite/commit/52cfd6e6b9202febfc7d8a5ee07e28c1a02eee44", "committedDate": "2020-09-04T19:16:30Z", "message": "IGNITE-12968 Add snapshot documentation pages"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDgzNDMyNTEx", "url": "https://github.com/apache/ignite/pull/8128#pullrequestreview-483432511", "createdAt": "2020-09-07T10:10:26Z", "commit": {"oid": "52cfd6e6b9202febfc7d8a5ee07e28c1a02eee44"}, "state": "COMMENTED", "comments": {"totalCount": 38, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0wN1QxMDoxMDoyN1rOHN5aNQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0wN1QxNDoyMToxOVrOHOBLSQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NDMzNDEzMw==", "bodyText": "At runtime, you can create multiple snapshots of all configured persistent cache groups.", "url": "https://github.com/apache/ignite/pull/8128#discussion_r484334133", "createdAt": "2020-09-07T10:10:27Z", "author": {"login": "Silberfuchs1"}, "path": "docs/_docs/persistence/snapshot.adoc", "diffHunk": "@@ -0,0 +1,181 @@\n+= Snapshots and recovery\n+\n+== Overview\n+\n+Apache Ignite 2.9 comes with an ability to create fully consistent cluster-wide snapshots for deployments with\n+the link:persistence/native-persistence[Ignite Native Persistence]. You can create at runtime any number of snapshots\n+of all configured persistent cache groups. The snapshot is a consistent copy of all cache group data files (except", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "52cfd6e6b9202febfc7d8a5ee07e28c1a02eee44"}, "originalPosition": 7}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NDMzNDkzMA==", "bodyText": "'stored' ---> 'is stored'", "url": "https://github.com/apache/ignite/pull/8128#discussion_r484334930", "createdAt": "2020-09-07T10:11:58Z", "author": {"login": "Silberfuchs1"}, "path": "docs/_docs/persistence/snapshot.adoc", "diffHunk": "@@ -0,0 +1,181 @@\n+= Snapshots and recovery\n+\n+== Overview\n+\n+Apache Ignite 2.9 comes with an ability to create fully consistent cluster-wide snapshots for deployments with\n+the link:persistence/native-persistence[Ignite Native Persistence]. You can create at runtime any number of snapshots\n+of all configured persistent cache groups. The snapshot is a consistent copy of all cache group data files (except\n+structures used for crash recovery) for each baseline node in a cluster. Since data of persistent cache groups stored", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "52cfd6e6b9202febfc7d8a5ee07e28c1a02eee44"}, "originalPosition": 8}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NDMzNTYxNA==", "bodyText": "'for each node' maybe? The data is stored on disk in files for each node?", "url": "https://github.com/apache/ignite/pull/8128#discussion_r484335614", "createdAt": "2020-09-07T10:13:15Z", "author": {"login": "Silberfuchs1"}, "path": "docs/_docs/persistence/snapshot.adoc", "diffHunk": "@@ -0,0 +1,181 @@\n+= Snapshots and recovery\n+\n+== Overview\n+\n+Apache Ignite 2.9 comes with an ability to create fully consistent cluster-wide snapshots for deployments with\n+the link:persistence/native-persistence[Ignite Native Persistence]. You can create at runtime any number of snapshots\n+of all configured persistent cache groups. The snapshot is a consistent copy of all cache group data files (except\n+structures used for crash recovery) for each baseline node in a cluster. Since data of persistent cache groups stored\n+on disk in files on each node (cache group partition files, configuration files, binary metadata) the snapshot will", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "52cfd6e6b9202febfc7d8a5ee07e28c1a02eee44"}, "originalPosition": 9}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NDMzNTg4Ng==", "bodyText": "'...(cache group partition files, configuration files, binary metadata), the snapshot will...'", "url": "https://github.com/apache/ignite/pull/8128#discussion_r484335886", "createdAt": "2020-09-07T10:13:44Z", "author": {"login": "Silberfuchs1"}, "path": "docs/_docs/persistence/snapshot.adoc", "diffHunk": "@@ -0,0 +1,181 @@\n+= Snapshots and recovery\n+\n+== Overview\n+\n+Apache Ignite 2.9 comes with an ability to create fully consistent cluster-wide snapshots for deployments with\n+the link:persistence/native-persistence[Ignite Native Persistence]. You can create at runtime any number of snapshots\n+of all configured persistent cache groups. The snapshot is a consistent copy of all cache group data files (except\n+structures used for crash recovery) for each baseline node in a cluster. Since data of persistent cache groups stored\n+on disk in files on each node (cache group partition files, configuration files, binary metadata) the snapshot will", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "52cfd6e6b9202febfc7d8a5ee07e28c1a02eee44"}, "originalPosition": 9}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NDMzNjM5OA==", "bodyText": "'ids' ---> 'IDs'", "url": "https://github.com/apache/ignite/pull/8128#discussion_r484336398", "createdAt": "2020-09-07T10:14:39Z", "author": {"login": "Silberfuchs1"}, "path": "docs/_docs/persistence/snapshot.adoc", "diffHunk": "@@ -0,0 +1,181 @@\n+= Snapshots and recovery\n+\n+== Overview\n+\n+Apache Ignite 2.9 comes with an ability to create fully consistent cluster-wide snapshots for deployments with\n+the link:persistence/native-persistence[Ignite Native Persistence]. You can create at runtime any number of snapshots\n+of all configured persistent cache groups. The snapshot is a consistent copy of all cache group data files (except\n+structures used for crash recovery) for each baseline node in a cluster. Since data of persistent cache groups stored\n+on disk in files on each node (cache group partition files, configuration files, binary metadata) the snapshot will\n+contain a copy of the same files with keeping Ignite cluster node data directory structure and the node consistent ids.", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "52cfd6e6b9202febfc7d8a5ee07e28c1a02eee44"}, "originalPosition": 10}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NDMzNjg4Ng==", "bodyText": "'...you created' ---> 'you've created'", "url": "https://github.com/apache/ignite/pull/8128#discussion_r484336886", "createdAt": "2020-09-07T10:15:35Z", "author": {"login": "Silberfuchs1"}, "path": "docs/_docs/persistence/snapshot.adoc", "diffHunk": "@@ -0,0 +1,181 @@\n+= Snapshots and recovery\n+\n+== Overview\n+\n+Apache Ignite 2.9 comes with an ability to create fully consistent cluster-wide snapshots for deployments with\n+the link:persistence/native-persistence[Ignite Native Persistence]. You can create at runtime any number of snapshots\n+of all configured persistent cache groups. The snapshot is a consistent copy of all cache group data files (except\n+structures used for crash recovery) for each baseline node in a cluster. Since data of persistent cache groups stored\n+on disk in files on each node (cache group partition files, configuration files, binary metadata) the snapshot will\n+contain a copy of the same files with keeping Ignite cluster node data directory structure and the node consistent ids.\n+\n+*Snapshot Consistency.*\n+\n+All snapshots you created are fully consistent in terms of concurrent cluster-wide operations and all ongoing changes of", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "52cfd6e6b9202febfc7d8a5ee07e28c1a02eee44"}, "originalPosition": 14}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NDMzOTY3Ng==", "bodyText": "'...will be also fully consistent...' ---> '...will also be fully consistent...'", "url": "https://github.com/apache/ignite/pull/8128#discussion_r484339676", "createdAt": "2020-09-07T10:21:01Z", "author": {"login": "Silberfuchs1"}, "path": "docs/_docs/persistence/snapshot.adoc", "diffHunk": "@@ -0,0 +1,181 @@\n+= Snapshots and recovery\n+\n+== Overview\n+\n+Apache Ignite 2.9 comes with an ability to create fully consistent cluster-wide snapshots for deployments with\n+the link:persistence/native-persistence[Ignite Native Persistence]. You can create at runtime any number of snapshots\n+of all configured persistent cache groups. The snapshot is a consistent copy of all cache group data files (except\n+structures used for crash recovery) for each baseline node in a cluster. Since data of persistent cache groups stored\n+on disk in files on each node (cache group partition files, configuration files, binary metadata) the snapshot will\n+contain a copy of the same files with keeping Ignite cluster node data directory structure and the node consistent ids.\n+\n+*Snapshot Consistency.*\n+\n+All snapshots you created are fully consistent in terms of concurrent cluster-wide operations and all ongoing changes of\n+system files on the local node. Primary and backup cache group partitions will be also fully consistent in created", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "52cfd6e6b9202febfc7d8a5ee07e28c1a02eee44"}, "originalPosition": 15}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NDM0MDg0Mg==", "bodyText": "'... achieved...' ---> 'is achieved'", "url": "https://github.com/apache/ignite/pull/8128#discussion_r484340842", "createdAt": "2020-09-07T10:23:18Z", "author": {"login": "Silberfuchs1"}, "path": "docs/_docs/persistence/snapshot.adoc", "diffHunk": "@@ -0,0 +1,181 @@\n+= Snapshots and recovery\n+\n+== Overview\n+\n+Apache Ignite 2.9 comes with an ability to create fully consistent cluster-wide snapshots for deployments with\n+the link:persistence/native-persistence[Ignite Native Persistence]. You can create at runtime any number of snapshots\n+of all configured persistent cache groups. The snapshot is a consistent copy of all cache group data files (except\n+structures used for crash recovery) for each baseline node in a cluster. Since data of persistent cache groups stored\n+on disk in files on each node (cache group partition files, configuration files, binary metadata) the snapshot will\n+contain a copy of the same files with keeping Ignite cluster node data directory structure and the node consistent ids.\n+\n+*Snapshot Consistency.*\n+\n+All snapshots you created are fully consistent in terms of concurrent cluster-wide operations and all ongoing changes of\n+system files on the local node. Primary and backup cache group partitions will be also fully consistent in created\n+snapshots.\n+\n+The cluster-wide snapshot consistency achieved by triggering the", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "52cfd6e6b9202febfc7d8a5ee07e28c1a02eee44"}, "originalPosition": 18}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NDM0MjY3Mg==", "bodyText": "don't understand, where 'procedure' goes... Is 'triggering the link' the procedure?", "url": "https://github.com/apache/ignite/pull/8128#discussion_r484342672", "createdAt": "2020-09-07T10:26:58Z", "author": {"login": "Silberfuchs1"}, "path": "docs/_docs/persistence/snapshot.adoc", "diffHunk": "@@ -0,0 +1,181 @@\n+= Snapshots and recovery\n+\n+== Overview\n+\n+Apache Ignite 2.9 comes with an ability to create fully consistent cluster-wide snapshots for deployments with\n+the link:persistence/native-persistence[Ignite Native Persistence]. You can create at runtime any number of snapshots\n+of all configured persistent cache groups. The snapshot is a consistent copy of all cache group data files (except\n+structures used for crash recovery) for each baseline node in a cluster. Since data of persistent cache groups stored\n+on disk in files on each node (cache group partition files, configuration files, binary metadata) the snapshot will\n+contain a copy of the same files with keeping Ignite cluster node data directory structure and the node consistent ids.\n+\n+*Snapshot Consistency.*\n+\n+All snapshots you created are fully consistent in terms of concurrent cluster-wide operations and all ongoing changes of\n+system files on the local node. Primary and backup cache group partitions will be also fully consistent in created\n+snapshots.\n+\n+The cluster-wide snapshot consistency achieved by triggering the\n+link:https://cwiki.apache.org/confluence/display/IGNITE/%28Partition+Map%29+Exchange+-+under+the+hood[Partition-Map-Exchange]\n+procedure. Doing this the cluster will eventually get a point in time when all previously started transactions", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "52cfd6e6b9202febfc7d8a5ee07e28c1a02eee44"}, "originalPosition": 20}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NDM0MzAxMw==", "bodyText": "'... finished...' ---> '...are finished...'", "url": "https://github.com/apache/ignite/pull/8128#discussion_r484343013", "createdAt": "2020-09-07T10:27:38Z", "author": {"login": "Silberfuchs1"}, "path": "docs/_docs/persistence/snapshot.adoc", "diffHunk": "@@ -0,0 +1,181 @@\n+= Snapshots and recovery\n+\n+== Overview\n+\n+Apache Ignite 2.9 comes with an ability to create fully consistent cluster-wide snapshots for deployments with\n+the link:persistence/native-persistence[Ignite Native Persistence]. You can create at runtime any number of snapshots\n+of all configured persistent cache groups. The snapshot is a consistent copy of all cache group data files (except\n+structures used for crash recovery) for each baseline node in a cluster. Since data of persistent cache groups stored\n+on disk in files on each node (cache group partition files, configuration files, binary metadata) the snapshot will\n+contain a copy of the same files with keeping Ignite cluster node data directory structure and the node consistent ids.\n+\n+*Snapshot Consistency.*\n+\n+All snapshots you created are fully consistent in terms of concurrent cluster-wide operations and all ongoing changes of\n+system files on the local node. Primary and backup cache group partitions will be also fully consistent in created\n+snapshots.\n+\n+The cluster-wide snapshot consistency achieved by triggering the\n+link:https://cwiki.apache.org/confluence/display/IGNITE/%28Partition+Map%29+Exchange+-+under+the+hood[Partition-Map-Exchange]\n+procedure. Doing this the cluster will eventually get a point in time when all previously started transactions\n+finished on primary and backups, and new ones are hold until a new snapshot operation will be started.", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "52cfd6e6b9202febfc7d8a5ee07e28c1a02eee44"}, "originalPosition": 21}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NDM0MzMyMg==", "bodyText": "started ---> initiated maybe?", "url": "https://github.com/apache/ignite/pull/8128#discussion_r484343322", "createdAt": "2020-09-07T10:28:20Z", "author": {"login": "Silberfuchs1"}, "path": "docs/_docs/persistence/snapshot.adoc", "diffHunk": "@@ -0,0 +1,181 @@\n+= Snapshots and recovery\n+\n+== Overview\n+\n+Apache Ignite 2.9 comes with an ability to create fully consistent cluster-wide snapshots for deployments with\n+the link:persistence/native-persistence[Ignite Native Persistence]. You can create at runtime any number of snapshots\n+of all configured persistent cache groups. The snapshot is a consistent copy of all cache group data files (except\n+structures used for crash recovery) for each baseline node in a cluster. Since data of persistent cache groups stored\n+on disk in files on each node (cache group partition files, configuration files, binary metadata) the snapshot will\n+contain a copy of the same files with keeping Ignite cluster node data directory structure and the node consistent ids.\n+\n+*Snapshot Consistency.*\n+\n+All snapshots you created are fully consistent in terms of concurrent cluster-wide operations and all ongoing changes of\n+system files on the local node. Primary and backup cache group partitions will be also fully consistent in created\n+snapshots.\n+\n+The cluster-wide snapshot consistency achieved by triggering the\n+link:https://cwiki.apache.org/confluence/display/IGNITE/%28Partition+Map%29+Exchange+-+under+the+hood[Partition-Map-Exchange]\n+procedure. Doing this the cluster will eventually get a point in time when all previously started transactions\n+finished on primary and backups, and new ones are hold until a new snapshot operation will be started.", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "52cfd6e6b9202febfc7d8a5ee07e28c1a02eee44"}, "originalPosition": 21}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NDM0ODM1NQ==", "bodyText": "'The consistency of local system files (e.g. cache group partition files, binary metadata files, configuration files) is achieved....'\nor\n'The local system files (e.g. cache group partition files, binary metadata files, configuration files) consistency  is achieved....'\nOtherwise, the types of local system files are away from the definition itself, and the reader could get confused.", "url": "https://github.com/apache/ignite/pull/8128#discussion_r484348355", "createdAt": "2020-09-07T10:38:44Z", "author": {"login": "Silberfuchs1"}, "path": "docs/_docs/persistence/snapshot.adoc", "diffHunk": "@@ -0,0 +1,181 @@\n+= Snapshots and recovery\n+\n+== Overview\n+\n+Apache Ignite 2.9 comes with an ability to create fully consistent cluster-wide snapshots for deployments with\n+the link:persistence/native-persistence[Ignite Native Persistence]. You can create at runtime any number of snapshots\n+of all configured persistent cache groups. The snapshot is a consistent copy of all cache group data files (except\n+structures used for crash recovery) for each baseline node in a cluster. Since data of persistent cache groups stored\n+on disk in files on each node (cache group partition files, configuration files, binary metadata) the snapshot will\n+contain a copy of the same files with keeping Ignite cluster node data directory structure and the node consistent ids.\n+\n+*Snapshot Consistency.*\n+\n+All snapshots you created are fully consistent in terms of concurrent cluster-wide operations and all ongoing changes of\n+system files on the local node. Primary and backup cache group partitions will be also fully consistent in created\n+snapshots.\n+\n+The cluster-wide snapshot consistency achieved by triggering the\n+link:https://cwiki.apache.org/confluence/display/IGNITE/%28Partition+Map%29+Exchange+-+under+the+hood[Partition-Map-Exchange]\n+procedure. Doing this the cluster will eventually get a point in time when all previously started transactions\n+finished on primary and backups, and new ones are hold until a new snapshot operation will be started.\n+\n+The local system files consistency (e.g. cache group partition files, binary metadata files, configuration files) achieved", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "52cfd6e6b9202febfc7d8a5ee07e28c1a02eee44"}, "originalPosition": 23}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NDM0ODk0NA==", "bodyText": "'will require'? Why not 'requires' or 'may require', or 'might require'?", "url": "https://github.com/apache/ignite/pull/8128#discussion_r484348944", "createdAt": "2020-09-07T10:39:56Z", "author": {"login": "Silberfuchs1"}, "path": "docs/_docs/persistence/snapshot.adoc", "diffHunk": "@@ -0,0 +1,181 @@\n+= Snapshots and recovery\n+\n+== Overview\n+\n+Apache Ignite 2.9 comes with an ability to create fully consistent cluster-wide snapshots for deployments with\n+the link:persistence/native-persistence[Ignite Native Persistence]. You can create at runtime any number of snapshots\n+of all configured persistent cache groups. The snapshot is a consistent copy of all cache group data files (except\n+structures used for crash recovery) for each baseline node in a cluster. Since data of persistent cache groups stored\n+on disk in files on each node (cache group partition files, configuration files, binary metadata) the snapshot will\n+contain a copy of the same files with keeping Ignite cluster node data directory structure and the node consistent ids.\n+\n+*Snapshot Consistency.*\n+\n+All snapshots you created are fully consistent in terms of concurrent cluster-wide operations and all ongoing changes of\n+system files on the local node. Primary and backup cache group partitions will be also fully consistent in created\n+snapshots.\n+\n+The cluster-wide snapshot consistency achieved by triggering the\n+link:https://cwiki.apache.org/confluence/display/IGNITE/%28Partition+Map%29+Exchange+-+under+the+hood[Partition-Map-Exchange]\n+procedure. Doing this the cluster will eventually get a point in time when all previously started transactions\n+finished on primary and backups, and new ones are hold until a new snapshot operation will be started.\n+\n+The local system files consistency (e.g. cache group partition files, binary metadata files, configuration files) achieved\n+by copying them to the destination snapshot directory with tracking all concurrent ongoing changes. Tracking concurrent\n+changes during copying of cache group partition files will require additional space in Ignite system directory.", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "52cfd6e6b9202febfc7d8a5ee07e28c1a02eee44"}, "originalPosition": 25}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NDM1MjcwMg==", "bodyText": "Didn't understand the sentence. what does '... as the Ignite native persistence does with keeping nodes consistentId in snapshot directory.' mean?", "url": "https://github.com/apache/ignite/pull/8128#discussion_r484352702", "createdAt": "2020-09-07T10:46:32Z", "author": {"login": "Silberfuchs1"}, "path": "docs/_docs/persistence/snapshot.adoc", "diffHunk": "@@ -0,0 +1,181 @@\n+= Snapshots and recovery\n+\n+== Overview\n+\n+Apache Ignite 2.9 comes with an ability to create fully consistent cluster-wide snapshots for deployments with\n+the link:persistence/native-persistence[Ignite Native Persistence]. You can create at runtime any number of snapshots\n+of all configured persistent cache groups. The snapshot is a consistent copy of all cache group data files (except\n+structures used for crash recovery) for each baseline node in a cluster. Since data of persistent cache groups stored\n+on disk in files on each node (cache group partition files, configuration files, binary metadata) the snapshot will\n+contain a copy of the same files with keeping Ignite cluster node data directory structure and the node consistent ids.\n+\n+*Snapshot Consistency.*\n+\n+All snapshots you created are fully consistent in terms of concurrent cluster-wide operations and all ongoing changes of\n+system files on the local node. Primary and backup cache group partitions will be also fully consistent in created\n+snapshots.\n+\n+The cluster-wide snapshot consistency achieved by triggering the\n+link:https://cwiki.apache.org/confluence/display/IGNITE/%28Partition+Map%29+Exchange+-+under+the+hood[Partition-Map-Exchange]\n+procedure. Doing this the cluster will eventually get a point in time when all previously started transactions\n+finished on primary and backups, and new ones are hold until a new snapshot operation will be started.\n+\n+The local system files consistency (e.g. cache group partition files, binary metadata files, configuration files) achieved\n+by copying them to the destination snapshot directory with tracking all concurrent ongoing changes. Tracking concurrent\n+changes during copying of cache group partition files will require additional space in Ignite system directory.\n+\n+*Snapshot Structure.*\n+\n+The created snapshot has the same\n+link:https://cwiki.apache.org/confluence/display/IGNITE/Ignite+Persistent+Store+-+under+the+hood#IgnitePersistentStoreunderthehood-FoldersStructure[Directory Structure]\n+as the Ignite native persistence does with keeping nodes `consistentId` in snapshot directory. The `wal` directory will", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "52cfd6e6b9202febfc7d8a5ee07e28c1a02eee44"}, "originalPosition": 31}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NDQwMTcwMw==", "bodyText": "A configured Ignite native persistence directory requires additional disk space (up to the current size of this directory).", "url": "https://github.com/apache/ignite/pull/8128#discussion_r484401703", "createdAt": "2020-09-07T12:28:01Z", "author": {"login": "Silberfuchs1"}, "path": "docs/_docs/persistence/snapshot.adoc", "diffHunk": "@@ -0,0 +1,181 @@\n+= Snapshots and recovery\n+\n+== Overview\n+\n+Apache Ignite 2.9 comes with an ability to create fully consistent cluster-wide snapshots for deployments with\n+the link:persistence/native-persistence[Ignite Native Persistence]. You can create at runtime any number of snapshots\n+of all configured persistent cache groups. The snapshot is a consistent copy of all cache group data files (except\n+structures used for crash recovery) for each baseline node in a cluster. Since data of persistent cache groups stored\n+on disk in files on each node (cache group partition files, configuration files, binary metadata) the snapshot will\n+contain a copy of the same files with keeping Ignite cluster node data directory structure and the node consistent ids.\n+\n+*Snapshot Consistency.*\n+\n+All snapshots you created are fully consistent in terms of concurrent cluster-wide operations and all ongoing changes of\n+system files on the local node. Primary and backup cache group partitions will be also fully consistent in created\n+snapshots.\n+\n+The cluster-wide snapshot consistency achieved by triggering the\n+link:https://cwiki.apache.org/confluence/display/IGNITE/%28Partition+Map%29+Exchange+-+under+the+hood[Partition-Map-Exchange]\n+procedure. Doing this the cluster will eventually get a point in time when all previously started transactions\n+finished on primary and backups, and new ones are hold until a new snapshot operation will be started.\n+\n+The local system files consistency (e.g. cache group partition files, binary metadata files, configuration files) achieved\n+by copying them to the destination snapshot directory with tracking all concurrent ongoing changes. Tracking concurrent\n+changes during copying of cache group partition files will require additional space in Ignite system directory.\n+\n+*Snapshot Structure.*\n+\n+The created snapshot has the same\n+link:https://cwiki.apache.org/confluence/display/IGNITE/Ignite+Persistent+Store+-+under+the+hood#IgnitePersistentStoreunderthehood-FoldersStructure[Directory Structure]\n+as the Ignite native persistence does with keeping nodes `consistentId` in snapshot directory. The `wal` directory will\n+be excluded from snapshot since recovery procedures are not necessary for cache group data files.\n+\n+.Example of snapshot directory structure\n+[source,shell]\n+----\n+work\n+\u2514\u2500\u2500 snapshots\n+    \u2514\u2500\u2500 backup23012020\n+        \u251c\u2500\u2500 binary_meta\n+        \u2502   \u251c\u2500\u2500 snapshot_IgniteClusterSnapshotSelfTest0\n+        \u2502   \u251c\u2500\u2500 snapshot_IgniteClusterSnapshotSelfTest1\n+        \u2502   \u2514\u2500\u2500 snapshot_IgniteClusterSnapshotSelfTest2\n+        \u251c\u2500\u2500 db\n+        \u2502   \u251c\u2500\u2500 snapshot_IgniteClusterSnapshotSelfTest0\n+        \u2502   \u2502   \u2514\u2500\u2500 cache-txCache\n+        \u2502   \u2502       \u251c\u2500\u2500 cache_data.dat\n+        \u2502   \u2502       \u251c\u2500\u2500 part-3.bin\n+        \u2502   \u2502       \u251c\u2500\u2500 part-4.bin\n+        \u2502   \u2502       \u2514\u2500\u2500 part-6.bin\n+        \u2502   \u251c\u2500\u2500 snapshot_IgniteClusterSnapshotSelfTest1\n+        \u2502   \u2502   \u2514\u2500\u2500 cache-txCache\n+        \u2502   \u2502       \u251c\u2500\u2500 cache_data.dat\n+        \u2502   \u2502       \u251c\u2500\u2500 part-1.bin\n+        \u2502   \u2502       \u251c\u2500\u2500 part-5.bin\n+        \u2502   \u2502       \u2514\u2500\u2500 part-7.bin\n+        \u2502   \u2514\u2500\u2500 snapshot_IgniteClusterSnapshotSelfTest2\n+        \u2502       \u2514\u2500\u2500 cache-txCache\n+        \u2502           \u251c\u2500\u2500 cache_data.dat\n+        \u2502           \u251c\u2500\u2500 part-0.bin\n+        \u2502           \u2514\u2500\u2500 part-2.bin\n+        \u2514\u2500\u2500 marshaller\n+----\n+\n+*Requirements.*\n+\n+You need an extra space on disk for the configured Ignite native persistence directory up to the current size this directory.", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "52cfd6e6b9202febfc7d8a5ee07e28c1a02eee44"}, "originalPosition": 67}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NDQwNDMxMA==", "bodyText": "This space will be used for storing intermediate snapshot results and cleaned up after the snapshot operation is completed.", "url": "https://github.com/apache/ignite/pull/8128#discussion_r484404310", "createdAt": "2020-09-07T12:33:03Z", "author": {"login": "Silberfuchs1"}, "path": "docs/_docs/persistence/snapshot.adoc", "diffHunk": "@@ -0,0 +1,181 @@\n+= Snapshots and recovery\n+\n+== Overview\n+\n+Apache Ignite 2.9 comes with an ability to create fully consistent cluster-wide snapshots for deployments with\n+the link:persistence/native-persistence[Ignite Native Persistence]. You can create at runtime any number of snapshots\n+of all configured persistent cache groups. The snapshot is a consistent copy of all cache group data files (except\n+structures used for crash recovery) for each baseline node in a cluster. Since data of persistent cache groups stored\n+on disk in files on each node (cache group partition files, configuration files, binary metadata) the snapshot will\n+contain a copy of the same files with keeping Ignite cluster node data directory structure and the node consistent ids.\n+\n+*Snapshot Consistency.*\n+\n+All snapshots you created are fully consistent in terms of concurrent cluster-wide operations and all ongoing changes of\n+system files on the local node. Primary and backup cache group partitions will be also fully consistent in created\n+snapshots.\n+\n+The cluster-wide snapshot consistency achieved by triggering the\n+link:https://cwiki.apache.org/confluence/display/IGNITE/%28Partition+Map%29+Exchange+-+under+the+hood[Partition-Map-Exchange]\n+procedure. Doing this the cluster will eventually get a point in time when all previously started transactions\n+finished on primary and backups, and new ones are hold until a new snapshot operation will be started.\n+\n+The local system files consistency (e.g. cache group partition files, binary metadata files, configuration files) achieved\n+by copying them to the destination snapshot directory with tracking all concurrent ongoing changes. Tracking concurrent\n+changes during copying of cache group partition files will require additional space in Ignite system directory.\n+\n+*Snapshot Structure.*\n+\n+The created snapshot has the same\n+link:https://cwiki.apache.org/confluence/display/IGNITE/Ignite+Persistent+Store+-+under+the+hood#IgnitePersistentStoreunderthehood-FoldersStructure[Directory Structure]\n+as the Ignite native persistence does with keeping nodes `consistentId` in snapshot directory. The `wal` directory will\n+be excluded from snapshot since recovery procedures are not necessary for cache group data files.\n+\n+.Example of snapshot directory structure\n+[source,shell]\n+----\n+work\n+\u2514\u2500\u2500 snapshots\n+    \u2514\u2500\u2500 backup23012020\n+        \u251c\u2500\u2500 binary_meta\n+        \u2502   \u251c\u2500\u2500 snapshot_IgniteClusterSnapshotSelfTest0\n+        \u2502   \u251c\u2500\u2500 snapshot_IgniteClusterSnapshotSelfTest1\n+        \u2502   \u2514\u2500\u2500 snapshot_IgniteClusterSnapshotSelfTest2\n+        \u251c\u2500\u2500 db\n+        \u2502   \u251c\u2500\u2500 snapshot_IgniteClusterSnapshotSelfTest0\n+        \u2502   \u2502   \u2514\u2500\u2500 cache-txCache\n+        \u2502   \u2502       \u251c\u2500\u2500 cache_data.dat\n+        \u2502   \u2502       \u251c\u2500\u2500 part-3.bin\n+        \u2502   \u2502       \u251c\u2500\u2500 part-4.bin\n+        \u2502   \u2502       \u2514\u2500\u2500 part-6.bin\n+        \u2502   \u251c\u2500\u2500 snapshot_IgniteClusterSnapshotSelfTest1\n+        \u2502   \u2502   \u2514\u2500\u2500 cache-txCache\n+        \u2502   \u2502       \u251c\u2500\u2500 cache_data.dat\n+        \u2502   \u2502       \u251c\u2500\u2500 part-1.bin\n+        \u2502   \u2502       \u251c\u2500\u2500 part-5.bin\n+        \u2502   \u2502       \u2514\u2500\u2500 part-7.bin\n+        \u2502   \u2514\u2500\u2500 snapshot_IgniteClusterSnapshotSelfTest2\n+        \u2502       \u2514\u2500\u2500 cache-txCache\n+        \u2502           \u251c\u2500\u2500 cache_data.dat\n+        \u2502           \u251c\u2500\u2500 part-0.bin\n+        \u2502           \u2514\u2500\u2500 part-2.bin\n+        \u2514\u2500\u2500 marshaller\n+----\n+\n+*Requirements.*\n+\n+You need an extra space on disk for the configured Ignite native persistence directory up to the current size this directory.\n+This space will be used for storing intermediate snapshot results and will be freed when the snapshot operation ends.", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "52cfd6e6b9202febfc7d8a5ee07e28c1a02eee44"}, "originalPosition": 68}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NDQwNTExMA==", "bodyText": "'...with your own production environment:'", "url": "https://github.com/apache/ignite/pull/8128#discussion_r484405110", "createdAt": "2020-09-07T12:34:25Z", "author": {"login": "Silberfuchs1"}, "path": "docs/_docs/persistence/snapshot.adoc", "diffHunk": "@@ -0,0 +1,181 @@\n+= Snapshots and recovery\n+\n+== Overview\n+\n+Apache Ignite 2.9 comes with an ability to create fully consistent cluster-wide snapshots for deployments with\n+the link:persistence/native-persistence[Ignite Native Persistence]. You can create at runtime any number of snapshots\n+of all configured persistent cache groups. The snapshot is a consistent copy of all cache group data files (except\n+structures used for crash recovery) for each baseline node in a cluster. Since data of persistent cache groups stored\n+on disk in files on each node (cache group partition files, configuration files, binary metadata) the snapshot will\n+contain a copy of the same files with keeping Ignite cluster node data directory structure and the node consistent ids.\n+\n+*Snapshot Consistency.*\n+\n+All snapshots you created are fully consistent in terms of concurrent cluster-wide operations and all ongoing changes of\n+system files on the local node. Primary and backup cache group partitions will be also fully consistent in created\n+snapshots.\n+\n+The cluster-wide snapshot consistency achieved by triggering the\n+link:https://cwiki.apache.org/confluence/display/IGNITE/%28Partition+Map%29+Exchange+-+under+the+hood[Partition-Map-Exchange]\n+procedure. Doing this the cluster will eventually get a point in time when all previously started transactions\n+finished on primary and backups, and new ones are hold until a new snapshot operation will be started.\n+\n+The local system files consistency (e.g. cache group partition files, binary metadata files, configuration files) achieved\n+by copying them to the destination snapshot directory with tracking all concurrent ongoing changes. Tracking concurrent\n+changes during copying of cache group partition files will require additional space in Ignite system directory.\n+\n+*Snapshot Structure.*\n+\n+The created snapshot has the same\n+link:https://cwiki.apache.org/confluence/display/IGNITE/Ignite+Persistent+Store+-+under+the+hood#IgnitePersistentStoreunderthehood-FoldersStructure[Directory Structure]\n+as the Ignite native persistence does with keeping nodes `consistentId` in snapshot directory. The `wal` directory will\n+be excluded from snapshot since recovery procedures are not necessary for cache group data files.\n+\n+.Example of snapshot directory structure\n+[source,shell]\n+----\n+work\n+\u2514\u2500\u2500 snapshots\n+    \u2514\u2500\u2500 backup23012020\n+        \u251c\u2500\u2500 binary_meta\n+        \u2502   \u251c\u2500\u2500 snapshot_IgniteClusterSnapshotSelfTest0\n+        \u2502   \u251c\u2500\u2500 snapshot_IgniteClusterSnapshotSelfTest1\n+        \u2502   \u2514\u2500\u2500 snapshot_IgniteClusterSnapshotSelfTest2\n+        \u251c\u2500\u2500 db\n+        \u2502   \u251c\u2500\u2500 snapshot_IgniteClusterSnapshotSelfTest0\n+        \u2502   \u2502   \u2514\u2500\u2500 cache-txCache\n+        \u2502   \u2502       \u251c\u2500\u2500 cache_data.dat\n+        \u2502   \u2502       \u251c\u2500\u2500 part-3.bin\n+        \u2502   \u2502       \u251c\u2500\u2500 part-4.bin\n+        \u2502   \u2502       \u2514\u2500\u2500 part-6.bin\n+        \u2502   \u251c\u2500\u2500 snapshot_IgniteClusterSnapshotSelfTest1\n+        \u2502   \u2502   \u2514\u2500\u2500 cache-txCache\n+        \u2502   \u2502       \u251c\u2500\u2500 cache_data.dat\n+        \u2502   \u2502       \u251c\u2500\u2500 part-1.bin\n+        \u2502   \u2502       \u251c\u2500\u2500 part-5.bin\n+        \u2502   \u2502       \u2514\u2500\u2500 part-7.bin\n+        \u2502   \u2514\u2500\u2500 snapshot_IgniteClusterSnapshotSelfTest2\n+        \u2502       \u2514\u2500\u2500 cache-txCache\n+        \u2502           \u251c\u2500\u2500 cache_data.dat\n+        \u2502           \u251c\u2500\u2500 part-0.bin\n+        \u2502           \u2514\u2500\u2500 part-2.bin\n+        \u2514\u2500\u2500 marshaller\n+----\n+\n+*Requirements.*\n+\n+You need an extra space on disk for the configured Ignite native persistence directory up to the current size this directory.\n+This space will be used for storing intermediate snapshot results and will be freed when the snapshot operation ends.\n+\n+*Limitations.*\n+\n+The snapshot procedure has some limitations that you should be aware of before using it at your production environment:", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "52cfd6e6b9202febfc7d8a5ee07e28c1a02eee44"}, "originalPosition": 72}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NDQwNjE0MA==", "bodyText": "taking a snapshot of a particular cache or cache group is not supported;", "url": "https://github.com/apache/ignite/pull/8128#discussion_r484406140", "createdAt": "2020-09-07T12:36:30Z", "author": {"login": "Silberfuchs1"}, "path": "docs/_docs/persistence/snapshot.adoc", "diffHunk": "@@ -0,0 +1,181 @@\n+= Snapshots and recovery\n+\n+== Overview\n+\n+Apache Ignite 2.9 comes with an ability to create fully consistent cluster-wide snapshots for deployments with\n+the link:persistence/native-persistence[Ignite Native Persistence]. You can create at runtime any number of snapshots\n+of all configured persistent cache groups. The snapshot is a consistent copy of all cache group data files (except\n+structures used for crash recovery) for each baseline node in a cluster. Since data of persistent cache groups stored\n+on disk in files on each node (cache group partition files, configuration files, binary metadata) the snapshot will\n+contain a copy of the same files with keeping Ignite cluster node data directory structure and the node consistent ids.\n+\n+*Snapshot Consistency.*\n+\n+All snapshots you created are fully consistent in terms of concurrent cluster-wide operations and all ongoing changes of\n+system files on the local node. Primary and backup cache group partitions will be also fully consistent in created\n+snapshots.\n+\n+The cluster-wide snapshot consistency achieved by triggering the\n+link:https://cwiki.apache.org/confluence/display/IGNITE/%28Partition+Map%29+Exchange+-+under+the+hood[Partition-Map-Exchange]\n+procedure. Doing this the cluster will eventually get a point in time when all previously started transactions\n+finished on primary and backups, and new ones are hold until a new snapshot operation will be started.\n+\n+The local system files consistency (e.g. cache group partition files, binary metadata files, configuration files) achieved\n+by copying them to the destination snapshot directory with tracking all concurrent ongoing changes. Tracking concurrent\n+changes during copying of cache group partition files will require additional space in Ignite system directory.\n+\n+*Snapshot Structure.*\n+\n+The created snapshot has the same\n+link:https://cwiki.apache.org/confluence/display/IGNITE/Ignite+Persistent+Store+-+under+the+hood#IgnitePersistentStoreunderthehood-FoldersStructure[Directory Structure]\n+as the Ignite native persistence does with keeping nodes `consistentId` in snapshot directory. The `wal` directory will\n+be excluded from snapshot since recovery procedures are not necessary for cache group data files.\n+\n+.Example of snapshot directory structure\n+[source,shell]\n+----\n+work\n+\u2514\u2500\u2500 snapshots\n+    \u2514\u2500\u2500 backup23012020\n+        \u251c\u2500\u2500 binary_meta\n+        \u2502   \u251c\u2500\u2500 snapshot_IgniteClusterSnapshotSelfTest0\n+        \u2502   \u251c\u2500\u2500 snapshot_IgniteClusterSnapshotSelfTest1\n+        \u2502   \u2514\u2500\u2500 snapshot_IgniteClusterSnapshotSelfTest2\n+        \u251c\u2500\u2500 db\n+        \u2502   \u251c\u2500\u2500 snapshot_IgniteClusterSnapshotSelfTest0\n+        \u2502   \u2502   \u2514\u2500\u2500 cache-txCache\n+        \u2502   \u2502       \u251c\u2500\u2500 cache_data.dat\n+        \u2502   \u2502       \u251c\u2500\u2500 part-3.bin\n+        \u2502   \u2502       \u251c\u2500\u2500 part-4.bin\n+        \u2502   \u2502       \u2514\u2500\u2500 part-6.bin\n+        \u2502   \u251c\u2500\u2500 snapshot_IgniteClusterSnapshotSelfTest1\n+        \u2502   \u2502   \u2514\u2500\u2500 cache-txCache\n+        \u2502   \u2502       \u251c\u2500\u2500 cache_data.dat\n+        \u2502   \u2502       \u251c\u2500\u2500 part-1.bin\n+        \u2502   \u2502       \u251c\u2500\u2500 part-5.bin\n+        \u2502   \u2502       \u2514\u2500\u2500 part-7.bin\n+        \u2502   \u2514\u2500\u2500 snapshot_IgniteClusterSnapshotSelfTest2\n+        \u2502       \u2514\u2500\u2500 cache-txCache\n+        \u2502           \u251c\u2500\u2500 cache_data.dat\n+        \u2502           \u251c\u2500\u2500 part-0.bin\n+        \u2502           \u2514\u2500\u2500 part-2.bin\n+        \u2514\u2500\u2500 marshaller\n+----\n+\n+*Requirements.*\n+\n+You need an extra space on disk for the configured Ignite native persistence directory up to the current size this directory.\n+This space will be used for storing intermediate snapshot results and will be freed when the snapshot operation ends.\n+\n+*Limitations.*\n+\n+The snapshot procedure has some limitations that you should be aware of before using it at your production environment:\n+\n+* taking a snapshot of particular cache or cache group not supported;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "52cfd6e6b9202febfc7d8a5ee07e28c1a02eee44"}, "originalPosition": 74}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NDQwNjMzMQ==", "bodyText": "in-memory caches will not be included into a snapshot;", "url": "https://github.com/apache/ignite/pull/8128#discussion_r484406331", "createdAt": "2020-09-07T12:36:52Z", "author": {"login": "Silberfuchs1"}, "path": "docs/_docs/persistence/snapshot.adoc", "diffHunk": "@@ -0,0 +1,181 @@\n+= Snapshots and recovery\n+\n+== Overview\n+\n+Apache Ignite 2.9 comes with an ability to create fully consistent cluster-wide snapshots for deployments with\n+the link:persistence/native-persistence[Ignite Native Persistence]. You can create at runtime any number of snapshots\n+of all configured persistent cache groups. The snapshot is a consistent copy of all cache group data files (except\n+structures used for crash recovery) for each baseline node in a cluster. Since data of persistent cache groups stored\n+on disk in files on each node (cache group partition files, configuration files, binary metadata) the snapshot will\n+contain a copy of the same files with keeping Ignite cluster node data directory structure and the node consistent ids.\n+\n+*Snapshot Consistency.*\n+\n+All snapshots you created are fully consistent in terms of concurrent cluster-wide operations and all ongoing changes of\n+system files on the local node. Primary and backup cache group partitions will be also fully consistent in created\n+snapshots.\n+\n+The cluster-wide snapshot consistency achieved by triggering the\n+link:https://cwiki.apache.org/confluence/display/IGNITE/%28Partition+Map%29+Exchange+-+under+the+hood[Partition-Map-Exchange]\n+procedure. Doing this the cluster will eventually get a point in time when all previously started transactions\n+finished on primary and backups, and new ones are hold until a new snapshot operation will be started.\n+\n+The local system files consistency (e.g. cache group partition files, binary metadata files, configuration files) achieved\n+by copying them to the destination snapshot directory with tracking all concurrent ongoing changes. Tracking concurrent\n+changes during copying of cache group partition files will require additional space in Ignite system directory.\n+\n+*Snapshot Structure.*\n+\n+The created snapshot has the same\n+link:https://cwiki.apache.org/confluence/display/IGNITE/Ignite+Persistent+Store+-+under+the+hood#IgnitePersistentStoreunderthehood-FoldersStructure[Directory Structure]\n+as the Ignite native persistence does with keeping nodes `consistentId` in snapshot directory. The `wal` directory will\n+be excluded from snapshot since recovery procedures are not necessary for cache group data files.\n+\n+.Example of snapshot directory structure\n+[source,shell]\n+----\n+work\n+\u2514\u2500\u2500 snapshots\n+    \u2514\u2500\u2500 backup23012020\n+        \u251c\u2500\u2500 binary_meta\n+        \u2502   \u251c\u2500\u2500 snapshot_IgniteClusterSnapshotSelfTest0\n+        \u2502   \u251c\u2500\u2500 snapshot_IgniteClusterSnapshotSelfTest1\n+        \u2502   \u2514\u2500\u2500 snapshot_IgniteClusterSnapshotSelfTest2\n+        \u251c\u2500\u2500 db\n+        \u2502   \u251c\u2500\u2500 snapshot_IgniteClusterSnapshotSelfTest0\n+        \u2502   \u2502   \u2514\u2500\u2500 cache-txCache\n+        \u2502   \u2502       \u251c\u2500\u2500 cache_data.dat\n+        \u2502   \u2502       \u251c\u2500\u2500 part-3.bin\n+        \u2502   \u2502       \u251c\u2500\u2500 part-4.bin\n+        \u2502   \u2502       \u2514\u2500\u2500 part-6.bin\n+        \u2502   \u251c\u2500\u2500 snapshot_IgniteClusterSnapshotSelfTest1\n+        \u2502   \u2502   \u2514\u2500\u2500 cache-txCache\n+        \u2502   \u2502       \u251c\u2500\u2500 cache_data.dat\n+        \u2502   \u2502       \u251c\u2500\u2500 part-1.bin\n+        \u2502   \u2502       \u251c\u2500\u2500 part-5.bin\n+        \u2502   \u2502       \u2514\u2500\u2500 part-7.bin\n+        \u2502   \u2514\u2500\u2500 snapshot_IgniteClusterSnapshotSelfTest2\n+        \u2502       \u2514\u2500\u2500 cache-txCache\n+        \u2502           \u251c\u2500\u2500 cache_data.dat\n+        \u2502           \u251c\u2500\u2500 part-0.bin\n+        \u2502           \u2514\u2500\u2500 part-2.bin\n+        \u2514\u2500\u2500 marshaller\n+----\n+\n+*Requirements.*\n+\n+You need an extra space on disk for the configured Ignite native persistence directory up to the current size this directory.\n+This space will be used for storing intermediate snapshot results and will be freed when the snapshot operation ends.\n+\n+*Limitations.*\n+\n+The snapshot procedure has some limitations that you should be aware of before using it at your production environment:\n+\n+* taking a snapshot of particular cache or cache group not supported;\n+* in-memory caches will not be included into snapshot;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "52cfd6e6b9202febfc7d8a5ee07e28c1a02eee44"}, "originalPosition": 75}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NDQwNjQ3Nw==", "bodyText": "encrypted caches are not supported and will be ignored;", "url": "https://github.com/apache/ignite/pull/8128#discussion_r484406477", "createdAt": "2020-09-07T12:37:09Z", "author": {"login": "Silberfuchs1"}, "path": "docs/_docs/persistence/snapshot.adoc", "diffHunk": "@@ -0,0 +1,181 @@\n+= Snapshots and recovery\n+\n+== Overview\n+\n+Apache Ignite 2.9 comes with an ability to create fully consistent cluster-wide snapshots for deployments with\n+the link:persistence/native-persistence[Ignite Native Persistence]. You can create at runtime any number of snapshots\n+of all configured persistent cache groups. The snapshot is a consistent copy of all cache group data files (except\n+structures used for crash recovery) for each baseline node in a cluster. Since data of persistent cache groups stored\n+on disk in files on each node (cache group partition files, configuration files, binary metadata) the snapshot will\n+contain a copy of the same files with keeping Ignite cluster node data directory structure and the node consistent ids.\n+\n+*Snapshot Consistency.*\n+\n+All snapshots you created are fully consistent in terms of concurrent cluster-wide operations and all ongoing changes of\n+system files on the local node. Primary and backup cache group partitions will be also fully consistent in created\n+snapshots.\n+\n+The cluster-wide snapshot consistency achieved by triggering the\n+link:https://cwiki.apache.org/confluence/display/IGNITE/%28Partition+Map%29+Exchange+-+under+the+hood[Partition-Map-Exchange]\n+procedure. Doing this the cluster will eventually get a point in time when all previously started transactions\n+finished on primary and backups, and new ones are hold until a new snapshot operation will be started.\n+\n+The local system files consistency (e.g. cache group partition files, binary metadata files, configuration files) achieved\n+by copying them to the destination snapshot directory with tracking all concurrent ongoing changes. Tracking concurrent\n+changes during copying of cache group partition files will require additional space in Ignite system directory.\n+\n+*Snapshot Structure.*\n+\n+The created snapshot has the same\n+link:https://cwiki.apache.org/confluence/display/IGNITE/Ignite+Persistent+Store+-+under+the+hood#IgnitePersistentStoreunderthehood-FoldersStructure[Directory Structure]\n+as the Ignite native persistence does with keeping nodes `consistentId` in snapshot directory. The `wal` directory will\n+be excluded from snapshot since recovery procedures are not necessary for cache group data files.\n+\n+.Example of snapshot directory structure\n+[source,shell]\n+----\n+work\n+\u2514\u2500\u2500 snapshots\n+    \u2514\u2500\u2500 backup23012020\n+        \u251c\u2500\u2500 binary_meta\n+        \u2502   \u251c\u2500\u2500 snapshot_IgniteClusterSnapshotSelfTest0\n+        \u2502   \u251c\u2500\u2500 snapshot_IgniteClusterSnapshotSelfTest1\n+        \u2502   \u2514\u2500\u2500 snapshot_IgniteClusterSnapshotSelfTest2\n+        \u251c\u2500\u2500 db\n+        \u2502   \u251c\u2500\u2500 snapshot_IgniteClusterSnapshotSelfTest0\n+        \u2502   \u2502   \u2514\u2500\u2500 cache-txCache\n+        \u2502   \u2502       \u251c\u2500\u2500 cache_data.dat\n+        \u2502   \u2502       \u251c\u2500\u2500 part-3.bin\n+        \u2502   \u2502       \u251c\u2500\u2500 part-4.bin\n+        \u2502   \u2502       \u2514\u2500\u2500 part-6.bin\n+        \u2502   \u251c\u2500\u2500 snapshot_IgniteClusterSnapshotSelfTest1\n+        \u2502   \u2502   \u2514\u2500\u2500 cache-txCache\n+        \u2502   \u2502       \u251c\u2500\u2500 cache_data.dat\n+        \u2502   \u2502       \u251c\u2500\u2500 part-1.bin\n+        \u2502   \u2502       \u251c\u2500\u2500 part-5.bin\n+        \u2502   \u2502       \u2514\u2500\u2500 part-7.bin\n+        \u2502   \u2514\u2500\u2500 snapshot_IgniteClusterSnapshotSelfTest2\n+        \u2502       \u2514\u2500\u2500 cache-txCache\n+        \u2502           \u251c\u2500\u2500 cache_data.dat\n+        \u2502           \u251c\u2500\u2500 part-0.bin\n+        \u2502           \u2514\u2500\u2500 part-2.bin\n+        \u2514\u2500\u2500 marshaller\n+----\n+\n+*Requirements.*\n+\n+You need an extra space on disk for the configured Ignite native persistence directory up to the current size this directory.\n+This space will be used for storing intermediate snapshot results and will be freed when the snapshot operation ends.\n+\n+*Limitations.*\n+\n+The snapshot procedure has some limitations that you should be aware of before using it at your production environment:\n+\n+* taking a snapshot of particular cache or cache group not supported;\n+* in-memory caches will not be included into snapshot;\n+* encrypted caches not supported and will be ignored;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "52cfd6e6b9202febfc7d8a5ee07e28c1a02eee44"}, "originalPosition": 76}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NDQwOTQ3Mw==", "bodyText": "you can start only one snapshot operation at a time;\nMy question is: is the snapshot operation started automatically, or it can be started manually?\nIf the answer is 'automatically', then you need to say: 'only one snapshot operation can be started at once' or\n'only one snapshot operation at a time can be started'", "url": "https://github.com/apache/ignite/pull/8128#discussion_r484409473", "createdAt": "2020-09-07T12:43:06Z", "author": {"login": "Silberfuchs1"}, "path": "docs/_docs/persistence/snapshot.adoc", "diffHunk": "@@ -0,0 +1,181 @@\n+= Snapshots and recovery\n+\n+== Overview\n+\n+Apache Ignite 2.9 comes with an ability to create fully consistent cluster-wide snapshots for deployments with\n+the link:persistence/native-persistence[Ignite Native Persistence]. You can create at runtime any number of snapshots\n+of all configured persistent cache groups. The snapshot is a consistent copy of all cache group data files (except\n+structures used for crash recovery) for each baseline node in a cluster. Since data of persistent cache groups stored\n+on disk in files on each node (cache group partition files, configuration files, binary metadata) the snapshot will\n+contain a copy of the same files with keeping Ignite cluster node data directory structure and the node consistent ids.\n+\n+*Snapshot Consistency.*\n+\n+All snapshots you created are fully consistent in terms of concurrent cluster-wide operations and all ongoing changes of\n+system files on the local node. Primary and backup cache group partitions will be also fully consistent in created\n+snapshots.\n+\n+The cluster-wide snapshot consistency achieved by triggering the\n+link:https://cwiki.apache.org/confluence/display/IGNITE/%28Partition+Map%29+Exchange+-+under+the+hood[Partition-Map-Exchange]\n+procedure. Doing this the cluster will eventually get a point in time when all previously started transactions\n+finished on primary and backups, and new ones are hold until a new snapshot operation will be started.\n+\n+The local system files consistency (e.g. cache group partition files, binary metadata files, configuration files) achieved\n+by copying them to the destination snapshot directory with tracking all concurrent ongoing changes. Tracking concurrent\n+changes during copying of cache group partition files will require additional space in Ignite system directory.\n+\n+*Snapshot Structure.*\n+\n+The created snapshot has the same\n+link:https://cwiki.apache.org/confluence/display/IGNITE/Ignite+Persistent+Store+-+under+the+hood#IgnitePersistentStoreunderthehood-FoldersStructure[Directory Structure]\n+as the Ignite native persistence does with keeping nodes `consistentId` in snapshot directory. The `wal` directory will\n+be excluded from snapshot since recovery procedures are not necessary for cache group data files.\n+\n+.Example of snapshot directory structure\n+[source,shell]\n+----\n+work\n+\u2514\u2500\u2500 snapshots\n+    \u2514\u2500\u2500 backup23012020\n+        \u251c\u2500\u2500 binary_meta\n+        \u2502   \u251c\u2500\u2500 snapshot_IgniteClusterSnapshotSelfTest0\n+        \u2502   \u251c\u2500\u2500 snapshot_IgniteClusterSnapshotSelfTest1\n+        \u2502   \u2514\u2500\u2500 snapshot_IgniteClusterSnapshotSelfTest2\n+        \u251c\u2500\u2500 db\n+        \u2502   \u251c\u2500\u2500 snapshot_IgniteClusterSnapshotSelfTest0\n+        \u2502   \u2502   \u2514\u2500\u2500 cache-txCache\n+        \u2502   \u2502       \u251c\u2500\u2500 cache_data.dat\n+        \u2502   \u2502       \u251c\u2500\u2500 part-3.bin\n+        \u2502   \u2502       \u251c\u2500\u2500 part-4.bin\n+        \u2502   \u2502       \u2514\u2500\u2500 part-6.bin\n+        \u2502   \u251c\u2500\u2500 snapshot_IgniteClusterSnapshotSelfTest1\n+        \u2502   \u2502   \u2514\u2500\u2500 cache-txCache\n+        \u2502   \u2502       \u251c\u2500\u2500 cache_data.dat\n+        \u2502   \u2502       \u251c\u2500\u2500 part-1.bin\n+        \u2502   \u2502       \u251c\u2500\u2500 part-5.bin\n+        \u2502   \u2502       \u2514\u2500\u2500 part-7.bin\n+        \u2502   \u2514\u2500\u2500 snapshot_IgniteClusterSnapshotSelfTest2\n+        \u2502       \u2514\u2500\u2500 cache-txCache\n+        \u2502           \u251c\u2500\u2500 cache_data.dat\n+        \u2502           \u251c\u2500\u2500 part-0.bin\n+        \u2502           \u2514\u2500\u2500 part-2.bin\n+        \u2514\u2500\u2500 marshaller\n+----\n+\n+*Requirements.*\n+\n+You need an extra space on disk for the configured Ignite native persistence directory up to the current size this directory.\n+This space will be used for storing intermediate snapshot results and will be freed when the snapshot operation ends.\n+\n+*Limitations.*\n+\n+The snapshot procedure has some limitations that you should be aware of before using it at your production environment:\n+\n+* taking a snapshot of particular cache or cache group not supported;\n+* in-memory caches will not be included into snapshot;\n+* encrypted caches not supported and will be ignored;\n+* only single snapshot operation can be started at once;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "52cfd6e6b9202febfc7d8a5ee07e28c1a02eee44"}, "originalPosition": 77}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NDQxMTQ3NQ==", "bodyText": "...leaves the cluster", "url": "https://github.com/apache/ignite/pull/8128#discussion_r484411475", "createdAt": "2020-09-07T12:47:00Z", "author": {"login": "Silberfuchs1"}, "path": "docs/_docs/persistence/snapshot.adoc", "diffHunk": "@@ -0,0 +1,181 @@\n+= Snapshots and recovery\n+\n+== Overview\n+\n+Apache Ignite 2.9 comes with an ability to create fully consistent cluster-wide snapshots for deployments with\n+the link:persistence/native-persistence[Ignite Native Persistence]. You can create at runtime any number of snapshots\n+of all configured persistent cache groups. The snapshot is a consistent copy of all cache group data files (except\n+structures used for crash recovery) for each baseline node in a cluster. Since data of persistent cache groups stored\n+on disk in files on each node (cache group partition files, configuration files, binary metadata) the snapshot will\n+contain a copy of the same files with keeping Ignite cluster node data directory structure and the node consistent ids.\n+\n+*Snapshot Consistency.*\n+\n+All snapshots you created are fully consistent in terms of concurrent cluster-wide operations and all ongoing changes of\n+system files on the local node. Primary and backup cache group partitions will be also fully consistent in created\n+snapshots.\n+\n+The cluster-wide snapshot consistency achieved by triggering the\n+link:https://cwiki.apache.org/confluence/display/IGNITE/%28Partition+Map%29+Exchange+-+under+the+hood[Partition-Map-Exchange]\n+procedure. Doing this the cluster will eventually get a point in time when all previously started transactions\n+finished on primary and backups, and new ones are hold until a new snapshot operation will be started.\n+\n+The local system files consistency (e.g. cache group partition files, binary metadata files, configuration files) achieved\n+by copying them to the destination snapshot directory with tracking all concurrent ongoing changes. Tracking concurrent\n+changes during copying of cache group partition files will require additional space in Ignite system directory.\n+\n+*Snapshot Structure.*\n+\n+The created snapshot has the same\n+link:https://cwiki.apache.org/confluence/display/IGNITE/Ignite+Persistent+Store+-+under+the+hood#IgnitePersistentStoreunderthehood-FoldersStructure[Directory Structure]\n+as the Ignite native persistence does with keeping nodes `consistentId` in snapshot directory. The `wal` directory will\n+be excluded from snapshot since recovery procedures are not necessary for cache group data files.\n+\n+.Example of snapshot directory structure\n+[source,shell]\n+----\n+work\n+\u2514\u2500\u2500 snapshots\n+    \u2514\u2500\u2500 backup23012020\n+        \u251c\u2500\u2500 binary_meta\n+        \u2502   \u251c\u2500\u2500 snapshot_IgniteClusterSnapshotSelfTest0\n+        \u2502   \u251c\u2500\u2500 snapshot_IgniteClusterSnapshotSelfTest1\n+        \u2502   \u2514\u2500\u2500 snapshot_IgniteClusterSnapshotSelfTest2\n+        \u251c\u2500\u2500 db\n+        \u2502   \u251c\u2500\u2500 snapshot_IgniteClusterSnapshotSelfTest0\n+        \u2502   \u2502   \u2514\u2500\u2500 cache-txCache\n+        \u2502   \u2502       \u251c\u2500\u2500 cache_data.dat\n+        \u2502   \u2502       \u251c\u2500\u2500 part-3.bin\n+        \u2502   \u2502       \u251c\u2500\u2500 part-4.bin\n+        \u2502   \u2502       \u2514\u2500\u2500 part-6.bin\n+        \u2502   \u251c\u2500\u2500 snapshot_IgniteClusterSnapshotSelfTest1\n+        \u2502   \u2502   \u2514\u2500\u2500 cache-txCache\n+        \u2502   \u2502       \u251c\u2500\u2500 cache_data.dat\n+        \u2502   \u2502       \u251c\u2500\u2500 part-1.bin\n+        \u2502   \u2502       \u251c\u2500\u2500 part-5.bin\n+        \u2502   \u2502       \u2514\u2500\u2500 part-7.bin\n+        \u2502   \u2514\u2500\u2500 snapshot_IgniteClusterSnapshotSelfTest2\n+        \u2502       \u2514\u2500\u2500 cache-txCache\n+        \u2502           \u251c\u2500\u2500 cache_data.dat\n+        \u2502           \u251c\u2500\u2500 part-0.bin\n+        \u2502           \u2514\u2500\u2500 part-2.bin\n+        \u2514\u2500\u2500 marshaller\n+----\n+\n+*Requirements.*\n+\n+You need an extra space on disk for the configured Ignite native persistence directory up to the current size this directory.\n+This space will be used for storing intermediate snapshot results and will be freed when the snapshot operation ends.\n+\n+*Limitations.*\n+\n+The snapshot procedure has some limitations that you should be aware of before using it at your production environment:\n+\n+* taking a snapshot of particular cache or cache group not supported;\n+* in-memory caches will not be included into snapshot;\n+* encrypted caches not supported and will be ignored;\n+* only single snapshot operation can be started at once;\n+* snapshot procedure will be interrupted if any baseline node leave the cluster;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "52cfd6e6b9202febfc7d8a5ee07e28c1a02eee44"}, "originalPosition": 78}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NDQxNDI4NA==", "bodyText": "Didn't understand the sentence. Looks like it's not finished.\nMaybe like this: 'snapshot recovery is performed at the same baseline topology with the same node consistent Id.'", "url": "https://github.com/apache/ignite/pull/8128#discussion_r484414284", "createdAt": "2020-09-07T12:52:17Z", "author": {"login": "Silberfuchs1"}, "path": "docs/_docs/persistence/snapshot.adoc", "diffHunk": "@@ -0,0 +1,181 @@\n+= Snapshots and recovery\n+\n+== Overview\n+\n+Apache Ignite 2.9 comes with an ability to create fully consistent cluster-wide snapshots for deployments with\n+the link:persistence/native-persistence[Ignite Native Persistence]. You can create at runtime any number of snapshots\n+of all configured persistent cache groups. The snapshot is a consistent copy of all cache group data files (except\n+structures used for crash recovery) for each baseline node in a cluster. Since data of persistent cache groups stored\n+on disk in files on each node (cache group partition files, configuration files, binary metadata) the snapshot will\n+contain a copy of the same files with keeping Ignite cluster node data directory structure and the node consistent ids.\n+\n+*Snapshot Consistency.*\n+\n+All snapshots you created are fully consistent in terms of concurrent cluster-wide operations and all ongoing changes of\n+system files on the local node. Primary and backup cache group partitions will be also fully consistent in created\n+snapshots.\n+\n+The cluster-wide snapshot consistency achieved by triggering the\n+link:https://cwiki.apache.org/confluence/display/IGNITE/%28Partition+Map%29+Exchange+-+under+the+hood[Partition-Map-Exchange]\n+procedure. Doing this the cluster will eventually get a point in time when all previously started transactions\n+finished on primary and backups, and new ones are hold until a new snapshot operation will be started.\n+\n+The local system files consistency (e.g. cache group partition files, binary metadata files, configuration files) achieved\n+by copying them to the destination snapshot directory with tracking all concurrent ongoing changes. Tracking concurrent\n+changes during copying of cache group partition files will require additional space in Ignite system directory.\n+\n+*Snapshot Structure.*\n+\n+The created snapshot has the same\n+link:https://cwiki.apache.org/confluence/display/IGNITE/Ignite+Persistent+Store+-+under+the+hood#IgnitePersistentStoreunderthehood-FoldersStructure[Directory Structure]\n+as the Ignite native persistence does with keeping nodes `consistentId` in snapshot directory. The `wal` directory will\n+be excluded from snapshot since recovery procedures are not necessary for cache group data files.\n+\n+.Example of snapshot directory structure\n+[source,shell]\n+----\n+work\n+\u2514\u2500\u2500 snapshots\n+    \u2514\u2500\u2500 backup23012020\n+        \u251c\u2500\u2500 binary_meta\n+        \u2502   \u251c\u2500\u2500 snapshot_IgniteClusterSnapshotSelfTest0\n+        \u2502   \u251c\u2500\u2500 snapshot_IgniteClusterSnapshotSelfTest1\n+        \u2502   \u2514\u2500\u2500 snapshot_IgniteClusterSnapshotSelfTest2\n+        \u251c\u2500\u2500 db\n+        \u2502   \u251c\u2500\u2500 snapshot_IgniteClusterSnapshotSelfTest0\n+        \u2502   \u2502   \u2514\u2500\u2500 cache-txCache\n+        \u2502   \u2502       \u251c\u2500\u2500 cache_data.dat\n+        \u2502   \u2502       \u251c\u2500\u2500 part-3.bin\n+        \u2502   \u2502       \u251c\u2500\u2500 part-4.bin\n+        \u2502   \u2502       \u2514\u2500\u2500 part-6.bin\n+        \u2502   \u251c\u2500\u2500 snapshot_IgniteClusterSnapshotSelfTest1\n+        \u2502   \u2502   \u2514\u2500\u2500 cache-txCache\n+        \u2502   \u2502       \u251c\u2500\u2500 cache_data.dat\n+        \u2502   \u2502       \u251c\u2500\u2500 part-1.bin\n+        \u2502   \u2502       \u251c\u2500\u2500 part-5.bin\n+        \u2502   \u2502       \u2514\u2500\u2500 part-7.bin\n+        \u2502   \u2514\u2500\u2500 snapshot_IgniteClusterSnapshotSelfTest2\n+        \u2502       \u2514\u2500\u2500 cache-txCache\n+        \u2502           \u251c\u2500\u2500 cache_data.dat\n+        \u2502           \u251c\u2500\u2500 part-0.bin\n+        \u2502           \u2514\u2500\u2500 part-2.bin\n+        \u2514\u2500\u2500 marshaller\n+----\n+\n+*Requirements.*\n+\n+You need an extra space on disk for the configured Ignite native persistence directory up to the current size this directory.\n+This space will be used for storing intermediate snapshot results and will be freed when the snapshot operation ends.\n+\n+*Limitations.*\n+\n+The snapshot procedure has some limitations that you should be aware of before using it at your production environment:\n+\n+* taking a snapshot of particular cache or cache group not supported;\n+* in-memory caches will not be included into snapshot;\n+* encrypted caches not supported and will be ignored;\n+* only single snapshot operation can be started at once;\n+* snapshot procedure will be interrupted if any baseline node leave the cluster;\n+* snapshot recovery at the same baseline topology with the same consistent node id;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "52cfd6e6b9202febfc7d8a5ee07e28c1a02eee44"}, "originalPosition": 79}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NDQxNTg4Mg==", "bodyText": "The destination snapshot can be configured via IgniteConfiguration.", "url": "https://github.com/apache/ignite/pull/8128#discussion_r484415882", "createdAt": "2020-09-07T12:55:23Z", "author": {"login": "Silberfuchs1"}, "path": "docs/_docs/persistence/snapshot.adoc", "diffHunk": "@@ -0,0 +1,181 @@\n+= Snapshots and recovery\n+\n+== Overview\n+\n+Apache Ignite 2.9 comes with an ability to create fully consistent cluster-wide snapshots for deployments with\n+the link:persistence/native-persistence[Ignite Native Persistence]. You can create at runtime any number of snapshots\n+of all configured persistent cache groups. The snapshot is a consistent copy of all cache group data files (except\n+structures used for crash recovery) for each baseline node in a cluster. Since data of persistent cache groups stored\n+on disk in files on each node (cache group partition files, configuration files, binary metadata) the snapshot will\n+contain a copy of the same files with keeping Ignite cluster node data directory structure and the node consistent ids.\n+\n+*Snapshot Consistency.*\n+\n+All snapshots you created are fully consistent in terms of concurrent cluster-wide operations and all ongoing changes of\n+system files on the local node. Primary and backup cache group partitions will be also fully consistent in created\n+snapshots.\n+\n+The cluster-wide snapshot consistency achieved by triggering the\n+link:https://cwiki.apache.org/confluence/display/IGNITE/%28Partition+Map%29+Exchange+-+under+the+hood[Partition-Map-Exchange]\n+procedure. Doing this the cluster will eventually get a point in time when all previously started transactions\n+finished on primary and backups, and new ones are hold until a new snapshot operation will be started.\n+\n+The local system files consistency (e.g. cache group partition files, binary metadata files, configuration files) achieved\n+by copying them to the destination snapshot directory with tracking all concurrent ongoing changes. Tracking concurrent\n+changes during copying of cache group partition files will require additional space in Ignite system directory.\n+\n+*Snapshot Structure.*\n+\n+The created snapshot has the same\n+link:https://cwiki.apache.org/confluence/display/IGNITE/Ignite+Persistent+Store+-+under+the+hood#IgnitePersistentStoreunderthehood-FoldersStructure[Directory Structure]\n+as the Ignite native persistence does with keeping nodes `consistentId` in snapshot directory. The `wal` directory will\n+be excluded from snapshot since recovery procedures are not necessary for cache group data files.\n+\n+.Example of snapshot directory structure\n+[source,shell]\n+----\n+work\n+\u2514\u2500\u2500 snapshots\n+    \u2514\u2500\u2500 backup23012020\n+        \u251c\u2500\u2500 binary_meta\n+        \u2502   \u251c\u2500\u2500 snapshot_IgniteClusterSnapshotSelfTest0\n+        \u2502   \u251c\u2500\u2500 snapshot_IgniteClusterSnapshotSelfTest1\n+        \u2502   \u2514\u2500\u2500 snapshot_IgniteClusterSnapshotSelfTest2\n+        \u251c\u2500\u2500 db\n+        \u2502   \u251c\u2500\u2500 snapshot_IgniteClusterSnapshotSelfTest0\n+        \u2502   \u2502   \u2514\u2500\u2500 cache-txCache\n+        \u2502   \u2502       \u251c\u2500\u2500 cache_data.dat\n+        \u2502   \u2502       \u251c\u2500\u2500 part-3.bin\n+        \u2502   \u2502       \u251c\u2500\u2500 part-4.bin\n+        \u2502   \u2502       \u2514\u2500\u2500 part-6.bin\n+        \u2502   \u251c\u2500\u2500 snapshot_IgniteClusterSnapshotSelfTest1\n+        \u2502   \u2502   \u2514\u2500\u2500 cache-txCache\n+        \u2502   \u2502       \u251c\u2500\u2500 cache_data.dat\n+        \u2502   \u2502       \u251c\u2500\u2500 part-1.bin\n+        \u2502   \u2502       \u251c\u2500\u2500 part-5.bin\n+        \u2502   \u2502       \u2514\u2500\u2500 part-7.bin\n+        \u2502   \u2514\u2500\u2500 snapshot_IgniteClusterSnapshotSelfTest2\n+        \u2502       \u2514\u2500\u2500 cache-txCache\n+        \u2502           \u251c\u2500\u2500 cache_data.dat\n+        \u2502           \u251c\u2500\u2500 part-0.bin\n+        \u2502           \u2514\u2500\u2500 part-2.bin\n+        \u2514\u2500\u2500 marshaller\n+----\n+\n+*Requirements.*\n+\n+You need an extra space on disk for the configured Ignite native persistence directory up to the current size this directory.\n+This space will be used for storing intermediate snapshot results and will be freed when the snapshot operation ends.\n+\n+*Limitations.*\n+\n+The snapshot procedure has some limitations that you should be aware of before using it at your production environment:\n+\n+* taking a snapshot of particular cache or cache group not supported;\n+* in-memory caches will not be included into snapshot;\n+* encrypted caches not supported and will be ignored;\n+* only single snapshot operation can be started at once;\n+* snapshot procedure will be interrupted if any baseline node leave the cluster;\n+* snapshot recovery at the same baseline topology with the same consistent node id;\n+\n+== Configuration\n+\n+You may configure the destination snapshot directory via `IgniteConfiguration`.", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "52cfd6e6b9202febfc7d8a5ee07e28c1a02eee44"}, "originalPosition": 83}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NDQxNjM3NA==", "bodyText": "'...act like a tool...'", "url": "https://github.com/apache/ignite/pull/8128#discussion_r484416374", "createdAt": "2020-09-07T12:56:21Z", "author": {"login": "Silberfuchs1"}, "path": "docs/_docs/persistence/snapshot.adoc", "diffHunk": "@@ -0,0 +1,181 @@\n+= Snapshots and recovery\n+\n+== Overview\n+\n+Apache Ignite 2.9 comes with an ability to create fully consistent cluster-wide snapshots for deployments with\n+the link:persistence/native-persistence[Ignite Native Persistence]. You can create at runtime any number of snapshots\n+of all configured persistent cache groups. The snapshot is a consistent copy of all cache group data files (except\n+structures used for crash recovery) for each baseline node in a cluster. Since data of persistent cache groups stored\n+on disk in files on each node (cache group partition files, configuration files, binary metadata) the snapshot will\n+contain a copy of the same files with keeping Ignite cluster node data directory structure and the node consistent ids.\n+\n+*Snapshot Consistency.*\n+\n+All snapshots you created are fully consistent in terms of concurrent cluster-wide operations and all ongoing changes of\n+system files on the local node. Primary and backup cache group partitions will be also fully consistent in created\n+snapshots.\n+\n+The cluster-wide snapshot consistency achieved by triggering the\n+link:https://cwiki.apache.org/confluence/display/IGNITE/%28Partition+Map%29+Exchange+-+under+the+hood[Partition-Map-Exchange]\n+procedure. Doing this the cluster will eventually get a point in time when all previously started transactions\n+finished on primary and backups, and new ones are hold until a new snapshot operation will be started.\n+\n+The local system files consistency (e.g. cache group partition files, binary metadata files, configuration files) achieved\n+by copying them to the destination snapshot directory with tracking all concurrent ongoing changes. Tracking concurrent\n+changes during copying of cache group partition files will require additional space in Ignite system directory.\n+\n+*Snapshot Structure.*\n+\n+The created snapshot has the same\n+link:https://cwiki.apache.org/confluence/display/IGNITE/Ignite+Persistent+Store+-+under+the+hood#IgnitePersistentStoreunderthehood-FoldersStructure[Directory Structure]\n+as the Ignite native persistence does with keeping nodes `consistentId` in snapshot directory. The `wal` directory will\n+be excluded from snapshot since recovery procedures are not necessary for cache group data files.\n+\n+.Example of snapshot directory structure\n+[source,shell]\n+----\n+work\n+\u2514\u2500\u2500 snapshots\n+    \u2514\u2500\u2500 backup23012020\n+        \u251c\u2500\u2500 binary_meta\n+        \u2502   \u251c\u2500\u2500 snapshot_IgniteClusterSnapshotSelfTest0\n+        \u2502   \u251c\u2500\u2500 snapshot_IgniteClusterSnapshotSelfTest1\n+        \u2502   \u2514\u2500\u2500 snapshot_IgniteClusterSnapshotSelfTest2\n+        \u251c\u2500\u2500 db\n+        \u2502   \u251c\u2500\u2500 snapshot_IgniteClusterSnapshotSelfTest0\n+        \u2502   \u2502   \u2514\u2500\u2500 cache-txCache\n+        \u2502   \u2502       \u251c\u2500\u2500 cache_data.dat\n+        \u2502   \u2502       \u251c\u2500\u2500 part-3.bin\n+        \u2502   \u2502       \u251c\u2500\u2500 part-4.bin\n+        \u2502   \u2502       \u2514\u2500\u2500 part-6.bin\n+        \u2502   \u251c\u2500\u2500 snapshot_IgniteClusterSnapshotSelfTest1\n+        \u2502   \u2502   \u2514\u2500\u2500 cache-txCache\n+        \u2502   \u2502       \u251c\u2500\u2500 cache_data.dat\n+        \u2502   \u2502       \u251c\u2500\u2500 part-1.bin\n+        \u2502   \u2502       \u251c\u2500\u2500 part-5.bin\n+        \u2502   \u2502       \u2514\u2500\u2500 part-7.bin\n+        \u2502   \u2514\u2500\u2500 snapshot_IgniteClusterSnapshotSelfTest2\n+        \u2502       \u2514\u2500\u2500 cache-txCache\n+        \u2502           \u251c\u2500\u2500 cache_data.dat\n+        \u2502           \u251c\u2500\u2500 part-0.bin\n+        \u2502           \u2514\u2500\u2500 part-2.bin\n+        \u2514\u2500\u2500 marshaller\n+----\n+\n+*Requirements.*\n+\n+You need an extra space on disk for the configured Ignite native persistence directory up to the current size this directory.\n+This space will be used for storing intermediate snapshot results and will be freed when the snapshot operation ends.\n+\n+*Limitations.*\n+\n+The snapshot procedure has some limitations that you should be aware of before using it at your production environment:\n+\n+* taking a snapshot of particular cache or cache group not supported;\n+* in-memory caches will not be included into snapshot;\n+* encrypted caches not supported and will be ignored;\n+* only single snapshot operation can be started at once;\n+* snapshot procedure will be interrupted if any baseline node leave the cluster;\n+* snapshot recovery at the same baseline topology with the same consistent node id;\n+\n+== Configuration\n+\n+You may configure the destination snapshot directory via `IgniteConfiguration`.\n+\n+[tabs]\n+--\n+tab:XML[]\n+\n+[source, xml]\n+----\n+include::code-snippets/xml/snapshots.xml[tags=ignite-config;!discovery, indent=0]\n+\n+----\n+\n+tab:Java[]\n+\n+[source, java]\n+----\n+include::{javaCodeDir}/Snapshots.java[tags=config, indent=0]\n+\n+----\n+\n+tab:C#/.NET[]\n+tab:C++[]\n+--\n+\n+== Snapshot creation\n+\n+Ignite provides the ability to start a snapshot operation from the following interfaces:\n+\n+- link:#command-line[Command line]\n+- link:#jmx[JMX]\n+- link:#java-api[Java API]\n+\n+=== Command line\n+\n+Ignite ships `control.(sh|bat)` scripts, located in the `$IGNITE_HOME/bin` directory, that acts like a tool to", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "52cfd6e6b9202febfc7d8a5ee07e28c1a02eee44"}, "originalPosition": 117}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NDQxOTE5OQ==", "bodyText": "'...currently running one via...'", "url": "https://github.com/apache/ignite/pull/8128#discussion_r484419199", "createdAt": "2020-09-07T13:01:53Z", "author": {"login": "Silberfuchs1"}, "path": "docs/_docs/persistence/snapshot.adoc", "diffHunk": "@@ -0,0 +1,181 @@\n+= Snapshots and recovery\n+\n+== Overview\n+\n+Apache Ignite 2.9 comes with an ability to create fully consistent cluster-wide snapshots for deployments with\n+the link:persistence/native-persistence[Ignite Native Persistence]. You can create at runtime any number of snapshots\n+of all configured persistent cache groups. The snapshot is a consistent copy of all cache group data files (except\n+structures used for crash recovery) for each baseline node in a cluster. Since data of persistent cache groups stored\n+on disk in files on each node (cache group partition files, configuration files, binary metadata) the snapshot will\n+contain a copy of the same files with keeping Ignite cluster node data directory structure and the node consistent ids.\n+\n+*Snapshot Consistency.*\n+\n+All snapshots you created are fully consistent in terms of concurrent cluster-wide operations and all ongoing changes of\n+system files on the local node. Primary and backup cache group partitions will be also fully consistent in created\n+snapshots.\n+\n+The cluster-wide snapshot consistency achieved by triggering the\n+link:https://cwiki.apache.org/confluence/display/IGNITE/%28Partition+Map%29+Exchange+-+under+the+hood[Partition-Map-Exchange]\n+procedure. Doing this the cluster will eventually get a point in time when all previously started transactions\n+finished on primary and backups, and new ones are hold until a new snapshot operation will be started.\n+\n+The local system files consistency (e.g. cache group partition files, binary metadata files, configuration files) achieved\n+by copying them to the destination snapshot directory with tracking all concurrent ongoing changes. Tracking concurrent\n+changes during copying of cache group partition files will require additional space in Ignite system directory.\n+\n+*Snapshot Structure.*\n+\n+The created snapshot has the same\n+link:https://cwiki.apache.org/confluence/display/IGNITE/Ignite+Persistent+Store+-+under+the+hood#IgnitePersistentStoreunderthehood-FoldersStructure[Directory Structure]\n+as the Ignite native persistence does with keeping nodes `consistentId` in snapshot directory. The `wal` directory will\n+be excluded from snapshot since recovery procedures are not necessary for cache group data files.\n+\n+.Example of snapshot directory structure\n+[source,shell]\n+----\n+work\n+\u2514\u2500\u2500 snapshots\n+    \u2514\u2500\u2500 backup23012020\n+        \u251c\u2500\u2500 binary_meta\n+        \u2502   \u251c\u2500\u2500 snapshot_IgniteClusterSnapshotSelfTest0\n+        \u2502   \u251c\u2500\u2500 snapshot_IgniteClusterSnapshotSelfTest1\n+        \u2502   \u2514\u2500\u2500 snapshot_IgniteClusterSnapshotSelfTest2\n+        \u251c\u2500\u2500 db\n+        \u2502   \u251c\u2500\u2500 snapshot_IgniteClusterSnapshotSelfTest0\n+        \u2502   \u2502   \u2514\u2500\u2500 cache-txCache\n+        \u2502   \u2502       \u251c\u2500\u2500 cache_data.dat\n+        \u2502   \u2502       \u251c\u2500\u2500 part-3.bin\n+        \u2502   \u2502       \u251c\u2500\u2500 part-4.bin\n+        \u2502   \u2502       \u2514\u2500\u2500 part-6.bin\n+        \u2502   \u251c\u2500\u2500 snapshot_IgniteClusterSnapshotSelfTest1\n+        \u2502   \u2502   \u2514\u2500\u2500 cache-txCache\n+        \u2502   \u2502       \u251c\u2500\u2500 cache_data.dat\n+        \u2502   \u2502       \u251c\u2500\u2500 part-1.bin\n+        \u2502   \u2502       \u251c\u2500\u2500 part-5.bin\n+        \u2502   \u2502       \u2514\u2500\u2500 part-7.bin\n+        \u2502   \u2514\u2500\u2500 snapshot_IgniteClusterSnapshotSelfTest2\n+        \u2502       \u2514\u2500\u2500 cache-txCache\n+        \u2502           \u251c\u2500\u2500 cache_data.dat\n+        \u2502           \u251c\u2500\u2500 part-0.bin\n+        \u2502           \u2514\u2500\u2500 part-2.bin\n+        \u2514\u2500\u2500 marshaller\n+----\n+\n+*Requirements.*\n+\n+You need an extra space on disk for the configured Ignite native persistence directory up to the current size this directory.\n+This space will be used for storing intermediate snapshot results and will be freed when the snapshot operation ends.\n+\n+*Limitations.*\n+\n+The snapshot procedure has some limitations that you should be aware of before using it at your production environment:\n+\n+* taking a snapshot of particular cache or cache group not supported;\n+* in-memory caches will not be included into snapshot;\n+* encrypted caches not supported and will be ignored;\n+* only single snapshot operation can be started at once;\n+* snapshot procedure will be interrupted if any baseline node leave the cluster;\n+* snapshot recovery at the same baseline topology with the same consistent node id;\n+\n+== Configuration\n+\n+You may configure the destination snapshot directory via `IgniteConfiguration`.\n+\n+[tabs]\n+--\n+tab:XML[]\n+\n+[source, xml]\n+----\n+include::code-snippets/xml/snapshots.xml[tags=ignite-config;!discovery, indent=0]\n+\n+----\n+\n+tab:Java[]\n+\n+[source, java]\n+----\n+include::{javaCodeDir}/Snapshots.java[tags=config, indent=0]\n+\n+----\n+\n+tab:C#/.NET[]\n+tab:C++[]\n+--\n+\n+== Snapshot creation\n+\n+Ignite provides the ability to start a snapshot operation from the following interfaces:\n+\n+- link:#command-line[Command line]\n+- link:#jmx[JMX]\n+- link:#java-api[Java API]\n+\n+=== Command line\n+\n+Ignite ships `control.(sh|bat)` scripts, located in the `$IGNITE_HOME/bin` directory, that acts like a tool to\n+start or cancel snapshot operation from the command line. The following commands can be used with `control.(sh|bat)`:\n+\n+[source,shell]\n+----\n+#Create cluster snapshot:\n+control.(sh|bat) --snapshot create snapshot_name\n+\n+#Cancel running snapshot:\n+control.(sh|bat) --snapshot cancel snapshot_name\n+\n+#Kill running snapshot:\n+control.(sh|bat) --kill SNAPSHOT snapshot_name\n+----\n+\n+=== JMX\n+\n+You can start snapshot operation or cancel currently running via the `SnapshotMXBean` interface:", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "52cfd6e6b9202febfc7d8a5ee07e28c1a02eee44"}, "originalPosition": 134}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NDQ0MDY4Mw==", "bodyText": "NOTE: Removing data from the $IGNITE_HOME/work directory is performed at your own risk.", "url": "https://github.com/apache/ignite/pull/8128#discussion_r484440683", "createdAt": "2020-09-07T13:45:27Z", "author": {"login": "Silberfuchs1"}, "path": "docs/_docs/persistence/snapshot.adoc", "diffHunk": "@@ -0,0 +1,181 @@\n+= Snapshots and recovery\n+\n+== Overview\n+\n+Apache Ignite 2.9 comes with an ability to create fully consistent cluster-wide snapshots for deployments with\n+the link:persistence/native-persistence[Ignite Native Persistence]. You can create at runtime any number of snapshots\n+of all configured persistent cache groups. The snapshot is a consistent copy of all cache group data files (except\n+structures used for crash recovery) for each baseline node in a cluster. Since data of persistent cache groups stored\n+on disk in files on each node (cache group partition files, configuration files, binary metadata) the snapshot will\n+contain a copy of the same files with keeping Ignite cluster node data directory structure and the node consistent ids.\n+\n+*Snapshot Consistency.*\n+\n+All snapshots you created are fully consistent in terms of concurrent cluster-wide operations and all ongoing changes of\n+system files on the local node. Primary and backup cache group partitions will be also fully consistent in created\n+snapshots.\n+\n+The cluster-wide snapshot consistency achieved by triggering the\n+link:https://cwiki.apache.org/confluence/display/IGNITE/%28Partition+Map%29+Exchange+-+under+the+hood[Partition-Map-Exchange]\n+procedure. Doing this the cluster will eventually get a point in time when all previously started transactions\n+finished on primary and backups, and new ones are hold until a new snapshot operation will be started.\n+\n+The local system files consistency (e.g. cache group partition files, binary metadata files, configuration files) achieved\n+by copying them to the destination snapshot directory with tracking all concurrent ongoing changes. Tracking concurrent\n+changes during copying of cache group partition files will require additional space in Ignite system directory.\n+\n+*Snapshot Structure.*\n+\n+The created snapshot has the same\n+link:https://cwiki.apache.org/confluence/display/IGNITE/Ignite+Persistent+Store+-+under+the+hood#IgnitePersistentStoreunderthehood-FoldersStructure[Directory Structure]\n+as the Ignite native persistence does with keeping nodes `consistentId` in snapshot directory. The `wal` directory will\n+be excluded from snapshot since recovery procedures are not necessary for cache group data files.\n+\n+.Example of snapshot directory structure\n+[source,shell]\n+----\n+work\n+\u2514\u2500\u2500 snapshots\n+    \u2514\u2500\u2500 backup23012020\n+        \u251c\u2500\u2500 binary_meta\n+        \u2502   \u251c\u2500\u2500 snapshot_IgniteClusterSnapshotSelfTest0\n+        \u2502   \u251c\u2500\u2500 snapshot_IgniteClusterSnapshotSelfTest1\n+        \u2502   \u2514\u2500\u2500 snapshot_IgniteClusterSnapshotSelfTest2\n+        \u251c\u2500\u2500 db\n+        \u2502   \u251c\u2500\u2500 snapshot_IgniteClusterSnapshotSelfTest0\n+        \u2502   \u2502   \u2514\u2500\u2500 cache-txCache\n+        \u2502   \u2502       \u251c\u2500\u2500 cache_data.dat\n+        \u2502   \u2502       \u251c\u2500\u2500 part-3.bin\n+        \u2502   \u2502       \u251c\u2500\u2500 part-4.bin\n+        \u2502   \u2502       \u2514\u2500\u2500 part-6.bin\n+        \u2502   \u251c\u2500\u2500 snapshot_IgniteClusterSnapshotSelfTest1\n+        \u2502   \u2502   \u2514\u2500\u2500 cache-txCache\n+        \u2502   \u2502       \u251c\u2500\u2500 cache_data.dat\n+        \u2502   \u2502       \u251c\u2500\u2500 part-1.bin\n+        \u2502   \u2502       \u251c\u2500\u2500 part-5.bin\n+        \u2502   \u2502       \u2514\u2500\u2500 part-7.bin\n+        \u2502   \u2514\u2500\u2500 snapshot_IgniteClusterSnapshotSelfTest2\n+        \u2502       \u2514\u2500\u2500 cache-txCache\n+        \u2502           \u251c\u2500\u2500 cache_data.dat\n+        \u2502           \u251c\u2500\u2500 part-0.bin\n+        \u2502           \u2514\u2500\u2500 part-2.bin\n+        \u2514\u2500\u2500 marshaller\n+----\n+\n+*Requirements.*\n+\n+You need an extra space on disk for the configured Ignite native persistence directory up to the current size this directory.\n+This space will be used for storing intermediate snapshot results and will be freed when the snapshot operation ends.\n+\n+*Limitations.*\n+\n+The snapshot procedure has some limitations that you should be aware of before using it at your production environment:\n+\n+* taking a snapshot of particular cache or cache group not supported;\n+* in-memory caches will not be included into snapshot;\n+* encrypted caches not supported and will be ignored;\n+* only single snapshot operation can be started at once;\n+* snapshot procedure will be interrupted if any baseline node leave the cluster;\n+* snapshot recovery at the same baseline topology with the same consistent node id;\n+\n+== Configuration\n+\n+You may configure the destination snapshot directory via `IgniteConfiguration`.\n+\n+[tabs]\n+--\n+tab:XML[]\n+\n+[source, xml]\n+----\n+include::code-snippets/xml/snapshots.xml[tags=ignite-config;!discovery, indent=0]\n+\n+----\n+\n+tab:Java[]\n+\n+[source, java]\n+----\n+include::{javaCodeDir}/Snapshots.java[tags=config, indent=0]\n+\n+----\n+\n+tab:C#/.NET[]\n+tab:C++[]\n+--\n+\n+== Snapshot creation\n+\n+Ignite provides the ability to start a snapshot operation from the following interfaces:\n+\n+- link:#command-line[Command line]\n+- link:#jmx[JMX]\n+- link:#java-api[Java API]\n+\n+=== Command line\n+\n+Ignite ships `control.(sh|bat)` scripts, located in the `$IGNITE_HOME/bin` directory, that acts like a tool to\n+start or cancel snapshot operation from the command line. The following commands can be used with `control.(sh|bat)`:\n+\n+[source,shell]\n+----\n+#Create cluster snapshot:\n+control.(sh|bat) --snapshot create snapshot_name\n+\n+#Cancel running snapshot:\n+control.(sh|bat) --snapshot cancel snapshot_name\n+\n+#Kill running snapshot:\n+control.(sh|bat) --kill SNAPSHOT snapshot_name\n+----\n+\n+=== JMX\n+\n+You can start snapshot operation or cancel currently running via the `SnapshotMXBean` interface:\n+\n+[cols=\"1,1\",opts=\"header\"]\n+|===\n+|Method | Description\n+|createSnapshot(String snpName) | Create cluster-wide snapshot.\n+|cancelSnapshot(String snpName) | Cancel started cluster-wide snapshot on the node initiator.\n+|===\n+\n+=== Java API\n+\n+The snapshot operation can be started using Java API:\n+\n+[tabs]\n+--\n+tab:Java[]\n+\n+[source, java]\n+----\n+include::{javaCodeDir}/Snapshots.java[tags=create, indent=0]\n+----\n+--\n+\n+== Snapshot restore (manually)\n+\n+NOTE: Pay attention in case of removing any data from the `$IGNITE_HOME/work` directory. You do it at your own risk.", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "52cfd6e6b9202febfc7d8a5ee07e28c1a02eee44"}, "originalPosition": 159}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NDQ0NDA4Nw==", "bodyText": "in order to recover the data from a particular snapshot, you need to start the same cluster with the same configuration...\n'configuration on these files.' - which files? Data files? Then maybe 'in these files'? Or 'of these files'?", "url": "https://github.com/apache/ignite/pull/8128#discussion_r484444087", "createdAt": "2020-09-07T13:51:46Z", "author": {"login": "Silberfuchs1"}, "path": "docs/_docs/persistence/snapshot.adoc", "diffHunk": "@@ -0,0 +1,181 @@\n+= Snapshots and recovery\n+\n+== Overview\n+\n+Apache Ignite 2.9 comes with an ability to create fully consistent cluster-wide snapshots for deployments with\n+the link:persistence/native-persistence[Ignite Native Persistence]. You can create at runtime any number of snapshots\n+of all configured persistent cache groups. The snapshot is a consistent copy of all cache group data files (except\n+structures used for crash recovery) for each baseline node in a cluster. Since data of persistent cache groups stored\n+on disk in files on each node (cache group partition files, configuration files, binary metadata) the snapshot will\n+contain a copy of the same files with keeping Ignite cluster node data directory structure and the node consistent ids.\n+\n+*Snapshot Consistency.*\n+\n+All snapshots you created are fully consistent in terms of concurrent cluster-wide operations and all ongoing changes of\n+system files on the local node. Primary and backup cache group partitions will be also fully consistent in created\n+snapshots.\n+\n+The cluster-wide snapshot consistency achieved by triggering the\n+link:https://cwiki.apache.org/confluence/display/IGNITE/%28Partition+Map%29+Exchange+-+under+the+hood[Partition-Map-Exchange]\n+procedure. Doing this the cluster will eventually get a point in time when all previously started transactions\n+finished on primary and backups, and new ones are hold until a new snapshot operation will be started.\n+\n+The local system files consistency (e.g. cache group partition files, binary metadata files, configuration files) achieved\n+by copying them to the destination snapshot directory with tracking all concurrent ongoing changes. Tracking concurrent\n+changes during copying of cache group partition files will require additional space in Ignite system directory.\n+\n+*Snapshot Structure.*\n+\n+The created snapshot has the same\n+link:https://cwiki.apache.org/confluence/display/IGNITE/Ignite+Persistent+Store+-+under+the+hood#IgnitePersistentStoreunderthehood-FoldersStructure[Directory Structure]\n+as the Ignite native persistence does with keeping nodes `consistentId` in snapshot directory. The `wal` directory will\n+be excluded from snapshot since recovery procedures are not necessary for cache group data files.\n+\n+.Example of snapshot directory structure\n+[source,shell]\n+----\n+work\n+\u2514\u2500\u2500 snapshots\n+    \u2514\u2500\u2500 backup23012020\n+        \u251c\u2500\u2500 binary_meta\n+        \u2502   \u251c\u2500\u2500 snapshot_IgniteClusterSnapshotSelfTest0\n+        \u2502   \u251c\u2500\u2500 snapshot_IgniteClusterSnapshotSelfTest1\n+        \u2502   \u2514\u2500\u2500 snapshot_IgniteClusterSnapshotSelfTest2\n+        \u251c\u2500\u2500 db\n+        \u2502   \u251c\u2500\u2500 snapshot_IgniteClusterSnapshotSelfTest0\n+        \u2502   \u2502   \u2514\u2500\u2500 cache-txCache\n+        \u2502   \u2502       \u251c\u2500\u2500 cache_data.dat\n+        \u2502   \u2502       \u251c\u2500\u2500 part-3.bin\n+        \u2502   \u2502       \u251c\u2500\u2500 part-4.bin\n+        \u2502   \u2502       \u2514\u2500\u2500 part-6.bin\n+        \u2502   \u251c\u2500\u2500 snapshot_IgniteClusterSnapshotSelfTest1\n+        \u2502   \u2502   \u2514\u2500\u2500 cache-txCache\n+        \u2502   \u2502       \u251c\u2500\u2500 cache_data.dat\n+        \u2502   \u2502       \u251c\u2500\u2500 part-1.bin\n+        \u2502   \u2502       \u251c\u2500\u2500 part-5.bin\n+        \u2502   \u2502       \u2514\u2500\u2500 part-7.bin\n+        \u2502   \u2514\u2500\u2500 snapshot_IgniteClusterSnapshotSelfTest2\n+        \u2502       \u2514\u2500\u2500 cache-txCache\n+        \u2502           \u251c\u2500\u2500 cache_data.dat\n+        \u2502           \u251c\u2500\u2500 part-0.bin\n+        \u2502           \u2514\u2500\u2500 part-2.bin\n+        \u2514\u2500\u2500 marshaller\n+----\n+\n+*Requirements.*\n+\n+You need an extra space on disk for the configured Ignite native persistence directory up to the current size this directory.\n+This space will be used for storing intermediate snapshot results and will be freed when the snapshot operation ends.\n+\n+*Limitations.*\n+\n+The snapshot procedure has some limitations that you should be aware of before using it at your production environment:\n+\n+* taking a snapshot of particular cache or cache group not supported;\n+* in-memory caches will not be included into snapshot;\n+* encrypted caches not supported and will be ignored;\n+* only single snapshot operation can be started at once;\n+* snapshot procedure will be interrupted if any baseline node leave the cluster;\n+* snapshot recovery at the same baseline topology with the same consistent node id;\n+\n+== Configuration\n+\n+You may configure the destination snapshot directory via `IgniteConfiguration`.\n+\n+[tabs]\n+--\n+tab:XML[]\n+\n+[source, xml]\n+----\n+include::code-snippets/xml/snapshots.xml[tags=ignite-config;!discovery, indent=0]\n+\n+----\n+\n+tab:Java[]\n+\n+[source, java]\n+----\n+include::{javaCodeDir}/Snapshots.java[tags=config, indent=0]\n+\n+----\n+\n+tab:C#/.NET[]\n+tab:C++[]\n+--\n+\n+== Snapshot creation\n+\n+Ignite provides the ability to start a snapshot operation from the following interfaces:\n+\n+- link:#command-line[Command line]\n+- link:#jmx[JMX]\n+- link:#java-api[Java API]\n+\n+=== Command line\n+\n+Ignite ships `control.(sh|bat)` scripts, located in the `$IGNITE_HOME/bin` directory, that acts like a tool to\n+start or cancel snapshot operation from the command line. The following commands can be used with `control.(sh|bat)`:\n+\n+[source,shell]\n+----\n+#Create cluster snapshot:\n+control.(sh|bat) --snapshot create snapshot_name\n+\n+#Cancel running snapshot:\n+control.(sh|bat) --snapshot cancel snapshot_name\n+\n+#Kill running snapshot:\n+control.(sh|bat) --kill SNAPSHOT snapshot_name\n+----\n+\n+=== JMX\n+\n+You can start snapshot operation or cancel currently running via the `SnapshotMXBean` interface:\n+\n+[cols=\"1,1\",opts=\"header\"]\n+|===\n+|Method | Description\n+|createSnapshot(String snpName) | Create cluster-wide snapshot.\n+|cancelSnapshot(String snpName) | Cancel started cluster-wide snapshot on the node initiator.\n+|===\n+\n+=== Java API\n+\n+The snapshot operation can be started using Java API:\n+\n+[tabs]\n+--\n+tab:Java[]\n+\n+[source, java]\n+----\n+include::{javaCodeDir}/Snapshots.java[tags=create, indent=0]\n+----\n+--\n+\n+== Snapshot restore (manually)\n+\n+NOTE: Pay attention in case of removing any data from the `$IGNITE_HOME/work` directory. You do it at your own risk.\n+\n+Currently, the restore procedure is fully manual. Since the snapshot is a consistent copy of all data files for each node,\n+to recover from the particular snapshot you need to start the same cluster with the same configuration on these files.", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "52cfd6e6b9202febfc7d8a5ee07e28c1a02eee44"}, "originalPosition": 162}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NDQ0NTIxMA==", "bodyText": "It'd be better to name this section like 'Cluster restoring from a snapshot (manual)'", "url": "https://github.com/apache/ignite/pull/8128#discussion_r484445210", "createdAt": "2020-09-07T13:53:49Z", "author": {"login": "Silberfuchs1"}, "path": "docs/_docs/persistence/snapshot.adoc", "diffHunk": "@@ -0,0 +1,181 @@\n+= Snapshots and recovery\n+\n+== Overview\n+\n+Apache Ignite 2.9 comes with an ability to create fully consistent cluster-wide snapshots for deployments with\n+the link:persistence/native-persistence[Ignite Native Persistence]. You can create at runtime any number of snapshots\n+of all configured persistent cache groups. The snapshot is a consistent copy of all cache group data files (except\n+structures used for crash recovery) for each baseline node in a cluster. Since data of persistent cache groups stored\n+on disk in files on each node (cache group partition files, configuration files, binary metadata) the snapshot will\n+contain a copy of the same files with keeping Ignite cluster node data directory structure and the node consistent ids.\n+\n+*Snapshot Consistency.*\n+\n+All snapshots you created are fully consistent in terms of concurrent cluster-wide operations and all ongoing changes of\n+system files on the local node. Primary and backup cache group partitions will be also fully consistent in created\n+snapshots.\n+\n+The cluster-wide snapshot consistency achieved by triggering the\n+link:https://cwiki.apache.org/confluence/display/IGNITE/%28Partition+Map%29+Exchange+-+under+the+hood[Partition-Map-Exchange]\n+procedure. Doing this the cluster will eventually get a point in time when all previously started transactions\n+finished on primary and backups, and new ones are hold until a new snapshot operation will be started.\n+\n+The local system files consistency (e.g. cache group partition files, binary metadata files, configuration files) achieved\n+by copying them to the destination snapshot directory with tracking all concurrent ongoing changes. Tracking concurrent\n+changes during copying of cache group partition files will require additional space in Ignite system directory.\n+\n+*Snapshot Structure.*\n+\n+The created snapshot has the same\n+link:https://cwiki.apache.org/confluence/display/IGNITE/Ignite+Persistent+Store+-+under+the+hood#IgnitePersistentStoreunderthehood-FoldersStructure[Directory Structure]\n+as the Ignite native persistence does with keeping nodes `consistentId` in snapshot directory. The `wal` directory will\n+be excluded from snapshot since recovery procedures are not necessary for cache group data files.\n+\n+.Example of snapshot directory structure\n+[source,shell]\n+----\n+work\n+\u2514\u2500\u2500 snapshots\n+    \u2514\u2500\u2500 backup23012020\n+        \u251c\u2500\u2500 binary_meta\n+        \u2502   \u251c\u2500\u2500 snapshot_IgniteClusterSnapshotSelfTest0\n+        \u2502   \u251c\u2500\u2500 snapshot_IgniteClusterSnapshotSelfTest1\n+        \u2502   \u2514\u2500\u2500 snapshot_IgniteClusterSnapshotSelfTest2\n+        \u251c\u2500\u2500 db\n+        \u2502   \u251c\u2500\u2500 snapshot_IgniteClusterSnapshotSelfTest0\n+        \u2502   \u2502   \u2514\u2500\u2500 cache-txCache\n+        \u2502   \u2502       \u251c\u2500\u2500 cache_data.dat\n+        \u2502   \u2502       \u251c\u2500\u2500 part-3.bin\n+        \u2502   \u2502       \u251c\u2500\u2500 part-4.bin\n+        \u2502   \u2502       \u2514\u2500\u2500 part-6.bin\n+        \u2502   \u251c\u2500\u2500 snapshot_IgniteClusterSnapshotSelfTest1\n+        \u2502   \u2502   \u2514\u2500\u2500 cache-txCache\n+        \u2502   \u2502       \u251c\u2500\u2500 cache_data.dat\n+        \u2502   \u2502       \u251c\u2500\u2500 part-1.bin\n+        \u2502   \u2502       \u251c\u2500\u2500 part-5.bin\n+        \u2502   \u2502       \u2514\u2500\u2500 part-7.bin\n+        \u2502   \u2514\u2500\u2500 snapshot_IgniteClusterSnapshotSelfTest2\n+        \u2502       \u2514\u2500\u2500 cache-txCache\n+        \u2502           \u251c\u2500\u2500 cache_data.dat\n+        \u2502           \u251c\u2500\u2500 part-0.bin\n+        \u2502           \u2514\u2500\u2500 part-2.bin\n+        \u2514\u2500\u2500 marshaller\n+----\n+\n+*Requirements.*\n+\n+You need an extra space on disk for the configured Ignite native persistence directory up to the current size this directory.\n+This space will be used for storing intermediate snapshot results and will be freed when the snapshot operation ends.\n+\n+*Limitations.*\n+\n+The snapshot procedure has some limitations that you should be aware of before using it at your production environment:\n+\n+* taking a snapshot of particular cache or cache group not supported;\n+* in-memory caches will not be included into snapshot;\n+* encrypted caches not supported and will be ignored;\n+* only single snapshot operation can be started at once;\n+* snapshot procedure will be interrupted if any baseline node leave the cluster;\n+* snapshot recovery at the same baseline topology with the same consistent node id;\n+\n+== Configuration\n+\n+You may configure the destination snapshot directory via `IgniteConfiguration`.\n+\n+[tabs]\n+--\n+tab:XML[]\n+\n+[source, xml]\n+----\n+include::code-snippets/xml/snapshots.xml[tags=ignite-config;!discovery, indent=0]\n+\n+----\n+\n+tab:Java[]\n+\n+[source, java]\n+----\n+include::{javaCodeDir}/Snapshots.java[tags=config, indent=0]\n+\n+----\n+\n+tab:C#/.NET[]\n+tab:C++[]\n+--\n+\n+== Snapshot creation\n+\n+Ignite provides the ability to start a snapshot operation from the following interfaces:\n+\n+- link:#command-line[Command line]\n+- link:#jmx[JMX]\n+- link:#java-api[Java API]\n+\n+=== Command line\n+\n+Ignite ships `control.(sh|bat)` scripts, located in the `$IGNITE_HOME/bin` directory, that acts like a tool to\n+start or cancel snapshot operation from the command line. The following commands can be used with `control.(sh|bat)`:\n+\n+[source,shell]\n+----\n+#Create cluster snapshot:\n+control.(sh|bat) --snapshot create snapshot_name\n+\n+#Cancel running snapshot:\n+control.(sh|bat) --snapshot cancel snapshot_name\n+\n+#Kill running snapshot:\n+control.(sh|bat) --kill SNAPSHOT snapshot_name\n+----\n+\n+=== JMX\n+\n+You can start snapshot operation or cancel currently running via the `SnapshotMXBean` interface:\n+\n+[cols=\"1,1\",opts=\"header\"]\n+|===\n+|Method | Description\n+|createSnapshot(String snpName) | Create cluster-wide snapshot.\n+|cancelSnapshot(String snpName) | Cancel started cluster-wide snapshot on the node initiator.\n+|===\n+\n+=== Java API\n+\n+The snapshot operation can be started using Java API:\n+\n+[tabs]\n+--\n+tab:Java[]\n+\n+[source, java]\n+----\n+include::{javaCodeDir}/Snapshots.java[tags=create, indent=0]\n+----\n+--\n+\n+== Snapshot restore (manually)", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "52cfd6e6b9202febfc7d8a5ee07e28c1a02eee44"}, "originalPosition": 157}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NDQ0NTYxMw==", "bodyText": "... the data recovery procedure...", "url": "https://github.com/apache/ignite/pull/8128#discussion_r484445613", "createdAt": "2020-09-07T13:54:39Z", "author": {"login": "Silberfuchs1"}, "path": "docs/_docs/persistence/snapshot.adoc", "diffHunk": "@@ -0,0 +1,181 @@\n+= Snapshots and recovery\n+\n+== Overview\n+\n+Apache Ignite 2.9 comes with an ability to create fully consistent cluster-wide snapshots for deployments with\n+the link:persistence/native-persistence[Ignite Native Persistence]. You can create at runtime any number of snapshots\n+of all configured persistent cache groups. The snapshot is a consistent copy of all cache group data files (except\n+structures used for crash recovery) for each baseline node in a cluster. Since data of persistent cache groups stored\n+on disk in files on each node (cache group partition files, configuration files, binary metadata) the snapshot will\n+contain a copy of the same files with keeping Ignite cluster node data directory structure and the node consistent ids.\n+\n+*Snapshot Consistency.*\n+\n+All snapshots you created are fully consistent in terms of concurrent cluster-wide operations and all ongoing changes of\n+system files on the local node. Primary and backup cache group partitions will be also fully consistent in created\n+snapshots.\n+\n+The cluster-wide snapshot consistency achieved by triggering the\n+link:https://cwiki.apache.org/confluence/display/IGNITE/%28Partition+Map%29+Exchange+-+under+the+hood[Partition-Map-Exchange]\n+procedure. Doing this the cluster will eventually get a point in time when all previously started transactions\n+finished on primary and backups, and new ones are hold until a new snapshot operation will be started.\n+\n+The local system files consistency (e.g. cache group partition files, binary metadata files, configuration files) achieved\n+by copying them to the destination snapshot directory with tracking all concurrent ongoing changes. Tracking concurrent\n+changes during copying of cache group partition files will require additional space in Ignite system directory.\n+\n+*Snapshot Structure.*\n+\n+The created snapshot has the same\n+link:https://cwiki.apache.org/confluence/display/IGNITE/Ignite+Persistent+Store+-+under+the+hood#IgnitePersistentStoreunderthehood-FoldersStructure[Directory Structure]\n+as the Ignite native persistence does with keeping nodes `consistentId` in snapshot directory. The `wal` directory will\n+be excluded from snapshot since recovery procedures are not necessary for cache group data files.\n+\n+.Example of snapshot directory structure\n+[source,shell]\n+----\n+work\n+\u2514\u2500\u2500 snapshots\n+    \u2514\u2500\u2500 backup23012020\n+        \u251c\u2500\u2500 binary_meta\n+        \u2502   \u251c\u2500\u2500 snapshot_IgniteClusterSnapshotSelfTest0\n+        \u2502   \u251c\u2500\u2500 snapshot_IgniteClusterSnapshotSelfTest1\n+        \u2502   \u2514\u2500\u2500 snapshot_IgniteClusterSnapshotSelfTest2\n+        \u251c\u2500\u2500 db\n+        \u2502   \u251c\u2500\u2500 snapshot_IgniteClusterSnapshotSelfTest0\n+        \u2502   \u2502   \u2514\u2500\u2500 cache-txCache\n+        \u2502   \u2502       \u251c\u2500\u2500 cache_data.dat\n+        \u2502   \u2502       \u251c\u2500\u2500 part-3.bin\n+        \u2502   \u2502       \u251c\u2500\u2500 part-4.bin\n+        \u2502   \u2502       \u2514\u2500\u2500 part-6.bin\n+        \u2502   \u251c\u2500\u2500 snapshot_IgniteClusterSnapshotSelfTest1\n+        \u2502   \u2502   \u2514\u2500\u2500 cache-txCache\n+        \u2502   \u2502       \u251c\u2500\u2500 cache_data.dat\n+        \u2502   \u2502       \u251c\u2500\u2500 part-1.bin\n+        \u2502   \u2502       \u251c\u2500\u2500 part-5.bin\n+        \u2502   \u2502       \u2514\u2500\u2500 part-7.bin\n+        \u2502   \u2514\u2500\u2500 snapshot_IgniteClusterSnapshotSelfTest2\n+        \u2502       \u2514\u2500\u2500 cache-txCache\n+        \u2502           \u251c\u2500\u2500 cache_data.dat\n+        \u2502           \u251c\u2500\u2500 part-0.bin\n+        \u2502           \u2514\u2500\u2500 part-2.bin\n+        \u2514\u2500\u2500 marshaller\n+----\n+\n+*Requirements.*\n+\n+You need an extra space on disk for the configured Ignite native persistence directory up to the current size this directory.\n+This space will be used for storing intermediate snapshot results and will be freed when the snapshot operation ends.\n+\n+*Limitations.*\n+\n+The snapshot procedure has some limitations that you should be aware of before using it at your production environment:\n+\n+* taking a snapshot of particular cache or cache group not supported;\n+* in-memory caches will not be included into snapshot;\n+* encrypted caches not supported and will be ignored;\n+* only single snapshot operation can be started at once;\n+* snapshot procedure will be interrupted if any baseline node leave the cluster;\n+* snapshot recovery at the same baseline topology with the same consistent node id;\n+\n+== Configuration\n+\n+You may configure the destination snapshot directory via `IgniteConfiguration`.\n+\n+[tabs]\n+--\n+tab:XML[]\n+\n+[source, xml]\n+----\n+include::code-snippets/xml/snapshots.xml[tags=ignite-config;!discovery, indent=0]\n+\n+----\n+\n+tab:Java[]\n+\n+[source, java]\n+----\n+include::{javaCodeDir}/Snapshots.java[tags=config, indent=0]\n+\n+----\n+\n+tab:C#/.NET[]\n+tab:C++[]\n+--\n+\n+== Snapshot creation\n+\n+Ignite provides the ability to start a snapshot operation from the following interfaces:\n+\n+- link:#command-line[Command line]\n+- link:#jmx[JMX]\n+- link:#java-api[Java API]\n+\n+=== Command line\n+\n+Ignite ships `control.(sh|bat)` scripts, located in the `$IGNITE_HOME/bin` directory, that acts like a tool to\n+start or cancel snapshot operation from the command line. The following commands can be used with `control.(sh|bat)`:\n+\n+[source,shell]\n+----\n+#Create cluster snapshot:\n+control.(sh|bat) --snapshot create snapshot_name\n+\n+#Cancel running snapshot:\n+control.(sh|bat) --snapshot cancel snapshot_name\n+\n+#Kill running snapshot:\n+control.(sh|bat) --kill SNAPSHOT snapshot_name\n+----\n+\n+=== JMX\n+\n+You can start snapshot operation or cancel currently running via the `SnapshotMXBean` interface:\n+\n+[cols=\"1,1\",opts=\"header\"]\n+|===\n+|Method | Description\n+|createSnapshot(String snpName) | Create cluster-wide snapshot.\n+|cancelSnapshot(String snpName) | Cancel started cluster-wide snapshot on the node initiator.\n+|===\n+\n+=== Java API\n+\n+The snapshot operation can be started using Java API:\n+\n+[tabs]\n+--\n+tab:Java[]\n+\n+[source, java]\n+----\n+include::{javaCodeDir}/Snapshots.java[tags=create, indent=0]\n+----\n+--\n+\n+== Snapshot restore (manually)\n+\n+NOTE: Pay attention in case of removing any data from the `$IGNITE_HOME/work` directory. You do it at your own risk.\n+\n+Currently, the restore procedure is fully manual. Since the snapshot is a consistent copy of all data files for each node,", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "52cfd6e6b9202febfc7d8a5ee07e28c1a02eee44"}, "originalPosition": 161}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NDQ0Nzg1NA==", "bodyText": "To restore a cluster from a snapshot, the following steps should be performed for each baseline node in it:", "url": "https://github.com/apache/ignite/pull/8128#discussion_r484447854", "createdAt": "2020-09-07T13:59:00Z", "author": {"login": "Silberfuchs1"}, "path": "docs/_docs/persistence/snapshot.adoc", "diffHunk": "@@ -0,0 +1,181 @@\n+= Snapshots and recovery\n+\n+== Overview\n+\n+Apache Ignite 2.9 comes with an ability to create fully consistent cluster-wide snapshots for deployments with\n+the link:persistence/native-persistence[Ignite Native Persistence]. You can create at runtime any number of snapshots\n+of all configured persistent cache groups. The snapshot is a consistent copy of all cache group data files (except\n+structures used for crash recovery) for each baseline node in a cluster. Since data of persistent cache groups stored\n+on disk in files on each node (cache group partition files, configuration files, binary metadata) the snapshot will\n+contain a copy of the same files with keeping Ignite cluster node data directory structure and the node consistent ids.\n+\n+*Snapshot Consistency.*\n+\n+All snapshots you created are fully consistent in terms of concurrent cluster-wide operations and all ongoing changes of\n+system files on the local node. Primary and backup cache group partitions will be also fully consistent in created\n+snapshots.\n+\n+The cluster-wide snapshot consistency achieved by triggering the\n+link:https://cwiki.apache.org/confluence/display/IGNITE/%28Partition+Map%29+Exchange+-+under+the+hood[Partition-Map-Exchange]\n+procedure. Doing this the cluster will eventually get a point in time when all previously started transactions\n+finished on primary and backups, and new ones are hold until a new snapshot operation will be started.\n+\n+The local system files consistency (e.g. cache group partition files, binary metadata files, configuration files) achieved\n+by copying them to the destination snapshot directory with tracking all concurrent ongoing changes. Tracking concurrent\n+changes during copying of cache group partition files will require additional space in Ignite system directory.\n+\n+*Snapshot Structure.*\n+\n+The created snapshot has the same\n+link:https://cwiki.apache.org/confluence/display/IGNITE/Ignite+Persistent+Store+-+under+the+hood#IgnitePersistentStoreunderthehood-FoldersStructure[Directory Structure]\n+as the Ignite native persistence does with keeping nodes `consistentId` in snapshot directory. The `wal` directory will\n+be excluded from snapshot since recovery procedures are not necessary for cache group data files.\n+\n+.Example of snapshot directory structure\n+[source,shell]\n+----\n+work\n+\u2514\u2500\u2500 snapshots\n+    \u2514\u2500\u2500 backup23012020\n+        \u251c\u2500\u2500 binary_meta\n+        \u2502   \u251c\u2500\u2500 snapshot_IgniteClusterSnapshotSelfTest0\n+        \u2502   \u251c\u2500\u2500 snapshot_IgniteClusterSnapshotSelfTest1\n+        \u2502   \u2514\u2500\u2500 snapshot_IgniteClusterSnapshotSelfTest2\n+        \u251c\u2500\u2500 db\n+        \u2502   \u251c\u2500\u2500 snapshot_IgniteClusterSnapshotSelfTest0\n+        \u2502   \u2502   \u2514\u2500\u2500 cache-txCache\n+        \u2502   \u2502       \u251c\u2500\u2500 cache_data.dat\n+        \u2502   \u2502       \u251c\u2500\u2500 part-3.bin\n+        \u2502   \u2502       \u251c\u2500\u2500 part-4.bin\n+        \u2502   \u2502       \u2514\u2500\u2500 part-6.bin\n+        \u2502   \u251c\u2500\u2500 snapshot_IgniteClusterSnapshotSelfTest1\n+        \u2502   \u2502   \u2514\u2500\u2500 cache-txCache\n+        \u2502   \u2502       \u251c\u2500\u2500 cache_data.dat\n+        \u2502   \u2502       \u251c\u2500\u2500 part-1.bin\n+        \u2502   \u2502       \u251c\u2500\u2500 part-5.bin\n+        \u2502   \u2502       \u2514\u2500\u2500 part-7.bin\n+        \u2502   \u2514\u2500\u2500 snapshot_IgniteClusterSnapshotSelfTest2\n+        \u2502       \u2514\u2500\u2500 cache-txCache\n+        \u2502           \u251c\u2500\u2500 cache_data.dat\n+        \u2502           \u251c\u2500\u2500 part-0.bin\n+        \u2502           \u2514\u2500\u2500 part-2.bin\n+        \u2514\u2500\u2500 marshaller\n+----\n+\n+*Requirements.*\n+\n+You need an extra space on disk for the configured Ignite native persistence directory up to the current size this directory.\n+This space will be used for storing intermediate snapshot results and will be freed when the snapshot operation ends.\n+\n+*Limitations.*\n+\n+The snapshot procedure has some limitations that you should be aware of before using it at your production environment:\n+\n+* taking a snapshot of particular cache or cache group not supported;\n+* in-memory caches will not be included into snapshot;\n+* encrypted caches not supported and will be ignored;\n+* only single snapshot operation can be started at once;\n+* snapshot procedure will be interrupted if any baseline node leave the cluster;\n+* snapshot recovery at the same baseline topology with the same consistent node id;\n+\n+== Configuration\n+\n+You may configure the destination snapshot directory via `IgniteConfiguration`.\n+\n+[tabs]\n+--\n+tab:XML[]\n+\n+[source, xml]\n+----\n+include::code-snippets/xml/snapshots.xml[tags=ignite-config;!discovery, indent=0]\n+\n+----\n+\n+tab:Java[]\n+\n+[source, java]\n+----\n+include::{javaCodeDir}/Snapshots.java[tags=config, indent=0]\n+\n+----\n+\n+tab:C#/.NET[]\n+tab:C++[]\n+--\n+\n+== Snapshot creation\n+\n+Ignite provides the ability to start a snapshot operation from the following interfaces:\n+\n+- link:#command-line[Command line]\n+- link:#jmx[JMX]\n+- link:#java-api[Java API]\n+\n+=== Command line\n+\n+Ignite ships `control.(sh|bat)` scripts, located in the `$IGNITE_HOME/bin` directory, that acts like a tool to\n+start or cancel snapshot operation from the command line. The following commands can be used with `control.(sh|bat)`:\n+\n+[source,shell]\n+----\n+#Create cluster snapshot:\n+control.(sh|bat) --snapshot create snapshot_name\n+\n+#Cancel running snapshot:\n+control.(sh|bat) --snapshot cancel snapshot_name\n+\n+#Kill running snapshot:\n+control.(sh|bat) --kill SNAPSHOT snapshot_name\n+----\n+\n+=== JMX\n+\n+You can start snapshot operation or cancel currently running via the `SnapshotMXBean` interface:\n+\n+[cols=\"1,1\",opts=\"header\"]\n+|===\n+|Method | Description\n+|createSnapshot(String snpName) | Create cluster-wide snapshot.\n+|cancelSnapshot(String snpName) | Cancel started cluster-wide snapshot on the node initiator.\n+|===\n+\n+=== Java API\n+\n+The snapshot operation can be started using Java API:\n+\n+[tabs]\n+--\n+tab:Java[]\n+\n+[source, java]\n+----\n+include::{javaCodeDir}/Snapshots.java[tags=create, indent=0]\n+----\n+--\n+\n+== Snapshot restore (manually)\n+\n+NOTE: Pay attention in case of removing any data from the `$IGNITE_HOME/work` directory. You do it at your own risk.\n+\n+Currently, the restore procedure is fully manual. Since the snapshot is a consistent copy of all data files for each node,\n+to recover from the particular snapshot you need to start the same cluster with the same configuration on these files.\n+\n+To restore a cluster from the snapshot you must do the following steps for each baseline node in it:", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "52cfd6e6b9202febfc7d8a5ee07e28c1a02eee44"}, "originalPosition": 164}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NDQ0ODE5Mw==", "bodyText": "Locate the snapshot you've created by name;", "url": "https://github.com/apache/ignite/pull/8128#discussion_r484448193", "createdAt": "2020-09-07T13:59:38Z", "author": {"login": "Silberfuchs1"}, "path": "docs/_docs/persistence/snapshot.adoc", "diffHunk": "@@ -0,0 +1,181 @@\n+= Snapshots and recovery\n+\n+== Overview\n+\n+Apache Ignite 2.9 comes with an ability to create fully consistent cluster-wide snapshots for deployments with\n+the link:persistence/native-persistence[Ignite Native Persistence]. You can create at runtime any number of snapshots\n+of all configured persistent cache groups. The snapshot is a consistent copy of all cache group data files (except\n+structures used for crash recovery) for each baseline node in a cluster. Since data of persistent cache groups stored\n+on disk in files on each node (cache group partition files, configuration files, binary metadata) the snapshot will\n+contain a copy of the same files with keeping Ignite cluster node data directory structure and the node consistent ids.\n+\n+*Snapshot Consistency.*\n+\n+All snapshots you created are fully consistent in terms of concurrent cluster-wide operations and all ongoing changes of\n+system files on the local node. Primary and backup cache group partitions will be also fully consistent in created\n+snapshots.\n+\n+The cluster-wide snapshot consistency achieved by triggering the\n+link:https://cwiki.apache.org/confluence/display/IGNITE/%28Partition+Map%29+Exchange+-+under+the+hood[Partition-Map-Exchange]\n+procedure. Doing this the cluster will eventually get a point in time when all previously started transactions\n+finished on primary and backups, and new ones are hold until a new snapshot operation will be started.\n+\n+The local system files consistency (e.g. cache group partition files, binary metadata files, configuration files) achieved\n+by copying them to the destination snapshot directory with tracking all concurrent ongoing changes. Tracking concurrent\n+changes during copying of cache group partition files will require additional space in Ignite system directory.\n+\n+*Snapshot Structure.*\n+\n+The created snapshot has the same\n+link:https://cwiki.apache.org/confluence/display/IGNITE/Ignite+Persistent+Store+-+under+the+hood#IgnitePersistentStoreunderthehood-FoldersStructure[Directory Structure]\n+as the Ignite native persistence does with keeping nodes `consistentId` in snapshot directory. The `wal` directory will\n+be excluded from snapshot since recovery procedures are not necessary for cache group data files.\n+\n+.Example of snapshot directory structure\n+[source,shell]\n+----\n+work\n+\u2514\u2500\u2500 snapshots\n+    \u2514\u2500\u2500 backup23012020\n+        \u251c\u2500\u2500 binary_meta\n+        \u2502   \u251c\u2500\u2500 snapshot_IgniteClusterSnapshotSelfTest0\n+        \u2502   \u251c\u2500\u2500 snapshot_IgniteClusterSnapshotSelfTest1\n+        \u2502   \u2514\u2500\u2500 snapshot_IgniteClusterSnapshotSelfTest2\n+        \u251c\u2500\u2500 db\n+        \u2502   \u251c\u2500\u2500 snapshot_IgniteClusterSnapshotSelfTest0\n+        \u2502   \u2502   \u2514\u2500\u2500 cache-txCache\n+        \u2502   \u2502       \u251c\u2500\u2500 cache_data.dat\n+        \u2502   \u2502       \u251c\u2500\u2500 part-3.bin\n+        \u2502   \u2502       \u251c\u2500\u2500 part-4.bin\n+        \u2502   \u2502       \u2514\u2500\u2500 part-6.bin\n+        \u2502   \u251c\u2500\u2500 snapshot_IgniteClusterSnapshotSelfTest1\n+        \u2502   \u2502   \u2514\u2500\u2500 cache-txCache\n+        \u2502   \u2502       \u251c\u2500\u2500 cache_data.dat\n+        \u2502   \u2502       \u251c\u2500\u2500 part-1.bin\n+        \u2502   \u2502       \u251c\u2500\u2500 part-5.bin\n+        \u2502   \u2502       \u2514\u2500\u2500 part-7.bin\n+        \u2502   \u2514\u2500\u2500 snapshot_IgniteClusterSnapshotSelfTest2\n+        \u2502       \u2514\u2500\u2500 cache-txCache\n+        \u2502           \u251c\u2500\u2500 cache_data.dat\n+        \u2502           \u251c\u2500\u2500 part-0.bin\n+        \u2502           \u2514\u2500\u2500 part-2.bin\n+        \u2514\u2500\u2500 marshaller\n+----\n+\n+*Requirements.*\n+\n+You need an extra space on disk for the configured Ignite native persistence directory up to the current size this directory.\n+This space will be used for storing intermediate snapshot results and will be freed when the snapshot operation ends.\n+\n+*Limitations.*\n+\n+The snapshot procedure has some limitations that you should be aware of before using it at your production environment:\n+\n+* taking a snapshot of particular cache or cache group not supported;\n+* in-memory caches will not be included into snapshot;\n+* encrypted caches not supported and will be ignored;\n+* only single snapshot operation can be started at once;\n+* snapshot procedure will be interrupted if any baseline node leave the cluster;\n+* snapshot recovery at the same baseline topology with the same consistent node id;\n+\n+== Configuration\n+\n+You may configure the destination snapshot directory via `IgniteConfiguration`.\n+\n+[tabs]\n+--\n+tab:XML[]\n+\n+[source, xml]\n+----\n+include::code-snippets/xml/snapshots.xml[tags=ignite-config;!discovery, indent=0]\n+\n+----\n+\n+tab:Java[]\n+\n+[source, java]\n+----\n+include::{javaCodeDir}/Snapshots.java[tags=config, indent=0]\n+\n+----\n+\n+tab:C#/.NET[]\n+tab:C++[]\n+--\n+\n+== Snapshot creation\n+\n+Ignite provides the ability to start a snapshot operation from the following interfaces:\n+\n+- link:#command-line[Command line]\n+- link:#jmx[JMX]\n+- link:#java-api[Java API]\n+\n+=== Command line\n+\n+Ignite ships `control.(sh|bat)` scripts, located in the `$IGNITE_HOME/bin` directory, that acts like a tool to\n+start or cancel snapshot operation from the command line. The following commands can be used with `control.(sh|bat)`:\n+\n+[source,shell]\n+----\n+#Create cluster snapshot:\n+control.(sh|bat) --snapshot create snapshot_name\n+\n+#Cancel running snapshot:\n+control.(sh|bat) --snapshot cancel snapshot_name\n+\n+#Kill running snapshot:\n+control.(sh|bat) --kill SNAPSHOT snapshot_name\n+----\n+\n+=== JMX\n+\n+You can start snapshot operation or cancel currently running via the `SnapshotMXBean` interface:\n+\n+[cols=\"1,1\",opts=\"header\"]\n+|===\n+|Method | Description\n+|createSnapshot(String snpName) | Create cluster-wide snapshot.\n+|cancelSnapshot(String snpName) | Cancel started cluster-wide snapshot on the node initiator.\n+|===\n+\n+=== Java API\n+\n+The snapshot operation can be started using Java API:\n+\n+[tabs]\n+--\n+tab:Java[]\n+\n+[source, java]\n+----\n+include::{javaCodeDir}/Snapshots.java[tags=create, indent=0]\n+----\n+--\n+\n+== Snapshot restore (manually)\n+\n+NOTE: Pay attention in case of removing any data from the `$IGNITE_HOME/work` directory. You do it at your own risk.\n+\n+Currently, the restore procedure is fully manual. Since the snapshot is a consistent copy of all data files for each node,\n+to recover from the particular snapshot you need to start the same cluster with the same configuration on these files.\n+\n+To restore a cluster from the snapshot you must do the following steps for each baseline node in it:\n+\n+- Locate by name the snapshot you created;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "52cfd6e6b9202febfc7d8a5ee07e28c1a02eee44"}, "originalPosition": 166}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NDQ1MDY2MA==", "bodyText": "...a consistent id of a node you work with;", "url": "https://github.com/apache/ignite/pull/8128#discussion_r484450660", "createdAt": "2020-09-07T14:02:19Z", "author": {"login": "Silberfuchs1"}, "path": "docs/_docs/persistence/snapshot.adoc", "diffHunk": "@@ -0,0 +1,181 @@\n+= Snapshots and recovery\n+\n+== Overview\n+\n+Apache Ignite 2.9 comes with an ability to create fully consistent cluster-wide snapshots for deployments with\n+the link:persistence/native-persistence[Ignite Native Persistence]. You can create at runtime any number of snapshots\n+of all configured persistent cache groups. The snapshot is a consistent copy of all cache group data files (except\n+structures used for crash recovery) for each baseline node in a cluster. Since data of persistent cache groups stored\n+on disk in files on each node (cache group partition files, configuration files, binary metadata) the snapshot will\n+contain a copy of the same files with keeping Ignite cluster node data directory structure and the node consistent ids.\n+\n+*Snapshot Consistency.*\n+\n+All snapshots you created are fully consistent in terms of concurrent cluster-wide operations and all ongoing changes of\n+system files on the local node. Primary and backup cache group partitions will be also fully consistent in created\n+snapshots.\n+\n+The cluster-wide snapshot consistency achieved by triggering the\n+link:https://cwiki.apache.org/confluence/display/IGNITE/%28Partition+Map%29+Exchange+-+under+the+hood[Partition-Map-Exchange]\n+procedure. Doing this the cluster will eventually get a point in time when all previously started transactions\n+finished on primary and backups, and new ones are hold until a new snapshot operation will be started.\n+\n+The local system files consistency (e.g. cache group partition files, binary metadata files, configuration files) achieved\n+by copying them to the destination snapshot directory with tracking all concurrent ongoing changes. Tracking concurrent\n+changes during copying of cache group partition files will require additional space in Ignite system directory.\n+\n+*Snapshot Structure.*\n+\n+The created snapshot has the same\n+link:https://cwiki.apache.org/confluence/display/IGNITE/Ignite+Persistent+Store+-+under+the+hood#IgnitePersistentStoreunderthehood-FoldersStructure[Directory Structure]\n+as the Ignite native persistence does with keeping nodes `consistentId` in snapshot directory. The `wal` directory will\n+be excluded from snapshot since recovery procedures are not necessary for cache group data files.\n+\n+.Example of snapshot directory structure\n+[source,shell]\n+----\n+work\n+\u2514\u2500\u2500 snapshots\n+    \u2514\u2500\u2500 backup23012020\n+        \u251c\u2500\u2500 binary_meta\n+        \u2502   \u251c\u2500\u2500 snapshot_IgniteClusterSnapshotSelfTest0\n+        \u2502   \u251c\u2500\u2500 snapshot_IgniteClusterSnapshotSelfTest1\n+        \u2502   \u2514\u2500\u2500 snapshot_IgniteClusterSnapshotSelfTest2\n+        \u251c\u2500\u2500 db\n+        \u2502   \u251c\u2500\u2500 snapshot_IgniteClusterSnapshotSelfTest0\n+        \u2502   \u2502   \u2514\u2500\u2500 cache-txCache\n+        \u2502   \u2502       \u251c\u2500\u2500 cache_data.dat\n+        \u2502   \u2502       \u251c\u2500\u2500 part-3.bin\n+        \u2502   \u2502       \u251c\u2500\u2500 part-4.bin\n+        \u2502   \u2502       \u2514\u2500\u2500 part-6.bin\n+        \u2502   \u251c\u2500\u2500 snapshot_IgniteClusterSnapshotSelfTest1\n+        \u2502   \u2502   \u2514\u2500\u2500 cache-txCache\n+        \u2502   \u2502       \u251c\u2500\u2500 cache_data.dat\n+        \u2502   \u2502       \u251c\u2500\u2500 part-1.bin\n+        \u2502   \u2502       \u251c\u2500\u2500 part-5.bin\n+        \u2502   \u2502       \u2514\u2500\u2500 part-7.bin\n+        \u2502   \u2514\u2500\u2500 snapshot_IgniteClusterSnapshotSelfTest2\n+        \u2502       \u2514\u2500\u2500 cache-txCache\n+        \u2502           \u251c\u2500\u2500 cache_data.dat\n+        \u2502           \u251c\u2500\u2500 part-0.bin\n+        \u2502           \u2514\u2500\u2500 part-2.bin\n+        \u2514\u2500\u2500 marshaller\n+----\n+\n+*Requirements.*\n+\n+You need an extra space on disk for the configured Ignite native persistence directory up to the current size this directory.\n+This space will be used for storing intermediate snapshot results and will be freed when the snapshot operation ends.\n+\n+*Limitations.*\n+\n+The snapshot procedure has some limitations that you should be aware of before using it at your production environment:\n+\n+* taking a snapshot of particular cache or cache group not supported;\n+* in-memory caches will not be included into snapshot;\n+* encrypted caches not supported and will be ignored;\n+* only single snapshot operation can be started at once;\n+* snapshot procedure will be interrupted if any baseline node leave the cluster;\n+* snapshot recovery at the same baseline topology with the same consistent node id;\n+\n+== Configuration\n+\n+You may configure the destination snapshot directory via `IgniteConfiguration`.\n+\n+[tabs]\n+--\n+tab:XML[]\n+\n+[source, xml]\n+----\n+include::code-snippets/xml/snapshots.xml[tags=ignite-config;!discovery, indent=0]\n+\n+----\n+\n+tab:Java[]\n+\n+[source, java]\n+----\n+include::{javaCodeDir}/Snapshots.java[tags=config, indent=0]\n+\n+----\n+\n+tab:C#/.NET[]\n+tab:C++[]\n+--\n+\n+== Snapshot creation\n+\n+Ignite provides the ability to start a snapshot operation from the following interfaces:\n+\n+- link:#command-line[Command line]\n+- link:#jmx[JMX]\n+- link:#java-api[Java API]\n+\n+=== Command line\n+\n+Ignite ships `control.(sh|bat)` scripts, located in the `$IGNITE_HOME/bin` directory, that acts like a tool to\n+start or cancel snapshot operation from the command line. The following commands can be used with `control.(sh|bat)`:\n+\n+[source,shell]\n+----\n+#Create cluster snapshot:\n+control.(sh|bat) --snapshot create snapshot_name\n+\n+#Cancel running snapshot:\n+control.(sh|bat) --snapshot cancel snapshot_name\n+\n+#Kill running snapshot:\n+control.(sh|bat) --kill SNAPSHOT snapshot_name\n+----\n+\n+=== JMX\n+\n+You can start snapshot operation or cancel currently running via the `SnapshotMXBean` interface:\n+\n+[cols=\"1,1\",opts=\"header\"]\n+|===\n+|Method | Description\n+|createSnapshot(String snpName) | Create cluster-wide snapshot.\n+|cancelSnapshot(String snpName) | Cancel started cluster-wide snapshot on the node initiator.\n+|===\n+\n+=== Java API\n+\n+The snapshot operation can be started using Java API:\n+\n+[tabs]\n+--\n+tab:Java[]\n+\n+[source, java]\n+----\n+include::{javaCodeDir}/Snapshots.java[tags=create, indent=0]\n+----\n+--\n+\n+== Snapshot restore (manually)\n+\n+NOTE: Pay attention in case of removing any data from the `$IGNITE_HOME/work` directory. You do it at your own risk.\n+\n+Currently, the restore procedure is fully manual. Since the snapshot is a consistent copy of all data files for each node,\n+to recover from the particular snapshot you need to start the same cluster with the same configuration on these files.\n+\n+To restore a cluster from the snapshot you must do the following steps for each baseline node in it:\n+\n+- Locate by name the snapshot you created;\n+- Remove all the data from `$IGNITE_HOME/work/{node_id}` where `{node_id}` is a consistent node id which do you work with;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "52cfd6e6b9202febfc7d8a5ee07e28c1a02eee44"}, "originalPosition": 167}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NDQ1MjEwMA==", "bodyText": "Copy all snapshot files from the snapshot related to {node_id} to the $IGNITE_HOME/work/{node_id} directory;", "url": "https://github.com/apache/ignite/pull/8128#discussion_r484452100", "createdAt": "2020-09-07T14:03:49Z", "author": {"login": "Silberfuchs1"}, "path": "docs/_docs/persistence/snapshot.adoc", "diffHunk": "@@ -0,0 +1,181 @@\n+= Snapshots and recovery\n+\n+== Overview\n+\n+Apache Ignite 2.9 comes with an ability to create fully consistent cluster-wide snapshots for deployments with\n+the link:persistence/native-persistence[Ignite Native Persistence]. You can create at runtime any number of snapshots\n+of all configured persistent cache groups. The snapshot is a consistent copy of all cache group data files (except\n+structures used for crash recovery) for each baseline node in a cluster. Since data of persistent cache groups stored\n+on disk in files on each node (cache group partition files, configuration files, binary metadata) the snapshot will\n+contain a copy of the same files with keeping Ignite cluster node data directory structure and the node consistent ids.\n+\n+*Snapshot Consistency.*\n+\n+All snapshots you created are fully consistent in terms of concurrent cluster-wide operations and all ongoing changes of\n+system files on the local node. Primary and backup cache group partitions will be also fully consistent in created\n+snapshots.\n+\n+The cluster-wide snapshot consistency achieved by triggering the\n+link:https://cwiki.apache.org/confluence/display/IGNITE/%28Partition+Map%29+Exchange+-+under+the+hood[Partition-Map-Exchange]\n+procedure. Doing this the cluster will eventually get a point in time when all previously started transactions\n+finished on primary and backups, and new ones are hold until a new snapshot operation will be started.\n+\n+The local system files consistency (e.g. cache group partition files, binary metadata files, configuration files) achieved\n+by copying them to the destination snapshot directory with tracking all concurrent ongoing changes. Tracking concurrent\n+changes during copying of cache group partition files will require additional space in Ignite system directory.\n+\n+*Snapshot Structure.*\n+\n+The created snapshot has the same\n+link:https://cwiki.apache.org/confluence/display/IGNITE/Ignite+Persistent+Store+-+under+the+hood#IgnitePersistentStoreunderthehood-FoldersStructure[Directory Structure]\n+as the Ignite native persistence does with keeping nodes `consistentId` in snapshot directory. The `wal` directory will\n+be excluded from snapshot since recovery procedures are not necessary for cache group data files.\n+\n+.Example of snapshot directory structure\n+[source,shell]\n+----\n+work\n+\u2514\u2500\u2500 snapshots\n+    \u2514\u2500\u2500 backup23012020\n+        \u251c\u2500\u2500 binary_meta\n+        \u2502   \u251c\u2500\u2500 snapshot_IgniteClusterSnapshotSelfTest0\n+        \u2502   \u251c\u2500\u2500 snapshot_IgniteClusterSnapshotSelfTest1\n+        \u2502   \u2514\u2500\u2500 snapshot_IgniteClusterSnapshotSelfTest2\n+        \u251c\u2500\u2500 db\n+        \u2502   \u251c\u2500\u2500 snapshot_IgniteClusterSnapshotSelfTest0\n+        \u2502   \u2502   \u2514\u2500\u2500 cache-txCache\n+        \u2502   \u2502       \u251c\u2500\u2500 cache_data.dat\n+        \u2502   \u2502       \u251c\u2500\u2500 part-3.bin\n+        \u2502   \u2502       \u251c\u2500\u2500 part-4.bin\n+        \u2502   \u2502       \u2514\u2500\u2500 part-6.bin\n+        \u2502   \u251c\u2500\u2500 snapshot_IgniteClusterSnapshotSelfTest1\n+        \u2502   \u2502   \u2514\u2500\u2500 cache-txCache\n+        \u2502   \u2502       \u251c\u2500\u2500 cache_data.dat\n+        \u2502   \u2502       \u251c\u2500\u2500 part-1.bin\n+        \u2502   \u2502       \u251c\u2500\u2500 part-5.bin\n+        \u2502   \u2502       \u2514\u2500\u2500 part-7.bin\n+        \u2502   \u2514\u2500\u2500 snapshot_IgniteClusterSnapshotSelfTest2\n+        \u2502       \u2514\u2500\u2500 cache-txCache\n+        \u2502           \u251c\u2500\u2500 cache_data.dat\n+        \u2502           \u251c\u2500\u2500 part-0.bin\n+        \u2502           \u2514\u2500\u2500 part-2.bin\n+        \u2514\u2500\u2500 marshaller\n+----\n+\n+*Requirements.*\n+\n+You need an extra space on disk for the configured Ignite native persistence directory up to the current size this directory.\n+This space will be used for storing intermediate snapshot results and will be freed when the snapshot operation ends.\n+\n+*Limitations.*\n+\n+The snapshot procedure has some limitations that you should be aware of before using it at your production environment:\n+\n+* taking a snapshot of particular cache or cache group not supported;\n+* in-memory caches will not be included into snapshot;\n+* encrypted caches not supported and will be ignored;\n+* only single snapshot operation can be started at once;\n+* snapshot procedure will be interrupted if any baseline node leave the cluster;\n+* snapshot recovery at the same baseline topology with the same consistent node id;\n+\n+== Configuration\n+\n+You may configure the destination snapshot directory via `IgniteConfiguration`.\n+\n+[tabs]\n+--\n+tab:XML[]\n+\n+[source, xml]\n+----\n+include::code-snippets/xml/snapshots.xml[tags=ignite-config;!discovery, indent=0]\n+\n+----\n+\n+tab:Java[]\n+\n+[source, java]\n+----\n+include::{javaCodeDir}/Snapshots.java[tags=config, indent=0]\n+\n+----\n+\n+tab:C#/.NET[]\n+tab:C++[]\n+--\n+\n+== Snapshot creation\n+\n+Ignite provides the ability to start a snapshot operation from the following interfaces:\n+\n+- link:#command-line[Command line]\n+- link:#jmx[JMX]\n+- link:#java-api[Java API]\n+\n+=== Command line\n+\n+Ignite ships `control.(sh|bat)` scripts, located in the `$IGNITE_HOME/bin` directory, that acts like a tool to\n+start or cancel snapshot operation from the command line. The following commands can be used with `control.(sh|bat)`:\n+\n+[source,shell]\n+----\n+#Create cluster snapshot:\n+control.(sh|bat) --snapshot create snapshot_name\n+\n+#Cancel running snapshot:\n+control.(sh|bat) --snapshot cancel snapshot_name\n+\n+#Kill running snapshot:\n+control.(sh|bat) --kill SNAPSHOT snapshot_name\n+----\n+\n+=== JMX\n+\n+You can start snapshot operation or cancel currently running via the `SnapshotMXBean` interface:\n+\n+[cols=\"1,1\",opts=\"header\"]\n+|===\n+|Method | Description\n+|createSnapshot(String snpName) | Create cluster-wide snapshot.\n+|cancelSnapshot(String snpName) | Cancel started cluster-wide snapshot on the node initiator.\n+|===\n+\n+=== Java API\n+\n+The snapshot operation can be started using Java API:\n+\n+[tabs]\n+--\n+tab:Java[]\n+\n+[source, java]\n+----\n+include::{javaCodeDir}/Snapshots.java[tags=create, indent=0]\n+----\n+--\n+\n+== Snapshot restore (manually)\n+\n+NOTE: Pay attention in case of removing any data from the `$IGNITE_HOME/work` directory. You do it at your own risk.\n+\n+Currently, the restore procedure is fully manual. Since the snapshot is a consistent copy of all data files for each node,\n+to recover from the particular snapshot you need to start the same cluster with the same configuration on these files.\n+\n+To restore a cluster from the snapshot you must do the following steps for each baseline node in it:\n+\n+- Locate by name the snapshot you created;\n+- Remove all the data from `$IGNITE_HOME/work/{node_id}` where `{node_id}` is a consistent node id which do you work with;\n+- Copy all snapshot files to the `$IGNITE_HOME/work/{node_id}` directory from the snapshot related to `{node_id}`;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "52cfd6e6b9202febfc7d8a5ee07e28c1a02eee44"}, "originalPosition": 168}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NDQ1Mzg5OQ==", "bodyText": "Here are some options:", "url": "https://github.com/apache/ignite/pull/8128#discussion_r484453899", "createdAt": "2020-09-07T14:06:58Z", "author": {"login": "Silberfuchs1"}, "path": "docs/_docs/persistence/snapshot.adoc", "diffHunk": "@@ -0,0 +1,181 @@\n+= Snapshots and recovery\n+\n+== Overview\n+\n+Apache Ignite 2.9 comes with an ability to create fully consistent cluster-wide snapshots for deployments with\n+the link:persistence/native-persistence[Ignite Native Persistence]. You can create at runtime any number of snapshots\n+of all configured persistent cache groups. The snapshot is a consistent copy of all cache group data files (except\n+structures used for crash recovery) for each baseline node in a cluster. Since data of persistent cache groups stored\n+on disk in files on each node (cache group partition files, configuration files, binary metadata) the snapshot will\n+contain a copy of the same files with keeping Ignite cluster node data directory structure and the node consistent ids.\n+\n+*Snapshot Consistency.*\n+\n+All snapshots you created are fully consistent in terms of concurrent cluster-wide operations and all ongoing changes of\n+system files on the local node. Primary and backup cache group partitions will be also fully consistent in created\n+snapshots.\n+\n+The cluster-wide snapshot consistency achieved by triggering the\n+link:https://cwiki.apache.org/confluence/display/IGNITE/%28Partition+Map%29+Exchange+-+under+the+hood[Partition-Map-Exchange]\n+procedure. Doing this the cluster will eventually get a point in time when all previously started transactions\n+finished on primary and backups, and new ones are hold until a new snapshot operation will be started.\n+\n+The local system files consistency (e.g. cache group partition files, binary metadata files, configuration files) achieved\n+by copying them to the destination snapshot directory with tracking all concurrent ongoing changes. Tracking concurrent\n+changes during copying of cache group partition files will require additional space in Ignite system directory.\n+\n+*Snapshot Structure.*\n+\n+The created snapshot has the same\n+link:https://cwiki.apache.org/confluence/display/IGNITE/Ignite+Persistent+Store+-+under+the+hood#IgnitePersistentStoreunderthehood-FoldersStructure[Directory Structure]\n+as the Ignite native persistence does with keeping nodes `consistentId` in snapshot directory. The `wal` directory will\n+be excluded from snapshot since recovery procedures are not necessary for cache group data files.\n+\n+.Example of snapshot directory structure\n+[source,shell]\n+----\n+work\n+\u2514\u2500\u2500 snapshots\n+    \u2514\u2500\u2500 backup23012020\n+        \u251c\u2500\u2500 binary_meta\n+        \u2502   \u251c\u2500\u2500 snapshot_IgniteClusterSnapshotSelfTest0\n+        \u2502   \u251c\u2500\u2500 snapshot_IgniteClusterSnapshotSelfTest1\n+        \u2502   \u2514\u2500\u2500 snapshot_IgniteClusterSnapshotSelfTest2\n+        \u251c\u2500\u2500 db\n+        \u2502   \u251c\u2500\u2500 snapshot_IgniteClusterSnapshotSelfTest0\n+        \u2502   \u2502   \u2514\u2500\u2500 cache-txCache\n+        \u2502   \u2502       \u251c\u2500\u2500 cache_data.dat\n+        \u2502   \u2502       \u251c\u2500\u2500 part-3.bin\n+        \u2502   \u2502       \u251c\u2500\u2500 part-4.bin\n+        \u2502   \u2502       \u2514\u2500\u2500 part-6.bin\n+        \u2502   \u251c\u2500\u2500 snapshot_IgniteClusterSnapshotSelfTest1\n+        \u2502   \u2502   \u2514\u2500\u2500 cache-txCache\n+        \u2502   \u2502       \u251c\u2500\u2500 cache_data.dat\n+        \u2502   \u2502       \u251c\u2500\u2500 part-1.bin\n+        \u2502   \u2502       \u251c\u2500\u2500 part-5.bin\n+        \u2502   \u2502       \u2514\u2500\u2500 part-7.bin\n+        \u2502   \u2514\u2500\u2500 snapshot_IgniteClusterSnapshotSelfTest2\n+        \u2502       \u2514\u2500\u2500 cache-txCache\n+        \u2502           \u251c\u2500\u2500 cache_data.dat\n+        \u2502           \u251c\u2500\u2500 part-0.bin\n+        \u2502           \u2514\u2500\u2500 part-2.bin\n+        \u2514\u2500\u2500 marshaller\n+----\n+\n+*Requirements.*\n+\n+You need an extra space on disk for the configured Ignite native persistence directory up to the current size this directory.\n+This space will be used for storing intermediate snapshot results and will be freed when the snapshot operation ends.\n+\n+*Limitations.*\n+\n+The snapshot procedure has some limitations that you should be aware of before using it at your production environment:\n+\n+* taking a snapshot of particular cache or cache group not supported;\n+* in-memory caches will not be included into snapshot;\n+* encrypted caches not supported and will be ignored;\n+* only single snapshot operation can be started at once;\n+* snapshot procedure will be interrupted if any baseline node leave the cluster;\n+* snapshot recovery at the same baseline topology with the same consistent node id;\n+\n+== Configuration\n+\n+You may configure the destination snapshot directory via `IgniteConfiguration`.\n+\n+[tabs]\n+--\n+tab:XML[]\n+\n+[source, xml]\n+----\n+include::code-snippets/xml/snapshots.xml[tags=ignite-config;!discovery, indent=0]\n+\n+----\n+\n+tab:Java[]\n+\n+[source, java]\n+----\n+include::{javaCodeDir}/Snapshots.java[tags=config, indent=0]\n+\n+----\n+\n+tab:C#/.NET[]\n+tab:C++[]\n+--\n+\n+== Snapshot creation\n+\n+Ignite provides the ability to start a snapshot operation from the following interfaces:\n+\n+- link:#command-line[Command line]\n+- link:#jmx[JMX]\n+- link:#java-api[Java API]\n+\n+=== Command line\n+\n+Ignite ships `control.(sh|bat)` scripts, located in the `$IGNITE_HOME/bin` directory, that acts like a tool to\n+start or cancel snapshot operation from the command line. The following commands can be used with `control.(sh|bat)`:\n+\n+[source,shell]\n+----\n+#Create cluster snapshot:\n+control.(sh|bat) --snapshot create snapshot_name\n+\n+#Cancel running snapshot:\n+control.(sh|bat) --snapshot cancel snapshot_name\n+\n+#Kill running snapshot:\n+control.(sh|bat) --kill SNAPSHOT snapshot_name\n+----\n+\n+=== JMX\n+\n+You can start snapshot operation or cancel currently running via the `SnapshotMXBean` interface:\n+\n+[cols=\"1,1\",opts=\"header\"]\n+|===\n+|Method | Description\n+|createSnapshot(String snpName) | Create cluster-wide snapshot.\n+|cancelSnapshot(String snpName) | Cancel started cluster-wide snapshot on the node initiator.\n+|===\n+\n+=== Java API\n+\n+The snapshot operation can be started using Java API:\n+\n+[tabs]\n+--\n+tab:Java[]\n+\n+[source, java]\n+----\n+include::{javaCodeDir}/Snapshots.java[tags=create, indent=0]\n+----\n+--\n+\n+== Snapshot restore (manually)\n+\n+NOTE: Pay attention in case of removing any data from the `$IGNITE_HOME/work` directory. You do it at your own risk.\n+\n+Currently, the restore procedure is fully manual. Since the snapshot is a consistent copy of all data files for each node,\n+to recover from the particular snapshot you need to start the same cluster with the same configuration on these files.\n+\n+To restore a cluster from the snapshot you must do the following steps for each baseline node in it:\n+\n+- Locate by name the snapshot you created;\n+- Remove all the data from `$IGNITE_HOME/work/{node_id}` where `{node_id}` is a consistent node id which do you work with;\n+- Copy all snapshot files to the `$IGNITE_HOME/work/{node_id}` directory from the snapshot related to `{node_id}`;\n+\n+Some use cases at production deployments may require creating a snapshot at m-node cluster and applying it to n-node\n+cluster. There are a few options here:", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "52cfd6e6b9202febfc7d8a5ee07e28c1a02eee44"}, "originalPosition": 171}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NDQ1NzMxMQ==", "bodyText": "Use the same baseline and configuration.", "url": "https://github.com/apache/ignite/pull/8128#discussion_r484457311", "createdAt": "2020-09-07T14:14:01Z", "author": {"login": "Silberfuchs1"}, "path": "docs/_docs/persistence/snapshot.adoc", "diffHunk": "@@ -0,0 +1,181 @@\n+= Snapshots and recovery\n+\n+== Overview\n+\n+Apache Ignite 2.9 comes with an ability to create fully consistent cluster-wide snapshots for deployments with\n+the link:persistence/native-persistence[Ignite Native Persistence]. You can create at runtime any number of snapshots\n+of all configured persistent cache groups. The snapshot is a consistent copy of all cache group data files (except\n+structures used for crash recovery) for each baseline node in a cluster. Since data of persistent cache groups stored\n+on disk in files on each node (cache group partition files, configuration files, binary metadata) the snapshot will\n+contain a copy of the same files with keeping Ignite cluster node data directory structure and the node consistent ids.\n+\n+*Snapshot Consistency.*\n+\n+All snapshots you created are fully consistent in terms of concurrent cluster-wide operations and all ongoing changes of\n+system files on the local node. Primary and backup cache group partitions will be also fully consistent in created\n+snapshots.\n+\n+The cluster-wide snapshot consistency achieved by triggering the\n+link:https://cwiki.apache.org/confluence/display/IGNITE/%28Partition+Map%29+Exchange+-+under+the+hood[Partition-Map-Exchange]\n+procedure. Doing this the cluster will eventually get a point in time when all previously started transactions\n+finished on primary and backups, and new ones are hold until a new snapshot operation will be started.\n+\n+The local system files consistency (e.g. cache group partition files, binary metadata files, configuration files) achieved\n+by copying them to the destination snapshot directory with tracking all concurrent ongoing changes. Tracking concurrent\n+changes during copying of cache group partition files will require additional space in Ignite system directory.\n+\n+*Snapshot Structure.*\n+\n+The created snapshot has the same\n+link:https://cwiki.apache.org/confluence/display/IGNITE/Ignite+Persistent+Store+-+under+the+hood#IgnitePersistentStoreunderthehood-FoldersStructure[Directory Structure]\n+as the Ignite native persistence does with keeping nodes `consistentId` in snapshot directory. The `wal` directory will\n+be excluded from snapshot since recovery procedures are not necessary for cache group data files.\n+\n+.Example of snapshot directory structure\n+[source,shell]\n+----\n+work\n+\u2514\u2500\u2500 snapshots\n+    \u2514\u2500\u2500 backup23012020\n+        \u251c\u2500\u2500 binary_meta\n+        \u2502   \u251c\u2500\u2500 snapshot_IgniteClusterSnapshotSelfTest0\n+        \u2502   \u251c\u2500\u2500 snapshot_IgniteClusterSnapshotSelfTest1\n+        \u2502   \u2514\u2500\u2500 snapshot_IgniteClusterSnapshotSelfTest2\n+        \u251c\u2500\u2500 db\n+        \u2502   \u251c\u2500\u2500 snapshot_IgniteClusterSnapshotSelfTest0\n+        \u2502   \u2502   \u2514\u2500\u2500 cache-txCache\n+        \u2502   \u2502       \u251c\u2500\u2500 cache_data.dat\n+        \u2502   \u2502       \u251c\u2500\u2500 part-3.bin\n+        \u2502   \u2502       \u251c\u2500\u2500 part-4.bin\n+        \u2502   \u2502       \u2514\u2500\u2500 part-6.bin\n+        \u2502   \u251c\u2500\u2500 snapshot_IgniteClusterSnapshotSelfTest1\n+        \u2502   \u2502   \u2514\u2500\u2500 cache-txCache\n+        \u2502   \u2502       \u251c\u2500\u2500 cache_data.dat\n+        \u2502   \u2502       \u251c\u2500\u2500 part-1.bin\n+        \u2502   \u2502       \u251c\u2500\u2500 part-5.bin\n+        \u2502   \u2502       \u2514\u2500\u2500 part-7.bin\n+        \u2502   \u2514\u2500\u2500 snapshot_IgniteClusterSnapshotSelfTest2\n+        \u2502       \u2514\u2500\u2500 cache-txCache\n+        \u2502           \u251c\u2500\u2500 cache_data.dat\n+        \u2502           \u251c\u2500\u2500 part-0.bin\n+        \u2502           \u2514\u2500\u2500 part-2.bin\n+        \u2514\u2500\u2500 marshaller\n+----\n+\n+*Requirements.*\n+\n+You need an extra space on disk for the configured Ignite native persistence directory up to the current size this directory.\n+This space will be used for storing intermediate snapshot results and will be freed when the snapshot operation ends.\n+\n+*Limitations.*\n+\n+The snapshot procedure has some limitations that you should be aware of before using it at your production environment:\n+\n+* taking a snapshot of particular cache or cache group not supported;\n+* in-memory caches will not be included into snapshot;\n+* encrypted caches not supported and will be ignored;\n+* only single snapshot operation can be started at once;\n+* snapshot procedure will be interrupted if any baseline node leave the cluster;\n+* snapshot recovery at the same baseline topology with the same consistent node id;\n+\n+== Configuration\n+\n+You may configure the destination snapshot directory via `IgniteConfiguration`.\n+\n+[tabs]\n+--\n+tab:XML[]\n+\n+[source, xml]\n+----\n+include::code-snippets/xml/snapshots.xml[tags=ignite-config;!discovery, indent=0]\n+\n+----\n+\n+tab:Java[]\n+\n+[source, java]\n+----\n+include::{javaCodeDir}/Snapshots.java[tags=config, indent=0]\n+\n+----\n+\n+tab:C#/.NET[]\n+tab:C++[]\n+--\n+\n+== Snapshot creation\n+\n+Ignite provides the ability to start a snapshot operation from the following interfaces:\n+\n+- link:#command-line[Command line]\n+- link:#jmx[JMX]\n+- link:#java-api[Java API]\n+\n+=== Command line\n+\n+Ignite ships `control.(sh|bat)` scripts, located in the `$IGNITE_HOME/bin` directory, that acts like a tool to\n+start or cancel snapshot operation from the command line. The following commands can be used with `control.(sh|bat)`:\n+\n+[source,shell]\n+----\n+#Create cluster snapshot:\n+control.(sh|bat) --snapshot create snapshot_name\n+\n+#Cancel running snapshot:\n+control.(sh|bat) --snapshot cancel snapshot_name\n+\n+#Kill running snapshot:\n+control.(sh|bat) --kill SNAPSHOT snapshot_name\n+----\n+\n+=== JMX\n+\n+You can start snapshot operation or cancel currently running via the `SnapshotMXBean` interface:\n+\n+[cols=\"1,1\",opts=\"header\"]\n+|===\n+|Method | Description\n+|createSnapshot(String snpName) | Create cluster-wide snapshot.\n+|cancelSnapshot(String snpName) | Cancel started cluster-wide snapshot on the node initiator.\n+|===\n+\n+=== Java API\n+\n+The snapshot operation can be started using Java API:\n+\n+[tabs]\n+--\n+tab:Java[]\n+\n+[source, java]\n+----\n+include::{javaCodeDir}/Snapshots.java[tags=create, indent=0]\n+----\n+--\n+\n+== Snapshot restore (manually)\n+\n+NOTE: Pay attention in case of removing any data from the `$IGNITE_HOME/work` directory. You do it at your own risk.\n+\n+Currently, the restore procedure is fully manual. Since the snapshot is a consistent copy of all data files for each node,\n+to recover from the particular snapshot you need to start the same cluster with the same configuration on these files.\n+\n+To restore a cluster from the snapshot you must do the following steps for each baseline node in it:\n+\n+- Locate by name the snapshot you created;\n+- Remove all the data from `$IGNITE_HOME/work/{node_id}` where `{node_id}` is a consistent node id which do you work with;\n+- Copy all snapshot files to the `$IGNITE_HOME/work/{node_id}` directory from the snapshot related to `{node_id}`;\n+\n+Some use cases at production deployments may require creating a snapshot at m-node cluster and applying it to n-node\n+cluster. There are a few options here:\n+\n+[cols=\"1,1\",opts=\"header\"]\n+|===\n+|Condition | Description\n+|m == n | The *recommended* case. Use the same baseline and the same configuration.", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "52cfd6e6b9202febfc7d8a5ee07e28c1a02eee44"}, "originalPosition": 176}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NDQ2MTIwNQ==", "bodyText": "The process will require the cluster to be rebalanced and SQL indexes to be rebuilt. These operations may take a long time.", "url": "https://github.com/apache/ignite/pull/8128#discussion_r484461205", "createdAt": "2020-09-07T14:21:01Z", "author": {"login": "Silberfuchs1"}, "path": "docs/_docs/persistence/snapshot.adoc", "diffHunk": "@@ -0,0 +1,181 @@\n+= Snapshots and recovery\n+\n+== Overview\n+\n+Apache Ignite 2.9 comes with an ability to create fully consistent cluster-wide snapshots for deployments with\n+the link:persistence/native-persistence[Ignite Native Persistence]. You can create at runtime any number of snapshots\n+of all configured persistent cache groups. The snapshot is a consistent copy of all cache group data files (except\n+structures used for crash recovery) for each baseline node in a cluster. Since data of persistent cache groups stored\n+on disk in files on each node (cache group partition files, configuration files, binary metadata) the snapshot will\n+contain a copy of the same files with keeping Ignite cluster node data directory structure and the node consistent ids.\n+\n+*Snapshot Consistency.*\n+\n+All snapshots you created are fully consistent in terms of concurrent cluster-wide operations and all ongoing changes of\n+system files on the local node. Primary and backup cache group partitions will be also fully consistent in created\n+snapshots.\n+\n+The cluster-wide snapshot consistency achieved by triggering the\n+link:https://cwiki.apache.org/confluence/display/IGNITE/%28Partition+Map%29+Exchange+-+under+the+hood[Partition-Map-Exchange]\n+procedure. Doing this the cluster will eventually get a point in time when all previously started transactions\n+finished on primary and backups, and new ones are hold until a new snapshot operation will be started.\n+\n+The local system files consistency (e.g. cache group partition files, binary metadata files, configuration files) achieved\n+by copying them to the destination snapshot directory with tracking all concurrent ongoing changes. Tracking concurrent\n+changes during copying of cache group partition files will require additional space in Ignite system directory.\n+\n+*Snapshot Structure.*\n+\n+The created snapshot has the same\n+link:https://cwiki.apache.org/confluence/display/IGNITE/Ignite+Persistent+Store+-+under+the+hood#IgnitePersistentStoreunderthehood-FoldersStructure[Directory Structure]\n+as the Ignite native persistence does with keeping nodes `consistentId` in snapshot directory. The `wal` directory will\n+be excluded from snapshot since recovery procedures are not necessary for cache group data files.\n+\n+.Example of snapshot directory structure\n+[source,shell]\n+----\n+work\n+\u2514\u2500\u2500 snapshots\n+    \u2514\u2500\u2500 backup23012020\n+        \u251c\u2500\u2500 binary_meta\n+        \u2502   \u251c\u2500\u2500 snapshot_IgniteClusterSnapshotSelfTest0\n+        \u2502   \u251c\u2500\u2500 snapshot_IgniteClusterSnapshotSelfTest1\n+        \u2502   \u2514\u2500\u2500 snapshot_IgniteClusterSnapshotSelfTest2\n+        \u251c\u2500\u2500 db\n+        \u2502   \u251c\u2500\u2500 snapshot_IgniteClusterSnapshotSelfTest0\n+        \u2502   \u2502   \u2514\u2500\u2500 cache-txCache\n+        \u2502   \u2502       \u251c\u2500\u2500 cache_data.dat\n+        \u2502   \u2502       \u251c\u2500\u2500 part-3.bin\n+        \u2502   \u2502       \u251c\u2500\u2500 part-4.bin\n+        \u2502   \u2502       \u2514\u2500\u2500 part-6.bin\n+        \u2502   \u251c\u2500\u2500 snapshot_IgniteClusterSnapshotSelfTest1\n+        \u2502   \u2502   \u2514\u2500\u2500 cache-txCache\n+        \u2502   \u2502       \u251c\u2500\u2500 cache_data.dat\n+        \u2502   \u2502       \u251c\u2500\u2500 part-1.bin\n+        \u2502   \u2502       \u251c\u2500\u2500 part-5.bin\n+        \u2502   \u2502       \u2514\u2500\u2500 part-7.bin\n+        \u2502   \u2514\u2500\u2500 snapshot_IgniteClusterSnapshotSelfTest2\n+        \u2502       \u2514\u2500\u2500 cache-txCache\n+        \u2502           \u251c\u2500\u2500 cache_data.dat\n+        \u2502           \u251c\u2500\u2500 part-0.bin\n+        \u2502           \u2514\u2500\u2500 part-2.bin\n+        \u2514\u2500\u2500 marshaller\n+----\n+\n+*Requirements.*\n+\n+You need an extra space on disk for the configured Ignite native persistence directory up to the current size this directory.\n+This space will be used for storing intermediate snapshot results and will be freed when the snapshot operation ends.\n+\n+*Limitations.*\n+\n+The snapshot procedure has some limitations that you should be aware of before using it at your production environment:\n+\n+* taking a snapshot of particular cache or cache group not supported;\n+* in-memory caches will not be included into snapshot;\n+* encrypted caches not supported and will be ignored;\n+* only single snapshot operation can be started at once;\n+* snapshot procedure will be interrupted if any baseline node leave the cluster;\n+* snapshot recovery at the same baseline topology with the same consistent node id;\n+\n+== Configuration\n+\n+You may configure the destination snapshot directory via `IgniteConfiguration`.\n+\n+[tabs]\n+--\n+tab:XML[]\n+\n+[source, xml]\n+----\n+include::code-snippets/xml/snapshots.xml[tags=ignite-config;!discovery, indent=0]\n+\n+----\n+\n+tab:Java[]\n+\n+[source, java]\n+----\n+include::{javaCodeDir}/Snapshots.java[tags=config, indent=0]\n+\n+----\n+\n+tab:C#/.NET[]\n+tab:C++[]\n+--\n+\n+== Snapshot creation\n+\n+Ignite provides the ability to start a snapshot operation from the following interfaces:\n+\n+- link:#command-line[Command line]\n+- link:#jmx[JMX]\n+- link:#java-api[Java API]\n+\n+=== Command line\n+\n+Ignite ships `control.(sh|bat)` scripts, located in the `$IGNITE_HOME/bin` directory, that acts like a tool to\n+start or cancel snapshot operation from the command line. The following commands can be used with `control.(sh|bat)`:\n+\n+[source,shell]\n+----\n+#Create cluster snapshot:\n+control.(sh|bat) --snapshot create snapshot_name\n+\n+#Cancel running snapshot:\n+control.(sh|bat) --snapshot cancel snapshot_name\n+\n+#Kill running snapshot:\n+control.(sh|bat) --kill SNAPSHOT snapshot_name\n+----\n+\n+=== JMX\n+\n+You can start snapshot operation or cancel currently running via the `SnapshotMXBean` interface:\n+\n+[cols=\"1,1\",opts=\"header\"]\n+|===\n+|Method | Description\n+|createSnapshot(String snpName) | Create cluster-wide snapshot.\n+|cancelSnapshot(String snpName) | Cancel started cluster-wide snapshot on the node initiator.\n+|===\n+\n+=== Java API\n+\n+The snapshot operation can be started using Java API:\n+\n+[tabs]\n+--\n+tab:Java[]\n+\n+[source, java]\n+----\n+include::{javaCodeDir}/Snapshots.java[tags=create, indent=0]\n+----\n+--\n+\n+== Snapshot restore (manually)\n+\n+NOTE: Pay attention in case of removing any data from the `$IGNITE_HOME/work` directory. You do it at your own risk.\n+\n+Currently, the restore procedure is fully manual. Since the snapshot is a consistent copy of all data files for each node,\n+to recover from the particular snapshot you need to start the same cluster with the same configuration on these files.\n+\n+To restore a cluster from the snapshot you must do the following steps for each baseline node in it:\n+\n+- Locate by name the snapshot you created;\n+- Remove all the data from `$IGNITE_HOME/work/{node_id}` where `{node_id}` is a consistent node id which do you work with;\n+- Copy all snapshot files to the `$IGNITE_HOME/work/{node_id}` directory from the snapshot related to `{node_id}`;\n+\n+Some use cases at production deployments may require creating a snapshot at m-node cluster and applying it to n-node\n+cluster. There are a few options here:\n+\n+[cols=\"1,1\",opts=\"header\"]\n+|===\n+|Condition | Description\n+|m == n | The *recommended* case. Use the same baseline and the same configuration.\n+|m < n | Start the m-node cluster from the snapshot and add additional nodes to the started baseline. The process will\n+require the cluster to be rebalanced and SQL indexes to be rebuilt which may take a long time.", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "52cfd6e6b9202febfc7d8a5ee07e28c1a02eee44"}, "originalPosition": 178}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NDQ2MTM4NQ==", "bodyText": "Currently, it is not supported.", "url": "https://github.com/apache/ignite/pull/8128#discussion_r484461385", "createdAt": "2020-09-07T14:21:19Z", "author": {"login": "Silberfuchs1"}, "path": "docs/_docs/persistence/snapshot.adoc", "diffHunk": "@@ -0,0 +1,181 @@\n+= Snapshots and recovery\n+\n+== Overview\n+\n+Apache Ignite 2.9 comes with an ability to create fully consistent cluster-wide snapshots for deployments with\n+the link:persistence/native-persistence[Ignite Native Persistence]. You can create at runtime any number of snapshots\n+of all configured persistent cache groups. The snapshot is a consistent copy of all cache group data files (except\n+structures used for crash recovery) for each baseline node in a cluster. Since data of persistent cache groups stored\n+on disk in files on each node (cache group partition files, configuration files, binary metadata) the snapshot will\n+contain a copy of the same files with keeping Ignite cluster node data directory structure and the node consistent ids.\n+\n+*Snapshot Consistency.*\n+\n+All snapshots you created are fully consistent in terms of concurrent cluster-wide operations and all ongoing changes of\n+system files on the local node. Primary and backup cache group partitions will be also fully consistent in created\n+snapshots.\n+\n+The cluster-wide snapshot consistency achieved by triggering the\n+link:https://cwiki.apache.org/confluence/display/IGNITE/%28Partition+Map%29+Exchange+-+under+the+hood[Partition-Map-Exchange]\n+procedure. Doing this the cluster will eventually get a point in time when all previously started transactions\n+finished on primary and backups, and new ones are hold until a new snapshot operation will be started.\n+\n+The local system files consistency (e.g. cache group partition files, binary metadata files, configuration files) achieved\n+by copying them to the destination snapshot directory with tracking all concurrent ongoing changes. Tracking concurrent\n+changes during copying of cache group partition files will require additional space in Ignite system directory.\n+\n+*Snapshot Structure.*\n+\n+The created snapshot has the same\n+link:https://cwiki.apache.org/confluence/display/IGNITE/Ignite+Persistent+Store+-+under+the+hood#IgnitePersistentStoreunderthehood-FoldersStructure[Directory Structure]\n+as the Ignite native persistence does with keeping nodes `consistentId` in snapshot directory. The `wal` directory will\n+be excluded from snapshot since recovery procedures are not necessary for cache group data files.\n+\n+.Example of snapshot directory structure\n+[source,shell]\n+----\n+work\n+\u2514\u2500\u2500 snapshots\n+    \u2514\u2500\u2500 backup23012020\n+        \u251c\u2500\u2500 binary_meta\n+        \u2502   \u251c\u2500\u2500 snapshot_IgniteClusterSnapshotSelfTest0\n+        \u2502   \u251c\u2500\u2500 snapshot_IgniteClusterSnapshotSelfTest1\n+        \u2502   \u2514\u2500\u2500 snapshot_IgniteClusterSnapshotSelfTest2\n+        \u251c\u2500\u2500 db\n+        \u2502   \u251c\u2500\u2500 snapshot_IgniteClusterSnapshotSelfTest0\n+        \u2502   \u2502   \u2514\u2500\u2500 cache-txCache\n+        \u2502   \u2502       \u251c\u2500\u2500 cache_data.dat\n+        \u2502   \u2502       \u251c\u2500\u2500 part-3.bin\n+        \u2502   \u2502       \u251c\u2500\u2500 part-4.bin\n+        \u2502   \u2502       \u2514\u2500\u2500 part-6.bin\n+        \u2502   \u251c\u2500\u2500 snapshot_IgniteClusterSnapshotSelfTest1\n+        \u2502   \u2502   \u2514\u2500\u2500 cache-txCache\n+        \u2502   \u2502       \u251c\u2500\u2500 cache_data.dat\n+        \u2502   \u2502       \u251c\u2500\u2500 part-1.bin\n+        \u2502   \u2502       \u251c\u2500\u2500 part-5.bin\n+        \u2502   \u2502       \u2514\u2500\u2500 part-7.bin\n+        \u2502   \u2514\u2500\u2500 snapshot_IgniteClusterSnapshotSelfTest2\n+        \u2502       \u2514\u2500\u2500 cache-txCache\n+        \u2502           \u251c\u2500\u2500 cache_data.dat\n+        \u2502           \u251c\u2500\u2500 part-0.bin\n+        \u2502           \u2514\u2500\u2500 part-2.bin\n+        \u2514\u2500\u2500 marshaller\n+----\n+\n+*Requirements.*\n+\n+You need an extra space on disk for the configured Ignite native persistence directory up to the current size this directory.\n+This space will be used for storing intermediate snapshot results and will be freed when the snapshot operation ends.\n+\n+*Limitations.*\n+\n+The snapshot procedure has some limitations that you should be aware of before using it at your production environment:\n+\n+* taking a snapshot of particular cache or cache group not supported;\n+* in-memory caches will not be included into snapshot;\n+* encrypted caches not supported and will be ignored;\n+* only single snapshot operation can be started at once;\n+* snapshot procedure will be interrupted if any baseline node leave the cluster;\n+* snapshot recovery at the same baseline topology with the same consistent node id;\n+\n+== Configuration\n+\n+You may configure the destination snapshot directory via `IgniteConfiguration`.\n+\n+[tabs]\n+--\n+tab:XML[]\n+\n+[source, xml]\n+----\n+include::code-snippets/xml/snapshots.xml[tags=ignite-config;!discovery, indent=0]\n+\n+----\n+\n+tab:Java[]\n+\n+[source, java]\n+----\n+include::{javaCodeDir}/Snapshots.java[tags=config, indent=0]\n+\n+----\n+\n+tab:C#/.NET[]\n+tab:C++[]\n+--\n+\n+== Snapshot creation\n+\n+Ignite provides the ability to start a snapshot operation from the following interfaces:\n+\n+- link:#command-line[Command line]\n+- link:#jmx[JMX]\n+- link:#java-api[Java API]\n+\n+=== Command line\n+\n+Ignite ships `control.(sh|bat)` scripts, located in the `$IGNITE_HOME/bin` directory, that acts like a tool to\n+start or cancel snapshot operation from the command line. The following commands can be used with `control.(sh|bat)`:\n+\n+[source,shell]\n+----\n+#Create cluster snapshot:\n+control.(sh|bat) --snapshot create snapshot_name\n+\n+#Cancel running snapshot:\n+control.(sh|bat) --snapshot cancel snapshot_name\n+\n+#Kill running snapshot:\n+control.(sh|bat) --kill SNAPSHOT snapshot_name\n+----\n+\n+=== JMX\n+\n+You can start snapshot operation or cancel currently running via the `SnapshotMXBean` interface:\n+\n+[cols=\"1,1\",opts=\"header\"]\n+|===\n+|Method | Description\n+|createSnapshot(String snpName) | Create cluster-wide snapshot.\n+|cancelSnapshot(String snpName) | Cancel started cluster-wide snapshot on the node initiator.\n+|===\n+\n+=== Java API\n+\n+The snapshot operation can be started using Java API:\n+\n+[tabs]\n+--\n+tab:Java[]\n+\n+[source, java]\n+----\n+include::{javaCodeDir}/Snapshots.java[tags=create, indent=0]\n+----\n+--\n+\n+== Snapshot restore (manually)\n+\n+NOTE: Pay attention in case of removing any data from the `$IGNITE_HOME/work` directory. You do it at your own risk.\n+\n+Currently, the restore procedure is fully manual. Since the snapshot is a consistent copy of all data files for each node,\n+to recover from the particular snapshot you need to start the same cluster with the same configuration on these files.\n+\n+To restore a cluster from the snapshot you must do the following steps for each baseline node in it:\n+\n+- Locate by name the snapshot you created;\n+- Remove all the data from `$IGNITE_HOME/work/{node_id}` where `{node_id}` is a consistent node id which do you work with;\n+- Copy all snapshot files to the `$IGNITE_HOME/work/{node_id}` directory from the snapshot related to `{node_id}`;\n+\n+Some use cases at production deployments may require creating a snapshot at m-node cluster and applying it to n-node\n+cluster. There are a few options here:\n+\n+[cols=\"1,1\",opts=\"header\"]\n+|===\n+|Condition | Description\n+|m == n | The *recommended* case. Use the same baseline and the same configuration.\n+|m < n | Start the m-node cluster from the snapshot and add additional nodes to the started baseline. The process will\n+require the cluster to be rebalanced and SQL indexes to be rebuilt which may take a long time.\n+|m > n | Currently, not supported.", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "52cfd6e6b9202febfc7d8a5ee07e28c1a02eee44"}, "originalPosition": 179}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f9e55f10ae98db07c5629177a05fecdf1e23fa08", "author": {"user": {"login": "Mmuzaf", "name": "Maxim Muzafarov"}}, "url": "https://github.com/apache/ignite/commit/f9e55f10ae98db07c5629177a05fecdf1e23fa08", "committedDate": "2020-09-08T11:22:50Z", "message": "IGNITE-12968 fix review comments"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDg0MDU1ODgy", "url": "https://github.com/apache/ignite/pull/8128#pullrequestreview-484055882", "createdAt": "2020-09-08T11:51:30Z", "commit": {"oid": "f9e55f10ae98db07c5629177a05fecdf1e23fa08"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0wOFQxMTo1MTozMVrOHOZS9g==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0wOFQxMTo1NjozMlrOHOZdiQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NDg1NjU2Ng==", "bodyText": "...is initiated", "url": "https://github.com/apache/ignite/pull/8128#discussion_r484856566", "createdAt": "2020-09-08T11:51:31Z", "author": {"login": "Silberfuchs1"}, "path": "docs/_docs/persistence/snapshot.adoc", "diffHunk": "@@ -3,33 +3,40 @@\n == Overview\n \n Apache Ignite 2.9 comes with an ability to create fully consistent cluster-wide snapshots for deployments with\n-the link:persistence/native-persistence[Ignite Native Persistence]. You can create at runtime any number of snapshots\n-of all configured persistent cache groups. The snapshot is a consistent copy of all cache group data files (except\n-structures used for crash recovery) for each baseline node in a cluster. Since data of persistent cache groups stored\n-on disk in files on each node (cache group partition files, configuration files, binary metadata) the snapshot will\n-contain a copy of the same files with keeping Ignite cluster node data directory structure and the node consistent ids.\n+the link:persistence/native-persistence[Ignite Native Persistence]. At runtime, you can create multiple snapshots of all\n+configured persistent cache groups. The snapshot is a consistent copy of all cache group data files (except\n+structures used for crash recovery) for each baseline node in a cluster. Since data of persistent cache groups is stored\n+on disk in files for each node (cache group partition files, configuration files, binary metadata) in a cluster,\n+the snapshot will contain a copy of the same files with keeping Ignite cluster node data directory structure and node consistent IDs.\n \n-*Snapshot Consistency.*\n+=== Snapshot Consistency\n \n-All snapshots you created are fully consistent in terms of concurrent cluster-wide operations and all ongoing changes of\n-system files on the local node. Primary and backup cache group partitions will be also fully consistent in created\n+All snapshots you've created are fully consistent in terms of concurrent cluster-wide operations and all ongoing changes of\n+system files on the local node. Primary and backup cache group partitions will also be fully consistent in created\n snapshots.\n \n-The cluster-wide snapshot consistency achieved by triggering the\n+The cluster-wide snapshot consistency is achieved by triggering the\n link:https://cwiki.apache.org/confluence/display/IGNITE/%28Partition+Map%29+Exchange+-+under+the+hood[Partition-Map-Exchange]\n-procedure. Doing this the cluster will eventually get a point in time when all previously started transactions\n-finished on primary and backups, and new ones are hold until a new snapshot operation will be started.\n+procedure. Doing this the cluster will eventually get a point in time when all previously started transactions are\n+finished on primary and backups, and new ones are hold until a new snapshot operation will be initiated.", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f9e55f10ae98db07c5629177a05fecdf1e23fa08"}, "originalPosition": 30}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NDg1ODQwNw==", "bodyText": "after the snapshot operation is completed.\nIt is so, because when you say ' completes', the reader will think 'completes doing what?'.", "url": "https://github.com/apache/ignite/pull/8128#discussion_r484858407", "createdAt": "2020-09-08T11:54:59Z", "author": {"login": "Silberfuchs1"}, "path": "docs/_docs/persistence/snapshot.adoc", "diffHunk": "@@ -62,25 +69,25 @@ work\n         \u2514\u2500\u2500 marshaller\n ----\n \n-*Requirements.*\n+=== Requirements\n \n-You need an extra space on disk for the configured Ignite native persistence directory up to the current size this directory.\n-This space will be used for storing intermediate snapshot results and will be freed when the snapshot operation ends.\n+A configured Ignite native persistence directory requires additional disk space (up to the current size of this directory).\n+This space will be used for storing intermediate snapshot results and cleaned up after the snapshot operation completes.", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f9e55f10ae98db07c5629177a05fecdf1e23fa08"}, "originalPosition": 67}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NDg1OTI3Mw==", "bodyText": "if 'operation' than 'initiated'. Let's do so throughout the document.", "url": "https://github.com/apache/ignite/pull/8128#discussion_r484859273", "createdAt": "2020-09-08T11:56:32Z", "author": {"login": "Silberfuchs1"}, "path": "docs/_docs/persistence/snapshot.adoc", "diffHunk": "@@ -62,25 +69,25 @@ work\n         \u2514\u2500\u2500 marshaller\n ----\n \n-*Requirements.*\n+=== Requirements\n \n-You need an extra space on disk for the configured Ignite native persistence directory up to the current size this directory.\n-This space will be used for storing intermediate snapshot results and will be freed when the snapshot operation ends.\n+A configured Ignite native persistence directory requires additional disk space (up to the current size of this directory).\n+This space will be used for storing intermediate snapshot results and cleaned up after the snapshot operation completes.\n \n-*Limitations.*\n+=== Limitations\n \n-The snapshot procedure has some limitations that you should be aware of before using it at your production environment:\n+The snapshot procedure has some limitations that you should be aware of before using it within your production environment:\n \n-* taking a snapshot of particular cache or cache group not supported;\n-* in-memory caches will not be included into snapshot;\n-* encrypted caches not supported and will be ignored;\n-* only single snapshot operation can be started at once;\n-* snapshot procedure will be interrupted if any baseline node leave the cluster;\n-* snapshot recovery at the same baseline topology with the same consistent node id;\n+* taking a snapshot of a particular cache or cache group is not supported;\n+* in-memory caches will not be included into a snapshot;\n+* encrypted caches are not supported and will be ignored;\n+* only one snapshot operation at a time can be started;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f9e55f10ae98db07c5629177a05fecdf1e23fa08"}, "originalPosition": 84}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a43e1bca30f97d034097f95a58b1a32a160cc9f8", "author": {"user": {"login": "Mmuzaf", "name": "Maxim Muzafarov"}}, "url": "https://github.com/apache/ignite/commit/a43e1bca30f97d034097f95a58b1a32a160cc9f8", "committedDate": "2020-09-08T12:10:23Z", "message": "IGNITE-12968 fix review comments 2"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b02cbbc1a90d00d1956a74987343e1ce28142b3c", "author": {"user": {"login": "Mmuzaf", "name": "Maxim Muzafarov"}}, "url": "https://github.com/apache/ignite/commit/b02cbbc1a90d00d1956a74987343e1ce28142b3c", "committedDate": "2020-09-11T07:38:59Z", "message": "IGNITE-12968 fix missprints according to checker"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDg5MTU3NDAz", "url": "https://github.com/apache/ignite/pull/8128#pullrequestreview-489157403", "createdAt": "2020-09-15T22:43:47Z", "commit": {"oid": "b02cbbc1a90d00d1956a74987343e1ce28142b3c"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 9, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xNVQyMjo0Mzo0OFrOHSYvoQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xNVQyMzowOTowN1rOHSZ55g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4OTA0MTgyNQ==", "bodyText": "Can we replace \"persistent cache groups\" with \"cache\" or \"cache and tables\", or \"data\"? The term \"persistent cache groups\" are not widespread among the user community and can cause confusion.\nFor instance, in this sentence you can say:\n\"You can create multiple snapshots of all the data stored in your cluster\"", "url": "https://github.com/apache/ignite/pull/8128#discussion_r489041825", "createdAt": "2020-09-15T22:43:48Z", "author": {"login": "dmagda"}, "path": "docs/_docs/persistence/snapshot.adoc", "diffHunk": "@@ -0,0 +1,188 @@\n+= Snapshots and recovery\n+\n+== Overview\n+\n+Apache Ignite 2.9 comes with an ability to create fully consistent cluster-wide snapshots for deployments with\n+the link:persistence/native-persistence[Ignite Native Persistence]. At runtime, you can create multiple snapshots of all\n+configured persistent cache groups. The snapshot is a consistent copy of all cache group data files (except", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b02cbbc1a90d00d1956a74987343e1ce28142b3c"}, "originalPosition": 7}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4OTA0MjczOA==", "bodyText": "You can simply say \"node\" instead of \"baseline node\" as long as all the nodes have to be in a baseline topology when the persistence is used.", "url": "https://github.com/apache/ignite/pull/8128#discussion_r489042738", "createdAt": "2020-09-15T22:44:59Z", "author": {"login": "dmagda"}, "path": "docs/_docs/persistence/snapshot.adoc", "diffHunk": "@@ -0,0 +1,188 @@\n+= Snapshots and recovery\n+\n+== Overview\n+\n+Apache Ignite 2.9 comes with an ability to create fully consistent cluster-wide snapshots for deployments with\n+the link:persistence/native-persistence[Ignite Native Persistence]. At runtime, you can create multiple snapshots of all\n+configured persistent cache groups. The snapshot is a consistent copy of all cache group data files (except\n+structures used for crash recovery) for each baseline node in a cluster. Since the data of persistent cache groups are stored", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b02cbbc1a90d00d1956a74987343e1ce28142b3c"}, "originalPosition": 8}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4OTA0NTE1Ng==", "bodyText": "Just merge this \"Requirements\" section with the \"Configuration\" section below. They talk about the same thing.", "url": "https://github.com/apache/ignite/pull/8128#discussion_r489045156", "createdAt": "2020-09-15T22:48:08Z", "author": {"login": "dmagda"}, "path": "docs/_docs/persistence/snapshot.adoc", "diffHunk": "@@ -0,0 +1,188 @@\n+= Snapshots and recovery\n+\n+== Overview\n+\n+Apache Ignite 2.9 comes with an ability to create fully consistent cluster-wide snapshots for deployments with\n+the link:persistence/native-persistence[Ignite Native Persistence]. At runtime, you can create multiple snapshots of all\n+configured persistent cache groups. The snapshot is a consistent copy of all cache group data files (except\n+structures used for crash recovery) for each baseline node in a cluster. Since the data of persistent cache groups are stored\n+on disk in files for each node (cache group partition files, configuration files, binary metadata) in a cluster,\n+the snapshot will contain a copy of the same files with keeping Ignite cluster node data directory structure and node consistent IDs.\n+\n+=== Snapshot Consistency\n+\n+All snapshots you've created are fully consistent in terms of concurrent cluster-wide operations and all ongoing changes of\n+system files on the local node. Primary and backup cache group partitions will also be fully consistent in created\n+snapshots.\n+\n+The cluster-wide snapshot consistency is achieved by triggering the\n+link:https://cwiki.apache.org/confluence/display/IGNITE/%28Partition+Map%29+Exchange+-+under+the+hood[Partition-Map-Exchange]\n+procedure. Doing this the cluster will eventually get a point in time when all previously started transactions are\n+finished on primary and backups, and new ones are hold until a new snapshot operation is initiated.\n+\n+The local system files (e.g. cache group partition files, binary metadata files, configuration files) consistency is achieved\n+by copying them to the destination snapshot directory with tracking all concurrent ongoing changes. Tracking concurrent\n+changes during copying of cache group partition files might require additional space in the Ignite work directory.\n+\n+=== Snapshot Structure\n+\n+The created snapshot has the same\n+link:https://cwiki.apache.org/confluence/display/IGNITE/Ignite+Persistent+Store+-+under+the+hood#IgnitePersistentStoreunderthehood-FoldersStructure[Directory Structure]\n+as the Ignite native persistence does with keeping nodes `consistentId` in the snapshot directory. The `wal` and `checkpoint`\n+directories will be excluded from the snapshot since recovery procedures are not necessary for cache group data files.\n+\n+The created snapshot contains:\n+\n+- cache group partition files;\n+- cache configuration files related to cache groups;\n+- binary metadata files;\n+- marshaller data files;\n+\n+.Example of snapshot directory structure\n+[source,shell]\n+----\n+work\n+\u2514\u2500\u2500 snapshots\n+    \u2514\u2500\u2500 backup23012020\n+        \u251c\u2500\u2500 binary_meta\n+        \u2502   \u251c\u2500\u2500 snapshot_IgniteClusterSnapshotSelfTest0\n+        \u2502   \u251c\u2500\u2500 snapshot_IgniteClusterSnapshotSelfTest1\n+        \u2502   \u2514\u2500\u2500 snapshot_IgniteClusterSnapshotSelfTest2\n+        \u251c\u2500\u2500 db\n+        \u2502   \u251c\u2500\u2500 snapshot_IgniteClusterSnapshotSelfTest0\n+        \u2502   \u2502   \u2514\u2500\u2500 cache-txCache\n+        \u2502   \u2502       \u251c\u2500\u2500 cache_data.dat\n+        \u2502   \u2502       \u251c\u2500\u2500 part-3.bin\n+        \u2502   \u2502       \u251c\u2500\u2500 part-4.bin\n+        \u2502   \u2502       \u2514\u2500\u2500 part-6.bin\n+        \u2502   \u251c\u2500\u2500 snapshot_IgniteClusterSnapshotSelfTest1\n+        \u2502   \u2502   \u2514\u2500\u2500 cache-txCache\n+        \u2502   \u2502       \u251c\u2500\u2500 cache_data.dat\n+        \u2502   \u2502       \u251c\u2500\u2500 part-1.bin\n+        \u2502   \u2502       \u251c\u2500\u2500 part-5.bin\n+        \u2502   \u2502       \u2514\u2500\u2500 part-7.bin\n+        \u2502   \u2514\u2500\u2500 snapshot_IgniteClusterSnapshotSelfTest2\n+        \u2502       \u2514\u2500\u2500 cache-txCache\n+        \u2502           \u251c\u2500\u2500 cache_data.dat\n+        \u2502           \u251c\u2500\u2500 part-0.bin\n+        \u2502           \u2514\u2500\u2500 part-2.bin\n+        \u2514\u2500\u2500 marshaller\n+----\n+\n+=== Requirements\n+\n+A configured Ignite native persistence directory requires additional disk space (up to the current size of this directory).\n+This space will be used for storing intermediate snapshot results and cleaned up after the snapshot operation is completed.", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b02cbbc1a90d00d1956a74987343e1ce28142b3c"}, "originalPosition": 75}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4OTA0NzU0Nw==", "bodyText": "Below we are saying that the restore procedure is manual. I would add an item to the limitations list saying that the automatic restore is not available yet.", "url": "https://github.com/apache/ignite/pull/8128#discussion_r489047547", "createdAt": "2020-09-15T22:51:17Z", "author": {"login": "dmagda"}, "path": "docs/_docs/persistence/snapshot.adoc", "diffHunk": "@@ -0,0 +1,188 @@\n+= Snapshots and recovery\n+\n+== Overview\n+\n+Apache Ignite 2.9 comes with an ability to create fully consistent cluster-wide snapshots for deployments with\n+the link:persistence/native-persistence[Ignite Native Persistence]. At runtime, you can create multiple snapshots of all\n+configured persistent cache groups. The snapshot is a consistent copy of all cache group data files (except\n+structures used for crash recovery) for each baseline node in a cluster. Since the data of persistent cache groups are stored\n+on disk in files for each node (cache group partition files, configuration files, binary metadata) in a cluster,\n+the snapshot will contain a copy of the same files with keeping Ignite cluster node data directory structure and node consistent IDs.\n+\n+=== Snapshot Consistency\n+\n+All snapshots you've created are fully consistent in terms of concurrent cluster-wide operations and all ongoing changes of\n+system files on the local node. Primary and backup cache group partitions will also be fully consistent in created\n+snapshots.\n+\n+The cluster-wide snapshot consistency is achieved by triggering the\n+link:https://cwiki.apache.org/confluence/display/IGNITE/%28Partition+Map%29+Exchange+-+under+the+hood[Partition-Map-Exchange]\n+procedure. Doing this the cluster will eventually get a point in time when all previously started transactions are\n+finished on primary and backups, and new ones are hold until a new snapshot operation is initiated.\n+\n+The local system files (e.g. cache group partition files, binary metadata files, configuration files) consistency is achieved\n+by copying them to the destination snapshot directory with tracking all concurrent ongoing changes. Tracking concurrent\n+changes during copying of cache group partition files might require additional space in the Ignite work directory.\n+\n+=== Snapshot Structure\n+\n+The created snapshot has the same\n+link:https://cwiki.apache.org/confluence/display/IGNITE/Ignite+Persistent+Store+-+under+the+hood#IgnitePersistentStoreunderthehood-FoldersStructure[Directory Structure]\n+as the Ignite native persistence does with keeping nodes `consistentId` in the snapshot directory. The `wal` and `checkpoint`\n+directories will be excluded from the snapshot since recovery procedures are not necessary for cache group data files.\n+\n+The created snapshot contains:\n+\n+- cache group partition files;\n+- cache configuration files related to cache groups;\n+- binary metadata files;\n+- marshaller data files;\n+\n+.Example of snapshot directory structure\n+[source,shell]\n+----\n+work\n+\u2514\u2500\u2500 snapshots\n+    \u2514\u2500\u2500 backup23012020\n+        \u251c\u2500\u2500 binary_meta\n+        \u2502   \u251c\u2500\u2500 snapshot_IgniteClusterSnapshotSelfTest0\n+        \u2502   \u251c\u2500\u2500 snapshot_IgniteClusterSnapshotSelfTest1\n+        \u2502   \u2514\u2500\u2500 snapshot_IgniteClusterSnapshotSelfTest2\n+        \u251c\u2500\u2500 db\n+        \u2502   \u251c\u2500\u2500 snapshot_IgniteClusterSnapshotSelfTest0\n+        \u2502   \u2502   \u2514\u2500\u2500 cache-txCache\n+        \u2502   \u2502       \u251c\u2500\u2500 cache_data.dat\n+        \u2502   \u2502       \u251c\u2500\u2500 part-3.bin\n+        \u2502   \u2502       \u251c\u2500\u2500 part-4.bin\n+        \u2502   \u2502       \u2514\u2500\u2500 part-6.bin\n+        \u2502   \u251c\u2500\u2500 snapshot_IgniteClusterSnapshotSelfTest1\n+        \u2502   \u2502   \u2514\u2500\u2500 cache-txCache\n+        \u2502   \u2502       \u251c\u2500\u2500 cache_data.dat\n+        \u2502   \u2502       \u251c\u2500\u2500 part-1.bin\n+        \u2502   \u2502       \u251c\u2500\u2500 part-5.bin\n+        \u2502   \u2502       \u2514\u2500\u2500 part-7.bin\n+        \u2502   \u2514\u2500\u2500 snapshot_IgniteClusterSnapshotSelfTest2\n+        \u2502       \u2514\u2500\u2500 cache-txCache\n+        \u2502           \u251c\u2500\u2500 cache_data.dat\n+        \u2502           \u251c\u2500\u2500 part-0.bin\n+        \u2502           \u2514\u2500\u2500 part-2.bin\n+        \u2514\u2500\u2500 marshaller\n+----\n+\n+=== Requirements\n+\n+A configured Ignite native persistence directory requires additional disk space (up to the current size of this directory).\n+This space will be used for storing intermediate snapshot results and cleaned up after the snapshot operation is completed.\n+\n+=== Limitations\n+\n+The snapshot procedure has some limitations that you should be aware of before using it within your production environment:\n+\n+* taking a snapshot of a particular cache or cache group is not supported;\n+* in-memory caches will not be included into a snapshot;\n+* encrypted caches are not supported and will be ignored;\n+* only one snapshot operation at a time can be initiated;\n+* snapshot procedure will be interrupted if any baseline node leaves the cluster;\n+* snapshot may be restored only at the same baseline topology with the same node consistent IDs;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b02cbbc1a90d00d1956a74987343e1ce28142b3c"}, "originalPosition": 86}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4OTA0OTAxMw==", "bodyText": "Check this page for an example of how to create NOTE callouts (search for the NOTE occurrence):\nhttps://raw.githubusercontent.com/apache/ignite/IGNITE-7595/docs/_docs/quick-start/java.adoc", "url": "https://github.com/apache/ignite/pull/8128#discussion_r489049013", "createdAt": "2020-09-15T22:53:19Z", "author": {"login": "dmagda"}, "path": "docs/_docs/persistence/snapshot.adoc", "diffHunk": "@@ -0,0 +1,188 @@\n+= Snapshots and recovery\n+\n+== Overview\n+\n+Apache Ignite 2.9 comes with an ability to create fully consistent cluster-wide snapshots for deployments with\n+the link:persistence/native-persistence[Ignite Native Persistence]. At runtime, you can create multiple snapshots of all\n+configured persistent cache groups. The snapshot is a consistent copy of all cache group data files (except\n+structures used for crash recovery) for each baseline node in a cluster. Since the data of persistent cache groups are stored\n+on disk in files for each node (cache group partition files, configuration files, binary metadata) in a cluster,\n+the snapshot will contain a copy of the same files with keeping Ignite cluster node data directory structure and node consistent IDs.\n+\n+=== Snapshot Consistency\n+\n+All snapshots you've created are fully consistent in terms of concurrent cluster-wide operations and all ongoing changes of\n+system files on the local node. Primary and backup cache group partitions will also be fully consistent in created\n+snapshots.\n+\n+The cluster-wide snapshot consistency is achieved by triggering the\n+link:https://cwiki.apache.org/confluence/display/IGNITE/%28Partition+Map%29+Exchange+-+under+the+hood[Partition-Map-Exchange]\n+procedure. Doing this the cluster will eventually get a point in time when all previously started transactions are\n+finished on primary and backups, and new ones are hold until a new snapshot operation is initiated.\n+\n+The local system files (e.g. cache group partition files, binary metadata files, configuration files) consistency is achieved\n+by copying them to the destination snapshot directory with tracking all concurrent ongoing changes. Tracking concurrent\n+changes during copying of cache group partition files might require additional space in the Ignite work directory.\n+\n+=== Snapshot Structure\n+\n+The created snapshot has the same\n+link:https://cwiki.apache.org/confluence/display/IGNITE/Ignite+Persistent+Store+-+under+the+hood#IgnitePersistentStoreunderthehood-FoldersStructure[Directory Structure]\n+as the Ignite native persistence does with keeping nodes `consistentId` in the snapshot directory. The `wal` and `checkpoint`\n+directories will be excluded from the snapshot since recovery procedures are not necessary for cache group data files.\n+\n+The created snapshot contains:\n+\n+- cache group partition files;\n+- cache configuration files related to cache groups;\n+- binary metadata files;\n+- marshaller data files;\n+\n+.Example of snapshot directory structure\n+[source,shell]\n+----\n+work\n+\u2514\u2500\u2500 snapshots\n+    \u2514\u2500\u2500 backup23012020\n+        \u251c\u2500\u2500 binary_meta\n+        \u2502   \u251c\u2500\u2500 snapshot_IgniteClusterSnapshotSelfTest0\n+        \u2502   \u251c\u2500\u2500 snapshot_IgniteClusterSnapshotSelfTest1\n+        \u2502   \u2514\u2500\u2500 snapshot_IgniteClusterSnapshotSelfTest2\n+        \u251c\u2500\u2500 db\n+        \u2502   \u251c\u2500\u2500 snapshot_IgniteClusterSnapshotSelfTest0\n+        \u2502   \u2502   \u2514\u2500\u2500 cache-txCache\n+        \u2502   \u2502       \u251c\u2500\u2500 cache_data.dat\n+        \u2502   \u2502       \u251c\u2500\u2500 part-3.bin\n+        \u2502   \u2502       \u251c\u2500\u2500 part-4.bin\n+        \u2502   \u2502       \u2514\u2500\u2500 part-6.bin\n+        \u2502   \u251c\u2500\u2500 snapshot_IgniteClusterSnapshotSelfTest1\n+        \u2502   \u2502   \u2514\u2500\u2500 cache-txCache\n+        \u2502   \u2502       \u251c\u2500\u2500 cache_data.dat\n+        \u2502   \u2502       \u251c\u2500\u2500 part-1.bin\n+        \u2502   \u2502       \u251c\u2500\u2500 part-5.bin\n+        \u2502   \u2502       \u2514\u2500\u2500 part-7.bin\n+        \u2502   \u2514\u2500\u2500 snapshot_IgniteClusterSnapshotSelfTest2\n+        \u2502       \u2514\u2500\u2500 cache-txCache\n+        \u2502           \u251c\u2500\u2500 cache_data.dat\n+        \u2502           \u251c\u2500\u2500 part-0.bin\n+        \u2502           \u2514\u2500\u2500 part-2.bin\n+        \u2514\u2500\u2500 marshaller\n+----\n+\n+=== Requirements\n+\n+A configured Ignite native persistence directory requires additional disk space (up to the current size of this directory).\n+This space will be used for storing intermediate snapshot results and cleaned up after the snapshot operation is completed.\n+\n+=== Limitations\n+\n+The snapshot procedure has some limitations that you should be aware of before using it within your production environment:\n+\n+* taking a snapshot of a particular cache or cache group is not supported;\n+* in-memory caches will not be included into a snapshot;\n+* encrypted caches are not supported and will be ignored;\n+* only one snapshot operation at a time can be initiated;\n+* snapshot procedure will be interrupted if any baseline node leaves the cluster;\n+* snapshot may be restored only at the same baseline topology with the same node consistent IDs;\n+\n+== Configuration\n+\n+The destination snapshot directory can be configured via `IgniteConfiguration`.\n+\n+[tabs]\n+--\n+tab:XML[]\n+\n+[source, xml]\n+----\n+include::code-snippets/xml/snapshots.xml[tags=ignite-config;!discovery, indent=0]\n+\n+----\n+\n+tab:Java[]\n+\n+[source, java]\n+----\n+include::{javaCodeDir}/Snapshots.java[tags=config, indent=0]\n+\n+----\n+\n+tab:C#/.NET[]\n+tab:C++[]\n+--\n+\n+== Snapshot creation\n+\n+Ignite provides the ability to start a snapshot operation from the following interfaces:\n+\n+- link:#command-line[Command line]\n+- link:#jmx[JMX]\n+- link:#java-api[Java API]\n+\n+=== Command line\n+\n+Ignite ships `control.(sh|bat)` scripts, located in the `$IGNITE_HOME/bin` directory, that act like a tool to\n+start or cancel snapshot operation from the command line. The following commands can be used with `control.(sh|bat)`:\n+\n+[source,shell]\n+----\n+#Create cluster snapshot:\n+control.(sh|bat) --snapshot create snapshot_name\n+\n+#Cancel running snapshot:\n+control.(sh|bat) --snapshot cancel snapshot_name\n+\n+#Kill running snapshot:\n+control.(sh|bat) --kill SNAPSHOT snapshot_name\n+----\n+\n+=== JMX\n+\n+You can start snapshot operation or cancel currently running one via the `SnapshotMXBean` interface:\n+\n+[cols=\"1,1\",opts=\"header\"]\n+|===\n+|Method | Description\n+|createSnapshot(String snpName) | Create cluster-wide snapshot.\n+|cancelSnapshot(String snpName) | Cancel started cluster-wide snapshot on the node initiator.\n+|===\n+\n+=== Java API\n+\n+The snapshot operation can be started using Java API:\n+\n+[tabs]\n+--\n+tab:Java[]\n+\n+[source, java]\n+----\n+include::{javaCodeDir}/Snapshots.java[tags=create, indent=0]\n+----\n+--\n+\n+== Restoring from a snapshot (manual)\n+\n+NOTE: Removing data from the $IGNITE_HOME/work directory performed at your own risk.", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b02cbbc1a90d00d1956a74987343e1ce28142b3c"}, "originalPosition": 166}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4OTA1NTUyMg==", "bodyText": "\"you need to start each node of the same cluster on these files...\"\nI would say\n\"you need restart every cluster node swapping its current data from the \"{IGNITE_WORK_DIR}/db\" directory with the data from the snapshot\"", "url": "https://github.com/apache/ignite/pull/8128#discussion_r489055522", "createdAt": "2020-09-15T23:01:53Z", "author": {"login": "dmagda"}, "path": "docs/_docs/persistence/snapshot.adoc", "diffHunk": "@@ -0,0 +1,188 @@\n+= Snapshots and recovery\n+\n+== Overview\n+\n+Apache Ignite 2.9 comes with an ability to create fully consistent cluster-wide snapshots for deployments with\n+the link:persistence/native-persistence[Ignite Native Persistence]. At runtime, you can create multiple snapshots of all\n+configured persistent cache groups. The snapshot is a consistent copy of all cache group data files (except\n+structures used for crash recovery) for each baseline node in a cluster. Since the data of persistent cache groups are stored\n+on disk in files for each node (cache group partition files, configuration files, binary metadata) in a cluster,\n+the snapshot will contain a copy of the same files with keeping Ignite cluster node data directory structure and node consistent IDs.\n+\n+=== Snapshot Consistency\n+\n+All snapshots you've created are fully consistent in terms of concurrent cluster-wide operations and all ongoing changes of\n+system files on the local node. Primary and backup cache group partitions will also be fully consistent in created\n+snapshots.\n+\n+The cluster-wide snapshot consistency is achieved by triggering the\n+link:https://cwiki.apache.org/confluence/display/IGNITE/%28Partition+Map%29+Exchange+-+under+the+hood[Partition-Map-Exchange]\n+procedure. Doing this the cluster will eventually get a point in time when all previously started transactions are\n+finished on primary and backups, and new ones are hold until a new snapshot operation is initiated.\n+\n+The local system files (e.g. cache group partition files, binary metadata files, configuration files) consistency is achieved\n+by copying them to the destination snapshot directory with tracking all concurrent ongoing changes. Tracking concurrent\n+changes during copying of cache group partition files might require additional space in the Ignite work directory.\n+\n+=== Snapshot Structure\n+\n+The created snapshot has the same\n+link:https://cwiki.apache.org/confluence/display/IGNITE/Ignite+Persistent+Store+-+under+the+hood#IgnitePersistentStoreunderthehood-FoldersStructure[Directory Structure]\n+as the Ignite native persistence does with keeping nodes `consistentId` in the snapshot directory. The `wal` and `checkpoint`\n+directories will be excluded from the snapshot since recovery procedures are not necessary for cache group data files.\n+\n+The created snapshot contains:\n+\n+- cache group partition files;\n+- cache configuration files related to cache groups;\n+- binary metadata files;\n+- marshaller data files;\n+\n+.Example of snapshot directory structure\n+[source,shell]\n+----\n+work\n+\u2514\u2500\u2500 snapshots\n+    \u2514\u2500\u2500 backup23012020\n+        \u251c\u2500\u2500 binary_meta\n+        \u2502   \u251c\u2500\u2500 snapshot_IgniteClusterSnapshotSelfTest0\n+        \u2502   \u251c\u2500\u2500 snapshot_IgniteClusterSnapshotSelfTest1\n+        \u2502   \u2514\u2500\u2500 snapshot_IgniteClusterSnapshotSelfTest2\n+        \u251c\u2500\u2500 db\n+        \u2502   \u251c\u2500\u2500 snapshot_IgniteClusterSnapshotSelfTest0\n+        \u2502   \u2502   \u2514\u2500\u2500 cache-txCache\n+        \u2502   \u2502       \u251c\u2500\u2500 cache_data.dat\n+        \u2502   \u2502       \u251c\u2500\u2500 part-3.bin\n+        \u2502   \u2502       \u251c\u2500\u2500 part-4.bin\n+        \u2502   \u2502       \u2514\u2500\u2500 part-6.bin\n+        \u2502   \u251c\u2500\u2500 snapshot_IgniteClusterSnapshotSelfTest1\n+        \u2502   \u2502   \u2514\u2500\u2500 cache-txCache\n+        \u2502   \u2502       \u251c\u2500\u2500 cache_data.dat\n+        \u2502   \u2502       \u251c\u2500\u2500 part-1.bin\n+        \u2502   \u2502       \u251c\u2500\u2500 part-5.bin\n+        \u2502   \u2502       \u2514\u2500\u2500 part-7.bin\n+        \u2502   \u2514\u2500\u2500 snapshot_IgniteClusterSnapshotSelfTest2\n+        \u2502       \u2514\u2500\u2500 cache-txCache\n+        \u2502           \u251c\u2500\u2500 cache_data.dat\n+        \u2502           \u251c\u2500\u2500 part-0.bin\n+        \u2502           \u2514\u2500\u2500 part-2.bin\n+        \u2514\u2500\u2500 marshaller\n+----\n+\n+=== Requirements\n+\n+A configured Ignite native persistence directory requires additional disk space (up to the current size of this directory).\n+This space will be used for storing intermediate snapshot results and cleaned up after the snapshot operation is completed.\n+\n+=== Limitations\n+\n+The snapshot procedure has some limitations that you should be aware of before using it within your production environment:\n+\n+* taking a snapshot of a particular cache or cache group is not supported;\n+* in-memory caches will not be included into a snapshot;\n+* encrypted caches are not supported and will be ignored;\n+* only one snapshot operation at a time can be initiated;\n+* snapshot procedure will be interrupted if any baseline node leaves the cluster;\n+* snapshot may be restored only at the same baseline topology with the same node consistent IDs;\n+\n+== Configuration\n+\n+The destination snapshot directory can be configured via `IgniteConfiguration`.\n+\n+[tabs]\n+--\n+tab:XML[]\n+\n+[source, xml]\n+----\n+include::code-snippets/xml/snapshots.xml[tags=ignite-config;!discovery, indent=0]\n+\n+----\n+\n+tab:Java[]\n+\n+[source, java]\n+----\n+include::{javaCodeDir}/Snapshots.java[tags=config, indent=0]\n+\n+----\n+\n+tab:C#/.NET[]\n+tab:C++[]\n+--\n+\n+== Snapshot creation\n+\n+Ignite provides the ability to start a snapshot operation from the following interfaces:\n+\n+- link:#command-line[Command line]\n+- link:#jmx[JMX]\n+- link:#java-api[Java API]\n+\n+=== Command line\n+\n+Ignite ships `control.(sh|bat)` scripts, located in the `$IGNITE_HOME/bin` directory, that act like a tool to\n+start or cancel snapshot operation from the command line. The following commands can be used with `control.(sh|bat)`:\n+\n+[source,shell]\n+----\n+#Create cluster snapshot:\n+control.(sh|bat) --snapshot create snapshot_name\n+\n+#Cancel running snapshot:\n+control.(sh|bat) --snapshot cancel snapshot_name\n+\n+#Kill running snapshot:\n+control.(sh|bat) --kill SNAPSHOT snapshot_name\n+----\n+\n+=== JMX\n+\n+You can start snapshot operation or cancel currently running one via the `SnapshotMXBean` interface:\n+\n+[cols=\"1,1\",opts=\"header\"]\n+|===\n+|Method | Description\n+|createSnapshot(String snpName) | Create cluster-wide snapshot.\n+|cancelSnapshot(String snpName) | Cancel started cluster-wide snapshot on the node initiator.\n+|===\n+\n+=== Java API\n+\n+The snapshot operation can be started using Java API:\n+\n+[tabs]\n+--\n+tab:Java[]\n+\n+[source, java]\n+----\n+include::{javaCodeDir}/Snapshots.java[tags=create, indent=0]\n+----\n+--\n+\n+== Restoring from a snapshot (manual)\n+\n+NOTE: Removing data from the $IGNITE_HOME/work directory performed at your own risk.\n+\n+Currently, the data restore procedure is fully manual. Since the snapshot is a consistent copy of all data files for each node,\n+in order to recover from the particular snapshot, you need to start each node of the same cluster on these files", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b02cbbc1a90d00d1956a74987343e1ce28142b3c"}, "originalPosition": 169}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4OTA1NzYyMA==", "bodyText": "Do we need to replace the files from the entire work dir or is it enough to do this procedure with {WORK_DIR}/db?\nAlso, you should take into account a use case when the storage path is overridden via DataStorageConfiguration.storagePath parameter.", "url": "https://github.com/apache/ignite/pull/8128#discussion_r489057620", "createdAt": "2020-09-15T23:04:40Z", "author": {"login": "dmagda"}, "path": "docs/_docs/persistence/snapshot.adoc", "diffHunk": "@@ -0,0 +1,188 @@\n+= Snapshots and recovery\n+\n+== Overview\n+\n+Apache Ignite 2.9 comes with an ability to create fully consistent cluster-wide snapshots for deployments with\n+the link:persistence/native-persistence[Ignite Native Persistence]. At runtime, you can create multiple snapshots of all\n+configured persistent cache groups. The snapshot is a consistent copy of all cache group data files (except\n+structures used for crash recovery) for each baseline node in a cluster. Since the data of persistent cache groups are stored\n+on disk in files for each node (cache group partition files, configuration files, binary metadata) in a cluster,\n+the snapshot will contain a copy of the same files with keeping Ignite cluster node data directory structure and node consistent IDs.\n+\n+=== Snapshot Consistency\n+\n+All snapshots you've created are fully consistent in terms of concurrent cluster-wide operations and all ongoing changes of\n+system files on the local node. Primary and backup cache group partitions will also be fully consistent in created\n+snapshots.\n+\n+The cluster-wide snapshot consistency is achieved by triggering the\n+link:https://cwiki.apache.org/confluence/display/IGNITE/%28Partition+Map%29+Exchange+-+under+the+hood[Partition-Map-Exchange]\n+procedure. Doing this the cluster will eventually get a point in time when all previously started transactions are\n+finished on primary and backups, and new ones are hold until a new snapshot operation is initiated.\n+\n+The local system files (e.g. cache group partition files, binary metadata files, configuration files) consistency is achieved\n+by copying them to the destination snapshot directory with tracking all concurrent ongoing changes. Tracking concurrent\n+changes during copying of cache group partition files might require additional space in the Ignite work directory.\n+\n+=== Snapshot Structure\n+\n+The created snapshot has the same\n+link:https://cwiki.apache.org/confluence/display/IGNITE/Ignite+Persistent+Store+-+under+the+hood#IgnitePersistentStoreunderthehood-FoldersStructure[Directory Structure]\n+as the Ignite native persistence does with keeping nodes `consistentId` in the snapshot directory. The `wal` and `checkpoint`\n+directories will be excluded from the snapshot since recovery procedures are not necessary for cache group data files.\n+\n+The created snapshot contains:\n+\n+- cache group partition files;\n+- cache configuration files related to cache groups;\n+- binary metadata files;\n+- marshaller data files;\n+\n+.Example of snapshot directory structure\n+[source,shell]\n+----\n+work\n+\u2514\u2500\u2500 snapshots\n+    \u2514\u2500\u2500 backup23012020\n+        \u251c\u2500\u2500 binary_meta\n+        \u2502   \u251c\u2500\u2500 snapshot_IgniteClusterSnapshotSelfTest0\n+        \u2502   \u251c\u2500\u2500 snapshot_IgniteClusterSnapshotSelfTest1\n+        \u2502   \u2514\u2500\u2500 snapshot_IgniteClusterSnapshotSelfTest2\n+        \u251c\u2500\u2500 db\n+        \u2502   \u251c\u2500\u2500 snapshot_IgniteClusterSnapshotSelfTest0\n+        \u2502   \u2502   \u2514\u2500\u2500 cache-txCache\n+        \u2502   \u2502       \u251c\u2500\u2500 cache_data.dat\n+        \u2502   \u2502       \u251c\u2500\u2500 part-3.bin\n+        \u2502   \u2502       \u251c\u2500\u2500 part-4.bin\n+        \u2502   \u2502       \u2514\u2500\u2500 part-6.bin\n+        \u2502   \u251c\u2500\u2500 snapshot_IgniteClusterSnapshotSelfTest1\n+        \u2502   \u2502   \u2514\u2500\u2500 cache-txCache\n+        \u2502   \u2502       \u251c\u2500\u2500 cache_data.dat\n+        \u2502   \u2502       \u251c\u2500\u2500 part-1.bin\n+        \u2502   \u2502       \u251c\u2500\u2500 part-5.bin\n+        \u2502   \u2502       \u2514\u2500\u2500 part-7.bin\n+        \u2502   \u2514\u2500\u2500 snapshot_IgniteClusterSnapshotSelfTest2\n+        \u2502       \u2514\u2500\u2500 cache-txCache\n+        \u2502           \u251c\u2500\u2500 cache_data.dat\n+        \u2502           \u251c\u2500\u2500 part-0.bin\n+        \u2502           \u2514\u2500\u2500 part-2.bin\n+        \u2514\u2500\u2500 marshaller\n+----\n+\n+=== Requirements\n+\n+A configured Ignite native persistence directory requires additional disk space (up to the current size of this directory).\n+This space will be used for storing intermediate snapshot results and cleaned up after the snapshot operation is completed.\n+\n+=== Limitations\n+\n+The snapshot procedure has some limitations that you should be aware of before using it within your production environment:\n+\n+* taking a snapshot of a particular cache or cache group is not supported;\n+* in-memory caches will not be included into a snapshot;\n+* encrypted caches are not supported and will be ignored;\n+* only one snapshot operation at a time can be initiated;\n+* snapshot procedure will be interrupted if any baseline node leaves the cluster;\n+* snapshot may be restored only at the same baseline topology with the same node consistent IDs;\n+\n+== Configuration\n+\n+The destination snapshot directory can be configured via `IgniteConfiguration`.\n+\n+[tabs]\n+--\n+tab:XML[]\n+\n+[source, xml]\n+----\n+include::code-snippets/xml/snapshots.xml[tags=ignite-config;!discovery, indent=0]\n+\n+----\n+\n+tab:Java[]\n+\n+[source, java]\n+----\n+include::{javaCodeDir}/Snapshots.java[tags=config, indent=0]\n+\n+----\n+\n+tab:C#/.NET[]\n+tab:C++[]\n+--\n+\n+== Snapshot creation\n+\n+Ignite provides the ability to start a snapshot operation from the following interfaces:\n+\n+- link:#command-line[Command line]\n+- link:#jmx[JMX]\n+- link:#java-api[Java API]\n+\n+=== Command line\n+\n+Ignite ships `control.(sh|bat)` scripts, located in the `$IGNITE_HOME/bin` directory, that act like a tool to\n+start or cancel snapshot operation from the command line. The following commands can be used with `control.(sh|bat)`:\n+\n+[source,shell]\n+----\n+#Create cluster snapshot:\n+control.(sh|bat) --snapshot create snapshot_name\n+\n+#Cancel running snapshot:\n+control.(sh|bat) --snapshot cancel snapshot_name\n+\n+#Kill running snapshot:\n+control.(sh|bat) --kill SNAPSHOT snapshot_name\n+----\n+\n+=== JMX\n+\n+You can start snapshot operation or cancel currently running one via the `SnapshotMXBean` interface:\n+\n+[cols=\"1,1\",opts=\"header\"]\n+|===\n+|Method | Description\n+|createSnapshot(String snpName) | Create cluster-wide snapshot.\n+|cancelSnapshot(String snpName) | Cancel started cluster-wide snapshot on the node initiator.\n+|===\n+\n+=== Java API\n+\n+The snapshot operation can be started using Java API:\n+\n+[tabs]\n+--\n+tab:Java[]\n+\n+[source, java]\n+----\n+include::{javaCodeDir}/Snapshots.java[tags=create, indent=0]\n+----\n+--\n+\n+== Restoring from a snapshot (manual)\n+\n+NOTE: Removing data from the $IGNITE_HOME/work directory performed at your own risk.\n+\n+Currently, the data restore procedure is fully manual. Since the snapshot is a consistent copy of all data files for each node,\n+in order to recover from the particular snapshot, you need to start each node of the same cluster on these files\n+(see link:#snapshot-structure[Snapshot Structure] for details).\n+\n+To restore a cluster from a snapshot, the following steps should be performed for each baseline node in it:\n+\n+- Locate the snapshot you've created by name;\n+- Remove all the data from `$IGNITE_HOME/work/{node_id}` where `{node_id}` is a consistent id of a node you work with;\n+- Copy all snapshot files from the snapshot related to `{node_id}` to the $IGNITE_HOME/work/{node_id} directory;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b02cbbc1a90d00d1956a74987343e1ce28142b3c"}, "originalPosition": 176}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4OTA1ODAwNQ==", "bodyText": "Should we mention that the entire cluster must be stopped before the restore procedure?", "url": "https://github.com/apache/ignite/pull/8128#discussion_r489058005", "createdAt": "2020-09-15T23:05:14Z", "author": {"login": "dmagda"}, "path": "docs/_docs/persistence/snapshot.adoc", "diffHunk": "@@ -0,0 +1,188 @@\n+= Snapshots and recovery\n+\n+== Overview\n+\n+Apache Ignite 2.9 comes with an ability to create fully consistent cluster-wide snapshots for deployments with\n+the link:persistence/native-persistence[Ignite Native Persistence]. At runtime, you can create multiple snapshots of all\n+configured persistent cache groups. The snapshot is a consistent copy of all cache group data files (except\n+structures used for crash recovery) for each baseline node in a cluster. Since the data of persistent cache groups are stored\n+on disk in files for each node (cache group partition files, configuration files, binary metadata) in a cluster,\n+the snapshot will contain a copy of the same files with keeping Ignite cluster node data directory structure and node consistent IDs.\n+\n+=== Snapshot Consistency\n+\n+All snapshots you've created are fully consistent in terms of concurrent cluster-wide operations and all ongoing changes of\n+system files on the local node. Primary and backup cache group partitions will also be fully consistent in created\n+snapshots.\n+\n+The cluster-wide snapshot consistency is achieved by triggering the\n+link:https://cwiki.apache.org/confluence/display/IGNITE/%28Partition+Map%29+Exchange+-+under+the+hood[Partition-Map-Exchange]\n+procedure. Doing this the cluster will eventually get a point in time when all previously started transactions are\n+finished on primary and backups, and new ones are hold until a new snapshot operation is initiated.\n+\n+The local system files (e.g. cache group partition files, binary metadata files, configuration files) consistency is achieved\n+by copying them to the destination snapshot directory with tracking all concurrent ongoing changes. Tracking concurrent\n+changes during copying of cache group partition files might require additional space in the Ignite work directory.\n+\n+=== Snapshot Structure\n+\n+The created snapshot has the same\n+link:https://cwiki.apache.org/confluence/display/IGNITE/Ignite+Persistent+Store+-+under+the+hood#IgnitePersistentStoreunderthehood-FoldersStructure[Directory Structure]\n+as the Ignite native persistence does with keeping nodes `consistentId` in the snapshot directory. The `wal` and `checkpoint`\n+directories will be excluded from the snapshot since recovery procedures are not necessary for cache group data files.\n+\n+The created snapshot contains:\n+\n+- cache group partition files;\n+- cache configuration files related to cache groups;\n+- binary metadata files;\n+- marshaller data files;\n+\n+.Example of snapshot directory structure\n+[source,shell]\n+----\n+work\n+\u2514\u2500\u2500 snapshots\n+    \u2514\u2500\u2500 backup23012020\n+        \u251c\u2500\u2500 binary_meta\n+        \u2502   \u251c\u2500\u2500 snapshot_IgniteClusterSnapshotSelfTest0\n+        \u2502   \u251c\u2500\u2500 snapshot_IgniteClusterSnapshotSelfTest1\n+        \u2502   \u2514\u2500\u2500 snapshot_IgniteClusterSnapshotSelfTest2\n+        \u251c\u2500\u2500 db\n+        \u2502   \u251c\u2500\u2500 snapshot_IgniteClusterSnapshotSelfTest0\n+        \u2502   \u2502   \u2514\u2500\u2500 cache-txCache\n+        \u2502   \u2502       \u251c\u2500\u2500 cache_data.dat\n+        \u2502   \u2502       \u251c\u2500\u2500 part-3.bin\n+        \u2502   \u2502       \u251c\u2500\u2500 part-4.bin\n+        \u2502   \u2502       \u2514\u2500\u2500 part-6.bin\n+        \u2502   \u251c\u2500\u2500 snapshot_IgniteClusterSnapshotSelfTest1\n+        \u2502   \u2502   \u2514\u2500\u2500 cache-txCache\n+        \u2502   \u2502       \u251c\u2500\u2500 cache_data.dat\n+        \u2502   \u2502       \u251c\u2500\u2500 part-1.bin\n+        \u2502   \u2502       \u251c\u2500\u2500 part-5.bin\n+        \u2502   \u2502       \u2514\u2500\u2500 part-7.bin\n+        \u2502   \u2514\u2500\u2500 snapshot_IgniteClusterSnapshotSelfTest2\n+        \u2502       \u2514\u2500\u2500 cache-txCache\n+        \u2502           \u251c\u2500\u2500 cache_data.dat\n+        \u2502           \u251c\u2500\u2500 part-0.bin\n+        \u2502           \u2514\u2500\u2500 part-2.bin\n+        \u2514\u2500\u2500 marshaller\n+----\n+\n+=== Requirements\n+\n+A configured Ignite native persistence directory requires additional disk space (up to the current size of this directory).\n+This space will be used for storing intermediate snapshot results and cleaned up after the snapshot operation is completed.\n+\n+=== Limitations\n+\n+The snapshot procedure has some limitations that you should be aware of before using it within your production environment:\n+\n+* taking a snapshot of a particular cache or cache group is not supported;\n+* in-memory caches will not be included into a snapshot;\n+* encrypted caches are not supported and will be ignored;\n+* only one snapshot operation at a time can be initiated;\n+* snapshot procedure will be interrupted if any baseline node leaves the cluster;\n+* snapshot may be restored only at the same baseline topology with the same node consistent IDs;\n+\n+== Configuration\n+\n+The destination snapshot directory can be configured via `IgniteConfiguration`.\n+\n+[tabs]\n+--\n+tab:XML[]\n+\n+[source, xml]\n+----\n+include::code-snippets/xml/snapshots.xml[tags=ignite-config;!discovery, indent=0]\n+\n+----\n+\n+tab:Java[]\n+\n+[source, java]\n+----\n+include::{javaCodeDir}/Snapshots.java[tags=config, indent=0]\n+\n+----\n+\n+tab:C#/.NET[]\n+tab:C++[]\n+--\n+\n+== Snapshot creation\n+\n+Ignite provides the ability to start a snapshot operation from the following interfaces:\n+\n+- link:#command-line[Command line]\n+- link:#jmx[JMX]\n+- link:#java-api[Java API]\n+\n+=== Command line\n+\n+Ignite ships `control.(sh|bat)` scripts, located in the `$IGNITE_HOME/bin` directory, that act like a tool to\n+start or cancel snapshot operation from the command line. The following commands can be used with `control.(sh|bat)`:\n+\n+[source,shell]\n+----\n+#Create cluster snapshot:\n+control.(sh|bat) --snapshot create snapshot_name\n+\n+#Cancel running snapshot:\n+control.(sh|bat) --snapshot cancel snapshot_name\n+\n+#Kill running snapshot:\n+control.(sh|bat) --kill SNAPSHOT snapshot_name\n+----\n+\n+=== JMX\n+\n+You can start snapshot operation or cancel currently running one via the `SnapshotMXBean` interface:\n+\n+[cols=\"1,1\",opts=\"header\"]\n+|===\n+|Method | Description\n+|createSnapshot(String snpName) | Create cluster-wide snapshot.\n+|cancelSnapshot(String snpName) | Cancel started cluster-wide snapshot on the node initiator.\n+|===\n+\n+=== Java API\n+\n+The snapshot operation can be started using Java API:\n+\n+[tabs]\n+--\n+tab:Java[]\n+\n+[source, java]\n+----\n+include::{javaCodeDir}/Snapshots.java[tags=create, indent=0]\n+----\n+--\n+\n+== Restoring from a snapshot (manual)\n+\n+NOTE: Removing data from the $IGNITE_HOME/work directory performed at your own risk.\n+\n+Currently, the data restore procedure is fully manual. Since the snapshot is a consistent copy of all data files for each node,\n+in order to recover from the particular snapshot, you need to start each node of the same cluster on these files\n+(see link:#snapshot-structure[Snapshot Structure] for details).\n+\n+To restore a cluster from a snapshot, the following steps should be performed for each baseline node in it:\n+\n+- Locate the snapshot you've created by name;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b02cbbc1a90d00d1956a74987343e1ce28142b3c"}, "originalPosition": 174}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4OTA2MDgzOA==", "bodyText": "Let's say I had 5 nodes in the N-cluster and trying to apply the snapshot to a 3-node cluster (the m-cluster). I will copy the snapshot files from the first 3 nodes of the N-cluster to the M-cluster.  But what should I do with the snapshot files of the other 2 nodes of the N-cluster? Basically, what's the procedure for squeezing 5 folders (N-cluster) with the snapshots into the 3 folders (M-cluster). That's unclear to me.", "url": "https://github.com/apache/ignite/pull/8128#discussion_r489060838", "createdAt": "2020-09-15T23:09:07Z", "author": {"login": "dmagda"}, "path": "docs/_docs/persistence/snapshot.adoc", "diffHunk": "@@ -0,0 +1,188 @@\n+= Snapshots and recovery\n+\n+== Overview\n+\n+Apache Ignite 2.9 comes with an ability to create fully consistent cluster-wide snapshots for deployments with\n+the link:persistence/native-persistence[Ignite Native Persistence]. At runtime, you can create multiple snapshots of all\n+configured persistent cache groups. The snapshot is a consistent copy of all cache group data files (except\n+structures used for crash recovery) for each baseline node in a cluster. Since the data of persistent cache groups are stored\n+on disk in files for each node (cache group partition files, configuration files, binary metadata) in a cluster,\n+the snapshot will contain a copy of the same files with keeping Ignite cluster node data directory structure and node consistent IDs.\n+\n+=== Snapshot Consistency\n+\n+All snapshots you've created are fully consistent in terms of concurrent cluster-wide operations and all ongoing changes of\n+system files on the local node. Primary and backup cache group partitions will also be fully consistent in created\n+snapshots.\n+\n+The cluster-wide snapshot consistency is achieved by triggering the\n+link:https://cwiki.apache.org/confluence/display/IGNITE/%28Partition+Map%29+Exchange+-+under+the+hood[Partition-Map-Exchange]\n+procedure. Doing this the cluster will eventually get a point in time when all previously started transactions are\n+finished on primary and backups, and new ones are hold until a new snapshot operation is initiated.\n+\n+The local system files (e.g. cache group partition files, binary metadata files, configuration files) consistency is achieved\n+by copying them to the destination snapshot directory with tracking all concurrent ongoing changes. Tracking concurrent\n+changes during copying of cache group partition files might require additional space in the Ignite work directory.\n+\n+=== Snapshot Structure\n+\n+The created snapshot has the same\n+link:https://cwiki.apache.org/confluence/display/IGNITE/Ignite+Persistent+Store+-+under+the+hood#IgnitePersistentStoreunderthehood-FoldersStructure[Directory Structure]\n+as the Ignite native persistence does with keeping nodes `consistentId` in the snapshot directory. The `wal` and `checkpoint`\n+directories will be excluded from the snapshot since recovery procedures are not necessary for cache group data files.\n+\n+The created snapshot contains:\n+\n+- cache group partition files;\n+- cache configuration files related to cache groups;\n+- binary metadata files;\n+- marshaller data files;\n+\n+.Example of snapshot directory structure\n+[source,shell]\n+----\n+work\n+\u2514\u2500\u2500 snapshots\n+    \u2514\u2500\u2500 backup23012020\n+        \u251c\u2500\u2500 binary_meta\n+        \u2502   \u251c\u2500\u2500 snapshot_IgniteClusterSnapshotSelfTest0\n+        \u2502   \u251c\u2500\u2500 snapshot_IgniteClusterSnapshotSelfTest1\n+        \u2502   \u2514\u2500\u2500 snapshot_IgniteClusterSnapshotSelfTest2\n+        \u251c\u2500\u2500 db\n+        \u2502   \u251c\u2500\u2500 snapshot_IgniteClusterSnapshotSelfTest0\n+        \u2502   \u2502   \u2514\u2500\u2500 cache-txCache\n+        \u2502   \u2502       \u251c\u2500\u2500 cache_data.dat\n+        \u2502   \u2502       \u251c\u2500\u2500 part-3.bin\n+        \u2502   \u2502       \u251c\u2500\u2500 part-4.bin\n+        \u2502   \u2502       \u2514\u2500\u2500 part-6.bin\n+        \u2502   \u251c\u2500\u2500 snapshot_IgniteClusterSnapshotSelfTest1\n+        \u2502   \u2502   \u2514\u2500\u2500 cache-txCache\n+        \u2502   \u2502       \u251c\u2500\u2500 cache_data.dat\n+        \u2502   \u2502       \u251c\u2500\u2500 part-1.bin\n+        \u2502   \u2502       \u251c\u2500\u2500 part-5.bin\n+        \u2502   \u2502       \u2514\u2500\u2500 part-7.bin\n+        \u2502   \u2514\u2500\u2500 snapshot_IgniteClusterSnapshotSelfTest2\n+        \u2502       \u2514\u2500\u2500 cache-txCache\n+        \u2502           \u251c\u2500\u2500 cache_data.dat\n+        \u2502           \u251c\u2500\u2500 part-0.bin\n+        \u2502           \u2514\u2500\u2500 part-2.bin\n+        \u2514\u2500\u2500 marshaller\n+----\n+\n+=== Requirements\n+\n+A configured Ignite native persistence directory requires additional disk space (up to the current size of this directory).\n+This space will be used for storing intermediate snapshot results and cleaned up after the snapshot operation is completed.\n+\n+=== Limitations\n+\n+The snapshot procedure has some limitations that you should be aware of before using it within your production environment:\n+\n+* taking a snapshot of a particular cache or cache group is not supported;\n+* in-memory caches will not be included into a snapshot;\n+* encrypted caches are not supported and will be ignored;\n+* only one snapshot operation at a time can be initiated;\n+* snapshot procedure will be interrupted if any baseline node leaves the cluster;\n+* snapshot may be restored only at the same baseline topology with the same node consistent IDs;\n+\n+== Configuration\n+\n+The destination snapshot directory can be configured via `IgniteConfiguration`.\n+\n+[tabs]\n+--\n+tab:XML[]\n+\n+[source, xml]\n+----\n+include::code-snippets/xml/snapshots.xml[tags=ignite-config;!discovery, indent=0]\n+\n+----\n+\n+tab:Java[]\n+\n+[source, java]\n+----\n+include::{javaCodeDir}/Snapshots.java[tags=config, indent=0]\n+\n+----\n+\n+tab:C#/.NET[]\n+tab:C++[]\n+--\n+\n+== Snapshot creation\n+\n+Ignite provides the ability to start a snapshot operation from the following interfaces:\n+\n+- link:#command-line[Command line]\n+- link:#jmx[JMX]\n+- link:#java-api[Java API]\n+\n+=== Command line\n+\n+Ignite ships `control.(sh|bat)` scripts, located in the `$IGNITE_HOME/bin` directory, that act like a tool to\n+start or cancel snapshot operation from the command line. The following commands can be used with `control.(sh|bat)`:\n+\n+[source,shell]\n+----\n+#Create cluster snapshot:\n+control.(sh|bat) --snapshot create snapshot_name\n+\n+#Cancel running snapshot:\n+control.(sh|bat) --snapshot cancel snapshot_name\n+\n+#Kill running snapshot:\n+control.(sh|bat) --kill SNAPSHOT snapshot_name\n+----\n+\n+=== JMX\n+\n+You can start snapshot operation or cancel currently running one via the `SnapshotMXBean` interface:\n+\n+[cols=\"1,1\",opts=\"header\"]\n+|===\n+|Method | Description\n+|createSnapshot(String snpName) | Create cluster-wide snapshot.\n+|cancelSnapshot(String snpName) | Cancel started cluster-wide snapshot on the node initiator.\n+|===\n+\n+=== Java API\n+\n+The snapshot operation can be started using Java API:\n+\n+[tabs]\n+--\n+tab:Java[]\n+\n+[source, java]\n+----\n+include::{javaCodeDir}/Snapshots.java[tags=create, indent=0]\n+----\n+--\n+\n+== Restoring from a snapshot (manual)\n+\n+NOTE: Removing data from the $IGNITE_HOME/work directory performed at your own risk.\n+\n+Currently, the data restore procedure is fully manual. Since the snapshot is a consistent copy of all data files for each node,\n+in order to recover from the particular snapshot, you need to start each node of the same cluster on these files\n+(see link:#snapshot-structure[Snapshot Structure] for details).\n+\n+To restore a cluster from a snapshot, the following steps should be performed for each baseline node in it:\n+\n+- Locate the snapshot you've created by name;\n+- Remove all the data from `$IGNITE_HOME/work/{node_id}` where `{node_id}` is a consistent id of a node you work with;\n+- Copy all snapshot files from the snapshot related to `{node_id}` to the $IGNITE_HOME/work/{node_id} directory;\n+\n+Some use cases at production deployments may require creating a snapshot at the m-node cluster and applying it to the\n+n-node cluster. Here are some options:\n+\n+[cols=\"1,1\",opts=\"header\"]\n+|===\n+|Condition | Description\n+|m == n | The *recommended* case. Use the same baseline and configuration.\n+|m < n | Start the m-node cluster from the snapshot and add additional nodes to the started baseline. The process", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b02cbbc1a90d00d1956a74987343e1ce28142b3c"}, "originalPosition": 185}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "d7721c935153a3375c842f29c6e8a44afc8c607c", "author": {"user": {"login": "Mmuzaf", "name": "Maxim Muzafarov"}}, "url": "https://github.com/apache/ignite/commit/d7721c935153a3375c842f29c6e8a44afc8c607c", "committedDate": "2020-09-16T10:16:59Z", "message": "IGNITE-12968 fix review comments, change topics"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "92a23ab97ee0549af1b489b83a25f28b30d8df45", "author": {"user": {"login": "Mmuzaf", "name": "Maxim Muzafarov"}}, "url": "https://github.com/apache/ignite/commit/92a23ab97ee0549af1b489b83a25f28b30d8df45", "committedDate": "2020-09-16T10:30:32Z", "message": "IGNITE-12968 fix review comments 2"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e0a78aabcfbc4e0052662cc420f9d6bdc1cdde34", "author": {"user": {"login": "Mmuzaf", "name": "Maxim Muzafarov"}}, "url": "https://github.com/apache/ignite/commit/e0a78aabcfbc4e0052662cc420f9d6bdc1cdde34", "committedDate": "2020-09-16T10:31:40Z", "message": "IGNITE-12968 fix review comments 3"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3227, "cost": 1, "resetAt": "2021-10-29T19:57:52Z"}}}