{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDE1Mjk0NjA3", "number": 7787, "title": "IGNITE-12961: Add snapshot create command to control.sh", "bodyText": "Thank you for submitting the pull request to the Apache Ignite.\nIn order to streamline the review of the contribution\nwe ask you to ensure the following steps have been taken:\nThe Contribution Checklist\n\n There is a single JIRA ticket related to the pull request.\n The web-link to the pull request is attached to the JIRA ticket.\n The JIRA ticket has the Patch Available state.\n The pull request body describes changes that have been made.\nThe description explains WHAT and WHY was made instead of HOW.\n The pull request title is treated as the final commit message.\nThe following pattern must be used: IGNITE-12407: Add Cluster API support to Java thin client\n A reviewer has been mentioned through the JIRA comments\n(see the Maintainers list)\n The pull request has been checked by the Teamcity Bot and\nthe green visa attached to the JIRA ticket (see TC.Bot: Check PR)\n\nNotes\n\nHow to Contribute\nCoding abbreviation rules\nCoding Guidelines\nApache Ignite Teamcity Bot\n\nIf you need any help, please email dev@ignite.apache.org or ask an\u0443 advice on http://asf.slack.com #ignite channel.", "createdAt": "2020-05-08T15:34:00Z", "url": "https://github.com/apache/ignite/pull/7787", "merged": true, "mergeCommit": {"oid": "60485b144e8e6cb215049c720edab1ea86669951"}, "closed": true, "closedAt": "2020-05-21T16:16:20Z", "author": {"login": "Mmuzaf"}, "timelineItems": {"totalCount": 21, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABccui9ngH2gAyNDE1Mjk0NjA3OmM4NTM2MWY3YzYxNzc2ZmViYjNhYzhmZjg1ZWM0YjQ4MDRiNjA2OWU=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcjfNCqAFqTQxNjIzNzY1MQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "c85361f7c61776febb3ac8ff85ec4b4804b6069e", "author": {"user": {"login": "Mmuzaf", "name": "Maxim Muzafarov"}}, "url": "https://github.com/apache/ignite/commit/c85361f7c61776febb3ac8ff85ec4b4804b6069e", "committedDate": "2020-04-30T15:09:47Z", "message": "IGNITE-12961: WIP"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "5b434540cf2426d3435b67e64f9e8032a9273cf9", "author": {"user": {"login": "Mmuzaf", "name": "Maxim Muzafarov"}}, "url": "https://github.com/apache/ignite/commit/5b434540cf2426d3435b67e64f9e8032a9273cf9", "committedDate": "2020-05-02T12:41:23Z", "message": "IGNITE-12961: implement snapshot command"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "25ae1baa892b85f00cbfa45b79e5b4aa528e2845", "author": {"user": {"login": "Mmuzaf", "name": "Maxim Muzafarov"}}, "url": "https://github.com/apache/ignite/commit/25ae1baa892b85f00cbfa45b79e5b4aa528e2845", "committedDate": "2020-05-03T09:43:29Z", "message": "Merge branch 'master' into ignite-12961"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e55031ca0022ec65ef952f07e432298f5bfe1f67", "author": {"user": {"login": "Mmuzaf", "name": "Maxim Muzafarov"}}, "url": "https://github.com/apache/ignite/commit/e55031ca0022ec65ef952f07e432298f5bfe1f67", "committedDate": "2020-05-03T14:21:40Z", "message": "IGNITE-12961: throw ex immediately"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "8b1095e7df1886457e3758da1585966c33eb3286", "author": {"user": {"login": "Mmuzaf", "name": "Maxim Muzafarov"}}, "url": "https://github.com/apache/ignite/commit/8b1095e7df1886457e3758da1585966c33eb3286", "committedDate": "2020-05-08T15:31:43Z", "message": "Merge branch 'master' into ignite-12961"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "7ac2e1baf4289346a2a7720e167c843abc705bec", "author": {"user": {"login": "Mmuzaf", "name": "Maxim Muzafarov"}}, "url": "https://github.com/apache/ignite/commit/7ac2e1baf4289346a2a7720e167c843abc705bec", "committedDate": "2020-05-14T13:32:33Z", "message": "Merge branch 'master' into ignite-12961"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "218c312bef42753ede5fbb3754e7ac62992b05b9", "author": {"user": {"login": "Mmuzaf", "name": "Maxim Muzafarov"}}, "url": "https://github.com/apache/ignite/commit/218c312bef42753ede5fbb3754e7ac62992b05b9", "committedDate": "2020-05-18T10:36:58Z", "message": "Merge branch 'master' into ignite-12961"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "d192284441843893206b9f9e3731c9dc95089830", "author": {"user": {"login": "Mmuzaf", "name": "Maxim Muzafarov"}}, "url": "https://github.com/apache/ignite/commit/d192284441843893206b9f9e3731c9dc95089830", "committedDate": "2020-05-18T15:46:56Z", "message": "IGNITE-12961: fix snapshot control.sh command"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDEzNzM0MjEx", "url": "https://github.com/apache/ignite/pull/7787#pullrequestreview-413734211", "createdAt": "2020-05-18T16:02:26Z", "commit": {"oid": "d192284441843893206b9f9e3731c9dc95089830"}, "state": "COMMENTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xOFQxNjowMjoyNlrOGW90Fg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xOFQxNjoxNDo1NlrOGW-T0g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNjczNDYxNA==", "bodyText": "Let's check that a snapshot was created with provided name.", "url": "https://github.com/apache/ignite/pull/7787#discussion_r426734614", "createdAt": "2020-05-18T16:02:26Z", "author": {"login": "NSAmelchev"}, "path": "modules/core/src/test/java/org/apache/ignite/util/GridCommandHandlerTest.java", "diffHunk": "@@ -2089,4 +2089,28 @@ public void testMasterKeyChangeOnInactiveCluster() throws Exception {\n \n         assertContains(log, testOut.toString(), \"Master key change was rejected. The cluster is inactive.\");\n     }\n+\n+    /** @throws Exception If failed. */\n+    @Test\n+    public void testClusterSnapshotCreate() throws Exception {\n+        Ignite ignite = startGrids(2);\n+        ignite.cluster().state(ACTIVE);\n+\n+        createCacheAndPreload(ignite, 10);\n+\n+        CommandHandler h = new CommandHandler();\n+\n+        assertEquals(EXIT_CODE_OK, execute(h, \"--snapshot\", \"create\", \"snapshot_02052020\"));", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d192284441843893206b9f9e3731c9dc95089830"}, "originalPosition": 15}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNjc0MjczOA==", "bodyText": "I suggest that success command execution prints an informative message. For example, the snapshot was(will be) created. And how to monitor the status.", "url": "https://github.com/apache/ignite/pull/7787#discussion_r426742738", "createdAt": "2020-05-18T16:14:56Z", "author": {"login": "NSAmelchev"}, "path": "modules/core/src/main/java/org/apache/ignite/internal/visor/snapshot/VisorSnapshotCreateTask.java", "diffHunk": "@@ -0,0 +1,62 @@\n+/*\n+ * Licensed to the Apache Software Foundation (ASF) under one or more\n+ * contributor license agreements. See the NOTICE file distributed with\n+ * this work for additional information regarding copyright ownership.\n+ * The ASF licenses this file to You under the Apache License, Version 2.0\n+ * (the \"License\"); you may not use this file except in compliance with\n+ * the License. You may obtain a copy of the License at\n+ *\n+ * http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package org.apache.ignite.internal.visor.snapshot;\n+\n+import org.apache.ignite.IgniteException;\n+import org.apache.ignite.IgniteSnapshot;\n+import org.apache.ignite.internal.commandline.snapshot.SnapshotCommand;\n+import org.apache.ignite.internal.processors.cache.persistence.snapshot.SnapshotMXBeanImpl;\n+import org.apache.ignite.internal.processors.task.GridInternal;\n+import org.apache.ignite.internal.visor.VisorJob;\n+import org.apache.ignite.internal.visor.VisorOneNodeTask;\n+\n+/**\n+ * @see SnapshotCommand\n+ * @see IgniteSnapshot#createSnapshot(String)\n+ */\n+@GridInternal\n+public class VisorSnapshotCreateTask extends VisorOneNodeTask<String, Void> {\n+    /** Serial version uid. */\n+    private static final long serialVersionUID = 0L;\n+\n+    /** {@inheritDoc} */\n+    @Override protected VisorJob<String, Void> job(String arg) {\n+        return new VisorSnapshotCreateJob(arg, debug);\n+    }\n+\n+    /** */\n+    private static class VisorSnapshotCreateJob extends VisorJob<String, Void> {\n+        /** Serial version uid. */\n+        private static final long serialVersionUID = 0L;\n+\n+        /**\n+         * @param name Snapshot name.\n+         * @param debug Flag indicating whether debug information should be printed into node log.\n+         */\n+        protected VisorSnapshotCreateJob(String name, boolean debug) {\n+            super(name, debug);\n+        }\n+\n+        /** {@inheritDoc} */\n+        @Override protected Void run(String name) throws IgniteException {\n+            new SnapshotMXBeanImpl(ignite.context()).createSnapshot(name);\n+\n+            return null;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d192284441843893206b9f9e3731c9dc95089830"}, "originalPosition": 59}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "bcf7a4ccf46d0fc09f38b6ae30918c5680228aa3", "author": {"user": {"login": "Mmuzaf", "name": "Maxim Muzafarov"}}, "url": "https://github.com/apache/ignite/commit/bcf7a4ccf46d0fc09f38b6ae30918c5680228aa3", "committedDate": "2020-05-18T20:18:51Z", "message": "IGNITE-12961: fix review comments"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDE0MjYzODY3", "url": "https://github.com/apache/ignite/pull/7787#pullrequestreview-414263867", "createdAt": "2020-05-19T09:25:42Z", "commit": {"oid": "bcf7a4ccf46d0fc09f38b6ae30918c5680228aa3"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "340aecbc6a5fbad57aea8b12ec60046d2fd3854e", "author": {"user": {"login": "Mmuzaf", "name": "Maxim Muzafarov"}}, "url": "https://github.com/apache/ignite/commit/340aecbc6a5fbad57aea8b12ec60046d2fd3854e", "committedDate": "2020-05-19T17:47:42Z", "message": "IGNITE-12961: fix review comments 2"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "d642397caafc57124b93b03edc7a0ed3a0a5b2f5", "author": {"user": {"login": "Mmuzaf", "name": "Maxim Muzafarov"}}, "url": "https://github.com/apache/ignite/commit/d642397caafc57124b93b03edc7a0ed3a0a5b2f5", "committedDate": "2020-05-19T18:29:27Z", "message": "Merge branch 'master' into ignite-12961"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "5a9501759d4b4cb88cedecae0129d5888a5c4939", "author": {"user": {"login": "Mmuzaf", "name": "Maxim Muzafarov"}}, "url": "https://github.com/apache/ignite/commit/5a9501759d4b4cb88cedecae0129d5888a5c4939", "committedDate": "2020-05-19T18:50:42Z", "message": "IGNITE-12961: fix usage"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "8390b16130f91cb3c4c9a597c1c907fbe0970727", "author": {"user": {"login": "Mmuzaf", "name": "Maxim Muzafarov"}}, "url": "https://github.com/apache/ignite/commit/8390b16130f91cb3c4c9a597c1c907fbe0970727", "committedDate": "2020-05-20T10:39:01Z", "message": "IGNITE-12961: fix flaky test"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ceffd82a660c429add6318ccec19cfdc72258388", "author": {"user": {"login": "Mmuzaf", "name": "Maxim Muzafarov"}}, "url": "https://github.com/apache/ignite/commit/ceffd82a660c429add6318ccec19cfdc72258388", "committedDate": "2020-05-20T16:45:06Z", "message": "IGNITE-12961: improve test err logging"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "4849381426bfb74b280be1a4c3375ba24a206951", "author": {"user": {"login": "Mmuzaf", "name": "Maxim Muzafarov"}}, "url": "https://github.com/apache/ignite/commit/4849381426bfb74b280be1a4c3375ba24a206951", "committedDate": "2020-05-21T08:54:53Z", "message": "IGNITE-12961: set default test timeout"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "9b617dade43d17f3a24423628dac97b269ddd64f", "author": {"user": {"login": "Mmuzaf", "name": "Maxim Muzafarov"}}, "url": "https://github.com/apache/ignite/commit/9b617dade43d17f3a24423628dac97b269ddd64f", "committedDate": "2020-05-21T10:25:34Z", "message": "IGNITE-12961: set jmx exporter locally"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "5693d160214246627abab7eae187bc837b461f9a", "author": {"user": {"login": "Mmuzaf", "name": "Maxim Muzafarov"}}, "url": "https://github.com/apache/ignite/commit/5693d160214246627abab7eae187bc837b461f9a", "committedDate": "2020-05-21T15:05:45Z", "message": "IGNITE-12961: fix test"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "d3f34c98def73893a4039e44ecd8cccd8ada11fc", "author": {"user": {"login": "Mmuzaf", "name": "Maxim Muzafarov"}}, "url": "https://github.com/apache/ignite/commit/d3f34c98def73893a4039e44ecd8cccd8ada11fc", "committedDate": "2020-05-21T15:10:56Z", "message": "IGNITE-12961: fix test 2"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDE2MjM3NjUx", "url": "https://github.com/apache/ignite/pull/7787#pullrequestreview-416237651", "createdAt": "2020-05-21T15:14:45Z", "commit": {"oid": "d3f34c98def73893a4039e44ecd8cccd8ada11fc"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2633, "cost": 1, "resetAt": "2021-10-29T19:57:52Z"}}}