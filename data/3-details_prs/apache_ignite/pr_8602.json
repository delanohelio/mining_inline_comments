{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTQ0OTIyMjI3", "number": 8602, "title": "IGNITE-13734 .NET: Register service return type on method invocation", "bodyText": "This PR fixes bug that occurs on the invocation of the service method that has not registered return type.\nThe Contribution Checklist\n\n There is a single JIRA ticket related to the pull request.\n The web-link to the pull request is attached to the JIRA ticket.\n The JIRA ticket has the Patch Available state.\n The pull request body describes changes that have been made.\nThe description explains WHAT and WHY was made instead of HOW.\n The pull request title is treated as the final commit message.\nThe following pattern must be used: IGNITE-XXXX Change summary where XXXX - number of JIRA issue.\n A reviewer has been mentioned through the JIRA comments\n(see the Maintainers list)\n The pull request has been checked by the Teamcity Bot and\nthe green visa attached to the JIRA ticket (see TC.Bot: Check PR)\n\nNotes\n\nHow to Contribute\nCoding abbreviation rules\nCoding Guidelines\nApache Ignite Teamcity Bot\n\nIf you need any help, please email dev@ignite.apache.org or ask an\u0443 advice on http://asf.slack.com #ignite channel.", "createdAt": "2020-12-23T16:18:50Z", "url": "https://github.com/apache/ignite/pull/8602", "merged": true, "mergeCommit": {"oid": "6d02e32e7f049e4f78f7abd37f4ff91d77f738c2"}, "closed": true, "closedAt": "2020-12-25T19:52:13Z", "author": {"login": "nizhikov"}, "timelineItems": {"totalCount": 9, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdpBjkQgH2gAyNTQ0OTIyMjI3OjU2ZmI0OTNjYTliYzZiNjg0OGEyZTE3MWM5OGYxZTZiYjM2NDQ5MWI=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdpqoSigFqTU1ODgyNjQ4Mg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "56fb493ca9bc6b6848a2e171c98f1e6bb364491b", "author": {"user": {"login": "nizhikov", "name": "Nikolay"}}, "url": "https://github.com/apache/ignite/commit/56fb493ca9bc6b6848a2e171c98f1e6bb364491b", "committedDate": "2020-12-23T16:16:53Z", "message": "IGNITE-13734: Register service return type on method invocation."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "fb2206fb56eeefa0b897e6a84bb0ea8c6fbe6f7d", "author": {"user": {"login": "nizhikov", "name": "Nikolay"}}, "url": "https://github.com/apache/ignite/commit/fb2206fb56eeefa0b897e6a84bb0ea8c6fbe6f7d", "committedDate": "2020-12-23T16:35:28Z", "message": "IGNITE-13734: Register service return type on method invocation."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "d00b8adf462c4d803c5a36dc7288cc4dc42e72a9", "author": {"user": {"login": "nizhikov", "name": "Nikolay"}}, "url": "https://github.com/apache/ignite/commit/d00b8adf462c4d803c5a36dc7288cc4dc42e72a9", "committedDate": "2020-12-23T16:39:36Z", "message": "IGNITE-13734: Register service return type on method invocation."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ef76d227943a90f0867c260744e4156d081e1fc0", "author": {"user": {"login": "nizhikov", "name": "Nikolay"}}, "url": "https://github.com/apache/ignite/commit/ef76d227943a90f0867c260744e4156d081e1fc0", "committedDate": "2020-12-24T08:28:22Z", "message": "Merge branch 'master' into IGNITE-13734"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "fb9cbfe7fcae0846f23275f39c29267a22c8428e", "author": {"user": {"login": "nizhikov", "name": "Nikolay"}}, "url": "https://github.com/apache/ignite/commit/fb9cbfe7fcae0846f23275f39c29267a22c8428e", "committedDate": "2020-12-24T12:07:57Z", "message": "Merge branch 'master' into IGNITE-13734"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTU4ODIzMDc5", "url": "https://github.com/apache/ignite/pull/8602#pullrequestreview-558823079", "createdAt": "2020-12-25T15:06:08Z", "commit": {"oid": "d00b8adf462c4d803c5a36dc7288cc4dc42e72a9"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0yNVQxNTowNjowOFrOILdJUA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0yNVQxNToyOTowMVrOILdR5g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0ODg4Mjc2OA==", "bodyText": "Unused import", "url": "https://github.com/apache/ignite/pull/8602#discussion_r548882768", "createdAt": "2020-12-25T15:06:08Z", "author": {"login": "ptupitsyn"}, "path": "modules/platforms/dotnet/Apache.Ignite.Core.Tests/Services/ServiceProxyTest.cs", "diffHunk": "@@ -18,6 +18,7 @@\n namespace Apache.Ignite.Core.Tests.Services\n {\n     using System;\n+    using System.CodeDom;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d00b8adf462c4d803c5a36dc7288cc4dc42e72a9"}, "originalPosition": 4}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0ODg4NDI0Nw==", "bodyText": "Let's extract a method string GetTypeName(int id, bool java).", "url": "https://github.com/apache/ignite/pull/8602#discussion_r548884247", "createdAt": "2020-12-25T15:22:38Z", "author": {"login": "ptupitsyn"}, "path": "modules/platforms/dotnet/Apache.Ignite.Core/Impl/Binary/BinaryProcessor.cs", "diffHunk": "@@ -162,7 +168,34 @@ public BinaryType RegisterEnum(string typeName, IEnumerable<KeyValuePair<string,\n         /// <returns>Type or null.</returns>\n         public string GetTypeName(int id)\n         {\n-            return DoOutInOp((int) Op.GetType, w => w.WriteInt(id), r => Marshaller.StartUnmarshal(r).ReadString());\n+            try\n+            {\n+                return DoOutInOp((int) Op.GetType, w =>", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d00b8adf462c4d803c5a36dc7288cc4dc42e72a9"}, "originalPosition": 20}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0ODg4NDk2Ng==", "bodyText": "I think we can return the name of the registered type from above, no need to call into Java again.", "url": "https://github.com/apache/ignite/pull/8602#discussion_r548884966", "createdAt": "2020-12-25T15:29:01Z", "author": {"login": "ptupitsyn"}, "path": "modules/platforms/dotnet/Apache.Ignite.Core/Impl/Binary/BinaryProcessor.cs", "diffHunk": "@@ -162,7 +168,34 @@ public BinaryType RegisterEnum(string typeName, IEnumerable<KeyValuePair<string,\n         /// <returns>Type or null.</returns>\n         public string GetTypeName(int id)\n         {\n-            return DoOutInOp((int) Op.GetType, w => w.WriteInt(id), r => Marshaller.StartUnmarshal(r).ReadString());\n+            try\n+            {\n+                return DoOutInOp((int) Op.GetType, w =>\n+                {\n+                    w.WriteInt(id);\n+                    w.WriteByte(DotNetPlatformId);\n+                }, r => Marshaller.StartUnmarshal(r).ReadString());\n+            }\n+            catch (BinaryObjectException)\n+            {\n+                if (!Marshaller.RegisterSameJavaType.Value)\n+                    throw;\n+            }\n+\n+            // Try to get java type name and register corresponding DotNet type.\n+            var javaTypeName = DoOutInOp((int) Op.GetType, w =>\n+            {\n+                w.WriteInt(id);\n+                w.WriteByte(JavaPlatformId);\n+            }, r => Marshaller.StartUnmarshal(r).ReadString());\n+\n+            RegisterType(id, Marshaller.GetTypeName(javaTypeName), false);\n+\n+            return DoOutInOp((int) Op.GetType, w =>", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d00b8adf462c4d803c5a36dc7288cc4dc42e72a9"}, "originalPosition": 41}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "397347274e37aee04e24e86edf5082b2d593734c", "author": {"user": {"login": "nizhikov", "name": "Nikolay"}}, "url": "https://github.com/apache/ignite/commit/397347274e37aee04e24e86edf5082b2d593734c", "committedDate": "2020-12-25T15:39:54Z", "message": "Merge branch 'master' into IGNITE-13734"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "2bdafff84d7afea6ba41821b34b8f2b02974570f", "author": {"user": {"login": "nizhikov", "name": "Nikolay"}}, "url": "https://github.com/apache/ignite/commit/2bdafff84d7afea6ba41821b34b8f2b02974570f", "committedDate": "2020-12-25T15:51:18Z", "message": "IGNITE-13734: code review fixes."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTU4ODI2NDgy", "url": "https://github.com/apache/ignite/pull/8602#pullrequestreview-558826482", "createdAt": "2020-12-25T16:08:09Z", "commit": {"oid": "2bdafff84d7afea6ba41821b34b8f2b02974570f"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2301, "cost": 1, "resetAt": "2021-10-29T19:57:52Z"}}}