{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDg5NDI3Mjkz", "number": 8258, "title": "IGNITE-12968 fix snapshot documentation minor issues", "bodyText": "Thank you for submitting the pull request to the Apache Ignite.\nIn order to streamline the review of the contribution\nwe ask you to ensure the following steps have been taken:\nThe Contribution Checklist\n\n There is a single JIRA ticket related to the pull request.\n The web-link to the pull request is attached to the JIRA ticket.\n The JIRA ticket has the Patch Available state.\n The pull request body describes changes that have been made.\nThe description explains WHAT and WHY was made instead of HOW.\n The pull request title is treated as the final commit message.\nThe following pattern must be used: IGNITE-XXXX Change summary where XXXX - number of JIRA issue.\n A reviewer has been mentioned through the JIRA comments\n(see the Maintainers list)\n The pull request has been checked by the Teamcity Bot and\nthe green visa attached to the JIRA ticket (see TC.Bot: Check PR)\n\nNotes\n\nHow to Contribute\nCoding abbreviation rules\nCoding Guidelines\nApache Ignite Teamcity Bot\n\nIf you need any help, please email dev@ignite.apache.org or ask an\u0443 advice on http://asf.slack.com #ignite channel.", "createdAt": "2020-09-18T16:43:36Z", "url": "https://github.com/apache/ignite/pull/8258", "merged": true, "mergeCommit": {"oid": "5e1ce17752536f3a7b33ec5d5fe62c83e31f415a"}, "closed": true, "closedAt": "2020-09-22T12:34:04Z", "author": {"login": "Mmuzaf"}, "timelineItems": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdKIYx1gH2gAyNDg5NDI3MjkzOjAzN2Q4MzNjZDZlNWZkMTExNjA5NzZlM2I3ODZkMDQwNmU4ODc2NTk=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdLXK-CAH2gAyNDg5NDI3MjkzOjNjNDk5ZmM5YzBiZWZkMzMzZTc0NDFkMWVjZjUyMTg0YzYxNmJhOWY=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "037d833cd6e5fd11160976e3b786d0406e887659", "author": {"user": {"login": "Mmuzaf", "name": "Maxim Muzafarov"}}, "url": "https://github.com/apache/ignite/commit/037d833cd6e5fd11160976e3b786d0406e887659", "committedDate": "2020-09-18T16:42:47Z", "message": "IGNITE-12968 fix snapshot documentation minor issues"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDkyODAwOTIx", "url": "https://github.com/apache/ignite/pull/8258#pullrequestreview-492800921", "createdAt": "2020-09-21T16:47:06Z", "commit": {"oid": "037d833cd6e5fd11160976e3b786d0406e887659"}, "state": "COMMENTED", "comments": {"totalCount": 5, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yMVQxNjo0NzowNlrOHVZwkg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yMVQxNjo1ODoxNVrOHVaJ9A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MjIwNDE3OA==", "bodyText": "It feels like we are saying too much in the opening paragraph. Basically, we're listing some or most of the restore steps that are covered down below.\nHow about shortening the opening paragraph to a single sentence and listing all the steps in the numbered-list below?\n_\"Currently, the data restore procedure has to be performed manually. Follow these step to restore a cluster from a snapshot:\n\nStop the cluster you intend to restore\n2)..\nN)\n\"_", "url": "https://github.com/apache/ignite/pull/8258#discussion_r492204178", "createdAt": "2020-09-21T16:47:06Z", "author": {"login": "dmagda"}, "path": "docs/_docs/persistence/snapshots.adoc", "diffHunk": "@@ -131,15 +134,18 @@ include::{javaCodeDir}/Snapshots.java[tags=create, indent=0]\n == Restoring From Snapshot\n \n Currently, the data restore procedure has to be performed manually. In a nutshell, you need to stop the cluster,\n-replace persistence data and other files with the data from the snapshot, and restart the nodes. The detailed procedure\n-looks as follows:\n+replace persistence data and other files with the data from the snapshot, and restart the nodes. Prior to performing", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "037d833cd6e5fd11160976e3b786d0406e887659"}, "originalPosition": 36}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MjIwNTAyMA==", "bodyText": "A grammar mistake introduced by me earlier:\n\"copy the files of belogning to a node\" - remove the \"of\" preposition.", "url": "https://github.com/apache/ignite/pull/8258#discussion_r492205020", "createdAt": "2020-09-21T16:48:32Z", "author": {"login": "dmagda"}, "path": "docs/_docs/persistence/snapshots.adoc", "diffHunk": "@@ -131,15 +134,18 @@ include::{javaCodeDir}/Snapshots.java[tags=create, indent=0]\n == Restoring From Snapshot\n \n Currently, the data restore procedure has to be performed manually. In a nutshell, you need to stop the cluster,\n-replace persistence data and other files with the data from the snapshot, and restart the nodes. The detailed procedure\n-looks as follows:\n+replace persistence data and other files with the data from the snapshot, and restart the nodes. Prior to performing\n+restore steps do not forget to cleanup the Write-ahead and Checkpoint files related to the current cluster. They may\n+trigger unnecessary crash-recovery procedures when the cluster starts from a snapshot.\n+\n+The detailed procedure looks as follows:\n \n . Stop the cluster you intend to restore\n . Do the following on each node:\n-    - Remove all the files and directories under the `$IGNITE_HOME/work/{node_id}` directory. Clean the\n+    - Remove all the files and directories related to the `{nodeId}` under your `$IGNITE_HOME/work/` directory. Clean the\n link:link:persistence/native-persistence#configuring-persistent-storage-directory[`db/{node_id}`] directory separately if\n it's not located under the Ignite `work` dir.\n-    - Copy the files of belonging to a node with the `{node_id}` from the snapshot into the `$IGNITE_HOME/work/{node_id}` directory.\n+    - Copy the files of belonging to a node with the `{node_id}` from the snapshot into the `$IGNITE_HOME/work/` directory.", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "037d833cd6e5fd11160976e3b786d0406e887659"}, "originalPosition": 49}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MjIwNjU1Nw==", "bodyText": "It's unclear what are those other \"files\".  In my version, I wanted to say that all the changes with Ignite Persistence and other files are to be consistently recorded to a snapshot. The \"other files\" imply some other files that unrelated to persistence and it's not that important to mention here.\nIn the current version, we have just \"files\" (without \"other\"). And we either need to return \"other\" or be more specific listing the names of those files.", "url": "https://github.com/apache/ignite/pull/8258#discussion_r492206557", "createdAt": "2020-09-21T16:51:05Z", "author": {"login": "dmagda"}, "path": "docs/_docs/persistence/snapshots.adoc", "diffHunk": "@@ -160,27 +166,27 @@ the topology and wait while the data gets rebalanced and indexes are rebuilt.\n == Consistency Guarantees\n \n All snapshots are fully consistent in terms of concurrent cluster-wide operations as well as ongoing changes with Ignite\n-Persistence and other files on nodes.\n+Persistence and files on nodes.", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "037d833cd6e5fd11160976e3b786d0406e887659"}, "originalPosition": 58}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MjIwOTk1NA==", "bodyText": "The \"cache\" is redundant in the sentence. We can simply say primary and backup partitions. Plus, some people work with SQL tables and this reference to caches can cause confusion.\nConsider this version, it fixes some misprints and addresses the point above:\nOnce this happens, the cluster initiates the snapshot creation procedure. The PME procedure ensures that the snapshot includes primary and backup in a consistent state.", "url": "https://github.com/apache/ignite/pull/8258#discussion_r492209954", "createdAt": "2020-09-21T16:56:58Z", "author": {"login": "dmagda"}, "path": "docs/_docs/persistence/snapshots.adoc", "diffHunk": "@@ -160,27 +166,27 @@ the topology and wait while the data gets rebalanced and indexes are rebuilt.\n == Consistency Guarantees\n \n All snapshots are fully consistent in terms of concurrent cluster-wide operations as well as ongoing changes with Ignite\n-Persistence and other files on nodes.\n+Persistence and files on nodes.\n \n The cluster-wide snapshot consistency is achieved by triggering the link:https://cwiki.apache.org/confluence/display/IGNITE/%28Partition+Map%29+Exchange+-+under+the+hood[Partition-Map-Exchange]\n procedure. By doing that, the cluster will eventually get to the point in time when all previously started transactions are completed, and new\n-ones are paused. Once this happens, the cluster initiates the snapshot creation procedure.\n+ones are paused. Once this happens, the cluster initiates the snapshot creation procedure. Primary and backup cache partitions", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "037d833cd6e5fd11160976e3b786d0406e887659"}, "originalPosition": 63}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MjIxMDY3Ng==", "bodyText": "\"up to the current size of it\" - what is the \"it\"? Are you talking about the size of the persistence files or the storage media as a whole? Please clarify this in place.", "url": "https://github.com/apache/ignite/pull/8258#discussion_r492210676", "createdAt": "2020-09-21T16:58:15Z", "author": {"login": "dmagda"}, "path": "docs/_docs/persistence/snapshots.adoc", "diffHunk": "@@ -160,27 +166,27 @@ the topology and wait while the data gets rebalanced and indexes are rebuilt.\n == Consistency Guarantees\n \n All snapshots are fully consistent in terms of concurrent cluster-wide operations as well as ongoing changes with Ignite\n-Persistence and other files on nodes.\n+Persistence and files on nodes.\n \n The cluster-wide snapshot consistency is achieved by triggering the link:https://cwiki.apache.org/confluence/display/IGNITE/%28Partition+Map%29+Exchange+-+under+the+hood[Partition-Map-Exchange]\n procedure. By doing that, the cluster will eventually get to the point in time when all previously started transactions are completed, and new\n-ones are paused. Once this happens, the cluster initiates the snapshot creation procedure.\n+ones are paused. Once this happens, the cluster initiates the snapshot creation procedure. Primary and backup cache partitions\n+will also be inclued and fully consistent in created snapshots since the PME procedure also awaits transaction completion\n+on backup cache partitions too.\n \n-The consistency between the primary Ignite Persistence files and their snapshot copies is achieved by copying the primary\n+The consistency between the Ignite Persistence files and their snapshot copies is achieved by copying the original\n files to the destination snapshot directory with tracking all concurrent ongoing changes. The tracking of the changes\n-might require extra space on your storage media.\n-\n+might require extra space on the Ignite Persistence storage media (up to the current size of it).", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "037d833cd6e5fd11160976e3b786d0406e887659"}, "originalPosition": 72}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "3c499fc9c0befd333e7441d1ecf52184c616ba9f", "author": {"user": {"login": "Mmuzaf", "name": "Maxim Muzafarov"}}, "url": "https://github.com/apache/ignite/commit/3c499fc9c0befd333e7441d1ecf52184c616ba9f", "committedDate": "2020-09-22T12:30:12Z", "message": "IGNITE-12968 fix review comments 4"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3136, "cost": 1, "resetAt": "2021-10-29T19:57:52Z"}}}