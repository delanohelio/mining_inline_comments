{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDQwNjM3NDQ1", "number": 7967, "title": "Duck is a duck ", "bodyText": "Thank you for submitting the pull request to the Apache Ignite.\nIn order to streamline the review of the contribution\nwe ask you to ensure the following steps have been taken:\nThe Contribution Checklist\n\n There is a single JIRA ticket related to the pull request.\n The web-link to the pull request is attached to the JIRA ticket.\n The JIRA ticket has the Patch Available state.\n The pull request body describes changes that have been made.\nThe description explains WHAT and WHY was made instead of HOW.\n The pull request title is treated as the final commit message.\nThe following pattern must be used: IGNITE-XXXX Change summary where XXXX - number of JIRA issue.\n A reviewer has been mentioned through the JIRA comments\n(see the Maintainers list)\n The pull request has been checked by the Teamcity Bot and\nthe green visa attached to the JIRA ticket (see TC.Bot: Check PR)\n\nNotes\n\nHow to Contribute\nCoding abbreviation rules\nCoding Guidelines\nApache Ignite Teamcity Bot\n\nIf you need any help, please email dev@ignite.apache.org or ask an\u0443 advice on http://asf.slack.com #ignite channel.", "createdAt": "2020-06-26T15:05:48Z", "url": "https://github.com/apache/ignite/pull/7967", "merged": true, "mergeCommit": {"oid": "aeb5db9afe9b117d36ebf8590ff3df1df114f15b"}, "closed": true, "closedAt": "2020-07-16T10:34:29Z", "author": {"login": "anton-vinogradov"}, "timelineItems": {"totalCount": 18, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcvEozvgH2gAyNDQwNjM3NDQ1OjNjMzk5ODMwMDViZDllYWY4Y2I0NTg5NTBkOTQyZmI1OTJmZmY4NWM=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcy6xxMgH2gAyNDQwNjM3NDQ1OmMyODNhNTE0NGY1ZjFmOTgzMGEyYWE0M2RjOTdhZjVmZDg2NjAyYWM=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "3c39983005bd9eaf8cb458950d942fb592fff85c", "author": {"user": {"login": "anton-vinogradov", "name": "Anton Vinogradov"}}, "url": "https://github.com/apache/ignite/commit/3c39983005bd9eaf8cb458950d942fb592fff85c", "committedDate": "2020-06-26T15:04:43Z", "message": "duck is a duck"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "9ebffa7201275fc05c3928d8827880b66849d291", "author": {"user": {"login": "anton-vinogradov", "name": "Anton Vinogradov"}}, "url": "https://github.com/apache/ignite/commit/9ebffa7201275fc05c3928d8827880b66849d291", "committedDate": "2020-06-29T08:06:41Z", "message": "checkstyle + package refactoring"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "22392a11a4318f3ca03bad18710ae3a3ab605a52", "author": {"user": {"login": "anton-vinogradov", "name": "Anton Vinogradov"}}, "url": "https://github.com/apache/ignite/commit/22392a11a4318f3ca03bad18710ae3a3ab605a52", "committedDate": "2020-06-29T08:09:06Z", "message": "WIP"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b01929ddfe7696027562f7ccdf1fe196f00edc5d", "author": {"user": {"login": "anton-vinogradov", "name": "Anton Vinogradov"}}, "url": "https://github.com/apache/ignite/commit/b01929ddfe7696027562f7ccdf1fe196f00edc5d", "committedDate": "2020-06-29T09:38:42Z", "message": "WIP"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e3ea44b397db5a621104b864ab84c931ca8ada55", "author": {"user": {"login": "anton-vinogradov", "name": "Anton Vinogradov"}}, "url": "https://github.com/apache/ignite/commit/e3ea44b397db5a621104b864ab84c931ca8ada55", "committedDate": "2020-06-30T07:34:07Z", "message": "WIP"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "32109c09bd024f45b6be930da55d563b2d70559e", "author": {"user": {"login": "anton-vinogradov", "name": "Anton Vinogradov"}}, "url": "https://github.com/apache/ignite/commit/32109c09bd024f45b6be930da55d563b2d70559e", "committedDate": "2020-06-30T10:34:21Z", "message": "WIP"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDQxNjU2NTQz", "url": "https://github.com/apache/ignite/pull/7967#pullrequestreview-441656543", "createdAt": "2020-07-02T13:03:38Z", "commit": {"oid": "32109c09bd024f45b6be930da55d563b2d70559e"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wMlQxMzowMzozOFrOGsL5cw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wMlQxMzowMzozOFrOGsL5cw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0ODk4NTQ1OQ==", "bodyText": "Use \"RUN curl -O\" or \"RUN wget\" instead of ADD to enable caching. Check this issue", "url": "https://github.com/apache/ignite/pull/7967#discussion_r448985459", "createdAt": "2020-07-02T13:03:38Z", "author": {"login": "timoninmaxim"}, "path": "modules/ducktests/tests/docker/Dockerfile", "diffHunk": "@@ -48,14 +48,13 @@ ARG APACHE_MIRROR=\"https://apache-mirror.rbc.ru/pub/apache/\"\n ARG APACHE_ARCHIVE=\"https://archive.apache.org/dist/\"\n \n # Install binary test dependencies.\n-ARG IGNITE_VERSION=\"2.8.0\"\n-ARG IGNITE_NAME=\"ignite-$IGNITE_VERSION\"\n-ARG IGNITE_RELEASE_NAME=\"apache-ignite-$IGNITE_VERSION-bin\"\n-\n-ADD $APACHE_ARCHIVE/ignite/$IGNITE_VERSION/$IGNITE_RELEASE_NAME.zip /opt/\n-RUN cd /opt && unzip $IGNITE_RELEASE_NAME.zip && rm $IGNITE_RELEASE_NAME.zip\n-RUN mv /opt/$IGNITE_RELEASE_NAME /opt/$IGNITE_NAME\n-RUN chmod a+wr /opt/$IGNITE_NAME -R\n+ADD $APACHE_ARCHIVE/ignite/2.7.6/apache-ignite-2.7.6-bin.zip /opt/", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "32109c09bd024f45b6be930da55d563b2d70559e"}, "originalPosition": 21}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDQxNjU3ODg0", "url": "https://github.com/apache/ignite/pull/7967#pullrequestreview-441657884", "createdAt": "2020-07-02T13:05:13Z", "commit": {"oid": "32109c09bd024f45b6be930da55d563b2d70559e"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wMlQxMzowNToxNFrOGsL9dg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wMlQxMzowNToxNFrOGsL9dg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0ODk4NjQ4Ng==", "bodyText": "IGNITE_NAME was removed, chmod invoked twice", "url": "https://github.com/apache/ignite/pull/7967#discussion_r448986486", "createdAt": "2020-07-02T13:05:14Z", "author": {"login": "timoninmaxim"}, "path": "modules/ducktests/tests/docker/Dockerfile", "diffHunk": "@@ -48,14 +48,13 @@ ARG APACHE_MIRROR=\"https://apache-mirror.rbc.ru/pub/apache/\"\n ARG APACHE_ARCHIVE=\"https://archive.apache.org/dist/\"\n \n # Install binary test dependencies.\n-ARG IGNITE_VERSION=\"2.8.0\"\n-ARG IGNITE_NAME=\"ignite-$IGNITE_VERSION\"\n-ARG IGNITE_RELEASE_NAME=\"apache-ignite-$IGNITE_VERSION-bin\"\n-\n-ADD $APACHE_ARCHIVE/ignite/$IGNITE_VERSION/$IGNITE_RELEASE_NAME.zip /opt/\n-RUN cd /opt && unzip $IGNITE_RELEASE_NAME.zip && rm $IGNITE_RELEASE_NAME.zip\n-RUN mv /opt/$IGNITE_RELEASE_NAME /opt/$IGNITE_NAME\n-RUN chmod a+wr /opt/$IGNITE_NAME -R\n+ADD $APACHE_ARCHIVE/ignite/2.7.6/apache-ignite-2.7.6-bin.zip /opt/\n+RUN cd /opt && unzip apache-ignite-2.7.6-bin.zip && mv /opt/apache-ignite-2.7.6-bin /opt/ignite-2.7.6 && chmod a+wr /opt/$IGNITE_NAME -R", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "32109c09bd024f45b6be930da55d563b2d70559e"}, "originalPosition": 22}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDQxNjg0ODAw", "url": "https://github.com/apache/ignite/pull/7967#pullrequestreview-441684800", "createdAt": "2020-07-02T13:36:14Z", "commit": {"oid": "32109c09bd024f45b6be930da55d563b2d70559e"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wMlQxMzozNjoxNFrOGsNMAw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wMlQxMzozNjoxNFrOGsNMAw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0OTAwNjU5NQ==", "bodyText": "add XX:+UseCGroupMemoryLimitForHeap option for JVM to enable correct cgroups for Java application inside docker. Check this article", "url": "https://github.com/apache/ignite/pull/7967#discussion_r449006595", "createdAt": "2020-07-02T13:36:14Z", "author": {"login": "timoninmaxim"}, "path": "modules/ducktests/tests/ignitetest/services/ignite.py", "diffHunk": "@@ -20,79 +20,52 @@\n from ducktape.services.service import Service\n from ducktape.utils.util import wait_until\n \n-from ignitetest.services.utils.ignite_config import IgniteConfig\n-from ignitetest.services.utils.ignite_path import IgnitePath\n+from ignitetest.services.utils.ignite_aware import IgniteAwareService\n from ignitetest.version import DEV_BRANCH\n \n \n-class IgniteService(Service):\n-    PERSISTENT_ROOT = \"/mnt/ignite\"\n-    WORK_DIR = os.path.join(PERSISTENT_ROOT, \"work\")\n-    CONFIG_FILE = os.path.join(PERSISTENT_ROOT, \"ignite-config.xml\")\n-    LOG4J_CONFIG_FILE = os.path.join(PERSISTENT_ROOT, \"ignite-log4j.xml\")\n-    HEAP_DUMP_FILE = os.path.join(PERSISTENT_ROOT, \"ignite-heap.bin\")\n-    STDOUT_STDERR_CAPTURE = os.path.join(PERSISTENT_ROOT, \"console.log\")\n+class IgniteService(IgniteAwareService):\n+    APP_SERVICE_CLASS = \"org.apache.ignite.startup.cmdline.CommandLineStartup\"\n+    HEAP_DUMP_FILE = os.path.join(IgniteAwareService.PERSISTENT_ROOT, \"ignite-heap.bin\")\n \n     logs = {\n         \"console_log\": {\n-            \"path\": STDOUT_STDERR_CAPTURE,\n+            \"path\": IgniteAwareService.STDOUT_STDERR_CAPTURE,\n             \"collect_default\": True},\n \n         \"heap_dump\": {\n             \"path\": HEAP_DUMP_FILE,\n             \"collect_default\": False}\n     }\n \n-    def __init__(self, context, num_nodes=3, version=DEV_BRANCH):\n-        \"\"\"\n-        :param context: test context\n-        :param num_nodes: number of Ignite nodes.\n-        \"\"\"\n-        Service.__init__(self, context, num_nodes)\n+    def __init__(self, context, num_nodes, version=DEV_BRANCH, properties=\"\"):\n+        IgniteAwareService.__init__(self, context, num_nodes, version, properties)\n \n-        self.log_level = \"DEBUG\"\n-        self.config = IgniteConfig()\n-        self.path = IgnitePath()\n-\n-        for node in self.nodes:\n-            node.version = version\n-\n-    def start(self):\n+    def start(self, timeout_sec=180):\n         Service.start(self)\n \n-        self.logger.info(\"Waiting for Ignite to start...\")\n+        self.logger.info(\"Waiting for Ignite(s) to start...\")\n+\n+        for node in self.nodes:\n+            self.await_node_stated(node, timeout_sec)\n \n     def start_cmd(self, node):\n         jvm_opts = \"-J-DIGNITE_SUCCESS_FILE=\" + IgniteService.PERSISTENT_ROOT + \"/success_file \"\n         jvm_opts += \"-J-Dlog4j.configDebug=true\"", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "32109c09bd024f45b6be930da55d563b2d70559e"}, "originalPosition": 60}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDQxODk3OTE0", "url": "https://github.com/apache/ignite/pull/7967#pullrequestreview-441897914", "createdAt": "2020-07-02T17:34:57Z", "commit": {"oid": "32109c09bd024f45b6be930da55d563b2d70559e"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wMlQxNzozNDo1N1rOGsXPYw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wMlQxNzozNDo1N1rOGsXPYw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0OTE3MTI5OQ==", "bodyText": "Versions should be moved to config. Adding new versions (or ISP versions) will lead to change multiple files just to update version.", "url": "https://github.com/apache/ignite/pull/7967#discussion_r449171299", "createdAt": "2020-07-02T17:34:57Z", "author": {"login": "timoninmaxim"}, "path": "modules/ducktests/tests/ignitetest/tests/benchmarks/add_node_rebalance_test.py", "diffHunk": "@@ -0,0 +1,94 @@\n+# Licensed to the Apache Software Foundation (ASF) under one or more\n+# contributor license agreements.  See the NOTICE file distributed with\n+# this work for additional information regarding copyright ownership.\n+# The ASF licenses this file to You under the Apache License, Version 2.0\n+# (the \"License\"); you may not use this file except in compliance with\n+# the License.  You may obtain a copy of the License at\n+#\n+#    http://www.apache.org/licenses/LICENSE-2.0\n+#\n+# Unless required by applicable law or agreed to in writing, software\n+# distributed under the License is distributed on an \"AS IS\" BASIS,\n+# WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+# See the License for the specific language governing permissions and\n+# limitations under the License.\n+import time\n+\n+from ducktape.mark import parametrize\n+from ducktape.mark.resource import cluster\n+\n+from ignitetest.services.ignite import IgniteService\n+from ignitetest.services.ignite_app import IgniteApplicationService\n+from ignitetest.tests.utils.ignite_test import IgniteTest\n+from ignitetest.version import DEV_BRANCH, IgniteVersion, V_2_8_0\n+\n+\n+class AddNodeRebalanceTest(IgniteTest):\n+    NUM_NODES = 4\n+    PRELOAD_TIMEOUT = 60\n+    DATA_AMOUNT = 1000000\n+    REBALANCE_TIMEOUT = 60\n+\n+    \"\"\"\n+    Test performs rebalance tests.\n+    \"\"\"\n+\n+    @staticmethod\n+    def properties(client_mode=\"false\"):\n+        return \"\"\"\n+            <property name=\"clientMode\" value=\"{client_mode}\"/>\n+        \"\"\".format(client_mode=client_mode)\n+\n+    def __init__(self, test_context):\n+        super(AddNodeRebalanceTest, self).__init__(test_context=test_context)\n+\n+    def setUp(self):\n+        pass\n+\n+    def teardown(self):\n+        pass\n+\n+    @cluster(num_nodes=NUM_NODES + 1)\n+    @parametrize(version=str(DEV_BRANCH))\n+    @parametrize(version=str(V_2_8_0))", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "32109c09bd024f45b6be930da55d563b2d70559e"}, "originalPosition": 53}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDQxOTA0MDk1", "url": "https://github.com/apache/ignite/pull/7967#pullrequestreview-441904095", "createdAt": "2020-07-02T17:44:27Z", "commit": {"oid": "32109c09bd024f45b6be930da55d563b2d70559e"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wMlQxNzo0NDoyOFrOGsXiOQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wMlQxNzo0NDoyOFrOGsXiOQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0OTE3NjEyMQ==", "bodyText": "Versions and distributive sources should be configured externally: easy add new versions, custom versions from custom sources, without changing dockerfile.\nPossible just try use different images for different versions (to save time on prepare tests to start)", "url": "https://github.com/apache/ignite/pull/7967#discussion_r449176121", "createdAt": "2020-07-02T17:44:28Z", "author": {"login": "timoninmaxim"}, "path": "modules/ducktests/tests/docker/Dockerfile", "diffHunk": "@@ -48,14 +48,13 @@ ARG APACHE_MIRROR=\"https://apache-mirror.rbc.ru/pub/apache/\"\n ARG APACHE_ARCHIVE=\"https://archive.apache.org/dist/\"\n \n # Install binary test dependencies.\n-ARG IGNITE_VERSION=\"2.8.0\"\n-ARG IGNITE_NAME=\"ignite-$IGNITE_VERSION\"\n-ARG IGNITE_RELEASE_NAME=\"apache-ignite-$IGNITE_VERSION-bin\"\n-\n-ADD $APACHE_ARCHIVE/ignite/$IGNITE_VERSION/$IGNITE_RELEASE_NAME.zip /opt/\n-RUN cd /opt && unzip $IGNITE_RELEASE_NAME.zip && rm $IGNITE_RELEASE_NAME.zip\n-RUN mv /opt/$IGNITE_RELEASE_NAME /opt/$IGNITE_NAME\n-RUN chmod a+wr /opt/$IGNITE_NAME -R\n+ADD $APACHE_ARCHIVE/ignite/2.7.6/apache-ignite-2.7.6-bin.zip /opt/\n+RUN cd /opt && unzip apache-ignite-2.7.6-bin.zip && mv /opt/apache-ignite-2.7.6-bin /opt/ignite-2.7.6 && chmod a+wr /opt/$IGNITE_NAME -R\n+\n+ADD $APACHE_ARCHIVE/ignite/2.8.0/apache-ignite-2.8.0-bin.zip /opt/", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "32109c09bd024f45b6be930da55d563b2d70559e"}, "originalPosition": 24}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDQxOTExNjc1", "url": "https://github.com/apache/ignite/pull/7967#pullrequestreview-441911675", "createdAt": "2020-07-02T17:56:21Z", "commit": {"oid": "32109c09bd024f45b6be930da55d563b2d70559e"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wMlQxNzo1NjoyMVrOGsX5hg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wMlQxNzo1NjoyMVrOGsX5hg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0OTE4MjA4Ng==", "bodyText": "delegated could be misleading. Containers are reused for running tests with ./run_tests.sh script. But docker docs says:\n\nIf changes to the mount source directory are present on the host file system, those changes may be lost when the delegated mount synchronizes with the host source directory.\n\nIt could lead to situation when change of sources does not synchronized and does not affect tests.\nCheck this article", "url": "https://github.com/apache/ignite/pull/7967#discussion_r449182086", "createdAt": "2020-07-02T17:56:21Z", "author": {"login": "timoninmaxim"}, "path": "modules/ducktests/tests/docker/ducker-ignite", "diffHunk": "@@ -258,7 +258,7 @@ docker_run() {\n     must_do -v docker run --privileged \\\n         -d -t -h \"${node}\" --network ducknet \"${expose_ports}\" \\\n         --memory=${docker_run_memory_limit} --memory-swappiness=1 \\\n-        -v \"${ignite_dir}:/opt/ignite-dev\" --name \"${node}\" -- \"${image_name}\"\n+        -v \"${ignite_dir}:/opt/ignite-dev:delegated\" --name \"${node}\" -- \"${image_name}\"", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "32109c09bd024f45b6be930da55d563b2d70559e"}, "originalPosition": 14}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "aae0cab81c48c1b871945cc96ec1b2966633177b", "author": {"user": {"login": "anton-vinogradov", "name": "Anton Vinogradov"}}, "url": "https://github.com/apache/ignite/commit/aae0cab81c48c1b871945cc96ec1b2966633177b", "committedDate": "2020-07-03T11:50:31Z", "message": "WIP"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "5613c63ced32fe1c89204474936e6aeb1cf6b94c", "author": {"user": {"login": "anton-vinogradov", "name": "Anton Vinogradov"}}, "url": "https://github.com/apache/ignite/commit/5613c63ced32fe1c89204474936e6aeb1cf6b94c", "committedDate": "2020-07-03T12:27:23Z", "message": "WIP"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "065be2e4cbe2d8675db84e8b4cee049ae4408262", "author": {"user": {"login": "anton-vinogradov", "name": "Anton Vinogradov"}}, "url": "https://github.com/apache/ignite/commit/065be2e4cbe2d8675db84e8b4cee049ae4408262", "committedDate": "2020-07-03T12:46:47Z", "message": "Merge remote-tracking branch 'remotes/origin/ignite-ducktape' into ignite-ducktape"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a42ff074ce241a22a544baa8a94722345e4397be", "author": {"user": {"login": "anton-vinogradov", "name": "Anton Vinogradov"}}, "url": "https://github.com/apache/ignite/commit/a42ff074ce241a22a544baa8a94722345e4397be", "committedDate": "2020-07-03T14:49:47Z", "message": "WIP"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDQzNDcwNDU5", "url": "https://github.com/apache/ignite/pull/7967#pullrequestreview-443470459", "createdAt": "2020-07-06T23:36:26Z", "commit": {"oid": "a42ff074ce241a22a544baa8a94722345e4397be"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wNlQyMzozNjoyNlrOGtqU6Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wNlQyMzozNjoyNlrOGtqU6Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MDUzMjU4NQ==", "bodyText": "That's just create two additional full-archive copy layers which increase image size [1] and may slow down file deletion operations due to layered nature of docker image [2].\n$ docker images\nREPOSITORY                TAG                 IMAGE ID            CREATED             SIZE\nducker-ignite-openjdk-8   latest              eb0bc05f45f0        10 minutes ago      4.31GB\n\nducker@ducker01:/$ sudo du -hs / 2>/dev/null\n3.6G\t/\n\n\nIf you absolutely need writable ignite dir, you could either glue RUN commands together, or you may set up a bunch of symlinks:\n/opt/apache-ignite-2.8.0/bin ... original archive\n/opt/ignite-2.8.0/ - real directory\n/opt/ignite-2.8.0/bin -> symlink to /opt/apache-ignite-2.8.0/bin\n...\n\n\n[1] - https://www.datawire.io/not-engineer-running-3-5gb-docker-images/\n[2] - https://docs.docker.com/storage/storagedriver/", "url": "https://github.com/apache/ignite/pull/7967#discussion_r450532585", "createdAt": "2020-07-06T23:36:26Z", "author": {"login": "mshonichev"}, "path": "modules/ducktests/tests/docker/Dockerfile", "diffHunk": "@@ -42,28 +42,23 @@ COPY ./ssh-config /root/.ssh/config\n RUN ssh-keygen -m PEM -q -t rsa -N '' -f /root/.ssh/id_rsa && cp -f /root/.ssh/id_rsa.pub /root/.ssh/authorized_keys\n RUN echo 'PermitUserEnvironment yes' >> /etc/ssh/sshd_config\n \n-RUN chmod a+wr /opt\n-\n ARG APACHE_MIRROR=\"https://apache-mirror.rbc.ru/pub/apache/\"\n ARG APACHE_ARCHIVE=\"https://archive.apache.org/dist/\"\n \n # Install binary test dependencies.\n-ARG IGNITE_VERSION=\"2.8.0\"\n-ARG IGNITE_NAME=\"ignite-$IGNITE_VERSION\"\n-ARG IGNITE_RELEASE_NAME=\"apache-ignite-$IGNITE_VERSION-bin\"\n+RUN cd /opt && curl -O $APACHE_ARCHIVE/ignite/2.7.6/apache-ignite-2.7.6-bin.zip && unzip apache-ignite-2.7.6-bin.zip && mv /opt/apache-ignite-2.7.6-bin /opt/ignite-2.7.6\n+RUN cd /opt && curl -O $APACHE_ARCHIVE/ignite/2.8.0/apache-ignite-2.8.0-bin.zip && unzip apache-ignite-2.8.0-bin.zip && mv /opt/apache-ignite-2.8.0-bin /opt/ignite-2.8.0\n+RUN cd /opt && curl -O $APACHE_ARCHIVE/ignite/2.8.1/apache-ignite-2.8.1-bin.zip && unzip apache-ignite-2.8.1-bin.zip && mv /opt/apache-ignite-2.8.1-bin /opt/ignite-2.8.1\n \n-ADD $APACHE_ARCHIVE/ignite/$IGNITE_VERSION/$IGNITE_RELEASE_NAME.zip /opt/\n-RUN cd /opt && unzip $IGNITE_RELEASE_NAME.zip && rm $IGNITE_RELEASE_NAME.zip\n-RUN mv /opt/$IGNITE_RELEASE_NAME /opt/$IGNITE_NAME\n-RUN chmod a+wr /opt/$IGNITE_NAME -R\n+RUN rm /opt/apache-ignite-*-bin.zip\n+RUN chmod a+wr /opt -R", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "a42ff074ce241a22a544baa8a94722345e4397be"}, "originalPosition": 31}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c283a5144f5f1f9830a2aa43dc97af5fd86602ac", "author": {"user": {"login": "anton-vinogradov", "name": "Anton Vinogradov"}}, "url": "https://github.com/apache/ignite/commit/c283a5144f5f1f9830a2aa43dc97af5fd86602ac", "committedDate": "2020-07-08T13:51:09Z", "message": "WIP"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2437, "cost": 1, "resetAt": "2021-10-29T19:57:52Z"}}}