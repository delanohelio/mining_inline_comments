{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDIzMjYzMjY5", "number": 7852, "title": "IGNITE-13051 still validate MVCC if cache will not start", "bodyText": "Validate and enable MVCC if cache will not start", "createdAt": "2020-05-26T15:03:40Z", "url": "https://github.com/apache/ignite/pull/7852", "merged": true, "mergeCommit": {"oid": "f809525f31ed595b9304b9832bdd92fe1b9de984"}, "closed": true, "closedAt": "2020-06-03T08:56:18Z", "author": {"login": "timoninmaxim"}, "timelineItems": {"totalCount": 10, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABclarZogH2gAyNDIzMjYzMjY5OmU1MDMyNWExMGQ1MDFlNDNhNWZhYjAzMTM2NTMxOTExMmM2YjAzZmE=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcnPvDdAFqTQyMjQxMDc0Nw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "e50325a10d501e43a5fab031365319112c6b03fa", "author": {"user": {"login": "timoninmaxim", "name": "Maksim Timonin"}}, "url": "https://github.com/apache/ignite/commit/e50325a10d501e43a5fab031365319112c6b03fa", "committedDate": "2020-05-27T15:06:13Z", "message": "IGNITE-13051 fix: coprocessor validation for recieved caches"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "d0d803579bfc25bf2f7efc84f126a8f9230b808b", "author": {"user": null}, "url": "https://github.com/apache/ignite/commit/d0d803579bfc25bf2f7efc84f126a8f9230b808b", "committedDate": "2020-05-26T15:01:09Z", "message": "IGNITE-13051 feat: still validate MVCC if cache will not start"}, "afterCommit": {"oid": "e50325a10d501e43a5fab031365319112c6b03fa", "author": {"user": {"login": "timoninmaxim", "name": "Maksim Timonin"}}, "url": "https://github.com/apache/ignite/commit/e50325a10d501e43a5fab031365319112c6b03fa", "committedDate": "2020-05-27T15:06:13Z", "message": "IGNITE-13051 fix: coprocessor validation for recieved caches"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "7e2f59324bd5686457f0b98e855886188b448961", "author": {"user": {"login": "timoninmaxim", "name": "Maksim Timonin"}}, "url": "https://github.com/apache/ignite/commit/7e2f59324bd5686457f0b98e855886188b448961", "committedDate": "2020-05-27T16:43:34Z", "message": "IGNITE-13051 fix: checkstyle fix"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDIxNjM0OTUy", "url": "https://github.com/apache/ignite/pull/7852#pullrequestreview-421634952", "createdAt": "2020-06-01T07:07:48Z", "commit": {"oid": "7e2f59324bd5686457f0b98e855886188b448961"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wMVQwNzowNzo0OFrOGdAzVg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wMVQwNzoxNToxNlrOGdA8_A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMzA3NTAzMA==", "bodyText": "newline required before \"for\"\nsee https://cwiki.apache.org/confluence/display/IGNITE/Coding+Guidelines#CodingGuidelines-SemanticUnits for details", "url": "https://github.com/apache/ignite/pull/7852#discussion_r433075030", "createdAt": "2020-06-01T07:07:48Z", "author": {"login": "anton-vinogradov"}, "path": "modules/core/src/main/java/org/apache/ignite/internal/processors/cache/CacheAffinitySharedManager.java", "diffHunk": "@@ -1350,6 +1350,9 @@ else if (!crd && grp != null && grp.localStartVersion().equals(fut.initialVersio\n         Collection<DynamicCacheDescriptor> descs\n     ) throws IgniteCheckedException {\n         IgniteInternalFuture<?> res = cachesRegistry.addUnregistered(descs);\n+        for (DynamicCacheDescriptor d: descs) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "7e2f59324bd5686457f0b98e855886188b448961"}, "originalPosition": 4}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMzA3NzE4MA==", "bodyText": "Do we really need to specify near, backups, and atomicity mode here?", "url": "https://github.com/apache/ignite/pull/7852#discussion_r433077180", "createdAt": "2020-06-01T07:14:22Z", "author": {"login": "anton-vinogradov"}, "path": "modules/core/src/test/java/org/apache/ignite/internal/processors/cache/mvcc/CacheMvccConfigurationValidationTest.java", "diffHunk": "@@ -322,6 +325,33 @@ public void testTransactionalSnapshotLimitations() throws Exception {\n         );\n     }\n \n+    /**\n+     * Check that node in client mode (filtered by AttributeNodeFilter) correctly works with MVCC.\n+     */\n+    @SuppressWarnings(\"unchecked\")\n+    @Test\n+    public void testMvccEnabledForClientMode() throws Exception {\n+        String attrName = \"has_cache\";\n+        Object attrVal = Boolean.TRUE;\n+\n+        final IgniteEx crd = (IgniteEx) startGrid(getTestIgniteInstanceName(0), getConfiguration());\n+\n+        // Do not start cache on non-affinity node.\n+        CacheConfiguration ccfg = defaultCacheConfiguration()", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "7e2f59324bd5686457f0b98e855886188b448961"}, "originalPosition": 30}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMzA3NzUwMA==", "bodyText": "The better case is to check every node.", "url": "https://github.com/apache/ignite/pull/7852#discussion_r433077500", "createdAt": "2020-06-01T07:15:16Z", "author": {"login": "anton-vinogradov"}, "path": "modules/core/src/test/java/org/apache/ignite/internal/processors/cache/mvcc/CacheMvccConfigurationValidationTest.java", "diffHunk": "@@ -322,6 +325,33 @@ public void testTransactionalSnapshotLimitations() throws Exception {\n         );\n     }\n \n+    /**\n+     * Check that node in client mode (filtered by AttributeNodeFilter) correctly works with MVCC.\n+     */\n+    @SuppressWarnings(\"unchecked\")\n+    @Test\n+    public void testMvccEnabledForClientMode() throws Exception {\n+        String attrName = \"has_cache\";\n+        Object attrVal = Boolean.TRUE;\n+\n+        final IgniteEx crd = (IgniteEx) startGrid(getTestIgniteInstanceName(0), getConfiguration());\n+\n+        // Do not start cache on non-affinity node.\n+        CacheConfiguration ccfg = defaultCacheConfiguration()\n+                .setNearConfiguration(null)\n+                .setNodeFilter(new AttributeNodeFilter(attrName, attrVal))\n+                .setBackups(0)\n+                .setAtomicityMode(TRANSACTIONAL_SNAPSHOT);\n+\n+        final Ignite node = startGrid(getTestIgniteInstanceName(1), getConfiguration()\n+                .setCacheConfiguration(ccfg)\n+                .setUserAttributes(F.asMap(attrName, attrVal)));\n+\n+        checkTopology(2);\n+\n+        assertTrue(crd.context().coordinators().mvccEnabled());", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "7e2f59324bd5686457f0b98e855886188b448961"}, "originalPosition": 42}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "60af9821f7c295a7c3aaf66eae1560b872a74604", "author": {"user": {"login": "timoninmaxim", "name": "Maksim Timonin"}}, "url": "https://github.com/apache/ignite/commit/60af9821f7c295a7c3aaf66eae1560b872a74604", "committedDate": "2020-06-01T07:41:41Z", "message": "fixup! IGNITE-13051 fix: checkstyle fix"}, "afterCommit": {"oid": "7e2f59324bd5686457f0b98e855886188b448961", "author": {"user": {"login": "timoninmaxim", "name": "Maksim Timonin"}}, "url": "https://github.com/apache/ignite/commit/7e2f59324bd5686457f0b98e855886188b448961", "committedDate": "2020-05-27T16:43:34Z", "message": "IGNITE-13051 fix: checkstyle fix"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "dd1719bef133b7ce236d9191da9790596fa5bde8", "author": {"user": {"login": "timoninmaxim", "name": "Maksim Timonin"}}, "url": "https://github.com/apache/ignite/commit/dd1719bef133b7ce236d9191da9790596fa5bde8", "committedDate": "2020-06-01T07:44:13Z", "message": "fixup! IGNITE-13051 fix: checkstyle fix"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDIxNzMwMTgy", "url": "https://github.com/apache/ignite/pull/7852#pullrequestreview-421730182", "createdAt": "2020-06-01T10:05:21Z", "commit": {"oid": "dd1719bef133b7ce236d9191da9790596fa5bde8"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDIxNzQzMTYy", "url": "https://github.com/apache/ignite/pull/7852#pullrequestreview-421743162", "createdAt": "2020-06-01T10:29:55Z", "commit": {"oid": "dd1719bef133b7ce236d9191da9790596fa5bde8"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wMVQxMDoyOTo1NVrOGdF33A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wMVQxMDoyOTo1NVrOGdF33A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMzE1ODEwOA==", "bodyText": "oneliner for should not use braces", "url": "https://github.com/apache/ignite/pull/7852#discussion_r433158108", "createdAt": "2020-06-01T10:29:55Z", "author": {"login": "anton-vinogradov"}, "path": "modules/core/src/main/java/org/apache/ignite/internal/processors/cache/CacheAffinitySharedManager.java", "diffHunk": "@@ -1351,6 +1351,10 @@ else if (!crd && grp != null && grp.localStartVersion().equals(fut.initialVersio\n     ) throws IgniteCheckedException {\n         IgniteInternalFuture<?> res = cachesRegistry.addUnregistered(descs);\n \n+        for (DynamicCacheDescriptor d: descs) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "dd1719bef133b7ce236d9191da9790596fa5bde8"}, "originalPosition": 4}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ae468c56f341af2cb60a83c8953c89111775d296", "author": {"user": {"login": "timoninmaxim", "name": "Maksim Timonin"}}, "url": "https://github.com/apache/ignite/commit/ae468c56f341af2cb60a83c8953c89111775d296", "committedDate": "2020-06-01T11:40:02Z", "message": "fixup! IGNITE-13051 fix: checkstyle fix"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDIyNDEwNzQ3", "url": "https://github.com/apache/ignite/pull/7852#pullrequestreview-422410747", "createdAt": "2020-06-02T07:29:06Z", "commit": {"oid": "ae468c56f341af2cb60a83c8953c89111775d296"}, "state": "COMMENTED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2536, "cost": 1, "resetAt": "2021-10-29T19:57:52Z"}}}