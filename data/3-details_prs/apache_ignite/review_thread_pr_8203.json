{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDc2ODkyNzYw", "number": 8203, "reviewThreads": {"totalCount": 7, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0wMVQwODoxNzo1NlrOEeyvrg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0wMVQwOTowNTozOFrOEez5IA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzAwNzI0MTQyOnYy", "diffSide": "RIGHT", "path": ".gitignore", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0wMVQwODoxNzo1NlrOHKrT9g==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0wMVQwODoxNzo1NlrOHKrT9g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MDk1NzQzMA==", "bodyText": "Add new line", "url": "https://github.com/apache/ignite/pull/8203#discussion_r480957430", "createdAt": "2020-09-01T08:17:56Z", "author": {"login": "ivandasch"}, "path": ".gitignore", "diffHunk": "@@ -80,3 +80,9 @@ packages\n \n #NodeJs files\n /modules/platforms/nodejs/node_modules\n+\n+#Python temp files\n+**/.eggs\n+**/venv\n+**/.pytest_cache\n+**/pyignite.egg-info", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "715a82b599bf9bf23926adfed2b797319808f5f6"}, "originalPosition": 9}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzAwNzI0NDY4OnYy", "diffSide": "RIGHT", "path": "modules/platforms/python/tests/test_sql.py", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0wMVQwODoxODo1N1rOHKrWFQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0wMVQwODoxODo1N1rOHKrWFQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MDk1Nzk3Mw==", "bodyText": "Unnecessary variable definition.\nBoth of them are used only in one place.", "url": "https://github.com/apache/ignite/pull/8203#discussion_r480957973", "createdAt": "2020-09-01T08:18:57Z", "author": {"login": "ivandasch"}, "path": "modules/platforms/python/tests/test_sql.py", "diffHunk": "@@ -152,3 +152,71 @@ def test_sql_fields(client):\n     # repeat cleanup\n     result = sql_fields(client, 'PUBLIC', drop_query, page_size)\n     assert result.status == 0\n+\n+\n+def test_long_multipage_query(client):\n+    \"\"\"\n+    The test creates a table with 13 columns (id and 12 enumerated columns)\n+    and 20 records with id in range from 1 to 20. Values of enumerated columns\n+    are = column number * id.\n+\n+    The goal is to ensure that all the values are selected in a right order.\n+    \"\"\"\n+\n+    field_range = range(1, 13)", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "715a82b599bf9bf23926adfed2b797319808f5f6"}, "originalPosition": 15}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzAwNzI2MTk2OnYy", "diffSide": "RIGHT", "path": "modules/platforms/python/tests/test_sql.py", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0wMVQwODoyMzoyMFrOHKrgUg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0wMVQwODoyMzoyMFrOHKrgUg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MDk2MDU5NA==", "bodyText": "Both of these queries can be easily created without so long definition:\ni.e.\nfields = [\"id\",\"abc\"...]\n\"CREATE TABLE LongMultiPageQuery (%s, %s)\" % (fields[0] +  \" INT(11) PRIMARY KEY\", \",\".join(map(lambda f: f + \" INT(11)\", fields[1:])\n\n\"INSERT INTO LongMultipageQuery (%s) VALUES (%s)\" % (\",\".join(fields), \",\".join(\"?\" * len(fields)))", "url": "https://github.com/apache/ignite/pull/8203#discussion_r480960594", "createdAt": "2020-09-01T08:23:20Z", "author": {"login": "ivandasch"}, "path": "modules/platforms/python/tests/test_sql.py", "diffHunk": "@@ -152,3 +152,71 @@ def test_sql_fields(client):\n     # repeat cleanup\n     result = sql_fields(client, 'PUBLIC', drop_query, page_size)\n     assert result.status == 0\n+\n+\n+def test_long_multipage_query(client):\n+    \"\"\"\n+    The test creates a table with 13 columns (id and 12 enumerated columns)\n+    and 20 records with id in range from 1 to 20. Values of enumerated columns\n+    are = column number * id.\n+\n+    The goal is to ensure that all the values are selected in a right order.\n+    \"\"\"\n+\n+    field_range = range(1, 13)\n+\n+    record_range = range(1, 21)\n+\n+    drop_query = 'DROP TABLE LongMultipageQuery IF EXISTS'\n+\n+    create_query = '''CREATE TABLE LongMultipageQuery (", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "715a82b599bf9bf23926adfed2b797319808f5f6"}, "originalPosition": 21}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzAwNzI5NzkyOnYy", "diffSide": "RIGHT", "path": "modules/platforms/python/pyignite/api/sql.py", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0wMVQwODozMjowNlrOHKr2Gw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0wMVQwODozMjowNlrOHKr2Gw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MDk2NjE3MQ==", "bodyText": "Why not just row = list(row_dict.values())?", "url": "https://github.com/apache/ignite/pull/8203#discussion_r480966171", "createdAt": "2020-09-01T08:32:06Z", "author": {"login": "ivandasch"}, "path": "modules/platforms/python/pyignite/api/sql.py", "diffHunk": "@@ -442,7 +442,7 @@ def sql_fields_cursor_get_page(\n     }\n     for row_dict in value['data']:\n         row = []\n-        for field_key in sorted(row_dict.keys()):\n+        for field_key in row_dict.keys():", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "715a82b599bf9bf23926adfed2b797319808f5f6"}, "originalPosition": 5}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzAwNzQyMTg3OnYy", "diffSide": "RIGHT", "path": "modules/platforms/python/tests/test_sql.py", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0wMVQwOTowMzo0NlrOHKtA4Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0wMVQwOTowMzo0NlrOHKtA4Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MDk4NTMxMw==", "bodyText": "Let's use range(1, len(fields))", "url": "https://github.com/apache/ignite/pull/8203#discussion_r480985313", "createdAt": "2020-09-01T09:03:46Z", "author": {"login": "ivandasch"}, "path": "modules/platforms/python/tests/test_sql.py", "diffHunk": "@@ -163,56 +163,19 @@ def test_long_multipage_query(client):\n     The goal is to ensure that all the values are selected in a right order.\n     \"\"\"\n \n-    field_range = range(1, 13)\n-\n-    record_range = range(1, 21)\n-\n-    drop_query = 'DROP TABLE LongMultipageQuery IF EXISTS'\n-\n-    create_query = '''CREATE TABLE LongMultipageQuery (\n-        id INT(11) PRIMARY KEY,\n-        abc INT(11),\n-        ghi INT(11),\n-        def INT(11),\n-        jkl INT(11),\n-        prs INT(11),\n-        mno INT(11),\n-        tuw INT(11),\n-        zyz INT(11),\n-        abc1 INT(11),\n-        def1 INT(11),\n-        jkl1 INT(11),\n-        prs1 INT(11),\n-    )'''\n-\n-    insert_query = '''INSERT INTO LongMultipageQuery (\n-        id,\n-        abc,\n-        ghi,\n-        def,\n-        jkl,\n-        prs,\n-        mno,\n-        tuw,\n-        zyz,\n-        abc1,\n-        def1,\n-        jkl1,\n-        prs1,\n-    ) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)'''\n-\n-    select_query = 'SELECT * FROM LongMultipageQuery'\n+    fields = [\"id\", \"abc\", \"ghi\", \"def\", \"jkl\", \"prs\", \"mno\", \"tuw\", \"zyz\", \"abc1\", \"def1\", \"jkl1\", \"prs1\"]\n \n-    client.sql(drop_query)\n-    client.sql(create_query)\n+    client.sql('DROP TABLE LongMultipageQuery IF EXISTS')\n+\n+    client.sql(\"CREATE TABLE LongMultiPageQuery (%s, %s)\" % \\\n+               (fields[0] + \" INT(11) PRIMARY KEY\", \",\".join(map(lambda f: f + \" INT(11)\", fields[1:]))))\n \n-    for id in record_range:\n+    for id in range(1, 21):\n         client.sql(\n-            insert_query,\n-            query_args=[id] + list(i * id for i in field_range),\n-        )\n+            \"INSERT INTO LongMultipageQuery (%s) VALUES (%s)\" % (\",\".join(fields), \",\".join(\"?\" * len(fields))),\n+            query_args=[id] + list(i * id for i in range(1, 13)))", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "3ffc0dedf014c116cc0cc67eb2eb906a932f3ee2"}, "originalPosition": 59}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzAwNzQyMzE0OnYy", "diffSide": "RIGHT", "path": "modules/platforms/python/tests/test_sql.py", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0wMVQwOTowNDowNVrOHKtBog==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0wMVQwOTowNDowNVrOHKtBog==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MDk4NTUwNg==", "bodyText": "assert len(page) == len(fields)", "url": "https://github.com/apache/ignite/pull/8203#discussion_r480985506", "createdAt": "2020-09-01T09:04:05Z", "author": {"login": "ivandasch"}, "path": "modules/platforms/python/tests/test_sql.py", "diffHunk": "@@ -163,56 +163,19 @@ def test_long_multipage_query(client):\n     The goal is to ensure that all the values are selected in a right order.\n     \"\"\"\n \n-    field_range = range(1, 13)\n-\n-    record_range = range(1, 21)\n-\n-    drop_query = 'DROP TABLE LongMultipageQuery IF EXISTS'\n-\n-    create_query = '''CREATE TABLE LongMultipageQuery (\n-        id INT(11) PRIMARY KEY,\n-        abc INT(11),\n-        ghi INT(11),\n-        def INT(11),\n-        jkl INT(11),\n-        prs INT(11),\n-        mno INT(11),\n-        tuw INT(11),\n-        zyz INT(11),\n-        abc1 INT(11),\n-        def1 INT(11),\n-        jkl1 INT(11),\n-        prs1 INT(11),\n-    )'''\n-\n-    insert_query = '''INSERT INTO LongMultipageQuery (\n-        id,\n-        abc,\n-        ghi,\n-        def,\n-        jkl,\n-        prs,\n-        mno,\n-        tuw,\n-        zyz,\n-        abc1,\n-        def1,\n-        jkl1,\n-        prs1,\n-    ) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)'''\n-\n-    select_query = 'SELECT * FROM LongMultipageQuery'\n+    fields = [\"id\", \"abc\", \"ghi\", \"def\", \"jkl\", \"prs\", \"mno\", \"tuw\", \"zyz\", \"abc1\", \"def1\", \"jkl1\", \"prs1\"]\n \n-    client.sql(drop_query)\n-    client.sql(create_query)\n+    client.sql('DROP TABLE LongMultipageQuery IF EXISTS')\n+\n+    client.sql(\"CREATE TABLE LongMultiPageQuery (%s, %s)\" % \\\n+               (fields[0] + \" INT(11) PRIMARY KEY\", \",\".join(map(lambda f: f + \" INT(11)\", fields[1:]))))\n \n-    for id in record_range:\n+    for id in range(1, 21):\n         client.sql(\n-            insert_query,\n-            query_args=[id] + list(i * id for i in field_range),\n-        )\n+            \"INSERT INTO LongMultipageQuery (%s) VALUES (%s)\" % (\",\".join(fields), \",\".join(\"?\" * len(fields))),\n+            query_args=[id] + list(i * id for i in range(1, 13)))\n \n-    result = client.sql(select_query, page_size=1)\n+    result = client.sql('SELECT * FROM LongMultipageQuery', page_size=1)\n     for page in result:\n         assert len(page) == 13", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "3ffc0dedf014c116cc0cc67eb2eb906a932f3ee2"}, "originalPosition": 64}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzAwNzQyOTQ0OnYy", "diffSide": "RIGHT", "path": "modules/platforms/python/tests/test_sql.py", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0wMVQwOTowNTozOFrOHKtFUw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0wMVQwOTowNTozOFrOHKtFUw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MDk4NjQ1MQ==", "bodyText": "Even better:\n\"CREATE TABLE LongMultiPageQuery (%s)\" %  \",\".join(map(lambda f: f + \" INT(11)\" if f != \"id\" else \"id INT(11) PRIMARY KEY\", fields))))", "url": "https://github.com/apache/ignite/pull/8203#discussion_r480986451", "createdAt": "2020-09-01T09:05:38Z", "author": {"login": "ivandasch"}, "path": "modules/platforms/python/tests/test_sql.py", "diffHunk": "@@ -163,56 +163,19 @@ def test_long_multipage_query(client):\n     The goal is to ensure that all the values are selected in a right order.\n     \"\"\"\n \n-    field_range = range(1, 13)\n-\n-    record_range = range(1, 21)\n-\n-    drop_query = 'DROP TABLE LongMultipageQuery IF EXISTS'\n-\n-    create_query = '''CREATE TABLE LongMultipageQuery (\n-        id INT(11) PRIMARY KEY,\n-        abc INT(11),\n-        ghi INT(11),\n-        def INT(11),\n-        jkl INT(11),\n-        prs INT(11),\n-        mno INT(11),\n-        tuw INT(11),\n-        zyz INT(11),\n-        abc1 INT(11),\n-        def1 INT(11),\n-        jkl1 INT(11),\n-        prs1 INT(11),\n-    )'''\n-\n-    insert_query = '''INSERT INTO LongMultipageQuery (\n-        id,\n-        abc,\n-        ghi,\n-        def,\n-        jkl,\n-        prs,\n-        mno,\n-        tuw,\n-        zyz,\n-        abc1,\n-        def1,\n-        jkl1,\n-        prs1,\n-    ) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)'''\n-\n-    select_query = 'SELECT * FROM LongMultipageQuery'\n+    fields = [\"id\", \"abc\", \"ghi\", \"def\", \"jkl\", \"prs\", \"mno\", \"tuw\", \"zyz\", \"abc1\", \"def1\", \"jkl1\", \"prs1\"]\n \n-    client.sql(drop_query)\n-    client.sql(create_query)\n+    client.sql('DROP TABLE LongMultipageQuery IF EXISTS')\n+\n+    client.sql(\"CREATE TABLE LongMultiPageQuery (%s, %s)\" % \\\n+               (fields[0] + \" INT(11) PRIMARY KEY\", \",\".join(map(lambda f: f + \" INT(11)\", fields[1:]))))", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "3ffc0dedf014c116cc0cc67eb2eb906a932f3ee2"}, "originalPosition": 50}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2735, "cost": 1, "resetAt": "2021-11-12T09:44:50Z"}}}