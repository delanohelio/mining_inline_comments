{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTI0Njg0ODU3", "number": 8484, "title": "IGNITE-13705 : Another node fails with failure of target node.", "bodyText": "Scenario:\nThe nodes have relative places in the ring: N and N+1. Node N detects failure of node N+1. Node N tries to connect to node N+2. Node N+2 checks backward connection to node N+1.\nProblem:\nNode N can fail too.\nCause:\nThe timeout on node N to recover connection to node N+2 appears shorter than timeout on node N+2 to check connection to N+1.\nFix:\nIntroduced a fundamental timeout value to check/recover connection based on current configuration. The mentioned timeouts have been turned relative. The timeout of backward connection check is now generally shorter than the timeout to recover connection.\nAdditions:\n\nBrought some logs to have diagnostoc ability. It was hard to realize the issue without them.\nSome renamings and minor optimizations to avoid mess in ping / connection checks.", "createdAt": "2020-11-20T12:49:26Z", "url": "https://github.com/apache/ignite/pull/8484", "merged": true, "mergeCommit": {"oid": "edb736dcd8d1d57c875ce7de2b2b2b786d1f8d51"}, "closed": true, "closedAt": "2020-12-02T09:13:45Z", "author": {"login": "Vladsz83"}, "timelineItems": {"totalCount": 14, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABddaGCfAH2gAyNTI0Njg0ODU3OmQxMWI0MGZiMDljYWIxNjU0NGY1NGE0YzM5NzdkM2Q3YWVlYWI5N2E=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdiL9OAgFqTU0MjY5NDYwNA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "d11b40fb09cab16544f54a4c3977d3d7aeeab97a", "author": {"user": {"login": "Vladsz83", "name": "Vladimir Steshin"}}, "url": "https://github.com/apache/ignite/commit/d11b40fb09cab16544f54a4c3977d3d7aeeab97a", "committedDate": "2020-11-17T14:05:10Z", "message": "1st attempt"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "51037cfd099a9778f7912da189a97657d165a221", "author": {"user": {"login": "Vladsz83", "name": "Vladimir Steshin"}}, "url": "https://github.com/apache/ignite/commit/51037cfd099a9778f7912da189a97657d165a221", "committedDate": "2020-11-17T16:29:43Z", "message": "1st attempt"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "fc4b54c621f22c930ccd60202eac0e6c09b05f84", "author": {"user": {"login": "Vladsz83", "name": "Vladimir Steshin"}}, "url": "https://github.com/apache/ignite/commit/fc4b54c621f22c930ccd60202eac0e6c09b05f84", "committedDate": "2020-11-17T18:46:30Z", "message": "1st attempt"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e8cbb118b6589fe645bad0bc9f1a1619c2c169f0", "author": {"user": {"login": "Vladsz83", "name": "Vladimir Steshin"}}, "url": "https://github.com/apache/ignite/commit/e8cbb118b6589fe645bad0bc9f1a1619c2c169f0", "committedDate": "2020-11-18T16:30:54Z", "message": "Fix."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "167d54de27b05af86e1bfadfce8b382d4364af69", "author": {"user": {"login": "Vladsz83", "name": "Vladimir Steshin"}}, "url": "https://github.com/apache/ignite/commit/167d54de27b05af86e1bfadfce8b382d4364af69", "committedDate": "2020-11-18T16:37:34Z", "message": "Fix"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ab3017c9355435fd7e2ab6a7c86c4899343753f0", "author": {"user": {"login": "Vladsz83", "name": "Vladimir Steshin"}}, "url": "https://github.com/apache/ignite/commit/ab3017c9355435fd7e2ab6a7c86c4899343753f0", "committedDate": "2020-11-19T11:36:33Z", "message": "Fix"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b606a0e4026e9918ba610f1cf40abe3dd32f0779", "author": {"user": {"login": "Vladsz83", "name": "Vladimir Steshin"}}, "url": "https://github.com/apache/ignite/commit/b606a0e4026e9918ba610f1cf40abe3dd32f0779", "committedDate": "2020-11-20T11:05:18Z", "message": "Minor spell fix"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "dd021db64bd6797a28184670781188dd89d1c997", "author": {"user": {"login": "Vladsz83", "name": "Vladimir Steshin"}}, "url": "https://github.com/apache/ignite/commit/dd021db64bd6797a28184670781188dd89d1c997", "committedDate": "2020-11-20T12:54:08Z", "message": "Renamings. Optimization."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "0dfd37db3bef7f62d026b5e543dc56a7637dca12", "author": {"user": {"login": "Vladsz83", "name": "Vladimir Steshin"}}, "url": "https://github.com/apache/ignite/commit/0dfd37db3bef7f62d026b5e543dc56a7637dca12", "committedDate": "2020-11-26T16:28:01Z", "message": "Renamings"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "7e0f84bc61c1d904070ac4762e84c29b23694a5e", "author": {"user": {"login": "Vladsz83", "name": "Vladimir Steshin"}}, "url": "https://github.com/apache/ignite/commit/7e0f84bc61c1d904070ac4762e84c29b23694a5e", "committedDate": "2020-11-27T10:32:28Z", "message": "long fix, minors"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "03ebaec8f6c1cba0227b89d1eab4db6cf522a2eb", "author": {"user": {"login": "Vladsz83", "name": "Vladimir Steshin"}}, "url": "https://github.com/apache/ignite/commit/03ebaec8f6c1cba0227b89d1eab4db6cf522a2eb", "committedDate": "2020-11-27T10:56:31Z", "message": "minority"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "325c1edfc1b939a77aa0a92916b4765f495b1226", "author": {"user": {"login": "Vladsz83", "name": "Vladimir Steshin"}}, "url": "https://github.com/apache/ignite/commit/325c1edfc1b939a77aa0a92916b4765f495b1226", "committedDate": "2020-11-30T16:49:50Z", "message": "Merge branch 'master' into IGNITE-13705v4"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "1deb451fea9d2c3c755e207c58b144fda8c4ea7c", "author": {"user": {"login": "Vladsz83", "name": "Vladimir Steshin"}}, "url": "https://github.com/apache/ignite/commit/1deb451fea9d2c3c755e207c58b144fda8c4ea7c", "committedDate": "2020-12-01T12:33:45Z", "message": "Merge branch 'master' into IGNITE-13705v4"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTQyNjk0NjA0", "url": "https://github.com/apache/ignite/pull/8484#pullrequestreview-542694604", "createdAt": "2020-12-02T10:26:29Z", "commit": {"oid": "1deb451fea9d2c3c755e207c58b144fda8c4ea7c"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0wMlQxMDoyNjoyOVrOH9URAg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0wMlQxMDoyNjoyOVrOH9URAg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNDA1NzIxOA==", "bodyText": "sequentially", "url": "https://github.com/apache/ignite/pull/8484#discussion_r534057218", "createdAt": "2020-12-02T10:26:29Z", "author": {"login": "ivandasch"}, "path": "modules/core/src/test/java/org/apache/ignite/spi/discovery/tcp/TcpDiscoveryNetworkIssuesTest.java", "diffHunk": "@@ -236,20 +253,28 @@ public void testFailTwoNodes() throws Exception {\n             }, EVT_NODE_SEGMENTED);\n         }\n \n-        processNetworkThreads(ignite(2), t -> t.suspend());\n-        processNetworkThreads(ignite(3), t -> t.suspend());\n+        Set<Integer> failedNodes = new HashSet<>();\n+\n+        failedNodes.add(2);\n+\n+        if (sequentionally)", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "1deb451fea9d2c3c755e207c58b144fda8c4ea7c"}, "originalPosition": 55}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2985, "cost": 1, "resetAt": "2021-10-29T19:57:52Z"}}}