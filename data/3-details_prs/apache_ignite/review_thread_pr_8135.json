{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDY1NDY3MjE0", "number": 8135, "reviewThreads": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xN1QxODozNDowN1rOEZLDIA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xN1QxODo0NTozN1rOEZLi8Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjk0ODMwODgwOnYy", "diffSide": "RIGHT", "path": "modules/core/src/main/java/org/apache/ignite/internal/managers/systemview/GridSystemViewManager.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xN1QxODozNDowN1rOHB1yJg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xOFQwNzoxMToyNVrOHCGRSw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MTY5MTgxNA==", "bodyText": "Could you please replace supplier by simple method call? There is no need to use lambda syntax here.", "url": "https://github.com/apache/ignite/pull/8135#discussion_r471691814", "createdAt": "2020-08-17T18:34:07Z", "author": {"login": "agura"}, "path": "modules/core/src/main/java/org/apache/ignite/internal/managers/systemview/GridSystemViewManager.java", "diffHunk": "@@ -75,7 +82,26 @@\n      * @param ctx Kernal context.\n      */\n     public GridSystemViewManager(GridKernalContext ctx) {\n-        super(ctx, ctx.config().getSystemViewExporterSpi());\n+        super(ctx, ((Supplier<SystemViewExporterSpi[]>)() -> {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d97ea1017bb049a2ce06a73ffcc2d885bb84b09e"}, "originalPosition": 31}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MTk2MTkzMQ==", "bodyText": "replaced.", "url": "https://github.com/apache/ignite/pull/8135#discussion_r471961931", "createdAt": "2020-08-18T07:11:25Z", "author": {"login": "nizhikov"}, "path": "modules/core/src/main/java/org/apache/ignite/internal/managers/systemview/GridSystemViewManager.java", "diffHunk": "@@ -75,7 +82,26 @@\n      * @param ctx Kernal context.\n      */\n     public GridSystemViewManager(GridKernalContext ctx) {\n-        super(ctx, ctx.config().getSystemViewExporterSpi());\n+        super(ctx, ((Supplier<SystemViewExporterSpi[]>)() -> {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MTY5MTgxNA=="}, "originalCommit": {"oid": "d97ea1017bb049a2ce06a73ffcc2d885bb84b09e"}, "originalPosition": 31}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjk0ODMxODA4OnYy", "diffSide": "RIGHT", "path": "modules/core/src/main/java/org/apache/ignite/internal/managers/systemview/GridSystemViewManager.java", "isResolved": false, "comments": {"totalCount": 5, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xN1QxODozNToxOVrOHB14pA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xN1QxMjoyNTo1NFrOHTfj6w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MTY5MzQ3Ng==", "bodyText": "Nevertheless, what if spi array already contains SqlViewExporterSpi?", "url": "https://github.com/apache/ignite/pull/8135#discussion_r471693476", "createdAt": "2020-08-17T18:35:19Z", "author": {"login": "agura"}, "path": "modules/core/src/main/java/org/apache/ignite/internal/managers/systemview/GridSystemViewManager.java", "diffHunk": "@@ -75,7 +82,26 @@\n      * @param ctx Kernal context.\n      */\n     public GridSystemViewManager(GridKernalContext ctx) {\n-        super(ctx, ctx.config().getSystemViewExporterSpi());\n+        super(ctx, ((Supplier<SystemViewExporterSpi[]>)() -> {\n+            SystemViewExporterSpi[] spi = ctx.config().getSystemViewExporterSpi();\n+\n+            if (!IgniteComponentType.INDEXING.inClassPath())\n+                return spi;\n+\n+            SystemViewExporterSpi[] spiWithSql = new SystemViewExporterSpi[spi != null ? spi.length + 1 : 1];", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d97ea1017bb049a2ce06a73ffcc2d885bb84b09e"}, "originalPosition": 37}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MTk1NjkzMQ==", "bodyText": "SqlViewExporterSpi now is package-private so it's forbidden for the user to create instances.", "url": "https://github.com/apache/ignite/pull/8135#discussion_r471956931", "createdAt": "2020-08-18T07:01:05Z", "author": {"login": "nizhikov"}, "path": "modules/core/src/main/java/org/apache/ignite/internal/managers/systemview/GridSystemViewManager.java", "diffHunk": "@@ -75,7 +82,26 @@\n      * @param ctx Kernal context.\n      */\n     public GridSystemViewManager(GridKernalContext ctx) {\n-        super(ctx, ctx.config().getSystemViewExporterSpi());\n+        super(ctx, ((Supplier<SystemViewExporterSpi[]>)() -> {\n+            SystemViewExporterSpi[] spi = ctx.config().getSystemViewExporterSpi();\n+\n+            if (!IgniteComponentType.INDEXING.inClassPath())\n+                return spi;\n+\n+            SystemViewExporterSpi[] spiWithSql = new SystemViewExporterSpi[spi != null ? spi.length + 1 : 1];", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MTY5MzQ3Ng=="}, "originalCommit": {"oid": "d97ea1017bb049a2ce06a73ffcc2d885bb84b09e"}, "originalPosition": 37}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4OTA3OTkxMg==", "bodyText": "Any way it is just somewhat sloppy.", "url": "https://github.com/apache/ignite/pull/8135#discussion_r489079912", "createdAt": "2020-09-15T23:48:35Z", "author": {"login": "agura"}, "path": "modules/core/src/main/java/org/apache/ignite/internal/managers/systemview/GridSystemViewManager.java", "diffHunk": "@@ -75,7 +82,26 @@\n      * @param ctx Kernal context.\n      */\n     public GridSystemViewManager(GridKernalContext ctx) {\n-        super(ctx, ctx.config().getSystemViewExporterSpi());\n+        super(ctx, ((Supplier<SystemViewExporterSpi[]>)() -> {\n+            SystemViewExporterSpi[] spi = ctx.config().getSystemViewExporterSpi();\n+\n+            if (!IgniteComponentType.INDEXING.inClassPath())\n+                return spi;\n+\n+            SystemViewExporterSpi[] spiWithSql = new SystemViewExporterSpi[spi != null ? spi.length + 1 : 1];", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MTY5MzQ3Ng=="}, "originalCommit": {"oid": "d97ea1017bb049a2ce06a73ffcc2d885bb84b09e"}, "originalPosition": 37}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MDEzMzkzNw==", "bodyText": "OK, I've added a check to ensure SqlViewExporterSpi not presented in the initial array.", "url": "https://github.com/apache/ignite/pull/8135#discussion_r490133937", "createdAt": "2020-09-17T10:19:51Z", "author": {"login": "nizhikov"}, "path": "modules/core/src/main/java/org/apache/ignite/internal/managers/systemview/GridSystemViewManager.java", "diffHunk": "@@ -75,7 +82,26 @@\n      * @param ctx Kernal context.\n      */\n     public GridSystemViewManager(GridKernalContext ctx) {\n-        super(ctx, ctx.config().getSystemViewExporterSpi());\n+        super(ctx, ((Supplier<SystemViewExporterSpi[]>)() -> {\n+            SystemViewExporterSpi[] spi = ctx.config().getSystemViewExporterSpi();\n+\n+            if (!IgniteComponentType.INDEXING.inClassPath())\n+                return spi;\n+\n+            SystemViewExporterSpi[] spiWithSql = new SystemViewExporterSpi[spi != null ? spi.length + 1 : 1];", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MTY5MzQ3Ng=="}, "originalCommit": {"oid": "d97ea1017bb049a2ce06a73ffcc2d885bb84b09e"}, "originalPosition": 37}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MDIwMjA5MQ==", "bodyText": "It's definitely redundant due to a package privacy. I told about naming only. Please revert this check and merge.", "url": "https://github.com/apache/ignite/pull/8135#discussion_r490202091", "createdAt": "2020-09-17T12:25:54Z", "author": {"login": "agura"}, "path": "modules/core/src/main/java/org/apache/ignite/internal/managers/systemview/GridSystemViewManager.java", "diffHunk": "@@ -75,7 +82,26 @@\n      * @param ctx Kernal context.\n      */\n     public GridSystemViewManager(GridKernalContext ctx) {\n-        super(ctx, ctx.config().getSystemViewExporterSpi());\n+        super(ctx, ((Supplier<SystemViewExporterSpi[]>)() -> {\n+            SystemViewExporterSpi[] spi = ctx.config().getSystemViewExporterSpi();\n+\n+            if (!IgniteComponentType.INDEXING.inClassPath())\n+                return spi;\n+\n+            SystemViewExporterSpi[] spiWithSql = new SystemViewExporterSpi[spi != null ? spi.length + 1 : 1];", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MTY5MzQ3Ng=="}, "originalCommit": {"oid": "d97ea1017bb049a2ce06a73ffcc2d885bb84b09e"}, "originalPosition": 37}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjk0ODM0MzU0OnYy", "diffSide": "RIGHT", "path": "modules/core/src/main/java/org/apache/ignite/internal/managers/systemview/GridSystemViewManager.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xN1QxODozODo0NVrOHB2LVw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xOFQwNzoxMjoyM1rOHCGTLw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MTY5ODI2Mw==", "bodyText": "Visibility scope for this constant is too broad.", "url": "https://github.com/apache/ignite/pull/8135#discussion_r471698263", "createdAt": "2020-08-17T18:38:45Z", "author": {"login": "agura"}, "path": "modules/core/src/main/java/org/apache/ignite/internal/managers/systemview/GridSystemViewManager.java", "diffHunk": "@@ -53,6 +57,9 @@\n  */\n public class GridSystemViewManager extends GridManagerAdapter<SystemViewExporterSpi>\n     implements ReadOnlySystemViewRegistry {\n+    /** Class name for a SQL view exporter of system views. */\n+    public static final String SYSTEM_VIEW_SQL_SPI = \"org.apache.ignite.internal.managers.systemview.SqlViewExporterSpi\";", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d97ea1017bb049a2ce06a73ffcc2d885bb84b09e"}, "originalPosition": 21}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MTk2MjQxNQ==", "bodyText": "fixed.", "url": "https://github.com/apache/ignite/pull/8135#discussion_r471962415", "createdAt": "2020-08-18T07:12:23Z", "author": {"login": "nizhikov"}, "path": "modules/core/src/main/java/org/apache/ignite/internal/managers/systemview/GridSystemViewManager.java", "diffHunk": "@@ -53,6 +57,9 @@\n  */\n public class GridSystemViewManager extends GridManagerAdapter<SystemViewExporterSpi>\n     implements ReadOnlySystemViewRegistry {\n+    /** Class name for a SQL view exporter of system views. */\n+    public static final String SYSTEM_VIEW_SQL_SPI = \"org.apache.ignite.internal.managers.systemview.SqlViewExporterSpi\";", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MTY5ODI2Mw=="}, "originalCommit": {"oid": "d97ea1017bb049a2ce06a73ffcc2d885bb84b09e"}, "originalPosition": 21}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjk0ODM5MDI1OnYy", "diffSide": "RIGHT", "path": "modules/indexing/src/main/java/org/apache/ignite/internal/managers/systemview/SqlViewExporterSpi.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xN1QxODo0NTozN1rOHB2rRw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xOFQwNzozMDowM1rOHCG49Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MTcwNjQzOQ==", "bodyText": "IMHO, it isn't the best solution to have internal implementation of any SPI. May be we can extract some common parts of Exporter SPI into a new internal super-class which should be inherited by SystemViewExporterSpi and our internal analog of SqlViewEXporterSpi?", "url": "https://github.com/apache/ignite/pull/8135#discussion_r471706439", "createdAt": "2020-08-17T18:45:37Z", "author": {"login": "agura"}, "path": "modules/indexing/src/main/java/org/apache/ignite/internal/managers/systemview/SqlViewExporterSpi.java", "diffHunk": "@@ -36,12 +37,9 @@\n  * This SPI implementation exports metrics as SQL views.\n  *\n  * Note, instance of this class created with reflection.\n- * @see IgnitionEx#SYSTEM_VIEW_SQL_SPI\n+ * @see GridSystemViewManager#SYSTEM_VIEW_SQL_SPI\n  */\n-public class SqlViewExporterSpi extends IgniteSpiAdapter implements SystemViewExporterSpi {\n-    /** System view filter. */\n-    @Nullable private Predicate<SystemView<?>> filter;\n-\n+class SqlViewExporterSpi extends IgniteSpiAdapter implements SystemViewExporterSpi {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d97ea1017bb049a2ce06a73ffcc2d885bb84b09e"}, "originalPosition": 32}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MTk3MjA4NQ==", "bodyText": "AbstractSystemViewExporterSpi introduced. Please, take a look one more time.", "url": "https://github.com/apache/ignite/pull/8135#discussion_r471972085", "createdAt": "2020-08-18T07:30:03Z", "author": {"login": "nizhikov"}, "path": "modules/indexing/src/main/java/org/apache/ignite/internal/managers/systemview/SqlViewExporterSpi.java", "diffHunk": "@@ -36,12 +37,9 @@\n  * This SPI implementation exports metrics as SQL views.\n  *\n  * Note, instance of this class created with reflection.\n- * @see IgnitionEx#SYSTEM_VIEW_SQL_SPI\n+ * @see GridSystemViewManager#SYSTEM_VIEW_SQL_SPI\n  */\n-public class SqlViewExporterSpi extends IgniteSpiAdapter implements SystemViewExporterSpi {\n-    /** System view filter. */\n-    @Nullable private Predicate<SystemView<?>> filter;\n-\n+class SqlViewExporterSpi extends IgniteSpiAdapter implements SystemViewExporterSpi {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MTcwNjQzOQ=="}, "originalCommit": {"oid": "d97ea1017bb049a2ce06a73ffcc2d885bb84b09e"}, "originalPosition": 32}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2804, "cost": 1, "resetAt": "2021-11-12T09:44:50Z"}}}