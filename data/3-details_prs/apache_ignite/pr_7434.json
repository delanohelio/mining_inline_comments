{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0Mzc1NzU0NDcy", "number": 7434, "title": "IGNITE-7276 .NET: Enable/disable cache statistics in runtime", "bodyText": "IGNITE-7276  .NET: Enable/disable cache statistics in runtime\nICache.EnableStatistics(bool enabled);\nIClusterGroup.EnableStatistics(IEnumerable cacheNames, bool enabled)", "createdAt": "2020-02-15T20:25:43Z", "url": "https://github.com/apache/ignite/pull/7434", "merged": true, "mergeCommit": {"oid": "7c7bd17daec5d1efe0439cae0c7ac39b4e5d58ec"}, "closed": true, "closedAt": "2020-02-25T11:40:07Z", "author": {"login": "gurustron"}, "timelineItems": {"totalCount": 13, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABb-NVl3gH2gAyMzc1NzU0NDcyOmY5OWZiYTZkN2JhNjBjNjI5OGYzMjMyOTI2ZDNhZGUyYzY4NTY1NDg=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcHwkHzgFqTM2NDA3NDQ5Ng==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "f99fba6d7ba60c6298f3232926d3ade2c6856548", "author": {"user": {"login": "gurustron", "name": null}}, "url": "https://github.com/apache/ignite/commit/f99fba6d7ba60c6298f3232926d3ade2c6856548", "committedDate": "2020-01-26T19:30:35Z", "message": "IGNITE-7276 - ICache.EnableStatistics started"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "9d822d53141319f111622fc990c761e6b7f11d88", "author": {"user": {"login": "gurustron", "name": null}}, "url": "https://github.com/apache/ignite/commit/9d822d53141319f111622fc990c761e6b7f11d88", "committedDate": "2020-02-06T22:23:54Z", "message": "Merge branch 'master' into IGNITE-7276-enable-cluster-stats\n\n# Conflicts:\n#\tmodules/platforms/dotnet/Apache.Ignite.Core/Impl/Cache/CacheOp.cs"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ba93a4f92e4f551b59aa44504023edb76abbff21", "author": {"user": {"login": "gurustron", "name": null}}, "url": "https://github.com/apache/ignite/commit/ba93a4f92e4f551b59aa44504023edb76abbff21", "committedDate": "2020-02-08T14:06:27Z", "message": "IGNITE-7276 - cache enable stats."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "08bee16128509fdb30cc4420e1c7890a689129d2", "author": {"user": {"login": "gurustron", "name": null}}, "url": "https://github.com/apache/ignite/commit/08bee16128509fdb30cc4420e1c7890a689129d2", "committedDate": "2020-02-15T20:06:43Z", "message": "IGNITE-7276 - cache enable stats."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b7536bf2acd575cb55b679d70ef0848f93151746", "author": {"user": {"login": "gurustron", "name": null}}, "url": "https://github.com/apache/ignite/commit/b7536bf2acd575cb55b679d70ef0848f93151746", "committedDate": "2020-02-16T00:28:59Z", "message": "IGNITE-7276 - cache enable stats."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzU5OTA4OTcy", "url": "https://github.com/apache/ignite/pull/7434#pullrequestreview-359908972", "createdAt": "2020-02-17T18:20:49Z", "commit": {"oid": "b7536bf2acd575cb55b679d70ef0848f93151746"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 6, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xN1QxODoyMDo0OVrOFqs5fA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xN1QxODozMDoyN1rOFqtEuQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MDMyMDEyNA==", "bodyText": "val == FALSE ? false : true -> val == TRUE ?", "url": "https://github.com/apache/ignite/pull/7434#discussion_r380320124", "createdAt": "2020-02-17T18:20:49Z", "author": {"login": "ptupitsyn"}, "path": "modules/core/src/main/java/org/apache/ignite/internal/processors/platform/cache/PlatformCache.java", "diffHunk": "@@ -1174,6 +1177,11 @@ private void loadCache0(BinaryRawReaderEx reader, boolean loc) {\n             case OP_PRELOAD_PARTITION:\n                 cache.preloadPartition((int)val);\n \n+                return TRUE;\n+\n+            case OP_ENABLE_STATISTICS:\n+                cache.enableStatistics(val == FALSE ? false : true);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b7536bf2acd575cb55b679d70ef0848f93151746"}, "originalPosition": 17}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MDMyMTM0NA==", "bodyText": "Please use public API when possible: platformCtx.kernalContext().grid().cluster().enableStatistics(cacheNames, enabled)\nThere is a difference in exception handling and GridKernalGateway.readLock call.", "url": "https://github.com/apache/ignite/pull/7434#discussion_r380321344", "createdAt": "2020-02-17T18:24:39Z", "author": {"login": "ptupitsyn"}, "path": "modules/core/src/main/java/org/apache/ignite/internal/processors/platform/cluster/PlatformClusterGroup.java", "diffHunk": "@@ -356,6 +359,22 @@ public PlatformClusterGroup(PlatformContext platformCtx, ClusterGroupEx prj) {\n                 return TRUE;\n             }\n \n+            case OP_ENABLE_STATISTICS: {\n+                boolean enabled = reader.readBoolean();\n+\n+                int cnt = reader.readInt();\n+\n+                Collection<String> cacheNames = new ArrayList<>(cnt);\n+\n+                for (int i = 0; i < cnt; i++) {\n+                    cacheNames.add(reader.readString());\n+                }\n+\n+                platformCtx.kernalContext().cache().enableStatistics(cacheNames, enabled);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b7536bf2acd575cb55b679d70ef0848f93151746"}, "originalPosition": 25}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MDMyMTgxNQ==", "bodyText": "Redundant blank line", "url": "https://github.com/apache/ignite/pull/7434#discussion_r380321815", "createdAt": "2020-02-17T18:26:09Z", "author": {"login": "ptupitsyn"}, "path": "modules/platforms/dotnet/Apache.Ignite.Core.Tests/Cache/CacheMetricsTest.cs", "diffHunk": "@@ -99,6 +99,28 @@ public void TestGlobalMetrics()\n             Assert.AreEqual(1, remoteMetrics.CachePuts);\n         }\n \n+        /// <summary>\n+        /// Tests the cache metrics enable/disable \n+        /// </summary>\n+        [Test]\n+        public void TestCacheEnableStatistics()\n+        {\n+            TestEnableStatistics(\"cacheEnableStatistics\", (cache, b) => cache.EnableStatistics(b));\n+        }\n+", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b7536bf2acd575cb55b679d70ef0848f93151746"}, "originalPosition": 12}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MDMyMjI0MQ==", "bodyText": "enabled ? True : False", "url": "https://github.com/apache/ignite/pull/7434#discussion_r380322241", "createdAt": "2020-02-17T18:27:43Z", "author": {"login": "ptupitsyn"}, "path": "modules/platforms/dotnet/Apache.Ignite.Core/Impl/Cache/CacheImpl.cs", "diffHunk": "@@ -1173,6 +1173,12 @@ public ICacheMetrics GetLocalMetrics()\n             });\n         }\n \n+        /** <inheritDoc /> */\n+        public void EnableStatistics(bool enabled)\n+        {\n+            DoOutInOp((int) CacheOp.EnableStatistics, enabled ? 1 : 0);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b7536bf2acd575cb55b679d70ef0848f93151746"}, "originalPosition": 7}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MDMyMjUxMQ==", "bodyText": "Please add /** <inheritdoc /> */", "url": "https://github.com/apache/ignite/pull/7434#discussion_r380322511", "createdAt": "2020-02-17T18:28:41Z", "author": {"login": "ptupitsyn"}, "path": "modules/platforms/dotnet/Apache.Ignite.Core/Impl/Ignite.cs", "diffHunk": "@@ -639,6 +639,11 @@ public IServices GetServices()\n             return _prj.ForServers().GetServices();\n         }\n \n+        public void EnableStatistics(IEnumerable<string> cacheNames, bool enabled)", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b7536bf2acd575cb55b679d70ef0848f93151746"}, "originalPosition": 4}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MDMyMzAwMQ==", "bodyText": "Please add the following tests additionally:\n\nPass empty cacheNames\nPass non-existent cache names", "url": "https://github.com/apache/ignite/pull/7434#discussion_r380323001", "createdAt": "2020-02-17T18:30:27Z", "author": {"login": "ptupitsyn"}, "path": "modules/platforms/dotnet/Apache.Ignite.Core.Tests/Cache/CacheMetricsTest.cs", "diffHunk": "@@ -99,6 +99,28 @@ public void TestGlobalMetrics()\n             Assert.AreEqual(1, remoteMetrics.CachePuts);\n         }\n \n+        /// <summary>\n+        /// Tests the cache metrics enable/disable \n+        /// </summary>\n+        [Test]\n+        public void TestCacheEnableStatistics()\n+        {\n+            TestEnableStatistics(\"cacheEnableStatistics\", (cache, b) => cache.EnableStatistics(b));\n+        }\n+\n+        \n+        /// <summary>\n+        /// Tests the cache metrics enable/disable \n+        /// </summary>\n+        [Test]\n+        public void TestClusterGroupEnableStatistics()\n+        {\n+            var cacheName = \"clusterEnableStatistics\";\n+            TestEnableStatistics(\n+                cacheName,\n+                (cache, b) => cache.Ignite.GetCluster().EnableStatistics(new[] {cacheName}, b));", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b7536bf2acd575cb55b679d70ef0848f93151746"}, "originalPosition": 23}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "91931feb785e3deac64f282120c89d42e5cc92f0", "author": {"user": {"login": "gurustron", "name": null}}, "url": "https://github.com/apache/ignite/commit/91931feb785e3deac64f282120c89d42e5cc92f0", "committedDate": "2020-02-17T18:37:59Z", "message": "IGNITE-7276 - switch to public API"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ca457183c45a09d26030a165ea1ad30a7a220d46", "author": {"user": {"login": "gurustron", "name": null}}, "url": "https://github.com/apache/ignite/commit/ca457183c45a09d26030a165ea1ad30a7a220d46", "committedDate": "2020-02-17T18:46:32Z", "message": "IGNITE-7276 - clean up"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "1d5bbf6f648b76e3f7b81e92f5edf8b05e3080cf", "author": {"user": {"login": "gurustron", "name": null}}, "url": "https://github.com/apache/ignite/commit/1d5bbf6f648b76e3f7b81e92f5edf8b05e3080cf", "committedDate": "2020-02-17T19:11:42Z", "message": "IGNITE-7276 - fixes after review."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b9e40ea47966c6162cc351eda3058a20e851a197", "author": {"user": {"login": "gurustron", "name": null}}, "url": "https://github.com/apache/ignite/commit/b9e40ea47966c6162cc351eda3058a20e851a197", "committedDate": "2020-02-19T07:18:06Z", "message": "IGNITE-7276 - extra tests"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzYzMDM2OTI2", "url": "https://github.com/apache/ignite/pull/7434#pullrequestreview-363036926", "createdAt": "2020-02-22T16:16:43Z", "commit": {"oid": "b9e40ea47966c6162cc351eda3058a20e851a197"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yMlQxNjoxNjo0M1rOFtLzaQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yMlQxNjoxNzozMlrOFtLzlg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MjkyMzYyNQ==", "bodyText": "Can you please extract the code below into two separate tests? Something like:\n\nTestClusterEnableStatisticsAllowsEmptyCacheNames\nTestClusterEnableStatisticsThrowsOnInvalidCacheName", "url": "https://github.com/apache/ignite/pull/7434#discussion_r382923625", "createdAt": "2020-02-22T16:16:43Z", "author": {"login": "ptupitsyn"}, "path": "modules/platforms/dotnet/Apache.Ignite.Core.Tests/Cache/CacheMetricsTest.cs", "diffHunk": "@@ -118,6 +120,16 @@ public void TestClusterGroupEnableStatistics()\n             TestEnableStatistics(\n                 cacheName,\n                 (cache, b) => cache.Ignite.GetCluster().EnableStatistics(new[] {cacheName}, b));\n+\n+            var ignite = Ignition.GetIgnite();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b9e40ea47966c6162cc351eda3058a20e851a197"}, "originalPosition": 26}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MjkyMzY3MA==", "bodyText": "Let's add an assertion for the exception message. Does it make sense, is it clear enough for the user to fix the issue?", "url": "https://github.com/apache/ignite/pull/7434#discussion_r382923670", "createdAt": "2020-02-22T16:17:32Z", "author": {"login": "ptupitsyn"}, "path": "modules/platforms/dotnet/Apache.Ignite.Core.Tests/Cache/CacheMetricsTest.cs", "diffHunk": "@@ -118,6 +120,16 @@ public void TestClusterGroupEnableStatistics()\n             TestEnableStatistics(\n                 cacheName,\n                 (cache, b) => cache.Ignite.GetCluster().EnableStatistics(new[] {cacheName}, b));\n+\n+            var ignite = Ignition.GetIgnite();\n+            ignite.CreateCache<int, int>(new CacheConfiguration(\"clusterEnableStatsValidName\"));\n+            var cluster = ignite.GetCluster();\n+\n+            Assert.DoesNotThrow(() => cluster.EnableStatistics(Enumerable.Empty<string>(), true));\n+\n+            // Nonexistent cache name\n+            Assert.Throws<IgniteException>(", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b9e40ea47966c6162cc351eda3058a20e851a197"}, "originalPosition": 33}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "953eca5a6f38eb43650e9d66f5c6185c76d5624c", "author": {"user": {"login": "gurustron", "name": null}}, "url": "https://github.com/apache/ignite/commit/953eca5a6f38eb43650e9d66f5c6185c76d5624c", "committedDate": "2020-02-22T20:30:57Z", "message": "IGNITE-7276 - refactor tests"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzY0MDc0NDk2", "url": "https://github.com/apache/ignite/pull/7434#pullrequestreview-364074496", "createdAt": "2020-02-25T11:38:27Z", "commit": {"oid": "953eca5a6f38eb43650e9d66f5c6185c76d5624c"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2821, "cost": 1, "resetAt": "2021-10-29T19:57:52Z"}}}