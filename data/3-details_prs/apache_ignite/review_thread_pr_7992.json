{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDQ0NDU5NTc0", "number": 7992, "reviewThreads": {"totalCount": 35, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wN1QxNTo1ODoyOFrOEMJEmg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yNlQxNTo0MDoxMlrOEcomhQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjgxMTY3MDAyOnYy", "diffSide": "RIGHT", "path": "modules/platforms/dotnet/Apache.Ignite.Core.Tests/Apache.Ignite.Core.Tests.csproj", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wN1QxNTo1ODoyOFrOGuFOIw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wN1QxNTo1ODoyOFrOGuFOIw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MDk3MzIxOQ==", "bodyText": "Please add those tests to .DotNetCore project as well.", "url": "https://github.com/apache/ignite/pull/7992#discussion_r450973219", "createdAt": "2020-07-07T15:58:28Z", "author": {"login": "ptupitsyn"}, "path": "modules/platforms/dotnet/Apache.Ignite.Core.Tests/Apache.Ignite.Core.Tests.csproj", "diffHunk": "@@ -143,6 +143,9 @@\n     <Compile Include=\"Cache\\Query\\Linq\\CacheLinqTest.Contains.cs\" />\n     <Compile Include=\"Cache\\Store\\CacheStoreSessionTestCodeConfig.cs\" />\n     <Compile Include=\"Cache\\Store\\CacheStoreSessionTestSharedFactory.cs\" />\n+    <Compile Include=\"Client\\Cache\\CacheClientAbstractTxTest.cs\" />", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c3d172515837d67838de7d9bb83ca949eae599ac"}, "originalPosition": 4}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjgxMTY3MjQ5OnYy", "diffSide": "RIGHT", "path": "modules/platforms/dotnet/Apache.Ignite.Core.Tests/Client/Cache/CacheClientLocalTxTest.cs", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wN1QxNTo1OTowNVrOGuFP1Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wN1QxNTo1OTowNVrOGuFP1Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MDk3MzY1Mw==", "bodyText": "Missing inheritdoc", "url": "https://github.com/apache/ignite/pull/7992#discussion_r450973653", "createdAt": "2020-07-07T15:59:05Z", "author": {"login": "ptupitsyn"}, "path": "modules/platforms/dotnet/Apache.Ignite.Core.Tests/Client/Cache/CacheClientLocalTxTest.cs", "diffHunk": "@@ -0,0 +1,38 @@\n+/*\n+ * Licensed to the Apache Software Foundation (ASF) under one or more\n+ * contributor license agreements.  See the NOTICE file distributed with\n+ * this work for additional information regarding copyright ownership.\n+ * The ASF licenses this file to You under the Apache License, Version 2.0\n+ * (the \"License\"); you may not use this file except in compliance with\n+ * the License.  You may obtain a copy of the License at\n+ *\n+ *      http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+namespace Apache.Ignite.Core.Tests.Client.Cache\n+{\n+    /// <summary>\n+    /// Tests client transactions for single node.\n+    /// </summary>\n+    public class CacheClientLocalTxTest : CacheClientAbstractTxTest\n+    {\n+        /// <summary>\n+        ///  Initializes a new instance of the <see cref=\"CacheClientLocalTxTest\"/> class.\n+        /// </summary>\n+        public CacheClientLocalTxTest() : base(1, false)\n+        {\n+            // No-op.\n+        }\n+\n+        protected override string GetCacheName()", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c3d172515837d67838de7d9bb83ca949eae599ac"}, "originalPosition": 33}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjgxMTY4MDQ4OnYy", "diffSide": "RIGHT", "path": "modules/platforms/dotnet/Apache.Ignite.Core/Client/Transactions/IClientTransactions.cs", "isResolved": true, "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wN1QxNjowMDo1OFrOGuFU7Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wOFQyMjoyMDozMVrOGu7KWw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MDk3NDk1Nw==", "bodyText": "Let's rename to ITransactionsClient to be consistent with ICacheClient, IComputeClient.", "url": "https://github.com/apache/ignite/pull/7992#discussion_r450974957", "createdAt": "2020-07-07T16:00:58Z", "author": {"login": "ptupitsyn"}, "path": "modules/platforms/dotnet/Apache.Ignite.Core/Client/Transactions/IClientTransactions.cs", "diffHunk": "@@ -0,0 +1,58 @@\n+/*\n+ * Licensed to the Apache Software Foundation (ASF) under one or more\n+ * contributor license agreements.  See the NOTICE file distributed with\n+ * this work for additional information regarding copyright ownership.\n+ * The ASF licenses this file to You under the Apache License, Version 2.0\n+ * (the \"License\"); you may not use this file except in compliance with\n+ * the License.  You may obtain a copy of the License at\n+ *\n+ *      http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+namespace Apache.Ignite.Core.Client.Transactions\n+{\n+    using System;\n+    using Apache.Ignite.Core.Transactions;\n+\n+    /// <summary>\n+    /// Ignite Thin Client transactions facade.\n+    /// </summary>\n+    public interface IClientTransactions", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c3d172515837d67838de7d9bb83ca949eae599ac"}, "originalPosition": 26}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MTE1MTQyNA==", "bodyText": "I think it can be better compared to IClientCluster , IClientClusterNode and so on. To me ITransactionsClient sounds a little bit misleading and clumsy.", "url": "https://github.com/apache/ignite/pull/7992#discussion_r451151424", "createdAt": "2020-07-07T21:22:59Z", "author": {"login": "gurustron"}, "path": "modules/platforms/dotnet/Apache.Ignite.Core/Client/Transactions/IClientTransactions.cs", "diffHunk": "@@ -0,0 +1,58 @@\n+/*\n+ * Licensed to the Apache Software Foundation (ASF) under one or more\n+ * contributor license agreements.  See the NOTICE file distributed with\n+ * this work for additional information regarding copyright ownership.\n+ * The ASF licenses this file to You under the Apache License, Version 2.0\n+ * (the \"License\"); you may not use this file except in compliance with\n+ * the License.  You may obtain a copy of the License at\n+ *\n+ *      http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+namespace Apache.Ignite.Core.Client.Transactions\n+{\n+    using System;\n+    using Apache.Ignite.Core.Transactions;\n+\n+    /// <summary>\n+    /// Ignite Thin Client transactions facade.\n+    /// </summary>\n+    public interface IClientTransactions", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MDk3NDk1Nw=="}, "originalCommit": {"oid": "c3d172515837d67838de7d9bb83ca949eae599ac"}, "originalPosition": 26}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MTg1Njk4Nw==", "bodyText": "Actually, IClientCluster was missed during the review, so we have an inconsistency now, but I'd like to avoid further inconsistencies.", "url": "https://github.com/apache/ignite/pull/7992#discussion_r451856987", "createdAt": "2020-07-08T22:20:31Z", "author": {"login": "ptupitsyn"}, "path": "modules/platforms/dotnet/Apache.Ignite.Core/Client/Transactions/IClientTransactions.cs", "diffHunk": "@@ -0,0 +1,58 @@\n+/*\n+ * Licensed to the Apache Software Foundation (ASF) under one or more\n+ * contributor license agreements.  See the NOTICE file distributed with\n+ * this work for additional information regarding copyright ownership.\n+ * The ASF licenses this file to You under the Apache License, Version 2.0\n+ * (the \"License\"); you may not use this file except in compliance with\n+ * the License.  You may obtain a copy of the License at\n+ *\n+ *      http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+namespace Apache.Ignite.Core.Client.Transactions\n+{\n+    using System;\n+    using Apache.Ignite.Core.Transactions;\n+\n+    /// <summary>\n+    /// Ignite Thin Client transactions facade.\n+    /// </summary>\n+    public interface IClientTransactions", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MDk3NDk1Nw=="}, "originalCommit": {"oid": "c3d172515837d67838de7d9bb83ca949eae599ac"}, "originalPosition": 26}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjgxMTY4MjQ3OnYy", "diffSide": "RIGHT", "path": "modules/platforms/dotnet/Apache.Ignite.Core/Client/Transactions/IClientTransaction.cs", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wN1QxNjowMToyMFrOGuFWCQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wN1QxNjowMToyMFrOGuFWCQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MDk3NTI0MQ==", "bodyText": "Let's rename to ITransactionClient to be consistent with ICacheClient, IComputeClient.", "url": "https://github.com/apache/ignite/pull/7992#discussion_r450975241", "createdAt": "2020-07-07T16:01:20Z", "author": {"login": "ptupitsyn"}, "path": "modules/platforms/dotnet/Apache.Ignite.Core/Client/Transactions/IClientTransaction.cs", "diffHunk": "@@ -0,0 +1,37 @@\n+/*\n+ * Licensed to the Apache Software Foundation (ASF) under one or more\n+ * contributor license agreements.  See the NOTICE file distributed with\n+ * this work for additional information regarding copyright ownership.\n+ * The ASF licenses this file to You under the Apache License, Version 2.0\n+ * (the \"License\"); you may not use this file except in compliance with\n+ * the License.  You may obtain a copy of the License at\n+ *\n+ *      http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+namespace Apache.Ignite.Core.Client.Transactions\n+{\n+    using System;\n+\n+    /// <summary>\n+    /// Thin client transaction.\n+    /// </summary>\n+    public interface IClientTransaction : IDisposable", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c3d172515837d67838de7d9bb83ca949eae599ac"}, "originalPosition": 25}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjgxMTY5NjYyOnYy", "diffSide": "RIGHT", "path": "modules/platforms/dotnet/Apache.Ignite.Core/Client/IIgniteClient.cs", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wN1QxNjowNDo1OFrOGuFfEQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wN1QxNjowNDo1OFrOGuFfEQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MDk3NzU1Mw==", "bodyText": "Please convert to a method for consistency with IIgnite.GetTransactions.\nMethod is also a more future-proof option (see https://docs.microsoft.com/en-us/previous-versions/dotnet/netframework-4.0/ms229054(v=vs.100)).", "url": "https://github.com/apache/ignite/pull/7992#discussion_r450977553", "createdAt": "2020-07-07T16:04:58Z", "author": {"login": "ptupitsyn"}, "path": "modules/platforms/dotnet/Apache.Ignite.Core/Client/IIgniteClient.cs", "diffHunk": "@@ -111,6 +112,11 @@ public interface IIgniteClient : IDisposable\n         [SuppressMessage(\"Microsoft.Design\", \"CA1024:UsePropertiesWhereAppropriate\", Justification = \"Semantics.\")]\n         IBinary GetBinary();\n \n+        /// <summary>\n+        /// Gets Ignite transactions facade.\n+        /// </summary>\n+        IClientTransactions Transactions { get; }", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c3d172515837d67838de7d9bb83ca949eae599ac"}, "originalPosition": 15}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjgxMTcwNjk4OnYy", "diffSide": "RIGHT", "path": "modules/platforms/dotnet/Apache.Ignite.Core/Client/Transactions/IClientTransactions.cs", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wN1QxNjowNzozNFrOGuFljQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wN1QxNjowNzozNFrOGuFljQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MDk3OTIxMw==", "bodyText": "Please add more explanation - why is this useful, how to retrieve this label", "url": "https://github.com/apache/ignite/pull/7992#discussion_r450979213", "createdAt": "2020-07-07T16:07:34Z", "author": {"login": "ptupitsyn"}, "path": "modules/platforms/dotnet/Apache.Ignite.Core/Client/Transactions/IClientTransactions.cs", "diffHunk": "@@ -0,0 +1,58 @@\n+/*\n+ * Licensed to the Apache Software Foundation (ASF) under one or more\n+ * contributor license agreements.  See the NOTICE file distributed with\n+ * this work for additional information regarding copyright ownership.\n+ * The ASF licenses this file to You under the Apache License, Version 2.0\n+ * (the \"License\"); you may not use this file except in compliance with\n+ * the License.  You may obtain a copy of the License at\n+ *\n+ *      http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+namespace Apache.Ignite.Core.Client.Transactions\n+{\n+    using System;\n+    using Apache.Ignite.Core.Transactions;\n+\n+    /// <summary>\n+    /// Ignite Thin Client transactions facade.\n+    /// </summary>\n+    public interface IClientTransactions\n+    {\n+        /// <summary>\n+        /// Starts a new transaction with the default isolation level, concurrency and timeout. \n+        /// </summary>\n+        /// <returns>New transaction.</returns>\n+        IClientTransaction TxStart();\n+\n+        /// <summary>\n+        /// Starts new transaction with the specified concurrency and isolation.\n+        /// </summary>\n+        /// <param name=\"concurrency\">Concurrency.</param>\n+        /// <param name=\"isolation\">Isolation.</param>\n+        /// <returns>New transaction.</returns>\n+        IClientTransaction TxStart(TransactionConcurrency concurrency, TransactionIsolation isolation);\n+\n+        /// <summary>\n+        /// Starts new transaction with the specified concurrency, isolation and timeout.\n+        /// </summary>\n+        /// <param name=\"concurrency\">Concurrency.</param>\n+        /// <param name=\"isolation\">Isolation.</param>\n+        /// <param name=\"timeout\">Timeout. TimeSpan. Zero for indefinite timeout.</param>\n+        /// <returns>New transaction.</returns>\n+        IClientTransaction TxStart(TransactionConcurrency concurrency, TransactionIsolation isolation, TimeSpan timeout);\n+\n+        /// <summary>\n+        /// Returns instance of <see cref=\"IClientTransactions\"/>> to mark a transaction with a special label.", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c3d172515837d67838de7d9bb83ca949eae599ac"}, "originalPosition": 52}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjgxMTcyNjA4OnYy", "diffSide": "RIGHT", "path": "modules/platforms/dotnet/Apache.Ignite.Core/Impl/Client/Cache/CacheClient.cs", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wN1QxNjoxMjowNlrOGuFxhA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wN1QxNjoxMjowNlrOGuFxhA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MDk4MjI3Ng==", "bodyText": "HasFlag is slow on older frameworks, let's avoid it here.", "url": "https://github.com/apache/ignite/pull/7992#discussion_r450982276", "createdAt": "2020-07-07T16:12:06Z", "author": {"login": "ptupitsyn"}, "path": "modules/platforms/dotnet/Apache.Ignite.Core/Impl/Client/Cache/CacheClient.cs", "diffHunk": "@@ -754,14 +797,26 @@ private void WriteRequest(Action<ClientRequestContext> writeAction, ClientReques\n         {\n             ctx.Stream.WriteInt(_id);\n \n+            var flags = ClientCacheRequestFlag.None;\n             if (_expiryPolicy != null)\n             {\n                 ctx.Features.ValidateWithExpiryPolicyFlag();\n-                ctx.Stream.WriteByte((byte) ClientCacheRequestFlag.WithExpiryPolicy);\n-                ExpiryPolicySerializer.WritePolicy(ctx.Writer, _expiryPolicy);\n+                flags = flags | ClientCacheRequestFlag.WithExpiryPolicy;\n             }\n-            else\n-                ctx.Stream.WriteByte((byte) ClientCacheRequestFlag.None); // Flags (skipStore, etc).\n+\n+            var tx = _ignite.Transactions.CurrentTx;\n+            if (tx != null)\n+            {\n+                flags |= ClientCacheRequestFlag.WithTransactional;\n+            }\n+\n+            ctx.Stream.WriteByte((byte) flags);\n+\n+            if (flags.HasFlag(ClientCacheRequestFlag.WithExpiryPolicy))", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c3d172515837d67838de7d9bb83ca949eae599ac"}, "originalPosition": 223}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjgxMTc1MTQyOnYy", "diffSide": "RIGHT", "path": "modules/platforms/dotnet/Apache.Ignite.Core/Impl/Client/ClientFailoverSocket.cs", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wN1QxNjoxODoyNlrOGuGBOQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wN1QxNjoxODoyNlrOGuGBOQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MDk4NjI5Nw==", "bodyText": "To be precise: transactional operation must be executed using the same connection (same ClientSocket instance) that started the transaction.\nAnd the check here does not guarantee this at all - reconnect could have happened, for example.\nA proper approach is to store get the socket from ClientContextBase.Socket property when executing ClientOp.TxStart, and use that socket directly for transactional operations.", "url": "https://github.com/apache/ignite/pull/7992#discussion_r450986297", "createdAt": "2020-07-07T16:18:26Z", "author": {"login": "ptupitsyn"}, "path": "modules/platforms/dotnet/Apache.Ignite.Core/Impl/Client/ClientFailoverSocket.cs", "diffHunk": "@@ -269,6 +278,12 @@ private ClientSocket GetAffinitySocket<TKey>(int cacheId, TKey key)\n                 return null;\n             }\n \n+            // Transactional operation should be executed on node started the transaction.\n+            if (_transactions.CurrentTx != null)", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c3d172515837d67838de7d9bb83ca949eae599ac"}, "originalPosition": 45}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjgxMTc2MjEwOnYy", "diffSide": "RIGHT", "path": "modules/platforms/dotnet/Apache.Ignite.Core/Impl/Client/Transactions/ClientTransaction.cs", "isResolved": true, "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wN1QxNjoyMToxMlrOGuGH6w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xN1QxODozNToyM1rOGzdRig==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MDk4ODAxMQ==", "bodyText": "Do we need volatile? Transactions are tied to a specific thread, right?", "url": "https://github.com/apache/ignite/pull/7992#discussion_r450988011", "createdAt": "2020-07-07T16:21:12Z", "author": {"login": "ptupitsyn"}, "path": "modules/platforms/dotnet/Apache.Ignite.Core/Impl/Client/Transactions/ClientTransaction.cs", "diffHunk": "@@ -0,0 +1,125 @@\n+/*\n+ * Licensed to the Apache Software Foundation (ASF) under one or more\n+ * contributor license agreements.  See the NOTICE file distributed with\n+ * this work for additional information regarding copyright ownership.\n+ * The ASF licenses this file to You under the Apache License, Version 2.0\n+ * (the \"License\"); you may not use this file except in compliance with\n+ * the License.  You may obtain a copy of the License at\n+ *\n+ *      http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+namespace Apache.Ignite.Core.Impl.Client.Transactions\n+{\n+    using System;\n+    using System.Threading;\n+\n+    /// <summary>\n+    /// Ignite Thin Client transaction facade.\n+    /// </summary>\n+    internal class ClientTransaction: IClientTransactionInternal\n+    {\n+        /** Unique  transaction ID.*/\n+        private readonly int _id;\n+\n+        /** Ignite. */\n+        private readonly IgniteClient _ignite;\n+\n+        /* Transactions. */\n+        private readonly ClientTransactions _transactions;\n+\n+        /** Transaction is closed. */\n+        private volatile bool _closed; ", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c3d172515837d67838de7d9bb83ca949eae599ac"}, "originalPosition": 38}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NTc5NjAyOA==", "bodyText": "In theory transaction returned by TxStart can be closed from any thread.", "url": "https://github.com/apache/ignite/pull/7992#discussion_r455796028", "createdAt": "2020-07-16T13:43:50Z", "author": {"login": "gurustron"}, "path": "modules/platforms/dotnet/Apache.Ignite.Core/Impl/Client/Transactions/ClientTransaction.cs", "diffHunk": "@@ -0,0 +1,125 @@\n+/*\n+ * Licensed to the Apache Software Foundation (ASF) under one or more\n+ * contributor license agreements.  See the NOTICE file distributed with\n+ * this work for additional information regarding copyright ownership.\n+ * The ASF licenses this file to You under the Apache License, Version 2.0\n+ * (the \"License\"); you may not use this file except in compliance with\n+ * the License.  You may obtain a copy of the License at\n+ *\n+ *      http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+namespace Apache.Ignite.Core.Impl.Client.Transactions\n+{\n+    using System;\n+    using System.Threading;\n+\n+    /// <summary>\n+    /// Ignite Thin Client transaction facade.\n+    /// </summary>\n+    internal class ClientTransaction: IClientTransactionInternal\n+    {\n+        /** Unique  transaction ID.*/\n+        private readonly int _id;\n+\n+        /** Ignite. */\n+        private readonly IgniteClient _ignite;\n+\n+        /* Transactions. */\n+        private readonly ClientTransactions _transactions;\n+\n+        /** Transaction is closed. */\n+        private volatile bool _closed; ", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MDk4ODAxMQ=="}, "originalCommit": {"oid": "c3d172515837d67838de7d9bb83ca949eae599ac"}, "originalPosition": 38}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NjYxMDE4Ng==", "bodyText": "Usually, types and APIs are not thread safe, unless stated otherwise. E.g. we don't expect List<T> to be thread safe and have volatile fields. We explicitly state that Ignite transactions are per-thread, so we don't need to guarantee thread safety.", "url": "https://github.com/apache/ignite/pull/7992#discussion_r456610186", "createdAt": "2020-07-17T18:35:23Z", "author": {"login": "ptupitsyn"}, "path": "modules/platforms/dotnet/Apache.Ignite.Core/Impl/Client/Transactions/ClientTransaction.cs", "diffHunk": "@@ -0,0 +1,125 @@\n+/*\n+ * Licensed to the Apache Software Foundation (ASF) under one or more\n+ * contributor license agreements.  See the NOTICE file distributed with\n+ * this work for additional information regarding copyright ownership.\n+ * The ASF licenses this file to You under the Apache License, Version 2.0\n+ * (the \"License\"); you may not use this file except in compliance with\n+ * the License.  You may obtain a copy of the License at\n+ *\n+ *      http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+namespace Apache.Ignite.Core.Impl.Client.Transactions\n+{\n+    using System;\n+    using System.Threading;\n+\n+    /// <summary>\n+    /// Ignite Thin Client transaction facade.\n+    /// </summary>\n+    internal class ClientTransaction: IClientTransactionInternal\n+    {\n+        /** Unique  transaction ID.*/\n+        private readonly int _id;\n+\n+        /** Ignite. */\n+        private readonly IgniteClient _ignite;\n+\n+        /* Transactions. */\n+        private readonly ClientTransactions _transactions;\n+\n+        /** Transaction is closed. */\n+        private volatile bool _closed; ", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MDk4ODAxMQ=="}, "originalCommit": {"oid": "c3d172515837d67838de7d9bb83ca949eae599ac"}, "originalPosition": 38}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjg0OTY5NzQ0OnYy", "diffSide": "RIGHT", "path": "modules/platforms/dotnet/Apache.Ignite.Core.Tests/Client/Cache/CacheClientAbstractTxTest.cs", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xOFQxNToyOToxOVrOGzo4mA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xOFQxNToyOToxOVrOGzo4mA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NjgwMDQwOA==", "bodyText": "Blank line", "url": "https://github.com/apache/ignite/pull/7992#discussion_r456800408", "createdAt": "2020-07-18T15:29:19Z", "author": {"login": "ptupitsyn"}, "path": "modules/platforms/dotnet/Apache.Ignite.Core.Tests/Client/Cache/CacheClientAbstractTxTest.cs", "diffHunk": "@@ -0,0 +1,756 @@\n+/*\n+ * Licensed to the Apache Software Foundation (ASF) under one or more\n+ * contributor license agreements.  See the NOTICE file distributed with\n+ * this work for additional information regarding copyright ownership.\n+ * The ASF licenses this file to You under the Apache License, Version 2.0\n+ * (the \"License\"); you may not use this file except in compliance with\n+ * the License.  You may obtain a copy of the License at\n+ *\n+ *      http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+namespace Apache.Ignite.Core.Tests.Client.Cache\n+{\n+    using System;\n+    using System.Collections.Generic;\n+    using System.Linq;\n+    using System.Threading;\n+    using System.Transactions;\n+    using Apache.Ignite.Core.Cache.Configuration;\n+    using Apache.Ignite.Core.Client;\n+    using Apache.Ignite.Core.Client.Cache;\n+    using Apache.Ignite.Core.Client.Transactions;\n+    using Apache.Ignite.Core.Impl.Client.Transactions;\n+    using Apache.Ignite.Core.Transactions;\n+    using NUnit.Framework;\n+    using NUnit.Framework.Constraints;\n+\n+    /// <summary>\n+    /// Transactional cache client tests.\n+    /// </summary>\n+    public abstract class CacheClientAbstractTxTest : ClientTestBase\n+    {\n+        /** All concurrency controls. */\n+        private static readonly TransactionConcurrency[] AllConcurrencyControls =\n+        {\n+            TransactionConcurrency.Optimistic, \n+            TransactionConcurrency.Pessimistic\n+        };\n+\n+        /** All isolation levels*/\n+        private static readonly TransactionIsolation[] AllIsolationLevels = \n+        {\n+            TransactionIsolation.Serializable,\n+            TransactionIsolation.ReadCommitted,\n+            TransactionIsolation.RepeatableRead\n+        };\n+\n+        protected CacheClientAbstractTxTest(int serverCount, bool enablePartitionAwareness) : base(serverCount,\n+            enablePartitionAwareness: enablePartitionAwareness)\n+        {\n+            // No-op.\n+        }\n+\n+        /// <summary>\n+        /// Tests that custom client transactions configuration is applied.\n+        /// </summary>\n+        [Test]\n+        public void TestClientTransactionConfiguration()\n+        {\n+            var timeout = TransactionClientConfiguration.DefaultDefaultTimeout.Add(TimeSpan.FromMilliseconds(1000));\n+            var cfg = GetClientConfiguration();\n+            cfg.TransactionConfiguration = new TransactionClientConfiguration\n+            {\n+                DefaultTimeout = timeout\n+            };\n+\n+            foreach (var concurrency in AllConcurrencyControls)\n+            {\n+                foreach (var isolation in AllIsolationLevels)\n+                {\n+                    cfg.TransactionConfiguration.DefaultTransactionConcurrency = concurrency;\n+                    cfg.TransactionConfiguration.DefaultTransactionIsolation = isolation;\n+                    using (var client = Ignition.StartClient(cfg))\n+                    {\n+                        ITransaction tx;\n+                        using (client.GetTransactions().TxStart())\n+                        {\n+                            tx = GetSingleLocalTransaction();\n+                            Assert.AreEqual(concurrency, tx.Concurrency);\n+                            Assert.AreEqual(isolation, tx.Isolation);\n+                            Assert.AreEqual(timeout, tx.Timeout);\n+                        }\n+                        tx.Dispose();\n+                    }\n+                }\n+            }\n+        }\n+\n+        /// <summary>\n+        /// Tests that parameters passed to TxStart are applied.\n+        /// </summary>\n+        [Test]\n+        public void TestTxStartPassesParameters()\n+        {\n+            var timeout = TransactionClientConfiguration.DefaultDefaultTimeout.Add(TimeSpan.FromMilliseconds(1000));\n+            var acts = new List<Func<ITransactionsClient>>\n+            {\n+                () => Client.GetTransactions(),\n+                () => Client.GetTransactions().WithLabel(\"label\"),\n+            };\n+            foreach (var concurrency in AllConcurrencyControls)\n+            {\n+                foreach (var isolation in AllIsolationLevels)\n+                {\n+                    foreach (var act in acts)\n+                    {\n+                        ITransaction tx;\n+                        using (act().TxStart(concurrency, isolation))\n+                        {\n+                            tx = GetSingleLocalTransaction();\n+                            Assert.AreEqual(concurrency, tx.Concurrency);\n+                            Assert.AreEqual(isolation, tx.Isolation);\n+                        }\n+                        tx.Dispose();\n+                        using (act().TxStart(concurrency, isolation, timeout))\n+                        {\n+                            tx = GetSingleLocalTransaction();\n+                            Assert.AreEqual(concurrency, tx.Concurrency);\n+                            Assert.AreEqual(isolation, tx.Isolation);\n+                            Assert.AreEqual(timeout, tx.Timeout);\n+                        }\n+                        tx.Dispose();\n+                    }\n+                }\n+            }\n+        }\n+\n+        /// <summary>\n+        /// Tests that transaction can't be committed/rollback after being already completed.\n+        /// </summary>\n+        [Test]\n+        public void TestThrowsIfEndAlreadyCompletedTransaction()\n+        {\n+            var tx = Client.GetTransactions().TxStart();\n+            tx.Commit();\n+\n+            var constraint = new ReusableConstraint(Is.TypeOf<InvalidOperationException>()\n+               .And.Message.Contains(\"Transaction\")\n+               .And.Message.Contains(\"is closed\"));\n+\n+            Assert.Throws(constraint, () => tx.Commit());\n+            Assert.Throws(constraint, () => tx.Rollback());\n+\n+            using (tx = Client.GetTransactions().TxStart())\n+            {\n+            }\n+\n+            Assert.Throws(constraint, () => tx.Commit());\n+            Assert.Throws(constraint, () => tx.Rollback());\n+        }\n+\n+\n+        /// <summary>\n+        /// Tests that transaction throws if timeout elapsed.\n+        /// </summary>\n+        [Test]\n+        public void TestTimeout()\n+        {\n+            var timeout = TimeSpan.FromMilliseconds(200);\n+            var cache = GetTransactionalCache();\n+            cache.Put(1, 1);\n+            using (var tx = Client.GetTransactions().TxStart(TransactionConcurrency.Pessimistic,\n+                TransactionIsolation.ReadCommitted,\n+                timeout))\n+            {\n+                Thread.Sleep(TimeSpan.FromMilliseconds(300));\n+                var constraint = new ReusableConstraint(Is.TypeOf<IgniteClientException>()\n+                   .And.Message.Contains(\"Cache transaction timed out\"));\n+                Assert.Throws(constraint, () => cache.Put(1, 10));\n+                Assert.Throws(constraint, () => tx.Commit());\n+            }\n+\n+            Assert.AreEqual(1, cache.Get(1));\n+        }\n+\n+        /// <summary>\n+        /// Tests that commit applies cache changes.\n+        /// </summary>\n+        [Test]\n+        public void TestTxCommit()\n+        {\n+            var cache = GetTransactionalCache();\n+\n+            cache.Put(1, 1);\n+            cache.Put(2, 2);\n+\n+            using (var tx = Client.GetTransactions().TxStart())\n+            {\n+                cache.Put(1, 10);\n+                cache.Put(2, 20);\n+\n+                tx.Commit();\n+            }\n+\n+            Assert.AreEqual(10, cache.Get(1));\n+            Assert.AreEqual(20, cache.Get(2));\n+        }\n+\n+        /// <summary>\n+        /// Tests that rollback reverts cache changes.\n+        /// </summary>\n+        [Test]\n+        public void TestTxRollback()\n+        {\n+            var cache = GetTransactionalCache();\n+            cache.Put(1, 1);\n+            cache.Put(2, 2);\n+\n+            using (var tx = Client.GetTransactions().TxStart())\n+            {\n+                cache.Put(1, 10);\n+                cache.Put(2, 20);\n+\n+                Assert.AreEqual(10, cache.Get(1));\n+                Assert.AreEqual(20, cache.Get(2));\n+                tx.Rollback();\n+            }\n+\n+            Assert.AreEqual(1, cache.Get(1));\n+            Assert.AreEqual(2, cache.Get(2));\n+        }\n+\n+        /// <summary>\n+        /// Tests that closing transaction without commit reverts cache changes.\n+        /// </summary>\n+        [Test]\n+        public void TestTxClose()\n+        {\n+            var cache = GetTransactionalCache();\n+\n+            cache.Put(1, 1);\n+            cache.Put(2, 2);\n+\n+            using (Client.GetTransactions().TxStart())\n+            {\n+                cache.Put(1, 10);\n+                cache.Put(2, 20);\n+            }\n+\n+            Assert.AreEqual(1, cache.Get(1));\n+            Assert.AreEqual(2, cache.Get(2));\n+        }\n+\n+        /// <summary>\n+        /// Tests that client can't start multiple transactions in one thread.\n+        /// </summary>\n+        [Test]\n+        public void TestThrowsIfMultipleStarted()\n+        {\n+            TestThrowsIfMultipleStarted(\n+                () => Client.GetTransactions().TxStart(),\n+                () => Client.GetTransactions().TxStart());\n+        }\n+\n+        /// <summary>\n+        /// Tests that different clients can start transactions in one thread.\n+        /// </summary>\n+        [Test]\n+        public void TestDifferentClientsCanStartTransactions()\n+        {\n+            Assert.DoesNotThrow(() =>\n+            {\n+                using (Client.GetTransactions().TxStart())\n+                using (GetClient().GetTransactions().TxStart())\n+                {\n+                    // No-op.\n+                }\n+            });\n+        }\n+\n+        /// <summary>\n+        /// Test Ignite thin client transaction with label.\n+        /// </summary>\n+        [Test]\n+        public void TestWithLabel()\n+        {\n+            const string label1 = \"label1\";\n+            const string label2 = \"label2\";\n+\n+            var cache = GetTransactionalCache();\n+            cache.Put(1, 1);\n+            cache.Put(2, 2);\n+\n+            ITransaction igniteTx;\n+            using (Client.GetTransactions().WithLabel(label1).TxStart())\n+            {\n+                igniteTx = GetSingleLocalTransaction();\n+\n+                Assert.AreEqual(igniteTx.Label, label1);\n+\n+                cache.Put(1, 10);\n+                cache.Put(2, 20);\n+            }\n+            igniteTx.Dispose();\n+\n+            Assert.AreEqual(1, cache.Get(1));\n+            Assert.AreEqual(2, cache.Get(2));\n+\n+            using (var tx = Client.GetTransactions().WithLabel(label1).TxStart())\n+            {\n+                igniteTx = GetSingleLocalTransaction();\n+\n+                Assert.AreEqual(igniteTx.Label, label1);\n+\n+                cache.Put(1, 10);\n+                cache.Put(2, 20);\n+                tx.Commit();\n+            }\n+            igniteTx.Dispose();\n+\n+            Assert.AreEqual(10, cache.Get(1));\n+            Assert.AreEqual(20, cache.Get(2));\n+\n+            using (Client.GetTransactions().WithLabel(label1).WithLabel(label2).TxStart())\n+            {\n+                igniteTx = GetSingleLocalTransaction();\n+\n+                Assert.AreEqual(igniteTx.Label, label2);\n+            }\n+            igniteTx.Dispose();\n+\n+            TestThrowsIfMultipleStarted(\n+                () => Client.GetTransactions().WithLabel(label1).TxStart(),\n+                () => Client.GetTransactions().TxStart());\n+\n+            TestThrowsIfMultipleStarted(\n+                () => Client.GetTransactions().TxStart(),\n+                () => Client.GetTransactions().WithLabel(label1).TxStart());\n+\n+            TestThrowsIfMultipleStarted(\n+                () => Client.GetTransactions().WithLabel(label1).TxStart(),\n+                () => Client.GetTransactions().WithLabel(label2).TxStart());\n+        }\n+\n+        /// <summary>\n+        /// Test Ignite thin client transaction enlistment in ambient <see cref=\"TransactionScope\"/>.\n+        /// </summary>\n+        [Test]\n+        public void TestTransactionScopeSingleCache()\n+        {\n+            var cache = GetTransactionalCache();\n+\n+            cache[1] = 1;\n+            cache[2] = 2;\n+\n+            // Commit.\n+            using (var ts = new TransactionScope())\n+            {\n+                cache[1] = 10;\n+                cache[2] = 20;\n+\n+                ts.Complete();\n+            }\n+\n+            Assert.AreEqual(10, cache[1]);\n+            Assert.AreEqual(20, cache[2]);\n+\n+            // Rollback.\n+            using (new TransactionScope())\n+            {\n+                cache[1] = 100;\n+                cache[2] = 200;\n+            }\n+\n+            Assert.AreEqual(10, cache[1]);\n+            Assert.AreEqual(20, cache[2]);\n+        }\n+\n+        /// <summary>\n+        /// Test Ignite thin client transaction enlistment in ambient <see cref=\"TransactionScope\"/>\n+        /// with multiple participating caches.\n+        /// </summary>\n+        [Test]\n+        public void TestTransactionScopeMultiCache()\n+        {\n+            var cache1 = GetTransactionalCache();\n+            var cache2 = GetTransactionalCache(cache1.Name + \"1\");\n+\n+            cache1[1] = 1;\n+            cache2[1] = 2;\n+\n+            // Commit.\n+            using (var ts = new TransactionScope())\n+            {\n+                cache1.Put(1, 10);\n+                cache2.Put(1, 20);\n+\n+                ts.Complete();\n+            }\n+\n+            Assert.AreEqual(10, cache1[1]);\n+            Assert.AreEqual(20, cache2[1]);\n+\n+            // Rollback.\n+            using (new TransactionScope())\n+            {\n+                cache1.Put(1, 100);\n+                cache2.Put(1, 200);\n+            }\n+\n+            Assert.AreEqual(10, cache1[1]);\n+            Assert.AreEqual(20, cache2[1]);\n+        }\n+\n+        /// <summary>\n+        /// Test Ignite thin client transaction enlistment in ambient <see cref=\"TransactionScope\"/>\n+        /// when Ignite tx is started manually.\n+        /// </summary>\n+        [Test]\n+        public void TestTransactionScopeWithManualIgniteTx()\n+        {\n+            var cache = GetTransactionalCache();\n+            var transactions = Client.GetTransactions();\n+\n+            cache[1] = 1;\n+\n+            // When Ignite tx is started manually, it won't be enlisted in TransactionScope.\n+            using (var tx = transactions.TxStart())\n+            {\n+                using (new TransactionScope())\n+                {\n+                    cache[1] = 2;\n+                }  // Revert transaction scope.\n+\n+                tx.Commit();  // Commit manual tx.\n+            }\n+\n+            Assert.AreEqual(2, cache[1]);\n+        }\n+\n+        /// <summary>\n+        /// Test Ignite transaction with <see cref=\"TransactionScopeOption.Suppress\"/> option.\n+        /// </summary>\n+        [Test]\n+        public void TestSuppressedTransactionScope()\n+        {\n+            var cache = GetTransactionalCache();\n+\n+            cache[1] = 1;\n+\n+            using (new TransactionScope(TransactionScopeOption.Suppress))\n+            {\n+                cache[1] = 2;\n+            }\n+\n+            // Even though transaction is not completed, the value is updated, because tx is suppressed.\n+            Assert.AreEqual(2, cache[1]);\n+        }\n+\n+        /// <summary>\n+        /// Test Ignite thin client transaction enlistment in ambient <see cref=\"TransactionScope\"/> with nested scopes.\n+        /// </summary>\n+        [Test]\n+        public void TestNestedTransactionScope()\n+        {\n+            var cache = GetTransactionalCache();\n+\n+            cache[1] = 1;\n+\n+            foreach (var option in new[] {TransactionScopeOption.Required, TransactionScopeOption.RequiresNew})\n+            {\n+                // Commit.\n+                using (var ts1 = new TransactionScope())\n+                {\n+                    using (var ts2 = new TransactionScope(option))\n+                    {\n+                        cache[1] = 2;\n+                        ts2.Complete();\n+                    }\n+\n+                    cache[1] = 3;\n+                    ts1.Complete();\n+                }\n+\n+                Assert.AreEqual(3, cache[1]);\n+\n+                // Rollback.\n+                using (new TransactionScope())\n+                {\n+                    using (new TransactionScope(option))\n+                        cache[1] = 4;\n+\n+                    cache[1] = 5;\n+                }\n+\n+                // In case with Required option there is a single tx\n+                // that gets aborted, second put executes outside the tx.\n+                Assert.AreEqual(option == TransactionScopeOption.Required ? 5 : 3, cache[1], option.ToString());\n+            }\n+        }\n+\n+        /// <summary>\n+        /// Test that ambient <see cref=\"TransactionScope\"/> options propagate to Ignite transaction.\n+        /// </summary>\n+        [Test]\n+        public void TestTransactionScopeOptions()\n+        {\n+            var cache = GetTransactionalCache();\n+            var transactions = (ITransactionsClientInternal) Client.GetTransactions();\n+\n+            var modes = new[]\n+            {\n+                Tuple.Create(IsolationLevel.Serializable, TransactionIsolation.Serializable),\n+                Tuple.Create(IsolationLevel.RepeatableRead, TransactionIsolation.RepeatableRead),\n+                Tuple.Create(IsolationLevel.ReadCommitted, TransactionIsolation.ReadCommitted),\n+                Tuple.Create(IsolationLevel.ReadUncommitted, TransactionIsolation.ReadCommitted),\n+                Tuple.Create(IsolationLevel.Snapshot, TransactionIsolation.ReadCommitted),\n+                Tuple.Create(IsolationLevel.Chaos, TransactionIsolation.ReadCommitted),\n+            };\n+\n+            foreach (var mode in modes)\n+            {\n+                ITransaction tx;\n+                using (new TransactionScope(TransactionScopeOption.Required, new TransactionOptions\n+                {\n+                    IsolationLevel = mode.Item1\n+                }))\n+                {\n+                    cache[1] = 1;\n+\n+                    tx = GetSingleLocalTransaction();\n+                    Assert.AreEqual(mode.Item2, tx.Isolation);\n+                    Assert.AreEqual(transactions.DefaultTxConcurrency, tx.Concurrency);\n+                }\n+                tx.Dispose();\n+            }\n+        }\n+\n+        /// <summary>\n+        /// Tests all synchronous transactional operations with <see cref=\"TransactionScope\"/>.\n+        /// </summary>\n+        [Test]\n+        public void TestTransactionScopeAllOperationsSync()\n+        {\n+            CheckTxOp((cache, key) => cache.Put(key, -5));\n+\n+            CheckReadTxOp((cache, key) => cache.Get(key));\n+            \n+            CheckReadTxOp((cache, key) =>\n+            {\n+                int value;\n+                Assert.IsTrue(cache.TryGet(key, out value));\n+            });\n+\n+            CheckReadTxOp((cache, key) => cache.ContainsKey(key));\n+\n+            CheckReadTxOp((cache, key) => cache.ContainsKeys(new[] {key}));\n+\n+            CheckTxOp((cache, key) => cache.PutAll(new Dictionary<int, int> {{key, -7}}));\n+\n+            CheckTxOp((cache, key) =>\n+            {\n+                cache.Remove(key);\n+                cache.PutIfAbsent(key, -10);\n+            });\n+\n+            CheckTxOp((cache, key) => cache.GetAndPut(key, -9));\n+\n+            CheckTxOp((cache, key) =>\n+            {\n+                cache.Remove(key);\n+                cache.GetAndPutIfAbsent(key, -10);\n+            });\n+\n+            CheckTxOp((cache, key) => cache.GetAndRemove(key));\n+\n+            CheckTxOp((cache, key) => cache.GetAndReplace(key, -11));\n+\n+            CheckTxOp((cache, key) => cache.Remove(key));\n+\n+            CheckTxOp((cache, key) => cache.RemoveAll(new[] {key}));\n+\n+            CheckTxOp((cache, key) => cache.Replace(key, 100));\n+\n+            CheckTxOp((cache, key) => cache.Replace(key, cache[key], 100));\n+        }\n+\n+        /// <summary>\n+        /// Tests all transactional async operations with <see cref=\"TransactionScope\"/>.\n+        /// </summary>\n+        [Test]\n+        [Ignore(\"Async thin client transactional operations not supported.\")]\n+        public void TestTransactionScopeAllOperationsAsync()\n+        {\n+            CheckTxOp((cache, key) => cache.PutAsync(key, -5));\n+            CheckTxOp((cache, key) => cache.PutAllAsync(new Dictionary<int, int> {{key, -7}}));\n+\n+            CheckTxOp((cache, key) =>\n+            {\n+                cache.Remove(key);\n+                cache.PutIfAbsentAsync(key, -10);\n+            });\n+\n+            CheckTxOp((cache, key) => cache.GetAndPutAsync(key, -9));\n+\n+            CheckTxOp((cache, key) =>\n+            {\n+                cache.Remove(key);\n+                cache.GetAndPutIfAbsentAsync(key, -10);\n+            });\n+\n+            CheckTxOp((cache, key) => cache.GetAndRemoveAsync(key));\n+\n+            CheckTxOp((cache, key) => cache.GetAndReplaceAsync(key, -11));\n+\n+            CheckTxOp((cache, key) => cache.RemoveAsync(key));\n+\n+            CheckTxOp((cache, key) => cache.RemoveAllAsync(new[] {key}));\n+\n+            CheckTxOp((cache, key) => cache.ReplaceAsync(key, 100));\n+\n+            CheckTxOp((cache, key) => cache.ReplaceAsync(key, cache[key], 100));\n+        }\n+\n+        /// <summary>\n+        /// Checks that read cache operation starts ambient transaction.\n+        /// </summary>\n+        private void CheckReadTxOp(Action<ICacheClient<int, int>, int> act)\n+        {\n+            var txOpts = new TransactionOptions {IsolationLevel = IsolationLevel.RepeatableRead};\n+            const TransactionScopeOption scope = TransactionScopeOption.Required;\n+\n+            var cache = GetTransactionalCache();\n+            cache[1] = 1;\n+\n+            // Rollback.\n+            using (new TransactionScope(scope, txOpts))\n+            {\n+                act(cache, 1);\n+\n+                Assert.IsNotNull(((ITransactionsClientInternal) Client.GetTransactions()).CurrentTx,\n+                    \"Transaction has not started.\");\n+            }\n+        }\n+\n+        /// <summary>\n+        /// Checks that cache operation behaves transactionally.\n+        /// </summary>\n+        private void CheckTxOp(Action<ICacheClient<int, int>, int> act)\n+        {\n+            var isolationLevels = new[]\n+            {\n+                IsolationLevel.Serializable, IsolationLevel.RepeatableRead, IsolationLevel.ReadCommitted,\n+                IsolationLevel.ReadUncommitted, IsolationLevel.Snapshot, IsolationLevel.Chaos\n+            };\n+\n+            foreach (var isolationLevel in isolationLevels)\n+            {\n+                var txOpts = new TransactionOptions {IsolationLevel = isolationLevel};\n+                const TransactionScopeOption scope = TransactionScopeOption.Required;\n+\n+                var cache = GetTransactionalCache();\n+\n+                cache[1] = 1;\n+                cache[2] = 2;\n+\n+                // Rollback.\n+                using (new TransactionScope(scope, txOpts))\n+                {\n+                    act(cache, 1);\n+\n+                    Assert.IsNotNull(((ITransactionsClientInternal)Client.GetTransactions()).CurrentTx,\n+                        \"Transaction has not started.\");\n+                }\n+\n+                Assert.AreEqual(1, cache[1]);\n+                Assert.AreEqual(2, cache[2]);\n+\n+                using (new TransactionScope(scope, txOpts))\n+                {\n+                    act(cache, 1);\n+                    act(cache, 2);\n+                }\n+\n+                Assert.AreEqual(1, cache[1]);\n+                Assert.AreEqual(2, cache[2]);\n+\n+                // Commit.\n+                using (var ts = new TransactionScope(scope, txOpts))\n+                {\n+                    act(cache, 1);\n+                    ts.Complete();\n+                }\n+\n+                Assert.IsTrue(!cache.ContainsKey(1) || cache[1] != 1);\n+                Assert.AreEqual(2, cache[2]);\n+\n+                using (var ts = new TransactionScope(scope, txOpts))\n+                {\n+                    act(cache, 1);\n+                    act(cache, 2);\n+                    ts.Complete();\n+                }\n+\n+                Assert.IsTrue(!cache.ContainsKey(1) || cache[1] != 1);\n+                Assert.IsTrue(!cache.ContainsKey(2) || cache[2] != 2);\n+            }\n+        }\n+\n+        /// <summary>\n+        /// Gets single transaction from Ignite.\n+        /// </summary>\n+        private static ITransaction GetSingleLocalTransaction()\n+        {\n+            return GetIgnite()\n+               .GetTransactions()\n+               .GetLocalActiveTransactions()\n+               .Single();\n+        }\n+\n+        /// <summary>\n+        /// Tests that client can't start multiple transactions in one thread.\n+        /// </summary>\n+        private void TestThrowsIfMultipleStarted(Func<IDisposable> outer, Func<IDisposable> inner)\n+        {\n+", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "bf214c04a56d730b31cb7e1c84068c123e8dc525"}, "originalPosition": 722}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjg0OTcwNjYwOnYy", "diffSide": "RIGHT", "path": "modules/platforms/dotnet/Apache.Ignite.Core.Tests/Client/Cache/CacheClientAbstractTxTest.cs", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xOFQxNTo0MjoxOVrOGzo9EA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xOFQxNTo0MjoxOVrOGzo9EA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NjgwMTU1Mg==", "bodyText": "Extra blank line", "url": "https://github.com/apache/ignite/pull/7992#discussion_r456801552", "createdAt": "2020-07-18T15:42:19Z", "author": {"login": "ptupitsyn"}, "path": "modules/platforms/dotnet/Apache.Ignite.Core.Tests/Client/Cache/CacheClientAbstractTxTest.cs", "diffHunk": "@@ -0,0 +1,756 @@\n+/*\n+ * Licensed to the Apache Software Foundation (ASF) under one or more\n+ * contributor license agreements.  See the NOTICE file distributed with\n+ * this work for additional information regarding copyright ownership.\n+ * The ASF licenses this file to You under the Apache License, Version 2.0\n+ * (the \"License\"); you may not use this file except in compliance with\n+ * the License.  You may obtain a copy of the License at\n+ *\n+ *      http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+namespace Apache.Ignite.Core.Tests.Client.Cache\n+{\n+    using System;\n+    using System.Collections.Generic;\n+    using System.Linq;\n+    using System.Threading;\n+    using System.Transactions;\n+    using Apache.Ignite.Core.Cache.Configuration;\n+    using Apache.Ignite.Core.Client;\n+    using Apache.Ignite.Core.Client.Cache;\n+    using Apache.Ignite.Core.Client.Transactions;\n+    using Apache.Ignite.Core.Impl.Client.Transactions;\n+    using Apache.Ignite.Core.Transactions;\n+    using NUnit.Framework;\n+    using NUnit.Framework.Constraints;\n+\n+    /// <summary>\n+    /// Transactional cache client tests.\n+    /// </summary>\n+    public abstract class CacheClientAbstractTxTest : ClientTestBase\n+    {\n+        /** All concurrency controls. */\n+        private static readonly TransactionConcurrency[] AllConcurrencyControls =\n+        {\n+            TransactionConcurrency.Optimistic, \n+            TransactionConcurrency.Pessimistic\n+        };\n+\n+        /** All isolation levels*/\n+        private static readonly TransactionIsolation[] AllIsolationLevels = \n+        {\n+            TransactionIsolation.Serializable,\n+            TransactionIsolation.ReadCommitted,\n+            TransactionIsolation.RepeatableRead\n+        };\n+\n+        protected CacheClientAbstractTxTest(int serverCount, bool enablePartitionAwareness) : base(serverCount,\n+            enablePartitionAwareness: enablePartitionAwareness)\n+        {\n+            // No-op.\n+        }\n+\n+        /// <summary>\n+        /// Tests that custom client transactions configuration is applied.\n+        /// </summary>\n+        [Test]\n+        public void TestClientTransactionConfiguration()\n+        {\n+            var timeout = TransactionClientConfiguration.DefaultDefaultTimeout.Add(TimeSpan.FromMilliseconds(1000));\n+            var cfg = GetClientConfiguration();\n+            cfg.TransactionConfiguration = new TransactionClientConfiguration\n+            {\n+                DefaultTimeout = timeout\n+            };\n+\n+            foreach (var concurrency in AllConcurrencyControls)\n+            {\n+                foreach (var isolation in AllIsolationLevels)\n+                {\n+                    cfg.TransactionConfiguration.DefaultTransactionConcurrency = concurrency;\n+                    cfg.TransactionConfiguration.DefaultTransactionIsolation = isolation;\n+                    using (var client = Ignition.StartClient(cfg))\n+                    {\n+                        ITransaction tx;\n+                        using (client.GetTransactions().TxStart())\n+                        {\n+                            tx = GetSingleLocalTransaction();\n+                            Assert.AreEqual(concurrency, tx.Concurrency);\n+                            Assert.AreEqual(isolation, tx.Isolation);\n+                            Assert.AreEqual(timeout, tx.Timeout);\n+                        }\n+                        tx.Dispose();\n+                    }\n+                }\n+            }\n+        }\n+\n+        /// <summary>\n+        /// Tests that parameters passed to TxStart are applied.\n+        /// </summary>\n+        [Test]\n+        public void TestTxStartPassesParameters()\n+        {\n+            var timeout = TransactionClientConfiguration.DefaultDefaultTimeout.Add(TimeSpan.FromMilliseconds(1000));\n+            var acts = new List<Func<ITransactionsClient>>\n+            {\n+                () => Client.GetTransactions(),\n+                () => Client.GetTransactions().WithLabel(\"label\"),\n+            };\n+            foreach (var concurrency in AllConcurrencyControls)\n+            {\n+                foreach (var isolation in AllIsolationLevels)\n+                {\n+                    foreach (var act in acts)\n+                    {\n+                        ITransaction tx;\n+                        using (act().TxStart(concurrency, isolation))\n+                        {\n+                            tx = GetSingleLocalTransaction();\n+                            Assert.AreEqual(concurrency, tx.Concurrency);\n+                            Assert.AreEqual(isolation, tx.Isolation);\n+                        }\n+                        tx.Dispose();\n+                        using (act().TxStart(concurrency, isolation, timeout))\n+                        {\n+                            tx = GetSingleLocalTransaction();\n+                            Assert.AreEqual(concurrency, tx.Concurrency);\n+                            Assert.AreEqual(isolation, tx.Isolation);\n+                            Assert.AreEqual(timeout, tx.Timeout);\n+                        }\n+                        tx.Dispose();\n+                    }\n+                }\n+            }\n+        }\n+\n+        /// <summary>\n+        /// Tests that transaction can't be committed/rollback after being already completed.\n+        /// </summary>\n+        [Test]\n+        public void TestThrowsIfEndAlreadyCompletedTransaction()\n+        {\n+            var tx = Client.GetTransactions().TxStart();\n+            tx.Commit();\n+\n+            var constraint = new ReusableConstraint(Is.TypeOf<InvalidOperationException>()\n+               .And.Message.Contains(\"Transaction\")\n+               .And.Message.Contains(\"is closed\"));\n+\n+            Assert.Throws(constraint, () => tx.Commit());\n+            Assert.Throws(constraint, () => tx.Rollback());\n+\n+            using (tx = Client.GetTransactions().TxStart())\n+            {\n+            }\n+\n+            Assert.Throws(constraint, () => tx.Commit());\n+            Assert.Throws(constraint, () => tx.Rollback());\n+        }\n+", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "bf214c04a56d730b31cb7e1c84068c123e8dc525"}, "originalPosition": 157}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjg0OTcxMTAxOnYy", "diffSide": "RIGHT", "path": "modules/platforms/dotnet/Apache.Ignite.Core/Client/Transactions/ITransactionsClient.cs", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xOFQxNTo0OTowN1rOGzo_Og==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xOFQxNTo0OTowN1rOGzo_Og==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NjgwMjEwNg==", "bodyText": "starts a new - here and below", "url": "https://github.com/apache/ignite/pull/7992#discussion_r456802106", "createdAt": "2020-07-18T15:49:07Z", "author": {"login": "ptupitsyn"}, "path": "modules/platforms/dotnet/Apache.Ignite.Core/Client/Transactions/ITransactionsClient.cs", "diffHunk": "@@ -0,0 +1,69 @@\n+/*\n+ * Licensed to the Apache Software Foundation (ASF) under one or more\n+ * contributor license agreements.  See the NOTICE file distributed with\n+ * this work for additional information regarding copyright ownership.\n+ * The ASF licenses this file to You under the Apache License, Version 2.0\n+ * (the \"License\"); you may not use this file except in compliance with\n+ * the License.  You may obtain a copy of the License at\n+ *\n+ *      http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+namespace Apache.Ignite.Core.Client.Transactions\n+{\n+    using System;\n+    using Apache.Ignite.Core.Transactions;\n+\n+    /// <summary>\n+    /// Ignite Thin Client transactions facade.\n+    /// <para /> Transactions are bound to the thread started the transaction. After that, each cache operation within this thread\n+    /// will belong to the corresponding transaction until the transaction is committed, rolled back or closed.\n+    /// <para /> Should not be used with async calls.\n+    /// </summary> \n+    public interface ITransactionsClient\n+    {\n+        /// <summary>\n+        /// Starts a new transaction with the default isolation level, concurrency and timeout.\n+        /// <para /> Default values for transaction isolation level, concurrency and timeout can be configured via\n+        /// <see cref=\"TransactionClientConfiguration\"/>.\n+        /// <para /> Should not be used with async calls.\n+        /// </summary>\n+        /// <returns>New transaction.</returns>\n+        ITransactionClient TxStart();\n+\n+        /// <summary>\n+        /// Starts new transaction with the specified concurrency and isolation.", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "bf214c04a56d730b31cb7e1c84068c123e8dc525"}, "originalPosition": 41}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjg0OTcxMTQxOnYy", "diffSide": "RIGHT", "path": "modules/platforms/dotnet/Apache.Ignite.Core/Client/Transactions/ITransactionsClient.cs", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xOFQxNTo0OTozMFrOGzo_aw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xOFQxNTo0OTozMFrOGzo_aw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NjgwMjE1NQ==", "bodyText": "an instance", "url": "https://github.com/apache/ignite/pull/7992#discussion_r456802155", "createdAt": "2020-07-18T15:49:30Z", "author": {"login": "ptupitsyn"}, "path": "modules/platforms/dotnet/Apache.Ignite.Core/Client/Transactions/ITransactionsClient.cs", "diffHunk": "@@ -0,0 +1,69 @@\n+/*\n+ * Licensed to the Apache Software Foundation (ASF) under one or more\n+ * contributor license agreements.  See the NOTICE file distributed with\n+ * this work for additional information regarding copyright ownership.\n+ * The ASF licenses this file to You under the Apache License, Version 2.0\n+ * (the \"License\"); you may not use this file except in compliance with\n+ * the License.  You may obtain a copy of the License at\n+ *\n+ *      http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+namespace Apache.Ignite.Core.Client.Transactions\n+{\n+    using System;\n+    using Apache.Ignite.Core.Transactions;\n+\n+    /// <summary>\n+    /// Ignite Thin Client transactions facade.\n+    /// <para /> Transactions are bound to the thread started the transaction. After that, each cache operation within this thread\n+    /// will belong to the corresponding transaction until the transaction is committed, rolled back or closed.\n+    /// <para /> Should not be used with async calls.\n+    /// </summary> \n+    public interface ITransactionsClient\n+    {\n+        /// <summary>\n+        /// Starts a new transaction with the default isolation level, concurrency and timeout.\n+        /// <para /> Default values for transaction isolation level, concurrency and timeout can be configured via\n+        /// <see cref=\"TransactionClientConfiguration\"/>.\n+        /// <para /> Should not be used with async calls.\n+        /// </summary>\n+        /// <returns>New transaction.</returns>\n+        ITransactionClient TxStart();\n+\n+        /// <summary>\n+        /// Starts new transaction with the specified concurrency and isolation.\n+        /// <para /> Should not be used with async calls.\n+        /// </summary>\n+        /// <param name=\"concurrency\">Concurrency.</param>\n+        /// <param name=\"isolation\">Isolation.</param>\n+        /// <returns>New transaction.</returns>\n+        ITransactionClient TxStart(TransactionConcurrency concurrency, TransactionIsolation isolation);\n+\n+        /// <summary>\n+        /// Starts new transaction with the specified concurrency, isolation and timeout.\n+        /// <para /> Should not be used with async calls.\n+        /// </summary>\n+        /// <param name=\"concurrency\">Concurrency.</param>\n+        /// <param name=\"isolation\">Isolation.</param>\n+        /// <param name=\"timeout\">Timeout. TimeSpan. Zero for indefinite timeout.</param>\n+        /// <returns>New transaction.</returns>\n+        ITransactionClient TxStart(TransactionConcurrency concurrency, TransactionIsolation isolation, TimeSpan timeout);\n+\n+        /// <summary>\n+        /// Returns instance of <see cref=\"ITransactionsClient\"/> to mark a transaction with a special label.", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "bf214c04a56d730b31cb7e1c84068c123e8dc525"}, "originalPosition": 60}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjg0OTcxMzAxOnYy", "diffSide": "RIGHT", "path": "modules/platforms/dotnet/Apache.Ignite.Core/Client/Transactions/ITransactionsClient.cs", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xOFQxNTo1MTo0M1rOGzpANA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xOFQxNTo1MTo0M1rOGzpANA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NjgwMjM1Ng==", "bodyText": "We can add <see cref=\"ITransaction.Label\" /> and <see cref=\"ITransactions.GetLocalActiveTransactions\" />", "url": "https://github.com/apache/ignite/pull/7992#discussion_r456802356", "createdAt": "2020-07-18T15:51:43Z", "author": {"login": "ptupitsyn"}, "path": "modules/platforms/dotnet/Apache.Ignite.Core/Client/Transactions/ITransactionsClient.cs", "diffHunk": "@@ -0,0 +1,69 @@\n+/*\n+ * Licensed to the Apache Software Foundation (ASF) under one or more\n+ * contributor license agreements.  See the NOTICE file distributed with\n+ * this work for additional information regarding copyright ownership.\n+ * The ASF licenses this file to You under the Apache License, Version 2.0\n+ * (the \"License\"); you may not use this file except in compliance with\n+ * the License.  You may obtain a copy of the License at\n+ *\n+ *      http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+namespace Apache.Ignite.Core.Client.Transactions\n+{\n+    using System;\n+    using Apache.Ignite.Core.Transactions;\n+\n+    /// <summary>\n+    /// Ignite Thin Client transactions facade.\n+    /// <para /> Transactions are bound to the thread started the transaction. After that, each cache operation within this thread\n+    /// will belong to the corresponding transaction until the transaction is committed, rolled back or closed.\n+    /// <para /> Should not be used with async calls.\n+    /// </summary> \n+    public interface ITransactionsClient\n+    {\n+        /// <summary>\n+        /// Starts a new transaction with the default isolation level, concurrency and timeout.\n+        /// <para /> Default values for transaction isolation level, concurrency and timeout can be configured via\n+        /// <see cref=\"TransactionClientConfiguration\"/>.\n+        /// <para /> Should not be used with async calls.\n+        /// </summary>\n+        /// <returns>New transaction.</returns>\n+        ITransactionClient TxStart();\n+\n+        /// <summary>\n+        /// Starts new transaction with the specified concurrency and isolation.\n+        /// <para /> Should not be used with async calls.\n+        /// </summary>\n+        /// <param name=\"concurrency\">Concurrency.</param>\n+        /// <param name=\"isolation\">Isolation.</param>\n+        /// <returns>New transaction.</returns>\n+        ITransactionClient TxStart(TransactionConcurrency concurrency, TransactionIsolation isolation);\n+\n+        /// <summary>\n+        /// Starts new transaction with the specified concurrency, isolation and timeout.\n+        /// <para /> Should not be used with async calls.\n+        /// </summary>\n+        /// <param name=\"concurrency\">Concurrency.</param>\n+        /// <param name=\"isolation\">Isolation.</param>\n+        /// <param name=\"timeout\">Timeout. TimeSpan. Zero for indefinite timeout.</param>\n+        /// <returns>New transaction.</returns>\n+        ITransactionClient TxStart(TransactionConcurrency concurrency, TransactionIsolation isolation, TimeSpan timeout);\n+\n+        /// <summary>\n+        /// Returns instance of <see cref=\"ITransactionsClient\"/> to mark a transaction with a special label.\n+        /// The label is helpful for diagnostic and exposed to some diagnostic tools like\n+        /// SYS.TRANSACTIONS system view, control.sh commands, JMX TransactionsMXBean,\n+        /// long-running transactions dump in logs.", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "bf214c04a56d730b31cb7e1c84068c123e8dc525"}, "originalPosition": 63}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjg0OTcxMzkzOnYy", "diffSide": "RIGHT", "path": "modules/platforms/dotnet/Apache.Ignite.Core/Client/Transactions/TransactionClientConfiguration.cs", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xOFQxNTo1Mjo1M1rOGzpAog==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xOFQxNTo1Mjo1M1rOGzpAog==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NjgwMjQ2Ng==", "bodyText": "We should copy the values from the configuration parameter, right? Please add a test for this.", "url": "https://github.com/apache/ignite/pull/7992#discussion_r456802466", "createdAt": "2020-07-18T15:52:53Z", "author": {"login": "ptupitsyn"}, "path": "modules/platforms/dotnet/Apache.Ignite.Core/Client/Transactions/TransactionClientConfiguration.cs", "diffHunk": "@@ -0,0 +1,81 @@\n+\ufeff/*\n+ * Licensed to the Apache Software Foundation (ASF) under one or more\n+ * contributor license agreements.  See the NOTICE file distributed with\n+ * this work for additional information regarding copyright ownership.\n+ * The ASF licenses this file to You under the Apache License, Version 2.0\n+ * (the \"License\"); you may not use this file except in compliance with\n+ * the License.  You may obtain a copy of the License at\n+ *\n+ *      http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+namespace Apache.Ignite.Core.Client.Transactions\n+{\n+    using System;\n+    using System.ComponentModel;\n+    using Apache.Ignite.Core.Impl.Common;\n+    using Apache.Ignite.Core.Transactions;\n+\n+    /// <summary>\n+    /// Transactions configuration.\n+    /// </summary>\n+    public class TransactionClientConfiguration\n+    {\n+        /// <summary> The default value for <see cref=\"DefaultTransactionConcurrency\"/> property. </summary>\n+        public const TransactionConcurrency DefaultDefaultTransactionConcurrency = TransactionConcurrency.Pessimistic;\n+\n+        /// <summary> The default value for <see cref=\"DefaultTransactionIsolation\"/> property. </summary>\n+        public const TransactionIsolation DefaultDefaultTransactionIsolation = TransactionIsolation.RepeatableRead;\n+\n+        /// <summary> The default value for <see cref=\"DefaultTransactionIsolation\"/> property. </summary>\n+        public static readonly TimeSpan DefaultDefaultTimeout = TimeSpan.Zero;\n+\n+        /// <summary>\n+        /// Gets or sets the cache transaction concurrency to use when one is not explicitly specified.\n+        /// </summary>\n+        [DefaultValue(DefaultDefaultTransactionConcurrency)]\n+        public TransactionConcurrency DefaultTransactionConcurrency { get; set; }\n+\n+        /// <summary>\n+        /// Gets or sets the cache transaction isolation to use when one is not explicitly specified.\n+        /// </summary>\n+        [DefaultValue(DefaultDefaultTransactionIsolation)]\n+        public TransactionIsolation DefaultTransactionIsolation { get; set; }\n+\n+        /// <summary>\n+        /// Gets or sets the cache transaction timeout to use when one is not explicitly specified.\n+        /// <see cref=\"TimeSpan.Zero\"/> for infinite timeout.\n+        /// </summary>\n+        [DefaultValue(typeof(TimeSpan), \"00:00:00\")]\n+        public TimeSpan DefaultTimeout { get; set; }\n+\n+        /// <summary>\n+        /// Initializes a new instance of the <see cref=\"TransactionClientConfiguration\" /> class.\n+        /// </summary>\n+        public TransactionClientConfiguration()\n+        {\n+            DefaultTransactionConcurrency = DefaultDefaultTransactionConcurrency;\n+            DefaultTransactionIsolation = DefaultDefaultTransactionIsolation;\n+            DefaultTimeout = DefaultDefaultTimeout;\n+        }\n+        \n+        /// <summary>\n+        /// Initializes a new instance of the <see cref=\"TransactionClientConfiguration\" /> class.\n+        /// </summary>\n+        /// <param name=\"configuration\">The configuration to copy.</param>\n+        public TransactionClientConfiguration(TransactionClientConfiguration configuration)\n+        {\n+            IgniteArgumentCheck.NotNull(configuration, \"configuration\");\n+\n+            DefaultTransactionConcurrency = DefaultDefaultTransactionConcurrency;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "bf214c04a56d730b31cb7e1c84068c123e8dc525"}, "originalPosition": 76}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjg0OTcxNDQxOnYy", "diffSide": "RIGHT", "path": "modules/platforms/dotnet/Apache.Ignite.Core/Impl/Client/ClientFailoverSocket.cs", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xOFQxNTo1NDoxMFrOGzpA4g==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xOFQxNTo1NDoxMFrOGzpA4g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NjgwMjUzMA==", "bodyText": "Comment", "url": "https://github.com/apache/ignite/pull/7992#discussion_r456802530", "createdAt": "2020-07-18T15:54:10Z", "author": {"login": "ptupitsyn"}, "path": "modules/platforms/dotnet/Apache.Ignite.Core/Impl/Client/ClientFailoverSocket.cs", "diffHunk": "@@ -54,6 +55,8 @@ internal class ClientFailoverSocket : IDisposable\n         /** Marshaller. */\n         private readonly Marshaller _marsh;\n \n+        private readonly ITransactionsClientInternal _transactions;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "bf214c04a56d730b31cb7e1c84068c123e8dc525"}, "originalPosition": 12}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjg0OTcxNTk3OnYy", "diffSide": "RIGHT", "path": "modules/platforms/dotnet/Apache.Ignite.Core/Impl/Client/ClientFailoverSocket.cs", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xOFQxNTo1NjowNVrOGzpBlA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yMVQyMToyNjowM1rOG1KXvw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NjgwMjcwOA==", "bodyText": "Is there a test for this case? How are users supposed to handle this?", "url": "https://github.com/apache/ignite/pull/7992#discussion_r456802708", "createdAt": "2020-07-18T15:56:05Z", "author": {"login": "ptupitsyn"}, "path": "modules/platforms/dotnet/Apache.Ignite.Core/Impl/Client/ClientFailoverSocket.cs", "diffHunk": "@@ -247,6 +256,16 @@ public IEnumerable<IClientConnection> GetConnections()\n         /// </summary>\n         private ClientSocket GetSocket()\n         {\n+            var tx = _transactions.CurrentTx;\n+            if (tx != null)\n+            {\n+                if (tx.Socket.IsDisposed)\n+                {\n+                    throw new IgniteClientException(\"Transaction context has been lost due to connection errors.\");", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "bf214c04a56d730b31cb7e1c84068c123e8dc525"}, "originalPosition": 49}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1ODM5NzYzMQ==", "bodyText": "I've added one. Calling dispose o tx should take care of it.", "url": "https://github.com/apache/ignite/pull/7992#discussion_r458397631", "createdAt": "2020-07-21T21:26:03Z", "author": {"login": "gurustron"}, "path": "modules/platforms/dotnet/Apache.Ignite.Core/Impl/Client/ClientFailoverSocket.cs", "diffHunk": "@@ -247,6 +256,16 @@ public IEnumerable<IClientConnection> GetConnections()\n         /// </summary>\n         private ClientSocket GetSocket()\n         {\n+            var tx = _transactions.CurrentTx;\n+            if (tx != null)\n+            {\n+                if (tx.Socket.IsDisposed)\n+                {\n+                    throw new IgniteClientException(\"Transaction context has been lost due to connection errors.\");", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NjgwMjcwOA=="}, "originalCommit": {"oid": "bf214c04a56d730b31cb7e1c84068c123e8dc525"}, "originalPosition": 49}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjg0OTcxOTM0OnYy", "diffSide": "RIGHT", "path": "modules/platforms/dotnet/Apache.Ignite.Core/Impl/Client/Transactions/ClientCacheTransactionManager.cs", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xOFQxNjowMDo0N1rOGzpDOw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xOFQxNjowMDo0N1rOGzpDOw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NjgwMzEzMQ==", "bodyText": "This condition seems to be unnecessary, please see my changes in #8004 .", "url": "https://github.com/apache/ignite/pull/7992#discussion_r456803131", "createdAt": "2020-07-18T16:00:47Z", "author": {"login": "ptupitsyn"}, "path": "modules/platforms/dotnet/Apache.Ignite.Core/Impl/Client/Transactions/ClientCacheTransactionManager.cs", "diffHunk": "@@ -0,0 +1,154 @@\n+/*\n+ * Licensed to the Apache Software Foundation (ASF) under one or more\n+ * contributor license agreements.  See the NOTICE file distributed with\n+ * this work for additional information regarding copyright ownership.\n+ * The ASF licenses this file to You under the Apache License, Version 2.0\n+ * (the \"License\"); you may not use this file except in compliance with\n+ * the License.  You may obtain a copy of the License at\n+ *\n+ *      http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+namespace Apache.Ignite.Core.Impl.Client.Transactions\n+{\n+    using System;\n+    using System.Diagnostics;\n+    using System.Diagnostics.CodeAnalysis;\n+    using System.Threading;\n+    using System.Transactions;\n+    using Apache.Ignite.Core.Impl.Transactions;\n+\n+    /// <summary>\n+    /// Cache transaction enlistment manager, \n+    /// allows using Ignite transactions via standard <see cref=\"TransactionScope\"/>.\n+    /// </summary>\n+    internal class ClientCacheTransactionManager : ISinglePhaseNotification, IDisposable\n+    {\n+        /** */\n+        private readonly ITransactionsClientInternal _transactions;\n+\n+        /** */\n+        private readonly ThreadLocal<Enlistment> _enlistment = new ThreadLocal<Enlistment>();\n+\n+        /// <summary>\n+        /// Initializes a new instance of <see cref=\"ClientCacheTransactionManager\"/> class.\n+        /// </summary>\n+        /// <param name=\"transactions\">Transactions.</param>\n+        public ClientCacheTransactionManager(ITransactionsClientInternal transactions)\n+        {\n+            _transactions = transactions;\n+        }\n+\n+        /// <summary>\n+        /// If ambient transaction is present, starts an Ignite transaction and enlists it.\n+        /// </summary>\n+        public void StartTxIfNeeded()\n+        {\n+            if (_transactions.CurrentTx != null)\n+            {\n+                // Ignite transaction is already present.\n+                // We have either enlisted it already, or it has been started manually and should not be enlisted.\n+                // Java enlists existing Ignite tx in this case (see CacheJtaManager.java), but we do not.\n+                return;\n+            }\n+\n+            if (_enlistment.Value != null)", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "bf214c04a56d730b31cb7e1c84068c123e8dc525"}, "originalPosition": 61}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjg0OTcxOTUyOnYy", "diffSide": "RIGHT", "path": "modules/platforms/dotnet/Apache.Ignite.Core/Impl/Client/Transactions/ClientCacheTransactionManager.cs", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xOFQxNjowMTowN1rOGzpDUQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xOFQxNjowMTowN1rOGzpDUQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NjgwMzE1Mw==", "bodyText": "Missing xmldoc", "url": "https://github.com/apache/ignite/pull/7992#discussion_r456803153", "createdAt": "2020-07-18T16:01:07Z", "author": {"login": "ptupitsyn"}, "path": "modules/platforms/dotnet/Apache.Ignite.Core/Impl/Client/Transactions/ClientCacheTransactionManager.cs", "diffHunk": "@@ -0,0 +1,154 @@\n+/*\n+ * Licensed to the Apache Software Foundation (ASF) under one or more\n+ * contributor license agreements.  See the NOTICE file distributed with\n+ * this work for additional information regarding copyright ownership.\n+ * The ASF licenses this file to You under the Apache License, Version 2.0\n+ * (the \"License\"); you may not use this file except in compliance with\n+ * the License.  You may obtain a copy of the License at\n+ *\n+ *      http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+namespace Apache.Ignite.Core.Impl.Client.Transactions\n+{\n+    using System;\n+    using System.Diagnostics;\n+    using System.Diagnostics.CodeAnalysis;\n+    using System.Threading;\n+    using System.Transactions;\n+    using Apache.Ignite.Core.Impl.Transactions;\n+\n+    /// <summary>\n+    /// Cache transaction enlistment manager, \n+    /// allows using Ignite transactions via standard <see cref=\"TransactionScope\"/>.\n+    /// </summary>\n+    internal class ClientCacheTransactionManager : ISinglePhaseNotification, IDisposable\n+    {\n+        /** */\n+        private readonly ITransactionsClientInternal _transactions;\n+\n+        /** */\n+        private readonly ThreadLocal<Enlistment> _enlistment = new ThreadLocal<Enlistment>();\n+\n+        /// <summary>\n+        /// Initializes a new instance of <see cref=\"ClientCacheTransactionManager\"/> class.\n+        /// </summary>\n+        /// <param name=\"transactions\">Transactions.</param>\n+        public ClientCacheTransactionManager(ITransactionsClientInternal transactions)\n+        {\n+            _transactions = transactions;\n+        }\n+\n+        /// <summary>\n+        /// If ambient transaction is present, starts an Ignite transaction and enlists it.\n+        /// </summary>\n+        public void StartTxIfNeeded()\n+        {\n+            if (_transactions.CurrentTx != null)\n+            {\n+                // Ignite transaction is already present.\n+                // We have either enlisted it already, or it has been started manually and should not be enlisted.\n+                // Java enlists existing Ignite tx in this case (see CacheJtaManager.java), but we do not.\n+                return;\n+            }\n+\n+            if (_enlistment.Value != null)\n+            {\n+                // We are already enlisted.\n+                // .NET transaction mechanism allows nested transactions,\n+                // and they can be processed differently depending on TransactionScopeOption.\n+                // Ignite, however, allows only one active transaction per thread.\n+                // Therefore we enlist only once on the first transaction that we encounter.\n+                return;\n+            }\n+\n+            var ambientTx = System.Transactions.Transaction.Current;\n+\n+            if (ambientTx != null && ambientTx.TransactionInformation.Status == TransactionStatus.Active)\n+            {\n+                _transactions.TxStart(_transactions.DefaultTxConcurrency,\n+                    CacheTransactionManager.ConvertTransactionIsolation(ambientTx.IsolationLevel),\n+                    _transactions.DefaultTimeout);\n+\n+                _enlistment.Value = ambientTx.EnlistVolatile(this, EnlistmentOptions.None);\n+            }\n+        }\n+\n+        void IEnlistmentNotification.Prepare(PreparingEnlistment preparingEnlistment)", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "bf214c04a56d730b31cb7e1c84068c123e8dc525"}, "originalPosition": 83}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjg0OTcxOTU3OnYy", "diffSide": "RIGHT", "path": "modules/platforms/dotnet/Apache.Ignite.Core/Impl/Client/Transactions/ITransactionClientInternal.cs", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xOFQxNjowMToxNVrOGzpDWg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xOFQxNjowMToxNVrOGzpDWg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NjgwMzE2Mg==", "bodyText": "xmldoc", "url": "https://github.com/apache/ignite/pull/7992#discussion_r456803162", "createdAt": "2020-07-18T16:01:15Z", "author": {"login": "ptupitsyn"}, "path": "modules/platforms/dotnet/Apache.Ignite.Core/Impl/Client/Transactions/ITransactionClientInternal.cs", "diffHunk": "@@ -0,0 +1,34 @@\n+/*\n+ * Licensed to the Apache Software Foundation (ASF) under one or more\n+ * contributor license agreements.  See the NOTICE file distributed with\n+ * this work for additional information regarding copyright ownership.\n+ * The ASF licenses this file to You under the Apache License, Version 2.0\n+ * (the \"License\"); you may not use this file except in compliance with\n+ * the License.  You may obtain a copy of the License at\n+ *\n+ *      http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+namespace Apache.Ignite.Core.Impl.Client.Transactions\n+{\n+    using Apache.Ignite.Core.Client.Transactions;\n+\n+    internal interface ITransactionClientInternal : ITransactionClient", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "bf214c04a56d730b31cb7e1c84068c123e8dc525"}, "originalPosition": 22}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjg0OTcxOTgyOnYy", "diffSide": "RIGHT", "path": "modules/platforms/dotnet/Apache.Ignite.Core/Impl/Client/Transactions/ITransactionsClientInternal.cs", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xOFQxNjowMTozNFrOGzpDeg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xOFQxNjowMTozNFrOGzpDeg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NjgwMzE5NA==", "bodyText": "xmldoc", "url": "https://github.com/apache/ignite/pull/7992#discussion_r456803194", "createdAt": "2020-07-18T16:01:34Z", "author": {"login": "ptupitsyn"}, "path": "modules/platforms/dotnet/Apache.Ignite.Core/Impl/Client/Transactions/ITransactionsClientInternal.cs", "diffHunk": "@@ -0,0 +1,51 @@\n+/*\n+ * Licensed to the Apache Software Foundation (ASF) under one or more\n+ * contributor license agreements.  See the NOTICE file distributed with\n+ * this work for additional information regarding copyright ownership.\n+ * The ASF licenses this file to You under the Apache License, Version 2.0\n+ * (the \"License\"); you may not use this file except in compliance with\n+ * the License.  You may obtain a copy of the License at\n+ *\n+ *      http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+namespace Apache.Ignite.Core.Impl.Client.Transactions\n+{\n+    using System;\n+    using Apache.Ignite.Core.Client.Transactions;\n+    using Apache.Ignite.Core.Transactions;\n+\n+    internal interface ITransactionsClientInternal : ITransactionsClient", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "bf214c04a56d730b31cb7e1c84068c123e8dc525"}, "originalPosition": 24}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjg0OTcyMDg0OnYy", "diffSide": "RIGHT", "path": "modules/platforms/dotnet/Apache.Ignite.Core/Impl/Client/Transactions/TransactionsClient.cs", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xOFQxNjowMzowNVrOGzpD-g==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xOFQxNjowMzowNVrOGzpD-g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NjgwMzMyMg==", "bodyText": "return tx", "url": "https://github.com/apache/ignite/pull/7992#discussion_r456803322", "createdAt": "2020-07-18T16:03:05Z", "author": {"login": "ptupitsyn"}, "path": "modules/platforms/dotnet/Apache.Ignite.Core/Impl/Client/Transactions/TransactionsClient.cs", "diffHunk": "@@ -0,0 +1,249 @@\n+/*\n+ * Licensed to the Apache Software Foundation (ASF) under one or more\n+ * contributor license agreements.  See the NOTICE file distributed with\n+ * this work for additional information regarding copyright ownership.\n+ * The ASF licenses this file to You under the Apache License, Version 2.0\n+ * (the \"License\"); you may not use this file except in compliance with\n+ * the License.  You may obtain a copy of the License at\n+ *\n+ *      http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+namespace Apache.Ignite.Core.Impl.Client.Transactions\n+{\n+    using System;\n+    using System.Diagnostics;\n+    using System.Diagnostics.CodeAnalysis;\n+    using System.Threading;\n+    using Apache.Ignite.Core.Client;\n+    using Apache.Ignite.Core.Client.Transactions;\n+    using Apache.Ignite.Core.Impl.Binary;\n+    using Apache.Ignite.Core.Impl.Common;\n+    using Apache.Ignite.Core.Transactions;\n+\n+    /// <summary>\n+    /// Ignite Thin Client transactions facade.\n+    /// </summary>\n+    internal class TransactionsClient : ITransactionsClientInternal, IDisposable\n+    {\n+        /** Ignite. */\n+        private readonly IgniteClient _ignite;\n+\n+        /** Default transaction configuration. */\n+        private readonly TransactionClientConfiguration _cfg;\n+\n+        /** Transaction for this thread and client. */\n+        private readonly ThreadLocal<TransactionClient> _currentTx = new ThreadLocal<TransactionClient>();\n+\n+        /** Transaction manager. */\n+        private readonly ClientCacheTransactionManager _txManager;\n+\n+        /// <summary>\n+        /// Constructor.\n+        /// </summary>\n+        /// <param name=\"ignite\">Ignite.</param>\n+        /// <param name=\"cfg\"></param>\n+        public TransactionsClient(IgniteClient ignite, TransactionClientConfiguration cfg)\n+        {\n+            _ignite = ignite;\n+            _cfg = cfg ?? new TransactionClientConfiguration();\n+            _txManager = new ClientCacheTransactionManager(this);\n+        }\n+\n+        /** <inheritdoc /> */\n+        public ITransactionClientInternal CurrentTx\n+        {\n+            get\n+            {\n+                var tx = _currentTx.Value;\n+\n+                if (tx == null)\n+                    return null;\n+\n+                if (tx.Closed)\n+                {\n+                    _currentTx.Value = null;\n+\n+                    return null;\n+                }\n+\n+                return tx;\n+            }\n+        }\n+\n+        /** <inheritDoc /> */\n+        public void StartTxIfNeeded()\n+        {\n+            _txManager.StartTxIfNeeded();\n+        }\n+\n+        /** <inheritDoc /> */\n+        public TransactionConcurrency DefaultTxConcurrency\n+        {\n+            get { return _cfg.DefaultTransactionConcurrency; }\n+        }\n+\n+        /** <inheritDoc /> */\n+        public TransactionIsolation DefaultTxIsolation\n+        {\n+            get { return _cfg.DefaultTransactionIsolation; }\n+        }\n+\n+        /** <inheritDoc /> */\n+        public TimeSpan DefaultTimeout\n+        {\n+            get { return _cfg.DefaultTimeout; }\n+        }\n+\n+        /** <inheritDoc /> */\n+        public ITransactionClient TxStart()\n+        {\n+            return TxStart(_cfg.DefaultTransactionConcurrency, _cfg.DefaultTransactionIsolation);\n+        }\n+\n+        /** <inheritDoc /> */\n+        public ITransactionClient TxStart(TransactionConcurrency concurrency, TransactionIsolation isolation)\n+        {\n+            return TxStart(concurrency, isolation, _cfg.DefaultTimeout);\n+        }\n+\n+        /** <inheritDoc /> */\n+        public ITransactionClient TxStart(TransactionConcurrency concurrency, \n+            TransactionIsolation isolation,\n+            TimeSpan timeout)\n+        {\n+            return TxStart(concurrency, isolation, timeout, null);\n+        }\n+\n+        private ITransactionClient TxStart(TransactionConcurrency concurrency,\n+            TransactionIsolation isolation,\n+            TimeSpan timeout,\n+            string label)\n+        {\n+            if (CurrentTx != null)\n+            {\n+                throw new IgniteClientException(\"A transaction has already been started by the current thread.\");\n+            }\n+\n+            var tx = _ignite.Socket.DoOutInOp(\n+                ClientOp.TxStart,\n+                ctx =>\n+                {\n+                    ctx.Writer.WriteByte((byte) concurrency);\n+                    ctx.Writer.WriteByte((byte) isolation);\n+                    ctx.Writer.WriteTimeSpanAsLong(timeout);\n+                    ctx.Writer.WriteString(label);\n+                },\n+                ctx => new TransactionClient(\n+                    ctx.Reader.ReadInt(),\n+                    _ignite,\n+                    ctx.Socket)\n+            );\n+\n+            _currentTx.Value = tx;\n+            return _currentTx.Value;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "bf214c04a56d730b31cb7e1c84068c123e8dc525"}, "originalPosition": 150}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjg0OTcyMTM1OnYy", "diffSide": "RIGHT", "path": "modules/platforms/dotnet/Apache.Ignite.Core/Impl/Client/Transactions/TransactionsClient.cs", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xOFQxNjowNDoxMlrOGzpEOg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xOFQxNjowNDoxMlrOGzpEOg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NjgwMzM4Ng==", "bodyText": "I think it will be simpler to incorporate label into the TransactionsClient class.", "url": "https://github.com/apache/ignite/pull/7992#discussion_r456803386", "createdAt": "2020-07-18T16:04:12Z", "author": {"login": "ptupitsyn"}, "path": "modules/platforms/dotnet/Apache.Ignite.Core/Impl/Client/Transactions/TransactionsClient.cs", "diffHunk": "@@ -0,0 +1,249 @@\n+/*\n+ * Licensed to the Apache Software Foundation (ASF) under one or more\n+ * contributor license agreements.  See the NOTICE file distributed with\n+ * this work for additional information regarding copyright ownership.\n+ * The ASF licenses this file to You under the Apache License, Version 2.0\n+ * (the \"License\"); you may not use this file except in compliance with\n+ * the License.  You may obtain a copy of the License at\n+ *\n+ *      http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+namespace Apache.Ignite.Core.Impl.Client.Transactions\n+{\n+    using System;\n+    using System.Diagnostics;\n+    using System.Diagnostics.CodeAnalysis;\n+    using System.Threading;\n+    using Apache.Ignite.Core.Client;\n+    using Apache.Ignite.Core.Client.Transactions;\n+    using Apache.Ignite.Core.Impl.Binary;\n+    using Apache.Ignite.Core.Impl.Common;\n+    using Apache.Ignite.Core.Transactions;\n+\n+    /// <summary>\n+    /// Ignite Thin Client transactions facade.\n+    /// </summary>\n+    internal class TransactionsClient : ITransactionsClientInternal, IDisposable\n+    {\n+        /** Ignite. */\n+        private readonly IgniteClient _ignite;\n+\n+        /** Default transaction configuration. */\n+        private readonly TransactionClientConfiguration _cfg;\n+\n+        /** Transaction for this thread and client. */\n+        private readonly ThreadLocal<TransactionClient> _currentTx = new ThreadLocal<TransactionClient>();\n+\n+        /** Transaction manager. */\n+        private readonly ClientCacheTransactionManager _txManager;\n+\n+        /// <summary>\n+        /// Constructor.\n+        /// </summary>\n+        /// <param name=\"ignite\">Ignite.</param>\n+        /// <param name=\"cfg\"></param>\n+        public TransactionsClient(IgniteClient ignite, TransactionClientConfiguration cfg)\n+        {\n+            _ignite = ignite;\n+            _cfg = cfg ?? new TransactionClientConfiguration();\n+            _txManager = new ClientCacheTransactionManager(this);\n+        }\n+\n+        /** <inheritdoc /> */\n+        public ITransactionClientInternal CurrentTx\n+        {\n+            get\n+            {\n+                var tx = _currentTx.Value;\n+\n+                if (tx == null)\n+                    return null;\n+\n+                if (tx.Closed)\n+                {\n+                    _currentTx.Value = null;\n+\n+                    return null;\n+                }\n+\n+                return tx;\n+            }\n+        }\n+\n+        /** <inheritDoc /> */\n+        public void StartTxIfNeeded()\n+        {\n+            _txManager.StartTxIfNeeded();\n+        }\n+\n+        /** <inheritDoc /> */\n+        public TransactionConcurrency DefaultTxConcurrency\n+        {\n+            get { return _cfg.DefaultTransactionConcurrency; }\n+        }\n+\n+        /** <inheritDoc /> */\n+        public TransactionIsolation DefaultTxIsolation\n+        {\n+            get { return _cfg.DefaultTransactionIsolation; }\n+        }\n+\n+        /** <inheritDoc /> */\n+        public TimeSpan DefaultTimeout\n+        {\n+            get { return _cfg.DefaultTimeout; }\n+        }\n+\n+        /** <inheritDoc /> */\n+        public ITransactionClient TxStart()\n+        {\n+            return TxStart(_cfg.DefaultTransactionConcurrency, _cfg.DefaultTransactionIsolation);\n+        }\n+\n+        /** <inheritDoc /> */\n+        public ITransactionClient TxStart(TransactionConcurrency concurrency, TransactionIsolation isolation)\n+        {\n+            return TxStart(concurrency, isolation, _cfg.DefaultTimeout);\n+        }\n+\n+        /** <inheritDoc /> */\n+        public ITransactionClient TxStart(TransactionConcurrency concurrency, \n+            TransactionIsolation isolation,\n+            TimeSpan timeout)\n+        {\n+            return TxStart(concurrency, isolation, timeout, null);\n+        }\n+\n+        private ITransactionClient TxStart(TransactionConcurrency concurrency,\n+            TransactionIsolation isolation,\n+            TimeSpan timeout,\n+            string label)\n+        {\n+            if (CurrentTx != null)\n+            {\n+                throw new IgniteClientException(\"A transaction has already been started by the current thread.\");\n+            }\n+\n+            var tx = _ignite.Socket.DoOutInOp(\n+                ClientOp.TxStart,\n+                ctx =>\n+                {\n+                    ctx.Writer.WriteByte((byte) concurrency);\n+                    ctx.Writer.WriteByte((byte) isolation);\n+                    ctx.Writer.WriteTimeSpanAsLong(timeout);\n+                    ctx.Writer.WriteString(label);\n+                },\n+                ctx => new TransactionClient(\n+                    ctx.Reader.ReadInt(),\n+                    _ignite,\n+                    ctx.Socket)\n+            );\n+\n+            _currentTx.Value = tx;\n+            return _currentTx.Value;\n+        }\n+\n+        /** <inheritDoc /> */\n+        public ITransactionsClient WithLabel(string label)\n+        {\n+            IgniteArgumentCheck.NotNullOrEmpty(label, \"label\");\n+\n+            return new TransactionsClientWithLabel(this, label); \n+        }\n+\n+        /** <inheritDoc /> */\n+        [SuppressMessage(\"Microsoft.Usage\",\n+            \"CA1816:CallGCSuppressFinalizeCorrectly\",\n+            Justification = \"There is no finalizer.\")]\n+        public void Dispose()\n+        {\n+            _currentTx.Dispose();\n+            _txManager.Dispose();\n+        }\n+\n+        /// <summary>\n+        /// Wrapper for transactions with label.\n+        /// </summary>\n+        private class TransactionsClientWithLabel : ITransactionsClientInternal", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "bf214c04a56d730b31cb7e1c84068c123e8dc525"}, "originalPosition": 174}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjg1OTc3NDE4OnYy", "diffSide": "RIGHT", "path": "modules/platforms/dotnet/Apache.Ignite.Core/Impl/Client/Transactions/ITransactionClientInternal.cs", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yMVQxNzo0MDo0NFrOG1C40w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yMVQxNzo0MDo0NFrOG1C40w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1ODI3NTAyNw==", "bodyText": "Looks like we don't really need this interface and the one below, since they have only one implementation.", "url": "https://github.com/apache/ignite/pull/7992#discussion_r458275027", "createdAt": "2020-07-21T17:40:44Z", "author": {"login": "ptupitsyn"}, "path": "modules/platforms/dotnet/Apache.Ignite.Core/Impl/Client/Transactions/ITransactionClientInternal.cs", "diffHunk": "@@ -0,0 +1,37 @@\n+/*\n+ * Licensed to the Apache Software Foundation (ASF) under one or more\n+ * contributor license agreements.  See the NOTICE file distributed with\n+ * this work for additional information regarding copyright ownership.\n+ * The ASF licenses this file to You under the Apache License, Version 2.0\n+ * (the \"License\"); you may not use this file except in compliance with\n+ * the License.  You may obtain a copy of the License at\n+ *\n+ *      http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+namespace Apache.Ignite.Core.Impl.Client.Transactions\n+{\n+    using Apache.Ignite.Core.Client.Transactions;\n+\n+    /// <summary>\n+    /// Internal Ignite Thin Client transaction facade.\n+    /// </summary>\n+    internal interface ITransactionClientInternal : ITransactionClient", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "3f2c89bd507115ef6a44f50c2eb92511b0b2f21c"}, "originalPosition": 25}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjg1OTc4NDQzOnYy", "diffSide": "RIGHT", "path": "modules/platforms/dotnet/Apache.Ignite.Core/Client/Transactions/ITransactionClient.cs", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yMVQxNzo0MzoyMVrOG1C_Qg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yMVQxNzo0MzoyMVrOG1C_Qg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1ODI3NjY3NA==", "bodyText": "Can we add tx properties here?\n\nIsolation\nConcurrency\nTimeout\nLabel", "url": "https://github.com/apache/ignite/pull/7992#discussion_r458276674", "createdAt": "2020-07-21T17:43:21Z", "author": {"login": "ptupitsyn"}, "path": "modules/platforms/dotnet/Apache.Ignite.Core/Client/Transactions/ITransactionClient.cs", "diffHunk": "@@ -0,0 +1,37 @@\n+/*\n+ * Licensed to the Apache Software Foundation (ASF) under one or more\n+ * contributor license agreements.  See the NOTICE file distributed with\n+ * this work for additional information regarding copyright ownership.\n+ * The ASF licenses this file to You under the Apache License, Version 2.0\n+ * (the \"License\"); you may not use this file except in compliance with\n+ * the License.  You may obtain a copy of the License at\n+ *\n+ *      http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+namespace Apache.Ignite.Core.Client.Transactions\n+{\n+    using System;\n+\n+    /// <summary>\n+    /// Thin client transaction.\n+    /// </summary>\n+    public interface ITransactionClient : IDisposable", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "3f2c89bd507115ef6a44f50c2eb92511b0b2f21c"}, "originalPosition": 25}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjg1OTc5MTcxOnYy", "diffSide": "RIGHT", "path": "modules/platforms/dotnet/Apache.Ignite.Core/Client/Transactions/ITransactionsClient.cs", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yMVQxNzo0NToxMVrOG1DD5g==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yMVQxNzo0NToxMVrOG1DD5g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1ODI3Nzg2Mg==", "bodyText": "Please add properties:\n\nTx\nDefaultTransactionConcurrency\nDefaultTransactionIsolation\nDefaultTimeout", "url": "https://github.com/apache/ignite/pull/7992#discussion_r458277862", "createdAt": "2020-07-21T17:45:11Z", "author": {"login": "ptupitsyn"}, "path": "modules/platforms/dotnet/Apache.Ignite.Core/Client/Transactions/ITransactionsClient.cs", "diffHunk": "@@ -0,0 +1,70 @@\n+/*\n+ * Licensed to the Apache Software Foundation (ASF) under one or more\n+ * contributor license agreements.  See the NOTICE file distributed with\n+ * this work for additional information regarding copyright ownership.\n+ * The ASF licenses this file to You under the Apache License, Version 2.0\n+ * (the \"License\"); you may not use this file except in compliance with\n+ * the License.  You may obtain a copy of the License at\n+ *\n+ *      http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+namespace Apache.Ignite.Core.Client.Transactions\n+{\n+    using System;\n+    using Apache.Ignite.Core.Transactions;\n+\n+    /// <summary>\n+    /// Ignite Thin Client transactions facade.\n+    /// <para /> Transactions are bound to the thread started the transaction. After that, each cache operation within this thread\n+    /// will belong to the corresponding transaction until the transaction is committed, rolled back or closed.\n+    /// <para /> Should not be used with async calls.\n+    /// </summary> \n+    public interface ITransactionsClient", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "3f2c89bd507115ef6a44f50c2eb92511b0b2f21c"}, "originalPosition": 29}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjg1OTc5NTU0OnYy", "diffSide": "RIGHT", "path": "modules/platforms/dotnet/Apache.Ignite.Core/Client/Transactions/TransactionClientConfiguration.cs", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yMVQxNzo0NjowOVrOG1DGUg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yMVQxNzo0NjowOVrOG1DGUg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1ODI3ODQ4Mg==", "bodyText": "Missing space after =", "url": "https://github.com/apache/ignite/pull/7992#discussion_r458278482", "createdAt": "2020-07-21T17:46:09Z", "author": {"login": "ptupitsyn"}, "path": "modules/platforms/dotnet/Apache.Ignite.Core/Client/Transactions/TransactionClientConfiguration.cs", "diffHunk": "@@ -0,0 +1,81 @@\n+\ufeff/*\n+ * Licensed to the Apache Software Foundation (ASF) under one or more\n+ * contributor license agreements.  See the NOTICE file distributed with\n+ * this work for additional information regarding copyright ownership.\n+ * The ASF licenses this file to You under the Apache License, Version 2.0\n+ * (the \"License\"); you may not use this file except in compliance with\n+ * the License.  You may obtain a copy of the License at\n+ *\n+ *      http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+namespace Apache.Ignite.Core.Client.Transactions\n+{\n+    using System;\n+    using System.ComponentModel;\n+    using Apache.Ignite.Core.Impl.Common;\n+    using Apache.Ignite.Core.Transactions;\n+\n+    /// <summary>\n+    /// Transactions configuration.\n+    /// </summary>\n+    public class TransactionClientConfiguration\n+    {\n+        /// <summary> The default value for <see cref=\"DefaultTransactionConcurrency\"/> property. </summary>\n+        public const TransactionConcurrency DefaultDefaultTransactionConcurrency = TransactionConcurrency.Pessimistic;\n+\n+        /// <summary> The default value for <see cref=\"DefaultTransactionIsolation\"/> property. </summary>\n+        public const TransactionIsolation DefaultDefaultTransactionIsolation = TransactionIsolation.RepeatableRead;\n+\n+        /// <summary> The default value for <see cref=\"DefaultTransactionIsolation\"/> property. </summary>\n+        public static readonly TimeSpan DefaultDefaultTimeout = TimeSpan.Zero;\n+\n+        /// <summary>\n+        /// Gets or sets the cache transaction concurrency to use when one is not explicitly specified.\n+        /// </summary>\n+        [DefaultValue(DefaultDefaultTransactionConcurrency)]\n+        public TransactionConcurrency DefaultTransactionConcurrency { get; set; }\n+\n+        /// <summary>\n+        /// Gets or sets the cache transaction isolation to use when one is not explicitly specified.\n+        /// </summary>\n+        [DefaultValue(DefaultDefaultTransactionIsolation)]\n+        public TransactionIsolation DefaultTransactionIsolation { get; set; }\n+\n+        /// <summary>\n+        /// Gets or sets the cache transaction timeout to use when one is not explicitly specified.\n+        /// <see cref=\"TimeSpan.Zero\"/> for infinite timeout.\n+        /// </summary>\n+        [DefaultValue(typeof(TimeSpan), \"00:00:00\")]\n+        public TimeSpan DefaultTimeout { get; set; }\n+\n+        /// <summary>\n+        /// Initializes a new instance of the <see cref=\"TransactionClientConfiguration\" /> class.\n+        /// </summary>\n+        public TransactionClientConfiguration()\n+        {\n+            DefaultTransactionConcurrency = DefaultDefaultTransactionConcurrency;\n+            DefaultTransactionIsolation = DefaultDefaultTransactionIsolation;\n+            DefaultTimeout = DefaultDefaultTimeout;\n+        }\n+        \n+        /// <summary>\n+        /// Initializes a new instance of the <see cref=\"TransactionClientConfiguration\" /> class.\n+        /// </summary>\n+        /// <param name=\"cfg\">The configuration to copy.</param>\n+        public TransactionClientConfiguration(TransactionClientConfiguration cfg)\n+        {\n+            IgniteArgumentCheck.NotNull(cfg, \"configuration\");\n+\n+            DefaultTransactionConcurrency = cfg.DefaultTransactionConcurrency;\n+            DefaultTransactionIsolation = cfg.DefaultTransactionIsolation;\n+            DefaultTimeout =cfg.DefaultTimeout;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "3f2c89bd507115ef6a44f50c2eb92511b0b2f21c"}, "originalPosition": 78}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjg1OTgwNjMyOnYy", "diffSide": "RIGHT", "path": "modules/platforms/dotnet/Apache.Ignite.Core/Client/Transactions/TransactionClientConfiguration.cs", "isResolved": true, "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yMVQxNzo0ODo1OVrOG1DNPQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yN1QxODo0MToyM1rOG3u5QQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1ODI4MDI1Mw==", "bodyText": "Please add simple tests for both constructors (check that properties are set as expected)\nAdd tests for custom values - use newly added properties in ITransactionClient and ITransactionsClient to make sure that custom defaults are used", "url": "https://github.com/apache/ignite/pull/7992#discussion_r458280253", "createdAt": "2020-07-21T17:48:59Z", "author": {"login": "ptupitsyn"}, "path": "modules/platforms/dotnet/Apache.Ignite.Core/Client/Transactions/TransactionClientConfiguration.cs", "diffHunk": "@@ -0,0 +1,81 @@\n+\ufeff/*\n+ * Licensed to the Apache Software Foundation (ASF) under one or more\n+ * contributor license agreements.  See the NOTICE file distributed with\n+ * this work for additional information regarding copyright ownership.\n+ * The ASF licenses this file to You under the Apache License, Version 2.0\n+ * (the \"License\"); you may not use this file except in compliance with\n+ * the License.  You may obtain a copy of the License at\n+ *\n+ *      http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+namespace Apache.Ignite.Core.Client.Transactions\n+{\n+    using System;\n+    using System.ComponentModel;\n+    using Apache.Ignite.Core.Impl.Common;\n+    using Apache.Ignite.Core.Transactions;\n+\n+    /// <summary>\n+    /// Transactions configuration.\n+    /// </summary>\n+    public class TransactionClientConfiguration\n+    {\n+        /// <summary> The default value for <see cref=\"DefaultTransactionConcurrency\"/> property. </summary>\n+        public const TransactionConcurrency DefaultDefaultTransactionConcurrency = TransactionConcurrency.Pessimistic;\n+\n+        /// <summary> The default value for <see cref=\"DefaultTransactionIsolation\"/> property. </summary>\n+        public const TransactionIsolation DefaultDefaultTransactionIsolation = TransactionIsolation.RepeatableRead;\n+\n+        /// <summary> The default value for <see cref=\"DefaultTransactionIsolation\"/> property. </summary>\n+        public static readonly TimeSpan DefaultDefaultTimeout = TimeSpan.Zero;\n+\n+        /// <summary>\n+        /// Gets or sets the cache transaction concurrency to use when one is not explicitly specified.\n+        /// </summary>\n+        [DefaultValue(DefaultDefaultTransactionConcurrency)]\n+        public TransactionConcurrency DefaultTransactionConcurrency { get; set; }\n+\n+        /// <summary>\n+        /// Gets or sets the cache transaction isolation to use when one is not explicitly specified.\n+        /// </summary>\n+        [DefaultValue(DefaultDefaultTransactionIsolation)]\n+        public TransactionIsolation DefaultTransactionIsolation { get; set; }\n+\n+        /// <summary>\n+        /// Gets or sets the cache transaction timeout to use when one is not explicitly specified.\n+        /// <see cref=\"TimeSpan.Zero\"/> for infinite timeout.\n+        /// </summary>\n+        [DefaultValue(typeof(TimeSpan), \"00:00:00\")]\n+        public TimeSpan DefaultTimeout { get; set; }\n+\n+        /// <summary>\n+        /// Initializes a new instance of the <see cref=\"TransactionClientConfiguration\" /> class.\n+        /// </summary>\n+        public TransactionClientConfiguration()", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "3f2c89bd507115ef6a44f50c2eb92511b0b2f21c"}, "originalPosition": 61}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1ODQwMDQ1MA==", "bodyText": "There are already tests for it - IgniteConfigurationTest.TestDefaultValueAttributes:103 for default ctor And IgniteClientConfigurationTest.TestTransactionConfigurationCopyCtor for copy one.\nCacheClientAbstractTxTest.TestClientTransactionConfiguration and TestTxStartPassesParameters would not be sufficient?", "url": "https://github.com/apache/ignite/pull/7992#discussion_r458400450", "createdAt": "2020-07-21T21:31:36Z", "author": {"login": "gurustron"}, "path": "modules/platforms/dotnet/Apache.Ignite.Core/Client/Transactions/TransactionClientConfiguration.cs", "diffHunk": "@@ -0,0 +1,81 @@\n+\ufeff/*\n+ * Licensed to the Apache Software Foundation (ASF) under one or more\n+ * contributor license agreements.  See the NOTICE file distributed with\n+ * this work for additional information regarding copyright ownership.\n+ * The ASF licenses this file to You under the Apache License, Version 2.0\n+ * (the \"License\"); you may not use this file except in compliance with\n+ * the License.  You may obtain a copy of the License at\n+ *\n+ *      http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+namespace Apache.Ignite.Core.Client.Transactions\n+{\n+    using System;\n+    using System.ComponentModel;\n+    using Apache.Ignite.Core.Impl.Common;\n+    using Apache.Ignite.Core.Transactions;\n+\n+    /// <summary>\n+    /// Transactions configuration.\n+    /// </summary>\n+    public class TransactionClientConfiguration\n+    {\n+        /// <summary> The default value for <see cref=\"DefaultTransactionConcurrency\"/> property. </summary>\n+        public const TransactionConcurrency DefaultDefaultTransactionConcurrency = TransactionConcurrency.Pessimistic;\n+\n+        /// <summary> The default value for <see cref=\"DefaultTransactionIsolation\"/> property. </summary>\n+        public const TransactionIsolation DefaultDefaultTransactionIsolation = TransactionIsolation.RepeatableRead;\n+\n+        /// <summary> The default value for <see cref=\"DefaultTransactionIsolation\"/> property. </summary>\n+        public static readonly TimeSpan DefaultDefaultTimeout = TimeSpan.Zero;\n+\n+        /// <summary>\n+        /// Gets or sets the cache transaction concurrency to use when one is not explicitly specified.\n+        /// </summary>\n+        [DefaultValue(DefaultDefaultTransactionConcurrency)]\n+        public TransactionConcurrency DefaultTransactionConcurrency { get; set; }\n+\n+        /// <summary>\n+        /// Gets or sets the cache transaction isolation to use when one is not explicitly specified.\n+        /// </summary>\n+        [DefaultValue(DefaultDefaultTransactionIsolation)]\n+        public TransactionIsolation DefaultTransactionIsolation { get; set; }\n+\n+        /// <summary>\n+        /// Gets or sets the cache transaction timeout to use when one is not explicitly specified.\n+        /// <see cref=\"TimeSpan.Zero\"/> for infinite timeout.\n+        /// </summary>\n+        [DefaultValue(typeof(TimeSpan), \"00:00:00\")]\n+        public TimeSpan DefaultTimeout { get; set; }\n+\n+        /// <summary>\n+        /// Initializes a new instance of the <see cref=\"TransactionClientConfiguration\" /> class.\n+        /// </summary>\n+        public TransactionClientConfiguration()", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1ODI4MDI1Mw=="}, "originalCommit": {"oid": "3f2c89bd507115ef6a44f50c2eb92511b0b2f21c"}, "originalPosition": 61}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MTA5MzE4NQ==", "bodyText": "Yep that looks good, thanks.", "url": "https://github.com/apache/ignite/pull/7992#discussion_r461093185", "createdAt": "2020-07-27T18:41:23Z", "author": {"login": "ptupitsyn"}, "path": "modules/platforms/dotnet/Apache.Ignite.Core/Client/Transactions/TransactionClientConfiguration.cs", "diffHunk": "@@ -0,0 +1,81 @@\n+\ufeff/*\n+ * Licensed to the Apache Software Foundation (ASF) under one or more\n+ * contributor license agreements.  See the NOTICE file distributed with\n+ * this work for additional information regarding copyright ownership.\n+ * The ASF licenses this file to You under the Apache License, Version 2.0\n+ * (the \"License\"); you may not use this file except in compliance with\n+ * the License.  You may obtain a copy of the License at\n+ *\n+ *      http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+namespace Apache.Ignite.Core.Client.Transactions\n+{\n+    using System;\n+    using System.ComponentModel;\n+    using Apache.Ignite.Core.Impl.Common;\n+    using Apache.Ignite.Core.Transactions;\n+\n+    /// <summary>\n+    /// Transactions configuration.\n+    /// </summary>\n+    public class TransactionClientConfiguration\n+    {\n+        /// <summary> The default value for <see cref=\"DefaultTransactionConcurrency\"/> property. </summary>\n+        public const TransactionConcurrency DefaultDefaultTransactionConcurrency = TransactionConcurrency.Pessimistic;\n+\n+        /// <summary> The default value for <see cref=\"DefaultTransactionIsolation\"/> property. </summary>\n+        public const TransactionIsolation DefaultDefaultTransactionIsolation = TransactionIsolation.RepeatableRead;\n+\n+        /// <summary> The default value for <see cref=\"DefaultTransactionIsolation\"/> property. </summary>\n+        public static readonly TimeSpan DefaultDefaultTimeout = TimeSpan.Zero;\n+\n+        /// <summary>\n+        /// Gets or sets the cache transaction concurrency to use when one is not explicitly specified.\n+        /// </summary>\n+        [DefaultValue(DefaultDefaultTransactionConcurrency)]\n+        public TransactionConcurrency DefaultTransactionConcurrency { get; set; }\n+\n+        /// <summary>\n+        /// Gets or sets the cache transaction isolation to use when one is not explicitly specified.\n+        /// </summary>\n+        [DefaultValue(DefaultDefaultTransactionIsolation)]\n+        public TransactionIsolation DefaultTransactionIsolation { get; set; }\n+\n+        /// <summary>\n+        /// Gets or sets the cache transaction timeout to use when one is not explicitly specified.\n+        /// <see cref=\"TimeSpan.Zero\"/> for infinite timeout.\n+        /// </summary>\n+        [DefaultValue(typeof(TimeSpan), \"00:00:00\")]\n+        public TimeSpan DefaultTimeout { get; set; }\n+\n+        /// <summary>\n+        /// Initializes a new instance of the <see cref=\"TransactionClientConfiguration\" /> class.\n+        /// </summary>\n+        public TransactionClientConfiguration()", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1ODI4MDI1Mw=="}, "originalCommit": {"oid": "3f2c89bd507115ef6a44f50c2eb92511b0b2f21c"}, "originalPosition": 61}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjg1OTg1MzA4OnYy", "diffSide": "RIGHT", "path": "modules/platforms/dotnet/Apache.Ignite.Core/Impl/Client/Transactions/TransactionsClient.cs", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yMVQxODowMTozMlrOG1Drbg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yMVQxODowMTozMlrOG1Drbg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1ODI4Nzk4Mg==", "bodyText": "XMLDoc", "url": "https://github.com/apache/ignite/pull/7992#discussion_r458287982", "createdAt": "2020-07-21T18:01:32Z", "author": {"login": "ptupitsyn"}, "path": "modules/platforms/dotnet/Apache.Ignite.Core/Impl/Client/Transactions/TransactionsClient.cs", "diffHunk": "@@ -0,0 +1,249 @@\n+/*\n+ * Licensed to the Apache Software Foundation (ASF) under one or more\n+ * contributor license agreements.  See the NOTICE file distributed with\n+ * this work for additional information regarding copyright ownership.\n+ * The ASF licenses this file to You under the Apache License, Version 2.0\n+ * (the \"License\"); you may not use this file except in compliance with\n+ * the License.  You may obtain a copy of the License at\n+ *\n+ *      http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+namespace Apache.Ignite.Core.Impl.Client.Transactions\n+{\n+    using System;\n+    using System.Diagnostics;\n+    using System.Diagnostics.CodeAnalysis;\n+    using System.Threading;\n+    using Apache.Ignite.Core.Client;\n+    using Apache.Ignite.Core.Client.Transactions;\n+    using Apache.Ignite.Core.Impl.Binary;\n+    using Apache.Ignite.Core.Impl.Common;\n+    using Apache.Ignite.Core.Transactions;\n+\n+    /// <summary>\n+    /// Ignite Thin Client transactions facade.\n+    /// </summary>\n+    internal class TransactionsClient : ITransactionsClientInternal, IDisposable\n+    {\n+        /** Ignite. */\n+        private readonly IgniteClient _ignite;\n+\n+        /** Default transaction configuration. */\n+        private readonly TransactionClientConfiguration _cfg;\n+\n+        /** Transaction for this thread and client. */\n+        private readonly ThreadLocal<TransactionClient> _currentTx = new ThreadLocal<TransactionClient>();\n+\n+        /** Transaction manager. */\n+        private readonly ClientCacheTransactionManager _txManager;\n+\n+        /// <summary>\n+        /// Constructor.\n+        /// </summary>\n+        /// <param name=\"ignite\">Ignite.</param>\n+        /// <param name=\"cfg\"></param>\n+        public TransactionsClient(IgniteClient ignite, TransactionClientConfiguration cfg)\n+        {\n+            _ignite = ignite;\n+            _cfg = cfg ?? new TransactionClientConfiguration();\n+            _txManager = new ClientCacheTransactionManager(this);\n+        }\n+\n+        /** <inheritdoc /> */\n+        public ITransactionClientInternal CurrentTx\n+        {\n+            get\n+            {\n+                var tx = _currentTx.Value;\n+\n+                if (tx == null)\n+                    return null;\n+\n+                if (tx.Closed)\n+                {\n+                    _currentTx.Value = null;\n+\n+                    return null;\n+                }\n+\n+                return tx;\n+            }\n+        }\n+\n+        /** <inheritDoc /> */\n+        public void StartTxIfNeeded()\n+        {\n+            _txManager.StartTxIfNeeded();\n+        }\n+\n+        /** <inheritDoc /> */\n+        public TransactionConcurrency DefaultTxConcurrency\n+        {\n+            get { return _cfg.DefaultTransactionConcurrency; }\n+        }\n+\n+        /** <inheritDoc /> */\n+        public TransactionIsolation DefaultTxIsolation\n+        {\n+            get { return _cfg.DefaultTransactionIsolation; }\n+        }\n+\n+        /** <inheritDoc /> */\n+        public TimeSpan DefaultTimeout\n+        {\n+            get { return _cfg.DefaultTimeout; }\n+        }\n+\n+        /** <inheritDoc /> */\n+        public ITransactionClient TxStart()\n+        {\n+            return TxStart(_cfg.DefaultTransactionConcurrency, _cfg.DefaultTransactionIsolation);\n+        }\n+\n+        /** <inheritDoc /> */\n+        public ITransactionClient TxStart(TransactionConcurrency concurrency, TransactionIsolation isolation)\n+        {\n+            return TxStart(concurrency, isolation, _cfg.DefaultTimeout);\n+        }\n+\n+        /** <inheritDoc /> */\n+        public ITransactionClient TxStart(TransactionConcurrency concurrency, \n+            TransactionIsolation isolation,\n+            TimeSpan timeout)\n+        {\n+            return TxStart(concurrency, isolation, timeout, null);\n+        }\n+\n+        private ITransactionClient TxStart(TransactionConcurrency concurrency,", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "3f2c89bd507115ef6a44f50c2eb92511b0b2f21c"}, "originalPosition": 124}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjg1OTg2MjcyOnYy", "diffSide": "RIGHT", "path": "modules/platforms/dotnet/Apache.Ignite.Core.Tests/Client/Cache/CachePartitionedTxTest.cs", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yMVQxODowNDoyMFrOG1Dxug==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yMVQxODowNDoyMFrOG1Dxug==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1ODI4OTU5NA==", "bodyText": "inheritdoc", "url": "https://github.com/apache/ignite/pull/7992#discussion_r458289594", "createdAt": "2020-07-21T18:04:20Z", "author": {"login": "ptupitsyn"}, "path": "modules/platforms/dotnet/Apache.Ignite.Core.Tests/Client/Cache/CachePartitionedTxTest.cs", "diffHunk": "@@ -0,0 +1,101 @@\n+/*\n+ * Licensed to the Apache Software Foundation (ASF) under one or more\n+ * contributor license agreements.  See the NOTICE file distributed with\n+ * this work for additional information regarding copyright ownership.\n+ * The ASF licenses this file to You under the Apache License, Version 2.0\n+ * (the \"License\"); you may not use this file except in compliance with\n+ * the License.  You may obtain a copy of the License at\n+ *\n+ *      http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+namespace Apache.Ignite.Core.Tests.Client.Cache\n+{\n+    using System.Linq;\n+    using System.Transactions;\n+    using Apache.Ignite.Core.Client;\n+    using Apache.Ignite.Core.Impl.Client.Transactions;\n+    using NUnit.Framework;\n+    using NUnit.Framework.Constraints;\n+\n+    /// <summary>\n+    /// Tests client transactions for multiple nodes with partition awareness.\n+    /// </summary>\n+    public class CachePartitionedTxTest : CacheClientAbstractTxTest\n+    {\n+        /// <summary>\n+        ///  Initializes a new instance of the <see cref=\"CachePartitionedTxTest\"/> class.\n+        /// </summary>\n+        public CachePartitionedTxTest() : base(3, true)\n+        {\n+            // No-op.\n+        }\n+\n+        /// <summary>\n+        /// Test transaction for partition aware client. \n+        /// </summary>\n+        [Test]\n+        public void TestTxPartitioned()\n+        {\n+            var cache = GetTransactionalCache();\n+            var ignite1 = GetIgnite();\n+            var ignite2 = GetIgnite(1);\n+            var key1 = TestUtils.GetPrimaryKey(ignite1, GetCacheName());\n+            var key2 = TestUtils.GetPrimaryKey(ignite2, GetCacheName());\n+\n+            cache.Put(key1, 1);\n+            cache.Put(key2, 2);\n+\n+            using (Client.GetTransactions().TxStart())\n+            {\n+                cache.Put(key1, 10);\n+                cache.Put(key2, 20);\n+\n+                Assert.AreEqual(10, cache.Get(key1));\n+                Assert.AreEqual(20, cache.Get(key2));\n+            }\n+\n+            Assert.AreEqual(1, cache.Get(key1));\n+            Assert.AreEqual(2, cache.Get(key2));\n+        }\n+        \n+        /// <summary>\n+        /// Test transaction scope for partition aware client. \n+        /// </summary>\n+        [Test]\n+        public void TestTransactionScopePartitioned()\n+        {\n+            var cache = GetTransactionalCache();\n+            var ignite1 = GetIgnite();\n+            var ignite2 = GetIgnite(1);\n+            var key1 = TestUtils.GetPrimaryKey(ignite1, GetCacheName());\n+            var key2 = TestUtils.GetPrimaryKey(ignite2, GetCacheName());\n+\n+            cache.Put(key1, 1);\n+            cache.Put(key2, 2);\n+\n+            using (new TransactionScope())\n+            {\n+                cache.Put(key1, 10);\n+                cache.Put(key2, 20);\n+\n+                Assert.AreEqual(10, cache.Get(key1));\n+                Assert.AreEqual(20, cache.Get(key2));\n+            }\n+\n+            Assert.AreEqual(1, cache.Get(key1));\n+            Assert.AreEqual(2, cache.Get(key2));\n+        }\n+\n+        protected override string GetCacheName()", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "3f2c89bd507115ef6a44f50c2eb92511b0b2f21c"}, "originalPosition": 96}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjg3Nzk3NzIwOnYy", "diffSide": "RIGHT", "path": "modules/platforms/dotnet/Apache.Ignite.Core/Client/Transactions/ITransactionClient.cs", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yN1QxNjozMjoyNlrOG3qS1Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0wMlQxMTo1NTo1OVrOG6kfEA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MTAxNzgxMw==", "bodyText": "Missing XMLDoc", "url": "https://github.com/apache/ignite/pull/7992#discussion_r461017813", "createdAt": "2020-07-27T16:32:26Z", "author": {"login": "ptupitsyn"}, "path": "modules/platforms/dotnet/Apache.Ignite.Core/Client/Transactions/ITransactionClient.cs", "diffHunk": "@@ -0,0 +1,46 @@\n+/*\n+ * Licensed to the Apache Software Foundation (ASF) under one or more\n+ * contributor license agreements.  See the NOTICE file distributed with\n+ * this work for additional information regarding copyright ownership.\n+ * The ASF licenses this file to You under the Apache License, Version 2.0\n+ * (the \"License\"); you may not use this file except in compliance with\n+ * the License.  You may obtain a copy of the License at\n+ *\n+ *      http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+namespace Apache.Ignite.Core.Client.Transactions\n+{\n+    using System;\n+    using Apache.Ignite.Core.Transactions;\n+\n+    /// <summary>\n+    /// Thin client transaction.\n+    /// </summary>\n+    public interface ITransactionClient : IDisposable\n+    {\n+        /// <summary>\n+        /// Commits this transaction.\n+        /// </summary>\n+        void Commit();\n+\n+        /// <summary>\n+        /// Rolls back this transaction.\n+        /// </summary>\n+        void Rollback();\n+        \n+        TransactionConcurrency Concurrency { get; } ", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "613be9da2ec34523f5f52ae994e8ad2a13aef55d"}, "originalPosition": 38}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NDA2ODM2OA==", "bodyText": "Fixed.", "url": "https://github.com/apache/ignite/pull/7992#discussion_r464068368", "createdAt": "2020-08-02T11:55:59Z", "author": {"login": "gurustron"}, "path": "modules/platforms/dotnet/Apache.Ignite.Core/Client/Transactions/ITransactionClient.cs", "diffHunk": "@@ -0,0 +1,46 @@\n+/*\n+ * Licensed to the Apache Software Foundation (ASF) under one or more\n+ * contributor license agreements.  See the NOTICE file distributed with\n+ * this work for additional information regarding copyright ownership.\n+ * The ASF licenses this file to You under the Apache License, Version 2.0\n+ * (the \"License\"); you may not use this file except in compliance with\n+ * the License.  You may obtain a copy of the License at\n+ *\n+ *      http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+namespace Apache.Ignite.Core.Client.Transactions\n+{\n+    using System;\n+    using Apache.Ignite.Core.Transactions;\n+\n+    /// <summary>\n+    /// Thin client transaction.\n+    /// </summary>\n+    public interface ITransactionClient : IDisposable\n+    {\n+        /// <summary>\n+        /// Commits this transaction.\n+        /// </summary>\n+        void Commit();\n+\n+        /// <summary>\n+        /// Rolls back this transaction.\n+        /// </summary>\n+        void Rollback();\n+        \n+        TransactionConcurrency Concurrency { get; } ", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MTAxNzgxMw=="}, "originalCommit": {"oid": "613be9da2ec34523f5f52ae994e8ad2a13aef55d"}, "originalPosition": 38}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjg3Nzk4MjYxOnYy", "diffSide": "RIGHT", "path": "modules/platforms/dotnet/Apache.Ignite.Core/Client/Transactions/ITransactionClient.cs", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yN1QxNjozMzo1MlrOG3qWTw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0wMlQxMTo1NjozMFrOG6kfNg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MTAxODcwMw==", "bodyText": "Please add a test for this property", "url": "https://github.com/apache/ignite/pull/7992#discussion_r461018703", "createdAt": "2020-07-27T16:33:52Z", "author": {"login": "ptupitsyn"}, "path": "modules/platforms/dotnet/Apache.Ignite.Core/Client/Transactions/ITransactionClient.cs", "diffHunk": "@@ -0,0 +1,46 @@\n+/*\n+ * Licensed to the Apache Software Foundation (ASF) under one or more\n+ * contributor license agreements.  See the NOTICE file distributed with\n+ * this work for additional information regarding copyright ownership.\n+ * The ASF licenses this file to You under the Apache License, Version 2.0\n+ * (the \"License\"); you may not use this file except in compliance with\n+ * the License.  You may obtain a copy of the License at\n+ *\n+ *      http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+namespace Apache.Ignite.Core.Client.Transactions\n+{\n+    using System;\n+    using Apache.Ignite.Core.Transactions;\n+\n+    /// <summary>\n+    /// Thin client transaction.\n+    /// </summary>\n+    public interface ITransactionClient : IDisposable\n+    {\n+        /// <summary>\n+        /// Commits this transaction.\n+        /// </summary>\n+        void Commit();\n+\n+        /// <summary>\n+        /// Rolls back this transaction.\n+        /// </summary>\n+        void Rollback();\n+        \n+        TransactionConcurrency Concurrency { get; } \n+        \n+        TransactionIsolation Isolation { get; }\n+\n+        TimeSpan Timeout { get; }\n+\n+        string Label { get; }", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "613be9da2ec34523f5f52ae994e8ad2a13aef55d"}, "originalPosition": 44}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NDA2ODQwNg==", "bodyText": "Added to TestWithLabel", "url": "https://github.com/apache/ignite/pull/7992#discussion_r464068406", "createdAt": "2020-08-02T11:56:30Z", "author": {"login": "gurustron"}, "path": "modules/platforms/dotnet/Apache.Ignite.Core/Client/Transactions/ITransactionClient.cs", "diffHunk": "@@ -0,0 +1,46 @@\n+/*\n+ * Licensed to the Apache Software Foundation (ASF) under one or more\n+ * contributor license agreements.  See the NOTICE file distributed with\n+ * this work for additional information regarding copyright ownership.\n+ * The ASF licenses this file to You under the Apache License, Version 2.0\n+ * (the \"License\"); you may not use this file except in compliance with\n+ * the License.  You may obtain a copy of the License at\n+ *\n+ *      http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+namespace Apache.Ignite.Core.Client.Transactions\n+{\n+    using System;\n+    using Apache.Ignite.Core.Transactions;\n+\n+    /// <summary>\n+    /// Thin client transaction.\n+    /// </summary>\n+    public interface ITransactionClient : IDisposable\n+    {\n+        /// <summary>\n+        /// Commits this transaction.\n+        /// </summary>\n+        void Commit();\n+\n+        /// <summary>\n+        /// Rolls back this transaction.\n+        /// </summary>\n+        void Rollback();\n+        \n+        TransactionConcurrency Concurrency { get; } \n+        \n+        TransactionIsolation Isolation { get; }\n+\n+        TimeSpan Timeout { get; }\n+\n+        string Label { get; }", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MTAxODcwMw=="}, "originalCommit": {"oid": "613be9da2ec34523f5f52ae994e8ad2a13aef55d"}, "originalPosition": 44}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjg3ODQ3Njk2OnYy", "diffSide": "RIGHT", "path": "modules/platforms/dotnet/Apache.Ignite.Core/Impl/Client/Transactions/TransactionClient.cs", "isResolved": true, "comments": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yN1QxODo0NzozM1rOG3vGmA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xN1QxNTo1MTo0NlrOHTpNBw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MTA5NjYwMA==", "bodyText": "_socket should be used instead of _ignite.Socket\nMake sure we do not throw exceptions from the finalizer and Dispose", "url": "https://github.com/apache/ignite/pull/7992#discussion_r461096600", "createdAt": "2020-07-27T18:47:33Z", "author": {"login": "ptupitsyn"}, "path": "modules/platforms/dotnet/Apache.Ignite.Core/Impl/Client/Transactions/TransactionClient.cs", "diffHunk": "@@ -0,0 +1,172 @@\n+/*\n+ * Licensed to the Apache Software Foundation (ASF) under one or more\n+ * contributor license agreements.  See the NOTICE file distributed with\n+ * this work for additional information regarding copyright ownership.\n+ * The ASF licenses this file to You under the Apache License, Version 2.0\n+ * (the \"License\"); you may not use this file except in compliance with\n+ * the License.  You may obtain a copy of the License at\n+ *\n+ *      http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+namespace Apache.Ignite.Core.Impl.Client.Transactions\n+{\n+    using System;\n+    using System.Globalization;\n+    using Apache.Ignite.Core.Client.Transactions;\n+    using Apache.Ignite.Core.Transactions;\n+\n+    /// <summary>\n+    /// Ignite Thin Client transaction facade.\n+    /// </summary>\n+    internal class TransactionClient : ITransactionClient\n+    {\n+        /** Unique  transaction ID.*/\n+        private readonly int _id;\n+\n+        /** Ignite. */\n+        private readonly IgniteClient _ignite;\n+\n+        /** Socket. */\n+        private readonly ClientSocket _socket;\n+\n+        /** Transaction is closed. */\n+        private bool _closed;\n+\n+        /// <summary>\n+        /// Constructor.\n+        /// </summary>\n+        /// <param name=\"id\">ID.</param>\n+        /// <param name=\"ignite\">Ignite.</param>\n+        /// <param name=\"socket\">Socket.</param>\n+        /// <param name=\"concurrency\">Concurrency.</param>\n+        /// <param name=\"isolation\">Isolation.</param>\n+        /// <param name=\"timeout\">Timeout.</param>\n+        /// <param name=\"label\">Label.</param>\n+        public TransactionClient(int id,\n+            IgniteClient ignite,\n+            ClientSocket socket,\n+            TransactionConcurrency concurrency,\n+            TransactionIsolation isolation,\n+            TimeSpan timeout,\n+            string label)\n+        {\n+            _id = id;\n+            _ignite = ignite;\n+            _socket = socket;\n+            Concurrency = concurrency;\n+            Isolation = isolation;\n+            Timeout = timeout;\n+            Label = label;\n+        }\n+\n+        /** <inheritdoc /> */\n+        public void Commit()\n+        {\n+            ThrowIfClosed();\n+            Close(true);\n+        }\n+\n+        /** <inheritdoc /> */\n+        public void Rollback()\n+        {\n+            ThrowIfClosed();\n+            Close(false);\n+        }\n+\n+        /** <inheritdoc /> */\n+        public TransactionConcurrency Concurrency { get; private set; }\n+\n+        /** <inheritdoc /> */\n+        public TransactionIsolation Isolation { get; private set; }\n+\n+        /** <inheritdoc /> */\n+        public TimeSpan Timeout { get; private set; }\n+\n+        /** <inheritdoc /> */\n+        public string Label { get; private set; }\n+\n+        /** <inheritdoc /> */\n+        public void Dispose()\n+        {\n+            try\n+            {\n+                Close(false);\n+            }\n+            finally\n+            {\n+                GC.SuppressFinalize(this);\n+            }\n+        }\n+\n+        /// <summary>\n+        /// Transaction Id.\n+        /// </summary>\n+        public int Id\n+        {\n+            get { return _id; }\n+        }\n+\n+        public ClientSocket Socket\n+        {\n+            get { return _socket; }\n+        }\n+\n+        /// <summary>\n+        /// Returns if transaction is closed.\n+        /// </summary>\n+        internal bool Closed\n+        {\n+            get { return _closed; }\n+        }\n+\n+        /// <summary>\n+        /// Closes the transaction. \n+        /// </summary>\n+        private void Close(bool commit)\n+        {\n+            if (!_closed)\n+            {\n+                try\n+                {\n+                    _ignite.Socket.DoOutInOp<object>(ClientOp.TxEnd,", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "613be9da2ec34523f5f52ae994e8ad2a13aef55d"}, "originalPosition": 138}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NDA2OTk2Ng==", "bodyText": "Fixed.\nWhat exceptions should we cover?", "url": "https://github.com/apache/ignite/pull/7992#discussion_r464069966", "createdAt": "2020-08-02T12:13:07Z", "author": {"login": "gurustron"}, "path": "modules/platforms/dotnet/Apache.Ignite.Core/Impl/Client/Transactions/TransactionClient.cs", "diffHunk": "@@ -0,0 +1,172 @@\n+/*\n+ * Licensed to the Apache Software Foundation (ASF) under one or more\n+ * contributor license agreements.  See the NOTICE file distributed with\n+ * this work for additional information regarding copyright ownership.\n+ * The ASF licenses this file to You under the Apache License, Version 2.0\n+ * (the \"License\"); you may not use this file except in compliance with\n+ * the License.  You may obtain a copy of the License at\n+ *\n+ *      http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+namespace Apache.Ignite.Core.Impl.Client.Transactions\n+{\n+    using System;\n+    using System.Globalization;\n+    using Apache.Ignite.Core.Client.Transactions;\n+    using Apache.Ignite.Core.Transactions;\n+\n+    /// <summary>\n+    /// Ignite Thin Client transaction facade.\n+    /// </summary>\n+    internal class TransactionClient : ITransactionClient\n+    {\n+        /** Unique  transaction ID.*/\n+        private readonly int _id;\n+\n+        /** Ignite. */\n+        private readonly IgniteClient _ignite;\n+\n+        /** Socket. */\n+        private readonly ClientSocket _socket;\n+\n+        /** Transaction is closed. */\n+        private bool _closed;\n+\n+        /// <summary>\n+        /// Constructor.\n+        /// </summary>\n+        /// <param name=\"id\">ID.</param>\n+        /// <param name=\"ignite\">Ignite.</param>\n+        /// <param name=\"socket\">Socket.</param>\n+        /// <param name=\"concurrency\">Concurrency.</param>\n+        /// <param name=\"isolation\">Isolation.</param>\n+        /// <param name=\"timeout\">Timeout.</param>\n+        /// <param name=\"label\">Label.</param>\n+        public TransactionClient(int id,\n+            IgniteClient ignite,\n+            ClientSocket socket,\n+            TransactionConcurrency concurrency,\n+            TransactionIsolation isolation,\n+            TimeSpan timeout,\n+            string label)\n+        {\n+            _id = id;\n+            _ignite = ignite;\n+            _socket = socket;\n+            Concurrency = concurrency;\n+            Isolation = isolation;\n+            Timeout = timeout;\n+            Label = label;\n+        }\n+\n+        /** <inheritdoc /> */\n+        public void Commit()\n+        {\n+            ThrowIfClosed();\n+            Close(true);\n+        }\n+\n+        /** <inheritdoc /> */\n+        public void Rollback()\n+        {\n+            ThrowIfClosed();\n+            Close(false);\n+        }\n+\n+        /** <inheritdoc /> */\n+        public TransactionConcurrency Concurrency { get; private set; }\n+\n+        /** <inheritdoc /> */\n+        public TransactionIsolation Isolation { get; private set; }\n+\n+        /** <inheritdoc /> */\n+        public TimeSpan Timeout { get; private set; }\n+\n+        /** <inheritdoc /> */\n+        public string Label { get; private set; }\n+\n+        /** <inheritdoc /> */\n+        public void Dispose()\n+        {\n+            try\n+            {\n+                Close(false);\n+            }\n+            finally\n+            {\n+                GC.SuppressFinalize(this);\n+            }\n+        }\n+\n+        /// <summary>\n+        /// Transaction Id.\n+        /// </summary>\n+        public int Id\n+        {\n+            get { return _id; }\n+        }\n+\n+        public ClientSocket Socket\n+        {\n+            get { return _socket; }\n+        }\n+\n+        /// <summary>\n+        /// Returns if transaction is closed.\n+        /// </summary>\n+        internal bool Closed\n+        {\n+            get { return _closed; }\n+        }\n+\n+        /// <summary>\n+        /// Closes the transaction. \n+        /// </summary>\n+        private void Close(bool commit)\n+        {\n+            if (!_closed)\n+            {\n+                try\n+                {\n+                    _ignite.Socket.DoOutInOp<object>(ClientOp.TxEnd,", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MTA5NjYwMA=="}, "originalCommit": {"oid": "613be9da2ec34523f5f52ae994e8ad2a13aef55d"}, "originalPosition": 138}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NDA4NzUwMg==", "bodyText": "I think the only situation to be covered here is a socket disconnect.\nWe can catch Exception, and swallow it only if _socket is disconnected, otherwise throw.", "url": "https://github.com/apache/ignite/pull/7992#discussion_r464087502", "createdAt": "2020-08-02T14:56:31Z", "author": {"login": "ptupitsyn"}, "path": "modules/platforms/dotnet/Apache.Ignite.Core/Impl/Client/Transactions/TransactionClient.cs", "diffHunk": "@@ -0,0 +1,172 @@\n+/*\n+ * Licensed to the Apache Software Foundation (ASF) under one or more\n+ * contributor license agreements.  See the NOTICE file distributed with\n+ * this work for additional information regarding copyright ownership.\n+ * The ASF licenses this file to You under the Apache License, Version 2.0\n+ * (the \"License\"); you may not use this file except in compliance with\n+ * the License.  You may obtain a copy of the License at\n+ *\n+ *      http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+namespace Apache.Ignite.Core.Impl.Client.Transactions\n+{\n+    using System;\n+    using System.Globalization;\n+    using Apache.Ignite.Core.Client.Transactions;\n+    using Apache.Ignite.Core.Transactions;\n+\n+    /// <summary>\n+    /// Ignite Thin Client transaction facade.\n+    /// </summary>\n+    internal class TransactionClient : ITransactionClient\n+    {\n+        /** Unique  transaction ID.*/\n+        private readonly int _id;\n+\n+        /** Ignite. */\n+        private readonly IgniteClient _ignite;\n+\n+        /** Socket. */\n+        private readonly ClientSocket _socket;\n+\n+        /** Transaction is closed. */\n+        private bool _closed;\n+\n+        /// <summary>\n+        /// Constructor.\n+        /// </summary>\n+        /// <param name=\"id\">ID.</param>\n+        /// <param name=\"ignite\">Ignite.</param>\n+        /// <param name=\"socket\">Socket.</param>\n+        /// <param name=\"concurrency\">Concurrency.</param>\n+        /// <param name=\"isolation\">Isolation.</param>\n+        /// <param name=\"timeout\">Timeout.</param>\n+        /// <param name=\"label\">Label.</param>\n+        public TransactionClient(int id,\n+            IgniteClient ignite,\n+            ClientSocket socket,\n+            TransactionConcurrency concurrency,\n+            TransactionIsolation isolation,\n+            TimeSpan timeout,\n+            string label)\n+        {\n+            _id = id;\n+            _ignite = ignite;\n+            _socket = socket;\n+            Concurrency = concurrency;\n+            Isolation = isolation;\n+            Timeout = timeout;\n+            Label = label;\n+        }\n+\n+        /** <inheritdoc /> */\n+        public void Commit()\n+        {\n+            ThrowIfClosed();\n+            Close(true);\n+        }\n+\n+        /** <inheritdoc /> */\n+        public void Rollback()\n+        {\n+            ThrowIfClosed();\n+            Close(false);\n+        }\n+\n+        /** <inheritdoc /> */\n+        public TransactionConcurrency Concurrency { get; private set; }\n+\n+        /** <inheritdoc /> */\n+        public TransactionIsolation Isolation { get; private set; }\n+\n+        /** <inheritdoc /> */\n+        public TimeSpan Timeout { get; private set; }\n+\n+        /** <inheritdoc /> */\n+        public string Label { get; private set; }\n+\n+        /** <inheritdoc /> */\n+        public void Dispose()\n+        {\n+            try\n+            {\n+                Close(false);\n+            }\n+            finally\n+            {\n+                GC.SuppressFinalize(this);\n+            }\n+        }\n+\n+        /// <summary>\n+        /// Transaction Id.\n+        /// </summary>\n+        public int Id\n+        {\n+            get { return _id; }\n+        }\n+\n+        public ClientSocket Socket\n+        {\n+            get { return _socket; }\n+        }\n+\n+        /// <summary>\n+        /// Returns if transaction is closed.\n+        /// </summary>\n+        internal bool Closed\n+        {\n+            get { return _closed; }\n+        }\n+\n+        /// <summary>\n+        /// Closes the transaction. \n+        /// </summary>\n+        private void Close(bool commit)\n+        {\n+            if (!_closed)\n+            {\n+                try\n+                {\n+                    _ignite.Socket.DoOutInOp<object>(ClientOp.TxEnd,", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MTA5NjYwMA=="}, "originalCommit": {"oid": "613be9da2ec34523f5f52ae994e8ad2a13aef55d"}, "originalPosition": 138}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MDM2MDA3MQ==", "bodyText": "Fixed.", "url": "https://github.com/apache/ignite/pull/7992#discussion_r490360071", "createdAt": "2020-09-17T15:51:46Z", "author": {"login": "gurustron"}, "path": "modules/platforms/dotnet/Apache.Ignite.Core/Impl/Client/Transactions/TransactionClient.cs", "diffHunk": "@@ -0,0 +1,172 @@\n+/*\n+ * Licensed to the Apache Software Foundation (ASF) under one or more\n+ * contributor license agreements.  See the NOTICE file distributed with\n+ * this work for additional information regarding copyright ownership.\n+ * The ASF licenses this file to You under the Apache License, Version 2.0\n+ * (the \"License\"); you may not use this file except in compliance with\n+ * the License.  You may obtain a copy of the License at\n+ *\n+ *      http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+namespace Apache.Ignite.Core.Impl.Client.Transactions\n+{\n+    using System;\n+    using System.Globalization;\n+    using Apache.Ignite.Core.Client.Transactions;\n+    using Apache.Ignite.Core.Transactions;\n+\n+    /// <summary>\n+    /// Ignite Thin Client transaction facade.\n+    /// </summary>\n+    internal class TransactionClient : ITransactionClient\n+    {\n+        /** Unique  transaction ID.*/\n+        private readonly int _id;\n+\n+        /** Ignite. */\n+        private readonly IgniteClient _ignite;\n+\n+        /** Socket. */\n+        private readonly ClientSocket _socket;\n+\n+        /** Transaction is closed. */\n+        private bool _closed;\n+\n+        /// <summary>\n+        /// Constructor.\n+        /// </summary>\n+        /// <param name=\"id\">ID.</param>\n+        /// <param name=\"ignite\">Ignite.</param>\n+        /// <param name=\"socket\">Socket.</param>\n+        /// <param name=\"concurrency\">Concurrency.</param>\n+        /// <param name=\"isolation\">Isolation.</param>\n+        /// <param name=\"timeout\">Timeout.</param>\n+        /// <param name=\"label\">Label.</param>\n+        public TransactionClient(int id,\n+            IgniteClient ignite,\n+            ClientSocket socket,\n+            TransactionConcurrency concurrency,\n+            TransactionIsolation isolation,\n+            TimeSpan timeout,\n+            string label)\n+        {\n+            _id = id;\n+            _ignite = ignite;\n+            _socket = socket;\n+            Concurrency = concurrency;\n+            Isolation = isolation;\n+            Timeout = timeout;\n+            Label = label;\n+        }\n+\n+        /** <inheritdoc /> */\n+        public void Commit()\n+        {\n+            ThrowIfClosed();\n+            Close(true);\n+        }\n+\n+        /** <inheritdoc /> */\n+        public void Rollback()\n+        {\n+            ThrowIfClosed();\n+            Close(false);\n+        }\n+\n+        /** <inheritdoc /> */\n+        public TransactionConcurrency Concurrency { get; private set; }\n+\n+        /** <inheritdoc /> */\n+        public TransactionIsolation Isolation { get; private set; }\n+\n+        /** <inheritdoc /> */\n+        public TimeSpan Timeout { get; private set; }\n+\n+        /** <inheritdoc /> */\n+        public string Label { get; private set; }\n+\n+        /** <inheritdoc /> */\n+        public void Dispose()\n+        {\n+            try\n+            {\n+                Close(false);\n+            }\n+            finally\n+            {\n+                GC.SuppressFinalize(this);\n+            }\n+        }\n+\n+        /// <summary>\n+        /// Transaction Id.\n+        /// </summary>\n+        public int Id\n+        {\n+            get { return _id; }\n+        }\n+\n+        public ClientSocket Socket\n+        {\n+            get { return _socket; }\n+        }\n+\n+        /// <summary>\n+        /// Returns if transaction is closed.\n+        /// </summary>\n+        internal bool Closed\n+        {\n+            get { return _closed; }\n+        }\n+\n+        /// <summary>\n+        /// Closes the transaction. \n+        /// </summary>\n+        private void Close(bool commit)\n+        {\n+            if (!_closed)\n+            {\n+                try\n+                {\n+                    _ignite.Socket.DoOutInOp<object>(ClientOp.TxEnd,", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MTA5NjYwMA=="}, "originalCommit": {"oid": "613be9da2ec34523f5f52ae994e8ad2a13aef55d"}, "originalPosition": 138}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjk4NDM0MDYwOnYy", "diffSide": "RIGHT", "path": "modules/platforms/dotnet/Apache.Ignite.Core/Impl/Client/Transactions/TransactionsClient.cs", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yNlQxNDo0Mjo1NFrOHHPhQw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yNlQxNDo1MDoxM1rOHHP3eg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NzM1NjM1NQ==", "bodyText": "We should handle an edge case when multiple clients are used from the same thread:\ncheck that tx actually belongs to the current IgniteClient and has the same ClientSocket.\nIf there is an active transaction for another client or socket, I think we should throw  NotSupportedException.", "url": "https://github.com/apache/ignite/pull/7992#discussion_r477356355", "createdAt": "2020-08-26T14:42:54Z", "author": {"login": "ptupitsyn"}, "path": "modules/platforms/dotnet/Apache.Ignite.Core/Impl/Client/Transactions/TransactionsClient.cs", "diffHunk": "@@ -0,0 +1,257 @@\n+/*\n+ * Licensed to the Apache Software Foundation (ASF) under one or more\n+ * contributor license agreements.  See the NOTICE file distributed with\n+ * this work for additional information regarding copyright ownership.\n+ * The ASF licenses this file to You under the Apache License, Version 2.0\n+ * (the \"License\"); you may not use this file except in compliance with\n+ * the License.  You may obtain a copy of the License at\n+ *\n+ *      http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+namespace Apache.Ignite.Core.Impl.Client.Transactions\n+{\n+    using System;\n+    using System.Diagnostics.CodeAnalysis;\n+    using System.Threading;\n+    using Apache.Ignite.Core.Client;\n+    using Apache.Ignite.Core.Client.Transactions;\n+    using Apache.Ignite.Core.Impl.Binary;\n+    using Apache.Ignite.Core.Impl.Common;\n+    using Apache.Ignite.Core.Transactions;\n+\n+    /// <summary>\n+    /// Ignite Thin Client transactions facade.\n+    /// </summary>\n+    internal class TransactionsClient : ITransactionsClient, IDisposable\n+    {\n+        /** Default transaction configuration. */\n+        private readonly TransactionClientConfiguration _cfg;\n+\n+        /** Transaction for this thread and client. */\n+        private readonly ThreadLocal<TransactionClient> _currentTx = new ThreadLocal<TransactionClient>();\n+\n+        /** Ignite. */\n+        private readonly IgniteClient _ignite;\n+\n+        /** Transaction manager. */\n+        private readonly ClientCacheTransactionManager _txManager;\n+\n+        /// <summary>\n+        /// Constructor.\n+        /// </summary>\n+        /// <param name=\"ignite\">Ignite.</param>\n+        /// <param name=\"cfg\"></param>\n+        public TransactionsClient(IgniteClient ignite, TransactionClientConfiguration cfg)\n+        {\n+            _ignite = ignite;\n+            _cfg = cfg ?? new TransactionClientConfiguration();\n+            _txManager = new ClientCacheTransactionManager(this);\n+        }\n+\n+        /** <inheritDoc /> */\n+        [SuppressMessage(\"Microsoft.Usage\", \"CA1816:CallGCSuppressFinalizeCorrectly\",\n+            Justification = \"There is no finalizer.\")]\n+        public void Dispose()\n+        {\n+            _currentTx.Dispose();\n+            _txManager.Dispose();\n+        }\n+\n+        /// <summary>\n+        /// Starts ambient transaction if needed.\n+        /// </summary>\n+        internal void StartTxIfNeeded()\n+        {\n+            _txManager.StartTxIfNeeded();\n+        }\n+\n+        /** <inheritDoc /> */\n+        ITransactionClient ITransactionsClient.Tx\n+        {\n+            get { return Tx; }\n+        }\n+\n+        /// <summary>\n+        /// Gets transaction started by this thread or null if this thread does not have a transaction.\n+        /// </summary>\n+        internal TransactionClient Tx\n+        {\n+            get\n+            {\n+                var tx = _currentTx.Value;\n+\n+                if (tx == null)\n+                    return null;\n+\n+                if (tx.Closed)", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "61642003b16c65b3d859738c4955bc0229da25fe"}, "originalPosition": 93}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NzM2MjA0Mg==", "bodyText": "Also, when socket is disconnected, we should clear all related thread locals to avoid leading memory.", "url": "https://github.com/apache/ignite/pull/7992#discussion_r477362042", "createdAt": "2020-08-26T14:50:13Z", "author": {"login": "ptupitsyn"}, "path": "modules/platforms/dotnet/Apache.Ignite.Core/Impl/Client/Transactions/TransactionsClient.cs", "diffHunk": "@@ -0,0 +1,257 @@\n+/*\n+ * Licensed to the Apache Software Foundation (ASF) under one or more\n+ * contributor license agreements.  See the NOTICE file distributed with\n+ * this work for additional information regarding copyright ownership.\n+ * The ASF licenses this file to You under the Apache License, Version 2.0\n+ * (the \"License\"); you may not use this file except in compliance with\n+ * the License.  You may obtain a copy of the License at\n+ *\n+ *      http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+namespace Apache.Ignite.Core.Impl.Client.Transactions\n+{\n+    using System;\n+    using System.Diagnostics.CodeAnalysis;\n+    using System.Threading;\n+    using Apache.Ignite.Core.Client;\n+    using Apache.Ignite.Core.Client.Transactions;\n+    using Apache.Ignite.Core.Impl.Binary;\n+    using Apache.Ignite.Core.Impl.Common;\n+    using Apache.Ignite.Core.Transactions;\n+\n+    /// <summary>\n+    /// Ignite Thin Client transactions facade.\n+    /// </summary>\n+    internal class TransactionsClient : ITransactionsClient, IDisposable\n+    {\n+        /** Default transaction configuration. */\n+        private readonly TransactionClientConfiguration _cfg;\n+\n+        /** Transaction for this thread and client. */\n+        private readonly ThreadLocal<TransactionClient> _currentTx = new ThreadLocal<TransactionClient>();\n+\n+        /** Ignite. */\n+        private readonly IgniteClient _ignite;\n+\n+        /** Transaction manager. */\n+        private readonly ClientCacheTransactionManager _txManager;\n+\n+        /// <summary>\n+        /// Constructor.\n+        /// </summary>\n+        /// <param name=\"ignite\">Ignite.</param>\n+        /// <param name=\"cfg\"></param>\n+        public TransactionsClient(IgniteClient ignite, TransactionClientConfiguration cfg)\n+        {\n+            _ignite = ignite;\n+            _cfg = cfg ?? new TransactionClientConfiguration();\n+            _txManager = new ClientCacheTransactionManager(this);\n+        }\n+\n+        /** <inheritDoc /> */\n+        [SuppressMessage(\"Microsoft.Usage\", \"CA1816:CallGCSuppressFinalizeCorrectly\",\n+            Justification = \"There is no finalizer.\")]\n+        public void Dispose()\n+        {\n+            _currentTx.Dispose();\n+            _txManager.Dispose();\n+        }\n+\n+        /// <summary>\n+        /// Starts ambient transaction if needed.\n+        /// </summary>\n+        internal void StartTxIfNeeded()\n+        {\n+            _txManager.StartTxIfNeeded();\n+        }\n+\n+        /** <inheritDoc /> */\n+        ITransactionClient ITransactionsClient.Tx\n+        {\n+            get { return Tx; }\n+        }\n+\n+        /// <summary>\n+        /// Gets transaction started by this thread or null if this thread does not have a transaction.\n+        /// </summary>\n+        internal TransactionClient Tx\n+        {\n+            get\n+            {\n+                var tx = _currentTx.Value;\n+\n+                if (tx == null)\n+                    return null;\n+\n+                if (tx.Closed)", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NzM1NjM1NQ=="}, "originalCommit": {"oid": "61642003b16c65b3d859738c4955bc0229da25fe"}, "originalPosition": 93}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjk4NDYwODA1OnYy", "diffSide": "RIGHT", "path": "modules/platforms/dotnet/Apache.Ignite.Core.Tests/Client/Cache/CacheClientAbstractTxTest.cs", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yNlQxNTo0MDoxMlrOHHSHUA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xMlQyMzo0MDoxNlrOHQ4M8Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NzM5ODg2NA==", "bodyText": "We should check that operations can be performed and that one client does not use the TX started by the other.\nI think this is not the case, since we only have one thread local which is shared by all clients.", "url": "https://github.com/apache/ignite/pull/7992#discussion_r477398864", "createdAt": "2020-08-26T15:40:12Z", "author": {"login": "ptupitsyn"}, "path": "modules/platforms/dotnet/Apache.Ignite.Core.Tests/Client/Cache/CacheClientAbstractTxTest.cs", "diffHunk": "@@ -0,0 +1,822 @@\n+/*\n+ * Licensed to the Apache Software Foundation (ASF) under one or more\n+ * contributor license agreements.  See the NOTICE file distributed with\n+ * this work for additional information regarding copyright ownership.\n+ * The ASF licenses this file to You under the Apache License, Version 2.0\n+ * (the \"License\"); you may not use this file except in compliance with\n+ * the License.  You may obtain a copy of the License at\n+ *\n+ *      http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+namespace Apache.Ignite.Core.Tests.Client.Cache\n+{\n+    using System;\n+    using System.Collections.Generic;\n+    using System.Linq;\n+    using System.Threading;\n+    using System.Threading.Tasks;\n+    using System.Transactions;\n+    using Apache.Ignite.Core.Cache.Configuration;\n+    using Apache.Ignite.Core.Client;\n+    using Apache.Ignite.Core.Client.Cache;\n+    using Apache.Ignite.Core.Client.Transactions;\n+    using Apache.Ignite.Core.Impl.Client.Transactions;\n+    using Apache.Ignite.Core.Transactions;\n+    using NUnit.Framework;\n+    using NUnit.Framework.Constraints;\n+\n+    /// <summary>\n+    /// Transactional cache client tests.\n+    /// </summary>\n+    public abstract class CacheClientAbstractTxTest : ClientTestBase\n+    {\n+        /** All concurrency controls. */\n+        private static readonly TransactionConcurrency[] AllConcurrencyControls =\n+        {\n+            TransactionConcurrency.Optimistic,\n+            TransactionConcurrency.Pessimistic\n+        };\n+\n+        /** All isolation levels*/\n+        private static readonly TransactionIsolation[] AllIsolationLevels =\n+        {\n+            TransactionIsolation.Serializable,\n+            TransactionIsolation.ReadCommitted,\n+            TransactionIsolation.RepeatableRead\n+        };\n+\n+        /// <summary>\n+        /// Initializes a new instance of the <see cref=\"CacheClientAbstractTxTest\"/> class.\n+        /// </summary>\n+        protected CacheClientAbstractTxTest(int serverCount, bool enablePartitionAwareness) : base(serverCount,\n+            enablePartitionAwareness: enablePartitionAwareness)\n+        {\n+            // No-op.\n+        }\n+\n+        /// <summary>\n+        /// Tests that custom client transactions configuration is applied.\n+        /// </summary>\n+        [Test]\n+        public void TestClientTransactionConfiguration()\n+        {\n+            var timeout = TransactionClientConfiguration.DefaultDefaultTimeout.Add(TimeSpan.FromMilliseconds(1000));\n+            var cfg = GetClientConfiguration();\n+            cfg.TransactionConfiguration = new TransactionClientConfiguration\n+            {\n+                DefaultTimeout = timeout\n+            };\n+\n+            foreach (var concurrency in AllConcurrencyControls)\n+            {\n+                foreach (var isolation in AllIsolationLevels)\n+                {\n+                    cfg.TransactionConfiguration.DefaultTransactionConcurrency = concurrency;\n+                    cfg.TransactionConfiguration.DefaultTransactionIsolation = isolation;\n+                    using (var client = Ignition.StartClient(cfg))\n+                    {\n+                        var transactions = client.GetTransactions();\n+                        Assert.AreEqual(concurrency, transactions.DefaultTransactionConcurrency);\n+                        Assert.AreEqual(isolation, transactions.DefaultTransactionIsolation);\n+                        Assert.AreEqual(timeout, transactions.DefaultTimeout);\n+\n+                        ITransaction igniteTx;\n+                        using (var tx = transactions.TxStart())\n+                        {\n+                            Assert.AreEqual(tx, transactions.Tx);\n+                            Assert.AreEqual(concurrency, tx.Concurrency);\n+                            Assert.AreEqual(isolation, tx.Isolation);\n+                            Assert.AreEqual(timeout, tx.Timeout);\n+\n+                            igniteTx = GetSingleLocalTransaction();\n+                            Assert.AreEqual(concurrency, igniteTx.Concurrency);\n+                            Assert.AreEqual(isolation, igniteTx.Isolation);\n+                            Assert.AreEqual(timeout, igniteTx.Timeout);\n+                        }\n+\n+                        igniteTx.Dispose();\n+                    }\n+                }\n+            }\n+        }\n+\n+        /// <summary>\n+        /// Tests that parameters passed to TxStart are applied.\n+        /// </summary>\n+        [Test]\n+        public void TestTxStartPassesParameters()\n+        {\n+            var timeout = TransactionClientConfiguration.DefaultDefaultTimeout.Add(TimeSpan.FromMilliseconds(1000));\n+            var acts = new List<Func<ITransactionsClient>>\n+            {\n+                () => Client.GetTransactions(),\n+                () => Client.GetTransactions().WithLabel(\"label\"),\n+            };\n+            foreach (var concurrency in AllConcurrencyControls)\n+            {\n+                foreach (var isolation in AllIsolationLevels)\n+                {\n+                    foreach (var act in acts)\n+                    {\n+                        var client = act();\n+\n+                        ITransaction igniteTx;\n+                        using (var tx = client.TxStart(concurrency, isolation))\n+                        {\n+                            Assert.AreEqual(tx, client.Tx);\n+                            Assert.AreEqual(concurrency, tx.Concurrency);\n+                            Assert.AreEqual(isolation, tx.Isolation);\n+\n+                            igniteTx = GetSingleLocalTransaction();\n+                            Assert.AreEqual(concurrency, igniteTx.Concurrency);\n+                            Assert.AreEqual(isolation, igniteTx.Isolation);\n+                        }\n+\n+                        igniteTx.Dispose();\n+                        using (var tx = client.TxStart(concurrency, isolation, timeout))\n+                        {\n+                            Assert.AreEqual(concurrency, tx.Concurrency);\n+                            Assert.AreEqual(isolation, tx.Isolation);\n+                            Assert.AreEqual(timeout, tx.Timeout);\n+\n+                            igniteTx = GetSingleLocalTransaction();\n+                            Assert.AreEqual(concurrency, igniteTx.Concurrency);\n+                            Assert.AreEqual(isolation, igniteTx.Isolation);\n+                            Assert.AreEqual(timeout, igniteTx.Timeout);\n+                        }\n+\n+                        igniteTx.Dispose();\n+                    }\n+                }\n+            }\n+        }\n+\n+        /// <summary>\n+        /// Tests that transaction can't be committed/rollback after being already completed.\n+        /// </summary>\n+        [Test]\n+        public void TestThrowsIfEndAlreadyCompletedTransaction()\n+        {\n+            var tx = Client.GetTransactions().TxStart();\n+            tx.Commit();\n+\n+            var constraint = new ReusableConstraint(Is.TypeOf<InvalidOperationException>()\n+                .And.Message.Contains(\"Transaction\")\n+                .And.Message.Contains(\"is closed\"));\n+\n+            Assert.Throws(constraint, () => tx.Commit());\n+            Assert.Throws(constraint, () => tx.Rollback());\n+\n+            using (tx = Client.GetTransactions().TxStart())\n+            {\n+            }\n+\n+            Assert.Throws(constraint, () => tx.Commit());\n+            Assert.Throws(constraint, () => tx.Rollback());\n+        }\n+\n+        /// <summary>\n+        /// Tests that transaction throws if timeout elapsed.\n+        /// </summary>\n+        [Test]\n+        public void TestTimeout()\n+        {\n+            var timeout = TimeSpan.FromMilliseconds(200);\n+            var cache = GetTransactionalCache();\n+            cache.Put(1, 1);\n+            using (var tx = Client.GetTransactions().TxStart(TransactionConcurrency.Pessimistic,\n+                TransactionIsolation.ReadCommitted,\n+                timeout))\n+            {\n+                Thread.Sleep(TimeSpan.FromMilliseconds(300));\n+                var constraint = new ReusableConstraint(Is.TypeOf<IgniteClientException>()\n+                    .And.Message.Contains(\"Cache transaction timed out\"));\n+                Assert.Throws(constraint, () => cache.Put(1, 10));\n+                Assert.Throws(constraint, () => tx.Commit());\n+            }\n+\n+            Assert.AreEqual(1, cache.Get(1));\n+        }\n+\n+        /// <summary>\n+        /// Tests that commit applies cache changes.\n+        /// </summary>\n+        [Test]\n+        public void TestTxCommit()\n+        {\n+            var cache = GetTransactionalCache();\n+\n+            cache.Put(1, 1);\n+            cache.Put(2, 2);\n+\n+            using (var tx = Client.GetTransactions().TxStart())\n+            {\n+                cache.Put(1, 10);\n+                cache.Put(2, 20);\n+\n+                tx.Commit();\n+            }\n+\n+            Assert.AreEqual(10, cache.Get(1));\n+            Assert.AreEqual(20, cache.Get(2));\n+        }\n+\n+        /// <summary>\n+        /// Tests that rollback reverts cache changes.\n+        /// </summary>\n+        [Test]\n+        public void TestTxRollback()\n+        {\n+            var cache = GetTransactionalCache();\n+            cache.Put(1, 1);\n+            cache.Put(2, 2);\n+\n+            using (var tx = Client.GetTransactions().TxStart())\n+            {\n+                cache.Put(1, 10);\n+                cache.Put(2, 20);\n+\n+                Assert.AreEqual(10, cache.Get(1));\n+                Assert.AreEqual(20, cache.Get(2));\n+                tx.Rollback();\n+            }\n+\n+            Assert.AreEqual(1, cache.Get(1));\n+            Assert.AreEqual(2, cache.Get(2));\n+        }\n+\n+        /// <summary>\n+        /// Tests that closing transaction without commit reverts cache changes.\n+        /// </summary>\n+        [Test]\n+        public void TestTxClose()\n+        {\n+            var cache = GetTransactionalCache();\n+\n+            cache.Put(1, 1);\n+            cache.Put(2, 2);\n+\n+            using (Client.GetTransactions().TxStart())\n+            {\n+                cache.Put(1, 10);\n+                cache.Put(2, 20);\n+            }\n+\n+            Assert.AreEqual(1, cache.Get(1));\n+            Assert.AreEqual(2, cache.Get(2));\n+        }\n+\n+        /// <summary>\n+        /// Tests that client can't start multiple transactions in one thread.\n+        /// </summary>\n+        [Test]\n+        public void TestThrowsIfMultipleStarted()\n+        {\n+            TestThrowsIfMultipleStarted(\n+                () => Client.GetTransactions().TxStart(),\n+                () => Client.GetTransactions().TxStart());\n+        }\n+\n+        /// <summary>\n+        /// Tests that different clients can start transactions in one thread.\n+        /// </summary>\n+        [Test]\n+        public void TestDifferentClientsCanStartTransactions()\n+        {\n+            Assert.DoesNotThrow(() =>\n+            {\n+                using (Client.GetTransactions().TxStart())\n+                using (GetClient().GetTransactions().TxStart())\n+                {\n+                    // No-op.", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "61642003b16c65b3d859738c4955bc0229da25fe"}, "originalPosition": 298}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NzQ2MDA4MQ==", "bodyText": "Added test.", "url": "https://github.com/apache/ignite/pull/7992#discussion_r487460081", "createdAt": "2020-09-12T23:40:16Z", "author": {"login": "gurustron"}, "path": "modules/platforms/dotnet/Apache.Ignite.Core.Tests/Client/Cache/CacheClientAbstractTxTest.cs", "diffHunk": "@@ -0,0 +1,822 @@\n+/*\n+ * Licensed to the Apache Software Foundation (ASF) under one or more\n+ * contributor license agreements.  See the NOTICE file distributed with\n+ * this work for additional information regarding copyright ownership.\n+ * The ASF licenses this file to You under the Apache License, Version 2.0\n+ * (the \"License\"); you may not use this file except in compliance with\n+ * the License.  You may obtain a copy of the License at\n+ *\n+ *      http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+namespace Apache.Ignite.Core.Tests.Client.Cache\n+{\n+    using System;\n+    using System.Collections.Generic;\n+    using System.Linq;\n+    using System.Threading;\n+    using System.Threading.Tasks;\n+    using System.Transactions;\n+    using Apache.Ignite.Core.Cache.Configuration;\n+    using Apache.Ignite.Core.Client;\n+    using Apache.Ignite.Core.Client.Cache;\n+    using Apache.Ignite.Core.Client.Transactions;\n+    using Apache.Ignite.Core.Impl.Client.Transactions;\n+    using Apache.Ignite.Core.Transactions;\n+    using NUnit.Framework;\n+    using NUnit.Framework.Constraints;\n+\n+    /// <summary>\n+    /// Transactional cache client tests.\n+    /// </summary>\n+    public abstract class CacheClientAbstractTxTest : ClientTestBase\n+    {\n+        /** All concurrency controls. */\n+        private static readonly TransactionConcurrency[] AllConcurrencyControls =\n+        {\n+            TransactionConcurrency.Optimistic,\n+            TransactionConcurrency.Pessimistic\n+        };\n+\n+        /** All isolation levels*/\n+        private static readonly TransactionIsolation[] AllIsolationLevels =\n+        {\n+            TransactionIsolation.Serializable,\n+            TransactionIsolation.ReadCommitted,\n+            TransactionIsolation.RepeatableRead\n+        };\n+\n+        /// <summary>\n+        /// Initializes a new instance of the <see cref=\"CacheClientAbstractTxTest\"/> class.\n+        /// </summary>\n+        protected CacheClientAbstractTxTest(int serverCount, bool enablePartitionAwareness) : base(serverCount,\n+            enablePartitionAwareness: enablePartitionAwareness)\n+        {\n+            // No-op.\n+        }\n+\n+        /// <summary>\n+        /// Tests that custom client transactions configuration is applied.\n+        /// </summary>\n+        [Test]\n+        public void TestClientTransactionConfiguration()\n+        {\n+            var timeout = TransactionClientConfiguration.DefaultDefaultTimeout.Add(TimeSpan.FromMilliseconds(1000));\n+            var cfg = GetClientConfiguration();\n+            cfg.TransactionConfiguration = new TransactionClientConfiguration\n+            {\n+                DefaultTimeout = timeout\n+            };\n+\n+            foreach (var concurrency in AllConcurrencyControls)\n+            {\n+                foreach (var isolation in AllIsolationLevels)\n+                {\n+                    cfg.TransactionConfiguration.DefaultTransactionConcurrency = concurrency;\n+                    cfg.TransactionConfiguration.DefaultTransactionIsolation = isolation;\n+                    using (var client = Ignition.StartClient(cfg))\n+                    {\n+                        var transactions = client.GetTransactions();\n+                        Assert.AreEqual(concurrency, transactions.DefaultTransactionConcurrency);\n+                        Assert.AreEqual(isolation, transactions.DefaultTransactionIsolation);\n+                        Assert.AreEqual(timeout, transactions.DefaultTimeout);\n+\n+                        ITransaction igniteTx;\n+                        using (var tx = transactions.TxStart())\n+                        {\n+                            Assert.AreEqual(tx, transactions.Tx);\n+                            Assert.AreEqual(concurrency, tx.Concurrency);\n+                            Assert.AreEqual(isolation, tx.Isolation);\n+                            Assert.AreEqual(timeout, tx.Timeout);\n+\n+                            igniteTx = GetSingleLocalTransaction();\n+                            Assert.AreEqual(concurrency, igniteTx.Concurrency);\n+                            Assert.AreEqual(isolation, igniteTx.Isolation);\n+                            Assert.AreEqual(timeout, igniteTx.Timeout);\n+                        }\n+\n+                        igniteTx.Dispose();\n+                    }\n+                }\n+            }\n+        }\n+\n+        /// <summary>\n+        /// Tests that parameters passed to TxStart are applied.\n+        /// </summary>\n+        [Test]\n+        public void TestTxStartPassesParameters()\n+        {\n+            var timeout = TransactionClientConfiguration.DefaultDefaultTimeout.Add(TimeSpan.FromMilliseconds(1000));\n+            var acts = new List<Func<ITransactionsClient>>\n+            {\n+                () => Client.GetTransactions(),\n+                () => Client.GetTransactions().WithLabel(\"label\"),\n+            };\n+            foreach (var concurrency in AllConcurrencyControls)\n+            {\n+                foreach (var isolation in AllIsolationLevels)\n+                {\n+                    foreach (var act in acts)\n+                    {\n+                        var client = act();\n+\n+                        ITransaction igniteTx;\n+                        using (var tx = client.TxStart(concurrency, isolation))\n+                        {\n+                            Assert.AreEqual(tx, client.Tx);\n+                            Assert.AreEqual(concurrency, tx.Concurrency);\n+                            Assert.AreEqual(isolation, tx.Isolation);\n+\n+                            igniteTx = GetSingleLocalTransaction();\n+                            Assert.AreEqual(concurrency, igniteTx.Concurrency);\n+                            Assert.AreEqual(isolation, igniteTx.Isolation);\n+                        }\n+\n+                        igniteTx.Dispose();\n+                        using (var tx = client.TxStart(concurrency, isolation, timeout))\n+                        {\n+                            Assert.AreEqual(concurrency, tx.Concurrency);\n+                            Assert.AreEqual(isolation, tx.Isolation);\n+                            Assert.AreEqual(timeout, tx.Timeout);\n+\n+                            igniteTx = GetSingleLocalTransaction();\n+                            Assert.AreEqual(concurrency, igniteTx.Concurrency);\n+                            Assert.AreEqual(isolation, igniteTx.Isolation);\n+                            Assert.AreEqual(timeout, igniteTx.Timeout);\n+                        }\n+\n+                        igniteTx.Dispose();\n+                    }\n+                }\n+            }\n+        }\n+\n+        /// <summary>\n+        /// Tests that transaction can't be committed/rollback after being already completed.\n+        /// </summary>\n+        [Test]\n+        public void TestThrowsIfEndAlreadyCompletedTransaction()\n+        {\n+            var tx = Client.GetTransactions().TxStart();\n+            tx.Commit();\n+\n+            var constraint = new ReusableConstraint(Is.TypeOf<InvalidOperationException>()\n+                .And.Message.Contains(\"Transaction\")\n+                .And.Message.Contains(\"is closed\"));\n+\n+            Assert.Throws(constraint, () => tx.Commit());\n+            Assert.Throws(constraint, () => tx.Rollback());\n+\n+            using (tx = Client.GetTransactions().TxStart())\n+            {\n+            }\n+\n+            Assert.Throws(constraint, () => tx.Commit());\n+            Assert.Throws(constraint, () => tx.Rollback());\n+        }\n+\n+        /// <summary>\n+        /// Tests that transaction throws if timeout elapsed.\n+        /// </summary>\n+        [Test]\n+        public void TestTimeout()\n+        {\n+            var timeout = TimeSpan.FromMilliseconds(200);\n+            var cache = GetTransactionalCache();\n+            cache.Put(1, 1);\n+            using (var tx = Client.GetTransactions().TxStart(TransactionConcurrency.Pessimistic,\n+                TransactionIsolation.ReadCommitted,\n+                timeout))\n+            {\n+                Thread.Sleep(TimeSpan.FromMilliseconds(300));\n+                var constraint = new ReusableConstraint(Is.TypeOf<IgniteClientException>()\n+                    .And.Message.Contains(\"Cache transaction timed out\"));\n+                Assert.Throws(constraint, () => cache.Put(1, 10));\n+                Assert.Throws(constraint, () => tx.Commit());\n+            }\n+\n+            Assert.AreEqual(1, cache.Get(1));\n+        }\n+\n+        /// <summary>\n+        /// Tests that commit applies cache changes.\n+        /// </summary>\n+        [Test]\n+        public void TestTxCommit()\n+        {\n+            var cache = GetTransactionalCache();\n+\n+            cache.Put(1, 1);\n+            cache.Put(2, 2);\n+\n+            using (var tx = Client.GetTransactions().TxStart())\n+            {\n+                cache.Put(1, 10);\n+                cache.Put(2, 20);\n+\n+                tx.Commit();\n+            }\n+\n+            Assert.AreEqual(10, cache.Get(1));\n+            Assert.AreEqual(20, cache.Get(2));\n+        }\n+\n+        /// <summary>\n+        /// Tests that rollback reverts cache changes.\n+        /// </summary>\n+        [Test]\n+        public void TestTxRollback()\n+        {\n+            var cache = GetTransactionalCache();\n+            cache.Put(1, 1);\n+            cache.Put(2, 2);\n+\n+            using (var tx = Client.GetTransactions().TxStart())\n+            {\n+                cache.Put(1, 10);\n+                cache.Put(2, 20);\n+\n+                Assert.AreEqual(10, cache.Get(1));\n+                Assert.AreEqual(20, cache.Get(2));\n+                tx.Rollback();\n+            }\n+\n+            Assert.AreEqual(1, cache.Get(1));\n+            Assert.AreEqual(2, cache.Get(2));\n+        }\n+\n+        /// <summary>\n+        /// Tests that closing transaction without commit reverts cache changes.\n+        /// </summary>\n+        [Test]\n+        public void TestTxClose()\n+        {\n+            var cache = GetTransactionalCache();\n+\n+            cache.Put(1, 1);\n+            cache.Put(2, 2);\n+\n+            using (Client.GetTransactions().TxStart())\n+            {\n+                cache.Put(1, 10);\n+                cache.Put(2, 20);\n+            }\n+\n+            Assert.AreEqual(1, cache.Get(1));\n+            Assert.AreEqual(2, cache.Get(2));\n+        }\n+\n+        /// <summary>\n+        /// Tests that client can't start multiple transactions in one thread.\n+        /// </summary>\n+        [Test]\n+        public void TestThrowsIfMultipleStarted()\n+        {\n+            TestThrowsIfMultipleStarted(\n+                () => Client.GetTransactions().TxStart(),\n+                () => Client.GetTransactions().TxStart());\n+        }\n+\n+        /// <summary>\n+        /// Tests that different clients can start transactions in one thread.\n+        /// </summary>\n+        [Test]\n+        public void TestDifferentClientsCanStartTransactions()\n+        {\n+            Assert.DoesNotThrow(() =>\n+            {\n+                using (Client.GetTransactions().TxStart())\n+                using (GetClient().GetTransactions().TxStart())\n+                {\n+                    // No-op.", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NzM5ODg2NA=="}, "originalCommit": {"oid": "61642003b16c65b3d859738c4955bc0229da25fe"}, "originalPosition": 298}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2431, "cost": 1, "resetAt": "2021-11-12T09:44:50Z"}}}