{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDY1NDY3MjE0", "number": 8135, "title": "IGNITE-12921 SqlViewExporterSpi moved to the internal package", "bodyText": "SqlViewExporterSpi moved to the internal package to eliminate it from public API.\nInstances of this SPI will be created automatically in case the indexing module available during node startup.\nThe Contribution Checklist\n\n There is a single JIRA ticket related to the pull request.\n The web-link to the pull request is attached to the JIRA ticket.\n The JIRA ticket has the Patch Available state.\n The pull request body describes changes that have been made.\nThe description explains WHAT and WHY was made instead of HOW.\n The pull request title is treated as the final commit message.\nThe following pattern must be used: IGNITE-XXXX Change summary where XXXX - number of JIRA issue.\n A reviewer has been mentioned through the JIRA comments\n(see the Maintainers list)\n The pull request has been checked by the Teamcity Bot and\nthe green visa attached to the JIRA ticket (see TC.Bot: Check PR)\n\nNotes\n\nHow to Contribute\nCoding abbreviation rules\nCoding Guidelines\nApache Ignite Teamcity Bot\n\nIf you need any help, please email dev@ignite.apache.org or ask an\u0443 advice on http://asf.slack.com #ignite channel.", "createdAt": "2020-08-10T12:23:27Z", "url": "https://github.com/apache/ignite/pull/8135", "merged": true, "mergeCommit": {"oid": "9590036394f25fdba76d9bd7e14e3ad5037ae6ac"}, "closed": true, "closedAt": "2020-09-18T12:05:21Z", "author": {"login": "nizhikov"}, "timelineItems": {"totalCount": 13, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABc9hOdBgH2gAyNDY1NDY3MjE0OmQ5N2VhMTAxN2JiMDQ5YTJjZTA2YTczZmZjYzJkODg1YmI4NGIwOWU=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdKDKfTgH2gAyNDY1NDY3MjE0OmQ2ZWM2M2I4YWQwODI4YTg4Y2M4MTM5NGIxNWY2M2FmN2MzNzEyZTM=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "d97ea1017bb049a2ce06a73ffcc2d885bb84b09e", "author": {"user": {"login": "nizhikov", "name": "Nikolay"}}, "url": "https://github.com/apache/ignite/commit/d97ea1017bb049a2ce06a73ffcc2d885bb84b09e", "committedDate": "2020-08-10T12:18:07Z", "message": "IGNITE-12921: SqlViewExporterSpi moved to the internal package."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDY4NzM5NTE5", "url": "https://github.com/apache/ignite/pull/8135#pullrequestreview-468739519", "createdAt": "2020-08-17T18:34:06Z", "commit": {"oid": "d97ea1017bb049a2ce06a73ffcc2d885bb84b09e"}, "state": "COMMENTED", "comments": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xN1QxODozNDowN1rOHB1yJg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xN1QxODo0NTozN1rOHB2rRw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MTY5MTgxNA==", "bodyText": "Could you please replace supplier by simple method call? There is no need to use lambda syntax here.", "url": "https://github.com/apache/ignite/pull/8135#discussion_r471691814", "createdAt": "2020-08-17T18:34:07Z", "author": {"login": "agura"}, "path": "modules/core/src/main/java/org/apache/ignite/internal/managers/systemview/GridSystemViewManager.java", "diffHunk": "@@ -75,7 +82,26 @@\n      * @param ctx Kernal context.\n      */\n     public GridSystemViewManager(GridKernalContext ctx) {\n-        super(ctx, ctx.config().getSystemViewExporterSpi());\n+        super(ctx, ((Supplier<SystemViewExporterSpi[]>)() -> {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d97ea1017bb049a2ce06a73ffcc2d885bb84b09e"}, "originalPosition": 31}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MTY5MzQ3Ng==", "bodyText": "Nevertheless, what if spi array already contains SqlViewExporterSpi?", "url": "https://github.com/apache/ignite/pull/8135#discussion_r471693476", "createdAt": "2020-08-17T18:35:19Z", "author": {"login": "agura"}, "path": "modules/core/src/main/java/org/apache/ignite/internal/managers/systemview/GridSystemViewManager.java", "diffHunk": "@@ -75,7 +82,26 @@\n      * @param ctx Kernal context.\n      */\n     public GridSystemViewManager(GridKernalContext ctx) {\n-        super(ctx, ctx.config().getSystemViewExporterSpi());\n+        super(ctx, ((Supplier<SystemViewExporterSpi[]>)() -> {\n+            SystemViewExporterSpi[] spi = ctx.config().getSystemViewExporterSpi();\n+\n+            if (!IgniteComponentType.INDEXING.inClassPath())\n+                return spi;\n+\n+            SystemViewExporterSpi[] spiWithSql = new SystemViewExporterSpi[spi != null ? spi.length + 1 : 1];", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d97ea1017bb049a2ce06a73ffcc2d885bb84b09e"}, "originalPosition": 37}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MTY5ODI2Mw==", "bodyText": "Visibility scope for this constant is too broad.", "url": "https://github.com/apache/ignite/pull/8135#discussion_r471698263", "createdAt": "2020-08-17T18:38:45Z", "author": {"login": "agura"}, "path": "modules/core/src/main/java/org/apache/ignite/internal/managers/systemview/GridSystemViewManager.java", "diffHunk": "@@ -53,6 +57,9 @@\n  */\n public class GridSystemViewManager extends GridManagerAdapter<SystemViewExporterSpi>\n     implements ReadOnlySystemViewRegistry {\n+    /** Class name for a SQL view exporter of system views. */\n+    public static final String SYSTEM_VIEW_SQL_SPI = \"org.apache.ignite.internal.managers.systemview.SqlViewExporterSpi\";", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d97ea1017bb049a2ce06a73ffcc2d885bb84b09e"}, "originalPosition": 21}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MTcwNjQzOQ==", "bodyText": "IMHO, it isn't the best solution to have internal implementation of any SPI. May be we can extract some common parts of Exporter SPI into a new internal super-class which should be inherited by SystemViewExporterSpi and our internal analog of SqlViewEXporterSpi?", "url": "https://github.com/apache/ignite/pull/8135#discussion_r471706439", "createdAt": "2020-08-17T18:45:37Z", "author": {"login": "agura"}, "path": "modules/indexing/src/main/java/org/apache/ignite/internal/managers/systemview/SqlViewExporterSpi.java", "diffHunk": "@@ -36,12 +37,9 @@\n  * This SPI implementation exports metrics as SQL views.\n  *\n  * Note, instance of this class created with reflection.\n- * @see IgnitionEx#SYSTEM_VIEW_SQL_SPI\n+ * @see GridSystemViewManager#SYSTEM_VIEW_SQL_SPI\n  */\n-public class SqlViewExporterSpi extends IgniteSpiAdapter implements SystemViewExporterSpi {\n-    /** System view filter. */\n-    @Nullable private Predicate<SystemView<?>> filter;\n-\n+class SqlViewExporterSpi extends IgniteSpiAdapter implements SystemViewExporterSpi {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d97ea1017bb049a2ce06a73ffcc2d885bb84b09e"}, "originalPosition": 32}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "702b52563b0165270d84920c7785b6731ff01e98", "author": {"user": {"login": "nizhikov", "name": "Nikolay"}}, "url": "https://github.com/apache/ignite/commit/702b52563b0165270d84920c7785b6731ff01e98", "committedDate": "2020-08-18T07:03:04Z", "message": "Merge branch 'master' into IGNITE-12921"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "42fa58850ec2dfc34a7e31381320cb99325bc3c5", "author": {"user": {"login": "nizhikov", "name": "Nikolay"}}, "url": "https://github.com/apache/ignite/commit/42fa58850ec2dfc34a7e31381320cb99325bc3c5", "committedDate": "2020-08-18T07:12:52Z", "message": "IGNITE-12921: code review fixes."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "9a35215139e3af529e8e7d9531facdfebea6a643", "author": {"user": {"login": "nizhikov", "name": "Nikolay"}}, "url": "https://github.com/apache/ignite/commit/9a35215139e3af529e8e7d9531facdfebea6a643", "committedDate": "2020-08-18T07:28:55Z", "message": "IGNITE-12921: code review fixes."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "583e005725800c24788780c2fd80903a9356e01f", "author": {"user": {"login": "nizhikov", "name": "Nikolay"}}, "url": "https://github.com/apache/ignite/commit/583e005725800c24788780c2fd80903a9356e01f", "committedDate": "2020-09-17T10:14:54Z", "message": "Merge branch 'master' into IGNITE-12921"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "310f8485b32bc4ba6f2e7446b47f0d20ab5efaef", "author": {"user": {"login": "nizhikov", "name": "Nikolay"}}, "url": "https://github.com/apache/ignite/commit/310f8485b32bc4ba6f2e7446b47f0d20ab5efaef", "committedDate": "2020-09-17T10:52:47Z", "message": "IGNITE-12921: Check added."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e9b69247ca5cc44c23ce98860ecb182daf592cf9", "author": {"user": {"login": "nizhikov", "name": "Nikolay"}}, "url": "https://github.com/apache/ignite/commit/e9b69247ca5cc44c23ce98860ecb182daf592cf9", "committedDate": "2020-09-17T12:43:26Z", "message": "IGNITE-12921: Check removed."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "d0532e2cf3161d3ceeb75b2c4754f8a97dfb7880", "author": {"user": {"login": "nizhikov", "name": "Nikolay"}}, "url": "https://github.com/apache/ignite/commit/d0532e2cf3161d3ceeb75b2c4754f8a97dfb7880", "committedDate": "2020-09-17T12:44:49Z", "message": "IGNITE-12921: Check removed."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "addb8b0da53354cd1393705eb13ab9e3b13fd370", "author": {"user": {"login": "nizhikov", "name": "Nikolay"}}, "url": "https://github.com/apache/ignite/commit/addb8b0da53354cd1393705eb13ab9e3b13fd370", "committedDate": "2020-09-17T12:59:01Z", "message": "IGNITE-12921: code style fixes"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "802d9743b9a57dd2ccb99a9f4b8aaf442f4fdfab", "author": {"user": {"login": "nizhikov", "name": "Nikolay"}}, "url": "https://github.com/apache/ignite/commit/802d9743b9a57dd2ccb99a9f4b8aaf442f4fdfab", "committedDate": "2020-09-17T13:33:59Z", "message": "IGNITE-12921: code style fixes"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "22ff7fb95fbaa802da0cba8da0250fea2b870367", "author": {"user": {"login": "nizhikov", "name": "Nikolay"}}, "url": "https://github.com/apache/ignite/commit/22ff7fb95fbaa802da0cba8da0250fea2b870367", "committedDate": "2020-09-18T10:23:20Z", "message": "Merge branch 'master' into IGNITE-12921"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "d6ec63b8ad0828a88cc81394b15f63af7c3712e3", "author": {"user": {"login": "nizhikov", "name": "Nikolay"}}, "url": "https://github.com/apache/ignite/commit/d6ec63b8ad0828a88cc81394b15f63af7c3712e3", "committedDate": "2020-09-18T10:37:39Z", "message": "IGNITE-12921: test fix"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3235, "cost": 1, "resetAt": "2021-10-29T19:57:52Z"}}}