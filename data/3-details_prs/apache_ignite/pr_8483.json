{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTI0NTAxNjE4", "number": 8483, "title": "IGNITE-13496 Java thin: make async API non-blocking with GridNioServer", "bodyText": "Refactor Java Thin Client to use GridNioServer in client mode:\n\nTrue non-blocking async\nWorker threads are shared across connections within single IgniteClient\n\nBenchmark results:\nBEFORE (master)\nBenchmark                         Mode  Cnt      Score      Error  Units\nJmhThinClientCacheBenchmark.get  thrpt   10  65916.805 \u00b1 2118.954  ops/s\nJmhThinClientCacheBenchmark.put  thrpt   10  62304.444 \u00b1 2521.371  ops/s\n\nAFTER (ignite-13496)\nBenchmark                         Mode  Cnt      Score      Error  Units\nJmhThinClientCacheBenchmark.get  thrpt   10  92501.557 \u00b1 1380.384  ops/s\nJmhThinClientCacheBenchmark.put  thrpt   10  82907.446 \u00b1 7572.537  ops/s", "createdAt": "2020-11-20T07:27:27Z", "url": "https://github.com/apache/ignite/pull/8483", "merged": true, "mergeCommit": {"oid": "338165afadd3b6979b4655ee2f03f3b9c2228236"}, "closed": true, "closedAt": "2020-12-02T16:39:26Z", "author": {"login": "ptupitsyn"}, "timelineItems": {"totalCount": 170, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdfS06BAH2gAyNTI0NTAxNjE4OjlhMjNkNGFjYzg5ZThhNTA2MDM4MjVjMDIyMmUzMGY0YjVmOGQyMmQ=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdh8vocAFqTU0MjA5MjExOQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "9a23d4acc89e8a50603825c0222e30f4b5f8d22d", "author": {"user": {"login": "ptupitsyn", "name": "Pavel Tupitsyn"}}, "url": "https://github.com/apache/ignite/commit/9a23d4acc89e8a50603825c0222e30f4b5f8d22d", "committedDate": "2020-11-23T10:44:58Z", "message": "wip TODOs"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "175d7764192e406f8ca3b4754f2c5404ee217fd8", "author": {"user": {"login": "ptupitsyn", "name": "Pavel Tupitsyn"}}, "url": "https://github.com/apache/ignite/commit/175d7764192e406f8ca3b4754f2c5404ee217fd8", "committedDate": "2020-11-23T12:31:52Z", "message": "wip fixing exception handling"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "4511dac5ebd303be24cc8859f0452e01f7338269", "author": {"user": {"login": "ptupitsyn", "name": "Pavel Tupitsyn"}}, "url": "https://github.com/apache/ignite/commit/4511dac5ebd303be24cc8859f0452e01f7338269", "committedDate": "2020-11-24T08:02:44Z", "message": "Clean up GridNioServer if TcpIgniteClient constructor fails"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f997d8e3a9a5d5a67648b10d309e8188933b87d3", "author": {"user": {"login": "ptupitsyn", "name": "Pavel Tupitsyn"}}, "url": "https://github.com/apache/ignite/commit/f997d8e3a9a5d5a67648b10d309e8188933b87d3", "committedDate": "2020-11-24T08:21:40Z", "message": "Fix resource cleanup in ConnectToStartingNodeTest"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "295e7c031c499fc996fc99d4444fe54ffc44cd58", "author": {"user": {"login": "ptupitsyn", "name": "Pavel Tupitsyn"}}, "url": "https://github.com/apache/ignite/commit/295e7c031c499fc996fc99d4444fe54ffc44cd58", "committedDate": "2020-11-24T08:53:37Z", "message": "Fix handshake timeout handling"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "cd4427e12b88147a847f9918dd4dd4484b467df2", "author": {"user": {"login": "ptupitsyn", "name": "Pavel Tupitsyn"}}, "url": "https://github.com/apache/ignite/commit/cd4427e12b88147a847f9918dd4dd4484b467df2", "committedDate": "2020-11-24T12:18:26Z", "message": "Fix operation timeout handling"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "81bbe9c2118139cac1a894378a04a2a3ba4f6058", "author": {"user": {"login": "ptupitsyn", "name": "Pavel Tupitsyn"}}, "url": "https://github.com/apache/ignite/commit/81bbe9c2118139cac1a894378a04a2a3ba4f6058", "committedDate": "2020-11-24T12:22:47Z", "message": "All tests pass!"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "38981dcbfedb9c3a8cea0370d59215740348fe86", "author": {"user": {"login": "ptupitsyn", "name": "Pavel Tupitsyn"}}, "url": "https://github.com/apache/ignite/commit/38981dcbfedb9c3a8cea0370d59215740348fe86", "committedDate": "2020-11-24T13:44:21Z", "message": "Fixing checkstyle"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "aab7d1dee312b1b58dce4e05be7e82dc82aa8d68", "author": {"user": {"login": "ptupitsyn", "name": "Pavel Tupitsyn"}}, "url": "https://github.com/apache/ignite/commit/aab7d1dee312b1b58dce4e05be7e82dc82aa8d68", "committedDate": "2020-11-24T14:02:38Z", "message": "wip cleanup"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "220a64cfcc877a5909697999370921d0c561d4e6", "author": {"user": {"login": "ptupitsyn", "name": "Pavel Tupitsyn"}}, "url": "https://github.com/apache/ignite/commit/220a64cfcc877a5909697999370921d0c561d4e6", "committedDate": "2020-11-24T14:07:13Z", "message": "wip cleanup"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ecd54fbf615b4ab324bf6e0fb1afc5225e2ce75c", "author": {"user": {"login": "ptupitsyn", "name": "Pavel Tupitsyn"}}, "url": "https://github.com/apache/ignite/commit/ecd54fbf615b4ab324bf6e0fb1afc5225e2ce75c", "committedDate": "2020-11-24T15:07:12Z", "message": "wip cleanup"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "71ec9dfbd8993ecb87c83f5548ee72e93747ad58", "author": {"user": {"login": "ptupitsyn", "name": "Pavel Tupitsyn"}}, "url": "https://github.com/apache/ignite/commit/71ec9dfbd8993ecb87c83f5548ee72e93747ad58", "committedDate": "2020-11-24T15:14:18Z", "message": "wip cleanup"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "1ad021cca41339d3f722ede5488cabb51c2f7e73", "author": {"user": {"login": "ptupitsyn", "name": "Pavel Tupitsyn"}}, "url": "https://github.com/apache/ignite/commit/1ad021cca41339d3f722ede5488cabb51c2f7e73", "committedDate": "2020-11-24T15:53:53Z", "message": "wip cleanup"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b075750c135a36ed09c407892fdc589cbbc5cdb1", "author": {"user": {"login": "ptupitsyn", "name": "Pavel Tupitsyn"}}, "url": "https://github.com/apache/ignite/commit/b075750c135a36ed09c407892fdc589cbbc5cdb1", "committedDate": "2020-11-24T16:22:16Z", "message": "wip cleanup"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "bfbb8c544b527fa70b893189314adc772a667c0c", "author": {"user": {"login": "ptupitsyn", "name": "Pavel Tupitsyn"}}, "url": "https://github.com/apache/ignite/commit/bfbb8c544b527fa70b893189314adc772a667c0c", "committedDate": "2020-11-24T16:27:40Z", "message": "wip cleanup"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a313af3dbf50301a863bf93aad04799db58884ff", "author": {"user": {"login": "ptupitsyn", "name": "Pavel Tupitsyn"}}, "url": "https://github.com/apache/ignite/commit/a313af3dbf50301a863bf93aad04799db58884ff", "committedDate": "2020-11-24T16:40:33Z", "message": "Fixing exception propagation"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "4c6f9f60b9c6383aeb2f01300af0a36857f7a4b0", "author": {"user": {"login": "ptupitsyn", "name": "Pavel Tupitsyn"}}, "url": "https://github.com/apache/ignite/commit/4c6f9f60b9c6383aeb2f01300af0a36857f7a4b0", "committedDate": "2020-11-24T17:14:00Z", "message": "Fixing exception propagation"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b0c776d252be9248f9d477b03cc601ea1d5c0f21", "author": {"user": {"login": "ptupitsyn", "name": "Pavel Tupitsyn"}}, "url": "https://github.com/apache/ignite/commit/b0c776d252be9248f9d477b03cc601ea1d5c0f21", "committedDate": "2020-11-24T17:14:47Z", "message": "Remove locking from TcpClientChannel"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "da983a0e6d30bb0eb8b5d58d27621344dada0d74", "author": {"user": {"login": "ptupitsyn", "name": "Pavel Tupitsyn"}}, "url": "https://github.com/apache/ignite/commit/da983a0e6d30bb0eb8b5d58d27621344dada0d74", "committedDate": "2020-11-24T17:41:49Z", "message": "Cleanup"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "3511525f16f100075bf40388d48fb1b2929ea18d", "author": {"user": {"login": "ptupitsyn", "name": "Pavel Tupitsyn"}}, "url": "https://github.com/apache/ignite/commit/3511525f16f100075bf40388d48fb1b2929ea18d", "committedDate": "2020-11-24T17:43:20Z", "message": "Cleanup"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "4e720e1dbb709f7043eb20dfdf0a3bceac108640", "author": {"user": {"login": "ptupitsyn", "name": "Pavel Tupitsyn"}}, "url": "https://github.com/apache/ignite/commit/4e720e1dbb709f7043eb20dfdf0a3bceac108640", "committedDate": "2020-11-24T18:41:41Z", "message": "Cleanup"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "7838d13d9a2ee4dd0b516694b4f375e53de68f0d", "author": {"user": {"login": "ptupitsyn", "name": "Pavel Tupitsyn"}}, "url": "https://github.com/apache/ignite/commit/7838d13d9a2ee4dd0b516694b4f375e53de68f0d", "committedDate": "2020-11-24T18:42:30Z", "message": "Cleanup"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "eb7959922287b39d98f294496e5e208c385011ed", "author": {"user": {"login": "ptupitsyn", "name": "Pavel Tupitsyn"}}, "url": "https://github.com/apache/ignite/commit/eb7959922287b39d98f294496e5e208c385011ed", "committedDate": "2020-11-24T18:57:48Z", "message": "Fix exception propagation during write"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "5fd49fff22896d840e697a3d8719859e3d7d7ed1", "author": {"user": {"login": "ptupitsyn", "name": "Pavel Tupitsyn"}}, "url": "https://github.com/apache/ignite/commit/5fd49fff22896d840e697a3d8719859e3d7d7ed1", "committedDate": "2020-11-24T19:02:34Z", "message": "imports cleanup"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "45e6fe411a1ff1a421ec0efc49838a2931eda1a7", "author": {"user": {"login": "ptupitsyn", "name": "Pavel Tupitsyn"}}, "url": "https://github.com/apache/ignite/commit/45e6fe411a1ff1a421ec0efc49838a2931eda1a7", "committedDate": "2020-11-24T19:03:02Z", "message": "imports cleanup"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "95b37a221cc544ed0855737a0d51005abe966642", "author": {"user": {"login": "ptupitsyn", "name": "Pavel Tupitsyn"}}, "url": "https://github.com/apache/ignite/commit/95b37a221cc544ed0855737a0d51005abe966642", "committedDate": "2020-11-24T19:05:33Z", "message": "imports cleanup"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "fe6dd44d4caf91f0d75a9fb652580a7d628cfa1a", "author": {"user": {"login": "ptupitsyn", "name": "Pavel Tupitsyn"}}, "url": "https://github.com/apache/ignite/commit/fe6dd44d4caf91f0d75a9fb652580a7d628cfa1a", "committedDate": "2020-11-24T19:05:51Z", "message": "imports cleanup"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "65444d05f1042700640ca708e81c1debba31ad68", "author": {"user": {"login": "ptupitsyn", "name": "Pavel Tupitsyn"}}, "url": "https://github.com/apache/ignite/commit/65444d05f1042700640ca708e81c1debba31ad68", "committedDate": "2020-11-24T19:10:04Z", "message": "comments cleanup"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "630af97e457d10e03b98abcfe59cc2382d806bc6", "author": {"user": {"login": "ptupitsyn", "name": "Pavel Tupitsyn"}}, "url": "https://github.com/apache/ignite/commit/630af97e457d10e03b98abcfe59cc2382d806bc6", "committedDate": "2020-11-25T06:29:47Z", "message": "Merge remote-tracking branch 'origin/master' into ignite-13496"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "9a3a2ebbf5feb8f2e77e1386f17d98fc5c70e1cc", "author": {"user": {"login": "ptupitsyn", "name": "Pavel Tupitsyn"}}, "url": "https://github.com/apache/ignite/commit/9a3a2ebbf5feb8f2e77e1386f17d98fc5c70e1cc", "committedDate": "2020-11-25T09:31:12Z", "message": "Adding thin client JMH benchmarks"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f20eddc90ec24de923bb458ea1611b86fbb61983", "author": {"user": {"login": "ptupitsyn", "name": "Pavel Tupitsyn"}}, "url": "https://github.com/apache/ignite/commit/f20eddc90ec24de923bb458ea1611b86fbb61983", "committedDate": "2020-11-25T09:41:03Z", "message": "wip Adding thin client JMH benchmarks"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "7f020a71fb117296489f3ace4f81cae8d1f14214", "author": {"user": {"login": "ptupitsyn", "name": "Pavel Tupitsyn"}}, "url": "https://github.com/apache/ignite/commit/7f020a71fb117296489f3ace4f81cae8d1f14214", "committedDate": "2020-11-25T09:43:43Z", "message": "wip Adding thin client JMH benchmarks"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "fb84e7df262c6e0965bb983d478213f20c07ce82", "author": {"user": {"login": "ptupitsyn", "name": "Pavel Tupitsyn"}}, "url": "https://github.com/apache/ignite/commit/fb84e7df262c6e0965bb983d478213f20c07ce82", "committedDate": "2020-11-25T12:53:32Z", "message": "Merge branch 'master' into ignite-13496"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "90b5d78c0b721e2f8f69883d04f6c0756c1ccd17", "author": {"user": {"login": "ptupitsyn", "name": "Pavel Tupitsyn"}}, "url": "https://github.com/apache/ignite/commit/90b5d78c0b721e2f8f69883d04f6c0756c1ccd17", "committedDate": "2020-11-25T13:03:26Z", "message": "wip thin client benchmarks"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ab362f8441cc16698137fa8f08f909edbb485a6d", "author": {"user": {"login": "ptupitsyn", "name": "Pavel Tupitsyn"}}, "url": "https://github.com/apache/ignite/commit/ab362f8441cc16698137fa8f08f909edbb485a6d", "committedDate": "2020-11-25T13:04:42Z", "message": "wip thin client benchmarks"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "6e12482f77f19da9649cd240a50b9038f1269de4", "author": {"user": {"login": "ptupitsyn", "name": "Pavel Tupitsyn"}}, "url": "https://github.com/apache/ignite/commit/6e12482f77f19da9649cd240a50b9038f1269de4", "committedDate": "2020-11-25T13:32:26Z", "message": "wip thin client benchmarks"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "52f89f6cedb0765a7b7b36836305f69963a97e9f", "author": {"user": {"login": "ptupitsyn", "name": "Pavel Tupitsyn"}}, "url": "https://github.com/apache/ignite/commit/52f89f6cedb0765a7b7b36836305f69963a97e9f", "committedDate": "2020-11-25T13:41:00Z", "message": "wip thin client benchmarks"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c1ba3b60fcdf1f33fdcdd5d25d535669cf7fff83", "author": {"user": {"login": "ptupitsyn", "name": "Pavel Tupitsyn"}}, "url": "https://github.com/apache/ignite/commit/c1ba3b60fcdf1f33fdcdd5d25d535669cf7fff83", "committedDate": "2020-11-25T13:45:17Z", "message": "wip thin client benchmarks"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "87801bf8277bb0fd58db3c3bbdd5c453257d771f", "author": {"user": {"login": "ptupitsyn", "name": "Pavel Tupitsyn"}}, "url": "https://github.com/apache/ignite/commit/87801bf8277bb0fd58db3c3bbdd5c453257d771f", "committedDate": "2020-11-25T13:47:56Z", "message": "wip thin client benchmarks"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ea2de648f66af8a8948777840785b0efabcc1a90", "author": {"user": {"login": "ptupitsyn", "name": "Pavel Tupitsyn"}}, "url": "https://github.com/apache/ignite/commit/ea2de648f66af8a8948777840785b0efabcc1a90", "committedDate": "2020-11-25T13:50:07Z", "message": "wip thin client benchmarks"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "8e93fe2cf8f85808ad39a228131bd1277ff4e036", "author": {"user": {"login": "ptupitsyn", "name": "Pavel Tupitsyn"}}, "url": "https://github.com/apache/ignite/commit/8e93fe2cf8f85808ad39a228131bd1277ff4e036", "committedDate": "2020-11-25T14:02:09Z", "message": "wip thin client benchmarks"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c7c8ee1c6db3bcc328038d77190d3324425d64ef", "author": {"user": {"login": "ptupitsyn", "name": "Pavel Tupitsyn"}}, "url": "https://github.com/apache/ignite/commit/c7c8ee1c6db3bcc328038d77190d3324425d64ef", "committedDate": "2020-11-25T14:20:22Z", "message": "wip thin client benchmarks - investigate hangs"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "6e42984d1f10f356989801bedace59d443446a9f", "author": {"user": {"login": "ptupitsyn", "name": "Pavel Tupitsyn"}}, "url": "https://github.com/apache/ignite/commit/6e42984d1f10f356989801bedace59d443446a9f", "committedDate": "2020-11-25T14:35:48Z", "message": "wip thin client benchmarks - investigate hangs"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "323ef1faab68c0086435f71cdbd5b9da5c5e5aef", "author": {"user": {"login": "ptupitsyn", "name": "Pavel Tupitsyn"}}, "url": "https://github.com/apache/ignite/commit/323ef1faab68c0086435f71cdbd5b9da5c5e5aef", "committedDate": "2020-11-25T14:36:37Z", "message": "wip thin client benchmarks - investigate hangs"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "9bf57846e8d49de9f259075bf70f81a9a36d01cb", "author": {"user": {"login": "ptupitsyn", "name": "Pavel Tupitsyn"}}, "url": "https://github.com/apache/ignite/commit/9bf57846e8d49de9f259075bf70f81a9a36d01cb", "committedDate": "2020-11-25T14:37:11Z", "message": "wip thin client benchmarks - investigate hangs"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "cea96374fa05c3c8cde07a4b30af1ffed3b8d6de", "author": {"user": {"login": "ptupitsyn", "name": "Pavel Tupitsyn"}}, "url": "https://github.com/apache/ignite/commit/cea96374fa05c3c8cde07a4b30af1ffed3b8d6de", "committedDate": "2020-11-25T15:02:15Z", "message": "wip thin client benchmarks - TODOs about IGNITE_IO_BALANCE_PERIOD"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "2e7079cebd3572177d178f8533d7543c95b5990c", "author": {"user": {"login": "ptupitsyn", "name": "Pavel Tupitsyn"}}, "url": "https://github.com/apache/ignite/commit/2e7079cebd3572177d178f8533d7543c95b5990c", "committedDate": "2020-11-26T10:44:31Z", "message": "Put ClientMessageDecoder to session meta - fix race conditions across multiple sessions / selectors"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "52ee53dfc5c4d7515a0db3deaa81893082d56797", "author": {"user": {"login": "ptupitsyn", "name": "Pavel Tupitsyn"}}, "url": "https://github.com/apache/ignite/commit/52ee53dfc5c4d7515a0db3deaa81893082d56797", "committedDate": "2020-11-26T10:52:06Z", "message": "Benchmark cleanup"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c18175e88ba3943f5e282153da1c2cf944361810", "author": {"user": {"login": "ptupitsyn", "name": "Pavel Tupitsyn"}}, "url": "https://github.com/apache/ignite/commit/c18175e88ba3943f5e282153da1c2cf944361810", "committedDate": "2020-11-26T11:26:17Z", "message": "cleanup"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "366539fc1ac9ab30f39fdf075a0692d10a11670d", "author": {"user": {"login": "ptupitsyn", "name": "Pavel Tupitsyn"}}, "url": "https://github.com/apache/ignite/commit/366539fc1ac9ab30f39fdf075a0692d10a11670d", "committedDate": "2020-11-26T11:28:02Z", "message": "Add benchmark results to xmldoc"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "32e107621ebb430deebfb1714f2cba02db17fb8d", "author": {"user": {"login": "ptupitsyn", "name": "Pavel Tupitsyn"}}, "url": "https://github.com/apache/ignite/commit/32e107621ebb430deebfb1714f2cba02db17fb8d", "committedDate": "2020-11-26T11:33:00Z", "message": "fix license headers"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "7ec65888fe9086160e589cd1488e45f78845696c", "author": {"user": {"login": "ptupitsyn", "name": "Pavel Tupitsyn"}}, "url": "https://github.com/apache/ignite/commit/7ec65888fe9086160e589cd1488e45f78845696c", "committedDate": "2020-11-26T11:38:32Z", "message": "Merge remote-tracking branch 'origin/master' into ignite-13496"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "8ea125f43ac263c24c3bf2b8233c8f49c91141aa", "author": {"user": {"login": "ptupitsyn", "name": "Pavel Tupitsyn"}}, "url": "https://github.com/apache/ignite/commit/8ea125f43ac263c24c3bf2b8233c8f49c91141aa", "committedDate": "2020-11-26T11:39:06Z", "message": "cleanup"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "95471e8b15f0c14681350a900e3c1c5a2e57e74a", "author": {"user": {"login": "ptupitsyn", "name": "Pavel Tupitsyn"}}, "url": "https://github.com/apache/ignite/commit/95471e8b15f0c14681350a900e3c1c5a2e57e74a", "committedDate": "2020-11-26T11:42:17Z", "message": "BinaryByteBufferInputStream cleanup"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "3e06fe305b56e7df401dcb783a90fffd2a7bd0e9", "author": {"user": {"login": "ptupitsyn", "name": "Pavel Tupitsyn"}}, "url": "https://github.com/apache/ignite/commit/3e06fe305b56e7df401dcb783a90fffd2a7bd0e9", "committedDate": "2020-11-26T11:45:12Z", "message": "BinaryByteBufferInputStream cleanup"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "aa57ebf88a9dd81ba54a80d2c3b6657f5b7ca893", "author": {"user": {"login": "ptupitsyn", "name": "Pavel Tupitsyn"}}, "url": "https://github.com/apache/ignite/commit/aa57ebf88a9dd81ba54a80d2c3b6657f5b7ca893", "committedDate": "2020-11-26T12:03:07Z", "message": "comments cleanup"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "eb29f33ac3ff668b567a5e3d863558445b029fbe", "author": {"user": {"login": "ptupitsyn", "name": "Pavel Tupitsyn"}}, "url": "https://github.com/apache/ignite/commit/eb29f33ac3ff668b567a5e3d863558445b029fbe", "committedDate": "2020-11-26T12:10:22Z", "message": "comments cleanup"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTM5MzE2ODg0", "url": "https://github.com/apache/ignite/pull/8483#pullrequestreview-539316884", "createdAt": "2020-11-26T13:31:00Z", "commit": {"oid": "eb29f33ac3ff668b567a5e3d863558445b029fbe"}, "state": "APPROVED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0yNlQxMzozMTowMFrOH6bjPA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0yNlQxMzozMTowMFrOH6bjPA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMTAzMDg0NA==", "bodyText": "Maybe we should also specify the hardware used to get those results.", "url": "https://github.com/apache/ignite/pull/8483#discussion_r531030844", "createdAt": "2020-11-26T13:31:00Z", "author": {"login": "isapego"}, "path": "modules/benchmarks/src/main/java/org/apache/ignite/internal/benchmarks/jmh/thin/JmhThinClientCacheBenchmark.java", "diffHunk": "@@ -0,0 +1,67 @@\n+/*\n+ * Licensed to the Apache Software Foundation (ASF) under one or more\n+ * contributor license agreements.  See the NOTICE file distributed with\n+ * this work for additional information regarding copyright ownership.\n+ * The ASF licenses this file to You under the Apache License, Version 2.0\n+ * (the \"License\"); you may not use this file except in compliance with\n+ * the License.  You may obtain a copy of the License at\n+ *\n+ *      http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package org.apache.ignite.internal.benchmarks.jmh.thin;\n+\n+import java.util.concurrent.ThreadLocalRandom;\n+\n+import org.apache.ignite.internal.benchmarks.jmh.runner.JmhIdeBenchmarkRunner;\n+import org.openjdk.jmh.annotations.Benchmark;\n+\n+/**\n+ * Thin client cache benchmark.\n+ *\n+ * Benchmark                         Mode  Cnt      Score      Error  Units\n+ * JmhThinClientCacheBenchmark.get  thrpt   10  92501.557 \u00b1 1380.384  ops/s\n+ * JmhThinClientCacheBenchmark.put  thrpt   10  82907.446 \u00b1 7572.537  ops/s", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "eb29f33ac3ff668b567a5e3d863558445b029fbe"}, "originalPosition": 30}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "1f523fd3f9d957f528dfb4258d7af798eb3370be", "author": {"user": {"login": "ptupitsyn", "name": "Pavel Tupitsyn"}}, "url": "https://github.com/apache/ignite/commit/1f523fd3f9d957f528dfb4258d7af798eb3370be", "committedDate": "2020-11-30T07:48:04Z", "message": "Merge remote-tracking branch 'origin/master' into ignite-13496\n\n# Conflicts:\n#\tmodules/core/src/main/java/org/apache/ignite/internal/client/thin/TcpClientChannel.java\n\n(port \"IGNITE-13730 Unify fallback property for SSL key store provider\" changes to ClientSslUtils)"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "054bf139a27909223f8f1b6f929d2d3431a1f774", "author": {"user": {"login": "ptupitsyn", "name": "Pavel Tupitsyn"}}, "url": "https://github.com/apache/ignite/commit/054bf139a27909223f8f1b6f929d2d3431a1f774", "committedDate": "2020-11-30T09:11:32Z", "message": "Add latency benchmark, update results, specify system config"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTQxNjgwNjc1", "url": "https://github.com/apache/ignite/pull/8483#pullrequestreview-541680675", "createdAt": "2020-12-01T09:07:16Z", "commit": {"oid": "054bf139a27909223f8f1b6f929d2d3431a1f774"}, "state": "COMMENTED", "comments": {"totalCount": 16, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0wMVQwOTowNzoxNlrOH8fLQw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0wMVQxMTozNzowOVrOH8op3A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMzE4NzM5NQ==", "bodyText": "NL between } and catch according to code style", "url": "https://github.com/apache/ignite/pull/8483#discussion_r533187395", "createdAt": "2020-12-01T09:07:16Z", "author": {"login": "alex-plekhanov"}, "path": "modules/core/src/main/java/org/apache/ignite/internal/client/thin/TcpIgniteClient.java", "diffHunk": "@@ -116,18 +117,23 @@ private TcpIgniteClient(ClientConfiguration cfg) throws ClientException {\n \n         ch = new ReliableChannel(chFactory, cfg, binary);\n \n-        ch.channelsInit();\n+        try {\n+            ch.channelsInit();\n \n-        ch.addChannelFailListener(() -> metadataHandler.onReconnect());\n+            ch.addChannelFailListener(() -> metadataHandler.onReconnect());\n \n-        transactions = new TcpClientTransactions(ch, marsh,\n-            new ClientTransactionConfiguration(cfg.getTransactionConfiguration()));\n+            transactions = new TcpClientTransactions(ch, marsh,\n+                    new ClientTransactionConfiguration(cfg.getTransactionConfiguration()));\n \n-        cluster = new ClientClusterImpl(ch, marsh);\n+            cluster = new ClientClusterImpl(ch, marsh);\n \n-        compute = new ClientComputeImpl(ch, marsh, cluster.defaultClusterGroup());\n+            compute = new ClientComputeImpl(ch, marsh, cluster.defaultClusterGroup());\n \n-        services = new ClientServicesImpl(ch, marsh, cluster.defaultClusterGroup());\n+            services = new ClientServicesImpl(ch, marsh, cluster.defaultClusterGroup());\n+        } catch (Exception e) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "054bf139a27909223f8f1b6f929d2d3431a1f774"}, "originalPosition": 53}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMzE4NzYzNA==", "bodyText": "NL between } and catch according to code style", "url": "https://github.com/apache/ignite/pull/8483#discussion_r533187634", "createdAt": "2020-12-01T09:07:27Z", "author": {"login": "alex-plekhanov"}, "path": "modules/core/src/main/java/org/apache/ignite/internal/client/thin/io/gridnioserver/GridNioClientConnectionMultiplexer.java", "diffHunk": "@@ -0,0 +1,143 @@\n+/*\n+ * Licensed to the Apache Software Foundation (ASF) under one or more\n+ * contributor license agreements.  See the NOTICE file distributed with\n+ * this work for additional information regarding copyright ownership.\n+ * The ASF licenses this file to You under the Apache License, Version 2.0\n+ * (the \"License\"); you may not use this file except in compliance with\n+ * the License.  You may obtain a copy of the License at\n+ *\n+ *      http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package org.apache.ignite.internal.client.thin.io.gridnioserver;\n+\n+import java.net.InetSocketAddress;\n+import java.nio.ByteBuffer;\n+import java.nio.ByteOrder;\n+import java.util.HashMap;\n+import java.util.Map;\n+import javax.net.ssl.SSLContext;\n+\n+import org.apache.ignite.IgniteCheckedException;\n+import org.apache.ignite.IgniteException;\n+import org.apache.ignite.IgniteLogger;\n+import org.apache.ignite.client.ClientConnectionException;\n+import org.apache.ignite.configuration.ClientConfiguration;\n+import org.apache.ignite.internal.client.thin.ClientSslUtils;\n+import org.apache.ignite.internal.client.thin.io.ClientConnection;\n+import org.apache.ignite.internal.client.thin.io.ClientConnectionMultiplexer;\n+import org.apache.ignite.internal.client.thin.io.ClientConnectionStateHandler;\n+import org.apache.ignite.internal.client.thin.io.ClientMessageHandler;\n+import org.apache.ignite.internal.util.nio.GridNioCodecFilter;\n+import org.apache.ignite.internal.util.nio.GridNioFilter;\n+import org.apache.ignite.internal.util.nio.GridNioFuture;\n+import org.apache.ignite.internal.util.nio.GridNioFutureImpl;\n+import org.apache.ignite.internal.util.nio.GridNioServer;\n+import org.apache.ignite.internal.util.nio.GridNioSession;\n+import org.apache.ignite.internal.util.nio.ssl.GridNioSslFilter;\n+import org.apache.ignite.logger.NullLogger;\n+\n+/**\n+ * Client connection multiplexer based on {@link org.apache.ignite.internal.util.nio.GridNioServer}.\n+ */\n+public class GridNioClientConnectionMultiplexer implements ClientConnectionMultiplexer {\n+    /** Worker thread prefix. */\n+    private static final String THREAD_PREFIX = \"thin-client-channel\";\n+\n+    /** */\n+    private static final int CLIENT_MODE_PORT = -1;\n+\n+    /** */\n+    private final GridNioServer<ByteBuffer> srv;\n+\n+    /** */\n+    private final SSLContext sslCtx;\n+\n+    /**\n+     * Constructor.\n+     *\n+     * @param cfg Client config.\n+     */\n+    public GridNioClientConnectionMultiplexer(ClientConfiguration cfg) {\n+        IgniteLogger gridLog = new NullLogger();\n+\n+        GridNioFilter[] filters;\n+\n+        GridNioFilter codecFilter = new GridNioCodecFilter(new GridNioClientParser(), gridLog, false);\n+\n+        sslCtx = ClientSslUtils.getSslContext(cfg);\n+\n+        if (sslCtx != null) {\n+            GridNioSslFilter sslFilter = new GridNioSslFilter(sslCtx, true, ByteOrder.nativeOrder(), gridLog);\n+            sslFilter.directMode(false);\n+            filters = new GridNioFilter[]{codecFilter, sslFilter};\n+        } else\n+            filters = new GridNioFilter[]{codecFilter};\n+\n+        try {\n+            srv = GridNioServer.<ByteBuffer>builder()\n+                    .port(CLIENT_MODE_PORT)\n+                    .listener(new GridNioClientListener())\n+                    .filters(filters)\n+                    .logger(gridLog)\n+                    .selectorCount(1) // Using more selectors does not seem to improve performance.\n+                    .byteOrder(ByteOrder.nativeOrder())\n+                    .directBuffer(true)\n+                    .directMode(false)\n+                    .igniteInstanceName(\"thinClient\")\n+                    .serverName(THREAD_PREFIX)\n+                    .idleTimeout(Long.MAX_VALUE)\n+                    .socketReceiveBufferSize(cfg.getReceiveBufferSize())\n+                    .socketSendBufferSize(cfg.getSendBufferSize())\n+                    .tcpNoDelay(true)\n+                    .build();\n+        } catch (IgniteCheckedException e) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "054bf139a27909223f8f1b6f929d2d3431a1f774"}, "originalPosition": 100}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMzE4Nzc3Nw==", "bodyText": "NL between } and catch according to code style", "url": "https://github.com/apache/ignite/pull/8483#discussion_r533187777", "createdAt": "2020-12-01T09:07:37Z", "author": {"login": "alex-plekhanov"}, "path": "modules/core/src/main/java/org/apache/ignite/internal/client/thin/io/gridnioserver/GridNioClientConnectionMultiplexer.java", "diffHunk": "@@ -0,0 +1,143 @@\n+/*\n+ * Licensed to the Apache Software Foundation (ASF) under one or more\n+ * contributor license agreements.  See the NOTICE file distributed with\n+ * this work for additional information regarding copyright ownership.\n+ * The ASF licenses this file to You under the Apache License, Version 2.0\n+ * (the \"License\"); you may not use this file except in compliance with\n+ * the License.  You may obtain a copy of the License at\n+ *\n+ *      http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package org.apache.ignite.internal.client.thin.io.gridnioserver;\n+\n+import java.net.InetSocketAddress;\n+import java.nio.ByteBuffer;\n+import java.nio.ByteOrder;\n+import java.util.HashMap;\n+import java.util.Map;\n+import javax.net.ssl.SSLContext;\n+\n+import org.apache.ignite.IgniteCheckedException;\n+import org.apache.ignite.IgniteException;\n+import org.apache.ignite.IgniteLogger;\n+import org.apache.ignite.client.ClientConnectionException;\n+import org.apache.ignite.configuration.ClientConfiguration;\n+import org.apache.ignite.internal.client.thin.ClientSslUtils;\n+import org.apache.ignite.internal.client.thin.io.ClientConnection;\n+import org.apache.ignite.internal.client.thin.io.ClientConnectionMultiplexer;\n+import org.apache.ignite.internal.client.thin.io.ClientConnectionStateHandler;\n+import org.apache.ignite.internal.client.thin.io.ClientMessageHandler;\n+import org.apache.ignite.internal.util.nio.GridNioCodecFilter;\n+import org.apache.ignite.internal.util.nio.GridNioFilter;\n+import org.apache.ignite.internal.util.nio.GridNioFuture;\n+import org.apache.ignite.internal.util.nio.GridNioFutureImpl;\n+import org.apache.ignite.internal.util.nio.GridNioServer;\n+import org.apache.ignite.internal.util.nio.GridNioSession;\n+import org.apache.ignite.internal.util.nio.ssl.GridNioSslFilter;\n+import org.apache.ignite.logger.NullLogger;\n+\n+/**\n+ * Client connection multiplexer based on {@link org.apache.ignite.internal.util.nio.GridNioServer}.\n+ */\n+public class GridNioClientConnectionMultiplexer implements ClientConnectionMultiplexer {\n+    /** Worker thread prefix. */\n+    private static final String THREAD_PREFIX = \"thin-client-channel\";\n+\n+    /** */\n+    private static final int CLIENT_MODE_PORT = -1;\n+\n+    /** */\n+    private final GridNioServer<ByteBuffer> srv;\n+\n+    /** */\n+    private final SSLContext sslCtx;\n+\n+    /**\n+     * Constructor.\n+     *\n+     * @param cfg Client config.\n+     */\n+    public GridNioClientConnectionMultiplexer(ClientConfiguration cfg) {\n+        IgniteLogger gridLog = new NullLogger();\n+\n+        GridNioFilter[] filters;\n+\n+        GridNioFilter codecFilter = new GridNioCodecFilter(new GridNioClientParser(), gridLog, false);\n+\n+        sslCtx = ClientSslUtils.getSslContext(cfg);\n+\n+        if (sslCtx != null) {\n+            GridNioSslFilter sslFilter = new GridNioSslFilter(sslCtx, true, ByteOrder.nativeOrder(), gridLog);\n+            sslFilter.directMode(false);\n+            filters = new GridNioFilter[]{codecFilter, sslFilter};\n+        } else\n+            filters = new GridNioFilter[]{codecFilter};\n+\n+        try {\n+            srv = GridNioServer.<ByteBuffer>builder()\n+                    .port(CLIENT_MODE_PORT)\n+                    .listener(new GridNioClientListener())\n+                    .filters(filters)\n+                    .logger(gridLog)\n+                    .selectorCount(1) // Using more selectors does not seem to improve performance.\n+                    .byteOrder(ByteOrder.nativeOrder())\n+                    .directBuffer(true)\n+                    .directMode(false)\n+                    .igniteInstanceName(\"thinClient\")\n+                    .serverName(THREAD_PREFIX)\n+                    .idleTimeout(Long.MAX_VALUE)\n+                    .socketReceiveBufferSize(cfg.getReceiveBufferSize())\n+                    .socketSendBufferSize(cfg.getSendBufferSize())\n+                    .tcpNoDelay(true)\n+                    .build();\n+        } catch (IgniteCheckedException e) {\n+            throw new IgniteException(e);\n+        }\n+    }\n+\n+    /** {@inheritDoc} */\n+    @Override public void start() {\n+        srv.start();\n+    }\n+\n+    /** {@inheritDoc} */\n+    @Override public void stop() {\n+        srv.stop();\n+    }\n+\n+    /** {@inheritDoc} */\n+    @Override public ClientConnection open(InetSocketAddress addr,\n+                                           ClientMessageHandler msgHnd,\n+                                           ClientConnectionStateHandler stateHnd)\n+            throws ClientConnectionException {\n+        try {\n+            java.nio.channels.SocketChannel ch = java.nio.channels.SocketChannel.open();\n+            ch.socket().connect(new InetSocketAddress(addr.getHostName(), addr.getPort()), Integer.MAX_VALUE);\n+\n+            Map<Integer, Object> meta = new HashMap<>();\n+            GridNioFuture<?> sslHandshakeFut = null;\n+\n+            if (sslCtx != null) {\n+                sslHandshakeFut = new GridNioFutureImpl<>(null);\n+\n+                meta.put(GridNioSslFilter.HANDSHAKE_FUT_META_KEY, sslHandshakeFut);\n+            }\n+\n+            GridNioSession ses = srv.createSession(ch, meta, false, null).get();\n+\n+            if (sslHandshakeFut != null)\n+                sslHandshakeFut.get();\n+\n+            return new GridNioClientConnection(ses, msgHnd, stateHnd);\n+        } catch (Exception e) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "054bf139a27909223f8f1b6f929d2d3431a1f774"}, "originalPosition": 139}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMzE5MTU1NA==", "bodyText": "NL after }", "url": "https://github.com/apache/ignite/pull/8483#discussion_r533191554", "createdAt": "2020-12-01T09:10:44Z", "author": {"login": "alex-plekhanov"}, "path": "modules/core/src/test/java/org/apache/ignite/client/ConnectToStartingNodeTest.java", "diffHunk": "@@ -71,14 +71,20 @@ public void testClientConnectBeforeDiscoveryStart() throws Exception {\n         IgniteInternalFuture<IgniteClient> futStartClient = GridTestUtils.runAsync(\n             () -> startClient(grid()));\n \n-        // Server doesn't accept connection before discovery SPI started.\n-        assertFalse(GridTestUtils.waitForCondition(futStartClient::isDone, 500L));\n+        try {\n+            // Server doesn't accept connection before discovery SPI started.\n+            assertFalse(GridTestUtils.waitForCondition(futStartClient::isDone, 500L));\n \n-        barrier.await();\n+            barrier.await();\n+\n+            futStartGrid.get();\n \n-        futStartGrid.get();\n+            // Server accept connection after discovery SPI started.\n+            assertTrue(GridTestUtils.waitForCondition(futStartClient::isDone, 500L));\n+        } finally {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "054bf139a27909223f8f1b6f929d2d3431a1f774"}, "originalPosition": 18}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMzE5MjI2Ng==", "bodyText": "Redundant NL", "url": "https://github.com/apache/ignite/pull/8483#discussion_r533192266", "createdAt": "2020-12-01T09:11:19Z", "author": {"login": "alex-plekhanov"}, "path": "modules/core/src/test/java/org/apache/ignite/client/ConnectToStartingNodeTest.java", "diffHunk": "@@ -71,14 +71,20 @@ public void testClientConnectBeforeDiscoveryStart() throws Exception {\n         IgniteInternalFuture<IgniteClient> futStartClient = GridTestUtils.runAsync(\n             () -> startClient(grid()));\n \n-        // Server doesn't accept connection before discovery SPI started.\n-        assertFalse(GridTestUtils.waitForCondition(futStartClient::isDone, 500L));\n+        try {\n+            // Server doesn't accept connection before discovery SPI started.\n+            assertFalse(GridTestUtils.waitForCondition(futStartClient::isDone, 500L));\n \n-        barrier.await();\n+            barrier.await();\n+\n+            futStartGrid.get();\n \n-        futStartGrid.get();\n+            // Server accept connection after discovery SPI started.\n+            assertTrue(GridTestUtils.waitForCondition(futStartClient::isDone, 500L));\n+        } finally {\n+            if (futStartClient.isDone())\n+                futStartClient.get().close();\n+        }\n ", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "054bf139a27909223f8f1b6f929d2d3431a1f774"}, "originalPosition": 22}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMzIzNDk3NA==", "bodyText": "NL between } and catch according to code style", "url": "https://github.com/apache/ignite/pull/8483#discussion_r533234974", "createdAt": "2020-12-01T09:41:41Z", "author": {"login": "alex-plekhanov"}, "path": "modules/core/src/main/java/org/apache/ignite/internal/client/thin/TcpClientChannel.java", "diffHunk": "@@ -680,12 +571,12 @@ else if (!supportedVers.contains(srvVer) ||\n \n     /** Write bytes to the output stream. */\n     private void write(byte[] bytes, int len) throws ClientConnectionException {\n+        ByteBuffer buf = ByteBuffer.wrap(bytes, 0, len);\n+\n         try {\n-            out.write(bytes, 0, len);\n-            out.flush();\n-        }\n-        catch (IOException e) {\n-            throw handleIOError(e);\n+            sock.send(buf);\n+        } catch (IgniteCheckedException e) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "054bf139a27909223f8f1b6f929d2d3431a1f774"}, "originalPosition": 471}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMzIzNTM3NA==", "bodyText": "NL between } and catch according to code style", "url": "https://github.com/apache/ignite/pull/8483#discussion_r533235374", "createdAt": "2020-12-01T09:42:01Z", "author": {"login": "alex-plekhanov"}, "path": "modules/core/src/main/java/org/apache/ignite/internal/client/thin/TcpClientChannel.java", "diffHunk": "@@ -543,31 +450,20 @@ else if (addr.getPort() < 1024 || addr.getPort() > 49151)\n             throw new IllegalArgumentException(error);\n     }\n \n-    /** Create socket. */\n-    private static Socket createSocket(ClientChannelConfiguration cfg) throws IOException {\n-        Socket sock = cfg.getSslMode() == SslMode.REQUIRED ?\n-            new ClientSslSocketFactory(cfg).create() :\n-            new Socket(cfg.getAddress().getHostName(), cfg.getAddress().getPort());\n-\n-        sock.setTcpNoDelay(cfg.isTcpNoDelay());\n-\n-        if (cfg.getTimeout() > 0)\n-            sock.setSoTimeout(cfg.getTimeout());\n-\n-        if (cfg.getSendBufferSize() > 0)\n-            sock.setSendBufferSize(cfg.getSendBufferSize());\n-\n-        if (cfg.getReceiveBufferSize() > 0)\n-            sock.setReceiveBufferSize(cfg.getReceiveBufferSize());\n-\n-        return sock;\n-    }\n-\n     /** Client handshake. */\n     private void handshake(ProtocolVersion ver, String user, String pwd, Map<String, String> userAttrs)\n         throws ClientConnectionException, ClientAuthenticationException, ClientProtocolError {\n+        ClientRequestFuture fut = new ClientRequestFuture();\n+        pendingReqs.put(-1L, fut);\n+\n         handshakeReq(ver, user, pwd, userAttrs);\n-        handshakeRes(ver, user, pwd, userAttrs);\n+\n+        try {\n+            ByteBuffer res = timeout > 0 ? fut.get(timeout) : fut.get();\n+            handshakeRes(res, ver, user, pwd, userAttrs);\n+        } catch (IgniteCheckedException e) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "054bf139a27909223f8f1b6f929d2d3431a1f774"}, "originalPosition": 419}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMzI1MzY2NQ==", "bodyText": "I don't quite understand. In PayloadOutputChannel constructor we have created a new BinaryHeapOutputStream, which doesn't leaks to anywhere. Why do we need another array copy here?", "url": "https://github.com/apache/ignite/pull/8483#discussion_r533253665", "createdAt": "2020-12-01T09:56:27Z", "author": {"login": "alex-plekhanov"}, "path": "modules/core/src/main/java/org/apache/ignite/internal/client/thin/TcpClientChannel.java", "diffHunk": "@@ -292,7 +233,8 @@ private ClientRequestFuture send(ClientOperation op, Consumer<PayloadOutputChann\n \n             req.writeInt(0, req.position() - 4); // Actual size.\n \n-            write(req.array(), req.position());\n+            // arrayCopy is required, because buffer is pooled, and write is async.\n+            write(req.arrayCopy(), req.position());", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "054bf139a27909223f8f1b6f929d2d3431a1f774"}, "originalPosition": 233}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMzI1Nzc3OQ==", "bodyText": "Wrong indent", "url": "https://github.com/apache/ignite/pull/8483#discussion_r533257779", "createdAt": "2020-12-01T09:59:44Z", "author": {"login": "alex-plekhanov"}, "path": "modules/core/src/main/java/org/apache/ignite/internal/client/thin/io/ClientMessageDecoder.java", "diffHunk": "@@ -0,0 +1,92 @@\n+/*\n+ * Licensed to the Apache Software Foundation (ASF) under one or more\n+ * contributor license agreements.  See the NOTICE file distributed with\n+ * this work for additional information regarding copyright ownership.\n+ * The ASF licenses this file to You under the Apache License, Version 2.0\n+ * (the \"License\"); you may not use this file except in compliance with\n+ * the License.  You may obtain a copy of the License at\n+ *\n+ *      http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package org.apache.ignite.internal.client.thin.io;\n+\n+import java.nio.ByteBuffer;\n+\n+/**\n+ * Decodes thin client messages from partial buffers.\n+  */", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "054bf139a27909223f8f1b6f929d2d3431a1f774"}, "originalPosition": 24}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMzI1OTUzNw==", "bodyText": "Point at the end", "url": "https://github.com/apache/ignite/pull/8483#discussion_r533259537", "createdAt": "2020-12-01T10:01:10Z", "author": {"login": "alex-plekhanov"}, "path": "modules/core/src/main/java/org/apache/ignite/internal/client/thin/io/ClientConnectionStateHandler.java", "diffHunk": "@@ -0,0 +1,31 @@\n+/*\n+ * Licensed to the Apache Software Foundation (ASF) under one or more\n+ * contributor license agreements.  See the NOTICE file distributed with\n+ * this work for additional information regarding copyright ownership.\n+ * The ASF licenses this file to You under the Apache License, Version 2.0\n+ * (the \"License\"); you may not use this file except in compliance with\n+ * the License.  You may obtain a copy of the License at\n+ *\n+ *      http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package org.apache.ignite.internal.client.thin.io;\n+\n+import org.jetbrains.annotations.Nullable;\n+\n+/**\n+ * Handles thin client connection state.\n+ */\n+public interface ClientConnectionStateHandler {\n+    /**\n+     * Handles connection loss", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "054bf139a27909223f8f1b6f929d2d3431a1f774"}, "originalPosition": 27}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMzI3ODkzMA==", "bodyText": "NL after }", "url": "https://github.com/apache/ignite/pull/8483#discussion_r533278930", "createdAt": "2020-12-01T10:17:43Z", "author": {"login": "alex-plekhanov"}, "path": "modules/core/src/main/java/org/apache/ignite/internal/client/thin/io/gridnioserver/GridNioClientConnectionMultiplexer.java", "diffHunk": "@@ -0,0 +1,143 @@\n+/*\n+ * Licensed to the Apache Software Foundation (ASF) under one or more\n+ * contributor license agreements.  See the NOTICE file distributed with\n+ * this work for additional information regarding copyright ownership.\n+ * The ASF licenses this file to You under the Apache License, Version 2.0\n+ * (the \"License\"); you may not use this file except in compliance with\n+ * the License.  You may obtain a copy of the License at\n+ *\n+ *      http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package org.apache.ignite.internal.client.thin.io.gridnioserver;\n+\n+import java.net.InetSocketAddress;\n+import java.nio.ByteBuffer;\n+import java.nio.ByteOrder;\n+import java.util.HashMap;\n+import java.util.Map;\n+import javax.net.ssl.SSLContext;\n+\n+import org.apache.ignite.IgniteCheckedException;\n+import org.apache.ignite.IgniteException;\n+import org.apache.ignite.IgniteLogger;\n+import org.apache.ignite.client.ClientConnectionException;\n+import org.apache.ignite.configuration.ClientConfiguration;\n+import org.apache.ignite.internal.client.thin.ClientSslUtils;\n+import org.apache.ignite.internal.client.thin.io.ClientConnection;\n+import org.apache.ignite.internal.client.thin.io.ClientConnectionMultiplexer;\n+import org.apache.ignite.internal.client.thin.io.ClientConnectionStateHandler;\n+import org.apache.ignite.internal.client.thin.io.ClientMessageHandler;\n+import org.apache.ignite.internal.util.nio.GridNioCodecFilter;\n+import org.apache.ignite.internal.util.nio.GridNioFilter;\n+import org.apache.ignite.internal.util.nio.GridNioFuture;\n+import org.apache.ignite.internal.util.nio.GridNioFutureImpl;\n+import org.apache.ignite.internal.util.nio.GridNioServer;\n+import org.apache.ignite.internal.util.nio.GridNioSession;\n+import org.apache.ignite.internal.util.nio.ssl.GridNioSslFilter;\n+import org.apache.ignite.logger.NullLogger;\n+\n+/**\n+ * Client connection multiplexer based on {@link org.apache.ignite.internal.util.nio.GridNioServer}.\n+ */\n+public class GridNioClientConnectionMultiplexer implements ClientConnectionMultiplexer {\n+    /** Worker thread prefix. */\n+    private static final String THREAD_PREFIX = \"thin-client-channel\";\n+\n+    /** */\n+    private static final int CLIENT_MODE_PORT = -1;\n+\n+    /** */\n+    private final GridNioServer<ByteBuffer> srv;\n+\n+    /** */\n+    private final SSLContext sslCtx;\n+\n+    /**\n+     * Constructor.\n+     *\n+     * @param cfg Client config.\n+     */\n+    public GridNioClientConnectionMultiplexer(ClientConfiguration cfg) {\n+        IgniteLogger gridLog = new NullLogger();\n+\n+        GridNioFilter[] filters;\n+\n+        GridNioFilter codecFilter = new GridNioCodecFilter(new GridNioClientParser(), gridLog, false);\n+\n+        sslCtx = ClientSslUtils.getSslContext(cfg);\n+\n+        if (sslCtx != null) {\n+            GridNioSslFilter sslFilter = new GridNioSslFilter(sslCtx, true, ByteOrder.nativeOrder(), gridLog);\n+            sslFilter.directMode(false);\n+            filters = new GridNioFilter[]{codecFilter, sslFilter};\n+        } else", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "054bf139a27909223f8f1b6f929d2d3431a1f774"}, "originalPosition": 80}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMzI4NDgxOQ==", "bodyText": "Space before  {", "url": "https://github.com/apache/ignite/pull/8483#discussion_r533284819", "createdAt": "2020-12-01T10:22:39Z", "author": {"login": "alex-plekhanov"}, "path": "modules/core/src/main/java/org/apache/ignite/internal/client/thin/io/gridnioserver/GridNioClientConnectionMultiplexer.java", "diffHunk": "@@ -0,0 +1,143 @@\n+/*\n+ * Licensed to the Apache Software Foundation (ASF) under one or more\n+ * contributor license agreements.  See the NOTICE file distributed with\n+ * this work for additional information regarding copyright ownership.\n+ * The ASF licenses this file to You under the Apache License, Version 2.0\n+ * (the \"License\"); you may not use this file except in compliance with\n+ * the License.  You may obtain a copy of the License at\n+ *\n+ *      http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package org.apache.ignite.internal.client.thin.io.gridnioserver;\n+\n+import java.net.InetSocketAddress;\n+import java.nio.ByteBuffer;\n+import java.nio.ByteOrder;\n+import java.util.HashMap;\n+import java.util.Map;\n+import javax.net.ssl.SSLContext;\n+\n+import org.apache.ignite.IgniteCheckedException;\n+import org.apache.ignite.IgniteException;\n+import org.apache.ignite.IgniteLogger;\n+import org.apache.ignite.client.ClientConnectionException;\n+import org.apache.ignite.configuration.ClientConfiguration;\n+import org.apache.ignite.internal.client.thin.ClientSslUtils;\n+import org.apache.ignite.internal.client.thin.io.ClientConnection;\n+import org.apache.ignite.internal.client.thin.io.ClientConnectionMultiplexer;\n+import org.apache.ignite.internal.client.thin.io.ClientConnectionStateHandler;\n+import org.apache.ignite.internal.client.thin.io.ClientMessageHandler;\n+import org.apache.ignite.internal.util.nio.GridNioCodecFilter;\n+import org.apache.ignite.internal.util.nio.GridNioFilter;\n+import org.apache.ignite.internal.util.nio.GridNioFuture;\n+import org.apache.ignite.internal.util.nio.GridNioFutureImpl;\n+import org.apache.ignite.internal.util.nio.GridNioServer;\n+import org.apache.ignite.internal.util.nio.GridNioSession;\n+import org.apache.ignite.internal.util.nio.ssl.GridNioSslFilter;\n+import org.apache.ignite.logger.NullLogger;\n+\n+/**\n+ * Client connection multiplexer based on {@link org.apache.ignite.internal.util.nio.GridNioServer}.\n+ */\n+public class GridNioClientConnectionMultiplexer implements ClientConnectionMultiplexer {\n+    /** Worker thread prefix. */\n+    private static final String THREAD_PREFIX = \"thin-client-channel\";\n+\n+    /** */\n+    private static final int CLIENT_MODE_PORT = -1;\n+\n+    /** */\n+    private final GridNioServer<ByteBuffer> srv;\n+\n+    /** */\n+    private final SSLContext sslCtx;\n+\n+    /**\n+     * Constructor.\n+     *\n+     * @param cfg Client config.\n+     */\n+    public GridNioClientConnectionMultiplexer(ClientConfiguration cfg) {\n+        IgniteLogger gridLog = new NullLogger();\n+\n+        GridNioFilter[] filters;\n+\n+        GridNioFilter codecFilter = new GridNioCodecFilter(new GridNioClientParser(), gridLog, false);\n+\n+        sslCtx = ClientSslUtils.getSslContext(cfg);\n+\n+        if (sslCtx != null) {\n+            GridNioSslFilter sslFilter = new GridNioSslFilter(sslCtx, true, ByteOrder.nativeOrder(), gridLog);\n+            sslFilter.directMode(false);\n+            filters = new GridNioFilter[]{codecFilter, sslFilter};\n+        } else\n+            filters = new GridNioFilter[]{codecFilter};", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "054bf139a27909223f8f1b6f929d2d3431a1f774"}, "originalPosition": 81}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMzI4NDk0Mw==", "bodyText": "Space before  {", "url": "https://github.com/apache/ignite/pull/8483#discussion_r533284943", "createdAt": "2020-12-01T10:22:45Z", "author": {"login": "alex-plekhanov"}, "path": "modules/core/src/main/java/org/apache/ignite/internal/client/thin/io/gridnioserver/GridNioClientConnectionMultiplexer.java", "diffHunk": "@@ -0,0 +1,143 @@\n+/*\n+ * Licensed to the Apache Software Foundation (ASF) under one or more\n+ * contributor license agreements.  See the NOTICE file distributed with\n+ * this work for additional information regarding copyright ownership.\n+ * The ASF licenses this file to You under the Apache License, Version 2.0\n+ * (the \"License\"); you may not use this file except in compliance with\n+ * the License.  You may obtain a copy of the License at\n+ *\n+ *      http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package org.apache.ignite.internal.client.thin.io.gridnioserver;\n+\n+import java.net.InetSocketAddress;\n+import java.nio.ByteBuffer;\n+import java.nio.ByteOrder;\n+import java.util.HashMap;\n+import java.util.Map;\n+import javax.net.ssl.SSLContext;\n+\n+import org.apache.ignite.IgniteCheckedException;\n+import org.apache.ignite.IgniteException;\n+import org.apache.ignite.IgniteLogger;\n+import org.apache.ignite.client.ClientConnectionException;\n+import org.apache.ignite.configuration.ClientConfiguration;\n+import org.apache.ignite.internal.client.thin.ClientSslUtils;\n+import org.apache.ignite.internal.client.thin.io.ClientConnection;\n+import org.apache.ignite.internal.client.thin.io.ClientConnectionMultiplexer;\n+import org.apache.ignite.internal.client.thin.io.ClientConnectionStateHandler;\n+import org.apache.ignite.internal.client.thin.io.ClientMessageHandler;\n+import org.apache.ignite.internal.util.nio.GridNioCodecFilter;\n+import org.apache.ignite.internal.util.nio.GridNioFilter;\n+import org.apache.ignite.internal.util.nio.GridNioFuture;\n+import org.apache.ignite.internal.util.nio.GridNioFutureImpl;\n+import org.apache.ignite.internal.util.nio.GridNioServer;\n+import org.apache.ignite.internal.util.nio.GridNioSession;\n+import org.apache.ignite.internal.util.nio.ssl.GridNioSslFilter;\n+import org.apache.ignite.logger.NullLogger;\n+\n+/**\n+ * Client connection multiplexer based on {@link org.apache.ignite.internal.util.nio.GridNioServer}.\n+ */\n+public class GridNioClientConnectionMultiplexer implements ClientConnectionMultiplexer {\n+    /** Worker thread prefix. */\n+    private static final String THREAD_PREFIX = \"thin-client-channel\";\n+\n+    /** */\n+    private static final int CLIENT_MODE_PORT = -1;\n+\n+    /** */\n+    private final GridNioServer<ByteBuffer> srv;\n+\n+    /** */\n+    private final SSLContext sslCtx;\n+\n+    /**\n+     * Constructor.\n+     *\n+     * @param cfg Client config.\n+     */\n+    public GridNioClientConnectionMultiplexer(ClientConfiguration cfg) {\n+        IgniteLogger gridLog = new NullLogger();\n+\n+        GridNioFilter[] filters;\n+\n+        GridNioFilter codecFilter = new GridNioCodecFilter(new GridNioClientParser(), gridLog, false);\n+\n+        sslCtx = ClientSslUtils.getSslContext(cfg);\n+\n+        if (sslCtx != null) {\n+            GridNioSslFilter sslFilter = new GridNioSslFilter(sslCtx, true, ByteOrder.nativeOrder(), gridLog);\n+            sslFilter.directMode(false);\n+            filters = new GridNioFilter[]{codecFilter, sslFilter};", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "054bf139a27909223f8f1b6f929d2d3431a1f774"}, "originalPosition": 79}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMzMxOTY1Ng==", "bodyText": "Add java.nio.channels.SocketChannel to imports?", "url": "https://github.com/apache/ignite/pull/8483#discussion_r533319656", "createdAt": "2020-12-01T10:57:09Z", "author": {"login": "alex-plekhanov"}, "path": "modules/core/src/main/java/org/apache/ignite/internal/client/thin/io/gridnioserver/GridNioClientConnectionMultiplexer.java", "diffHunk": "@@ -0,0 +1,143 @@\n+/*\n+ * Licensed to the Apache Software Foundation (ASF) under one or more\n+ * contributor license agreements.  See the NOTICE file distributed with\n+ * this work for additional information regarding copyright ownership.\n+ * The ASF licenses this file to You under the Apache License, Version 2.0\n+ * (the \"License\"); you may not use this file except in compliance with\n+ * the License.  You may obtain a copy of the License at\n+ *\n+ *      http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package org.apache.ignite.internal.client.thin.io.gridnioserver;\n+\n+import java.net.InetSocketAddress;\n+import java.nio.ByteBuffer;\n+import java.nio.ByteOrder;\n+import java.util.HashMap;\n+import java.util.Map;\n+import javax.net.ssl.SSLContext;\n+\n+import org.apache.ignite.IgniteCheckedException;\n+import org.apache.ignite.IgniteException;\n+import org.apache.ignite.IgniteLogger;\n+import org.apache.ignite.client.ClientConnectionException;\n+import org.apache.ignite.configuration.ClientConfiguration;\n+import org.apache.ignite.internal.client.thin.ClientSslUtils;\n+import org.apache.ignite.internal.client.thin.io.ClientConnection;\n+import org.apache.ignite.internal.client.thin.io.ClientConnectionMultiplexer;\n+import org.apache.ignite.internal.client.thin.io.ClientConnectionStateHandler;\n+import org.apache.ignite.internal.client.thin.io.ClientMessageHandler;\n+import org.apache.ignite.internal.util.nio.GridNioCodecFilter;\n+import org.apache.ignite.internal.util.nio.GridNioFilter;\n+import org.apache.ignite.internal.util.nio.GridNioFuture;\n+import org.apache.ignite.internal.util.nio.GridNioFutureImpl;\n+import org.apache.ignite.internal.util.nio.GridNioServer;\n+import org.apache.ignite.internal.util.nio.GridNioSession;\n+import org.apache.ignite.internal.util.nio.ssl.GridNioSslFilter;\n+import org.apache.ignite.logger.NullLogger;\n+\n+/**\n+ * Client connection multiplexer based on {@link org.apache.ignite.internal.util.nio.GridNioServer}.\n+ */\n+public class GridNioClientConnectionMultiplexer implements ClientConnectionMultiplexer {\n+    /** Worker thread prefix. */\n+    private static final String THREAD_PREFIX = \"thin-client-channel\";\n+\n+    /** */\n+    private static final int CLIENT_MODE_PORT = -1;\n+\n+    /** */\n+    private final GridNioServer<ByteBuffer> srv;\n+\n+    /** */\n+    private final SSLContext sslCtx;\n+\n+    /**\n+     * Constructor.\n+     *\n+     * @param cfg Client config.\n+     */\n+    public GridNioClientConnectionMultiplexer(ClientConfiguration cfg) {\n+        IgniteLogger gridLog = new NullLogger();\n+\n+        GridNioFilter[] filters;\n+\n+        GridNioFilter codecFilter = new GridNioCodecFilter(new GridNioClientParser(), gridLog, false);\n+\n+        sslCtx = ClientSslUtils.getSslContext(cfg);\n+\n+        if (sslCtx != null) {\n+            GridNioSslFilter sslFilter = new GridNioSslFilter(sslCtx, true, ByteOrder.nativeOrder(), gridLog);\n+            sslFilter.directMode(false);\n+            filters = new GridNioFilter[]{codecFilter, sslFilter};\n+        } else\n+            filters = new GridNioFilter[]{codecFilter};\n+\n+        try {\n+            srv = GridNioServer.<ByteBuffer>builder()\n+                    .port(CLIENT_MODE_PORT)\n+                    .listener(new GridNioClientListener())\n+                    .filters(filters)\n+                    .logger(gridLog)\n+                    .selectorCount(1) // Using more selectors does not seem to improve performance.\n+                    .byteOrder(ByteOrder.nativeOrder())\n+                    .directBuffer(true)\n+                    .directMode(false)\n+                    .igniteInstanceName(\"thinClient\")\n+                    .serverName(THREAD_PREFIX)\n+                    .idleTimeout(Long.MAX_VALUE)\n+                    .socketReceiveBufferSize(cfg.getReceiveBufferSize())\n+                    .socketSendBufferSize(cfg.getSendBufferSize())\n+                    .tcpNoDelay(true)\n+                    .build();\n+        } catch (IgniteCheckedException e) {\n+            throw new IgniteException(e);\n+        }\n+    }\n+\n+    /** {@inheritDoc} */\n+    @Override public void start() {\n+        srv.start();\n+    }\n+\n+    /** {@inheritDoc} */\n+    @Override public void stop() {\n+        srv.stop();\n+    }\n+\n+    /** {@inheritDoc} */\n+    @Override public ClientConnection open(InetSocketAddress addr,\n+                                           ClientMessageHandler msgHnd,\n+                                           ClientConnectionStateHandler stateHnd)\n+            throws ClientConnectionException {\n+        try {\n+            java.nio.channels.SocketChannel ch = java.nio.channels.SocketChannel.open();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "054bf139a27909223f8f1b6f929d2d3431a1f774"}, "originalPosition": 121}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMzMzODUxMQ==", "bodyText": "I think here ByteOrder.LITTLE_ENDIAN should be used since this ByteBuffer is passed to payload readers", "url": "https://github.com/apache/ignite/pull/8483#discussion_r533338511", "createdAt": "2020-12-01T11:30:00Z", "author": {"login": "alex-plekhanov"}, "path": "modules/core/src/main/java/org/apache/ignite/internal/client/thin/io/gridnioserver/GridNioClientParser.java", "diffHunk": "@@ -0,0 +1,58 @@\n+/*\n+ * Licensed to the Apache Software Foundation (ASF) under one or more\n+ * contributor license agreements.  See the NOTICE file distributed with\n+ * this work for additional information regarding copyright ownership.\n+ * The ASF licenses this file to You under the Apache License, Version 2.0\n+ * (the \"License\"); you may not use this file except in compliance with\n+ * the License.  You may obtain a copy of the License at\n+ *\n+ *      http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package org.apache.ignite.internal.client.thin.io.gridnioserver;\n+\n+import java.nio.ByteBuffer;\n+import java.nio.ByteOrder;\n+\n+import org.apache.ignite.internal.client.thin.io.ClientMessageDecoder;\n+import org.apache.ignite.internal.util.nio.GridNioParser;\n+import org.apache.ignite.internal.util.nio.GridNioSession;\n+import org.apache.ignite.internal.util.nio.GridNioSessionMetaKey;\n+import org.jetbrains.annotations.Nullable;\n+\n+/**\n+ * Client message parser.\n+ */\n+class GridNioClientParser implements GridNioParser {\n+    /** */\n+    private static final int SES_META_DECODER = GridNioSessionMetaKey.nextUniqueKey();\n+\n+    /** {@inheritDoc} */\n+    @Override public @Nullable Object decode(GridNioSession ses, ByteBuffer buf) {\n+        ClientMessageDecoder decoder = ses.meta(SES_META_DECODER);\n+\n+        if (decoder == null) {\n+            decoder = new ClientMessageDecoder();\n+\n+            ses.addMeta(SES_META_DECODER, decoder);\n+        }\n+\n+        byte[] bytes = decoder.apply(buf);\n+\n+        if (bytes == null)\n+            return null; // Message is not yet completely received.\n+\n+        return ByteBuffer.wrap(bytes).order(ByteOrder.nativeOrder());", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "054bf139a27909223f8f1b6f929d2d3431a1f774"}, "originalPosition": 51}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMzM0MjY4NA==", "bodyText": "public abstract class?", "url": "https://github.com/apache/ignite/pull/8483#discussion_r533342684", "createdAt": "2020-12-01T11:37:09Z", "author": {"login": "alex-plekhanov"}, "path": "modules/benchmarks/src/main/java/org/apache/ignite/internal/benchmarks/jmh/thin/JmhThinClientAbstractBenchmark.java", "diffHunk": "@@ -0,0 +1,135 @@\n+/*\n+ * Licensed to the Apache Software Foundation (ASF) under one or more\n+ * contributor license agreements.  See the NOTICE file distributed with\n+ * this work for additional information regarding copyright ownership.\n+ * The ASF licenses this file to You under the Apache License, Version 2.0\n+ * (the \"License\"); you may not use this file except in compliance with\n+ * the License.  You may obtain a copy of the License at\n+ *\n+ *      http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package org.apache.ignite.internal.benchmarks.jmh.thin;\n+\n+import java.util.stream.IntStream;\n+\n+import org.apache.ignite.Ignite;\n+import org.apache.ignite.Ignition;\n+import org.apache.ignite.client.ClientCache;\n+import org.apache.ignite.client.IgniteClient;\n+import org.apache.ignite.configuration.ClientConfiguration;\n+import org.apache.ignite.configuration.IgniteConfiguration;\n+import org.apache.ignite.internal.benchmarks.jmh.JmhAbstractBenchmark;\n+import org.apache.ignite.internal.util.typedef.internal.A;\n+import org.apache.ignite.spi.discovery.tcp.TcpDiscoverySpi;\n+import org.apache.ignite.spi.discovery.tcp.ipfinder.vm.TcpDiscoveryVmIpFinder;\n+import org.openjdk.jmh.annotations.Scope;\n+import org.openjdk.jmh.annotations.Setup;\n+import org.openjdk.jmh.annotations.State;\n+import org.openjdk.jmh.annotations.TearDown;\n+\n+/**\n+ * Base class for thin client benchmarks.\n+ */\n+@State(Scope.Benchmark)\n+public class JmhThinClientAbstractBenchmark extends JmhAbstractBenchmark {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "054bf139a27909223f8f1b6f929d2d3431a1f774"}, "originalPosition": 41}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a1ca91668c56d9814c4b7dd82539eeac6c36f638", "author": {"user": {"login": "ptupitsyn", "name": "Pavel Tupitsyn"}}, "url": "https://github.com/apache/ignite/commit/a1ca91668c56d9814c4b7dd82539eeac6c36f638", "committedDate": "2020-12-01T13:51:59Z", "message": "fixing code style"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "8489a03bcb8a6537cb0b775e44cb8a532768d3ae", "author": {"user": {"login": "ptupitsyn", "name": "Pavel Tupitsyn"}}, "url": "https://github.com/apache/ignite/commit/8489a03bcb8a6537cb0b775e44cb8a532768d3ae", "committedDate": "2020-12-01T13:53:36Z", "message": "fixing code style"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f50c4ecf9c5145ae70af701294ac0f872be2de17", "author": {"user": {"login": "ptupitsyn", "name": "Pavel Tupitsyn"}}, "url": "https://github.com/apache/ignite/commit/f50c4ecf9c5145ae70af701294ac0f872be2de17", "committedDate": "2020-12-01T14:01:53Z", "message": "fixing code style"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "6dae134bc0c343ca6cb9c5de6d8003131a493181", "author": {"user": {"login": "ptupitsyn", "name": "Pavel Tupitsyn"}}, "url": "https://github.com/apache/ignite/commit/6dae134bc0c343ca6cb9c5de6d8003131a493181", "committedDate": "2020-12-01T14:03:13Z", "message": "fixing code style"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "0bae1866b66491d2c94d376411f138d6fd4e4c9b", "author": {"user": {"login": "ptupitsyn", "name": "Pavel Tupitsyn"}}, "url": "https://github.com/apache/ignite/commit/0bae1866b66491d2c94d376411f138d6fd4e4c9b", "committedDate": "2020-12-01T14:03:41Z", "message": "fixing code style"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "2f8c7cd8926329d018800720188001d8b969f76d", "author": {"user": {"login": "ptupitsyn", "name": "Pavel Tupitsyn"}}, "url": "https://github.com/apache/ignite/commit/2f8c7cd8926329d018800720188001d8b969f76d", "committedDate": "2020-12-01T16:00:16Z", "message": "fixing code style"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "4b1e1619da5605892959798176480d79efef62d5", "author": {"user": {"login": "ptupitsyn", "name": "Pavel Tupitsyn"}}, "url": "https://github.com/apache/ignite/commit/4b1e1619da5605892959798176480d79efef62d5", "committedDate": "2020-12-01T16:05:53Z", "message": "Fix ByteBuffer endianness"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTQyMDY3Mzcw", "url": "https://github.com/apache/ignite/pull/8483#pullrequestreview-542067370", "createdAt": "2020-12-01T16:17:45Z", "commit": {"oid": "4b1e1619da5605892959798176480d79efef62d5"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTQyMDkyMTE5", "url": "https://github.com/apache/ignite/pull/8483#pullrequestreview-542092119", "createdAt": "2020-12-01T16:43:04Z", "commit": {"oid": "4b1e1619da5605892959798176480d79efef62d5"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "bd35d4d2728fa5655d908956c3536f3b77af95b8", "author": {"user": {"login": "ptupitsyn", "name": "Pavel Tupitsyn"}}, "url": "https://github.com/apache/ignite/commit/bd35d4d2728fa5655d908956c3536f3b77af95b8", "committedDate": "2020-10-13T13:45:01Z", "message": "AsynchronousSocketChannel POC wip"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "d47863abf6190e830625a885f2eae319a9a5b85f", "author": {"user": {"login": "ptupitsyn", "name": "Pavel Tupitsyn"}}, "url": "https://github.com/apache/ignite/commit/d47863abf6190e830625a885f2eae319a9a5b85f", "committedDate": "2020-10-13T13:48:42Z", "message": "AsynchronousSocketChannel POC wip"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "d70305b38d0646db91f89595d4443fdbe14e8f4e", "author": {"user": {"login": "ptupitsyn", "name": "Pavel Tupitsyn"}}, "url": "https://github.com/apache/ignite/commit/d70305b38d0646db91f89595d4443fdbe14e8f4e", "committedDate": "2020-10-13T13:50:00Z", "message": "AsynchronousSocketChannel POC wip"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "42b78386c03adf8810ee4918f65973a355128607", "author": {"user": {"login": "ptupitsyn", "name": "Pavel Tupitsyn"}}, "url": "https://github.com/apache/ignite/commit/42b78386c03adf8810ee4918f65973a355128607", "committedDate": "2020-10-14T15:43:14Z", "message": "AsynchronousSocketChannel testing wip"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "5c3a70c7fd8267ede78311aaeefd9a8c88c7b342", "author": {"user": {"login": "ptupitsyn", "name": "Pavel Tupitsyn"}}, "url": "https://github.com/apache/ignite/commit/5c3a70c7fd8267ede78311aaeefd9a8c88c7b342", "committedDate": "2020-10-14T15:52:06Z", "message": "AsynchronousSocketChannel testing wip"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "59a4c185f2f96dcdafc7904b729c7ffc2de6d091", "author": {"user": {"login": "ptupitsyn", "name": "Pavel Tupitsyn"}}, "url": "https://github.com/apache/ignite/commit/59a4c185f2f96dcdafc7904b729c7ffc2de6d091", "committedDate": "2020-10-14T15:56:52Z", "message": "AsynchronousSocketChannel testing wip"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a14e98ade13380b1b8163053265e974fb4013ac0", "author": {"user": {"login": "ptupitsyn", "name": "Pavel Tupitsyn"}}, "url": "https://github.com/apache/ignite/commit/a14e98ade13380b1b8163053265e974fb4013ac0", "committedDate": "2020-10-14T16:00:34Z", "message": "AsynchronousSocketChannel testing wip"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "734451a71689a300988841d847cccec0b43c4795", "author": {"user": {"login": "ptupitsyn", "name": "Pavel Tupitsyn"}}, "url": "https://github.com/apache/ignite/commit/734451a71689a300988841d847cccec0b43c4795", "committedDate": "2020-10-14T16:24:05Z", "message": "AsynchronousSocketChannel testing wip"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "4f9c667bb930e1bc3be8f913ab8e7e22538ee65a", "author": {"user": {"login": "ptupitsyn", "name": "Pavel Tupitsyn"}}, "url": "https://github.com/apache/ignite/commit/4f9c667bb930e1bc3be8f913ab8e7e22538ee65a", "committedDate": "2020-10-14T16:24:53Z", "message": "AsynchronousSocketChannel testing wip"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "d1e9094f23b02d1524bfc5ab82dfbd6fe35a8b47", "author": {"user": {"login": "ptupitsyn", "name": "Pavel Tupitsyn"}}, "url": "https://github.com/apache/ignite/commit/d1e9094f23b02d1524bfc5ab82dfbd6fe35a8b47", "committedDate": "2020-10-14T18:13:54Z", "message": "AsynchronousSocketChannel testing wip netty"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "36327410c0df307a9f85839670300d0704922a9b", "author": {"user": {"login": "ptupitsyn", "name": "Pavel Tupitsyn"}}, "url": "https://github.com/apache/ignite/commit/36327410c0df307a9f85839670300d0704922a9b", "committedDate": "2020-10-14T18:40:46Z", "message": "AsynchronousSocketChannel testing wip netty"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "bb7779b78340b4abd067771274264b381b3dc2f0", "author": {"user": {"login": "ptupitsyn", "name": "Pavel Tupitsyn"}}, "url": "https://github.com/apache/ignite/commit/bb7779b78340b4abd067771274264b381b3dc2f0", "committedDate": "2020-10-14T18:45:37Z", "message": "AsynchronousSocketChannel testing wip netty"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "76152b0d2f47b8404e03dd40280615e29a5d36dc", "author": {"user": {"login": "ptupitsyn", "name": "Pavel Tupitsyn"}}, "url": "https://github.com/apache/ignite/commit/76152b0d2f47b8404e03dd40280615e29a5d36dc", "committedDate": "2020-10-15T19:07:37Z", "message": "AsynchronousSocketChannel testing wip netty"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "3ace15ce3f1ee88569c226e1bf7f4eec59232361", "author": {"user": {"login": "ptupitsyn", "name": "Pavel Tupitsyn"}}, "url": "https://github.com/apache/ignite/commit/3ace15ce3f1ee88569c226e1bf7f4eec59232361", "committedDate": "2020-10-15T19:25:31Z", "message": "AsynchronousSocketChannel testing wip netty"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "0626431eddb0aab512cbdf5d41a671cdfe8139a2", "author": {"user": {"login": "ptupitsyn", "name": "Pavel Tupitsyn"}}, "url": "https://github.com/apache/ignite/commit/0626431eddb0aab512cbdf5d41a671cdfe8139a2", "committedDate": "2020-10-15T19:29:35Z", "message": "AsynchronousSocketChannel testing wip netty"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c1b69c052adca4edd7bccce8396e8c26ce37fe7f", "author": {"user": {"login": "ptupitsyn", "name": "Pavel Tupitsyn"}}, "url": "https://github.com/apache/ignite/commit/c1b69c052adca4edd7bccce8396e8c26ce37fe7f", "committedDate": "2020-10-15T19:32:56Z", "message": "AsynchronousSocketChannel testing wip netty"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "d5fc08b81a854e55e2156d9d7ae16774ed3dfb52", "author": {"user": {"login": "ptupitsyn", "name": "Pavel Tupitsyn"}}, "url": "https://github.com/apache/ignite/commit/d5fc08b81a854e55e2156d9d7ae16774ed3dfb52", "committedDate": "2020-10-15T19:42:28Z", "message": "wip"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e3e99f5aa1c9d654603e6157e95cff9da05414fa", "author": {"user": {"login": "ptupitsyn", "name": "Pavel Tupitsyn"}}, "url": "https://github.com/apache/ignite/commit/e3e99f5aa1c9d654603e6157e95cff9da05414fa", "committedDate": "2020-10-16T07:37:04Z", "message": "wip netty ssl"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "749a7c89b95ab4c48b86f1d9ec610ed8f7829b0b", "author": {"user": {"login": "ptupitsyn", "name": "Pavel Tupitsyn"}}, "url": "https://github.com/apache/ignite/commit/749a7c89b95ab4c48b86f1d9ec610ed8f7829b0b", "committedDate": "2020-10-16T07:43:54Z", "message": "wip netty ssl"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "1836a010e3e7c9f3e43e46b0efb6c338c9ca4f4f", "author": {"user": {"login": "ptupitsyn", "name": "Pavel Tupitsyn"}}, "url": "https://github.com/apache/ignite/commit/1836a010e3e7c9f3e43e46b0efb6c338c9ca4f4f", "committedDate": "2020-10-21T15:12:34Z", "message": "wip GridNioServer"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a99d9f4405009c2fb9711393991b2c9dddd9b42f", "author": {"user": {"login": "ptupitsyn", "name": "Pavel Tupitsyn"}}, "url": "https://github.com/apache/ignite/commit/a99d9f4405009c2fb9711393991b2c9dddd9b42f", "committedDate": "2020-11-06T09:06:28Z", "message": "Merge branch 'master' into ignite-13496"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "354953847a5b500e2cf4715fd09c82fa0a966a5f", "author": {"user": {"login": "ptupitsyn", "name": "Pavel Tupitsyn"}}, "url": "https://github.com/apache/ignite/commit/354953847a5b500e2cf4715fd09c82fa0a966a5f", "committedDate": "2020-11-06T16:20:39Z", "message": "Merge remote-tracking branch 'origin/master' into ignite-13496"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "48c2fcb6f11dae346d039951427bd73593a2cc17", "author": {"user": {"login": "ptupitsyn", "name": "Pavel Tupitsyn"}}, "url": "https://github.com/apache/ignite/commit/48c2fcb6f11dae346d039951427bd73593a2cc17", "committedDate": "2020-11-06T17:07:51Z", "message": "wip GridNioServer test"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "d4b39115d8986f6979c9259f2748056744eb31dd", "author": {"user": {"login": "ptupitsyn", "name": "Pavel Tupitsyn"}}, "url": "https://github.com/apache/ignite/commit/d4b39115d8986f6979c9259f2748056744eb31dd", "committedDate": "2020-11-06T17:27:35Z", "message": "wip GridNioServer test"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "8cf972a1c0fab4d8c73700cc5c692d5d16d2ffb1", "author": {"user": {"login": "ptupitsyn", "name": "Pavel Tupitsyn"}}, "url": "https://github.com/apache/ignite/commit/8cf972a1c0fab4d8c73700cc5c692d5d16d2ffb1", "committedDate": "2020-11-06T17:35:22Z", "message": "wip GridNioServer test"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "0320cee2b9288c7e1fe067221f3621ed435aaa5e", "author": {"user": {"login": "ptupitsyn", "name": "Pavel Tupitsyn"}}, "url": "https://github.com/apache/ignite/commit/0320cee2b9288c7e1fe067221f3621ed435aaa5e", "committedDate": "2020-11-06T17:36:34Z", "message": "wip GridNioServer test"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "6a95d76adca6d849d45484e99dfd48a89531baac", "author": {"user": {"login": "ptupitsyn", "name": "Pavel Tupitsyn"}}, "url": "https://github.com/apache/ignite/commit/6a95d76adca6d849d45484e99dfd48a89531baac", "committedDate": "2020-11-06T17:38:51Z", "message": "wip GridNioServer test"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "017be62b6102cbf1e1a1af540a2f0e8abc8926e5", "author": {"user": {"login": "ptupitsyn", "name": "Pavel Tupitsyn"}}, "url": "https://github.com/apache/ignite/commit/017be62b6102cbf1e1a1af540a2f0e8abc8926e5", "committedDate": "2020-11-06T17:46:39Z", "message": "wip GridNioServer test"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "5cd1dd07c9c50ae8ad7da9cdf9995bc49566f819", "author": {"user": {"login": "ptupitsyn", "name": "Pavel Tupitsyn"}}, "url": "https://github.com/apache/ignite/commit/5cd1dd07c9c50ae8ad7da9cdf9995bc49566f819", "committedDate": "2020-11-06T17:48:56Z", "message": "wip GridNioServer test"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a1f05f01a5d1e29cade7f51474841b71d59640bb", "author": {"user": {"login": "ptupitsyn", "name": "Pavel Tupitsyn"}}, "url": "https://github.com/apache/ignite/commit/a1f05f01a5d1e29cade7f51474841b71d59640bb", "committedDate": "2020-11-06T17:52:46Z", "message": "wip GridNioServer test"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "d4330c53ab56ac09d7c1dab6f18c95e779ae1780", "author": {"user": {"login": "ptupitsyn", "name": "Pavel Tupitsyn"}}, "url": "https://github.com/apache/ignite/commit/d4330c53ab56ac09d7c1dab6f18c95e779ae1780", "committedDate": "2020-11-06T18:47:29Z", "message": "wip GridNioServer test"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "5e581bb735c41a2077f949d06b618c06318515ce", "author": {"user": {"login": "ptupitsyn", "name": "Pavel Tupitsyn"}}, "url": "https://github.com/apache/ignite/commit/5e581bb735c41a2077f949d06b618c06318515ce", "committedDate": "2020-11-06T18:57:16Z", "message": "wip GridNioServer test"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ba08e8bb98284ab3e75375a30b0728db8fea9e9a", "author": {"user": {"login": "ptupitsyn", "name": "Pavel Tupitsyn"}}, "url": "https://github.com/apache/ignite/commit/ba08e8bb98284ab3e75375a30b0728db8fea9e9a", "committedDate": "2020-11-08T16:05:11Z", "message": "cleanup"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a0401a404547e5637f92898fe74bdf50141c1117", "author": {"user": {"login": "ptupitsyn", "name": "Pavel Tupitsyn"}}, "url": "https://github.com/apache/ignite/commit/a0401a404547e5637f92898fe74bdf50141c1117", "committedDate": "2020-11-18T07:16:45Z", "message": "Merge branch 'master' into ignite-13496"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "7ee2c41f4f1cc0887a776e09604fd0d6d0e7ea21", "author": {"user": {"login": "ptupitsyn", "name": "Pavel Tupitsyn"}}, "url": "https://github.com/apache/ignite/commit/7ee2c41f4f1cc0887a776e09604fd0d6d0e7ea21", "committedDate": "2020-11-18T12:54:47Z", "message": "wip NIO abstraction"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "6814848ba3f9b167a5c8d57ff89da0b9829d4325", "author": {"user": {"login": "ptupitsyn", "name": "Pavel Tupitsyn"}}, "url": "https://github.com/apache/ignite/commit/6814848ba3f9b167a5c8d57ff89da0b9829d4325", "committedDate": "2020-11-18T12:56:34Z", "message": "wip NIO abstraction"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "7bfa6c9ad41b38afd8bcd136ea849ed750e061b3", "author": {"user": {"login": "ptupitsyn", "name": "Pavel Tupitsyn"}}, "url": "https://github.com/apache/ignite/commit/7bfa6c9ad41b38afd8bcd136ea849ed750e061b3", "committedDate": "2020-11-18T13:02:07Z", "message": "wip NIO abstraction"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "7887210e6d3b8d0602b7f51b9331421cd6f068cc", "author": {"user": {"login": "ptupitsyn", "name": "Pavel Tupitsyn"}}, "url": "https://github.com/apache/ignite/commit/7887210e6d3b8d0602b7f51b9331421cd6f068cc", "committedDate": "2020-11-18T13:05:08Z", "message": "use byte buffers"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "64882a367ec1a32251b37222b16304541523ae42", "author": {"user": {"login": "ptupitsyn", "name": "Pavel Tupitsyn"}}, "url": "https://github.com/apache/ignite/commit/64882a367ec1a32251b37222b16304541523ae42", "committedDate": "2020-11-18T13:18:17Z", "message": "wip NIO abstraction"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "4e5b6d00fe8a2958f5f4b0b442ae0558d6567838", "author": {"user": {"login": "ptupitsyn", "name": "Pavel Tupitsyn"}}, "url": "https://github.com/apache/ignite/commit/4e5b6d00fe8a2958f5f4b0b442ae0558d6567838", "committedDate": "2020-11-18T13:38:30Z", "message": "wip NIO abstraction"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "2e26eb9d31038705db02d1a6f3795f4e8f10ac30", "author": {"user": {"login": "ptupitsyn", "name": "Pavel Tupitsyn"}}, "url": "https://github.com/apache/ignite/commit/2e26eb9d31038705db02d1a6f3795f4e8f10ac30", "committedDate": "2020-11-18T13:49:47Z", "message": "wip NIO abstraction"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "726faa2b717b8267045fcc13962bb1c018bcaf54", "author": {"user": {"login": "ptupitsyn", "name": "Pavel Tupitsyn"}}, "url": "https://github.com/apache/ignite/commit/726faa2b717b8267045fcc13962bb1c018bcaf54", "committedDate": "2020-11-18T14:25:35Z", "message": "wip NIO abstraction"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "81267f5caf167c2100adb731cfe1e9d59c0fdf0b", "author": {"user": {"login": "ptupitsyn", "name": "Pavel Tupitsyn"}}, "url": "https://github.com/apache/ignite/commit/81267f5caf167c2100adb731cfe1e9d59c0fdf0b", "committedDate": "2020-11-18T14:34:14Z", "message": "wip NIO abstraction"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "13daaae22c74f2c6c83da0189eaa18492b6fd792", "author": {"user": {"login": "ptupitsyn", "name": "Pavel Tupitsyn"}}, "url": "https://github.com/apache/ignite/commit/13daaae22c74f2c6c83da0189eaa18492b6fd792", "committedDate": "2020-11-18T14:36:50Z", "message": "wip NIO abstraction"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "fc27964444957e89552ea050d4f7a351757d96ff", "author": {"user": {"login": "ptupitsyn", "name": "Pavel Tupitsyn"}}, "url": "https://github.com/apache/ignite/commit/fc27964444957e89552ea050d4f7a351757d96ff", "committedDate": "2020-11-18T15:10:08Z", "message": "wip NIO abstraction"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "561e2fa471dca31c710223a7a3a7fbe6bab77d1f", "author": {"user": {"login": "ptupitsyn", "name": "Pavel Tupitsyn"}}, "url": "https://github.com/apache/ignite/commit/561e2fa471dca31c710223a7a3a7fbe6bab77d1f", "committedDate": "2020-11-18T17:47:43Z", "message": "wip NIO abstraction"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "409059585ebe1fa76109b22960398b6611fe7d45", "author": {"user": {"login": "ptupitsyn", "name": "Pavel Tupitsyn"}}, "url": "https://github.com/apache/ignite/commit/409059585ebe1fa76109b22960398b6611fe7d45", "committedDate": "2020-11-18T17:51:52Z", "message": "wip NIO abstraction"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c5178fef35ca3279ee83dc78a59bae0721e41dd6", "author": {"user": {"login": "ptupitsyn", "name": "Pavel Tupitsyn"}}, "url": "https://github.com/apache/ignite/commit/c5178fef35ca3279ee83dc78a59bae0721e41dd6", "committedDate": "2020-11-18T17:57:30Z", "message": "wip NIO abstraction"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b2a7345118801f8162bf139703bb92b08c4c17b5", "author": {"user": {"login": "ptupitsyn", "name": "Pavel Tupitsyn"}}, "url": "https://github.com/apache/ignite/commit/b2a7345118801f8162bf139703bb92b08c4c17b5", "committedDate": "2020-11-18T17:58:10Z", "message": "wip NIO abstraction"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "4c594ea675e06880e8e37adc3fe2032d1054022d", "author": {"user": {"login": "ptupitsyn", "name": "Pavel Tupitsyn"}}, "url": "https://github.com/apache/ignite/commit/4c594ea675e06880e8e37adc3fe2032d1054022d", "committedDate": "2020-11-18T18:08:04Z", "message": "wip NIO abstraction"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "6558951d198d19d521263ac97c90a3395df807d0", "author": {"user": {"login": "ptupitsyn", "name": "Pavel Tupitsyn"}}, "url": "https://github.com/apache/ignite/commit/6558951d198d19d521263ac97c90a3395df807d0", "committedDate": "2020-11-18T19:36:04Z", "message": "wip NIO abstraction"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c3b5fdc5a68911750fafbf29ffa98a8d1bafd169", "author": {"user": {"login": "ptupitsyn", "name": "Pavel Tupitsyn"}}, "url": "https://github.com/apache/ignite/commit/c3b5fdc5a68911750fafbf29ffa98a8d1bafd169", "committedDate": "2020-11-18T19:37:04Z", "message": "wip NIO abstraction"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "9ec8ea31b23c27403d1157bd1e72df8543c61421", "author": {"user": {"login": "ptupitsyn", "name": "Pavel Tupitsyn"}}, "url": "https://github.com/apache/ignite/commit/9ec8ea31b23c27403d1157bd1e72df8543c61421", "committedDate": "2020-11-18T19:40:09Z", "message": "wip NIO abstraction - decoding"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "15fc9b886804de08828ca403f29e88c664015443", "author": {"user": {"login": "ptupitsyn", "name": "Pavel Tupitsyn"}}, "url": "https://github.com/apache/ignite/commit/15fc9b886804de08828ca403f29e88c664015443", "committedDate": "2020-11-18T19:46:50Z", "message": "wip NIO abstraction - refactoring TcpClientChannel"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "0b59189eaf060cdfabe712cd76f85df431f6b30e", "author": {"user": {"login": "ptupitsyn", "name": "Pavel Tupitsyn"}}, "url": "https://github.com/apache/ignite/commit/0b59189eaf060cdfabe712cd76f85df431f6b30e", "committedDate": "2020-11-19T10:32:24Z", "message": "wip NIO abstraction - refactoring TcpClientChannel"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ebd930a0614314ca5f7a924bd8f978e5904de6e8", "author": {"user": {"login": "ptupitsyn", "name": "Pavel Tupitsyn"}}, "url": "https://github.com/apache/ignite/commit/ebd930a0614314ca5f7a924bd8f978e5904de6e8", "committedDate": "2020-11-19T10:36:20Z", "message": "wip NIO abstraction - refactoring TcpClientChannel"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "435359ce3797aeaa6c2cca533ca44c74db3172e2", "author": {"user": {"login": "ptupitsyn", "name": "Pavel Tupitsyn"}}, "url": "https://github.com/apache/ignite/commit/435359ce3797aeaa6c2cca533ca44c74db3172e2", "committedDate": "2020-11-19T10:41:13Z", "message": "wip NIO abstraction - refactoring TcpClientChannel"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "401d1eab1c4e5db9c2d04d86f47e9cf9d1f07c86", "author": {"user": {"login": "ptupitsyn", "name": "Pavel Tupitsyn"}}, "url": "https://github.com/apache/ignite/commit/401d1eab1c4e5db9c2d04d86f47e9cf9d1f07c86", "committedDate": "2020-11-19T12:15:31Z", "message": "wip NIO abstraction - refactoring TcpClientChannel"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "fe567c97087c18ea6b664999583a296fb1f4cd47", "author": {"user": {"login": "ptupitsyn", "name": "Pavel Tupitsyn"}}, "url": "https://github.com/apache/ignite/commit/fe567c97087c18ea6b664999583a296fb1f4cd47", "committedDate": "2020-11-19T12:51:18Z", "message": "wip NIO abstraction - refactoring TcpClientChannel"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "4fddb28d0fdcb4163ca9cdc04766a4781520bd7f", "author": {"user": {"login": "ptupitsyn", "name": "Pavel Tupitsyn"}}, "url": "https://github.com/apache/ignite/commit/4fddb28d0fdcb4163ca9cdc04766a4781520bd7f", "committedDate": "2020-11-19T12:51:52Z", "message": "wip NIO abstraction - refactoring TcpClientChannel"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "21b45a86e82c33933d6c39608ee19ac4ce381307", "author": {"user": {"login": "ptupitsyn", "name": "Pavel Tupitsyn"}}, "url": "https://github.com/apache/ignite/commit/21b45a86e82c33933d6c39608ee19ac4ce381307", "committedDate": "2020-11-19T13:26:19Z", "message": "wip NIO abstraction - refactoring TcpClientChannel"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "bd2b120f7e4f2a0151e4e77aa2b31aecf7c4679b", "author": {"user": {"login": "ptupitsyn", "name": "Pavel Tupitsyn"}}, "url": "https://github.com/apache/ignite/commit/bd2b120f7e4f2a0151e4e77aa2b31aecf7c4679b", "committedDate": "2020-11-19T13:39:12Z", "message": "wip NIO abstraction - refactoring TcpClientChannel"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "548ce1b0d4606959c2b1155a03d548871ba8da21", "author": {"user": {"login": "ptupitsyn", "name": "Pavel Tupitsyn"}}, "url": "https://github.com/apache/ignite/commit/548ce1b0d4606959c2b1155a03d548871ba8da21", "committedDate": "2020-11-19T13:53:01Z", "message": "wip NIO abstraction - refactoring TcpClientChannel - switch everything to ByteBuffer"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "4b1910cfc51ec30607a4aaecf26c6d9ff46bdf55", "author": {"user": {"login": "ptupitsyn", "name": "Pavel Tupitsyn"}}, "url": "https://github.com/apache/ignite/commit/4b1910cfc51ec30607a4aaecf26c6d9ff46bdf55", "committedDate": "2020-11-19T13:54:21Z", "message": "wip NIO abstraction - refactoring TcpClientChannel - switch everything to ByteBuffer"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "00be6c6b734b1d83515f2938d99bbfb149ca706f", "author": {"user": {"login": "ptupitsyn", "name": "Pavel Tupitsyn"}}, "url": "https://github.com/apache/ignite/commit/00be6c6b734b1d83515f2938d99bbfb149ca706f", "committedDate": "2020-11-19T14:00:00Z", "message": "TcpClientChannel refactoring: it compiles"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "03095eef83cbb0f8e701a50273c0ce300ece4b6d", "author": {"user": {"login": "ptupitsyn", "name": "Pavel Tupitsyn"}}, "url": "https://github.com/apache/ignite/commit/03095eef83cbb0f8e701a50273c0ce300ece4b6d", "committedDate": "2020-11-19T14:03:58Z", "message": "TcpClientChannel refactoring: fix tests compilation"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "7e2b3119063c3c971da9c13cadcb975c85d97e8d", "author": {"user": {"login": "ptupitsyn", "name": "Pavel Tupitsyn"}}, "url": "https://github.com/apache/ignite/commit/7e2b3119063c3c971da9c13cadcb975c85d97e8d", "committedDate": "2020-11-19T14:10:14Z", "message": "TcpClientChannel refactoring: fixing simple connection use case"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f2e9f3ee4701b8226398984dbc99d9ca64719f4e", "author": {"user": {"login": "ptupitsyn", "name": "Pavel Tupitsyn"}}, "url": "https://github.com/apache/ignite/commit/f2e9f3ee4701b8226398984dbc99d9ca64719f4e", "committedDate": "2020-11-19T14:15:55Z", "message": "TcpClientChannel refactoring: fixing simple connection use case - fix BinaryByteBufferInputStream"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "46f878d1f40bc7497e02c9aa9e3db2c2b6cf1869", "author": {"user": {"login": "ptupitsyn", "name": "Pavel Tupitsyn"}}, "url": "https://github.com/apache/ignite/commit/46f878d1f40bc7497e02c9aa9e3db2c2b6cf1869", "committedDate": "2020-11-19T14:24:20Z", "message": "TcpClientChannel refactoring: fixing simple connection use case - replace BinaryByteBufferInputStream with BinaryHeapInputStream - handshake works!"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "4ada2943eeece9b06a79f0b53d3d22c2fee45c48", "author": {"user": {"login": "ptupitsyn", "name": "Pavel Tupitsyn"}}, "url": "https://github.com/apache/ignite/commit/4ada2943eeece9b06a79f0b53d3d22c2fee45c48", "committedDate": "2020-11-19T16:52:35Z", "message": "TcpClientChannel refactoring: handshake works with ByteBuffer - ByteOrder fixed"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "d45c409a630d1de336e94416dd6a804055e80043", "author": {"user": {"login": "ptupitsyn", "name": "Pavel Tupitsyn"}}, "url": "https://github.com/apache/ignite/commit/d45c409a630d1de336e94416dd6a804055e80043", "committedDate": "2020-11-19T16:54:09Z", "message": "cleanup"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "03588760621c3d83f5ecae83f19a6bc11fd2c06c", "author": {"user": {"login": "ptupitsyn", "name": "Pavel Tupitsyn"}}, "url": "https://github.com/apache/ignite/commit/03588760621c3d83f5ecae83f19a6bc11fd2c06c", "committedDate": "2020-11-19T19:55:33Z", "message": "Fix BinaryByteBufferInputStream.readIntPositioned"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "af131903cd6de93a8dd0fff7e7645563834fdd2b", "author": {"user": {"login": "ptupitsyn", "name": "Pavel Tupitsyn"}}, "url": "https://github.com/apache/ignite/commit/af131903cd6de93a8dd0fff7e7645563834fdd2b", "committedDate": "2020-11-20T07:25:17Z", "message": "Fix addr passing - fixes testComputeDisabled"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "1fbdbde1f9bfd57e669359ba74b1c8ed0187757e", "author": {"user": {"login": "ptupitsyn", "name": "Pavel Tupitsyn"}}, "url": "https://github.com/apache/ignite/commit/1fbdbde1f9bfd57e669359ba74b1c8ed0187757e", "committedDate": "2020-11-20T07:38:40Z", "message": "cleanup"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "3058159c9c7b439cb646bf6b343f7b55b511a2a4", "author": {"user": {"login": "ptupitsyn", "name": "Pavel Tupitsyn"}}, "url": "https://github.com/apache/ignite/commit/3058159c9c7b439cb646bf6b343f7b55b511a2a4", "committedDate": "2020-11-20T07:38:44Z", "message": "cleanup"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTM1MTc4MDQ1", "url": "https://github.com/apache/ignite/pull/8483#pullrequestreview-535178045", "createdAt": "2020-11-20T07:43:37Z", "commit": {"oid": "3058159c9c7b439cb646bf6b343f7b55b511a2a4"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0yMFQwNzo0MzozOFrOH3Dt1w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0yMFQwNzo0MzozOFrOH3Dt1w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNzQ5NDYxNQ==", "bodyText": "To be honest, there is no need to create more than one selector. One thread for processing IO event\nis more than enough", "url": "https://github.com/apache/ignite/pull/8483#discussion_r527494615", "createdAt": "2020-11-20T07:43:38Z", "author": {"login": "ivandasch"}, "path": "modules/core/src/main/java/org/apache/ignite/internal/client/thin/io/gridnioserver/GridNioServerClientConnectionMultiplexer.java", "diffHunk": "@@ -0,0 +1,177 @@\n+/*\n+ * Licensed to the Apache Software Foundation (ASF) under one or more\n+ * contributor license agreements.  See the NOTICE file distributed with\n+ * this work for additional information regarding copyright ownership.\n+ * The ASF licenses this file to You under the Apache License, Version 2.0\n+ * (the \"License\"); you may not use this file except in compliance with\n+ * the License.  You may obtain a copy of the License at\n+ *\n+ *      http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package org.apache.ignite.internal.client.thin.io.gridnioserver;\n+\n+import org.apache.ignite.IgniteCheckedException;\n+import org.apache.ignite.IgniteException;\n+import org.apache.ignite.IgniteLogger;\n+import org.apache.ignite.failure.FailureType;\n+import org.apache.ignite.internal.client.thin.io.ClientConnection;\n+import org.apache.ignite.internal.client.thin.io.ClientConnectionMultiplexer;\n+import org.apache.ignite.internal.client.thin.io.ClientMessageDecoder;\n+import org.apache.ignite.internal.util.nio.GridNioCodecFilter;\n+import org.apache.ignite.internal.util.nio.GridNioFilter;\n+import org.apache.ignite.internal.util.nio.GridNioFuture;\n+import org.apache.ignite.internal.util.nio.GridNioParser;\n+import org.apache.ignite.internal.util.nio.GridNioServer;\n+import org.apache.ignite.internal.util.nio.GridNioServerListener;\n+import org.apache.ignite.internal.util.nio.GridNioSession;\n+import org.apache.ignite.logger.java.JavaLogger;\n+import org.jetbrains.annotations.Nullable;\n+\n+import java.io.IOException;\n+import java.net.InetAddress;\n+import java.net.InetSocketAddress;\n+import java.net.Socket;\n+import java.nio.ByteBuffer;\n+import java.nio.ByteOrder;\n+import java.util.HashMap;\n+import java.util.Map;\n+import java.util.function.Consumer;\n+\n+/**\n+ * Client connection multiplexer based on {@link org.apache.ignite.internal.util.nio.GridNioServer}.\n+ */\n+public class GridNioServerClientConnectionMultiplexer implements ClientConnectionMultiplexer {\n+    /** */\n+    private static final int CLIENT_MODE_PORT = -1;\n+\n+    /** */\n+    private final GridNioServer<ByteBuffer> srv; // TODO: <ByteBuffer> possible?\n+\n+    public GridNioServerClientConnectionMultiplexer() {\n+        IgniteLogger gridLog = new JavaLogger(false);\n+\n+        ClientMessageDecoder decoder = new ClientMessageDecoder();\n+\n+        GridNioFilter[] filters;\n+\n+        GridNioFilter codecFilter = new GridNioCodecFilter(new GridNioParser() {\n+            @Override\n+            public @Nullable Object decode(GridNioSession ses, ByteBuffer buf) throws IOException, IgniteCheckedException {\n+                byte[] bytes = decoder.apply(buf);\n+\n+                return ByteBuffer.wrap(bytes).order(ByteOrder.nativeOrder());\n+            }\n+\n+            @Override\n+            public ByteBuffer encode(GridNioSession ses, Object msg) throws IOException, IgniteCheckedException {\n+                return (ByteBuffer)msg;\n+            }\n+        }, gridLog, false);\n+\n+//        if (sslCtx != null) {\n+//            GridNioSslFilter sslFilter = new GridNioSslFilter(sslCtx, true, ByteOrder.nativeOrder(), gridLog);\n+//\n+//            sslFilter.directMode(false);\n+//\n+//            filters = new GridNioFilter[]{codecFilter, sslFilter};\n+//        }\n+//        else\n+        filters = new GridNioFilter[]{codecFilter};\n+\n+        try {\n+            srv = GridNioServer.<ByteBuffer>builder()\n+                    .address(InetAddress.getLoopbackAddress()) // TODO: Remove?\n+                    .port(CLIENT_MODE_PORT)\n+                    .listener(new GridNioServerListener<ByteBuffer>() {\n+                        @Override\n+                        public void onConnected(GridNioSession ses) {\n+                            System.out.println(\"Connect\");\n+                        }\n+\n+                        @Override\n+                        public void onDisconnected(GridNioSession ses, @Nullable Exception e) {\n+                            System.out.println(\"Disconnect\");\n+                        }\n+\n+                        @Override\n+                        public void onMessageSent(GridNioSession ses, ByteBuffer msg) {\n+\n+                        }\n+\n+                        @Override\n+                        public void onMessage(GridNioSession ses, ByteBuffer msg) {\n+                            GridNioServerClientConnection conn = ses.meta(GridNioServerClientConnection.SES_META_CONN);\n+\n+                            conn.onMessage(msg);\n+                        }\n+\n+                        @Override\n+                        public void onSessionWriteTimeout(GridNioSession ses) {\n+\n+                        }\n+\n+                        @Override\n+                        public void onSessionIdleTimeout(GridNioSession ses) {\n+\n+                        }\n+\n+                        @Override\n+                        public void onFailure(FailureType failureType, Throwable failure) {\n+                            System.out.println(\"Fail\");\n+                        }\n+                    })\n+                    .filters(filters)\n+                    .logger(gridLog)\n+                    .selectorCount(1) // TODO: Get from settings", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "3058159c9c7b439cb646bf6b343f7b55b511a2a4"}, "originalPosition": 132}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "51edbb23146ac5e63d66ab20fcc82f766275eeeb", "author": {"user": {"login": "ptupitsyn", "name": "Pavel Tupitsyn"}}, "url": "https://github.com/apache/ignite/commit/51edbb23146ac5e63d66ab20fcc82f766275eeeb", "committedDate": "2020-11-20T13:50:11Z", "message": "Fix InetSocketAddress handling"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "1a9193f48c92890bf1469a42947f1d511317644f", "author": {"user": {"login": "ptupitsyn", "name": "Pavel Tupitsyn"}}, "url": "https://github.com/apache/ignite/commit/1a9193f48c92890bf1469a42947f1d511317644f", "committedDate": "2020-11-20T14:15:01Z", "message": "fix partial message handling"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "9abbd88394c1a33517e0148c0172108557aa6f73", "author": {"user": {"login": "ptupitsyn", "name": "Pavel Tupitsyn"}}, "url": "https://github.com/apache/ignite/commit/9abbd88394c1a33517e0148c0172108557aa6f73", "committedDate": "2020-11-20T14:20:55Z", "message": "wip TODOs"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "d964e508225c84126d5bb67bb04b3d3bd7120cff", "author": {"user": {"login": "ptupitsyn", "name": "Pavel Tupitsyn"}}, "url": "https://github.com/apache/ignite/commit/d964e508225c84126d5bb67bb04b3d3bd7120cff", "committedDate": "2020-11-21T11:02:17Z", "message": "wip"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "37c63d075885642c243ad501c2e43761b6f068bd", "author": {"user": {"login": "ptupitsyn", "name": "Pavel Tupitsyn"}}, "url": "https://github.com/apache/ignite/commit/37c63d075885642c243ad501c2e43761b6f068bd", "committedDate": "2020-11-21T11:15:55Z", "message": "wip handle disconnect"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "feb9d91b85fdb22f9c31ac9cf583e7e63dfa5e34", "author": {"user": {"login": "ptupitsyn", "name": "Pavel Tupitsyn"}}, "url": "https://github.com/apache/ignite/commit/feb9d91b85fdb22f9c31ac9cf583e7e63dfa5e34", "committedDate": "2020-11-21T11:46:19Z", "message": "wip handle disconnect"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ecc51012dcb5ff54101c4aa9a26567425ab456dd", "author": {"user": {"login": "ptupitsyn", "name": "Pavel Tupitsyn"}}, "url": "https://github.com/apache/ignite/commit/ecc51012dcb5ff54101c4aa9a26567425ab456dd", "committedDate": "2020-11-21T11:47:01Z", "message": "wip handle disconnect"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f0817b2b68902d510c64e9851bc859dc48b68630", "author": {"user": {"login": "ptupitsyn", "name": "Pavel Tupitsyn"}}, "url": "https://github.com/apache/ignite/commit/f0817b2b68902d510c64e9851bc859dc48b68630", "committedDate": "2020-11-21T11:48:05Z", "message": "disconnect handling works"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e68f50609fea7c20e5db64d4703ab22d7d83cfd9", "author": {"user": {"login": "ptupitsyn", "name": "Pavel Tupitsyn"}}, "url": "https://github.com/apache/ignite/commit/e68f50609fea7c20e5db64d4703ab22d7d83cfd9", "committedDate": "2020-11-21T12:04:38Z", "message": "wip fixing testResourcesReleasedAfterClientClosed"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "8a01ec698bc11eb6ba47baf89f09524f387e1377", "author": {"user": {"login": "ptupitsyn", "name": "Pavel Tupitsyn"}}, "url": "https://github.com/apache/ignite/commit/8a01ec698bc11eb6ba47baf89f09524f387e1377", "committedDate": "2020-11-21T12:08:37Z", "message": "testResourcesReleasedAfterClientClosed fixed"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "56c6c21f81521c8b806bea5496347d847dace15c", "author": {"user": {"login": "ptupitsyn", "name": "Pavel Tupitsyn"}}, "url": "https://github.com/apache/ignite/commit/56c6c21f81521c8b806bea5496347d847dace15c", "committedDate": "2020-11-21T12:25:13Z", "message": "Replace ReliableChannel#asyncRunner with ForkJoinPool.commonPool()"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "0435af0b60db215a713f9bc3e6ad9ac066413377", "author": {"user": {"login": "ptupitsyn", "name": "Pavel Tupitsyn"}}, "url": "https://github.com/apache/ignite/commit/0435af0b60db215a713f9bc3e6ad9ac066413377", "committedDate": "2020-11-21T14:08:42Z", "message": "Replace ReliableChannel#asyncRunner with ForkJoinPool.commonPool() - cleanup"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "3b6fe96304d0aef80d596f9d43a1da5535ed2053", "author": {"user": {"login": "ptupitsyn", "name": "Pavel Tupitsyn"}}, "url": "https://github.com/apache/ignite/commit/3b6fe96304d0aef80d596f9d43a1da5535ed2053", "committedDate": "2020-11-21T14:10:10Z", "message": "Replace ReliableChannel#asyncRunner with ForkJoinPool.commonPool() - cleanup"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "45b6b7db6b651eb1fae43381e6692bf81e011dd3", "author": {"user": {"login": "ptupitsyn", "name": "Pavel Tupitsyn"}}, "url": "https://github.com/apache/ignite/commit/45b6b7db6b651eb1fae43381e6692bf81e011dd3", "committedDate": "2020-11-22T15:43:42Z", "message": "wip SSL"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "9d0665115d0301cc9991e640028aabb3edee7eeb", "author": {"user": {"login": "ptupitsyn", "name": "Pavel Tupitsyn"}}, "url": "https://github.com/apache/ignite/commit/9d0665115d0301cc9991e640028aabb3edee7eeb", "committedDate": "2020-11-22T15:56:52Z", "message": "wip SSL"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "fc0dbfea2f56131dff6a4e2b693a5d59b363dd21", "author": {"user": {"login": "ptupitsyn", "name": "Pavel Tupitsyn"}}, "url": "https://github.com/apache/ignite/commit/fc0dbfea2f56131dff6a4e2b693a5d59b363dd21", "committedDate": "2020-11-22T16:16:51Z", "message": "wip SSL"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "14d4381e6e4d2c5547e53d5722d1bf0f76cbc7e3", "author": {"user": {"login": "ptupitsyn", "name": "Pavel Tupitsyn"}}, "url": "https://github.com/apache/ignite/commit/14d4381e6e4d2c5547e53d5722d1bf0f76cbc7e3", "committedDate": "2020-11-22T16:28:16Z", "message": "wip SSL"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "0beb60fdd1e836d4714b202d5b7cdcd46a0431ae", "author": {"user": {"login": "ptupitsyn", "name": "Pavel Tupitsyn"}}, "url": "https://github.com/apache/ignite/commit/0beb60fdd1e836d4714b202d5b7cdcd46a0431ae", "committedDate": "2020-11-22T16:37:26Z", "message": "wip SSL - compilation fixed"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "31c488e1a88b74144ed442d5073008b6812e99b1", "author": {"user": {"login": "ptupitsyn", "name": "Pavel Tupitsyn"}}, "url": "https://github.com/apache/ignite/commit/31c488e1a88b74144ed442d5073008b6812e99b1", "committedDate": "2020-11-22T16:49:22Z", "message": "wip SSL - compilation fixed"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "8519a86f91077a8b01d8fd9e84f2161a299025a7", "author": {"user": {"login": "ptupitsyn", "name": "Pavel Tupitsyn"}}, "url": "https://github.com/apache/ignite/commit/8519a86f91077a8b01d8fd9e84f2161a299025a7", "committedDate": "2020-11-22T16:57:44Z", "message": "SSL works - basic test passes"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "77917e56a7cc6c84d6cb8b222426691ee57e9ac0", "author": {"user": {"login": "ptupitsyn", "name": "Pavel Tupitsyn"}}, "url": "https://github.com/apache/ignite/commit/77917e56a7cc6c84d6cb8b222426691ee57e9ac0", "committedDate": "2020-11-23T09:42:30Z", "message": "wip cleanup"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "016356b35dc460edfd018873119bb1c09c92400f", "author": {"user": {"login": "ptupitsyn", "name": "Pavel Tupitsyn"}}, "url": "https://github.com/apache/ignite/commit/016356b35dc460edfd018873119bb1c09c92400f", "committedDate": "2020-11-23T09:45:56Z", "message": "Merge remote-tracking branch 'origin/master' into ignite-13496\n\n# Conflicts:\n#\tmodules/core/src/main/java/org/apache/ignite/internal/client/thin/TcpClientChannel.java"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "81c346a0df15dee49f6a450b9db51c338845644a", "author": {"user": {"login": "ptupitsyn", "name": "Pavel Tupitsyn"}}, "url": "https://github.com/apache/ignite/commit/81c346a0df15dee49f6a450b9db51c338845644a", "committedDate": "2020-11-23T10:01:23Z", "message": "wip cleanup"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "7429ce0259e60ce9f3180eb2919c98357b838f25", "author": {"user": {"login": "ptupitsyn", "name": "Pavel Tupitsyn"}}, "url": "https://github.com/apache/ignite/commit/7429ce0259e60ce9f3180eb2919c98357b838f25", "committedDate": "2020-11-23T10:11:39Z", "message": "fixing tests"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2979, "cost": 1, "resetAt": "2021-10-29T19:57:52Z"}}}