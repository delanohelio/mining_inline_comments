{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDkzNzgyODM0", "number": 8284, "reviewThreads": {"totalCount": 8, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wMVQxNjozMDozNFrOEpjS7w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wMlQwODowMTozOFrOEpuYHw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzEyMDA1MzU5OnYy", "diffSide": "RIGHT", "path": "modules/core/src/main/java/org/apache/ignite/internal/visor/metric/VisorMetricTask.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wMVQxNjozMDozNFrOHbSV3g==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wMVQyMjoxMTowNlrOHbcU7A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5ODM3NDExMA==", "bodyText": "Can metric.getAsString() be used instead of this method?", "url": "https://github.com/apache/ignite/pull/8284#discussion_r498374110", "createdAt": "2020-10-01T16:30:34Z", "author": {"login": "NSAmelchev"}, "path": "modules/core/src/main/java/org/apache/ignite/internal/visor/metric/VisorMetricTask.java", "diffHunk": "@@ -0,0 +1,130 @@\n+/*\n+ * Licensed to the Apache Software Foundation (ASF) under one or more\n+ * contributor license agreements.  See the NOTICE file distributed with\n+ * this work for additional information regarding copyright ownership.\n+ * The ASF licenses this file to You under the Apache License, Version 2.0\n+ * (the \"License\"); you may not use this file except in compliance with\n+ * the License.  You may obtain a copy of the License at\n+ *\n+ *      http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package org.apache.ignite.internal.visor.metric;\n+\n+import java.util.Collections;\n+import java.util.HashMap;\n+import java.util.Map;\n+import org.apache.ignite.IgniteException;\n+import org.apache.ignite.internal.processors.metric.GridMetricManager;\n+import org.apache.ignite.internal.processors.task.GridInternal;\n+import org.apache.ignite.internal.processors.task.GridVisorManagementTask;\n+import org.apache.ignite.internal.visor.VisorJob;\n+import org.apache.ignite.internal.visor.VisorOneNodeTask;\n+import org.apache.ignite.spi.metric.BooleanMetric;\n+import org.apache.ignite.spi.metric.DoubleMetric;\n+import org.apache.ignite.spi.metric.IntMetric;\n+import org.apache.ignite.spi.metric.LongMetric;\n+import org.apache.ignite.spi.metric.Metric;\n+import org.apache.ignite.spi.metric.ObjectMetric;\n+import org.apache.ignite.spi.metric.ReadOnlyMetricRegistry;\n+import org.jetbrains.annotations.Nullable;\n+\n+import static org.apache.ignite.internal.processors.metric.impl.MetricUtils.SEPARATOR;\n+import static org.apache.ignite.spi.metric.jmx.MetricRegistryMBean.searchHistogram;\n+\n+/** Reperesents visor task for obtaining metric values. */\n+@GridInternal\n+@GridVisorManagementTask\n+public class VisorMetricTask extends VisorOneNodeTask<VisorMetricTaskArg, Map<String, ?>> {\n+    /** */\n+    private static final long serialVersionUID = 0L;\n+\n+    /** {@inheritDoc} */\n+    @Override protected VisorJob<VisorMetricTaskArg, Map<String, ?>> job(VisorMetricTaskArg arg) {\n+        return new VisorMetricJob(arg, false);\n+    }\n+\n+    /** */\n+    private static class VisorMetricJob extends VisorJob<VisorMetricTaskArg, Map<String, ?>> {\n+        /** */\n+        private static final long serialVersionUID = 0L;\n+\n+        /**\n+         * Create job with specified argument.\n+         *\n+         * @param arg   Job argument.\n+         * @param debug Flag indicating whether debug information should be printed into node log.\n+         */\n+        protected VisorMetricJob(@Nullable VisorMetricTaskArg arg, boolean debug) {\n+            super(arg, debug);\n+        }\n+\n+        /** {@inheritDoc} */\n+        @Override protected Map<String, ?> run(@Nullable VisorMetricTaskArg arg) throws IgniteException {\n+            String name = arg.name();\n+\n+            GridMetricManager mMgr = ignite.context().metric();\n+\n+            for (ReadOnlyMetricRegistry mReg : mMgr) {\n+                String mRegName = mReg.name();\n+\n+                if (mRegName.equals(name)) {\n+                    Map<String, Object> res = new HashMap<>();\n+\n+                    mReg.forEach(metric -> res.put(metric.name(), valueOf(metric)));\n+\n+                    return res;\n+                }\n+\n+                String mRegPrefix = mRegName + SEPARATOR;\n+\n+                if (!name.startsWith(mRegPrefix))\n+                    continue;\n+\n+                if (mRegPrefix.equals(name))\n+                    return null;\n+\n+                String metricName = name.substring(mRegPrefix.length());\n+\n+                Metric metric = mReg.findMetric(metricName);\n+\n+                if (metric != null)\n+                    return Collections.singletonMap(name, valueOf(metric));\n+\n+                Object val = searchHistogram(metricName, mReg);\n+\n+                if (val != null)\n+                    return Collections.singletonMap(name, val);\n+            }\n+\n+            return null;\n+        }\n+\n+        /**\n+         * Obtains value of the metric.\n+         *\n+         * @param metric Metric which value should be obtained.\n+         * @return Value of the metric.\n+         */\n+        private Object valueOf(Metric metric) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "6f2469ef3913f4474d24805da8c79424f7a879ce"}, "originalPosition": 115}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5ODUzNzcwOA==", "bodyText": "I haven't used getAsString() method for primitive types to reduce size of response message and avoid unnecessary converting on the server side.", "url": "https://github.com/apache/ignite/pull/8284#discussion_r498537708", "createdAt": "2020-10-01T22:11:06Z", "author": {"login": "ololo3000"}, "path": "modules/core/src/main/java/org/apache/ignite/internal/visor/metric/VisorMetricTask.java", "diffHunk": "@@ -0,0 +1,130 @@\n+/*\n+ * Licensed to the Apache Software Foundation (ASF) under one or more\n+ * contributor license agreements.  See the NOTICE file distributed with\n+ * this work for additional information regarding copyright ownership.\n+ * The ASF licenses this file to You under the Apache License, Version 2.0\n+ * (the \"License\"); you may not use this file except in compliance with\n+ * the License.  You may obtain a copy of the License at\n+ *\n+ *      http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package org.apache.ignite.internal.visor.metric;\n+\n+import java.util.Collections;\n+import java.util.HashMap;\n+import java.util.Map;\n+import org.apache.ignite.IgniteException;\n+import org.apache.ignite.internal.processors.metric.GridMetricManager;\n+import org.apache.ignite.internal.processors.task.GridInternal;\n+import org.apache.ignite.internal.processors.task.GridVisorManagementTask;\n+import org.apache.ignite.internal.visor.VisorJob;\n+import org.apache.ignite.internal.visor.VisorOneNodeTask;\n+import org.apache.ignite.spi.metric.BooleanMetric;\n+import org.apache.ignite.spi.metric.DoubleMetric;\n+import org.apache.ignite.spi.metric.IntMetric;\n+import org.apache.ignite.spi.metric.LongMetric;\n+import org.apache.ignite.spi.metric.Metric;\n+import org.apache.ignite.spi.metric.ObjectMetric;\n+import org.apache.ignite.spi.metric.ReadOnlyMetricRegistry;\n+import org.jetbrains.annotations.Nullable;\n+\n+import static org.apache.ignite.internal.processors.metric.impl.MetricUtils.SEPARATOR;\n+import static org.apache.ignite.spi.metric.jmx.MetricRegistryMBean.searchHistogram;\n+\n+/** Reperesents visor task for obtaining metric values. */\n+@GridInternal\n+@GridVisorManagementTask\n+public class VisorMetricTask extends VisorOneNodeTask<VisorMetricTaskArg, Map<String, ?>> {\n+    /** */\n+    private static final long serialVersionUID = 0L;\n+\n+    /** {@inheritDoc} */\n+    @Override protected VisorJob<VisorMetricTaskArg, Map<String, ?>> job(VisorMetricTaskArg arg) {\n+        return new VisorMetricJob(arg, false);\n+    }\n+\n+    /** */\n+    private static class VisorMetricJob extends VisorJob<VisorMetricTaskArg, Map<String, ?>> {\n+        /** */\n+        private static final long serialVersionUID = 0L;\n+\n+        /**\n+         * Create job with specified argument.\n+         *\n+         * @param arg   Job argument.\n+         * @param debug Flag indicating whether debug information should be printed into node log.\n+         */\n+        protected VisorMetricJob(@Nullable VisorMetricTaskArg arg, boolean debug) {\n+            super(arg, debug);\n+        }\n+\n+        /** {@inheritDoc} */\n+        @Override protected Map<String, ?> run(@Nullable VisorMetricTaskArg arg) throws IgniteException {\n+            String name = arg.name();\n+\n+            GridMetricManager mMgr = ignite.context().metric();\n+\n+            for (ReadOnlyMetricRegistry mReg : mMgr) {\n+                String mRegName = mReg.name();\n+\n+                if (mRegName.equals(name)) {\n+                    Map<String, Object> res = new HashMap<>();\n+\n+                    mReg.forEach(metric -> res.put(metric.name(), valueOf(metric)));\n+\n+                    return res;\n+                }\n+\n+                String mRegPrefix = mRegName + SEPARATOR;\n+\n+                if (!name.startsWith(mRegPrefix))\n+                    continue;\n+\n+                if (mRegPrefix.equals(name))\n+                    return null;\n+\n+                String metricName = name.substring(mRegPrefix.length());\n+\n+                Metric metric = mReg.findMetric(metricName);\n+\n+                if (metric != null)\n+                    return Collections.singletonMap(name, valueOf(metric));\n+\n+                Object val = searchHistogram(metricName, mReg);\n+\n+                if (val != null)\n+                    return Collections.singletonMap(name, val);\n+            }\n+\n+            return null;\n+        }\n+\n+        /**\n+         * Obtains value of the metric.\n+         *\n+         * @param metric Metric which value should be obtained.\n+         * @return Value of the metric.\n+         */\n+        private Object valueOf(Metric metric) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5ODM3NDExMA=="}, "originalCommit": {"oid": "6f2469ef3913f4474d24805da8c79424f7a879ce"}, "originalPosition": 115}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzEyMTc1Nzc3OnYy", "diffSide": "RIGHT", "path": "modules/core/src/main/java/org/apache/ignite/util/SimpleType.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wMlQwNzoyMTozOVrOHbjaOA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wMlQxOToxODo1N1rOHb497A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5ODY1Mzc1Mg==", "bodyText": "This enum has a very closed use scope.\nLet's move it back to the SystemViewVisorTask\nWe shouldn't flood util package with the class that can be used only in 2 cases.", "url": "https://github.com/apache/ignite/pull/8284#discussion_r498653752", "createdAt": "2020-10-02T07:21:39Z", "author": {"login": "nizhikov"}, "path": "modules/core/src/main/java/org/apache/ignite/util/SimpleType.java", "diffHunk": "@@ -0,0 +1,32 @@\n+/*\n+ * Licensed to the Apache Software Foundation (ASF) under one or more\n+ * contributor license agreements.  See the NOTICE file distributed with\n+ * this work for additional information regarding copyright ownership.\n+ * The ASF licenses this file to You under the Apache License, Version 2.0\n+ * (the \"License\"); you may not use this file except in compliance with\n+ * the License.  You may obtain a copy of the License at\n+ *\n+ *      http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package org.apache.ignite.util;\n+\n+/**\n+ * Represents lightweight type descriptors.\n+ */\n+public enum SimpleType {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b0d50dac9d90aa28d543bf50df29fc222dd9db37"}, "originalPosition": 23}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5OTAwNjk1Ng==", "bodyText": "Done.", "url": "https://github.com/apache/ignite/pull/8284#discussion_r499006956", "createdAt": "2020-10-02T19:18:57Z", "author": {"login": "ololo3000"}, "path": "modules/core/src/main/java/org/apache/ignite/util/SimpleType.java", "diffHunk": "@@ -0,0 +1,32 @@\n+/*\n+ * Licensed to the Apache Software Foundation (ASF) under one or more\n+ * contributor license agreements.  See the NOTICE file distributed with\n+ * this work for additional information regarding copyright ownership.\n+ * The ASF licenses this file to You under the Apache License, Version 2.0\n+ * (the \"License\"); you may not use this file except in compliance with\n+ * the License.  You may obtain a copy of the License at\n+ *\n+ *      http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package org.apache.ignite.util;\n+\n+/**\n+ * Represents lightweight type descriptors.\n+ */\n+public enum SimpleType {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5ODY1Mzc1Mg=="}, "originalCommit": {"oid": "b0d50dac9d90aa28d543bf50df29fc222dd9db37"}, "originalPosition": 23}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzEyMTc3NTY2OnYy", "diffSide": "RIGHT", "path": "modules/core/src/main/java/org/apache/ignite/internal/visor/metric/VisorMetricTask.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wMlQwNzoyOTowMVrOHbjlgQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wMlQxOToxOTowOFrOHb4-QQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5ODY1NjY0MQ==", "bodyText": "mMgr -> mmgr", "url": "https://github.com/apache/ignite/pull/8284#discussion_r498656641", "createdAt": "2020-10-02T07:29:01Z", "author": {"login": "nizhikov"}, "path": "modules/core/src/main/java/org/apache/ignite/internal/visor/metric/VisorMetricTask.java", "diffHunk": "@@ -0,0 +1,130 @@\n+/*\n+ * Licensed to the Apache Software Foundation (ASF) under one or more\n+ * contributor license agreements.  See the NOTICE file distributed with\n+ * this work for additional information regarding copyright ownership.\n+ * The ASF licenses this file to You under the Apache License, Version 2.0\n+ * (the \"License\"); you may not use this file except in compliance with\n+ * the License.  You may obtain a copy of the License at\n+ *\n+ *      http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package org.apache.ignite.internal.visor.metric;\n+\n+import java.util.Collections;\n+import java.util.HashMap;\n+import java.util.Map;\n+import org.apache.ignite.IgniteException;\n+import org.apache.ignite.internal.processors.metric.GridMetricManager;\n+import org.apache.ignite.internal.processors.task.GridInternal;\n+import org.apache.ignite.internal.processors.task.GridVisorManagementTask;\n+import org.apache.ignite.internal.visor.VisorJob;\n+import org.apache.ignite.internal.visor.VisorOneNodeTask;\n+import org.apache.ignite.spi.metric.BooleanMetric;\n+import org.apache.ignite.spi.metric.DoubleMetric;\n+import org.apache.ignite.spi.metric.IntMetric;\n+import org.apache.ignite.spi.metric.LongMetric;\n+import org.apache.ignite.spi.metric.Metric;\n+import org.apache.ignite.spi.metric.ObjectMetric;\n+import org.apache.ignite.spi.metric.ReadOnlyMetricRegistry;\n+import org.jetbrains.annotations.Nullable;\n+\n+import static org.apache.ignite.internal.processors.metric.impl.MetricUtils.SEPARATOR;\n+import static org.apache.ignite.spi.metric.jmx.MetricRegistryMBean.searchHistogram;\n+\n+/** Reperesents visor task for obtaining metric values. */\n+@GridInternal\n+@GridVisorManagementTask\n+public class VisorMetricTask extends VisorOneNodeTask<VisorMetricTaskArg, Map<String, ?>> {\n+    /** */\n+    private static final long serialVersionUID = 0L;\n+\n+    /** {@inheritDoc} */\n+    @Override protected VisorJob<VisorMetricTaskArg, Map<String, ?>> job(VisorMetricTaskArg arg) {\n+        return new VisorMetricJob(arg, false);\n+    }\n+\n+    /** */\n+    private static class VisorMetricJob extends VisorJob<VisorMetricTaskArg, Map<String, ?>> {\n+        /** */\n+        private static final long serialVersionUID = 0L;\n+\n+        /**\n+         * Create job with specified argument.\n+         *\n+         * @param arg   Job argument.\n+         * @param debug Flag indicating whether debug information should be printed into node log.\n+         */\n+        protected VisorMetricJob(@Nullable VisorMetricTaskArg arg, boolean debug) {\n+            super(arg, debug);\n+        }\n+\n+        /** {@inheritDoc} */\n+        @Override protected Map<String, ?> run(@Nullable VisorMetricTaskArg arg) throws IgniteException {\n+            String name = arg.name();\n+\n+            GridMetricManager mMgr = ignite.context().metric();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b0d50dac9d90aa28d543bf50df29fc222dd9db37"}, "originalPosition": 72}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5OTAwNzA0MQ==", "bodyText": "Done.", "url": "https://github.com/apache/ignite/pull/8284#discussion_r499007041", "createdAt": "2020-10-02T19:19:08Z", "author": {"login": "ololo3000"}, "path": "modules/core/src/main/java/org/apache/ignite/internal/visor/metric/VisorMetricTask.java", "diffHunk": "@@ -0,0 +1,130 @@\n+/*\n+ * Licensed to the Apache Software Foundation (ASF) under one or more\n+ * contributor license agreements.  See the NOTICE file distributed with\n+ * this work for additional information regarding copyright ownership.\n+ * The ASF licenses this file to You under the Apache License, Version 2.0\n+ * (the \"License\"); you may not use this file except in compliance with\n+ * the License.  You may obtain a copy of the License at\n+ *\n+ *      http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package org.apache.ignite.internal.visor.metric;\n+\n+import java.util.Collections;\n+import java.util.HashMap;\n+import java.util.Map;\n+import org.apache.ignite.IgniteException;\n+import org.apache.ignite.internal.processors.metric.GridMetricManager;\n+import org.apache.ignite.internal.processors.task.GridInternal;\n+import org.apache.ignite.internal.processors.task.GridVisorManagementTask;\n+import org.apache.ignite.internal.visor.VisorJob;\n+import org.apache.ignite.internal.visor.VisorOneNodeTask;\n+import org.apache.ignite.spi.metric.BooleanMetric;\n+import org.apache.ignite.spi.metric.DoubleMetric;\n+import org.apache.ignite.spi.metric.IntMetric;\n+import org.apache.ignite.spi.metric.LongMetric;\n+import org.apache.ignite.spi.metric.Metric;\n+import org.apache.ignite.spi.metric.ObjectMetric;\n+import org.apache.ignite.spi.metric.ReadOnlyMetricRegistry;\n+import org.jetbrains.annotations.Nullable;\n+\n+import static org.apache.ignite.internal.processors.metric.impl.MetricUtils.SEPARATOR;\n+import static org.apache.ignite.spi.metric.jmx.MetricRegistryMBean.searchHistogram;\n+\n+/** Reperesents visor task for obtaining metric values. */\n+@GridInternal\n+@GridVisorManagementTask\n+public class VisorMetricTask extends VisorOneNodeTask<VisorMetricTaskArg, Map<String, ?>> {\n+    /** */\n+    private static final long serialVersionUID = 0L;\n+\n+    /** {@inheritDoc} */\n+    @Override protected VisorJob<VisorMetricTaskArg, Map<String, ?>> job(VisorMetricTaskArg arg) {\n+        return new VisorMetricJob(arg, false);\n+    }\n+\n+    /** */\n+    private static class VisorMetricJob extends VisorJob<VisorMetricTaskArg, Map<String, ?>> {\n+        /** */\n+        private static final long serialVersionUID = 0L;\n+\n+        /**\n+         * Create job with specified argument.\n+         *\n+         * @param arg   Job argument.\n+         * @param debug Flag indicating whether debug information should be printed into node log.\n+         */\n+        protected VisorMetricJob(@Nullable VisorMetricTaskArg arg, boolean debug) {\n+            super(arg, debug);\n+        }\n+\n+        /** {@inheritDoc} */\n+        @Override protected Map<String, ?> run(@Nullable VisorMetricTaskArg arg) throws IgniteException {\n+            String name = arg.name();\n+\n+            GridMetricManager mMgr = ignite.context().metric();", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5ODY1NjY0MQ=="}, "originalCommit": {"oid": "b0d50dac9d90aa28d543bf50df29fc222dd9db37"}, "originalPosition": 72}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzEyMTc3NjEwOnYy", "diffSide": "RIGHT", "path": "modules/core/src/main/java/org/apache/ignite/internal/visor/metric/VisorMetricTask.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wMlQwNzoyOTowOVrOHbjlxA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wMlQxOToxOToxM1rOHb4-dg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5ODY1NjcwOA==", "bodyText": "mReg -> mreg", "url": "https://github.com/apache/ignite/pull/8284#discussion_r498656708", "createdAt": "2020-10-02T07:29:09Z", "author": {"login": "nizhikov"}, "path": "modules/core/src/main/java/org/apache/ignite/internal/visor/metric/VisorMetricTask.java", "diffHunk": "@@ -0,0 +1,130 @@\n+/*\n+ * Licensed to the Apache Software Foundation (ASF) under one or more\n+ * contributor license agreements.  See the NOTICE file distributed with\n+ * this work for additional information regarding copyright ownership.\n+ * The ASF licenses this file to You under the Apache License, Version 2.0\n+ * (the \"License\"); you may not use this file except in compliance with\n+ * the License.  You may obtain a copy of the License at\n+ *\n+ *      http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package org.apache.ignite.internal.visor.metric;\n+\n+import java.util.Collections;\n+import java.util.HashMap;\n+import java.util.Map;\n+import org.apache.ignite.IgniteException;\n+import org.apache.ignite.internal.processors.metric.GridMetricManager;\n+import org.apache.ignite.internal.processors.task.GridInternal;\n+import org.apache.ignite.internal.processors.task.GridVisorManagementTask;\n+import org.apache.ignite.internal.visor.VisorJob;\n+import org.apache.ignite.internal.visor.VisorOneNodeTask;\n+import org.apache.ignite.spi.metric.BooleanMetric;\n+import org.apache.ignite.spi.metric.DoubleMetric;\n+import org.apache.ignite.spi.metric.IntMetric;\n+import org.apache.ignite.spi.metric.LongMetric;\n+import org.apache.ignite.spi.metric.Metric;\n+import org.apache.ignite.spi.metric.ObjectMetric;\n+import org.apache.ignite.spi.metric.ReadOnlyMetricRegistry;\n+import org.jetbrains.annotations.Nullable;\n+\n+import static org.apache.ignite.internal.processors.metric.impl.MetricUtils.SEPARATOR;\n+import static org.apache.ignite.spi.metric.jmx.MetricRegistryMBean.searchHistogram;\n+\n+/** Reperesents visor task for obtaining metric values. */\n+@GridInternal\n+@GridVisorManagementTask\n+public class VisorMetricTask extends VisorOneNodeTask<VisorMetricTaskArg, Map<String, ?>> {\n+    /** */\n+    private static final long serialVersionUID = 0L;\n+\n+    /** {@inheritDoc} */\n+    @Override protected VisorJob<VisorMetricTaskArg, Map<String, ?>> job(VisorMetricTaskArg arg) {\n+        return new VisorMetricJob(arg, false);\n+    }\n+\n+    /** */\n+    private static class VisorMetricJob extends VisorJob<VisorMetricTaskArg, Map<String, ?>> {\n+        /** */\n+        private static final long serialVersionUID = 0L;\n+\n+        /**\n+         * Create job with specified argument.\n+         *\n+         * @param arg   Job argument.\n+         * @param debug Flag indicating whether debug information should be printed into node log.\n+         */\n+        protected VisorMetricJob(@Nullable VisorMetricTaskArg arg, boolean debug) {\n+            super(arg, debug);\n+        }\n+\n+        /** {@inheritDoc} */\n+        @Override protected Map<String, ?> run(@Nullable VisorMetricTaskArg arg) throws IgniteException {\n+            String name = arg.name();\n+\n+            GridMetricManager mMgr = ignite.context().metric();\n+\n+            for (ReadOnlyMetricRegistry mReg : mMgr) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b0d50dac9d90aa28d543bf50df29fc222dd9db37"}, "originalPosition": 74}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5OTAwNzA5NA==", "bodyText": "Done.", "url": "https://github.com/apache/ignite/pull/8284#discussion_r499007094", "createdAt": "2020-10-02T19:19:13Z", "author": {"login": "ololo3000"}, "path": "modules/core/src/main/java/org/apache/ignite/internal/visor/metric/VisorMetricTask.java", "diffHunk": "@@ -0,0 +1,130 @@\n+/*\n+ * Licensed to the Apache Software Foundation (ASF) under one or more\n+ * contributor license agreements.  See the NOTICE file distributed with\n+ * this work for additional information regarding copyright ownership.\n+ * The ASF licenses this file to You under the Apache License, Version 2.0\n+ * (the \"License\"); you may not use this file except in compliance with\n+ * the License.  You may obtain a copy of the License at\n+ *\n+ *      http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package org.apache.ignite.internal.visor.metric;\n+\n+import java.util.Collections;\n+import java.util.HashMap;\n+import java.util.Map;\n+import org.apache.ignite.IgniteException;\n+import org.apache.ignite.internal.processors.metric.GridMetricManager;\n+import org.apache.ignite.internal.processors.task.GridInternal;\n+import org.apache.ignite.internal.processors.task.GridVisorManagementTask;\n+import org.apache.ignite.internal.visor.VisorJob;\n+import org.apache.ignite.internal.visor.VisorOneNodeTask;\n+import org.apache.ignite.spi.metric.BooleanMetric;\n+import org.apache.ignite.spi.metric.DoubleMetric;\n+import org.apache.ignite.spi.metric.IntMetric;\n+import org.apache.ignite.spi.metric.LongMetric;\n+import org.apache.ignite.spi.metric.Metric;\n+import org.apache.ignite.spi.metric.ObjectMetric;\n+import org.apache.ignite.spi.metric.ReadOnlyMetricRegistry;\n+import org.jetbrains.annotations.Nullable;\n+\n+import static org.apache.ignite.internal.processors.metric.impl.MetricUtils.SEPARATOR;\n+import static org.apache.ignite.spi.metric.jmx.MetricRegistryMBean.searchHistogram;\n+\n+/** Reperesents visor task for obtaining metric values. */\n+@GridInternal\n+@GridVisorManagementTask\n+public class VisorMetricTask extends VisorOneNodeTask<VisorMetricTaskArg, Map<String, ?>> {\n+    /** */\n+    private static final long serialVersionUID = 0L;\n+\n+    /** {@inheritDoc} */\n+    @Override protected VisorJob<VisorMetricTaskArg, Map<String, ?>> job(VisorMetricTaskArg arg) {\n+        return new VisorMetricJob(arg, false);\n+    }\n+\n+    /** */\n+    private static class VisorMetricJob extends VisorJob<VisorMetricTaskArg, Map<String, ?>> {\n+        /** */\n+        private static final long serialVersionUID = 0L;\n+\n+        /**\n+         * Create job with specified argument.\n+         *\n+         * @param arg   Job argument.\n+         * @param debug Flag indicating whether debug information should be printed into node log.\n+         */\n+        protected VisorMetricJob(@Nullable VisorMetricTaskArg arg, boolean debug) {\n+            super(arg, debug);\n+        }\n+\n+        /** {@inheritDoc} */\n+        @Override protected Map<String, ?> run(@Nullable VisorMetricTaskArg arg) throws IgniteException {\n+            String name = arg.name();\n+\n+            GridMetricManager mMgr = ignite.context().metric();\n+\n+            for (ReadOnlyMetricRegistry mReg : mMgr) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5ODY1NjcwOA=="}, "originalCommit": {"oid": "b0d50dac9d90aa28d543bf50df29fc222dd9db37"}, "originalPosition": 74}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzEyMTc3NjQyOnYy", "diffSide": "RIGHT", "path": "modules/core/src/main/java/org/apache/ignite/internal/visor/metric/VisorMetricTask.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wMlQwNzoyOToxOFrOHbjmAA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wMlQxOToxOToxOFrOHb4-jQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5ODY1Njc2OA==", "bodyText": "mRegName -> mregName", "url": "https://github.com/apache/ignite/pull/8284#discussion_r498656768", "createdAt": "2020-10-02T07:29:18Z", "author": {"login": "nizhikov"}, "path": "modules/core/src/main/java/org/apache/ignite/internal/visor/metric/VisorMetricTask.java", "diffHunk": "@@ -0,0 +1,130 @@\n+/*\n+ * Licensed to the Apache Software Foundation (ASF) under one or more\n+ * contributor license agreements.  See the NOTICE file distributed with\n+ * this work for additional information regarding copyright ownership.\n+ * The ASF licenses this file to You under the Apache License, Version 2.0\n+ * (the \"License\"); you may not use this file except in compliance with\n+ * the License.  You may obtain a copy of the License at\n+ *\n+ *      http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package org.apache.ignite.internal.visor.metric;\n+\n+import java.util.Collections;\n+import java.util.HashMap;\n+import java.util.Map;\n+import org.apache.ignite.IgniteException;\n+import org.apache.ignite.internal.processors.metric.GridMetricManager;\n+import org.apache.ignite.internal.processors.task.GridInternal;\n+import org.apache.ignite.internal.processors.task.GridVisorManagementTask;\n+import org.apache.ignite.internal.visor.VisorJob;\n+import org.apache.ignite.internal.visor.VisorOneNodeTask;\n+import org.apache.ignite.spi.metric.BooleanMetric;\n+import org.apache.ignite.spi.metric.DoubleMetric;\n+import org.apache.ignite.spi.metric.IntMetric;\n+import org.apache.ignite.spi.metric.LongMetric;\n+import org.apache.ignite.spi.metric.Metric;\n+import org.apache.ignite.spi.metric.ObjectMetric;\n+import org.apache.ignite.spi.metric.ReadOnlyMetricRegistry;\n+import org.jetbrains.annotations.Nullable;\n+\n+import static org.apache.ignite.internal.processors.metric.impl.MetricUtils.SEPARATOR;\n+import static org.apache.ignite.spi.metric.jmx.MetricRegistryMBean.searchHistogram;\n+\n+/** Reperesents visor task for obtaining metric values. */\n+@GridInternal\n+@GridVisorManagementTask\n+public class VisorMetricTask extends VisorOneNodeTask<VisorMetricTaskArg, Map<String, ?>> {\n+    /** */\n+    private static final long serialVersionUID = 0L;\n+\n+    /** {@inheritDoc} */\n+    @Override protected VisorJob<VisorMetricTaskArg, Map<String, ?>> job(VisorMetricTaskArg arg) {\n+        return new VisorMetricJob(arg, false);\n+    }\n+\n+    /** */\n+    private static class VisorMetricJob extends VisorJob<VisorMetricTaskArg, Map<String, ?>> {\n+        /** */\n+        private static final long serialVersionUID = 0L;\n+\n+        /**\n+         * Create job with specified argument.\n+         *\n+         * @param arg   Job argument.\n+         * @param debug Flag indicating whether debug information should be printed into node log.\n+         */\n+        protected VisorMetricJob(@Nullable VisorMetricTaskArg arg, boolean debug) {\n+            super(arg, debug);\n+        }\n+\n+        /** {@inheritDoc} */\n+        @Override protected Map<String, ?> run(@Nullable VisorMetricTaskArg arg) throws IgniteException {\n+            String name = arg.name();\n+\n+            GridMetricManager mMgr = ignite.context().metric();\n+\n+            for (ReadOnlyMetricRegistry mReg : mMgr) {\n+                String mRegName = mReg.name();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b0d50dac9d90aa28d543bf50df29fc222dd9db37"}, "originalPosition": 75}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5OTAwNzExNw==", "bodyText": "Done.", "url": "https://github.com/apache/ignite/pull/8284#discussion_r499007117", "createdAt": "2020-10-02T19:19:18Z", "author": {"login": "ololo3000"}, "path": "modules/core/src/main/java/org/apache/ignite/internal/visor/metric/VisorMetricTask.java", "diffHunk": "@@ -0,0 +1,130 @@\n+/*\n+ * Licensed to the Apache Software Foundation (ASF) under one or more\n+ * contributor license agreements.  See the NOTICE file distributed with\n+ * this work for additional information regarding copyright ownership.\n+ * The ASF licenses this file to You under the Apache License, Version 2.0\n+ * (the \"License\"); you may not use this file except in compliance with\n+ * the License.  You may obtain a copy of the License at\n+ *\n+ *      http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package org.apache.ignite.internal.visor.metric;\n+\n+import java.util.Collections;\n+import java.util.HashMap;\n+import java.util.Map;\n+import org.apache.ignite.IgniteException;\n+import org.apache.ignite.internal.processors.metric.GridMetricManager;\n+import org.apache.ignite.internal.processors.task.GridInternal;\n+import org.apache.ignite.internal.processors.task.GridVisorManagementTask;\n+import org.apache.ignite.internal.visor.VisorJob;\n+import org.apache.ignite.internal.visor.VisorOneNodeTask;\n+import org.apache.ignite.spi.metric.BooleanMetric;\n+import org.apache.ignite.spi.metric.DoubleMetric;\n+import org.apache.ignite.spi.metric.IntMetric;\n+import org.apache.ignite.spi.metric.LongMetric;\n+import org.apache.ignite.spi.metric.Metric;\n+import org.apache.ignite.spi.metric.ObjectMetric;\n+import org.apache.ignite.spi.metric.ReadOnlyMetricRegistry;\n+import org.jetbrains.annotations.Nullable;\n+\n+import static org.apache.ignite.internal.processors.metric.impl.MetricUtils.SEPARATOR;\n+import static org.apache.ignite.spi.metric.jmx.MetricRegistryMBean.searchHistogram;\n+\n+/** Reperesents visor task for obtaining metric values. */\n+@GridInternal\n+@GridVisorManagementTask\n+public class VisorMetricTask extends VisorOneNodeTask<VisorMetricTaskArg, Map<String, ?>> {\n+    /** */\n+    private static final long serialVersionUID = 0L;\n+\n+    /** {@inheritDoc} */\n+    @Override protected VisorJob<VisorMetricTaskArg, Map<String, ?>> job(VisorMetricTaskArg arg) {\n+        return new VisorMetricJob(arg, false);\n+    }\n+\n+    /** */\n+    private static class VisorMetricJob extends VisorJob<VisorMetricTaskArg, Map<String, ?>> {\n+        /** */\n+        private static final long serialVersionUID = 0L;\n+\n+        /**\n+         * Create job with specified argument.\n+         *\n+         * @param arg   Job argument.\n+         * @param debug Flag indicating whether debug information should be printed into node log.\n+         */\n+        protected VisorMetricJob(@Nullable VisorMetricTaskArg arg, boolean debug) {\n+            super(arg, debug);\n+        }\n+\n+        /** {@inheritDoc} */\n+        @Override protected Map<String, ?> run(@Nullable VisorMetricTaskArg arg) throws IgniteException {\n+            String name = arg.name();\n+\n+            GridMetricManager mMgr = ignite.context().metric();\n+\n+            for (ReadOnlyMetricRegistry mReg : mMgr) {\n+                String mRegName = mReg.name();", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5ODY1Njc2OA=="}, "originalCommit": {"oid": "b0d50dac9d90aa28d543bf50df29fc222dd9db37"}, "originalPosition": 75}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzEyMTc3Njk5OnYy", "diffSide": "RIGHT", "path": "modules/core/src/main/java/org/apache/ignite/internal/visor/metric/VisorMetricTask.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wMlQwNzoyOTozM1rOHbjmXg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wMlQxOToxOToyNlrOHb4-yQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5ODY1Njg2Mg==", "bodyText": "mRegPrefix -> mregPrefix", "url": "https://github.com/apache/ignite/pull/8284#discussion_r498656862", "createdAt": "2020-10-02T07:29:33Z", "author": {"login": "nizhikov"}, "path": "modules/core/src/main/java/org/apache/ignite/internal/visor/metric/VisorMetricTask.java", "diffHunk": "@@ -0,0 +1,130 @@\n+/*\n+ * Licensed to the Apache Software Foundation (ASF) under one or more\n+ * contributor license agreements.  See the NOTICE file distributed with\n+ * this work for additional information regarding copyright ownership.\n+ * The ASF licenses this file to You under the Apache License, Version 2.0\n+ * (the \"License\"); you may not use this file except in compliance with\n+ * the License.  You may obtain a copy of the License at\n+ *\n+ *      http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package org.apache.ignite.internal.visor.metric;\n+\n+import java.util.Collections;\n+import java.util.HashMap;\n+import java.util.Map;\n+import org.apache.ignite.IgniteException;\n+import org.apache.ignite.internal.processors.metric.GridMetricManager;\n+import org.apache.ignite.internal.processors.task.GridInternal;\n+import org.apache.ignite.internal.processors.task.GridVisorManagementTask;\n+import org.apache.ignite.internal.visor.VisorJob;\n+import org.apache.ignite.internal.visor.VisorOneNodeTask;\n+import org.apache.ignite.spi.metric.BooleanMetric;\n+import org.apache.ignite.spi.metric.DoubleMetric;\n+import org.apache.ignite.spi.metric.IntMetric;\n+import org.apache.ignite.spi.metric.LongMetric;\n+import org.apache.ignite.spi.metric.Metric;\n+import org.apache.ignite.spi.metric.ObjectMetric;\n+import org.apache.ignite.spi.metric.ReadOnlyMetricRegistry;\n+import org.jetbrains.annotations.Nullable;\n+\n+import static org.apache.ignite.internal.processors.metric.impl.MetricUtils.SEPARATOR;\n+import static org.apache.ignite.spi.metric.jmx.MetricRegistryMBean.searchHistogram;\n+\n+/** Reperesents visor task for obtaining metric values. */\n+@GridInternal\n+@GridVisorManagementTask\n+public class VisorMetricTask extends VisorOneNodeTask<VisorMetricTaskArg, Map<String, ?>> {\n+    /** */\n+    private static final long serialVersionUID = 0L;\n+\n+    /** {@inheritDoc} */\n+    @Override protected VisorJob<VisorMetricTaskArg, Map<String, ?>> job(VisorMetricTaskArg arg) {\n+        return new VisorMetricJob(arg, false);\n+    }\n+\n+    /** */\n+    private static class VisorMetricJob extends VisorJob<VisorMetricTaskArg, Map<String, ?>> {\n+        /** */\n+        private static final long serialVersionUID = 0L;\n+\n+        /**\n+         * Create job with specified argument.\n+         *\n+         * @param arg   Job argument.\n+         * @param debug Flag indicating whether debug information should be printed into node log.\n+         */\n+        protected VisorMetricJob(@Nullable VisorMetricTaskArg arg, boolean debug) {\n+            super(arg, debug);\n+        }\n+\n+        /** {@inheritDoc} */\n+        @Override protected Map<String, ?> run(@Nullable VisorMetricTaskArg arg) throws IgniteException {\n+            String name = arg.name();\n+\n+            GridMetricManager mMgr = ignite.context().metric();\n+\n+            for (ReadOnlyMetricRegistry mReg : mMgr) {\n+                String mRegName = mReg.name();\n+\n+                if (mRegName.equals(name)) {\n+                    Map<String, Object> res = new HashMap<>();\n+\n+                    mReg.forEach(metric -> res.put(metric.name(), valueOf(metric)));\n+\n+                    return res;\n+                }\n+\n+                String mRegPrefix = mRegName + SEPARATOR;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b0d50dac9d90aa28d543bf50df29fc222dd9db37"}, "originalPosition": 85}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5OTAwNzE3Nw==", "bodyText": "Done.", "url": "https://github.com/apache/ignite/pull/8284#discussion_r499007177", "createdAt": "2020-10-02T19:19:26Z", "author": {"login": "ololo3000"}, "path": "modules/core/src/main/java/org/apache/ignite/internal/visor/metric/VisorMetricTask.java", "diffHunk": "@@ -0,0 +1,130 @@\n+/*\n+ * Licensed to the Apache Software Foundation (ASF) under one or more\n+ * contributor license agreements.  See the NOTICE file distributed with\n+ * this work for additional information regarding copyright ownership.\n+ * The ASF licenses this file to You under the Apache License, Version 2.0\n+ * (the \"License\"); you may not use this file except in compliance with\n+ * the License.  You may obtain a copy of the License at\n+ *\n+ *      http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package org.apache.ignite.internal.visor.metric;\n+\n+import java.util.Collections;\n+import java.util.HashMap;\n+import java.util.Map;\n+import org.apache.ignite.IgniteException;\n+import org.apache.ignite.internal.processors.metric.GridMetricManager;\n+import org.apache.ignite.internal.processors.task.GridInternal;\n+import org.apache.ignite.internal.processors.task.GridVisorManagementTask;\n+import org.apache.ignite.internal.visor.VisorJob;\n+import org.apache.ignite.internal.visor.VisorOneNodeTask;\n+import org.apache.ignite.spi.metric.BooleanMetric;\n+import org.apache.ignite.spi.metric.DoubleMetric;\n+import org.apache.ignite.spi.metric.IntMetric;\n+import org.apache.ignite.spi.metric.LongMetric;\n+import org.apache.ignite.spi.metric.Metric;\n+import org.apache.ignite.spi.metric.ObjectMetric;\n+import org.apache.ignite.spi.metric.ReadOnlyMetricRegistry;\n+import org.jetbrains.annotations.Nullable;\n+\n+import static org.apache.ignite.internal.processors.metric.impl.MetricUtils.SEPARATOR;\n+import static org.apache.ignite.spi.metric.jmx.MetricRegistryMBean.searchHistogram;\n+\n+/** Reperesents visor task for obtaining metric values. */\n+@GridInternal\n+@GridVisorManagementTask\n+public class VisorMetricTask extends VisorOneNodeTask<VisorMetricTaskArg, Map<String, ?>> {\n+    /** */\n+    private static final long serialVersionUID = 0L;\n+\n+    /** {@inheritDoc} */\n+    @Override protected VisorJob<VisorMetricTaskArg, Map<String, ?>> job(VisorMetricTaskArg arg) {\n+        return new VisorMetricJob(arg, false);\n+    }\n+\n+    /** */\n+    private static class VisorMetricJob extends VisorJob<VisorMetricTaskArg, Map<String, ?>> {\n+        /** */\n+        private static final long serialVersionUID = 0L;\n+\n+        /**\n+         * Create job with specified argument.\n+         *\n+         * @param arg   Job argument.\n+         * @param debug Flag indicating whether debug information should be printed into node log.\n+         */\n+        protected VisorMetricJob(@Nullable VisorMetricTaskArg arg, boolean debug) {\n+            super(arg, debug);\n+        }\n+\n+        /** {@inheritDoc} */\n+        @Override protected Map<String, ?> run(@Nullable VisorMetricTaskArg arg) throws IgniteException {\n+            String name = arg.name();\n+\n+            GridMetricManager mMgr = ignite.context().metric();\n+\n+            for (ReadOnlyMetricRegistry mReg : mMgr) {\n+                String mRegName = mReg.name();\n+\n+                if (mRegName.equals(name)) {\n+                    Map<String, Object> res = new HashMap<>();\n+\n+                    mReg.forEach(metric -> res.put(metric.name(), valueOf(metric)));\n+\n+                    return res;\n+                }\n+\n+                String mRegPrefix = mRegName + SEPARATOR;", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5ODY1Njg2Mg=="}, "originalCommit": {"oid": "b0d50dac9d90aa28d543bf50df29fc222dd9db37"}, "originalPosition": 85}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzEyMTg1MDU1OnYy", "diffSide": "RIGHT", "path": "modules/control-utility/src/main/java/org/apache/ignite/internal/commandline/TablePrinter.java", "isResolved": false, "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wMlQwNzo1NTozNlrOHbkTtQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wMlQxOToxOTozNVrOHb4_Bg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5ODY2ODQ2OQ==", "bodyText": "Do we really need a class instance for printing?\nIt's seems we can do it with the single method as it was in SystemViewCommand.", "url": "https://github.com/apache/ignite/pull/8284#discussion_r498668469", "createdAt": "2020-10-02T07:55:36Z", "author": {"login": "nizhikov"}, "path": "modules/control-utility/src/main/java/org/apache/ignite/internal/commandline/TablePrinter.java", "diffHunk": "@@ -0,0 +1,149 @@\n+/*\n+ * Licensed to the Apache Software Foundation (ASF) under one or more\n+ * contributor license agreements.  See the NOTICE file distributed with\n+ * this work for additional information regarding copyright ownership.\n+ * The ASF licenses this file to You under the Apache License, Version 2.0\n+ * (the \"License\"); you may not use this file except in compliance with\n+ * the License.  You may obtain a copy of the License at\n+ *\n+ *      http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package org.apache.ignite.internal.commandline;\n+\n+import java.util.ArrayList;\n+import java.util.Collection;\n+import java.util.Iterator;\n+import java.util.List;\n+import java.util.ListIterator;\n+import java.util.logging.Logger;\n+import java.util.stream.Collectors;\n+import org.apache.ignite.util.SimpleType;\n+\n+import static java.util.Collections.nCopies;\n+import static org.apache.ignite.util.SimpleType.DATE;\n+import static org.apache.ignite.util.SimpleType.NUMBER;\n+import static org.apache.ignite.util.SimpleType.STRING;\n+\n+/** Represents utility class for table content printing. */\n+public class TablePrinter {\n+    /** Column separator. */\n+    public static final String COLUMN_SEPARATOR = \"    \";\n+\n+    /** Titles of the table columns. */\n+    private final List<String> titles;\n+\n+    /** Types of the table columns. */\n+    private final List<SimpleType> types;\n+\n+    /** Number of table columns. */\n+    private final int colsCnt;\n+\n+    /**\n+     * @param titles Titles of the table columns. Number of titles determines the number of columns in table.\n+     * @param types  Types of the table columns.\n+     */\n+    public TablePrinter(List<String> titles, List<SimpleType> types) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b0d50dac9d90aa28d543bf50df29fc222dd9db37"}, "originalPosition": 52}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5ODY2ODc3Ng==", "bodyText": "Le'ts just make static method in SystemViewCommand and use it in the MetricCommand.", "url": "https://github.com/apache/ignite/pull/8284#discussion_r498668776", "createdAt": "2020-10-02T07:56:13Z", "author": {"login": "nizhikov"}, "path": "modules/control-utility/src/main/java/org/apache/ignite/internal/commandline/TablePrinter.java", "diffHunk": "@@ -0,0 +1,149 @@\n+/*\n+ * Licensed to the Apache Software Foundation (ASF) under one or more\n+ * contributor license agreements.  See the NOTICE file distributed with\n+ * this work for additional information regarding copyright ownership.\n+ * The ASF licenses this file to You under the Apache License, Version 2.0\n+ * (the \"License\"); you may not use this file except in compliance with\n+ * the License.  You may obtain a copy of the License at\n+ *\n+ *      http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package org.apache.ignite.internal.commandline;\n+\n+import java.util.ArrayList;\n+import java.util.Collection;\n+import java.util.Iterator;\n+import java.util.List;\n+import java.util.ListIterator;\n+import java.util.logging.Logger;\n+import java.util.stream.Collectors;\n+import org.apache.ignite.util.SimpleType;\n+\n+import static java.util.Collections.nCopies;\n+import static org.apache.ignite.util.SimpleType.DATE;\n+import static org.apache.ignite.util.SimpleType.NUMBER;\n+import static org.apache.ignite.util.SimpleType.STRING;\n+\n+/** Represents utility class for table content printing. */\n+public class TablePrinter {\n+    /** Column separator. */\n+    public static final String COLUMN_SEPARATOR = \"    \";\n+\n+    /** Titles of the table columns. */\n+    private final List<String> titles;\n+\n+    /** Types of the table columns. */\n+    private final List<SimpleType> types;\n+\n+    /** Number of table columns. */\n+    private final int colsCnt;\n+\n+    /**\n+     * @param titles Titles of the table columns. Number of titles determines the number of columns in table.\n+     * @param types  Types of the table columns.\n+     */\n+    public TablePrinter(List<String> titles, List<SimpleType> types) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5ODY2ODQ2OQ=="}, "originalCommit": {"oid": "b0d50dac9d90aa28d543bf50df29fc222dd9db37"}, "originalPosition": 52}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5OTAwNzIzOA==", "bodyText": "Done.", "url": "https://github.com/apache/ignite/pull/8284#discussion_r499007238", "createdAt": "2020-10-02T19:19:35Z", "author": {"login": "ololo3000"}, "path": "modules/control-utility/src/main/java/org/apache/ignite/internal/commandline/TablePrinter.java", "diffHunk": "@@ -0,0 +1,149 @@\n+/*\n+ * Licensed to the Apache Software Foundation (ASF) under one or more\n+ * contributor license agreements.  See the NOTICE file distributed with\n+ * this work for additional information regarding copyright ownership.\n+ * The ASF licenses this file to You under the Apache License, Version 2.0\n+ * (the \"License\"); you may not use this file except in compliance with\n+ * the License.  You may obtain a copy of the License at\n+ *\n+ *      http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package org.apache.ignite.internal.commandline;\n+\n+import java.util.ArrayList;\n+import java.util.Collection;\n+import java.util.Iterator;\n+import java.util.List;\n+import java.util.ListIterator;\n+import java.util.logging.Logger;\n+import java.util.stream.Collectors;\n+import org.apache.ignite.util.SimpleType;\n+\n+import static java.util.Collections.nCopies;\n+import static org.apache.ignite.util.SimpleType.DATE;\n+import static org.apache.ignite.util.SimpleType.NUMBER;\n+import static org.apache.ignite.util.SimpleType.STRING;\n+\n+/** Represents utility class for table content printing. */\n+public class TablePrinter {\n+    /** Column separator. */\n+    public static final String COLUMN_SEPARATOR = \"    \";\n+\n+    /** Titles of the table columns. */\n+    private final List<String> titles;\n+\n+    /** Types of the table columns. */\n+    private final List<SimpleType> types;\n+\n+    /** Number of table columns. */\n+    private final int colsCnt;\n+\n+    /**\n+     * @param titles Titles of the table columns. Number of titles determines the number of columns in table.\n+     * @param types  Types of the table columns.\n+     */\n+    public TablePrinter(List<String> titles, List<SimpleType> types) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5ODY2ODQ2OQ=="}, "originalCommit": {"oid": "b0d50dac9d90aa28d543bf50df29fc222dd9db37"}, "originalPosition": 52}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzEyMTg2OTExOnYy", "diffSide": "RIGHT", "path": "modules/control-utility/src/test/java/org/apache/ignite/util/MetricCommandTest.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wMlQwODowMTozOFrOHbkfJg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wMlQxOToxOTo0MlrOHb4_OQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5ODY3MTM5OA==", "bodyText": "Le'ts keep one test for each type of metric and remove all other tests.", "url": "https://github.com/apache/ignite/pull/8284#discussion_r498671398", "createdAt": "2020-10-02T08:01:38Z", "author": {"login": "nizhikov"}, "path": "modules/control-utility/src/test/java/org/apache/ignite/util/MetricCommandTest.java", "diffHunk": "@@ -0,0 +1,644 @@\n+/*\n+ * Licensed to the Apache Software Foundation (ASF) under one or more\n+ * contributor license agreements.  See the NOTICE file distributed with\n+ * this work for additional information regarding copyright ownership.\n+ * The ASF licenses this file to You under the Apache License, Version 2.0\n+ * (the \"License\"); you may not use this file except in compliance with\n+ * the License.  You may obtain a copy of the License at\n+ *\n+ *      http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package org.apache.ignite.util;\n+\n+import java.util.Arrays;\n+import java.util.HashMap;\n+import java.util.Iterator;\n+import java.util.Map;\n+import java.util.UUID;\n+import java.util.concurrent.ThreadPoolExecutor.AbortPolicy;\n+import org.apache.ignite.IgniteCheckedException;\n+import org.apache.ignite.configuration.DataRegionConfiguration;\n+import org.apache.ignite.internal.IgniteEx;\n+import org.apache.ignite.internal.commandline.CommandList;\n+import org.apache.ignite.internal.commandline.metric.MetricCommandArg;\n+import org.apache.ignite.internal.processors.metric.MetricRegistry;\n+import org.apache.ignite.internal.processors.metric.impl.HistogramMetricImpl;\n+import org.apache.ignite.internal.util.typedef.internal.U;\n+import org.apache.ignite.thread.IgniteThreadFactory;\n+import org.junit.Test;\n+\n+import static java.lang.Long.parseLong;\n+import static java.lang.System.currentTimeMillis;\n+import static java.util.regex.Pattern.quote;\n+import static org.apache.ignite.cluster.ClusterState.ACTIVE;\n+import static org.apache.ignite.configuration.IgniteConfiguration.DFLT_THREAD_KEEP_ALIVE_TIME;\n+import static org.apache.ignite.internal.commandline.CommandHandler.EXIT_CODE_INVALID_ARGUMENTS;\n+import static org.apache.ignite.internal.commandline.CommandHandler.EXIT_CODE_OK;\n+import static org.apache.ignite.internal.commandline.CommandList.METRIC;\n+import static org.apache.ignite.internal.commandline.TablePrinter.COLUMN_SEPARATOR;\n+import static org.apache.ignite.internal.commandline.metric.MetricCommandArg.NODE_ID;\n+import static org.apache.ignite.internal.managers.communication.GridIoManager.COMM_METRICS;\n+import static org.apache.ignite.internal.processors.cache.persistence.DataStorageMetricsImpl.DATASTORAGE_METRIC_PREFIX;\n+import static org.apache.ignite.internal.processors.cache.persistence.snapshot.IgniteSnapshotManager.SNAPSHOT_METRICS;\n+import static org.apache.ignite.internal.processors.job.GridJobProcessor.JOBS_METRICS;\n+import static org.apache.ignite.internal.processors.metric.GridMetricManager.CLUSTER_METRICS;\n+import static org.apache.ignite.internal.processors.metric.GridMetricManager.IGNITE_METRICS;\n+import static org.apache.ignite.internal.processors.metric.GridMetricManager.PME_METRICS;\n+import static org.apache.ignite.internal.processors.metric.GridMetricManager.SYS_METRICS;\n+import static org.apache.ignite.internal.processors.metric.GridMetricManager.THREAD_POOLS;\n+import static org.apache.ignite.internal.processors.metric.GridMetricManager.TX_METRICS;\n+import static org.apache.ignite.internal.processors.metric.impl.MetricUtils.SEPARATOR;\n+import static org.apache.ignite.internal.processors.metric.impl.MetricUtils.cacheMetricsRegistryName;\n+import static org.apache.ignite.internal.processors.metric.impl.MetricUtils.metricName;\n+import static org.apache.ignite.testframework.GridTestUtils.assertContains;\n+import static org.apache.ignite.testframework.GridTestUtils.assertThrowsWithCause;\n+\n+/** Tests output of {@link CommandList#METRIC} command. */\n+public class MetricCommandTest extends GridCommandHandlerClusterByClassAbstractTest {\n+    /** Command line argument for printing metric values. */\n+    private static final String CMD_METRIC = METRIC.text();\n+\n+    /** Test node with 0 index. */\n+    private IgniteEx ignite0;\n+\n+    /** Test node with 1 index. */\n+    private IgniteEx ignite1;\n+\n+    /** {@inheritDoc} */\n+    @Override protected void beforeTestsStarted() throws Exception {\n+        super.beforeTestsStarted();\n+\n+        awaitPartitionMapExchange();\n+    }\n+\n+    /** {@inheritDoc} */\n+    @Override protected void beforeTest() throws Exception {\n+        super.beforeTest();\n+\n+        injectTestSystemOut();\n+\n+        autoConfirmation = false;\n+\n+        ignite0 = ignite(0);\n+        ignite1 = ignite(1);\n+    }\n+\n+    /** Tests command error output in case of mandatory metric name is omitted. */\n+    @Test\n+    public void testMetricNameMissedFailure() {\n+        assertContains(log, executeCommand(EXIT_CODE_INVALID_ARGUMENTS, CMD_METRIC),\n+            \"The name of a metric(metric registry) is expected.\");\n+    }\n+\n+    /** Tests command error output in case value of {@link MetricCommandArg#NODE_ID} argument is omitted. */\n+    @Test\n+    public void testNodeIdMissedFailure() {\n+        assertContains(log, executeCommand(EXIT_CODE_INVALID_ARGUMENTS, CMD_METRIC, SYS_METRICS, NODE_ID.argName()),\n+            \"ID of the node from which metric values should be obtained is expected.\");\n+    }\n+\n+    /** Tests command error output in case value of {@link MetricCommandArg#NODE_ID} argument is invalid.*/\n+    @Test\n+    public void testInvalidNodeIdFailure() {\n+        assertContains(log,\n+            executeCommand(EXIT_CODE_INVALID_ARGUMENTS, CMD_METRIC, SYS_METRICS, NODE_ID.argName(), \"invalid_node_id\"),\n+            \"Failed to parse \" + NODE_ID.argName() +\n+                \" command argument. String representation of \\\"java.util.UUID\\\" is exepected.\" +\n+                \" For example: 123e4567-e89b-42d3-a456-556642440000\"\n+        );\n+    }\n+\n+    /** Tests command error output in case multiple metric names are specified. */\n+    @Test\n+    public void testMultipleMetricNamesFailure() {\n+        assertContains(log,\n+            executeCommand(EXIT_CODE_INVALID_ARGUMENTS, CMD_METRIC, IGNITE_METRICS, SYS_METRICS),\n+            \"Multiple metric(metric registry) names are not supported.\");\n+    }\n+\n+    /** Tests command error output in case {@link MetricCommandArg#NODE_ID} argument value refers to nonexistent node. */\n+    @Test\n+    public void testNonExistentNodeIdFailure() {\n+        String incorrectNodeId = UUID.randomUUID().toString();\n+\n+        assertContains(log,\n+            executeCommand(EXIT_CODE_INVALID_ARGUMENTS, CMD_METRIC, \"--node-id\", incorrectNodeId, IGNITE_METRICS),\n+            \"Failed to perform operation.\\nNode with id=\" + incorrectNodeId + \" not found\");\n+    }\n+\n+    /** Tests command output in case nonexistent metric name is specified. */\n+    @Test\n+    public void testNonExistentMetric() {\n+        assertContains(log, executeCommand(EXIT_CODE_OK, CMD_METRIC, IGNITE_METRICS + SEPARATOR),\n+            \"No metric with specified name was found [name=\" + IGNITE_METRICS + SEPARATOR + ']');\n+\n+        assertContains(log, executeCommand(EXIT_CODE_OK, CMD_METRIC, \"nonexistent.metric\"),\n+            \"No metric with specified name was found [name=nonexistent.metric]\");\n+    }\n+\n+    /** */\n+    @Test\n+    public void testCommunicationMetrics() {\n+        Map<String, String> metrics = metrics(ignite0, COMM_METRICS);\n+\n+        assertTrue(Integer.parseInt(metrics.get(metricName(COMM_METRICS, \"SentBytesCount\"))) > 0);\n+        assertTrue(Integer.parseInt(metrics.get(metricName(COMM_METRICS, \"ReceivedBytesCount\"))) > 0);\n+        assertEquals(\"0\", metrics.get(metricName(COMM_METRICS, \"OutboundMessagesQueueSize\")));\n+        assertTrue(Integer.parseInt(metrics.get(metricName(COMM_METRICS, \"ReceivedMessagesCount\"))) > 0);\n+        assertTrue(Integer.parseInt(metrics.get(metricName(COMM_METRICS, \"SentMessagesCount\"))) > 0);\n+    }\n+\n+    /** */\n+    @Test\n+    public void testJobsMetrics() {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b0d50dac9d90aa28d543bf50df29fc222dd9db37"}, "originalPosition": 160}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5OTAwNzI4OQ==", "bodyText": "Done.", "url": "https://github.com/apache/ignite/pull/8284#discussion_r499007289", "createdAt": "2020-10-02T19:19:42Z", "author": {"login": "ololo3000"}, "path": "modules/control-utility/src/test/java/org/apache/ignite/util/MetricCommandTest.java", "diffHunk": "@@ -0,0 +1,644 @@\n+/*\n+ * Licensed to the Apache Software Foundation (ASF) under one or more\n+ * contributor license agreements.  See the NOTICE file distributed with\n+ * this work for additional information regarding copyright ownership.\n+ * The ASF licenses this file to You under the Apache License, Version 2.0\n+ * (the \"License\"); you may not use this file except in compliance with\n+ * the License.  You may obtain a copy of the License at\n+ *\n+ *      http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package org.apache.ignite.util;\n+\n+import java.util.Arrays;\n+import java.util.HashMap;\n+import java.util.Iterator;\n+import java.util.Map;\n+import java.util.UUID;\n+import java.util.concurrent.ThreadPoolExecutor.AbortPolicy;\n+import org.apache.ignite.IgniteCheckedException;\n+import org.apache.ignite.configuration.DataRegionConfiguration;\n+import org.apache.ignite.internal.IgniteEx;\n+import org.apache.ignite.internal.commandline.CommandList;\n+import org.apache.ignite.internal.commandline.metric.MetricCommandArg;\n+import org.apache.ignite.internal.processors.metric.MetricRegistry;\n+import org.apache.ignite.internal.processors.metric.impl.HistogramMetricImpl;\n+import org.apache.ignite.internal.util.typedef.internal.U;\n+import org.apache.ignite.thread.IgniteThreadFactory;\n+import org.junit.Test;\n+\n+import static java.lang.Long.parseLong;\n+import static java.lang.System.currentTimeMillis;\n+import static java.util.regex.Pattern.quote;\n+import static org.apache.ignite.cluster.ClusterState.ACTIVE;\n+import static org.apache.ignite.configuration.IgniteConfiguration.DFLT_THREAD_KEEP_ALIVE_TIME;\n+import static org.apache.ignite.internal.commandline.CommandHandler.EXIT_CODE_INVALID_ARGUMENTS;\n+import static org.apache.ignite.internal.commandline.CommandHandler.EXIT_CODE_OK;\n+import static org.apache.ignite.internal.commandline.CommandList.METRIC;\n+import static org.apache.ignite.internal.commandline.TablePrinter.COLUMN_SEPARATOR;\n+import static org.apache.ignite.internal.commandline.metric.MetricCommandArg.NODE_ID;\n+import static org.apache.ignite.internal.managers.communication.GridIoManager.COMM_METRICS;\n+import static org.apache.ignite.internal.processors.cache.persistence.DataStorageMetricsImpl.DATASTORAGE_METRIC_PREFIX;\n+import static org.apache.ignite.internal.processors.cache.persistence.snapshot.IgniteSnapshotManager.SNAPSHOT_METRICS;\n+import static org.apache.ignite.internal.processors.job.GridJobProcessor.JOBS_METRICS;\n+import static org.apache.ignite.internal.processors.metric.GridMetricManager.CLUSTER_METRICS;\n+import static org.apache.ignite.internal.processors.metric.GridMetricManager.IGNITE_METRICS;\n+import static org.apache.ignite.internal.processors.metric.GridMetricManager.PME_METRICS;\n+import static org.apache.ignite.internal.processors.metric.GridMetricManager.SYS_METRICS;\n+import static org.apache.ignite.internal.processors.metric.GridMetricManager.THREAD_POOLS;\n+import static org.apache.ignite.internal.processors.metric.GridMetricManager.TX_METRICS;\n+import static org.apache.ignite.internal.processors.metric.impl.MetricUtils.SEPARATOR;\n+import static org.apache.ignite.internal.processors.metric.impl.MetricUtils.cacheMetricsRegistryName;\n+import static org.apache.ignite.internal.processors.metric.impl.MetricUtils.metricName;\n+import static org.apache.ignite.testframework.GridTestUtils.assertContains;\n+import static org.apache.ignite.testframework.GridTestUtils.assertThrowsWithCause;\n+\n+/** Tests output of {@link CommandList#METRIC} command. */\n+public class MetricCommandTest extends GridCommandHandlerClusterByClassAbstractTest {\n+    /** Command line argument for printing metric values. */\n+    private static final String CMD_METRIC = METRIC.text();\n+\n+    /** Test node with 0 index. */\n+    private IgniteEx ignite0;\n+\n+    /** Test node with 1 index. */\n+    private IgniteEx ignite1;\n+\n+    /** {@inheritDoc} */\n+    @Override protected void beforeTestsStarted() throws Exception {\n+        super.beforeTestsStarted();\n+\n+        awaitPartitionMapExchange();\n+    }\n+\n+    /** {@inheritDoc} */\n+    @Override protected void beforeTest() throws Exception {\n+        super.beforeTest();\n+\n+        injectTestSystemOut();\n+\n+        autoConfirmation = false;\n+\n+        ignite0 = ignite(0);\n+        ignite1 = ignite(1);\n+    }\n+\n+    /** Tests command error output in case of mandatory metric name is omitted. */\n+    @Test\n+    public void testMetricNameMissedFailure() {\n+        assertContains(log, executeCommand(EXIT_CODE_INVALID_ARGUMENTS, CMD_METRIC),\n+            \"The name of a metric(metric registry) is expected.\");\n+    }\n+\n+    /** Tests command error output in case value of {@link MetricCommandArg#NODE_ID} argument is omitted. */\n+    @Test\n+    public void testNodeIdMissedFailure() {\n+        assertContains(log, executeCommand(EXIT_CODE_INVALID_ARGUMENTS, CMD_METRIC, SYS_METRICS, NODE_ID.argName()),\n+            \"ID of the node from which metric values should be obtained is expected.\");\n+    }\n+\n+    /** Tests command error output in case value of {@link MetricCommandArg#NODE_ID} argument is invalid.*/\n+    @Test\n+    public void testInvalidNodeIdFailure() {\n+        assertContains(log,\n+            executeCommand(EXIT_CODE_INVALID_ARGUMENTS, CMD_METRIC, SYS_METRICS, NODE_ID.argName(), \"invalid_node_id\"),\n+            \"Failed to parse \" + NODE_ID.argName() +\n+                \" command argument. String representation of \\\"java.util.UUID\\\" is exepected.\" +\n+                \" For example: 123e4567-e89b-42d3-a456-556642440000\"\n+        );\n+    }\n+\n+    /** Tests command error output in case multiple metric names are specified. */\n+    @Test\n+    public void testMultipleMetricNamesFailure() {\n+        assertContains(log,\n+            executeCommand(EXIT_CODE_INVALID_ARGUMENTS, CMD_METRIC, IGNITE_METRICS, SYS_METRICS),\n+            \"Multiple metric(metric registry) names are not supported.\");\n+    }\n+\n+    /** Tests command error output in case {@link MetricCommandArg#NODE_ID} argument value refers to nonexistent node. */\n+    @Test\n+    public void testNonExistentNodeIdFailure() {\n+        String incorrectNodeId = UUID.randomUUID().toString();\n+\n+        assertContains(log,\n+            executeCommand(EXIT_CODE_INVALID_ARGUMENTS, CMD_METRIC, \"--node-id\", incorrectNodeId, IGNITE_METRICS),\n+            \"Failed to perform operation.\\nNode with id=\" + incorrectNodeId + \" not found\");\n+    }\n+\n+    /** Tests command output in case nonexistent metric name is specified. */\n+    @Test\n+    public void testNonExistentMetric() {\n+        assertContains(log, executeCommand(EXIT_CODE_OK, CMD_METRIC, IGNITE_METRICS + SEPARATOR),\n+            \"No metric with specified name was found [name=\" + IGNITE_METRICS + SEPARATOR + ']');\n+\n+        assertContains(log, executeCommand(EXIT_CODE_OK, CMD_METRIC, \"nonexistent.metric\"),\n+            \"No metric with specified name was found [name=nonexistent.metric]\");\n+    }\n+\n+    /** */\n+    @Test\n+    public void testCommunicationMetrics() {\n+        Map<String, String> metrics = metrics(ignite0, COMM_METRICS);\n+\n+        assertTrue(Integer.parseInt(metrics.get(metricName(COMM_METRICS, \"SentBytesCount\"))) > 0);\n+        assertTrue(Integer.parseInt(metrics.get(metricName(COMM_METRICS, \"ReceivedBytesCount\"))) > 0);\n+        assertEquals(\"0\", metrics.get(metricName(COMM_METRICS, \"OutboundMessagesQueueSize\")));\n+        assertTrue(Integer.parseInt(metrics.get(metricName(COMM_METRICS, \"ReceivedMessagesCount\"))) > 0);\n+        assertTrue(Integer.parseInt(metrics.get(metricName(COMM_METRICS, \"SentMessagesCount\"))) > 0);\n+    }\n+\n+    /** */\n+    @Test\n+    public void testJobsMetrics() {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5ODY3MTM5OA=="}, "originalCommit": {"oid": "b0d50dac9d90aa28d543bf50df29fc222dd9db37"}, "originalPosition": 160}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2695, "cost": 1, "resetAt": "2021-11-12T09:44:50Z"}}}