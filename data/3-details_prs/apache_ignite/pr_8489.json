{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTI2MzE4NjY2", "number": 8489, "title": "IGNITE-13714 [ML]: Add catboost inference integration", "bodyText": "Add catboost (Apache-2.0 License) inference integration\n\nIssue: https://issues.apache.org/jira/browse/IGNITE-13714", "createdAt": "2020-11-24T08:56:49Z", "url": "https://github.com/apache/ignite/pull/8489", "merged": true, "mergeCommit": {"oid": "04f6a33851d9f7bd269a09fdc2c74485b1e01a8a"}, "closed": true, "closedAt": "2020-12-09T18:23:04Z", "author": {"login": "mrk-andreev"}, "timelineItems": {"totalCount": 7, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdfuOkZABqjQwMzQzMDI2NDY=", "endCursor": "Y3Vyc29yOnYyOpPPAAABelIR38gFqTY5Mzc3NjY2MQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "7ff8f6fd37ce60619ce0736b1de801d7f179d5b2", "author": {"user": {"login": "mrk-andreev", "name": "Mark Andreev"}}, "url": "https://github.com/apache/ignite/commit/7ff8f6fd37ce60619ce0736b1de801d7f179d5b2", "committedDate": "2020-11-24T08:54:57Z", "message": "IGNITE-13714 Add catboost inference integration"}, "afterCommit": {"oid": "064eff4fbb64cb5acde0cf1a85777dc93983490d", "author": {"user": {"login": "mrk-andreev", "name": "Mark Andreev"}}, "url": "https://github.com/apache/ignite/commit/064eff4fbb64cb5acde0cf1a85777dc93983490d", "committedDate": "2020-11-24T18:40:11Z", "message": "IGNITE-13714 Add catboost inference integration"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTQxNjgzNjIx", "url": "https://github.com/apache/ignite/pull/8489#pullrequestreview-541683621", "createdAt": "2020-12-01T09:10:48Z", "commit": {"oid": "064eff4fbb64cb5acde0cf1a85777dc93983490d"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 5, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0wMVQwOToxMDo0OFrOH8fbvg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0wMVQwOToxNDoxMFrOH8frwg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMzE5MTYxNA==", "bodyText": "Remove blank line", "url": "https://github.com/apache/ignite/pull/8489#discussion_r533191614", "createdAt": "2020-12-01T09:10:48Z", "author": {"login": "zaleslaw"}, "path": "modules/ml/catboost-model-parser/src/main/java/org/apache/ignite/ml/catboost/CatboostRegressionModel.java", "diffHunk": "@@ -0,0 +1,71 @@\n+/*\n+ * Licensed to the Apache Software Foundation (ASF) under one or more\n+ * contributor license agreements.  See the NOTICE file distributed with\n+ * this work for additional information regarding copyright ownership.\n+ * The ASF licenses this file to You under the Apache License, Version 2.0\n+ * (the \"License\"); you may not use this file except in compliance with\n+ * the License.  You may obtain a copy of the License at\n+ *\n+ *      http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package org.apache.ignite.ml.catboost;\n+\n+import ai.catboost.CatBoostError;\n+import ai.catboost.CatBoostModel;\n+import org.apache.ignite.ml.inference.Model;\n+import org.apache.ignite.ml.math.primitives.vector.NamedVector;\n+import org.slf4j.Logger;\n+import org.slf4j.LoggerFactory;\n+\n+/**\n+ * CatboostRegressionModel imported and wrapped to be compatible with Apache Ignite infrastructure.\n+ */\n+public class CatboostRegressionModel implements Model<NamedVector, Double> {\n+  /** Logger. */\n+  private static final Logger logger = LoggerFactory.getLogger(CatboostRegressionModel.class);\n+\n+  /** Catboost model. */\n+  private final CatBoostModel model;\n+\n+  /**\n+   * Constructs a new instance of Catboost model wrapper.\n+   *\n+   * @param model Catboost Model\n+   */\n+  public CatboostRegressionModel(CatBoostModel model) {\n+    this.model = model;\n+  }\n+\n+  /** {@inheritDoc} */\n+  @Override public Double predict(NamedVector input) {\n+    float[] floatInput = new float[input.size()];\n+    int index = 0;\n+    for (String key: model.getFeatureNames()) {\n+      floatInput[index] = (float) input.get(key);\n+      index++;\n+    }\n+\n+    try {\n+      return model.predict(floatInput, model.getFeatureNames()).get(0, 0);\n+    } catch (CatBoostError e) {\n+      throw new RuntimeException(e.getMessage());\n+    }\n+  }\n+\n+  /** {@inheritDoc} */\n+  @Override public void close() {\n+    try {\n+      model.close();\n+    } catch (CatBoostError e) {\n+      logger.error(e.getMessage());\n+    }\n+  }\n+", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "064eff4fbb64cb5acde0cf1a85777dc93983490d"}, "originalPosition": 70}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMzE5MjIzOQ==", "bodyText": "Add more comments about CatBoost model, maybe copy some javadaoc from CatBoost", "url": "https://github.com/apache/ignite/pull/8489#discussion_r533192239", "createdAt": "2020-12-01T09:11:18Z", "author": {"login": "zaleslaw"}, "path": "modules/ml/catboost-model-parser/src/main/java/org/apache/ignite/ml/catboost/CatboostClassificationModel.java", "diffHunk": "@@ -0,0 +1,77 @@\n+/*\n+ * Licensed to the Apache Software Foundation (ASF) under one or more\n+ * contributor license agreements.  See the NOTICE file distributed with\n+ * this work for additional information regarding copyright ownership.\n+ * The ASF licenses this file to You under the Apache License, Version 2.0\n+ * (the \"License\"); you may not use this file except in compliance with\n+ * the License.  You may obtain a copy of the License at\n+ *\n+ *      http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package org.apache.ignite.ml.catboost;\n+\n+import ai.catboost.CatBoostError;\n+import ai.catboost.CatBoostModel;\n+import org.apache.ignite.ml.inference.Model;\n+import org.apache.ignite.ml.math.primitives.vector.NamedVector;\n+import org.slf4j.Logger;\n+import org.slf4j.LoggerFactory;\n+\n+/**\n+ * CatboostClassificationModel imported and wrapped to be compatible with Apache Ignite infrastructure.", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "064eff4fbb64cb5acde0cf1a85777dc93983490d"}, "originalPosition": 28}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMzE5NDE3NQ==", "bodyText": "Looks like the use different code formatting\nCould you please check https://cwiki.apache.org/confluence/display/IGNITE/Coding+Guidelines especially\nWhitespaces and empty lines chapter\nSource code line should not be longer then 120 characters (to be visible on most conventional monitors). 4 space characters should be used for tabulation and indentation", "url": "https://github.com/apache/ignite/pull/8489#discussion_r533194175", "createdAt": "2020-12-01T09:12:55Z", "author": {"login": "zaleslaw"}, "path": "modules/ml/catboost-model-parser/src/main/java/org/apache/ignite/ml/catboost/CatboostClassificationModel.java", "diffHunk": "@@ -0,0 +1,77 @@\n+/*\n+ * Licensed to the Apache Software Foundation (ASF) under one or more\n+ * contributor license agreements.  See the NOTICE file distributed with\n+ * this work for additional information regarding copyright ownership.\n+ * The ASF licenses this file to You under the Apache License, Version 2.0\n+ * (the \"License\"); you may not use this file except in compliance with\n+ * the License.  You may obtain a copy of the License at\n+ *\n+ *      http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package org.apache.ignite.ml.catboost;\n+\n+import ai.catboost.CatBoostError;\n+import ai.catboost.CatBoostModel;\n+import org.apache.ignite.ml.inference.Model;\n+import org.apache.ignite.ml.math.primitives.vector.NamedVector;\n+import org.slf4j.Logger;\n+import org.slf4j.LoggerFactory;\n+\n+/**\n+ * CatboostClassificationModel imported and wrapped to be compatible with Apache Ignite infrastructure.\n+ */\n+public class CatboostClassificationModel implements Model<NamedVector, Double> {\n+  /** Logger. */\n+  private static final Logger logger = LoggerFactory.getLogger(CatboostClassificationModel.class);\n+\n+  /** Catboost model. */\n+  private final CatBoostModel model;\n+\n+  /**\n+   * Constructs a new instance of Catboost model wrapper.\n+   *\n+   * @param model Catboost Model\n+   */\n+  public CatboostClassificationModel(CatBoostModel model) {\n+    this.model = model;\n+  }\n+\n+  /** {@inheritDoc} */\n+  @Override public Double predict(NamedVector input) {\n+    float[] floatInput = new float[input.size()];\n+    int index = 0;\n+    for (String key: model.getFeatureNames()) {\n+      floatInput[index] = (float) input.get(key);\n+      index++;\n+    }\n+\n+    try {\n+      double predict = model.predict(", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "064eff4fbb64cb5acde0cf1a85777dc93983490d"}, "originalPosition": 56}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMzE5NDg0Mg==", "bodyText": "Could you please explain, why did you use NamedVector with CatBoost models", "url": "https://github.com/apache/ignite/pull/8489#discussion_r533194842", "createdAt": "2020-12-01T09:13:29Z", "author": {"login": "zaleslaw"}, "path": "modules/ml/catboost-model-parser/src/main/java/org/apache/ignite/ml/catboost/CatboostClassificationModelParser.java", "diffHunk": "@@ -0,0 +1,44 @@\n+/*\n+ * Licensed to the Apache Software Foundation (ASF) under one or more\n+ * contributor license agreements.  See the NOTICE file distributed with\n+ * this work for additional information regarding copyright ownership.\n+ * The ASF licenses this file to You under the Apache License, Version 2.0\n+ * (the \"License\"); you may not use this file except in compliance with\n+ * the License.  You may obtain a copy of the License at\n+ *\n+ *      http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package org.apache.ignite.ml.catboost;\n+\n+import java.io.ByteArrayInputStream;\n+import java.io.IOException;\n+import java.io.InputStream;\n+import ai.catboost.CatBoostError;\n+import ai.catboost.CatBoostModel;\n+import org.apache.ignite.ml.inference.parser.ModelParser;\n+import org.apache.ignite.ml.math.primitives.vector.NamedVector;\n+\n+/**\n+ * Catboost Classification model parser.\n+ */\n+public class CatboostClassificationModelParser implements\n+    ModelParser<NamedVector, Double, CatboostClassificationModel> {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "064eff4fbb64cb5acde0cf1a85777dc93983490d"}, "originalPosition": 32}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMzE5NTcxNA==", "bodyText": "Rewrite the RuntimeException message to more clear (maybe with tips, what's going on)", "url": "https://github.com/apache/ignite/pull/8489#discussion_r533195714", "createdAt": "2020-12-01T09:14:10Z", "author": {"login": "zaleslaw"}, "path": "modules/ml/catboost-model-parser/src/main/java/org/apache/ignite/ml/catboost/CatboostClassificationModelParser.java", "diffHunk": "@@ -0,0 +1,44 @@\n+/*\n+ * Licensed to the Apache Software Foundation (ASF) under one or more\n+ * contributor license agreements.  See the NOTICE file distributed with\n+ * this work for additional information regarding copyright ownership.\n+ * The ASF licenses this file to You under the Apache License, Version 2.0\n+ * (the \"License\"); you may not use this file except in compliance with\n+ * the License.  You may obtain a copy of the License at\n+ *\n+ *      http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package org.apache.ignite.ml.catboost;\n+\n+import java.io.ByteArrayInputStream;\n+import java.io.IOException;\n+import java.io.InputStream;\n+import ai.catboost.CatBoostError;\n+import ai.catboost.CatBoostModel;\n+import org.apache.ignite.ml.inference.parser.ModelParser;\n+import org.apache.ignite.ml.math.primitives.vector.NamedVector;\n+\n+/**\n+ * Catboost Classification model parser.\n+ */\n+public class CatboostClassificationModelParser implements\n+    ModelParser<NamedVector, Double, CatboostClassificationModel> {\n+  /** */\n+  private static final long serialVersionUID = -8425510352746936163L;\n+\n+  /** {@inheritDoc} */\n+  @Override public CatboostClassificationModel parse(byte[] mdl) {\n+    try (InputStream inputStream = new ByteArrayInputStream(mdl)) {\n+      return new CatboostClassificationModel(CatBoostModel.loadModel(inputStream));\n+    } catch (IOException | CatBoostError e) {\n+      throw new RuntimeException(\"Failed to parse model\", e);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "064eff4fbb64cb5acde0cf1a85777dc93983490d"}, "originalPosition": 41}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "064eff4fbb64cb5acde0cf1a85777dc93983490d", "author": {"user": {"login": "mrk-andreev", "name": "Mark Andreev"}}, "url": "https://github.com/apache/ignite/commit/064eff4fbb64cb5acde0cf1a85777dc93983490d", "committedDate": "2020-11-24T18:40:11Z", "message": "IGNITE-13714 Add catboost inference integration"}, "afterCommit": {"oid": "3ce2f3507e032b6b2020d7941be94fab37ec42d8", "author": {"user": {"login": "mrk-andreev", "name": "Mark Andreev"}}, "url": "https://github.com/apache/ignite/commit/3ce2f3507e032b6b2020d7941be94fab37ec42d8", "committedDate": "2020-12-04T08:50:19Z", "message": "IGNITE-13714 Add catboost inference integration"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "3ce2f3507e032b6b2020d7941be94fab37ec42d8", "author": {"user": {"login": "mrk-andreev", "name": "Mark Andreev"}}, "url": "https://github.com/apache/ignite/commit/3ce2f3507e032b6b2020d7941be94fab37ec42d8", "committedDate": "2020-12-04T08:50:19Z", "message": "IGNITE-13714 Add catboost inference integration"}, "afterCommit": {"oid": "9e996242c5f26052d3ddf82dfdf41c9ca999d63f", "author": {"user": {"login": "mrk-andreev", "name": "Mark Andreev"}}, "url": "https://github.com/apache/ignite/commit/9e996242c5f26052d3ddf82dfdf41c9ca999d63f", "committedDate": "2020-12-07T18:25:40Z", "message": "IGNITE-13714 Add catboost inference integration"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b5dad685606bcb4b4c5713184a4c291daeebcc0e", "author": {"user": {"login": "mrk-andreev", "name": "Mark Andreev"}}, "url": "https://github.com/apache/ignite/commit/b5dad685606bcb4b4c5713184a4c291daeebcc0e", "committedDate": "2020-12-07T18:31:29Z", "message": "IGNITE-13714 Add catboost inference integration"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "9e996242c5f26052d3ddf82dfdf41c9ca999d63f", "author": {"user": {"login": "mrk-andreev", "name": "Mark Andreev"}}, "url": "https://github.com/apache/ignite/commit/9e996242c5f26052d3ddf82dfdf41c9ca999d63f", "committedDate": "2020-12-07T18:25:40Z", "message": "IGNITE-13714 Add catboost inference integration"}, "afterCommit": {"oid": "b5dad685606bcb4b4c5713184a4c291daeebcc0e", "author": {"user": {"login": "mrk-andreev", "name": "Mark Andreev"}}, "url": "https://github.com/apache/ignite/commit/b5dad685606bcb4b4c5713184a4c291daeebcc0e", "committedDate": "2020-12-07T18:31:29Z", "message": "IGNITE-13714 Add catboost inference integration"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NjkzNzc2NjYx", "url": "https://github.com/apache/ignite/pull/8489#pullrequestreview-693776661", "createdAt": "2021-06-28T10:02:21Z", "commit": {"oid": "b5dad685606bcb4b4c5713184a4c291daeebcc0e"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wNi0yOFQxMDowMjoyMVrOJ1F5EQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wNi0yOFQxMDowMjoyMVrOJ1F5EQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDY1OTY1MDgzMw==", "bodyText": "Hi @mrk-andreev , second parameter in predict for catboost model should be an array of  categorical features? Could you please help with, how can we run for a model containing categorical features?", "url": "https://github.com/apache/ignite/pull/8489#discussion_r659650833", "createdAt": "2021-06-28T10:02:21Z", "author": {"login": "saurzcode"}, "path": "modules/ml/catboost-model-parser/src/main/java/org/apache/ignite/ml/catboost/CatboostClassificationModel.java", "diffHunk": "@@ -0,0 +1,73 @@\n+/*\n+ * Licensed to the Apache Software Foundation (ASF) under one or more\n+ * contributor license agreements.  See the NOTICE file distributed with\n+ * this work for additional information regarding copyright ownership.\n+ * The ASF licenses this file to You under the Apache License, Version 2.0\n+ * (the \"License\"); you may not use this file except in compliance with\n+ * the License.  You may obtain a copy of the License at\n+ *\n+ *      http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package org.apache.ignite.ml.catboost;\n+\n+import ai.catboost.CatBoostError;\n+import ai.catboost.CatBoostModel;\n+import org.apache.ignite.ml.inference.Model;\n+import org.apache.ignite.ml.math.primitives.vector.NamedVector;\n+import org.slf4j.Logger;\n+import org.slf4j.LoggerFactory;\n+\n+/**\n+ * CatboostClassificationModel imported and wrapped to be compatible with Apache Ignite infrastructure.\n+ */\n+public class CatboostClassificationModel implements Model<NamedVector, Double> {\n+    /** Logger. */\n+    private static final Logger logger = LoggerFactory.getLogger(CatboostClassificationModel.class);\n+\n+    /** Catboost model. */\n+    private final CatBoostModel model;\n+\n+    /**\n+     * Constructs a new instance of Catboost model wrapper.\n+     *\n+     * @param model Catboost Model\n+     */\n+    public CatboostClassificationModel(CatBoostModel model) {\n+        this.model = model;\n+    }\n+\n+    /** {@inheritDoc} */\n+    @Override public Double predict(NamedVector input) {\n+        float[] floatInput = new float[input.size()];\n+        int index = 0;\n+        for (String key: model.getFeatureNames()) {\n+            floatInput[index] = (float) input.get(key);\n+            index++;\n+        }\n+\n+        try {\n+            double predict = model.predict(floatInput, model.getFeatureNames())", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b5dad685606bcb4b4c5713184a4c291daeebcc0e"}, "originalPosition": 56}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2989, "cost": 1, "resetAt": "2021-10-29T19:57:52Z"}}}