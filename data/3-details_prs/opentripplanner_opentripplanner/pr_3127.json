{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDQyNTIwMjUz", "number": 3127, "title": "Fill out Leg#serviceDate using the relevant TripSchedule", "bodyText": "LegMapper is updated to use the service date of the TripSchedule to correctly fill out leg.serviceDate. For this to be possible, TripSchedule is extended with a getServiceDate() method which exposes the service date (LocalDate) in TripScheduleWithOffset throught TripPatternForDate / TripPatternForDates.\nCloses #3126\nTo be completed by pull request submitter:\n\n issue: Link to or create an issue that describes the relevant feature or bug. Add GitHub keywords to this PR's description (e.g., closes #45).\n roadmap: Check the roadmap for this feature or bug. If it is not already on the roadmap, PLC will discuss as part of the review process.\n tests: Have you added relevant test coverage? Are all the tests passing on the continuous integration service (Travis CI)?\n formatting: Have you followed the suggested code style?\n documentation: If you are adding a new configuration option, have you added an explanation to the configuration documentation tables and sections?\n changelog: add a bullet point to the changelog file with description and link to the linked issue\n\nTo be completed by @opentripplanner/plc:\n\n reviews and approvals by 2 members, ideally from different organizations\n after merging: update the relevant card on the roadmap", "createdAt": "2020-07-01T08:08:11Z", "url": "https://github.com/opentripplanner/OpenTripPlanner/pull/3127", "merged": true, "mergeCommit": {"oid": "a8c245b148efa53a83c7aa0dc0dbd5c6d1f80e25"}, "closed": true, "closedAt": "2020-08-10T13:03:15Z", "author": {"login": "flaktack"}, "timelineItems": {"totalCount": 5, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABc5-jxSgFqTQ1ODM0MDc3OQ==", "endCursor": "Y3Vyc29yOnYyOpPPAAABc9h3KfgFqTQ2NDIwNjY0OQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDU4MzQwNzc5", "url": "https://github.com/opentripplanner/OpenTripPlanner/pull/3127#pullrequestreview-458340779", "createdAt": "2020-07-30T12:12:56Z", "commit": {"oid": "805495a69d0c418cfd748aa8de4e9c39bd736c82"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0zMFQxMjoxMjo1NlrOG5gWJA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0zMFQxMjoxMjo1NlrOG5gWJA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2Mjk1MTk3Mg==", "bodyText": "I think we should add more JavaDoc here and maybe also rename the field to tripServiceDate. Add doc (suggestion):\n...\n<p>\nThe trip service date should be used to identify the correct trip schedule and\ncan not be trusted to display the date for any departures or arrivals. For example,\nthe first departure for a given trip may happen at service date March 25th and\nservice time 25:00, which in local time would be Mach 26th 01:00.", "url": "https://github.com/opentripplanner/OpenTripPlanner/pull/3127#discussion_r462951972", "createdAt": "2020-07-30T12:12:56Z", "author": {"login": "t2gran"}, "path": "src/main/java/org/opentripplanner/model/plan/Leg.java", "diffHunk": "@@ -149,9 +150,7 @@\n     * For transit legs, the service date of the trip.\n     * For non-transit legs, null.\n     */\n-   // TODO OTP2 - This should not be a String? What is this used for? Is it the actual date or the\n-   //           - Service date?\n-   public String serviceDate = null;\n+   public ServiceDate serviceDate = null;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "805495a69d0c418cfd748aa8de4e9c39bd736c82"}, "originalPosition": 15}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDU4MzUxNzk3", "url": "https://github.com/opentripplanner/OpenTripPlanner/pull/3127#pullrequestreview-458351797", "createdAt": "2020-07-30T12:28:49Z", "commit": {"oid": "805495a69d0c418cfd748aa8de4e9c39bd736c82"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0zMFQxMjoyODo0OVrOG5g2mA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0zMFQxMjoyODo0OVrOG5g2mA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2Mjk2MDI4MA==", "bodyText": "I would like to point out this this duplicate the service calendar information. The service date is redundant, it can be found using the calendar info, trip and leg. We sometimes do duplicate information in the model, but be aware that that have a high maintenance cost. I would recommend retrieving this from the calendar service instead at the time of mapping into the API if it is not to difficult or error prune. We plan to clean up the transit layer, so maybe we can deal with it then.", "url": "https://github.com/opentripplanner/OpenTripPlanner/pull/3127#discussion_r462960280", "createdAt": "2020-07-30T12:28:49Z", "author": {"login": "t2gran"}, "path": "src/main/java/org/opentripplanner/routing/algorithm/raptor/transit/TripSchedule.java", "diffHunk": "@@ -20,6 +22,8 @@\n      */\n     TripPattern getOriginalTripPattern();\n \n+    LocalDate getServiceDate();\n+", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "805495a69d0c418cfd748aa8de4e9c39bd736c82"}, "originalPosition": 14}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e8267721fe4612a5757e5f7b6b7bbd395b0e04b5", "author": {"user": {"login": "flaktack", "name": "Zsombor Welker"}}, "url": "https://github.com/opentripplanner/OpenTripPlanner/commit/e8267721fe4612a5757e5f7b6b7bbd395b0e04b5", "committedDate": "2020-08-10T11:59:35Z", "message": "Correctly fill out Leg#serviceDate\n\nusing the serviceDate of the trip from the TripSchedule"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "805495a69d0c418cfd748aa8de4e9c39bd736c82", "author": {"user": {"login": "flaktack", "name": "Zsombor Welker"}}, "url": "https://github.com/opentripplanner/OpenTripPlanner/commit/805495a69d0c418cfd748aa8de4e9c39bd736c82", "committedDate": "2020-06-30T11:55:56Z", "message": "Correctly fill out Leg#serviceDate\n\nusing the serviceDate of the trip from the TripSchedule"}, "afterCommit": {"oid": "e8267721fe4612a5757e5f7b6b7bbd395b0e04b5", "author": {"user": {"login": "flaktack", "name": "Zsombor Welker"}}, "url": "https://github.com/opentripplanner/OpenTripPlanner/commit/e8267721fe4612a5757e5f7b6b7bbd395b0e04b5", "committedDate": "2020-08-10T11:59:35Z", "message": "Correctly fill out Leg#serviceDate\n\nusing the serviceDate of the trip from the TripSchedule"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDY0MjA2NjQ5", "url": "https://github.com/opentripplanner/OpenTripPlanner/pull/3127#pullrequestreview-464206649", "createdAt": "2020-08-10T13:02:35Z", "commit": {"oid": "e8267721fe4612a5757e5f7b6b7bbd395b0e04b5"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2167, "cost": 1, "resetAt": "2021-11-01T15:33:45Z"}}}