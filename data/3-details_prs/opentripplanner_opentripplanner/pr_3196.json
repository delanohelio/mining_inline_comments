{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDk0NjQ0NDQ0", "number": 3196, "title": "Add Mapbox Vector Tiles API as a sandbox feature", "bodyText": "Add a new sandbox feature for producing Mapbox vector tiles, which are used by eg. Digitransit-ui for showing information about public transit entities on the map.\nThere is one new dependency, https://github.com/wdtinc/mapbox-vector-tile-java. All of its dependencies are already included in OTP.\nTo be completed by pull request submitter:\n\n issue: Link to or create an issue that describes the relevant feature or bug. Add GitHub keywords to this PR's description (e.g., closes #45).\n roadmap: Check the roadmap for this feature or bug. If it is not already on the roadmap, PLC will discuss as part of the review process.\n tests: Have you added relevant test coverage? Are all the tests passing on the continuous integration service (Travis CI)?\n formatting: Have you followed the suggested code style?\n documentation: If you are adding a new configuration option, have you added an explanation to the configuration documentation tables and sections?\n changelog: add a bullet point to the changelog file with description and link to the linked issue\n\nTo be completed by @opentripplanner/plc:\n\n reviews and approvals by 2 members, ideally from different organizations\n after merging: update the relevant card on the roadmap", "createdAt": "2020-09-29T08:07:09Z", "url": "https://github.com/opentripplanner/OpenTripPlanner/pull/3196", "merged": true, "mergeCommit": {"oid": "bbd6100fd314f9875af7ca0f016ac16de6b14f89"}, "closed": true, "closedAt": "2020-09-29T09:57:53Z", "author": {"login": "hannesj"}, "timelineItems": {"totalCount": 9, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdNSIIAgH2gAyNDk0NjQ0NDQ0OjY2Y2I0YmRjMTA1NDY1MTAyMThlMTViNGUzNTFhZDM2ZTY3MjVkYmY=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdNlLHogFqTQ5ODMwNDU5OA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "66cb4bdc10546510218e15b4e351ad36e6725dbf", "author": {"user": {"login": "hannesj", "name": "Hannes Junnila"}}, "url": "https://github.com/opentripplanner/OpenTripPlanner/commit/66cb4bdc10546510218e15b4e351ad36e6725dbf", "committedDate": "2020-09-28T11:45:25Z", "message": "Move and rename classes from the analyst directory"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "4adfde8d86dda37d39b6bdb42187d15fcbbcdee5", "author": {"user": {"login": "hannesj", "name": "Hannes Junnila"}}, "url": "https://github.com/opentripplanner/OpenTripPlanner/commit/4adfde8d86dda37d39b6bdb42187d15fcbbcdee5", "committedDate": "2020-09-28T11:45:25Z", "message": "Remove unused superclass usage"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "8b23fd3cbe4cac6d88a14fa7621a35a501a3165d", "author": {"user": {"login": "hannesj", "name": "Hannes Junnila"}}, "url": "https://github.com/opentripplanner/OpenTripPlanner/commit/8b23fd3cbe4cac6d88a14fa7621a35a501a3165d", "committedDate": "2020-09-29T08:05:02Z", "message": "Add API endpoint for fetching Mapbox Vector Tiles"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "d2e167a37db4bd2fd0f6f03484fae86d20c59f50", "author": {"user": {"login": "hannesj", "name": "Hannes Junnila"}}, "url": "https://github.com/opentripplanner/OpenTripPlanner/commit/d2e167a37db4bd2fd0f6f03484fae86d20c59f50", "committedDate": "2020-09-29T08:32:35Z", "message": "Add documentation"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDk4MjQ3OTQ4", "url": "https://github.com/opentripplanner/OpenTripPlanner/pull/3196#pullrequestreview-498247948", "createdAt": "2020-09-29T08:49:22Z", "commit": {"oid": "d2e167a37db4bd2fd0f6f03484fae86d20c59f50"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yOVQwODo0OToyMlrOHZi2OQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yOVQwODo0OToyMlrOHZi2OQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NjU0NzM4NQ==", "bodyText": "Link to this in:\n\nmkdocs.yml\nSandbox.md", "url": "https://github.com/opentripplanner/OpenTripPlanner/pull/3196#discussion_r496547385", "createdAt": "2020-09-29T08:49:22Z", "author": {"login": "t2gran"}, "path": "docs/sandbox/MapboxVectorTilesApi.md", "diffHunk": "@@ -0,0 +1,60 @@\n+# Mapbox Vector Tiles API\n+", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d2e167a37db4bd2fd0f6f03484fae86d20c59f50"}, "originalPosition": 2}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDk4MjQ4Njkz", "url": "https://github.com/opentripplanner/OpenTripPlanner/pull/3196#pullrequestreview-498248693", "createdAt": "2020-09-29T08:50:13Z", "commit": {"oid": "d2e167a37db4bd2fd0f6f03484fae86d20c59f50"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yOVQwODo1MDoxNFrOHZi4aQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yOVQwODo1MDoxNFrOHZi4aQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NjU0Nzk0NQ==", "bodyText": "Add some doc on how to extend and move to \"core\"", "url": "https://github.com/opentripplanner/OpenTripPlanner/pull/3196#discussion_r496547945", "createdAt": "2020-09-29T08:50:14Z", "author": {"login": "t2gran"}, "path": "docs/sandbox/MapboxVectorTilesApi.md", "diffHunk": "@@ -0,0 +1,60 @@\n+# Mapbox Vector Tiles API\n+\n+## Contact Info\n+- HSL, Finland\n+- Kyyti Group Oy, Finland\n+- Hannes Junnila\n+\n+\n+## Changelog\n+- Initial version of Mapbox vector tiles api API\n+\n+## Documentation\n+\n+This API produces [Mapbox vector tiles](https://docs.mapbox.com/vector-tiles/reference/), which are used by eg. [Digitransit-ui](https://github.com/HSLdevcom/digitransit-ui) to show information about public transit entities on the map.\n+\n+The tiles can be fetched from `/otp/routers/{routerId}/vectorTiles/{layers}/{z}/{x}/{y}.pbf`, where `layers is a comma separated list of layer names from the configuration.\n+\n+### Configuration\n+To enable this you need to add the feature `SandboxAPIMapboxVectorTilesApi` in `otp-config.json`.\n+\n+The feature must be configured in `router-config.json` as follows\n+ \n+```\n+{\n+  \"vectorTileLayers\": [\n+    {\n+      \"name\": \"stops\",\n+      \"type\": \"Stop\",\n+      \"mapper\": \"Digitransit\",\n+      \"maxZoom\": 20,\n+      \"minZoom\": 14,\n+      \"cacheMaxSeconds\": 600\n+    },\n+    {\n+      \"name\": \"stations\",\n+      \"type\": \"Station\",\n+      \"mapper\": \"Digitransit\",\n+      \"maxZoom\": 20,\n+      \"minZoom\": 12,\n+      \"cacheMaxSeconds\": 600\n+    },\n+    {\n+      \"name\": \"citybikes\",\n+      \"type\": \"BikeRental\",\n+      \"mapper\": \"Digitransit\",\n+      \"maxZoom\": 20,\n+      \"minZoom\": 14,\n+      \"cacheMaxSeconds\": 60\n+    }\n+  ]\n+}\n+```\n+\n+For each layer, the configuration includes,\n+ - `name` which is used in the url to fetch tiles, and as the layer name in the vector tiles.\n+ - `type` which tells the type of the layer. Currently `Stop`, `Station` and `BikeRental` are supported.\n+ - `mapper` which describes the mapper converting the properties from the OTP model entities to the vector tile properties. Currently `Digitransit` is supported for all layer types.\n+ - `minZoom` and `maxZoom` which describe the zoom levels the layer is active for.\n+ - `cacheMaxSeconds` which sets the cache header in the response. The lowest value of the layers included is selected.\n+ ", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d2e167a37db4bd2fd0f6f03484fae86d20c59f50"}, "originalPosition": 60}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "341f2a3b0cb0bd9a08627539a278ca51ceb9a5f0", "author": {"user": {"login": "hannesj", "name": "Hannes Junnila"}}, "url": "https://github.com/opentripplanner/OpenTripPlanner/commit/341f2a3b0cb0bd9a08627539a278ca51ceb9a5f0", "committedDate": "2020-09-29T09:50:34Z", "message": "Merge remote-tracking branch 'origin/dev-2.x' into mvt"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "77b59ef42c5d23f788164197ab90db6b02ea2491", "author": {"user": {"login": "hannesj", "name": "Hannes Junnila"}}, "url": "https://github.com/opentripplanner/OpenTripPlanner/commit/77b59ef42c5d23f788164197ab90db6b02ea2491", "committedDate": "2020-09-29T09:53:45Z", "message": "Add notes about extension"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDk4MzA0NTk4", "url": "https://github.com/opentripplanner/OpenTripPlanner/pull/3196#pullrequestreview-498304598", "createdAt": "2020-09-29T09:56:53Z", "commit": {"oid": "77b59ef42c5d23f788164197ab90db6b02ea2491"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1979, "cost": 1, "resetAt": "2021-11-01T15:33:45Z"}}}