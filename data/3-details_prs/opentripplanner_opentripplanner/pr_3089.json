{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDI3MDUwODA1", "number": 3089, "title": "Add support for public/private code", "bodyText": "To be completed by pull request submitter:\n\n issue: #3088\n roadmap: Check the roadmap for this feature or bug. If it is not already on the roadmap, PLC will discuss as part of the review process.\n tests: Have you added relevant test coverage? Are all the tests passing on the continuous integration service (Travis CI)?\n formatting: Have you followed the suggested code style?\n documentation: If you are adding a new configuration option, have you added an explanation to the configuration documentation tables and sections?\n changelog: add a bullet point to the changelog file with description and link to the linked issue\n\nTo be completed by @opentripplanner/plc:\n\n reviews and approvals by 2 members, ideally from different organizations\n after merging: update the relevant card on the roadmap\n\nThis adds the privateCode/publicCode fields to the Trip class in the OTP model. It also adds these fields to the NeTEx import and the Transmodel graphql API.", "createdAt": "2020-06-03T08:39:24Z", "url": "https://github.com/opentripplanner/OpenTripPlanner/pull/3089", "merged": true, "mergeCommit": {"oid": "398bb3ae90b8e6746caf319d69695c51fe647231"}, "closed": true, "closedAt": "2020-06-16T15:58:08Z", "author": {"login": "gmellemstrand"}, "timelineItems": {"totalCount": 14, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcnlK6SAH2gAyNDI3MDUwODA1OjY1YjM1NTU1ZTVhMGJkNThkODFiMmYxYjg1Y2M1N2YzMDI0NmRlZTU=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcr3Z93AFqTQzMTY1ODM3MQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "65b35555e5a0bd58d81b2f1b85cc57f30246dee5", "author": {"user": {"login": "gmellemstrand", "name": null}}, "url": "https://github.com/opentripplanner/OpenTripPlanner/commit/65b35555e5a0bd58d81b2f1b85cc57f30246dee5", "committedDate": "2020-06-03T08:27:32Z", "message": "Add support for public/private code"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "d78db428c59a4d0cb35d6446fdaec3167d2e17a7", "author": {"user": {"login": "gmellemstrand", "name": null}}, "url": "https://github.com/opentripplanner/OpenTripPlanner/commit/d78db428c59a4d0cb35d6446fdaec3167d2e17a7", "committedDate": "2020-06-03T08:33:49Z", "message": "Javadoc"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "d2e224ab15bc9fcd9c5f92ad230f342e301aeee6", "author": {"user": {"login": "gmellemstrand", "name": null}}, "url": "https://github.com/opentripplanner/OpenTripPlanner/commit/d2e224ab15bc9fcd9c5f92ad230f342e301aeee6", "committedDate": "2020-06-03T08:40:18Z", "message": "Added changelog entry"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDI1MTg0Mzgz", "url": "https://github.com/opentripplanner/OpenTripPlanner/pull/3089#pullrequestreview-425184383", "createdAt": "2020-06-05T10:32:13Z", "commit": {"oid": "d2e224ab15bc9fcd9c5f92ad230f342e301aeee6"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wNVQxMDozMjoxNFrOGfpRQg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wNVQxMDozMjoxNFrOGfpRQg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNTgzNTIwMg==", "bodyText": "I suggest mapping the Netex tripPublicCode into tripShortName - maybe not exactly the same - but close enogh. Is there something in Netex that mappes better to GTFS tripShortName?\nWe should discuss on tuesday what to do with tripPrivateCode. The options are:\n\nAdd it to trip (as done here) - and add documentation.\nAdd a new field Trip.extNetex with type NetexTripExtention. The NetexTripExtention will have one field and that is tripPrivateCode.\nMape and index(Map) from Trip.id to 'tripPrivetCode' and store it in GraphIndex.\n\nConsiderations:\n\nIs this a \"Entur\" specific hack?\nIs it likely that we need to add more fields to Trip later, then option 2 is best. Also this make a good example on how to add stuff like this.", "url": "https://github.com/opentripplanner/OpenTripPlanner/pull/3089#discussion_r435835202", "createdAt": "2020-06-05T10:32:14Z", "author": {"login": "t2gran"}, "path": "src/main/java/org/opentripplanner/model/Trip.java", "diffHunk": "@@ -15,6 +15,10 @@\n \n     private String tripShortName;\n \n+    private String tripPublicCode;\n+\n+    private String tripPrivateCode;\n+", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d2e224ab15bc9fcd9c5f92ad230f342e301aeee6"}, "originalPosition": 7}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "665cb0876640fabc64a4b99ba346998878a5547c", "author": {"user": {"login": "gmellemstrand", "name": null}}, "url": "https://github.com/opentripplanner/OpenTripPlanner/commit/665cb0876640fabc64a4b99ba346998878a5547c", "committedDate": "2020-06-11T12:09:53Z", "message": "Remove publicCode, remap to tripShortName and document"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "17faa72c35496743d6cfc83bfe6d0669d25436d3", "author": {"user": {"login": "gmellemstrand", "name": null}}, "url": "https://github.com/opentripplanner/OpenTripPlanner/commit/17faa72c35496743d6cfc83bfe6d0669d25436d3", "committedDate": "2020-06-11T12:13:58Z", "message": "Rename privateCode to internalPlanningCode"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ce02f7cdd001ae55f845e8a479366648a4bf9f64", "author": {"user": {"login": "gmellemstrand", "name": null}}, "url": "https://github.com/opentripplanner/OpenTripPlanner/commit/ce02f7cdd001ae55f845e8a479366648a4bf9f64", "committedDate": "2020-06-11T12:17:16Z", "message": "Merge branch 'dev-2.x' into otp2_public_private_code"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDI4OTgxNzk0", "url": "https://github.com/opentripplanner/OpenTripPlanner/pull/3089#pullrequestreview-428981794", "createdAt": "2020-06-11T14:42:13Z", "commit": {"oid": "ce02f7cdd001ae55f845e8a479366648a4bf9f64"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xMVQxNDo0MjoxNFrOGigi5Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xMVQxNDo1MTozMFrOGig7_w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzODgzNzk4OQ==", "bodyText": "Change this, refrase and write something that is meaningful for someone who look at OTP as a black box - a Product Owner.", "url": "https://github.com/opentripplanner/OpenTripPlanner/pull/3089#discussion_r438837989", "createdAt": "2020-06-11T14:42:14Z", "author": {"login": "t2gran"}, "path": "docs/Changelog.md", "diffHunk": "@@ -34,6 +34,7 @@ See the [OTP2 Migration Guide](OTP2-MigrationGuide.md) on changes to the REST AP\n - Refactor how to specify access/egress/direct/transit modes in the internal model and the Transmodel API (#3011)\n - Make agency id feed scoped (#3035)\n - Refactor kiss and ride to a more general car pickup mode (#3063)\n+- Add publicCode/privateCode to the Trip class in the OTP model (#3088)", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ce02f7cdd001ae55f845e8a479366648a4bf9f64"}, "originalPosition": 4}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzODg0NDQxNQ==", "bodyText": "In NeTEx this maps to {@link ServiceJourney#privateCode}, there is no GTFS equivalent.", "url": "https://github.com/opentripplanner/OpenTripPlanner/pull/3089#discussion_r438844415", "createdAt": "2020-06-11T14:51:30Z", "author": {"login": "t2gran"}, "path": "src/main/java/org/opentripplanner/model/Trip.java", "diffHunk": "@@ -110,6 +115,17 @@ public void setTripShortName(String tripShortName) {\n         this.tripShortName = tripShortName;\n     }\n \n+    /**\n+     * Internal code (non-public identifier) for the journey (e.g. train- or trip number from\n+     * the planners' tool). This is kept to ensure compatibility with legacy planning systems.\n+     * There is no GTFS equivalent.", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ce02f7cdd001ae55f845e8a479366648a4bf9f64"}, "originalPosition": 35}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f2805240d46070656f8bb552ab09a5655bc93436", "author": {"user": {"login": "gmellemstrand", "name": null}}, "url": "https://github.com/opentripplanner/OpenTripPlanner/commit/f2805240d46070656f8bb552ab09a5655bc93436", "committedDate": "2020-06-12T09:48:18Z", "message": "Update changelog"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f4159d582448eec5d0dd9f56738edbff7109580c", "author": {"user": {"login": "gmellemstrand", "name": null}}, "url": "https://github.com/opentripplanner/OpenTripPlanner/commit/f4159d582448eec5d0dd9f56738edbff7109580c", "committedDate": "2020-06-12T09:49:42Z", "message": "Update javadoc"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDI5NjgxMDk4", "url": "https://github.com/opentripplanner/OpenTripPlanner/pull/3089#pullrequestreview-429681098", "createdAt": "2020-06-12T11:55:17Z", "commit": {"oid": "f4159d582448eec5d0dd9f56738edbff7109580c"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xMlQxMTo1NToxN1rOGjBTag==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xMlQxMTo1NToxN1rOGjBTag==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzOTM3NDY5OA==", "bodyText": "No need to wrap this with a if", "url": "https://github.com/opentripplanner/OpenTripPlanner/pull/3089#discussion_r439374698", "createdAt": "2020-06-12T11:55:17Z", "author": {"login": "t2gran"}, "path": "src/main/java/org/opentripplanner/netex/loader/mapping/TripMapper.java", "diffHunk": "@@ -62,6 +62,12 @@ Trip mapServiceJourney(ServiceJourney serviceJourney){\n         trip.setRoute(route);\n         trip.setServiceId(idFactory.createId(serviceId));\n         trip.setShapeId(getShapeId(serviceJourney));\n+        if (serviceJourney.getPrivateCode() != null) {\n+          trip.setInternalPlanningCode(serviceJourney.getPrivateCode().getValue());\n+        }\n+        if (serviceJourney.getPublicCode() != null) {\n+          trip.setTripShortName(serviceJourney.getPublicCode());\n+        }", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f4159d582448eec5d0dd9f56738edbff7109580c"}, "originalPosition": 9}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "7c7aa6fe1cdd162d9430260c7abd21b41085f37e", "author": {"user": {"login": "gmellemstrand", "name": null}}, "url": "https://github.com/opentripplanner/OpenTripPlanner/commit/7c7aa6fe1cdd162d9430260c7abd21b41085f37e", "committedDate": "2020-06-16T08:40:51Z", "message": "Remove unecessary if-check"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "fe2156f225fcb377cf3c6d51678d6d4c8f33f75f", "author": {"user": {"login": "t2gran", "name": "Thomas Gran"}}, "url": "https://github.com/opentripplanner/OpenTripPlanner/commit/fe2156f225fcb377cf3c6d51678d6d4c8f33f75f", "committedDate": "2020-06-16T08:42:36Z", "message": "Merge branch 'dev-2.x' into otp2_public_private_code"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDMxNjU4Mzcx", "url": "https://github.com/opentripplanner/OpenTripPlanner/pull/3089#pullrequestreview-431658371", "createdAt": "2020-06-16T15:57:58Z", "commit": {"oid": "fe2156f225fcb377cf3c6d51678d6d4c8f33f75f"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2128, "cost": 1, "resetAt": "2021-11-01T15:33:45Z"}}}