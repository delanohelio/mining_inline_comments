{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTIzNjAyMzY1", "number": 3253, "title": "Make sure bug do not occour when AvgTimer is switched off.", "bodyText": "To be completed by pull request submitter:\n\n\nThe error was fairly easy to reproduce to be a concurrency issue. Hitting the server with plenty of requests during startup cased this error to occur every time.\n\n\n issue: closes #3252\n\n\n roadmap: No\n\n\n tests: No.\n\n\n formatting: Yes\n\n\n documentation: No\n\n\n changelog: No\n\n\nTo be completed by @opentripplanner/plc:\n\n reviews and approvals by 2 members, ideally from different organizations\n after merging: update the relevant card on the roadmap", "createdAt": "2020-11-19T00:51:20Z", "url": "https://github.com/opentripplanner/OpenTripPlanner/pull/3253", "merged": true, "mergeCommit": {"oid": "4401fb88290513246a76f7679a4b4986438b1d95"}, "closed": true, "closedAt": "2020-11-22T23:05:59Z", "author": {"login": "t2gran"}, "timelineItems": {"totalCount": 8, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdd3wvFgH2gAyNTIzNjAyMzY1OmMyZjFjN2M4MGQxNjAzMjBmOGVhZWE3NThiNWVkMGIzZmEzNWVmYTU=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdfIxYeAH2gAyNTIzNjAyMzY1OmI1YWZiOTM1NjdkMWU5MjlkYWJhY2Q3YjE3ZGJkYjFiNTNmOWU4M2E=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "c2f1c7c80d160320f8eaea758b5ed0b3fa35efa5", "author": {"user": {"login": "t2gran", "name": "Thomas Gran"}}, "url": "https://github.com/opentripplanner/OpenTripPlanner/commit/c2f1c7c80d160320f8eaea758b5ed0b3fa35efa5", "committedDate": "2020-11-19T00:39:03Z", "message": "Make sure bug do not occour when AvgTimer is switched off."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTM0MjMxNjQ2", "url": "https://github.com/opentripplanner/OpenTripPlanner/pull/3253#pullrequestreview-534231646", "createdAt": "2020-11-19T09:33:13Z", "commit": {"oid": "c2f1c7c80d160320f8eaea758b5ed0b3fa35efa5"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xOVQwOTozMzoxM1rOH2UL0w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xOVQwOTozMzoxM1rOH2UL0w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNjcxNTg1OQ==", "bodyText": "Add comment on NOT THREAD-SAFE", "url": "https://github.com/opentripplanner/OpenTripPlanner/pull/3253#discussion_r526715859", "createdAt": "2020-11-19T09:33:13Z", "author": {"login": "t2gran"}, "path": "src/main/java/org/opentripplanner/transit/raptor/util/AvgTimer.java", "diffHunk": "@@ -186,17 +172,11 @@ public String totalTimeInSeconds() {\n \n     /* private methods */\n \n-    private boolean used() {\n-        return counterSuccess != 0 || counterFailed != 0;\n-    }\n-\n-    private String toString(int width) {\n-        return formatLine(\n-                method,\n-                width,\n-                formatResultAvg(totalTimeSuccess, counterSuccess),\n-                formatResult(totalTimeFailed, counterFailed)\n-        );\n+    private static AvgTimer timer(final String method, final Function<String, ? extends AvgTimer> factory) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c2f1c7c80d160320f8eaea758b5ed0b3fa35efa5"}, "originalPosition": 90}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTM0MjM1MjAx", "url": "https://github.com/opentripplanner/OpenTripPlanner/pull/3253#pullrequestreview-534235201", "createdAt": "2020-11-19T09:37:06Z", "commit": {"oid": "c2f1c7c80d160320f8eaea758b5ed0b3fa35efa5"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xOVQwOTozNzowNlrOH2UWIw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xOVQwOTozNzowNlrOH2UWIw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNjcxODQ5OQ==", "bodyText": "Synchrocronize this", "url": "https://github.com/opentripplanner/OpenTripPlanner/pull/3253#discussion_r526718499", "createdAt": "2020-11-19T09:37:06Z", "author": {"login": "t2gran"}, "path": "src/main/java/org/opentripplanner/transit/raptor/util/AvgTimer.java", "diffHunk": "@@ -51,13 +50,15 @@ private AvgTimer(String method) {\n      * @param method Use: <SimpleClassName>:<methodName>\n      */\n     public static AvgTimer timerMilliSec(final String method) {\n+        if(NOOP) { return NoopAvgTimer.INSTANCE; }", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c2f1c7c80d160320f8eaea758b5ed0b3fa35efa5"}, "originalPosition": 24}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "28c9dd0bca085e69f7394ecfec8fbc4f2216fc84", "author": {"user": {"login": "t2gran", "name": "Thomas Gran"}}, "url": "https://github.com/opentripplanner/OpenTripPlanner/commit/28c9dd0bca085e69f7394ecfec8fbc4f2216fc84", "committedDate": "2020-11-19T10:23:54Z", "message": "Merge remote-tracking branch 'otp/dev-2.x' into otp2_fix_ConcurrentModificationException_in_Avg_timer"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c718b1bc603ed925dcfe2a31f2be33216b842d78", "author": {"user": {"login": "t2gran", "name": "Thomas Gran"}}, "url": "https://github.com/opentripplanner/OpenTripPlanner/commit/c718b1bc603ed925dcfe2a31f2be33216b842d78", "committedDate": "2020-11-19T11:22:18Z", "message": "Review fixes, doc and small improvments using ConcurrentHashMap to increase thread-safty"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c03445174bdf38454d45f978f591bc42d880b361", "author": {"user": {"login": "t2gran", "name": "Thomas Gran"}}, "url": "https://github.com/opentripplanner/OpenTripPlanner/commit/c03445174bdf38454d45f978f591bc42d880b361", "committedDate": "2020-11-19T11:25:40Z", "message": "Merge branch 'dev-2.x' into otp2_fix_ConcurrentModificationException_in_Avg_timer"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTM1NDkzODE3", "url": "https://github.com/opentripplanner/OpenTripPlanner/pull/3253#pullrequestreview-535493817", "createdAt": "2020-11-20T14:51:10Z", "commit": {"oid": "c03445174bdf38454d45f978f591bc42d880b361"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b5afb93567d1e929dabacd7b17dbdb1b53f9e83a", "author": {"user": {"login": "t2gran", "name": "Thomas Gran"}}, "url": "https://github.com/opentripplanner/OpenTripPlanner/commit/b5afb93567d1e929dabacd7b17dbdb1b53f9e83a", "committedDate": "2020-11-22T23:02:04Z", "message": "Merge branch 'dev-2.x' into otp2_fix_ConcurrentModificationException_in_Avg_timer"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2025, "cost": 1, "resetAt": "2021-11-01T15:33:45Z"}}}