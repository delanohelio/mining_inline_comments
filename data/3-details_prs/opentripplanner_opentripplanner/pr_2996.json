{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0MzgzOTUxNzg2", "number": 2996, "title": "OTP2: include result paging metadata on results containing no itineraries", "bodyText": "To be completed by pull request submitter:\n\n issue: closes #2995\n roadmap: Bugfix\n tests: Yes, for new ProgressTracker\n formatting: Yes\n documentation: No doc added, just JavaDoc on new code\n changelog: No, this is a bugfix of new bugs introduced after last release.\n\nTo be completed by @opentripplanner/plc:\n\n reviews and approvals by 2 members, ideally from different organizations\n after merging: update the relevant card on the roadmap", "createdAt": "2020-03-04T22:58:07Z", "url": "https://github.com/opentripplanner/OpenTripPlanner/pull/2996", "merged": true, "mergeCommit": {"oid": "bf6ee4e884e9341d0ebadf286be1345fe757f4b6"}, "closed": true, "closedAt": "2020-03-10T11:24:59Z", "author": {"login": "t2gran"}, "timelineItems": {"totalCount": 15, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcKXHl3AH2gAyMzgzOTUxNzg2OmZjOGM1YjU4MzgyOWIzOWJhOTVlODJjMjY5Yjc5ZGI1ZmRjZTgxZWM=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcMQweSAFqTM3MTg2ODg3Nw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "fc8c5b583829b39ba95e82c269b79db5fdce81ec", "author": {"user": {"login": "t2gran", "name": "Thomas Gran"}}, "url": "https://github.com/opentripplanner/OpenTripPlanner/commit/fc8c5b583829b39ba95e82c269b79db5fdce81ec", "committedDate": "2020-03-04T13:41:26Z", "message": "Fix error handling in Transmodel API when from/to place is TOO_CLOSE. This failed hard in the previous version."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "2382beb48e7ee0d06a7404e1a4736c0601c71499", "author": {"user": {"login": "t2gran", "name": "Thomas Gran"}}, "url": "https://github.com/opentripplanner/OpenTripPlanner/commit/2382beb48e7ee0d06a7404e1a4736c0601c71499", "committedDate": "2020-03-04T19:43:17Z", "message": "Fix error handling in when from/to place is missing in the egress/access search."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "9ccbb682eaa8f3d5b9dc93bf6be0db24c719b6ec", "author": {"user": {"login": "t2gran", "name": "Thomas Gran"}}, "url": "https://github.com/opentripplanner/OpenTripPlanner/commit/9ccbb682eaa8f3d5b9dc93bf6be0db24c719b6ec", "committedDate": "2020-03-04T22:49:55Z", "message": "Add progress tracking on the stop linking."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "fb5667f9c544f9ee0af1f44affeaaa0492ac8b8d", "author": {"user": {"login": "t2gran", "name": "Thomas Gran"}}, "url": "https://github.com/opentripplanner/OpenTripPlanner/commit/fb5667f9c544f9ee0af1f44affeaaa0492ac8b8d", "committedDate": "2020-03-04T22:50:00Z", "message": "Add error message to response when no itineraries are found."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzY5NDA0NDM0", "url": "https://github.com/opentripplanner/OpenTripPlanner/pull/2996#pullrequestreview-369404434", "createdAt": "2020-03-05T09:19:21Z", "commit": {"oid": "2382beb48e7ee0d06a7404e1a4736c0601c71499"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wNVQwOToxOToyMVrOFyLv_Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wNVQwOToxOToyMVrOFyLv_Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4ODE2NTYyOQ==", "bodyText": "These are not in use", "url": "https://github.com/opentripplanner/OpenTripPlanner/pull/2996#discussion_r388165629", "createdAt": "2020-03-05T09:19:21Z", "author": {"login": "t2gran"}, "path": "src/main/java/org/opentripplanner/api/common/Message.java", "diffHunk": "@@ -19,8 +19,16 @@\n     NO_TRANSIT_TIMES(406),\n     REQUEST_TIMEOUT(408),\n     BOGUS_PARAMETER(413),\n-    GEOCODE_FROM_NOT_FOUND(440),\n-    GEOCODE_TO_NOT_FOUND(450),\n+    /**\n+     * The request 'from' location is not found. This can also mean that there is no street close\n+     * to the given coordinates, no stops nearby. Change the from field and try again.\n+     */\n+    FROM_NOT_FOUND(440),\n+    /**\n+     * The request 'to' location is not found. This can also mean that there is no street close to\n+     * the given coordinates, no stops nearby. Change the from field and try again.\n+     */\n+    TO_NOT_FOUND(450),", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "2382beb48e7ee0d06a7404e1a4736c0601c71499"}, "originalPosition": 27}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzY5NDEwNjc1", "url": "https://github.com/opentripplanner/OpenTripPlanner/pull/2996#pullrequestreview-369410675", "createdAt": "2020-03-05T09:28:02Z", "commit": {"oid": "2382beb48e7ee0d06a7404e1a4736c0601c71499"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wNVQwOToyODowMlrOFyMDCw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wNVQwOToyODowMlrOFyMDCw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4ODE3MDUwNw==", "bodyText": "Go back to the T.", "url": "https://github.com/opentripplanner/OpenTripPlanner/pull/2996#discussion_r388170507", "createdAt": "2020-03-05T09:28:02Z", "author": {"login": "t2gran"}, "path": "src/main/java/org/opentripplanner/model/base/ToStringBuilder.java", "diffHunk": "@@ -92,27 +122,32 @@ public ToStringBuilder addDuration(String name, Integer durationSeconds) {\n \n     @Override\n     public String toString() {\n-        if(!unsetFields.isEmpty()) { addIt(\"NOT_SET\", unsetFields.toString()); }\n-        sb.append(\"}\");\n+        if(includeMetadata) {\n+            if(!unsetFields.isEmpty()) { addIt(\"NOT_SET\", unsetFields.toString()); }\n+            sb.append(\"}\");\n+        }\n         return sb.toString();\n     }\n \n-    private <T> ToStringBuilder addIfNotNull(String name, T value) {\n+    private <S> ToStringBuilder addIfNotNull(String name, S value) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "2382beb48e7ee0d06a7404e1a4736c0601c71499"}, "originalPosition": 82}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzY5NDE0MjU2", "url": "https://github.com/opentripplanner/OpenTripPlanner/pull/2996#pullrequestreview-369414256", "createdAt": "2020-03-05T09:33:01Z", "commit": {"oid": "2382beb48e7ee0d06a7404e1a4736c0601c71499"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wNVQwOTozMzowMVrOFyMOJQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wNVQwOTozMzowMVrOFyMOJQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4ODE3MzM0OQ==", "bodyText": "Rename exception", "url": "https://github.com/opentripplanner/OpenTripPlanner/pull/2996#discussion_r388173349", "createdAt": "2020-03-05T09:33:01Z", "author": {"login": "t2gran"}, "path": "src/main/java/org/opentripplanner/routing/algorithm/RoutingWorker.java", "diffHunk": "@@ -299,4 +301,21 @@ private double calculateDistanceMaxLimit() {\n \n         return limit;\n     }\n+\n+    private void verifyEgressAccess(\n+            RoutingRequest request,\n+            Map<?,?> access,\n+            Map<?,?> egress\n+    ) {\n+        boolean accessExist = !access.isEmpty();\n+        boolean egressExist = !egress.isEmpty();\n+\n+        if(accessExist && egressExist) { return; }\n+\n+        List<String> missingPlaces = new ArrayList<>();\n+        if(!accessExist) { missingPlaces.add(request.from.toString()); }\n+        if(!egressExist) { missingPlaces.add(request.to.toString()); }\n+\n+        throw new VertexNotFoundException(missingPlaces);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "2382beb48e7ee0d06a7404e1a4736c0601c71499"}, "originalPosition": 35}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzY5NDE3NjYz", "url": "https://github.com/opentripplanner/OpenTripPlanner/pull/2996#pullrequestreview-369417663", "createdAt": "2020-03-05T09:37:48Z", "commit": {"oid": "2382beb48e7ee0d06a7404e1a4736c0601c71499"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wNVQwOTozNzo0OVrOFyMYrg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wNVQwOTozNzo0OVrOFyMYrg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4ODE3NjA0Ng==", "bodyText": "Remove methods with default values", "url": "https://github.com/opentripplanner/OpenTripPlanner/pull/2996#discussion_r388176046", "createdAt": "2020-03-05T09:37:49Z", "author": {"login": "t2gran"}, "path": "src/test/java/org/opentripplanner/model/base/ValueObjectToStringBuilderTest.java", "diffHunk": "@@ -0,0 +1,133 @@\n+package org.opentripplanner.model.base;\n+\n+import org.junit.Test;\n+\n+import java.time.LocalDateTime;\n+import java.time.ZoneId;\n+import java.time.ZonedDateTime;\n+import java.util.Calendar;\n+import java.util.GregorianCalendar;\n+\n+import static org.junit.Assert.assertEquals;\n+\n+public class ValueObjectToStringBuilderTest {\n+    private enum  AEnum { A }\n+    private static class Foo {\n+        int a;\n+        String b;\n+\n+        public Foo(int a, String b) {\n+            this.a = a;\n+            this.b = b;\n+        }\n+\n+        @Override\n+        public String toString() {\n+            return ValueObjectToStringBuilder.of()\n+                    .addNum(a, 0)\n+                    .addStr(b)\n+                    .toString();\n+        }\n+    }\n+\n+    private ValueObjectToStringBuilder subject() { return ValueObjectToStringBuilder.of(); }\n+\n+    @Test\n+    public void addNum() {\n+        assertEquals(\"3.0\", subject().addNum(3.0000000d).toString());\n+        assertEquals(\"3.0\", subject().addNum(3.0000000f).toString());\n+        assertEquals(\"3\", subject().addNum(3).toString());\n+        assertEquals(\"3\", subject().addNum(3L).toString());\n+    }\n+\n+    @Test\n+    public void testAddNumWithDefaults() {\n+        assertEquals(\n+                \"3.0\",\n+                subject()\n+                        .addNum(4d, 4d)\n+                        .addNum(3d, 2d)\n+                        .addNum(-1d, -1d)\n+                        .toString()\n+        );", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "2382beb48e7ee0d06a7404e1a4736c0601c71499"}, "originalPosition": 52}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzY5Mzk2ODky", "url": "https://github.com/opentripplanner/OpenTripPlanner/pull/2996#pullrequestreview-369396892", "createdAt": "2020-03-05T09:08:42Z", "commit": {"oid": "9ccbb682eaa8f3d5b9dc93bf6be0db24c719b6ec"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wNVQwOTowODo0MlrOFyLY_w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wNVQwOTowODo0MlrOFyLY_w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4ODE1OTc0Mw==", "bodyText": "I would rename this to something like quietPeriodMilliseconds, because it doesn't ensure an update every M milliseconds, it silences updates for that long.", "url": "https://github.com/opentripplanner/OpenTripPlanner/pull/2996#discussion_r388159743", "createdAt": "2020-03-05T09:08:42Z", "author": {"login": "abyrd"}, "path": "src/main/java/org/opentripplanner/util/ProgressTracker.java", "diffHunk": "@@ -0,0 +1,47 @@\n+package org.opentripplanner.util;\n+\n+import java.util.function.BiConsumer;\n+\n+\n+/**\n+ * The progress tracker notify the caller based on 'time' and a 'counter'.\n+ * <p>\n+ * The 'counter' is used to notify the caller for each percent(1%) it the total number of\n+ * steps is more than 100. If the number steps is less than 100 the caller is notified every time.\n+ * <p>\n+ * To avoid the caller from being notified to often, the tracker also uses a 'timer'. The\n+ * 'timer' prevent notification unless a minimum amount of time is passed since last time the\n+ * caller was notified.\n+ * <p>\n+ * Both the 'counter' and the 'timer' constraint must pass for the caller to be notified.\n+ */\n+public class ProgressTracker {\n+    private final int dStep;\n+    private final int size;\n+    private final long notifyEveryMillisecond;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "9ccbb682eaa8f3d5b9dc93bf6be0db24c719b6ec"}, "originalPosition": 21}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "eac3796e6a6838d0a220583114a22b2772d6b2a6", "author": {"user": {"login": "t2gran", "name": "Thomas Gran"}}, "url": "https://github.com/opentripplanner/OpenTripPlanner/commit/eac3796e6a6838d0a220583114a22b2772d6b2a6", "committedDate": "2020-03-05T15:41:37Z", "message": "Code cleanup ToStringBuilder's."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "35a44f8fbe36c3c0cbafc1404f6f089aed8346df", "author": {"user": {"login": "t2gran", "name": "Thomas Gran"}}, "url": "https://github.com/opentripplanner/OpenTripPlanner/commit/35a44f8fbe36c3c0cbafc1404f6f089aed8346df", "committedDate": "2020-03-05T15:55:39Z", "message": "Review code cleanup:\n - fixed \"missingPlaces\" in routing response (to/from missing).\n - Revert change to Messages - this is a greater refactoring.\n - Cleanup ProgressTracker, static factory and field naming."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "d4d81b06cbb4c1d533bfe99da2e3c2500c3fe070", "author": {"user": {"login": "t2gran", "name": "Thomas Gran"}}, "url": "https://github.com/opentripplanner/OpenTripPlanner/commit/d4d81b06cbb4c1d533bfe99da2e3c2500c3fe070", "committedDate": "2020-03-05T15:56:15Z", "message": "Merge branch 'dev-2.x' into otp2_route_metadata_on_empty_result"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "044598213fdfba1329cc002f2612f753befe44c7", "author": {"user": {"login": "t2gran", "name": "Thomas Gran"}}, "url": "https://github.com/opentripplanner/OpenTripPlanner/commit/044598213fdfba1329cc002f2612f753befe44c7", "committedDate": "2020-03-09T18:51:29Z", "message": "Made ProgressTracker thread-safe and used in several places.\n - Track progress for Link Transit(stop, parking, area) linking to street network.\n - Track progress for Generate TripPattern geometries.\n - Track progress for Build street graph.\n - Track progress for Create transfer edges.\n - Track progress for Parse OSM (Relations, Ways, Nodes).\n - Close input stream when reading OSM files.\n - ProgressTracker, make it THREAD-SAFE.\n - ProgressTracker, add support for tracking input streams."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f58abe6e298d9f55c6b3679133654120db134901", "author": {"user": {"login": "t2gran", "name": "Thomas Gran"}}, "url": "https://github.com/opentripplanner/OpenTripPlanner/commit/f58abe6e298d9f55c6b3679133654120db134901", "committedDate": "2020-03-09T18:52:02Z", "message": "Merge branch 'otp2_route_metadata_on_empty_result' of https://github.com/entur/OpenTripPlanner into otp2_route_metadata_on_empty_result"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzcxODY4ODc3", "url": "https://github.com/opentripplanner/OpenTripPlanner/pull/2996#pullrequestreview-371868877", "createdAt": "2020-03-10T11:24:36Z", "commit": {"oid": "f58abe6e298d9f55c6b3679133654120db134901"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2074, "cost": 1, "resetAt": "2021-11-01T15:33:45Z"}}}