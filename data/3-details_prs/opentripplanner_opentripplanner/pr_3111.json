{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDM4NDkxOTUx", "number": 3111, "title": "Fixed arraysOutOfBounds exception when copying pattern geometries to \u2026", "bodyText": "\u2026new trip patterns\nTo be completed by pull request submitter:\n\n issue: This address the #3110 issue and fixes one part.\n roadmap: Check the roadmap for this feature or bug. If it is not already on the roadmap, PLC will discuss as part of the review process.\n tests: No new tests added\n formatting: Have you followed the suggested code style?\n documentation: If you are adding a new configuration option, have you added an explanation to the configuration documentation tables and sections?\n changelog: add a bullet point to the changelog file with description and link to the linked issue\n\nTo be completed by @opentripplanner/plc:\n\n reviews and approvals by 2 members, ideally from different organizations\n after merging: update the relevant card on the roadmap\n\nThis is a fix for a bug where you would get an ArrayIndexOutOfBoundsException when updating a TripPattern with a new pattern with a larger number of stops than the original. The error occurred when looping through the stops in order to reuse segments of the geometry on the new pattern.\nI have changed the number of loop iterations to be the smaller number of stops when looking at both the original and the new TripPattern.", "createdAt": "2020-06-23T10:58:09Z", "url": "https://github.com/opentripplanner/OpenTripPlanner/pull/3111", "merged": true, "mergeCommit": {"oid": "72f5e0121da3dda442afe21405cb70ea21eef935"}, "closed": true, "closedAt": "2020-08-27T08:44:42Z", "author": {"login": "gmellemstrand"}, "timelineItems": {"totalCount": 7, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcuDOnugH2gAyNDM4NDkxOTUxOjg0NTM3NTY4Mzg0MTg0MTEwMjNkM2RjZWM0MmMyMzA3ZjM3MzAxYjI=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdC8WVbgH2gAyNDM4NDkxOTUxOmE0OTQ0M2IwZTY2ZTVkMGFjOWRlNDNmY2ExOTNlYmRiNGIwZDE1MzY=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "8453756838418411023d3dcec42c2307f37301b2", "author": {"user": {"login": "gmellemstrand", "name": null}}, "url": "https://github.com/opentripplanner/OpenTripPlanner/commit/8453756838418411023d3dcec42c2307f37301b2", "committedDate": "2020-06-23T10:52:17Z", "message": "Fixed arraysOutOfBounds exception when copying pattern geometries to new trip patterns"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDc0MzI5MTY1", "url": "https://github.com/opentripplanner/OpenTripPlanner/pull/3111#pullrequestreview-474329165", "createdAt": "2020-08-25T10:04:02Z", "commit": {"oid": "8453756838418411023d3dcec42c2307f37301b2"}, "state": "DISMISSED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yNVQxMDowNDowMlrOHGRBRQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yNVQxMDowNDowMlrOHGRBRQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NjMzMjM1Nw==", "bodyText": "Should be sufficient to just add a comment here explaining why a length mismatch would occur (realtime update adding stops) and clarifying that this will only preserve geometry up to the added stop, at which point it will fall back on straight lines.", "url": "https://github.com/opentripplanner/OpenTripPlanner/pull/3111#discussion_r476332357", "createdAt": "2020-08-25T10:04:02Z", "author": {"login": "abyrd"}, "path": "src/main/java/org/opentripplanner/model/TripPattern.java", "diffHunk": "@@ -159,7 +159,11 @@ public void setHopGeometry(int i, LineString hopGeometry) {\n      */\n     public void setHopGeometriesFromPattern(TripPattern other) {\n         this.hopGeometries = new byte[this.getStops().size() - 1][];\n-        for (int i = 0; i < other.getStops().size() - 1; i++) {\n+\n+        // Gets the size of the shortest of the two trip patterns\n+        int sizeOfShortestPattern = Math.min(this.getStops().size(), other.getStops().size());", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "8453756838418411023d3dcec42c2307f37301b2"}, "originalPosition": 7}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "882cb57093129b1e09228bb7af4cf5828be3cb92", "author": {"user": {"login": "abyrd", "name": "Andrew Byrd"}}, "url": "https://github.com/opentripplanner/OpenTripPlanner/commit/882cb57093129b1e09228bb7af4cf5828be3cb92", "committedDate": "2020-08-25T10:04:45Z", "message": "Merge branch 'dev-2.x' into otp2_copy_geometry_bugfix"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b06e239f1fba9219d6773ad69c97e4b31f26cc00", "author": {"user": {"login": "gmellemstrand", "name": null}}, "url": "https://github.com/opentripplanner/OpenTripPlanner/commit/b06e239f1fba9219d6773ad69c97e4b31f26cc00", "committedDate": "2020-08-25T11:56:14Z", "message": "Correctly add GroupOfLines"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b876436f76fef546502eafcf891a7fd78e33a11a", "author": {"user": {"login": "gmellemstrand", "name": null}}, "url": "https://github.com/opentripplanner/OpenTripPlanner/commit/b876436f76fef546502eafcf891a7fd78e33a11a", "committedDate": "2020-08-25T12:09:47Z", "message": "Add comment"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "65dda1b7da0765daee5a64d8ec348ede67a36848", "author": {"user": {"login": "gmellemstrand", "name": null}}, "url": "https://github.com/opentripplanner/OpenTripPlanner/commit/65dda1b7da0765daee5a64d8ec348ede67a36848", "committedDate": "2020-08-25T12:10:06Z", "message": "Merge branch 'dev-2.x' into otp2_copy_geometry_bugfix"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a49443b0e66e5d0ac9de43fca193ebdb4b0d1536", "author": {"user": {"login": "gmellemstrand", "name": null}}, "url": "https://github.com/opentripplanner/OpenTripPlanner/commit/a49443b0e66e5d0ac9de43fca193ebdb4b0d1536", "committedDate": "2020-08-27T08:43:47Z", "message": "Merge branch 'dev-2.x' into otp2_copy_geometry_bugfix"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2147, "cost": 1, "resetAt": "2021-11-01T15:33:45Z"}}}