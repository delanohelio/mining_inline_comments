{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDM4Mzc2NjY2", "number": 3109, "title": "Move debug timing to RoutingWorker and adapt to OTP2 routing phases", "bodyText": "This makes DebugOutput use the new routing phases in OTP2, and updates their calculation. Previously a time of 0ms was reported for everything, as the DebugOutput object was not used in the routing worker.\nTo be completed by pull request submitter:\n\n issue: Link to or create an issue that describes the relevant feature or bug. Add GitHub keywords to this PR's description (e.g., closes #45).\n roadmap: Check the roadmap for this feature or bug. If it is not already on the roadmap, PLC will discuss as part of the review process.\n tests: Have you added relevant test coverage? Are all the tests passing on the continuous integration service (Travis CI)?\n formatting: Have you followed the suggested code style?\n documentation: If you are adding a new configuration option, have you added an explanation to the configuration documentation tables and sections?\n changelog: add a bullet point to the changelog file with description and link to the linked issue\n\nTo be completed by @opentripplanner/plc:\n\n reviews and approvals by 2 members, ideally from different organizations\n after merging: update the relevant card on the roadmap", "createdAt": "2020-06-23T07:30:25Z", "url": "https://github.com/opentripplanner/OpenTripPlanner/pull/3109", "merged": true, "mergeCommit": {"oid": "e54dcc93eb201e8312f59709088eabb275b2591a"}, "closed": true, "closedAt": "2020-08-04T20:00:57Z", "author": {"login": "hannesj"}, "timelineItems": {"totalCount": 12, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcuAdY9ABqjM0NzE1NzQ5MDg=", "endCursor": "Y3Vyc29yOnYyOpPPAAABc7ndtrAFqTQ2MDg2NjI1Ng==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "d517249a8dbf9a33eac4cbffebc5983df0a566da", "author": {"user": {"login": "hannesj", "name": "Hannes Junnila"}}, "url": "https://github.com/opentripplanner/OpenTripPlanner/commit/d517249a8dbf9a33eac4cbffebc5983df0a566da", "committedDate": "2020-06-16T11:11:22Z", "message": "Move timing debug to RoutingWorker"}, "afterCommit": {"oid": "2a5a93c5bf5fa1bdb7d4896083adaae501c450c7", "author": {"user": {"login": "hannesj", "name": "Hannes Junnila"}}, "url": "https://github.com/opentripplanner/OpenTripPlanner/commit/2a5a93c5bf5fa1bdb7d4896083adaae501c450c7", "committedDate": "2020-06-23T07:38:16Z", "message": "Documentation"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "2a5a93c5bf5fa1bdb7d4896083adaae501c450c7", "author": {"user": {"login": "hannesj", "name": "Hannes Junnila"}}, "url": "https://github.com/opentripplanner/OpenTripPlanner/commit/2a5a93c5bf5fa1bdb7d4896083adaae501c450c7", "committedDate": "2020-06-23T07:38:16Z", "message": "Documentation"}, "afterCommit": {"oid": "8c1e665c459cb8b14ca7c778a3687ed43e28e07a", "author": {"user": {"login": "hannesj", "name": "Hannes Junnila"}}, "url": "https://github.com/opentripplanner/OpenTripPlanner/commit/8c1e665c459cb8b14ca7c778a3687ed43e28e07a", "committedDate": "2020-06-23T07:42:25Z", "message": "Documentation"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDM3NDU1NzE2", "url": "https://github.com/opentripplanner/OpenTripPlanner/pull/3109#pullrequestreview-437455716", "createdAt": "2020-06-25T12:46:01Z", "commit": {"oid": "7f1248ebb486f10022e33595d2524072692f2cb7"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yNVQxMjo0NjowMVrOGo49nA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yNVQxMjo1MDoyNlrOGo5HsA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NTUyOTUwMA==", "bodyText": "This could be final", "url": "https://github.com/opentripplanner/OpenTripPlanner/pull/3109#discussion_r445529500", "createdAt": "2020-06-25T12:46:01Z", "author": {"login": "t2gran"}, "path": "src/main/java/org/opentripplanner/routing/algorithm/RoutingWorker.java", "diffHunk": "@@ -49,6 +50,9 @@\n \n     private final RaptorService<TripSchedule> raptorService;\n \n+    /** An object that accumulates profiling and debugging info for inclusion in the response. */\n+    public DebugOutput debugOutput = new DebugOutput();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "7f1248ebb486f10022e33595d2524072692f2cb7"}, "originalPosition": 12}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NTUzMjA4MA==", "bodyText": "We should probably encapsulate the timing into the DebugOutput class. The debug log statement can be removed , I forgot to take it away after making sure the itineraries filtering is not using any time. We could also move the logging inside the DebugOutput, so turning that logger on/off will give you performance logging. Also, maybe split the DebugOutput into a Service (DebugAggregator) and a DTO DebugOutput.", "url": "https://github.com/opentripplanner/OpenTripPlanner/pull/3109#discussion_r445532080", "createdAt": "2020-06-25T12:50:26Z", "author": {"login": "t2gran"}, "path": "src/main/java/org/opentripplanner/routing/algorithm/RoutingWorker.java", "diffHunk": "@@ -111,22 +124,24 @@ public RoutingResponse route(Router router) {\n                 request.rctx.bannedRoutes,\n                 request.walkSpeed\n         );\n-        LOG.debug(\"Filtering tripPatterns took {} ms\", System.currentTimeMillis() - startTime);\n+        long tripPatternFilterTime = System.currentTimeMillis() - startTime;\n+        this.debugOutput.transitRouterTimes.tripPatternFilterTime = tripPatternFilterTime;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "7f1248ebb486f10022e33595d2524072692f2cb7"}, "originalPosition": 65}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f5d05b004256a8b82e10ed42cf420bc3ed8dfdb7", "author": {"user": {"login": "hannesj", "name": "Hannes Junnila"}}, "url": "https://github.com/opentripplanner/OpenTripPlanner/commit/f5d05b004256a8b82e10ed42cf420bc3ed8dfdb7", "committedDate": "2020-07-06T11:16:04Z", "message": "Move timing debug to RoutingWorker"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "fe09c25412b58e2e599e0fbbe276a5340717b00a", "author": {"user": {"login": "hannesj", "name": "Hannes Junnila"}}, "url": "https://github.com/opentripplanner/OpenTripPlanner/commit/fe09c25412b58e2e599e0fbbe276a5340717b00a", "committedDate": "2020-07-06T11:16:04Z", "message": "move time to variables"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c1266368a663ed78dddbf75a652cc3cfb6c57e63", "author": {"user": {"login": "hannesj", "name": "Hannes Junnila"}}, "url": "https://github.com/opentripplanner/OpenTripPlanner/commit/c1266368a663ed78dddbf75a652cc3cfb6c57e63", "committedDate": "2020-07-06T11:16:42Z", "message": "Documentation"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "d2ed0de91944d1a81148579a2db888aedf457886", "author": {"user": {"login": "hannesj", "name": "Hannes Junnila"}}, "url": "https://github.com/opentripplanner/OpenTripPlanner/commit/d2ed0de91944d1a81148579a2db888aedf457886", "committedDate": "2020-07-06T11:16:42Z", "message": "Split DebugOutput into service and DTO classes"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "7f1248ebb486f10022e33595d2524072692f2cb7", "author": {"user": {"login": "hannesj", "name": "Hannes Junnila"}}, "url": "https://github.com/opentripplanner/OpenTripPlanner/commit/7f1248ebb486f10022e33595d2524072692f2cb7", "committedDate": "2020-06-25T08:22:50Z", "message": "Merge branch 'dev-2.x' into debug-output"}, "afterCommit": {"oid": "d2ed0de91944d1a81148579a2db888aedf457886", "author": {"user": {"login": "hannesj", "name": "Hannes Junnila"}}, "url": "https://github.com/opentripplanner/OpenTripPlanner/commit/d2ed0de91944d1a81148579a2db888aedf457886", "committedDate": "2020-07-06T11:16:42Z", "message": "Split DebugOutput into service and DTO classes"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDU4MzU3NDgw", "url": "https://github.com/opentripplanner/OpenTripPlanner/pull/3109#pullrequestreview-458357480", "createdAt": "2020-07-30T12:36:40Z", "commit": {"oid": "d2ed0de91944d1a81148579a2db888aedf457886"}, "state": "DISMISSED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0zMFQxMjozNjo0MFrOG5hG-Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0zMFQxMjozODoyN1rOG5hKhQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2Mjk2NDQ3Mw==", "bodyText": "Need JavaDoc", "url": "https://github.com/opentripplanner/OpenTripPlanner/pull/3109#discussion_r462964473", "createdAt": "2020-07-30T12:36:40Z", "author": {"login": "t2gran"}, "path": "src/main/java/org/opentripplanner/api/resource/TransitTimingOutput.java", "diffHunk": "@@ -0,0 +1,20 @@\n+package org.opentripplanner.api.resource;\n+\n+public class TransitTimingOutput {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d2ed0de91944d1a81148579a2db888aedf457886"}, "originalPosition": 3}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2Mjk2NTM4MQ==", "bodyText": "JavaDoc", "url": "https://github.com/opentripplanner/OpenTripPlanner/pull/3109#discussion_r462965381", "createdAt": "2020-07-30T12:38:27Z", "author": {"login": "t2gran"}, "path": "src/main/java/org/opentripplanner/routing/framework/DebugAggregator.java", "diffHunk": "@@ -0,0 +1,122 @@\n+package org.opentripplanner.routing.framework;\n+\n+import org.opentripplanner.api.resource.DebugOutput;\n+import org.opentripplanner.api.resource.TransitTimingOutput;\n+import org.slf4j.Logger;\n+import org.slf4j.LoggerFactory;\n+\n+public class DebugAggregator {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d2ed0de91944d1a81148579a2db888aedf457886"}, "originalPosition": 8}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "745adcb2a5ec81b69c96aeb4cd7a6842c3ca75c2", "author": {"user": {"login": "hannesj", "name": "Hannes Junnila"}}, "url": "https://github.com/opentripplanner/OpenTripPlanner/commit/745adcb2a5ec81b69c96aeb4cd7a6842c3ca75c2", "committedDate": "2020-08-04T11:19:37Z", "message": "Merge branch 'dev-2.x' of github.com:opentripplanner/OpenTripPlanner into debug-output"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "d4e836dd503cdcf215657b0f032e1aa404669bc5", "author": {"user": {"login": "hannesj", "name": "Hannes Junnila"}}, "url": "https://github.com/opentripplanner/OpenTripPlanner/commit/d4e836dd503cdcf215657b0f032e1aa404669bc5", "committedDate": "2020-08-04T11:56:53Z", "message": "Add javadoc"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDYwODY2MjU2", "url": "https://github.com/opentripplanner/OpenTripPlanner/pull/3109#pullrequestreview-460866256", "createdAt": "2020-08-04T14:26:22Z", "commit": {"oid": "d4e836dd503cdcf215657b0f032e1aa404669bc5"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2144, "cost": 1, "resetAt": "2021-11-01T15:33:45Z"}}}