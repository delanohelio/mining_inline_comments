{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0MzgwODI3NzAw", "number": 2988, "title": "Copy geometries from previous TripPattern when doing real-time updates", "bodyText": "To be completed by pull request submitter:\n\n issue: #2987\n roadmap: Check the roadmap for this feature or bug. If it is not already on the roadmap, PLC will discuss as part of the review process.\n tests: Have you added relevant test coverage? Are all the tests passing on the continuous integration service (Travis CI)?\n formatting: Have you followed the suggested code style?\n documentation: If you are adding a new configuration option, have you added an explanation to the configuration documentation tables and sections?\n changelog: add a bullet point to the changelog file with description and link to the linked issue\n\nTo be completed by @opentripplanner/plc:\n\n reviews and approvals by 2 members, ideally from different organizations\n after merging: update the relevant card on the roadmap\n\nThis adds a methods to the TripPattern class that will copy the geometry from another TripPattern to the current one. It checks if each hop is between the same stops before copying that hop geometry. If the stops are different, a straight-line hop-geometry will be used instead.\nThis method is called in the TripPatternCache.getOrCreateTripPattern and SiriTripPatternCache.getOrCreateTripPattern method in order to copy the geometries when a TripPattern is replaced by another.", "createdAt": "2020-02-27T12:40:27Z", "url": "https://github.com/opentripplanner/OpenTripPlanner/pull/2988", "merged": true, "mergeCommit": {"oid": "9dfaf499efdc1fa5dcfa2140af6db5f378a1a346"}, "closed": true, "closedAt": "2020-03-05T08:39:09Z", "author": {"login": "gmellemstrand"}, "timelineItems": {"totalCount": 6, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcIaPa1gH2gAyMzgwODI3NzAwOmJiZWNlYjAzNDQ4YTFmZTQ1OTEzMjU5MjU5ZjE2Y2RmZWJkYmMwZWQ=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcKnX3AgFqTM2OTM3NzExMw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "bbeceb03448a1fe45913259259f16cdfebdbc0ed", "author": {"user": {"login": "gmellemstrand", "name": null}}, "url": "https://github.com/opentripplanner/OpenTripPlanner/commit/bbeceb03448a1fe45913259259f16cdfebdbc0ed", "committedDate": "2020-02-27T12:11:51Z", "message": "Copy geometries from previous TripPattern when doing real-time updates"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "9db4dff840021bb25db021e5a89e31e1999190db", "author": {"user": {"login": "gmellemstrand", "name": null}}, "url": "https://github.com/opentripplanner/OpenTripPlanner/commit/9db4dff840021bb25db021e5a89e31e1999190db", "committedDate": "2020-02-27T12:36:57Z", "message": "Added changelog entry"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzY3ODU2NDI2", "url": "https://github.com/opentripplanner/OpenTripPlanner/pull/2988#pullrequestreview-367856426", "createdAt": "2020-03-03T10:20:19Z", "commit": {"oid": "9db4dff840021bb25db021e5a89e31e1999190db"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wM1QxMDoyMDoxOVrOFw_3pA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wM1QxMDoyMTozN1rOFw_6mA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NjkyMjQwNA==", "bodyText": "Annotate the trip parameter here and on Siri trip pattern cache with @NotNull", "url": "https://github.com/opentripplanner/OpenTripPlanner/pull/2988#discussion_r386922404", "createdAt": "2020-03-03T10:20:19Z", "author": {"login": "abyrd"}, "path": "src/main/java/org/opentripplanner/updater/stoptime/TripPatternCache.java", "diffHunk": "@@ -28,12 +29,13 @@\n      * and edges for this trip pattern are also created in the graph.\n      * \n      * @param stopPattern stop pattern to retrieve/create trip pattern\n-     * @param route route of new trip pattern in case a new trip pattern will be created\n+     * @param trip the trip the new trip pattern will be created for\n      * @param graph graph to add vertices and edges in case a new trip pattern will be created\n      * @return cached or newly created trip pattern\n      */\n     public synchronized TripPattern getOrCreateTripPattern(final StopPattern stopPattern,\n-            final Route route, final Graph graph) {\n+            final Trip trip, final Graph graph) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "9db4dff840021bb25db021e5a89e31e1999190db"}, "originalPosition": 19}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NjkyMzE2MA==", "bodyText": "rename this method, \"previous\" has a time or sequence connotation. The method is general enough that it could be setHopGeometriesFromTripPattern.", "url": "https://github.com/opentripplanner/OpenTripPlanner/pull/2988#discussion_r386923160", "createdAt": "2020-03-03T10:21:37Z", "author": {"login": "abyrd"}, "path": "src/main/java/org/opentripplanner/model/TripPattern.java", "diffHunk": "@@ -155,6 +155,35 @@ public void setHopGeometry(int i, LineString hopGeometry) {\n         this.hopGeometries[i] = CompactLineString.compactLineString(hopGeometry,false);\n     }\n \n+    /**\n+     * This will copy the geometry from another TripPattern to this one. It checks if each hop is\n+     * between the same stops before copying that hop geometry. If the stops are different, a\n+     * straight-line hop-geometry will be used instead.\n+     *\n+     * @param other TripPattern to copy geometry from\n+     */\n+    public void setHopGeometriesFromPreviousTripPattern(TripPattern other) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "9db4dff840021bb25db021e5a89e31e1999190db"}, "originalPosition": 11}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "7361e1ed44713895361344c098c80c72397cc0a5", "author": {"user": {"login": "gmellemstrand", "name": null}}, "url": "https://github.com/opentripplanner/OpenTripPlanner/commit/7361e1ed44713895361344c098c80c72397cc0a5", "committedDate": "2020-03-03T12:30:15Z", "message": "Rename method setHopGeometriesFromPattern"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "764b27682b6b4238ae84b6fdd39439e6476b298d", "author": {"user": {"login": "gmellemstrand", "name": null}}, "url": "https://github.com/opentripplanner/OpenTripPlanner/commit/764b27682b6b4238ae84b6fdd39439e6476b298d", "committedDate": "2020-03-03T12:32:28Z", "message": "Annotate parameters in TripPatternCache and SiriTripPatternCache with NotNull"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzY5Mzc3MTEz", "url": "https://github.com/opentripplanner/OpenTripPlanner/pull/2988#pullrequestreview-369377113", "createdAt": "2020-03-05T08:37:41Z", "commit": {"oid": "764b27682b6b4238ae84b6fdd39439e6476b298d"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2063, "cost": 1, "resetAt": "2021-11-01T15:33:45Z"}}}