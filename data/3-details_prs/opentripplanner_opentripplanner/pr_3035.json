{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDA0MzY3Nzcw", "number": 3035, "title": "Make agency id feed scoped", "bodyText": "This pull request aims to make the agency id feed scoped, similar to how all the other transit entities are. The reason for the previous behaviour is due to the OBA GTFS models, which were previously used as the internal model for all transit entities in OTP, and for which the agency id was only a string. As we have copied over the models to internal models, we have the freedom to change them.\nA comment in the code suggest that this is a temporary hack, and should be fixed. Another reason for fixing this, is that the HSLDevcom GraphQL API has the agencies as feed scoped, and when porting over the api to a sandbox feature, we need to somehow make the agencies feed aware. Another less invasive alternative, would be just writing the feed in a separate field in the agency object.\nThis is a breaking change, as the api responses for the agency will now include the feed id, as they do with all the other transit entities. Similarly for input parameter for banned and preferred agencies, the feed id is now required in similar format to how it is output.\nTo be completed by pull request submitter:\n\n issue: This issue is described in the code as a todo\n roadmap: Check the roadmap for this feature or bug. If it is not already on the roadmap, PLC will discuss as part of the review process.\n tests: Have you added relevant test coverage? Are all the tests passing on the continuous integration service (Travis CI)?\n formatting: Have you followed the suggested code style?\n documentation: If you are adding a new configuration option, have you added an explanation to the configuration documentation tables and sections?\n changelog: add a bullet point to the changelog file with description and link to the linked issue\n\nTo be completed by @opentripplanner/plc:\n\n reviews and approvals by 2 members, ideally from different organizations\n after merging: update the relevant card on the roadmap", "createdAt": "2020-04-16T13:24:08Z", "url": "https://github.com/opentripplanner/OpenTripPlanner/pull/3035", "merged": true, "mergeCommit": {"oid": "d332745b81bcb679cd973051c467943b72963cd3"}, "closed": true, "closedAt": "2020-04-23T08:58:26Z", "author": {"login": "hannesj"}, "timelineItems": {"totalCount": 14, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcYlh7wgBqjMyNDU1MDMzOTQ=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcaY5GOAFqTM5ODg4OTYyMQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "ffe293b03778d3afa69d6cb6336b84bb4512d8c9", "author": {"user": {"login": "hannesj", "name": "Hannes Junnila"}}, "url": "https://github.com/opentripplanner/OpenTripPlanner/commit/ffe293b03778d3afa69d6cb6336b84bb4512d8c9", "committedDate": "2020-04-16T13:13:18Z", "message": "Make agency id feed scoped"}, "afterCommit": {"oid": "8d27442e8c74f5ae1c4ff0bf911fecaf4e4160e5", "author": {"user": {"login": "hannesj", "name": "Hannes Junnila"}}, "url": "https://github.com/opentripplanner/OpenTripPlanner/commit/8d27442e8c74f5ae1c4ff0bf911fecaf4e4160e5", "committedDate": "2020-04-17T18:05:53Z", "message": "Make agency id feed scoped"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "11ee0398a8300b72654c47c8cc25b8edeba4f6a8", "author": {"user": {"login": "hannesj", "name": "Hannes Junnila"}}, "url": "https://github.com/opentripplanner/OpenTripPlanner/commit/11ee0398a8300b72654c47c8cc25b8edeba4f6a8", "committedDate": "2020-04-20T11:12:07Z", "message": "Add changelog + migration entries"}, "afterCommit": {"oid": "9a24e2d917ddeff475af7151ee2d820c5c284d87", "author": {"user": {"login": "hannesj", "name": "Hannes Junnila"}}, "url": "https://github.com/opentripplanner/OpenTripPlanner/commit/9a24e2d917ddeff475af7151ee2d820c5c284d87", "committedDate": "2020-04-21T08:30:22Z", "message": "Add changelog + migration entries"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzk3OTQyMTE4", "url": "https://github.com/opentripplanner/OpenTripPlanner/pull/3035#pullrequestreview-397942118", "createdAt": "2020-04-22T08:06:12Z", "commit": {"oid": "5d07ca52cd4e45b8094a3aa8fea95a4f428b71cc"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yMlQwODowNjoxMlrOGJpHwg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yMlQwODowNjoxMlrOGJpHwg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMjc2NDA5OA==", "bodyText": "This is repeated several times.  I suggest making a static parse function in the FeedScopedId.", "url": "https://github.com/opentripplanner/OpenTripPlanner/pull/3035#discussion_r412764098", "createdAt": "2020-04-22T08:06:12Z", "author": {"login": "t2gran"}, "path": "src/main/java/org/opentripplanner/routing/request/RoutingRequest.java", "diffHunk": "@@ -820,7 +820,12 @@ public void setBikeBoardCost(int bikeBoardCost) {\n     public void setPreferredAgencies(String s) {\n         if (!s.isEmpty()) {\n             preferredAgencies = new HashSet<>();\n-            Collections.addAll(preferredAgencies, s.split(\",\"));\n+            Collections.addAll(\n+                preferredAgencies,\n+                Arrays.stream(s.split(\",\"))\n+                    .map(FeedScopedId::convertFromString)\n+                    .toArray(FeedScopedId[]::new)\n+            );", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "5d07ca52cd4e45b8094a3aa8fea95a4f428b71cc"}, "originalPosition": 41}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "dabe10f0924bd420489061e6ecdc4a6bb5afd117", "author": {"user": {"login": "hannesj", "name": "Hannes Junnila"}}, "url": "https://github.com/opentripplanner/OpenTripPlanner/commit/dabe10f0924bd420489061e6ecdc4a6bb5afd117", "committedDate": "2020-04-22T13:40:52Z", "message": "Make agency id feed scoped"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "3fdb08f51abc0eaed2692ce4109ea121ead07d7e", "author": {"user": {"login": "hannesj", "name": "Hannes Junnila"}}, "url": "https://github.com/opentripplanner/OpenTripPlanner/commit/3fdb08f51abc0eaed2692ce4109ea121ead07d7e", "committedDate": "2020-04-22T13:40:52Z", "message": "Expose all ids as strings in the API"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "5cf6226c5ee66c2905ffd66d6b7dd38bdecdad59", "author": {"user": {"login": "hannesj", "name": "Hannes Junnila"}}, "url": "https://github.com/opentripplanner/OpenTripPlanner/commit/5cf6226c5ee66c2905ffd66d6b7dd38bdecdad59", "committedDate": "2020-04-22T13:42:31Z", "message": "Add changelog + migration entries"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "09792700539f9fc2cb36fea056d858ed77e73020", "author": {"user": {"login": "hannesj", "name": "Hannes Junnila"}}, "url": "https://github.com/opentripplanner/OpenTripPlanner/commit/09792700539f9fc2cb36fea056d858ed77e73020", "committedDate": "2020-04-22T13:42:31Z", "message": "Add a utility method from converting from a string to a set of feed scoped ids"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "5d07ca52cd4e45b8094a3aa8fea95a4f428b71cc", "author": {"user": {"login": "hannesj", "name": "Hannes Junnila"}}, "url": "https://github.com/opentripplanner/OpenTripPlanner/commit/5d07ca52cd4e45b8094a3aa8fea95a4f428b71cc", "committedDate": "2020-04-21T11:14:52Z", "message": "Merge branch 'dev-2.x' into agency-feed-id"}, "afterCommit": {"oid": "09792700539f9fc2cb36fea056d858ed77e73020", "author": {"user": {"login": "hannesj", "name": "Hannes Junnila"}}, "url": "https://github.com/opentripplanner/OpenTripPlanner/commit/09792700539f9fc2cb36fea056d858ed77e73020", "committedDate": "2020-04-22T13:42:31Z", "message": "Add a utility method from converting from a string to a set of feed scoped ids"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzk4NDA5Njg3", "url": "https://github.com/opentripplanner/OpenTripPlanner/pull/3035#pullrequestreview-398409687", "createdAt": "2020-04-22T17:20:57Z", "commit": {"oid": "09792700539f9fc2cb36fea056d858ed77e73020"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yMlQxNzoyMDo1OFrOGKB7fA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yMlQxNzoyMDo1OFrOGKB7fA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMzE3MDU1Ng==", "bodyText": "I would call this function convertFromListOfIds or parseListOfIds. I prefer parseoverconvert`, but we already used convert for the single element version, so it should be consistent.", "url": "https://github.com/opentripplanner/OpenTripPlanner/pull/3035#discussion_r413170556", "createdAt": "2020-04-22T17:20:58Z", "author": {"login": "t2gran"}, "path": "src/main/java/org/opentripplanner/model/FeedScopedId.java", "diffHunk": "@@ -105,4 +108,14 @@ public static String convertToString(FeedScopedId aid) {\n     public static String concatenateId(String feedId, String id) {\n         return feedId + ID_SEPARATOR + id;\n     }\n+\n+    /**\n+     * Converts a string consisting of concatenated FeedScopedIds to a Set\n+     */\n+    public static HashSet<FeedScopedId> convertFromConcatenatedString(String s) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "09792700539f9fc2cb36fea056d858ed77e73020"}, "originalPosition": 18}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "27dde83a84a3fb5415ce2d19cc7499cd2a747d19", "author": {"user": {"login": "hannesj", "name": "Hannes Junnila"}}, "url": "https://github.com/opentripplanner/OpenTripPlanner/commit/27dde83a84a3fb5415ce2d19cc7499cd2a747d19", "committedDate": "2020-04-23T08:06:38Z", "message": "Rename from convert to parse in FeedScopedId"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c61d7d3b9e3302a0718be9ca493ffc4d66b1fcfb", "author": {"user": {"login": "hannesj", "name": "Hannes Junnila"}}, "url": "https://github.com/opentripplanner/OpenTripPlanner/commit/c61d7d3b9e3302a0718be9ca493ffc4d66b1fcfb", "committedDate": "2020-04-23T08:34:46Z", "message": "Update javadoc to match reality"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzk4ODg3MzQ1", "url": "https://github.com/opentripplanner/OpenTripPlanner/pull/3035#pullrequestreview-398887345", "createdAt": "2020-04-23T08:45:26Z", "commit": {"oid": "c61d7d3b9e3302a0718be9ca493ffc4d66b1fcfb"}, "state": "DISMISSED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "09afb56a9e9c9d9b3af796f32d78d0d0cd0e7a46", "author": {"user": {"login": "hannesj", "name": "Hannes Junnila"}}, "url": "https://github.com/opentripplanner/OpenTripPlanner/commit/09afb56a9e9c9d9b3af796f32d78d0d0cd0e7a46", "committedDate": "2020-04-23T08:47:34Z", "message": "Merge branch 'dev-2.x' into agency-feed-id"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzk4ODg5NjIx", "url": "https://github.com/opentripplanner/OpenTripPlanner/pull/3035#pullrequestreview-398889621", "createdAt": "2020-04-23T08:48:12Z", "commit": {"oid": "09afb56a9e9c9d9b3af796f32d78d0d0cd0e7a46"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2098, "cost": 1, "resetAt": "2021-11-01T15:33:45Z"}}}