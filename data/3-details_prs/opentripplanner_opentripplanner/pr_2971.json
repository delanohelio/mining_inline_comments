{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0MzczNjMyODg5", "number": 2971, "title": "FL_3 - Otp2 filter results - Filter chain, walk/wait reluctance, debug", "bodyText": "This PR implement a dynamic filter-chain. The filter-chain is configured based on the request and the response. It is able to:\n\nFilter away itineraries which start after the latest-departure-time (earliest-departure-time minus search-window). A depart after search produces poor results at the end of the search window and when the access leg is time-shifted the departure fall outside of the time window. This filter remove these itineraries. They will be part of the \"next\" window if they are pareto-optimal.\nGroup itineraries by the p% longest legs and filter away the itineraries with the lowest generalized cost.\nThe request parameter \"numItineraries\" is used to define a maximum limit of itineraries returned.\nThere is a sort filter - sorting on [NonTransit|Transit], arrival-time (acc), departure-time(dec).\nDebugging filters is supported. If the request debugItineraryFilter is true, then the filters do NOT delete itineraries, instead the itineraries is marked as deleted debugMarkedAsDeleted and a alert is added to the first leg and the second(if the first is walking).\n\nThis PR also include a minor bugfix in the style.css (OTP client).\nThis PR build on top of FL_1 #2970.\n\n\n issue: Close #2936\n\n\n roadmap: No.\n\n\n tests: Some test on new mapping code added.\n\n\n formatting: Yes.\n\n\n documentation: No.\n\n\n changelog: No.\nTo be completed by @opentripplanner/plc:\n\n\n reviews and approvals by 2 members, ideally from different organizations\n\n\n after merging: update the relevant card on the roadmap", "createdAt": "2020-02-11T12:31:20Z", "url": "https://github.com/opentripplanner/OpenTripPlanner/pull/2971", "merged": true, "mergeCommit": {"oid": "447d3c6b235a01b43eaf0500cf18fe17caf84763"}, "closed": true, "closedAt": "2020-02-14T10:42:42Z", "author": {"login": "t2gran"}, "timelineItems": {"totalCount": 16, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcDQ01rgH2gAyMzczNjMyODg5OjRjNDY3MjNkYmVhMzZjMDAxYTFjZTZmMTI4Y2Q2ZGQ3MWU2ZjgyZDk=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcENJAdgFqTM1ODg1MzAyNA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "4c46723dbea36c001a1ce6f128cd6dd71e6f82d9", "author": {"user": {"login": "t2gran", "name": "Thomas Gran"}}, "url": "https://github.com/opentripplanner/OpenTripPlanner/commit/4c46723dbea36c001a1ce6f128cd6dd71e6f82d9", "committedDate": "2020-02-11T12:24:03Z", "message": "WalkReluctance & WaitReluctance supported, and fix cost equals \"transit second cost\" in OTP domain(not in raptor). Set default board cost to 10 minutes."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c7df735316135fa4e65555951a2384f1bf455102", "author": {"user": {"login": "t2gran", "name": "Thomas Gran"}}, "url": "https://github.com/opentripplanner/OpenTripPlanner/commit/c7df735316135fa4e65555951a2384f1bf455102", "committedDate": "2020-02-11T12:24:03Z", "message": "Bugfix int style.css in OTP client."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "04bc986e3abd03c71ae748b593fdbe98cecbd0a9", "author": {"user": {"login": "t2gran", "name": "Thomas Gran"}}, "url": "https://github.com/opentripplanner/OpenTripPlanner/commit/04bc986e3abd03c71ae748b593fdbe98cecbd0a9", "committedDate": "2020-02-11T12:24:03Z", "message": "Implement a working filter-chain."}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "7b93b01df6a55290dafa6028d959be958d990cc6", "author": {"user": {"login": "t2gran", "name": "Thomas Gran"}}, "url": "https://github.com/opentripplanner/OpenTripPlanner/commit/7b93b01df6a55290dafa6028d959be958d990cc6", "committedDate": "2020-02-11T12:24:03Z", "message": "Enable debug for filter-chain - returning all itineraries, just mark deleted once."}, "afterCommit": {"oid": "aa05398de164b2b5d24426c9e0d13fee6a1496d5", "author": {"user": {"login": "t2gran", "name": "Thomas Gran"}}, "url": "https://github.com/opentripplanner/OpenTripPlanner/commit/aa05398de164b2b5d24426c9e0d13fee6a1496d5", "committedDate": "2020-02-11T12:55:19Z", "message": "Enable debug for filter-chain - returning all itineraries, just mark deleted once."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "800f1f67681925531d27ca8690a6933e9c1531f6", "author": {"user": {"login": "t2gran", "name": "Thomas Gran"}}, "url": "https://github.com/opentripplanner/OpenTripPlanner/commit/800f1f67681925531d27ca8690a6933e9c1531f6", "committedDate": "2020-02-11T16:43:38Z", "message": "Enable debug for filter-chain - returning all itineraries, just mark deleted once."}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "aa05398de164b2b5d24426c9e0d13fee6a1496d5", "author": {"user": {"login": "t2gran", "name": "Thomas Gran"}}, "url": "https://github.com/opentripplanner/OpenTripPlanner/commit/aa05398de164b2b5d24426c9e0d13fee6a1496d5", "committedDate": "2020-02-11T12:55:19Z", "message": "Enable debug for filter-chain - returning all itineraries, just mark deleted once."}, "afterCommit": {"oid": "800f1f67681925531d27ca8690a6933e9c1531f6", "author": {"user": {"login": "t2gran", "name": "Thomas Gran"}}, "url": "https://github.com/opentripplanner/OpenTripPlanner/commit/800f1f67681925531d27ca8690a6933e9c1531f6", "committedDate": "2020-02-11T16:43:38Z", "message": "Enable debug for filter-chain - returning all itineraries, just mark deleted once."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "3808b623f2a5a5bac60e914977288ef58ffacdfc", "author": {"user": {"login": "abyrd", "name": "Andrew Byrd"}}, "url": "https://github.com/opentripplanner/OpenTripPlanner/commit/3808b623f2a5a5bac60e914977288ef58ffacdfc", "committedDate": "2020-02-12T09:44:55Z", "message": "Merge branch 'dev-2.x' into otp2_filter_results_3_chain"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzU3MzA1ODk4", "url": "https://github.com/opentripplanner/OpenTripPlanner/pull/2971#pullrequestreview-357305898", "createdAt": "2020-02-12T09:38:09Z", "commit": {"oid": "04bc986e3abd03c71ae748b593fdbe98cecbd0a9"}, "state": "COMMENTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xMlQwOTozODowOVrOFoniGg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xMlQwOTozOTowNVrOFonkUg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3ODEzNTA2Ng==", "bodyText": "We could add units to the constant names.", "url": "https://github.com/opentripplanner/OpenTripPlanner/pull/2971#discussion_r378135066", "createdAt": "2020-02-12T09:38:09Z", "author": {"login": "abyrd"}, "path": "src/main/java/org/opentripplanner/routing/algorithm/RoutingWorker.java", "diffHunk": "@@ -54,17 +56,22 @@\n      * To avoid long searches witch might degrade the performance we use an upper limit\n      * to the distance for none transit what we would allow.\n      */\n-    public static final double MAX_WALK_DISTANCE = 50_000;\n-    public static final double MAX_BIKE_DISTANCE = 150_000;\n-    public static final double MAX_CAR_DISTANCE = 500_000;\n+    private static final double MAX_WALK_DISTANCE = 50_000;\n+    private static final double MAX_BIKE_DISTANCE = 150_000;\n+    private static final double MAX_CAR_DISTANCE = 500_000;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "04bc986e3abd03c71ae748b593fdbe98cecbd0a9"}, "originalPosition": 27}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3ODEzNTYzNA==", "bodyText": "Add to documentation: this function should not change the List instance passed in, but may change the elements in that List, and may return a List with a subset of the elements (or even different, new elements?)", "url": "https://github.com/opentripplanner/OpenTripPlanner/pull/2971#discussion_r378135634", "createdAt": "2020-02-12T09:39:05Z", "author": {"login": "abyrd"}, "path": "src/main/java/org/opentripplanner/routing/algorithm/filterchain/ItineraryFilter.java", "diffHunk": "@@ -0,0 +1,21 @@\n+package org.opentripplanner.routing.algorithm.filterchain;\n+\n+import org.opentripplanner.model.plan.Itinerary;\n+\n+import java.util.List;\n+\n+/**\n+ * Filter or decorate itineraries.\n+ */\n+public interface ItineraryFilter {\n+\n+    /**\n+     * A name used for debugging filters to attach to elements deleted by the filter.\n+     */\n+    String name();\n+\n+    /**\n+     * Process the given itineraries returning the result.", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "04bc986e3abd03c71ae748b593fdbe98cecbd0a9"}, "originalPosition": 18}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "27fdc25449694cf9e2dd01b4091a0b907a861747", "author": {"user": {"login": "t2gran", "name": "Thomas Gran"}}, "url": "https://github.com/opentripplanner/OpenTripPlanner/commit/27fdc25449694cf9e2dd01b4091a0b907a861747", "committedDate": "2020-02-12T20:21:43Z", "message": "Review - Added JavaDoc and improved unit-tests. Slightly changed the GroupByFilter.groupMaxLimit function to round off properly."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a0acd1af705b56b3e30289f28ab958690445f992", "author": {"user": {"login": "t2gran", "name": "Thomas Gran"}}, "url": "https://github.com/opentripplanner/OpenTripPlanner/commit/a0acd1af705b56b3e30289f28ab958690445f992", "committedDate": "2020-02-12T20:23:01Z", "message": "Merge commit '3808b623' into otp2_filter_results_3_chain"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "a1b4b75c20eaaed03e36a96d20a99ba52785e5c1", "author": {"user": {"login": "t2gran", "name": "Thomas Gran"}}, "url": "https://github.com/opentripplanner/OpenTripPlanner/commit/a1b4b75c20eaaed03e36a96d20a99ba52785e5c1", "committedDate": "2020-02-12T20:15:00Z", "message": "Merge remote-tracking branch 'refs/remotes/entur/otp2_filter_results_3_chain' into otp2_filter_results_3_chain"}, "afterCommit": {"oid": "a0acd1af705b56b3e30289f28ab958690445f992", "author": {"user": {"login": "t2gran", "name": "Thomas Gran"}}, "url": "https://github.com/opentripplanner/OpenTripPlanner/commit/a0acd1af705b56b3e30289f28ab958690445f992", "committedDate": "2020-02-12T20:23:01Z", "message": "Merge commit '3808b623' into otp2_filter_results_3_chain"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "2b075f25040ad55bdf5804278d8a4527e89f1e3e", "author": {"user": {"login": "t2gran", "name": "Thomas Gran"}}, "url": "https://github.com/opentripplanner/OpenTripPlanner/commit/2b075f25040ad55bdf5804278d8a4527e89f1e3e", "committedDate": "2020-02-12T20:26:36Z", "message": "Merge branch 'dev-2.x' into otp2_filter_results_3_chain"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "7e93635f100aef7b2956ce3d8a80bf6bb7e84010", "author": {"user": {"login": "t2gran", "name": "Thomas Gran"}}, "url": "https://github.com/opentripplanner/OpenTripPlanner/commit/7e93635f100aef7b2956ce3d8a80bf6bb7e84010", "committedDate": "2020-02-12T21:04:48Z", "message": "Cleanup JavaDoc on ItineraryFilter"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "aeefcde859b8f4fbf53a93c880b7f35d9b9adc82", "author": {"user": {"login": "t2gran", "name": "Thomas Gran"}}, "url": "https://github.com/opentripplanner/OpenTripPlanner/commit/aeefcde859b8f4fbf53a93c880b7f35d9b9adc82", "committedDate": "2020-02-14T10:28:52Z", "message": "Merge branch 'dev-2.x' into otp2_filter_results_3_chain"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "7a254808b6a52ed8a657eb91066ef71e93fa059f", "author": {"user": {"login": "t2gran", "name": "Thomas Gran"}}, "url": "https://github.com/opentripplanner/OpenTripPlanner/commit/7a254808b6a52ed8a657eb91066ef71e93fa059f", "committedDate": "2020-02-14T10:39:06Z", "message": "JavaDoc fix on ItineraryFilter."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzU4ODUzMDI0", "url": "https://github.com/opentripplanner/OpenTripPlanner/pull/2971#pullrequestreview-358853024", "createdAt": "2020-02-14T10:40:23Z", "commit": {"oid": "7a254808b6a52ed8a657eb91066ef71e93fa059f"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2208, "cost": 1, "resetAt": "2021-11-01T15:33:45Z"}}}