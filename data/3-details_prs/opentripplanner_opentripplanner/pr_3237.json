{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTE3ODE0OTc2", "number": 3237, "title": "Fix TransitLayerUpdater bug", "bodyText": "To be completed by pull request submitter:\n\n issue: Closes #3236\n roadmap: Check the roadmap for this feature or bug. If it is not already on the roadmap, PLC will discuss as part of the review process.\n tests: Have you added relevant test coverage? Are all the tests passing on the continuous integration service (Travis CI)?\n formatting: Have you followed the suggested code style?\n documentation: If you are adding a new configuration option, have you added an explanation to the configuration documentation tables and sections?\n changelog: add a bullet point to the changelog file with description and link to the linked issue\n\nTo be completed by @opentripplanner/plc:\n\n reviews and approvals by 2 members, ideally from different organizations\n after merging: update the relevant card on the roadmap\n\nThis PR fixes the errors to the TransitLayerUpdater introduced by #3222.", "createdAt": "2020-11-09T14:46:21Z", "url": "https://github.com/opentripplanner/OpenTripPlanner/pull/3237", "merged": true, "mergeCommit": {"oid": "92b649773e4d3b65ba7471d256d601e5b9912a46"}, "closed": true, "closedAt": "2020-11-20T15:08:45Z", "author": {"login": "gmellemstrand"}, "timelineItems": {"totalCount": 9, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdbEowwAH2gAyNTE3ODE0OTc2OmJlODYxYTc4ZTQ3M2E3NDQ0OWE4MjBlMGU5OTRlY2JjMTFiYzgwN2Y=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdeVjmJgFqTUzNTM0MzM1Mw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "be861a78e473a74449a820e0e994ecbc11bc807f", "author": {"user": {"login": "gmellemstrand", "name": null}}, "url": "https://github.com/opentripplanner/OpenTripPlanner/commit/be861a78e473a74449a820e0e994ecbc11bc807f", "committedDate": "2020-11-10T07:57:20Z", "message": "Account for new TripPatternForDate indexing structure in TransitLayerUpdater"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "2d4a2ee68ba0b19185abb8ec745ddfb1bd8b2339", "author": {"user": {"login": "gmellemstrand", "name": null}}, "url": "https://github.com/opentripplanner/OpenTripPlanner/commit/2d4a2ee68ba0b19185abb8ec745ddfb1bd8b2339", "committedDate": "2020-11-09T14:44:12Z", "message": "Account for new TripPatternForDate indexing structure in TransitLayerUpdater"}, "afterCommit": {"oid": "be861a78e473a74449a820e0e994ecbc11bc807f", "author": {"user": {"login": "gmellemstrand", "name": null}}, "url": "https://github.com/opentripplanner/OpenTripPlanner/commit/be861a78e473a74449a820e0e994ecbc11bc807f", "committedDate": "2020-11-10T07:57:20Z", "message": "Account for new TripPatternForDate indexing structure in TransitLayerUpdater"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "5bbba6972879dba0ecd0fe712d68447509ff0242", "author": {"user": {"login": "gmellemstrand", "name": null}}, "url": "https://github.com/opentripplanner/OpenTripPlanner/commit/5bbba6972879dba0ecd0fe712d68447509ff0242", "committedDate": "2020-11-10T13:37:28Z", "message": "Keep a cache of TripPatternsForDate by running date to improve performance"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "0be22333f4780807b07acb2688be612bc299a122", "author": {"user": {"login": "t2gran", "name": "Thomas Gran"}}, "url": "https://github.com/opentripplanner/OpenTripPlanner/commit/0be22333f4780807b07acb2688be612bc299a122", "committedDate": "2020-11-18T09:58:05Z", "message": "clean code: Fixed formating and removed unused method."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "65ca2728cd321f089c4aa8e095e16e42a0055e05", "author": {"user": {"login": "abyrd", "name": "Andrew Byrd"}}, "url": "https://github.com/opentripplanner/OpenTripPlanner/commit/65ca2728cd321f089c4aa8e095e16e42a0055e05", "committedDate": "2020-11-18T14:03:45Z", "message": "Merge branch 'dev-2.x' into otp2_fix_transitlayerupdater_bug"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTMzNDc4MzI2", "url": "https://github.com/opentripplanner/OpenTripPlanner/pull/3237#pullrequestreview-533478326", "createdAt": "2020-11-18T14:06:31Z", "commit": {"oid": "65ca2728cd321f089c4aa8e095e16e42a0055e05"}, "state": "DISMISSED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xOFQxNDowNjozMVrOH1vXrg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xOFQxNDowNzoyMFrOH1vZ2A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNjExMjY4Ng==", "bodyText": "Introduction of the expression \"RunningPeriodDate\" may be confusing to readers. A simpler name like TripPatternsRunningOnDate or TripPatternsRunningByDate might be better, and still contrast with TripPatternsByDate which would index them by their \"time zero reference\" date.", "url": "https://github.com/opentripplanner/OpenTripPlanner/pull/3237#discussion_r526112686", "createdAt": "2020-11-18T14:06:31Z", "author": {"login": "abyrd"}, "path": "src/main/java/org/opentripplanner/routing/algorithm/raptor/transit/TransitLayer.java", "diffHunk": "@@ -2,21 +2,23 @@\n \n import org.opentripplanner.model.Stop;\n \n+import javax.annotation.Nullable;\n import java.time.LocalDate;\n import java.time.ZoneId;\n import java.util.ArrayList;\n import java.util.Collection;\n-import java.util.Collections;\n import java.util.HashMap;\n import java.util.List;\n import java.util.Map;\n+import java.util.stream.Collectors;\n \n public class TransitLayer {\n \n   /**\n-   * Transit data required for routing\n+   * Transit data required for routing, indexed by each local date(Graph TimeZone) it runs through.\n+   * A Trip \"runs through\" a date if any of its arrivals or depatures is happening on that date.\n    */\n-  private final HashMap<LocalDate, List<TripPatternForDate>> tripPatternsForDate;\n+  private final HashMap<LocalDate, List<TripPatternForDate>> tripPatternsByRunningPeriodDate;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "65ca2728cd321f089c4aa8e095e16e42a0055e05"}, "originalPosition": 23}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNjExMzI0MA==", "bodyText": "Also, is there any reason to use a HashMap instead of a Guava Multimap?", "url": "https://github.com/opentripplanner/OpenTripPlanner/pull/3237#discussion_r526113240", "createdAt": "2020-11-18T14:07:20Z", "author": {"login": "abyrd"}, "path": "src/main/java/org/opentripplanner/routing/algorithm/raptor/transit/TransitLayer.java", "diffHunk": "@@ -2,21 +2,23 @@\n \n import org.opentripplanner.model.Stop;\n \n+import javax.annotation.Nullable;\n import java.time.LocalDate;\n import java.time.ZoneId;\n import java.util.ArrayList;\n import java.util.Collection;\n-import java.util.Collections;\n import java.util.HashMap;\n import java.util.List;\n import java.util.Map;\n+import java.util.stream.Collectors;\n \n public class TransitLayer {\n \n   /**\n-   * Transit data required for routing\n+   * Transit data required for routing, indexed by each local date(Graph TimeZone) it runs through.\n+   * A Trip \"runs through\" a date if any of its arrivals or depatures is happening on that date.\n    */\n-  private final HashMap<LocalDate, List<TripPatternForDate>> tripPatternsForDate;\n+  private final HashMap<LocalDate, List<TripPatternForDate>> tripPatternsByRunningPeriodDate;", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNjExMjY4Ng=="}, "originalCommit": {"oid": "65ca2728cd321f089c4aa8e095e16e42a0055e05"}, "originalPosition": 23}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "d0822b7682c388c72779475269ec9ca61d742fef", "author": {"user": {"login": "t2gran", "name": "Thomas Gran"}}, "url": "https://github.com/opentripplanner/OpenTripPlanner/commit/d0822b7682c388c72779475269ec9ca61d742fef", "committedDate": "2020-11-19T15:56:01Z", "message": "Merge branch 'dev-2.x' into otp2_fix_transitlayerupdater_bug"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "2c214afcc535198cc93c1306d18ef211deab74c1", "author": {"user": {"login": "t2gran", "name": "Thomas Gran"}}, "url": "https://github.com/opentripplanner/OpenTripPlanner/commit/2c214afcc535198cc93c1306d18ef211deab74c1", "committedDate": "2020-11-20T11:08:49Z", "message": "Clean code: Rename `tripPatternsByRunningPeriodDate` to `tripPatternsRunningOnDate`."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTM1MzQzMzUz", "url": "https://github.com/opentripplanner/OpenTripPlanner/pull/3237#pullrequestreview-535343353", "createdAt": "2020-11-20T11:21:51Z", "commit": {"oid": "2c214afcc535198cc93c1306d18ef211deab74c1"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2009, "cost": 1, "resetAt": "2021-11-01T15:33:45Z"}}}