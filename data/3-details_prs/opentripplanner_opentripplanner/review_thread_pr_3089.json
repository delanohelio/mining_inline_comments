{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDI3MDUwODA1", "number": 3089, "reviewThreads": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wNVQxMDozMjoxNFrOEC520A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xMlQxMTo1NToxN1rOEFCE3w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjcxNDgwNTI4OnYy", "diffSide": "RIGHT", "path": "src/main/java/org/opentripplanner/model/Trip.java", "isResolved": false, "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wNVQxMDozMjoxNFrOGfpRQg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xMVQxNDo0MToyNlrOGiggsA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNTgzNTIwMg==", "bodyText": "I suggest mapping the Netex tripPublicCode into tripShortName - maybe not exactly the same - but close enogh. Is there something in Netex that mappes better to GTFS tripShortName?\nWe should discuss on tuesday what to do with tripPrivateCode. The options are:\n\nAdd it to trip (as done here) - and add documentation.\nAdd a new field Trip.extNetex with type NetexTripExtention. The NetexTripExtention will have one field and that is tripPrivateCode.\nMape and index(Map) from Trip.id to 'tripPrivetCode' and store it in GraphIndex.\n\nConsiderations:\n\nIs this a \"Entur\" specific hack?\nIs it likely that we need to add more fields to Trip later, then option 2 is best. Also this make a good example on how to add stuff like this.", "url": "https://github.com/opentripplanner/OpenTripPlanner/pull/3089#discussion_r435835202", "createdAt": "2020-06-05T10:32:14Z", "author": {"login": "t2gran"}, "path": "src/main/java/org/opentripplanner/model/Trip.java", "diffHunk": "@@ -15,6 +15,10 @@\n \n     private String tripShortName;\n \n+    private String tripPublicCode;\n+\n+    private String tripPrivateCode;\n+", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d2e224ab15bc9fcd9c5f92ad230f342e301aeee6"}, "originalPosition": 7}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNjUxMTQ1MA==", "bodyText": "onebusaway-gtfs has the concept of extensions which could be used to add generic objects/fields to existing entities, which we've used extensively. It would be great to see something similar in OTP2.\nFrom NeTEx we also have a list of elements it would be nice to be able to store on objects: ServiceFacilitySetRef for ServiceJourneys, or PrivateCode for Quays and StopPlaces.\nMaybe adding a Map<Class<?>, Object> to TransitEntity<?> to store extensions (similar to the onebusaway-gtfs IdentityBean) could be an option?", "url": "https://github.com/opentripplanner/OpenTripPlanner/pull/3089#discussion_r436511450", "createdAt": "2020-06-08T07:46:16Z", "author": {"login": "flaktack"}, "path": "src/main/java/org/opentripplanner/model/Trip.java", "diffHunk": "@@ -15,6 +15,10 @@\n \n     private String tripShortName;\n \n+    private String tripPublicCode;\n+\n+    private String tripPrivateCode;\n+", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNTgzNTIwMg=="}, "originalCommit": {"oid": "d2e224ab15bc9fcd9c5f92ad230f342e301aeee6"}, "originalPosition": 7}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzODgzNzQyNA==", "bodyText": "@flaktack We discussed this today, and I do not want a generic solution, because:\n\nIf this information is just \"pass through otp\", than maybe it make sense, but as soon as we add logic on top of it it this become problematic.\nWe want to encourage standardisation - enabling to have reusable components in the trip planning ecosystem.\nWe do not want to leave the documentation and integration to the OTP service provider.\nAdding a fields to TransitEntity would increase the memory consumption and overall performance - maybe not much, but enough that I care.\n\nWe agreed to map the NeTEx tripPublicCodeto the internal tripShortName and to add a new field internalRef for the NeTEx privateCode.", "url": "https://github.com/opentripplanner/OpenTripPlanner/pull/3089#discussion_r438837424", "createdAt": "2020-06-11T14:41:26Z", "author": {"login": "t2gran"}, "path": "src/main/java/org/opentripplanner/model/Trip.java", "diffHunk": "@@ -15,6 +15,10 @@\n \n     private String tripShortName;\n \n+    private String tripPublicCode;\n+\n+    private String tripPrivateCode;\n+", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNTgzNTIwMg=="}, "originalCommit": {"oid": "d2e224ab15bc9fcd9c5f92ad230f342e301aeee6"}, "originalPosition": 7}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjczMzc5MDY1OnYy", "diffSide": "RIGHT", "path": "docs/Changelog.md", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xMVQxNDo0MjoxNFrOGigi5Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xMVQxNDo0MjoxNFrOGigi5Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzODgzNzk4OQ==", "bodyText": "Change this, refrase and write something that is meaningful for someone who look at OTP as a black box - a Product Owner.", "url": "https://github.com/opentripplanner/OpenTripPlanner/pull/3089#discussion_r438837989", "createdAt": "2020-06-11T14:42:14Z", "author": {"login": "t2gran"}, "path": "docs/Changelog.md", "diffHunk": "@@ -34,6 +34,7 @@ See the [OTP2 Migration Guide](OTP2-MigrationGuide.md) on changes to the REST AP\n - Refactor how to specify access/egress/direct/transit modes in the internal model and the Transmodel API (#3011)\n - Make agency id feed scoped (#3035)\n - Refactor kiss and ride to a more general car pickup mode (#3063)\n+- Add publicCode/privateCode to the Trip class in the OTP model (#3088)", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ce02f7cdd001ae55f845e8a479366648a4bf9f64"}, "originalPosition": 4}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjczMzgyODcwOnYy", "diffSide": "RIGHT", "path": "src/main/java/org/opentripplanner/model/Trip.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xMVQxNDo1MTozMFrOGig7_w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xMVQxNDo1MTozMFrOGig7_w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzODg0NDQxNQ==", "bodyText": "In NeTEx this maps to {@link ServiceJourney#privateCode}, there is no GTFS equivalent.", "url": "https://github.com/opentripplanner/OpenTripPlanner/pull/3089#discussion_r438844415", "createdAt": "2020-06-11T14:51:30Z", "author": {"login": "t2gran"}, "path": "src/main/java/org/opentripplanner/model/Trip.java", "diffHunk": "@@ -110,6 +115,17 @@ public void setTripShortName(String tripShortName) {\n         this.tripShortName = tripShortName;\n     }\n \n+    /**\n+     * Internal code (non-public identifier) for the journey (e.g. train- or trip number from\n+     * the planners' tool). This is kept to ensure compatibility with legacy planning systems.\n+     * There is no GTFS equivalent.", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ce02f7cdd001ae55f845e8a479366648a4bf9f64"}, "originalPosition": 35}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjczNzEyMzUxOnYy", "diffSide": "RIGHT", "path": "src/main/java/org/opentripplanner/netex/loader/mapping/TripMapper.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xMlQxMTo1NToxN1rOGjBTag==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xMlQxMTo1NToxN1rOGjBTag==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzOTM3NDY5OA==", "bodyText": "No need to wrap this with a if", "url": "https://github.com/opentripplanner/OpenTripPlanner/pull/3089#discussion_r439374698", "createdAt": "2020-06-12T11:55:17Z", "author": {"login": "t2gran"}, "path": "src/main/java/org/opentripplanner/netex/loader/mapping/TripMapper.java", "diffHunk": "@@ -62,6 +62,12 @@ Trip mapServiceJourney(ServiceJourney serviceJourney){\n         trip.setRoute(route);\n         trip.setServiceId(idFactory.createId(serviceId));\n         trip.setShapeId(getShapeId(serviceJourney));\n+        if (serviceJourney.getPrivateCode() != null) {\n+          trip.setInternalPlanningCode(serviceJourney.getPrivateCode().getValue());\n+        }\n+        if (serviceJourney.getPublicCode() != null) {\n+          trip.setTripShortName(serviceJourney.getPublicCode());\n+        }", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f4159d582448eec5d0dd9f56738edbff7109580c"}, "originalPosition": 9}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1836, "cost": 1, "resetAt": "2021-11-13T12:10:21Z"}}}