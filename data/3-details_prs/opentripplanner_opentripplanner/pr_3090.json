{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDI3MTU4NTM0", "number": 3090, "title": "Add endpoint fetcher for GBFS", "bodyText": "To be completed by pull request submitter:\n\n issue: Link to or create an issue that describes the relevant feature or bug. Add GitHub keywords to this PR's description (e.g., closes #45).\n roadmap: Check the roadmap for this feature or bug. If it is not already on the roadmap, PLC will discuss as part of the review process.\n tests: Have you added relevant test coverage? Are all the tests passing on the continuous integration service (Travis CI)?\n formatting: Have you followed the suggested code style?\n documentation: If you are adding a new configuration option, have you added an explanation to the configuration documentation tables and sections?\n changelog: add a bullet point to the changelog file with description and link to the linked issue\n\nTo be completed by @opentripplanner/plc:\n\n reviews and approvals by 2 members, ideally from different organizations\n after merging: update the relevant card on the roadmap", "createdAt": "2020-06-03T12:06:23Z", "url": "https://github.com/opentripplanner/OpenTripPlanner/pull/3090", "merged": true, "mergeCommit": {"oid": "0c0c4a8533cef3337b24f69222293857b9cbe586"}, "closed": true, "closedAt": "2020-06-26T11:32:57Z", "author": {"login": "gmellemstrand"}, "timelineItems": {"totalCount": 28, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcnoQBhAH2gAyNDI3MTU4NTM0OjYyNjEzYzA3ODhmYTAyMDk0MTliYzUxMWVlYzllYWZkMjY0NzgxODQ=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcvBmA8gFqTQzODIyMTc2OA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "62613c0788fa0209419bc511eec9eafd26478184", "author": {"user": {"login": "gmellemstrand", "name": null}}, "url": "https://github.com/opentripplanner/OpenTripPlanner/commit/62613c0788fa0209419bc511eec9eafd26478184", "committedDate": "2020-06-03T12:02:50Z", "message": "Add endpoint fetcher for GBFS"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ce331a5a7deb64a63ae7bdae82e4dafa8fbdf6c9", "author": {"user": {"login": "gmellemstrand", "name": null}}, "url": "https://github.com/opentripplanner/OpenTripPlanner/commit/ce331a5a7deb64a63ae7bdae82e4dafa8fbdf6c9", "committedDate": "2020-06-03T12:12:19Z", "message": "Add documentaton"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "50f8abc2c4466c08690da09302e3f02b9e4d1819", "author": {"user": {"login": "t2gran", "name": "Thomas Gran"}}, "url": "https://github.com/opentripplanner/OpenTripPlanner/commit/50f8abc2c4466c08690da09302e3f02b9e4d1819", "committedDate": "2020-06-11T09:40:49Z", "message": "Merge branch 'dev-2.x' into otp2_bikerental_endpoint"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDI4ODM4MDc1", "url": "https://github.com/opentripplanner/OpenTripPlanner/pull/3090#pullrequestreview-428838075", "createdAt": "2020-06-11T11:56:31Z", "commit": {"oid": "50f8abc2c4466c08690da09302e3f02b9e4d1819"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 12, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xMVQxMTo1NjozMVrOGiZ-wA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xMVQxNDoxMjoxN1rOGifRlA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzODczMDQzMg==", "bodyText": "Line break", "url": "https://github.com/opentripplanner/OpenTripPlanner/pull/3090#discussion_r438730432", "createdAt": "2020-06-11T11:56:31Z", "author": {"login": "t2gran"}, "path": "src/ext/java/org/opentripplanner/ext/updater_endpoint_fetcher/GBFSUpdaterEndpointFetcher.java", "diffHunk": "@@ -0,0 +1,74 @@\n+package org.opentripplanner.ext.updater_endpoint_fetcher;\n+\n+import com.fasterxml.jackson.databind.JsonNode;\n+import com.fasterxml.jackson.databind.ObjectMapper;\n+import org.apache.commons.lang3.StringUtils;\n+import org.opentripplanner.updater.GraphUpdater;\n+import org.opentripplanner.updater.bike_rental.BikeRentalUpdater;\n+import org.opentripplanner.util.HttpUtils;\n+import org.slf4j.Logger;\n+import org.slf4j.LoggerFactory;\n+\n+import java.io.InputStream;\n+import java.util.ArrayList;\n+import java.util.List;\n+\n+/**\n+ * Fetches GBFS endpoints from the Bikeservice component located at\n+ * https://github.com/entur/bikeservice\n+ */\n+public class GBFSUpdaterEndpointFetcher {\n+\n+  private static final Logger LOG = LoggerFactory.getLogger(GBFSUpdaterEndpointFetcher.class);\n+\n+  private static final int DEFAULT_FREQUENCY_SEC = 15;\n+\n+  public static List<GraphUpdater> createUpdatersFromEndpoint(String url) {\n+\n+    LOG.info(\"Fetching list of updaters from {}\", url);\n+\n+    List<GraphUpdater> updaters = new ArrayList<>();\n+\n+    try {\n+      InputStream is = HttpUtils.getData(url);\n+      JsonNode node = (new ObjectMapper()).readTree(is);\n+      for (JsonNode operator : node.get(\"operators\")) {\n+        String network = operator.get(\"name\").asText();\n+        String updaterUrl = adjustUrlForUpdater(operator.get(\"url\").asText());\n+\n+        GbfsDataSource dataSource = new GbfsDataSource(updaterUrl, network);\n+        GbfsUpdaterSourceConfig gbfsUpdaterSourceConfig = new GbfsUpdaterSourceConfig(dataSource);\n+        BikeRentalParameters bikeRentalParameters = new BikeRentalParameters(\n+            gbfsUpdaterSourceConfig,\n+            updaterUrl,\n+            DEFAULT_FREQUENCY_SEC,\n+            network\n+        );\n+        LOG.info(\"Fetched updater info for {} at url {}\", network, updaterUrl);\n+\n+        GraphUpdater updater = new BikeRentalUpdater(bikeRentalParameters);\n+        updaters.add(updater);\n+      }\n+    }\n+    catch (java.io.IOException e) {\n+      LOG.warn(\n+          \"Error fetching list of bike rental endpoints from {}\", url);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "50f8abc2c4466c08690da09302e3f02b9e4d1819"}, "originalPosition": 55}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzODczNTA4NQ==", "bodyText": "We try to avoid using the 'org.apache.commons' when possible, and here you can rewrite this as:\nprivate static final String GBFS_JSON_FILENAME = \"gbfs.json\";\n:\nreturn url.endsWith(GBFS_JSON_FILENAME)\n        ? url.substring(0, url.length() - GBFS_JSON_FILENAME.length())\n        : url;", "url": "https://github.com/opentripplanner/OpenTripPlanner/pull/3090#discussion_r438735085", "createdAt": "2020-06-11T12:06:27Z", "author": {"login": "t2gran"}, "path": "src/ext/java/org/opentripplanner/ext/updater_endpoint_fetcher/GBFSUpdaterEndpointFetcher.java", "diffHunk": "@@ -0,0 +1,74 @@\n+package org.opentripplanner.ext.updater_endpoint_fetcher;\n+\n+import com.fasterxml.jackson.databind.JsonNode;\n+import com.fasterxml.jackson.databind.ObjectMapper;\n+import org.apache.commons.lang3.StringUtils;\n+import org.opentripplanner.updater.GraphUpdater;\n+import org.opentripplanner.updater.bike_rental.BikeRentalUpdater;\n+import org.opentripplanner.util.HttpUtils;\n+import org.slf4j.Logger;\n+import org.slf4j.LoggerFactory;\n+\n+import java.io.InputStream;\n+import java.util.ArrayList;\n+import java.util.List;\n+\n+/**\n+ * Fetches GBFS endpoints from the Bikeservice component located at\n+ * https://github.com/entur/bikeservice\n+ */\n+public class GBFSUpdaterEndpointFetcher {\n+\n+  private static final Logger LOG = LoggerFactory.getLogger(GBFSUpdaterEndpointFetcher.class);\n+\n+  private static final int DEFAULT_FREQUENCY_SEC = 15;\n+\n+  public static List<GraphUpdater> createUpdatersFromEndpoint(String url) {\n+\n+    LOG.info(\"Fetching list of updaters from {}\", url);\n+\n+    List<GraphUpdater> updaters = new ArrayList<>();\n+\n+    try {\n+      InputStream is = HttpUtils.getData(url);\n+      JsonNode node = (new ObjectMapper()).readTree(is);\n+      for (JsonNode operator : node.get(\"operators\")) {\n+        String network = operator.get(\"name\").asText();\n+        String updaterUrl = adjustUrlForUpdater(operator.get(\"url\").asText());\n+\n+        GbfsDataSource dataSource = new GbfsDataSource(updaterUrl, network);\n+        GbfsUpdaterSourceConfig gbfsUpdaterSourceConfig = new GbfsUpdaterSourceConfig(dataSource);\n+        BikeRentalParameters bikeRentalParameters = new BikeRentalParameters(\n+            gbfsUpdaterSourceConfig,\n+            updaterUrl,\n+            DEFAULT_FREQUENCY_SEC,\n+            network\n+        );\n+        LOG.info(\"Fetched updater info for {} at url {}\", network, updaterUrl);\n+\n+        GraphUpdater updater = new BikeRentalUpdater(bikeRentalParameters);\n+        updaters.add(updater);\n+      }\n+    }\n+    catch (java.io.IOException e) {\n+      LOG.warn(\n+          \"Error fetching list of bike rental endpoints from {}\", url);\n+    }\n+\n+    LOG.info(\"{} updaters fetched\", updaters.size());\n+\n+    return updaters;\n+  }\n+\n+  /**\n+   * The GBFS standard defines \"gbfs.json\" as the entrypoint, while\n+   * {@link org.opentripplanner.updater.bike_rental.BikeRentalDataSource} expects the base url and\n+   * does not look at \"gbfs.json\". This method adjusts the URL to what the BikeRentalDataSource\n+   * expects.\n+   */\n+  private static String adjustUrlForUpdater(String url) {\n+    return url.endsWith(\"gbfs.json\")\n+        ? StringUtils.substring(url, 0, url.length() - 9)\n+        : url;\n+  }", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "50f8abc2c4466c08690da09302e3f02b9e4d1819"}, "originalPosition": 73}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzODczNjE2Mw==", "bodyText": "Follow the Java package naming convention using only lowercase letters, no underscores.", "url": "https://github.com/opentripplanner/OpenTripPlanner/pull/3090#discussion_r438736163", "createdAt": "2020-06-11T12:08:44Z", "author": {"login": "t2gran"}, "path": "src/ext/java/org/opentripplanner/ext/updater_endpoint_fetcher/GBFSUpdaterEndpointFetcher.java", "diffHunk": "@@ -0,0 +1,74 @@\n+package org.opentripplanner.ext.updater_endpoint_fetcher;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "50f8abc2c4466c08690da09302e3f02b9e4d1819"}, "originalPosition": 1}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzODczNjg1Ng==", "bodyText": "Should be named GbfsDataSourceParameters ?", "url": "https://github.com/opentripplanner/OpenTripPlanner/pull/3090#discussion_r438736856", "createdAt": "2020-06-11T12:10:14Z", "author": {"login": "t2gran"}, "path": "src/ext/java/org/opentripplanner/ext/updater_endpoint_fetcher/GbfsDataSource.java", "diffHunk": "@@ -0,0 +1,30 @@\n+package org.opentripplanner.ext.updater_endpoint_fetcher;\n+\n+import org.opentripplanner.updater.bike_rental.GbfsBikeRentalDataSource;\n+\n+public class GbfsDataSource implements GbfsBikeRentalDataSource.Parameters {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "50f8abc2c4466c08690da09302e3f02b9e4d1819"}, "originalPosition": 5}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzODc0Mzc0Mg==", "bodyText": "It is not clear what this is from this documentation.", "url": "https://github.com/opentripplanner/OpenTripPlanner/pull/3090#discussion_r438743742", "createdAt": "2020-06-11T12:24:17Z", "author": {"login": "t2gran"}, "path": "docs/sandbox/BikeShareUpdaterEndpoint.md", "diffHunk": "@@ -0,0 +1,14 @@\n+# Bike share updater API support.\n+\n+## Contact Info\n+- Gard Mellemstrand, Entur, Norway\n+\n+## Changelog\n+- Initial implementation of bike share updater API support\n+\n+## Documentation\n+\n+This adds support for the GBFS endpoint component located at https://github.com/entur/bikeservice", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "50f8abc2c4466c08690da09302e3f02b9e4d1819"}, "originalPosition": 11}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzODc0NDYwNQ==", "bodyText": "bikeShareUpdaterEndpoint is to generic.", "url": "https://github.com/opentripplanner/OpenTripPlanner/pull/3090#discussion_r438744605", "createdAt": "2020-06-11T12:25:56Z", "author": {"login": "t2gran"}, "path": "docs/sandbox/BikeShareUpdaterEndpoint.md", "diffHunk": "@@ -0,0 +1,14 @@\n+# Bike share updater API support.\n+\n+## Contact Info\n+- Gard Mellemstrand, Entur, Norway\n+\n+## Changelog\n+- Initial implementation of bike share updater API support\n+\n+## Documentation\n+\n+This adds support for the GBFS endpoint component located at https://github.com/entur/bikeservice\n+ \n+### Configuration\n+To enable this you need to specify a url for the `bikeShareUpdaterEndpoint` in the `router-config.json`", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "50f8abc2c4466c08690da09302e3f02b9e4d1819"}, "originalPosition": 14}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzODc0NTU4MQ==", "bodyText": "The url is configurable, ref that not our url.", "url": "https://github.com/opentripplanner/OpenTripPlanner/pull/3090#discussion_r438745581", "createdAt": "2020-06-11T12:27:56Z", "author": {"login": "t2gran"}, "path": "src/ext/java/org/opentripplanner/ext/updater_endpoint_fetcher/GBFSUpdaterEndpointFetcher.java", "diffHunk": "@@ -0,0 +1,74 @@\n+package org.opentripplanner.ext.updater_endpoint_fetcher;\n+\n+import com.fasterxml.jackson.databind.JsonNode;\n+import com.fasterxml.jackson.databind.ObjectMapper;\n+import org.apache.commons.lang3.StringUtils;\n+import org.opentripplanner.updater.GraphUpdater;\n+import org.opentripplanner.updater.bike_rental.BikeRentalUpdater;\n+import org.opentripplanner.util.HttpUtils;\n+import org.slf4j.Logger;\n+import org.slf4j.LoggerFactory;\n+\n+import java.io.InputStream;\n+import java.util.ArrayList;\n+import java.util.List;\n+\n+/**\n+ * Fetches GBFS endpoints from the Bikeservice component located at\n+ * https://github.com/entur/bikeservice", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "50f8abc2c4466c08690da09302e3f02b9e4d1819"}, "originalPosition": 18}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzODc0Njg4MA==", "bodyText": "BikeShare or BikeRentalService? Is this a service locator, hub or a gateway?\nThe best name I can think of is BikeRentalServiceDirectory. Other similar names would be BikeRentalServiceLocatorService or BikeRentalServiceLookupService. From what I understand this is just a directory/name service - listing GBFS BikeRental endpoints. It does not act as a gateway/hub/proxy?", "url": "https://github.com/opentripplanner/OpenTripPlanner/pull/3090#discussion_r438746880", "createdAt": "2020-06-11T12:30:34Z", "author": {"login": "t2gran"}, "path": "docs/sandbox/BikeShareUpdaterEndpoint.md", "diffHunk": "@@ -0,0 +1,14 @@\n+# Bike share updater API support.\n+\n+## Contact Info\n+- Gard Mellemstrand, Entur, Norway\n+\n+## Changelog\n+- Initial implementation of bike share updater API support\n+\n+## Documentation\n+\n+This adds support for the GBFS endpoint component located at https://github.com/entur/bikeservice\n+ \n+### Configuration\n+To enable this you need to specify a url for the `bikeShareUpdaterEndpoint` in the `router-config.json`", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzODc0NDYwNQ=="}, "originalCommit": {"oid": "50f8abc2c4466c08690da09302e3f02b9e4d1819"}, "originalPosition": 14}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzODgxMTc0MA==", "bodyText": "You are silently eating the exception, print at least the exception message in the log.", "url": "https://github.com/opentripplanner/OpenTripPlanner/pull/3090#discussion_r438811740", "createdAt": "2020-06-11T14:04:08Z", "author": {"login": "t2gran"}, "path": "src/ext/java/org/opentripplanner/ext/updater_endpoint_fetcher/GBFSUpdaterEndpointFetcher.java", "diffHunk": "@@ -0,0 +1,74 @@\n+package org.opentripplanner.ext.updater_endpoint_fetcher;\n+\n+import com.fasterxml.jackson.databind.JsonNode;\n+import com.fasterxml.jackson.databind.ObjectMapper;\n+import org.apache.commons.lang3.StringUtils;\n+import org.opentripplanner.updater.GraphUpdater;\n+import org.opentripplanner.updater.bike_rental.BikeRentalUpdater;\n+import org.opentripplanner.util.HttpUtils;\n+import org.slf4j.Logger;\n+import org.slf4j.LoggerFactory;\n+\n+import java.io.InputStream;\n+import java.util.ArrayList;\n+import java.util.List;\n+\n+/**\n+ * Fetches GBFS endpoints from the Bikeservice component located at\n+ * https://github.com/entur/bikeservice\n+ */\n+public class GBFSUpdaterEndpointFetcher {\n+\n+  private static final Logger LOG = LoggerFactory.getLogger(GBFSUpdaterEndpointFetcher.class);\n+\n+  private static final int DEFAULT_FREQUENCY_SEC = 15;\n+\n+  public static List<GraphUpdater> createUpdatersFromEndpoint(String url) {\n+\n+    LOG.info(\"Fetching list of updaters from {}\", url);\n+\n+    List<GraphUpdater> updaters = new ArrayList<>();\n+\n+    try {\n+      InputStream is = HttpUtils.getData(url);\n+      JsonNode node = (new ObjectMapper()).readTree(is);\n+      for (JsonNode operator : node.get(\"operators\")) {\n+        String network = operator.get(\"name\").asText();\n+        String updaterUrl = adjustUrlForUpdater(operator.get(\"url\").asText());\n+\n+        GbfsDataSource dataSource = new GbfsDataSource(updaterUrl, network);\n+        GbfsUpdaterSourceConfig gbfsUpdaterSourceConfig = new GbfsUpdaterSourceConfig(dataSource);\n+        BikeRentalParameters bikeRentalParameters = new BikeRentalParameters(\n+            gbfsUpdaterSourceConfig,\n+            updaterUrl,\n+            DEFAULT_FREQUENCY_SEC,\n+            network\n+        );\n+        LOG.info(\"Fetched updater info for {} at url {}\", network, updaterUrl);\n+\n+        GraphUpdater updater = new BikeRentalUpdater(bikeRentalParameters);\n+        updaters.add(updater);\n+      }\n+    }\n+    catch (java.io.IOException e) {\n+      LOG.warn(\n+          \"Error fetching list of bike rental endpoints from {}\", url);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzODczMDQzMg=="}, "originalCommit": {"oid": "50f8abc2c4466c08690da09302e3f02b9e4d1819"}, "originalPosition": 55}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzODgxNTI5Mw==", "bodyText": "asURI(...)", "url": "https://github.com/opentripplanner/OpenTripPlanner/pull/3090#discussion_r438815293", "createdAt": "2020-06-11T14:09:43Z", "author": {"login": "t2gran"}, "path": "src/main/java/org/opentripplanner/standalone/config/RouterConfig.java", "diffHunk": "@@ -42,6 +44,9 @@ public RouterConfig(JsonNode node, String source, boolean logUnusedParams) {\n         this.streetRoutingTimeoutSeconds = adapter.asDouble(\n                 \"streetRoutingTimeout\", DEFAULT_STREET_ROUTING_TIMEOUT\n         );\n+        this.bikeShareUpdaterEndpoint = adapter.asText(\n+            \"bikeShareUpdaterEndpoint\", null\n+        );", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "50f8abc2c4466c08690da09302e3f02b9e4d1819"}, "originalPosition": 22}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzODgxNTM1MQ==", "bodyText": "private final URI gbfsBikeRentalServiceDirectory;", "url": "https://github.com/opentripplanner/OpenTripPlanner/pull/3090#discussion_r438815351", "createdAt": "2020-06-11T14:09:48Z", "author": {"login": "t2gran"}, "path": "src/main/java/org/opentripplanner/standalone/config/RouterConfig.java", "diffHunk": "@@ -31,6 +32,7 @@\n \n     private final String requestLogFile;\n     private final double streetRoutingTimeoutSeconds;\n+    private final String bikeShareUpdaterEndpoint;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "50f8abc2c4466c08690da09302e3f02b9e4d1819"}, "originalPosition": 12}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzODgxNzE3Mg==", "bodyText": "Can the gbfsBikeRentalServiceDirectory  part of the UpdaterConfig?", "url": "https://github.com/opentripplanner/OpenTripPlanner/pull/3090#discussion_r438817172", "createdAt": "2020-06-11T14:12:17Z", "author": {"login": "t2gran"}, "path": "src/main/java/org/opentripplanner/standalone/server/Router.java", "diffHunk": "@@ -93,7 +93,11 @@ public void startup() {\n         }\n \n         /* Create Graph updater modules from JSON config. */\n-        GraphUpdaterConfigurator.setupGraph(this.graph, routerConfig.updaterConfig());\n+        GraphUpdaterConfigurator.setupGraph(\n+            this.graph,\n+            routerConfig.updaterConfig(),\n+            routerConfig.getBikeShareUpdaterEndpoint()", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "50f8abc2c4466c08690da09302e3f02b9e4d1819"}, "originalPosition": 8}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b3491e22091f96444284aef1bc54ee408d428973", "author": {"user": {"login": "gmellemstrand", "name": null}}, "url": "https://github.com/opentripplanner/OpenTripPlanner/commit/b3491e22091f96444284aef1bc54ee408d428973", "committedDate": "2020-06-12T08:46:32Z", "message": "Log exception message"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c3d1ec8bab01e4c0418528e7411b9709c8115bac", "author": {"user": {"login": "gmellemstrand", "name": null}}, "url": "https://github.com/opentripplanner/OpenTripPlanner/commit/c3d1ec8bab01e4c0418528e7411b9709c8115bac", "committedDate": "2020-06-12T08:47:48Z", "message": "Avoid using apache commons"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "50b5ae1883bb0f07472d7a5ed59c0a43bce77a56", "author": {"user": {"login": "gmellemstrand", "name": null}}, "url": "https://github.com/opentripplanner/OpenTripPlanner/commit/50b5ae1883bb0f07472d7a5ed59c0a43bce77a56", "committedDate": "2020-06-12T08:53:17Z", "message": "Rename package to not use underscores"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "9d6db34631fc83fc8f7be80a1ea0c35b9688a7ff", "author": {"user": {"login": "gmellemstrand", "name": null}}, "url": "https://github.com/opentripplanner/OpenTripPlanner/commit/9d6db34631fc83fc8f7be80a1ea0c35b9688a7ff", "committedDate": "2020-06-12T08:54:01Z", "message": "Rename GBFSDataSource to GBFSDataSourceParameters"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "2191313227011393118049be20f5c7501d0539e2", "author": {"user": {"login": "gmellemstrand", "name": null}}, "url": "https://github.com/opentripplanner/OpenTripPlanner/commit/2191313227011393118049be20f5c7501d0539e2", "committedDate": "2020-06-12T08:56:36Z", "message": "Expanded javadoc"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "d92bd5bde3cbc65b6efb726de88978d194ed7efc", "author": {"user": {"login": "gmellemstrand", "name": null}}, "url": "https://github.com/opentripplanner/OpenTripPlanner/commit/d92bd5bde3cbc65b6efb726de88978d194ed7efc", "committedDate": "2020-06-12T09:34:47Z", "message": "Use URI data type for endpoint config"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a1229c03c922ac3e72e333460cc1fd80ef2b3b5f", "author": {"user": {"login": "gmellemstrand", "name": null}}, "url": "https://github.com/opentripplanner/OpenTripPlanner/commit/a1229c03c922ac3e72e333460cc1fd80ef2b3b5f", "committedDate": "2020-06-17T11:43:02Z", "message": "Rename to bikeRentalServiceDirectory"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e9444256ceaf9482bb8091ea368a5ab6a1bca07d", "author": {"user": {"login": "gmellemstrand", "name": null}}, "url": "https://github.com/opentripplanner/OpenTripPlanner/commit/e9444256ceaf9482bb8091ea368a5ab6a1bca07d", "committedDate": "2020-06-17T11:44:05Z", "message": "Merge branch 'dev-2.x' into otp2_bikerental_endpoint"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "124612b5544ece60fbdcad7d3e98f4fdc5f22441", "author": {"user": {"login": "gmellemstrand", "name": null}}, "url": "https://github.com/opentripplanner/OpenTripPlanner/commit/124612b5544ece60fbdcad7d3e98f4fdc5f22441", "committedDate": "2020-06-17T12:06:38Z", "message": "Merge branch 'dev-2.x' into otp2_bikerental_endpoint"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDMyMzMzNTkw", "url": "https://github.com/opentripplanner/OpenTripPlanner/pull/3090#pullrequestreview-432333590", "createdAt": "2020-06-17T12:07:25Z", "commit": {"oid": "e9444256ceaf9482bb8091ea368a5ab6a1bca07d"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xN1QxMjowODo0MlrOGlCv_A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xN1QxMjoxMToyMVrOGlC1iQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MTQ5NTU0OA==", "bodyText": "Add a short javadoc to this method including that it configure a Sandbox feature.", "url": "https://github.com/opentripplanner/OpenTripPlanner/pull/3090#discussion_r441495548", "createdAt": "2020-06-17T12:08:42Z", "author": {"login": "t2gran"}, "path": "src/main/java/org/opentripplanner/standalone/config/RouterConfig.java", "diffHunk": "@@ -65,6 +70,10 @@ public double streetRoutingTimeoutSeconds() {\n         return streetRoutingTimeoutSeconds;\n     }\n \n+    public URI getBikeRentalServiceDirectoryUrl() {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "124612b5544ece60fbdcad7d3e98f4fdc5f22441"}, "originalPosition": 30}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MTQ5Njk2OQ==", "bodyText": "This parameter need documentation in the Configuration.md - Not much, but clearly stated that it is a Sandbox feature.", "url": "https://github.com/opentripplanner/OpenTripPlanner/pull/3090#discussion_r441496969", "createdAt": "2020-06-17T12:11:21Z", "author": {"login": "t2gran"}, "path": "src/main/java/org/opentripplanner/standalone/config/RouterConfig.java", "diffHunk": "@@ -42,6 +44,9 @@ public RouterConfig(JsonNode node, String source, boolean logUnusedParams) {\n         this.streetRoutingTimeoutSeconds = adapter.asDouble(\n                 \"streetRoutingTimeout\", DEFAULT_STREET_ROUTING_TIMEOUT\n         );\n+        this.bikeRentalServiceDirectoryUrl = adapter.asUri(\n+            \"bikeRentalServiceDirectoryUrl\", null\n+        );", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "124612b5544ece60fbdcad7d3e98f4fdc5f22441"}, "originalPosition": 22}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "76160af2495c0d7ec8ccda2d1a8c018d0e37ced1", "author": {"user": {"login": "gmellemstrand", "name": null}}, "url": "https://github.com/opentripplanner/OpenTripPlanner/commit/76160af2495c0d7ec8ccda2d1a8c018d0e37ced1", "committedDate": "2020-06-17T12:27:16Z", "message": "Documentation"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "267524266872ae8f6049f481e82a5bb8cdb8bcd6", "author": {"user": {"login": "gmellemstrand", "name": null}}, "url": "https://github.com/opentripplanner/OpenTripPlanner/commit/267524266872ae8f6049f481e82a5bb8cdb8bcd6", "committedDate": "2020-06-17T12:22:41Z", "message": "Documentation"}, "afterCommit": {"oid": "76160af2495c0d7ec8ccda2d1a8c018d0e37ced1", "author": {"user": {"login": "gmellemstrand", "name": null}}, "url": "https://github.com/opentripplanner/OpenTripPlanner/commit/76160af2495c0d7ec8ccda2d1a8c018d0e37ced1", "committedDate": "2020-06-17T12:27:16Z", "message": "Documentation"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "cdceeeb3dae2646a9f1495b4dc869d002ead2f43", "author": {"user": {"login": "gmellemstrand", "name": null}}, "url": "https://github.com/opentripplanner/OpenTripPlanner/commit/cdceeeb3dae2646a9f1495b4dc869d002ead2f43", "committedDate": "2020-06-25T08:21:13Z", "message": "Merge branch 'dev-2.x' into otp2_bikerental_endpoint"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "d29aa8ba9931b7b1534e2ec647a04faa286c462b", "author": {"user": {"login": "t2gran", "name": "Thomas Gran"}}, "url": "https://github.com/opentripplanner/OpenTripPlanner/commit/d29aa8ba9931b7b1534e2ec647a04faa286c462b", "committedDate": "2020-06-25T09:11:46Z", "message": "Merge branch 'dev-2.x' into otp2_bikerental_endpoint"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "49ac74015e01bbfad12722f71a1c494a5d3f0ff6", "author": {"user": {"login": "gmellemstrand", "name": null}}, "url": "https://github.com/opentripplanner/OpenTripPlanner/commit/49ac74015e01bbfad12722f71a1c494a5d3f0ff6", "committedDate": "2020-06-25T09:57:45Z", "message": "Extracted interface from UpdaterConfig and added getBikeRentalServiceDirectoryUrl to the interface"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "7a862de234e71a3fa2a1cecfe429889290e7cfbc", "author": {"user": {"login": "t2gran", "name": "Thomas Gran"}}, "url": "https://github.com/opentripplanner/OpenTripPlanner/commit/7a862de234e71a3fa2a1cecfe429889290e7cfbc", "committedDate": "2020-06-25T09:33:12Z", "message": "Example"}, "afterCommit": {"oid": "49ac74015e01bbfad12722f71a1c494a5d3f0ff6", "author": {"user": {"login": "gmellemstrand", "name": null}}, "url": "https://github.com/opentripplanner/OpenTripPlanner/commit/49ac74015e01bbfad12722f71a1c494a5d3f0ff6", "committedDate": "2020-06-25T09:57:45Z", "message": "Extracted interface from UpdaterConfig and added getBikeRentalServiceDirectoryUrl to the interface"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDM4MTc5MjQ2", "url": "https://github.com/opentripplanner/OpenTripPlanner/pull/3090#pullrequestreview-438179246", "createdAt": "2020-06-26T10:14:59Z", "commit": {"oid": "49ac74015e01bbfad12722f71a1c494a5d3f0ff6"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yNlQxMDoxNTowMFrOGpbkWg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yNlQxMDoxNTowMFrOGpbkWg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NjA5NjQ3NA==", "bodyText": "FYI: The UpdaterDataSourceConfig is still a bit \"stange\", but not part of this PR. I might look at it later.", "url": "https://github.com/opentripplanner/OpenTripPlanner/pull/3090#discussion_r446096474", "createdAt": "2020-06-26T10:15:00Z", "author": {"login": "t2gran"}, "path": "src/ext/java/org/opentripplanner/ext/bikerentalservicedirectory/GbfsUpdaterSourceConfig.java", "diffHunk": "@@ -0,0 +1,25 @@\n+package org.opentripplanner.ext.bikerentalservicedirectory;\n+\n+import org.opentripplanner.updater.UpdaterDataSourceConfig;\n+import org.opentripplanner.updater.UpdaterDataSourceParameters;\n+\n+public class GbfsUpdaterSourceConfig implements UpdaterDataSourceConfig {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "49ac74015e01bbfad12722f71a1c494a5d3f0ff6"}, "originalPosition": 6}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDM4MTg3MDgy", "url": "https://github.com/opentripplanner/OpenTripPlanner/pull/3090#pullrequestreview-438187082", "createdAt": "2020-06-26T10:28:25Z", "commit": {"oid": "49ac74015e01bbfad12722f71a1c494a5d3f0ff6"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yNlQxMDoyODoyNVrOGpb8Mg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yNlQxMDoyODoyNVrOGpb8Mg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NjEwMjU3OA==", "bodyText": "The boxing here is unnecessary - I will remove it.", "url": "https://github.com/opentripplanner/OpenTripPlanner/pull/3090#discussion_r446102578", "createdAt": "2020-06-26T10:28:25Z", "author": {"login": "t2gran"}, "path": "src/main/java/org/opentripplanner/updater/GraphUpdaterConfigurator.java", "diffHunk": "@@ -41,11 +41,17 @@\n \n     private static Logger LOG = LoggerFactory.getLogger(GraphUpdaterConfigurator.class);\n \n-    public static void setupGraph(Graph graph, UpdaterConfig updaterConfig) {\n+    public static void setupGraph(\n+        Graph graph,\n+        UpdaterParameters updaterParameters\n+    ) {\n \n-        List<GraphUpdater> updaters = new ArrayList<>();\n+        List<GraphUpdater> updaters = new ArrayList<>(createUpdatersFromConfig(updaterParameters));", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "49ac74015e01bbfad12722f71a1c494a5d3f0ff6"}, "originalPosition": 21}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDM4MTkzMDY4", "url": "https://github.com/opentripplanner/OpenTripPlanner/pull/3090#pullrequestreview-438193068", "createdAt": "2020-06-26T10:39:26Z", "commit": {"oid": "49ac74015e01bbfad12722f71a1c494a5d3f0ff6"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yNlQxMDozOToyNlrOGpcN-Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yNlQxMDozOToyNlrOGpcN-Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NjEwNzEyOQ==", "bodyText": "The getData method should be refactored to take in a type-safe argument when we have it. I will fix this.", "url": "https://github.com/opentripplanner/OpenTripPlanner/pull/3090#discussion_r446107129", "createdAt": "2020-06-26T10:39:26Z", "author": {"login": "t2gran"}, "path": "src/ext/java/org/opentripplanner/ext/bikerentalservicedirectory/BikeRentalServiceDirectoryFetcher.java", "diffHunk": "@@ -0,0 +1,75 @@\n+package org.opentripplanner.ext.bikerentalservicedirectory;\n+\n+import com.fasterxml.jackson.databind.JsonNode;\n+import com.fasterxml.jackson.databind.ObjectMapper;\n+import org.opentripplanner.updater.GraphUpdater;\n+import org.opentripplanner.updater.bike_rental.BikeRentalUpdater;\n+import org.opentripplanner.util.HttpUtils;\n+import org.slf4j.Logger;\n+import org.slf4j.LoggerFactory;\n+\n+import java.io.InputStream;\n+import java.net.URI;\n+import java.util.ArrayList;\n+import java.util.List;\n+\n+/**\n+ * Fetches GBFS endpoints from the Bikeservice component located at\n+ * https://github.com/entur/bikeservice, which is an API for aggregating GBFS endpoints.\n+ */\n+public class BikeRentalServiceDirectoryFetcher {\n+\n+  private static final Logger LOG = LoggerFactory.getLogger(BikeRentalServiceDirectoryFetcher.class);\n+\n+  private static final int DEFAULT_FREQUENCY_SEC = 15;\n+\n+  private static final String GBFS_JSON_FILENAME = \"gbfs.json\";\n+\n+  public static List<GraphUpdater> createUpdatersFromEndpoint(URI url) {\n+\n+    LOG.info(\"Fetching list of updaters from {}\", url);\n+\n+    List<GraphUpdater> updaters = new ArrayList<>();\n+\n+    try {\n+      InputStream is = HttpUtils.getData(url.toString());", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "49ac74015e01bbfad12722f71a1c494a5d3f0ff6"}, "originalPosition": 35}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "fe9a3093b263e393965ab16530cffc9d4398e836", "author": {"user": {"login": "t2gran", "name": "Thomas Gran"}}, "url": "https://github.com/opentripplanner/OpenTripPlanner/commit/fe9a3093b263e393965ab16530cffc9d4398e836", "committedDate": "2020-06-26T10:49:09Z", "message": "Small code cleanups."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDM4MTk5NDE2", "url": "https://github.com/opentripplanner/OpenTripPlanner/pull/3090#pullrequestreview-438199416", "createdAt": "2020-06-26T10:51:35Z", "commit": {"oid": "fe9a3093b263e393965ab16530cffc9d4398e836"}, "state": "DISMISSED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "8a2dd02198a1566a314a287a191f4557ba10c1b1", "author": {"user": {"login": "t2gran", "name": "Thomas Gran"}}, "url": "https://github.com/opentripplanner/OpenTripPlanner/commit/8a2dd02198a1566a314a287a191f4557ba10c1b1", "committedDate": "2020-06-26T10:51:48Z", "message": "Merge branch 'dev-2.x' into otp2_bikerental_endpoint"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "5ec39a081ad871b5d2173f904af0907d668ded66", "author": {"user": {"login": "t2gran", "name": "Thomas Gran"}}, "url": "https://github.com/opentripplanner/OpenTripPlanner/commit/5ec39a081ad871b5d2173f904af0907d668ded66", "committedDate": "2020-06-26T11:11:14Z", "message": "Small code cleanups - fix compilation error."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDM4MjIxNzY4", "url": "https://github.com/opentripplanner/OpenTripPlanner/pull/3090#pullrequestreview-438221768", "createdAt": "2020-06-26T11:31:57Z", "commit": {"oid": "5ec39a081ad871b5d2173f904af0907d668ded66"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2132, "cost": 1, "resetAt": "2021-11-01T15:33:45Z"}}}