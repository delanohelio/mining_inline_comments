{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0Mzc4OTk4Mjg5", "number": 2984, "title": "Use Raptor calculation of leg start/end times", "bodyText": "To be completed by pull request submitter:\n\n issue: #2955\n roadmap: Check the roadmap for this feature or bug. If it is not already on the roadmap, PLC will discuss as part of the review process.\n tests: Have you added relevant test coverage? Are all the tests passing on the continuous integration service (Travis CI)?\n formatting: Have you followed the suggested code style?\n documentation: If you are adding a new configuration option, have you added an explanation to the configuration documentation tables and sections?\n changelog: add a bullet point to the changelog file with description and link to the linked issue\n\nTo be completed by @opentripplanner/plc:\n\n reviews and approvals by 2 members, ideally from different organizations\n after merging: update the relevant card on the roadmap\n\nThe RaptorPathToItineraryMapper calculates walk legs by iterating over the legs the way it is done in AStar. This can differ from the times originally used in the Raptor routing. This pull request causes the mapper to ignore the start and end times from iterating over the legs and instead use the Raptor times.", "createdAt": "2020-02-24T13:44:57Z", "url": "https://github.com/opentripplanner/OpenTripPlanner/pull/2984", "merged": true, "mergeCommit": {"oid": "4fcf5907f1991559a60680b44e7383905d2707c7"}, "closed": true, "closedAt": "2020-02-27T09:03:44Z", "author": {"login": "gmellemstrand"}, "timelineItems": {"totalCount": 6, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcHzL--AH2gAyMzc4OTk4Mjg5OjNjMjVlOWQzMzYxNjVkZjgzM2YxZDkzMTI4NTliMTYzYTViZjQ5MDc=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcIXhk3AFqTM2NTUwODU3Ng==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "3c25e9d336165df833f1d9312859b163a5bf4907", "author": {"user": {"login": "gmellemstrand", "name": null}}, "url": "https://github.com/opentripplanner/OpenTripPlanner/commit/3c25e9d336165df833f1d9312859b163a5bf4907", "committedDate": "2020-02-25T14:41:48Z", "message": "Use Raptor calculation of leg start/end times even if they differ from AStar calculation"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "b077966358fee504645d664331dde53e1f7cf55b", "author": {"user": {"login": "gmellemstrand", "name": null}}, "url": "https://github.com/opentripplanner/OpenTripPlanner/commit/b077966358fee504645d664331dde53e1f7cf55b", "committedDate": "2020-02-24T13:32:21Z", "message": "Use Raptor calculation of leg start/end times even if they differ from AStar calculation"}, "afterCommit": {"oid": "3c25e9d336165df833f1d9312859b163a5bf4907", "author": {"user": {"login": "gmellemstrand", "name": null}}, "url": "https://github.com/opentripplanner/OpenTripPlanner/commit/3c25e9d336165df833f1d9312859b163a5bf4907", "committedDate": "2020-02-25T14:41:48Z", "message": "Use Raptor calculation of leg start/end times even if they differ from AStar calculation"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "40f6dad277f20c3739afa159367c7513a92bde60", "author": {"user": {"login": "t2gran", "name": "Thomas Gran"}}, "url": "https://github.com/opentripplanner/OpenTripPlanner/commit/40f6dad277f20c3739afa159367c7513a92bde60", "committedDate": "2020-02-25T18:24:13Z", "message": "Merge branch 'dev-2.x' into negative_wait_times_bug_fix"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzY0MzUxNTc5", "url": "https://github.com/opentripplanner/OpenTripPlanner/pull/2984#pullrequestreview-364351579", "createdAt": "2020-02-25T18:35:37Z", "commit": {"oid": "40f6dad277f20c3739afa159367c7513a92bde60"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yNVQxODozNTozN1rOFuQcqQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yNVQxODozNTozN1rOFuQcqQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NDA0ODI5Nw==", "bodyText": "We do not use assert, it need to be enabled by a command line switch, which rarely is used. You can do a if(...) { throw new IllegalArgumentException(\"<message>\"); } instead.\nI personally like programing by contract, so feel free to promote this to become part of the coding guidelines, but until then we should not use it.", "url": "https://github.com/opentripplanner/OpenTripPlanner/pull/2984#discussion_r384048297", "createdAt": "2020-02-25T18:35:37Z", "author": {"login": "t2gran"}, "path": "src/main/java/org/opentripplanner/routing/algorithm/mapping/RaptorPathToItineraryMapper.java", "diffHunk": "@@ -291,7 +291,9 @@ private void mapNonTransitLeg(List<Leg> legs, PathLeg<TripSchedule> pathLeg, Tra\n                 // TODO OTP2 We use the duration initially calculated for use during routing\n                 //      because they do not always match up and we risk getting negative wait times\n                 //      (#2955)\n-                subItinerary.nonTransitTimeSeconds = pathLeg.duration();\n+                assert(subItinerary.legs.size() == 1);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "40f6dad277f20c3739afa159367c7513a92bde60"}, "originalPosition": 5}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "731532ee35516fa91078ee0f32768ee914d666a8", "author": {"user": {"login": "gmellemstrand", "name": null}}, "url": "https://github.com/opentripplanner/OpenTripPlanner/commit/731532ee35516fa91078ee0f32768ee914d666a8", "committedDate": "2020-02-26T08:21:38Z", "message": "Throw exception if subitinerary does not contain exactly 1 leg"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzY1NTA4NTc2", "url": "https://github.com/opentripplanner/OpenTripPlanner/pull/2984#pullrequestreview-365508576", "createdAt": "2020-02-27T09:01:58Z", "commit": {"oid": "731532ee35516fa91078ee0f32768ee914d666a8"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2058, "cost": 1, "resetAt": "2021-11-01T15:33:45Z"}}}