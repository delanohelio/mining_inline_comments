{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTI4NDg4NDc4", "number": 3265, "title": "Redact config", "bodyText": "When OTP starts up it logs its own config files, which may contain API keys, including values substituted in from environment variables.\nThis PR looks for keys in a specified set and removes their values to avoid leaking credentials into the logs.\n17:25:04.385 INFO (ConfigLoader.java:168) Load JSON configuration file '/Users/abyrd/otp/pdx/build-config.json'\n17:25:04.400 INFO (ConfigLoader.java:169) Summarizing '/Users/abyrd/otp/pdx/build-config.json': {\n  \"elevationBucket\" : {\n    \"accessKey\" : \"********\",\n    \"secretKey\" : \"********\",\n    \"bucketName\" : \"ned13\"\n  },\n  \"storage\" : {\n    \"gsCredentials\" : \"********\"\n  }\n}\n\nI'm not sure if you want to get this into the 2.0 release or 2.1. It may not be wise to make changes to configuration loading right before a release. But this seems to work well in testing, with the redacted values still available for downloads.\nI'm also not sure whether you want to redact the gsCredentials since it usually just points to a file, but it seems safer to just redact it.", "createdAt": "2020-11-27T09:12:02Z", "url": "https://github.com/opentripplanner/OpenTripPlanner/pull/3265", "merged": true, "mergeCommit": {"oid": "fb5ef51d943641d9639f75d5c33268014992b776"}, "closed": true, "closedAt": "2021-01-05T11:23:23Z", "author": {"login": "abyrd"}, "timelineItems": {"totalCount": 8, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdgj7ZbAH2gAyNTI4NDg4NDc4OjkzMjZlMDc3ODQ3MTQ3OWY2ZjkwZWM5MzM5ZDQ0YWUyMWE5ZmI3YjE=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdtJGZzAFqTU2MTcwOTg2Ng==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "9326e0778471479f6f90ec9339d44ae21a9fb7b1", "author": {"user": {"login": "abyrd", "name": "Andrew Byrd"}}, "url": "https://github.com/opentripplanner/OpenTripPlanner/commit/9326e0778471479f6f90ec9339d44ae21a9fb7b1", "committedDate": "2020-11-27T09:14:22Z", "message": "redact credentials from config file before logging"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "c3715afbfeaf78e4453ca8beaefe4438b9c985e2", "author": {"user": {"login": "abyrd", "name": "Andrew Byrd"}}, "url": "https://github.com/opentripplanner/OpenTripPlanner/commit/c3715afbfeaf78e4453ca8beaefe4438b9c985e2", "committedDate": "2020-11-27T09:09:41Z", "message": "redact credentials from config file before logging"}, "afterCommit": {"oid": "9326e0778471479f6f90ec9339d44ae21a9fb7b1", "author": {"user": {"login": "abyrd", "name": "Andrew Byrd"}}, "url": "https://github.com/opentripplanner/OpenTripPlanner/commit/9326e0778471479f6f90ec9339d44ae21a9fb7b1", "committedDate": "2020-11-27T09:14:22Z", "message": "redact credentials from config file before logging"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "6e1f244b747fc8df0674ee91fd012cbb7d03b12c", "author": {"user": {"login": "abyrd", "name": "Andrew Byrd"}}, "url": "https://github.com/opentripplanner/OpenTripPlanner/commit/6e1f244b747fc8df0674ee91fd012cbb7d03b12c", "committedDate": "2020-11-27T09:26:43Z", "message": "redact gsCredentials config property"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTYxNzAyNDg0", "url": "https://github.com/opentripplanner/OpenTripPlanner/pull/3265#pullrequestreview-561702484", "createdAt": "2021-01-05T11:08:24Z", "commit": {"oid": "6e1f244b747fc8df0674ee91fd012cbb7d03b12c"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wMS0wNVQxMTowODoyNFrOIOTLsg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wMS0wNVQxMTowODoyNFrOIOTLsg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1MTg2NTI2Ng==", "bodyText": "Set.of()", "url": "https://github.com/opentripplanner/OpenTripPlanner/pull/3265#discussion_r551865266", "createdAt": "2021-01-05T11:08:24Z", "author": {"login": "t2gran"}, "path": "src/main/java/org/opentripplanner/standalone/config/ConfigLoader.java", "diffHunk": "@@ -31,6 +34,9 @@\n     private static final String BUILD_CONFIG_FILENAME = \"build-config.json\";\n     private static final String ROUTER_CONFIG_FILENAME = \"router-config.json\";\n \n+    /** When echoing config files to logs, values for these keys will be hidden. */\n+    private static final Set<String> REDACT_KEYS = ImmutableSet.of(\"secretKey\", \"accessKey\", \"gsCredentials\");", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "6e1f244b747fc8df0674ee91fd012cbb7d03b12c"}, "originalPosition": 22}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f7d99155ff0e6aee98bfa94d3ad5e792b22c994b", "author": {"user": {"login": "t2gran", "name": "Thomas Gran"}}, "url": "https://github.com/opentripplanner/OpenTripPlanner/commit/f7d99155ff0e6aee98bfa94d3ad5e792b22c994b", "committedDate": "2021-01-05T11:12:24Z", "message": "Use Set.of() not ImmutableSet.of"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTYxNzA1MDg0", "url": "https://github.com/opentripplanner/OpenTripPlanner/pull/3265#pullrequestreview-561705084", "createdAt": "2021-01-05T11:12:35Z", "commit": {"oid": "6e1f244b747fc8df0674ee91fd012cbb7d03b12c"}, "state": "DISMISSED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "1d507a2cceb32302304769f9924a518b0b34332e", "author": {"user": {"login": "t2gran", "name": "Thomas Gran"}}, "url": "https://github.com/opentripplanner/OpenTripPlanner/commit/1d507a2cceb32302304769f9924a518b0b34332e", "committedDate": "2021-01-05T11:13:38Z", "message": "Merge branch 'dev-2.x' into redact-config"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTYxNzA5ODY2", "url": "https://github.com/opentripplanner/OpenTripPlanner/pull/3265#pullrequestreview-561709866", "createdAt": "2021-01-05T11:19:58Z", "commit": {"oid": "1d507a2cceb32302304769f9924a518b0b34332e"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2030, "cost": 1, "resetAt": "2021-11-01T15:33:45Z"}}}