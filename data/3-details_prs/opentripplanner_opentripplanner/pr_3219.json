{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTA1MDEyNTU5", "number": 3219, "title": "Add `generalizedCost` to both itinerary and leg", "bodyText": "Allowing us to fetch the generalizedCost from the REST and TransmodelAPI allow us to better understand the cost, debug and tune the system.\nThis PR also:\n\nShow cost at itinerary level in OTP UI.\nAdd modes FERRY and FLEXIBLE to \"Transit, No Airplane\" selection in UI.\n\nTo be completed by pull request submitter:\n\n issue: No.\n roadmap: No\n tests: Some unit tests are updated. Manual system test with Entur data for whole of Norway.\n formatting: Yes.\n documentation: No.\n changelog: No.\n\nTo be completed by @opentripplanner/plc:\n\n reviews and approvals by 2 members, ideally from different organizations\n after merging: update the relevant card on the roadmap", "createdAt": "2020-10-16T18:00:50Z", "url": "https://github.com/opentripplanner/OpenTripPlanner/pull/3219", "merged": true, "mergeCommit": {"oid": "2f141f9c76fe1203094f6b29e054a1f90fd18376"}, "closed": true, "closedAt": "2020-10-27T09:31:44Z", "author": {"login": "t2gran"}, "timelineItems": {"totalCount": 8, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdTJSjAAH2gAyNTA1MDEyNTU5OmZkYzM5ODFiMWQwYmFlYjU4ZmY0MjY1MjE4OGE0YWQ2MTYyYWI4ZTc=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdWlFHvgFqTUxNzQ3MDIwMQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "fdc3981b1d0baeb58ff42652188a4ad6162ab8e7", "author": {"user": {"login": "t2gran", "name": "Thomas Gran"}}, "url": "https://github.com/opentripplanner/OpenTripPlanner/commit/fdc3981b1d0baeb58ff42652188a4ad6162ab8e7", "committedDate": "2020-10-16T16:51:12Z", "message": "improvement: Add `generalizedCost` to both itinerary and leg, so we can debug the calculated cost. Show cost at itinerary level in OTP UI. Add modes `FERRY` and `FLEXIBLE` to \"Transit, No Airplane\" selection in UI."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f822a125daac9faa8080c961e7b6dd3e44f07d25", "author": {"user": {"login": "t2gran", "name": "Thomas Gran"}}, "url": "https://github.com/opentripplanner/OpenTripPlanner/commit/f822a125daac9faa8080c961e7b6dd3e44f07d25", "committedDate": "2020-10-20T14:37:55Z", "message": "Add `generalizedCost` to Leg and Itinerary on the LegacyGraphQL API."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "89698fe327d70c237a5613f845bc19e902452986", "author": {"user": {"login": "t2gran", "name": "Thomas Gran"}}, "url": "https://github.com/opentripplanner/OpenTripPlanner/commit/89698fe327d70c237a5613f845bc19e902452986", "committedDate": "2020-10-21T07:54:32Z", "message": "Merge remote-tracking branch 'otp/dev-2.x' into otp2_generalized_cost_on_legs"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTE0NDc0Mzk5", "url": "https://github.com/opentripplanner/OpenTripPlanner/pull/3219#pullrequestreview-514474399", "createdAt": "2020-10-22T08:21:42Z", "commit": {"oid": "89698fe327d70c237a5613f845bc19e902452986"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yMlQwODoyMTo0MlrOHmWIUA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yMlQwODoyMTo0MlrOHmWIUA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwOTk3MDUxMg==", "bodyText": "What happens, when there are multiple legs generated from on AccessPath?", "url": "https://github.com/opentripplanner/OpenTripPlanner/pull/3219#discussion_r509970512", "createdAt": "2020-10-22T08:21:42Z", "author": {"login": "hannesj"}, "path": "src/main/java/org/opentripplanner/transit/raptor/rangeraptor/path/ForwardPathMapper.java", "diffHunk": "@@ -99,7 +102,12 @@ private void setRangeRaptorIterationDepartureTime(int iterationDepartureTime) {\n             from.stop(),\n             departureTime,\n             from.arrivalTime(),\n+            RaptorCostConverter.toOtpDomainCost(from.cost()),", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "89698fe327d70c237a5613f845bc19e902452986"}, "originalPosition": 30}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ac61e0424b3a7c82fc432ffe6cd09003061fe293", "author": {"user": {"login": "t2gran", "name": "Thomas Gran"}}, "url": "https://github.com/opentripplanner/OpenTripPlanner/commit/ac61e0424b3a7c82fc432ffe6cd09003061fe293", "committedDate": "2020-10-22T13:38:16Z", "message": "Merge branch 'dev-2.x' into otp2_generalized_cost_on_legs"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTE0NzYyODE3", "url": "https://github.com/opentripplanner/OpenTripPlanner/pull/3219#pullrequestreview-514762817", "createdAt": "2020-10-22T14:03:16Z", "commit": {"oid": "ac61e0424b3a7c82fc432ffe6cd09003061fe293"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yMlQxNDowMzoxNlrOHmjZ_g==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yMlQxNDowMzoxNlrOHmjZ_g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMDE4ODAzMA==", "bodyText": "Code cleanup: A basic principle of programming is to have methods with no side-effects. So, I changed this method to return the mapped legs, not map and insert into the result.", "url": "https://github.com/opentripplanner/OpenTripPlanner/pull/3219#discussion_r510188030", "createdAt": "2020-10-22T14:03:16Z", "author": {"login": "t2gran"}, "path": "src/main/java/org/opentripplanner/routing/algorithm/mapping/RaptorPathToItineraryMapper.java", "diffHunk": "@@ -114,24 +113,23 @@ public Itinerary createItinerary(Path<TripSchedule> path) {\n         return itinerary;\n     }\n \n-    private void mapAccessLeg(\n-            List<Leg> legs,\n-            AccessPathLeg<TripSchedule> accessPathLeg\n-    ) {\n+    private List<Leg> mapAccessLeg(AccessPathLeg<TripSchedule> accessPathLeg) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ac61e0424b3a7c82fc432ffe6cd09003061fe293"}, "originalPosition": 39}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "015de23eadbd5ed4d2fc8718e1b7623e9345a2cb", "author": {"user": {"login": "t2gran", "name": "Thomas Gran"}}, "url": "https://github.com/opentripplanner/OpenTripPlanner/commit/015de23eadbd5ed4d2fc8718e1b7623e9345a2cb", "committedDate": "2020-10-26T16:55:58Z", "message": "Merge branch 'dev-2.x' into otp2_generalized_cost_on_legs"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTE3NDcwMjAx", "url": "https://github.com/opentripplanner/OpenTripPlanner/pull/3219#pullrequestreview-517470201", "createdAt": "2020-10-27T08:55:39Z", "commit": {"oid": "015de23eadbd5ed4d2fc8718e1b7623e9345a2cb"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1998, "cost": 1, "resetAt": "2021-11-01T15:33:45Z"}}}