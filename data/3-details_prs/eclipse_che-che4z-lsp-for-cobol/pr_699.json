{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTM1MTE2ODc5", "number": 699, "title": "VariableDefinitionDelegate refactoring", "bodyText": "Hope it helps.", "createdAt": "2020-12-09T11:38:27Z", "url": "https://github.com/eclipse/che-che4z-lsp-for-cobol/pull/699", "merged": true, "mergeCommit": {"oid": "338c6ba11dce675a720a6da9899581e232668c0f"}, "closed": true, "closedAt": "2020-12-10T14:25:12Z", "author": {"login": "grianbrcom"}, "timelineItems": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdkd8RFgFqTU0ODEwOTg2Mw==", "endCursor": "Y3Vyc29yOnYyOpPPAAABdkxE7_gFqTU0OTA3MDUyMA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTQ4MTA5ODYz", "url": "https://github.com/eclipse/che-che4z-lsp-for-cobol/pull/699#pullrequestreview-548109863", "createdAt": "2020-12-09T11:57:20Z", "commit": {"oid": "639e82812d2ef9393509e45b9cc53ea3167ccb38"}, "state": "COMMENTED", "comments": {"totalCount": 6, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0wOVQxMTo1NzoyMFrOICQ9-A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0wOVQxMjoyNzo0MFrOICSIFw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzOTI0NjA3Mg==", "bodyText": "Maybe, it would be better to use a builder here", "url": "https://github.com/eclipse/che-che4z-lsp-for-cobol/pull/699#discussion_r539246072", "createdAt": "2020-12-09T11:57:20Z", "author": {"login": "temanbrcom"}, "path": "server/src/main/java/com/broadcom/lsp/cobol/core/visitor/VariableDefinitionDelegate.java", "diffHunk": "@@ -104,71 +104,38 @@ void defineVariable(@NonNull DataDescriptionEntryFormat1Context ctx) {\n     // TODO: 8. redefining one may be group when RE is element\n     // TODO: 9. cannot contain VALUE\n \n-    int number = Integer.parseInt(ctx.LEVEL_NUMBER().getText());\n+    VariableDefinitionContext variableDefinitionContext = new VariableDefinitionContext();\n+    variableDefinitionContext.setNumber(Integer.parseInt(ctx.LEVEL_NUMBER().getText()));\n+    variableDefinitionContext.setName(retrieveName(ctx.entryName()));\n+    variableDefinitionContext.setDefinition(retrieveDefinition(ctx.entryName()));\n+    variableDefinitionContext.setAntlrClass(ctx.getClass());\n+    variableDefinitionContext.setStarting(positions.get(ctx.LEVEL_NUMBER().getSymbol()));\n+    variableDefinitionContext.setPicClauses(ctx.dataPictureClause());\n+    variableDefinitionContext.setOccursClauses(ctx.dataOccursClause());\n+    variableDefinitionContext.setValueClauses(ctx.dataValueClause());", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "639e82812d2ef9393509e45b9cc53ea3167ccb38"}, "originalPosition": 13}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzOTI0NjMyMw==", "bodyText": "Missing class javadoc", "url": "https://github.com/eclipse/che-che4z-lsp-for-cobol/pull/699#discussion_r539246323", "createdAt": "2020-12-09T11:57:43Z", "author": {"login": "temanbrcom"}, "path": "server/src/main/java/com/broadcom/lsp/cobol/core/model/variables/VariableDefinitionContext.java", "diffHunk": "@@ -0,0 +1,23 @@\n+package com.broadcom.lsp.cobol.core.model.variables;\n+\n+import com.broadcom.lsp.cobol.core.CobolParser;\n+import com.broadcom.lsp.cobol.core.model.Locality;\n+import lombok.Data;\n+\n+import java.util.List;\n+", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "639e82812d2ef9393509e45b9cc53ea3167ccb38"}, "originalPosition": 8}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzOTI0NjY3Mg==", "bodyText": "Please, parametrize this Class usage to avoid a code smell", "url": "https://github.com/eclipse/che-che4z-lsp-for-cobol/pull/699#discussion_r539246672", "createdAt": "2020-12-09T11:58:18Z", "author": {"login": "temanbrcom"}, "path": "server/src/main/java/com/broadcom/lsp/cobol/core/model/variables/VariableDefinitionContext.java", "diffHunk": "@@ -0,0 +1,23 @@\n+package com.broadcom.lsp.cobol.core.model.variables;\n+\n+import com.broadcom.lsp.cobol.core.CobolParser;\n+import com.broadcom.lsp.cobol.core.model.Locality;\n+import lombok.Data;\n+\n+import java.util.List;\n+\n+@Data\n+public class VariableDefinitionContext {\n+  int number;\n+  String name;\n+  Locality definition;\n+  Class antlrClass;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "639e82812d2ef9393509e45b9cc53ea3167ccb38"}, "originalPosition": 14}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzOTI0OTgxMw==", "bodyText": "Nice", "url": "https://github.com/eclipse/che-che4z-lsp-for-cobol/pull/699#discussion_r539249813", "createdAt": "2020-12-09T12:03:27Z", "author": {"login": "temanbrcom"}, "path": "server/src/main/java/com/broadcom/lsp/cobol/core/visitor/VariableDefinitionDelegate.java", "diffHunk": "@@ -443,4 +335,223 @@ private void addError(String suggestion, Locality locality, ErrorSeverity severi\n     LOG.debug(\n         format(\"Syntax error defined by %s: %s\", getClass().getSimpleName(), error.toString()));\n   }\n+\n+  private void setFillerNameIfNeeded(VariableDefinitionContext variable) {\n+    if (variable.getName() == null) {\n+      variable.setName(OutlineNodeNames.FILLER_NAME);\n+    }\n+  }\n+\n+  private void checkVariableTypeAllowed(VariableDefinitionContext variable) {\n+    if (!section.allowsVariableType(variable.getAntlrClass())) {\n+      addError(messages.getMessage(DEFINITION_NOT_ALLOWED_IN_SECTION), variable.getDefinition());\n+    }\n+  }\n+\n+  private void checkStartingArea(VariableDefinitionContext variable) {\n+    if ((variable.getNumber() == 1 || variable.getNumber() == LEVEL_77)\n+        && variable.getStarting().getRange().getStart().getCharacter() > 10) {\n+      addError(AREA_A_WARNING, variable.getStarting(), WARNING);\n+    }\n+  }\n+\n+  private void closePreviousStructureIfNeeded(VariableDefinitionContext variable) {\n+    closePreviousStructureIfNeeded(variable.getNumber());\n+  }\n+\n+  private void checkTopElementNumber(VariableDefinitionContext variable) {\n+    int number = variable.getNumber();\n+    if (number == 1 || number == LEVEL_66 || number == LEVEL_77) return;\n+    addError(messages.getMessage(NUMBER_NOT_ALLOWED_AT_TOP), variable.getDefinition());\n+  }\n+\n+  private void updateQualifier(VariableDefinitionContext variable) {\n+    if (variable.getContainer() == null) {\n+      variable.setQualifier(retrieveQualifier(variable.getName()));\n+    } else {\n+      variable.setQualifier(variable.getContainer() + \" \" + variable.getName());\n+    }\n+  }\n+\n+  private void checkPictureClauseIsSingle(VariableDefinitionContext variable) {\n+    checkClauseIsSingle(variable.getPicClauses());\n+  }\n+\n+  private void checkOccursClauseIsSingle(VariableDefinitionContext variable) {\n+    checkClauseIsSingle(variable.getOccursClauses());\n+  }\n+\n+  private void checkValueClauseIsSingle(VariableDefinitionContext variable) {\n+    checkClauseIsSingle(variable.getValueClauses());\n+  }\n+\n+  private void checkClauseIsSingle(List<? extends ParserRuleContext> clauses) {\n+    if (clauses.size() > 1) {\n+      addError(\n+          messages.getMessage(TOO_MANY_CLAUSES_MSG, clauses.get(0).getStart().getText()),\n+          retrieveRangeLocality(clauses));\n+    }\n+  }\n+\n+  private void setValueClauseText(VariableDefinitionContext variable) {\n+    String valueClauseText = \"\";\n+    if (!variable.getValueClauses().isEmpty()) {\n+      valueClauseText = variable.getValueClauses().get(0).dataValueClauseLiteral().getText();\n+    }\n+    variable.setValueClauseTest(valueClauseText);\n+  }\n+\n+  private void updateConditionalContainer(VariableDefinitionContext variable) {\n+    ElementItem container = getConditionalContainer();\n+    variable.setContainer(container);\n+    if (container == null) {\n+      addError(messages.getMessage(PREVIOUS_WITHOUT_PIC_FOR_88, variable.getName()), variable.getDefinition());\n+    }\n+  }\n+\n+  private void defineVariable(VariableDefinitionContext variableDefinitionContext,\n+                              Function<VariableDefinitionContext, Variable> ... matchers) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "639e82812d2ef9393509e45b9cc53ea3167ccb38"}, "originalPosition": 393}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzOTI1MzYxMw==", "bodyText": "Should also set pic and value", "url": "https://github.com/eclipse/che-che4z-lsp-for-cobol/pull/699#discussion_r539253613", "createdAt": "2020-12-09T12:09:47Z", "author": {"login": "temanbrcom"}, "path": "server/src/main/java/com/broadcom/lsp/cobol/core/visitor/VariableDefinitionDelegate.java", "diffHunk": "@@ -178,30 +145,21 @@ void defineVariable(@NonNull DataDescriptionEntryFormat1Context ctx) {\n    * @param ctx - a {@link DataDescriptionEntryFormat1Level77Context} to retrieve the variable\n    */\n   void defineVariable(@NonNull DataDescriptionEntryFormat1Level77Context ctx) {\n-    String name = retrieveName(ctx.entryName());\n-    Locality definition = retrieveDefinition(ctx.entryName());\n-\n-    checkVariableTypeAllowed(ctx.getClass(), definition);\n-    checkStartingArea(LEVEL_77, positions.get(ctx.LEVEL_NUMBER_77().getSymbol()));\n+    VariableDefinitionContext variableDefinitionContext = new VariableDefinitionContext();\n+    variableDefinitionContext.setNumber(LEVEL_77);\n+    variableDefinitionContext.setName(retrieveName(ctx.entryName()));\n+    variableDefinitionContext.setDefinition(retrieveDefinition(ctx.entryName()));\n+    variableDefinitionContext.setAntlrClass(ctx.getClass());\n+    variableDefinitionContext.setStarting(positions.get(ctx.LEVEL_NUMBER_77().getSymbol()));\n+", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "639e82812d2ef9393509e45b9cc53ea3167ccb38"}, "originalPosition": 115}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzOTI2NTA0Nw==", "bodyText": "Those indices should also be stored", "url": "https://github.com/eclipse/che-che4z-lsp-for-cobol/pull/699#discussion_r539265047", "createdAt": "2020-12-09T12:27:40Z", "author": {"login": "temanbrcom"}, "path": "server/src/main/java/com/broadcom/lsp/cobol/core/visitor/VariableDefinitionDelegate.java", "diffHunk": "@@ -443,4 +335,223 @@ private void addError(String suggestion, Locality locality, ErrorSeverity severi\n     LOG.debug(\n         format(\"Syntax error defined by %s: %s\", getClass().getSimpleName(), error.toString()));\n   }\n+\n+  private void setFillerNameIfNeeded(VariableDefinitionContext variable) {\n+    if (variable.getName() == null) {\n+      variable.setName(OutlineNodeNames.FILLER_NAME);\n+    }\n+  }\n+\n+  private void checkVariableTypeAllowed(VariableDefinitionContext variable) {\n+    if (!section.allowsVariableType(variable.getAntlrClass())) {\n+      addError(messages.getMessage(DEFINITION_NOT_ALLOWED_IN_SECTION), variable.getDefinition());\n+    }\n+  }\n+\n+  private void checkStartingArea(VariableDefinitionContext variable) {\n+    if ((variable.getNumber() == 1 || variable.getNumber() == LEVEL_77)\n+        && variable.getStarting().getRange().getStart().getCharacter() > 10) {\n+      addError(AREA_A_WARNING, variable.getStarting(), WARNING);\n+    }\n+  }\n+\n+  private void closePreviousStructureIfNeeded(VariableDefinitionContext variable) {\n+    closePreviousStructureIfNeeded(variable.getNumber());\n+  }\n+\n+  private void checkTopElementNumber(VariableDefinitionContext variable) {\n+    int number = variable.getNumber();\n+    if (number == 1 || number == LEVEL_66 || number == LEVEL_77) return;\n+    addError(messages.getMessage(NUMBER_NOT_ALLOWED_AT_TOP), variable.getDefinition());\n+  }\n+\n+  private void updateQualifier(VariableDefinitionContext variable) {\n+    if (variable.getContainer() == null) {\n+      variable.setQualifier(retrieveQualifier(variable.getName()));\n+    } else {\n+      variable.setQualifier(variable.getContainer() + \" \" + variable.getName());\n+    }\n+  }\n+\n+  private void checkPictureClauseIsSingle(VariableDefinitionContext variable) {\n+    checkClauseIsSingle(variable.getPicClauses());\n+  }\n+\n+  private void checkOccursClauseIsSingle(VariableDefinitionContext variable) {\n+    checkClauseIsSingle(variable.getOccursClauses());\n+  }\n+\n+  private void checkValueClauseIsSingle(VariableDefinitionContext variable) {\n+    checkClauseIsSingle(variable.getValueClauses());\n+  }\n+\n+  private void checkClauseIsSingle(List<? extends ParserRuleContext> clauses) {\n+    if (clauses.size() > 1) {\n+      addError(\n+          messages.getMessage(TOO_MANY_CLAUSES_MSG, clauses.get(0).getStart().getText()),\n+          retrieveRangeLocality(clauses));\n+    }\n+  }\n+\n+  private void setValueClauseText(VariableDefinitionContext variable) {\n+    String valueClauseText = \"\";\n+    if (!variable.getValueClauses().isEmpty()) {\n+      valueClauseText = variable.getValueClauses().get(0).dataValueClauseLiteral().getText();\n+    }\n+    variable.setValueClauseTest(valueClauseText);\n+  }\n+\n+  private void updateConditionalContainer(VariableDefinitionContext variable) {\n+    ElementItem container = getConditionalContainer();\n+    variable.setContainer(container);\n+    if (container == null) {\n+      addError(messages.getMessage(PREVIOUS_WITHOUT_PIC_FOR_88, variable.getName()), variable.getDefinition());\n+    }\n+  }\n+\n+  private void defineVariable(VariableDefinitionContext variableDefinitionContext,\n+                              Function<VariableDefinitionContext, Variable> ... matchers) {\n+    Arrays.stream(matchers)\n+        .map(matcher -> matcher.apply(variableDefinitionContext))\n+        .filter(Objects::nonNull)\n+        .findFirst()\n+        .ifPresent(variable -> {\n+            // TODO: add check that value does not exceed PIC length\n+            ofNullable(structureStack.peek()).ifPresent(it -> it.addChild(variable));\n+            if (variable instanceof StructuredVariable) {\n+              structureStack.push((StructuredVariable)variable);\n+            }\n+            variables.push(variable);\n+        });\n+  }\n+\n+  private Variable multiTableDataNameMatcher(VariableDefinitionContext variable) {\n+    if (variable.getPicClauses().isEmpty() && !variable.getOccursClauses().isEmpty()) {\n+      MultiTableDataName result = new MultiTableDataName(\n+          variable.getNumber(),\n+          variable.getName(),\n+          variable.getQualifier(),\n+          variable.getDefinition(),\n+          retrieveOccursTimes(variable.getOccursClauses().get(0)),\n+          retrieveIndexItem(variable.getOccursClauses().get(0))", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "639e82812d2ef9393509e45b9cc53ea3167ccb38"}, "originalPosition": 416}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a3bc702163a8425d26ec16dfc27e17baa4f255ad", "author": {"user": {"login": "grianbrcom", "name": "Anton Grigorev"}}, "url": "https://github.com/eclipse/che-che4z-lsp-for-cobol/commit/a3bc702163a8425d26ec16dfc27e17baa4f255ad", "committedDate": "2020-12-09T15:34:38Z", "message": "refactor: VariableDefinitionDelegate refactoring\n\nSigned-off-by: Anton Grigorev <anton.grigorev@broadcom.com>"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "639e82812d2ef9393509e45b9cc53ea3167ccb38", "author": {"user": {"login": "grianbrcom", "name": "Anton Grigorev"}}, "url": "https://github.com/eclipse/che-che4z-lsp-for-cobol/commit/639e82812d2ef9393509e45b9cc53ea3167ccb38", "committedDate": "2020-12-09T11:33:59Z", "message": "refactor: VariableDefinitionDelegate refactoring\n\nSigned-off-by: Anton Grigorev <anton.grigorev@broadcom.com>"}, "afterCommit": {"oid": "a3bc702163a8425d26ec16dfc27e17baa4f255ad", "author": {"user": {"login": "grianbrcom", "name": "Anton Grigorev"}}, "url": "https://github.com/eclipse/che-che4z-lsp-for-cobol/commit/a3bc702163a8425d26ec16dfc27e17baa4f255ad", "committedDate": "2020-12-09T15:34:38Z", "message": "refactor: VariableDefinitionDelegate refactoring\n\nSigned-off-by: Anton Grigorev <anton.grigorev@broadcom.com>"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTQ5MDcwNTIw", "url": "https://github.com/eclipse/che-che4z-lsp-for-cobol/pull/699#pullrequestreview-549070520", "createdAt": "2020-12-10T10:46:38Z", "commit": {"oid": "a3bc702163a8425d26ec16dfc27e17baa4f255ad"}, "state": "COMMENTED", "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xMFQxMDo0NjozOFrOIDC_VQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xMFQxMDo0ODo1NFrOIDDFRg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MDA2NTYyMQ==", "bodyText": "SonarLint warns about possible heap pollution at this method", "url": "https://github.com/eclipse/che-che4z-lsp-for-cobol/pull/699#discussion_r540065621", "createdAt": "2020-12-10T10:46:38Z", "author": {"login": "temanbrcom"}, "path": "server/src/main/java/com/broadcom/lsp/cobol/core/visitor/VariableDefinitionDelegate.java", "diffHunk": "@@ -443,4 +344,244 @@ private void addError(String suggestion, Locality locality, ErrorSeverity severi\n     LOG.debug(\n         format(\"Syntax error defined by %s: %s\", getClass().getSimpleName(), error.toString()));\n   }\n+\n+  private void setFillerNameIfNeeded(VariableDefinitionContext variable) {\n+    if (variable.getName() == null) {\n+      variable.setName(OutlineNodeNames.FILLER_NAME);\n+    }\n+  }\n+\n+  private void checkVariableTypeAllowed(VariableDefinitionContext variable) {\n+    if (!section.allowsVariableType(variable.getAntlrClass())) {\n+      addError(messages.getMessage(DEFINITION_NOT_ALLOWED_IN_SECTION), variable.getDefinition());\n+    }\n+  }\n+\n+  private void checkStartingArea(VariableDefinitionContext variable) {\n+    if ((variable.getNumber() == 1 || variable.getNumber() == LEVEL_77)\n+        && variable.getStarting().getRange().getStart().getCharacter() > 10) {\n+      addError(AREA_A_WARNING, variable.getStarting(), WARNING);\n+    }\n+  }\n+\n+  private void closePreviousStructureIfNeeded(VariableDefinitionContext variable) {\n+    closePreviousStructureIfNeeded(variable.getNumber());\n+  }\n+\n+  private void checkTopElementNumber(VariableDefinitionContext variable) {\n+    int number = variable.getNumber();\n+    if (number == 1 || number == LEVEL_66 || number == LEVEL_77) return;\n+    addError(messages.getMessage(NUMBER_NOT_ALLOWED_AT_TOP), variable.getDefinition());\n+  }\n+\n+  private void updateQualifier(VariableDefinitionContext variable) {\n+    if (variable.getContainer() == null) {\n+      variable.setQualifier(retrieveQualifier(variable.getName()));\n+    } else {\n+      variable.setQualifier(variable.getContainer() + \" \" + variable.getName());\n+    }\n+  }\n+\n+  private void checkPictureClauseIsSingle(VariableDefinitionContext variable) {\n+    checkClauseIsSingle(variable.getPicClauses());\n+  }\n+\n+  private void checkOccursClauseIsSingle(VariableDefinitionContext variable) {\n+    checkClauseIsSingle(variable.getOccursClauses());\n+  }\n+\n+  private void checkValueClauseIsSingle(VariableDefinitionContext variable) {\n+    checkClauseIsSingle(variable.getValueClauses());\n+  }\n+\n+  private void checkClauseIsSingle(List<? extends ParserRuleContext> clauses) {\n+    if (clauses.size() > 1) {\n+      addError(\n+          messages.getMessage(TOO_MANY_CLAUSES_MSG, clauses.get(0).getStart().getText()),\n+          retrieveRangeLocality(clauses));\n+    }\n+  }\n+\n+  private void setValueClauseText(VariableDefinitionContext variable) {\n+    String valueClauseText = \"\";\n+    if (!variable.getValueClauses().isEmpty()) {\n+      valueClauseText = variable.getValueClauses().get(0).dataValueClauseLiteral().getText();\n+    }\n+    variable.setValueClauseTest(valueClauseText);\n+  }\n+\n+  private void updateConditionalContainer(VariableDefinitionContext variable) {\n+    ElementItem container = getConditionalContainer();\n+    variable.setContainer(container);\n+    if (container == null) {\n+      addError(messages.getMessage(PREVIOUS_WITHOUT_PIC_FOR_88, variable.getName()), variable.getDefinition());\n+    }\n+  }\n+\n+  private void defineVariable(VariableDefinitionContext variableDefinitionContext,", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "a3bc702163a8425d26ec16dfc27e17baa4f255ad"}, "originalPosition": 415}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MDA2NzA1Nw==", "bodyText": "May be returned immediately", "url": "https://github.com/eclipse/che-che4z-lsp-for-cobol/pull/699#discussion_r540067057", "createdAt": "2020-12-10T10:48:46Z", "author": {"login": "temanbrcom"}, "path": "server/src/main/java/com/broadcom/lsp/cobol/core/visitor/VariableDefinitionDelegate.java", "diffHunk": "@@ -443,4 +344,244 @@ private void addError(String suggestion, Locality locality, ErrorSeverity severi\n     LOG.debug(\n         format(\"Syntax error defined by %s: %s\", getClass().getSimpleName(), error.toString()));\n   }\n+\n+  private void setFillerNameIfNeeded(VariableDefinitionContext variable) {\n+    if (variable.getName() == null) {\n+      variable.setName(OutlineNodeNames.FILLER_NAME);\n+    }\n+  }\n+\n+  private void checkVariableTypeAllowed(VariableDefinitionContext variable) {\n+    if (!section.allowsVariableType(variable.getAntlrClass())) {\n+      addError(messages.getMessage(DEFINITION_NOT_ALLOWED_IN_SECTION), variable.getDefinition());\n+    }\n+  }\n+\n+  private void checkStartingArea(VariableDefinitionContext variable) {\n+    if ((variable.getNumber() == 1 || variable.getNumber() == LEVEL_77)\n+        && variable.getStarting().getRange().getStart().getCharacter() > 10) {\n+      addError(AREA_A_WARNING, variable.getStarting(), WARNING);\n+    }\n+  }\n+\n+  private void closePreviousStructureIfNeeded(VariableDefinitionContext variable) {\n+    closePreviousStructureIfNeeded(variable.getNumber());\n+  }\n+\n+  private void checkTopElementNumber(VariableDefinitionContext variable) {\n+    int number = variable.getNumber();\n+    if (number == 1 || number == LEVEL_66 || number == LEVEL_77) return;\n+    addError(messages.getMessage(NUMBER_NOT_ALLOWED_AT_TOP), variable.getDefinition());\n+  }\n+\n+  private void updateQualifier(VariableDefinitionContext variable) {\n+    if (variable.getContainer() == null) {\n+      variable.setQualifier(retrieveQualifier(variable.getName()));\n+    } else {\n+      variable.setQualifier(variable.getContainer() + \" \" + variable.getName());\n+    }\n+  }\n+\n+  private void checkPictureClauseIsSingle(VariableDefinitionContext variable) {\n+    checkClauseIsSingle(variable.getPicClauses());\n+  }\n+\n+  private void checkOccursClauseIsSingle(VariableDefinitionContext variable) {\n+    checkClauseIsSingle(variable.getOccursClauses());\n+  }\n+\n+  private void checkValueClauseIsSingle(VariableDefinitionContext variable) {\n+    checkClauseIsSingle(variable.getValueClauses());\n+  }\n+\n+  private void checkClauseIsSingle(List<? extends ParserRuleContext> clauses) {\n+    if (clauses.size() > 1) {\n+      addError(\n+          messages.getMessage(TOO_MANY_CLAUSES_MSG, clauses.get(0).getStart().getText()),\n+          retrieveRangeLocality(clauses));\n+    }\n+  }\n+\n+  private void setValueClauseText(VariableDefinitionContext variable) {\n+    String valueClauseText = \"\";\n+    if (!variable.getValueClauses().isEmpty()) {\n+      valueClauseText = variable.getValueClauses().get(0).dataValueClauseLiteral().getText();\n+    }\n+    variable.setValueClauseTest(valueClauseText);\n+  }\n+\n+  private void updateConditionalContainer(VariableDefinitionContext variable) {\n+    ElementItem container = getConditionalContainer();\n+    variable.setContainer(container);\n+    if (container == null) {\n+      addError(messages.getMessage(PREVIOUS_WITHOUT_PIC_FOR_88, variable.getName()), variable.getDefinition());\n+    }\n+  }\n+\n+  private void defineVariable(VariableDefinitionContext variableDefinitionContext,\n+                              Function<VariableDefinitionContext, Variable> ... matchers) {\n+    Arrays.stream(matchers)\n+        .map(matcher -> matcher.apply(variableDefinitionContext))\n+        .filter(Objects::nonNull)\n+        .findFirst()\n+        .ifPresent(variable -> {\n+            // TODO: add check that value does not exceed PIC length\n+            ofNullable(structureStack.peek()).ifPresent(it -> it.addChild(variable));\n+            if (variable instanceof StructuredVariable) {\n+              structureStack.push((StructuredVariable)variable);\n+            }\n+            variables.push(variable);\n+        });\n+  }\n+\n+  private Variable multiTableDataNameMatcher(VariableDefinitionContext variable) {\n+    if (variable.getPicClauses().isEmpty() && !variable.getOccursClauses().isEmpty()) {\n+      MultiTableDataName result = new MultiTableDataName(\n+          variable.getNumber(),\n+          variable.getName(),\n+          variable.getQualifier(),\n+          variable.getDefinition(),\n+          retrieveOccursTimes(variable.getOccursClauses().get(0)),\n+          retrieveIndexItem(variable.getOccursClauses().get(0))\n+      );\n+      result.getIndexes().forEach(variables::push);\n+      return result;\n+    }\n+    return null;\n+  }\n+\n+  private Variable groupItemMatcher(VariableDefinitionContext variable) {\n+    if (variable.getPicClauses().isEmpty() && variable.getOccursClauses().isEmpty()) {\n+      GroupItem result = new GroupItem(", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "a3bc702163a8425d26ec16dfc27e17baa4f255ad"}, "originalPosition": 449}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MDA2NzE0Mg==", "bodyText": "May be returned immediately", "url": "https://github.com/eclipse/che-che4z-lsp-for-cobol/pull/699#discussion_r540067142", "createdAt": "2020-12-10T10:48:54Z", "author": {"login": "temanbrcom"}, "path": "server/src/main/java/com/broadcom/lsp/cobol/core/visitor/VariableDefinitionDelegate.java", "diffHunk": "@@ -443,4 +344,244 @@ private void addError(String suggestion, Locality locality, ErrorSeverity severi\n     LOG.debug(\n         format(\"Syntax error defined by %s: %s\", getClass().getSimpleName(), error.toString()));\n   }\n+\n+  private void setFillerNameIfNeeded(VariableDefinitionContext variable) {\n+    if (variable.getName() == null) {\n+      variable.setName(OutlineNodeNames.FILLER_NAME);\n+    }\n+  }\n+\n+  private void checkVariableTypeAllowed(VariableDefinitionContext variable) {\n+    if (!section.allowsVariableType(variable.getAntlrClass())) {\n+      addError(messages.getMessage(DEFINITION_NOT_ALLOWED_IN_SECTION), variable.getDefinition());\n+    }\n+  }\n+\n+  private void checkStartingArea(VariableDefinitionContext variable) {\n+    if ((variable.getNumber() == 1 || variable.getNumber() == LEVEL_77)\n+        && variable.getStarting().getRange().getStart().getCharacter() > 10) {\n+      addError(AREA_A_WARNING, variable.getStarting(), WARNING);\n+    }\n+  }\n+\n+  private void closePreviousStructureIfNeeded(VariableDefinitionContext variable) {\n+    closePreviousStructureIfNeeded(variable.getNumber());\n+  }\n+\n+  private void checkTopElementNumber(VariableDefinitionContext variable) {\n+    int number = variable.getNumber();\n+    if (number == 1 || number == LEVEL_66 || number == LEVEL_77) return;\n+    addError(messages.getMessage(NUMBER_NOT_ALLOWED_AT_TOP), variable.getDefinition());\n+  }\n+\n+  private void updateQualifier(VariableDefinitionContext variable) {\n+    if (variable.getContainer() == null) {\n+      variable.setQualifier(retrieveQualifier(variable.getName()));\n+    } else {\n+      variable.setQualifier(variable.getContainer() + \" \" + variable.getName());\n+    }\n+  }\n+\n+  private void checkPictureClauseIsSingle(VariableDefinitionContext variable) {\n+    checkClauseIsSingle(variable.getPicClauses());\n+  }\n+\n+  private void checkOccursClauseIsSingle(VariableDefinitionContext variable) {\n+    checkClauseIsSingle(variable.getOccursClauses());\n+  }\n+\n+  private void checkValueClauseIsSingle(VariableDefinitionContext variable) {\n+    checkClauseIsSingle(variable.getValueClauses());\n+  }\n+\n+  private void checkClauseIsSingle(List<? extends ParserRuleContext> clauses) {\n+    if (clauses.size() > 1) {\n+      addError(\n+          messages.getMessage(TOO_MANY_CLAUSES_MSG, clauses.get(0).getStart().getText()),\n+          retrieveRangeLocality(clauses));\n+    }\n+  }\n+\n+  private void setValueClauseText(VariableDefinitionContext variable) {\n+    String valueClauseText = \"\";\n+    if (!variable.getValueClauses().isEmpty()) {\n+      valueClauseText = variable.getValueClauses().get(0).dataValueClauseLiteral().getText();\n+    }\n+    variable.setValueClauseTest(valueClauseText);\n+  }\n+\n+  private void updateConditionalContainer(VariableDefinitionContext variable) {\n+    ElementItem container = getConditionalContainer();\n+    variable.setContainer(container);\n+    if (container == null) {\n+      addError(messages.getMessage(PREVIOUS_WITHOUT_PIC_FOR_88, variable.getName()), variable.getDefinition());\n+    }\n+  }\n+\n+  private void defineVariable(VariableDefinitionContext variableDefinitionContext,\n+                              Function<VariableDefinitionContext, Variable> ... matchers) {\n+    Arrays.stream(matchers)\n+        .map(matcher -> matcher.apply(variableDefinitionContext))\n+        .filter(Objects::nonNull)\n+        .findFirst()\n+        .ifPresent(variable -> {\n+            // TODO: add check that value does not exceed PIC length\n+            ofNullable(structureStack.peek()).ifPresent(it -> it.addChild(variable));\n+            if (variable instanceof StructuredVariable) {\n+              structureStack.push((StructuredVariable)variable);\n+            }\n+            variables.push(variable);\n+        });\n+  }\n+\n+  private Variable multiTableDataNameMatcher(VariableDefinitionContext variable) {\n+    if (variable.getPicClauses().isEmpty() && !variable.getOccursClauses().isEmpty()) {\n+      MultiTableDataName result = new MultiTableDataName(\n+          variable.getNumber(),\n+          variable.getName(),\n+          variable.getQualifier(),\n+          variable.getDefinition(),\n+          retrieveOccursTimes(variable.getOccursClauses().get(0)),\n+          retrieveIndexItem(variable.getOccursClauses().get(0))\n+      );\n+      result.getIndexes().forEach(variables::push);\n+      return result;\n+    }\n+    return null;\n+  }\n+\n+  private Variable groupItemMatcher(VariableDefinitionContext variable) {\n+    if (variable.getPicClauses().isEmpty() && variable.getOccursClauses().isEmpty()) {\n+      GroupItem result = new GroupItem(\n+          variable.getNumber(),\n+          variable.getName(),\n+          variable.getQualifier(),\n+          variable.getDefinition()\n+      );\n+      return result;\n+    }\n+    return null;\n+  }\n+\n+  private Variable tableDataNameMatcher(VariableDefinitionContext variable) {\n+    if (!variable.getPicClauses().isEmpty() && !variable.getOccursClauses().isEmpty()) {\n+      TableDataName tableDataName = new TableDataName(\n+          variable.getName(),\n+          variable.getQualifier(),\n+          variable.getDefinition(),\n+          retrievePicText(variable.getPicClauses().get(0)),\n+          variable.getValueClauseTest(),\n+          retrieveOccursTimes(variable.getOccursClauses().get(0)),\n+          retrieveIndexItem(variable.getOccursClauses().get(0))\n+      );\n+      tableDataName.getIndexes().forEach(variables::push);\n+      return tableDataName;\n+    }\n+    return null;\n+  }\n+\n+  private Variable elementItemMatcher(VariableDefinitionContext variable) {\n+    if (!variable.getPicClauses().isEmpty() && variable.getOccursClauses().isEmpty()) {\n+      ElementItem result = new ElementItem(", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "a3bc702163a8425d26ec16dfc27e17baa4f255ad"}, "originalPosition": 479}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 943, "cost": 1, "resetAt": "2021-11-01T13:51:04Z"}}}