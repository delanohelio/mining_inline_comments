{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDQyNzg2NjU4", "number": 410, "title": "Fix sending download requests for nested copybooks", "bodyText": "", "createdAt": "2020-07-01T15:47:11Z", "url": "https://github.com/eclipse/che-che4z-lsp-for-cobol/pull/410", "merged": true, "mergeCommit": {"oid": "4522ffdd2d5f21100df17a4b1bcf3ce2eef9d781"}, "closed": true, "closedAt": "2020-07-02T11:13:53Z", "author": {"login": "temanbrcom"}, "timelineItems": {"totalCount": 5, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcw6z9vAFqTQ0MTQ3NDI2Ng==", "endCursor": "Y3Vyc29yOnYyOpPPAAABcw800zgFqTQ0MTU3NTUxMw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDQxNDc0MjY2", "url": "https://github.com/eclipse/che-che4z-lsp-for-cobol/pull/410#pullrequestreview-441474266", "createdAt": "2020-07-02T08:45:42Z", "commit": {"oid": "b8c997fe47e6f63323fbd6a1734a8768c7ccc7e5"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDQxNTQ5NjI1", "url": "https://github.com/eclipse/che-che4z-lsp-for-cobol/pull/410#pullrequestreview-441549625", "createdAt": "2020-07-02T10:26:21Z", "commit": {"oid": "b8c997fe47e6f63323fbd6a1734a8768c7ccc7e5"}, "state": "APPROVED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wMlQxMDoyNjoyMlrOGsG8jg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wMlQxMDoyOTowMlrOGsHBnQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0ODkwNDMzNA==", "bodyText": "Maybe, it will be better to use Set of uris here.", "url": "https://github.com/eclipse/che-che4z-lsp-for-cobol/pull/410#discussion_r448904334", "createdAt": "2020-07-02T10:26:22Z", "author": {"login": "grianbrcom"}, "path": "com.ca.lsp.cobol/lsp-service-cobol/src/main/java/com/ca/lsp/cobol/service/CopybookServiceImpl.java", "diffHunk": "@@ -127,26 +126,36 @@ private void handleRequiredCopybookEvent(RequiredCopybookEvent event) {\n   /**\n    * Sends downloading requests to the Client for copybooks not presented locally, if any.\n    *\n-   * <p>A list of missed copybooks grouped by document URI.\n+   * <p>A list of missed copybooks grouped by document URI, including nested copybooks.\n    *\n    * @param event - document analysis done\n    */\n   private void handleAnalysisFinishedEvent(AnalysisFinishedEvent event) {\n-    String cobolFileName = files.getNameFromURI(event.getDocumentUri());\n-    if (copybooksForDownloading.containsKey(cobolFileName)) {\n-      settingsService\n-              .getConfigurations(copybooksForDownloading.remove(cobolFileName).stream()\n-                      .map(copybook -> Joiner.on(\".\").join(COPYBOOK_DOWNLOAD.label, cobolFileName, copybook))\n-                      .collect(Collectors.toList()));\n+    List<String> uris = new ArrayList<>(event.getUris());\n+    String documentUri = event.getDocumentUri();\n+    if (!uris.contains(documentUri)) uris.add(documentUri);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b8c997fe47e6f63323fbd6a1734a8768c7ccc7e5"}, "originalPosition": 88}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0ODkwNTYyOQ==", "bodyText": "copybookUris will better suit here.", "url": "https://github.com/eclipse/che-che4z-lsp-for-cobol/pull/410#discussion_r448905629", "createdAt": "2020-07-02T10:29:02Z", "author": {"login": "grianbrcom"}, "path": "com.ca.lsp.cobol/lsp-core-domain/src/main/java/com/broadcom/lsp/domain/cobol/event/model/AnalysisFinishedEvent.java", "diffHunk": "@@ -16,19 +16,26 @@\n \n import lombok.Builder;\n import lombok.Data;\n+import lombok.EqualsAndHashCode;\n import lombok.NoArgsConstructor;\n \n+import java.util.List;\n+\n /**\n- * This class is a signal object to show that analysis is finished. Contains the uri of analyzed document.\n+ * This class is a signal object to show that analysis finished. Contains the uri of analyzed\n+ * document.\n  */\n+@EqualsAndHashCode(callSuper = false)\n @NoArgsConstructor\n @Data\n-public class AnalysisFinishedEvent extends DataEvent{\n-    private String documentUri;\n+public class AnalysisFinishedEvent extends DataEvent {\n+  private String documentUri;\n+  private List<String> uris;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b8c997fe47e6f63323fbd6a1734a8768c7ccc7e5"}, "originalPosition": 21}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "5920e82df2babd67b32b18edd58fd38fc4ebd361", "author": {"user": {"login": "temanbrcom", "name": "Andrei Temnikov"}}, "url": "https://github.com/eclipse/che-che4z-lsp-for-cobol/commit/5920e82df2babd67b32b18edd58fd38fc4ebd361", "committedDate": "2020-07-02T10:47:36Z", "message": "refactor: Fix sending download requests for nested copybooks #400"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "b8c997fe47e6f63323fbd6a1734a8768c7ccc7e5", "author": {"user": {"login": "temanbrcom", "name": "Andrei Temnikov"}}, "url": "https://github.com/eclipse/che-che4z-lsp-for-cobol/commit/b8c997fe47e6f63323fbd6a1734a8768c7ccc7e5", "committedDate": "2020-07-01T15:45:59Z", "message": "refactor: Fix sending download requests for nested copybooks #400"}, "afterCommit": {"oid": "5920e82df2babd67b32b18edd58fd38fc4ebd361", "author": {"user": {"login": "temanbrcom", "name": "Andrei Temnikov"}}, "url": "https://github.com/eclipse/che-che4z-lsp-for-cobol/commit/5920e82df2babd67b32b18edd58fd38fc4ebd361", "committedDate": "2020-07-02T10:47:36Z", "message": "refactor: Fix sending download requests for nested copybooks #400"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDQxNTc1NTEz", "url": "https://github.com/eclipse/che-che4z-lsp-for-cobol/pull/410#pullrequestreview-441575513", "createdAt": "2020-07-02T11:06:27Z", "commit": {"oid": "5920e82df2babd67b32b18edd58fd38fc4ebd361"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 954, "cost": 1, "resetAt": "2021-11-01T13:51:04Z"}}}