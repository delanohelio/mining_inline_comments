{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0Mzc3MjMzMjg3", "number": 210, "title": "Copybook references", "bodyText": "#107\nAdded support for finding copybook references", "createdAt": "2020-02-19T15:50:39Z", "url": "https://github.com/eclipse/che-che4z-lsp-for-cobol/pull/210", "merged": true, "mergeCommit": {"oid": "034e5f22c2bf704f124adea14a847cde488fa9d0"}, "closed": true, "closedAt": "2020-02-24T12:56:47Z", "author": {"login": "abdrabrcom"}, "timelineItems": {"totalCount": 23, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcBX-ZxgH2gAyMzc3MjMzMjg3OmZjZjNmYWY0Mjg5YjE0Nzc0MzhmYWM3Yzg2ZmU2NWYxYmNhMTQ5OTE=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcHbM35gH2gAyMzc3MjMzMjg3OjRiMTY4MDdjNGNiNTc5YjBhMzAyMTVmZGU3NjJlYjdhYjMzYTQ4NDM=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "fcf3faf4289b1477438fac7c86fe65f1bca14991", "author": {"user": null}, "url": "https://github.com/eclipse/che-che4z-lsp-for-cobol/commit/fcf3faf4289b1477438fac7c86fe65f1bca14991", "committedDate": "2020-02-05T15:35:59Z", "message": "added implementation for copybook autocomplete from cobol document and fixed tests\n\nSigned-off-by: Ramy Abdalla <ramy.abdalla@broadcom.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "809c5fc662ef26bcff412b1d76177ddae7fa01f9", "author": {"user": null}, "url": "https://github.com/eclipse/che-che4z-lsp-for-cobol/commit/809c5fc662ef26bcff412b1d76177ddae7fa01f9", "committedDate": "2020-02-06T11:13:36Z", "message": "added junit test for CopybookCompletion class\n\nSigned-off-by: Ramy Abdalla <ramy.abdalla@broadcom.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "5db920082b39a37981a15ed80195422d9f9fe473", "author": {"user": null}, "url": "https://github.com/eclipse/che-che4z-lsp-for-cobol/commit/5db920082b39a37981a15ed80195422d9f9fe473", "committedDate": "2020-02-06T11:15:09Z", "message": "adding CopybookCompletionsTest to AllTests\n\nSigned-off-by: Ramy Abdalla <ramy.abdalla@broadcom.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "abc86d84d7b3afe38d4c163a0f7e8b1e96079dec", "author": {"user": null}, "url": "https://github.com/eclipse/che-che4z-lsp-for-cobol/commit/abc86d84d7b3afe38d4c163a0f7e8b1e96079dec", "committedDate": "2020-02-06T11:16:32Z", "message": "Merge branch 'development' into copybooks_autocomplete"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "be2164c03d20b40d205455f83e2b5160d465878e", "author": {"user": null}, "url": "https://github.com/eclipse/che-che4z-lsp-for-cobol/commit/be2164c03d20b40d205455f83e2b5160d465878e", "committedDate": "2020-02-06T13:11:36Z", "message": "Merge branch 'development' into copybooks_autocomplete"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "4306d075f8b0d2eb96f5061d39815a26ef62c314", "author": {"user": null}, "url": "https://github.com/eclipse/che-che4z-lsp-for-cobol/commit/4306d075f8b0d2eb96f5061d39815a26ef62c314", "committedDate": "2020-02-06T13:12:28Z", "message": "added javadocs annotation for both CopybookCompletion and CopybookCompletionTest\n\nSigned-off-by: Ramy Abdalla <ramy.abdalla@broadcom.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b26663b4fb784b5905dfc6e45f747c774570cb38", "author": {"user": null}, "url": "https://github.com/eclipse/che-che4z-lsp-for-cobol/commit/b26663b4fb784b5905dfc6e45f747c774570cb38", "committedDate": "2020-02-07T10:08:46Z", "message": "reverted back packagejson and packagelock fixing naming issue and adding missing entry to testmodule\n\nSigned-off-by: Ramy Abdalla <ramy.abdalla@broadcom.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "24159302f51cfb90a654e783fb2285b8f098ac8a", "author": {"user": null}, "url": "https://github.com/eclipse/che-che4z-lsp-for-cobol/commit/24159302f51cfb90a654e783fb2285b8f098ac8a", "committedDate": "2020-02-07T10:09:52Z", "message": "Merge branch 'development' into copybooks_autocomplete"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "67daa43dfa1773437cf6c2c999899ea203a96ee8", "author": {"user": null}, "url": "https://github.com/eclipse/che-che4z-lsp-for-cobol/commit/67daa43dfa1773437cf6c2c999899ea203a96ee8", "committedDate": "2020-02-07T10:20:41Z", "message": "fixed packagelock\n\nSigned-off-by: Ramy Abdalla <ramy.abdalla@broadcom.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "268de2b070d869f81f4206a98220a377206a9507", "author": {"user": null}, "url": "https://github.com/eclipse/che-che4z-lsp-for-cobol/commit/268de2b070d869f81f4206a98220a377206a9507", "committedDate": "2020-02-11T11:09:45Z", "message": "Merge branch 'development' into copybooks_autocomplete"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "71f74592f67e3a9351aec176ef4a2978dd4319b2", "author": {"user": null}, "url": "https://github.com/eclipse/che-che4z-lsp-for-cobol/commit/71f74592f67e3a9351aec176ef4a2978dd4319b2", "committedDate": "2020-02-11T13:24:21Z", "message": "added implementation for copybook usage reference\n\nSigned-off-by: Ramy Abdalla <ramy.abdalla@broadcom.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ffed222c5d6db8a0092513aafd2728393afbca48", "author": {"user": null}, "url": "https://github.com/eclipse/che-che4z-lsp-for-cobol/commit/ffed222c5d6db8a0092513aafd2728393afbca48", "committedDate": "2020-02-17T14:13:53Z", "message": "Merge branch 'development' into copybook_references"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "bbe37b4853c7b54f54afbc8dc17aa53829b6ee7f", "author": {"user": null}, "url": "https://github.com/eclipse/che-che4z-lsp-for-cobol/commit/bbe37b4853c7b54f54afbc8dc17aa53829b6ee7f", "committedDate": "2020-02-18T10:28:28Z", "message": "merging development\n\nSigned-off-by: Ramy Abdalla <ramy.abdalla@broadcom.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "22c65eecc40494b42b065389941cc47b4cfb02b2", "author": {"user": null}, "url": "https://github.com/eclipse/che-che4z-lsp-for-cobol/commit/22c65eecc40494b42b065389941cc47b4cfb02b2", "committedDate": "2020-02-18T10:31:14Z", "message": "adding implementation for copybook references\n\nSigned-off-by: Ramy Abdalla <ramy.abdalla@broadcom.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "1bafc35ff2fa80ce3a26cafb584db5dd48b16468", "author": {"user": null}, "url": "https://github.com/eclipse/che-che4z-lsp-for-cobol/commit/1bafc35ff2fa80ce3a26cafb584db5dd48b16468", "committedDate": "2020-02-19T10:14:44Z", "message": "Merge branch 'development' into copybook_references"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "4fe7b57ac92950b3d000835477afa62bc13b86e6", "author": {"user": null}, "url": "https://github.com/eclipse/che-che4z-lsp-for-cobol/commit/4fe7b57ac92950b3d000835477afa62bc13b86e6", "committedDate": "2020-02-19T15:30:01Z", "message": "Merge branch 'development' into copybook_references"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "dfc6df1dbd9e2c12d6478efd88203793351f6409", "author": {"user": null}, "url": "https://github.com/eclipse/che-che4z-lsp-for-cobol/commit/dfc6df1dbd9e2c12d6478efd88203793351f6409", "committedDate": "2020-02-19T15:32:32Z", "message": "added test for copybook references and adjustted copybooks to show on usages\n\nSigned-off-by: Ramy Abdalla <ramy.abdalla@broadcom.com>"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzYxNzE2NTI5", "url": "https://github.com/eclipse/che-che4z-lsp-for-cobol/pull/210#pullrequestreview-361716529", "createdAt": "2020-02-20T08:42:26Z", "commit": {"oid": "dfc6df1dbd9e2c12d6478efd88203793351f6409"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzYxNzQ1Nzgx", "url": "https://github.com/eclipse/che-che4z-lsp-for-cobol/pull/210#pullrequestreview-361745781", "createdAt": "2020-02-20T09:26:44Z", "commit": {"oid": "dfc6df1dbd9e2c12d6478efd88203793351f6409"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yMFQwOToyNjo0NFrOFsL7LA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yMFQwOTozMDozM1rOFsMEHQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MTg3NzAzNg==", "bodyText": "It seems like the problem with the test caused by this line. I think define() here should be also replaced with addUsage()", "url": "https://github.com/eclipse/che-che4z-lsp-for-cobol/pull/210#discussion_r381877036", "createdAt": "2020-02-20T09:26:44Z", "author": {"login": "temanbrcom"}, "path": "com.ca.lsp.cobol/lsp-core-cobol-parser/src/main/java/com/ca/lsp/core/cobol/preprocessor/sub/document/impl/CobolSemanticParserListenerImpl.java", "diffHunk": "@@ -193,7 +193,7 @@ private void defineCopybook(String copybookName, Position position) {\n       return;\n     }\n     if (checkThisCopybookNotPresentInHierarchy(copybookName)) {\n-      semanticContext.getCopybooks().define(copybookName, position);\n+      semanticContext.getCopybooks().addUsage(copybookName, position);\n       semanticContext.getVariables().define(new Variable(\"-1\", copybookName), position);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "dfc6df1dbd9e2c12d6478efd88203793351f6409"}, "originalPosition": 6}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MTg3OTMyNQ==", "bodyText": "Also, try to replace definitions call in CobolVariableContext#buildVariableStructure() with one for usages", "url": "https://github.com/eclipse/che-che4z-lsp-for-cobol/pull/210#discussion_r381879325", "createdAt": "2020-02-20T09:30:33Z", "author": {"login": "temanbrcom"}, "path": "com.ca.lsp.cobol/lsp-core-cobol-parser/src/main/java/com/ca/lsp/core/cobol/preprocessor/sub/document/impl/CobolSemanticParserListenerImpl.java", "diffHunk": "@@ -193,7 +193,7 @@ private void defineCopybook(String copybookName, Position position) {\n       return;\n     }\n     if (checkThisCopybookNotPresentInHierarchy(copybookName)) {\n-      semanticContext.getCopybooks().define(copybookName, position);\n+      semanticContext.getCopybooks().addUsage(copybookName, position);\n       semanticContext.getVariables().define(new Variable(\"-1\", copybookName), position);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MTg3NzAzNg=="}, "originalCommit": {"oid": "dfc6df1dbd9e2c12d6478efd88203793351f6409"}, "originalPosition": 6}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "8dd61b5f383f8e711c1c23a91db31cd5c55dc8eb", "author": {"user": {"login": "temanbrcom", "name": "Andrei Temnikov"}}, "url": "https://github.com/eclipse/che-che4z-lsp-for-cobol/commit/8dd61b5f383f8e711c1c23a91db31cd5c55dc8eb", "committedDate": "2020-02-21T15:50:07Z", "message": "Make copybook processing work with usages, not with definitions #107"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzYzMjEwNzc4", "url": "https://github.com/eclipse/che-che4z-lsp-for-cobol/pull/210#pullrequestreview-363210778", "createdAt": "2020-02-24T08:00:31Z", "commit": {"oid": "8dd61b5f383f8e711c1c23a91db31cd5c55dc8eb"}, "state": "APPROVED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yNFQwODowMDozMlrOFtX0mw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yNFQwODowMDozMlrOFtX0mw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MzEyMDUzOQ==", "bodyText": "could you please provide a negative scenario as well in which you will try to get a reference and there is none", "url": "https://github.com/eclipse/che-che4z-lsp-for-cobol/pull/210#discussion_r383120539", "createdAt": "2020-02-24T08:00:32Z", "author": {"login": "sergiuilie"}, "path": "com.ca.lsp.cobol/lsp-service-cobol/src/test/java/com/ca/lsp/cobol/service/delegates/references/DocumentOccurrencesTest.java", "diffHunk": "@@ -159,6 +175,23 @@ public void testFindDeclarationForParagraph() throws ExecutionException, Interru\n     assertContainsRange(locations, range(15, 7, TEST_LENGTH));\n   }\n \n+  @Test\n+  public void testFindMultipleCopybookReferences() throws ExecutionException, InterruptedException {\n+    List<? extends Location> locations = invokeReferencesRequest(TEST_COPYBOOK1, true);\n+    assertEquals(2, locations.size());\n+\n+    assertContainsRange(locations, range(20, 12, COPY_LENGTH));\n+    assertContainsRange(locations, range(22, 12, COPY_LENGTH));\n+  }\n+\n+  @Test\n+  public void testFindSingleCopybookReference() throws ExecutionException, InterruptedException {\n+    List<? extends Location> locations = invokeReferencesRequest(TEST_COPYBOOK2, true);\n+    assertEquals(1, locations.size());\n+\n+    assertContainsRange(locations, range(21, 12, COPY_LENGTH));", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "8dd61b5f383f8e711c1c23a91db31cd5c55dc8eb"}, "originalPosition": 67}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "09c712958ecd63779de703470a6ef5fdf0bd3d48", "author": {"user": null}, "url": "https://github.com/eclipse/che-che4z-lsp-for-cobol/commit/09c712958ecd63779de703470a6ef5fdf0bd3d48", "committedDate": "2020-02-24T09:43:21Z", "message": "Merge branch 'development' into copybook_references"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "4b16807c4cb579b0a30215fde762eb7ab33a4843", "author": {"user": null}, "url": "https://github.com/eclipse/che-che4z-lsp-for-cobol/commit/4b16807c4cb579b0a30215fde762eb7ab33a4843", "committedDate": "2020-02-24T10:45:03Z", "message": "resolving conflicts\n\nSigned-off-by: Ramy Abdalla <ramy.abdalla@broadcom.com>"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1213, "cost": 1, "resetAt": "2021-11-01T13:51:04Z"}}}