{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0Mzg0NTA1NTQw", "number": 227, "title": "Finalize LRU algorithm #226", "bodyText": "", "createdAt": "2020-03-05T21:18:54Z", "url": "https://github.com/eclipse/che-che4z-lsp-for-cobol/pull/227", "merged": true, "mergeCommit": {"oid": "692d640e5b3fc2ba6d6d48d896c186164887b21a"}, "closed": true, "closedAt": "2020-03-06T13:38:52Z", "author": {"login": "sergiuilie"}, "timelineItems": {"totalCount": 6, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcKyMQfAH2gAyMzg0NTA1NTQwOjZhODVmZDFiMTFlMDMwZTBhNmU5ODk4MDc3NDQxZTllNWU4MTI1MzA=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcK_yCgAFqTM3MDMwNTMxMA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "6a85fd1b11e030e0a6e9898077441e9e5e812530", "author": {"user": {"login": "sergiuilie", "name": "Sergiu Ilie"}}, "url": "https://github.com/eclipse/che-che4z-lsp-for-cobol/commit/6a85fd1b11e030e0a6e9898077441e9e5e812530", "committedDate": "2020-03-05T21:13:58Z", "message": "Finalize LRU algorithm by adding the time"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "082f114b526b97361b969145b73b2fdef7d6932e", "author": {"user": {"login": "sergiuilie", "name": "Sergiu Ilie"}}, "url": "https://github.com/eclipse/che-che4z-lsp-for-cobol/commit/082f114b526b97361b969145b73b2fdef7d6932e", "committedDate": "2020-03-05T21:21:36Z", "message": "update CHANGELOG.md"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzcwMTQ3MTYx", "url": "https://github.com/eclipse/che-che4z-lsp-for-cobol/pull/227#pullrequestreview-370147161", "createdAt": "2020-03-06T08:20:40Z", "commit": {"oid": "082f114b526b97361b969145b73b2fdef7d6932e"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wNlQwODoyMDo0MFrOFywYWw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wNlQwODoyMDo0MFrOFywYWw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4ODc2NTc4Nw==", "bodyText": "We can use the method reference directly CopybookStorable::isExpired", "url": "https://github.com/eclipse/che-che4z-lsp-for-cobol/pull/227#discussion_r388765787", "createdAt": "2020-03-06T08:20:40Z", "author": {"login": "zacanbrcom"}, "path": "com.ca.lsp.cobol/lsp-core-domain/src/main/java/com/broadcom/lsp/domain/cobol/databus/impl/CopybookRepositoryLRU.java", "diffHunk": "@@ -84,6 +88,8 @@ public void setSort(boolean isSort) {\n   @Override\n   @SneakyThrows\n   public synchronized void persist(@NonNull CopybookStorable deepCopy) {\n+    cpyRepo.removeIf(elem -> elem.isExpired());", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "082f114b526b97361b969145b73b2fdef7d6932e"}, "originalPosition": 24}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzcwMTU3NzY1", "url": "https://github.com/eclipse/che-che4z-lsp-for-cobol/pull/227#pullrequestreview-370157765", "createdAt": "2020-03-06T08:41:30Z", "commit": {"oid": "082f114b526b97361b969145b73b2fdef7d6932e"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wNlQwODo0MTozMFrOFyw5fw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wNlQwODo0MTozMFrOFyw5fw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4ODc3NDI3MQ==", "bodyText": "Here is better use to use a waiter", "url": "https://github.com/eclipse/che-che4z-lsp-for-cobol/pull/227#discussion_r388774271", "createdAt": "2020-03-06T08:41:30Z", "author": {"login": "zacanbrcom"}, "path": "com.ca.lsp.cobol/lsp-core-domain/src/test/java/com/broadcom/lsp/domain/cobol/databus/impl/CopybookRepositoryLRUTest.java", "diffHunk": "@@ -62,6 +66,60 @@ public void testPersist() {\n     assertEquals(repository.size(), prevCacheSize + 1);\n   }\n \n+  /**\n+   * This test validates that the cache is throwing the expired elements away, the elements which\n+   * are older than 3h\n+   *\n+   * @throws NoSuchFieldException\n+   */\n+  @Test\n+  public void testCacheExpiration() throws NoSuchFieldException {\n+    long genDt = Instant.now().minus(4, ChronoUnit.HOURS).getEpochSecond();\n+\n+    CopybookStorable storableCpy = new CopybookStorable(\"REMOVE\", \"URI\", \"DUMMY CONTENT\");\n+    Field f = storableCpy.getClass().getDeclaredField(\"genDt\");\n+    f.setAccessible(true);\n+    FieldSetter.setField(storableCpy, f, genDt);\n+\n+    repository.persist(storableCpy);\n+    repository.persist(new CopybookStorable(\"NEW_STO\", \"URI\", \"DUMMY CONTENT\"));\n+    repository.persist(new CopybookStorable(\"NEW_STO232\", \"URI\", \"DUMMY CONTENT\"));\n+    repository.persist(new CopybookStorable(\"NEW_STO\", \"URI\", \"DUMMY CONTENT\"));\n+\n+    assertEquals(3, repository.size());\n+  }\n+\n+  /**\n+   * This test validates the cache sort mechanism, first is sorted by the hits and after by the\n+   * time, it is worth to mention that we need to put the thread asleep for 1ms in order to have a\n+   * time difference at the creation moment, if not it will not differentiate and the order will be\n+   * not the expected one\n+   *\n+   * @throws InterruptedException\n+   */\n+  @Test\n+  public void testCacheSort() throws InterruptedException {\n+    CopybookStorable topElem = new CopybookStorable(\"NEW_STO3\", \"URI\", \"DUMMY CONTENT\");\n+    Thread.sleep(1);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "082f114b526b97361b969145b73b2fdef7d6932e"}, "originalPosition": 59}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "8928b9a5f36b2e8b09e29392a6a52c9bd7758fde", "author": {"user": {"login": "sergiuilie", "name": "Sergiu Ilie"}}, "url": "https://github.com/eclipse/che-che4z-lsp-for-cobol/commit/8928b9a5f36b2e8b09e29392a6a52c9bd7758fde", "committedDate": "2020-03-06T10:44:27Z", "message": "Add negative test and address requested changes"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzcwMzA1MzEw", "url": "https://github.com/eclipse/che-che4z-lsp-for-cobol/pull/227#pullrequestreview-370305310", "createdAt": "2020-03-06T13:04:00Z", "commit": {"oid": "8928b9a5f36b2e8b09e29392a6a52c9bd7758fde"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1223, "cost": 1, "resetAt": "2021-11-01T13:51:04Z"}}}