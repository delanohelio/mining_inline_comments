{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0Mzc1MDEyNTUz", "number": 198, "title": "Introduce Code Action to Resolve Copybooks GH-197 ", "bodyText": "Add logic to the text document service to collect a list of applicable code actions.\nAdd logic to the workspace service to resolve missing copybooks on the Quick Fix.\nAdd error code to determine the code action command type.\nRegister those capabilities on the server initialization.\nClean-up MyLanguageServerImpl to set only supported capabilities #23", "createdAt": "2020-02-13T18:04:25Z", "url": "https://github.com/eclipse/che-che4z-lsp-for-cobol/pull/198", "merged": true, "mergeCommit": {"oid": "682b1f97680130097ff78751415a548d312d56b2"}, "closed": true, "closedAt": "2020-02-17T14:33:59Z", "author": {"login": "temanbrcom"}, "timelineItems": {"totalCount": 11, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcDoXfdgH2gAyMzc1MDEyNTUzOmYzOTczZGZjNjM5ODA5ZWZiZjMwODE4YzlmN2ZjYTg0MzYyZWMxMDY=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcFN93zgFqTM1OTc2MjA0NA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "f3973dfc639809efbf30818c9f7fca84362ec106", "author": {"user": {"login": "temanbrcom", "name": "Andrei Temnikov"}}, "url": "https://github.com/eclipse/che-che4z-lsp-for-cobol/commit/f3973dfc639809efbf30818c9f7fca84362ec106", "committedDate": "2020-02-12T15:49:43Z", "message": "Clean-up MyLanguageServerImpl to set only supported capabilities #23"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "a8f14b8d2746da24e9ae1a2517acd6173e642d37", "author": {"user": {"login": "temanbrcom", "name": "Andrei Temnikov"}}, "url": "https://github.com/eclipse/che-che4z-lsp-for-cobol/commit/a8f14b8d2746da24e9ae1a2517acd6173e642d37", "committedDate": "2020-02-13T17:51:57Z", "message": "Introduce Code Action to Resolve Copybooks GH-197\nAdd logic to the text document service to collect a list of applicable code actions.\nAdd logic to the workspace service to resolve missing copybooks on the Quick Fix.\nAdd error code to determine the code action command type.\nRegister those capabilities on the server initialization."}, "afterCommit": {"oid": "53db3fd8584da813fe84e5af69fd55d9b053b495", "author": {"user": {"login": "temanbrcom", "name": "Andrei Temnikov"}}, "url": "https://github.com/eclipse/che-che4z-lsp-for-cobol/commit/53db3fd8584da813fe84e5af69fd55d9b053b495", "committedDate": "2020-02-14T09:43:27Z", "message": "Introduce Code Action to Resolve Copybooks GH-197\nAdd logic to the text document service to collect a list of applicable code actions.\nAdd logic to the workspace service to resolve missing copybooks on the Quick Fix.\nAdd error code to determine the code action command type.\nRegister those capabilities on the server initialization."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzU5NTUwNDIx", "url": "https://github.com/eclipse/che-che4z-lsp-for-cobol/pull/198#pullrequestreview-359550421", "createdAt": "2020-02-17T08:17:46Z", "commit": {"oid": "53db3fd8584da813fe84e5af69fd55d9b053b495"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xN1QwODoxNzo0N1rOFqbesQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xN1QwODoxNzo0N1rOFqbesQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MDAzNDczNw==", "bodyText": "It looks like a good candidate for a factory method.", "url": "https://github.com/eclipse/che-che4z-lsp-for-cobol/pull/198#discussion_r380034737", "createdAt": "2020-02-17T08:17:47Z", "author": {"login": "ishche"}, "path": "com.ca.lsp.cobol/lsp-core-cobol-parser/src/test/java/com/ca/lsp/core/cobol/visitor/LevenshteinDistanceTest.java", "diffHunk": "@@ -37,7 +37,7 @@\n \n   @Test\n   public void testDistance() {\n-    errors.add(new SyntaxError(new Position(\"\", 1, 1, 1, 1), null, \"\", 2));\n+    errors.add(new SyntaxError(new Position(\"\", 1, 1, 1, 1), null, \"\", 2, null));", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "53db3fd8584da813fe84e5af69fd55d9b053b495"}, "originalPosition": 5}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzU5NTY1NTkz", "url": "https://github.com/eclipse/che-che4z-lsp-for-cobol/pull/198#pullrequestreview-359565593", "createdAt": "2020-02-17T08:47:13Z", "commit": {"oid": "53db3fd8584da813fe84e5af69fd55d9b053b495"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xN1QwODo0NzoxM1rOFqcPEQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xN1QwODo0NzoxM1rOFqcPEQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MDA0NzEyMQ==", "bodyText": "Please update the header :*(", "url": "https://github.com/eclipse/che-che4z-lsp-for-cobol/pull/198#discussion_r380047121", "createdAt": "2020-02-17T08:47:13Z", "author": {"login": "zacanbrcom"}, "path": "com.ca.lsp.cobol/lsp-core-cobol-parser/src/main/java/com/ca/lsp/core/cobol/engine/CobolLanguageEngine.java", "diffHunk": "@@ -40,8 +40,7 @@\n \n     CobolPreprocessorImpl preprocessor = new CobolPreprocessorImpl();\n \n-    ResultWithErrors<PreprocessedInput> preProcessedInput =\n-        preprocessor.process(documentUri, text);\n+    ResultWithErrors<PreprocessedInput> preProcessedInput = preprocessor.process(documentUri, text);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "53db3fd8584da813fe84e5af69fd55d9b053b495"}, "originalPosition": 6}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzU5NTY2NDA3", "url": "https://github.com/eclipse/che-che4z-lsp-for-cobol/pull/198#pullrequestreview-359566407", "createdAt": "2020-02-17T08:48:36Z", "commit": {"oid": "53db3fd8584da813fe84e5af69fd55d9b053b495"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xN1QwODo0ODozNlrOFqcRlg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xN1QwODo0ODozNlrOFqcRlg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MDA0Nzc2Ng==", "bodyText": "I will be more specific, like ''..in the predefined copybook folder\"", "url": "https://github.com/eclipse/che-che4z-lsp-for-cobol/pull/198#discussion_r380047766", "createdAt": "2020-02-17T08:48:36Z", "author": {"login": "zacanbrcom"}, "path": "com.ca.lsp.cobol/lsp-core-cobol-parser/src/main/java/com/ca/lsp/core/cobol/model/ErrorCode.java", "diffHunk": "@@ -0,0 +1,25 @@\n+/*\n+ * Copyright (c) 2020 Broadcom.\n+ * The term \"Broadcom\" refers to Broadcom Inc. and/or its subsidiaries.\n+ *\n+ * This program and the accompanying materials are made\n+ * available under the terms of the Eclipse Public License 2.0\n+ * which is available at https://www.eclipse.org/legal/epl-2.0/\n+ *\n+ * SPDX-License-Identifier: EPL-2.0\n+ *\n+ * Contributors:\n+ *    Broadcom, Inc. - initial API and implementation\n+ *\n+ */\n+\n+package com.ca.lsp.core.cobol.model;\n+\n+/**\n+ * This enum represents the error codes that are used to determine some special type of errors. See\n+ * the instance documentation for more details.\n+ */\n+public enum ErrorCode {\n+  /** This copybook does not present in the workspace */", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "53db3fd8584da813fe84e5af69fd55d9b053b495"}, "originalPosition": 23}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzU5NTY3NDg3", "url": "https://github.com/eclipse/che-che4z-lsp-for-cobol/pull/198#pullrequestreview-359567487", "createdAt": "2020-02-17T08:50:28Z", "commit": {"oid": "53db3fd8584da813fe84e5af69fd55d9b053b495"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xN1QwODo1MDoyOFrOFqcVFA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xN1QwODo1MDoyOFrOFqcVFA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MDA0ODY2MA==", "bodyText": "better use errorCode as name", "url": "https://github.com/eclipse/che-che4z-lsp-for-cobol/pull/198#discussion_r380048660", "createdAt": "2020-02-17T08:50:28Z", "author": {"login": "zacanbrcom"}, "path": "com.ca.lsp.cobol/lsp-core-cobol-parser/src/main/java/com/ca/lsp/core/cobol/model/SyntaxError.java", "diffHunk": "@@ -27,12 +27,15 @@\n   private final List<String> ruleStack;\n   private final String suggestion;\n   private final int severity;\n+  private final ErrorCode code;\n \n+  //Please, don't use static imports for this method: https://github.com/rzwitserloot/lombok/issues/2044\n   @Builder(builderMethodName = \"syntaxError\")\n-  public SyntaxError(Position position, List<String> ruleStack, String suggestion, int severity) {\n+  public SyntaxError(Position position, List<String> ruleStack, String suggestion, int severity, ErrorCode code) {\n     this.position = position;\n     this.ruleStack = ruleStack;\n     this.suggestion = suggestion;\n     this.severity = severity;\n+    this.code = code;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "53db3fd8584da813fe84e5af69fd55d9b053b495"}, "originalPosition": 22}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "53db3fd8584da813fe84e5af69fd55d9b053b495", "author": {"user": {"login": "temanbrcom", "name": "Andrei Temnikov"}}, "url": "https://github.com/eclipse/che-che4z-lsp-for-cobol/commit/53db3fd8584da813fe84e5af69fd55d9b053b495", "committedDate": "2020-02-14T09:43:27Z", "message": "Introduce Code Action to Resolve Copybooks GH-197\nAdd logic to the text document service to collect a list of applicable code actions.\nAdd logic to the workspace service to resolve missing copybooks on the Quick Fix.\nAdd error code to determine the code action command type.\nRegister those capabilities on the server initialization."}, "afterCommit": {"oid": "fbd6a463586bd51db3ddfdaa4f16d4d2cfe6f3ca", "author": {"user": {"login": "temanbrcom", "name": "Andrei Temnikov"}}, "url": "https://github.com/eclipse/che-che4z-lsp-for-cobol/commit/fbd6a463586bd51db3ddfdaa4f16d4d2cfe6f3ca", "committedDate": "2020-02-17T09:46:15Z", "message": "Introduce Code Action to Resolve Copybooks GH-197\nAdd logic to the text document service to collect a list of applicable code actions.\nAdd logic to the workspace service to resolve missing copybooks on the Quick Fix.\nAdd error code to determine the code action command type.\nRegister those capabilities on the server initialization."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "453da429e958184a64ea6b262a687a3ab04f7388", "author": {"user": {"login": "temanbrcom", "name": "Andrei Temnikov"}}, "url": "https://github.com/eclipse/che-che4z-lsp-for-cobol/commit/453da429e958184a64ea6b262a687a3ab04f7388", "committedDate": "2020-02-17T09:50:18Z", "message": "Introduce Code Action to Resolve Copybooks GH-197\nAdd logic to the text document service to collect a list of applicable code actions.\nAdd logic to the workspace service to resolve missing copybooks on the Quick Fix.\nAdd error code to determine the code action command type.\nRegister those capabilities on the server initialization."}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "fbd6a463586bd51db3ddfdaa4f16d4d2cfe6f3ca", "author": {"user": {"login": "temanbrcom", "name": "Andrei Temnikov"}}, "url": "https://github.com/eclipse/che-che4z-lsp-for-cobol/commit/fbd6a463586bd51db3ddfdaa4f16d4d2cfe6f3ca", "committedDate": "2020-02-17T09:46:15Z", "message": "Introduce Code Action to Resolve Copybooks GH-197\nAdd logic to the text document service to collect a list of applicable code actions.\nAdd logic to the workspace service to resolve missing copybooks on the Quick Fix.\nAdd error code to determine the code action command type.\nRegister those capabilities on the server initialization."}, "afterCommit": {"oid": "453da429e958184a64ea6b262a687a3ab04f7388", "author": {"user": {"login": "temanbrcom", "name": "Andrei Temnikov"}}, "url": "https://github.com/eclipse/che-che4z-lsp-for-cobol/commit/453da429e958184a64ea6b262a687a3ab04f7388", "committedDate": "2020-02-17T09:50:18Z", "message": "Introduce Code Action to Resolve Copybooks GH-197\nAdd logic to the text document service to collect a list of applicable code actions.\nAdd logic to the workspace service to resolve missing copybooks on the Quick Fix.\nAdd error code to determine the code action command type.\nRegister those capabilities on the server initialization."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzU5NTczOTkx", "url": "https://github.com/eclipse/che-che4z-lsp-for-cobol/pull/198#pullrequestreview-359573991", "createdAt": "2020-02-17T09:01:04Z", "commit": {"oid": "53db3fd8584da813fe84e5af69fd55d9b053b495"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xN1QxMDoxMzoxMlrOFqe-PA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xN1QxMDoxMzoxMlrOFqe-PA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MDA5MTk2NA==", "bodyText": "I didn't get why is required to use JsonPrimitive object, is not used in every definition of ExecuteCommandParams", "url": "https://github.com/eclipse/che-che4z-lsp-for-cobol/pull/198#discussion_r380091964", "createdAt": "2020-02-17T10:13:12Z", "author": {"login": "zacanbrcom"}, "path": "com.ca.lsp.cobol/lsp-service-cobol/src/test/java/com/ca/lsp/cobol/service/WorkspaceServiceTest.java", "diffHunk": "@@ -15,31 +15,113 @@\n  */\n package com.ca.lsp.cobol.service;\n \n+import com.broadcom.lsp.domain.cobol.databus.api.DataBusBroker;\n import com.broadcom.lsp.domain.cobol.databus.impl.DefaultDataBusBroker;\n+import com.broadcom.lsp.domain.cobol.event.model.RequiredCopybookEvent;\n import com.broadcom.lsp.domain.cobol.event.model.RunAnalysisEvent;\n+import com.google.gson.JsonPrimitive;\n import lombok.extern.slf4j.Slf4j;\n import org.eclipse.lsp4j.DidChangeWatchedFilesParams;\n-import org.eclipse.lsp4j.FileChangeType;\n+import org.eclipse.lsp4j.ExecuteCommandParams;\n import org.eclipse.lsp4j.FileEvent;\n import org.junit.Test;\n import org.mockito.ArgumentCaptor;\n \n-import java.util.Collections;\n+import java.util.concurrent.CompletableFuture;\n+import java.util.concurrent.ExecutionException;\n \n-import static junit.framework.TestCase.assertNotNull;\n-import static org.mockito.Mockito.mock;\n-import static org.mockito.Mockito.verify;\n+import static com.ca.lsp.cobol.service.delegates.validations.UseCaseUtils.DOCUMENT_URI;\n+import static com.ca.lsp.core.cobol.model.ErrorCode.MISSING_COPYBOOK;\n+import static java.util.Arrays.asList;\n+import static java.util.Collections.emptyList;\n+import static java.util.Collections.singletonList;\n+import static org.eclipse.lsp4j.FileChangeType.Changed;\n+import static org.junit.Assert.*;\n+import static org.mockito.ArgumentCaptor.forClass;\n+import static org.mockito.Mockito.*;\n \n+/**\n+ * This test checks the entry points of the {@link org.eclipse.lsp4j.services.WorkspaceService}\n+ * implementation.\n+ */\n @Slf4j\n public class WorkspaceServiceTest {\n+\n+  /**\n+   * Test of the workspace/executeCommand entry point. Assert that on a MISSING_COPYBOOK the {@link\n+   * RequiredCopybookEvent} is fired.\n+   */\n+  @Test\n+  public void testExecuteCommand() {\n+    DataBusBroker broker = mock(DataBusBroker.class);\n+    ArgumentCaptor<RequiredCopybookEvent> captor = forClass(RequiredCopybookEvent.class);\n+    String copybookName = \"COPYBOOK\";\n+\n+    CobolWorkspaceService service = new CobolWorkspaceServiceImpl(broker, null);\n+\n+    CompletableFuture<Object> result =\n+        service.executeCommand(\n+            new ExecuteCommandParams(\n+                MISSING_COPYBOOK.name(),\n+                asList(new JsonPrimitive(copybookName), new JsonPrimitive(DOCUMENT_URI))));", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "453da429e958184a64ea6b262a687a3ab04f7388"}, "originalPosition": 57}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzU5NzYyMDQ0", "url": "https://github.com/eclipse/che-che4z-lsp-for-cobol/pull/198#pullrequestreview-359762044", "createdAt": "2020-02-17T14:12:03Z", "commit": {"oid": "453da429e958184a64ea6b262a687a3ab04f7388"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1201, "cost": 1, "resetAt": "2021-11-01T13:51:04Z"}}}