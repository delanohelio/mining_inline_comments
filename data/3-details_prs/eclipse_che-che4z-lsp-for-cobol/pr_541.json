{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDk2MTc5MjI3", "number": 541, "title": "Introduce Predefined Variables Support", "bodyText": "Added predefined variables and all the language features for them", "createdAt": "2020-10-01T11:20:11Z", "url": "https://github.com/eclipse/che-che4z-lsp-for-cobol/pull/541", "merged": true, "mergeCommit": {"oid": "f4dc9ea27cc9f6c3ea87f9f5c76ceb6e34e0693c"}, "closed": true, "closedAt": "2020-10-02T11:49:49Z", "author": {"login": "temanbrcom"}, "timelineItems": {"totalCount": 14, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdOOahggH2gAyNDk2MTc5MjI3Ojg1NDdlY2U5ODU1MjBkMWU4ZDc5Yjc0YjVmZDg1MDcwZGQ1ZTQxNTc=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdOkEfqAFqTUwMTA0OTA4OA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "8547ece985520d1e8d79b74b5fd85070dd5e4157", "author": {"user": {"login": "temanbrcom", "name": "Andrei Temnikov"}}, "url": "https://github.com/eclipse/che-che4z-lsp-for-cobol/commit/8547ece985520d1e8d79b74b5fd85070dd5e4157", "committedDate": "2020-10-01T09:59:49Z", "message": "feat: Introduce predefined EIB variables support #527"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "bbd288c076266bb64965474d3092311fe7a8e368", "author": {"user": {"login": "temanbrcom", "name": "Andrei Temnikov"}}, "url": "https://github.com/eclipse/che-che4z-lsp-for-cobol/commit/bbd288c076266bb64965474d3092311fe7a8e368", "committedDate": "2020-10-01T10:03:46Z", "message": "test: Add predefined variables support in use case engine"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f60c70f44b98a019db6eae3b7c9158d0e5b5b722", "author": {"user": {"login": "temanbrcom", "name": "Andrei Temnikov"}}, "url": "https://github.com/eclipse/che-che4z-lsp-for-cobol/commit/f60c70f44b98a019db6eae3b7c9158d0e5b5b722", "committedDate": "2020-10-01T10:05:05Z", "message": "test: Add use case for EIB variables #527"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "075c3f719648493acf462fb6b9deff7aaa0401d5", "author": {"user": {"login": "temanbrcom", "name": "Andrei Temnikov"}}, "url": "https://github.com/eclipse/che-che4z-lsp-for-cobol/commit/075c3f719648493acf462fb6b9deff7aaa0401d5", "committedDate": "2020-10-01T10:54:57Z", "message": "feat: Add Go To Definition and Referrences for constants #527"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "48aaced3495848d7585dd44da3ef5af7746c26a0", "author": {"user": {"login": "temanbrcom", "name": "Andrei Temnikov"}}, "url": "https://github.com/eclipse/che-che4z-lsp-for-cobol/commit/48aaced3495848d7585dd44da3ef5af7746c26a0", "committedDate": "2020-10-01T11:02:33Z", "message": "feat: Introduce autocompletion for constants #527\nReorder completion suggestion to place constants before snippets"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "db2d5cf35d942b43f38b618f60cd1c446bbbe503", "author": {"user": {"login": "temanbrcom", "name": "Andrei Temnikov"}}, "url": "https://github.com/eclipse/che-che4z-lsp-for-cobol/commit/db2d5cf35d942b43f38b618f60cd1c446bbbe503", "committedDate": "2020-10-01T11:17:00Z", "message": "refactor: Explicitly define completions order"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c6578a8f1ac6f703f29277f4d30b6fd25941bc2e", "author": {"user": {"login": "temanbrcom", "name": "Andrei Temnikov"}}, "url": "https://github.com/eclipse/che-che4z-lsp-for-cobol/commit/c6578a8f1ac6f703f29277f4d30b6fd25941bc2e", "committedDate": "2020-10-01T14:20:54Z", "message": "feat: Add XML special registers #479"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "6250d479b3f15fda98a289db9d0367ecb16e42ec", "author": {"user": {"login": "temanbrcom", "name": "Andrei Temnikov"}}, "url": "https://github.com/eclipse/che-che4z-lsp-for-cobol/commit/6250d479b3f15fda98a289db9d0367ecb16e42ec", "committedDate": "2020-10-01T14:26:05Z", "message": "doc: Update Use Case Engine manual with predefined variables"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f392bd09ddc8bd539bc8bc0036e4e450acf3533e", "author": {"user": {"login": "temanbrcom", "name": "Andrei Temnikov"}}, "url": "https://github.com/eclipse/che-che4z-lsp-for-cobol/commit/f392bd09ddc8bd539bc8bc0036e4e450acf3533e", "committedDate": "2020-10-01T14:44:09Z", "message": "feat: Add JNIENVPTR special register support #479"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "d873b2cfb3fbaf42724eb183b12054bbac0fd673", "author": {"user": {"login": "temanbrcom", "name": "Andrei Temnikov"}}, "url": "https://github.com/eclipse/che-che4z-lsp-for-cobol/commit/d873b2cfb3fbaf42724eb183b12054bbac0fd673", "committedDate": "2020-10-01T14:59:50Z", "message": "feat: Add JSON special register support #479"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTAxMDE2MjYx", "url": "https://github.com/eclipse/che-che4z-lsp-for-cobol/pull/541#pullrequestreview-501016261", "createdAt": "2020-10-02T10:14:09Z", "commit": {"oid": "d873b2cfb3fbaf42724eb183b12054bbac0fd673"}, "state": "APPROVED", "comments": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wMlQxMDoxNDowOVrOHboYxA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wMlQxMDoyNTo0MlrOHbotUg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5ODczNTMwMA==", "bodyText": "I guess now it must be PREDEFINED_VARIABLES because it contains XML, etc.", "url": "https://github.com/eclipse/che-che4z-lsp-for-cobol/pull/541#discussion_r498735300", "createdAt": "2020-10-02T10:14:09Z", "author": {"login": "grianbrcom"}, "path": "server/src/test/java/com/ca/lsp/cobol/usecases/engine/UseCasePreprocessorListener.java", "diffHunk": "@@ -43,11 +44,54 @@\n  * UseCasePreprocessor.g4\n  */\n public class UseCasePreprocessorListener extends UseCasePreprocessorBaseListener {\n+  private List<String> PREDEFINED_EIB_VARIABLES =", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d873b2cfb3fbaf42724eb183b12054bbac0fd673"}, "originalPosition": 12}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5ODczNzAyOQ==", "bodyText": "What's about constructing a list and then convert it into a map?\nLike you did in server/src/test/java/com/ca/lsp/cobol/usecases/engine/UseCasePreprocessorListener.java.", "url": "https://github.com/eclipse/che-che4z-lsp-for-cobol/pull/541#discussion_r498737029", "createdAt": "2020-10-02T10:18:07Z", "author": {"login": "grianbrcom"}, "path": "server/src/main/java/com/ca/lsp/core/cobol/semantics/PredefinedVariableContext.java", "diffHunk": "@@ -0,0 +1,123 @@\n+/*\n+ * Copyright (c) 2020 Broadcom.\n+ * The term \"Broadcom\" refers to Broadcom Inc. and/or its subsidiaries.\n+ *\n+ * This program and the accompanying materials are made\n+ * available under the terms of the Eclipse Public License 2.0\n+ * which is available at https://www.eclipse.org/legal/epl-2.0/\n+ *\n+ * SPDX-License-Identifier: EPL-2.0\n+ *\n+ * Contributors:\n+ *    Broadcom, Inc. - initial API and implementation\n+ *\n+ */\n+\n+package com.ca.lsp.core.cobol.semantics;\n+\n+import com.ca.lsp.core.cobol.model.Variable;\n+import com.google.common.collect.HashMultimap;\n+import com.google.common.collect.Multimap;\n+import lombok.EqualsAndHashCode;\n+import lombok.NoArgsConstructor;\n+import org.eclipse.lsp4j.Location;\n+\n+import java.util.List;\n+\n+/**\n+ * This class represents a structure to store variables of a COBOL program and build a variable\n+ * hierarchy.\n+ */\n+@EqualsAndHashCode\n+@NoArgsConstructor\n+public class PredefinedVariableContext implements SubContext<Variable> {\n+  private static final Location MOCK_LOCATION = new Location();\n+  private static final Multimap<String, Location> VARIABLE_DEFINITIONS = HashMultimap.create();\n+\n+  private final Multimap<String, Location> variableUsages = HashMultimap.create();\n+\n+  static {\n+    // EXEC interface block fields\n+    VARIABLE_DEFINITIONS.put(\"EIBAID\", MOCK_LOCATION);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d873b2cfb3fbaf42724eb183b12054bbac0fd673"}, "originalPosition": 41}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5ODczOTEyOA==", "bodyText": "Just in case if you want an autonumbering:\nfinal String prefix = String.valueOf(this.ordinal());", "url": "https://github.com/eclipse/che-che4z-lsp-for-cobol/pull/541#discussion_r498739128", "createdAt": "2020-10-02T10:22:37Z", "author": {"login": "grianbrcom"}, "path": "server/src/main/java/com/ca/lsp/cobol/service/delegates/completions/CompletionOrder.java", "diffHunk": "@@ -0,0 +1,30 @@\n+/*\n+ * Copyright (c) 2020 Broadcom.\n+ * The term \"Broadcom\" refers to Broadcom Inc. and/or its subsidiaries.\n+ *\n+ * This program and the accompanying materials are made\n+ * available under the terms of the Eclipse Public License 2.0\n+ * which is available at https://www.eclipse.org/legal/epl-2.0/\n+ *\n+ * SPDX-License-Identifier: EPL-2.0\n+ *\n+ * Contributors:\n+ *    Broadcom, Inc. - initial API and implementation\n+ *\n+ */\n+\n+package com.ca.lsp.cobol.service.delegates.completions;\n+\n+import lombok.AllArgsConstructor;\n+\n+/** This enum explicitly defines the order for completions suggestions with sorting prefixes */\n+@AllArgsConstructor\n+public enum CompletionOrder {\n+  VARIABLES(\"0\"),\n+  PARAGRAPHS(\"1\"),\n+  COPYBOOKS(\"2\"),\n+  CONSTANTS(\"3\"),\n+  SNIPPETS(\"4\"),\n+  KEYWORDS(\"5\");\n+  final String prefix;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d873b2cfb3fbaf42724eb183b12054bbac0fd673"}, "originalPosition": 29}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5ODc0MDU2Mg==", "bodyText": "The third time you describe constants. It will be good to define them once.", "url": "https://github.com/eclipse/che-che4z-lsp-for-cobol/pull/541#discussion_r498740562", "createdAt": "2020-10-02T10:25:42Z", "author": {"login": "grianbrcom"}, "path": "server/src/test/java/com/ca/lsp/core/cobol/engine/CobolLanguageEngineTest.java", "diffHunk": "@@ -123,11 +127,68 @@ void testLanguageEngineRun() {\n     ResultWithErrors<SemanticContext> expected =\n         new ResultWithErrors<>(\n             new SemanticContext(\n-                Map.of(), Map.of(), Map.of(), Map.of(), Map.of(), Map.of(), expectedOutlineTree),\n+                Map.of(),\n+                Map.of(),\n+                Map.of(),\n+                Map.of(),\n+                getConstantDefinitions(),\n+                Map.of(),\n+                Map.of(),\n+                Map.of(),\n+                expectedOutlineTree),\n             List.of(error));\n \n     ResultWithErrors<SemanticContext> actual = engine.run(URI, TEXT, PROCESSING_MODE);\n \n     assertEquals(expected, actual);\n   }\n+\n+  private Map<String, Collection<Location>> getConstantDefinitions() {\n+    Location mockLocation = new Location();\n+    Multimap<String, Location> result = HashMultimap.create();\n+    result.put(\"EIBAID\", mockLocation);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d873b2cfb3fbaf42724eb183b12054bbac0fd673"}, "originalPosition": 40}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "9eff07af5b7291db85e95ef1f4c8a632eec589c3", "author": {"user": {"login": "temanbrcom", "name": "Andrei Temnikov"}}, "url": "https://github.com/eclipse/che-che4z-lsp-for-cobol/commit/9eff07af5b7291db85e95ef1f4c8a632eec589c3", "committedDate": "2020-10-02T10:52:59Z", "message": "refactor: Make completion order prefix defintion automatic"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "60f8a583b415467fbc938cc2c7a62c206720f064", "author": {"user": {"login": "temanbrcom", "name": "Andrei Temnikov"}}, "url": "https://github.com/eclipse/che-che4z-lsp-for-cobol/commit/60f8a583b415467fbc938cc2c7a62c206720f064", "committedDate": "2020-10-02T10:55:56Z", "message": "refactor: Change the obsolete variable name"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTAxMDQ5MDg4", "url": "https://github.com/eclipse/che-che4z-lsp-for-cobol/pull/541#pullrequestreview-501049088", "createdAt": "2020-10-02T11:13:40Z", "commit": {"oid": "60f8a583b415467fbc938cc2c7a62c206720f064"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1042, "cost": 1, "resetAt": "2021-11-01T13:51:04Z"}}}