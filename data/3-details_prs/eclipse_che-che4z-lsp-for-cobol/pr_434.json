{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDUzMjk5NDg5", "number": 434, "title": "Dispose diagnostic messages when user close the document #385", "bodyText": "Close #385\nPurpose of this PR is to clean up the problem area when the document is closed by the user.\nAccording to the LSP protocol, client is responsible to:\n\nclean up problems notified in problem area\nrestore the file text in the explorer removing the red font that highlight a file that contains problems.", "createdAt": "2020-07-20T10:26:06Z", "url": "https://github.com/eclipse/che-che4z-lsp-for-cobol/pull/434", "merged": true, "mergeCommit": {"oid": "0d04d8ab1378f53c8d2998e16de210308b6a316b"}, "closed": true, "closedAt": "2020-07-23T12:47:34Z", "author": {"login": "zacanbrcom"}, "timelineItems": {"totalCount": 13, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABc2ve_jgFqTQ1MTUwMjQ1OA==", "endCursor": "Y3Vyc29yOnYyOpPPAAABc3uWjXgH2gAyNDUzMjk5NDg5OjgzNDEwNzYzZDM2YjkxOTIxNjAzM2U3ZGRkZjY4ZTVkMTU2M2EyZmM=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDUxNTAyNDU4", "url": "https://github.com/eclipse/che-che4z-lsp-for-cobol/pull/434#pullrequestreview-451502458", "createdAt": "2020-07-20T10:57:22Z", "commit": {"oid": "4b3f3d2c78349bf987158eee0ce5bb7b93baa49e"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yMFQxMDo1NzoyM1rOG0GFHQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yMFQxMDo1NzoyM1rOG0GFHQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NzI3ODc0OQ==", "bodyText": "Maybe, we may log also the URI here", "url": "https://github.com/eclipse/che-che4z-lsp-for-cobol/pull/434#discussion_r457278749", "createdAt": "2020-07-20T10:57:23Z", "author": {"login": "temanbrcom"}, "path": "com.ca.lsp.cobol/lsp-service-cobol/src/main/java/com/ca/lsp/cobol/service/MyTextDocumentService.java", "diffHunk": "@@ -194,6 +191,7 @@ public void didChange(DidChangeTextDocumentParams params) {\n   public void didClose(DidCloseTextDocumentParams params) {\n     String uri = params.getTextDocument().getUri();\n     log.info(\"Document closing invoked\");", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "4b3f3d2c78349bf987158eee0ce5bb7b93baa49e"}, "originalPosition": 15}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "42074edb5c30eb6d6b39b6a07960920213eb3e7d", "author": {"user": {"login": "zacanbrcom", "name": "Andrea Zaccaro"}}, "url": "https://github.com/eclipse/che-che4z-lsp-for-cobol/commit/42074edb5c30eb6d6b39b6a07960920213eb3e7d", "committedDate": "2020-07-20T13:14:51Z", "message": "refactor: Update the log with URI of document opened #385"}, "afterCommit": {"oid": "2fbab00eea47b8811ff9fc87b1ccf2ad6a2e43ed", "author": {"user": {"login": "zacanbrcom", "name": "Andrea Zaccaro"}}, "url": "https://github.com/eclipse/che-che4z-lsp-for-cobol/commit/2fbab00eea47b8811ff9fc87b1ccf2ad6a2e43ed", "committedDate": "2020-07-20T13:50:53Z", "message": "refactor: Update the log with URI of document opened #385"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "c99cc15f4286d399f1878132f7e6774229a66d92", "author": {"user": {"login": "zacanbrcom", "name": "Andrea Zaccaro"}}, "url": "https://github.com/eclipse/che-che4z-lsp-for-cobol/commit/c99cc15f4286d399f1878132f7e6774229a66d92", "committedDate": "2020-07-20T13:53:43Z", "message": "refactor: rollback settings.json"}, "afterCommit": {"oid": "65fabcc9042deccde303afdd92122da84111c6a5", "author": {"user": {"login": "zacanbrcom", "name": "Andrea Zaccaro"}}, "url": "https://github.com/eclipse/che-che4z-lsp-for-cobol/commit/65fabcc9042deccde303afdd92122da84111c6a5", "committedDate": "2020-07-20T13:55:01Z", "message": "refactor: Update the log with URI of document opened #385"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "6e015177c8125bc8708cafb93bbd4fc32dad8a21", "author": {"user": {"login": "zacanbrcom", "name": "Andrea Zaccaro"}}, "url": "https://github.com/eclipse/che-che4z-lsp-for-cobol/commit/6e015177c8125bc8708cafb93bbd4fc32dad8a21", "committedDate": "2020-07-20T14:09:10Z", "message": "refactor: rollback content of settings.json #385"}, "afterCommit": {"oid": "8eca4bb068cdd3bc4916737640f693e6a8ad85bd", "author": {"user": {"login": "zacanbrcom", "name": "Andrea Zaccaro"}}, "url": "https://github.com/eclipse/che-che4z-lsp-for-cobol/commit/8eca4bb068cdd3bc4916737640f693e6a8ad85bd", "committedDate": "2020-07-20T14:13:57Z", "message": "fix: cleanup diagnostic messages when did_close event is triggered #385"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDUyMjAxNjQ4", "url": "https://github.com/eclipse/che-che4z-lsp-for-cobol/pull/434#pullrequestreview-452201648", "createdAt": "2020-07-21T07:39:38Z", "commit": {"oid": "8eca4bb068cdd3bc4916737640f693e6a8ad85bd"}, "state": "APPROVED", "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yMVQwNzozOTozOFrOG0r5Wg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yMVQwNzo0MTo1OVrOG0r-tA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1Nzg5ODMzMA==", "bodyText": "Do we keep comments inside json-elements?", "url": "https://github.com/eclipse/che-che4z-lsp-for-cobol/pull/434#discussion_r457898330", "createdAt": "2020-07-21T07:39:38Z", "author": {"login": "asatklichov"}, "path": "clients/cobol-lsp-vscode-extension/.vscode/settings.json", "diffHunk": "@@ -13,12 +13,15 @@\n  */\n // Place your settings in this file to overwrite default and user settings.\n {\n-\t\"files.exclude\": {\n-\t\t\"out\": false // set this to true to hide the \"out\" folder with the compiled JS files\n-\t},\n-\t\"search.exclude\": {\n-\t\t\"out\": true // set this to false to include \"out\" folder in search results\n-\t},\n+    \"files.exclude\": {\n+        \"out\": false\n+        // set this to true to hide the \"out\" folder with the compiled JS files\n+    },\n+    \"search.exclude\": {\n+        \"out\": true\n+        // set this to false to include \"out\" folder in search results\n+    },\n     \"typescript.tsdk\": \"./node_modules/typescript/lib\",\n-    \"vsicons.presets.angular\": false, // we want to use the TS server from our node_modules folder to control its version\n+    \"vsicons.presets.angular\": false\n+    // we want to use the TS server from our node_modules folder to control its version", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "8eca4bb068cdd3bc4916737640f693e6a8ad85bd"}, "originalPosition": 21}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1Nzg5ODU1MQ==", "bodyText": "Optional: List.of()", "url": "https://github.com/eclipse/che-che4z-lsp-for-cobol/pull/434#discussion_r457898551", "createdAt": "2020-07-21T07:40:02Z", "author": {"login": "asatklichov"}, "path": "com.ca.lsp.cobol/lsp-service-cobol/src/main/java/com/ca/lsp/cobol/service/MyTextDocumentService.java", "diffHunk": "@@ -193,7 +190,8 @@ public void didChange(DidChangeTextDocumentParams params) {\n   @Override\n   public void didClose(DidCloseTextDocumentParams params) {\n     String uri = params.getTextDocument().getUri();\n-    log.info(\"Document closing invoked\");\n+    log.info(String.format(\"Document closing invoked on URI %s\", uri));\n+    communications.publishDiagnostics(uri, Collections.emptyList());", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "8eca4bb068cdd3bc4916737640f693e6a8ad85bd"}, "originalPosition": 18}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1Nzg5OTcwMA==", "bodyText": "Optional: Hamcrest style:\nassertThat(client.getDiagnostics(), hasSize(0));", "url": "https://github.com/eclipse/che-che4z-lsp-for-cobol/pull/434#discussion_r457899700", "createdAt": "2020-07-21T07:41:59Z", "author": {"login": "asatklichov"}, "path": "com.ca.lsp.cobol/lsp-service-cobol/src/test/java/com/ca/lsp/cobol/service/MyTextDocumentServiceTest.java", "diffHunk": "@@ -254,6 +254,24 @@ public void testCodeActionsEndpoint() {\n     verify(actions).collect(params);\n   }\n \n+  /**\n+   * This test verify that when a {@link MyTextDocumentService#didClose(DidCloseTextDocumentParams)}\n+   * is sent from the client to dispose a document, all the related diagnostic message are disposed\n+   * from the document.\n+   */\n+  @Test\n+  public void testDidCloseDisposeDiagnostics() {\n+    service.didOpen(\n+        new DidOpenTextDocumentParams(\n+            new TextDocumentItem(DOCUMENT_URI, LANGUAGE, 1, TEXT_EXAMPLE)));\n+    assertEquals(1, closeGetter(service).size());\n+    TextDocumentIdentifier testDocument = new TextDocumentIdentifier(DOCUMENT_URI);\n+    DidCloseTextDocumentParams closedDocument = new DidCloseTextDocumentParams(testDocument);\n+    service.didClose(closedDocument);\n+    UseCaseUtils.waitForDiagnostics(client);\n+    assertEquals(0, client.getDiagnostics().size());", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "8eca4bb068cdd3bc4916737640f693e6a8ad85bd"}, "originalPosition": 19}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "150e6b736f378e014048e5282bb8640d1f517c4c", "author": {"user": {"login": "zacanbrcom", "name": "Andrea Zaccaro"}}, "url": "https://github.com/eclipse/che-che4z-lsp-for-cobol/commit/150e6b736f378e014048e5282bb8640d1f517c4c", "committedDate": "2020-07-21T08:02:04Z", "message": "refactor: Address req of changes #385"}, "afterCommit": {"oid": "3b188a9bb165ff00b65b3595adf1691c395bd98e", "author": {"user": {"login": "zacanbrcom", "name": "Andrea Zaccaro"}}, "url": "https://github.com/eclipse/che-che4z-lsp-for-cobol/commit/3b188a9bb165ff00b65b3595adf1691c395bd98e", "committedDate": "2020-07-21T08:03:19Z", "message": "fix: cleanup diagnostic messages when did_close event is triggered #385"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDUyMjM3MTkw", "url": "https://github.com/eclipse/che-che4z-lsp-for-cobol/pull/434#pullrequestreview-452237190", "createdAt": "2020-07-21T08:27:56Z", "commit": {"oid": "3b188a9bb165ff00b65b3595adf1691c395bd98e"}, "state": "APPROVED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yMVQwODoyNzo1NlrOG0tmQw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yMVQwODoyNzo1NlrOG0tmQw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NzkyNjIxMQ==", "bodyText": "Could you, please, use Communications mock to check the logic?\nThe UseCaseUtils#waitFodDiagnostic is going to be deprecated.", "url": "https://github.com/eclipse/che-che4z-lsp-for-cobol/pull/434#discussion_r457926211", "createdAt": "2020-07-21T08:27:56Z", "author": {"login": "temanbrcom"}, "path": "com.ca.lsp.cobol/lsp-service-cobol/src/test/java/com/ca/lsp/cobol/service/MyTextDocumentServiceTest.java", "diffHunk": "@@ -254,6 +255,24 @@ public void testCodeActionsEndpoint() {\n     verify(actions).collect(params);\n   }\n \n+  /**\n+   * This test verify that when a {@link MyTextDocumentService#didClose(DidCloseTextDocumentParams)}\n+   * is sent from the client to dispose a document, all the related diagnostic message are disposed\n+   * from the document.\n+   */\n+  @Test\n+  public void testDidCloseDisposeDiagnostics() {\n+    service.didOpen(\n+        new DidOpenTextDocumentParams(\n+            new TextDocumentItem(DOCUMENT_URI, LANGUAGE, 1, TEXT_EXAMPLE)));\n+    assertEquals(1, closeGetter(service).size());\n+    TextDocumentIdentifier testDocument = new TextDocumentIdentifier(DOCUMENT_URI);\n+    DidCloseTextDocumentParams closedDocument = new DidCloseTextDocumentParams(testDocument);\n+    service.didClose(closedDocument);\n+    UseCaseUtils.waitForDiagnostics(client);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "3b188a9bb165ff00b65b3595adf1691c395bd98e"}, "originalPosition": 26}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDUyNDg0MTc3", "url": "https://github.com/eclipse/che-che4z-lsp-for-cobol/pull/434#pullrequestreview-452484177", "createdAt": "2020-07-21T13:57:36Z", "commit": {"oid": "3b188a9bb165ff00b65b3595adf1691c395bd98e"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "0b1da465f71086ff36a61c7f22fed699c246d1fa", "author": {"user": {"login": "zacanbrcom", "name": "Andrea Zaccaro"}}, "url": "https://github.com/eclipse/che-che4z-lsp-for-cobol/commit/0b1da465f71086ff36a61c7f22fed699c246d1fa", "committedDate": "2020-07-21T12:35:26Z", "message": "refactor: Address req of changes #385"}, "afterCommit": {"oid": "b8be1caddf0912d2e5c3ab706dbf3d99990afa6e", "author": {"user": {"login": "zacanbrcom", "name": "Andrea Zaccaro"}}, "url": "https://github.com/eclipse/che-che4z-lsp-for-cobol/commit/b8be1caddf0912d2e5c3ab706dbf3d99990afa6e", "committedDate": "2020-07-21T14:29:06Z", "message": "fix: cleanup diagnostic messages when did_close event is triggered #385"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "fc60e57497c767c37739e7f66afd05fb7ae34624", "author": {"user": {"login": "zacanbrcom", "name": "Andrea Zaccaro"}}, "url": "https://github.com/eclipse/che-che4z-lsp-for-cobol/commit/fc60e57497c767c37739e7f66afd05fb7ae34624", "committedDate": "2020-07-21T14:32:53Z", "message": "fix: cleanup diagnostic messages when did_close event is triggered #385"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "95394bbd26a170a2838d358a535df1e01c516199", "author": {"user": {"login": "zacanbrcom", "name": "Andrea Zaccaro"}}, "url": "https://github.com/eclipse/che-che4z-lsp-for-cobol/commit/95394bbd26a170a2838d358a535df1e01c516199", "committedDate": "2020-07-21T14:32:15Z", "message": "refactor: Address req of changes #385"}, "afterCommit": {"oid": "fc60e57497c767c37739e7f66afd05fb7ae34624", "author": {"user": {"login": "zacanbrcom", "name": "Andrea Zaccaro"}}, "url": "https://github.com/eclipse/che-che4z-lsp-for-cobol/commit/fc60e57497c767c37739e7f66afd05fb7ae34624", "committedDate": "2020-07-21T14:32:53Z", "message": "fix: cleanup diagnostic messages when did_close event is triggered #385"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDUyNTI2MzQ2", "url": "https://github.com/eclipse/che-che4z-lsp-for-cobol/pull/434#pullrequestreview-452526346", "createdAt": "2020-07-21T14:39:28Z", "commit": {"oid": "fc60e57497c767c37739e7f66afd05fb7ae34624"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "83410763d36b919216033e7dddf68e5d1563a2fc", "author": {"user": {"login": "zacanbrcom", "name": "Andrea Zaccaro"}}, "url": "https://github.com/eclipse/che-che4z-lsp-for-cobol/commit/83410763d36b919216033e7dddf68e5d1563a2fc", "committedDate": "2020-07-23T12:12:11Z", "message": "Merge remote-tracking branch 'remotes/origin/development' into 385_didClose_diagnostic"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 967, "cost": 1, "resetAt": "2021-11-01T13:51:04Z"}}}