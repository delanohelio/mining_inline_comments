{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDMwODYzNTMx", "number": 381, "title": "test: Improve code coverage for JavaCheck", "bodyText": "Signed-off-by: Azat Satklichov azat.satklichov@broadcom.com", "createdAt": "2020-06-08T07:31:32Z", "url": "https://github.com/eclipse/che-che4z-lsp-for-cobol/pull/381", "merged": true, "mergeCommit": {"oid": "e872e16e9df0ee0c18e6ab729d9944dead20cc9d"}, "closed": true, "closedAt": "2020-06-08T12:19:48Z", "author": {"login": "asatklichov"}, "timelineItems": {"totalCount": 10, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcpLVXOAH2gAyNDMwODYzNTMxOjg5NTkxMDNlOGU1YWUyY2I1Yjk0ZGQ3MzM0MGQ4NjEzZGM2OTNhYTQ=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcpO9fqgFqTQyNjE0Njg1Ng==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "8959103e8e5ae2cb5b94dd73340d8613dc693aa4", "author": {"user": {"login": "asatklichov", "name": "Azat Satklichov"}}, "url": "https://github.com/eclipse/che-che4z-lsp-for-cobol/commit/8959103e8e5ae2cb5b94dd73340d8613dc693aa4", "committedDate": "2020-06-08T07:29:16Z", "message": "test: Improve code coverage for JavaCheck\n\nSigned-off-by: Azat Satklichov <azat.satklichov@broadcom.com>"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDI1OTkwMDU2", "url": "https://github.com/eclipse/che-che4z-lsp-for-cobol/pull/381#pullrequestreview-425990056", "createdAt": "2020-06-08T07:54:26Z", "commit": {"oid": "8959103e8e5ae2cb5b94dd73340d8613dc693aa4"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wOFQwNzo1NDoyNlrOGgSyiQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wOFQwNzo1NDoyNlrOGgSyiQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNjUxNTQ2NQ==", "bodyText": "Just a tiny suggestion: this try/catch for negative cases could be probably extracted as separate function", "url": "https://github.com/eclipse/che-che4z-lsp-for-cobol/pull/381#discussion_r436515465", "createdAt": "2020-06-08T07:54:26Z", "author": {"login": "zacanbrcom"}, "path": "clients/cobol-lsp-vscode-extension/src/__tests__/JavaCheckTest.ts", "diffHunk": "@@ -27,8 +28,93 @@ describe(\"Check Java version\", () => {\n         expect(JavaCheck.isJavaVersionSupported('openjdk version \"12.0.1\" 2018-10-16')).toBeTruthy();\n         expect(JavaCheck.isJavaVersionSupported(\"java 11 2018-09-25\")).toBeTruthy();\n         expect(JavaCheck.isJavaVersionSupported(\"java 12 2019-03-19\")).toBeTruthy();\n+        expect(JavaCheck.isJavaVersionSupported(\"java 13 2019-09-17\")).toBeTruthy();\n+        expect(JavaCheck.isJavaVersionSupported(\"java 14 2020-03-17\")).toBeTruthy();\n     });\n-    it(\"checks if Java version is not supported\", async () => {\n+\n+    it(\"when version is not supported\", async () => {\n         expect(JavaCheck.isJavaVersionSupported('java version \"1.7.0_131\"')).toBeFalsy();\n+        expect(JavaCheck.isJavaVersionSupported('java version \"1.5.0_22\"')).toBeFalsy();\n+    });\n+});\n+\n+describe(\"Checks Java installation\", () => {\n+\n+    let javaCheck: JavaCheck;\n+    let map: any;\n+    let checkFn: any;\n+    let stderrFn: any;\n+    const expectedErrMsgJavaVersionFound = \"Java version 8 expected\";\n+    const expectedErrMsgJavaVersionNotFound = \"Java 8 is not found\";\n+\n+    beforeEach(() => {\n+        javaCheck = new JavaCheck();\n+        checkFn = (event, callbackFn) => {\n+            map[event] = callbackFn;\n+        };\n+        stderrFn = (event, callbackFn) => {\n+            map[event] = callbackFn;\n+        };\n+        map = {};\n+    });\n+\n+    it(\"when required version is supported\", async () => {\n+        (cp as any).spawn = jest.fn().mockReturnValue({stderr: {on: stderrFn}, on: jest.fn()});\n+        const promise = javaCheck.isJavaInstalled();\n+        map.data(\"java 11 2018-09-25\");\n+\n+        try {\n+            expect(await promise).toEqual(undefined);\n+        } catch (e) {\n+            expect(e.toString()).toEqual(expectedErrMsgJavaVersionFound);\n+        }\n+    });\n+\n+    it(\"when required version is not supported\", async () => {\n+        (cp as any).spawn = jest.fn().mockReturnValue({stderr: {on: stderrFn}, on: jest.fn()});\n+        const promise = javaCheck.isJavaInstalled();\n+        map.data('java version \"1.5.0_22\"');\n+\n+        try {\n+            await promise;\n+        } catch (e) {\n+            expect(e.toString()).toEqual(expectedErrMsgJavaVersionFound);\n+        }\n+    });\n+\n+    it(\"when 'error' event is emitted  - spawned\", async () => {\n+        (cp as any).spawn = jest.fn().mockReturnValue({stderr: {on: jest.fn()}, on: checkFn});\n+        const promise = javaCheck.isJavaInstalled();\n+        map.error(\"Error: spawn java ENOENT\");\n+\n+        try {\n+            await promise;\n+        } catch (e) {\n+            expect(e.toString()).toEqual(expectedErrMsgJavaVersionNotFound);\n+        }\n+    });", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "8959103e8e5ae2cb5b94dd73340d8613dc693aa4"}, "originalPosition": 84}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDI1OTkzNTE3", "url": "https://github.com/eclipse/che-che4z-lsp-for-cobol/pull/381#pullrequestreview-425993517", "createdAt": "2020-06-08T07:59:31Z", "commit": {"oid": "8959103e8e5ae2cb5b94dd73340d8613dc693aa4"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "4ee75800266edc716e260f97f8a45dae941a3f98", "author": {"user": {"login": "asatklichov", "name": "Azat Satklichov"}}, "url": "https://github.com/eclipse/che-che4z-lsp-for-cobol/commit/4ee75800266edc716e260f97f8a45dae941a3f98", "committedDate": "2020-06-08T08:44:34Z", "message": "refactor: negative cases extracted to a function\n\nSigned-off-by: Azat Satklichov <azat.satklichov@broadcom.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "2c896c58f0d4538cc3168426576d1163eac44521", "author": {"user": {"login": "asatklichov", "name": "Azat Satklichov"}}, "url": "https://github.com/eclipse/che-che4z-lsp-for-cobol/commit/2c896c58f0d4538cc3168426576d1163eac44521", "committedDate": "2020-06-08T08:55:13Z", "message": "refactor: try catch replaced with inline alternative\n\nSigned-off-by: Azat Satklichov <azat.satklichov@broadcom.com>"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDI2MDM4MTMy", "url": "https://github.com/eclipse/che-che4z-lsp-for-cobol/pull/381#pullrequestreview-426038132", "createdAt": "2020-06-08T09:02:04Z", "commit": {"oid": "2c896c58f0d4538cc3168426576d1163eac44521"}, "state": "APPROVED", "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wOFQwOTowMjowNFrOGgVB1Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wOFQwOTowODoyM1rOGgVQBA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNjU1MjE0OQ==", "bodyText": "it when version is supported - not really readable )", "url": "https://github.com/eclipse/che-che4z-lsp-for-cobol/pull/381#discussion_r436552149", "createdAt": "2020-06-08T09:02:04Z", "author": {"login": "ishche"}, "path": "clients/cobol-lsp-vscode-extension/src/__tests__/JavaCheckTest.ts", "diffHunk": "@@ -12,10 +12,11 @@\n  *   Broadcom, Inc. - initial API and implementation\n  */\n \n-import { JavaCheck } from \"../services/JavaCheck\";\n+import * as cp from \"child_process\";\n+import {JavaCheck} from \"../services/JavaCheck\";\n \n-describe(\"Check Java version\", () => {\n-    it(\"checks if Java version is supported\", async () => {\n+describe(\"Checks Java version\", () => {\n+    it(\"when version is supported\", async () => {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "2c896c58f0d4538cc3168426576d1163eac44521"}, "originalPosition": 11}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNjU1NTMwNw==", "bodyText": "It can be const", "url": "https://github.com/eclipse/che-che4z-lsp-for-cobol/pull/381#discussion_r436555307", "createdAt": "2020-06-08T09:07:32Z", "author": {"login": "ishche"}, "path": "clients/cobol-lsp-vscode-extension/src/__tests__/JavaCheckTest.ts", "diffHunk": "@@ -27,8 +28,73 @@ describe(\"Check Java version\", () => {\n         expect(JavaCheck.isJavaVersionSupported('openjdk version \"12.0.1\" 2018-10-16')).toBeTruthy();\n         expect(JavaCheck.isJavaVersionSupported(\"java 11 2018-09-25\")).toBeTruthy();\n         expect(JavaCheck.isJavaVersionSupported(\"java 12 2019-03-19\")).toBeTruthy();\n+        expect(JavaCheck.isJavaVersionSupported(\"java 13 2019-09-17\")).toBeTruthy();\n+        expect(JavaCheck.isJavaVersionSupported(\"java 14 2020-03-17\")).toBeTruthy();\n     });\n-    it(\"checks if Java version is not supported\", async () => {\n+\n+    it(\"when version is not supported\", async () => {\n         expect(JavaCheck.isJavaVersionSupported('java version \"1.7.0_131\"')).toBeFalsy();\n+        expect(JavaCheck.isJavaVersionSupported('java version \"1.5.0_22\"')).toBeFalsy();\n+    });\n+});\n+\n+describe(\"Checks Java installation\", () => {\n+\n+    let javaCheck: JavaCheck;\n+    let map: any;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "2c896c58f0d4538cc3168426576d1163eac44521"}, "originalPosition": 33}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNjU1NTc4MA==", "bodyText": "Are we supporting java 8 still?", "url": "https://github.com/eclipse/che-che4z-lsp-for-cobol/pull/381#discussion_r436555780", "createdAt": "2020-06-08T09:08:23Z", "author": {"login": "ishche"}, "path": "clients/cobol-lsp-vscode-extension/src/__tests__/JavaCheckTest.ts", "diffHunk": "@@ -27,8 +28,73 @@ describe(\"Check Java version\", () => {\n         expect(JavaCheck.isJavaVersionSupported('openjdk version \"12.0.1\" 2018-10-16')).toBeTruthy();\n         expect(JavaCheck.isJavaVersionSupported(\"java 11 2018-09-25\")).toBeTruthy();\n         expect(JavaCheck.isJavaVersionSupported(\"java 12 2019-03-19\")).toBeTruthy();\n+        expect(JavaCheck.isJavaVersionSupported(\"java 13 2019-09-17\")).toBeTruthy();\n+        expect(JavaCheck.isJavaVersionSupported(\"java 14 2020-03-17\")).toBeTruthy();\n     });\n-    it(\"checks if Java version is not supported\", async () => {\n+\n+    it(\"when version is not supported\", async () => {\n         expect(JavaCheck.isJavaVersionSupported('java version \"1.7.0_131\"')).toBeFalsy();\n+        expect(JavaCheck.isJavaVersionSupported('java version \"1.5.0_22\"')).toBeFalsy();\n+    });\n+});\n+\n+describe(\"Checks Java installation\", () => {\n+\n+    let javaCheck: JavaCheck;\n+    let map: any;\n+    let checkFn: any;\n+    let stderrFn: any;\n+    const expectedErrMsgSupportedJavaVersion = \"Java version 8 expected\";\n+    const expectedErrMsgJavaVersionNotFound = \"Java 8 is not found\";", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "2c896c58f0d4538cc3168426576d1163eac44521"}, "originalPosition": 37}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDI2MDQzNTkw", "url": "https://github.com/eclipse/che-che4z-lsp-for-cobol/pull/381#pullrequestreview-426043590", "createdAt": "2020-06-08T09:09:01Z", "commit": {"oid": "2c896c58f0d4538cc3168426576d1163eac44521"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "80fc1ca6f08be76a52c060dd2b6fbbeaccec6715", "author": {"user": {"login": "asatklichov", "name": "Azat Satklichov"}}, "url": "https://github.com/eclipse/che-che4z-lsp-for-cobol/commit/80fc1ca6f08be76a52c060dd2b6fbbeaccec6715", "committedDate": "2020-06-08T10:30:22Z", "message": "refactor: change outdated Java version message\n\nSigned-off-by: Azat Satklichov <azat.satklichov@broadcom.com>"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDI2MTI4MjUy", "url": "https://github.com/eclipse/che-che4z-lsp-for-cobol/pull/381#pullrequestreview-426128252", "createdAt": "2020-06-08T11:11:10Z", "commit": {"oid": "80fc1ca6f08be76a52c060dd2b6fbbeaccec6715"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDI2MTQ2ODU2", "url": "https://github.com/eclipse/che-che4z-lsp-for-cobol/pull/381#pullrequestreview-426146856", "createdAt": "2020-06-08T11:42:49Z", "commit": {"oid": "80fc1ca6f08be76a52c060dd2b6fbbeaccec6715"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1129, "cost": 1, "resetAt": "2021-11-01T13:51:04Z"}}}