{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0Mzk2Mjc1NjIy", "number": 260, "title": "Add integration tests into Jenkins pipeline", "bodyText": "The changes are ready to merge.\nIt works locally in my Jenkins by parts, but I couldn't run it all together.\nThe changes MUST be tested on Eclipse Jenkins first.", "createdAt": "2020-03-31T11:43:44Z", "url": "https://github.com/eclipse/che-che4z-lsp-for-cobol/pull/260", "merged": true, "mergeCommit": {"oid": "1d246cfbf97359d3b345dc017ea69e035338b7f4"}, "closed": true, "closedAt": "2020-05-04T10:08:06Z", "author": {"login": "grianbrcom"}, "timelineItems": {"totalCount": 11, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcTBpqHgBqjMxODI5MDM0MjY=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcd8j6cgFqTQwNDg1Mzg3MQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "79d2f4edeb0bb5c3180b7debbcd04beb18ecd3fd", "author": {"user": {"login": "grianbrcom", "name": "Anton Grigorev"}}, "url": "https://github.com/eclipse/che-che4z-lsp-for-cobol/commit/79d2f4edeb0bb5c3180b7debbcd04beb18ecd3fd", "committedDate": "2020-03-31T10:35:31Z", "message": "Add integration tests into Jenkins pipeline"}, "afterCommit": {"oid": "52795e92c67fe9ebdafdb79d497436a29404960b", "author": {"user": {"login": "grianbrcom", "name": "Anton Grigorev"}}, "url": "https://github.com/eclipse/che-che4z-lsp-for-cobol/commit/52795e92c67fe9ebdafdb79d497436a29404960b", "committedDate": "2020-03-31T11:45:53Z", "message": "Add integration tests into Jenkins pipeline\n\nSigned-off-by: Anton Grigorev <anton.grigorev@broadcom.com>"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzg0NjU4MDEy", "url": "https://github.com/eclipse/che-che4z-lsp-for-cobol/pull/260#pullrequestreview-384658012", "createdAt": "2020-03-31T11:55:29Z", "commit": {"oid": "52795e92c67fe9ebdafdb79d497436a29404960b"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0zMVQxMTo1NToyOVrOF-SG3w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0zMVQxMTo1NToyOVrOF-SG3w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMDg1MjcwMw==", "bodyText": "is it possible to have it also for chrome? or this is only first portion, and chrome will follow.", "url": "https://github.com/eclipse/che-che4z-lsp-for-cobol/pull/260#discussion_r400852703", "createdAt": "2020-03-31T11:55:29Z", "author": {"login": "tomcec"}, "path": "Jenkinsfile", "diffHunk": "@@ -111,6 +145,29 @@ pipeline {\n                 }\n             }\n         }\n+        stage('Integration test') {\n+            steps {\n+                script {\n+                    if (isTimeTriggeredBuild() && (branchName == 'development' || env.CHANGE_ID)) {\n+                        container('theia') {\n+                            dir('tests') {\n+                                sh './theiaPrepare.sh'\n+                            }\n+                        }\n+                        container('python') {\n+                            dir('tests/theia_automation_lsp') {\n+                                sh 'pip install -r requirements.txt'\n+                                sh 'apt update'\n+                                sh 'apt install firefox-esr -y'\n+                                sh 'PYTHONPATH=`pwd` robot -i Rally -e Unstable --variable HEADLESS:True --outputdir robot_output robot_suites/lsp/local/firefox_lsp_local.robot'", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "52795e92c67fe9ebdafdb79d497436a29404960b"}, "originalPosition": 73}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzg1MzY0Mjgz", "url": "https://github.com/eclipse/che-che4z-lsp-for-cobol/pull/260#pullrequestreview-385364283", "createdAt": "2020-04-01T08:23:52Z", "commit": {"oid": "52795e92c67fe9ebdafdb79d497436a29404960b"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "d18103b4cfcb59c748919b8c6d94073e9e685e5b", "author": {"user": {"login": "grianbrcom", "name": "Anton Grigorev"}}, "url": "https://github.com/eclipse/che-che4z-lsp-for-cobol/commit/d18103b4cfcb59c748919b8c6d94073e9e685e5b", "committedDate": "2020-04-22T11:49:02Z", "message": "ci: Add integration tests to CI/CD\n\nSigned-off-by: Anton Grigorev <anton.grigorev@broadcom.com>"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "dfab965323f17f2a676b315f202734f81fe54bcb", "author": {"user": {"login": "grianbrcom", "name": "Anton Grigorev"}}, "url": "https://github.com/eclipse/che-che4z-lsp-for-cobol/commit/dfab965323f17f2a676b315f202734f81fe54bcb", "committedDate": "2020-04-08T16:03:24Z", "message": "Use shared volume to transfer package.\n\nSigned-off-by: Anton Grigorev <anton.grigorev@broadcom.com>"}, "afterCommit": {"oid": "d18103b4cfcb59c748919b8c6d94073e9e685e5b", "author": {"user": {"login": "grianbrcom", "name": "Anton Grigorev"}}, "url": "https://github.com/eclipse/che-che4z-lsp-for-cobol/commit/d18103b4cfcb59c748919b8c6d94073e9e685e5b", "committedDate": "2020-04-22T11:49:02Z", "message": "ci: Add integration tests to CI/CD\n\nSigned-off-by: Anton Grigorev <anton.grigorev@broadcom.com>"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzk5MTUzOTYz", "url": "https://github.com/eclipse/che-che4z-lsp-for-cobol/pull/260#pullrequestreview-399153963", "createdAt": "2020-04-23T14:27:31Z", "commit": {"oid": "d18103b4cfcb59c748919b8c6d94073e9e685e5b"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yM1QxNDoyNzozMVrOGKq_sw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yM1QxNDoyNzozMVrOGKq_sw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMzg0MzM3OQ==", "bodyText": "Since you are touching the kubernetes pod label, be aware that maximum length is 63 characters. Constructing such long label has potential to break that limit - the pod would not be created/started", "url": "https://github.com/eclipse/che-che4z-lsp-for-cobol/pull/260#discussion_r413843379", "createdAt": "2020-04-23T14:27:31Z", "author": {"login": "filipkroupa"}, "path": "Jenkinsfile", "diffHunk": "@@ -37,17 +37,59 @@ spec:\n       name: known-hosts\n \"\"\"\n \n+def kubernetes_test_config = \"\"\"\n+apiVersion: v1\n+kind: Pod\n+spec:\n+  containers:\n+  - name: theia\n+    image: grianbrcom/theia4cobol:1.0.1\n+    tty: true\n+    command: [ \"/bin/bash\", \"-c\", \"--\" ]\n+    args: [ \"while true; do sleep 1000; done;\" ]\n+    resources:\n+      limits:\n+        memory: \"2Gi\"\n+        cpu: \"1\"\n+      requests:\n+        memory: \"2Gi\"\n+        cpu: \"1\"\n+  - name: python\n+    image: grianbrcom/python-firefox:1.0.1\n+    tty: true\n+    resources:\n+      limits:\n+        memory: \"2Gi\"\n+        cpu: \"1\"\n+      requests:\n+        memory: \"2Gi\"\n+        cpu: \"1\"\n+  - name: jnlp\n+    volumeMounts:\n+    - name: volume-known-hosts\n+      mountPath: /home/jenkins/.ssh\n+  volumes:\n+  - name: volume-known-hosts\n+    configMap:\n+      name: known-hosts\n+\"\"\"\n+\n def projectName = 'lsp-for-cobol'\n-def targetFiles = 'lsp-core-cobol-parser/target/**'\n-def kubeLabel = projectName + '_pod_' + env.BUILD_NUMBER + '_' + env.BRANCH_NAME\n-kubeLabel = kubeLabel.replaceAll(/[^a-zA-Z0-9._-]+/,\"\")\n+def kubeLabelPrefix = \"${projectName}_pod_${env.BUILD_NUMBER}_${env.BRANCH_NAME}\".replaceAll(/[^a-zA-Z0-9._-]+/,\"\")\n+def kubeBuildLabel = \"${kubeLabelPrefix}_build\"\n+def kubeTestLabel = \"${kubeBuildLabel}_test\"", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d18103b4cfcb59c748919b8c6d94073e9e685e5b"}, "originalPosition": 55}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "944c56d036fe68082ffd0096e52aad8c760c975b", "author": {"user": {"login": "grianbrcom", "name": "Anton Grigorev"}}, "url": "https://github.com/eclipse/che-che4z-lsp-for-cobol/commit/944c56d036fe68082ffd0096e52aad8c760c975b", "committedDate": "2020-04-28T10:35:24Z", "message": "Merge branch 'development' into integrationTests"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e99780221f6eb99bd8ce07aace21681902ab966c", "author": {"user": {"login": "grianbrcom", "name": "Anton Grigorev"}}, "url": "https://github.com/eclipse/che-che4z-lsp-for-cobol/commit/e99780221f6eb99bd8ce07aace21681902ab966c", "committedDate": "2020-04-28T15:28:08Z", "message": "Schedule nightly build conditionally\n\nSigned-off-by: Anton Grigorev <anton.grigorev@broadcom.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "442c0dd7ed498bfb21341fce03a2545874b1eb9b", "author": {"user": {"login": "grianbrcom", "name": "Anton Grigorev"}}, "url": "https://github.com/eclipse/che-che4z-lsp-for-cobol/commit/442c0dd7ed498bfb21341fce03a2545874b1eb9b", "committedDate": "2020-04-28T15:56:45Z", "message": "fix branch name variable\n\nSigned-off-by: Anton Grigorev <anton.grigorev@broadcom.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "0849cf92f746a20ac0019eeda09fa2ce9fc2d557", "author": {"user": {"login": "grianbrcom", "name": "Anton Grigorev"}}, "url": "https://github.com/eclipse/che-che4z-lsp-for-cobol/commit/0849cf92f746a20ac0019eeda09fa2ce9fc2d557", "committedDate": "2020-05-04T09:29:11Z", "message": "Ignore failed tests\n\nSigned-off-by: Anton Grigorev <anton.grigorev@broadcom.com>"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDA0ODUzODcx", "url": "https://github.com/eclipse/che-che4z-lsp-for-cobol/pull/260#pullrequestreview-404853871", "createdAt": "2020-05-04T10:03:25Z", "commit": {"oid": "0849cf92f746a20ac0019eeda09fa2ce9fc2d557"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1059, "cost": 1, "resetAt": "2021-11-01T13:51:04Z"}}}