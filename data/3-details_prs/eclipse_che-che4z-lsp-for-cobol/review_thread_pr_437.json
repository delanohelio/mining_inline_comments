{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDU0NTIxNzk2", "number": 437, "reviewThreads": {"totalCount": 8, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yMVQxNDoyMToxOFrOEQpXzg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yMlQwOTozNDoyN1rOEQ-AWw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjg1ODkwNTEwOnYy", "diffSide": "RIGHT", "path": "com.ca.lsp.cobol/lsp-core-cobol-parser/src/main/java/com/ca/lsp/core/cobol/visitor/CobolVisitor.java", "isResolved": true, "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yMVQxNDoyMToxOFrOG06WWA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yMlQwODo1NTozMlrOG1ZOcA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1ODEzNTEyOA==", "bodyText": "Maybe, it would be better to extract ctx.getStart() as a variable to reduce duplicated calls?", "url": "https://github.com/eclipse/che-che4z-lsp-for-cobol/pull/437#discussion_r458135128", "createdAt": "2020-07-21T14:21:18Z", "author": {"login": "temanbrcom"}, "path": "com.ca.lsp.cobol/lsp-core-cobol-parser/src/main/java/com/ca/lsp/core/cobol/visitor/CobolVisitor.java", "diffHunk": "@@ -38,24 +41,140 @@\n   private static final int INFO_LEVEL = 3;\n \n   @Getter private List<SyntaxError> errors = new ArrayList<>();\n+  @Getter @Setter private String programName;\n \n   private String documentUri;\n   private SemanticContext semanticContext;\n+  private CommonTokenStream tokenStream;\n \n-  public CobolVisitor(String documentUri, SemanticContext semanticContext) {\n+  public CobolVisitor(\n+      String documentUri, SemanticContext semanticContext, CommonTokenStream tokenStream) {\n     this.documentUri = documentUri;\n     this.semanticContext = semanticContext;\n+    this.tokenStream = tokenStream;\n+  }\n+\n+  @Override\n+  public Class visitIdentificationDivision(IdentificationDivisionContext ctx) {\n+    String token = ctx.getStart().getText();\n+    areaAWarning(ctx.start.getCharPositionInLine(), token, ctx.getStart().getLine());", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "e68df24b27fec0594aa19189ec357ac51a236b27"}, "originalPosition": 32}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1ODE4MDM2NQ==", "bodyText": "sure", "url": "https://github.com/eclipse/che-che4z-lsp-for-cobol/pull/437#discussion_r458180365", "createdAt": "2020-07-21T15:19:34Z", "author": {"login": "sergiuilie"}, "path": "com.ca.lsp.cobol/lsp-core-cobol-parser/src/main/java/com/ca/lsp/core/cobol/visitor/CobolVisitor.java", "diffHunk": "@@ -38,24 +41,140 @@\n   private static final int INFO_LEVEL = 3;\n \n   @Getter private List<SyntaxError> errors = new ArrayList<>();\n+  @Getter @Setter private String programName;\n \n   private String documentUri;\n   private SemanticContext semanticContext;\n+  private CommonTokenStream tokenStream;\n \n-  public CobolVisitor(String documentUri, SemanticContext semanticContext) {\n+  public CobolVisitor(\n+      String documentUri, SemanticContext semanticContext, CommonTokenStream tokenStream) {\n     this.documentUri = documentUri;\n     this.semanticContext = semanticContext;\n+    this.tokenStream = tokenStream;\n+  }\n+\n+  @Override\n+  public Class visitIdentificationDivision(IdentificationDivisionContext ctx) {\n+    String token = ctx.getStart().getText();\n+    areaAWarning(ctx.start.getCharPositionInLine(), token, ctx.getStart().getLine());", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1ODEzNTEyOA=="}, "originalCommit": {"oid": "e68df24b27fec0594aa19189ec357ac51a236b27"}, "originalPosition": 32}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1ODY0MTAwOA==", "bodyText": "\ud83d\udc4d I left a similar comment, I will resolve mine :)", "url": "https://github.com/eclipse/che-che4z-lsp-for-cobol/pull/437#discussion_r458641008", "createdAt": "2020-07-22T08:55:32Z", "author": {"login": "zacanbrcom"}, "path": "com.ca.lsp.cobol/lsp-core-cobol-parser/src/main/java/com/ca/lsp/core/cobol/visitor/CobolVisitor.java", "diffHunk": "@@ -38,24 +41,140 @@\n   private static final int INFO_LEVEL = 3;\n \n   @Getter private List<SyntaxError> errors = new ArrayList<>();\n+  @Getter @Setter private String programName;\n \n   private String documentUri;\n   private SemanticContext semanticContext;\n+  private CommonTokenStream tokenStream;\n \n-  public CobolVisitor(String documentUri, SemanticContext semanticContext) {\n+  public CobolVisitor(\n+      String documentUri, SemanticContext semanticContext, CommonTokenStream tokenStream) {\n     this.documentUri = documentUri;\n     this.semanticContext = semanticContext;\n+    this.tokenStream = tokenStream;\n+  }\n+\n+  @Override\n+  public Class visitIdentificationDivision(IdentificationDivisionContext ctx) {\n+    String token = ctx.getStart().getText();\n+    areaAWarning(ctx.start.getCharPositionInLine(), token, ctx.getStart().getLine());", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1ODEzNTEyOA=="}, "originalCommit": {"oid": "e68df24b27fec0594aa19189ec357ac51a236b27"}, "originalPosition": 32}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjg1ODk2ODI2OnYy", "diffSide": "RIGHT", "path": "com.ca.lsp.cobol/lsp-core-cobol-parser/src/test/java/com/ca/lsp/core/cobol/visitor/MarginABTest.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yMVQxNDozNDowMVrOG0691g==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yMVQxNDozNDowMVrOG0691g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1ODE0NTIzOA==", "bodyText": "You may use UseCaseEngine#analyze or UseCaseEngine#analyzeForErrors here to reduce code duplication", "url": "https://github.com/eclipse/che-che4z-lsp-for-cobol/pull/437#discussion_r458145238", "createdAt": "2020-07-21T14:34:01Z", "author": {"login": "temanbrcom"}, "path": "com.ca.lsp.cobol/lsp-core-cobol-parser/src/test/java/com/ca/lsp/core/cobol/visitor/MarginABTest.java", "diffHunk": "@@ -0,0 +1,191 @@\n+/*\n+ * Copyright (c) 2020 Broadcom.\n+ * The term \"Broadcom\" refers to Broadcom Inc. and/or its subsidiaries.\n+ *\n+ * This program and the accompanying materials are made\n+ * available under the terms of the Eclipse Public License 2.0\n+ * which is available at https://www.eclipse.org/legal/epl-2.0/\n+ *\n+ * SPDX-License-Identifier: EPL-2.0\n+ *\n+ * Contributors:\n+ *    Broadcom, Inc. - initial API and implementation\n+ */\n+\n+package com.ca.lsp.core.cobol.visitor;\n+\n+import com.broadcom.lsp.cdi.EngineModule;\n+import com.broadcom.lsp.cdi.module.databus.DatabusModule;\n+import com.ca.lsp.core.cobol.engine.CobolLanguageEngine;\n+import com.ca.lsp.core.cobol.model.ResultWithErrors;\n+import com.ca.lsp.core.cobol.semantics.SemanticContext;\n+import com.google.inject.Guice;\n+import static org.junit.Assert.assertEquals;\n+import org.junit.Test;\n+\n+/** This test verifies if the margins are respected and warnings are thrown */\n+public class MarginABTest {\n+\n+  /**\n+   * In TEXT_DIVISION_WRONG_PLACE string there are several DIVISIONS that are not in the right place\n+   */\n+  private static final String TEXT_DIVISION_WRONG_PLACE =\n+      \"000000       IDENTIFICATION DIVISION.\\n\" // starting area B instead of A\n+          + \"000000  PROGRAM-ID.    FILETOTEST.\\n\"\n+          + \"000000  AUTHOR. SERGIU ILIE.\\n\"\n+          + \"000000     DATA DIVISION.\\n\" // starting area B instead of A\n+          + \"000000  WORKING-STORAGE SECTION.\\n\"\n+          + \"000000  01 TAPARM1.\\n\"\n+          + \"000000  01 TAPARM2      PIC 99 VALUE 2.\\n\"\n+          + \"000000  01 ATCDEM3      PIC X(7) VALUE 'ATCDEM3'.\\n\"\n+          + \"000000  01 P1PARM1      PIC 99 VALUE 0.\\n\"\n+          + \"000000  01 TASTRUCT.\\n\"\n+          + \"000000     05 LOC-ID.\\n\"\n+          + \"000000         10 STATE    PIC X(2).\\n\"\n+          + \"000000         10 CITY     PIC X(3).\\n\"\n+          + \"000000     05 OP-SYS     PIC X(3).\\n\"\n+          + \"000000     PROCEDURE DIVISION.\\n\" // starting area B instead of A\n+          + \"000000     MOVE 'ILCHIMVS' TO TASTRUCT.\\n\"\n+          + \"000000     MOVE 'ILSPR' TO LOC-ID.\\n\"\n+          + \"000000     MOVE 'AIX' TO OP-SYS.\\n\"\n+          + \"000000  PROGA.\\n\"\n+          + \"000000     PERFORM WITH TEST BEFORE UNTIL TAPARM1 = 0\\n\"\n+          + \"000000       SUBTRACT 1 FROM TAPARM1\\n\"\n+          + \"000000       CALL 'ATCDEM3'\\n\"\n+          + \"000000     END-PERFORM\\n\"\n+          + \"000000     IF TAPARM2 = 0\\n\"\n+          + \"000000       PERFORM PROCA\\n\"\n+          + \"000000     END-IF\\n\"\n+          + \"000000     PERFORM WITH TEST BEFORE UNTIL TAPARM2 = 0\\n\"\n+          + \"000000       SUBTRACT 1 FROM TAPARM2\\n\"\n+          + \"000000     END-PERFORM.\\n\"\n+          + \"000000  END PROGRAM FILETOTEST.\";\n+\n+  /** In TEXT_AREA_B there are several statements starting on the wrong position */\n+  private static final String TEXT_AREA_B =\n+      \"000000 IDENTIFICATION DIVISION.\\n\"\n+          + \"000000  PROGRAM-ID.    FILETOTEST.\\n\"\n+          + \"000000  AUTHOR. SERGIU ILIE.\\n\"\n+          + \"000000 DATA DIVISION.\\n\"\n+          + \"000000  WORKING-STORAGE SECTION.\\n\"\n+          + \"000000  01 TAPARM1.\\n\"\n+          + \"000000  01 TAPARM2      PIC 99 VALUE 2.\\n\"\n+          + \"000000  01 ATCDEM3      PIC X(7) VALUE 'ATCDEM3'.\\n\"\n+          + \"000000  01 P1PARM1      PIC 99 VALUE 0.\\n\"\n+          + \"000000  01 TASTRUCT.\\n\"\n+          + \"000000  05 LOC-ID.\\n\" // starting area A instead of B\n+          + \"000000         10 STATE    PIC X(2).\\n\"\n+          + \"000000         10 CITY     PIC X(3).\\n\"\n+          + \"000000     05 OP-SYS     PIC X(3).\\n\"\n+          + \"000000 PROCEDURE DIVISION.\\n\"\n+          + \"000000  MOVE 'ILCHIMVS' TO TASTRUCT.\\n\" // starting area A instead of B\n+          + \"000000     MOVE 'ILSPR' TO LOC-ID.\\n\"\n+          + \"000000     MOVE 'AIX' TO OP-SYS.\\n\"\n+          + \"000000  PROGA.\\n\"\n+          + \"000000  PERFORM WITH TEST BEFORE UNTIL TAPARM1 = 0\\n\" // starting area A instead of B\n+          + \"000000       SUBTRACT 1 FROM TAPARM1\\n\"\n+          + \"000000       CALL 'ATCDEM3'\\n\"\n+          + \"000000     END-PERFORM\\n\"\n+          + \"000000     IF TAPARM2 = 0\\n\"\n+          + \"000000       PERFORM PROCA\\n\"\n+          + \"000000     END-IF\\n\"\n+          + \"000000  PERFORM WITH TEST\\n\" // starting area A instead of B\n+          + \"000000  BEFORE UNTIL TAPARM2 = 0\\n\" // starting area A instead of B\n+          + \"000000       SUBTRACT 1 FROM TAPARM2\\n\"\n+          + \"000000     END-PERFORM.\\n\"\n+          + \"000000  END PROGRAM FILETOTEST.\";\n+\n+  private static final String TEXT_PROGRAM_ID =\n+      \"000000 IDENTIFICATION DIVISION.\\n\"\n+          + \"000000  PROGRAM-ID.    FILETOTEST.\\n\"\n+          + \"000000  AUTHOR. SERGIU ILIE.\\n\"\n+          + \"000000 DATA DIVISION.\\n\"\n+          + \"000000  WORKING-STORAGE SECTION.\\n\"\n+          + \"000000  01 TASTRUCT.\\n\"\n+          + \"000000     05 LOC-ID.\\n\"\n+          + \"000000         10 STATE    PIC X(2).\\n\"\n+          + \"000000         10 CITY     PIC X(3).\\n\"\n+          + \"000000     05 OP-SYS     PIC X(3).\\n\"\n+          + \"000000 PROCEDURE DIVISION.\\n\"\n+          + \"000000     MOVE 'ILCHIMVS' TO TASTRUCT.\\n\"\n+          + \"000000     MOVE 'ILSPR' TO LOC-ID.\\n\"\n+          + \"000000     MOVE 'AIX' TO OP-SYS.\\n\"\n+          + \"000000  END PROGRAM FILETOTEST2.\"; // PROGRAM-ID must be similar with PROGRAM-ID\n+  // mentioned on ID DIVISION\n+\n+  /** In TEXT_DECLARATIVES the mistake is on the DECLARATIVE line */\n+  private static final String TEXT_DECLARATIVES =\n+      \"000000 IDENTIFICATION DIVISION.\\n\"\n+          + \"000000  PROGRAM-ID.    FILETOTEST.\\n\"\n+          + \"000000  AUTHOR. SERGIU ILIE.\\n\"\n+          + \"000000 DATA DIVISION.\\n\"\n+          + \"000000  WORKING-STORAGE SECTION.\\n\"\n+          + \"000000  01 TASTRUCT.\\n\"\n+          + \"000000     05 LOC-ID.\\n\"\n+          + \"000000         10 STATE    PIC X(2).\\n\"\n+          + \"000000         10 CITY     PIC X(3).\\n\"\n+          + \"000000     05 OP-SYS     PIC X(3).\\n\"\n+          + \"000000 PROCEDURE DIVISION.\\n\"\n+          + \"000000 DECLARATIVES. MAMA\\n\" // after DECLARATIVES keyword no other token is allowed\n+          + \"000000 COBOL-DEBUG SECTION.\\n\"\n+          + \"000000     USE FOR DEBUGGING ON ALL PROCEDURES.\\n\"\n+          + \"000000 COBOL-DEBUG-PARA.\\n\"\n+          + \"000000     IF READY-TRACE THEN\\n\"\n+          + \"000000       DISPLAY DEBUG-NAME\\n\"\n+          + \"000000     END-IF.\\n\"\n+          + \"000000  END DECLARATIVES.\\n\"\n+          + \"000000     MOVE 'ILCHIMVS' TO TASTRUCT.\\n\"\n+          + \"000000     MOVE 'ILSPR' TO LOC-ID.\\n\"\n+          + \"000000     MOVE 'AIX' TO OP-SYS.\\n\"\n+          + \"000000  END PROGRAM FILETOTEST.\";\n+\n+  @Test\n+  public void checkForAreaA() {\n+    CobolLanguageEngine engine =\n+        Guice.createInjector(new EngineModule(), new DatabusModule())\n+            .getInstance(CobolLanguageEngine.class);\n+    ResultWithErrors<SemanticContext> result;\n+\n+    result = engine.run(\"1\", TEXT_DIVISION_WRONG_PLACE, \"DID_OPEN\");\n+    assertEquals(3, result.getErrors().size());", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "e68df24b27fec0594aa19189ec357ac51a236b27"}, "originalPosition": 150}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjg1ODk3NTAxOnYy", "diffSide": "RIGHT", "path": "com.ca.lsp.cobol/lsp-core-cobol-parser/src/main/java/com/ca/lsp/core/cobol/visitor/CobolVisitor.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yMVQxNDozNToyOVrOG07CGw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yMVQxNTozOTozNFrOG0-C6Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1ODE0NjMzMQ==", "bodyText": "I don't think we need a setter here", "url": "https://github.com/eclipse/che-che4z-lsp-for-cobol/pull/437#discussion_r458146331", "createdAt": "2020-07-21T14:35:29Z", "author": {"login": "temanbrcom"}, "path": "com.ca.lsp.cobol/lsp-core-cobol-parser/src/main/java/com/ca/lsp/core/cobol/visitor/CobolVisitor.java", "diffHunk": "@@ -38,24 +41,140 @@\n   private static final int INFO_LEVEL = 3;\n \n   @Getter private List<SyntaxError> errors = new ArrayList<>();\n+  @Getter @Setter private String programName;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "e68df24b27fec0594aa19189ec357ac51a236b27"}, "originalPosition": 15}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1ODE5NTY4OQ==", "bodyText": "true", "url": "https://github.com/eclipse/che-che4z-lsp-for-cobol/pull/437#discussion_r458195689", "createdAt": "2020-07-21T15:39:34Z", "author": {"login": "sergiuilie"}, "path": "com.ca.lsp.cobol/lsp-core-cobol-parser/src/main/java/com/ca/lsp/core/cobol/visitor/CobolVisitor.java", "diffHunk": "@@ -38,24 +41,140 @@\n   private static final int INFO_LEVEL = 3;\n \n   @Getter private List<SyntaxError> errors = new ArrayList<>();\n+  @Getter @Setter private String programName;", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1ODE0NjMzMQ=="}, "originalCommit": {"oid": "e68df24b27fec0594aa19189ec357ac51a236b27"}, "originalPosition": 15}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjg2MjAzNjIzOnYy", "diffSide": "RIGHT", "path": "com.ca.lsp.cobol/lsp-core-cobol-parser/src/main/java/com/ca/lsp/core/cobol/visitor/CobolVisitor.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yMlQwODoyOToxNFrOG1YPlA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yMlQwODoyOToxNFrOG1YPlA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1ODYyNDkxNg==", "bodyText": "Question: May this portion of code be extracted in a private method that accept as input an instance of ParserRuleContext?", "url": "https://github.com/eclipse/che-che4z-lsp-for-cobol/pull/437#discussion_r458624916", "createdAt": "2020-07-22T08:29:14Z", "author": {"login": "zacanbrcom"}, "path": "com.ca.lsp.cobol/lsp-core-cobol-parser/src/main/java/com/ca/lsp/core/cobol/visitor/CobolVisitor.java", "diffHunk": "@@ -39,23 +41,136 @@\n \n   @Getter private List<SyntaxError> errors = new ArrayList<>();\n \n+  private String programName = null;\n   private String documentUri;\n   private SemanticContext semanticContext;\n+  private CommonTokenStream tokenStream;\n \n-  public CobolVisitor(String documentUri, SemanticContext semanticContext) {\n+  public CobolVisitor(\n+      String documentUri, SemanticContext semanticContext, CommonTokenStream tokenStream) {\n     this.documentUri = documentUri;\n     this.semanticContext = semanticContext;\n+    this.tokenStream = tokenStream;\n+  }\n+\n+  @Override\n+  public Class visitIdentificationDivision(IdentificationDivisionContext ctx) {\n+    Token token = ctx.getStart();\n+    areaAWarning(ctx.start.getCharPositionInLine(), token.getText(), token.getLine());\n+    return visitChildren(ctx);\n+  }\n+\n+  @Override\n+  public Class visitProgramIdParagraph(ProgramIdParagraphContext ctx) {\n+    if (ctx.programName() != null) {\n+      programName = ctx.programName().getText();\n+    }\n+    return visitChildren(ctx);\n+  }\n+\n+  @Override\n+  public Class visitProcedureDivision(ProcedureDivisionContext ctx) {\n+    Token token = ctx.getStart();\n+    areaAWarning(ctx.start.getCharPositionInLine(), token.getText(), token.getLine());\n+    return visitChildren(ctx);\n+  }\n+\n+  @Override\n+  public Class visitEnvironmentDivision(EnvironmentDivisionContext ctx) {\n+    Token token = ctx.getStart();\n+    areaAWarning(ctx.start.getCharPositionInLine(), token.getText(), token.getLine());\n+    return visitChildren(ctx);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "fd9e14c6d59006aa6308fd4c8ddd58a3514aa816"}, "originalPosition": 53}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjg2MjA5ODc4OnYy", "diffSide": "RIGHT", "path": "com.ca.lsp.cobol/lsp-core-cobol-parser/src/main/java/com/ca/lsp/core/cobol/visitor/CobolVisitor.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yMlQwODo0NToxNVrOG1Y1tQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yMlQxMDowMDoyNlrOG1bkCA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1ODYzNDY3Nw==", "bodyText": "Is better provide a String constant for quick reference", "url": "https://github.com/eclipse/che-che4z-lsp-for-cobol/pull/437#discussion_r458634677", "createdAt": "2020-07-22T08:45:15Z", "author": {"login": "zacanbrcom"}, "path": "com.ca.lsp.cobol/lsp-core-cobol-parser/src/main/java/com/ca/lsp/core/cobol/visitor/CobolVisitor.java", "diffHunk": "@@ -39,23 +41,136 @@\n \n   @Getter private List<SyntaxError> errors = new ArrayList<>();\n \n+  private String programName = null;\n   private String documentUri;\n   private SemanticContext semanticContext;\n+  private CommonTokenStream tokenStream;\n \n-  public CobolVisitor(String documentUri, SemanticContext semanticContext) {\n+  public CobolVisitor(\n+      String documentUri, SemanticContext semanticContext, CommonTokenStream tokenStream) {\n     this.documentUri = documentUri;\n     this.semanticContext = semanticContext;\n+    this.tokenStream = tokenStream;\n+  }\n+\n+  @Override\n+  public Class visitIdentificationDivision(IdentificationDivisionContext ctx) {\n+    Token token = ctx.getStart();\n+    areaAWarning(ctx.start.getCharPositionInLine(), token.getText(), token.getLine());\n+    return visitChildren(ctx);\n+  }\n+\n+  @Override\n+  public Class visitProgramIdParagraph(ProgramIdParagraphContext ctx) {\n+    if (ctx.programName() != null) {\n+      programName = ctx.programName().getText();\n+    }\n+    return visitChildren(ctx);\n+  }\n+\n+  @Override\n+  public Class visitProcedureDivision(ProcedureDivisionContext ctx) {\n+    Token token = ctx.getStart();\n+    areaAWarning(ctx.start.getCharPositionInLine(), token.getText(), token.getLine());\n+    return visitChildren(ctx);\n+  }\n+\n+  @Override\n+  public Class visitEnvironmentDivision(EnvironmentDivisionContext ctx) {\n+    Token token = ctx.getStart();\n+    areaAWarning(ctx.start.getCharPositionInLine(), token.getText(), token.getLine());\n+    return visitChildren(ctx);\n+  }\n+\n+  @Override\n+  public Class visitDataDivision(DataDivisionContext ctx) {\n+    Token token = ctx.getStart();\n+    areaAWarning(ctx.start.getCharPositionInLine(), token.getText(), token.getLine());\n+    return visitChildren(ctx);\n+  }\n+\n+  @Override\n+  public Class visitDataDivisionSection(DataDivisionSectionContext ctx) {\n+    Token token = ctx.getStart();\n+    areaAWarning(ctx.start.getCharPositionInLine(), token.getText(), token.getLine());\n+    return visitChildren(ctx);\n+  }\n+\n+  @Override\n+  public Class visitEnvironmentDivisionBody(EnvironmentDivisionBodyContext ctx) {\n+    Token token = ctx.getStart();\n+    areaAWarning(ctx.start.getCharPositionInLine(), token.getText(), token.getLine());\n+    return visitChildren(ctx);\n+  }\n+\n+  @Override\n+  public Class visitProcedureSectionHeader(ProcedureSectionHeaderContext ctx) {\n+    Token token = ctx.getStart();\n+    areaAWarning(ctx.start.getCharPositionInLine(), token.getText(), token.getLine());\n+    return visitChildren(ctx);\n   }\n \n   @Override\n   public Class visitProcedureSection(ProcedureSectionContext ctx) {\n-    String wrongToken = ctx.getStart().getText();\n-    throwWarning(wrongToken, ctx.getStart().getLine(), ctx.getStart().getCharPositionInLine());\n+    Token token = ctx.getStart();\n+    throwWarning(token.getText(), token.getLine(), token.getCharPositionInLine());\n+    return visitChildren(ctx);\n+  }\n+\n+  @Override\n+  public Class visitParagraph(ParagraphContext ctx) {\n+    Token token = ctx.getStart();\n+    areaAWarning(ctx.start.getCharPositionInLine(), token.getText(), token.getLine());\n+    return visitChildren(ctx);\n+  }\n+\n+  @Override\n+  public Class visitDataDescriptionEntryFormat1(DataDescriptionEntryFormat1Context ctx) {\n+    Token token = ctx.getStart();\n+    String tokenText = token.getText();\n+    if (tokenText.equals(\"01\") || tokenText.equals(\"1\") || tokenText.equals(\"77\")) {\n+      areaAWarning(ctx.start.getCharPositionInLine(), tokenText, token.getLine());\n+    }\n+    return visitChildren(ctx);\n+  }\n+\n+  @Override\n+  public Class visitProcedureDeclaratives(ProcedureDeclarativesContext ctx) {\n+    Token firstDeclarative = ctx.getStart();\n+    int firstDeclLine = firstDeclarative.getLine();\n+    Token declarativeBody = ctx.procedureDeclarative(0).getStart();\n+    Token endToken = ctx.END().getSymbol();\n+\n+    if (firstDeclLine == declarativeBody.getLine()) {\n+      throwException(\n+          declarativeBody.getText(),\n+          declarativeBody.getLine(),\n+          declarativeBody.getCharPositionInLine(),\n+          \"Following token can not be on the same line with DECLARATIVE token: \",", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "fd9e14c6d59006aa6308fd4c8ddd58a3514aa816"}, "originalPosition": 122}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1ODY3OTMwNA==", "bodyText": "sure", "url": "https://github.com/eclipse/che-che4z-lsp-for-cobol/pull/437#discussion_r458679304", "createdAt": "2020-07-22T10:00:26Z", "author": {"login": "sergiuilie"}, "path": "com.ca.lsp.cobol/lsp-core-cobol-parser/src/main/java/com/ca/lsp/core/cobol/visitor/CobolVisitor.java", "diffHunk": "@@ -39,23 +41,136 @@\n \n   @Getter private List<SyntaxError> errors = new ArrayList<>();\n \n+  private String programName = null;\n   private String documentUri;\n   private SemanticContext semanticContext;\n+  private CommonTokenStream tokenStream;\n \n-  public CobolVisitor(String documentUri, SemanticContext semanticContext) {\n+  public CobolVisitor(\n+      String documentUri, SemanticContext semanticContext, CommonTokenStream tokenStream) {\n     this.documentUri = documentUri;\n     this.semanticContext = semanticContext;\n+    this.tokenStream = tokenStream;\n+  }\n+\n+  @Override\n+  public Class visitIdentificationDivision(IdentificationDivisionContext ctx) {\n+    Token token = ctx.getStart();\n+    areaAWarning(ctx.start.getCharPositionInLine(), token.getText(), token.getLine());\n+    return visitChildren(ctx);\n+  }\n+\n+  @Override\n+  public Class visitProgramIdParagraph(ProgramIdParagraphContext ctx) {\n+    if (ctx.programName() != null) {\n+      programName = ctx.programName().getText();\n+    }\n+    return visitChildren(ctx);\n+  }\n+\n+  @Override\n+  public Class visitProcedureDivision(ProcedureDivisionContext ctx) {\n+    Token token = ctx.getStart();\n+    areaAWarning(ctx.start.getCharPositionInLine(), token.getText(), token.getLine());\n+    return visitChildren(ctx);\n+  }\n+\n+  @Override\n+  public Class visitEnvironmentDivision(EnvironmentDivisionContext ctx) {\n+    Token token = ctx.getStart();\n+    areaAWarning(ctx.start.getCharPositionInLine(), token.getText(), token.getLine());\n+    return visitChildren(ctx);\n+  }\n+\n+  @Override\n+  public Class visitDataDivision(DataDivisionContext ctx) {\n+    Token token = ctx.getStart();\n+    areaAWarning(ctx.start.getCharPositionInLine(), token.getText(), token.getLine());\n+    return visitChildren(ctx);\n+  }\n+\n+  @Override\n+  public Class visitDataDivisionSection(DataDivisionSectionContext ctx) {\n+    Token token = ctx.getStart();\n+    areaAWarning(ctx.start.getCharPositionInLine(), token.getText(), token.getLine());\n+    return visitChildren(ctx);\n+  }\n+\n+  @Override\n+  public Class visitEnvironmentDivisionBody(EnvironmentDivisionBodyContext ctx) {\n+    Token token = ctx.getStart();\n+    areaAWarning(ctx.start.getCharPositionInLine(), token.getText(), token.getLine());\n+    return visitChildren(ctx);\n+  }\n+\n+  @Override\n+  public Class visitProcedureSectionHeader(ProcedureSectionHeaderContext ctx) {\n+    Token token = ctx.getStart();\n+    areaAWarning(ctx.start.getCharPositionInLine(), token.getText(), token.getLine());\n+    return visitChildren(ctx);\n   }\n \n   @Override\n   public Class visitProcedureSection(ProcedureSectionContext ctx) {\n-    String wrongToken = ctx.getStart().getText();\n-    throwWarning(wrongToken, ctx.getStart().getLine(), ctx.getStart().getCharPositionInLine());\n+    Token token = ctx.getStart();\n+    throwWarning(token.getText(), token.getLine(), token.getCharPositionInLine());\n+    return visitChildren(ctx);\n+  }\n+\n+  @Override\n+  public Class visitParagraph(ParagraphContext ctx) {\n+    Token token = ctx.getStart();\n+    areaAWarning(ctx.start.getCharPositionInLine(), token.getText(), token.getLine());\n+    return visitChildren(ctx);\n+  }\n+\n+  @Override\n+  public Class visitDataDescriptionEntryFormat1(DataDescriptionEntryFormat1Context ctx) {\n+    Token token = ctx.getStart();\n+    String tokenText = token.getText();\n+    if (tokenText.equals(\"01\") || tokenText.equals(\"1\") || tokenText.equals(\"77\")) {\n+      areaAWarning(ctx.start.getCharPositionInLine(), tokenText, token.getLine());\n+    }\n+    return visitChildren(ctx);\n+  }\n+\n+  @Override\n+  public Class visitProcedureDeclaratives(ProcedureDeclarativesContext ctx) {\n+    Token firstDeclarative = ctx.getStart();\n+    int firstDeclLine = firstDeclarative.getLine();\n+    Token declarativeBody = ctx.procedureDeclarative(0).getStart();\n+    Token endToken = ctx.END().getSymbol();\n+\n+    if (firstDeclLine == declarativeBody.getLine()) {\n+      throwException(\n+          declarativeBody.getText(),\n+          declarativeBody.getLine(),\n+          declarativeBody.getCharPositionInLine(),\n+          \"Following token can not be on the same line with DECLARATIVE token: \",", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1ODYzNDY3Nw=="}, "originalCommit": {"oid": "fd9e14c6d59006aa6308fd4c8ddd58a3514aa816"}, "originalPosition": 122}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjg2MjExNTM2OnYy", "diffSide": "RIGHT", "path": "com.ca.lsp.cobol/lsp-core-cobol-parser/src/main/java/com/ca/lsp/core/cobol/visitor/CobolVisitor.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yMlQwODo0OToyMVrOG1Y_nA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yMlQwODo0OToyMVrOG1Y_nA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1ODYzNzIxMg==", "bodyText": "For this case might be useful provide a javadoc to explain the margin checks we applied for the declarative sections", "url": "https://github.com/eclipse/che-che4z-lsp-for-cobol/pull/437#discussion_r458637212", "createdAt": "2020-07-22T08:49:21Z", "author": {"login": "zacanbrcom"}, "path": "com.ca.lsp.cobol/lsp-core-cobol-parser/src/main/java/com/ca/lsp/core/cobol/visitor/CobolVisitor.java", "diffHunk": "@@ -39,23 +41,136 @@\n \n   @Getter private List<SyntaxError> errors = new ArrayList<>();\n \n+  private String programName = null;\n   private String documentUri;\n   private SemanticContext semanticContext;\n+  private CommonTokenStream tokenStream;\n \n-  public CobolVisitor(String documentUri, SemanticContext semanticContext) {\n+  public CobolVisitor(\n+      String documentUri, SemanticContext semanticContext, CommonTokenStream tokenStream) {\n     this.documentUri = documentUri;\n     this.semanticContext = semanticContext;\n+    this.tokenStream = tokenStream;\n+  }\n+\n+  @Override\n+  public Class visitIdentificationDivision(IdentificationDivisionContext ctx) {\n+    Token token = ctx.getStart();\n+    areaAWarning(ctx.start.getCharPositionInLine(), token.getText(), token.getLine());\n+    return visitChildren(ctx);\n+  }\n+\n+  @Override\n+  public Class visitProgramIdParagraph(ProgramIdParagraphContext ctx) {\n+    if (ctx.programName() != null) {\n+      programName = ctx.programName().getText();\n+    }\n+    return visitChildren(ctx);\n+  }\n+\n+  @Override\n+  public Class visitProcedureDivision(ProcedureDivisionContext ctx) {\n+    Token token = ctx.getStart();\n+    areaAWarning(ctx.start.getCharPositionInLine(), token.getText(), token.getLine());\n+    return visitChildren(ctx);\n+  }\n+\n+  @Override\n+  public Class visitEnvironmentDivision(EnvironmentDivisionContext ctx) {\n+    Token token = ctx.getStart();\n+    areaAWarning(ctx.start.getCharPositionInLine(), token.getText(), token.getLine());\n+    return visitChildren(ctx);\n+  }\n+\n+  @Override\n+  public Class visitDataDivision(DataDivisionContext ctx) {\n+    Token token = ctx.getStart();\n+    areaAWarning(ctx.start.getCharPositionInLine(), token.getText(), token.getLine());\n+    return visitChildren(ctx);\n+  }\n+\n+  @Override\n+  public Class visitDataDivisionSection(DataDivisionSectionContext ctx) {\n+    Token token = ctx.getStart();\n+    areaAWarning(ctx.start.getCharPositionInLine(), token.getText(), token.getLine());\n+    return visitChildren(ctx);\n+  }\n+\n+  @Override\n+  public Class visitEnvironmentDivisionBody(EnvironmentDivisionBodyContext ctx) {\n+    Token token = ctx.getStart();\n+    areaAWarning(ctx.start.getCharPositionInLine(), token.getText(), token.getLine());\n+    return visitChildren(ctx);\n+  }\n+\n+  @Override\n+  public Class visitProcedureSectionHeader(ProcedureSectionHeaderContext ctx) {\n+    Token token = ctx.getStart();\n+    areaAWarning(ctx.start.getCharPositionInLine(), token.getText(), token.getLine());\n+    return visitChildren(ctx);\n   }\n \n   @Override\n   public Class visitProcedureSection(ProcedureSectionContext ctx) {\n-    String wrongToken = ctx.getStart().getText();\n-    throwWarning(wrongToken, ctx.getStart().getLine(), ctx.getStart().getCharPositionInLine());\n+    Token token = ctx.getStart();\n+    throwWarning(token.getText(), token.getLine(), token.getCharPositionInLine());\n+    return visitChildren(ctx);\n+  }\n+\n+  @Override\n+  public Class visitParagraph(ParagraphContext ctx) {\n+    Token token = ctx.getStart();\n+    areaAWarning(ctx.start.getCharPositionInLine(), token.getText(), token.getLine());\n+    return visitChildren(ctx);\n+  }\n+\n+  @Override\n+  public Class visitDataDescriptionEntryFormat1(DataDescriptionEntryFormat1Context ctx) {\n+    Token token = ctx.getStart();\n+    String tokenText = token.getText();\n+    if (tokenText.equals(\"01\") || tokenText.equals(\"1\") || tokenText.equals(\"77\")) {\n+      areaAWarning(ctx.start.getCharPositionInLine(), tokenText, token.getLine());\n+    }\n+    return visitChildren(ctx);\n+  }\n+\n+  @Override\n+  public Class visitProcedureDeclaratives(ProcedureDeclarativesContext ctx) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "fd9e14c6d59006aa6308fd4c8ddd58a3514aa816"}, "originalPosition": 111}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjg2MjE2MTYzOnYy", "diffSide": "RIGHT", "path": "com.ca.lsp.cobol/lsp-core-cobol-parser/src/main/java/com/ca/lsp/core/cobol/visitor/CobolVisitor.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yMlQwOTowMTowOFrOG1Zb8Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yMlQwOTo1ODoxMVrOG1be5g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1ODY0NDQ2NQ==", "bodyText": "Question: can we use token.getText() instead of programName?", "url": "https://github.com/eclipse/che-che4z-lsp-for-cobol/pull/437#discussion_r458644465", "createdAt": "2020-07-22T09:01:08Z", "author": {"login": "zacanbrcom"}, "path": "com.ca.lsp.cobol/lsp-core-cobol-parser/src/main/java/com/ca/lsp/core/cobol/visitor/CobolVisitor.java", "diffHunk": "@@ -246,4 +368,49 @@ private Position retrievePosition(ParserRuleContext ctx) {\n         ctx.getStart().getLine(),\n         ctx.getStart().getCharPositionInLine());\n   }\n+\n+  private void areaAWarning(int charPosition, String token, int startLine) {\n+    if (charPosition > 10) {\n+      throwException(\n+          token, startLine, charPosition, \"Following token must start in Area A: \", WARNING_LEVEL);\n+    }\n+  }\n+\n+  private void areaBWarning(List<Token> tokenList) {\n+    for (Token token : tokenList) {\n+      int charPosition = token.getCharPositionInLine();\n+      if (charPosition > 6 && charPosition < 11 && token.getChannel() != 1) {\n+        throwException(\n+            token.getText(),\n+            token.getLine(),\n+            charPosition,\n+            \"Following token must start in Area B: \",\n+            WARNING_LEVEL);\n+      }\n+    }\n+  }\n+\n+  private void checkProgramName(Token token) {\n+    if (programName == null) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "fd9e14c6d59006aa6308fd4c8ddd58a3514aa816"}, "originalPosition": 226}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1ODY3Nzk5MA==", "bodyText": "sure", "url": "https://github.com/eclipse/che-che4z-lsp-for-cobol/pull/437#discussion_r458677990", "createdAt": "2020-07-22T09:58:11Z", "author": {"login": "sergiuilie"}, "path": "com.ca.lsp.cobol/lsp-core-cobol-parser/src/main/java/com/ca/lsp/core/cobol/visitor/CobolVisitor.java", "diffHunk": "@@ -246,4 +368,49 @@ private Position retrievePosition(ParserRuleContext ctx) {\n         ctx.getStart().getLine(),\n         ctx.getStart().getCharPositionInLine());\n   }\n+\n+  private void areaAWarning(int charPosition, String token, int startLine) {\n+    if (charPosition > 10) {\n+      throwException(\n+          token, startLine, charPosition, \"Following token must start in Area A: \", WARNING_LEVEL);\n+    }\n+  }\n+\n+  private void areaBWarning(List<Token> tokenList) {\n+    for (Token token : tokenList) {\n+      int charPosition = token.getCharPositionInLine();\n+      if (charPosition > 6 && charPosition < 11 && token.getChannel() != 1) {\n+        throwException(\n+            token.getText(),\n+            token.getLine(),\n+            charPosition,\n+            \"Following token must start in Area B: \",\n+            WARNING_LEVEL);\n+      }\n+    }\n+  }\n+\n+  private void checkProgramName(Token token) {\n+    if (programName == null) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1ODY0NDQ2NQ=="}, "originalCommit": {"oid": "fd9e14c6d59006aa6308fd4c8ddd58a3514aa816"}, "originalPosition": 226}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjg2MjI4NTcxOnYy", "diffSide": "RIGHT", "path": "com.ca.lsp.cobol/lsp-core-cobol-parser/src/test/java/com/ca/lsp/core/cobol/visitor/VisitorSemanticAnalysisTest.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yMlQwOTozNDoyN1rOG1apFg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yMlQwOTo1ODoxOVrOG1bfHg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1ODY2NDIxNA==", "bodyText": "Question: do we have an unit test that check that misspelled warning message is sent back to the user?", "url": "https://github.com/eclipse/che-che4z-lsp-for-cobol/pull/437#discussion_r458664214", "createdAt": "2020-07-22T09:34:27Z", "author": {"login": "zacanbrcom"}, "path": "com.ca.lsp.cobol/lsp-core-cobol-parser/src/test/java/com/ca/lsp/core/cobol/visitor/VisitorSemanticAnalysisTest.java", "diffHunk": "@@ -81,9 +81,9 @@ public void testDefinedVariableUsageIsFound() {\n    * Check if visitor calculates distance between a wrong token and a keyword and returns a\n    * suggestion with the closest keyword.\n    */\n-  @Test\n+  @Test(expected = NullPointerException.class)", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "fd9e14c6d59006aa6308fd4c8ddd58a3514aa816"}, "originalPosition": 5}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1ODY3ODA0Ng==", "bodyText": "on it", "url": "https://github.com/eclipse/che-che4z-lsp-for-cobol/pull/437#discussion_r458678046", "createdAt": "2020-07-22T09:58:19Z", "author": {"login": "sergiuilie"}, "path": "com.ca.lsp.cobol/lsp-core-cobol-parser/src/test/java/com/ca/lsp/core/cobol/visitor/VisitorSemanticAnalysisTest.java", "diffHunk": "@@ -81,9 +81,9 @@ public void testDefinedVariableUsageIsFound() {\n    * Check if visitor calculates distance between a wrong token and a keyword and returns a\n    * suggestion with the closest keyword.\n    */\n-  @Test\n+  @Test(expected = NullPointerException.class)", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1ODY2NDIxNA=="}, "originalCommit": {"oid": "fd9e14c6d59006aa6308fd4c8ddd58a3514aa816"}, "originalPosition": 5}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3907, "cost": 1, "resetAt": "2021-11-12T18:49:56Z"}}}