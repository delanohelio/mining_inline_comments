{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDE3NDY4MjU1", "number": 353, "title": "Inform user about wrong credentials and stop sending other MF requests", "bodyText": "User was correctly notified if:\n\nZowe profile have empty password\nMF API not accessible\nZowe profile have wrong credentials\ndataset not found\n\nCloses #237\nSigned-off-by: Anton Grigorev anton.grigorev@broadcom.com", "createdAt": "2020-05-13T16:14:51Z", "url": "https://github.com/eclipse/che-che4z-lsp-for-cobol/pull/353", "merged": true, "mergeCommit": {"oid": "342a1be23d74cbb0d9723c541c9457a181d47abe"}, "closed": true, "closedAt": "2020-05-15T08:41:29Z", "author": {"login": "grianbrcom"}, "timelineItems": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcg7PTDAH2gAyNDE3NDY4MjU1OjBkYzA1NDg2YTRiNzQ0M2E3N2IwYzA3MzIwMzM2MWQ5ZWM0MWRjY2U=", "endCursor": "Y3Vyc29yOnYyOpPPAAABchd5kxgFqTQxMjQ1MjgwMA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "0dc05486a4b7443a77b0c073203361d9ec41dcce", "author": {"user": {"login": "grianbrcom", "name": "Anton Grigorev"}}, "url": "https://github.com/eclipse/che-che4z-lsp-for-cobol/commit/0dc05486a4b7443a77b0c073203361d9ec41dcce", "committedDate": "2020-05-13T16:12:46Z", "message": "feat: Inform user about wrong credentials and stop sending other MF requests\n\nUser was correctly notified if:\n* Zowe profile have empty password\n* MF API not accessible\n* Zowe profile have wrong credentials\n* dataset not found\n\nCloses #237\n\nSigned-off-by: Anton Grigorev <anton.grigorev@broadcom.com>"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDExNTkwNTcw", "url": "https://github.com/eclipse/che-che4z-lsp-for-cobol/pull/353#pullrequestreview-411590570", "createdAt": "2020-05-14T08:45:36Z", "commit": {"oid": "0dc05486a4b7443a77b0c073203361d9ec41dcce"}, "state": "APPROVED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xNFQwODo0NTozNlrOGVSJvg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xNFQwODo0NzowN1rOGVSNpw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNDk3MDY4Ng==", "bodyText": "Can profile be undefined here?", "url": "https://github.com/eclipse/che-che4z-lsp-for-cobol/pull/353#discussion_r424970686", "createdAt": "2020-05-14T08:45:36Z", "author": {"login": "ishche"}, "path": "clients/cobol-lsp-vscode-extension/src/services/ZoweApi.ts", "diffHunk": "@@ -41,28 +42,39 @@ export class ZoweApi {\n     }\n \n     public async fetchMember(dataset: string, member: string, profileName: string): Promise<string> {\n-        const session: Session = await this.createSession(profileName);\n+        try {\n+            const session: Session = await this.createSession(profileName);\n \n-        // default should be https\n-        const rpath = `${ZOSMF_PREFIX}${dataset}(${member})`;\n-        return await RestClient.getExpectString(session, rpath, [{\n-            \"Content-Type\": \"application/json\", \"X-CSRF-ZOSMF-HEADER\": \"\",\n-        }]);\n+            // default should be https\n+            const rpath = `${ZOSMF_PREFIX}${dataset}(${member})`;\n+            return await RestClient.getExpectString(session, rpath, [{\n+                \"Content-Type\": \"application/json\", \"X-CSRF-ZOSMF-HEADER\": \"\",\n+            }]);\n+        } catch (error) {\n+            throw convertError(error);\n+        }\n     }\n \n     public async listMembers(dataset: string, profileName: string): Promise<string[]> {\n-        // default should be https\n-        const session: Session = await this.createSession(profileName);\n-        const rpath = `${ZOSMF_PREFIX}${dataset}/member`;\n-        const result = await RestClient.getExpectJSON(session, rpath, [{\n-            \"Content-Type\": \"application/json\", \"X-CSRF-ZOSMF-HEADER\": \"\",\n-        }]);\n-        // tslint:disable-next-line: no-string-literal\n-        return result[\"items\"].map((i: any) => i.member);\n+        try {\n+            // default should be https\n+            const session: Session = await this.createSession(profileName);\n+            const rpath = `${ZOSMF_PREFIX}${dataset}/member`;\n+            const result = await RestClient.getExpectJSON(session, rpath, [{\n+                \"Content-Type\": \"application/json\", \"X-CSRF-ZOSMF-HEADER\": \"\",\n+            }]);\n+            // tslint:disable-next-line: no-string-literal\n+            return result[\"items\"].map((i: any) => i.member);\n+        } catch (error) {\n+            throw convertError(error);\n+        }\n     }\n \n     public async createSession(profileName: string) {\n         const profile = (await new BasicProfileManager(this.createProfileParams()).load({ name: profileName })).profile;\n+        if (profile.password === \"\") {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "0dc05486a4b7443a77b0c073203361d9ec41dcce"}, "originalPosition": 56}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNDk3MTY4Nw==", "bodyText": "Nice, it looks simpler than a hierarchy of classes. Like, subscribe.", "url": "https://github.com/eclipse/che-che4z-lsp-for-cobol/pull/353#discussion_r424971687", "createdAt": "2020-05-14T08:47:07Z", "author": {"login": "ishche"}, "path": "clients/cobol-lsp-vscode-extension/src/services/ZoweError.ts", "diffHunk": "@@ -0,0 +1,33 @@\n+import { RestClientError } from \"@zowe/imperative\";\n+\n+export function convertError(error: any): Error {\n+    if (error instanceof RestClientError) {\n+        switch (+error.mDetails.errorCode) {\n+            case 401:\n+                return new ZoweError(\"Invalid credentials\", Type.InvalidCredentials);\n+            case 404:\n+                return new ZoweError(\"Not found\", Type.NotFound);\n+        }\n+        if (error.mDetails.causeErrors != null &&\n+            (error.mDetails.causeErrors.code === \"ECONNREFUSED\" ||\n+             error.mDetails.causeErrors.code === \"ENOTFOUND\")) {\n+            return new ZoweError(`Connection refused to ${error.mDetails.host}:${error.mDetails.port}`,\n+                Type.ConnRefused);\n+        }\n+    }\n+    return error;\n+}\n+\n+export class ZoweError extends Error {\n+    constructor(message: string, public type: Type = Type.General) {\n+        super(message);\n+    }\n+}\n+\n+export enum Type {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "0dc05486a4b7443a77b0c073203361d9ec41dcce"}, "originalPosition": 27}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDEyNDUyODAw", "url": "https://github.com/eclipse/che-che4z-lsp-for-cobol/pull/353#pullrequestreview-412452800", "createdAt": "2020-05-15T08:35:43Z", "commit": {"oid": "0dc05486a4b7443a77b0c073203361d9ec41dcce"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1097, "cost": 1, "resetAt": "2021-11-01T13:51:04Z"}}}