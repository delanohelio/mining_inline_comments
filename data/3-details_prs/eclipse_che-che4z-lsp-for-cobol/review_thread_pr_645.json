{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTE5Nzk5MDU0", "number": 645, "reviewThreads": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xMlQxMDo1NjoxNVrOE4G3xQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xMlQxNDo1OToxMlrOE4M1_w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzI3MjY4MjkzOnYy", "diffSide": "RIGHT", "path": "clients/cobol-lsp-vscode-extension/package.json", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xMlQxMDo1NjoxNVrOHx1YYA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xMlQxMDo1NjoxNVrOHx1YYA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMjAxNjg2NA==", "bodyText": "run coverage in band mode instead of running in parallel. Planning it to keep this flag for some time and observe the performance and the intermittent failing UI test.", "url": "https://github.com/eclipse/che-che4z-lsp-for-cobol/pull/645#discussion_r522016864", "createdAt": "2020-11-12T10:56:15Z", "author": {"login": "ap891843"}, "path": "clients/cobol-lsp-vscode-extension/package.json", "diffHunk": "@@ -150,7 +150,7 @@\n         \"watch\": \"tsc -watch -p ./\",\n         \"postinstall\": \"node ./node_modules/vscode/bin/install\",\n         \"test\": \"jest -w 1 --unhandled-rejections=strict\",\n-        \"coverage\": \"jest --coverage\"\n+        \"coverage\": \"jest --coverage --runInBand\"", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "6e4664df453b099bbf3f9bfdd53c109d76214e2e"}, "originalPosition": 5}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzI3MjY4NjIxOnYy", "diffSide": "RIGHT", "path": "clients/cobol-lsp-vscode-extension/src/__tests__/ChangeDefaultZoweProfileTest.spec.ts", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xMlQxMDo1NzowMlrOHx1aPQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xMlQxMDo1NzowMlrOHx1aPQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMjAxNzM0MQ==", "bodyText": "fix unhandledRejection cases.", "url": "https://github.com/eclipse/che-che4z-lsp-for-cobol/pull/645#discussion_r522017341", "createdAt": "2020-11-12T10:57:02Z", "author": {"login": "ap891843"}, "path": "clients/cobol-lsp-vscode-extension/src/__tests__/ChangeDefaultZoweProfileTest.spec.ts", "diffHunk": "@@ -15,6 +15,8 @@\n import {changeDefaultZoweProfile} from \"../commands/ChangeDefaultZoweProfile\";\n import { ProfileService } from \"../services/ProfileService\";\n import {ZoweApi} from \"../services/ZoweApi\";\n+\n+jest.mock(\"../services/ProfileService\");", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "6e4664df453b099bbf3f9bfdd53c109d76214e2e"}, "originalPosition": 5}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzI3MjY4NjY1OnYy", "diffSide": "RIGHT", "path": "clients/cobol-lsp-vscode-extension/src/__tests__/CopybookDownloadServiceTest.spec.ts", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xMlQxMDo1NzoxMFrOHx1aig==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xMlQxMzo1NDoyOVrOHx7xnQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMjAxNzQxOA==", "bodyText": "fix unhandledRejection cases.", "url": "https://github.com/eclipse/che-che4z-lsp-for-cobol/pull/645#discussion_r522017418", "createdAt": "2020-11-12T10:57:10Z", "author": {"login": "ap891843"}, "path": "clients/cobol-lsp-vscode-extension/src/__tests__/CopybookDownloadServiceTest.spec.ts", "diffHunk": "@@ -54,6 +54,7 @@ beforeEach(() => {\n });\n \n jest.mock(\"../services/reporter/TelemetryService\");\n+jest.mock(\"../services/ProfileService\");", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "6e4664df453b099bbf3f9bfdd53c109d76214e2e"}, "originalPosition": 4}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMjEyMTYyOQ==", "bodyText": "Cool! It works for me.", "url": "https://github.com/eclipse/che-che4z-lsp-for-cobol/pull/645#discussion_r522121629", "createdAt": "2020-11-12T13:54:29Z", "author": {"login": "grianbrcom"}, "path": "clients/cobol-lsp-vscode-extension/src/__tests__/CopybookDownloadServiceTest.spec.ts", "diffHunk": "@@ -54,6 +54,7 @@ beforeEach(() => {\n });\n \n jest.mock(\"../services/reporter/TelemetryService\");\n+jest.mock(\"../services/ProfileService\");", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMjAxNzQxOA=="}, "originalCommit": {"oid": "6e4664df453b099bbf3f9bfdd53c109d76214e2e"}, "originalPosition": 4}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzI3MzY2MTQzOnYy", "diffSide": "RIGHT", "path": "clients/cobol-lsp-vscode-extension/src/__tests__/LanguageClientServiceTest.spec.ts", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xMlQxNDo1OToxMlrOHx-xBw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xMlQxNTozNToyNFrOHyAd0Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMjE3MDYzMQ==", "bodyText": "Why not to keep .not.toThrowError()?", "url": "https://github.com/eclipse/che-che4z-lsp-for-cobol/pull/645#discussion_r522170631", "createdAt": "2020-11-12T14:59:12Z", "author": {"login": "grianbrcom"}, "path": "clients/cobol-lsp-vscode-extension/src/__tests__/LanguageClientServiceTest.spec.ts", "diffHunk": "@@ -51,29 +51,29 @@ const SERVER_ID = \"COBOL\";\n \n beforeEach(() => {\n     jest.clearAllMocks();\n-});\n-\n-describe(\"LanguageClientService negative scenario.\", () => {\n-\n-    test(\"LSP port not defined and jar path doesn't exists\", async () => {\n-        await expect(new LanguageClientService(undefined).checkPrerequisites())\n-        .rejects.toThrowError(\"LSP server for COBOL not found\");\n-}, 10000);\n+    vscode.workspace.getConfiguration(expect.any(String)).get = jest.fn().mockReturnValue(0);\n });\n \n const SERVER_STARTED_MSG = \"server started\";\n const SERVER_STOPPED_MSG = \"server stopped\";\n describe(\"LanguageClientService positive scenario\", () => {\n-\n     beforeEach(() => {\n-        jest.clearAllMocks();\n         languageClientService = new LanguageClientService(middleware);\n         new JavaCheck().isJavaInstalled = jest.fn().mockResolvedValue(true);\n+        vscode.workspace.getConfiguration(expect.any(String)).get = jest.fn().mockReturnValue(0);\n         fs.existsSync = jest.fn().mockReturnValue(true);\n     });\n \n     test(\"Test LanguageClientService checkPrerequisites passes\", async () => {\n-        expect(async () => await languageClientService.checkPrerequisites()).not.toThrowError();\n+        let message = false;\n+        fs.existsSync = jest.fn().mockReturnValue(true);\n+        vscode.workspace.getConfiguration(expect.any(String)).get = jest.fn().mockReturnValue(9999);\n+        try {\n+            await languageClientService.checkPrerequisites();\n+        } catch (error) {\n+            message = error;\n+        }\n+        expect(message).toBeFalsy();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "caf9d146e4faf5e91b6fa64e73ef4db21ca4654b"}, "originalPosition": 37}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMjE5ODQ4MQ==", "bodyText": "yes, that was the previous implementation.\nawait expect(languageClientService.checkPrerequisites()).not.toThrowError(); should work.\nBut was failing on my machine.  So I took a long route to resolve everything at code and use jest to assert.\nNo clue why. \ud83e\udd15", "url": "https://github.com/eclipse/che-che4z-lsp-for-cobol/pull/645#discussion_r522198481", "createdAt": "2020-11-12T15:35:24Z", "author": {"login": "ap891843"}, "path": "clients/cobol-lsp-vscode-extension/src/__tests__/LanguageClientServiceTest.spec.ts", "diffHunk": "@@ -51,29 +51,29 @@ const SERVER_ID = \"COBOL\";\n \n beforeEach(() => {\n     jest.clearAllMocks();\n-});\n-\n-describe(\"LanguageClientService negative scenario.\", () => {\n-\n-    test(\"LSP port not defined and jar path doesn't exists\", async () => {\n-        await expect(new LanguageClientService(undefined).checkPrerequisites())\n-        .rejects.toThrowError(\"LSP server for COBOL not found\");\n-}, 10000);\n+    vscode.workspace.getConfiguration(expect.any(String)).get = jest.fn().mockReturnValue(0);\n });\n \n const SERVER_STARTED_MSG = \"server started\";\n const SERVER_STOPPED_MSG = \"server stopped\";\n describe(\"LanguageClientService positive scenario\", () => {\n-\n     beforeEach(() => {\n-        jest.clearAllMocks();\n         languageClientService = new LanguageClientService(middleware);\n         new JavaCheck().isJavaInstalled = jest.fn().mockResolvedValue(true);\n+        vscode.workspace.getConfiguration(expect.any(String)).get = jest.fn().mockReturnValue(0);\n         fs.existsSync = jest.fn().mockReturnValue(true);\n     });\n \n     test(\"Test LanguageClientService checkPrerequisites passes\", async () => {\n-        expect(async () => await languageClientService.checkPrerequisites()).not.toThrowError();\n+        let message = false;\n+        fs.existsSync = jest.fn().mockReturnValue(true);\n+        vscode.workspace.getConfiguration(expect.any(String)).get = jest.fn().mockReturnValue(9999);\n+        try {\n+            await languageClientService.checkPrerequisites();\n+        } catch (error) {\n+            message = error;\n+        }\n+        expect(message).toBeFalsy();", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMjE3MDYzMQ=="}, "originalCommit": {"oid": "caf9d146e4faf5e91b6fa64e73ef4db21ca4654b"}, "originalPosition": 37}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3844, "cost": 1, "resetAt": "2021-11-12T18:49:56Z"}}}