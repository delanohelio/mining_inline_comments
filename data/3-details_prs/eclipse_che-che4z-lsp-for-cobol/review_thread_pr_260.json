{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0Mzk2Mjc1NjIy", "number": 260, "reviewThreads": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0zMVQxMTo1NToyOVrODtEo6Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yM1QxNDoyNzozMVrOD1TUzw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjQ4NTg4NTIxOnYy", "diffSide": "RIGHT", "path": "Jenkinsfile", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0zMVQxMTo1NToyOVrOF-SG3w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0zMVQxMjowMzowOVrOF-SXww==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMDg1MjcwMw==", "bodyText": "is it possible to have it also for chrome? or this is only first portion, and chrome will follow.", "url": "https://github.com/eclipse/che-che4z-lsp-for-cobol/pull/260#discussion_r400852703", "createdAt": "2020-03-31T11:55:29Z", "author": {"login": "tomcec"}, "path": "Jenkinsfile", "diffHunk": "@@ -111,6 +145,29 @@ pipeline {\n                 }\n             }\n         }\n+        stage('Integration test') {\n+            steps {\n+                script {\n+                    if (isTimeTriggeredBuild() && (branchName == 'development' || env.CHANGE_ID)) {\n+                        container('theia') {\n+                            dir('tests') {\n+                                sh './theiaPrepare.sh'\n+                            }\n+                        }\n+                        container('python') {\n+                            dir('tests/theia_automation_lsp') {\n+                                sh 'pip install -r requirements.txt'\n+                                sh 'apt update'\n+                                sh 'apt install firefox-esr -y'\n+                                sh 'PYTHONPATH=`pwd` robot -i Rally -e Unstable --variable HEADLESS:True --outputdir robot_output robot_suites/lsp/local/firefox_lsp_local.robot'", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "52795e92c67fe9ebdafdb79d497436a29404960b"}, "originalPosition": 73}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMDg1NzAyNw==", "bodyText": "The tests are the same. As I understand, there is no need to test on both browsers.\nI also faced issues trying to run tests on chrome and choose firefox because it is a more straightforward solution.\nI'm not plan to add chrome support in this request. But it could be done by a separate change, if needed.", "url": "https://github.com/eclipse/che-che4z-lsp-for-cobol/pull/260#discussion_r400857027", "createdAt": "2020-03-31T12:03:09Z", "author": {"login": "grianbrcom"}, "path": "Jenkinsfile", "diffHunk": "@@ -111,6 +145,29 @@ pipeline {\n                 }\n             }\n         }\n+        stage('Integration test') {\n+            steps {\n+                script {\n+                    if (isTimeTriggeredBuild() && (branchName == 'development' || env.CHANGE_ID)) {\n+                        container('theia') {\n+                            dir('tests') {\n+                                sh './theiaPrepare.sh'\n+                            }\n+                        }\n+                        container('python') {\n+                            dir('tests/theia_automation_lsp') {\n+                                sh 'pip install -r requirements.txt'\n+                                sh 'apt update'\n+                                sh 'apt install firefox-esr -y'\n+                                sh 'PYTHONPATH=`pwd` robot -i Rally -e Unstable --variable HEADLESS:True --outputdir robot_output robot_suites/lsp/local/firefox_lsp_local.robot'", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMDg1MjcwMw=="}, "originalCommit": {"oid": "52795e92c67fe9ebdafdb79d497436a29404960b"}, "originalPosition": 73}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjU3MjE3NzQzOnYy", "diffSide": "RIGHT", "path": "Jenkinsfile", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yM1QxNDoyNzozMVrOGKq_sw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yNFQxNTo0MToxMVrOGLdsEg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMzg0MzM3OQ==", "bodyText": "Since you are touching the kubernetes pod label, be aware that maximum length is 63 characters. Constructing such long label has potential to break that limit - the pod would not be created/started", "url": "https://github.com/eclipse/che-che4z-lsp-for-cobol/pull/260#discussion_r413843379", "createdAt": "2020-04-23T14:27:31Z", "author": {"login": "filipkroupa"}, "path": "Jenkinsfile", "diffHunk": "@@ -37,17 +37,59 @@ spec:\n       name: known-hosts\n \"\"\"\n \n+def kubernetes_test_config = \"\"\"\n+apiVersion: v1\n+kind: Pod\n+spec:\n+  containers:\n+  - name: theia\n+    image: grianbrcom/theia4cobol:1.0.1\n+    tty: true\n+    command: [ \"/bin/bash\", \"-c\", \"--\" ]\n+    args: [ \"while true; do sleep 1000; done;\" ]\n+    resources:\n+      limits:\n+        memory: \"2Gi\"\n+        cpu: \"1\"\n+      requests:\n+        memory: \"2Gi\"\n+        cpu: \"1\"\n+  - name: python\n+    image: grianbrcom/python-firefox:1.0.1\n+    tty: true\n+    resources:\n+      limits:\n+        memory: \"2Gi\"\n+        cpu: \"1\"\n+      requests:\n+        memory: \"2Gi\"\n+        cpu: \"1\"\n+  - name: jnlp\n+    volumeMounts:\n+    - name: volume-known-hosts\n+      mountPath: /home/jenkins/.ssh\n+  volumes:\n+  - name: volume-known-hosts\n+    configMap:\n+      name: known-hosts\n+\"\"\"\n+\n def projectName = 'lsp-for-cobol'\n-def targetFiles = 'lsp-core-cobol-parser/target/**'\n-def kubeLabel = projectName + '_pod_' + env.BUILD_NUMBER + '_' + env.BRANCH_NAME\n-kubeLabel = kubeLabel.replaceAll(/[^a-zA-Z0-9._-]+/,\"\")\n+def kubeLabelPrefix = \"${projectName}_pod_${env.BUILD_NUMBER}_${env.BRANCH_NAME}\".replaceAll(/[^a-zA-Z0-9._-]+/,\"\")\n+def kubeBuildLabel = \"${kubeLabelPrefix}_build\"\n+def kubeTestLabel = \"${kubeBuildLabel}_test\"", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d18103b4cfcb59c748919b8c6d94073e9e685e5b"}, "originalPosition": 55}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNDY3MzkzOA==", "bodyText": "You are right. So, this means for a three-digit build number we should have a branch name length less or equal then 35 characters. The current limit is 41. I could make a short suffix or use the same label for pods.", "url": "https://github.com/eclipse/che-che4z-lsp-for-cobol/pull/260#discussion_r414673938", "createdAt": "2020-04-24T15:41:11Z", "author": {"login": "grianbrcom"}, "path": "Jenkinsfile", "diffHunk": "@@ -37,17 +37,59 @@ spec:\n       name: known-hosts\n \"\"\"\n \n+def kubernetes_test_config = \"\"\"\n+apiVersion: v1\n+kind: Pod\n+spec:\n+  containers:\n+  - name: theia\n+    image: grianbrcom/theia4cobol:1.0.1\n+    tty: true\n+    command: [ \"/bin/bash\", \"-c\", \"--\" ]\n+    args: [ \"while true; do sleep 1000; done;\" ]\n+    resources:\n+      limits:\n+        memory: \"2Gi\"\n+        cpu: \"1\"\n+      requests:\n+        memory: \"2Gi\"\n+        cpu: \"1\"\n+  - name: python\n+    image: grianbrcom/python-firefox:1.0.1\n+    tty: true\n+    resources:\n+      limits:\n+        memory: \"2Gi\"\n+        cpu: \"1\"\n+      requests:\n+        memory: \"2Gi\"\n+        cpu: \"1\"\n+  - name: jnlp\n+    volumeMounts:\n+    - name: volume-known-hosts\n+      mountPath: /home/jenkins/.ssh\n+  volumes:\n+  - name: volume-known-hosts\n+    configMap:\n+      name: known-hosts\n+\"\"\"\n+\n def projectName = 'lsp-for-cobol'\n-def targetFiles = 'lsp-core-cobol-parser/target/**'\n-def kubeLabel = projectName + '_pod_' + env.BUILD_NUMBER + '_' + env.BRANCH_NAME\n-kubeLabel = kubeLabel.replaceAll(/[^a-zA-Z0-9._-]+/,\"\")\n+def kubeLabelPrefix = \"${projectName}_pod_${env.BUILD_NUMBER}_${env.BRANCH_NAME}\".replaceAll(/[^a-zA-Z0-9._-]+/,\"\")\n+def kubeBuildLabel = \"${kubeLabelPrefix}_build\"\n+def kubeTestLabel = \"${kubeBuildLabel}_test\"", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMzg0MzM3OQ=="}, "originalCommit": {"oid": "d18103b4cfcb59c748919b8c6d94073e9e685e5b"}, "originalPosition": 55}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3998, "cost": 1, "resetAt": "2021-11-12T18:49:56Z"}}}