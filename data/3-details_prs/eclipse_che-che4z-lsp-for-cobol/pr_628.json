{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTE3NzQ0ODkz", "number": 628, "title": "fix: Copybook with Name in Quotes Not Recognized #620", "bodyText": "Normalize token name for copybooks implementation\nUnit tests\nUpdate usecase engine\n+1 Use case for testing purpose", "createdAt": "2020-11-09T12:56:13Z", "url": "https://github.com/eclipse/che-che4z-lsp-for-cobol/pull/628", "merged": true, "mergeCommit": {"oid": "b6458fa8e183269b655947f96ac1ccfa0b86f8e2"}, "closed": true, "closedAt": "2020-11-10T14:04:06Z", "author": {"login": "Nurkambay"}, "timelineItems": {"totalCount": 13, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABda00P-ABqjM5NzM3NjA3MjQ=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdbJ27eAFqTUyNzIzMDc0OA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "18fe58ee979524d0f4c5ec0e52f2a25a3f6d227a", "author": {"user": {"login": "Nurkambay", "name": "Leonid Baranov"}}, "url": "https://github.com/eclipse/che-che4z-lsp-for-cobol/commit/18fe58ee979524d0f4c5ec0e52f2a25a3f6d227a", "committedDate": "2020-11-09T12:52:32Z", "message": "bugfix: Copybook with Name in Quotes Not Recognized #620\n\nSigned-off-by: Leonid Baranov <leonid.baranov@broadcom.com>"}, "afterCommit": {"oid": "603abc8b6be19a7d34aae0c7f15158388bc88314", "author": {"user": {"login": "Nurkambay", "name": "Leonid Baranov"}}, "url": "https://github.com/eclipse/che-che4z-lsp-for-cobol/commit/603abc8b6be19a7d34aae0c7f15158388bc88314", "committedDate": "2020-11-09T13:31:18Z", "message": "fix: Copybook with Name in Quotes Not Recognized #620\n\nSigned-off-by: Leonid Baranov <leonid.baranov@broadcom.com>"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTI2MjYwNTg3", "url": "https://github.com/eclipse/che-che4z-lsp-for-cobol/pull/628#pullrequestreview-526260587", "createdAt": "2020-11-09T13:34:15Z", "commit": {"oid": "603abc8b6be19a7d34aae0c7f15158388bc88314"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wOVQxMzozNDoxNVrOHvvJBA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wOVQxMzo0OTowMlrOHvvtbw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxOTgxNzQ3Ng==", "bodyText": "Please, use PreprocessorStringUtils#trimQuotes instead", "url": "https://github.com/eclipse/che-che4z-lsp-for-cobol/pull/628#discussion_r519817476", "createdAt": "2020-11-09T13:34:15Z", "author": {"login": "temanbrcom"}, "path": "server/src/main/java/com/broadcom/lsp/cobol/core/preprocessor/delegates/GrammarPreprocessorListenerImpl.java", "diffHunk": "@@ -336,7 +337,7 @@ private String retrieveCopybookName(@NonNull CopySourceContext copySource) {\n   }\n \n   private String retrieveCopybookName(@NonNull RuleContext context) {\n-    return context.getText().toUpperCase();\n+    return CopybookHelper.normalizeName(context.getText());", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "603abc8b6be19a7d34aae0c7f15158388bc88314"}, "originalPosition": 13}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxOTgyNjI4NQ==", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            COPYBOOKNAME : ('\\'')*([a-zA-Z0-9#@$]+ ([-_]+ [a-zA-Z0-9#@$]+)*)+('\\'')*;\n          \n          \n            \n            COPYBOOKNAME : [a-zA-Z0-9#@$]+ ([-_]+ [a-zA-Z0-9#@$]+)*;\n          \n          \n            \n            QUOTED_COPYBOOKNAME : '\\'' + COPYBOOKNAME + '\\'';\n          \n          \n            \n            DOUBLE_QUOTED_COPYBOOKNAME : '\"' + COPYBOOKNAME + '\"';\n          \n      \n    \n    \n  \n\nI would recommend specifying explicitly the possible cases not to allow unclosed literals or something. It will also need to add this:\ncpyName\n   : IDENTIFIER | COPYBOOKNAME | QUOTED_COPYBOOKNAME | DOUBLE_QUOTED_COPYBOOKNAME\n   ;", "url": "https://github.com/eclipse/che-che4z-lsp-for-cobol/pull/628#discussion_r519826285", "createdAt": "2020-11-09T13:48:12Z", "author": {"login": "temanbrcom"}, "path": "server/src/test/antlr4/com/broadcom/usecase/UseCasePreprocessor.g4", "diffHunk": "@@ -130,7 +130,7 @@ MULTITOKENSTOP : '_' + STOP;\n STRINGLITERAL : [\"] ~[\"]* [\"];\n IDENTIFIER : [a-zA-Z0-9:]+ ([-_]+ [a-zA-Z0-9:]+)*;\n \n-COPYBOOKNAME : [a-zA-Z0-9#@$]+ ([-_]+ [a-zA-Z0-9#@$]+)*;\n+COPYBOOKNAME : ('\\'')*([a-zA-Z0-9#@$]+ ([-_]+ [a-zA-Z0-9#@$]+)*)+('\\'')*;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "603abc8b6be19a7d34aae0c7f15158388bc88314"}, "originalPosition": 5}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxOTgyNjc5OQ==", "bodyText": "Please, add also a check for double-quotes.", "url": "https://github.com/eclipse/che-che4z-lsp-for-cobol/pull/628#discussion_r519826799", "createdAt": "2020-11-09T13:49:02Z", "author": {"login": "temanbrcom"}, "path": "server/src/test/java/com/broadcom/lsp/cobol/usecases/TestCopybookNameWithQuotes.java", "diffHunk": "@@ -0,0 +1,30 @@\n+package com.broadcom.lsp.cobol.usecases;\n+\n+import com.broadcom.lsp.cobol.positive.CobolText;\n+import com.broadcom.lsp.cobol.usecases.engine.UseCaseEngine;\n+import org.junit.jupiter.api.Test;\n+\n+import java.util.List;\n+import java.util.Map;\n+\n+/**\n+ * This test checks that the copybook name with quotes processed successfully\n+ */\n+class TestCopybookNameWithQuotes {\n+  private static final String TEXT =\n+          \"        IDENTIFICATION DIVISION.\\n\"\n+          + \"          PROGRAM-ID. PARTEST.\\n\"\n+          + \"          DATA DIVISION.\\n\"\n+          + \"          WORKING-STORAGE SECTION.\\n\"\n+          + \"          PROCEDURE DIVISION.\\n\"\n+          + \"            COPY {~'CPBTEST'}.\\n\";", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "603abc8b6be19a7d34aae0c7f15158388bc88314"}, "originalPosition": 20}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "603abc8b6be19a7d34aae0c7f15158388bc88314", "author": {"user": {"login": "Nurkambay", "name": "Leonid Baranov"}}, "url": "https://github.com/eclipse/che-che4z-lsp-for-cobol/commit/603abc8b6be19a7d34aae0c7f15158388bc88314", "committedDate": "2020-11-09T13:31:18Z", "message": "fix: Copybook with Name in Quotes Not Recognized #620\n\nSigned-off-by: Leonid Baranov <leonid.baranov@broadcom.com>"}, "afterCommit": {"oid": "5e82191d2d7edb7374a4b90da0b0529d880a8571", "author": {"user": {"login": "Nurkambay", "name": "Leonid Baranov"}}, "url": "https://github.com/eclipse/che-che4z-lsp-for-cobol/commit/5e82191d2d7edb7374a4b90da0b0529d880a8571", "committedDate": "2020-11-09T14:22:52Z", "message": "fix: Copybook with Name in Quotes Not Recognized #620\n\nSigned-off-by: Leonid Baranov <leonid.baranov@broadcom.com>"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "5e82191d2d7edb7374a4b90da0b0529d880a8571", "author": {"user": {"login": "Nurkambay", "name": "Leonid Baranov"}}, "url": "https://github.com/eclipse/che-che4z-lsp-for-cobol/commit/5e82191d2d7edb7374a4b90da0b0529d880a8571", "committedDate": "2020-11-09T14:22:52Z", "message": "fix: Copybook with Name in Quotes Not Recognized #620\n\nSigned-off-by: Leonid Baranov <leonid.baranov@broadcom.com>"}, "afterCommit": {"oid": "1a3c1e0d09cb38ff98e63ea80af5d7ae5c142c31", "author": {"user": {"login": "Nurkambay", "name": "Leonid Baranov"}}, "url": "https://github.com/eclipse/che-che4z-lsp-for-cobol/commit/1a3c1e0d09cb38ff98e63ea80af5d7ae5c142c31", "committedDate": "2020-11-09T14:26:10Z", "message": "fix: Copybook with Name in Quotes Not Recognized #620\n\nSigned-off-by: Leonid Baranov <leonid.baranov@broadcom.com>"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTI3MDI2MjE4", "url": "https://github.com/eclipse/che-che4z-lsp-for-cobol/pull/628#pullrequestreview-527026218", "createdAt": "2020-11-10T09:47:20Z", "commit": {"oid": "1a3c1e0d09cb38ff98e63ea80af5d7ae5c142c31"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "1a3c1e0d09cb38ff98e63ea80af5d7ae5c142c31", "author": {"user": {"login": "Nurkambay", "name": "Leonid Baranov"}}, "url": "https://github.com/eclipse/che-che4z-lsp-for-cobol/commit/1a3c1e0d09cb38ff98e63ea80af5d7ae5c142c31", "committedDate": "2020-11-09T14:26:10Z", "message": "fix: Copybook with Name in Quotes Not Recognized #620\n\nSigned-off-by: Leonid Baranov <leonid.baranov@broadcom.com>"}, "afterCommit": {"oid": "1b4e58f363a0fbbccb2c7c2252d069054f5a5d50", "author": {"user": {"login": "Nurkambay", "name": "Leonid Baranov"}}, "url": "https://github.com/eclipse/che-che4z-lsp-for-cobol/commit/1b4e58f363a0fbbccb2c7c2252d069054f5a5d50", "committedDate": "2020-11-10T10:41:32Z", "message": "fix: Copybook with Name in Quotes Not Recognized #620\n\nSigned-off-by: Leonid Baranov <leonid.baranov@broadcom.com>"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "1b4e58f363a0fbbccb2c7c2252d069054f5a5d50", "author": {"user": {"login": "Nurkambay", "name": "Leonid Baranov"}}, "url": "https://github.com/eclipse/che-che4z-lsp-for-cobol/commit/1b4e58f363a0fbbccb2c7c2252d069054f5a5d50", "committedDate": "2020-11-10T10:41:32Z", "message": "fix: Copybook with Name in Quotes Not Recognized #620\n\nSigned-off-by: Leonid Baranov <leonid.baranov@broadcom.com>"}, "afterCommit": {"oid": "24525cb17e126e51cb26edf4f981479a302dc834", "author": {"user": {"login": "Nurkambay", "name": "Leonid Baranov"}}, "url": "https://github.com/eclipse/che-che4z-lsp-for-cobol/commit/24525cb17e126e51cb26edf4f981479a302dc834", "committedDate": "2020-11-10T10:59:58Z", "message": "fix: Copybook with Name in Quotes Not Recognized #620\n\nSigned-off-by: Leonid Baranov <leonid.baranov@broadcom.com>"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "24525cb17e126e51cb26edf4f981479a302dc834", "author": {"user": {"login": "Nurkambay", "name": "Leonid Baranov"}}, "url": "https://github.com/eclipse/che-che4z-lsp-for-cobol/commit/24525cb17e126e51cb26edf4f981479a302dc834", "committedDate": "2020-11-10T10:59:58Z", "message": "fix: Copybook with Name in Quotes Not Recognized #620\n\nSigned-off-by: Leonid Baranov <leonid.baranov@broadcom.com>"}, "afterCommit": {"oid": "7ee385fd6712b3cb8c7be0c6cb74b38404edae87", "author": {"user": {"login": "Nurkambay", "name": "Leonid Baranov"}}, "url": "https://github.com/eclipse/che-che4z-lsp-for-cobol/commit/7ee385fd6712b3cb8c7be0c6cb74b38404edae87", "committedDate": "2020-11-10T11:58:11Z", "message": "fix: Copybook with Name in Quotes Not Recognized #620\n\nSigned-off-by: Leonid Baranov <leonid.baranov@broadcom.com>"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "7ee385fd6712b3cb8c7be0c6cb74b38404edae87", "author": {"user": {"login": "Nurkambay", "name": "Leonid Baranov"}}, "url": "https://github.com/eclipse/che-che4z-lsp-for-cobol/commit/7ee385fd6712b3cb8c7be0c6cb74b38404edae87", "committedDate": "2020-11-10T11:58:11Z", "message": "fix: Copybook with Name in Quotes Not Recognized #620\n\nSigned-off-by: Leonid Baranov <leonid.baranov@broadcom.com>"}, "afterCommit": {"oid": "594f50b77a39ada424fae81ac3573a0486ccae6f", "author": {"user": {"login": "Nurkambay", "name": "Leonid Baranov"}}, "url": "https://github.com/eclipse/che-che4z-lsp-for-cobol/commit/594f50b77a39ada424fae81ac3573a0486ccae6f", "committedDate": "2020-11-10T13:16:41Z", "message": "fix: Copybook with Name in Quotes Not Recognized #620\n\nSigned-off-by: Leonid Baranov <leonid.baranov@broadcom.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "729997cc5fb29130f989a92f81933d842b18bc43", "author": {"user": {"login": "Nurkambay", "name": "Leonid Baranov"}}, "url": "https://github.com/eclipse/che-che4z-lsp-for-cobol/commit/729997cc5fb29130f989a92f81933d842b18bc43", "committedDate": "2020-11-10T13:47:16Z", "message": "fix: Copybook with Name in Quotes Not Recognized #620\n\nSigned-off-by: Leonid Baranov <leonid.baranov@broadcom.com>"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "594f50b77a39ada424fae81ac3573a0486ccae6f", "author": {"user": {"login": "Nurkambay", "name": "Leonid Baranov"}}, "url": "https://github.com/eclipse/che-che4z-lsp-for-cobol/commit/594f50b77a39ada424fae81ac3573a0486ccae6f", "committedDate": "2020-11-10T13:16:41Z", "message": "fix: Copybook with Name in Quotes Not Recognized #620\n\nSigned-off-by: Leonid Baranov <leonid.baranov@broadcom.com>"}, "afterCommit": {"oid": "729997cc5fb29130f989a92f81933d842b18bc43", "author": {"user": {"login": "Nurkambay", "name": "Leonid Baranov"}}, "url": "https://github.com/eclipse/che-che4z-lsp-for-cobol/commit/729997cc5fb29130f989a92f81933d842b18bc43", "committedDate": "2020-11-10T13:47:16Z", "message": "fix: Copybook with Name in Quotes Not Recognized #620\n\nSigned-off-by: Leonid Baranov <leonid.baranov@broadcom.com>"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTI3MjI5NjMy", "url": "https://github.com/eclipse/che-che4z-lsp-for-cobol/pull/628#pullrequestreview-527229632", "createdAt": "2020-11-10T14:01:09Z", "commit": {"oid": "729997cc5fb29130f989a92f81933d842b18bc43"}, "state": "COMMENTED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTI3MjMwNzQ4", "url": "https://github.com/eclipse/che-che4z-lsp-for-cobol/pull/628#pullrequestreview-527230748", "createdAt": "2020-11-10T14:02:20Z", "commit": {"oid": "729997cc5fb29130f989a92f81933d842b18bc43"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 880, "cost": 1, "resetAt": "2021-11-01T13:51:04Z"}}}