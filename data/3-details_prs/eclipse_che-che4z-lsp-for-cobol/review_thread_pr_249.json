{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0Mzg2ODAwOTYz", "number": 249, "reviewThreads": {"totalCount": 18, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xMlQwODoxMzo0MVrODnXhMA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0zMFQxNDozODoxMVrODstEDw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjQyNjA2Mzg0OnYy", "diffSide": "RIGHT", "path": "com.ca.lsp.cobol/lsp-service-cobol/src/main/java/com/ca/lsp/cobol/service/MyLanguageServerImpl.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xMlQwODoxMzo0MVrOF1UqEA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xMlQxMDoxMDoxNVrOF1YU2A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MTQ1NzI5Ng==", "bodyText": "Why do we need this reference?", "url": "https://github.com/eclipse/che-che4z-lsp-for-cobol/pull/249#discussion_r391457296", "createdAt": "2020-03-12T08:13:41Z", "author": {"login": "zacanbrcom"}, "path": "com.ca.lsp.cobol/lsp-service-cobol/src/main/java/com/ca/lsp/cobol/service/MyLanguageServerImpl.java", "diffHunk": "@@ -75,12 +75,14 @@\n       TextDocumentService textService,\n       WorkspaceService workspaceService,\n       Provider<LanguageClient> clientProvider,\n-      SettingsProvider settingsProvider) {\n+      SettingsProvider settingsProvider,\n+      MyTextDocumentService customTextService) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "6767b2105287fc95c12c465aa3b67e175b527e41"}, "originalPosition": 15}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MTUxNzQwMA==", "bodyText": "that is TextDocumentService which is the interface provided by lsp4j and the parameter that I need to set is workspaceFolder which I added in the MyTextDocumentService, in order to get this into the didOpen/didClose method", "url": "https://github.com/eclipse/che-che4z-lsp-for-cobol/pull/249#discussion_r391517400", "createdAt": "2020-03-12T10:10:15Z", "author": {"login": "sergiuilie"}, "path": "com.ca.lsp.cobol/lsp-service-cobol/src/main/java/com/ca/lsp/cobol/service/MyLanguageServerImpl.java", "diffHunk": "@@ -75,12 +75,14 @@\n       TextDocumentService textService,\n       WorkspaceService workspaceService,\n       Provider<LanguageClient> clientProvider,\n-      SettingsProvider settingsProvider) {\n+      SettingsProvider settingsProvider,\n+      MyTextDocumentService customTextService) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MTQ1NzI5Ng=="}, "originalCommit": {"oid": "6767b2105287fc95c12c465aa3b67e175b527e41"}, "originalPosition": 15}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjQyNjA2ODU2OnYy", "diffSide": "RIGHT", "path": "com.ca.lsp.cobol/lsp-service-cobol/src/main/java/com/ca/lsp/cobol/service/MyTextDocumentService.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xMlQwODoxNToxMFrOF1Usyg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xMlQwODoxNToxMFrOF1Usyg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MTQ1Nzk5NA==", "bodyText": "Probably you forgot to complete this statement", "url": "https://github.com/eclipse/che-che4z-lsp-for-cobol/pull/249#discussion_r391457994", "createdAt": "2020-03-12T08:15:10Z", "author": {"login": "zacanbrcom"}, "path": "com.ca.lsp.cobol/lsp-service-cobol/src/main/java/com/ca/lsp/cobol/service/MyTextDocumentService.java", "diffHunk": "@@ -213,6 +223,28 @@ private void registerEngineAndAnalyze(String uri, String languageType, String te\n     }\n   }\n \n+  /**\n+   * This method", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "6767b2105287fc95c12c465aa3b67e175b527e41"}, "originalPosition": 62}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjQyNjA3MjM4OnYy", "diffSide": "RIGHT", "path": "com.ca.lsp.cobol/lsp-service-cobol/src/main/java/com/ca/lsp/cobol/service/MyLanguageServerImpl.java", "isResolved": true, "comments": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xMlQwODoxNjoyN1rOF1Uu_Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xMlQwOToxMTowOVrOF1WU8Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MTQ1ODU1Nw==", "bodyText": "MyTextDocumentService is passed as a first parameter here", "url": "https://github.com/eclipse/che-che4z-lsp-for-cobol/pull/249#discussion_r391458557", "createdAt": "2020-03-12T08:16:27Z", "author": {"login": "temanbrcom"}, "path": "com.ca.lsp.cobol/lsp-service-cobol/src/main/java/com/ca/lsp/cobol/service/MyLanguageServerImpl.java", "diffHunk": "@@ -75,12 +75,14 @@\n       TextDocumentService textService,\n       WorkspaceService workspaceService,\n       Provider<LanguageClient> clientProvider,\n-      SettingsProvider settingsProvider) {\n+      SettingsProvider settingsProvider,\n+      MyTextDocumentService customTextService) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "6767b2105287fc95c12c465aa3b67e175b527e41"}, "originalPosition": 15}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MTQ3ODkzMg==", "bodyText": "that is TextDocumentService which is the interface provided by lsp4j and the parameter that I need to set is workspaceFolder which I added in the MyTextDocumentService, in order to get this into the didOpen method", "url": "https://github.com/eclipse/che-che4z-lsp-for-cobol/pull/249#discussion_r391478932", "createdAt": "2020-03-12T08:59:56Z", "author": {"login": "sergiuilie"}, "path": "com.ca.lsp.cobol/lsp-service-cobol/src/main/java/com/ca/lsp/cobol/service/MyLanguageServerImpl.java", "diffHunk": "@@ -75,12 +75,14 @@\n       TextDocumentService textService,\n       WorkspaceService workspaceService,\n       Provider<LanguageClient> clientProvider,\n-      SettingsProvider settingsProvider) {\n+      SettingsProvider settingsProvider,\n+      MyTextDocumentService customTextService) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MTQ1ODU1Nw=="}, "originalCommit": {"oid": "6767b2105287fc95c12c465aa3b67e175b527e41"}, "originalPosition": 15}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MTQ4MTI1Mg==", "bodyText": "Is still not clear for me, better discuss in a parking lot or earlier if u need", "url": "https://github.com/eclipse/che-che4z-lsp-for-cobol/pull/249#discussion_r391481252", "createdAt": "2020-03-12T09:04:36Z", "author": {"login": "zacanbrcom"}, "path": "com.ca.lsp.cobol/lsp-service-cobol/src/main/java/com/ca/lsp/cobol/service/MyLanguageServerImpl.java", "diffHunk": "@@ -75,12 +75,14 @@\n       TextDocumentService textService,\n       WorkspaceService workspaceService,\n       Provider<LanguageClient> clientProvider,\n-      SettingsProvider settingsProvider) {\n+      SettingsProvider settingsProvider,\n+      MyTextDocumentService customTextService) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MTQ1ODU1Nw=="}, "originalCommit": {"oid": "6767b2105287fc95c12c465aa3b67e175b527e41"}, "originalPosition": 15}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MTQ4NDY1Nw==", "bodyText": "I tested on my che with devfile based with this lsp and I haven't seen the dep file deleted at didOpen\nMoreover when I try to change the copybook name, the dep file still maintain the old value.\n\nI experienced the same issue because CHE doesn't close the file immediately and moreover we got a problem on VSCode with Zowe: \"if your file is open by Zowe explorer and you close it and open it again you will see the same problem because I think that the IDE does not close the file immediately\"", "url": "https://github.com/eclipse/che-che4z-lsp-for-cobol/pull/249#discussion_r391484657", "createdAt": "2020-03-12T09:11:09Z", "author": {"login": "sergiuilie"}, "path": "com.ca.lsp.cobol/lsp-service-cobol/src/main/java/com/ca/lsp/cobol/service/MyLanguageServerImpl.java", "diffHunk": "@@ -75,12 +75,14 @@\n       TextDocumentService textService,\n       WorkspaceService workspaceService,\n       Provider<LanguageClient> clientProvider,\n-      SettingsProvider settingsProvider) {\n+      SettingsProvider settingsProvider,\n+      MyTextDocumentService customTextService) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MTQ1ODU1Nw=="}, "originalCommit": {"oid": "6767b2105287fc95c12c465aa3b67e175b527e41"}, "originalPosition": 15}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjQyNjA3NjIzOnYy", "diffSide": "RIGHT", "path": "com.ca.lsp.cobol/lsp-service-cobol/src/main/java/com/ca/lsp/cobol/service/MyTextDocumentService.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xMlQwODoxNzo0OFrOF1UxRQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xMlQwODoxNzo0OFrOF1UxRQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MTQ1OTE0MQ==", "bodyText": "Can we move this method into the FileSystemUtils ?", "url": "https://github.com/eclipse/che-che4z-lsp-for-cobol/pull/249#discussion_r391459141", "createdAt": "2020-03-12T08:17:48Z", "author": {"login": "zacanbrcom"}, "path": "com.ca.lsp.cobol/lsp-service-cobol/src/main/java/com/ca/lsp/cobol/service/MyTextDocumentService.java", "diffHunk": "@@ -213,6 +223,28 @@ private void registerEngineAndAnalyze(String uri, String languageType, String te\n     }\n   }\n \n+  /**\n+   * This method\n+   * @param uri\n+   */\n+  private void deleteDependencyFile(String uri) {\n+    Path folderPath = null;\n+    if (checkIfInitWasCalled()) {\n+      folderPath =\n+          Paths.get(\n+              getDependencyFileFolderPath()\n+                  + FileSystems.getDefault().getSeparator()\n+                  + getFileNameFromURI(uri)\n+                  + DEP_EXTENSION);\n+    }\n+    if (isFileExists(folderPath))\n+      try {\n+        Files.delete(folderPath);\n+      } catch (IOException e) {\n+        log.error(e.getMessage());\n+      }\n+  }\n+", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "6767b2105287fc95c12c465aa3b67e175b527e41"}, "originalPosition": 82}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjQyNjA4MTIwOnYy", "diffSide": "RIGHT", "path": "com.ca.lsp.cobol/lsp-service-cobol/src/main/java/com/ca/lsp/cobol/service/MyTextDocumentService.java", "isResolved": true, "comments": {"totalCount": 7, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xMlQwODoxOTo1OFrOF1U0dA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xMlQwOToxMTozMlrOF1WV0Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MTQ1OTk1Ng==", "bodyText": "It is definitely not the responsibility of this class. I think that TextDocumentService should just fire an event to make CopybookService to remove the dep file", "url": "https://github.com/eclipse/che-che4z-lsp-for-cobol/pull/249#discussion_r391459956", "createdAt": "2020-03-12T08:19:58Z", "author": {"login": "temanbrcom"}, "path": "com.ca.lsp.cobol/lsp-service-cobol/src/main/java/com/ca/lsp/cobol/service/MyTextDocumentService.java", "diffHunk": "@@ -213,6 +223,28 @@ private void registerEngineAndAnalyze(String uri, String languageType, String te\n     }\n   }\n \n+  /**\n+   * This method\n+   * @param uri\n+   */\n+  private void deleteDependencyFile(String uri) {\n+    Path folderPath = null;\n+    if (checkIfInitWasCalled()) {\n+      folderPath =\n+          Paths.get(\n+              getDependencyFileFolderPath()\n+                  + FileSystems.getDefault().getSeparator()\n+                  + getFileNameFromURI(uri)\n+                  + DEP_EXTENSION);\n+    }\n+    if (isFileExists(folderPath))\n+      try {\n+        Files.delete(folderPath);\n+      } catch (IOException e) {\n+        log.error(e.getMessage());\n+      }\n+  }\n+", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "6767b2105287fc95c12c465aa3b67e175b527e41"}, "originalPosition": 82}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MTQ2MzM2Ng==", "bodyText": "Wait, CopybookService lose this responsability, there is a CopybookDependencyService that is responsible to everything is related to the dep file. Why we need to propagate this event on the databus?", "url": "https://github.com/eclipse/che-che4z-lsp-for-cobol/pull/249#discussion_r391463366", "createdAt": "2020-03-12T08:27:30Z", "author": {"login": "zacanbrcom"}, "path": "com.ca.lsp.cobol/lsp-service-cobol/src/main/java/com/ca/lsp/cobol/service/MyTextDocumentService.java", "diffHunk": "@@ -213,6 +223,28 @@ private void registerEngineAndAnalyze(String uri, String languageType, String te\n     }\n   }\n \n+  /**\n+   * This method\n+   * @param uri\n+   */\n+  private void deleteDependencyFile(String uri) {\n+    Path folderPath = null;\n+    if (checkIfInitWasCalled()) {\n+      folderPath =\n+          Paths.get(\n+              getDependencyFileFolderPath()\n+                  + FileSystems.getDefault().getSeparator()\n+                  + getFileNameFromURI(uri)\n+                  + DEP_EXTENSION);\n+    }\n+    if (isFileExists(folderPath))\n+      try {\n+        Files.delete(folderPath);\n+      } catch (IOException e) {\n+        log.error(e.getMessage());\n+      }\n+  }\n+", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MTQ1OTk1Ng=="}, "originalCommit": {"oid": "6767b2105287fc95c12c465aa3b67e175b527e41"}, "originalPosition": 82}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MTQ2NjM4OQ==", "bodyText": "Yes, it should be on CopybookDependencyService.\nThe databus event is needed to remove a direct dependency between the TextDocumentService and the dependency service.", "url": "https://github.com/eclipse/che-che4z-lsp-for-cobol/pull/249#discussion_r391466389", "createdAt": "2020-03-12T08:34:01Z", "author": {"login": "temanbrcom"}, "path": "com.ca.lsp.cobol/lsp-service-cobol/src/main/java/com/ca/lsp/cobol/service/MyTextDocumentService.java", "diffHunk": "@@ -213,6 +223,28 @@ private void registerEngineAndAnalyze(String uri, String languageType, String te\n     }\n   }\n \n+  /**\n+   * This method\n+   * @param uri\n+   */\n+  private void deleteDependencyFile(String uri) {\n+    Path folderPath = null;\n+    if (checkIfInitWasCalled()) {\n+      folderPath =\n+          Paths.get(\n+              getDependencyFileFolderPath()\n+                  + FileSystems.getDefault().getSeparator()\n+                  + getFileNameFromURI(uri)\n+                  + DEP_EXTENSION);\n+    }\n+    if (isFileExists(folderPath))\n+      try {\n+        Files.delete(folderPath);\n+      } catch (IOException e) {\n+        log.error(e.getMessage());\n+      }\n+  }\n+", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MTQ1OTk1Ng=="}, "originalCommit": {"oid": "6767b2105287fc95c12c465aa3b67e175b527e41"}, "originalPosition": 82}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MTQ3OTcyNw==", "bodyText": "There is no direct dependency between those two services, @temanbrcom , how do you see the dependency?", "url": "https://github.com/eclipse/che-che4z-lsp-for-cobol/pull/249#discussion_r391479727", "createdAt": "2020-03-12T09:01:29Z", "author": {"login": "sergiuilie"}, "path": "com.ca.lsp.cobol/lsp-service-cobol/src/main/java/com/ca/lsp/cobol/service/MyTextDocumentService.java", "diffHunk": "@@ -213,6 +223,28 @@ private void registerEngineAndAnalyze(String uri, String languageType, String te\n     }\n   }\n \n+  /**\n+   * This method\n+   * @param uri\n+   */\n+  private void deleteDependencyFile(String uri) {\n+    Path folderPath = null;\n+    if (checkIfInitWasCalled()) {\n+      folderPath =\n+          Paths.get(\n+              getDependencyFileFolderPath()\n+                  + FileSystems.getDefault().getSeparator()\n+                  + getFileNameFromURI(uri)\n+                  + DEP_EXTENSION);\n+    }\n+    if (isFileExists(folderPath))\n+      try {\n+        Files.delete(folderPath);\n+      } catch (IOException e) {\n+        log.error(e.getMessage());\n+      }\n+  }\n+", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MTQ1OTk1Ng=="}, "originalCommit": {"oid": "6767b2105287fc95c12c465aa3b67e175b527e41"}, "originalPosition": 82}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MTQ4MTI2OQ==", "bodyText": "There is no dependency because now TextDocumentService is applying file operations, but it shouldn't. It should just notify the CopybookDependencyService to delete dep files", "url": "https://github.com/eclipse/che-che4z-lsp-for-cobol/pull/249#discussion_r391481269", "createdAt": "2020-03-12T09:04:37Z", "author": {"login": "temanbrcom"}, "path": "com.ca.lsp.cobol/lsp-service-cobol/src/main/java/com/ca/lsp/cobol/service/MyTextDocumentService.java", "diffHunk": "@@ -213,6 +223,28 @@ private void registerEngineAndAnalyze(String uri, String languageType, String te\n     }\n   }\n \n+  /**\n+   * This method\n+   * @param uri\n+   */\n+  private void deleteDependencyFile(String uri) {\n+    Path folderPath = null;\n+    if (checkIfInitWasCalled()) {\n+      folderPath =\n+          Paths.get(\n+              getDependencyFileFolderPath()\n+                  + FileSystems.getDefault().getSeparator()\n+                  + getFileNameFromURI(uri)\n+                  + DEP_EXTENSION);\n+    }\n+    if (isFileExists(folderPath))\n+      try {\n+        Files.delete(folderPath);\n+      } catch (IOException e) {\n+        log.error(e.getMessage());\n+      }\n+  }\n+", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MTQ1OTk1Ng=="}, "originalCommit": {"oid": "6767b2105287fc95c12c465aa3b67e175b527e41"}, "originalPosition": 82}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MTQ4MzEzNw==", "bodyText": "So, there is no dependency, I will take a look and see how I can notify the CopybookDependencyService", "url": "https://github.com/eclipse/che-che4z-lsp-for-cobol/pull/249#discussion_r391483137", "createdAt": "2020-03-12T09:08:18Z", "author": {"login": "sergiuilie"}, "path": "com.ca.lsp.cobol/lsp-service-cobol/src/main/java/com/ca/lsp/cobol/service/MyTextDocumentService.java", "diffHunk": "@@ -213,6 +223,28 @@ private void registerEngineAndAnalyze(String uri, String languageType, String te\n     }\n   }\n \n+  /**\n+   * This method\n+   * @param uri\n+   */\n+  private void deleteDependencyFile(String uri) {\n+    Path folderPath = null;\n+    if (checkIfInitWasCalled()) {\n+      folderPath =\n+          Paths.get(\n+              getDependencyFileFolderPath()\n+                  + FileSystems.getDefault().getSeparator()\n+                  + getFileNameFromURI(uri)\n+                  + DEP_EXTENSION);\n+    }\n+    if (isFileExists(folderPath))\n+      try {\n+        Files.delete(folderPath);\n+      } catch (IOException e) {\n+        log.error(e.getMessage());\n+      }\n+  }\n+", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MTQ1OTk1Ng=="}, "originalCommit": {"oid": "6767b2105287fc95c12c465aa3b67e175b527e41"}, "originalPosition": 82}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MTQ4NDg4MQ==", "bodyText": "To be clear - saying \"remove\" I meant \"avoid\"", "url": "https://github.com/eclipse/che-che4z-lsp-for-cobol/pull/249#discussion_r391484881", "createdAt": "2020-03-12T09:11:32Z", "author": {"login": "temanbrcom"}, "path": "com.ca.lsp.cobol/lsp-service-cobol/src/main/java/com/ca/lsp/cobol/service/MyTextDocumentService.java", "diffHunk": "@@ -213,6 +223,28 @@ private void registerEngineAndAnalyze(String uri, String languageType, String te\n     }\n   }\n \n+  /**\n+   * This method\n+   * @param uri\n+   */\n+  private void deleteDependencyFile(String uri) {\n+    Path folderPath = null;\n+    if (checkIfInitWasCalled()) {\n+      folderPath =\n+          Paths.get(\n+              getDependencyFileFolderPath()\n+                  + FileSystems.getDefault().getSeparator()\n+                  + getFileNameFromURI(uri)\n+                  + DEP_EXTENSION);\n+    }\n+    if (isFileExists(folderPath))\n+      try {\n+        Files.delete(folderPath);\n+      } catch (IOException e) {\n+        log.error(e.getMessage());\n+      }\n+  }\n+", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MTQ1OTk1Ng=="}, "originalCommit": {"oid": "6767b2105287fc95c12c465aa3b67e175b527e41"}, "originalPosition": 82}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjQyNjA4NDM5OnYy", "diffSide": "RIGHT", "path": "com.ca.lsp.cobol/lsp-service-cobol/src/main/java/com/ca/lsp/cobol/service/MyTextDocumentService.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xMlQwODoyMToxOFrOF1U2hg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xMlQxMDowOToyMlrOF1YTEg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MTQ2MDQ4Ng==", "bodyText": "I think we can extend the CopybookDependencyService APIs and move this implementation there, if I didn't miss anything \ud83d\udc7c", "url": "https://github.com/eclipse/che-che4z-lsp-for-cobol/pull/249#discussion_r391460486", "createdAt": "2020-03-12T08:21:18Z", "author": {"login": "zacanbrcom"}, "path": "com.ca.lsp.cobol/lsp-service-cobol/src/main/java/com/ca/lsp/cobol/service/MyTextDocumentService.java", "diffHunk": "@@ -262,4 +294,16 @@ private String createDescriptiveErrorMessage(String action, String uri) {\n   private BiConsumer<Object, Throwable> reportExceptionIfThrown(String message) {\n     return (res, ex) -> ofNullable(ex).ifPresent(it -> log.error(message, it));\n   }\n+\n+  private Path getDependencyFileFolderPath() {\n+    return Paths.get(\n+        getWorkspaceFoldersAsPathList(getWorkspaceFolders()).get(0)\n+            + filesystemSeparator()\n+            + COBDEPS\n+            + filesystemSeparator());\n+  }", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "6767b2105287fc95c12c465aa3b67e175b527e41"}, "originalPosition": 97}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MTUxNjk0Ng==", "bodyText": "it can be done", "url": "https://github.com/eclipse/che-che4z-lsp-for-cobol/pull/249#discussion_r391516946", "createdAt": "2020-03-12T10:09:22Z", "author": {"login": "sergiuilie"}, "path": "com.ca.lsp.cobol/lsp-service-cobol/src/main/java/com/ca/lsp/cobol/service/MyTextDocumentService.java", "diffHunk": "@@ -262,4 +294,16 @@ private String createDescriptiveErrorMessage(String action, String uri) {\n   private BiConsumer<Object, Throwable> reportExceptionIfThrown(String message) {\n     return (res, ex) -> ofNullable(ex).ifPresent(it -> log.error(message, it));\n   }\n+\n+  private Path getDependencyFileFolderPath() {\n+    return Paths.get(\n+        getWorkspaceFoldersAsPathList(getWorkspaceFolders()).get(0)\n+            + filesystemSeparator()\n+            + COBDEPS\n+            + filesystemSeparator());\n+  }", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MTQ2MDQ4Ng=="}, "originalCommit": {"oid": "6767b2105287fc95c12c465aa3b67e175b527e41"}, "originalPosition": 97}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjQyNjA4ODExOnYy", "diffSide": "RIGHT", "path": "com.ca.lsp.cobol/lsp-service-cobol/src/main/java/com/ca/lsp/cobol/service/CopybookServiceImpl.java", "isResolved": true, "comments": {"totalCount": 5, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xMlQwODoyMjo0MFrOF1U42w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yNlQxMzoyNDoxNFrOF8GqFw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MTQ2MTA4Mw==", "bodyText": "I've experienced that calling the JsonObject#toString this way will return a string with doubled quotes - \"\"string\"\"", "url": "https://github.com/eclipse/che-che4z-lsp-for-cobol/pull/249#discussion_r391461083", "createdAt": "2020-03-12T08:22:40Z", "author": {"login": "temanbrcom"}, "path": "com.ca.lsp.cobol/lsp-service-cobol/src/main/java/com/ca/lsp/cobol/service/CopybookServiceImpl.java", "diffHunk": "@@ -236,7 +236,7 @@ public void observerCallback(RequiredCopybookEvent event) {\n     path =\n         findCopybook(\n             requiredCopybookName,\n-            (String) configurationSettingsStorable.getProfiles(),\n+            configurationSettingsStorable.getProfiles().toString(),", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "6767b2105287fc95c12c465aa3b67e175b527e41"}, "originalPosition": 5}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MTQ4MDE1NQ==", "bodyText": "I haven't seen any unit test that verify this functionality, we have to do that.\n\ntaking care of", "url": "https://github.com/eclipse/che-che4z-lsp-for-cobol/pull/249#discussion_r391480155", "createdAt": "2020-03-12T09:02:26Z", "author": {"login": "sergiuilie"}, "path": "com.ca.lsp.cobol/lsp-service-cobol/src/main/java/com/ca/lsp/cobol/service/CopybookServiceImpl.java", "diffHunk": "@@ -236,7 +236,7 @@ public void observerCallback(RequiredCopybookEvent event) {\n     path =\n         findCopybook(\n             requiredCopybookName,\n-            (String) configurationSettingsStorable.getProfiles(),\n+            configurationSettingsStorable.getProfiles().toString(),", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MTQ2MTA4Mw=="}, "originalCommit": {"oid": "6767b2105287fc95c12c465aa3b67e175b527e41"}, "originalPosition": 5}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5ODQ0NTIxNw==", "bodyText": "Is still pending this modification?", "url": "https://github.com/eclipse/che-che4z-lsp-for-cobol/pull/249#discussion_r398445217", "createdAt": "2020-03-26T09:56:33Z", "author": {"login": "zacanbrcom"}, "path": "com.ca.lsp.cobol/lsp-service-cobol/src/main/java/com/ca/lsp/cobol/service/CopybookServiceImpl.java", "diffHunk": "@@ -236,7 +236,7 @@ public void observerCallback(RequiredCopybookEvent event) {\n     path =\n         findCopybook(\n             requiredCopybookName,\n-            (String) configurationSettingsStorable.getProfiles(),\n+            configurationSettingsStorable.getProfiles().toString(),", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MTQ2MTA4Mw=="}, "originalCommit": {"oid": "6767b2105287fc95c12c465aa3b67e175b527e41"}, "originalPosition": 5}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5ODQ1NjQ5MQ==", "bodyText": "modify it, I forgot about it, thanks", "url": "https://github.com/eclipse/che-che4z-lsp-for-cobol/pull/249#discussion_r398456491", "createdAt": "2020-03-26T10:14:22Z", "author": {"login": "sergiuilie"}, "path": "com.ca.lsp.cobol/lsp-service-cobol/src/main/java/com/ca/lsp/cobol/service/CopybookServiceImpl.java", "diffHunk": "@@ -236,7 +236,7 @@ public void observerCallback(RequiredCopybookEvent event) {\n     path =\n         findCopybook(\n             requiredCopybookName,\n-            (String) configurationSettingsStorable.getProfiles(),\n+            configurationSettingsStorable.getProfiles().toString(),", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MTQ2MTA4Mw=="}, "originalCommit": {"oid": "6767b2105287fc95c12c465aa3b67e175b527e41"}, "originalPosition": 5}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5ODU2Nzk1OQ==", "bodyText": "I read about this and toString should be enough because we already have a Java Object and the JSON is parsed in the first instance", "url": "https://github.com/eclipse/che-che4z-lsp-for-cobol/pull/249#discussion_r398567959", "createdAt": "2020-03-26T13:24:14Z", "author": {"login": "sergiuilie"}, "path": "com.ca.lsp.cobol/lsp-service-cobol/src/main/java/com/ca/lsp/cobol/service/CopybookServiceImpl.java", "diffHunk": "@@ -236,7 +236,7 @@ public void observerCallback(RequiredCopybookEvent event) {\n     path =\n         findCopybook(\n             requiredCopybookName,\n-            (String) configurationSettingsStorable.getProfiles(),\n+            configurationSettingsStorable.getProfiles().toString(),", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MTQ2MTA4Mw=="}, "originalCommit": {"oid": "6767b2105287fc95c12c465aa3b67e175b527e41"}, "originalPosition": 5}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjQ3MDEzNDgyOnYy", "diffSide": "RIGHT", "path": "com.ca.lsp.cobol/lsp-service-cobol/src/main/java/com/ca/lsp/cobol/service/delegates/dependency/CopybookDependencyServiceImpl.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yNlQwOTo1ODo1NVrOF7_Q4w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yNlQxMDoxNTowMFrOF7_4LQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5ODQ0NjgxOQ==", "bodyText": "can we remove this?", "url": "https://github.com/eclipse/che-che4z-lsp-for-cobol/pull/249#discussion_r398446819", "createdAt": "2020-03-26T09:58:55Z", "author": {"login": "zacanbrcom"}, "path": "com.ca.lsp.cobol/lsp-service-cobol/src/main/java/com/ca/lsp/cobol/service/delegates/dependency/CopybookDependencyServiceImpl.java", "diffHunk": "@@ -125,18 +144,45 @@ public void generateDependencyFile(String cobolFileName) {\n     }\n   }\n \n-  private Path retrieveDependencyFile(Path dependencyFolderPath, String cobolFileName) {\n-    return Paths.get(dependencyFolderPath + filesystemSeparator() + cobolFileName + DEP_EXTENSION);\n-  }\n+  @Override\n+  public void observerCallback(CopybookDepEvent event) {\n+    if (!event.getTextDocumentSync().equals(\"DID_OPEN\")) {\n \n-  private String getCobolFileNameFromUri(String documentUri) {\n-    String result = null;\n-    try {\n-      result = FilenameUtils.getBaseName(Paths.get(new URI(documentUri)).getFileName().toString());\n-    } catch (URISyntaxException e) {\n-      log.error(e.getMessage());\n+      Path path =\n+          findCopybook(\n+              event.getCopybookName(),\n+              configurationSettingsStorableProvider.get().getProfiles().toString(),\n+              configurationSettingsStorableProvider.get().getPaths());\n+\n+      Path folderPath =\n+          Paths.get(\n+              getWorkspaceFolderPaths().get(0)\n+                  + filesystemSeparator()\n+                  + COBDEPS\n+                  + filesystemSeparator());\n+\n+      // change with document name, stupid blin", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "e70d5e09e5e3db2d03dcd1eb58287bc639246d8a"}, "originalPosition": 94}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5ODQ1Njg3Nw==", "bodyText": "of course", "url": "https://github.com/eclipse/che-che4z-lsp-for-cobol/pull/249#discussion_r398456877", "createdAt": "2020-03-26T10:15:00Z", "author": {"login": "sergiuilie"}, "path": "com.ca.lsp.cobol/lsp-service-cobol/src/main/java/com/ca/lsp/cobol/service/delegates/dependency/CopybookDependencyServiceImpl.java", "diffHunk": "@@ -125,18 +144,45 @@ public void generateDependencyFile(String cobolFileName) {\n     }\n   }\n \n-  private Path retrieveDependencyFile(Path dependencyFolderPath, String cobolFileName) {\n-    return Paths.get(dependencyFolderPath + filesystemSeparator() + cobolFileName + DEP_EXTENSION);\n-  }\n+  @Override\n+  public void observerCallback(CopybookDepEvent event) {\n+    if (!event.getTextDocumentSync().equals(\"DID_OPEN\")) {\n \n-  private String getCobolFileNameFromUri(String documentUri) {\n-    String result = null;\n-    try {\n-      result = FilenameUtils.getBaseName(Paths.get(new URI(documentUri)).getFileName().toString());\n-    } catch (URISyntaxException e) {\n-      log.error(e.getMessage());\n+      Path path =\n+          findCopybook(\n+              event.getCopybookName(),\n+              configurationSettingsStorableProvider.get().getProfiles().toString(),\n+              configurationSettingsStorableProvider.get().getPaths());\n+\n+      Path folderPath =\n+          Paths.get(\n+              getWorkspaceFolderPaths().get(0)\n+                  + filesystemSeparator()\n+                  + COBDEPS\n+                  + filesystemSeparator());\n+\n+      // change with document name, stupid blin", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5ODQ0NjgxOQ=="}, "originalCommit": {"oid": "e70d5e09e5e3db2d03dcd1eb58287bc639246d8a"}, "originalPosition": 94}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjQ3MDEzNjYyOnYy", "diffSide": "RIGHT", "path": "com.ca.lsp.cobol/lsp-service-cobol/src/main/java/com/ca/lsp/cobol/service/delegates/dependency/CopybookDependencyServiceImpl.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yNlQwOTo1OToyM1rOF7_SAw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yNlQxMDoxNToxNlrOF7_41g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5ODQ0NzEwNw==", "bodyText": "can we remove this?", "url": "https://github.com/eclipse/che-che4z-lsp-for-cobol/pull/249#discussion_r398447107", "createdAt": "2020-03-26T09:59:23Z", "author": {"login": "zacanbrcom"}, "path": "com.ca.lsp.cobol/lsp-service-cobol/src/main/java/com/ca/lsp/cobol/service/delegates/dependency/CopybookDependencyServiceImpl.java", "diffHunk": "@@ -160,4 +206,60 @@ private Path createDependencyFileFolder() {\n       return folderPath;\n     }\n   }\n+\n+  /** come on */", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "e70d5e09e5e3db2d03dcd1eb58287bc639246d8a"}, "originalPosition": 125}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5ODQ1NzA0Ng==", "bodyText": "of course, I replaced it with docs", "url": "https://github.com/eclipse/che-che4z-lsp-for-cobol/pull/249#discussion_r398457046", "createdAt": "2020-03-26T10:15:16Z", "author": {"login": "sergiuilie"}, "path": "com.ca.lsp.cobol/lsp-service-cobol/src/main/java/com/ca/lsp/cobol/service/delegates/dependency/CopybookDependencyServiceImpl.java", "diffHunk": "@@ -160,4 +206,60 @@ private Path createDependencyFileFolder() {\n       return folderPath;\n     }\n   }\n+\n+  /** come on */", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5ODQ0NzEwNw=="}, "originalCommit": {"oid": "e70d5e09e5e3db2d03dcd1eb58287bc639246d8a"}, "originalPosition": 125}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjQ3MDU4NTM1OnYy", "diffSide": "RIGHT", "path": "clients/cobol-lsp-vscode-extension/src/CopybooksDownloader.ts", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yNlQxMjowMjowMVrOF8DoQA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yNlQxMzowMjowNVrOF8FxGQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5ODUxODMzNg==", "bodyText": "why this file is changed?", "url": "https://github.com/eclipse/che-che4z-lsp-for-cobol/pull/249#discussion_r398518336", "createdAt": "2020-03-26T12:02:01Z", "author": {"login": "zacanbrcom"}, "path": "clients/cobol-lsp-vscode-extension/src/CopybooksDownloader.ts", "diffHunk": "@@ -66,7 +66,7 @@ export class CopybooksDownloader implements vscode.Disposable {\n             missingCopybooks.forEach(copybook => this.queue.push(copybook, profile));\n         } else if (missingCopybooks.length > 0) {\n             this.resolver.fixMissingDownloads(message, missingCopybooks, profile, {\n-                hasPaths: (await this.listPathDatasets()).length > 0,\n+                hasPaths: (await this.pathsService.listPathDatasets()).length > 0,", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "e70d5e09e5e3db2d03dcd1eb58287bc639246d8a"}, "originalPosition": 5}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5ODU1MzM2OQ==", "bodyText": "you changed 14 days ago, it was a bug \ud83d\ude06", "url": "https://github.com/eclipse/che-che4z-lsp-for-cobol/pull/249#discussion_r398553369", "createdAt": "2020-03-26T13:02:05Z", "author": {"login": "sergiuilie"}, "path": "clients/cobol-lsp-vscode-extension/src/CopybooksDownloader.ts", "diffHunk": "@@ -66,7 +66,7 @@ export class CopybooksDownloader implements vscode.Disposable {\n             missingCopybooks.forEach(copybook => this.queue.push(copybook, profile));\n         } else if (missingCopybooks.length > 0) {\n             this.resolver.fixMissingDownloads(message, missingCopybooks, profile, {\n-                hasPaths: (await this.listPathDatasets()).length > 0,\n+                hasPaths: (await this.pathsService.listPathDatasets()).length > 0,", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5ODUxODMzNg=="}, "originalCommit": {"oid": "e70d5e09e5e3db2d03dcd1eb58287bc639246d8a"}, "originalPosition": 5}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjQ3MDY3MTA4OnYy", "diffSide": "RIGHT", "path": "com.ca.lsp.cobol/lsp-service-cobol/src/main/java/com/ca/lsp/cobol/service/MyLanguageServerImpl.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yNlQxMjoyNzoyNFrOF8EeEQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yNlQxMzowMToyMlrOF8Fvig==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5ODUzMjExMw==", "bodyText": "copybookDependencyService is unused within the class", "url": "https://github.com/eclipse/che-che4z-lsp-for-cobol/pull/249#discussion_r398532113", "createdAt": "2020-03-26T12:27:24Z", "author": {"login": "zacanbrcom"}, "path": "com.ca.lsp.cobol/lsp-service-cobol/src/main/java/com/ca/lsp/cobol/service/MyLanguageServerImpl.java", "diffHunk": "@@ -66,21 +67,23 @@\n   private WorkspaceService workspaceService;\n   private CopybookService copybookService;\n   private Provider<LanguageClient> clientProvider;\n-\n   private SettingsProvider settingsProvider;\n+  private CopybookDependencyService copybookDependencyService;\n \n   @Inject\n   MyLanguageServerImpl(\n       CopybookService copybookService,\n       TextDocumentService textService,\n       WorkspaceService workspaceService,\n       Provider<LanguageClient> clientProvider,\n-      SettingsProvider settingsProvider) {\n+      SettingsProvider settingsProvider,\n+      CopybookDependencyService copybookDependencyService) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "e70d5e09e5e3db2d03dcd1eb58287bc639246d8a"}, "originalPosition": 24}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5ODU1Mjk3MA==", "bodyText": "by calling it here I initialized it in order to subscribe it to the databus", "url": "https://github.com/eclipse/che-che4z-lsp-for-cobol/pull/249#discussion_r398552970", "createdAt": "2020-03-26T13:01:22Z", "author": {"login": "sergiuilie"}, "path": "com.ca.lsp.cobol/lsp-service-cobol/src/main/java/com/ca/lsp/cobol/service/MyLanguageServerImpl.java", "diffHunk": "@@ -66,21 +67,23 @@\n   private WorkspaceService workspaceService;\n   private CopybookService copybookService;\n   private Provider<LanguageClient> clientProvider;\n-\n   private SettingsProvider settingsProvider;\n+  private CopybookDependencyService copybookDependencyService;\n \n   @Inject\n   MyLanguageServerImpl(\n       CopybookService copybookService,\n       TextDocumentService textService,\n       WorkspaceService workspaceService,\n       Provider<LanguageClient> clientProvider,\n-      SettingsProvider settingsProvider) {\n+      SettingsProvider settingsProvider,\n+      CopybookDependencyService copybookDependencyService) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5ODUzMjExMw=="}, "originalCommit": {"oid": "e70d5e09e5e3db2d03dcd1eb58287bc639246d8a"}, "originalPosition": 24}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjQ4MTQ4MzUxOnYy", "diffSide": "RIGHT", "path": "com.ca.lsp.cobol/lsp-service-cobol/src/main/java/com/ca/lsp/cobol/service/delegates/dependency/CopybookDependencyService.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0zMFQxMjozOTowN1rOF9ntPw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0zMFQxMjozOTowN1rOF9ntPw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMDE1ODAxNQ==", "bodyText": "The databus observation is an implementation detail, so it would be better to implement the EventObserver in the exact class", "url": "https://github.com/eclipse/che-che4z-lsp-for-cobol/pull/249#discussion_r400158015", "createdAt": "2020-03-30T12:39:07Z", "author": {"login": "temanbrcom"}, "path": "com.ca.lsp.cobol/lsp-service-cobol/src/main/java/com/ca/lsp/cobol/service/delegates/dependency/CopybookDependencyService.java", "diffHunk": "@@ -16,14 +16,17 @@\n \n package com.ca.lsp.cobol.service.delegates.dependency;\n \n+import com.broadcom.lsp.domain.cobol.event.api.EventObserver;\n+import com.broadcom.lsp.domain.cobol.event.model.CopybookDepEvent;\n+\n import java.nio.file.Path;\n import java.util.List;\n \n /**\n  * This interface defines the API to generate and update dependency file for copybook download\n  * management\n  */\n-public interface CopybookDependencyService {\n+public interface CopybookDependencyService extends EventObserver<CopybookDepEvent> {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "a89de1e7b9501a2225ff53388d8b8f8a975f9bbf"}, "originalPosition": 15}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjQ4MTUyMjI2OnYy", "diffSide": "RIGHT", "path": "com.ca.lsp.cobol/lsp-service-cobol/src/main/java/com/ca/lsp/cobol/service/delegates/dependency/CopybookDependencyServiceImpl.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0zMFQxMjo0OToxMFrOF9oEpw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0zMFQxNDoxNjozNFrOF9r6CA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMDE2NDAwNw==", "bodyText": "A negative check doesn't cover all the required cases here. I think it is better to compare the event's sync type with TextDocumentSyncType.DID_CHANGE.name()", "url": "https://github.com/eclipse/che-che4z-lsp-for-cobol/pull/249#discussion_r400164007", "createdAt": "2020-03-30T12:49:10Z", "author": {"login": "temanbrcom"}, "path": "com.ca.lsp.cobol/lsp-service-cobol/src/main/java/com/ca/lsp/cobol/service/delegates/dependency/CopybookDependencyServiceImpl.java", "diffHunk": "@@ -125,18 +145,66 @@ public void generateDependencyFile(String cobolFileName) {\n     }\n   }\n \n-  private Path retrieveDependencyFile(Path dependencyFolderPath, String cobolFileName) {\n-    return Paths.get(dependencyFolderPath + filesystemSeparator() + cobolFileName + DEP_EXTENSION);\n+  /**\n+   * This method is triggered when on databus the postData method is called and contains\n+   * CopybookDepEvent; This method implements the update logic for .dep file, by update we\n+   * understand that if the copybook is present in the .copybook folder than its name should be\n+   * remove from .dep file\n+   *\n+   * @param event of type CopybookDepEvent\n+   */\n+  @Synchronized\n+  @Override\n+  public void observerCallback(CopybookDepEvent event) {\n+    // we are not checking .dep on DID_OPEN because on DID_OPEN the file is updated with the\n+    // required copybooks\n+    if (!event.getTextDocumentSync().equals(\"DID_OPEN\")) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "a89de1e7b9501a2225ff53388d8b8f8a975f9bbf"}, "originalPosition": 85}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMDIyNjgyNA==", "bodyText": "true", "url": "https://github.com/eclipse/che-che4z-lsp-for-cobol/pull/249#discussion_r400226824", "createdAt": "2020-03-30T14:16:34Z", "author": {"login": "sergiuilie"}, "path": "com.ca.lsp.cobol/lsp-service-cobol/src/main/java/com/ca/lsp/cobol/service/delegates/dependency/CopybookDependencyServiceImpl.java", "diffHunk": "@@ -125,18 +145,66 @@ public void generateDependencyFile(String cobolFileName) {\n     }\n   }\n \n-  private Path retrieveDependencyFile(Path dependencyFolderPath, String cobolFileName) {\n-    return Paths.get(dependencyFolderPath + filesystemSeparator() + cobolFileName + DEP_EXTENSION);\n+  /**\n+   * This method is triggered when on databus the postData method is called and contains\n+   * CopybookDepEvent; This method implements the update logic for .dep file, by update we\n+   * understand that if the copybook is present in the .copybook folder than its name should be\n+   * remove from .dep file\n+   *\n+   * @param event of type CopybookDepEvent\n+   */\n+  @Synchronized\n+  @Override\n+  public void observerCallback(CopybookDepEvent event) {\n+    // we are not checking .dep on DID_OPEN because on DID_OPEN the file is updated with the\n+    // required copybooks\n+    if (!event.getTextDocumentSync().equals(\"DID_OPEN\")) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMDE2NDAwNw=="}, "originalCommit": {"oid": "a89de1e7b9501a2225ff53388d8b8f8a975f9bbf"}, "originalPosition": 85}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjQ4MTgxOTkyOnYy", "diffSide": "RIGHT", "path": "com.ca.lsp.cobol/lsp-service-cobol/src/main/java/com/ca/lsp/cobol/service/delegates/dependency/CopybookDependencyServiceImpl.java", "isResolved": true, "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0zMFQxMzo1NTozNFrOF9q70Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0zMFQxNDoyNjo0NFrOF9sZJQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMDIxMDg5Nw==", "bodyText": "Shouldn't it be updatedLines.equals(result)?", "url": "https://github.com/eclipse/che-che4z-lsp-for-cobol/pull/249#discussion_r400210897", "createdAt": "2020-03-30T13:55:34Z", "author": {"login": "temanbrcom"}, "path": "com.ca.lsp.cobol/lsp-service-cobol/src/main/java/com/ca/lsp/cobol/service/delegates/dependency/CopybookDependencyServiceImpl.java", "diffHunk": "@@ -125,18 +145,66 @@ public void generateDependencyFile(String cobolFileName) {\n     }\n   }\n \n-  private Path retrieveDependencyFile(Path dependencyFolderPath, String cobolFileName) {\n-    return Paths.get(dependencyFolderPath + filesystemSeparator() + cobolFileName + DEP_EXTENSION);\n+  /**\n+   * This method is triggered when on databus the postData method is called and contains\n+   * CopybookDepEvent; This method implements the update logic for .dep file, by update we\n+   * understand that if the copybook is present in the .copybook folder than its name should be\n+   * remove from .dep file\n+   *\n+   * @param event of type CopybookDepEvent\n+   */\n+  @Synchronized\n+  @Override\n+  public void observerCallback(CopybookDepEvent event) {\n+    // we are not checking .dep on DID_OPEN because on DID_OPEN the file is updated with the\n+    // required copybooks\n+    if (!event.getTextDocumentSync().equals(\"DID_OPEN\")) {\n+\n+      Path path =\n+          findCopybook(\n+              event.getCopybookName(),\n+              configurationSettingsStorableProvider.get().getProfiles().toString(),\n+              configurationSettingsStorableProvider.get().getPaths());\n+\n+      Path folderPath =\n+          Paths.get(\n+              getWorkspaceFolderPaths().get(0)\n+                  + filesystemSeparator()\n+                  + COBDEPS\n+                  + filesystemSeparator());\n+\n+      Path dependencyFilePath =\n+          retrieveDependencyFile(folderPath, getFileNameFromURI(event.getDocumentUri()));\n+\n+      if (path != null && isFileExists(dependencyFilePath)) {\n+        removeCpyFromDep(dependencyFilePath, event.getCopybookName());\n+      }\n+    }\n   }\n \n-  private String getCobolFileNameFromUri(String documentUri) {\n-    String result = null;\n+  /**\n+   * This method removes a given string from a given file\n+   *\n+   * @param dependencyFilePath - the path to .dep file\n+   * @param copybookName\n+   */\n+  private void removeCpyFromDep(Path dependencyFilePath, String copybookName) {\n+    List<String> result = null;\n     try {\n-      result = FilenameUtils.getBaseName(Paths.get(new URI(documentUri)).getFileName().toString());\n-    } catch (URISyntaxException e) {\n+      result = Files.readAllLines(dependencyFilePath);\n+      List<String> updatedLines =\n+          result.stream().filter(s -> !s.equals(copybookName)).collect(Collectors.toList());\n+      // don't write if the lines were not modify\n+      if (updatedLines != result) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "a89de1e7b9501a2225ff53388d8b8f8a975f9bbf"}, "originalPosition": 126}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMDIyNzQ0NA==", "bodyText": "no, if it equals than why to modify it?!", "url": "https://github.com/eclipse/che-che4z-lsp-for-cobol/pull/249#discussion_r400227444", "createdAt": "2020-03-30T14:17:19Z", "author": {"login": "sergiuilie"}, "path": "com.ca.lsp.cobol/lsp-service-cobol/src/main/java/com/ca/lsp/cobol/service/delegates/dependency/CopybookDependencyServiceImpl.java", "diffHunk": "@@ -125,18 +145,66 @@ public void generateDependencyFile(String cobolFileName) {\n     }\n   }\n \n-  private Path retrieveDependencyFile(Path dependencyFolderPath, String cobolFileName) {\n-    return Paths.get(dependencyFolderPath + filesystemSeparator() + cobolFileName + DEP_EXTENSION);\n+  /**\n+   * This method is triggered when on databus the postData method is called and contains\n+   * CopybookDepEvent; This method implements the update logic for .dep file, by update we\n+   * understand that if the copybook is present in the .copybook folder than its name should be\n+   * remove from .dep file\n+   *\n+   * @param event of type CopybookDepEvent\n+   */\n+  @Synchronized\n+  @Override\n+  public void observerCallback(CopybookDepEvent event) {\n+    // we are not checking .dep on DID_OPEN because on DID_OPEN the file is updated with the\n+    // required copybooks\n+    if (!event.getTextDocumentSync().equals(\"DID_OPEN\")) {\n+\n+      Path path =\n+          findCopybook(\n+              event.getCopybookName(),\n+              configurationSettingsStorableProvider.get().getProfiles().toString(),\n+              configurationSettingsStorableProvider.get().getPaths());\n+\n+      Path folderPath =\n+          Paths.get(\n+              getWorkspaceFolderPaths().get(0)\n+                  + filesystemSeparator()\n+                  + COBDEPS\n+                  + filesystemSeparator());\n+\n+      Path dependencyFilePath =\n+          retrieveDependencyFile(folderPath, getFileNameFromURI(event.getDocumentUri()));\n+\n+      if (path != null && isFileExists(dependencyFilePath)) {\n+        removeCpyFromDep(dependencyFilePath, event.getCopybookName());\n+      }\n+    }\n   }\n \n-  private String getCobolFileNameFromUri(String documentUri) {\n-    String result = null;\n+  /**\n+   * This method removes a given string from a given file\n+   *\n+   * @param dependencyFilePath - the path to .dep file\n+   * @param copybookName\n+   */\n+  private void removeCpyFromDep(Path dependencyFilePath, String copybookName) {\n+    List<String> result = null;\n     try {\n-      result = FilenameUtils.getBaseName(Paths.get(new URI(documentUri)).getFileName().toString());\n-    } catch (URISyntaxException e) {\n+      result = Files.readAllLines(dependencyFilePath);\n+      List<String> updatedLines =\n+          result.stream().filter(s -> !s.equals(copybookName)).collect(Collectors.toList());\n+      // don't write if the lines were not modify\n+      if (updatedLines != result) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMDIxMDg5Nw=="}, "originalCommit": {"oid": "a89de1e7b9501a2225ff53388d8b8f8a975f9bbf"}, "originalPosition": 126}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMDIzNDc4OQ==", "bodyText": "Yes, the correct line should be if (!updatedLines.equals(result)). The reason is that Collectors#toList() creates a new list every time, so the check on a link inequity will always return true", "url": "https://github.com/eclipse/che-che4z-lsp-for-cobol/pull/249#discussion_r400234789", "createdAt": "2020-03-30T14:26:44Z", "author": {"login": "temanbrcom"}, "path": "com.ca.lsp.cobol/lsp-service-cobol/src/main/java/com/ca/lsp/cobol/service/delegates/dependency/CopybookDependencyServiceImpl.java", "diffHunk": "@@ -125,18 +145,66 @@ public void generateDependencyFile(String cobolFileName) {\n     }\n   }\n \n-  private Path retrieveDependencyFile(Path dependencyFolderPath, String cobolFileName) {\n-    return Paths.get(dependencyFolderPath + filesystemSeparator() + cobolFileName + DEP_EXTENSION);\n+  /**\n+   * This method is triggered when on databus the postData method is called and contains\n+   * CopybookDepEvent; This method implements the update logic for .dep file, by update we\n+   * understand that if the copybook is present in the .copybook folder than its name should be\n+   * remove from .dep file\n+   *\n+   * @param event of type CopybookDepEvent\n+   */\n+  @Synchronized\n+  @Override\n+  public void observerCallback(CopybookDepEvent event) {\n+    // we are not checking .dep on DID_OPEN because on DID_OPEN the file is updated with the\n+    // required copybooks\n+    if (!event.getTextDocumentSync().equals(\"DID_OPEN\")) {\n+\n+      Path path =\n+          findCopybook(\n+              event.getCopybookName(),\n+              configurationSettingsStorableProvider.get().getProfiles().toString(),\n+              configurationSettingsStorableProvider.get().getPaths());\n+\n+      Path folderPath =\n+          Paths.get(\n+              getWorkspaceFolderPaths().get(0)\n+                  + filesystemSeparator()\n+                  + COBDEPS\n+                  + filesystemSeparator());\n+\n+      Path dependencyFilePath =\n+          retrieveDependencyFile(folderPath, getFileNameFromURI(event.getDocumentUri()));\n+\n+      if (path != null && isFileExists(dependencyFilePath)) {\n+        removeCpyFromDep(dependencyFilePath, event.getCopybookName());\n+      }\n+    }\n   }\n \n-  private String getCobolFileNameFromUri(String documentUri) {\n-    String result = null;\n+  /**\n+   * This method removes a given string from a given file\n+   *\n+   * @param dependencyFilePath - the path to .dep file\n+   * @param copybookName\n+   */\n+  private void removeCpyFromDep(Path dependencyFilePath, String copybookName) {\n+    List<String> result = null;\n     try {\n-      result = FilenameUtils.getBaseName(Paths.get(new URI(documentUri)).getFileName().toString());\n-    } catch (URISyntaxException e) {\n+      result = Files.readAllLines(dependencyFilePath);\n+      List<String> updatedLines =\n+          result.stream().filter(s -> !s.equals(copybookName)).collect(Collectors.toList());\n+      // don't write if the lines were not modify\n+      if (updatedLines != result) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMDIxMDg5Nw=="}, "originalCommit": {"oid": "a89de1e7b9501a2225ff53388d8b8f8a975f9bbf"}, "originalPosition": 126}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjQ4MTgzMDExOnYy", "diffSide": "RIGHT", "path": "com.ca.lsp.cobol/lsp-service-cobol/src/main/java/com/ca/lsp/cobol/service/delegates/dependency/CopybookDependencyServiceImpl.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0zMFQxMzo1NzozOVrOF9rCPg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0zMFQxMzo1NzozOVrOF9rCPg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMDIxMjU0Mg==", "bodyText": "You may inline this variable definition", "url": "https://github.com/eclipse/che-che4z-lsp-for-cobol/pull/249#discussion_r400212542", "createdAt": "2020-03-30T13:57:39Z", "author": {"login": "temanbrcom"}, "path": "com.ca.lsp.cobol/lsp-service-cobol/src/main/java/com/ca/lsp/cobol/service/delegates/dependency/CopybookDependencyServiceImpl.java", "diffHunk": "@@ -125,18 +145,66 @@ public void generateDependencyFile(String cobolFileName) {\n     }\n   }\n \n-  private Path retrieveDependencyFile(Path dependencyFolderPath, String cobolFileName) {\n-    return Paths.get(dependencyFolderPath + filesystemSeparator() + cobolFileName + DEP_EXTENSION);\n+  /**\n+   * This method is triggered when on databus the postData method is called and contains\n+   * CopybookDepEvent; This method implements the update logic for .dep file, by update we\n+   * understand that if the copybook is present in the .copybook folder than its name should be\n+   * remove from .dep file\n+   *\n+   * @param event of type CopybookDepEvent\n+   */\n+  @Synchronized\n+  @Override\n+  public void observerCallback(CopybookDepEvent event) {\n+    // we are not checking .dep on DID_OPEN because on DID_OPEN the file is updated with the\n+    // required copybooks\n+    if (!event.getTextDocumentSync().equals(\"DID_OPEN\")) {\n+\n+      Path path =\n+          findCopybook(\n+              event.getCopybookName(),\n+              configurationSettingsStorableProvider.get().getProfiles().toString(),\n+              configurationSettingsStorableProvider.get().getPaths());\n+\n+      Path folderPath =\n+          Paths.get(\n+              getWorkspaceFolderPaths().get(0)\n+                  + filesystemSeparator()\n+                  + COBDEPS\n+                  + filesystemSeparator());\n+\n+      Path dependencyFilePath =\n+          retrieveDependencyFile(folderPath, getFileNameFromURI(event.getDocumentUri()));\n+\n+      if (path != null && isFileExists(dependencyFilePath)) {\n+        removeCpyFromDep(dependencyFilePath, event.getCopybookName());\n+      }\n+    }\n   }\n \n-  private String getCobolFileNameFromUri(String documentUri) {\n-    String result = null;\n+  /**\n+   * This method removes a given string from a given file\n+   *\n+   * @param dependencyFilePath - the path to .dep file\n+   * @param copybookName\n+   */\n+  private void removeCpyFromDep(Path dependencyFilePath, String copybookName) {\n+    List<String> result = null;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "a89de1e7b9501a2225ff53388d8b8f8a975f9bbf"}, "originalPosition": 118}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjQ4MTg2OTgxOnYy", "diffSide": "RIGHT", "path": "com.ca.lsp.cobol/lsp-service-cobol/src/main/java/com/ca/lsp/cobol/service/delegates/dependency/CopybookDependencyServiceImpl.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0zMFQxNDowNjozNFrOF9rb8Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0zMFQxNDoxODo0NFrOF9sAzQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMDIxOTEyMQ==", "bodyText": "We'll receive a code smell because of the following code is a duplication of CopybookServiceImpl", "url": "https://github.com/eclipse/che-che4z-lsp-for-cobol/pull/249#discussion_r400219121", "createdAt": "2020-03-30T14:06:34Z", "author": {"login": "temanbrcom"}, "path": "com.ca.lsp.cobol/lsp-service-cobol/src/main/java/com/ca/lsp/cobol/service/delegates/dependency/CopybookDependencyServiceImpl.java", "diffHunk": "@@ -160,4 +228,71 @@ private Path createDependencyFileFolder() {\n       return folderPath;\n     }\n   }\n+\n+  /**\n+   * This method is used to search for a copybook against a given configuration of datasets that\n+   * represent the sub-path of the copyooks folder\n+   *\n+   * @param filename copybook name\n+   * @return The path of the existent copybook or null if not found\n+   */\n+  private Path findCopybook(String filename, String profile, List<String> datasetList) {\n+    return retrievePathOrNull(filename, generatePathListFromSettings(profile, datasetList));\n+  }\n+\n+  private Path retrievePathOrNull(String filename, List<Path> datasetPathList) {\n+    return datasetPathList.stream()\n+        .map(it -> applySearch(filename, it))\n+        .filter(Objects::nonNull)\n+        .findAny()\n+        .orElse(null);\n+  }\n+\n+  /**\n+   * @param fileName copybook name\n+   * @param targetFolderPath physical path of workspace where to search for the copybook\n+   * @return Path of the found copybook in the target folder.\n+   */\n+  private Path applySearch(String fileName, Path targetFolderPath) {\n+    try (Stream<Path> pathStream =", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "a89de1e7b9501a2225ff53388d8b8f8a975f9bbf"}, "originalPosition": 170}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMDIyODU1Nw==", "bodyText": "Andrea's implementation which will merge my branch will cover this, that's why I didn't modify it", "url": "https://github.com/eclipse/che-che4z-lsp-for-cobol/pull/249#discussion_r400228557", "createdAt": "2020-03-30T14:18:44Z", "author": {"login": "sergiuilie"}, "path": "com.ca.lsp.cobol/lsp-service-cobol/src/main/java/com/ca/lsp/cobol/service/delegates/dependency/CopybookDependencyServiceImpl.java", "diffHunk": "@@ -160,4 +228,71 @@ private Path createDependencyFileFolder() {\n       return folderPath;\n     }\n   }\n+\n+  /**\n+   * This method is used to search for a copybook against a given configuration of datasets that\n+   * represent the sub-path of the copyooks folder\n+   *\n+   * @param filename copybook name\n+   * @return The path of the existent copybook or null if not found\n+   */\n+  private Path findCopybook(String filename, String profile, List<String> datasetList) {\n+    return retrievePathOrNull(filename, generatePathListFromSettings(profile, datasetList));\n+  }\n+\n+  private Path retrievePathOrNull(String filename, List<Path> datasetPathList) {\n+    return datasetPathList.stream()\n+        .map(it -> applySearch(filename, it))\n+        .filter(Objects::nonNull)\n+        .findAny()\n+        .orElse(null);\n+  }\n+\n+  /**\n+   * @param fileName copybook name\n+   * @param targetFolderPath physical path of workspace where to search for the copybook\n+   * @return Path of the found copybook in the target folder.\n+   */\n+  private Path applySearch(String fileName, Path targetFolderPath) {\n+    try (Stream<Path> pathStream =", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMDIxOTEyMQ=="}, "originalCommit": {"oid": "a89de1e7b9501a2225ff53388d8b8f8a975f9bbf"}, "originalPosition": 170}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjQ4MTg5MDE1OnYy", "diffSide": "RIGHT", "path": "com.ca.lsp.cobol/lsp-service-cobol/src/test/java/com/ca/lsp/cobol/service/DependencyServiceTest.java", "isResolved": true, "comments": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0zMFQxNDoxMDo1OFrOF9ro9g==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0zMFQxNTowMjoxNFrOF9uG_A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMDIyMjQ1NA==", "bodyText": "It seems like we may call a CopybookDependencyServiceImpl#obaserverCallback() method directly, so we don't need a data bus broker and asynchronous awaiting.", "url": "https://github.com/eclipse/che-che4z-lsp-for-cobol/pull/249#discussion_r400222454", "createdAt": "2020-03-30T14:10:58Z", "author": {"login": "temanbrcom"}, "path": "com.ca.lsp.cobol/lsp-service-cobol/src/test/java/com/ca/lsp/cobol/service/DependencyServiceTest.java", "diffHunk": "@@ -44,13 +66,36 @@ public void initActivities() {\n     dependencyService.setWorkspaceFolderPaths(Collections.singletonList(workspaceFolder));\n   }\n \n+  /**\n+   * This test proves that the .dep file should update and remove the copybooks which were already\n+   * downloaded and present in the .copybook directory\n+   */\n+  @Test\n+  public void depFileUpdateTest() {\n+    // create the .dep file\n+    Path depFileReference = createDependencyFile(COPYBOOK_NAME);\n+    dependencyService.addCopybookInDepFile(CPY_OUTER_NAME_ONLY2, DOCUMENT_URI);\n+    int numberOfElements = getNumberOfElementsFromDepFile(depFileReference);\n+\n+    // trigger the event which will update the .dep file @link{CopybookDependencyServiceImpl.class}\n+    broker.postData(", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "a89de1e7b9501a2225ff53388d8b8f8a975f9bbf"}, "originalPosition": 66}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMDIzNTU3Ng==", "bodyText": "I agree if we have an \"integration test\" that use databus between DependencyService and CopybookService", "url": "https://github.com/eclipse/che-che4z-lsp-for-cobol/pull/249#discussion_r400235576", "createdAt": "2020-03-30T14:27:42Z", "author": {"login": "zacanbrcom"}, "path": "com.ca.lsp.cobol/lsp-service-cobol/src/test/java/com/ca/lsp/cobol/service/DependencyServiceTest.java", "diffHunk": "@@ -44,13 +66,36 @@ public void initActivities() {\n     dependencyService.setWorkspaceFolderPaths(Collections.singletonList(workspaceFolder));\n   }\n \n+  /**\n+   * This test proves that the .dep file should update and remove the copybooks which were already\n+   * downloaded and present in the .copybook directory\n+   */\n+  @Test\n+  public void depFileUpdateTest() {\n+    // create the .dep file\n+    Path depFileReference = createDependencyFile(COPYBOOK_NAME);\n+    dependencyService.addCopybookInDepFile(CPY_OUTER_NAME_ONLY2, DOCUMENT_URI);\n+    int numberOfElements = getNumberOfElementsFromDepFile(depFileReference);\n+\n+    // trigger the event which will update the .dep file @link{CopybookDependencyServiceImpl.class}\n+    broker.postData(", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMDIyMjQ1NA=="}, "originalCommit": {"oid": "a89de1e7b9501a2225ff53388d8b8f8a975f9bbf"}, "originalPosition": 66}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMDI1ODk2OQ==", "bodyText": "In fact, the integration that should be asserted in this class is only a subscription to the data bus in the constructor, because we may rely on more specific data bus tests.", "url": "https://github.com/eclipse/che-che4z-lsp-for-cobol/pull/249#discussion_r400258969", "createdAt": "2020-03-30T14:57:08Z", "author": {"login": "temanbrcom"}, "path": "com.ca.lsp.cobol/lsp-service-cobol/src/test/java/com/ca/lsp/cobol/service/DependencyServiceTest.java", "diffHunk": "@@ -44,13 +66,36 @@ public void initActivities() {\n     dependencyService.setWorkspaceFolderPaths(Collections.singletonList(workspaceFolder));\n   }\n \n+  /**\n+   * This test proves that the .dep file should update and remove the copybooks which were already\n+   * downloaded and present in the .copybook directory\n+   */\n+  @Test\n+  public void depFileUpdateTest() {\n+    // create the .dep file\n+    Path depFileReference = createDependencyFile(COPYBOOK_NAME);\n+    dependencyService.addCopybookInDepFile(CPY_OUTER_NAME_ONLY2, DOCUMENT_URI);\n+    int numberOfElements = getNumberOfElementsFromDepFile(depFileReference);\n+\n+    // trigger the event which will update the .dep file @link{CopybookDependencyServiceImpl.class}\n+    broker.postData(", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMDIyMjQ1NA=="}, "originalCommit": {"oid": "a89de1e7b9501a2225ff53388d8b8f8a975f9bbf"}, "originalPosition": 66}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMDI2MjkwOA==", "bodyText": "\ud83d\udc4d", "url": "https://github.com/eclipse/che-che4z-lsp-for-cobol/pull/249#discussion_r400262908", "createdAt": "2020-03-30T15:02:14Z", "author": {"login": "zacanbrcom"}, "path": "com.ca.lsp.cobol/lsp-service-cobol/src/test/java/com/ca/lsp/cobol/service/DependencyServiceTest.java", "diffHunk": "@@ -44,13 +66,36 @@ public void initActivities() {\n     dependencyService.setWorkspaceFolderPaths(Collections.singletonList(workspaceFolder));\n   }\n \n+  /**\n+   * This test proves that the .dep file should update and remove the copybooks which were already\n+   * downloaded and present in the .copybook directory\n+   */\n+  @Test\n+  public void depFileUpdateTest() {\n+    // create the .dep file\n+    Path depFileReference = createDependencyFile(COPYBOOK_NAME);\n+    dependencyService.addCopybookInDepFile(CPY_OUTER_NAME_ONLY2, DOCUMENT_URI);\n+    int numberOfElements = getNumberOfElementsFromDepFile(depFileReference);\n+\n+    // trigger the event which will update the .dep file @link{CopybookDependencyServiceImpl.class}\n+    broker.postData(", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMDIyMjQ1NA=="}, "originalCommit": {"oid": "a89de1e7b9501a2225ff53388d8b8f8a975f9bbf"}, "originalPosition": 66}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjQ4MjAyMjU1OnYy", "diffSide": "RIGHT", "path": "com.ca.lsp.cobol/lsp-service-cobol/src/main/java/com/ca/lsp/cobol/service/delegates/dependency/CopybookDependencyServiceImpl.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0zMFQxNDozODoxMlrOF9s8sg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0zMFQxNDozODoxMlrOF9s8sg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMDI0Mzg5MA==", "bodyText": "Paths.get cannot return null, so this check won't work. It is better to use Files::exists` here", "url": "https://github.com/eclipse/che-che4z-lsp-for-cobol/pull/249#discussion_r400243890", "createdAt": "2020-03-30T14:38:12Z", "author": {"login": "temanbrcom"}, "path": "com.ca.lsp.cobol/lsp-service-cobol/src/main/java/com/ca/lsp/cobol/service/delegates/dependency/CopybookDependencyServiceImpl.java", "diffHunk": "@@ -160,4 +228,71 @@ private Path createDependencyFileFolder() {\n       return folderPath;\n     }\n   }\n+\n+  /**\n+   * This method is used to search for a copybook against a given configuration of datasets that\n+   * represent the sub-path of the copyooks folder\n+   *\n+   * @param filename copybook name\n+   * @return The path of the existent copybook or null if not found\n+   */\n+  private Path findCopybook(String filename, String profile, List<String> datasetList) {\n+    return retrievePathOrNull(filename, generatePathListFromSettings(profile, datasetList));\n+  }\n+\n+  private Path retrievePathOrNull(String filename, List<Path> datasetPathList) {\n+    return datasetPathList.stream()\n+        .map(it -> applySearch(filename, it))\n+        .filter(Objects::nonNull)\n+        .findAny()\n+        .orElse(null);\n+  }\n+\n+  /**\n+   * @param fileName copybook name\n+   * @param targetFolderPath physical path of workspace where to search for the copybook\n+   * @return Path of the found copybook in the target folder.\n+   */\n+  private Path applySearch(String fileName, Path targetFolderPath) {\n+    try (Stream<Path> pathStream =\n+        Files.find(\n+            targetFolderPath,\n+            100,\n+            (path, basicFileAttributes) -> isValidFileFound(path.toFile(), fileName),\n+            FileVisitOption.FOLLOW_LINKS)) {\n+      return pathStream.findAny().orElse(null);\n+    } catch (IOException e) {\n+      log.error(e.getMessage());\n+      return null;\n+    }\n+  }\n+\n+  private List<Path> generatePathListFromSettings(String profile, List<String> datasetList) {\n+    // can happen here that copybooks or internal structure is null\n+    return datasetList.stream()\n+        .map(\n+            it ->\n+                Paths.get(\n+                    getCopybookFolder(workspaceFolderPaths.get(0))\n+                        + filesystemSeparator()\n+                        + profile\n+                        + filesystemSeparator()\n+                        + it))\n+        .filter(Objects::nonNull)", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "a89de1e7b9501a2225ff53388d8b8f8a975f9bbf"}, "originalPosition": 194}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4168, "cost": 1, "resetAt": "2021-11-12T18:49:56Z"}}}