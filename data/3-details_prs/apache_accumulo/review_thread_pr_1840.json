{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTQyMDU0NTg4", "number": 1840, "reviewThreads": {"totalCount": 5, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xN1QxOToyNjoxNVrOFG3m1A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xN1QyMDo0MzoyNVrOFG5dsA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzQyNzQ2ODM2OnYy", "diffSide": "RIGHT", "path": "server/tserver/src/main/java/org/apache/accumulo/tserver/scan/LookupTask.java", "isResolved": true, "comments": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xN1QxOToyNjoxNVrOIIFQxQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xN1QyMDo0NDozMlrOIIIE6g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NTM0NTczMw==", "bodyText": "Is there value in adding this to the result if we're re-throwing?", "url": "https://github.com/apache/accumulo/pull/1840#discussion_r545345733", "createdAt": "2020-12-17T19:26:15Z", "author": {"login": "ctubbsii"}, "path": "server/tserver/src/main/java/org/apache/accumulo/tserver/scan/LookupTask.java", "diffHunk": "@@ -177,9 +177,13 @@ public void run() {\n       }\n     } catch (SampleNotPresentException e) {\n       addResult(e);\n-    } catch (Throwable e) {\n+    } catch (Exception e) {\n       log.warn(\"exception while doing multi-scan \", e);\n       addResult(e);\n+    } catch (Error t) {\n+      log.warn(\"Error while doing multi-scan \", t);\n+      addResult(t);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "74303f2e7cebb0f00925a5e690f8d552393d743b"}, "originalPosition": 10}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NTM2MTQ4NA==", "bodyText": "I was following what the other catch clauses were doing here. I assume that the addResult() call is putting the exception on the result queue to be sent back to the client. It's possible that this error could make it's way back to the client before the tserver is halted.", "url": "https://github.com/apache/accumulo/pull/1840#discussion_r545361484", "createdAt": "2020-12-17T19:52:01Z", "author": {"login": "dlmarion"}, "path": "server/tserver/src/main/java/org/apache/accumulo/tserver/scan/LookupTask.java", "diffHunk": "@@ -177,9 +177,13 @@ public void run() {\n       }\n     } catch (SampleNotPresentException e) {\n       addResult(e);\n-    } catch (Throwable e) {\n+    } catch (Exception e) {\n       log.warn(\"exception while doing multi-scan \", e);\n       addResult(e);\n+    } catch (Error t) {\n+      log.warn(\"Error while doing multi-scan \", t);\n+      addResult(t);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NTM0NTczMw=="}, "originalCommit": {"oid": "74303f2e7cebb0f00925a5e690f8d552393d743b"}, "originalPosition": 10}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NTM4ODA4MA==", "bodyText": "If there's an actual Error, we probably shouldn't leak those details to the client. The client will get a TApplicationException when the server fails. It's probably not worth creating new work before the Error falls through and is ultimately handled. We probably also don't need the log message, either, because the code that will eventually handle the Error should provide a useful message/stack trace, and this would be redundant. It's probably better to just let it fall through and not even try to catch-handle-rethrow.", "url": "https://github.com/apache/accumulo/pull/1840#discussion_r545388080", "createdAt": "2020-12-17T20:37:32Z", "author": {"login": "ctubbsii"}, "path": "server/tserver/src/main/java/org/apache/accumulo/tserver/scan/LookupTask.java", "diffHunk": "@@ -177,9 +177,13 @@ public void run() {\n       }\n     } catch (SampleNotPresentException e) {\n       addResult(e);\n-    } catch (Throwable e) {\n+    } catch (Exception e) {\n       log.warn(\"exception while doing multi-scan \", e);\n       addResult(e);\n+    } catch (Error t) {\n+      log.warn(\"Error while doing multi-scan \", t);\n+      addResult(t);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NTM0NTczMw=="}, "originalCommit": {"oid": "74303f2e7cebb0f00925a5e690f8d552393d743b"}, "originalPosition": 10}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NTM5MTg1MA==", "bodyText": "I can remove this Error handling, I was just trying to follow the pattern.", "url": "https://github.com/apache/accumulo/pull/1840#discussion_r545391850", "createdAt": "2020-12-17T20:44:32Z", "author": {"login": "dlmarion"}, "path": "server/tserver/src/main/java/org/apache/accumulo/tserver/scan/LookupTask.java", "diffHunk": "@@ -177,9 +177,13 @@ public void run() {\n       }\n     } catch (SampleNotPresentException e) {\n       addResult(e);\n-    } catch (Throwable e) {\n+    } catch (Exception e) {\n       log.warn(\"exception while doing multi-scan \", e);\n       addResult(e);\n+    } catch (Error t) {\n+      log.warn(\"Error while doing multi-scan \", t);\n+      addResult(t);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NTM0NTczMw=="}, "originalCommit": {"oid": "74303f2e7cebb0f00925a5e690f8d552393d743b"}, "originalPosition": 10}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzQyNzQ4Mjg5OnYy", "diffSide": "RIGHT", "path": "server/tserver/src/main/java/org/apache/accumulo/tserver/scan/NextBatchTask.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xN1QxOToyOTo0MVrOIIFZSw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xN1QxOTo1Mzo1NlrOIIGTJw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NTM0NzkxNQ==", "bodyText": "Should this be more specific, like RuntimeException?", "url": "https://github.com/apache/accumulo/pull/1840#discussion_r545347915", "createdAt": "2020-12-17T19:29:41Z", "author": {"login": "ctubbsii"}, "path": "server/tserver/src/main/java/org/apache/accumulo/tserver/scan/NextBatchTask.java", "diffHunk": "@@ -89,14 +88,16 @@ public void run() {\n       }\n     } catch (TooManyFilesException | SampleNotPresentException e) {\n       addResult(e);\n-    } catch (OutOfMemoryError ome) {\n-      Halt.halt(\"Ran out of memory scanning \" + scanSession.extent + \" for \" + scanSession.client,\n-          1);\n-      addResult(ome);\n-    } catch (Throwable e) {\n+    } catch (Exception e) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "74303f2e7cebb0f00925a5e690f8d552393d743b"}, "originalPosition": 17}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NTM2MjcyNw==", "bodyText": "I can do that.", "url": "https://github.com/apache/accumulo/pull/1840#discussion_r545362727", "createdAt": "2020-12-17T19:53:56Z", "author": {"login": "dlmarion"}, "path": "server/tserver/src/main/java/org/apache/accumulo/tserver/scan/NextBatchTask.java", "diffHunk": "@@ -89,14 +88,16 @@ public void run() {\n       }\n     } catch (TooManyFilesException | SampleNotPresentException e) {\n       addResult(e);\n-    } catch (OutOfMemoryError ome) {\n-      Halt.halt(\"Ran out of memory scanning \" + scanSession.extent + \" for \" + scanSession.client,\n-          1);\n-      addResult(ome);\n-    } catch (Throwable e) {\n+    } catch (Exception e) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NTM0NzkxNQ=="}, "originalCommit": {"oid": "74303f2e7cebb0f00925a5e690f8d552393d743b"}, "originalPosition": 17}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzQyNzQ4NjE2OnYy", "diffSide": "RIGHT", "path": "server/tserver/src/main/java/org/apache/accumulo/tserver/scan/NextBatchTask.java", "isResolved": true, "comments": {"totalCount": 5, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xN1QxOTozMDoyNlrOIIFbNQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xN1QyMTowOTowMlrOIII4VQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NTM0ODQwNQ==", "bodyText": "The message here has changed and no longer has the scan session client included. Also, you should use slf4j substitution syntax to format the message.\nAre we sure we want to change the behavior to no longer Halt here? Is this change dependent on the one in #1818 to handle the shutdown?", "url": "https://github.com/apache/accumulo/pull/1840#discussion_r545348405", "createdAt": "2020-12-17T19:30:26Z", "author": {"login": "ctubbsii"}, "path": "server/tserver/src/main/java/org/apache/accumulo/tserver/scan/NextBatchTask.java", "diffHunk": "@@ -89,14 +88,16 @@ public void run() {\n       }\n     } catch (TooManyFilesException | SampleNotPresentException e) {\n       addResult(e);\n-    } catch (OutOfMemoryError ome) {\n-      Halt.halt(\"Ran out of memory scanning \" + scanSession.extent + \" for \" + scanSession.client,\n-          1);\n-      addResult(ome);\n-    } catch (Throwable e) {\n+    } catch (Exception e) {\n       log.warn(\"exception while scanning tablet \"\n           + (scanSession == null ? \"(unknown)\" : scanSession.extent), e);\n       addResult(e);\n+    } catch (Error t) {\n+      log.warn(\n+          \"Error while scanning tablet \" + (scanSession == null ? \"(unknown)\" : scanSession.extent),\n+          t);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "74303f2e7cebb0f00925a5e690f8d552393d743b"}, "originalPosition": 24}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NTM2NDI5OA==", "bodyText": "The message here has changed and no longer has the scan session client included.\n\nI'm not sure what yo umean, this is an copy of the log message in the catch clause above it.\n\nAlso, you should use slf4j substitution syntax to format the message.\n\nI can do that\n\nIs this change dependent on the one in #1818 to handle the shutdown?\n\nYes, I mentioned that in the initial comment on the PR. These changes assume that #1818 gets merged.", "url": "https://github.com/apache/accumulo/pull/1840#discussion_r545364298", "createdAt": "2020-12-17T19:56:20Z", "author": {"login": "dlmarion"}, "path": "server/tserver/src/main/java/org/apache/accumulo/tserver/scan/NextBatchTask.java", "diffHunk": "@@ -89,14 +88,16 @@ public void run() {\n       }\n     } catch (TooManyFilesException | SampleNotPresentException e) {\n       addResult(e);\n-    } catch (OutOfMemoryError ome) {\n-      Halt.halt(\"Ran out of memory scanning \" + scanSession.extent + \" for \" + scanSession.client,\n-          1);\n-      addResult(ome);\n-    } catch (Throwable e) {\n+    } catch (Exception e) {\n       log.warn(\"exception while scanning tablet \"\n           + (scanSession == null ? \"(unknown)\" : scanSession.extent), e);\n       addResult(e);\n+    } catch (Error t) {\n+      log.warn(\n+          \"Error while scanning tablet \" + (scanSession == null ? \"(unknown)\" : scanSession.extent),\n+          t);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NTM0ODQwNQ=="}, "originalCommit": {"oid": "74303f2e7cebb0f00925a5e690f8d552393d743b"}, "originalPosition": 24}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NTM4OTM4Mw==", "bodyText": "I'm not sure what yo umean, this is an copy of the log message in the catch clause above it.\n\nThe previous message from the Halt had \" for \" + scanSession.client, but this log message does not mention the scanSession.client at all.\n\nYes, I mentioned that in the initial comment on the PR. These changes assume that #1818 gets merged.\n\nThanks, I must've missed that.", "url": "https://github.com/apache/accumulo/pull/1840#discussion_r545389383", "createdAt": "2020-12-17T20:39:58Z", "author": {"login": "ctubbsii"}, "path": "server/tserver/src/main/java/org/apache/accumulo/tserver/scan/NextBatchTask.java", "diffHunk": "@@ -89,14 +88,16 @@ public void run() {\n       }\n     } catch (TooManyFilesException | SampleNotPresentException e) {\n       addResult(e);\n-    } catch (OutOfMemoryError ome) {\n-      Halt.halt(\"Ran out of memory scanning \" + scanSession.extent + \" for \" + scanSession.client,\n-          1);\n-      addResult(ome);\n-    } catch (Throwable e) {\n+    } catch (Exception e) {\n       log.warn(\"exception while scanning tablet \"\n           + (scanSession == null ? \"(unknown)\" : scanSession.extent), e);\n       addResult(e);\n+    } catch (Error t) {\n+      log.warn(\n+          \"Error while scanning tablet \" + (scanSession == null ? \"(unknown)\" : scanSession.extent),\n+          t);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NTM0ODQwNQ=="}, "originalCommit": {"oid": "74303f2e7cebb0f00925a5e690f8d552393d743b"}, "originalPosition": 24}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NTM5MjQ4NQ==", "bodyText": "As the log message you are referencing is in an Error handler, I should remove it as well given your comments in LookupTask?", "url": "https://github.com/apache/accumulo/pull/1840#discussion_r545392485", "createdAt": "2020-12-17T20:45:50Z", "author": {"login": "dlmarion"}, "path": "server/tserver/src/main/java/org/apache/accumulo/tserver/scan/NextBatchTask.java", "diffHunk": "@@ -89,14 +88,16 @@ public void run() {\n       }\n     } catch (TooManyFilesException | SampleNotPresentException e) {\n       addResult(e);\n-    } catch (OutOfMemoryError ome) {\n-      Halt.halt(\"Ran out of memory scanning \" + scanSession.extent + \" for \" + scanSession.client,\n-          1);\n-      addResult(ome);\n-    } catch (Throwable e) {\n+    } catch (Exception e) {\n       log.warn(\"exception while scanning tablet \"\n           + (scanSession == null ? \"(unknown)\" : scanSession.extent), e);\n       addResult(e);\n+    } catch (Error t) {\n+      log.warn(\n+          \"Error while scanning tablet \" + (scanSession == null ? \"(unknown)\" : scanSession.extent),\n+          t);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NTM0ODQwNQ=="}, "originalCommit": {"oid": "74303f2e7cebb0f00925a5e690f8d552393d743b"}, "originalPosition": 24}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NTQwNTAxMw==", "bodyText": "probably \ud83d\ude3a", "url": "https://github.com/apache/accumulo/pull/1840#discussion_r545405013", "createdAt": "2020-12-17T21:09:02Z", "author": {"login": "ctubbsii"}, "path": "server/tserver/src/main/java/org/apache/accumulo/tserver/scan/NextBatchTask.java", "diffHunk": "@@ -89,14 +88,16 @@ public void run() {\n       }\n     } catch (TooManyFilesException | SampleNotPresentException e) {\n       addResult(e);\n-    } catch (OutOfMemoryError ome) {\n-      Halt.halt(\"Ran out of memory scanning \" + scanSession.extent + \" for \" + scanSession.client,\n-          1);\n-      addResult(ome);\n-    } catch (Throwable e) {\n+    } catch (Exception e) {\n       log.warn(\"exception while scanning tablet \"\n           + (scanSession == null ? \"(unknown)\" : scanSession.extent), e);\n       addResult(e);\n+    } catch (Error t) {\n+      log.warn(\n+          \"Error while scanning tablet \" + (scanSession == null ? \"(unknown)\" : scanSession.extent),\n+          t);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NTM0ODQwNQ=="}, "originalCommit": {"oid": "74303f2e7cebb0f00925a5e690f8d552393d743b"}, "originalPosition": 24}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzQyNzQ5MjU4OnYy", "diffSide": "RIGHT", "path": "server/tserver/src/main/java/org/apache/accumulo/tserver/tablet/MinorCompactionTask.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xN1QxOTozMjoxMFrOIIFfPw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xN1QxOTozMjoxMFrOIIFfPw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NTM0OTQzOQ==", "bodyText": "This seems to be wrapping the exception with a RTE. Are there even checked exceptions that can occur here? If so, we probably should enumerate them explicitly, and only wrap checked exceptions, leaving RTEs unwrapped.", "url": "https://github.com/apache/accumulo/pull/1840#discussion_r545349439", "createdAt": "2020-12-17T19:32:10Z", "author": {"login": "ctubbsii"}, "path": "server/tserver/src/main/java/org/apache/accumulo/tserver/tablet/MinorCompactionTask.java", "diffHunk": "@@ -111,7 +111,7 @@ public void run() {\n       if (tablet.needsSplit()) {\n         tablet.getTabletServer().executeSplit(tablet);\n       }\n-    } catch (Throwable t) {\n+    } catch (Exception t) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "74303f2e7cebb0f00925a5e690f8d552393d743b"}, "originalPosition": 5}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzQyNzc3MjY0OnYy", "diffSide": "RIGHT", "path": "server/tserver/src/main/java/org/apache/accumulo/tserver/scan/NextBatchTask.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xN1QyMDo0MzoyNVrOIIIC1A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xN1QyMDo0MzoyNVrOIIIC1A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NTM5MTMxNg==", "bodyText": "This is good because it preserves existing behavior with regard to RTEs, but I suspect that eventually, we'll want to reconsider whether we want RTEs to get sent back to the client, or if we would want them to fall through and trigger a TApplicationException (which is like an HTTP 500 error), so that we don't leak arbitrary exceptions back to the client.", "url": "https://github.com/apache/accumulo/pull/1840#discussion_r545391316", "createdAt": "2020-12-17T20:43:25Z", "author": {"login": "ctubbsii"}, "path": "server/tserver/src/main/java/org/apache/accumulo/tserver/scan/NextBatchTask.java", "diffHunk": "@@ -89,14 +89,15 @@ public void run() {\n       }\n     } catch (TooManyFilesException | SampleNotPresentException e) {\n       addResult(e);\n-    } catch (OutOfMemoryError ome) {\n-      Halt.halt(\"Ran out of memory scanning \" + scanSession.extent + \" for \" + scanSession.client,\n-          1);\n-      addResult(ome);\n-    } catch (Throwable e) {\n-      log.warn(\"exception while scanning tablet \"\n-          + (scanSession == null ? \"(unknown)\" : scanSession.extent), e);\n+    } catch (IOException | RuntimeException e) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "76755fa4e1696d1cf76e25f592ed905eb2208086"}, "originalPosition": 24}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4021, "cost": 1, "resetAt": "2021-11-12T09:44:50Z"}}}