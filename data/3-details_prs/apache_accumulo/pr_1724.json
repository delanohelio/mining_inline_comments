{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDk5MDI5NTE3", "number": 1724, "title": "Update release candidate script", "bodyText": "Improving generated output:\n\nshow link to staging repo website\nshow full commits\nshow reminders of which buttons to click on the staging site\nshow reminder to replace $origin with actual remote name\nplace -s in git tag command with the other options\nupdate draft release notes link to point to staged site\n\nOptimizing performance:\n\ncreate the -next branch and switch to it in one command\nskip tests during release prep because the release can (and should) be\ntested outside of the actual release candidate creation process and\nthis speeds things up significantly\nchange release prep goal to only do package, because it's not\nnecessary to run verify during release:prepare; all the QA checks\ndone at verify can be done before/after release candidate staging\n\nBeing more interactive:\n\nprompt for gpg key to use\nprompt for the remote to push to (do not assume origin)\n\nRemoving junk:\n\nremove check for gpg2 (modern Linux uses version 2 for the gpg binary)\nremove unnecessary --test option and related runOrFail function\nremove extraReleaseArguments to simplify things", "createdAt": "2020-10-07T06:59:45Z", "url": "https://github.com/apache/accumulo/pull/1724", "merged": true, "mergeCommit": {"oid": "314f2aa6639449bf99db9191d3255349f84c5b61"}, "closed": true, "closedAt": "2020-10-07T17:18:21Z", "author": {"login": "ctubbsii"}, "timelineItems": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdQHkkTAH2gAyNDk5MDI5NTE3OmZiZjY3ODA0NzBlN2MyMjE4MmVmNDZkOTRiMDk3NzViMmFiMzE5Yjg=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdQOE6yAFqTUwMzk1NjA5MQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "fbf6780470e7c22182ef46d94b09775b2ab319b8", "author": {"user": {"login": "ctubbsii", "name": "Christopher Tubbs"}}, "url": "https://github.com/apache/accumulo/commit/fbf6780470e7c22182ef46d94b09775b2ab319b8", "committedDate": "2020-10-07T07:09:18Z", "message": "Update release candidate script\n\nImproving generated output:\n* show link to staging repo website\n* show full commits\n* show reminders of which buttons to click on the staging site\n* show reminder to replace `$origin` with actual remote name\n* place `-s` in `git tag` command with the other options\n* update draft release notes link to point to staged site\n\nOptimizing performance:\n* create the `-next` branch and switch to it in one command\n* skip tests during release prep because the release can (and should) be\n  tested outside of the actual release candidate creation process and\n  this speeds things up significantly\n* change release prep goal to only do `package`, because it's not\n  necessary to run `verify` during `release:prepare`; all the QA checks\n  done at `verify` can be done before/after release candidate staging\n\nBeing more interactive:\n* prompt for gpg key to use\n* prompt for the `remote` to push to (do not assume `origin`)\n\nRemoving junk:\n* remove check for `gpg2` (modern Linux uses version 2 for the `gpg` binary)\n* remove unnecessary `--test` option and related `runOrFail` function\n* remove `extraReleaseArguments` to simplify things"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "6963654f4ce3137ea59d413a214bd12905f204c8", "author": {"user": {"login": "ctubbsii", "name": "Christopher Tubbs"}}, "url": "https://github.com/apache/accumulo/commit/6963654f4ce3137ea59d413a214bd12905f204c8", "committedDate": "2020-10-07T06:56:51Z", "message": "Update release candidate script\n\nImproving generated output:\n* show link to staging repo website\n* show full commits\n* show reminders of which buttons to click on the staging site\n* show reminder to replace `$origin` with actual remote name\n* place `-s` in `git tag` command with the other options\n* update draft release notes link to point to staged site\n\nOptimizing performance:\n* create the `-next` branch and switch to it in one command\n* skip tests during release prep because the release can (and should) be\n  tested outside of the actual release candidate creation process and\n  this speeds things up significantly\n* change release prep goal to only do `package`, because it's not\n  necessary to run `verify` during `release:prepare`; all the QA checks\n  done at `verify` can be done before/after release candidate staging\n\nBeing more interactive:\n* prompt for gpg key to use\n* prompt for the `remote` to push to (do not assume `origin`)\n\nRemoving junk:\n* remove check for `gpg2` (modern Linux uses version 2 for the `gpg` binary)\n* remove unnecessary `--test` option and related `runOrFail` function\n* remove `extraReleaseArguments` to simplify things"}, "afterCommit": {"oid": "fbf6780470e7c22182ef46d94b09775b2ab319b8", "author": {"user": {"login": "ctubbsii", "name": "Christopher Tubbs"}}, "url": "https://github.com/apache/accumulo/commit/fbf6780470e7c22182ef46d94b09775b2ab319b8", "committedDate": "2020-10-07T07:09:18Z", "message": "Update release candidate script\n\nImproving generated output:\n* show link to staging repo website\n* show full commits\n* show reminders of which buttons to click on the staging site\n* show reminder to replace `$origin` with actual remote name\n* place `-s` in `git tag` command with the other options\n* update draft release notes link to point to staged site\n\nOptimizing performance:\n* create the `-next` branch and switch to it in one command\n* skip tests during release prep because the release can (and should) be\n  tested outside of the actual release candidate creation process and\n  this speeds things up significantly\n* change release prep goal to only do `package`, because it's not\n  necessary to run `verify` during `release:prepare`; all the QA checks\n  done at `verify` can be done before/after release candidate staging\n\nBeing more interactive:\n* prompt for gpg key to use\n* prompt for the `remote` to push to (do not assume `origin`)\n\nRemoving junk:\n* remove check for `gpg2` (modern Linux uses version 2 for the `gpg` binary)\n* remove unnecessary `--test` option and related `runOrFail` function\n* remove `extraReleaseArguments` to simplify things"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTAzOTU2MDkx", "url": "https://github.com/apache/accumulo/pull/1724#pullrequestreview-503956091", "createdAt": "2020-10-07T14:41:57Z", "commit": {"oid": "fbf6780470e7c22182ef46d94b09775b2ab319b8"}, "state": "APPROVED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wN1QxNDo0MTo1N1rOHd22pQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wN1QxNDo0MTo1N1rOHd22pQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMTA2OTQ3Nw==", "bodyText": "The prompt to select the fingerprint is nice, this was something I missed.", "url": "https://github.com/apache/accumulo/pull/1724#discussion_r501069477", "createdAt": "2020-10-07T14:41:57Z", "author": {"login": "milleruntime"}, "path": "assemble/build.sh", "diffHunk": "@@ -72,8 +74,43 @@ gitCommits() { pretty %H \"$@\"; }\n gitCommit()  { gitCommits -n1 \"$@\"; }\n gitSubject() { pretty %s \"$@\"; }\n \n+selectFingerprint() {\n+  local f fingerprints=()\n+  if [[ $SELECTED_FINGERPRINT =~ ^[0-9a-fA-F]{40}$ ]]; then\n+    # it's already set, don't set it again\n+    return 0\n+  fi\n+  mapfile -t fingerprints < <(gpg --list-secret-keys --with-colons --with-fingerprint 2>/dev/null | awk -F: '$1 == \"fpr\" {print $10}')\n+  fingerprints+=('Other')\n+  echo\n+  echo \"Select the $(green gpg) key to use:\"\n+  COLUMNS=1\n+  select f in \"${fingerprints[@]}\"; do\n+    if [[ -z $f ]]; then\n+      return 1\n+    elif [[ $f == 'Other' ]]; then\n+      SELECTED_FINGERPRINT=$(prompter \"$(green gpg) key's $(green fingerprint)\" '[0-9a-fA-F]{40}')\n+      return 0\n+    else\n+      SELECTED_FINGERPRINT=\"$f\"\n+      return 0\n+    fi\n+  done\n+}\n+", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "fbf6780470e7c22182ef46d94b09775b2ab319b8"}, "originalPosition": 96}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1732, "cost": 1, "resetAt": "2021-10-29T17:30:11Z"}}}