{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDAyODcyOTc1", "number": 1586, "reviewThreads": {"totalCount": 5, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0xNFQwMjozODo0N1rODxdQ3w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0xNFQxOTo1MjoxMVrODxzGBQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjUzMTg2MjcxOnYy", "diffSide": "RIGHT", "path": "core/src/main/java/org/apache/accumulo/core/singletons/SingletonManager.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0xNFQwMjozODo0N1rOGE8DkQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0xNFQxOTo0MToxMFrOGFeFAA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNzgzMTQ0MQ==", "bodyText": "As I understand it, the basis of this pull request is to create this CLOSED mode. What is this CLOSED mode for? This could use a javadoc similar to the other modes.", "url": "https://github.com/apache/accumulo/pull/1586#discussion_r407831441", "createdAt": "2020-04-14T02:38:47Z", "author": {"login": "ctubbsii"}, "path": "core/src/main/java/org/apache/accumulo/core/singletons/SingletonManager.java", "diffHunk": "@@ -65,7 +65,8 @@\n      * In this mode singletons are never disabled unless the mode is set back to CLIENT. The user\n      * can do this by using util.CleanUp (an old API created for users).\n      */\n-    CONNECTOR\n+    CONNECTOR,\n+    CLOSED", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "65dbef8c227a0527840a9c347db5b407339937b4"}, "originalPosition": 6}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwODM4ODg2NA==", "bodyText": "Added comments to explain CLOSED mode, also updated the CLIENT mode comments.", "url": "https://github.com/apache/accumulo/pull/1586#discussion_r408388864", "createdAt": "2020-04-14T19:41:10Z", "author": {"login": "karthick-rn"}, "path": "core/src/main/java/org/apache/accumulo/core/singletons/SingletonManager.java", "diffHunk": "@@ -65,7 +65,8 @@\n      * In this mode singletons are never disabled unless the mode is set back to CLIENT. The user\n      * can do this by using util.CleanUp (an old API created for users).\n      */\n-    CONNECTOR\n+    CONNECTOR,\n+    CLOSED", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNzgzMTQ0MQ=="}, "originalCommit": {"oid": "65dbef8c227a0527840a9c347db5b407339937b4"}, "originalPosition": 6}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjUzMTg3MzgzOnYy", "diffSide": "RIGHT", "path": "core/src/main/java/org/apache/accumulo/core/singletons/SingletonManager.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0xNFQwMjo0NTowN1rOGE8KLw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0xNFQwMjo0NTowN1rOGE8KLw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNzgzMzEzNQ==", "bodyText": "Would it be okay to just return if the mode parameter is already the current mode?\n\n  \n    \n  \n    \n\n  \n  This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters. Learn more about bidirectional Unicode characters\n\n\n  \n\n\n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                if (SingletonManager.mode == Mode.CLOSED && mode != Mode.CLOSED)\n          \n          \n            \n                  throw new IllegalStateException(\"Cannot leave closed mode once entered\");\n          \n          \n            \n                if (SingletonManager.mode == mode)\n          \n          \n            \n                  return;\n          \n          \n            \n                if (SingletonManager.mode == Mode.CLOSED)\n          \n          \n            \n                  throw new IllegalStateException(\"Cannot leave closed mode once entered\");\n          \n      \n    \n    \n  \n\nOr is it necessary to fall through and do something if they are both CLOSED already?", "url": "https://github.com/apache/accumulo/pull/1586#discussion_r407833135", "createdAt": "2020-04-14T02:45:07Z", "author": {"login": "ctubbsii"}, "path": "core/src/main/java/org/apache/accumulo/core/singletons/SingletonManager.java", "diffHunk": "@@ -148,6 +149,8 @@ public static long getReservationCount() {\n    * Change how singletons are managed. The default mode is {@link Mode#CLIENT}\n    */\n   public static synchronized void setMode(Mode mode) {\n+    if (SingletonManager.mode == Mode.CLOSED && mode != Mode.CLOSED)\n+      throw new IllegalStateException(\"Cannot leave closed mode once entered\");", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "65dbef8c227a0527840a9c347db5b407339937b4"}, "originalPosition": 15}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjUzMTg3OTg0OnYy", "diffSide": "RIGHT", "path": "core/src/main/java/org/apache/accumulo/core/singletons/SingletonManager.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0xNFQwMjo0ODozOVrOGE8N1A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0xNFQwMjo0ODozOVrOGE8N1A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNzgzNDA2OA==", "bodyText": "The comment above this line covers the left hand side, but doesn't explain the right hand side of this || expression. Should it say something about always allow changing state to CLOSED?", "url": "https://github.com/apache/accumulo/pull/1586#discussion_r407834068", "createdAt": "2020-04-14T02:48:39Z", "author": {"login": "ctubbsii"}, "path": "core/src/main/java/org/apache/accumulo/core/singletons/SingletonManager.java", "diffHunk": "@@ -161,7 +164,7 @@ public static synchronized void setMode(Mode mode) {\n     }\n \n     // do not change from server mode, its a terminal mode that can not be left once entered\n-    if (SingletonManager.mode != Mode.SERVER) {\n+    if (SingletonManager.mode != Mode.SERVER || mode == Mode.CLOSED) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "65dbef8c227a0527840a9c347db5b407339937b4"}, "originalPosition": 24}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjUzMTg4NDU4OnYy", "diffSide": "RIGHT", "path": "server/base/src/main/java/org/apache/accumulo/server/util/Admin.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0xNFQwMjo1MTowMlrOGE8QhQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0xNFQxMzo0OTo0MlrOGFPjRQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNzgzNDc1Nw==", "bodyText": "Does this prevent this code from being called from a process that might have other Accumulo client Connectors? If so, this is a bit concerning as a restriction.\n(Same comment for ZooZap and SetGoalState)", "url": "https://github.com/apache/accumulo/pull/1586#discussion_r407834757", "createdAt": "2020-04-14T02:51:02Z", "author": {"login": "ctubbsii"}, "path": "server/base/src/main/java/org/apache/accumulo/server/util/Admin.java", "diffHunk": "@@ -275,6 +277,8 @@ public void execute(final String[] args) {\n     } catch (Exception e) {\n       log.error(\"{}\", e.getMessage(), e);\n       System.exit(3);\n+    } finally {\n+      SingletonManager.setMode(Mode.CLOSED);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "65dbef8c227a0527840a9c347db5b407339937b4"}, "originalPosition": 14}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwODE1MDg1Mw==", "bodyText": "Does this prevent this code from being called from a process that might have other Accumulo client Connectors?\n\nYes I think it would.  I don't think this situation happens currently.  If it ever did in the future, a clear error message would occur making it easy to track down.  Since this not public API, its always easy to change this code later if the hypothetical situation does happen.", "url": "https://github.com/apache/accumulo/pull/1586#discussion_r408150853", "createdAt": "2020-04-14T13:49:42Z", "author": {"login": "keith-turner"}, "path": "server/base/src/main/java/org/apache/accumulo/server/util/Admin.java", "diffHunk": "@@ -275,6 +277,8 @@ public void execute(final String[] args) {\n     } catch (Exception e) {\n       log.error(\"{}\", e.getMessage(), e);\n       System.exit(3);\n+    } finally {\n+      SingletonManager.setMode(Mode.CLOSED);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNzgzNDc1Nw=="}, "originalCommit": {"oid": "65dbef8c227a0527840a9c347db5b407339937b4"}, "originalPosition": 14}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjUzNTQzOTQxOnYy", "diffSide": "RIGHT", "path": "core/src/main/java/org/apache/accumulo/core/singletons/SingletonManager.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0xNFQxOTo1MjoxMVrOGFecQQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0xNFQxOTo1MjoxMVrOGFecQQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwODM5NDgxNw==", "bodyText": "This isn't a javadoc comment.\n\n  \n    \n  \n    \n\n  \n  This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters. Learn more about bidirectional Unicode characters\n\n\n  \n\n\n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                /**\n          \n          \n            \n                /*", "url": "https://github.com/apache/accumulo/pull/1586#discussion_r408394817", "createdAt": "2020-04-14T19:52:11Z", "author": {"login": "ctubbsii"}, "path": "core/src/main/java/org/apache/accumulo/core/singletons/SingletonManager.java", "diffHunk": "@@ -170,8 +170,10 @@ public static synchronized void setMode(Mode mode) {\n       transitionedFromClientToConnector = true;\n     }\n \n-    // always allow transition to closed and only allow transition to client/connector when the\n-    // current mode is not server\n+    /**", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "3df1011e210663fd11e330bd5b5f215e213b3080"}, "originalPosition": 6}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4241, "cost": 1, "resetAt": "2021-11-12T09:44:50Z"}}}