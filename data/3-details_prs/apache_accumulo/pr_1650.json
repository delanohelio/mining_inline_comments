{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDQ1MzY0NjI3", "number": 1650, "title": "Batching Strategy for SimpleGarbageCollector Fix #1543", "bodyText": "Solution for #1543. Takes @ctubbsii  batching changes on #1441 and applying it to the SimpleGarbageCollector. I am not fully confident on my test for this feature so feadback on that will be much appreciated.", "createdAt": "2020-07-07T11:56:49Z", "url": "https://github.com/apache/accumulo/pull/1650", "merged": true, "mergeCommit": {"oid": "07bc9d329ea0b8da9a577863acfe009910e189cd"}, "closed": true, "closedAt": "2020-07-08T15:04:26Z", "author": {"login": "Manno15"}, "timelineItems": {"totalCount": 5, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcykJ-BAH2gAyNDQ1MzY0NjI3OmQyZDJkMzdlZTk1OTEyY2ZjZmVmMjY2ZjkzZWYzZWUzNzI5ZGIwZmE=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcy4SJYAH2gAyNDQ1MzY0NjI3OmNjMzI3NGQ4ZDIzODQ0MzNlZDFkMTNjYzEyZDBiNzA3NGM4MGMzOWQ=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "d2d2d37ee95912cfcfef266f93ef3ee3729db0fa", "author": {"user": {"login": "Manno15", "name": "Jeffrey Manno"}}, "url": "https://github.com/apache/accumulo/commit/d2d2d37ee95912cfcfef266f93ef3ee3729db0fa", "committedDate": "2020-07-07T11:29:46Z", "message": "Batching Strategy for SimpleGarbageCollector"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDQzOTk0OTI2", "url": "https://github.com/apache/accumulo/pull/1650#pullrequestreview-443994926", "createdAt": "2020-07-07T15:17:05Z", "commit": {"oid": "d2d2d37ee95912cfcfef266f93ef3ee3729db0fa"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wN1QxNToxNzowNlrOGuDe_w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wN1QxNToxNzowNlrOGuDe_w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MDk0NDc2Nw==", "bodyText": "I don't think the method comment is true anymore.  Perhaps this method name and comments should be changed altogether.", "url": "https://github.com/apache/accumulo/pull/1650#discussion_r450944767", "createdAt": "2020-07-07T15:17:06Z", "author": {"login": "ivakegg"}, "path": "server/gc/src/main/java/org/apache/accumulo/gc/SimpleGarbageCollector.java", "diffHunk": "@@ -669,14 +665,13 @@ private HostAndPort startStatsService() {\n   /**\n    * Checks if the system is almost out of memory.\n    *\n-   * @param runtime\n-   *          Java runtime\n+   * @param candidateLength\n+   *          Candidate Length\n    * @return true if system is almost out of memory\n-   * @see #CANDIDATE_MEMORY_PERCENTAGE\n+   * @see #CANDIDATE_BATCH_SIZE\n    */\n-  static boolean almostOutOfMemory(Runtime runtime) {\n-    return runtime.totalMemory() - runtime.freeMemory()\n-        > CANDIDATE_MEMORY_PERCENTAGE * runtime.maxMemory();\n+  static boolean almostOutOfMemory(Long candidateLength) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d2d2d37ee95912cfcfef266f93ef3ee3729db0fa"}, "originalPosition": 66}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDQ0MzQ2MzA0", "url": "https://github.com/apache/accumulo/pull/1650#pullrequestreview-444346304", "createdAt": "2020-07-08T01:05:50Z", "commit": {"oid": "d2d2d37ee95912cfcfef266f93ef3ee3729db0fa"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wOFQwMTowNTo1MFrOGuUmxw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wOFQwMTowNTo1MFrOGuUmxw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MTIyNTI4Nw==", "bodyText": "May be useful to include the batch size.  This probably needs to be reformatted.\n\n  \n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                      log.info(\"List of delete candidates has exceeded the batch size\"\n          \n          \n            \n                          + \" threshold. Attempting to delete what has been gathered so far.\");\n          \n          \n            \n                      log.info(\"Candidate batch of size {} has exceeded the\"\n          \n          \n            \n                          + \" threshold. Attempting to delete what has been gathered so far.\", candidateLength);", "url": "https://github.com/apache/accumulo/pull/1650#discussion_r451225287", "createdAt": "2020-07-08T01:05:50Z", "author": {"login": "keith-turner"}, "path": "server/gc/src/main/java/org/apache/accumulo/gc/SimpleGarbageCollector.java", "diffHunk": "@@ -209,20 +205,20 @@ public boolean getCandidates(String continuePoint, List<String> result)\n         throws TableNotFoundException {\n \n       Iterator<String> candidates = getContext().getAmple().getGcCandidates(level, continuePoint);\n+      long candidateLength = 0;\n \n       result.clear();\n \n       while (candidates.hasNext()) {\n-        String cand = candidates.next();\n-\n-        result.add(cand);\n-        if (almostOutOfMemory(Runtime.getRuntime())) {\n-          log.info(\"List of delete candidates has exceeded the memory\"\n+        String candidate = candidates.next();\n+        candidateLength += candidate.length();\n+        result.add(candidate);\n+        if (almostOutOfMemory(candidateLength)) {\n+          log.info(\"List of delete candidates has exceeded the batch size\"\n               + \" threshold. Attempting to delete what has been gathered so far.\");", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d2d2d37ee95912cfcfef266f93ef3ee3729db0fa"}, "originalPosition": 43}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDQ0MzQ2NDA2", "url": "https://github.com/apache/accumulo/pull/1650#pullrequestreview-444346406", "createdAt": "2020-07-08T01:06:09Z", "commit": {"oid": "d2d2d37ee95912cfcfef266f93ef3ee3729db0fa"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "cc3274d8d2384433ed1d13cc12d0b7074c80c39d", "author": {"user": {"login": "Manno15", "name": "Jeffrey Manno"}}, "url": "https://github.com/apache/accumulo/commit/cc3274d8d2384433ed1d13cc12d0b7074c80c39d", "committedDate": "2020-07-08T10:56:48Z", "message": "Remove test and make fuction inline per request"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1985, "cost": 1, "resetAt": "2021-10-29T17:30:11Z"}}}