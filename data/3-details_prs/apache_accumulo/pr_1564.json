{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0Mzg5NDc3ODk1", "number": 1564, "title": "Use single map method where possible.", "bodyText": "Replace common usage patterns of java.util.Map with Java 8 methods such as computeIfAbsent(), putIfAbsent(), etc.", "createdAt": "2020-03-16T20:26:41Z", "url": "https://github.com/apache/accumulo/pull/1564", "merged": true, "mergeCommit": {"oid": "9d772570ca1985076a420c71ea27f3bd2b351eb7"}, "closed": true, "closedAt": "2020-03-17T21:50:58Z", "author": {"login": "jmark99"}, "timelineItems": {"totalCount": 7, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcOT-NXAH2gAyMzg5NDc3ODk1OjA4ZDA3ZTFjZThmMzAwYTQ1YzA0YzZjODczY2JhYTIyMWVhMGFjMzQ=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcOoFFtgFqTM3NjM1MDEyNQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "08d07e1ce8f300a45c04c6c873cbaa221ea0ac34", "author": {"user": {"login": "jmark99", "name": "Mark Owens"}}, "url": "https://github.com/apache/accumulo/commit/08d07e1ce8f300a45c04c6c873cbaa221ea0ac34", "committedDate": "2020-03-16T20:17:10Z", "message": "Use single map method where possible.\n\nReplace common usage patterns of java.util.Map with Java 8 methods such\nas computeIfAbsent(), putIfAbsent(), etc."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzc1NjkwNjIx", "url": "https://github.com/apache/accumulo/pull/1564#pullrequestreview-375690621", "createdAt": "2020-03-17T01:57:24Z", "commit": {"oid": "08d07e1ce8f300a45c04c6c873cbaa221ea0ac34"}, "state": "COMMENTED", "comments": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xN1QwMTo1NzoyNVrOF3Lb7Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xN1QwMjoxMDoyN1rOF3Ln2A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MzQwMzM3Mw==", "bodyText": "If there aren't any checked exceptions, you can probably do e.getSecurityErrorCodes().forEach(...) instead of a loop over the entry set.", "url": "https://github.com/apache/accumulo/pull/1564#discussion_r393403373", "createdAt": "2020-03-17T01:57:25Z", "author": {"login": "ctubbsii"}, "path": "core/src/main/java/org/apache/accumulo/core/client/mapred/AccumuloOutputFormat.java", "diffHunk": "@@ -552,13 +550,9 @@ public void close(Reporter reporter) throws IOException {\n       } catch (MutationsRejectedException e) {\n         if (!e.getSecurityErrorCodes().isEmpty()) {\n           HashMap<String,Set<SecurityErrorCode>> tables = new HashMap<>();\n-          for (Entry<TabletId,Set<SecurityErrorCode>> ke : e.getSecurityErrorCodes().entrySet()) {\n+          for (var ke : e.getSecurityErrorCodes().entrySet()) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "08d07e1ce8f300a45c04c6c873cbaa221ea0ac34"}, "originalPosition": 21}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MzQwNDQyMw==", "bodyText": "One of the great things about .computeIfAbsent() is that you don't need to assign it to a variable... you could just immediately use it on the next line:\ntables.computeIfAbsent(tableId, k -> new HashSet<>()).addAll(ke.getValue());", "url": "https://github.com/apache/accumulo/pull/1564#discussion_r393404423", "createdAt": "2020-03-17T02:02:00Z", "author": {"login": "ctubbsii"}, "path": "core/src/main/java/org/apache/accumulo/core/client/mapred/AccumuloOutputFormat.java", "diffHunk": "@@ -552,13 +550,9 @@ public void close(Reporter reporter) throws IOException {\n       } catch (MutationsRejectedException e) {\n         if (!e.getSecurityErrorCodes().isEmpty()) {\n           HashMap<String,Set<SecurityErrorCode>> tables = new HashMap<>();\n-          for (Entry<TabletId,Set<SecurityErrorCode>> ke : e.getSecurityErrorCodes().entrySet()) {\n+          for (var ke : e.getSecurityErrorCodes().entrySet()) {\n             String tableId = ke.getKey().getTableId().toString();\n-            Set<SecurityErrorCode> secCodes = tables.get(tableId);\n-            if (secCodes == null) {\n-              secCodes = new HashSet<>();\n-              tables.put(tableId, secCodes);\n-            }\n+            Set<SecurityErrorCode> secCodes = tables.computeIfAbsent(tableId, k -> new HashSet<>());", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "08d07e1ce8f300a45c04c6c873cbaa221ea0ac34"}, "originalPosition": 28}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MzQwNTY0Nw==", "bodyText": "These look like they can simplify to:\nbinnedRanges.computeIfAbsent(location, k -> new HashMap<>())\n  .computeIfAbsent(ke, k -> new ArrayList<>())\n  .add(range);", "url": "https://github.com/apache/accumulo/pull/1564#discussion_r393405647", "createdAt": "2020-03-17T02:07:15Z", "author": {"login": "ctubbsii"}, "path": "core/src/main/java/org/apache/accumulo/core/clientImpl/TabletLocatorImpl.java", "diffHunk": "@@ -730,17 +730,10 @@ private void processInvalidated(ClientContext context, LockCheckerSession lcSess\n \n   protected static void addRange(Map<String,Map<KeyExtent,List<Range>>> binnedRanges,\n       String location, KeyExtent ke, Range range) {\n-    Map<KeyExtent,List<Range>> tablets = binnedRanges.get(location);\n-    if (tablets == null) {\n-      tablets = new HashMap<>();\n-      binnedRanges.put(location, tablets);\n-    }\n+    Map<KeyExtent,List<Range>> tablets =\n+        binnedRanges.computeIfAbsent(location, k -> new HashMap<>());\n \n-    List<Range> tabletsRanges = tablets.get(ke);\n-    if (tabletsRanges == null) {\n-      tabletsRanges = new ArrayList<>();\n-      tablets.put(ke, tabletsRanges);\n-    }\n+    List<Range> tabletsRanges = tablets.computeIfAbsent(ke, k -> new ArrayList<>());", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "08d07e1ce8f300a45c04c6c873cbaa221ea0ac34"}, "originalPosition": 17}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MzQwNjQyNA==", "bodyText": "This seems unrelated. If having trouble with the formatter, could just remove that comment at the end of the line, or put it above the log statement.", "url": "https://github.com/apache/accumulo/pull/1564#discussion_r393406424", "createdAt": "2020-03-17T02:10:27Z", "author": {"login": "ctubbsii"}, "path": "test/src/main/java/org/apache/accumulo/test/functional/ManyWriteAheadLogsIT.java", "diffHunk": "@@ -213,7 +213,8 @@ private void addOpenWals(ServerContext c, Set<String> allWalsSeen) throws Except\n           allWalsSeen.add(entry.getKey());\n           foundWal = true;\n         } else {\n-          log.debug(\"The WalState for {} is {}\", entry.getKey(), entry.getValue()); // CLOSED or UNREFERENCED\n+          log.debug(\"The WalState for {} is {}\", entry.getKey(), entry.getValue()); // CLOSED or\n+                                                                                    // UNREFERENCED", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "08d07e1ce8f300a45c04c6c873cbaa221ea0ac34"}, "originalPosition": 6}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "637448ac5196d57bc34a38c7ccce3db14a466038", "author": {"user": {"login": "ctubbsii", "name": "Christopher Tubbs"}}, "url": "https://github.com/apache/accumulo/commit/637448ac5196d57bc34a38c7ccce3db14a466038", "committedDate": "2020-03-17T04:19:34Z", "message": "Merge branch 'master' into map-methods"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzc2MDU2ODA1", "url": "https://github.com/apache/accumulo/pull/1564#pullrequestreview-376056805", "createdAt": "2020-03-17T13:56:15Z", "commit": {"oid": "637448ac5196d57bc34a38c7ccce3db14a466038"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "1ba24c1d0dbd1574759109e9c94dcb55397dd4c9", "author": {"user": {"login": "jmark99", "name": "Mark Owens"}}, "url": "https://github.com/apache/accumulo/commit/1ba24c1d0dbd1574759109e9c94dcb55397dd4c9", "committedDate": "2020-03-17T18:58:09Z", "message": "Use single map method where possible.\n\nAdded additional refactoring to the various Map methods. Namely chaining\ncommands where appropriate."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "6304177aa32208dfde7729a11b8bca53c62886ed", "author": {"user": {"login": "jmark99", "name": "Mark Owens"}}, "url": "https://github.com/apache/accumulo/commit/6304177aa32208dfde7729a11b8bca53c62886ed", "committedDate": "2020-03-17T19:00:24Z", "message": "Merge branch 'map-methods' of github.com:jmark99/accumulo into map-methods"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzc2MzUwMTI1", "url": "https://github.com/apache/accumulo/pull/1564#pullrequestreview-376350125", "createdAt": "2020-03-17T19:42:47Z", "commit": {"oid": "6304177aa32208dfde7729a11b8bca53c62886ed"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1899, "cost": 1, "resetAt": "2021-10-29T17:30:11Z"}}}