{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDM2MTc3MzAy", "number": 1632, "title": "Fix #1609 dynamically reinitialize compaction services when config ch\u2026", "bodyText": "\u2026anges", "createdAt": "2020-06-18T01:36:18Z", "url": "https://github.com/apache/accumulo/pull/1632", "merged": true, "mergeCommit": {"oid": "4115db09d2027d56bd8e021c0b9bc0d56e56e4ba"}, "closed": true, "closedAt": "2020-07-02T21:07:17Z", "author": {"login": "keith-turner"}, "timelineItems": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcsUM_9gH2gAyNDM2MTc3MzAyOmE5MTczYjczNTAxNDgxMGNlODUxNGZmMjUxZWJmZjg1ODZiOWU3MWY=", "endCursor": "Y3Vyc29yOnYyOpPPAAABc0mkgugFqTQ0NzUzNjQ4Mg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "a9173b735014810ce8514ff251ebff8586b9e71f", "author": {"user": {"login": "keith-turner", "name": "Keith Turner"}}, "url": "https://github.com/apache/accumulo/commit/a9173b735014810ce8514ff251ebff8586b9e71f", "committedDate": "2020-06-18T01:31:03Z", "message": "Fix #1609 dynamically reinitialize compaction services when config changes"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "721e6ea24df526cb4c0d22ae4886ca65a13da86a", "author": {"user": {"login": "keith-turner", "name": "Keith Turner"}}, "url": "https://github.com/apache/accumulo/commit/721e6ea24df526cb4c0d22ae4886ca65a13da86a", "committedDate": "2020-06-22T19:56:15Z", "message": "fix spotbugs issue"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "2b2469b4b20fe0829bbce081aa3ba0ff70c31b70", "author": {"user": {"login": "keith-turner", "name": "Keith Turner"}}, "url": "https://github.com/apache/accumulo/commit/2b2469b4b20fe0829bbce081aa3ba0ff70c31b70", "committedDate": "2020-06-24T00:17:59Z", "message": "remove TODO"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDQ3NTM2NDgy", "url": "https://github.com/apache/accumulo/pull/1632#pullrequestreview-447536482", "createdAt": "2020-07-13T19:26:25Z", "commit": {"oid": "2b2469b4b20fe0829bbce081aa3ba0ff70c31b70"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xM1QxOToyNjoyNVrOGw2oTw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xM1QxOToyNjoyNVrOGw2oTw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1Mzg3OTg4Nw==", "bodyText": "Did you consider using a ConcurrentHashMap here?  I see you made the map volatile, but was wondering if it would help prevent concurrency issues to have a ConcurrentHashMap as well.", "url": "https://github.com/apache/accumulo/pull/1632#discussion_r453879887", "createdAt": "2020-07-13T19:26:25Z", "author": {"login": "milleruntime"}, "path": "server/tserver/src/main/java/org/apache/accumulo/tserver/compactions/CompactionManager.java", "diffHunk": "@@ -20,34 +20,89 @@\n \n import java.util.HashMap;\n import java.util.Map;\n+import java.util.Objects;\n import java.util.Set;\n import java.util.concurrent.LinkedBlockingQueue;\n import java.util.concurrent.TimeUnit;\n \n+import org.apache.accumulo.core.conf.AccumuloConfiguration;\n import org.apache.accumulo.core.conf.Property;\n import org.apache.accumulo.core.dataImpl.KeyExtent;\n import org.apache.accumulo.core.spi.compaction.CompactionKind;\n import org.apache.accumulo.core.spi.compaction.CompactionServiceId;\n import org.apache.accumulo.core.spi.compaction.CompactionServices;\n-import org.apache.accumulo.core.spi.compaction.DefaultCompactionPlanner;\n import org.apache.accumulo.core.util.NamingThreadFactory;\n import org.apache.accumulo.fate.util.Retry;\n import org.apache.accumulo.server.ServerContext;\n-import org.apache.accumulo.tserver.TabletServerResourceManager;\n import org.slf4j.Logger;\n import org.slf4j.LoggerFactory;\n \n+import com.google.common.collect.Sets;\n+\n public class CompactionManager {\n \n   private static final Logger log = LoggerFactory.getLogger(CompactionManager.class);\n \n   private Iterable<Compactable> compactables;\n-  private Map<CompactionServiceId,CompactionService> services;\n+  private volatile Map<CompactionServiceId,CompactionService> services;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "2b2469b4b20fe0829bbce081aa3ba0ff70c31b70"}, "originalPosition": 31}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1970, "cost": 1, "resetAt": "2021-10-29T17:30:11Z"}}}