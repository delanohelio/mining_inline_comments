{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDQ1MzY0NjI3", "number": 1650, "reviewThreads": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wN1QxNToxNzowNVrOEMIA5g==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wOFQwMTowNTo1MFrOEMSy1w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjgxMTQ5NjcwOnYy", "diffSide": "RIGHT", "path": "server/gc/src/main/java/org/apache/accumulo/gc/SimpleGarbageCollector.java", "isResolved": true, "comments": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wN1QxNToxNzowNlrOGuDe_w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wOFQxMDoyODowNVrOGuh0_Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MDk0NDc2Nw==", "bodyText": "I don't think the method comment is true anymore.  Perhaps this method name and comments should be changed altogether.", "url": "https://github.com/apache/accumulo/pull/1650#discussion_r450944767", "createdAt": "2020-07-07T15:17:06Z", "author": {"login": "ivakegg"}, "path": "server/gc/src/main/java/org/apache/accumulo/gc/SimpleGarbageCollector.java", "diffHunk": "@@ -669,14 +665,13 @@ private HostAndPort startStatsService() {\n   /**\n    * Checks if the system is almost out of memory.\n    *\n-   * @param runtime\n-   *          Java runtime\n+   * @param candidateLength\n+   *          Candidate Length\n    * @return true if system is almost out of memory\n-   * @see #CANDIDATE_MEMORY_PERCENTAGE\n+   * @see #CANDIDATE_BATCH_SIZE\n    */\n-  static boolean almostOutOfMemory(Runtime runtime) {\n-    return runtime.totalMemory() - runtime.freeMemory()\n-        > CANDIDATE_MEMORY_PERCENTAGE * runtime.maxMemory();\n+  static boolean almostOutOfMemory(Long candidateLength) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d2d2d37ee95912cfcfef266f93ef3ee3729db0fa"}, "originalPosition": 66}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MDk1MTM3OA==", "bodyText": "That's fair, I wasn't quite sure on that either. Do you have any suggestions?", "url": "https://github.com/apache/accumulo/pull/1650#discussion_r450951378", "createdAt": "2020-07-07T15:26:27Z", "author": {"login": "Manno15"}, "path": "server/gc/src/main/java/org/apache/accumulo/gc/SimpleGarbageCollector.java", "diffHunk": "@@ -669,14 +665,13 @@ private HostAndPort startStatsService() {\n   /**\n    * Checks if the system is almost out of memory.\n    *\n-   * @param runtime\n-   *          Java runtime\n+   * @param candidateLength\n+   *          Candidate Length\n    * @return true if system is almost out of memory\n-   * @see #CANDIDATE_MEMORY_PERCENTAGE\n+   * @see #CANDIDATE_BATCH_SIZE\n    */\n-  static boolean almostOutOfMemory(Runtime runtime) {\n-    return runtime.totalMemory() - runtime.freeMemory()\n-        > CANDIDATE_MEMORY_PERCENTAGE * runtime.maxMemory();\n+  static boolean almostOutOfMemory(Long candidateLength) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MDk0NDc2Nw=="}, "originalCommit": {"oid": "d2d2d37ee95912cfcfef266f93ef3ee3729db0fa"}, "originalPosition": 66}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MTIyMzQ0OA==", "bodyText": "The method is so simple now, I would inline it and remove the associated test.", "url": "https://github.com/apache/accumulo/pull/1650#discussion_r451223448", "createdAt": "2020-07-08T00:58:42Z", "author": {"login": "keith-turner"}, "path": "server/gc/src/main/java/org/apache/accumulo/gc/SimpleGarbageCollector.java", "diffHunk": "@@ -669,14 +665,13 @@ private HostAndPort startStatsService() {\n   /**\n    * Checks if the system is almost out of memory.\n    *\n-   * @param runtime\n-   *          Java runtime\n+   * @param candidateLength\n+   *          Candidate Length\n    * @return true if system is almost out of memory\n-   * @see #CANDIDATE_MEMORY_PERCENTAGE\n+   * @see #CANDIDATE_BATCH_SIZE\n    */\n-  static boolean almostOutOfMemory(Runtime runtime) {\n-    return runtime.totalMemory() - runtime.freeMemory()\n-        > CANDIDATE_MEMORY_PERCENTAGE * runtime.maxMemory();\n+  static boolean almostOutOfMemory(Long candidateLength) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MDk0NDc2Nw=="}, "originalCommit": {"oid": "d2d2d37ee95912cfcfef266f93ef3ee3729db0fa"}, "originalPosition": 66}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MTQ0MTkxNw==", "bodyText": "That is what I originally had but was unsure on if removing the test was a good idea.", "url": "https://github.com/apache/accumulo/pull/1650#discussion_r451441917", "createdAt": "2020-07-08T10:28:05Z", "author": {"login": "Manno15"}, "path": "server/gc/src/main/java/org/apache/accumulo/gc/SimpleGarbageCollector.java", "diffHunk": "@@ -669,14 +665,13 @@ private HostAndPort startStatsService() {\n   /**\n    * Checks if the system is almost out of memory.\n    *\n-   * @param runtime\n-   *          Java runtime\n+   * @param candidateLength\n+   *          Candidate Length\n    * @return true if system is almost out of memory\n-   * @see #CANDIDATE_MEMORY_PERCENTAGE\n+   * @see #CANDIDATE_BATCH_SIZE\n    */\n-  static boolean almostOutOfMemory(Runtime runtime) {\n-    return runtime.totalMemory() - runtime.freeMemory()\n-        > CANDIDATE_MEMORY_PERCENTAGE * runtime.maxMemory();\n+  static boolean almostOutOfMemory(Long candidateLength) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MDk0NDc2Nw=="}, "originalCommit": {"oid": "d2d2d37ee95912cfcfef266f93ef3ee3729db0fa"}, "originalPosition": 66}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjgxMzI2Mjk1OnYy", "diffSide": "RIGHT", "path": "server/gc/src/main/java/org/apache/accumulo/gc/SimpleGarbageCollector.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wOFQwMTowNTo1MFrOGuUmxw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wOFQwMTowNTo1MFrOGuUmxw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MTIyNTI4Nw==", "bodyText": "May be useful to include the batch size.  This probably needs to be reformatted.\n\n  \n    \n  \n    \n\n  \n  This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters. Learn more about bidirectional Unicode characters\n\n\n  \n\n\n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                      log.info(\"List of delete candidates has exceeded the batch size\"\n          \n          \n            \n                          + \" threshold. Attempting to delete what has been gathered so far.\");\n          \n          \n            \n                      log.info(\"Candidate batch of size {} has exceeded the\"\n          \n          \n            \n                          + \" threshold. Attempting to delete what has been gathered so far.\", candidateLength);", "url": "https://github.com/apache/accumulo/pull/1650#discussion_r451225287", "createdAt": "2020-07-08T01:05:50Z", "author": {"login": "keith-turner"}, "path": "server/gc/src/main/java/org/apache/accumulo/gc/SimpleGarbageCollector.java", "diffHunk": "@@ -209,20 +205,20 @@ public boolean getCandidates(String continuePoint, List<String> result)\n         throws TableNotFoundException {\n \n       Iterator<String> candidates = getContext().getAmple().getGcCandidates(level, continuePoint);\n+      long candidateLength = 0;\n \n       result.clear();\n \n       while (candidates.hasNext()) {\n-        String cand = candidates.next();\n-\n-        result.add(cand);\n-        if (almostOutOfMemory(Runtime.getRuntime())) {\n-          log.info(\"List of delete candidates has exceeded the memory\"\n+        String candidate = candidates.next();\n+        candidateLength += candidate.length();\n+        result.add(candidate);\n+        if (almostOutOfMemory(candidateLength)) {\n+          log.info(\"List of delete candidates has exceeded the batch size\"\n               + \" threshold. Attempting to delete what has been gathered so far.\");", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d2d2d37ee95912cfcfef266f93ef3ee3729db0fa"}, "originalPosition": 43}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4292, "cost": 1, "resetAt": "2021-11-12T09:44:50Z"}}}