{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTIwODkyMjY2", "number": 1779, "title": "Stabilize NamespaceIdTest and TableIdTest", "bodyText": "TableId and NamespaceId have tests to ensure their caches work\ncorrectly. Previously, the tests would only attempt to increase the\ncache before checking that it decreased again. However, a garbage\ncollection could have reduced the size of the cache before we checked\nits size. This change guarantees the cache will reach a specific size\nbefore proceeding.", "createdAt": "2020-11-13T23:01:26Z", "url": "https://github.com/apache/accumulo/pull/1779", "merged": true, "mergeCommit": {"oid": "9c8bb334c00637514c41f04c6abeca1ec6e20711"}, "closed": true, "closedAt": "2020-11-16T17:23:45Z", "author": {"login": "ctubbsii"}, "timelineItems": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdcPQxygH2gAyNTIwODkyMjY2OjU4YTgwZDc2ZTRhYzU5NTIzZjFmMjBmYTFlNDZkMzVjNTU2YmE1NGQ=", "endCursor": "Y3Vyc29yOnYyOpPPAAABddIMeFAFqTUzMTUzMzMxMw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "58a80d76e4ac59523f1f20fa1e46d35c556ba54d", "author": {"user": {"login": "ctubbsii", "name": "Christopher Tubbs"}}, "url": "https://github.com/apache/accumulo/commit/58a80d76e4ac59523f1f20fa1e46d35c556ba54d", "committedDate": "2020-11-13T22:54:01Z", "message": "Stabilize NamespaceIdTest and TableIdTest\n\nTableId and NamespaceId have tests to ensure their caches work\ncorrectly. Previously, the tests would only *attempt* to increase the\ncache before checking that it decreased again. However, a garbage\ncollection could have reduced the size of the cache before we checked\nits size. This change *guarantees* the cache will reach a specific size\nbefore proceeding."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTMxNTMyMDI1", "url": "https://github.com/apache/accumulo/pull/1779#pullrequestreview-531532025", "createdAt": "2020-11-16T17:12:26Z", "commit": {"oid": "58a80d76e4ac59523f1f20fa1e46d35c556ba54d"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xNlQxNzoxMjoyNlrOH0I8yg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xNlQxNzoxMjoyNlrOH0I8yg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNDQzNDYzNA==", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                while ((preGCSize = NamespaceId.cache.asMap().entrySet().stream().count()) < 100) {\n          \n          \n            \n                while ((preGCSize = NamespaceId.cache.asMap().entrySet().size()) < 100) {", "url": "https://github.com/apache/accumulo/pull/1779#discussion_r524434634", "createdAt": "2020-11-16T17:12:26Z", "author": {"login": "milleruntime"}, "path": "core/src/test/java/org/apache/accumulo/core/data/NamespaceIdTest.java", "diffHunk": "@@ -79,12 +79,13 @@ public void testCacheIncreasesAndDecreasesAfterGC() {\n     assertEquals(namespaceString, nsId.canonical());\n \n     // create a bunch more and throw them away\n-    for (int i = 0; i < 999; i++) {\n-      NamespaceId.of(new String(\"namespace\" + i));\n+    long preGCSize = 0;\n+    int i = 0;\n+    while ((preGCSize = NamespaceId.cache.asMap().entrySet().stream().count()) < 100) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "58a80d76e4ac59523f1f20fa1e46d35c556ba54d"}, "originalPosition": 8}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTMxNTMzMDg1", "url": "https://github.com/apache/accumulo/pull/1779#pullrequestreview-531533085", "createdAt": "2020-11-16T17:13:39Z", "commit": {"oid": "58a80d76e4ac59523f1f20fa1e46d35c556ba54d"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xNlQxNzoxMzozOVrOH0I_7g==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xNlQxNzoxMzozOVrOH0I_7g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNDQzNTQzOA==", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                while ((preGCSize = TableId.cache.asMap().entrySet().stream().count()) < 100) {\n          \n          \n            \n                while ((preGCSize = TableId.cache.asMap().entrySet().size()) < 100) {\n          \n      \n    \n    \n  \n\nThere are also many other occurances in the test you could replace.", "url": "https://github.com/apache/accumulo/pull/1779#discussion_r524435438", "createdAt": "2020-11-16T17:13:39Z", "author": {"login": "milleruntime"}, "path": "core/src/test/java/org/apache/accumulo/core/data/TableIdTest.java", "diffHunk": "@@ -88,12 +88,13 @@ public void testCacheIncreasesAndDecreasesAfterGC() {\n     assertEquals(tableString, table1.canonical());\n \n     // create a bunch more and throw them away\n-    for (int i = 0; i < 999; i++) {\n-      TableId.of(new String(\"table\" + i));\n+    long preGCSize = 0;\n+    int i = 0;\n+    while ((preGCSize = TableId.cache.asMap().entrySet().stream().count()) < 100) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "58a80d76e4ac59523f1f20fa1e46d35c556ba54d"}, "originalPosition": 8}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTMxNTMzMzEz", "url": "https://github.com/apache/accumulo/pull/1779#pullrequestreview-531533313", "createdAt": "2020-11-16T17:13:54Z", "commit": {"oid": "58a80d76e4ac59523f1f20fa1e46d35c556ba54d"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1797, "cost": 1, "resetAt": "2021-10-29T17:30:11Z"}}}