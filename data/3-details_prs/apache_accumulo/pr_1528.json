{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0Mzc4MTc3NDY1", "number": 1528, "title": "Switch to Log4j2", "bodyText": "Fix #1514 Update pom.xml with log4j2 dependencies\n\nUse slf4j bindings for log4j2\nKeep log4j 1.2 jars for minicluster and test, because ZK needs it at runtime\nUse log4j-1.2-api jar for log4j 1.2 dependencies for deprecated public\nAPIs that can't yet be removed (particularly in core/mapred stuffs)\nAdd disruptor jar to class path to support high-performance asynchronous loggers\nExclude transitive dependencies for log4j 1.2, for better control over\nbuild class path, and to avoid multiple runtime slf4j bindings\nUpdate assembly to include log4j2 jars, and to exclude log4j 1.2 jars\n\nFix #1515 Create new AccumuloMonitorAppender to send to REST endpoint\n\nRemove unnecessary extra port configuration property for log4j\nSocketServer endpoint in monitor\nUpdate Monitor to store HTTP(s) URL for the service in ZK instead of\njust host and port; remove redundant log4j service advertisement using\nold log4j SocketServer port\nCreate new AccumuloMonitorAppender to read HTTP(s) URL from ZooCache,\non demand, and send logs as JSON to the REST endpoint at that URL\nFix extra slash in MonitorUtilTest\nReplace previous LogService in monitor with simpler RecentLogs\nimplementation to cache received logs from REST endpoint\nSimplify LogResource REST endpoints to use the RecentLogs APIs, with\nnew endpoint to receive POSTed logs as JSON, and clean up the\ndeduplication/counting/sanitizing code\nSimplify StatusResource to get its info from the RecentLogs object\nUpdate the web views to include logger names on the monitor page, and\nto simplify passing of the optional stacktrace details\n\nFix #1516 Remove log4j1 config files and add log4j2 config files\n\nCreate basic log4j2 config files for Accumulo services and a default\nconfig file for clients such as the shell\nUpdate accumulo-env.sh to configure logging using high-performance\nasynchronous loggers\nCreate service config file with console, rolling file, and monitor\nappenders, as well as an example separate rolling file appender for\naudit logs that can be easily toggled on\nCreate config file for console suitable for clients, especially the\nshell, complete with color highlighting\nAdd config for periodic auto-reconfiguring of log4j without restarting\nservices (especially helpful as a substitute for the now defunct shell\noption for 'debug on')", "createdAt": "2020-02-21T09:06:26Z", "url": "https://github.com/apache/accumulo/pull/1528", "merged": true, "mergeCommit": {"oid": "9f487a043d0ddef8ef3b8f8036d4bf999260b2d0"}, "closed": true, "closedAt": "2020-02-24T21:57:30Z", "author": {"login": "ctubbsii"}, "timelineItems": {"totalCount": 6, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcGfAxuAH2gAyMzc4MTc3NDY1OjAzMGRhYTFkNDc3Yjc0ZTczMmE3YWFkYzZjMDU2MDQxMjQxZDk2YzE=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcHz_ORAFqTM2NDIxNzI1OA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "030daa1d477b74e732a7aadc6c056041241d96c1", "author": {"user": {"login": "ctubbsii", "name": "Christopher Tubbs"}}, "url": "https://github.com/apache/accumulo/commit/030daa1d477b74e732a7aadc6c056041241d96c1", "committedDate": "2020-02-21T12:37:32Z", "message": "Update to log4j2\n\nFix #1514 Update pom.xml with log4j2 dependencies\n\n* Use slf4j bindings for log4j2\n* Keep log4j 1.2 jars for minicluster and test, because ZK needs it at runtime\n* Use log4j-1.2-api jar for log4j 1.2 dependencies for deprecated public\n  APIs that can't yet be removed (particularly in core/mapred stuffs)\n* Add disruptor jar to class path to support high-performance asynchronous loggers\n* Exclude transitive dependencies for log4j 1.2, for better control over\n  build class path, and to avoid multiple runtime slf4j bindings\n* Update assembly to include log4j2 jars, and to exclude log4j 1.2 jars\n\nFix #1515 Create new AccumuloMonitorAppender to send to REST endpoint\n\n* Remove unnecessary extra port configuration property for log4j\n  SocketServer endpoint in monitor\n* Update Monitor to store HTTP(s) URL for the service in ZK instead of\n  just host and port; remove redundant log4j service advertisement using\n  old log4j SocketServer port\n* Create new AccumuloMonitorAppender to read HTTP(s) URL from ZooCache,\n  on demand, and send logs as JSON to the REST endpoint at that URL\n* Fix extra slash in MonitorUtilTest\n* Replace previous LogService in monitor with simpler RecentLogs\n  implementation to cache received logs from REST endpoint\n* Simplify LogResource REST endpoints to use the RecentLogs APIs, with\n  new endpoint to receive POSTed logs as JSON, and clean up the\n  deduplication/counting/sanitizing code\n* Simplify StatusResource to get its info from the RecentLogs object\n* Update the web views to include logger names on the monitor page, and\n  to simplify passing of the optional stacktrace details\n\nFix #1516 Remove log4j1 config files and add log4j2 config files\n\n* Create basic log4j2 config files for Accumulo services and a default\n  config file for clients such as the shell\n* Update accumulo-env.sh to configure logging using high-performance\n  asynchronous loggers\n* Create service config file with console, rolling file, and monitor\n  appenders, as well as an example separate rolling file appender for\n  audit logs that can be easily toggled on\n* Create config file for console suitable for clients, especially the\n  shell, complete with color highlighting\n* Add config for periodic auto-reconfiguring of log4j without restarting\n  services (especially helpful as a substitute for the now defunct shell\n  option for 'debug on')"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "8d35fbe8e11a73bbc05ab65b2dfb5362a93bc7cc", "author": {"user": {"login": "ctubbsii", "name": "Christopher Tubbs"}}, "url": "https://github.com/apache/accumulo/commit/8d35fbe8e11a73bbc05ab65b2dfb5362a93bc7cc", "committedDate": "2020-02-21T11:44:19Z", "message": "Fix spotbugs and undeclared deps"}, "afterCommit": {"oid": "030daa1d477b74e732a7aadc6c056041241d96c1", "author": {"user": {"login": "ctubbsii", "name": "Christopher Tubbs"}}, "url": "https://github.com/apache/accumulo/commit/030daa1d477b74e732a7aadc6c056041241d96c1", "committedDate": "2020-02-21T12:37:32Z", "message": "Update to log4j2\n\nFix #1514 Update pom.xml with log4j2 dependencies\n\n* Use slf4j bindings for log4j2\n* Keep log4j 1.2 jars for minicluster and test, because ZK needs it at runtime\n* Use log4j-1.2-api jar for log4j 1.2 dependencies for deprecated public\n  APIs that can't yet be removed (particularly in core/mapred stuffs)\n* Add disruptor jar to class path to support high-performance asynchronous loggers\n* Exclude transitive dependencies for log4j 1.2, for better control over\n  build class path, and to avoid multiple runtime slf4j bindings\n* Update assembly to include log4j2 jars, and to exclude log4j 1.2 jars\n\nFix #1515 Create new AccumuloMonitorAppender to send to REST endpoint\n\n* Remove unnecessary extra port configuration property for log4j\n  SocketServer endpoint in monitor\n* Update Monitor to store HTTP(s) URL for the service in ZK instead of\n  just host and port; remove redundant log4j service advertisement using\n  old log4j SocketServer port\n* Create new AccumuloMonitorAppender to read HTTP(s) URL from ZooCache,\n  on demand, and send logs as JSON to the REST endpoint at that URL\n* Fix extra slash in MonitorUtilTest\n* Replace previous LogService in monitor with simpler RecentLogs\n  implementation to cache received logs from REST endpoint\n* Simplify LogResource REST endpoints to use the RecentLogs APIs, with\n  new endpoint to receive POSTed logs as JSON, and clean up the\n  deduplication/counting/sanitizing code\n* Simplify StatusResource to get its info from the RecentLogs object\n* Update the web views to include logger names on the monitor page, and\n  to simplify passing of the optional stacktrace details\n\nFix #1516 Remove log4j1 config files and add log4j2 config files\n\n* Create basic log4j2 config files for Accumulo services and a default\n  config file for clients such as the shell\n* Update accumulo-env.sh to configure logging using high-performance\n  asynchronous loggers\n* Create service config file with console, rolling file, and monitor\n  appenders, as well as an example separate rolling file appender for\n  audit logs that can be easily toggled on\n* Create config file for console suitable for clients, especially the\n  shell, complete with color highlighting\n* Add config for periodic auto-reconfiguring of log4j without restarting\n  services (especially helpful as a substitute for the now defunct shell\n  option for 'debug on')"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a06c8ebfa849d39b13e70bc1fec9879a20d667fd", "author": {"user": {"login": "ctubbsii", "name": "Christopher Tubbs"}}, "url": "https://github.com/apache/accumulo/commit/a06c8ebfa849d39b13e70bc1fec9879a20d667fd", "committedDate": "2020-02-21T14:01:04Z", "message": "Fix dependency analysis looking for log4j jar"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "de9fe403dbf70c2a68ca29dd3a12f5053681433e", "author": {"user": {"login": "ctubbsii", "name": "Christopher Tubbs"}}, "url": "https://github.com/apache/accumulo/commit/de9fe403dbf70c2a68ca29dd3a12f5053681433e", "committedDate": "2020-02-21T16:19:55Z", "message": "Fix ITs and make log clearing use a dedicated endpoint"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "2eab3fcc5c1da5f875433c21060be55068c8fe74", "author": {"user": {"login": "ctubbsii", "name": "Christopher Tubbs"}}, "url": "https://github.com/apache/accumulo/commit/2eab3fcc5c1da5f875433c21060be55068c8fe74", "committedDate": "2020-02-22T04:56:28Z", "message": "Fix #1529 Migrate log4j 1.2 test files to log4j2\n\nFix AuditMessageIT and directly convert existing log4j 1.2 configuration\nfiles to log4j2 format. No evaluation was done to update the files, only\ndirect conversion from previous behavior."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzY0MjE3MjU4", "url": "https://github.com/apache/accumulo/pull/1528#pullrequestreview-364217258", "createdAt": "2020-02-25T15:10:15Z", "commit": {"oid": "2eab3fcc5c1da5f875433c21060be55068c8fe74"}, "state": "COMMENTED", "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yNVQxNToxMTo0NlrOFuJ3wg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yNVQxNToxNjo0MVrOFuKEHA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4Mzk0MDU0Ng==", "bodyText": "A log4j package with \"impl\" in the name makes me think this isn't public API.  Is this for public use?", "url": "https://github.com/apache/accumulo/pull/1528#discussion_r383940546", "createdAt": "2020-02-25T15:11:46Z", "author": {"login": "milleruntime"}, "path": "core/pom.xml", "diffHunk": "@@ -145,13 +145,13 @@\n       <scope>test</scope>\n     </dependency>\n     <dependency>\n-      <groupId>org.easymock</groupId>\n-      <artifactId>easymock</artifactId>\n+      <groupId>org.apache.logging.log4j</groupId>\n+      <artifactId>log4j-slf4j-impl</artifactId>", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "2eab3fcc5c1da5f875433c21060be55068c8fe74"}, "originalPosition": 29}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4Mzk0MjQxMg==", "bodyText": "It looks like this property was only used in MiniAccumulo?", "url": "https://github.com/apache/accumulo/pull/1528#discussion_r383942412", "createdAt": "2020-02-25T15:14:44Z", "author": {"login": "milleruntime"}, "path": "core/src/main/java/org/apache/accumulo/core/conf/Property.java", "diffHunk": "@@ -544,8 +544,6 @@\n       \"Properties in this category affect the behavior of the monitor web server.\"),\n   MONITOR_PORT(\"monitor.port.client\", \"9995\", PropertyType.PORT,\n       \"The listening port for the monitor's http service\"),\n-  MONITOR_LOG4J_PORT(\"monitor.port.log4j\", \"4560\", PropertyType.PORT,\n-      \"The listening port for the monitor's log4j logging collection.\"),", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "2eab3fcc5c1da5f875433c21060be55068c8fe74"}, "originalPosition": 5}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4Mzk0MzcwOA==", "bodyText": "This looks like a new dependency.  Is this needed by log4j2?  What uses this?", "url": "https://github.com/apache/accumulo/pull/1528#discussion_r383943708", "createdAt": "2020-02-25T15:16:41Z", "author": {"login": "milleruntime"}, "path": "pom.xml", "diffHunk": "@@ -235,6 +235,11 @@\n         <artifactId>protobuf-java</artifactId>\n         <version>3.7.1</version>\n       </dependency>\n+      <dependency>\n+        <groupId>com.lmax</groupId>\n+        <artifactId>disruptor</artifactId>\n+        <version>3.4.2</version>\n+      </dependency>", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "2eab3fcc5c1da5f875433c21060be55068c8fe74"}, "originalPosition": 8}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1852, "cost": 1, "resetAt": "2021-10-29T17:30:11Z"}}}