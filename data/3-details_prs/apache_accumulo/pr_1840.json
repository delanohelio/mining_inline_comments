{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTQyMDU0NTg4", "number": 1840, "title": "Closes #1689: Don't catch Throwable (unless it's rethrown)", "bodyText": "Modified code that was catching Throwable to mostly catch Exception, unless Throwable was being re-thrown. This, in conjunction with #1818, should expose issues that might be getting silently ignored.", "createdAt": "2020-12-17T18:44:02Z", "url": "https://github.com/apache/accumulo/pull/1840", "merged": true, "mergeCommit": {"oid": "bbd87a6693fc5cdbbe947b0821a4f05a18cf905b"}, "closed": true, "closedAt": "2021-01-19T13:07:08Z", "author": {"login": "dlmarion"}, "timelineItems": {"totalCount": 9, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdnIA_KAH2gAyNTQyMDU0NTg4Ojc0MzAzZjJlN2NlYmIwZjAwOTI1YTVlNjkwZjhkNTUyMzkzZDc0M2I=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdxqsdfAH2gAyNTQyMDU0NTg4OjgzYzhjMTdmNTQzZmU3NGNlYjkxNGJmMTc3NTFkNGEwMDliMGVhMjQ=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "74303f2e7cebb0f00925a5e690f8d552393d743b", "author": {"user": {"login": "dlmarion", "name": "Dave Marion"}}, "url": "https://github.com/apache/accumulo/commit/74303f2e7cebb0f00925a5e690f8d552393d743b", "committedDate": "2020-12-17T18:40:36Z", "message": "Closes #1689: Don't catch Throwable (unless its rethrown)"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTU0OTE4NTQ2", "url": "https://github.com/apache/accumulo/pull/1840#pullrequestreview-554918546", "createdAt": "2020-12-17T19:26:15Z", "commit": {"oid": "74303f2e7cebb0f00925a5e690f8d552393d743b"}, "state": "COMMENTED", "comments": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xN1QxOToyNjoxNVrOIIFQxQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xN1QxOTozMjoxMFrOIIFfPw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NTM0NTczMw==", "bodyText": "Is there value in adding this to the result if we're re-throwing?", "url": "https://github.com/apache/accumulo/pull/1840#discussion_r545345733", "createdAt": "2020-12-17T19:26:15Z", "author": {"login": "ctubbsii"}, "path": "server/tserver/src/main/java/org/apache/accumulo/tserver/scan/LookupTask.java", "diffHunk": "@@ -177,9 +177,13 @@ public void run() {\n       }\n     } catch (SampleNotPresentException e) {\n       addResult(e);\n-    } catch (Throwable e) {\n+    } catch (Exception e) {\n       log.warn(\"exception while doing multi-scan \", e);\n       addResult(e);\n+    } catch (Error t) {\n+      log.warn(\"Error while doing multi-scan \", t);\n+      addResult(t);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "74303f2e7cebb0f00925a5e690f8d552393d743b"}, "originalPosition": 10}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NTM0NzkxNQ==", "bodyText": "Should this be more specific, like RuntimeException?", "url": "https://github.com/apache/accumulo/pull/1840#discussion_r545347915", "createdAt": "2020-12-17T19:29:41Z", "author": {"login": "ctubbsii"}, "path": "server/tserver/src/main/java/org/apache/accumulo/tserver/scan/NextBatchTask.java", "diffHunk": "@@ -89,14 +88,16 @@ public void run() {\n       }\n     } catch (TooManyFilesException | SampleNotPresentException e) {\n       addResult(e);\n-    } catch (OutOfMemoryError ome) {\n-      Halt.halt(\"Ran out of memory scanning \" + scanSession.extent + \" for \" + scanSession.client,\n-          1);\n-      addResult(ome);\n-    } catch (Throwable e) {\n+    } catch (Exception e) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "74303f2e7cebb0f00925a5e690f8d552393d743b"}, "originalPosition": 17}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NTM0ODQwNQ==", "bodyText": "The message here has changed and no longer has the scan session client included. Also, you should use slf4j substitution syntax to format the message.\nAre we sure we want to change the behavior to no longer Halt here? Is this change dependent on the one in #1818 to handle the shutdown?", "url": "https://github.com/apache/accumulo/pull/1840#discussion_r545348405", "createdAt": "2020-12-17T19:30:26Z", "author": {"login": "ctubbsii"}, "path": "server/tserver/src/main/java/org/apache/accumulo/tserver/scan/NextBatchTask.java", "diffHunk": "@@ -89,14 +88,16 @@ public void run() {\n       }\n     } catch (TooManyFilesException | SampleNotPresentException e) {\n       addResult(e);\n-    } catch (OutOfMemoryError ome) {\n-      Halt.halt(\"Ran out of memory scanning \" + scanSession.extent + \" for \" + scanSession.client,\n-          1);\n-      addResult(ome);\n-    } catch (Throwable e) {\n+    } catch (Exception e) {\n       log.warn(\"exception while scanning tablet \"\n           + (scanSession == null ? \"(unknown)\" : scanSession.extent), e);\n       addResult(e);\n+    } catch (Error t) {\n+      log.warn(\n+          \"Error while scanning tablet \" + (scanSession == null ? \"(unknown)\" : scanSession.extent),\n+          t);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "74303f2e7cebb0f00925a5e690f8d552393d743b"}, "originalPosition": 24}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NTM0OTQzOQ==", "bodyText": "This seems to be wrapping the exception with a RTE. Are there even checked exceptions that can occur here? If so, we probably should enumerate them explicitly, and only wrap checked exceptions, leaving RTEs unwrapped.", "url": "https://github.com/apache/accumulo/pull/1840#discussion_r545349439", "createdAt": "2020-12-17T19:32:10Z", "author": {"login": "ctubbsii"}, "path": "server/tserver/src/main/java/org/apache/accumulo/tserver/tablet/MinorCompactionTask.java", "diffHunk": "@@ -111,7 +111,7 @@ public void run() {\n       if (tablet.needsSplit()) {\n         tablet.getTabletServer().executeSplit(tablet);\n       }\n-    } catch (Throwable t) {\n+    } catch (Exception t) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "74303f2e7cebb0f00925a5e690f8d552393d743b"}, "originalPosition": 5}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "76755fa4e1696d1cf76e25f592ed905eb2208086", "author": {"user": {"login": "dlmarion", "name": "Dave Marion"}}, "url": "https://github.com/apache/accumulo/commit/76755fa4e1696d1cf76e25f592ed905eb2208086", "committedDate": "2020-12-17T20:08:56Z", "message": "re #1689: addressing PR comments"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTU0OTcyNjM1", "url": "https://github.com/apache/accumulo/pull/1840#pullrequestreview-554972635", "createdAt": "2020-12-17T20:43:25Z", "commit": {"oid": "76755fa4e1696d1cf76e25f592ed905eb2208086"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xN1QyMDo0MzoyNVrOIIIC1A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xN1QyMDo0MzoyNVrOIIIC1A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NTM5MTMxNg==", "bodyText": "This is good because it preserves existing behavior with regard to RTEs, but I suspect that eventually, we'll want to reconsider whether we want RTEs to get sent back to the client, or if we would want them to fall through and trigger a TApplicationException (which is like an HTTP 500 error), so that we don't leak arbitrary exceptions back to the client.", "url": "https://github.com/apache/accumulo/pull/1840#discussion_r545391316", "createdAt": "2020-12-17T20:43:25Z", "author": {"login": "ctubbsii"}, "path": "server/tserver/src/main/java/org/apache/accumulo/tserver/scan/NextBatchTask.java", "diffHunk": "@@ -89,14 +89,15 @@ public void run() {\n       }\n     } catch (TooManyFilesException | SampleNotPresentException e) {\n       addResult(e);\n-    } catch (OutOfMemoryError ome) {\n-      Halt.halt(\"Ran out of memory scanning \" + scanSession.extent + \" for \" + scanSession.client,\n-          1);\n-      addResult(ome);\n-    } catch (Throwable e) {\n-      log.warn(\"exception while scanning tablet \"\n-          + (scanSession == null ? \"(unknown)\" : scanSession.extent), e);\n+    } catch (IOException | RuntimeException e) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "76755fa4e1696d1cf76e25f592ed905eb2208086"}, "originalPosition": 24}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "024201a7a692ce291cbe4649b2a6ee4b497b8c1d", "author": {"user": {"login": "dlmarion", "name": "Dave Marion"}}, "url": "https://github.com/apache/accumulo/commit/024201a7a692ce291cbe4649b2a6ee4b497b8c1d", "committedDate": "2020-12-17T20:57:41Z", "message": "re #1689: Remove catch and re-throw of Error"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c6cb743fbe4273e0e9fb75e2b1290d051a417e01", "author": {"user": {"login": "dlmarion", "name": "Dave Marion"}}, "url": "https://github.com/apache/accumulo/commit/c6cb743fbe4273e0e9fb75e2b1290d051a417e01", "committedDate": "2021-01-11T14:07:21Z", "message": "Merge branch 'main' into 1689-dont-catch-throwable\n\nConflicts:\n\tserver/tserver/src/main/java/org/apache/accumulo/tserver/log/LogSorter.java"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "2a8ab15438b39b91da306ec23a9207fc04517b94", "author": {"user": {"login": "dlmarion", "name": "Dave Marion"}}, "url": "https://github.com/apache/accumulo/commit/2a8ab15438b39b91da306ec23a9207fc04517b94", "committedDate": "2021-01-11T14:39:25Z", "message": "re #1689: fix possible null pointer dereference error in SpotBugs"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTY2OTM4NDk4", "url": "https://github.com/apache/accumulo/pull/1840#pullrequestreview-566938498", "createdAt": "2021-01-13T07:04:08Z", "commit": {"oid": "2a8ab15438b39b91da306ec23a9207fc04517b94"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "83c8c17f543fe74ceb914bf17751d4a009b0ea24", "author": {"user": {"login": "dlmarion", "name": "Dave Marion"}}, "url": "https://github.com/apache/accumulo/commit/83c8c17f543fe74ceb914bf17751d4a009b0ea24", "committedDate": "2021-01-19T12:44:06Z", "message": "Merge branch 'main' into 1689-dont-catch-throwable\n\nConflicts:\n\tcore/src/main/java/org/apache/accumulo/core/clientImpl/TabletServerBatchWriter.java\n\tserver/tserver/src/main/java/org/apache/accumulo/tserver/TabletServerResourceManager.java\n\tserver/tserver/src/main/java/org/apache/accumulo/tserver/scan/NextBatchTask.java"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1679, "cost": 1, "resetAt": "2021-10-29T17:30:11Z"}}}