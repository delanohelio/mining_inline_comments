{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0MzgxNTU1MDE0", "number": 1538, "title": "Fix DatafileManager MajC for empty files. Closes #1535", "bodyText": "Don't rename the file if it is empty\nDon't add the file to the list of files if it is empty", "createdAt": "2020-02-28T19:25:09Z", "url": "https://github.com/apache/accumulo/pull/1538", "merged": true, "mergeCommit": {"oid": "ac6db98d669f84b5cc26177e83418cd6d8fddb7a"}, "closed": true, "closedAt": "2020-03-02T16:46:23Z", "author": {"login": "milleruntime"}, "timelineItems": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcI1ACQgH2gAyMzgxNTU1MDE0OjBlMmZkZWE1ZGMxOWNkYTI1Nzc5NTBlZTI5ZWJhYWRjOTQyM2E0MmI=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcJwGWngFqTM2NzMyNzM1OQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "0e2fdea5dc19cda2577950ee29ebaadc9423a42b", "author": {"user": {"login": "milleruntime", "name": "Mike Miller"}}, "url": "https://github.com/apache/accumulo/commit/0e2fdea5dc19cda2577950ee29ebaadc9423a42b", "committedDate": "2020-02-28T19:22:29Z", "message": "Fix DatafileManager MajC for empty files. Closes #1535\n\n* Don't rename the file if it is empty\n* Don't add the file to the list of files if it is empty"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzY2NzAwNjg1", "url": "https://github.com/apache/accumulo/pull/1538#pullrequestreview-366700685", "createdAt": "2020-02-28T21:37:37Z", "commit": {"oid": "0e2fdea5dc19cda2577950ee29ebaadc9423a42b"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yOFQyMTozNzozN1rOFwDizA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yOFQyMTozNzozN1rOFwDizA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NTkzNDAyOA==", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                  tablet.getTabletServer().getFileSystem().deleteRecursively(newDatafile.getPath());\n          \n          \n            \n                  tablet.getTabletServer().getFileSystem().deleteRecursively(tmpDatafile.getPath());", "url": "https://github.com/apache/accumulo/pull/1538#discussion_r385934028", "createdAt": "2020-02-28T21:37:37Z", "author": {"login": "keith-turner"}, "path": "server/tserver/src/main/java/org/apache/accumulo/tserver/tablet/DatafileManager.java", "diffHunk": "@@ -500,12 +500,13 @@ StoredTabletFile bringMajorCompactionOnline(Set<StoredTabletFile> oldDatafiles,\n       throw new IllegalStateException(\"Target map file already exist \" + newDatafile);\n     }\n \n-    // rename before putting in metadata table, so files in metadata table should\n-    // always exist\n-    rename(tablet.getTabletServer().getFileSystem(), tmpDatafile.getPath(), newDatafile.getPath());\n-\n     if (dfv.getNumEntries() == 0) {\n       tablet.getTabletServer().getFileSystem().deleteRecursively(newDatafile.getPath());", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "0e2fdea5dc19cda2577950ee29ebaadc9423a42b"}, "originalPosition": 9}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "23e56fdb7ca142bd9519c08b404b6d94ecca2659", "author": {"user": {"login": "milleruntime", "name": "Mike Miller"}}, "url": "https://github.com/apache/accumulo/commit/23e56fdb7ca142bd9519c08b404b6d94ecca2659", "committedDate": "2020-03-02T13:18:57Z", "message": "Update server/tserver/src/main/java/org/apache/accumulo/tserver/tablet/DatafileManager.java\n\nCo-Authored-By: Keith Turner <kturner@apache.org>"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzY3MzI3MzU5", "url": "https://github.com/apache/accumulo/pull/1538#pullrequestreview-367327359", "createdAt": "2020-03-02T16:13:47Z", "commit": {"oid": "23e56fdb7ca142bd9519c08b404b6d94ecca2659"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1864, "cost": 1, "resetAt": "2021-10-29T17:30:11Z"}}}