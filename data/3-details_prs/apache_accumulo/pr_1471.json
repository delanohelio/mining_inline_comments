{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0MzYxMDg5ODgz", "number": 1471, "title": "Create TabletFile for use in TabletMetadata. Closes #1396", "bodyText": "Created new TabletFile object as a strong type to replace where\nstrings are used to reference metadata tablet file paths\nDrop parts of code dealing with relative paths\nTabletData only uses TabletFile to create a FileRef for now, follow on\nwork can be done to utilize TabletFile in place of FileRef\nUpdate tests to use absolute paths\nAdd new Translator for TabletFile", "createdAt": "2020-01-09T18:09:15Z", "url": "https://github.com/apache/accumulo/pull/1471", "merged": true, "mergeCommit": {"oid": "d73e3af870d07e48b62d24d968b972378d0a8adc"}, "closed": true, "closedAt": "2020-01-15T14:19:10Z", "author": {"login": "milleruntime"}, "timelineItems": {"totalCount": 8, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABb5EPYbAFqTM0MTM3MjA3NQ==", "endCursor": "Y3Vyc29yOnYyOpPPAAABb6XW8kgH2gAyMzYxMDg5ODgzOmVkMTg2YTMyNzBiYmRiZjczOGFmOGRmODJkNzk3YzEyOGZmM2ZhOTA=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzQxMzcyMDc1", "url": "https://github.com/apache/accumulo/pull/1471#pullrequestreview-341372075", "createdAt": "2020-01-10T19:22:49Z", "commit": {"oid": "78eebbf6dad187348bfcaf71241daf91e0237cd6"}, "state": "COMMENTED", "comments": {"totalCount": 5, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0xMFQxOToyMjo0OVrOFcdx4Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0xMFQxOTo0MzoyMlrOFceTNg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NTM5MjM1Mw==", "bodyText": "Not complete sure, but I think unless a <p> this will not show up as its own paragraph in the rendered javadoc.", "url": "https://github.com/apache/accumulo/pull/1471#discussion_r365392353", "createdAt": "2020-01-10T19:22:49Z", "author": {"login": "keith-turner"}, "path": "core/src/main/java/org/apache/accumulo/core/metadata/schema/TabletFile.java", "diffHunk": "@@ -0,0 +1,128 @@\n+/*\n+ * Licensed to the Apache Software Foundation (ASF) under one\n+ * or more contributor license agreements.  See the NOTICE file\n+ * distributed with this work for additional information\n+ * regarding copyright ownership.  The ASF licenses this file\n+ * to you under the Apache License, Version 2.0 (the\n+ * \"License\"); you may not use this file except in compliance\n+ * with the License.  You may obtain a copy of the License at\n+ *\n+ *   http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing,\n+ * software distributed under the License is distributed on an\n+ * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n+ * KIND, either express or implied.  See the License for the\n+ * specific language governing permissions and limitations\n+ * under the License.\n+ */\n+package org.apache.accumulo.core.metadata.schema;\n+\n+import java.util.Objects;\n+\n+import org.apache.accumulo.core.Constants;\n+import org.apache.accumulo.core.data.TableId;\n+import org.apache.hadoop.fs.Path;\n+import org.apache.hadoop.io.Text;\n+\n+/**\n+ * Object representing a tablet file entry in the metadata table. Keeps a string of the exact entry\n+ * of what is in the metadata table for the column qualifier of the\n+ * {@link org.apache.accumulo.core.metadata.schema.MetadataSchema.TabletsSection.DataFileColumnFamily}\n+ *\n+ * As of 2.1, Tablet file paths should now be only absolute URIs with the removal of relative paths", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "78eebbf6dad187348bfcaf71241daf91e0237cd6"}, "originalPosition": 33}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NTM5NjYxOA==", "bodyText": "Could do the following which avoid calling TabletFileUtil.getVolumeFromFullPath.   This method converts a path to a string internally and then back to a path.  The following code uses the exisitng path object.\n  Path tablePath = Objects.requireNonNull(tableIdPath.getParent(), \"Table\" + errorMsg);\n  Preconditions.checkArgument(tablePath.getName().equals(Constants.HDFS_TABLES_DIR));\n  Path volumePath = Objects.requireNonNull(tablePath.getParent());\nWhen profiling in the past I have seen the Hadoop Path object show up.  So if its easy to avoid creating one, I try to do that.  This code would be used pretty frequently.", "url": "https://github.com/apache/accumulo/pull/1471#discussion_r365396618", "createdAt": "2020-01-10T19:33:09Z", "author": {"login": "keith-turner"}, "path": "core/src/main/java/org/apache/accumulo/core/metadata/schema/TabletFile.java", "diffHunk": "@@ -0,0 +1,128 @@\n+/*\n+ * Licensed to the Apache Software Foundation (ASF) under one\n+ * or more contributor license agreements.  See the NOTICE file\n+ * distributed with this work for additional information\n+ * regarding copyright ownership.  The ASF licenses this file\n+ * to you under the Apache License, Version 2.0 (the\n+ * \"License\"); you may not use this file except in compliance\n+ * with the License.  You may obtain a copy of the License at\n+ *\n+ *   http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing,\n+ * software distributed under the License is distributed on an\n+ * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n+ * KIND, either express or implied.  See the License for the\n+ * specific language governing permissions and limitations\n+ * under the License.\n+ */\n+package org.apache.accumulo.core.metadata.schema;\n+\n+import java.util.Objects;\n+\n+import org.apache.accumulo.core.Constants;\n+import org.apache.accumulo.core.data.TableId;\n+import org.apache.hadoop.fs.Path;\n+import org.apache.hadoop.io.Text;\n+\n+/**\n+ * Object representing a tablet file entry in the metadata table. Keeps a string of the exact entry\n+ * of what is in the metadata table for the column qualifier of the\n+ * {@link org.apache.accumulo.core.metadata.schema.MetadataSchema.TabletsSection.DataFileColumnFamily}\n+ *\n+ * As of 2.1, Tablet file paths should now be only absolute URIs with the removal of relative paths\n+ * in Upgrader9to10.upgradeRelativePaths()\n+ */\n+public class TabletFile implements Comparable<TabletFile> {\n+  // parts of an absolute URI, like \"hdfs://1.2.3.4/accumulo/tables/2a/t-0003/C0004.rf\"\n+  private final String volume; // hdfs://1.2.3.4/accumulo\n+  private final TableId tableId; // 2a\n+  private final String tabletDir; // t-0003\n+  private final String fileName; // C0004.rf\n+  private final String metadataEntry;\n+  private final String normalizedPath; // 2a/t-0003/C0004.rf\n+\n+  public TabletFile(String metadataEntry) {\n+    this.metadataEntry = Objects.requireNonNull(metadataEntry);\n+    String errorMsg = \" is missing from tablet file metadata entry: \" + metadataEntry;\n+\n+    Path metaPath = new Path(metadataEntry);\n+\n+    // use Path object to step backwards from the filename through all the parts\n+    this.fileName = metaPath.getName();\n+    MetadataSchema.TabletsSection.ServerColumnFamily.validateDirCol(fileName);\n+\n+    Path tabletDirPath = Objects.requireNonNull(metaPath.getParent(), \"Tablet dir\" + errorMsg);\n+    this.tabletDir = tabletDirPath.getName();\n+    MetadataSchema.TabletsSection.ServerColumnFamily.validateDirCol(tabletDir);\n+\n+    Path tableIdPath = Objects.requireNonNull(tabletDirPath.getParent(), \"Table ID\" + errorMsg);\n+    this.tableId = TableId.of(tableIdPath.getName());\n+    MetadataSchema.TabletsSection.ServerColumnFamily.validateDirCol(tableId.canonical());\n+\n+    Path volumePath = Objects.requireNonNull(", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "78eebbf6dad187348bfcaf71241daf91e0237cd6"}, "originalPosition": 63}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NTM5ODIyMA==", "bodyText": "Do you know if Hadoop's path object normalizes?", "url": "https://github.com/apache/accumulo/pull/1471#discussion_r365398220", "createdAt": "2020-01-10T19:36:33Z", "author": {"login": "keith-turner"}, "path": "core/src/main/java/org/apache/accumulo/core/metadata/schema/TabletFile.java", "diffHunk": "@@ -0,0 +1,128 @@\n+/*\n+ * Licensed to the Apache Software Foundation (ASF) under one\n+ * or more contributor license agreements.  See the NOTICE file\n+ * distributed with this work for additional information\n+ * regarding copyright ownership.  The ASF licenses this file\n+ * to you under the Apache License, Version 2.0 (the\n+ * \"License\"); you may not use this file except in compliance\n+ * with the License.  You may obtain a copy of the License at\n+ *\n+ *   http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing,\n+ * software distributed under the License is distributed on an\n+ * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n+ * KIND, either express or implied.  See the License for the\n+ * specific language governing permissions and limitations\n+ * under the License.\n+ */\n+package org.apache.accumulo.core.metadata.schema;\n+\n+import java.util.Objects;\n+\n+import org.apache.accumulo.core.Constants;\n+import org.apache.accumulo.core.data.TableId;\n+import org.apache.hadoop.fs.Path;\n+import org.apache.hadoop.io.Text;\n+\n+/**\n+ * Object representing a tablet file entry in the metadata table. Keeps a string of the exact entry\n+ * of what is in the metadata table for the column qualifier of the\n+ * {@link org.apache.accumulo.core.metadata.schema.MetadataSchema.TabletsSection.DataFileColumnFamily}\n+ *\n+ * As of 2.1, Tablet file paths should now be only absolute URIs with the removal of relative paths\n+ * in Upgrader9to10.upgradeRelativePaths()\n+ */\n+public class TabletFile implements Comparable<TabletFile> {\n+  // parts of an absolute URI, like \"hdfs://1.2.3.4/accumulo/tables/2a/t-0003/C0004.rf\"\n+  private final String volume; // hdfs://1.2.3.4/accumulo\n+  private final TableId tableId; // 2a\n+  private final String tabletDir; // t-0003\n+  private final String fileName; // C0004.rf\n+  private final String metadataEntry;\n+  private final String normalizedPath; // 2a/t-0003/C0004.rf\n+\n+  public TabletFile(String metadataEntry) {\n+    this.metadataEntry = Objects.requireNonNull(metadataEntry);\n+    String errorMsg = \" is missing from tablet file metadata entry: \" + metadataEntry;\n+\n+    Path metaPath = new Path(metadataEntry);\n+\n+    // use Path object to step backwards from the filename through all the parts\n+    this.fileName = metaPath.getName();\n+    MetadataSchema.TabletsSection.ServerColumnFamily.validateDirCol(fileName);\n+\n+    Path tabletDirPath = Objects.requireNonNull(metaPath.getParent(), \"Tablet dir\" + errorMsg);\n+    this.tabletDir = tabletDirPath.getName();\n+    MetadataSchema.TabletsSection.ServerColumnFamily.validateDirCol(tabletDir);\n+\n+    Path tableIdPath = Objects.requireNonNull(tabletDirPath.getParent(), \"Table ID\" + errorMsg);\n+    this.tableId = TableId.of(tableIdPath.getName());\n+    MetadataSchema.TabletsSection.ServerColumnFamily.validateDirCol(tableId.canonical());\n+\n+    Path volumePath = Objects.requireNonNull(\n+        TabletFileUtil.getVolumeFromFullPath(metaPath, \"tables\"), \"Volume\" + errorMsg);\n+    this.volume = volumePath.toString();\n+\n+    this.normalizedPath = volume + Constants.HDFS_TABLES_DIR + \"/\" + tableId.canonical() + \"/\"", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "78eebbf6dad187348bfcaf71241daf91e0237cd6"}, "originalPosition": 67}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NTM5OTI4NA==", "bodyText": "Would be nice to also verify normalization.", "url": "https://github.com/apache/accumulo/pull/1471#discussion_r365399284", "createdAt": "2020-01-10T19:39:15Z", "author": {"login": "keith-turner"}, "path": "core/src/test/java/org/apache/accumulo/core/metadata/schema/TabletFileTest.java", "diffHunk": "@@ -0,0 +1,78 @@\n+/*\n+ * Licensed to the Apache Software Foundation (ASF) under one\n+ * or more contributor license agreements.  See the NOTICE file\n+ * distributed with this work for additional information\n+ * regarding copyright ownership.  The ASF licenses this file\n+ * to you under the Apache License, Version 2.0 (the\n+ * \"License\"); you may not use this file except in compliance\n+ * with the License.  You may obtain a copy of the License at\n+ *\n+ *   http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing,\n+ * software distributed under the License is distributed on an\n+ * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n+ * KIND, either express or implied.  See the License for the\n+ * specific language governing permissions and limitations\n+ * under the License.\n+ */\n+package org.apache.accumulo.core.metadata.schema;\n+\n+import static org.junit.Assert.assertEquals;\n+import static org.junit.Assert.fail;\n+\n+import org.apache.accumulo.core.data.TableId;\n+import org.junit.Test;\n+\n+public class TabletFileTest {\n+\n+  private void test(String metadataEntry, TableId tableId, String tabletDir, String fileName) {\n+    TabletFile tabletFile = new TabletFile(metadataEntry);\n+\n+    assertEquals(metadataEntry, tabletFile.getMetadataEntry());\n+    assertEquals(tableId, tabletFile.getTableId());\n+    assertEquals(tabletDir, tabletFile.getTabletDir());\n+    assertEquals(fileName, tabletFile.getFileName());\n+", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "78eebbf6dad187348bfcaf71241daf91e0237cd6"}, "originalPosition": 36}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NTQwMDg4Ng==", "bodyText": "The following are some additional bad paths that would be nice to check.\nhdfs://localhost:8020/accumulo/tablets/2a/default_tablet/F0000070.rf\nhdfs://localhost:8020/accumulo/2a/default_tablet/F0000070.rf\n/accumulo/tables/2a/default_tablet/F0000070.rf\nhdfs://localhost:8020/accumulo/tables/2a/F0000070.rf\nhdfs://localhost:8020/accumulo/tables/F0000070.rf", "url": "https://github.com/apache/accumulo/pull/1471#discussion_r365400886", "createdAt": "2020-01-10T19:43:22Z", "author": {"login": "keith-turner"}, "path": "core/src/test/java/org/apache/accumulo/core/metadata/schema/TabletFileTest.java", "diffHunk": "@@ -0,0 +1,78 @@\n+/*\n+ * Licensed to the Apache Software Foundation (ASF) under one\n+ * or more contributor license agreements.  See the NOTICE file\n+ * distributed with this work for additional information\n+ * regarding copyright ownership.  The ASF licenses this file\n+ * to you under the Apache License, Version 2.0 (the\n+ * \"License\"); you may not use this file except in compliance\n+ * with the License.  You may obtain a copy of the License at\n+ *\n+ *   http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing,\n+ * software distributed under the License is distributed on an\n+ * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n+ * KIND, either express or implied.  See the License for the\n+ * specific language governing permissions and limitations\n+ * under the License.\n+ */\n+package org.apache.accumulo.core.metadata.schema;\n+\n+import static org.junit.Assert.assertEquals;\n+import static org.junit.Assert.fail;\n+\n+import org.apache.accumulo.core.data.TableId;\n+import org.junit.Test;\n+\n+public class TabletFileTest {\n+\n+  private void test(String metadataEntry, TableId tableId, String tabletDir, String fileName) {\n+    TabletFile tabletFile = new TabletFile(metadataEntry);\n+\n+    assertEquals(metadataEntry, tabletFile.getMetadataEntry());\n+    assertEquals(tableId, tabletFile.getTableId());\n+    assertEquals(tabletDir, tabletFile.getTabletDir());\n+    assertEquals(fileName, tabletFile.getFileName());\n+\n+  }\n+\n+  @Test\n+  public void testValidPaths() {\n+    test(\"hdfs://localhost:8020/accumulo/tables/2a/default_tablet/F0000070.rf\", TableId.of(\"2a\"),\n+        \"default_tablet\", \"F0000070.rf\");\n+    test(\"hdfs://nn1:9000/accumulo/tables/5a/t-0005/C0009.rf\", TableId.of(\"5a\"), \"t-0005\",\n+        \"C0009.rf\");\n+  }\n+\n+  @Test\n+  public void testBadPaths() {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "78eebbf6dad187348bfcaf71241daf91e0237cd6"}, "originalPosition": 48}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "9b46d2fed3f8bb2ba2d5097f2404a343fc27ebf1", "author": {"user": {"login": "milleruntime", "name": "Mike Miller"}}, "url": "https://github.com/apache/accumulo/commit/9b46d2fed3f8bb2ba2d5097f2404a343fc27ebf1", "committedDate": "2020-01-14T18:35:40Z", "message": "Created TabletFile for use in TabletMetadata\n\n* Created new TabletFile object as a strong type to replace where\nstrings are used to reference metadata tablet file paths\n* Drop parts of code dealing with relative paths\n* TabletData only uses TabletFile to create a FileRef for now, follow on\nwork can be done to utilize TabletFile in place of FileRef\n* Update tests to use absolute paths\n* Add new Translator for TabletFile"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b0952d924ddad50b637721f561e5b1e3f7e04068", "author": {"user": {"login": "milleruntime", "name": "Mike Miller"}}, "url": "https://github.com/apache/accumulo/commit/b0952d924ddad50b637721f561e5b1e3f7e04068", "committedDate": "2020-01-14T18:35:40Z", "message": "Fixes to volume and updates to test"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f51d1cb8ddec323fafac5b8787a6f9c269b04b1c", "author": {"user": {"login": "milleruntime", "name": "Mike Miller"}}, "url": "https://github.com/apache/accumulo/commit/f51d1cb8ddec323fafac5b8787a6f9c269b04b1c", "committedDate": "2020-01-14T19:42:47Z", "message": "Fix for rebase"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "a6679eced7f97eb7ae3d528b6a06ae503177f3a8", "author": {"user": {"login": "milleruntime", "name": "Mike Miller"}}, "url": "https://github.com/apache/accumulo/commit/a6679eced7f97eb7ae3d528b6a06ae503177f3a8", "committedDate": "2020-01-14T15:53:30Z", "message": "Fixes to volume and updates to test"}, "afterCommit": {"oid": "f51d1cb8ddec323fafac5b8787a6f9c269b04b1c", "author": {"user": {"login": "milleruntime", "name": "Mike Miller"}}, "url": "https://github.com/apache/accumulo/commit/f51d1cb8ddec323fafac5b8787a6f9c269b04b1c", "committedDate": "2020-01-14T19:42:47Z", "message": "Fix for rebase"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzQyNzk0MjUy", "url": "https://github.com/apache/accumulo/pull/1471#pullrequestreview-342794252", "createdAt": "2020-01-14T19:47:16Z", "commit": {"oid": "f51d1cb8ddec323fafac5b8787a6f9c269b04b1c"}, "state": "APPROVED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0xNFQxOTo0NzoxNlrOFdjvIg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0xNFQxOTo0NzoxNlrOFdjvIg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NjUzODUzMA==", "bodyText": "There is a lot of string concatenation (which causes object allocation) for error messages that will usually never be seen in this method.", "url": "https://github.com/apache/accumulo/pull/1471#discussion_r366538530", "createdAt": "2020-01-14T19:47:16Z", "author": {"login": "keith-turner"}, "path": "core/src/main/java/org/apache/accumulo/core/metadata/schema/TabletFile.java", "diffHunk": "@@ -0,0 +1,136 @@\n+/*\n+ * Licensed to the Apache Software Foundation (ASF) under one\n+ * or more contributor license agreements.  See the NOTICE file\n+ * distributed with this work for additional information\n+ * regarding copyright ownership.  The ASF licenses this file\n+ * to you under the Apache License, Version 2.0 (the\n+ * \"License\"); you may not use this file except in compliance\n+ * with the License.  You may obtain a copy of the License at\n+ *\n+ *   http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing,\n+ * software distributed under the License is distributed on an\n+ * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n+ * KIND, either express or implied.  See the License for the\n+ * specific language governing permissions and limitations\n+ * under the License.\n+ */\n+package org.apache.accumulo.core.metadata.schema;\n+\n+import java.util.Objects;\n+\n+import org.apache.accumulo.core.Constants;\n+import org.apache.accumulo.core.data.TableId;\n+import org.apache.hadoop.fs.Path;\n+import org.apache.hadoop.io.Text;\n+\n+import com.google.common.base.Preconditions;\n+\n+/**\n+ * Object representing a tablet file entry in the metadata table. Keeps a string of the exact entry\n+ * of what is in the metadata table for the column qualifier of the\n+ * {@link org.apache.accumulo.core.metadata.schema.MetadataSchema.TabletsSection.DataFileColumnFamily}\n+ * <p>\n+ * As of 2.1, Tablet file paths should now be only absolute URIs with the removal of relative paths\n+ * in Upgrader9to10.upgradeRelativePaths()\n+ */\n+public class TabletFile implements Comparable<TabletFile> {\n+  // parts of an absolute URI, like \"hdfs://1.2.3.4/accumulo/tables/2a/t-0003/C0004.rf\"\n+  private final String volume; // hdfs://1.2.3.4/accumulo\n+  private final TableId tableId; // 2a\n+  private final String tabletDir; // t-0003\n+  private final String fileName; // C0004.rf\n+  private final String metadataEntry;\n+  private final Path metaPath;\n+  private final String normalizedPath;\n+\n+  public TabletFile(String metadataEntry) {\n+    this.metadataEntry = Objects.requireNonNull(metadataEntry);\n+    String errorMsg = \" is missing/invalid from tablet file metadata entry: \" + metadataEntry;\n+\n+    this.metaPath = new Path(metadataEntry);\n+\n+    // use Path object to step backwards from the filename through all the parts\n+    this.fileName = metaPath.getName();\n+    MetadataSchema.TabletsSection.ServerColumnFamily.validateDirCol(fileName);\n+\n+    Path tabletDirPath = Objects.requireNonNull(metaPath.getParent(), \"Tablet dir\" + errorMsg);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f51d1cb8ddec323fafac5b8787a6f9c269b04b1c"}, "originalPosition": 58}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzQyNzk5MTQ2", "url": "https://github.com/apache/accumulo/pull/1471#pullrequestreview-342799146", "createdAt": "2020-01-14T19:55:30Z", "commit": {"oid": "f51d1cb8ddec323fafac5b8787a6f9c269b04b1c"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0xNFQxOTo1NTozMFrOFdj9iQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0xNFQxOTo1NTozMFrOFdj9iQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NjU0MjIxNw==", "bodyText": "Would also be nice to verify that TabletFile.equals and TabletFile.hashCode work as expected for normalized paths.", "url": "https://github.com/apache/accumulo/pull/1471#discussion_r366542217", "createdAt": "2020-01-14T19:55:30Z", "author": {"login": "keith-turner"}, "path": "core/src/test/java/org/apache/accumulo/core/metadata/schema/TabletFileTest.java", "diffHunk": "@@ -0,0 +1,104 @@\n+/*\n+ * Licensed to the Apache Software Foundation (ASF) under one\n+ * or more contributor license agreements.  See the NOTICE file\n+ * distributed with this work for additional information\n+ * regarding copyright ownership.  The ASF licenses this file\n+ * to you under the Apache License, Version 2.0 (the\n+ * \"License\"); you may not use this file except in compliance\n+ * with the License.  You may obtain a copy of the License at\n+ *\n+ *   http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing,\n+ * software distributed under the License is distributed on an\n+ * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n+ * KIND, either express or implied.  See the License for the\n+ * specific language governing permissions and limitations\n+ * under the License.\n+ */\n+package org.apache.accumulo.core.metadata.schema;\n+\n+import static org.junit.Assert.assertEquals;\n+import static org.junit.Assert.fail;\n+\n+import org.apache.accumulo.core.data.TableId;\n+import org.junit.Test;\n+\n+public class TabletFileTest {\n+\n+  private void test(String metadataEntry, String volume, String tableId, String tabletDir,\n+      String fileName) {\n+    TabletFile tabletFile = new TabletFile(metadataEntry);\n+\n+    assertEquals(volume, tabletFile.getVolume());\n+    assertEquals(metadataEntry, tabletFile.getMetadataEntry());\n+    assertEquals(TableId.of(tableId), tabletFile.getTableId());\n+    assertEquals(tabletDir, tabletFile.getTabletDir());\n+    assertEquals(fileName, tabletFile.getFileName());\n+  }\n+\n+  @Test\n+  public void testValidPaths() {\n+    test(\"hdfs://localhost:8020/accumulo/tables/2a/default_tablet/F0000070.rf\",\n+        \"hdfs://localhost:8020/accumulo\", \"2a\", \"default_tablet\", \"F0000070.rf\");\n+    test(\"hdfs://nn1:9000/accumulo/tables/5a/t-0005/C0009.rf\", \"hdfs://nn1:9000/accumulo\", \"5a\",\n+        \"t-0005\", \"C0009.rf\");\n+    test(\n+        \"file:/home/dude/workspace/accumulo/test/target/mini-tests/org.apache.accumulo.test.VolumeIT_test/volumes/v1/tables/1/t-0000003/F0000006.rf\",\n+        \"file:/home/dude/workspace/accumulo/test/target/mini-tests/org.apache.accumulo.test.VolumeIT_test/volumes/v1\",\n+        \"1\", \"t-0000003\", \"F0000006.rf\");\n+  }\n+\n+  @Test\n+  public void testBadPaths() {\n+    try {\n+      test(\"C0004.rf\", \"\", \"2a\", \"t-0003\", \"C0004.rf\");\n+      fail(\"Failed to throw error on bad path\");\n+    } catch (NullPointerException e) {}\n+    // 2a< srv:dir\n+    try {\n+      test(\"dir\", \"\", \"2a\", \"\", \"\");\n+      fail(\"Failed to throw error on bad path\");\n+    } catch (NullPointerException e) {}\n+    try {\n+      test(\"hdfs://localhost:8020/accumulo/tablets/2a/default_tablet/F0000070.rf\",\n+          \"hdfs://localhost:8020/accumulo\", \"2a\", \"default_tablet\", \"F0000070.rf\");\n+      fail(\"Failed to throw error on bad path\");\n+    } catch (IllegalArgumentException e) {}\n+    try {\n+      test(\"hdfs://localhost:8020/accumulo/2a/default_tablet/F0000070.rf\",\n+          \" hdfs://localhost:8020/accumulo\", \"2a\", \"default_tablet\", \" F0000070.rf\");\n+    } catch (IllegalArgumentException e) {}\n+    try {\n+      test(\"/accumulo/tables/2a/default_tablet/F0000070.rf\", \"\", \"2a\", \"default_tablet\",\n+          \"F0000070.rf\");\n+    } catch (IllegalArgumentException e) {}\n+    try {\n+      test(\"hdfs://localhost:8020/accumulo/tables/2a/F0000070.rf\", \"hdfs://localhost:8020/accumulo\",\n+          \"2a\", \"\", \"F0000070.rf\");\n+    } catch (IllegalArgumentException e) {}\n+    try {\n+      test(\"hdfs://localhost:8020/accumulo/tables/F0000070.rf\", \"hdfs://localhost:8020/accumulo\",\n+          null, \"\", \"F0000070.rf\");\n+    } catch (IllegalArgumentException e) {}\n+  }\n+\n+  private final String id = \"2a\";\n+  private final String dir = \"t-0003\";\n+  private final String filename = \"C0004.rf\";\n+\n+  @Test\n+  public void testFullPathWithVolume() {\n+    String volume = \"hdfs://1.2.3.4/accumulo\";\n+    String metadataEntry = volume + \"/tables/\" + id + \"/\" + dir + \"/\" + filename;\n+    test(metadataEntry, volume, id, dir, filename);\n+  }\n+\n+  @Test\n+  public void testNormalizePath() {\n+    String uglyVolume = \"hdfs://nn.somewhere.com:86753/accumulo/blah/.././/bad/bad2/../.././/////\";\n+    String metadataEntry = uglyVolume + \"/tables/\" + id + \"/\" + dir + \"/\" + filename;\n+    test(metadataEntry, \"hdfs://nn.somewhere.com:86753/accumulo\", id, dir, filename);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f51d1cb8ddec323fafac5b8787a6f9c269b04b1c"}, "originalPosition": 101}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ed186a3270bbdbf738af8df82d797c128ff3fa90", "author": {"user": {"login": "milleruntime", "name": "Mike Miller"}}, "url": "https://github.com/apache/accumulo/commit/ed186a3270bbdbf738af8df82d797c128ff3fa90", "committedDate": "2020-01-14T20:55:25Z", "message": "More fixes to TabletFile and test"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1995, "cost": 1, "resetAt": "2021-10-29T17:30:11Z"}}}