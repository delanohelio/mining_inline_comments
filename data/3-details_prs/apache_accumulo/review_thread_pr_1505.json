{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0MzczNzg3Mjcw", "number": 1505, "reviewThreads": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xMVQxODowMTo0OFrODe57iA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xMVQxODo1NToxMlrODe6_Jw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjMzNzMzMDAwOnYy", "diffSide": "LEFT", "path": "server/base/src/main/java/org/apache/accumulo/server/fs/VolumeUtil.java", "isResolved": true, "comments": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xMVQxODowMTo0OFrOFoTSng==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xMVQxODo1NToxOVrOFoVB0g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NzgwMzQyMg==", "bodyText": "Would it make more sense to keep the replacements assignment in this method, but short-circuit the method with a if (replacements.isEmpty()) { return; } line?\nIt seems like this is a smaller change and would keep the logic all together that handles the updates, rather than place the special case of no replacements outside the method.", "url": "https://github.com/apache/accumulo/pull/1505#discussion_r377803422", "createdAt": "2020-02-11T18:01:48Z", "author": {"login": "ctubbsii"}, "path": "server/base/src/main/java/org/apache/accumulo/server/fs/VolumeUtil.java", "diffHunk": "@@ -184,9 +184,8 @@ public static String switchRootTableVolume(String location) throws IOException {\n    * for use it chooses a new tablet directory.\n    */\n   public static TabletFiles updateTabletVolumes(AccumuloServerContext context, ZooLock zooLock,\n-      VolumeManager vm, KeyExtent extent, TabletFiles tabletFiles, boolean replicate)\n-      throws IOException {\n-    List<Pair<Path,Path>> replacements = ServerConstants.getVolumeReplacements();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "29bdb7024a2ca48a43828b26e2e0c5e28ef21c4e"}, "originalPosition": 6}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NzgzMDAzMQ==", "bodyText": "Well we wouldn't be able to just return because the return value would wipe out the files and logs kept in tabletPaths.  But since that object gets passed I think we could just return it.", "url": "https://github.com/apache/accumulo/pull/1505#discussion_r377830031", "createdAt": "2020-02-11T18:51:58Z", "author": {"login": "milleruntime"}, "path": "server/base/src/main/java/org/apache/accumulo/server/fs/VolumeUtil.java", "diffHunk": "@@ -184,9 +184,8 @@ public static String switchRootTableVolume(String location) throws IOException {\n    * for use it chooses a new tablet directory.\n    */\n   public static TabletFiles updateTabletVolumes(AccumuloServerContext context, ZooLock zooLock,\n-      VolumeManager vm, KeyExtent extent, TabletFiles tabletFiles, boolean replicate)\n-      throws IOException {\n-    List<Pair<Path,Path>> replacements = ServerConstants.getVolumeReplacements();", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NzgwMzQyMg=="}, "originalCommit": {"oid": "29bdb7024a2ca48a43828b26e2e0c5e28ef21c4e"}, "originalPosition": 6}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NzgzMTczNw==", "bodyText": "+1", "url": "https://github.com/apache/accumulo/pull/1505#discussion_r377831737", "createdAt": "2020-02-11T18:55:04Z", "author": {"login": "ivakegg"}, "path": "server/base/src/main/java/org/apache/accumulo/server/fs/VolumeUtil.java", "diffHunk": "@@ -184,9 +184,8 @@ public static String switchRootTableVolume(String location) throws IOException {\n    * for use it chooses a new tablet directory.\n    */\n   public static TabletFiles updateTabletVolumes(AccumuloServerContext context, ZooLock zooLock,\n-      VolumeManager vm, KeyExtent extent, TabletFiles tabletFiles, boolean replicate)\n-      throws IOException {\n-    List<Pair<Path,Path>> replacements = ServerConstants.getVolumeReplacements();", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NzgwMzQyMg=="}, "originalCommit": {"oid": "29bdb7024a2ca48a43828b26e2e0c5e28ef21c4e"}, "originalPosition": 6}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NzgzMTg5MA==", "bodyText": "Oh, right. I didn't see there was a return value.", "url": "https://github.com/apache/accumulo/pull/1505#discussion_r377831890", "createdAt": "2020-02-11T18:55:19Z", "author": {"login": "ctubbsii"}, "path": "server/base/src/main/java/org/apache/accumulo/server/fs/VolumeUtil.java", "diffHunk": "@@ -184,9 +184,8 @@ public static String switchRootTableVolume(String location) throws IOException {\n    * for use it chooses a new tablet directory.\n    */\n   public static TabletFiles updateTabletVolumes(AccumuloServerContext context, ZooLock zooLock,\n-      VolumeManager vm, KeyExtent extent, TabletFiles tabletFiles, boolean replicate)\n-      throws IOException {\n-    List<Pair<Path,Path>> replacements = ServerConstants.getVolumeReplacements();", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NzgwMzQyMg=="}, "originalCommit": {"oid": "29bdb7024a2ca48a43828b26e2e0c5e28ef21c4e"}, "originalPosition": 6}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjMzNzUwMzExOnYy", "diffSide": "RIGHT", "path": "server/base/src/main/java/org/apache/accumulo/server/fs/VolumeUtil.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xMVQxODo1NToxMlrOFoVBhA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xMVQxOTowMDowM1rOFoVMRw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NzgzMTgxMg==", "bodyText": "Should the log statement be using parameter substitution?\nlog.trace(\"Using volume replacements: {}\" + replacements);", "url": "https://github.com/apache/accumulo/pull/1505#discussion_r377831812", "createdAt": "2020-02-11T18:55:12Z", "author": {"login": "EdColeman"}, "path": "server/base/src/main/java/org/apache/accumulo/server/fs/VolumeUtil.java", "diffHunk": "@@ -184,9 +184,8 @@ public static String switchRootTableVolume(String location) throws IOException {\n    * for use it chooses a new tablet directory.\n    */\n   public static TabletFiles updateTabletVolumes(AccumuloServerContext context, ZooLock zooLock,\n-      VolumeManager vm, KeyExtent extent, TabletFiles tabletFiles, boolean replicate)\n-      throws IOException {\n-    List<Pair<Path,Path>> replacements = ServerConstants.getVolumeReplacements();\n+      VolumeManager vm, KeyExtent extent, TabletFiles tabletFiles, boolean replicate,\n+      List<Pair<Path,Path>> replacements) throws IOException {\n     log.trace(\"Using volume replacements: \" + replacements);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "29bdb7024a2ca48a43828b26e2e0c5e28ef21c4e"}, "originalPosition": 9}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NzgzNDU2Nw==", "bodyText": "Yeah but I was avoiding making unrelated changes to keep the change to a minimum.", "url": "https://github.com/apache/accumulo/pull/1505#discussion_r377834567", "createdAt": "2020-02-11T19:00:03Z", "author": {"login": "milleruntime"}, "path": "server/base/src/main/java/org/apache/accumulo/server/fs/VolumeUtil.java", "diffHunk": "@@ -184,9 +184,8 @@ public static String switchRootTableVolume(String location) throws IOException {\n    * for use it chooses a new tablet directory.\n    */\n   public static TabletFiles updateTabletVolumes(AccumuloServerContext context, ZooLock zooLock,\n-      VolumeManager vm, KeyExtent extent, TabletFiles tabletFiles, boolean replicate)\n-      throws IOException {\n-    List<Pair<Path,Path>> replacements = ServerConstants.getVolumeReplacements();\n+      VolumeManager vm, KeyExtent extent, TabletFiles tabletFiles, boolean replicate,\n+      List<Pair<Path,Path>> replacements) throws IOException {\n     log.trace(\"Using volume replacements: \" + replacements);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NzgzMTgxMg=="}, "originalCommit": {"oid": "29bdb7024a2ca48a43828b26e2e0c5e28ef21c4e"}, "originalPosition": 9}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4149, "cost": 1, "resetAt": "2021-11-12T09:44:50Z"}}}