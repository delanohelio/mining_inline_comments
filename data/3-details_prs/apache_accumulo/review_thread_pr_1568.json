{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0MzkxODAzMDk5", "number": 1568, "reviewThreads": {"totalCount": 7, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yNVQxNTowMDozNFrODrQQxg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yNVQxODoyMjo0N1rODrV6pA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjQ2NjgxNzk4OnYy", "diffSide": "RIGHT", "path": "assemble/bin/accumulo-cluster", "isResolved": true, "comments": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yNVQxNTowMDozNFrOF7fV-A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yN1QyMjoxNTowOFrOF9DW0A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NzkyMzgzMg==", "bodyText": "Not sure the following will work, the thought is to make running on localhost and remote consistent.  Both ensuring the env var is not set when running the script.\n\n  \n    \n  \n    \n\n  \n  This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters. Learn more about bidirectional Unicode characters\n\n\n  \n\n\n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                service_instance_cmd=\n          \n          \n            \n                service_instance_cmd=\"export ACCUMULO_SERVICE_INSTANCE=;\"", "url": "https://github.com/apache/accumulo/pull/1568#discussion_r397923832", "createdAt": "2020-03-25T15:00:34Z", "author": {"login": "keith-turner"}, "path": "assemble/bin/accumulo-cluster", "diffHunk": "@@ -100,15 +100,45 @@ function get_ip() {\n   echo \"$ip_addr\"\n }\n \n+function set_last_instance_id() {\n+  if [[ \"$service\" == \"tserver\" ]]; then\n+    last_instance_id=${NUM_TSERVERS:-1}\n+  else\n+    last_instance_id=1\n+  fi\n+}\n+\n+function set_service_instance_if_needed() {\n+  if [[ \"$service\" == \"tserver\" && ${NUM_TSERVERS:-1} > 1 ]]; then\n+    export ACCUMULO_SERVICE_INSTANCE=$inst_id\n+    service_instance_cmd=\"export ACCUMULO_SERVICE_INSTANCE=${inst_id};\"\n+  else\n+    export ACCUMULO_SERVICE_INSTANCE=\n+    service_instance_cmd=", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "4ff3ae3892f10f434433f878fe66f7122ab98a46"}, "originalPosition": 18}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5ODExMzE0MA==", "bodyText": "Will consider and implement. Thanks!", "url": "https://github.com/apache/accumulo/pull/1568#discussion_r398113140", "createdAt": "2020-03-25T19:26:00Z", "author": {"login": "arvindshmicrosoft"}, "path": "assemble/bin/accumulo-cluster", "diffHunk": "@@ -100,15 +100,45 @@ function get_ip() {\n   echo \"$ip_addr\"\n }\n \n+function set_last_instance_id() {\n+  if [[ \"$service\" == \"tserver\" ]]; then\n+    last_instance_id=${NUM_TSERVERS:-1}\n+  else\n+    last_instance_id=1\n+  fi\n+}\n+\n+function set_service_instance_if_needed() {\n+  if [[ \"$service\" == \"tserver\" && ${NUM_TSERVERS:-1} > 1 ]]; then\n+    export ACCUMULO_SERVICE_INSTANCE=$inst_id\n+    service_instance_cmd=\"export ACCUMULO_SERVICE_INSTANCE=${inst_id};\"\n+  else\n+    export ACCUMULO_SERVICE_INSTANCE=\n+    service_instance_cmd=", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NzkyMzgzMg=="}, "originalCommit": {"oid": "4ff3ae3892f10f434433f878fe66f7122ab98a46"}, "originalPosition": 18}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5OTA3NjM4MQ==", "bodyText": "Thanks Keith. With the suggestions that Christopher made, this has been handled in a different way now. Please take a look.", "url": "https://github.com/apache/accumulo/pull/1568#discussion_r399076381", "createdAt": "2020-03-27T07:24:26Z", "author": {"login": "arvindshmicrosoft"}, "path": "assemble/bin/accumulo-cluster", "diffHunk": "@@ -100,15 +100,45 @@ function get_ip() {\n   echo \"$ip_addr\"\n }\n \n+function set_last_instance_id() {\n+  if [[ \"$service\" == \"tserver\" ]]; then\n+    last_instance_id=${NUM_TSERVERS:-1}\n+  else\n+    last_instance_id=1\n+  fi\n+}\n+\n+function set_service_instance_if_needed() {\n+  if [[ \"$service\" == \"tserver\" && ${NUM_TSERVERS:-1} > 1 ]]; then\n+    export ACCUMULO_SERVICE_INSTANCE=$inst_id\n+    service_instance_cmd=\"export ACCUMULO_SERVICE_INSTANCE=${inst_id};\"\n+  else\n+    export ACCUMULO_SERVICE_INSTANCE=\n+    service_instance_cmd=", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NzkyMzgzMg=="}, "originalCommit": {"oid": "4ff3ae3892f10f434433f878fe66f7122ab98a46"}, "originalPosition": 18}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5OTU2MjQ0OA==", "bodyText": "Those changes look good and consistent.", "url": "https://github.com/apache/accumulo/pull/1568#discussion_r399562448", "createdAt": "2020-03-27T22:15:08Z", "author": {"login": "keith-turner"}, "path": "assemble/bin/accumulo-cluster", "diffHunk": "@@ -100,15 +100,45 @@ function get_ip() {\n   echo \"$ip_addr\"\n }\n \n+function set_last_instance_id() {\n+  if [[ \"$service\" == \"tserver\" ]]; then\n+    last_instance_id=${NUM_TSERVERS:-1}\n+  else\n+    last_instance_id=1\n+  fi\n+}\n+\n+function set_service_instance_if_needed() {\n+  if [[ \"$service\" == \"tserver\" && ${NUM_TSERVERS:-1} > 1 ]]; then\n+    export ACCUMULO_SERVICE_INSTANCE=$inst_id\n+    service_instance_cmd=\"export ACCUMULO_SERVICE_INSTANCE=${inst_id};\"\n+  else\n+    export ACCUMULO_SERVICE_INSTANCE=\n+    service_instance_cmd=", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NzkyMzgzMg=="}, "originalCommit": {"oid": "4ff3ae3892f10f434433f878fe66f7122ab98a46"}, "originalPosition": 18}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjQ2NzY0MzM3OnYy", "diffSide": "RIGHT", "path": "assemble/bin/accumulo-cluster", "isResolved": true, "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yNVQxNzo1Nzo0MVrOF7nizg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yNVQxOTo0MDo1NlrOF7rZ6w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5ODA1ODE5MA==", "bodyText": "This mixes double equals and single equals. Both are equivalent in bash double-square braces, so it's fine either way, but it'd be nice to be consistent.", "url": "https://github.com/apache/accumulo/pull/1568#discussion_r398058190", "createdAt": "2020-03-25T17:57:41Z", "author": {"login": "ctubbsii"}, "path": "assemble/bin/accumulo-cluster", "diffHunk": "@@ -100,15 +100,45 @@ function get_ip() {\n   echo \"$ip_addr\"\n }\n \n+function set_last_instance_id() {\n+  if [[ \"$service\" == \"tserver\" ]]; then\n+    last_instance_id=${NUM_TSERVERS:-1}\n+  else\n+    last_instance_id=1\n+  fi\n+}\n+\n+function set_service_instance_if_needed() {\n+  if [[ \"$service\" == \"tserver\" && ${NUM_TSERVERS:-1} > 1 ]]; then\n+    export ACCUMULO_SERVICE_INSTANCE=$inst_id\n+    service_instance_cmd=\"export ACCUMULO_SERVICE_INSTANCE=${inst_id};\"\n+  else\n+    export ACCUMULO_SERVICE_INSTANCE=\n+    service_instance_cmd=\n+  fi\n+}\n+\n+function control_service() {\n+  set_last_instance_id\n+\n+  for (( inst_id=1; inst_id<=last_instance_id; inst_id++ ))\n+  do\n+    set_service_instance_if_needed\n+\n+    if [[ $host == localhost || $host = \"$(hostname -s)\" || $host = \"$(hostname -f)\" || $host = $(get_ip) ]] ; then", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "4ff3ae3892f10f434433f878fe66f7122ab98a46"}, "originalPosition": 29}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5ODExMzUzOQ==", "bodyText": "Cool! Since this was existing code, I did not pay attention. I will address it.", "url": "https://github.com/apache/accumulo/pull/1568#discussion_r398113539", "createdAt": "2020-03-25T19:26:44Z", "author": {"login": "arvindshmicrosoft"}, "path": "assemble/bin/accumulo-cluster", "diffHunk": "@@ -100,15 +100,45 @@ function get_ip() {\n   echo \"$ip_addr\"\n }\n \n+function set_last_instance_id() {\n+  if [[ \"$service\" == \"tserver\" ]]; then\n+    last_instance_id=${NUM_TSERVERS:-1}\n+  else\n+    last_instance_id=1\n+  fi\n+}\n+\n+function set_service_instance_if_needed() {\n+  if [[ \"$service\" == \"tserver\" && ${NUM_TSERVERS:-1} > 1 ]]; then\n+    export ACCUMULO_SERVICE_INSTANCE=$inst_id\n+    service_instance_cmd=\"export ACCUMULO_SERVICE_INSTANCE=${inst_id};\"\n+  else\n+    export ACCUMULO_SERVICE_INSTANCE=\n+    service_instance_cmd=\n+  fi\n+}\n+\n+function control_service() {\n+  set_last_instance_id\n+\n+  for (( inst_id=1; inst_id<=last_instance_id; inst_id++ ))\n+  do\n+    set_service_instance_if_needed\n+\n+    if [[ $host == localhost || $host = \"$(hostname -s)\" || $host = \"$(hostname -f)\" || $host = $(get_ip) ]] ; then", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5ODA1ODE5MA=="}, "originalCommit": {"oid": "4ff3ae3892f10f434433f878fe66f7122ab98a46"}, "originalPosition": 29}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5ODEyMTQ1MQ==", "bodyText": "I didn't notice it was existing code. It's fine if you want to leave it. It's entirely up to you.", "url": "https://github.com/apache/accumulo/pull/1568#discussion_r398121451", "createdAt": "2020-03-25T19:40:56Z", "author": {"login": "ctubbsii"}, "path": "assemble/bin/accumulo-cluster", "diffHunk": "@@ -100,15 +100,45 @@ function get_ip() {\n   echo \"$ip_addr\"\n }\n \n+function set_last_instance_id() {\n+  if [[ \"$service\" == \"tserver\" ]]; then\n+    last_instance_id=${NUM_TSERVERS:-1}\n+  else\n+    last_instance_id=1\n+  fi\n+}\n+\n+function set_service_instance_if_needed() {\n+  if [[ \"$service\" == \"tserver\" && ${NUM_TSERVERS:-1} > 1 ]]; then\n+    export ACCUMULO_SERVICE_INSTANCE=$inst_id\n+    service_instance_cmd=\"export ACCUMULO_SERVICE_INSTANCE=${inst_id};\"\n+  else\n+    export ACCUMULO_SERVICE_INSTANCE=\n+    service_instance_cmd=\n+  fi\n+}\n+\n+function control_service() {\n+  set_last_instance_id\n+\n+  for (( inst_id=1; inst_id<=last_instance_id; inst_id++ ))\n+  do\n+    set_service_instance_if_needed\n+\n+    if [[ $host == localhost || $host = \"$(hostname -s)\" || $host = \"$(hostname -f)\" || $host = $(get_ip) ]] ; then", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5ODA1ODE5MA=="}, "originalCommit": {"oid": "4ff3ae3892f10f434433f878fe66f7122ab98a46"}, "originalPosition": 29}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjQ2NzcxMzUyOnYy", "diffSide": "RIGHT", "path": "assemble/bin/accumulo-cluster", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yNVQxODoxNToxMVrOF7oQSw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yNVQxODoxNToxMVrOF7oQSw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5ODA2OTgzNQ==", "bodyText": "Could use a simple local variable here.\n\n  \n    \n  \n    \n\n  \n  This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters. Learn more about bidirectional Unicode characters\n\n\n  \n\n\n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n              set_last_instance_id\n          \n          \n            \n              local last_instance_id; last_instance_id=1\n          \n          \n            \n              [[ \"$service\" = \"tserver\" ]] && last_instance_id=${NUM_TSERVERS:-1}", "url": "https://github.com/apache/accumulo/pull/1568#discussion_r398069835", "createdAt": "2020-03-25T18:15:11Z", "author": {"login": "ctubbsii"}, "path": "assemble/bin/accumulo-cluster", "diffHunk": "@@ -100,15 +100,45 @@ function get_ip() {\n   echo \"$ip_addr\"\n }\n \n+function set_last_instance_id() {\n+  if [[ \"$service\" == \"tserver\" ]]; then\n+    last_instance_id=${NUM_TSERVERS:-1}\n+  else\n+    last_instance_id=1\n+  fi\n+}\n+\n+function set_service_instance_if_needed() {\n+  if [[ \"$service\" == \"tserver\" && ${NUM_TSERVERS:-1} > 1 ]]; then\n+    export ACCUMULO_SERVICE_INSTANCE=$inst_id\n+    service_instance_cmd=\"export ACCUMULO_SERVICE_INSTANCE=${inst_id};\"\n+  else\n+    export ACCUMULO_SERVICE_INSTANCE=\n+    service_instance_cmd=\n+  fi\n+}\n+\n+function control_service() {\n+  set_last_instance_id", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "4ff3ae3892f10f434433f878fe66f7122ab98a46"}, "originalPosition": 23}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjQ2NzcxODA3OnYy", "diffSide": "RIGHT", "path": "assemble/bin/accumulo-cluster", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yNVQxODoxNjoxN1rOF7oTLQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yNVQxODoxNjoxN1rOF7oTLQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5ODA3MDU3Mw==", "bodyText": "This can be inline'd. It's only used once, and doesn't do much.\n\n  \n    \n  \n    \n\n  \n  This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters. Learn more about bidirectional Unicode characters\n\n\n  \n\n\n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            \n          \n          \n            \n            function set_last_instance_id() {\n          \n          \n            \n              if [[ \"$service\" == \"tserver\" ]]; then\n          \n          \n            \n                last_instance_id=${NUM_TSERVERS:-1}\n          \n          \n            \n              else\n          \n          \n            \n                last_instance_id=1\n          \n          \n            \n              fi\n          \n          \n            \n            }", "url": "https://github.com/apache/accumulo/pull/1568#discussion_r398070573", "createdAt": "2020-03-25T18:16:17Z", "author": {"login": "ctubbsii"}, "path": "assemble/bin/accumulo-cluster", "diffHunk": "@@ -100,15 +100,45 @@ function get_ip() {\n   echo \"$ip_addr\"\n }\n \n+function set_last_instance_id() {\n+  if [[ \"$service\" == \"tserver\" ]]; then\n+    last_instance_id=${NUM_TSERVERS:-1}\n+  else\n+    last_instance_id=1\n+  fi\n+}\n+", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "4ff3ae3892f10f434433f878fe66f7122ab98a46"}, "originalPosition": 11}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjQ2NzcyMTcwOnYy", "diffSide": "RIGHT", "path": "assemble/bin/accumulo-cluster", "isResolved": true, "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yNVQxODoxNzoxM1rOF7oVmw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yNVQxOTozOTo1MFrOF7rXfg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5ODA3MTE5NQ==", "bodyText": "Should use numeric greater-than comparison here, instead of ASCII lexical comparison:\n\n  \n    \n  \n    \n\n  \n  This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters. Learn more about bidirectional Unicode characters\n\n\n  \n\n\n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n              if [[ \"$service\" == \"tserver\" && ${NUM_TSERVERS:-1} > 1 ]]; then\n          \n          \n            \n              if [[ \"$service\" == \"tserver\" && ${NUM_TSERVERS:-1} -gt 1 ]]; then", "url": "https://github.com/apache/accumulo/pull/1568#discussion_r398071195", "createdAt": "2020-03-25T18:17:13Z", "author": {"login": "ctubbsii"}, "path": "assemble/bin/accumulo-cluster", "diffHunk": "@@ -100,15 +100,45 @@ function get_ip() {\n   echo \"$ip_addr\"\n }\n \n+function set_last_instance_id() {\n+  if [[ \"$service\" == \"tserver\" ]]; then\n+    last_instance_id=${NUM_TSERVERS:-1}\n+  else\n+    last_instance_id=1\n+  fi\n+}\n+\n+function set_service_instance_if_needed() {\n+  if [[ \"$service\" == \"tserver\" && ${NUM_TSERVERS:-1} > 1 ]]; then", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "4ff3ae3892f10f434433f878fe66f7122ab98a46"}, "originalPosition": 13}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5ODExMzk0OA==", "bodyText": "Thanks. I had run shellcheck initially but forgot to run it before pushing this round of updates. Indeed that caught this issue as well. I'll make sure I fix it.", "url": "https://github.com/apache/accumulo/pull/1568#discussion_r398113948", "createdAt": "2020-03-25T19:27:29Z", "author": {"login": "arvindshmicrosoft"}, "path": "assemble/bin/accumulo-cluster", "diffHunk": "@@ -100,15 +100,45 @@ function get_ip() {\n   echo \"$ip_addr\"\n }\n \n+function set_last_instance_id() {\n+  if [[ \"$service\" == \"tserver\" ]]; then\n+    last_instance_id=${NUM_TSERVERS:-1}\n+  else\n+    last_instance_id=1\n+  fi\n+}\n+\n+function set_service_instance_if_needed() {\n+  if [[ \"$service\" == \"tserver\" && ${NUM_TSERVERS:-1} > 1 ]]; then", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5ODA3MTE5NQ=="}, "originalCommit": {"oid": "4ff3ae3892f10f434433f878fe66f7122ab98a46"}, "originalPosition": 13}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5ODEyMDgzMA==", "bodyText": "I saw you already fixed the \"unnecesarry $ in math expression\" issue. shellcheck is awesome, isn't it? \ud83d\ude3a", "url": "https://github.com/apache/accumulo/pull/1568#discussion_r398120830", "createdAt": "2020-03-25T19:39:50Z", "author": {"login": "ctubbsii"}, "path": "assemble/bin/accumulo-cluster", "diffHunk": "@@ -100,15 +100,45 @@ function get_ip() {\n   echo \"$ip_addr\"\n }\n \n+function set_last_instance_id() {\n+  if [[ \"$service\" == \"tserver\" ]]; then\n+    last_instance_id=${NUM_TSERVERS:-1}\n+  else\n+    last_instance_id=1\n+  fi\n+}\n+\n+function set_service_instance_if_needed() {\n+  if [[ \"$service\" == \"tserver\" && ${NUM_TSERVERS:-1} > 1 ]]; then", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5ODA3MTE5NQ=="}, "originalCommit": {"oid": "4ff3ae3892f10f434433f878fe66f7122ab98a46"}, "originalPosition": 13}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjQ2NzczMzc3OnYy", "diffSide": "RIGHT", "path": "assemble/bin/accumulo-cluster", "isResolved": true, "comments": {"totalCount": 6, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yNVQxODoyMDowN1rOF7odJg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yN1QwNzoyMjozNFrOF8lpcw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5ODA3MzEyNg==", "bodyText": "Instead of creating a second variable and exporting here, you can probably just execute it with the environment variable set for the execution:\n\n  \n    \n  \n    \n\n  \n  This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters. Learn more about bidirectional Unicode characters\n\n\n  \n\n\n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                  $SSH \"$host\" \"bash -c '${service_instance_cmd} ${bin}/accumulo-service \\\"$service\\\" \\\"$control_cmd\\\"'\"\n          \n          \n            \n                  $SSH \"$host\" \"bash -c 'ACCUMULO_SERVICE_INSTANCE='\"$ACCUMULO_SERVICE_INSTANCE\"' ${bin}/accumulo-service \\\"$service\\\" \\\"$control_cmd\\\"'\"", "url": "https://github.com/apache/accumulo/pull/1568#discussion_r398073126", "createdAt": "2020-03-25T18:20:07Z", "author": {"login": "ctubbsii"}, "path": "assemble/bin/accumulo-cluster", "diffHunk": "@@ -100,15 +100,45 @@ function get_ip() {\n   echo \"$ip_addr\"\n }\n \n+function set_last_instance_id() {\n+  if [[ \"$service\" == \"tserver\" ]]; then\n+    last_instance_id=${NUM_TSERVERS:-1}\n+  else\n+    last_instance_id=1\n+  fi\n+}\n+\n+function set_service_instance_if_needed() {\n+  if [[ \"$service\" == \"tserver\" && ${NUM_TSERVERS:-1} > 1 ]]; then\n+    export ACCUMULO_SERVICE_INSTANCE=$inst_id\n+    service_instance_cmd=\"export ACCUMULO_SERVICE_INSTANCE=${inst_id};\"\n+  else\n+    export ACCUMULO_SERVICE_INSTANCE=\n+    service_instance_cmd=\n+  fi\n+}\n+\n+function control_service() {\n+  set_last_instance_id\n+\n+  for (( inst_id=1; inst_id<=last_instance_id; inst_id++ ))\n+  do\n+    set_service_instance_if_needed\n+\n+    if [[ $host == localhost || $host = \"$(hostname -s)\" || $host = \"$(hostname -f)\" || $host = $(get_ip) ]] ; then\n+      \"${bin}/accumulo-service\" \"$service\" \"$control_cmd\"\n+    else\n+      $SSH \"$host\" \"bash -c '${service_instance_cmd} ${bin}/accumulo-service \\\"$service\\\" \\\"$control_cmd\\\"'\"", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "4ff3ae3892f10f434433f878fe66f7122ab98a46"}, "originalPosition": 32}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5ODEyMDI3Nw==", "bodyText": "Ah - I think the usage of the semicolon in my script was the reason the variable was not visible within the accumulo-service script. I guess I was going off the syntax in the docs which has a semicolon between the ACCUMULO_SEVICE_INSTANCE variable and the accumulo script. I wonder now if that is a typo which needs to be addressed?", "url": "https://github.com/apache/accumulo/pull/1568#discussion_r398120277", "createdAt": "2020-03-25T19:38:50Z", "author": {"login": "arvindshmicrosoft"}, "path": "assemble/bin/accumulo-cluster", "diffHunk": "@@ -100,15 +100,45 @@ function get_ip() {\n   echo \"$ip_addr\"\n }\n \n+function set_last_instance_id() {\n+  if [[ \"$service\" == \"tserver\" ]]; then\n+    last_instance_id=${NUM_TSERVERS:-1}\n+  else\n+    last_instance_id=1\n+  fi\n+}\n+\n+function set_service_instance_if_needed() {\n+  if [[ \"$service\" == \"tserver\" && ${NUM_TSERVERS:-1} > 1 ]]; then\n+    export ACCUMULO_SERVICE_INSTANCE=$inst_id\n+    service_instance_cmd=\"export ACCUMULO_SERVICE_INSTANCE=${inst_id};\"\n+  else\n+    export ACCUMULO_SERVICE_INSTANCE=\n+    service_instance_cmd=\n+  fi\n+}\n+\n+function control_service() {\n+  set_last_instance_id\n+\n+  for (( inst_id=1; inst_id<=last_instance_id; inst_id++ ))\n+  do\n+    set_service_instance_if_needed\n+\n+    if [[ $host == localhost || $host = \"$(hostname -s)\" || $host = \"$(hostname -f)\" || $host = $(get_ip) ]] ; then\n+      \"${bin}/accumulo-service\" \"$service\" \"$control_cmd\"\n+    else\n+      $SSH \"$host\" \"bash -c '${service_instance_cmd} ${bin}/accumulo-service \\\"$service\\\" \\\"$control_cmd\\\"'\"", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5ODA3MzEyNg=="}, "originalCommit": {"oid": "4ff3ae3892f10f434433f878fe66f7122ab98a46"}, "originalPosition": 32}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5ODE2MDg2Nw==", "bodyText": "Ah, yeah, that's definitely a typo in the docs. I'll fix that.", "url": "https://github.com/apache/accumulo/pull/1568#discussion_r398160867", "createdAt": "2020-03-25T20:51:21Z", "author": {"login": "ctubbsii"}, "path": "assemble/bin/accumulo-cluster", "diffHunk": "@@ -100,15 +100,45 @@ function get_ip() {\n   echo \"$ip_addr\"\n }\n \n+function set_last_instance_id() {\n+  if [[ \"$service\" == \"tserver\" ]]; then\n+    last_instance_id=${NUM_TSERVERS:-1}\n+  else\n+    last_instance_id=1\n+  fi\n+}\n+\n+function set_service_instance_if_needed() {\n+  if [[ \"$service\" == \"tserver\" && ${NUM_TSERVERS:-1} > 1 ]]; then\n+    export ACCUMULO_SERVICE_INSTANCE=$inst_id\n+    service_instance_cmd=\"export ACCUMULO_SERVICE_INSTANCE=${inst_id};\"\n+  else\n+    export ACCUMULO_SERVICE_INSTANCE=\n+    service_instance_cmd=\n+  fi\n+}\n+\n+function control_service() {\n+  set_last_instance_id\n+\n+  for (( inst_id=1; inst_id<=last_instance_id; inst_id++ ))\n+  do\n+    set_service_instance_if_needed\n+\n+    if [[ $host == localhost || $host = \"$(hostname -s)\" || $host = \"$(hostname -f)\" || $host = $(get_ip) ]] ; then\n+      \"${bin}/accumulo-service\" \"$service\" \"$control_cmd\"\n+    else\n+      $SSH \"$host\" \"bash -c '${service_instance_cmd} ${bin}/accumulo-service \\\"$service\\\" \\\"$control_cmd\\\"'\"", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5ODA3MzEyNg=="}, "originalCommit": {"oid": "4ff3ae3892f10f434433f878fe66f7122ab98a46"}, "originalPosition": 32}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5ODE2MjM4NQ==", "bodyText": "The docs will further need to be updated to mention the use of NUM_TSERVERS for 2.1 and later, once this PR gets merged.", "url": "https://github.com/apache/accumulo/pull/1568#discussion_r398162385", "createdAt": "2020-03-25T20:53:48Z", "author": {"login": "ctubbsii"}, "path": "assemble/bin/accumulo-cluster", "diffHunk": "@@ -100,15 +100,45 @@ function get_ip() {\n   echo \"$ip_addr\"\n }\n \n+function set_last_instance_id() {\n+  if [[ \"$service\" == \"tserver\" ]]; then\n+    last_instance_id=${NUM_TSERVERS:-1}\n+  else\n+    last_instance_id=1\n+  fi\n+}\n+\n+function set_service_instance_if_needed() {\n+  if [[ \"$service\" == \"tserver\" && ${NUM_TSERVERS:-1} > 1 ]]; then\n+    export ACCUMULO_SERVICE_INSTANCE=$inst_id\n+    service_instance_cmd=\"export ACCUMULO_SERVICE_INSTANCE=${inst_id};\"\n+  else\n+    export ACCUMULO_SERVICE_INSTANCE=\n+    service_instance_cmd=\n+  fi\n+}\n+\n+function control_service() {\n+  set_last_instance_id\n+\n+  for (( inst_id=1; inst_id<=last_instance_id; inst_id++ ))\n+  do\n+    set_service_instance_if_needed\n+\n+    if [[ $host == localhost || $host = \"$(hostname -s)\" || $host = \"$(hostname -f)\" || $host = $(get_ip) ]] ; then\n+      \"${bin}/accumulo-service\" \"$service\" \"$control_cmd\"\n+    else\n+      $SSH \"$host\" \"bash -c '${service_instance_cmd} ${bin}/accumulo-service \\\"$service\\\" \\\"$control_cmd\\\"'\"", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5ODA3MzEyNg=="}, "originalCommit": {"oid": "4ff3ae3892f10f434433f878fe66f7122ab98a46"}, "originalPosition": 32}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5ODIzNTA1Nw==", "bodyText": "Thank you and I did plan to submit a docs PR for NUM_TSERVERS usage when this change is done.", "url": "https://github.com/apache/accumulo/pull/1568#discussion_r398235057", "createdAt": "2020-03-25T23:38:19Z", "author": {"login": "arvindshmicrosoft"}, "path": "assemble/bin/accumulo-cluster", "diffHunk": "@@ -100,15 +100,45 @@ function get_ip() {\n   echo \"$ip_addr\"\n }\n \n+function set_last_instance_id() {\n+  if [[ \"$service\" == \"tserver\" ]]; then\n+    last_instance_id=${NUM_TSERVERS:-1}\n+  else\n+    last_instance_id=1\n+  fi\n+}\n+\n+function set_service_instance_if_needed() {\n+  if [[ \"$service\" == \"tserver\" && ${NUM_TSERVERS:-1} > 1 ]]; then\n+    export ACCUMULO_SERVICE_INSTANCE=$inst_id\n+    service_instance_cmd=\"export ACCUMULO_SERVICE_INSTANCE=${inst_id};\"\n+  else\n+    export ACCUMULO_SERVICE_INSTANCE=\n+    service_instance_cmd=\n+  fi\n+}\n+\n+function control_service() {\n+  set_last_instance_id\n+\n+  for (( inst_id=1; inst_id<=last_instance_id; inst_id++ ))\n+  do\n+    set_service_instance_if_needed\n+\n+    if [[ $host == localhost || $host = \"$(hostname -s)\" || $host = \"$(hostname -f)\" || $host = $(get_ip) ]] ; then\n+      \"${bin}/accumulo-service\" \"$service\" \"$control_cmd\"\n+    else\n+      $SSH \"$host\" \"bash -c '${service_instance_cmd} ${bin}/accumulo-service \\\"$service\\\" \\\"$control_cmd\\\"'\"", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5ODA3MzEyNg=="}, "originalCommit": {"oid": "4ff3ae3892f10f434433f878fe66f7122ab98a46"}, "originalPosition": 32}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5OTA3NTY5OQ==", "bodyText": "The changes have been done - please review when you have a chance.", "url": "https://github.com/apache/accumulo/pull/1568#discussion_r399075699", "createdAt": "2020-03-27T07:22:34Z", "author": {"login": "arvindshmicrosoft"}, "path": "assemble/bin/accumulo-cluster", "diffHunk": "@@ -100,15 +100,45 @@ function get_ip() {\n   echo \"$ip_addr\"\n }\n \n+function set_last_instance_id() {\n+  if [[ \"$service\" == \"tserver\" ]]; then\n+    last_instance_id=${NUM_TSERVERS:-1}\n+  else\n+    last_instance_id=1\n+  fi\n+}\n+\n+function set_service_instance_if_needed() {\n+  if [[ \"$service\" == \"tserver\" && ${NUM_TSERVERS:-1} > 1 ]]; then\n+    export ACCUMULO_SERVICE_INSTANCE=$inst_id\n+    service_instance_cmd=\"export ACCUMULO_SERVICE_INSTANCE=${inst_id};\"\n+  else\n+    export ACCUMULO_SERVICE_INSTANCE=\n+    service_instance_cmd=\n+  fi\n+}\n+\n+function control_service() {\n+  set_last_instance_id\n+\n+  for (( inst_id=1; inst_id<=last_instance_id; inst_id++ ))\n+  do\n+    set_service_instance_if_needed\n+\n+    if [[ $host == localhost || $host = \"$(hostname -s)\" || $host = \"$(hostname -f)\" || $host = $(get_ip) ]] ; then\n+      \"${bin}/accumulo-service\" \"$service\" \"$control_cmd\"\n+    else\n+      $SSH \"$host\" \"bash -c '${service_instance_cmd} ${bin}/accumulo-service \\\"$service\\\" \\\"$control_cmd\\\"'\"", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5ODA3MzEyNg=="}, "originalCommit": {"oid": "4ff3ae3892f10f434433f878fe66f7122ab98a46"}, "originalPosition": 32}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjQ2Nzc0NDM2OnYy", "diffSide": "RIGHT", "path": "assemble/bin/accumulo-cluster", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yNVQxODoyMjo0N1rOF7oj7Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yNVQxODoyMjo0N1rOF7oj7Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5ODA3NDg2MQ==", "bodyText": "Could pass the arguments to the function instead of setting up global variables and picking them up in the function.\n\n  \n    \n  \n    \n\n  \n  This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters. Learn more about bidirectional Unicode characters\n\n\n  \n\n\n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n              control_service\n          \n          \n            \n              control_service start \"$@\"", "url": "https://github.com/apache/accumulo/pull/1568#discussion_r398074861", "createdAt": "2020-03-25T18:22:47Z", "author": {"login": "ctubbsii"}, "path": "assemble/bin/accumulo-cluster", "diffHunk": "@@ -100,15 +100,45 @@ function get_ip() {\n   echo \"$ip_addr\"\n }\n \n+function set_last_instance_id() {\n+  if [[ \"$service\" == \"tserver\" ]]; then\n+    last_instance_id=${NUM_TSERVERS:-1}\n+  else\n+    last_instance_id=1\n+  fi\n+}\n+\n+function set_service_instance_if_needed() {\n+  if [[ \"$service\" == \"tserver\" && ${NUM_TSERVERS:-1} > 1 ]]; then\n+    export ACCUMULO_SERVICE_INSTANCE=$inst_id\n+    service_instance_cmd=\"export ACCUMULO_SERVICE_INSTANCE=${inst_id};\"\n+  else\n+    export ACCUMULO_SERVICE_INSTANCE=\n+    service_instance_cmd=\n+  fi\n+}\n+\n+function control_service() {\n+  set_last_instance_id\n+\n+  for (( inst_id=1; inst_id<=last_instance_id; inst_id++ ))\n+  do\n+    set_service_instance_if_needed\n+\n+    if [[ $host == localhost || $host = \"$(hostname -s)\" || $host = \"$(hostname -f)\" || $host = $(get_ip) ]] ; then\n+      \"${bin}/accumulo-service\" \"$service\" \"$control_cmd\"\n+    else\n+      $SSH \"$host\" \"bash -c '${service_instance_cmd} ${bin}/accumulo-service \\\"$service\\\" \\\"$control_cmd\\\"'\"\n+    fi\n+  done\n+}\n+\n function start_service() {\n   host=\"$1\"\n   service=\"$2\"\n+  control_cmd=\"start\"\n \n-  if [[ $host == \"localhost\" || $host == $(hostname -f) || $host == $(hostname -s) || $host == $(get_ip) ]]; then\n-    \"${bin}/accumulo-service\" \"$service\" start\n-  else\n-    $SSH \"$host\" \"bash -c '${bin}/accumulo-service \\\"$service\\\" start'\"\n-  fi\n+  control_service", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "4ff3ae3892f10f434433f878fe66f7122ab98a46"}, "originalPosition": 47}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4215, "cost": 1, "resetAt": "2021-11-12T09:44:50Z"}}}