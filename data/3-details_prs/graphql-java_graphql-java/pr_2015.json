{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDc1NzM2ODI2", "number": 2015, "title": "Repeatable directives support", "bodyText": "This is a starting branch on repeatable directives.\nhttps://github.com/graphql/graphql-spec/pull/472/files\nIt supersedes the other PRs however code from them has been incorporated (via copy paste not commits) so we are grateful for those contributions\nWe have\n\ngrammar\nAST directive definition support\nAST directive container support\nsome tests of that\nGraphqlXXX runtime support of getting repeatable directives\nIntrospection support for show if a directive is repeatable\nTests for schema building with repeatable directives", "createdAt": "2020-08-29T07:29:57Z", "url": "https://github.com/graphql-java/graphql-java/pull/2015", "merged": true, "mergeCommit": {"oid": "ff3f6918330b9c78321b2fe6fce615ce2b155eac"}, "closed": true, "closedAt": "2020-11-15T23:56:41Z", "author": {"login": "bbakerman"}, "timelineItems": {"totalCount": 28, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdDkbYhAH2gAyNDc1NzM2ODI2OjdhNWY2NTJhZjNmZWNjODdjNjFjMTBlMjVkYzg5NWY1ZmM2ZWYwODE=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdc5LvwAH2gAyNDc1NzM2ODI2OmVjN2ZhOGEyNzU2NzRmZDQ2OTQ4YzRjMzA2MWZmMDhiM2UxZDM3OWU=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "7a5f652af3fecc87c61c10e25dc895f5fc6ef081", "author": {"user": {"login": "bbakerman", "name": "Brad Baker"}}, "url": "https://github.com/graphql-java/graphql-java/commit/7a5f652af3fecc87c61c10e25dc895f5fc6ef081", "committedDate": "2020-08-29T07:25:30Z", "message": "Repeatable directives support\n\nStill much to do"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "1a524c39e32efb90a77a3887266982f3f4efc7e3", "author": {"user": {"login": "bbakerman", "name": "Brad Baker"}}, "url": "https://github.com/graphql-java/graphql-java/commit/1a524c39e32efb90a77a3887266982f3f4efc7e3", "committedDate": "2020-08-29T08:38:00Z", "message": "Repeatable directives support\n\nIntrospection and better grammar plus GraphlXX runtime types"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDc4MTExNjc4", "url": "https://github.com/graphql-java/graphql-java/pull/2015#pullrequestreview-478111678", "createdAt": "2020-08-29T08:44:08Z", "commit": {"oid": "1a524c39e32efb90a77a3887266982f3f4efc7e3"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yOVQwODo0NDowOFrOHJaGTA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yOVQwODo0NDowOFrOHJaGTA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3OTYyNjgyOA==", "bodyText": "Should never had had this repeated code but rather inherit it", "url": "https://github.com/graphql-java/graphql-java/pull/2015#discussion_r479626828", "createdAt": "2020-08-29T08:44:08Z", "author": {"login": "bbakerman"}, "path": "src/main/java/graphql/language/InlineFragment.java", "diffHunk": "@@ -68,14 +67,6 @@ public TypeName getTypeCondition() {\n         return new ArrayList<>(directives);\n     }\n \n-    public Map<String, Directive> getDirectivesByName() {\n-        return directivesByName(directives);\n-    }\n-\n-    public Directive getDirective(String directiveName) {\n-        return getDirectivesByName().get(directiveName);\n-    }\n-", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "1a524c39e32efb90a77a3887266982f3f4efc7e3"}, "originalPosition": 19}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDc4MTExNzEz", "url": "https://github.com/graphql-java/graphql-java/pull/2015#pullrequestreview-478111713", "createdAt": "2020-08-29T08:44:53Z", "commit": {"oid": "1a524c39e32efb90a77a3887266982f3f4efc7e3"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yOVQwODo0NDo1NFrOHJaGhg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yOVQwODo0NDo1NFrOHJaGhg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3OTYyNjg4Ng==", "bodyText": "Should never had had this code", "url": "https://github.com/graphql-java/graphql-java/pull/2015#discussion_r479626886", "createdAt": "2020-08-29T08:44:54Z", "author": {"login": "bbakerman"}, "path": "src/main/java/graphql/schema/GraphQLEnumValueDefinition.java", "diffHunk": "@@ -119,16 +119,6 @@ public String getDeprecationReason() {\n         return new ArrayList<>(directives);\n     }\n \n-    @Override\n-    public Map<String, GraphQLDirective> getDirectivesByName() {\n-        return DirectivesUtil.directivesByName(directives);\n-    }\n-\n-    @Override\n-    public GraphQLDirective getDirective(String directiveName) {\n-        return getDirectivesByName().get(directiveName);\n-    }\n-", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "1a524c39e32efb90a77a3887266982f3f4efc7e3"}, "originalPosition": 13}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "466de8a7896ecb52b03e02f30dd544314982ad50", "author": {"user": {"login": "bbakerman", "name": "Brad Baker"}}, "url": "https://github.com/graphql-java/graphql-java/commit/466de8a7896ecb52b03e02f30dd544314982ad50", "committedDate": "2020-08-29T08:49:06Z", "message": "fixed test"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "d49f54f097a4951e9e44cab1b9a9c9d44fd94ab5", "author": {"user": {"login": "bbakerman", "name": "Brad Baker"}}, "url": "https://github.com/graphql-java/graphql-java/commit/d49f54f097a4951e9e44cab1b9a9c9d44fd94ab5", "committedDate": "2020-08-30T07:04:17Z", "message": "Better documentation and more tests"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b11d16ff0f26aa1e7c3683f9724c6654c2b637ab", "author": {"user": {"login": "bbakerman", "name": "Brad Baker"}}, "url": "https://github.com/graphql-java/graphql-java/commit/b11d16ff0f26aa1e7c3683f9724c6654c2b637ab", "committedDate": "2020-08-30T10:19:55Z", "message": "Now has runtime types included"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDc4MjM0NDEx", "url": "https://github.com/graphql-java/graphql-java/pull/2015#pullrequestreview-478234411", "createdAt": "2020-08-30T21:09:15Z", "commit": {"oid": "b11d16ff0f26aa1e7c3683f9724c6654c2b637ab"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0zMFQyMTowOToxNVrOHJlo7g==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0zMFQyMTowOToxNVrOHJlo7g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3OTgxNTkxOA==", "bodyText": "This method pattern is repeated in GraphqlDirectiveContainer as well - same names - same pattern - different types", "url": "https://github.com/graphql-java/graphql-java/pull/2015#discussion_r479815918", "createdAt": "2020-08-30T21:09:15Z", "author": {"login": "bbakerman"}, "path": "src/main/java/graphql/language/DirectivesContainer.java", "diffHunk": "@@ -6,34 +6,67 @@\n import java.util.List;\n import java.util.Map;\n \n-import static graphql.language.NodeUtil.directivesByName;\n+import static graphql.language.NodeUtil.allDirectivesByName;\n+import static graphql.language.NodeUtil.nonRepeatableDirectivesByName;\n+import static graphql.language.NodeUtil.nonRepeatedDirectiveByNameWithAssert;\n+import static java.util.Collections.emptyList;\n \n /**\n- * Represents a language node that can contain Directives.\n+ * Represents a language node that can contain Directives.  Directives can be repeatable and (by default) non repeatable.\n+ * <p>\n+ * There are access methods here that get the two different types.\n+ *\n+ * @see graphql.language.DirectiveDefinition\n+ * @see DirectiveDefinition#isRepeatable()\n  */\n @PublicApi\n public interface DirectivesContainer<T extends DirectivesContainer> extends Node<T> {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b11d16ff0f26aa1e7c3683f9724c6654c2b637ab"}, "originalPosition": 20}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "fc337e6755c8060eba207e86eda7213b4fe16045", "author": {"user": {"login": "bbakerman", "name": "Brad Baker"}}, "url": "https://github.com/graphql-java/graphql-java/commit/fc337e6755c8060eba207e86eda7213b4fe16045", "committedDate": "2020-08-31T01:33:52Z", "message": "Fixing up tests"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c9a9d07c7f22da3aa6ea1b1c6db2c907959a76fc", "author": {"user": {"login": "bbakerman", "name": "Brad Baker"}}, "url": "https://github.com/graphql-java/graphql-java/commit/c9a9d07c7f22da3aa6ea1b1c6db2c907959a76fc", "committedDate": "2020-08-31T23:07:01Z", "message": "SchemaPrinter and AstPrinter support"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDc5NDg2ODky", "url": "https://github.com/graphql-java/graphql-java/pull/2015#pullrequestreview-479486892", "createdAt": "2020-09-01T07:54:12Z", "commit": {"oid": "c9a9d07c7f22da3aa6ea1b1c6db2c907959a76fc"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0wMVQwNzo1NDoxMlrOHKqRSw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0wMVQwNzo1NDoxMlrOHKqRSw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MDk0MDM2Mw==", "bodyText": "it is false by default :-)", "url": "https://github.com/graphql-java/graphql-java/pull/2015#discussion_r480940363", "createdAt": "2020-09-01T07:54:12Z", "author": {"login": "andimarek"}, "path": "src/main/java/graphql/language/DirectiveDefinition.java", "diffHunk": "@@ -140,6 +153,7 @@ public DirectiveDefinition transform(Consumer<Builder> builderConsumer) {\n         private SourceLocation sourceLocation;\n         private List<Comment> comments = new ArrayList<>();\n         private String name;\n+        private boolean repeatable = false;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c9a9d07c7f22da3aa6ea1b1c6db2c907959a76fc"}, "originalPosition": 70}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDgxMDEwMjk2", "url": "https://github.com/graphql-java/graphql-java/pull/2015#pullrequestreview-481010296", "createdAt": "2020-09-02T16:47:10Z", "commit": {"oid": "c9a9d07c7f22da3aa6ea1b1c6db2c907959a76fc"}, "state": "COMMENTED", "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0wMlQxNjo0NzoxMFrOHL4EvA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0wMlQxNzozNDozMFrOHL6C7Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MjIxNTEwMA==", "bodyText": "nonRepeatableDirectivesByName will travel directives three times. The code below seem to be faster:\n    public static Map<String, GraphQLDirective> nonRepeatableDirectivesByName(List<GraphQLDirective> directives) {\n        // filter the repeatable directives\n        List<GraphQLDirective> singletonDirectives = directives.stream()\n                .filter(d -> !d.isRepeatable()).collect(Collectors.toList());\n        \n        return FpKit.getByName(singletonDirectives, GraphQLDirective::getName);\n    }", "url": "https://github.com/graphql-java/graphql-java/pull/2015#discussion_r482215100", "createdAt": "2020-09-02T16:47:10Z", "author": {"login": "dugenkui03"}, "path": "src/main/java/graphql/DirectivesUtil.java", "diffHunk": "@@ -7,20 +7,94 @@\n import java.util.List;\n import java.util.Map;\n import java.util.Optional;\n+import java.util.stream.Collectors;\n+\n+import static graphql.Assert.assertNotNull;\n+import static java.util.Collections.emptyList;\n \n @Internal\n public class DirectivesUtil {\n \n-    public static Map<String, GraphQLDirective> directivesByName(List<GraphQLDirective> directiveList) {\n-        return FpKit.getByName(directiveList, GraphQLDirective::getName, FpKit.mergeFirst());\n+\n+    public static Map<String, GraphQLDirective> nonRepeatableDirectivesByName(List<GraphQLDirective> directives) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c9a9d07c7f22da3aa6ea1b1c6db2c907959a76fc"}, "originalPosition": 15}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MjIyNTkzOQ==", "bodyText": "Do you think this is an more efficient way to implement enforceAdd:\n    public static List<GraphQLDirective> enforceAdd(List<GraphQLDirective> targetList, GraphQLDirective newDirective) {\n        assertNotNull(targetList, () -> \"directive list can't be null\");\n        assertNotNull(newDirective, () -> \"directive can't be null\");\n\n        // check whether the newDirective is repeatable in advance, to avoid needless operations\n        if(newDirective.isNonRepeatable()){\n            Map<String, List<GraphQLDirective>> map = allDirectivesByName(targetList);\n            assertNonRepeatable(newDirective, map);\n        }\n        targetList.add(newDirective);\n        return targetList;\n    }", "url": "https://github.com/graphql-java/graphql-java/pull/2015#discussion_r482225939", "createdAt": "2020-09-02T17:04:07Z", "author": {"login": "dugenkui03"}, "path": "src/main/java/graphql/DirectivesUtil.java", "diffHunk": "@@ -7,20 +7,94 @@\n import java.util.List;\n import java.util.Map;\n import java.util.Optional;\n+import java.util.stream.Collectors;\n+\n+import static graphql.Assert.assertNotNull;\n+import static java.util.Collections.emptyList;\n \n @Internal\n public class DirectivesUtil {\n \n-    public static Map<String, GraphQLDirective> directivesByName(List<GraphQLDirective> directiveList) {\n-        return FpKit.getByName(directiveList, GraphQLDirective::getName, FpKit.mergeFirst());\n+\n+    public static Map<String, GraphQLDirective> nonRepeatableDirectivesByName(List<GraphQLDirective> directives) {\n+        Map<String, List<GraphQLDirective>> map = allDirectivesByName(directives);\n+        List<GraphQLDirective> singletonDirectives = map.entrySet().stream()\n+                // only those that have 1 non repeated entry\n+                .filter(e -> e.getKey() != null && isAllNonRepeatable(e.getValue()))\n+                .flatMap(e -> e.getValue().stream()).collect(Collectors.toList());\n+        return FpKit.getByName(singletonDirectives, GraphQLDirective::getName);\n+    }\n+\n+    public static Map<String, List<GraphQLDirective>> allDirectivesByName(List<GraphQLDirective> directives) {\n+        return FpKit.groupingBy(directives, GraphQLDirective::getName);\n+    }\n+\n+    public static GraphQLDirective nonRepeatedDirectiveByNameWithAssert(Map<String, List<GraphQLDirective>> directives, String directiveName) {\n+        List<GraphQLDirective> directiveList = directives.get(directiveName);\n+        if (directiveList == null || directiveList.isEmpty()) {\n+            return null;\n+        }\n+        Assert.assertTrue(isAllNonRepeatable(directiveList), () -> String.format(\"'%s' is a repeatable directive and you have used a non repeatable access method\", directiveName));\n+        return directiveList.get(0);\n     }\n \n-    public static Optional<GraphQLArgument> directiveWithArg(List<GraphQLDirective> directiveList, String directiveName, String argumentName) {\n-        GraphQLDirective directive = directivesByName(directiveList).get(directiveName);\n+    public static Optional<GraphQLArgument> directiveWithArg(List<GraphQLDirective> directives, String directiveName, String argumentName) {\n+        GraphQLDirective directive = nonRepeatableDirectivesByName(directives).get(directiveName);\n         GraphQLArgument argument = null;\n         if (directive != null) {\n             argument = directive.getArgument(argumentName);\n         }\n         return Optional.ofNullable(argument);\n     }\n+\n+    public static boolean isAllNonRepeatable(List<GraphQLDirective> directives) {\n+        if (directives == null || directives.isEmpty()) {\n+            return false;\n+        }\n+        for (GraphQLDirective graphQLDirective : directives) {\n+            if (graphQLDirective.isRepeatable()) {\n+                return false;\n+            }\n+        }\n+        return true;\n+    }\n+\n+    public static List<GraphQLDirective> enforceAdd(List<GraphQLDirective> targetList, GraphQLDirective newDirective) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c9a9d07c7f22da3aa6ea1b1c6db2c907959a76fc"}, "originalPosition": 60}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MjI0NzQwNQ==", "bodyText": "repeatable directive may used in Field one times, size() == 1 is not a prefect way to determain wether a directive is repeatable.", "url": "https://github.com/graphql-java/graphql-java/pull/2015#discussion_r482247405", "createdAt": "2020-09-02T17:34:30Z", "author": {"login": "dugenkui03"}, "path": "src/main/java/graphql/language/NodeUtil.java", "diffHunk": "@@ -28,9 +30,26 @@ public static boolean isEqualTo(String thisStr, String thatStr) {\n         return true;\n     }\n \n+    public static Map<String, List<Directive>> allDirectivesByName(List<Directive> directives) {\n+        return FpKit.groupingBy(directives, Directive::getName);\n+    }\n+\n+    public static Map<String, Directive> nonRepeatableDirectivesByName(List<Directive> directives) {\n+        Map<String, List<Directive>> map = allDirectivesByName(directives);\n+        List<Directive> singletonDirectives = map.entrySet().stream()\n+                // only those that have 1 non repeated entry\n+                .filter(e -> e.getKey() != null && e.getValue().size() == 1)", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c9a9d07c7f22da3aa6ea1b1c6db2c907959a76fc"}, "originalPosition": 27}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b73c100f26b1cbee9754cb070254a89221800557", "author": {"user": {"login": "bbakerman", "name": "Brad Baker"}}, "url": "https://github.com/graphql-java/graphql-java/commit/b73c100f26b1cbee9754cb070254a89221800557", "committedDate": "2020-09-14T03:04:31Z", "message": "Merge remote-tracking branch 'origin/master' into repeatable-directives-support\n\n# Conflicts:\n#\tsrc/main/java/graphql/DirectivesUtil.java\n#\tsrc/main/java/graphql/execution/ConditionalNodes.java\n#\tsrc/main/java/graphql/language/DirectiveDefinition.java\n#\tsrc/main/java/graphql/language/DirectivesContainer.java\n#\tsrc/main/java/graphql/language/InlineFragment.java\n#\tsrc/main/java/graphql/language/NodeUtil.java\n#\tsrc/main/java/graphql/language/SchemaDefinition.java\n#\tsrc/main/java/graphql/schema/GraphQLDirectiveContainer.java\n#\tsrc/main/java/graphql/schema/GraphQLEnumValueDefinition.java"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTEzNTMyOTUz", "url": "https://github.com/graphql-java/graphql-java/pull/2015#pullrequestreview-513532953", "createdAt": "2020-10-21T10:31:51Z", "commit": {"oid": "b73c100f26b1cbee9754cb070254a89221800557"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yMVQxMDozMTo1MVrOHllN8A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yMVQxMDozMTo1MVrOHllN8A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwOTE2OTEzNg==", "bodyText": "This is some some rubbish left over testing - this is NOT needed", "url": "https://github.com/graphql-java/graphql-java/pull/2015#discussion_r509169136", "createdAt": "2020-10-21T10:31:51Z", "author": {"login": "bbakerman"}, "path": "build.gradle", "diffHunk": "@@ -75,6 +76,8 @@ dependencies {\n \n     testCompile 'org.openjdk.jmh:jmh-core:1.21'\n     testCompile 'org.openjdk.jmh:jmh-generator-annprocess:1.21'\n+\n+    testCompile 'is.tagomor.woothee:woothee-java:1.11.0'", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b73c100f26b1cbee9754cb070254a89221800557"}, "originalPosition": 13}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "5adf520e8f421018d5163d561b9da9270c2e878c", "author": {"user": {"login": "bbakerman", "name": "Brad Baker"}}, "url": "https://github.com/graphql-java/graphql-java/commit/5adf520e8f421018d5163d561b9da9270c2e878c", "committedDate": "2020-10-21T21:13:03Z", "message": "Merge remote-tracking branch 'origin/master' into repeatable-directives-support\n\n# Conflicts:\n#\tbuild.gradle\n#\tsrc/main/java/graphql/schema/idl/SchemaGenerator.java\n#\tsrc/main/java/graphql/schema/idl/SchemaGeneratorHelper.java\n\nnot currently working"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f81fe14a5e5a70fa05f54ac5e433d7258077be97", "author": {"user": {"login": "bbakerman", "name": "Brad Baker"}}, "url": "https://github.com/graphql-java/graphql-java/commit/f81fe14a5e5a70fa05f54ac5e433d7258077be97", "committedDate": "2020-10-25T04:04:31Z", "message": "Fixing builds after bad merge"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e9deb31fae7cd576ee112befd991050fc7f45438", "author": {"user": {"login": "bbakerman", "name": "Brad Baker"}}, "url": "https://github.com/graphql-java/graphql-java/commit/e9deb31fae7cd576ee112befd991050fc7f45438", "committedDate": "2020-10-25T04:37:17Z", "message": "PR feedback"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "af3d66783b78e03a059b57aaf88171852b6d9739", "author": {"user": {"login": "bbakerman", "name": "Brad Baker"}}, "url": "https://github.com/graphql-java/graphql-java/commit/af3d66783b78e03a059b57aaf88171852b6d9739", "committedDate": "2020-11-03T21:01:42Z", "message": "Removed the getDirectiveByName on AST area"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTIyODc0NTYz", "url": "https://github.com/graphql-java/graphql-java/pull/2015#pullrequestreview-522874563", "createdAt": "2020-11-03T21:07:10Z", "commit": {"oid": "af3d66783b78e03a059b57aaf88171852b6d9739"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wM1QyMTowNzoxMFrOHtAeYQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wM1QyMToxOTozM1rOHtA1aw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNjk1NTc0NQ==", "bodyText": "what is this fix here? did we have this wrong before?", "url": "https://github.com/graphql-java/graphql-java/pull/2015#discussion_r516955745", "createdAt": "2020-11-03T21:07:10Z", "author": {"login": "andimarek"}, "path": "src/main/java/graphql/introspection/Introspection.java", "diffHunk": "@@ -430,13 +430,17 @@ private static String print(Object value, GraphQLInputType type) {\n             .name(\"__Directive\")\n             .field(newFieldDefinition()\n                     .name(\"name\")\n-                    .type(GraphQLString))\n+                    .description(\"The __Directive type represents a Directive that a server supports.\")\n+                    .type(nonNull(GraphQLString)))\n             .field(newFieldDefinition()\n                     .name(\"description\")\n                     .type(GraphQLString))\n+            .field(newFieldDefinition()\n+                    .name(\"isRepeatable\")\n+                    .type(nonNull(GraphQLBoolean)))\n             .field(newFieldDefinition()\n                     .name(\"locations\")\n-                    .type(list(nonNull(__DirectiveLocation))))\n+                    .type(nonNull(list(__DirectiveLocation))))", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "af3d66783b78e03a059b57aaf88171852b6d9739"}, "originalPosition": 16}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNjk1NzYzNQ==", "bodyText": "@bbakerman so this method return only the directives used once?", "url": "https://github.com/graphql-java/graphql-java/pull/2015#discussion_r516957635", "createdAt": "2020-11-03T21:11:11Z", "author": {"login": "andimarek"}, "path": "src/main/java/graphql/language/NodeUtil.java", "diffHunk": "@@ -28,9 +30,26 @@ public static boolean isEqualTo(String thisStr, String thatStr) {\n         return true;\n     }\n \n+    public static Map<String, List<Directive>> allDirectivesByName(List<Directive> directives) {\n+        return FpKit.groupingBy(directives, Directive::getName);\n+    }\n+\n+    public static Map<String, Directive> nonRepeatableDirectivesByName(List<Directive> directives) {\n+        Map<String, List<Directive>> map = allDirectivesByName(directives);\n+        List<Directive> singletonDirectives = map.entrySet().stream()\n+                // only those that have 1 non repeated entry\n+                .filter(e -> e.getKey() != null && e.getValue().size() == 1)", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MjI0NzQwNQ=="}, "originalCommit": {"oid": "c9a9d07c7f22da3aa6ea1b1c6db2c907959a76fc"}, "originalPosition": 27}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNjk2MTY0Mw==", "bodyText": "we should have a test which actually prints multiple directives on a Node", "url": "https://github.com/graphql-java/graphql-java/pull/2015#discussion_r516961643", "createdAt": "2020-11-03T21:19:33Z", "author": {"login": "andimarek"}, "path": "src/test/groovy/graphql/language/AstPrinterTest.groovy", "diffHunk": "@@ -605,11 +601,41 @@ extend input Input @directive {\n                 .build()\n \n         when:\n-        def result = astPrinter.printAst(interfaceType)\n+        def result = AstPrinter.printAstCompact(interfaceType)\n \n         then:\n         result == \"extend interface Resource implements Node & Extra {}\"\n \n     }\n \n+    def \"directive definitions can be printed\"() {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "af3d66783b78e03a059b57aaf88171852b6d9739"}, "originalPosition": 49}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "fed532182d76c6354c27409bfa2ccd90a6af0e6b", "author": {"user": {"login": "bbakerman", "name": "Brad Baker"}}, "url": "https://github.com/graphql-java/graphql-java/commit/fed532182d76c6354c27409bfa2ccd90a6af0e6b", "committedDate": "2020-11-03T21:23:50Z", "message": "Merge remote-tracking branch 'origin/master' into repeatable-directives-support\n\n# Conflicts:\n#\tsrc/main/java/graphql/schema/idl/SchemaGeneratorHelper.java\n#\tsrc/main/java/graphql/schema/idl/SchemaTypeChecker.java"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "cb1bd847ceed231a37e067af497d5697e8fa8373", "author": {"user": {"login": "bbakerman", "name": "Brad Baker"}}, "url": "https://github.com/graphql-java/graphql-java/commit/cb1bd847ceed231a37e067af497d5697e8fa8373", "committedDate": "2020-11-03T21:44:41Z", "message": "Killed nonRepeatableDirectivesByName"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "99c3be26e79a75b0f837640f194dd332b913871b", "author": {"user": {"login": "bbakerman", "name": "Brad Baker"}}, "url": "https://github.com/graphql-java/graphql-java/commit/99c3be26e79a75b0f837640f194dd332b913871b", "committedDate": "2020-11-03T21:48:26Z", "message": "Killed nonRepeatableDirectivesByName"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "483d4473577190020b6ef4b287fbd250ca82efd8", "author": {"user": {"login": "bbakerman", "name": "Brad Baker"}}, "url": "https://github.com/graphql-java/graphql-java/commit/483d4473577190020b6ef4b287fbd250ca82efd8", "committedDate": "2020-11-10T10:29:57Z", "message": "Merge remote-tracking branch 'origin/master' into repeatable-directives-support\n\n# Conflicts:\n#\tsrc/main/java/graphql/language/Directive.java\n#\tsrc/main/java/graphql/language/DirectiveDefinition.java\n#\tsrc/main/java/graphql/language/InlineFragment.java\n#\tsrc/main/java/graphql/language/SchemaDefinition.java\n#\tsrc/main/java/graphql/schema/GraphQLArgument.java\n#\tsrc/main/java/graphql/schema/GraphQLDirective.java\n#\tsrc/main/java/graphql/schema/GraphQLEnumType.java\n#\tsrc/main/java/graphql/schema/GraphQLFieldDefinition.java\n#\tsrc/main/java/graphql/schema/GraphQLInputObjectField.java\n#\tsrc/main/java/graphql/schema/GraphQLInputObjectType.java\n#\tsrc/main/java/graphql/schema/GraphQLObjectType.java\n#\tsrc/main/java/graphql/schema/GraphQLScalarType.java\n#\tsrc/main/java/graphql/schema/GraphQLSchema.java\n#\tsrc/main/java/graphql/schema/GraphQLUnionType.java"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "cf753b9da66f6e54e6bfffee8ac7df704d2c53b6", "author": {"user": {"login": "bbakerman", "name": "Brad Baker"}}, "url": "https://github.com/graphql-java/graphql-java/commit/cf753b9da66f6e54e6bfffee8ac7df704d2c53b6", "committedDate": "2020-11-12T21:25:40Z", "message": "Merge remote-tracking branch 'origin/master' into repeatable-directives-support"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "27597deb44ddea8adb6db8647a87e91c433059e7", "author": {"user": {"login": "bbakerman", "name": "Brad Baker"}}, "url": "https://github.com/graphql-java/graphql-java/commit/27597deb44ddea8adb6db8647a87e91c433059e7", "committedDate": "2020-11-12T22:44:20Z", "message": "Added extra tests for printing repeatable directives"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "6d534628997c0188b50c8a6c34bf29d5dabaaf40", "author": {"user": {"login": "bbakerman", "name": "Brad Baker"}}, "url": "https://github.com/graphql-java/graphql-java/commit/6d534628997c0188b50c8a6c34bf29d5dabaaf40", "committedDate": "2020-11-13T10:35:32Z", "message": "Moved to a directive holder"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTMwNzc0MDc0", "url": "https://github.com/graphql-java/graphql-java/pull/2015#pullrequestreview-530774074", "createdAt": "2020-11-15T07:39:36Z", "commit": {"oid": "6d534628997c0188b50c8a6c34bf29d5dabaaf40"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ec7fa8a275674fd46948c4c3061ff08b3e1d379e", "author": {"user": {"login": "bbakerman", "name": "Brad Baker"}}, "url": "https://github.com/graphql-java/graphql-java/commit/ec7fa8a275674fd46948c4c3061ff08b3e1d379e", "committedDate": "2020-11-15T23:44:32Z", "message": "Merge remote-tracking branch 'origin/master' into repeatable-directives-support\n\n# Conflicts:\n#\tsrc/main/java/graphql/schema/GraphQLUnionType.java\n#\tsrc/main/java/graphql/schema/idl/SchemaGeneratorHelper.java"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4344, "cost": 1, "resetAt": "2021-11-01T14:51:55Z"}}}