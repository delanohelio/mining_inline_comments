{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTExMjMzMDUx", "number": 2085, "title": "#1914 Use default values for fields of input types when default argument value is provided", "bodyText": "Adds support for honoring the default values declared in input type definition (Issue)\nExample 1\nSchema:\ntype Query {\n    sayHello(arg: Arg! = {}): String\n}\n\ninput Arg {\n    foo: String = \"Bar\"\n}\n\nQuery:\nquery {\n    sayHello\n}\n\narg value before change:\n{}\narg value after change:\n{foo: \"Bar\"}\nExample 2\nSchema:\ntype Query {\n    sayHello(arg: Arg! = {field1: \"F1ValOverride\"}): String\n}\n\ninput Arg {\n    field1: String = \"F1V\"\n    field2: String = \"F2V\"\n}\n\nQuery:\nquery {\n    sayHello\n}\n\narg value before change:\n{field1: \"F1ValOverride\"}\narg value after change:\n{field1: \"F1ValOverride\", field2: \"F2V\"}", "createdAt": "2020-10-28T02:36:50Z", "url": "https://github.com/graphql-java/graphql-java/pull/2085", "merged": true, "mergeCommit": {"oid": "3295066eaab118ee1d971b2d3039bcb97cca65cc"}, "closed": true, "closedAt": "2020-11-01T02:23:39Z", "author": {"login": "priyaaggarwal24"}, "timelineItems": {"totalCount": 8, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdWz2OEgH2gAyNTExMjMzMDUxOmIwYzg3NTNkZTVjMGRkMGIwOWVhNTNkNzY0NGRiZjQxOWVmODRjMTU=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdXc5rTAH2gAyNTExMjMzMDUxOmVkZjQ5YTI5ZmM2YzVmNDE3N2NmMzRkM2NjMTFhNGM2NTNjYTk5ZjY=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "b0c8753de5c0dd0b09ea53d7644dbf419ef84c15", "author": {"user": null}, "url": "https://github.com/graphql-java/graphql-java/commit/b0c8753de5c0dd0b09ea53d7644dbf419ef84c15", "committedDate": "2020-10-28T02:07:57Z", "message": "Use default values for fields of input types when default arguments are provided"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f71a196f7c0fb8fc5c37c2f1fd868136e683cda0", "author": {"user": null}, "url": "https://github.com/graphql-java/graphql-java/commit/f71a196f7c0fb8fc5c37c2f1fd868136e683cda0", "committedDate": "2020-10-28T02:44:25Z", "message": "#1914 Shortened test name"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTE4Mjg2ODI2", "url": "https://github.com/graphql-java/graphql-java/pull/2085#pullrequestreview-518286826", "createdAt": "2020-10-28T02:47:06Z", "commit": {"oid": "f71a196f7c0fb8fc5c37c2f1fd868136e683cda0"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yOFQwMjo0NzowNlrOHpYBRQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yOFQwMjo0NzowNlrOHpYBRQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMzE0NzIwNQ==", "bodyText": "Performance of this statement can be improved by keeping a map of Object field's name and the field itself in ObjectValue class.", "url": "https://github.com/graphql-java/graphql-java/pull/2085#discussion_r513147205", "createdAt": "2020-10-28T02:47:06Z", "author": {"login": "priyaaggarwal24"}, "path": "src/main/java/graphql/schema/idl/SchemaGeneratorHelper.java", "diffHunk": "@@ -292,8 +293,13 @@ Object buildArrayValue(GraphQLType requiredType, ArrayValue arrayValue) {\n \n     Object buildObjectValue(ObjectValue defaultValue, GraphQLInputObjectType objectType) {\n         Map<String, Object> map = new LinkedHashMap<>();\n-        defaultValue.getObjectFields().forEach(of -> map.put(of.getName(),\n-                buildValue(of.getValue(), objectType.getField(of.getName()).getType())));\n+        objectType.getFieldDefinitions().forEach(\n+                f -> {\n+                    final Value<?> fieldValueFromDefaultObjectValue = defaultValue.getObjectFields().stream()", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f71a196f7c0fb8fc5c37c2f1fd868136e683cda0"}, "originalPosition": 16}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTE4Mjg3NTky", "url": "https://github.com/graphql-java/graphql-java/pull/2085#pullrequestreview-518287592", "createdAt": "2020-10-28T02:49:35Z", "commit": {"oid": "f71a196f7c0fb8fc5c37c2f1fd868136e683cda0"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yOFQwMjo0OTozNlrOHpYDww==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yOFQwMjo0OTozNlrOHpYDww==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMzE0Nzg0Mw==", "bodyText": "Introspection of schema now considers the default values defined in Input types.", "url": "https://github.com/graphql-java/graphql-java/pull/2085#discussion_r513147843", "createdAt": "2020-10-28T02:49:36Z", "author": {"login": "priyaaggarwal24"}, "path": "src/test/groovy/graphql/introspection/IntrospectionResultToSchemaTest.groovy", "diffHunk": "@@ -590,7 +590,7 @@ input CharacterInput {\n }\n \n type Query {\n-  outputField(inputArg: InputType = {age : 666, name : \"nameViaArg\"}, inputBoolean: Boolean = true, inputInt: Int = 1, inputString: String = \"viaArgString\"): OutputType\n+  outputField(inputArg: InputType = {age : 666, complex : {boolean : true, int : 666, string : \"string\"}, name : \"nameViaArg\", rocks : true}, inputBoolean: Boolean = true, inputInt: Int = 1, inputString: String = \"viaArgString\"): OutputType", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f71a196f7c0fb8fc5c37c2f1fd868136e683cda0"}, "originalPosition": 5}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e7ad9278e7530a4e05892e03b36a18eabdfb18fb", "author": {"user": null}, "url": "https://github.com/graphql-java/graphql-java/commit/e7ad9278e7530a4e05892e03b36a18eabdfb18fb", "committedDate": "2020-10-30T01:30:25Z", "message": "#1914 Added a test to verify if null value provided in input overrides default"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTIwMjA1Nzg5", "url": "https://github.com/graphql-java/graphql-java/pull/2085#pullrequestreview-520205789", "createdAt": "2020-10-30T00:21:57Z", "commit": {"oid": "f71a196f7c0fb8fc5c37c2f1fd868136e683cda0"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0zMFQwMDoyMTo1N1rOHqzH9A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0zMFQwMTozNToxNFrOHq1Gow==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNDYzOTg2MA==", "bodyText": "fields of objects are typically < 10 say - iterating them is not  a real problem.  Also schema building is KN OWN to be a heavy thing they can be slower (where slower is not really slow) - So there are no perf savings to be had in schema generation as a rule\nThat is not to say it should be terrible - but that when people come to us about performance its NOT in the schema gen side of things", "url": "https://github.com/graphql-java/graphql-java/pull/2085#discussion_r514639860", "createdAt": "2020-10-30T00:21:57Z", "author": {"login": "bbakerman"}, "path": "src/main/java/graphql/schema/idl/SchemaGeneratorHelper.java", "diffHunk": "@@ -292,8 +293,13 @@ Object buildArrayValue(GraphQLType requiredType, ArrayValue arrayValue) {\n \n     Object buildObjectValue(ObjectValue defaultValue, GraphQLInputObjectType objectType) {\n         Map<String, Object> map = new LinkedHashMap<>();\n-        defaultValue.getObjectFields().forEach(of -> map.put(of.getName(),\n-                buildValue(of.getValue(), objectType.getField(of.getName()).getType())));\n+        objectType.getFieldDefinitions().forEach(\n+                f -> {\n+                    final Value<?> fieldValueFromDefaultObjectValue = defaultValue.getObjectFields().stream()", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMzE0NzIwNQ=="}, "originalCommit": {"oid": "f71a196f7c0fb8fc5c37c2f1fd868136e683cda0"}, "originalPosition": 16}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNDY0NjQ1NA==", "bodyText": "final Value<?> fieldValueFromDefaultObjectValue = defaultValue.getObjectFields().stream().filter(dvf -> dvf.getName().equals(f.getName())).map(ObjectField::getValue).findFirst().orElse(null);\nends up really hard to read.  I like to put in simple methods to represent this\nfinal Value<?> fieldValueFromDefaultObjectValue = buildFieldDefaultValue(defaultValue,...)", "url": "https://github.com/graphql-java/graphql-java/pull/2085#discussion_r514646454", "createdAt": "2020-10-30T00:47:42Z", "author": {"login": "bbakerman"}, "path": "src/main/java/graphql/schema/idl/SchemaGeneratorHelper.java", "diffHunk": "@@ -292,8 +293,13 @@ Object buildArrayValue(GraphQLType requiredType, ArrayValue arrayValue) {\n \n     Object buildObjectValue(ObjectValue defaultValue, GraphQLInputObjectType objectType) {\n         Map<String, Object> map = new LinkedHashMap<>();\n-        defaultValue.getObjectFields().forEach(of -> map.put(of.getName(),\n-                buildValue(of.getValue(), objectType.getField(of.getName()).getType())));\n+        objectType.getFieldDefinitions().forEach(\n+                f -> {\n+                    final Value<?> fieldValueFromDefaultObjectValue = defaultValue.getObjectFields().stream()\n+                            .filter(dvf -> dvf.getName().equals(f.getName())).map(ObjectField::getValue).findFirst().orElse(null);\n+                    map.put(f.getName(), fieldValueFromDefaultObjectValue != null ? buildValue(fieldValueFromDefaultObjectValue, f.getType()): f.getDefaultValue());\n+                }\n+        );\n         return map;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f71a196f7c0fb8fc5c37c2f1fd868136e683cda0"}, "originalPosition": 21}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNDY3MjI5MQ==", "bodyText": "Can we get another test in place for when the inner field is named BUT the value is null", "url": "https://github.com/graphql-java/graphql-java/pull/2085#discussion_r514672291", "createdAt": "2020-10-30T01:35:14Z", "author": {"login": "bbakerman"}, "path": "src/test/groovy/graphql/Issue1914.groovy", "diffHunk": "@@ -0,0 +1,81 @@\n+package graphql\n+\n+import graphql.schema.DataFetcher\n+import spock.lang.Specification\n+\n+class Issue1914 extends Specification {\n+\n+    def \"default values in input objects are respected when variable is not provided\"() {\n+        given:\n+        def spec = \"\"\"type Query {\n+            sayHello(arg: Arg! = {}): String\n+        }\n+        input Arg {\n+            foo: String = \"bar\"\n+        }\n+        \"\"\"\n+        DataFetcher df = { dfe ->\n+            Map arg = dfe.getArgument(\"arg\")\n+            return arg.get(\"foo\")\n+        } as DataFetcher\n+        def graphQL = TestUtil.graphQL(spec, [\"Query\": [\"sayHello\": df]]).build()\n+\n+        when:\n+        def result = graphQL.execute('{sayHello}')\n+\n+        then:\n+        result.errors.isEmpty()\n+        result.data == [sayHello: \"bar\"]\n+\n+    }\n+\n+    def \"default values in input objects are overridden when variable is provided\"() {\n+        given:\n+        def spec = \"\"\"type Query {\n+            sayHello(arg: Arg! = {foo: \"brewery\"}): String\n+        }\n+        input Arg {\n+            foo: String = \"bar\"\n+        }\n+        \"\"\"\n+        DataFetcher df = { dfe ->\n+            Map arg = dfe.getArgument(\"arg\")\n+            return arg.get(\"foo\")\n+        } as DataFetcher\n+        def graphQL = TestUtil.graphQL(spec, [\"Query\": [\"sayHello\": df]]).build()\n+\n+        when:\n+        def result = graphQL.execute('{sayHello}')\n+\n+        then:\n+        result.errors.isEmpty()\n+        result.data == [sayHello: \"brewery\"]\n+\n+    }\n+\n+    def \"default values in input objects are overridden when variable is provided and otherwise are respected\"() {\n+        given:\n+        def spec = \"\"\"type Query {\n+            sayHello(arg: Arg! = {field1: \"F1ValOverride\"}): String\n+        }\n+        input Arg {\n+            field1: String = \"F1V\"\n+            field2: String = \"F2V\"\n+        }\n+        \"\"\"\n+        DataFetcher df = { dfe ->\n+            Map arg = dfe.getArgument(\"arg\")\n+            return arg.get(\"field1\") + \" & \" + arg.get(\"field2\")\n+        } as DataFetcher\n+        def graphQL = TestUtil.graphQL(spec, [\"Query\": [\"sayHello\": df]]).build()\n+\n+        when:\n+        def result = graphQL.execute('{sayHello}')\n+\n+        then:\n+        result.errors.isEmpty()\n+        result.data == [sayHello: \"F1ValOverride & F2V\"]", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f71a196f7c0fb8fc5c37c2f1fd868136e683cda0"}, "originalPosition": 77}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f8dbacc8ede09935a5a5dbf50d11813899c5314f", "author": {"user": null}, "url": "https://github.com/graphql-java/graphql-java/commit/f8dbacc8ede09935a5a5dbf50d11813899c5314f", "committedDate": "2020-10-30T01:51:13Z", "message": "#1914 Added a test with field having null value and refactored a long statement into a method"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "edf49a29fc6c5f4177cf34d3cc11a4c653ca99f6", "author": {"user": null}, "url": "https://github.com/graphql-java/graphql-java/commit/edf49a29fc6c5f4177cf34d3cc11a4c653ca99f6", "committedDate": "2020-10-30T01:57:50Z", "message": "#1914 Updated test to have a field with default value null"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4378, "cost": 1, "resetAt": "2021-11-01T14:51:55Z"}}}