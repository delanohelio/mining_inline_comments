{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0MzY2NjI0NTk2", "number": 1772, "title": "add custom scalar Specification URL", "bodyText": "This is a major new feature for GraphQL: it allows you to specify a url for a custom scalar which should point to a document describing this scalar.\nIt is implemented via directive for SDL or as property on GraphQLScalar.\nscalar MyScalar @specifiedBy(url: \"https://example.com/myScala\")\n...\nThe specifiedByUrl can then be queried via Introspection:\n{__type(name: \"MyScalar\") {name specifiedByUrl} }\nSee graphql/graphql-spec#649 and graphql/graphql-js#2276 for all the details.", "createdAt": "2020-01-24T00:02:21Z", "url": "https://github.com/graphql-java/graphql-java/pull/1772", "merged": true, "mergeCommit": {"oid": "0b611f2f5d621edb389060c824b08a650cf3a950"}, "closed": true, "closedAt": "2020-05-21T08:30:56Z", "author": {"login": "andimarek"}, "timelineItems": {"totalCount": 16, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABb79ENWAH2gAyMzY2NjI0NTk2OjIzMDkwZjYzNTE3M2IzNTM1NWQ3N2JiZDA2OThlMmQ4ZjhjNGNjNzE=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcjZUm3AH2gAyMzY2NjI0NTk2OmE3N2VkYWI1ZGUyN2E4NDU2YmFmMWJkMjdlYmI5MjNlYmM4ZWI0YjU=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "23090f635173b35355d77bbd0698e2d8f8c4cc71", "author": {"user": {"login": "andimarek", "name": "Andreas Marek"}}, "url": "https://github.com/graphql-java/graphql-java/commit/23090f635173b35355d77bbd0698e2d8f8c4cc71", "committedDate": "2020-01-19T19:25:16Z", "message": "add specified by url (wip)"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ab5004f6b188f0108bad4f5c73123b7623ba9c84", "author": {"user": {"login": "andimarek", "name": "Andreas Marek"}}, "url": "https://github.com/graphql-java/graphql-java/commit/ab5004f6b188f0108bad4f5c73123b7623ba9c84", "committedDate": "2020-01-24T00:01:11Z", "message": "add specified by url directive"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "5b17b65ea6693e7ee3723f43f563f8900c3d15c0", "author": {"user": {"login": "andimarek", "name": "Andreas Marek"}}, "url": "https://github.com/graphql-java/graphql-java/commit/5b17b65ea6693e7ee3723f43f563f8900c3d15c0", "committedDate": "2020-01-24T00:09:01Z", "message": "formatting"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "11186a6284711b63e71162302689bd13c37aa618", "author": {"user": {"login": "andimarek", "name": "Andreas Marek"}}, "url": "https://github.com/graphql-java/graphql-java/commit/11186a6284711b63e71162302689bd13c37aa618", "committedDate": "2020-05-20T00:14:40Z", "message": "Merge branch 'master' into specified-by-url"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ad30ab35906c0a376bafd30d7bd249299e131dc7", "author": {"user": {"login": "andimarek", "name": "Andreas Marek"}}, "url": "https://github.com/graphql-java/graphql-java/commit/ad30ab35906c0a376bafd30d7bd249299e131dc7", "committedDate": "2020-05-20T02:18:16Z", "message": "fix tests, rename to specifiedByUrl"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e6f868433769be178ddf1eb4c4c6802721b5668e", "author": {"user": {"login": "andimarek", "name": "Andreas Marek"}}, "url": "https://github.com/graphql-java/graphql-java/commit/e6f868433769be178ddf1eb4c4c6802721b5668e", "committedDate": "2020-05-20T03:30:45Z", "message": "cleanup and consistent description"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f3dba37acbde19a1dcb1408c82bfbab62de664d4", "author": {"user": {"login": "andimarek", "name": "Andreas Marek"}}, "url": "https://github.com/graphql-java/graphql-java/commit/f3dba37acbde19a1dcb1408c82bfbab62de664d4", "committedDate": "2020-05-20T05:50:14Z", "message": "more tests"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "1afa487bfd28a878fe57c190e0e272487cc57b95", "author": {"user": {"login": "andimarek", "name": "Andreas Marek"}}, "url": "https://github.com/graphql-java/graphql-java/commit/1afa487bfd28a878fe57c190e0e272487cc57b95", "committedDate": "2020-05-20T06:05:45Z", "message": "more tests"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "bae1d4f7b0acbdc8441f301c6d4f2a71ab27feb4", "author": {"user": {"login": "andimarek", "name": "Andreas Marek"}}, "url": "https://github.com/graphql-java/graphql-java/commit/bae1d4f7b0acbdc8441f301c6d4f2a71ab27feb4", "committedDate": "2020-05-20T06:09:41Z", "message": "cleanup"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b01b2a495f96664ae71b7cb0b28149aecbb0e774", "author": {"user": {"login": "andimarek", "name": "Andreas Marek"}}, "url": "https://github.com/graphql-java/graphql-java/commit/b01b2a495f96664ae71b7cb0b28149aecbb0e774", "committedDate": "2020-05-20T23:21:56Z", "message": "add integration test"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "6c6dd4d0f34221dad88d647c1649e5db8e6cab66", "author": {"user": {"login": "andimarek", "name": "Andreas Marek"}}, "url": "https://github.com/graphql-java/graphql-java/commit/6c6dd4d0f34221dad88d647c1649e5db8e6cab66", "committedDate": "2020-05-21T05:57:32Z", "message": "Merge branch 'master' into specified-by-url"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDE1OTM1OTE2", "url": "https://github.com/graphql-java/graphql-java/pull/1772#pullrequestreview-415935916", "createdAt": "2020-05-21T07:29:32Z", "commit": {"oid": "6c6dd4d0f34221dad88d647c1649e5db8e6cab66"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yMVQwNzoyOTozMlrOGYpCdg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yMVQwNzoyOTozMlrOGYpCdg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyODQ5MTM4Mg==", "bodyText": "spillin - Scalar (not Scala - never Scala)", "url": "https://github.com/graphql-java/graphql-java/pull/1772#discussion_r428491382", "createdAt": "2020-05-21T07:29:32Z", "author": {"login": "bbakerman"}, "path": "src/main/java/graphql/Directives.java", "diffHunk": "@@ -64,11 +65,23 @@\n             .description(\"Marks the field or enum value as deprecated\")\n             .argument(newArgument()\n                     .name(\"reason\")\n-                    .type(nonNull(GraphQLString))\n+                    .type(GraphQLString)\n                     .defaultValue(\"No longer supported\")\n                     .description(\"The reason for the deprecation\"))\n             .validLocations(FIELD_DEFINITION, ENUM_VALUE)\n             .build();\n \n+    /**\n+     * The \"specifiedBy\" directive allows to provide a specification URL for a Scala", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "6c6dd4d0f34221dad88d647c1649e5db8e6cab66"}, "originalPosition": 20}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDE1OTM2NzA1", "url": "https://github.com/graphql-java/graphql-java/pull/1772#pullrequestreview-415936705", "createdAt": "2020-05-21T07:31:04Z", "commit": {"oid": "6c6dd4d0f34221dad88d647c1649e5db8e6cab66"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yMVQwNzozMTowNFrOGYpE7g==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yMVQwNzozMTowNFrOGYpE7g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyODQ5MjAxNA==", "bodyText": "one version we need to remove the old constructors!", "url": "https://github.com/graphql-java/graphql-java/pull/1772#discussion_r428492014", "createdAt": "2020-05-21T07:31:04Z", "author": {"login": "bbakerman"}, "path": "src/main/java/graphql/schema/GraphQLScalarType.java", "diffHunk": "@@ -73,10 +74,16 @@ public GraphQLScalarType(String name, String description, Coercing coercing) {\n     @Internal\n     @Deprecated\n     public GraphQLScalarType(String name, String description, Coercing coercing, List<GraphQLDirective> directives, ScalarTypeDefinition definition) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "6c6dd4d0f34221dad88d647c1649e5db8e6cab66"}, "originalPosition": 11}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDE1OTM3NzY0", "url": "https://github.com/graphql-java/graphql-java/pull/1772#pullrequestreview-415937764", "createdAt": "2020-05-21T07:33:11Z", "commit": {"oid": "6c6dd4d0f34221dad88d647c1649e5db8e6cab66"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yMVQwNzozMzoxMVrOGYpITA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yMVQwNzozMzoxMVrOGYpITA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyODQ5Mjg3Ng==", "bodyText": "Thought - Will it always be non null arg values?", "url": "https://github.com/graphql-java/graphql-java/pull/1772#discussion_r428492876", "createdAt": "2020-05-21T07:33:11Z", "author": {"login": "bbakerman"}, "path": "src/main/java/graphql/schema/idl/SchemaGenerator.java", "diffHunk": "@@ -694,17 +697,32 @@ private GraphQLScalarType buildScalar(BuildContext buildCtx, ScalarTypeDefinitio\n             scalar = scalar.transform(builder -> builder\n                     .definition(typeDefinition)\n                     .comparatorRegistry(buildCtx.getComparatorRegistry())\n-                    .withDirectives(\n-                            buildDirectives(typeDefinition.getDirectives(),\n-                                    directivesOf(extensions), SCALAR, buildCtx.getDirectiveDefinitions(), buildCtx.getComparatorRegistry())\n+                    .specifiedByUrl(getSpecifiedByUrl(typeDefinition, extensions))\n+                    .withDirectives(buildDirectives(\n+                            typeDefinition.getDirectives(),\n+                            directivesOf(extensions),\n+                            SCALAR,\n+                            buildCtx.getDirectiveDefinitions(),\n+                            buildCtx.getComparatorRegistry())\n                     ));\n-            //\n-            // only allow modification of custom scalars\n             scalar = directiveBehaviour.onScalar(scalar, buildCtx.mkBehaviourParams());\n         }\n         return scalar;\n     }\n \n+    private String getSpecifiedByUrl(ScalarTypeDefinition scalarTypeDefinition, List<ScalarTypeExtensionDefinition> extensions) {\n+        List<Directive> allDirectives = new ArrayList<>(scalarTypeDefinition.getDirectives());\n+        extensions.forEach(extension -> allDirectives.addAll(extension.getDirectives()));\n+        Optional<Directive> specifiedByDirective = FpKit.findOne(allDirectives,\n+                directiveDefinition -> directiveDefinition.getName().equals(Directives.SpecifiedByDirective.getName()));\n+        if (!specifiedByDirective.isPresent()) {\n+            return null;\n+        }\n+        Argument urlArgument = specifiedByDirective.get().getArgument(\"url\");\n+        StringValue url = (StringValue) urlArgument.getValue();\n+        return url.getValue();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "6c6dd4d0f34221dad88d647c1649e5db8e6cab66"}, "originalPosition": 76}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDE1OTM4ODMw", "url": "https://github.com/graphql-java/graphql-java/pull/1772#pullrequestreview-415938830", "createdAt": "2020-05-21T07:35:19Z", "commit": {"oid": "6c6dd4d0f34221dad88d647c1649e5db8e6cab66"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a77edab5de27a8456baf1bd27ebb923ebc8eb4b5", "author": {"user": {"login": "andimarek", "name": "Andreas Marek"}}, "url": "https://github.com/graphql-java/graphql-java/commit/a77edab5de27a8456baf1bd27ebb923ebc8eb4b5", "committedDate": "2020-05-21T08:23:34Z", "message": "typo"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4390, "cost": 1, "resetAt": "2021-11-01T14:51:55Z"}}}