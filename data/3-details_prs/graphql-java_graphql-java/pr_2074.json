{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTAzODU0NzQ2", "number": 2074, "title": "avoiding allocations in FieldCollectorParameters and MergedField", "bodyText": "ExecutionContext uses immutable maps for variables and fragments, that could be shared freely.\nAnd, since this is an internal class, we could change a bit the contract and avoid some allocations of LinkedHashMap:\n            .fragments(executionContext.getFragmentsByName())\n            .variables(executionContext.getVariables())", "createdAt": "2020-10-15T06:16:15Z", "url": "https://github.com/graphql-java/graphql-java/pull/2074", "merged": true, "mergeCommit": {"oid": "31f44d801e71af27a5015c2f7961abf2bc560821"}, "closed": true, "closedAt": "2020-10-21T09:31:07Z", "author": {"login": "dfa1"}, "timelineItems": {"totalCount": 5, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdSrcMTgH2gAyNTAzODU0NzQ2OmFlNDZhNDA5ZjAyOTU5NjcwZmI1NGYwMTk4NTk4YTM0OTJmZDBlMDc=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdUCGZVgFqTUxMTY0NTQ5MA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "ae46a409f02959670fb54f0198598a3492fd0e07", "author": {"user": {"login": "dfa1", "name": "Davide Angelocola"}}, "url": "https://github.com/graphql-java/graphql-java/commit/ae46a409f02959670fb54f0198598a3492fd0e07", "committedDate": "2020-10-15T06:04:35Z", "message": "avoiding LinkedHashMap allocations"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ee6ed0dd8ae6f36b36608a755159dff6b59d0911", "author": {"user": {"login": "dfa1", "name": "Davide Angelocola"}}, "url": "https://github.com/graphql-java/graphql-java/commit/ee6ed0dd8ae6f36b36608a755159dff6b59d0911", "committedDate": "2020-10-15T07:05:20Z", "message": "avoiding ArrayList allocations\n\nArrayList allocated in the Builder never escapes the builder, so\nit is possible to avoid one copy in the private ctor"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "9e6ff2a39d179ee20c201314a9755ad501335c1b", "author": {"user": {"login": "dfa1", "name": "Davide Angelocola"}}, "url": "https://github.com/graphql-java/graphql-java/commit/9e6ff2a39d179ee20c201314a9755ad501335c1b", "committedDate": "2020-10-15T06:50:53Z", "message": "avoiding ArrayList allocations\n\nArrayList allocated in the Builder never escapes the builder, so\nit is possible to avoid one copy in the private ctor"}, "afterCommit": {"oid": "ee6ed0dd8ae6f36b36608a755159dff6b59d0911", "author": {"user": {"login": "dfa1", "name": "Davide Angelocola"}}, "url": "https://github.com/graphql-java/graphql-java/commit/ee6ed0dd8ae6f36b36608a755159dff6b59d0911", "committedDate": "2020-10-15T07:05:20Z", "message": "avoiding ArrayList allocations\n\nArrayList allocated in the Builder never escapes the builder, so\nit is possible to avoid one copy in the private ctor"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTA5MDc3MDUx", "url": "https://github.com/graphql-java/graphql-java/pull/2074#pullrequestreview-509077051", "createdAt": "2020-10-15T07:08:49Z", "commit": {"oid": "ee6ed0dd8ae6f36b36608a755159dff6b59d0911"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xNVQwNzowODo0OVrOHh1gyA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xNVQwNzowODo0OVrOHh1gyA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNTI0MTgwMA==", "bodyText": "used only in tests, could be a breaking change.\nMaybe this is the root cause of the additional copy that I've just removed in the constructor.", "url": "https://github.com/graphql-java/graphql-java/pull/2074#discussion_r505241800", "createdAt": "2020-10-15T07:08:49Z", "author": {"login": "dfa1"}, "path": "src/main/java/graphql/execution/MergedField.java", "diffHunk": "@@ -155,7 +156,7 @@ private Builder(MergedField existing) {\n         }\n \n         public Builder fields(List<Field> fields) {\n-            this.fields = fields;\n+            this.fields.addAll(fields);\n             return this;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ee6ed0dd8ae6f36b36608a755159dff6b59d0911"}, "originalPosition": 25}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTExNjQ1NDkw", "url": "https://github.com/graphql-java/graphql-java/pull/2074#pullrequestreview-511645490", "createdAt": "2020-10-19T11:02:25Z", "commit": {"oid": "ee6ed0dd8ae6f36b36608a755159dff6b59d0911"}, "state": "APPROVED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xOVQxMTowMjoyNVrOHkJAqQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xOVQxMTowMjoyNVrOHkJAqQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNzY1ODQwOQ==", "bodyText": "This is a tricky one - generally we try for more immutable classes and hence by \"copying\" we gain some control in mutable Java land\nHowever as this class is repeatedly called, we probably need to change this general pattern if we see evidence that it costs us.", "url": "https://github.com/graphql-java/graphql-java/pull/2074#discussion_r507658409", "createdAt": "2020-10-19T11:02:25Z", "author": {"login": "bbakerman"}, "path": "src/main/java/graphql/execution/FieldCollectorParameters.java", "diffHunk": "@@ -70,12 +69,12 @@ public Builder objectType(GraphQLObjectType objectType) {\n         }\n \n         public Builder fragments(Map<String, FragmentDefinition> fragmentsByName) {\n-            this.fragmentsByName.putAll(fragmentsByName);\n+            this.fragmentsByName = fragmentsByName;\n             return this;\n         }\n \n         public Builder variables(Map<String, Object> variables) {\n-            this.variables.putAll(variables);\n+            this.variables = variables;\n             return this;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ee6ed0dd8ae6f36b36608a755159dff6b59d0911"}, "originalPosition": 31}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4364, "cost": 1, "resetAt": "2021-11-01T14:51:55Z"}}}