{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDAyMTU0OTUw", "number": 1859, "title": "New Validation rule: unique_variable_names", "bodyText": "details in #1858", "createdAt": "2020-04-11T07:44:53Z", "url": "https://github.com/graphql-java/graphql-java/pull/1859", "merged": true, "mergeCommit": {"oid": "f409b6665d9d822cc4d7e60ae3237806edd0966a"}, "closed": true, "closedAt": "2020-05-19T23:53:34Z", "author": {"login": "dugenkui03"}, "timelineItems": {"totalCount": 7, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcYGbhCgFqTM5NDMyMzI1OA==", "endCursor": "Y3Vyc29yOnYyOpPPAAABci4hCygH2gAyNDAyMTU0OTUwOjdkZDk2YWE0NGZmMDI0YWVhZmVmYmE3OGEyYWRlNGM0YWQ5ZjNiZGE=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzk0MzIzMjU4", "url": "https://github.com/graphql-java/graphql-java/pull/1859#pullrequestreview-394323258", "createdAt": "2020-04-16T06:09:45Z", "commit": {"oid": "2751c40c834f29ed842df4e196123eb3c5f0d9f0"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0xNlQwNjowOTo0NVrOGGV8Jg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0xNlQwNjowOTo0NVrOGGV8Jg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwOTMwNDEwMg==", "bodyText": "Please change this back.  We use non .* imports", "url": "https://github.com/graphql-java/graphql-java/pull/1859#discussion_r409304102", "createdAt": "2020-04-16T06:09:45Z", "author": {"login": "bbakerman"}, "path": "src/main/java/graphql/validation/Validator.java", "diffHunk": "@@ -4,32 +4,7 @@\n import graphql.Internal;\n import graphql.language.Document;\n import graphql.schema.GraphQLSchema;\n-import graphql.validation.rules.ArgumentsOfCorrectType;\n-import graphql.validation.rules.DeferredDirectiveOnNonNullableField;\n-import graphql.validation.rules.DeferredDirectiveOnQueryOperation;\n-import graphql.validation.rules.DeferredMustBeOnAllFields;\n-import graphql.validation.rules.ExecutableDefinitions;\n-import graphql.validation.rules.FieldsOnCorrectType;\n-import graphql.validation.rules.FragmentsOnCompositeType;\n-import graphql.validation.rules.KnownArgumentNames;\n-import graphql.validation.rules.KnownDirectives;\n-import graphql.validation.rules.KnownFragmentNames;\n-import graphql.validation.rules.KnownTypeNames;\n-import graphql.validation.rules.LoneAnonymousOperation;\n-import graphql.validation.rules.NoFragmentCycles;\n-import graphql.validation.rules.NoUndefinedVariables;\n-import graphql.validation.rules.NoUnusedFragments;\n-import graphql.validation.rules.NoUnusedVariables;\n-import graphql.validation.rules.OverlappingFieldsCanBeMerged;\n-import graphql.validation.rules.PossibleFragmentSpreads;\n-import graphql.validation.rules.ProvidedNonNullArguments;\n-import graphql.validation.rules.ScalarLeafs;\n-import graphql.validation.rules.UniqueDirectiveNamesPerLocation;\n-import graphql.validation.rules.UniqueFragmentNames;\n-import graphql.validation.rules.UniqueOperationNames;\n-import graphql.validation.rules.VariableDefaultValuesOfCorrectType;\n-import graphql.validation.rules.VariableTypesMatchRule;\n-import graphql.validation.rules.VariablesAreInputTypes;\n+import graphql.validation.rules.*;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "2751c40c834f29ed842df4e196123eb3c5f0d9f0"}, "originalPosition": 30}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "52ab4771cc98b627bf1ab470d404c78f8edf4727", "author": {"user": {"login": "dugenkui03", "name": "dugenkui"}}, "url": "https://github.com/graphql-java/graphql-java/commit/52ab4771cc98b627bf1ab470d404c78f8edf4727", "committedDate": "2020-04-16T13:06:23Z", "message": "unique_variable_names"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "2751c40c834f29ed842df4e196123eb3c5f0d9f0", "author": {"user": {"login": "dugenkui03", "name": "dugenkui"}}, "url": "https://github.com/graphql-java/graphql-java/commit/2751c40c834f29ed842df4e196123eb3c5f0d9f0", "committedDate": "2020-04-11T07:25:37Z", "message": "unique_variable_names"}, "afterCommit": {"oid": "52ab4771cc98b627bf1ab470d404c78f8edf4727", "author": {"user": {"login": "dugenkui03", "name": "dugenkui"}}, "url": "https://github.com/graphql-java/graphql-java/commit/52ab4771cc98b627bf1ab470d404c78f8edf4727", "committedDate": "2020-04-16T13:06:23Z", "message": "unique_variable_names"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzk1MDcwMjcy", "url": "https://github.com/graphql-java/graphql-java/pull/1859#pullrequestreview-395070272", "createdAt": "2020-04-16T23:39:30Z", "commit": {"oid": "52ab4771cc98b627bf1ab470d404c78f8edf4727"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0xNlQyMzozOTozMFrOGG66Eg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0xNlQyMzozOTozMFrOGG66Eg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwOTkwOTc3OA==", "bodyText": "FYI - triple quoted single quotes means you never have to escape $ things\n    def query = '''\n             query($arg:Int,$arg:Int){\n                field(arg: $arg)\n             } \n          '''", "url": "https://github.com/graphql-java/graphql-java/pull/1859#discussion_r409909778", "createdAt": "2020-04-16T23:39:30Z", "author": {"login": "bbakerman"}, "path": "src/test/groovy/graphql/validation/rules/UniqueVariableNamesRulerTest.groovy", "diffHunk": "@@ -0,0 +1,51 @@\n+package graphql.validation.rules\n+\n+import graphql.TestUtil\n+import graphql.parser.Parser\n+import graphql.validation.ValidationError\n+import graphql.validation.ValidationErrorType\n+import graphql.validation.Validator\n+import spock.lang.Specification\n+\n+class UniqueVariableNamesRulerTest extends Specification {\n+\n+    def schema = TestUtil.schema('''\n+            type Query {\n+                field(arg: Int) : String\n+            }\n+        ''')\n+\n+    def \"normal query \"() {\n+\n+        def query = \"\"\"\n+             query(\\$arg:Int){\n+                field(arg: \\$arg)\n+             } \n+          \"\"\"\n+\n+        when:\n+        def document = Parser.parse(query)\n+        def validationResult = new Validator().validateDocument(schema, document)\n+\n+        then:\n+        validationResult.size() == 0\n+    }\n+\n+    def \"duplicate variable name error\"() {\n+\n+        def query = \"\"\"\n+             query(\\$arg:Int,\\$arg:Int){\n+                field(arg: \\$arg)\n+             } \n+          \"\"\"", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "52ab4771cc98b627bf1ab470d404c78f8edf4727"}, "originalPosition": 40}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzk1MDcwMzU2", "url": "https://github.com/graphql-java/graphql-java/pull/1859#pullrequestreview-395070356", "createdAt": "2020-04-16T23:39:47Z", "commit": {"oid": "52ab4771cc98b627bf1ab470d404c78f8edf4727"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDE0MTg0OTc2", "url": "https://github.com/graphql-java/graphql-java/pull/1859#pullrequestreview-414184976", "createdAt": "2020-05-19T07:48:19Z", "commit": {"oid": "52ab4771cc98b627bf1ab470d404c78f8edf4727"}, "state": "APPROVED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xOVQwNzo0ODoxOVrOGXT8Uw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xOVQwNzo0ODo0NFrOGXT9RA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNzA5NzE3MQ==", "bodyText": "we use LinkedHashSet in general in favor of HashSet because it preserves the order.", "url": "https://github.com/graphql-java/graphql-java/pull/1859#discussion_r427097171", "createdAt": "2020-05-19T07:48:19Z", "author": {"login": "andimarek"}, "path": "src/main/java/graphql/validation/rules/UniqueVariableNamesRule.java", "diffHunk": "@@ -0,0 +1,47 @@\n+package graphql.validation.rules;\n+\n+import graphql.language.*;\n+import graphql.validation.AbstractRule;\n+import graphql.validation.ValidationContext;\n+import graphql.validation.ValidationErrorCollector;\n+import graphql.validation.ValidationErrorType;\n+\n+import java.util.HashSet;\n+import java.util.List;\n+import java.util.Set;\n+\n+/**\n+ * Unique variable names\n+ * <p>\n+ * A GraphQL operation is only valid if all its variables are uniquely named.\n+ */\n+public class UniqueVariableNamesRule extends AbstractRule {\n+\n+    public UniqueVariableNamesRule(ValidationContext validationContext, ValidationErrorCollector validationErrorCollector) {\n+        super(validationContext, validationErrorCollector);\n+    }\n+\n+    @Override\n+    public void checkOperationDefinition(OperationDefinition operationDefinition) {\n+        List<VariableDefinition> variableDefinitions = operationDefinition.getVariableDefinitions();\n+        if (variableDefinitions == null || variableDefinitions.size() <= 1) {\n+            return;\n+        }\n+\n+        Set<String> variableNameList = new HashSet<>(variableDefinitions.size());", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "52ab4771cc98b627bf1ab470d404c78f8edf4727"}, "originalPosition": 31}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNzA5NzQxMg==", "bodyText": "please have a look at the intellij formatter inside the root folder: we don't use * imports.", "url": "https://github.com/graphql-java/graphql-java/pull/1859#discussion_r427097412", "createdAt": "2020-05-19T07:48:44Z", "author": {"login": "andimarek"}, "path": "src/main/java/graphql/validation/rules/UniqueVariableNamesRule.java", "diffHunk": "@@ -0,0 +1,47 @@\n+package graphql.validation.rules;\n+\n+import graphql.language.*;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "52ab4771cc98b627bf1ab470d404c78f8edf4727"}, "originalPosition": 3}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "7dd96aa44ff024aeafefba78a2ade4c4ad9f3bda", "author": {"user": {"login": "dugenkui03", "name": "dugenkui"}}, "url": "https://github.com/graphql-java/graphql-java/commit/7dd96aa44ff024aeafefba78a2ade4c4ad9f3bda", "committedDate": "2020-05-19T18:10:17Z", "message": "remove '*' imports; replace HashSet with LinkedHashSet, in ValidationErrorType."}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4430, "cost": 1, "resetAt": "2021-11-01T14:51:55Z"}}}