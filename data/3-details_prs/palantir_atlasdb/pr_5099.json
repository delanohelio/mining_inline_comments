{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTE1NTIwMzIx", "number": 5099, "title": "[TS] Allow configuration of lower batch size", "bodyText": "Goals (and why):\nWith autotuning we attempt to construct batches of up to 100k entries. This is generally what we want, as if there are so many entries we want to catch up as soon as possible. However it can take ~30min to process such an iteration, while sometimes we prefer to be slightly slower but able to be more uniformly up to date.\nImplementation Description (bullets):\nMostly wiring\nTesting (What was existing testing like?  What have you done to improve it?):\nSome tests to verify it works as expected, and that sweep delay treats it sanely\nConcerns (what feedback would you like?):\nDid I miss something?\nWhere should we start reviewing?:\nSmall\nPriority (whenever / two weeks / yesterday):\nasap", "createdAt": "2020-11-04T17:04:16Z", "url": "https://github.com/palantir/atlasdb/pull/5099", "merged": true, "mergeCommit": {"oid": "9d7d702f9f4254cb5954eedfbb189727a0ced420"}, "closed": true, "closedAt": "2021-01-08T20:14:24Z", "author": {"login": "gmaretic"}, "timelineItems": {"totalCount": 10, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdZOr23gH2gAyNTE1NTIwMzIxOjYxNmU2ODRmZWEzZGE4MTQyMDNiZWY4ZjRmZjljMmM4YzQzMWFlY2Q=", "endCursor": "Y3Vyc29yOnYyOpPPAAABduNRdJgH2gAyNTE1NTIwMzIxOjA0OTUxNWRkZjA0MGU0MmU0ZDQzOTQ1OWY0YjEzYmU0ZGMzN2IwZGU=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "616e684fea3da814203bef8f4ff9c2c8c431aecd", "author": {"user": {"login": "gmaretic", "name": null}}, "url": "https://github.com/palantir/atlasdb/commit/616e684fea3da814203bef8f4ff9c2c8c431aecd", "committedDate": "2020-11-04T14:31:55Z", "message": "Wip"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "858aba1006383be074865d9d0b9c22dd69c77910", "author": {"user": {"login": "gmaretic", "name": null}}, "url": "https://github.com/palantir/atlasdb/commit/858aba1006383be074865d9d0b9c22dd69c77910", "committedDate": "2020-11-04T15:16:34Z", "message": "Add config for cells threshold in sweep batch"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e19d79ac92df2a813ba49ccd777cf20e0a35e7f8", "author": {"user": {"login": "gmaretic", "name": null}}, "url": "https://github.com/palantir/atlasdb/commit/e19d79ac92df2a813ba49ccd777cf20e0a35e7f8", "committedDate": "2020-11-04T16:23:01Z", "message": "Wire into SweepDelay"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "3c3dd5797e33863eed007abc10caf78840313313", "author": {"user": {"login": "gmaretic", "name": null}}, "url": "https://github.com/palantir/atlasdb/commit/3c3dd5797e33863eed007abc10caf78840313313", "committedDate": "2020-11-04T16:23:01Z", "message": "Add generated changelog entries"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTI0NTQyNDQx", "url": "https://github.com/palantir/atlasdb/pull/5099#pullrequestreview-524542441", "createdAt": "2020-11-05T18:20:07Z", "commit": {"oid": "3c3dd5797e33863eed007abc10caf78840313313"}, "state": "COMMENTED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTU0NzU0NTc4", "url": "https://github.com/palantir/atlasdb/pull/5099#pullrequestreview-554754578", "createdAt": "2020-12-17T16:09:15Z", "commit": {"oid": "3c3dd5797e33863eed007abc10caf78840313313"}, "state": "APPROVED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xN1QxNjowOToxNlrOIH9A-A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xN1QxNjowOToxNlrOIH9A-A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NTIxMDYxNg==", "bodyText": "minor nits: config objects typically have just values. I'd suggest we either pass Supplier<RBRC> and use some Suppliers.transform(...) higher up, or rename this ReadBatchingRuntimeContext or something like that", "url": "https://github.com/palantir/atlasdb/pull/5099#discussion_r545210616", "createdAt": "2020-12-17T16:09:16Z", "author": {"login": "jeremyk-91"}, "path": "atlasdb-impl-shared/src/main/java/com/palantir/atlasdb/sweep/queue/SweepQueueReader.java", "diffHunk": "@@ -50,4 +50,16 @@ SweepBatchWithPartitionInfo getNextBatchToSweep(ShardAndStrategy shardStrategy,\n         }\n         return accumulator.toSweepBatch();\n     }\n+\n+    @Immutable\n+    public interface ReadBatchingRuntimeConfig {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "3c3dd5797e33863eed007abc10caf78840313313"}, "originalPosition": 41}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "abd0c1b8ee132e6f6f4b317013bd3a43ea414de7", "author": {"user": {"login": "gmaretic", "name": null}}, "url": "https://github.com/palantir/atlasdb/commit/abd0c1b8ee132e6f6f4b317013bd3a43ea414de7", "committedDate": "2021-01-08T17:43:58Z", "message": "Address CR and reduce default sweep batch size as discussed offline"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f4d90a8ee24245cdaaecaea1641fb158b0939d1d", "author": {"user": {"login": "gmaretic", "name": null}}, "url": "https://github.com/palantir/atlasdb/commit/f4d90a8ee24245cdaaecaea1641fb158b0939d1d", "committedDate": "2021-01-08T17:49:16Z", "message": "Allow setting the config back to 100k"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c8e5efdb137b0887b1625948fd7d57b396b44c6c", "author": {"user": {"login": "gmaretic", "name": null}}, "url": "https://github.com/palantir/atlasdb/commit/c8e5efdb137b0887b1625948fd7d57b396b44c6c", "committedDate": "2021-01-08T17:49:16Z", "message": "Add generated changelog entries"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "049515ddf040e42e4d439459f4b13be4dc37b0de", "author": {"user": {"login": "gmaretic", "name": null}}, "url": "https://github.com/palantir/atlasdb/commit/049515ddf040e42e4d439459f4b13be4dc37b0de", "committedDate": "2021-01-08T18:45:35Z", "message": "Merge branch 'develop' of github.com:palantir/atlasdb into ts/better"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2479, "cost": 1, "resetAt": "2021-11-01T16:19:10Z"}}}