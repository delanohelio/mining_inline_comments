{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDY2OTQ3NTgz", "number": 4941, "title": "Much less ram used by disruptors", "bodyText": "Disruptors at the moment hold their arguments and results for potentially far longer\nthan their expected lifetime. We use large buffers and so likely 16k copies of the arg\nand result are held, per autobatcher (internally we might have 300, or 5M copies of the results, spans, etc).", "createdAt": "2020-08-12T18:54:00Z", "url": "https://github.com/palantir/atlasdb/pull/4941", "merged": true, "mergeCommit": {"oid": "b647d5109f89fd270b50e7bd3539b77b38e559de"}, "closed": true, "closedAt": "2020-08-13T10:27:31Z", "author": {"login": "j-baker"}, "timelineItems": {"totalCount": 8, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABc-atpxgH2gAyNDY2OTQ3NTgzOmUzMmE1OWIyMTMyZmRlZTBkZjc2ZWZkNmZiNjQ2MDAxMzAxNGQ5MDQ=", "endCursor": "Y3Vyc29yOnYyOpPPAAABc-dQJMAH2gAyNDY2OTQ3NTgzOmFlMjNkZWJhMDE5ZTNlZDE1ODgzYzdmY2ZjNmU5NWUwZDk0MDc3NTI=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "e32a59b2132fdee0df76efd6fb6460013014d904", "author": {"user": {"login": "j-baker", "name": "James Baker"}}, "url": "https://github.com/palantir/atlasdb/commit/e32a59b2132fdee0df76efd6fb6460013014d904", "committedDate": "2020-08-13T07:16:47Z", "message": "Reattempt"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "3084c84a9532139785e526dee25fcb7f1fef1113", "author": {"user": {"login": "j-baker", "name": "James Baker"}}, "url": "https://github.com/palantir/atlasdb/commit/3084c84a9532139785e526dee25fcb7f1fef1113", "committedDate": "2020-08-13T07:16:47Z", "message": "Add generated changelog entries"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "5e6283104c98bd61dc95871e471f27d873d2a6e7", "author": {"user": {"login": "j-baker", "name": "James Baker"}}, "url": "https://github.com/palantir/atlasdb/commit/5e6283104c98bd61dc95871e471f27d873d2a6e7", "committedDate": "2020-08-12T18:52:14Z", "message": "Add generated changelog entries"}, "afterCommit": {"oid": "e32a59b2132fdee0df76efd6fb6460013014d904", "author": {"user": {"login": "j-baker", "name": "James Baker"}}, "url": "https://github.com/palantir/atlasdb/commit/e32a59b2132fdee0df76efd6fb6460013014d904", "committedDate": "2020-08-13T07:16:47Z", "message": "Reattempt"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "10c62bf02f3af4a29fd9cb33e38a2441f20fd52e", "author": {"user": {"login": "j-baker", "name": "James Baker"}}, "url": "https://github.com/palantir/atlasdb/commit/10c62bf02f3af4a29fd9cb33e38a2441f20fd52e", "committedDate": "2020-08-13T07:26:16Z", "message": "Not actually a batch element"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ee252fd795610958f5d6eb8e40cf4eba9321dbbb", "author": {"user": {"login": "j-baker", "name": "James Baker"}}, "url": "https://github.com/palantir/atlasdb/commit/ee252fd795610958f5d6eb8e40cf4eba9321dbbb", "committedDate": "2020-08-13T09:14:42Z", "message": "Args are nullable"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDY2NjA4MjI0", "url": "https://github.com/palantir/atlasdb/pull/4941#pullrequestreview-466608224", "createdAt": "2020-08-13T09:46:23Z", "commit": {"oid": "10c62bf02f3af4a29fd9cb33e38a2441f20fd52e"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDY2NjA5MDYy", "url": "https://github.com/palantir/atlasdb/pull/4941#pullrequestreview-466609062", "createdAt": "2020-08-13T09:47:34Z", "commit": {"oid": "ee252fd795610958f5d6eb8e40cf4eba9321dbbb"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xM1QwOTo0NzozNFrOHAERjg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xM1QwOTo0NzozNFrOHAERjg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2OTgzMjA3OA==", "bodyText": "nit: this has 129 chars - quick refactor please", "url": "https://github.com/palantir/atlasdb/pull/4941#discussion_r469832078", "createdAt": "2020-08-13T09:47:34Z", "author": {"login": "jeremyk-91"}, "path": "atlasdb-autobatch/src/main/java/com/palantir/atlasdb/autobatch/DisruptorAutobatcher.java", "diffHunk": "@@ -159,9 +160,9 @@ public boolean setFuture(ListenableFuture<? extends R> future) {\n             EventHandler<BatchElement<T, R>> eventHandler,\n             int bufferSize,\n             String safeLoggablePurpose) {\n-        Disruptor<DefaultBatchElement<T, R>> disruptor =\n-                new Disruptor<>(DefaultBatchElement::new, bufferSize, threadFactory(safeLoggablePurpose));\n-        disruptor.handleEventsWith(eventHandler);\n+        Disruptor<DisruptorBatchElement<T, R>> disruptor =\n+                new Disruptor<>(DisruptorBatchElement::new, bufferSize, threadFactory(safeLoggablePurpose));\n+        disruptor.handleEventsWith((event, sequence, endOfBatch) -> eventHandler.onEvent(event.consume(), sequence, endOfBatch));", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ee252fd795610958f5d6eb8e40cf4eba9321dbbb"}, "originalPosition": 57}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ae23deba019e3ed15883c7fcfc6e95e0d9407752", "author": {"user": {"login": "jeremyk-91", "name": "Jeremy Kong"}}, "url": "https://github.com/palantir/atlasdb/commit/ae23deba019e3ed15883c7fcfc6e95e0d9407752", "committedDate": "2020-08-13T10:14:16Z", "message": "checkstyle"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2795, "cost": 1, "resetAt": "2021-11-01T16:19:10Z"}}}