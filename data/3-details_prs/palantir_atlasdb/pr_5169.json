{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTQzNzg5OTcz", "number": 5169, "title": "Excavator: Upgrades Baseline to the latest version", "bodyText": "excavator is a bot for automating changes across repositories.\nChanges produced by the roomba/latest-baseline-oss check.\nTo enable or disable this check, please contact the maintainers of Excavator.", "createdAt": "2020-12-22T00:04:55Z", "url": "https://github.com/palantir/atlasdb/pull/5169", "merged": true, "mergeCommit": {"oid": "e75db01e281f12bd105b1ebf8623858866551ae9"}, "closed": true, "closedAt": "2021-01-26T11:06:21Z", "author": {"login": "svc-excavator-bot"}, "timelineItems": {"totalCount": 23, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdqw0clgBqjQxNTM0MjkwNDM=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdz5ezAAFqTU3NjI0MzI4MA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "012da330ebfdd93921c646cb8cc41486e2235906", "author": {"user": {"login": "svc-excavator-bot", "name": "Excavator Bot"}}, "url": "https://github.com/palantir/atlasdb/commit/012da330ebfdd93921c646cb8cc41486e2235906", "committedDate": "2020-12-22T00:04:51Z", "message": "Excavator: Upgrades Baseline to the latest version"}, "afterCommit": {"oid": "4c08e41007e020b055fd59668cd0677c267b7e31", "author": {"user": {"login": "svc-excavator-bot", "name": "Excavator Bot"}}, "url": "https://github.com/palantir/atlasdb/commit/4c08e41007e020b055fd59668cd0677c267b7e31", "committedDate": "2020-12-29T01:54:42Z", "message": "Excavator: Upgrades Baseline to the latest version"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "4c08e41007e020b055fd59668cd0677c267b7e31", "author": {"user": {"login": "svc-excavator-bot", "name": "Excavator Bot"}}, "url": "https://github.com/palantir/atlasdb/commit/4c08e41007e020b055fd59668cd0677c267b7e31", "committedDate": "2020-12-29T01:54:42Z", "message": "Excavator: Upgrades Baseline to the latest version"}, "afterCommit": {"oid": "961acaea71d505f1386e03fac7e27603bce71434", "author": {"user": {"login": "svc-excavator-bot", "name": "Excavator Bot"}}, "url": "https://github.com/palantir/atlasdb/commit/961acaea71d505f1386e03fac7e27603bce71434", "committedDate": "2021-01-05T02:51:04Z", "message": "Excavator: Upgrades Baseline to the latest version"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "961acaea71d505f1386e03fac7e27603bce71434", "author": {"user": {"login": "svc-excavator-bot", "name": "Excavator Bot"}}, "url": "https://github.com/palantir/atlasdb/commit/961acaea71d505f1386e03fac7e27603bce71434", "committedDate": "2021-01-05T02:51:04Z", "message": "Excavator: Upgrades Baseline to the latest version"}, "afterCommit": {"oid": "7b382854bb59d78c245cb91c84dfd815f71ab5a3", "author": {"user": {"login": "svc-excavator-bot", "name": "Excavator Bot"}}, "url": "https://github.com/palantir/atlasdb/commit/7b382854bb59d78c245cb91c84dfd815f71ab5a3", "committedDate": "2021-01-05T15:07:46Z", "message": "Excavator: Upgrades Baseline to the latest version"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "7b382854bb59d78c245cb91c84dfd815f71ab5a3", "author": {"user": {"login": "svc-excavator-bot", "name": "Excavator Bot"}}, "url": "https://github.com/palantir/atlasdb/commit/7b382854bb59d78c245cb91c84dfd815f71ab5a3", "committedDate": "2021-01-05T15:07:46Z", "message": "Excavator: Upgrades Baseline to the latest version"}, "afterCommit": {"oid": "18590428a0698f1b8b23eddc8d8aef2710b243f2", "author": {"user": {"login": "svc-excavator-bot", "name": "Excavator Bot"}}, "url": "https://github.com/palantir/atlasdb/commit/18590428a0698f1b8b23eddc8d8aef2710b243f2", "committedDate": "2021-01-05T22:48:19Z", "message": "Excavator: Upgrades Baseline to the latest version"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b60ffa596fafc602921f77d372e62bbffcfc6489", "author": {"user": {"login": "svc-excavator-bot", "name": "Excavator Bot"}}, "url": "https://github.com/palantir/atlasdb/commit/b60ffa596fafc602921f77d372e62bbffcfc6489", "committedDate": "2021-01-06T13:23:01Z", "message": "Excavator: Upgrades Baseline to the latest version"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "6dab4d8bd470fe78edb178916b7322961c33f410", "author": {"user": {"login": "sudiksha27", "name": "sudiksha nanda"}}, "url": "https://github.com/palantir/atlasdb/commit/6dab4d8bd470fe78edb178916b7322961c33f410", "committedDate": "2021-01-06T13:19:20Z", "message": "Fix ClassInitializationDeadlock - 1"}, "afterCommit": {"oid": "b60ffa596fafc602921f77d372e62bbffcfc6489", "author": {"user": {"login": "svc-excavator-bot", "name": "Excavator Bot"}}, "url": "https://github.com/palantir/atlasdb/commit/b60ffa596fafc602921f77d372e62bbffcfc6489", "committedDate": "2021-01-06T13:23:01Z", "message": "Excavator: Upgrades Baseline to the latest version"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ba6a9eb4c8e61afaa9b4978eae99c06faac57e31", "author": {"user": {"login": "sudiksha27", "name": "sudiksha nanda"}}, "url": "https://github.com/palantir/atlasdb/commit/ba6a9eb4c8e61afaa9b4978eae99c06faac57e31", "committedDate": "2021-01-06T13:37:59Z", "message": "Fix ClassInitializationDeadlock - 1"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "cfbafabbc17fbb8554170599f53c9936a5e77369", "author": {"user": {"login": "sudiksha27", "name": "sudiksha nanda"}}, "url": "https://github.com/palantir/atlasdb/commit/cfbafabbc17fbb8554170599f53c9936a5e77369", "committedDate": "2021-01-07T08:34:16Z", "message": "ClassInitializationDeadlock fixes - 2"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "86507d85388053e033a8c2004db0c6d7bce5fb42", "author": {"user": {"login": "sudiksha27", "name": "sudiksha nanda"}}, "url": "https://github.com/palantir/atlasdb/commit/86507d85388053e033a8c2004db0c6d7bce5fb42", "committedDate": "2021-01-07T08:42:01Z", "message": "ClassInitializationDeadlock fixes - 3"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "8455973726c61f78dd5e99a285d887f34f6a0e5a", "author": {"user": {"login": "sudiksha27", "name": "sudiksha nanda"}}, "url": "https://github.com/palantir/atlasdb/commit/8455973726c61f78dd5e99a285d887f34f6a0e5a", "committedDate": "2021-01-07T08:45:41Z", "message": "ClassInitializationDeadlock fixes - 4"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTYzMzAzMTk1", "url": "https://github.com/palantir/atlasdb/pull/5169#pullrequestreview-563303195", "createdAt": "2021-01-07T08:48:49Z", "commit": {"oid": "8455973726c61f78dd5e99a285d887f34f6a0e5a"}, "state": "COMMENTED", "comments": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wMS0wN1QwODo0ODo1MFrOIPjwAg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wMS0wN1QwOTowMDo1NVrOIPkJsg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1MzE4NTI4Mg==", "bodyText": "The immutable is used outside of package", "url": "https://github.com/palantir/atlasdb/pull/5169#discussion_r553185282", "createdAt": "2021-01-07T08:48:50Z", "author": {"login": "sudiksha27"}, "path": "atlasdb-api/src/main/java/com/palantir/atlasdb/factory/TransactionManagerConsistencyResult.java", "diffHunk": "@@ -23,7 +23,9 @@\n  * determine that it is safe (or, at least, not obviously unsafe) to service requests.\n  */\n @Value.Immutable\n+@SuppressWarnings(\"ClassInitializationDeadlock\")\n public interface TransactionManagerConsistencyResult {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "8455973726c61f78dd5e99a285d887f34f6a0e5a"}, "originalPosition": 5}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1MzE4NjIxMw==", "bodyText": "The immutable is used outside this package.", "url": "https://github.com/palantir/atlasdb/pull/5169#discussion_r553186213", "createdAt": "2021-01-07T08:50:36Z", "author": {"login": "sudiksha27"}, "path": "atlasdb-client/src/main/java/com/palantir/atlasdb/stream/StreamStorePersistenceConfiguration.java", "diffHunk": "@@ -23,10 +23,11 @@\n @JsonSerialize(as = ImmutableStreamStorePersistenceConfiguration.class)\n @JsonDeserialize(as = ImmutableStreamStorePersistenceConfiguration.class)\n @Value.Immutable\n+@SuppressWarnings(\"ClassInitializationDeadlock\")\n public interface StreamStorePersistenceConfiguration {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "8455973726c61f78dd5e99a285d887f34f6a0e5a"}, "originalPosition": 5}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1MzE4Njg5Mg==", "bodyText": "This constant is only used for testing.", "url": "https://github.com/palantir/atlasdb/pull/5169#discussion_r553186892", "createdAt": "2021-01-07T08:51:54Z", "author": {"login": "sudiksha27"}, "path": "atlasdb-conjure/src/main/java/com/palantir/atlasdb/http/v2/ClientOptions.java", "diffHunk": "@@ -32,14 +32,6 @@\n \n @Value.Immutable\n public abstract class ClientOptions {\n-    static final ClientOptions FAST_RETRYING_FOR_TEST = ImmutableClientOptions.builder()\n-            .connectTimeout(Duration.ofMillis(100))\n-            .readTimeout(Duration.ofSeconds(65))\n-            .backoffSlotSize(Duration.ofMillis(5))\n-            .failedUrlCooldown(Duration.ofMillis(1))\n-            .maxNumRetries(5)\n-            .clientQoS(ClientConfiguration.ClientQoS.DANGEROUS_DISABLE_SYMPATHETIC_CLIENT_QOS)\n-            .build();\n ", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "8455973726c61f78dd5e99a285d887f34f6a0e5a"}, "originalPosition": 12}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1MzE5MTg1OA==", "bodyText": "Instead of breaking the interface contract by moving the constant, we are setting the impl visibility to PACKAGE (this is done to avoid initializing the immutable first) and suppressing the error.", "url": "https://github.com/palantir/atlasdb/pull/5169#discussion_r553191858", "createdAt": "2021-01-07T09:00:55Z", "author": {"login": "sudiksha27"}, "path": "atlasdb-dbkvs/src/main/java/com/palantir/atlasdb/keyvalue/dbkvs/impl/Token.java", "diffHunk": "@@ -19,6 +19,8 @@\n import org.immutables.value.Value;\n \n @Value.Immutable\n+@Value.Style(visibility = Value.Style.ImplementationVisibility.PACKAGE)\n+@SuppressWarnings(\"ClassInitializationDeadlock\")\n abstract class Token {\n     @Nullable", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "8455973726c61f78dd5e99a285d887f34f6a0e5a"}, "originalPosition": 7}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "98cf1975bf71bf83700bf23251b65babfa709174", "author": {"user": {"login": "sudiksha27", "name": "sudiksha nanda"}}, "url": "https://github.com/palantir/atlasdb/commit/98cf1975bf71bf83700bf23251b65babfa709174", "committedDate": "2021-01-07T09:23:34Z", "message": "Immutable annotations"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "da4a26904eb75f50863d5dc4b0a8c87ed96198a4", "author": {"user": {"login": "sudiksha27", "name": "sudiksha nanda"}}, "url": "https://github.com/palantir/atlasdb/commit/da4a26904eb75f50863d5dc4b0a8c87ed96198a4", "committedDate": "2021-01-07T10:10:12Z", "message": "Fix build"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTYzMzY0NzE2", "url": "https://github.com/palantir/atlasdb/pull/5169#pullrequestreview-563364716", "createdAt": "2021-01-07T10:13:45Z", "commit": {"oid": "da4a26904eb75f50863d5dc4b0a8c87ed96198a4"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wMS0wN1QxMDoxMzo0NVrOIPmr9A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wMS0wN1QxMDoxMzo0NVrOIPmr9A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1MzIzMzM5Ng==", "bodyText": "The CassandraKeyValueServiceInstrumentation is being used in tests in a different package and can not be made package private, would appreciate alternative ideas for fixing the ClassInitDeadlock issue here.", "url": "https://github.com/palantir/atlasdb/pull/5169#discussion_r553233396", "createdAt": "2021-01-07T10:13:45Z", "author": {"login": "sudiksha27"}, "path": "atlasdb-perf/src/main/java/com/palantir/atlasdb/performance/backend/KeyValueServiceInstrumentation.java", "diffHunk": "@@ -23,6 +23,7 @@\n import java.util.Set;\n import java.util.TreeMap;\n \n+@SuppressWarnings(\"ClassInitializationDeadlock\")\n public abstract class KeyValueServiceInstrumentation {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "da4a26904eb75f50863d5dc4b0a8c87ed96198a4"}, "originalPosition": 5}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTYzMzkyMjA0", "url": "https://github.com/palantir/atlasdb/pull/5169#pullrequestreview-563392204", "createdAt": "2021-01-07T10:54:16Z", "commit": {"oid": "da4a26904eb75f50863d5dc4b0a8c87ed96198a4"}, "state": "COMMENTED", "comments": {"totalCount": 5, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wMS0wN1QxMDo1NDoxNlrOIPoAQg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wMS0wN1QxMDo1OTowM1rOIPoKLw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1MzI1NDk3OA==", "bodyText": "nit: unnecessary diff?", "url": "https://github.com/palantir/atlasdb/pull/5169#discussion_r553254978", "createdAt": "2021-01-07T10:54:16Z", "author": {"login": "Jolyon-S"}, "path": "atlasdb-client/src/main/java/com/palantir/atlasdb/stream/StreamStorePersistenceConfiguration.java", "diffHunk": "@@ -23,10 +23,11 @@\n @JsonSerialize(as = ImmutableStreamStorePersistenceConfiguration.class)\n @JsonDeserialize(as = ImmutableStreamStorePersistenceConfiguration.class)\n @Value.Immutable\n+@SuppressWarnings(\"ClassInitializationDeadlock\")\n public interface StreamStorePersistenceConfiguration {\n+    @Deprecated\n     StreamStorePersistenceConfiguration DEFAULT_CONFIG =\n             ImmutableStreamStorePersistenceConfiguration.builder().build();\n-", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "da4a26904eb75f50863d5dc4b0a8c87ed96198a4"}, "originalPosition": 9}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1MzI1NTMwOQ==", "bodyText": "I will assume that you verified this via a search on github? If so, great!", "url": "https://github.com/palantir/atlasdb/pull/5169#discussion_r553255309", "createdAt": "2021-01-07T10:54:57Z", "author": {"login": "Jolyon-S"}, "path": "atlasdb-conjure/src/main/java/com/palantir/atlasdb/http/v2/ClientOptions.java", "diffHunk": "@@ -32,14 +32,6 @@\n \n @Value.Immutable\n public abstract class ClientOptions {\n-    static final ClientOptions FAST_RETRYING_FOR_TEST = ImmutableClientOptions.builder()\n-            .connectTimeout(Duration.ofMillis(100))\n-            .readTimeout(Duration.ofSeconds(65))\n-            .backoffSlotSize(Duration.ofMillis(5))\n-            .failedUrlCooldown(Duration.ofMillis(1))\n-            .maxNumRetries(5)\n-            .clientQoS(ClientConfiguration.ClientQoS.DANGEROUS_DISABLE_SYMPATHETIC_CLIENT_QOS)\n-            .build();\n ", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1MzE4Njg5Mg=="}, "originalCommit": {"oid": "8455973726c61f78dd5e99a285d887f34f6a0e5a"}, "originalPosition": 12}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1MzI1NjY5Mw==", "bodyText": "To clarify, is it the case that:\n\nsetting the implementation visibility prevents the actual issue of initialisation deadlock?\nthe check is not smart enough to determine this, and so it requires the warning to be suppressed?\nwe cannot do this elsewhere because in other cases, the impl cannot be made package private? (In other words, why did we go with this solution here but not elsewhere, and vice versa?)", "url": "https://github.com/palantir/atlasdb/pull/5169#discussion_r553256693", "createdAt": "2021-01-07T10:57:32Z", "author": {"login": "Jolyon-S"}, "path": "atlasdb-dbkvs/src/main/java/com/palantir/atlasdb/keyvalue/dbkvs/impl/Token.java", "diffHunk": "@@ -19,6 +19,8 @@\n import org.immutables.value.Value;\n \n @Value.Immutable\n+@Value.Style(visibility = Value.Style.ImplementationVisibility.PACKAGE)\n+@SuppressWarnings(\"ClassInitializationDeadlock\")\n abstract class Token {\n     @Nullable", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1MzE5MTg1OA=="}, "originalCommit": {"oid": "8455973726c61f78dd5e99a285d887f34f6a0e5a"}, "originalPosition": 7}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1MzI1NzIzOA==", "bodyText": "Is this breaking?", "url": "https://github.com/palantir/atlasdb/pull/5169#discussion_r553257238", "createdAt": "2021-01-07T10:58:27Z", "author": {"login": "Jolyon-S"}, "path": "atlasdb-perf/src/main/java/com/palantir/atlasdb/performance/backend/PostgresKeyValueServiceInstrumentation.java", "diffHunk": "@@ -22,7 +22,7 @@\n import com.palantir.nexus.db.pool.config.ImmutablePostgresConnectionConfig;\n import java.net.InetSocketAddress;\n \n-public class PostgresKeyValueServiceInstrumentation extends KeyValueServiceInstrumentation {\n+class PostgresKeyValueServiceInstrumentation extends KeyValueServiceInstrumentation {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "da4a26904eb75f50863d5dc4b0a8c87ed96198a4"}, "originalPosition": 5}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1MzI1NzUxOQ==", "bodyText": "nit: order is not consistent with the order of annotations on some of the other classes", "url": "https://github.com/palantir/atlasdb/pull/5169#discussion_r553257519", "createdAt": "2021-01-07T10:59:03Z", "author": {"login": "Jolyon-S"}, "path": "lock-api/src/main/java/com/palantir/lock/LockServerOptions.java", "diffHunk": "@@ -35,6 +35,8 @@\n  */\n @JsonDeserialize(builder = LockServerOptions.SerializationProxy.class)\n @Value.Immutable\n+@Value.Style(visibility = Value.Style.ImplementationVisibility.PACKAGE)\n+@SuppressWarnings(\"ClassInitializationDeadlock\")", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "da4a26904eb75f50863d5dc4b0a8c87ed96198a4"}, "originalPosition": 5}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c695a342e51f7c46f3ece6480fdb17cc0b45c300", "author": {"user": {"login": "sudiksha27", "name": "sudiksha nanda"}}, "url": "https://github.com/palantir/atlasdb/commit/c695a342e51f7c46f3ece6480fdb17cc0b45c300", "committedDate": "2021-01-07T11:19:14Z", "message": "Address comments - 1"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTY0MjQzMDI2", "url": "https://github.com/palantir/atlasdb/pull/5169#pullrequestreview-564243026", "createdAt": "2021-01-08T13:04:09Z", "commit": {"oid": "c695a342e51f7c46f3ece6480fdb17cc0b45c300"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wMS0wOFQxMzowNDowOVrOIQRTJg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wMS0wOFQxMzoxMzo1NlrOIQRktw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1MzkzMTU1OA==", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            @SuppressWarnings(\"ClassInitializationDeadlock\")\n          \n          \n            \n            @SuppressWarnings(\"ClassInitializationDeadlock\")\n          \n          \n            \n            @Value.Style(visibility = Value.Style.ImplementationVisibility.PACKAGE)", "url": "https://github.com/palantir/atlasdb/pull/5169#discussion_r553931558", "createdAt": "2021-01-08T13:04:09Z", "author": {"login": "gmaretic"}, "path": "atlasdb-api/src/main/java/com/palantir/atlasdb/factory/TransactionManagerConsistencyResult.java", "diffHunk": "@@ -23,7 +23,9 @@\n  * determine that it is safe (or, at least, not obviously unsafe) to service requests.\n  */\n @Value.Immutable\n+@SuppressWarnings(\"ClassInitializationDeadlock\")", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c695a342e51f7c46f3ece6480fdb17cc0b45c300"}, "originalPosition": 4}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1MzkzMTgwNQ==", "bodyText": "And add a builder if necessary for outside use, the idea is not to expose the generated immutable", "url": "https://github.com/palantir/atlasdb/pull/5169#discussion_r553931805", "createdAt": "2021-01-08T13:04:42Z", "author": {"login": "gmaretic"}, "path": "atlasdb-api/src/main/java/com/palantir/atlasdb/factory/TransactionManagerConsistencyResult.java", "diffHunk": "@@ -23,7 +23,9 @@\n  * determine that it is safe (or, at least, not obviously unsafe) to service requests.\n  */\n @Value.Immutable\n+@SuppressWarnings(\"ClassInitializationDeadlock\")", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1MzkzMTU1OA=="}, "originalCommit": {"oid": "c695a342e51f7c46f3ece6480fdb17cc0b45c300"}, "originalPosition": 4}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1MzkzMTg3Mw==", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            @SuppressWarnings(\"ClassInitializationDeadlock\")\n          \n          \n            \n            @SuppressWarnings(\"ClassInitializationDeadlock\")\n          \n          \n            \n            @Value.Style(visibility = Value.Style.ImplementationVisibility.PACKAGE)", "url": "https://github.com/palantir/atlasdb/pull/5169#discussion_r553931873", "createdAt": "2021-01-08T13:04:54Z", "author": {"login": "gmaretic"}, "path": "atlasdb-client/src/main/java/com/palantir/atlasdb/stream/StreamStorePersistenceConfiguration.java", "diffHunk": "@@ -23,7 +23,9 @@\n @JsonSerialize(as = ImmutableStreamStorePersistenceConfiguration.class)\n @JsonDeserialize(as = ImmutableStreamStorePersistenceConfiguration.class)\n @Value.Immutable\n+@SuppressWarnings(\"ClassInitializationDeadlock\")", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c695a342e51f7c46f3ece6480fdb17cc0b45c300"}, "originalPosition": 4}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1MzkzNjA1NQ==", "bodyText": "If we try to initialise ImmutableClass before Class, that will require us to initialise Class, but because of the static constant, that requires an initialisation of ImmutableClass and this deadlocks because there is a lock on ImmutableClass.\nIf you ensure that Class gets initialised first, then everything works fine, so by making access to ImmutableClass package private (to prevent external badness) and exposing a builder on the Class interface to be used instead of the ImmutableClass builder directly, we can avoid this issue", "url": "https://github.com/palantir/atlasdb/pull/5169#discussion_r553936055", "createdAt": "2021-01-08T13:13:56Z", "author": {"login": "gmaretic"}, "path": "atlasdb-dbkvs/src/main/java/com/palantir/atlasdb/keyvalue/dbkvs/impl/Token.java", "diffHunk": "@@ -19,6 +19,8 @@\n import org.immutables.value.Value;\n \n @Value.Immutable\n+@Value.Style(visibility = Value.Style.ImplementationVisibility.PACKAGE)\n+@SuppressWarnings(\"ClassInitializationDeadlock\")\n abstract class Token {\n     @Nullable", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1MzE5MTg1OA=="}, "originalCommit": {"oid": "8455973726c61f78dd5e99a285d887f34f6a0e5a"}, "originalPosition": 7}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "0a5c83907e0600caf1e1393634deb7f2064479a7", "author": {"user": {"login": "sudiksha27", "name": "sudiksha nanda"}}, "url": "https://github.com/palantir/atlasdb/commit/0a5c83907e0600caf1e1393634deb7f2064479a7", "committedDate": "2021-01-11T14:58:29Z", "message": "Instrument batcher"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "44902a3c258b82b31297f478f9dd2564a996be89", "author": {"user": {"login": "sudiksha27", "name": "sudiksha nanda"}}, "url": "https://github.com/palantir/atlasdb/commit/44902a3c258b82b31297f478f9dd2564a996be89", "committedDate": "2021-01-11T15:00:23Z", "message": "Revert \"Instrument batcher\"\n\nThis reverts commit 0a5c83907e0600caf1e1393634deb7f2064479a7."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "262661e661a9ad742f70e7df554551d1784e8dc1", "author": {"user": {"login": "sudiksha27", "name": "sudiksha nanda"}}, "url": "https://github.com/palantir/atlasdb/commit/262661e661a9ad742f70e7df554551d1784e8dc1", "committedDate": "2021-01-18T13:51:17Z", "message": "Extract INITIAL Token"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "2340d1219b2b6a06e911efc2df20cdf12c7af898", "author": {"user": {"login": "sudiksha27", "name": "sudiksha nanda"}}, "url": "https://github.com/palantir/atlasdb/commit/2340d1219b2b6a06e911efc2df20cdf12c7af898", "committedDate": "2021-01-20T20:10:25Z", "message": "Extract out constants"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "346f1f9ac17a3eea89760002a9261b7bc704fd8f", "author": {"user": {"login": "sudiksha27", "name": "sudiksha nanda"}}, "url": "https://github.com/palantir/atlasdb/commit/346f1f9ac17a3eea89760002a9261b7bc704fd8f", "committedDate": "2021-01-21T14:27:16Z", "message": "Fix build"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTc2MjQzMjgw", "url": "https://github.com/palantir/atlasdb/pull/5169#pullrequestreview-576243280", "createdAt": "2021-01-26T11:05:36Z", "commit": {"oid": "346f1f9ac17a3eea89760002a9261b7bc704fd8f"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2205, "cost": 1, "resetAt": "2021-11-01T16:19:10Z"}}}