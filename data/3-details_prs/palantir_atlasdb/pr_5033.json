{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTAzNDAyODU2", "number": 5033, "title": "Wire invalidator 2", "bodyText": "Goals (and why):\nWire DbKvsTimestoreInvalidator.\nImplementation Description (bullets):\n\n\nChange signature of AtlasDbFactory#createTimestampStoreInvalidator to accommodate DbTimestampCreationSetting\n\n\nCreate invalidator for single series table\n\n\nCreate default invalidator for empty creation params or single series with no table\n\n\nCreate no invalidator for multi series\n\n\nTesting (What was existing testing like?  What have you done to improve it?):\nAdded some tests\nConcerns (what feedback would you like?):\nCorrectness\nWhere should we start reviewing?:\nDbAtlasDbFactory.java\nPriority (whenever / two weeks / yesterday):\nASAP", "createdAt": "2020-10-14T14:08:27Z", "url": "https://github.com/palantir/atlasdb/pull/5033", "merged": true, "mergeCommit": {"oid": "79c44592810f04aa5e14e670bda76e5d2e3637f4"}, "closed": true, "closedAt": "2020-10-15T15:27:38Z", "author": {"login": "sudiksha27"}, "timelineItems": {"totalCount": 12, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdSbkTtAH2gAyNTAzNDAyODU2OjI2M2Q1ZDJmOTU1Y2Y1N2Y5ODJiNmU4ZGJlNWQ4YWNmOTA0ZjA4ZmI=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdSxLdMAFqTUwOTMzNzM2Ng==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "263d5d2f955cf57f982b6e8dbe5d8acf904f08fb", "author": {"user": {"login": "sudiksha27", "name": "sudiksha nanda"}}, "url": "https://github.com/palantir/atlasdb/commit/263d5d2f955cf57f982b6e8dbe5d8acf904f08fb", "committedDate": "2020-10-14T11:34:58Z", "message": "WIP"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "2998a9be1e68a21653e75723433be43cf36f8396", "author": {"user": {"login": "sudiksha27", "name": "sudiksha nanda"}}, "url": "https://github.com/palantir/atlasdb/commit/2998a9be1e68a21653e75723433be43cf36f8396", "committedDate": "2020-10-14T12:54:35Z", "message": "WIP"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f8c65e1bd934adae36c22a54ce8c98fa319b9098", "author": {"user": {"login": "sudiksha27", "name": "sudiksha nanda"}}, "url": "https://github.com/palantir/atlasdb/commit/f8c65e1bd934adae36c22a54ce8c98fa319b9098", "committedDate": "2020-10-14T13:30:07Z", "message": "Test - WIP"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ab3483438a98e0aa4f9cf3bf561ca574933dbd7a", "author": {"user": {"login": "sudiksha27", "name": "sudiksha nanda"}}, "url": "https://github.com/palantir/atlasdb/commit/ab3483438a98e0aa4f9cf3bf561ca574933dbd7a", "committedDate": "2020-10-14T14:02:38Z", "message": "Tests"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "59253f22524b4907f5fffa2c5451c9c880aeeae8", "author": {"user": {"login": "sudiksha27", "name": "sudiksha nanda"}}, "url": "https://github.com/palantir/atlasdb/commit/59253f22524b4907f5fffa2c5451c9c880aeeae8", "committedDate": "2020-10-14T14:19:43Z", "message": "Clean"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "122e9385b4be2075b5f51962b52898290c181f8d", "author": {"user": {"login": "sudiksha27", "name": "sudiksha nanda"}}, "url": "https://github.com/palantir/atlasdb/commit/122e9385b4be2075b5f51962b52898290c181f8d", "committedDate": "2020-10-14T14:19:43Z", "message": "Add generated changelog entries"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "76e18f2051ce5782a69da373b38c32b071e7894e", "author": {"user": {"login": "sudiksha27", "name": "sudiksha nanda"}}, "url": "https://github.com/palantir/atlasdb/commit/76e18f2051ce5782a69da373b38c32b071e7894e", "committedDate": "2020-10-14T14:57:37Z", "message": "Be private"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "81b9fc86f1949608fc5af998278b3b5920e402b3", "author": {"user": {"login": "sudiksha27", "name": "sudiksha nanda"}}, "url": "https://github.com/palantir/atlasdb/commit/81b9fc86f1949608fc5af998278b3b5920e402b3", "committedDate": "2020-10-14T14:58:47Z", "message": "Merge branch 'wire-invalidator-2' of github.com:palantir/atlasdb into wire-invalidator-2"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTA4NTA2NDEy", "url": "https://github.com/palantir/atlasdb/pull/5033#pullrequestreview-508506412", "createdAt": "2020-10-14T16:06:19Z", "commit": {"oid": "81b9fc86f1949608fc5af998278b3b5920e402b3"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xNFQxNjowNjoxOVrOHhafeg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xNFQxNjowNjoxOVrOHhafeg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNDc5OTA5OA==", "bodyText": "I think it might be better if this one returns an invalidator that will throw an exception if invoked? This should only really happen in a DB-TimeLock, and if something is calling invalidation there that is a bug.", "url": "https://github.com/palantir/atlasdb/pull/5033#discussion_r504799098", "createdAt": "2020-10-14T16:06:19Z", "author": {"login": "jeremyk-91"}, "path": "atlasdb-dbkvs/src/main/java/com/palantir/atlasdb/keyvalue/dbkvs/DbAtlasDbFactory.java", "diffHunk": "@@ -123,7 +125,39 @@ private static InDbTimestampBoundStore multiSeries(ConnectionManagerAwareDbKvs d\n     private static InDbTimestampBoundStore defaultTimestampBoundStore(ConnectionManagerAwareDbKvs dbkvs) {\n         return InDbTimestampBoundStore.create(\n                 dbkvs.getConnectionManager(),\n-                AtlasDbConstants.TIMESTAMP_TABLE,\n-                dbkvs.getTablePrefix());\n+                defaultTimestampTable(),\n+                defaultTablePrefix(dbkvs));\n+    }\n+\n+    @Override\n+    public TimestampStoreInvalidator createTimestampStoreInvalidator(KeyValueService rawKvs,\n+            Optional<DbTimestampCreationSetting> creationParameters) {\n+        ConnectionManagerAwareDbKvs dbkvs = (ConnectionManagerAwareDbKvs) rawKvs;\n+        return creationParameters.map(params -> DbTimestampCreationSettings.caseOf(params)\n+                // Do not create invalidator for multi series table\n+                .multipleSeries((table, series) -> defaultTimestampStoreInvalidator(dbkvs, creationParameters))", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "81b9fc86f1949608fc5af998278b3b5920e402b3"}, "originalPosition": 30}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "0dcb21ef03f5f4e9fc20ed0741731d14f0572b54", "author": {"user": {"login": "sudiksha27", "name": "sudiksha nanda"}}, "url": "https://github.com/palantir/atlasdb/commit/0dcb21ef03f5f4e9fc20ed0741731d14f0572b54", "committedDate": "2020-10-14T18:39:08Z", "message": "Address comments"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e6bf0adb0c2b8987cccec0f029c3579916e49068", "author": {"user": {"login": "sudiksha27", "name": "sudiksha nanda"}}, "url": "https://github.com/palantir/atlasdb/commit/e6bf0adb0c2b8987cccec0f029c3579916e49068", "committedDate": "2020-10-15T09:58:53Z", "message": "Test modif"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTA5MzM3MzY2", "url": "https://github.com/palantir/atlasdb/pull/5033#pullrequestreview-509337366", "createdAt": "2020-10-15T12:45:44Z", "commit": {"oid": "e6bf0adb0c2b8987cccec0f029c3579916e49068"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2647, "cost": 1, "resetAt": "2021-11-01T16:19:10Z"}}}