{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDcyNTA4NTc3", "number": 4961, "title": "[LW] Fixes, 4: Register lockwatches eagerly", "bodyText": "Goals (and why):\n\nRegister locks immediately, as well as periodically. This not only allows the benefits to come through faster, but also makes testing easier.\n\nImplementation Description (bullets):\n\nCalls the internal register method when the client registers.\n\nTesting (What was existing testing like?  What have you done to improve it?):\nN/A\nConcerns (what feedback would you like?):\n\nAny hidden issues here?\n\nWhere should we start reviewing?:\nLockWatchManagerImpl\nPriority (whenever / two weeks / yesterday):\nThis week, please", "createdAt": "2020-08-24T13:15:24Z", "url": "https://github.com/palantir/atlasdb/pull/4961", "merged": true, "mergeCommit": {"oid": "5e69abf2f94208ea53ba6d48bb817f0e198169d5"}, "closed": true, "closedAt": "2020-08-25T09:24:36Z", "author": {"login": "Jolyon-S"}, "timelineItems": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdCCabxAH2gAyNDcyNTA4NTc3OmMzOTY3M2ViNTNiMDM4MzZhZjljY2FiZDU3ZWI1N2I1NDc5ODU5NWI=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdCTuX-AFqTQ3NDI5OTAxNQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "c39673eb53b03836af9ccabd57eb57b54798595b", "author": {"user": {"login": "Jolyon-S", "name": "Jolyon"}}, "url": "https://github.com/palantir/atlasdb/commit/c39673eb53b03836af9ccabd57eb57b54798595b", "committedDate": "2020-08-24T13:13:46Z", "message": "register watches early"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDc0Mjk4OTc1", "url": "https://github.com/palantir/atlasdb/pull/4961#pullrequestreview-474298975", "createdAt": "2020-08-25T09:23:53Z", "commit": {"oid": "c39673eb53b03836af9ccabd57eb57b54798595b"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yNVQwOToyMzo1NFrOHGPiHA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yNVQwOToyMzo1NFrOHGPiHA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NjMwNzk5Ng==", "bodyText": "I think this works, everything is nice and threadsafe anyway.", "url": "https://github.com/palantir/atlasdb/pull/4961#discussion_r476307996", "createdAt": "2020-08-25T09:23:54Z", "author": {"login": "jkozlowski"}, "path": "atlasdb-impl-shared/src/main/java/com/palantir/atlasdb/keyvalue/api/watch/LockWatchManagerImpl.java", "diffHunk": "@@ -72,6 +72,7 @@ public void close() {\n     @Override\n     public void registerWatches(Set<LockWatchReferences.LockWatchReference> newLockWatches) {\n         lockWatchReferences.addAll(newLockWatches);\n+        registerWatchesWithTimelock();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c39673eb53b03836af9ccabd57eb57b54798595b"}, "originalPosition": 4}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDc0Mjk5MDE1", "url": "https://github.com/palantir/atlasdb/pull/4961#pullrequestreview-474299015", "createdAt": "2020-08-25T09:23:56Z", "commit": {"oid": "c39673eb53b03836af9ccabd57eb57b54798595b"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2543, "cost": 1, "resetAt": "2021-11-01T16:19:10Z"}}}