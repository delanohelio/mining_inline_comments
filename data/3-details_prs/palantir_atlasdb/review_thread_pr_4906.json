{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDUzMjgyODI2", "number": 4906, "reviewThreads": {"totalCount": 15, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yMFQxMjowMjoyM1rOEQI1Uw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yOVQwOTo1NjowNlrOETLq5w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjg1MzU3Mzk1OnYy", "diffSide": "RIGHT", "path": "atlasdb-config/src/main/java/com/palantir/atlasdb/factory/TransactionManagers.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yMFQxMjowMjoyM1rOG0IlnA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yMFQxMjowMjoyM1rOG0IlnA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NzMxOTgzNg==", "bodyText": "The default should be an identifier that should tell that cluster is not on / moving away from blue greening and leadership should not be snatched because of version diff in this case.", "url": "https://github.com/palantir/atlasdb/pull/4906#discussion_r457319836", "createdAt": "2020-07-20T12:02:23Z", "author": {"login": "sudiksha27"}, "path": "atlasdb-config/src/main/java/com/palantir/atlasdb/factory/TransactionManagers.java", "diffHunk": "@@ -245,6 +245,11 @@ boolean allSafeForLogging() {\n         return false;\n     }\n \n+    @Value.Default\n+    String timeLockVersion() {\n+        return \"0.0.0\";\n+    }\n+", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "735d08f1d57a5c64af0060dfd91475984a841983"}, "originalPosition": 8}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjg4MTAwNzMyOnYy", "diffSide": "RIGHT", "path": "atlasdb-config/src/main/java/com/palantir/atlasdb/factory/Leaders.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yOFQxMDo0MDo0OVrOG4G4MA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yOFQxMDo0MDo0OVrOG4G4MA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MTQ4NjEyOA==", "bodyText": "Hmm, I don't think we need to rename this chain of methods (unless there's something I'm missing?) - the fact that a version is requested as a parameter should be enough", "url": "https://github.com/palantir/atlasdb/pull/4906#discussion_r461486128", "createdAt": "2020-07-28T10:40:49Z", "author": {"login": "jeremyk-91"}, "path": "atlasdb-config/src/main/java/com/palantir/atlasdb/factory/Leaders.java", "diffHunk": "@@ -83,10 +83,25 @@ public static LocalPaxosServices createAndRegisterLocalServices(\n             MetricsManager metricsManager,\n             Consumer<Object> env,\n             LeaderConfig config,\n-            Supplier<LeaderRuntimeConfig> runtime,\n             UserAgent userAgent) {\n-        LocalPaxosServices localPaxosServices = createInstrumentedLocalServices(\n-                metricsManager, config, userAgent);\n+        return createAndRegisterLocalServicesWithVersion(\n+                metricsManager,\n+                env,\n+                config,\n+                userAgent,\n+                Optional.empty());\n+    }\n+\n+    public static LocalPaxosServices createAndRegisterLocalServicesWithVersion(MetricsManager metricsManager,", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c167ba6e208692a0166d1b4db4b067a7f15fd89f"}, "originalPosition": 32}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjg4MTAxNDE4OnYy", "diffSide": "RIGHT", "path": "atlasdb-config/src/main/java/com/palantir/atlasdb/factory/TransactionManagers.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yOFQxMDo0MzowOFrOG4G8ew==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yOFQxMDo0MzowOFrOG4G8ew==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MTQ4NzIyNw==", "bodyText": "We should discuss this in person: there is no reason for TransactionManagers to have a TimeLock version (at least right now), as TimeLock doesn't create a transaction manager - and even if it did we would not be using the leader or remote blocks.", "url": "https://github.com/palantir/atlasdb/pull/4906#discussion_r461487227", "createdAt": "2020-07-28T10:43:08Z", "author": {"login": "jeremyk-91"}, "path": "atlasdb-config/src/main/java/com/palantir/atlasdb/factory/TransactionManagers.java", "diffHunk": "@@ -245,6 +245,8 @@ boolean allSafeForLogging() {\n         return false;\n     }\n \n+    abstract Optional<OrderableSlsVersion> timeLockVersion();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c167ba6e208692a0166d1b4db4b067a7f15fd89f"}, "originalPosition": 20}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjg4MTAxNTc4OnYy", "diffSide": "RIGHT", "path": "atlasdb-config/src/test/java/com/palantir/atlasdb/factory/TransactionManagersTest.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yOFQxMDo0MzozOVrOG4G9ag==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yOFQxMDo0MzozOVrOG4G9ag==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MTQ4NzQ2Ng==", "bodyText": "nit: unused?", "url": "https://github.com/palantir/atlasdb/pull/4906#discussion_r461487466", "createdAt": "2020-07-28T10:43:39Z", "author": {"login": "jeremyk-91"}, "path": "atlasdb-config/src/test/java/com/palantir/atlasdb/factory/TransactionManagersTest.java", "diffHunk": "@@ -144,6 +143,7 @@\n     private static final UserAgent USER_AGENT = UserAgent.of(UserAgent.Agent.of(USER_AGENT_NAME, USER_AGENT_VERSION));\n     private static final String EXPECTED_USER_AGENT_STRING = UserAgents.format(USER_AGENT);\n     private static final String USER_AGENT_HEADER = \"User-Agent\";\n+    private static final String TIMELOCK_VERSION = \"0.0.0\";", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c167ba6e208692a0166d1b4db4b067a7f15fd89f"}, "originalPosition": 12}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjg4MTAxNzY5OnYy", "diffSide": "RIGHT", "path": "changelog/@unreleased/pr-4906.v2.yml", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yOFQxMDo0NDoxNVrOG4G-mQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yOFQxMDo0NDoxNVrOG4G-mQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MTQ4Nzc2OQ==", "bodyText": "I'd write this the other way: the primary goal of the endpoint is still returning information about leadership status", "url": "https://github.com/palantir/atlasdb/pull/4906#discussion_r461487769", "createdAt": "2020-07-28T10:44:15Z", "author": {"login": "jeremyk-91"}, "path": "changelog/@unreleased/pr-4906.v2.yml", "diffHunk": "@@ -0,0 +1,6 @@\n+type: feature\n+feature:\n+  description: New api endpoint - pingV2 is added. It returns the version of TimeLock\n+    on remote server along with information regarding leadership status of the server.", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c167ba6e208692a0166d1b4db4b067a7f15fd89f"}, "originalPosition": 4}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjg4MTAxOTkwOnYy", "diffSide": "RIGHT", "path": "leader-election-api/src/main/java/com/palantir/leader/PingResult.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yOFQxMDo0NDo1N1rOG4HACA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yOFQxMDo0NDo1N1rOG4HACA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MTQ4ODEzNg==", "bodyText": "nit: It is probably worth JavaDoc explaining what this object is, especially its semantics in non-TimeLock contexts.", "url": "https://github.com/palantir/atlasdb/pull/4906#discussion_r461488136", "createdAt": "2020-07-28T10:44:57Z", "author": {"login": "jeremyk-91"}, "path": "leader-election-api/src/main/java/com/palantir/leader/PingResult.java", "diffHunk": "@@ -0,0 +1,33 @@\n+/*\n+ * (c) Copyright 2020 Palantir Technologies Inc. All rights reserved.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package com.palantir.leader;\n+\n+import java.util.Optional;\n+\n+import org.immutables.value.Value;\n+\n+import com.palantir.sls.versions.OrderableSlsVersion;\n+\n+@Value.Immutable\n+public interface PingResult {\n+    boolean isLeader();\n+    Optional<OrderableSlsVersion> timeLockVersion();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c167ba6e208692a0166d1b4db4b067a7f15fd89f"}, "originalPosition": 28}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjg4MTAyMjAxOnYy", "diffSide": "RIGHT", "path": "leader-election-api/src/main/java/com/palantir/leader/PingableLeader.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yOFQxMDo0NTozM1rOG4HBTQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yOFQxMDo0NTozM1rOG4HBTQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MTQ4ODQ2MQ==", "bodyText": "nit: As above, I think the \"am I the leader?\" is the core piece of information, not the version.", "url": "https://github.com/palantir/atlasdb/pull/4906#discussion_r461488461", "createdAt": "2020-07-28T10:45:33Z", "author": {"login": "jeremyk-91"}, "path": "leader-election-api/src/main/java/com/palantir/leader/PingableLeader.java", "diffHunk": "@@ -45,4 +45,16 @@\n     @SuppressWarnings(\"checkstyle:AbbreviationAsWordInName\") // Avoiding API break\n     @Timed\n     String getUUID();\n+\n+    /**\n+     * If this call returns then the server is reachable.\n+     *\n+     * @return string version of TimeLock on remote server with boolean to represent if the\n+     * server thinks it is the leader or not", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c167ba6e208692a0166d1b4db4b067a7f15fd89f"}, "originalPosition": 9}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjg4MTU4MDc5OnYy", "diffSide": "RIGHT", "path": "timelock-impl/src/test/java/com/palantir/atlasdb/timelock/paxos/PaxosStateLogMigrationIntegrationTest.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yOFQxMzoyMzowM1rOG4MTuA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yOFQxMzoyMzowM1rOG4MTuA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MTU3NTA5Ng==", "bodyText": "nit: unused", "url": "https://github.com/palantir/atlasdb/pull/4906#discussion_r461575096", "createdAt": "2020-07-28T13:23:03Z", "author": {"login": "jeremyk-91"}, "path": "timelock-impl/src/test/java/com/palantir/atlasdb/timelock/paxos/PaxosStateLogMigrationIntegrationTest.java", "diffHunk": "@@ -50,6 +51,7 @@\n     private static final long LATEST_ROUND_BEFORE_MIGRATING = 100;\n     private static final long CUTOFF = LATEST_ROUND_BEFORE_MIGRATING - PaxosStateLogMigrator.SAFETY_BUFFER;\n     private static final long ROUND_BEFORE_CUTOFF = CUTOFF - 1;\n+    private static final String TIMELOCK_VERSION = \"0.0.0\";", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c167ba6e208692a0166d1b4db4b067a7f15fd89f"}, "originalPosition": 12}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjg4MTU4MTg1OnYy", "diffSide": "RIGHT", "path": "timelock-impl/src/test/java/com/palantir/atlasdb/timelock/paxos/PaxosTimestampBoundStoreTest.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yOFQxMzoyMzoxOFrOG4MUaQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yOFQxMzoyMzoxOFrOG4MUaQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MTU3NTI3Mw==", "bodyText": "nit: unused\nI think I see what you were trying to do here \ud83d\ude05", "url": "https://github.com/palantir/atlasdb/pull/4906#discussion_r461575273", "createdAt": "2020-07-28T13:23:18Z", "author": {"login": "jeremyk-91"}, "path": "timelock-impl/src/test/java/com/palantir/atlasdb/timelock/paxos/PaxosTimestampBoundStoreTest.java", "diffHunk": "@@ -82,6 +83,7 @@\n             ImmutableSequenceAndBound.of(1, FORTY_TWO);\n \n     private static final RuntimeException EXCEPTION = new RuntimeException(\"exception\");\n+    private static final String TIMELOCK_VERSION = \"0.0.0\";", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c167ba6e208692a0166d1b4db4b067a7f15fd89f"}, "originalPosition": 12}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjg4MTU4ODM2OnYy", "diffSide": "RIGHT", "path": "timelock-impl/src/main/java/com/palantir/atlasdb/timelock/paxos/LocalPaxosComponents.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yOFQxMzoyNDo1MlrOG4MYew==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yOFQxMzoyNDo1MlrOG4MYew==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MTU3NjMxNQ==", "bodyText": "I think as with the other class, it's probably fine to overload this - no need to say withVersion", "url": "https://github.com/palantir/atlasdb/pull/4906#discussion_r461576315", "createdAt": "2020-07-28T13:24:52Z", "author": {"login": "jeremyk-91"}, "path": "timelock-impl/src/main/java/com/palantir/atlasdb/timelock/paxos/LocalPaxosComponents.java", "diffHunk": "@@ -96,8 +98,29 @@ public static LocalPaxosComponents createWithBlockingMigration(\n             DataSource sqliteDataSource,\n             UUID leaderUuid,\n             boolean canCreateNewClients) {\n-        LocalPaxosComponents components = new LocalPaxosComponents(metrics, paxosUseCase, legacyLogDirectory,\n-                sqliteDataSource, leaderUuid, canCreateNewClients);\n+        return createWithBlockingMigrationWithVersion(metrics,\n+                paxosUseCase,\n+                legacyLogDirectory,\n+                sqliteDataSource,\n+                leaderUuid,\n+                canCreateNewClients,\n+                Optional.empty());\n+    }\n+\n+    public static LocalPaxosComponents createWithBlockingMigrationWithVersion(TimelockPaxosMetrics metrics,", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c167ba6e208692a0166d1b4db4b067a7f15fd89f"}, "originalPosition": 72}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjg4MTYwOTM1OnYy", "diffSide": "RIGHT", "path": "leader-election-api/src/main/java/com/palantir/leader/PingResult.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yOFQxMzoyOTozMVrOG4MlkA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yOFQxMzoyOTozMVrOG4MlkA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MTU3OTY2NA==", "bodyText": "Maybe premature: In practice, there are only two possible versions of this result on each TimeLock server. Thus, I'd propose interning the results to improve perf.", "url": "https://github.com/palantir/atlasdb/pull/4906#discussion_r461579664", "createdAt": "2020-07-28T13:29:31Z", "author": {"login": "jeremyk-91"}, "path": "leader-election-api/src/main/java/com/palantir/leader/PingResult.java", "diffHunk": "@@ -0,0 +1,33 @@\n+/*\n+ * (c) Copyright 2020 Palantir Technologies Inc. All rights reserved.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package com.palantir.leader;\n+\n+import java.util.Optional;\n+\n+import org.immutables.value.Value;\n+\n+import com.palantir.sls.versions.OrderableSlsVersion;\n+\n+@Value.Immutable\n+public interface PingResult {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c167ba6e208692a0166d1b4db4b067a7f15fd89f"}, "originalPosition": 26}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjg4MTYyMjE4OnYy", "diffSide": "RIGHT", "path": "timelock-agent/src/main/java/com/palantir/atlasdb/timelock/paxos/PaxosResourcesFactory.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yOFQxMzozMjowMlrOG4MtOw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yOFQxNzoyMTo0MVrOG4Wwrw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MTU4MTYyNw==", "bodyText": "I'd suggest we just put the version in the installation context (together with things like the user agent and cluster addresses).", "url": "https://github.com/palantir/atlasdb/pull/4906#discussion_r461581627", "createdAt": "2020-07-28T13:32:02Z", "author": {"login": "jeremyk-91"}, "path": "timelock-agent/src/main/java/com/palantir/atlasdb/timelock/paxos/PaxosResourcesFactory.java", "diffHunk": "@@ -60,10 +61,27 @@ public static PaxosResources create(\n             MetricsManager metrics,\n             Supplier<PaxosRuntimeConfiguration> paxosRuntime,\n             ExecutorService sharedExecutor) {\n+        return createWithVersion(install,\n+                metrics,\n+                paxosRuntime,\n+                sharedExecutor,\n+                Optional.empty());\n+    }\n+\n+    public static PaxosResources createWithVersion(TimelockPaxosInstallationContext install,\n+            MetricsManager metrics,\n+            Supplier<PaxosRuntimeConfiguration> paxosRuntime,\n+            ExecutorService sharedExecutor,\n+            Optional<OrderableSlsVersion> timeLockVersion) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c167ba6e208692a0166d1b4db4b067a7f15fd89f"}, "originalPosition": 23}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MTc0NjM1MQ==", "bodyText": "\ud83d\udc4d", "url": "https://github.com/palantir/atlasdb/pull/4906#discussion_r461746351", "createdAt": "2020-07-28T17:21:41Z", "author": {"login": "sudiksha27"}, "path": "timelock-agent/src/main/java/com/palantir/atlasdb/timelock/paxos/PaxosResourcesFactory.java", "diffHunk": "@@ -60,10 +61,27 @@ public static PaxosResources create(\n             MetricsManager metrics,\n             Supplier<PaxosRuntimeConfiguration> paxosRuntime,\n             ExecutorService sharedExecutor) {\n+        return createWithVersion(install,\n+                metrics,\n+                paxosRuntime,\n+                sharedExecutor,\n+                Optional.empty());\n+    }\n+\n+    public static PaxosResources createWithVersion(TimelockPaxosInstallationContext install,\n+            MetricsManager metrics,\n+            Supplier<PaxosRuntimeConfiguration> paxosRuntime,\n+            ExecutorService sharedExecutor,\n+            Optional<OrderableSlsVersion> timeLockVersion) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MTU4MTYyNw=="}, "originalCommit": {"oid": "c167ba6e208692a0166d1b4db4b067a7f15fd89f"}, "originalPosition": 23}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjg4NTQ4NTU4OnYy", "diffSide": "RIGHT", "path": "leader-election-api/src/main/java/com/palantir/leader/PingResult.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yOVQwOTo1MzoxN1rOG4xNiw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yOVQwOTo1MzoxN1rOG4xNiw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MjE3OTcyMw==", "bodyText": "nit: I'd write this as the current version of TimeLock that the server is on if this ping result came from a TimeLock server, and empty otherwise. (Imagine deployments of large internal product where TimeLock is running, but there is a separate cluster also running leader election.)", "url": "https://github.com/palantir/atlasdb/pull/4906#discussion_r462179723", "createdAt": "2020-07-29T09:53:17Z", "author": {"login": "jeremyk-91"}, "path": "leader-election-api/src/main/java/com/palantir/leader/PingResult.java", "diffHunk": "@@ -0,0 +1,42 @@\n+/*\n+ * (c) Copyright 2020 Palantir Technologies Inc. All rights reserved.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package com.palantir.leader;\n+\n+import java.util.Optional;\n+\n+import org.immutables.value.Value;\n+\n+import com.fasterxml.jackson.databind.annotation.JsonDeserialize;\n+import com.fasterxml.jackson.databind.annotation.JsonSerialize;\n+import com.palantir.sls.versions.OrderableSlsVersion;\n+\n+@Value.Immutable(intern = true)\n+@JsonSerialize(as = ImmutablePingResult.class)\n+@JsonDeserialize(as = ImmutablePingResult.class)\n+public interface PingResult {\n+    boolean isLeader();\n+\n+    /**\n+     * @return The current version of TimeLock that server is on\n+     * if TimeLock service is running, empty otherwise.\n+     */\n+    Optional<OrderableSlsVersion> timeLockVersion();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "629833f70647880d8cf216f6323255b41a3ecc60"}, "originalPosition": 37}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjg4NTQ5MDUyOnYy", "diffSide": "RIGHT", "path": "timelock-agent/src/main/java/com/palantir/atlasdb/timelock/paxos/PaxosResourcesFactory.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yOVQwOTo1NDozNVrOG4xQeg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yOVQwOTo1NDozNVrOG4xQeg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MjE4MDQ3NA==", "bodyText": "Since this is timelock-agent, why not make it compulsory?", "url": "https://github.com/palantir/atlasdb/pull/4906#discussion_r462180474", "createdAt": "2020-07-29T09:54:35Z", "author": {"login": "jeremyk-91"}, "path": "timelock-agent/src/main/java/com/palantir/atlasdb/timelock/paxos/PaxosResourcesFactory.java", "diffHunk": "@@ -265,6 +269,9 @@ private static PaxosResources configureLeaderForAllClients(\n         @Value.Parameter\n         TimeLockDialogueServiceProvider dialogueServiceProvider();\n \n+        @Value.Parameter\n+        Optional<OrderableSlsVersion> timeLockVersion();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "629833f70647880d8cf216f6323255b41a3ecc60"}, "originalPosition": 41}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjg4NTQ5NjA3OnYy", "diffSide": "RIGHT", "path": "timelock-agent/src/main/java/com/palantir/timelock/paxos/TimeLockAgent.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yOVQwOTo1NjowNlrOG4xT7Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yOVQwOTo1NjowNlrOG4xT7Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MjE4MTM1Nw==", "bodyText": "As above, I think if you're making a TimeLockAgent it's fine for this to be compulsory.\n(For the Benchmark Server and the test server here, you can use the AtlasDB version, perhaps?)", "url": "https://github.com/palantir/atlasdb/pull/4906#discussion_r462181357", "createdAt": "2020-07-29T09:56:06Z", "author": {"login": "jeremyk-91"}, "path": "timelock-agent/src/main/java/com/palantir/timelock/paxos/TimeLockAgent.java", "diffHunk": "@@ -90,19 +91,20 @@\n     private LeaderPingHealthCheck healthCheck;\n     private TimelockNamespaces namespaces;\n \n-    public static TimeLockAgent create(\n-            MetricsManager metricsManager,\n+    public static TimeLockAgent create(MetricsManager metricsManager,\n             TimeLockInstallConfiguration install,\n             Supplier<TimeLockRuntimeConfiguration> runtime,\n             UserAgent userAgent,\n             int threadPoolSize,\n             long blockingTimeoutMs,\n             Consumer<Object> registrar,\n-            Optional<Consumer<UndertowService>> undertowRegistrar) {\n+            Optional<Consumer<UndertowService>> undertowRegistrar,\n+            Optional<OrderableSlsVersion> timeLockVersion) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "629833f70647880d8cf216f6323255b41a3ecc60"}, "originalPosition": 23}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2735, "cost": 1, "resetAt": "2021-11-12T12:57:47Z"}}}