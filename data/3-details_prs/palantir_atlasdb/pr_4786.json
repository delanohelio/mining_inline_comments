{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDE5NTE4MjM0", "number": 4786, "title": "[PaxosStateLog] Reintroduce Migration and Verification with Locks", "bodyText": "Goals (and why):\nNow that we have locking, we can go ahead with the migration plans\nImplementation Description (bullets):\nRevert previous revert and wire in the locking mechanism\nTesting (What was existing testing like?  What have you done to improve it?):\nExisting tests pass\nConcerns (what feedback would you like?):\nWe are not locking in the migration state class. Doesn't seem necessary since we almost never write there, but we can add it if it's valuable\nWhere should we start reviewing?:\nThe revert is pretty straightforward, so mostly make sure nothing is strange and that the latest commit makes sense\nPriority (whenever / two weeks / yesterday):\nToday, after the other PR", "createdAt": "2020-05-18T13:54:07Z", "url": "https://github.com/palantir/atlasdb/pull/4786", "merged": true, "mergeCommit": {"oid": "6cabbcba73dacd1ae0bc8f1018087da4f5f11852"}, "closed": true, "closedAt": "2020-05-19T09:43:47Z", "author": {"login": "gmaretic"}, "timelineItems": {"totalCount": 7, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcihhIpAFqTQxMzY5Nzg5NA==", "endCursor": "Y3Vyc29yOnYyOpPPAAABciiIE1ABqjMzNDgwNTMzNjg=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDEzNjk3ODk0", "url": "https://github.com/palantir/atlasdb/pull/4786#pullrequestreview-413697894", "createdAt": "2020-05-18T15:21:21Z", "commit": {"oid": "c6910cc5da96ea97b1efb1c884673671b66bd463"}, "state": "APPROVED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xOFQxNToyMToyMVrOGW8DBg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xOFQxNToyMToyMVrOGW8DBg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNjcwNTY3MA==", "bodyText": "These don't happen simultaneously with the other instances in the other tests in this test class, so while this might be a bit sketchy it's ok", "url": "https://github.com/palantir/atlasdb/pull/4786#discussion_r426705670", "createdAt": "2020-05-18T15:21:21Z", "author": {"login": "jeremyk-91"}, "path": "leader-election-impl/src/test/java/com/palantir/paxos/SqlitePaxosStateLogMigrationStateTest.java", "diffHunk": "@@ -99,8 +99,8 @@ public void finishingMigrationForOneNamespaceDoesNotSetFlagForOthers() {\n     public void finishingMigrationForOneUseCaseDoesNotSetFlagForOthers() {\n         migrationState.migrateToValidationState();\n \n-        SqlitePaxosStateLogMigrationState otherState = SqlitePaxosStateLogMigrationState\n-                .create(ImmutableNamespaceAndUseCase.of(Client.of(\"namespace\"), \"other\"), connSupplier);\n+        SqlitePaxosStateLogMigrationState otherState = new SqlitePaxosStateLogFactory().createMigrationState(\n+                ImmutableNamespaceAndUseCase.of(Client.of(\"namespace\"), \"other\"), connSupplier);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c6910cc5da96ea97b1efb1c884673671b66bd463"}, "originalPosition": 27}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "bc344a43f99449e6eaa5f0c5f95db79fa45e215c", "author": {"user": {"login": "gmaretic", "name": null}}, "url": "https://github.com/palantir/atlasdb/commit/bc344a43f99449e6eaa5f0c5f95db79fa45e215c", "committedDate": "2020-05-18T15:51:06Z", "message": "Revert \"Revert \"[PaxosStateLog] Wire up and Migrate To Verifying PSL (#4775)\" (#4782)\"\n\nThis reverts commit 89a0cd4b40f7f79074758dd1db94300eef53bd74."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "d2a08e92dc3597903dec75e389dae7082859eda6", "author": {"user": {"login": "gmaretic", "name": null}}, "url": "https://github.com/palantir/atlasdb/commit/d2a08e92dc3597903dec75e389dae7082859eda6", "committedDate": "2020-05-18T15:51:06Z", "message": "Reintroduce migration for verification"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "76cd9993271f0f65d10e23ab94951d6d28fc80b2", "author": {"user": {"login": "gmaretic", "name": null}}, "url": "https://github.com/palantir/atlasdb/commit/76cd9993271f0f65d10e23ab94951d6d28fc80b2", "committedDate": "2020-05-18T15:51:06Z", "message": "Also lock for migration state"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e5d9a6d9a34cda455d6b46040859f06cf949ab01", "author": {"user": {"login": "gmaretic", "name": null}}, "url": "https://github.com/palantir/atlasdb/commit/e5d9a6d9a34cda455d6b46040859f06cf949ab01", "committedDate": "2020-05-18T16:04:42Z", "message": "Add logging"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "14aeb0114facc2d8cf238ac6b301fd7f0c3e5ad4", "author": {"user": {"login": "gmaretic", "name": null}}, "url": "https://github.com/palantir/atlasdb/commit/14aeb0114facc2d8cf238ac6b301fd7f0c3e5ad4", "committedDate": "2020-05-18T16:04:42Z", "message": "Add generated changelog entries"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "c6910cc5da96ea97b1efb1c884673671b66bd463", "author": {"user": {"login": "gmaretic", "name": null}}, "url": "https://github.com/palantir/atlasdb/commit/c6910cc5da96ea97b1efb1c884673671b66bd463", "committedDate": "2020-05-18T15:00:17Z", "message": "Also lock for migration state"}, "afterCommit": {"oid": "e5d9a6d9a34cda455d6b46040859f06cf949ab01", "author": {"user": {"login": "gmaretic", "name": null}}, "url": "https://github.com/palantir/atlasdb/commit/e5d9a6d9a34cda455d6b46040859f06cf949ab01", "committedDate": "2020-05-18T16:04:42Z", "message": "Add logging"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2855, "cost": 1, "resetAt": "2021-11-01T16:19:10Z"}}}