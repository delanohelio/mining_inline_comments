{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDEwMDE3Mzc5", "number": 4739, "title": "Revert revert stream corruption", "bodyText": "Goals (and why):\nThis PR reimplements the fix made in #4201 which was reverted in #4434.\nImplementation Description (bullets):\n\n\nRead the index table via both the method used in large internal method and the method used in #4201.\n\n\nProceed with deleting the unreferenced streams when the response from two methods matches.\n\n\nDo not delete unreferenced streams and log the discrepancies are observed otherwise.\n\n\nTesting (What was existing testing like?  What have you done to improve it?):\nExisting ETE tests should suffice.\nConcerns (what feedback would you like?):\nIs there a case where we delete things that should not be deleted?\nWhere should we start reviewing?:\nStreamStoreRenderer.java\nPriority (whenever / two weeks / yesterday):\nEnd of this week.", "createdAt": "2020-04-28T10:09:10Z", "url": "https://github.com/palantir/atlasdb/pull/4739", "merged": true, "mergeCommit": {"oid": "9f30141b0185eeae6612d24f2de8ad1c0248689f"}, "closed": true, "closedAt": "2020-04-30T11:57:24Z", "author": {"login": "sudiksha27"}, "timelineItems": {"totalCount": 20, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABccEHzHAH2gAyNDEwMDE3Mzc5OjhkZWEyNWU0NDcyODRkMWU4Y2Y3NTgxMWVhNGUzNzZkZmExY2ZjYzA=", "endCursor": "Y3Vyc29yOnYyOpPPAAABccq4HWAH2gAyNDEwMDE3Mzc5OjdkYzg1MzNkMTlkZWMwYWQyZGE5NjQwODc1ODUwMDBjMDUyODk3MGY=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "8dea25e447284d1e8cf75811ea4e376dfa1cfcc0", "author": {"user": {"login": "sudiksha27", "name": "sudiksha nanda"}}, "url": "https://github.com/palantir/atlasdb/commit/8dea25e447284d1e8cf75811ea4e376dfa1cfcc0", "committedDate": "2020-04-28T13:44:06Z", "message": "Add generated changelog entries"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "dcda138ad96b2c64c584a4d2ff40f337a1e0c48c", "author": {"user": {"login": "sudiksha27", "name": "sudiksha nanda"}}, "url": "https://github.com/palantir/atlasdb/commit/dcda138ad96b2c64c584a4d2ff40f337a1e0c48c", "committedDate": "2020-04-28T13:44:06Z", "message": "Add generated changelog entries"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c06e364a594a06af755d2d2a0d2d7a3eed4c9855", "author": {"user": {"login": "sudiksha27", "name": "sudiksha nanda"}}, "url": "https://github.com/palantir/atlasdb/commit/c06e364a594a06af755d2d2a0d2d7a3eed4c9855", "committedDate": "2020-04-28T13:44:06Z", "message": "Add generated changelog entries"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "3a987d7dbcfc303c8864645e0eae45ba1209e131", "author": {"user": {"login": "sudiksha27", "name": "sudiksha nanda"}}, "url": "https://github.com/palantir/atlasdb/commit/3a987d7dbcfc303c8864645e0eae45ba1209e131", "committedDate": "2020-04-28T14:53:03Z", "message": "Demo | Update metadata cleanup task to delete unreferenced streams"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "8651034bc26141603b690318b574039ad8874fe0", "author": {"user": {"login": "sudiksha27", "name": "sudiksha nanda"}}, "url": "https://github.com/palantir/atlasdb/commit/8651034bc26141603b690318b574039ad8874fe0", "committedDate": "2020-04-28T14:53:03Z", "message": "rm"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a75f4958ba5da132f7595b87f694cf1c648d73df", "author": {"user": {"login": "sudiksha27", "name": "sudiksha nanda"}}, "url": "https://github.com/palantir/atlasdb/commit/a75f4958ba5da132f7595b87f694cf1c648d73df", "committedDate": "2020-04-28T14:53:03Z", "message": "Modify renderer"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "6c310265002ea6c5b9bc7918d8dc0bfe968afebc", "author": {"user": {"login": "sudiksha27", "name": "sudiksha nanda"}}, "url": "https://github.com/palantir/atlasdb/commit/6c310265002ea6c5b9bc7918d8dc0bfe968afebc", "committedDate": "2020-04-28T14:53:03Z", "message": "Fix style"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a90d6e3ee2cdcdf07a411cd41261c53e28a23ed2", "author": {"user": {"login": "sudiksha27", "name": "sudiksha nanda"}}, "url": "https://github.com/palantir/atlasdb/commit/a90d6e3ee2cdcdf07a411cd41261c53e28a23ed2", "committedDate": "2020-04-28T14:53:03Z", "message": "Demo | Update metadata cleanup task to delete unreferenced streams"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f2bee610c3fafd2e608f3e42b97567a92805fbc3", "author": {"user": {"login": "sudiksha27", "name": "sudiksha nanda"}}, "url": "https://github.com/palantir/atlasdb/commit/f2bee610c3fafd2e608f3e42b97567a92805fbc3", "committedDate": "2020-04-28T14:53:04Z", "message": "rm"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "d3075743a049cc10786730c94fc5425d85e83567", "author": {"user": {"login": "sudiksha27", "name": "sudiksha nanda"}}, "url": "https://github.com/palantir/atlasdb/commit/d3075743a049cc10786730c94fc5425d85e83567", "committedDate": "2020-04-28T14:53:04Z", "message": "Regenerate schemas"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "2abbd50804dc2dca5a735099c37b4b85d12e3083", "author": {"user": {"login": "sudiksha27", "name": "sudiksha nanda"}}, "url": "https://github.com/palantir/atlasdb/commit/2abbd50804dc2dca5a735099c37b4b85d12e3083", "committedDate": "2020-04-28T13:44:06Z", "message": "Add generated changelog entries"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "23466611b84a0b5ac14eb9aa85156de33de49ec0", "author": {"user": {"login": "sudiksha27", "name": "sudiksha nanda"}}, "url": "https://github.com/palantir/atlasdb/commit/23466611b84a0b5ac14eb9aa85156de33de49ec0", "committedDate": "2020-04-28T13:44:06Z", "message": "Regenerate schemas"}, "afterCommit": {"oid": "d3075743a049cc10786730c94fc5425d85e83567", "author": {"user": {"login": "sudiksha27", "name": "sudiksha nanda"}}, "url": "https://github.com/palantir/atlasdb/commit/d3075743a049cc10786730c94fc5425d85e83567", "committedDate": "2020-04-28T14:53:04Z", "message": "Regenerate schemas"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "2c050213be3f64f0a876d4e4d17544c0b5693478", "author": {"user": {"login": "sudiksha27", "name": "sudiksha nanda"}}, "url": "https://github.com/palantir/atlasdb/commit/2c050213be3f64f0a876d4e4d17544c0b5693478", "committedDate": "2020-04-28T16:16:48Z", "message": "Fix tests"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "6b8cd3411ae300f73fa966f95347fa211d1878a3", "author": {"user": {"login": "sudiksha27", "name": "sudiksha nanda"}}, "url": "https://github.com/palantir/atlasdb/commit/6b8cd3411ae300f73fa966f95347fa211d1878a3", "committedDate": "2020-04-28T16:24:20Z", "message": "Merge branch 'revert_revert_stream_corruption' of github.com:palantir/atlasdb into revert_revert_stream_corruption"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "3346df9ccc79773ce77023b2893fd93c76994891", "author": {"user": {"login": "sudiksha27", "name": "sudiksha nanda"}}, "url": "https://github.com/palantir/atlasdb/commit/3346df9ccc79773ce77023b2893fd93c76994891", "committedDate": "2020-04-29T16:21:26Z", "message": "debug test"}, "afterCommit": {"oid": "6b8cd3411ae300f73fa966f95347fa211d1878a3", "author": {"user": {"login": "sudiksha27", "name": "sudiksha nanda"}}, "url": "https://github.com/palantir/atlasdb/commit/6b8cd3411ae300f73fa966f95347fa211d1878a3", "committedDate": "2020-04-28T16:24:20Z", "message": "Merge branch 'revert_revert_stream_corruption' of github.com:palantir/atlasdb into revert_revert_stream_corruption"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "50321d87c6963c658ad9909c445bc72735c9f64e", "author": {"user": {"login": "sudiksha27", "name": "sudiksha nanda"}}, "url": "https://github.com/palantir/atlasdb/commit/50321d87c6963c658ad9909c445bc72735c9f64e", "committedDate": "2020-04-29T18:31:49Z", "message": "Modify codegen | bug fix"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "486c62f81512d2c7a0df3aa70510c14936b88810", "author": {"user": {"login": "sudiksha27", "name": "sudiksha nanda"}}, "url": "https://github.com/palantir/atlasdb/commit/486c62f81512d2c7a0df3aa70510c14936b88810", "committedDate": "2020-04-29T18:36:56Z", "message": "Regenerate schemas"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDAzMzY4Mzc5", "url": "https://github.com/palantir/atlasdb/pull/4739#pullrequestreview-403368379", "createdAt": "2020-04-30T09:50:43Z", "commit": {"oid": "486c62f81512d2c7a0df3aa70510c14936b88810"}, "state": "APPROVED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0zMFQwOTo1MDo0M1rOGOiBow==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0zMFQwOTo1MDo0M1rOGOiBow==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNzg5MDcyMw==", "bodyText": "No need to ignore, just kill this test - it documents the broken behaviour at the time.", "url": "https://github.com/palantir/atlasdb/pull/4739#discussion_r417890723", "createdAt": "2020-04-30T09:50:43Z", "author": {"login": "jeremyk-91"}, "path": "atlasdb-ete-tests/src/test/java/com/palantir/atlasdb/ete/TargetedSweepEteTest.java", "diffHunk": "@@ -106,6 +105,7 @@ public void targetedSweepCleansUpUnmarkedStreamsTest() {\n     }\n \n     @Test\n+    @Ignore // TODO (jkong): This is obviously not the desired behaviour, but we are doing this for safety.", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "486c62f81512d2c7a0df3aa70510c14936b88810"}, "originalPosition": 12}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b3740f0457e2ec866ee65e3653d1530fc218f08d", "author": {"user": {"login": "sudiksha27", "name": "sudiksha nanda"}}, "url": "https://github.com/palantir/atlasdb/commit/b3740f0457e2ec866ee65e3653d1530fc218f08d", "committedDate": "2020-04-30T10:26:46Z", "message": "Remove redundant test"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "7dc8533d19dec0ad2da964087585000c0528970f", "author": {"user": {"login": "sudiksha27", "name": "sudiksha nanda"}}, "url": "https://github.com/palantir/atlasdb/commit/7dc8533d19dec0ad2da964087585000c0528970f", "committedDate": "2020-04-30T10:53:16Z", "message": "Checkstyle"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3106, "cost": 1, "resetAt": "2021-11-01T16:19:10Z"}}}