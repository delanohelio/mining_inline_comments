{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTI0MTYyOTY2", "number": 5122, "title": "[Cross Client Batching LeaderTimes - 2b] | MultiClientConjureTimelockService Dialogue Clients", "bodyText": "Goals (and why):\nAdd Dialogue client for MultiClientConjureTimelockService\nConcerns (what feedback would you like?):\nIs short timeout a reasonable choice here?\nWhere should we start reviewing?:\nAtlasDbDialogueServiceProvider.java\nPriority (whenever / two weeks / yesterday):\nTomorrow EOD", "createdAt": "2020-11-19T18:54:51Z", "url": "https://github.com/palantir/atlasdb/pull/5122", "merged": true, "mergeCommit": {"oid": "d9ab87a360f9c0176cf00d6b028346cdf59353c1"}, "closed": true, "closedAt": "2020-11-23T16:34:41Z", "author": {"login": "sudiksha27"}, "timelineItems": {"totalCount": 23, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdeG9LagH2gAyNTI0MTYyOTY2Ojk3ZmQyNzM3NDA1YzVlNzQ4YTAzZDk0ZmM1Y2FjMjU4MzYxYzlmNWI=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdfXl_aAH2gAyNTI0MTYyOTY2OmIyZWU5MzNjOGExMjNmZWFjNDIxMmExNjFlZDJhZDc0NzEwMjhlMDg=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "97fd2737405c5e748a03d94fc5cac258361c9f5b", "author": {"user": {"login": "sudiksha27", "name": "sudiksha nanda"}}, "url": "https://github.com/palantir/atlasdb/commit/97fd2737405c5e748a03d94fc5cac258361c9f5b", "committedDate": "2020-11-19T18:21:13Z", "message": " Fix tests + remove redundant tests"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b29f21a48ffec3c35777b1052180f02f0aa3a47c", "author": {"user": {"login": "sudiksha27", "name": "sudiksha nanda"}}, "url": "https://github.com/palantir/atlasdb/commit/b29f21a48ffec3c35777b1052180f02f0aa3a47c", "committedDate": "2020-11-19T18:22:00Z", "message": "Refactor LeaderTimeGetter"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c5a9196255c30684aada5e74efe4941b8da31ef5", "author": {"user": {"login": "sudiksha27", "name": "sudiksha nanda"}}, "url": "https://github.com/palantir/atlasdb/commit/c5a9196255c30684aada5e74efe4941b8da31ef5", "committedDate": "2020-11-19T18:22:00Z", "message": "Configurable bufferSize"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "66831ceacc4187c2ef4bfad18bcb795343cd38f4", "author": {"user": {"login": "sudiksha27", "name": "sudiksha nanda"}}, "url": "https://github.com/palantir/atlasdb/commit/66831ceacc4187c2ef4bfad18bcb795343cd38f4", "committedDate": "2020-11-19T18:22:00Z", "message": "Implement LeaderTimeCoalescingBatcher"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "904a0264e0dfb04a2174a13649c4fe6d6eaafc68", "author": {"user": {"login": "sudiksha27", "name": "sudiksha nanda"}}, "url": "https://github.com/palantir/atlasdb/commit/904a0264e0dfb04a2174a13649c4fe6d6eaafc68", "committedDate": "2020-11-19T18:22:00Z", "message": "Wire LeaderTimeGetter"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e777d72f96808db68a59aee9c4951164ae3b775b", "author": {"user": {"login": "sudiksha27", "name": "sudiksha nanda"}}, "url": "https://github.com/palantir/atlasdb/commit/e777d72f96808db68a59aee9c4951164ae3b775b", "committedDate": "2020-11-19T18:22:00Z", "message": "Fix build"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "605cbc3619f4252951b12377397f1a949e1dd998", "author": {"user": {"login": "sudiksha27", "name": "sudiksha nanda"}}, "url": "https://github.com/palantir/atlasdb/commit/605cbc3619f4252951b12377397f1a949e1dd998", "committedDate": "2020-11-19T18:22:00Z", "message": "Address comments"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "d66dec83618a44d80b189fb881c489d5f17fc4af", "author": {"user": {"login": "sudiksha27", "name": "sudiksha nanda"}}, "url": "https://github.com/palantir/atlasdb/commit/d66dec83618a44d80b189fb881c489d5f17fc4af", "committedDate": "2020-11-19T18:26:27Z", "message": "Remove redundant line"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b112b32f738970dc78620ba4a2232efa2672ed84", "author": {"user": {"login": "sudiksha27", "name": "sudiksha nanda"}}, "url": "https://github.com/palantir/atlasdb/commit/b112b32f738970dc78620ba4a2232efa2672ed84", "committedDate": "2020-11-19T18:45:27Z", "message": "Fix tests"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "35f74badc329dc922c01d66423fd3eeee6e6c0f3", "author": {"user": {"login": "sudiksha27", "name": "sudiksha nanda"}}, "url": "https://github.com/palantir/atlasdb/commit/35f74badc329dc922c01d66423fd3eeee6e6c0f3", "committedDate": "2020-11-19T18:45:27Z", "message": "Add generated changelog entries"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "3676c5373b79ce897dd2e998e9b139323cbde18d", "author": {"user": {"login": "sudiksha27", "name": "sudiksha nanda"}}, "url": "https://github.com/palantir/atlasdb/commit/3676c5373b79ce897dd2e998e9b139323cbde18d", "committedDate": "2020-11-19T18:53:16Z", "message": "Dialogue proxy for MultiClientConjureTimelockService"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "0bb112997f793060dfa8c4ab7b49cbe1637977ce", "author": {"user": {"login": "sudiksha27", "name": "sudiksha nanda"}}, "url": "https://github.com/palantir/atlasdb/commit/0bb112997f793060dfa8c4ab7b49cbe1637977ce", "committedDate": "2020-11-19T18:54:08Z", "message": "Spotless"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTM1MzUyODQw", "url": "https://github.com/palantir/atlasdb/pull/5122#pullrequestreview-535352840", "createdAt": "2020-11-20T11:36:51Z", "commit": {"oid": "0bb112997f793060dfa8c4ab7b49cbe1637977ce"}, "state": "COMMENTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0yMFQxMTozNjo1MVrOH3MMZw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0yMFQxMTozNzowM1rOH3MMvQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNzYzMzUxMQ==", "bodyText": "This should implement MultiClientConjureTimelockService?", "url": "https://github.com/palantir/atlasdb/pull/5122#discussion_r527633511", "createdAt": "2020-11-20T11:36:51Z", "author": {"login": "jeremyk-91"}, "path": "lock-api/src/main/java/com/palantir/lock/client/DialogueAdaptingMultiClientConjureTimelockService.java", "diffHunk": "@@ -0,0 +1,38 @@\n+/*\n+ * (c) Copyright 2020 Palantir Technologies Inc. All rights reserved.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package com.palantir.lock.client;\n+\n+import com.palantir.atlasdb.timelock.api.LeaderTimes;\n+import com.palantir.atlasdb.timelock.api.MultiClientConjureTimelockServiceBlocking;\n+import com.palantir.atlasdb.timelock.api.Namespace;\n+import com.palantir.tokens.auth.AuthHeader;\n+import java.util.Set;\n+\n+public class DialogueAdaptingMultiClientConjureTimelockService {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "0bb112997f793060dfa8c4ab7b49cbe1637977ce"}, "originalPosition": 25}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNzYzMzU5Nw==", "bodyText": "This shouldn't depend on the concrete type", "url": "https://github.com/palantir/atlasdb/pull/5122#discussion_r527633597", "createdAt": "2020-11-20T11:37:03Z", "author": {"login": "jeremyk-91"}, "path": "atlasdb-config/src/main/java/com/palantir/atlasdb/factory/AtlasDbDialogueServiceProvider.java", "diffHunk": "@@ -113,6 +115,17 @@ ConjureTimelockService getConjureTimelockService() {\n         return new TimeoutSensitiveConjureTimelockService(shortAndLongTimeoutServices);\n     }\n \n+    DialogueAdaptingMultiClientConjureTimelockService getMultiClientConjureTimelockService() {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "0bb112997f793060dfa8c4ab7b49cbe1637977ce"}, "originalPosition": 20}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "58d4d6d043e72ec755a91e5a69bd2b376675b9d2", "author": {"user": {"login": "sudiksha27", "name": "sudiksha nanda"}}, "url": "https://github.com/palantir/atlasdb/commit/58d4d6d043e72ec755a91e5a69bd2b376675b9d2", "committedDate": "2020-11-20T12:46:16Z", "message": "Merge branch 'develop' into ccb-lts-2b"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "2e5a918484a68fdae46c5f9e706eeb94c39755a1", "author": {"user": {"login": "sudiksha27", "name": "sudiksha nanda"}}, "url": "https://github.com/palantir/atlasdb/commit/2e5a918484a68fdae46c5f9e706eeb94c39755a1", "committedDate": "2020-11-20T12:55:38Z", "message": "Remove responsibilty of concrete class from DialogueServiceProvider"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a6fabfd31050ff7d2807d7c9a4f264d4b2c58224", "author": {"user": {"login": "sudiksha27", "name": "sudiksha nanda"}}, "url": "https://github.com/palantir/atlasdb/commit/a6fabfd31050ff7d2807d7c9a4f264d4b2c58224", "committedDate": "2020-11-20T18:19:47Z", "message": "Dependency Inversion"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "2a515e50ca64dc01d8ea5a2bca8f6bb76545aa25", "author": {"user": {"login": "sudiksha27", "name": "sudiksha nanda"}}, "url": "https://github.com/palantir/atlasdb/commit/2a515e50ca64dc01d8ea5a2bca8f6bb76545aa25", "committedDate": "2020-11-20T18:23:06Z", "message": "Add change so previous commit makes sense"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTM2NDc4MTYz", "url": "https://github.com/palantir/atlasdb/pull/5122#pullrequestreview-536478163", "createdAt": "2020-11-23T13:37:37Z", "commit": {"oid": "2a515e50ca64dc01d8ea5a2bca8f6bb76545aa25"}, "state": "COMMENTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0yM1QxMzozNzozN1rOH4Nx7A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0yM1QxMzozOTo1NVrOH4N3UQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyODcwODA3Ng==", "bodyText": "IntelliJ says this can be package-private, so please do so.", "url": "https://github.com/palantir/atlasdb/pull/5122#discussion_r528708076", "createdAt": "2020-11-23T13:37:37Z", "author": {"login": "Jolyon-S"}, "path": "lock-api/src/main/java/com/palantir/lock/client/LeaderTimeCoalescingBatcher.java", "diffHunk": "@@ -49,15 +47,15 @@ public void close() {\n     }\n \n     static class LeaderTimeCoalescingConsumer implements CoalescingRequestFunction<Namespace, LeaderTime> {\n-        private final MultiClientConjureTimelockService delegate;\n+        private final AuthenticatingMultiClientConjureTimelockService delegate;\n \n-        public LeaderTimeCoalescingConsumer(MultiClientConjureTimelockService delegate) {\n+        public LeaderTimeCoalescingConsumer(AuthenticatingMultiClientConjureTimelockService delegate) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "2a515e50ca64dc01d8ea5a2bca8f6bb76545aa25"}, "originalPosition": 30}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyODcwOTQ1Nw==", "bodyText": "I think I understand why we need the impl, but not the interface - I feel like this is a very specific interface (where I'd rather there is a more generic interface and AMCCTS is one of the implementations). Regardless, this is also possibly a misleading name: this always passes a token that is \"Bearer omitted\", which while technically is on the theme of authentication, feels a bit odd to call this an authenticating service.", "url": "https://github.com/palantir/atlasdb/pull/5122#discussion_r528709457", "createdAt": "2020-11-23T13:39:55Z", "author": {"login": "Jolyon-S"}, "path": "lock-api/src/main/java/com/palantir/lock/client/AuthenticatingMultiClientConjureTimelockService.java", "diffHunk": "@@ -0,0 +1,25 @@\n+/*\n+ * (c) Copyright 2020 Palantir Technologies Inc. All rights reserved.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package com.palantir.lock.client;\n+\n+import com.palantir.atlasdb.timelock.api.LeaderTimes;\n+import com.palantir.atlasdb.timelock.api.Namespace;\n+import java.util.Set;\n+\n+public interface AuthenticatingMultiClientConjureTimelockService {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "2a515e50ca64dc01d8ea5a2bca8f6bb76545aa25"}, "originalPosition": 23}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTM2NTY0MzQ5", "url": "https://github.com/palantir/atlasdb/pull/5122#pullrequestreview-536564349", "createdAt": "2020-11-23T15:10:35Z", "commit": {"oid": "2a515e50ca64dc01d8ea5a2bca8f6bb76545aa25"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0yM1QxNToxMDozNVrOH4RvBQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0yM1QxNToxMDozNVrOH4RvBQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyODc3Mjg2OQ==", "bodyText": "I wouldn't name this in this way: users elsewhere in the AtlasDB client code shouldn't need to know that authentication (or the lack thereof!) is a thing that's happening beyond this layer, which is an implementation detail. Conceptually this interface should be something like InternalMultiClientConjureTimelockService (possibly not a great name) and then your AuthMCCTSImpl should be AuthIMCCTS (or even UnauthedIMCCTS).", "url": "https://github.com/palantir/atlasdb/pull/5122#discussion_r528772869", "createdAt": "2020-11-23T15:10:35Z", "author": {"login": "jeremyk-91"}, "path": "lock-api/src/main/java/com/palantir/lock/client/AuthenticatingMultiClientConjureTimelockService.java", "diffHunk": "@@ -0,0 +1,25 @@\n+/*\n+ * (c) Copyright 2020 Palantir Technologies Inc. All rights reserved.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package com.palantir.lock.client;\n+\n+import com.palantir.atlasdb.timelock.api.LeaderTimes;\n+import com.palantir.atlasdb.timelock.api.Namespace;\n+import java.util.Set;\n+\n+public interface AuthenticatingMultiClientConjureTimelockService {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyODcwOTQ1Nw=="}, "originalCommit": {"oid": "2a515e50ca64dc01d8ea5a2bca8f6bb76545aa25"}, "originalPosition": 23}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "4be23f250658d6b42b2374e009db1f235d96e6a3", "author": {"user": {"login": "sudiksha27", "name": "sudiksha nanda"}}, "url": "https://github.com/palantir/atlasdb/commit/4be23f250658d6b42b2374e009db1f235d96e6a3", "committedDate": "2020-11-23T15:48:23Z", "message": "Refactor"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTM2NjI4NTkx", "url": "https://github.com/palantir/atlasdb/pull/5122#pullrequestreview-536628591", "createdAt": "2020-11-23T16:14:14Z", "commit": {"oid": "4be23f250658d6b42b2374e009db1f235d96e6a3"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0yM1QxNjoxNDoxNFrOH4U4nQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0yM1QxNjoxNDoxNFrOH4U4nQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyODgyNDQ3Nw==", "bodyText": "nit: sorry for confusion, AuthIMCCTS was just used as a short-hand, I'd prefer we use either Authenticated or Unauthenticated in full rather than Auth, which doesn't say much", "url": "https://github.com/palantir/atlasdb/pull/5122#discussion_r528824477", "createdAt": "2020-11-23T16:14:14Z", "author": {"login": "jeremyk-91"}, "path": "lock-api/src/main/java/com/palantir/lock/client/AuthInternalMultiClientConjureTimelockService.java", "diffHunk": "@@ -0,0 +1,38 @@\n+/*\n+ * (c) Copyright 2020 Palantir Technologies Inc. All rights reserved.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package com.palantir.lock.client;\n+\n+import com.palantir.atlasdb.timelock.api.LeaderTimes;\n+import com.palantir.atlasdb.timelock.api.MultiClientConjureTimelockServiceBlocking;\n+import com.palantir.atlasdb.timelock.api.Namespace;\n+import com.palantir.tokens.auth.AuthHeader;\n+import java.util.Set;\n+\n+public class AuthInternalMultiClientConjureTimelockService implements InternalMultiClientConjureTimelockService {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "4be23f250658d6b42b2374e009db1f235d96e6a3"}, "originalPosition": 25}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTM2NjI4OTcz", "url": "https://github.com/palantir/atlasdb/pull/5122#pullrequestreview-536628973", "createdAt": "2020-11-23T16:14:37Z", "commit": {"oid": "4be23f250658d6b42b2374e009db1f235d96e6a3"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b2ee933c8a123feac4212a161ed2ad7471028e08", "author": {"user": {"login": "sudiksha27", "name": "sudiksha nanda"}}, "url": "https://github.com/palantir/atlasdb/commit/b2ee933c8a123feac4212a161ed2ad7471028e08", "committedDate": "2020-11-23T16:18:12Z", "message": "Rename"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2508, "cost": 1, "resetAt": "2021-11-01T16:19:10Z"}}}