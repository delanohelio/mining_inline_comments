{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDU4NDY0MDMz", "number": 4923, "reviewThreads": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0wN1QxMjo1NTowNlrOEWNDAA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xMVQxMDowMTozN1rOEXJCxw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjkxNzE3ODg4OnYy", "diffSide": "RIGHT", "path": "leader-election-impl/src/main/java/com/palantir/leader/LeadershipEvents.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0wN1QxMjo1NTowNlrOG9YwVA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0wN1QxMjo1NTowNlrOG9YwVA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NzAyMTkwOA==", "bodyText": "I'd suggest we rate limit the log message to maybe once every 10 or 30 seconds - timelocks otherwise ping each other 10 times per second meaning it'll be really noisy!", "url": "https://github.com/palantir/atlasdb/pull/4923#discussion_r467021908", "createdAt": "2020-08-07T12:55:06Z", "author": {"login": "jeremyk-91"}, "path": "leader-election-impl/src/main/java/com/palantir/leader/LeadershipEvents.java", "diffHunk": "@@ -88,6 +89,13 @@ void proposalFailure(PaxosRoundFailureException paxosException) {\n         leaderElectionServiceMetrics.proposalFailure().mark();\n     }\n \n+    public void leaderOnOlderTimeLockVersion(OrderableSlsVersion version) {\n+        // TODO(snanda): Kill log after few successful runs of blue-green deployment.\n+        leaderLog.info(\"We contacted the leader and it reported that it is on an older version of TimeLock - {}\",\n+                withContextArgs(SafeArg.of(\"version\", version)));\n+        leaderElectionServiceMetrics.leaderOnOlderTimeLockVersion().mark();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d081b65771e65b169575c37eb4d580599acc3132"}, "originalPosition": 16}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjkxNzE5NjkyOnYy", "diffSide": "RIGHT", "path": "lock-api-objects/build.gradle", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0wN1QxMjo1OTo1NlrOG9Y6sA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0wN1QxMzoxMzo1NFrOG9ZXAQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NzAyNDU2MA==", "bodyText": "Do we know what the semantics of having a product dependency on oneself are? (In particular, are we sure this restricts timelock to upgrading to this version only if it is already at least on 0.227.1, which I think is what this relies on?)", "url": "https://github.com/palantir/atlasdb/pull/4923#discussion_r467024560", "createdAt": "2020-08-07T12:59:56Z", "author": {"login": "jeremyk-91"}, "path": "lock-api-objects/build.gradle", "diffHunk": "@@ -27,7 +27,7 @@ recommendedProductDependencies {\n     productDependency {\n         productGroup = 'com.palantir.timelock'\n         productName = 'timelock-server'\n-        minimumVersion = '0.218.0'\n+        minimumVersion = '0.227.1'", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d081b65771e65b169575c37eb4d580599acc3132"}, "originalPosition": 5}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NzAzMTgwOQ==", "bodyText": "I think we might need to use Schema Versions for this and/or have a fallback mechanism that hits pingv1 actually", "url": "https://github.com/palantir/atlasdb/pull/4923#discussion_r467031809", "createdAt": "2020-08-07T13:13:54Z", "author": {"login": "jeremyk-91"}, "path": "lock-api-objects/build.gradle", "diffHunk": "@@ -27,7 +27,7 @@ recommendedProductDependencies {\n     productDependency {\n         productGroup = 'com.palantir.timelock'\n         productName = 'timelock-server'\n-        minimumVersion = '0.218.0'\n+        minimumVersion = '0.227.1'", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NzAyNDU2MA=="}, "originalCommit": {"oid": "d081b65771e65b169575c37eb4d580599acc3132"}, "originalPosition": 5}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjkyNzAwODcxOnYy", "diffSide": "RIGHT", "path": "timelock-agent/src/main/java/com/palantir/timelock/paxos/TimeLockAgent.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xMVQxMDowMTozN1rOG-w-Kg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xMVQxMDowMTozN1rOG-w-Kg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2ODQ2NzI0Mg==", "bodyText": "This is not required.", "url": "https://github.com/palantir/atlasdb/pull/4923#discussion_r468467242", "createdAt": "2020-08-11T10:01:37Z", "author": {"login": "jeremyk-91"}, "path": "timelock-agent/src/main/java/com/palantir/timelock/paxos/TimeLockAgent.java", "diffHunk": "@@ -77,7 +77,7 @@\n @SuppressWarnings(\"checkstyle:FinalClass\") // This is mocked internally\n public class TimeLockAgent {\n     // Schema version from 2 onwards are on SQLite\n-    private static final Long SCHEMA_VERSION = 3L;\n+    private static final Long SCHEMA_VERSION = 4L;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "e027d9f78e84cf2dfd7f8afa6f73bb215a1037a7"}, "originalPosition": 5}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2756, "cost": 1, "resetAt": "2021-11-12T12:57:47Z"}}}