{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0Mzk0NjU3MjU5", "number": 4680, "reviewThreads": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yN1QxMDo0MTo1NlrODsAr9Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yN1QxMzozNjo1NFrODsEVlg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjQ3NDc1MTg5OnYy", "diffSide": "RIGHT", "path": "atlasdb-cli/src/main/java/com/palantir/atlasdb/cli/command/KvsMigrationCommand.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yN1QxMDo0MTo1NlrOF8rvvw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yN1QxMTowNToxNlrOF8sfHg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5OTE3NTYxNQ==", "bodyText": "Why is it hard to make the verification step use multiple transactions, same as migration.", "url": "https://github.com/palantir/atlasdb/pull/4680#discussion_r399175615", "createdAt": "2020-03-27T10:41:56Z", "author": {"login": "jkozlowski"}, "path": "atlasdb-cli/src/main/java/com/palantir/atlasdb/cli/command/KvsMigrationCommand.java", "diffHunk": "@@ -40,6 +41,7 @@\n @Command(name = \"migrate\", description = \"Migrate your data from one key value service to another.\")\n public class KvsMigrationCommand implements Callable<Integer> {\n     private static final OutputPrinter printer = new OutputPrinter(LoggerFactory.getLogger(KvsMigrationCommand.class));\n+    private static final int TRANSACTION_READ_TIMEOUT_MILLIS_OVERRIDE = 8 * 60 * 60 * 1000;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "718de56a0aca7a947dd303f93048705a51f4d165"}, "originalPosition": 12}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5OTE4Nzc0Mg==", "bodyText": "#4681", "url": "https://github.com/palantir/atlasdb/pull/4680#discussion_r399187742", "createdAt": "2020-03-27T11:05:16Z", "author": {"login": "Jolyon-S"}, "path": "atlasdb-cli/src/main/java/com/palantir/atlasdb/cli/command/KvsMigrationCommand.java", "diffHunk": "@@ -40,6 +41,7 @@\n @Command(name = \"migrate\", description = \"Migrate your data from one key value service to another.\")\n public class KvsMigrationCommand implements Callable<Integer> {\n     private static final OutputPrinter printer = new OutputPrinter(LoggerFactory.getLogger(KvsMigrationCommand.class));\n+    private static final int TRANSACTION_READ_TIMEOUT_MILLIS_OVERRIDE = 8 * 60 * 60 * 1000;", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5OTE3NTYxNQ=="}, "originalCommit": {"oid": "718de56a0aca7a947dd303f93048705a51f4d165"}, "originalPosition": 12}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjQ3NTExNTY3OnYy", "diffSide": "RIGHT", "path": "atlasdb-cli/src/main/java/com/palantir/atlasdb/cli/command/KvsMigrationCommand.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yN1QxMjozNTo0MVrOF8vOkQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yN1QxMjozNTo0MVrOF8vOkQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5OTIzMjY1Nw==", "bodyText": "If we're going to do it this way, we should probably also disable retries in the validator; if you hit a problem after a couple hours it doesn't really buy you much to retry, becuase nobody will sit there for that long.", "url": "https://github.com/palantir/atlasdb/pull/4680#discussion_r399232657", "createdAt": "2020-03-27T12:35:41Z", "author": {"login": "jkozlowski"}, "path": "atlasdb-cli/src/main/java/com/palantir/atlasdb/cli/command/KvsMigrationCommand.java", "diffHunk": "@@ -150,21 +152,29 @@ private AtlasDbConfig makeOfflineIfNecessary(AtlasDbConfig atlasDbConfig) {\n     }\n \n     public AtlasDbServices connectFromServices() throws IOException {\n-        AtlasDbConfig fromConfig = AtlasDbConfigs.load(fromConfigFile, configRoot, AtlasDbConfig.class);\n+        AtlasDbConfig fromConfig = overrideTransactionTimeoutMillis(\n+                AtlasDbConfigs.load(fromConfigFile, configRoot, AtlasDbConfig.class));\n         ServicesConfigModule scm = ServicesConfigModule.create(\n                 makeOfflineIfNecessary(fromConfig), AtlasDbRuntimeConfig.withSweepDisabled());\n         return DaggerAtlasDbServices.builder().servicesConfigModule(scm).build();\n     }\n \n     public AtlasDbServices connectToServices() throws IOException {\n-        AtlasDbConfig toConfig = toConfigFile != null\n-                ? AtlasDbConfigs.load(toConfigFile, configRoot, AtlasDbConfig.class)\n-                : AtlasDbConfigs.loadFromString(inlineConfig, null, AtlasDbConfig.class);\n+        AtlasDbConfig toConfig = overrideTransactionTimeoutMillis(\n+                toConfigFile != null\n+                        ? AtlasDbConfigs.load(toConfigFile, configRoot, AtlasDbConfig.class)\n+                        : AtlasDbConfigs.loadFromString(inlineConfig, null, AtlasDbConfig.class));\n         ServicesConfigModule scm = ServicesConfigModule.create(\n                 makeOfflineIfNecessary(toConfig), AtlasDbRuntimeConfig.withSweepDisabled());\n         return DaggerAtlasDbServices.builder().servicesConfigModule(scm).build();\n     }\n \n+    private AtlasDbConfig overrideTransactionTimeoutMillis(AtlasDbConfig config) {\n+        return ImmutableAtlasDbConfig.builder().from(config)\n+                .transactionReadTimeoutMillis(TRANSACTION_READ_TIMEOUT_MILLIS_OVERRIDE)", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "718de56a0aca7a947dd303f93048705a51f4d165"}, "originalPosition": 43}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjQ3NTM0ODc5OnYy", "diffSide": "RIGHT", "path": "changelog/@unreleased/pr-4680.v2.yml", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yN1QxMzozNjozOVrOF8xb-g==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yN1QxMzozNjozOVrOF8xb-g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5OTI2ODg1OA==", "bodyText": "Update changelog", "url": "https://github.com/palantir/atlasdb/pull/4680#discussion_r399268858", "createdAt": "2020-03-27T13:36:39Z", "author": {"login": "jkozlowski"}, "path": "changelog/@unreleased/pr-4680.v2.yml", "diffHunk": "@@ -0,0 +1,5 @@\n+type: improvement\n+improvement:\n+  description: '[PDS-114184] Increase transaction read timeout in CLI to 8 hours'", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "91fb37933a7181663534bb67861d50b097d36e55"}, "originalPosition": 3}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjQ3NTM0OTk4OnYy", "diffSide": "RIGHT", "path": "atlasdb-impl-shared/src/main/java/com/palantir/atlasdb/schema/KeyValueServiceValidator.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yN1QxMzozNjo1NFrOF8xcuw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yN1QxMzozNjo1NFrOF8xcuw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5OTI2OTA1MQ==", "bodyText": "Put a comment why you don't want retryes", "url": "https://github.com/palantir/atlasdb/pull/4680#discussion_r399269051", "createdAt": "2020-03-27T13:36:54Z", "author": {"login": "jkozlowski"}, "path": "atlasdb-impl-shared/src/main/java/com/palantir/atlasdb/schema/KeyValueServiceValidator.java", "diffHunk": "@@ -115,7 +115,7 @@ private void validateTables(Set<TableReference> tables) {\n     private void validateTable(final TableReference table) {\n         final int limit = getBatchSize(table);\n         // read only, but need to use a write tx in case the source table has SweepStrategy.THOROUGH\n-        validationFromTransactionManager.runTaskWithRetry(\n+        validationFromTransactionManager.runTaskThrowOnConflict(", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "91fb37933a7181663534bb67861d50b097d36e55"}, "originalPosition": 5}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3017, "cost": 1, "resetAt": "2021-11-12T12:57:47Z"}}}