{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDUwMDU5NzMx", "number": 4901, "title": "[PDS-126257] Turning Tables: Checked Rejection Executor Services", "bodyText": "Goals (and why):\n\nSee PDS-126257\nWe can't trust developers (including myself) to correctly remember to catch RejectedExecutionException: it's a random case that only happens occasionally at our biggest deployments.\n\nImplementation Description (bullets):\n\nA {@link CheckedRejectionExecutorService} is an executor where submitters of tasks MUST be prepared to handle execution being rejected - and we thus throw a checked exception when submitting tasks. (Thanks to @j-baker for the idea!)\nThis should make things fail at compile time.\n\nTesting (What was existing testing like?  What have you done to improve it?):\n\nAdded tests for the new classes. Otherwise the compiler should be as good a test as any that wiring is correct.\n\nConcerns (what feedback would you like?):\n\nDid I fudge the wiring up nonetheless?\n\nWhere should we start reviewing?: CheckedRejectionExecutorService.java\nPriority (whenever / two weeks / yesterday): next week?", "createdAt": "2020-07-16T09:52:16Z", "url": "https://github.com/palantir/atlasdb/pull/4901", "merged": true, "mergeCommit": {"oid": "bb530a9e4ca0dfe968f136fc1e01a53bf8132783"}, "closed": true, "closedAt": "2020-07-29T10:27:26Z", "author": {"login": "jeremyk-91"}, "timelineItems": {"totalCount": 24, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABc1bmIIgH2gAyNDUwMDU5NzMxOjU5OTQzMDNiYTMyOWMxNDg5ZDk1ZTJhN2MwOWJhYTJlYTZmOWM1MDY=", "endCursor": "Y3Vyc29yOnYyOpPPAAABc5ZhSWgFqTQ1NjgzNDgxNg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "5994303ba329c1489d95e2a7c09baa2ea6f9c506", "author": {"user": {"login": "jeremyk-91", "name": "Jeremy Kong"}}, "url": "https://github.com/palantir/atlasdb/commit/5994303ba329c1489d95e2a7c09baa2ea6f9c506", "committedDate": "2020-07-16T09:13:09Z", "message": "fixes part 1"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "1ca19cdeee4d6283e5a52eebb6819de50b6bbd7c", "author": {"user": {"login": "jeremyk-91", "name": "Jeremy Kong"}}, "url": "https://github.com/palantir/atlasdb/commit/1ca19cdeee4d6283e5a52eebb6819de50b6bbd7c", "committedDate": "2020-07-16T09:13:09Z", "message": "adapters"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "317905123516dd88049d823a972d8265e0ecd3c9", "author": {"user": {"login": "jeremyk-91", "name": "Jeremy Kong"}}, "url": "https://github.com/palantir/atlasdb/commit/317905123516dd88049d823a972d8265e0ecd3c9", "committedDate": "2020-07-16T09:13:09Z", "message": "Kill sharedexecutor part 1"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "684910e00a32b46e3f09af6427ae549e86b38a72", "author": {"user": {"login": "jeremyk-91", "name": "Jeremy Kong"}}, "url": "https://github.com/palantir/atlasdb/commit/684910e00a32b46e3f09af6427ae549e86b38a72", "committedDate": "2020-07-16T09:13:09Z", "message": "Out damned SharedExecutor"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ee50d8a3f100d7835492e45bfdfe8cf1ce098c10", "author": {"user": {"login": "jeremyk-91", "name": "Jeremy Kong"}}, "url": "https://github.com/palantir/atlasdb/commit/ee50d8a3f100d7835492e45bfdfe8cf1ce098c10", "committedDate": "2020-07-16T09:13:10Z", "message": "Burn things all down"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "fa4e37bf41238df56d8252c2bf5aaacfbda35b9b", "author": {"user": {"login": "jeremyk-91", "name": "Jeremy Kong"}}, "url": "https://github.com/palantir/atlasdb/commit/fa4e37bf41238df56d8252c2bf5aaacfbda35b9b", "committedDate": "2020-07-16T09:13:10Z", "message": "more things"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "bc7f12a86e4f83fab61b2530950ebd11b19bb068", "author": {"user": {"login": "jeremyk-91", "name": "Jeremy Kong"}}, "url": "https://github.com/palantir/atlasdb/commit/bc7f12a86e4f83fab61b2530950ebd11b19bb068", "committedDate": "2020-07-16T09:13:10Z", "message": "Hard block some tasks"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "50031825758b34df0c9bfe5bf3ea06eb8861d4d0", "author": {"user": {"login": "jeremyk-91", "name": "Jeremy Kong"}}, "url": "https://github.com/palantir/atlasdb/commit/50031825758b34df0c9bfe5bf3ea06eb8861d4d0", "committedDate": "2020-07-16T09:13:10Z", "message": "Undo hyper-aggressive stress test"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "5dae79d136c61b12e86fb32173337c1043d5b26b", "author": {"user": {"login": "jeremyk-91", "name": "Jeremy Kong"}}, "url": "https://github.com/palantir/atlasdb/commit/5dae79d136c61b12e86fb32173337c1043d5b26b", "committedDate": "2020-07-16T09:13:10Z", "message": "fixup"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "8f4675e6c10ab2098198c1c69ea2d654b3d92441", "author": {"user": {"login": "jeremyk-91", "name": "Jeremy Kong"}}, "url": "https://github.com/palantir/atlasdb/commit/8f4675e6c10ab2098198c1c69ea2d654b3d92441", "committedDate": "2020-07-16T09:13:10Z", "message": "Increase threshold to 384"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "775e9e2564aa7c4efa80c7bd55257439255d7c34", "author": {"user": {"login": "jeremyk-91", "name": "Jeremy Kong"}}, "url": "https://github.com/palantir/atlasdb/commit/775e9e2564aa7c4efa80c7bd55257439255d7c34", "committedDate": "2020-07-16T09:13:10Z", "message": "Add generated changelog entries"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "aa0d43bf2becf66d0a44e35620a5220f13341db4", "author": {"user": {"login": "jeremyk-91", "name": "Jeremy Kong"}}, "url": "https://github.com/palantir/atlasdb/commit/aa0d43bf2becf66d0a44e35620a5220f13341db4", "committedDate": "2020-07-16T09:13:10Z", "message": "Fix bug with leader pinger"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "eeead8c4960cc3529b389ba4450876766d5133f8", "author": {"user": {"login": "jeremyk-91", "name": "Jeremy Kong"}}, "url": "https://github.com/palantir/atlasdb/commit/eeead8c4960cc3529b389ba4450876766d5133f8", "committedDate": "2020-07-16T09:41:07Z", "message": "Introduce checked ones"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "509b1f6983ec7ff8c0d548cbe412e5d63c0d3400", "author": {"user": {"login": "jeremyk-91", "name": "Jeremy Kong"}}, "url": "https://github.com/palantir/atlasdb/commit/509b1f6983ec7ff8c0d548cbe412e5d63c0d3400", "committedDate": "2020-07-16T09:41:07Z", "message": "rewiring"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "89fb87243b69160fd1e9a7b541c79e589f9a65fc", "author": {"user": {"login": "jeremyk-91", "name": "Jeremy Kong"}}, "url": "https://github.com/palantir/atlasdb/commit/89fb87243b69160fd1e9a7b541c79e589f9a65fc", "committedDate": "2020-07-16T09:41:07Z", "message": "Test"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c593b2c3f7a583401a8fbcdc251905ee893300fc", "author": {"user": {"login": "jeremyk-91", "name": "Jeremy Kong"}}, "url": "https://github.com/palantir/atlasdb/commit/c593b2c3f7a583401a8fbcdc251905ee893300fc", "committedDate": "2020-07-16T09:52:06Z", "message": "docs"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDQ5Nzg4MzI5", "url": "https://github.com/palantir/atlasdb/pull/4901#pullrequestreview-449788329", "createdAt": "2020-07-16T12:14:43Z", "commit": {"oid": "c593b2c3f7a583401a8fbcdc251905ee893300fc"}, "state": "COMMENTED", "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xNlQxMjoxNDo0M1rOGyoNWA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xNlQxMjo0MTowMVrOGypF2w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NTc0MDc2MA==", "bodyText": "\ud83d\udc4d", "url": "https://github.com/palantir/atlasdb/pull/4901#discussion_r455740760", "createdAt": "2020-07-16T12:14:43Z", "author": {"login": "sudiksha27"}, "path": "timelock-agent/src/main/java/com/palantir/atlasdb/timelock/paxos/TimeLockPaxosExecutors.java", "diffHunk": "@@ -39,15 +40,17 @@ private TimeLockPaxosExecutors() {\n      *\n      * It is assumed that tasks run on the local node will return quickly (hence the use of the direct executor).\n      */\n-    static <T> Map<T, ExecutorService> createBoundedExecutors(\n-            MetricRegistry metricRegistry, LocalAndRemotes<T> localAndRemotes, String useCase) {\n+    static <T> Map<T, CheckedRejectionExecutorService> createBoundedExecutors(\n+            LocalAndRemotes<T> localAndRemotes, String useCase) {\n         int numRemotes = localAndRemotes.remotes().size();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c593b2c3f7a583401a8fbcdc251905ee893300fc"}, "originalPosition": 16}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NTc0MjAwMA==", "bodyText": "nit: there are unused imports in some other places as well where ExecutorService is replaced by CheckedRejectionExecutorService", "url": "https://github.com/palantir/atlasdb/pull/4901#discussion_r455742000", "createdAt": "2020-07-16T12:17:00Z", "author": {"login": "sudiksha27"}, "path": "timelock-impl/src/main/java/com/palantir/atlasdb/timelock/paxos/AutobatchingPaxosAcceptorNetworkClientFactory.java", "diffHunk": "@@ -28,6 +28,7 @@\n import com.google.common.util.concurrent.ListenableFuture;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c593b2c3f7a583401a8fbcdc251905ee893300fc"}, "originalPosition": 1}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NTc1NTIyNw==", "bodyText": "Where is this used?", "url": "https://github.com/palantir/atlasdb/pull/4901#discussion_r455755227", "createdAt": "2020-07-16T12:41:01Z", "author": {"login": "sudiksha27"}, "path": "timelock-impl/src/main/java/com/palantir/atlasdb/timelock/paxos/PaxosQuorumCheckingCoalescingFunction.java", "diffHunk": "@@ -111,7 +112,7 @@ private PaxosQuorumCheckingCoalescingFunction(\n     public static <REQ, RESP extends PaxosResponse, SERVICE, F extends CoalescingRequestFunction<REQ, RESP>>\n     PaxosQuorumCheckingCoalescingFunction<REQ, RESP, F> wrapWithRemotes(\n             List<SERVICE> services,\n-            Map<SERVICE, ExecutorService> executors,\n+            Map<SERVICE, CheckedRejectionExecutorService> executors,\n             int quorumSize,\n             Function<SERVICE, F> functionFactory) {\n         List<FunctionAndExecutor<F>> functionsAndExecutors = KeyedStream.of(services)", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c593b2c3f7a583401a8fbcdc251905ee893300fc"}, "originalPosition": 32}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "4c464bde70b68b29fc480f3987cb2d84efee2588", "author": {"user": {"login": "jeremyk-91", "name": "Jeremy Kong"}}, "url": "https://github.com/palantir/atlasdb/commit/4c464bde70b68b29fc480f3987cb2d84efee2588", "committedDate": "2020-07-16T15:35:25Z", "message": "Baseline"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "239cb7d188b0f7106f00d3d7eca63f6730b8194c", "author": {"user": {"login": "jeremyk-91", "name": "Jeremy Kong"}}, "url": "https://github.com/palantir/atlasdb/commit/239cb7d188b0f7106f00d3d7eca63f6730b8194c", "committedDate": "2020-07-27T20:40:31Z", "message": "Fix broken test"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a1a3d226fe611bd15f9c9e465bf8aca7694f19f3", "author": {"user": {"login": "jeremyk-91", "name": "Jeremy Kong"}}, "url": "https://github.com/palantir/atlasdb/commit/a1a3d226fe611bd15f9c9e465bf8aca7694f19f3", "committedDate": "2020-07-27T20:51:27Z", "message": "Merge branch 'develop' into jkong/checked-mc"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "df2b39f6ecc07a09503c1181d7ed6cfeed931756", "author": {"user": {"login": "jeremyk-91", "name": "Jeremy Kong"}}, "url": "https://github.com/palantir/atlasdb/commit/df2b39f6ecc07a09503c1181d7ed6cfeed931756", "committedDate": "2020-07-27T20:55:55Z", "message": "fix tests"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "1f52c19dfdf43f9ef9e671de5cef74fec0429054", "author": {"user": {"login": "jeremyk-91", "name": "Jeremy Kong"}}, "url": "https://github.com/palantir/atlasdb/commit/1f52c19dfdf43f9ef9e671de5cef74fec0429054", "committedDate": "2020-07-28T09:57:26Z", "message": "Checkstyle"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "3619a051d4683e359d9b3efe64741dbd161fc412", "author": {"user": {"login": "jeremyk-91", "name": "Jeremy Kong"}}, "url": "https://github.com/palantir/atlasdb/commit/3619a051d4683e359d9b3efe64741dbd161fc412", "committedDate": "2020-07-28T17:01:05Z", "message": "Optimize Imports"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDU2ODM0ODE2", "url": "https://github.com/palantir/atlasdb/pull/4901#pullrequestreview-456834816", "createdAt": "2020-07-28T17:03:45Z", "commit": {"oid": "3619a051d4683e359d9b3efe64741dbd161fc412"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2743, "cost": 1, "resetAt": "2021-11-01T16:19:10Z"}}}