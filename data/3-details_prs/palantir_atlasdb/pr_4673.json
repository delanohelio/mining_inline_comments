{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0MzkzNzUxNzQ4", "number": 4673, "title": "Include extra tags for failure metrics", "bodyText": "Goals (and why):\nIf we've included extra tags, if for any reason they fail, it'd be nice to see the failures grouped by those extra tags as well.\nImplementation Description (bullets):\nAdd tags to MetricName in the failure case.\nTesting (What was existing testing like?  What have you done to improve it?):\nConcerns (what feedback would you like?):\nWhere should we start reviewing?:\nPriority (whenever / two weeks / yesterday):\nWhenever, fairly tiny.", "createdAt": "2020-03-25T18:21:21Z", "url": "https://github.com/palantir/atlasdb/pull/4673", "merged": true, "mergeCommit": {"oid": "1d4d9cb8f5dfeb7b8418290594f7a46b33211a02"}, "closed": true, "closedAt": "2020-03-26T08:42:54Z", "author": {"login": "felixdesouza"}, "timelineItems": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcRLriHAH2gAyMzkzNzUxNzQ4Ojg0YjcwYTRlZGYzZDBiMWRmNmIwYjQ5ZTE1OTdjY2Y3NjE4MDBmNTA=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcRXuh3AH2gAyMzkzNzUxNzQ4OjE4MDcyZDNiODg3MGRlZWM1MGI3ZGMyZjA0MDBhOWYyOGY5YWU2MTE=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "84b70a4edf3d0b1df6b0b49e1597ccf761800f50", "author": {"user": {"login": "felixdesouza", "name": "Felix de Souza"}}, "url": "https://github.com/palantir/atlasdb/commit/84b70a4edf3d0b1df6b0b49e1597ccf761800f50", "committedDate": "2020-03-25T18:19:18Z", "message": "include extra tags for failure metrics"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "17fb6567af36c1f6839cc8693e76cdd266516f8d", "author": {"user": {"login": "felixdesouza", "name": "Felix de Souza"}}, "url": "https://github.com/palantir/atlasdb/commit/17fb6567af36c1f6839cc8693e76cdd266516f8d", "committedDate": "2020-03-24T14:49:55Z", "message": "Add generated changelog entries"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzgxNDk4MjIy", "url": "https://github.com/palantir/atlasdb/pull/4673#pullrequestreview-381498222", "createdAt": "2020-03-25T20:10:43Z", "commit": {"oid": "17fb6567af36c1f6839cc8693e76cdd266516f8d"}, "state": "APPROVED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yNVQyMDoxMDo0M1rOF7saMw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yNVQyMDoxMDo0M1rOF7saMw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5ODEzNzkwNw==", "bodyText": "nit: orElseGet(() -> ... (as CircleCI kindly pointed out).", "url": "https://github.com/palantir/atlasdb/pull/4673#discussion_r398137907", "createdAt": "2020-03-25T20:10:43Z", "author": {"login": "Jolyon-S"}, "path": "atlasdb-client/src/main/java/com/palantir/atlasdb/util/TaggedMetricsInvocationEventHandler.java", "diffHunk": "@@ -169,9 +170,16 @@ public void onFailure(@Nullable InvocationContext context, @Nonnull Throwable ca\n         }\n \n         String failuresMetricName = InstrumentationUtils.getFailuresMetricName(context, serviceName);\n-        taggedMetricRegistry.meter(MetricName.builder().safeName(failuresMetricName).build()).mark();\n-        taggedMetricRegistry.meter(MetricName.builder().safeName(\n-                MetricRegistry.name(failuresMetricName, cause.getClass().getName())).build())\n+        Map<String, String> tags = tagFunction.map(f -> f.apply(context)).orElse(ImmutableMap.of());", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "17fb6567af36c1f6839cc8693e76cdd266516f8d"}, "originalPosition": 15}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "18072d3b8870deec50b7dc2f0400a9f28f9ae611", "author": {"user": {"login": "felixdesouza", "name": "Felix de Souza"}}, "url": "https://github.com/palantir/atlasdb/commit/18072d3b8870deec50b7dc2f0400a9f28f9ae611", "committedDate": "2020-03-26T08:21:26Z", "message": "Error prone."}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3004, "cost": 1, "resetAt": "2021-11-01T16:19:10Z"}}}