{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0MzgxMzU0OTU1", "number": 4616, "reviewThreads": {"totalCount": 5, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wMlQxMzozODoxMVrODkRPqw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wMlQxNToxNjo1N1rODkTgtg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjM5MzU3ODY3OnYy", "diffSide": "RIGHT", "path": "lock-api-objects/src/main/java/com/palantir/lock/watch/CommitTimestampsWithWatches.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wMlQxMzozODoxMVrOFwfw2w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wMlQxMzozODoxMVrOFwfw2w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NjM5NjM3OQ==", "bodyText": "define this in conjure? seems like a fairly simple object no?", "url": "https://github.com/palantir/atlasdb/pull/4616#discussion_r386396379", "createdAt": "2020-03-02T13:38:11Z", "author": {"login": "felixdesouza"}, "path": "lock-api-objects/src/main/java/com/palantir/lock/watch/CommitTimestampsWithWatches.java", "diffHunk": "@@ -20,15 +20,16 @@\n \n import com.fasterxml.jackson.databind.annotation.JsonDeserialize;\n import com.fasterxml.jackson.databind.annotation.JsonSerialize;\n+import com.palantir.timestamp.TimestampRange;\n \n @Value.Immutable\n-@JsonSerialize(as = ImmutableTimestampWithWatches.class)\n-@JsonDeserialize(as = ImmutableTimestampWithWatches.class)\n-public interface TimestampWithWatches {\n-    long timestamp();\n+@JsonSerialize(as = ImmutableCommitTimestampsWithWatches.class)\n+@JsonDeserialize(as = ImmutableCommitTimestampsWithWatches.class)\n+public interface CommitTimestampsWithWatches {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "33f12e25e6d35a86ac93e72bc40775bb0a6298fb"}, "originalPosition": 13}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjM5MzU4MjMxOnYy", "diffSide": "RIGHT", "path": "timelock-api/src/main/conjure/timelock-api.yml", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wMlQxMzozOToxNlrOFwfzKA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wMlQxMzozOToxNlrOFwfzKA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NjM5Njk2OA==", "bodyText": "I believe you're going to need to rebase, @j-baker got a similar thing in with #4622", "url": "https://github.com/palantir/atlasdb/pull/4616#discussion_r386396968", "createdAt": "2020-03-02T13:39:16Z", "author": {"login": "felixdesouza"}, "path": "timelock-api/src/main/conjure/timelock-api.yml", "diffHunk": "@@ -20,6 +20,14 @@ types:\n       base-type: any\n       external:\n         java: com.palantir.lock.v2.Lease\n+    CommitTimestampsWithWatches:\n+      base-type: any\n+      external:\n+        java: com.palantir.lock.watch.CommitTimestampsWithWatches\n+    Long:", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "33f12e25e6d35a86ac93e72bc40775bb0a6298fb"}, "originalPosition": 8}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjM5MzU4NDQzOnYy", "diffSide": "RIGHT", "path": "timelock-api/src/main/conjure/timelock-api.yml", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wMlQxMzozOTo1MlrOFwf0Zw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wMlQxMzozOTo1MlrOFwf0Zw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NjM5NzI4Nw==", "bodyText": "as above, it's probably just easier to define this object here instead of external, unless you have strong reservations as to why not.", "url": "https://github.com/palantir/atlasdb/pull/4616#discussion_r386397287", "createdAt": "2020-03-02T13:39:52Z", "author": {"login": "felixdesouza"}, "path": "timelock-api/src/main/conjure/timelock-api.yml", "diffHunk": "@@ -20,6 +20,14 @@ types:\n       base-type: any\n       external:\n         java: com.palantir.lock.v2.Lease\n+    CommitTimestampsWithWatches:\n+      base-type: any\n+      external:\n+        java: com.palantir.lock.watch.CommitTimestampsWithWatches", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "33f12e25e6d35a86ac93e72bc40775bb0a6298fb"}, "originalPosition": 7}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjM5Mzk0Mjk4OnYy", "diffSide": "RIGHT", "path": "timelock-impl/src/main/java/com/palantir/atlasdb/timelock/AsyncTimelockServiceImpl.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wMlQxNToxNTozMFrOFwjN0g==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wMlQxNToxNTozMFrOFwjN0g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NjQ1Mjk0Ng==", "bodyText": "This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters. Learn more about bidirectional Unicode characters\n\n\n  \n\n\n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                    return GetCommitTimestampsResponse.of(freshTimestamps.getLowerBound(), freshTimestamps.getUpperBound(),\n          \n          \n            \n                            getWatchStateUpdate(lastKnownVersion));\n          \n          \n            \n                    return GetCommitTimestampsResponse.of(\n          \n          \n            \n                            freshTimestamps.getLowerBound(), \n          \n          \n            \n                            freshTimestamps.getUpperBound(),\n          \n          \n            \n                            getWatchStateUpdate(lastKnownVersion));", "url": "https://github.com/palantir/atlasdb/pull/4616#discussion_r386452946", "createdAt": "2020-03-02T15:15:30Z", "author": {"login": "felixdesouza"}, "path": "timelock-impl/src/main/java/com/palantir/atlasdb/timelock/AsyncTimelockServiceImpl.java", "diffHunk": "@@ -176,8 +176,10 @@ public StartTransactionResponseV5 startTransactionsWithWatches(StartTransactionR\n     }\n \n     @Override\n-    public TimestampWithWatches getCommitTimestampWithWatches(OptionalLong lastKnownVersion) {\n-        return TimestampWithWatches.of(getFreshTimestamp(), getWatchStateUpdate(lastKnownVersion));\n+    public GetCommitTimestampsResponse getCommitTimestamps(int numTimestamps, OptionalLong lastKnownVersion) {\n+        TimestampRange freshTimestamps = getFreshTimestamps(numTimestamps);\n+        return GetCommitTimestampsResponse.of(freshTimestamps.getLowerBound(), freshTimestamps.getUpperBound(),\n+                getWatchStateUpdate(lastKnownVersion));", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d50a616155bf0ad33358a257f1f15f801d7b6a52"}, "originalPosition": 25}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjM5Mzk0OTk4OnYy", "diffSide": "RIGHT", "path": "timelock-api/src/main/conjure/timelock-api.yml", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wMlQxNToxNjo1N1rOFwjSBg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wMlQxNTo1MDoyOFrOFwko1A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NjQ1NDAyMg==", "bodyText": "I think I missed this earlier, any reason to not use Conjure unions here? you should still get the visitors and everything that you want etc.", "url": "https://github.com/palantir/atlasdb/pull/4616#discussion_r386454022", "createdAt": "2020-03-02T15:16:57Z", "author": {"login": "felixdesouza"}, "path": "timelock-api/src/main/conjure/timelock-api.yml", "diffHunk": "@@ -20,8 +20,12 @@ types:\n       base-type: any\n       external:\n         java: com.palantir.lock.v2.Lease\n+    LockWatchStateUpdate:", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d50a616155bf0ad33358a257f1f15f801d7b6a52"}, "originalPosition": 4}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NjQ3NjI0NA==", "bodyText": "Discussed offline -- requires nontrivial refactoring since the update is used outside of timelock api", "url": "https://github.com/palantir/atlasdb/pull/4616#discussion_r386476244", "createdAt": "2020-03-02T15:50:28Z", "author": {"login": "gmaretic"}, "path": "timelock-api/src/main/conjure/timelock-api.yml", "diffHunk": "@@ -20,8 +20,12 @@ types:\n       base-type: any\n       external:\n         java: com.palantir.lock.v2.Lease\n+    LockWatchStateUpdate:", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NjQ1NDAyMg=="}, "originalCommit": {"oid": "d50a616155bf0ad33358a257f1f15f801d7b6a52"}, "originalPosition": 4}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2354, "cost": 1, "resetAt": "2021-11-12T12:57:47Z"}}}