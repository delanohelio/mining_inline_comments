{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDA2OTA5ODEw", "number": 4726, "reviewThreads": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yMVQyMjowMTo0OVrOD0dQvA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yMVQyMjowMzo1OVrOD0dTmA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjU2MzMxOTY0OnYy", "diffSide": "RIGHT", "path": "leader-election-impl/src/main/java/com/palantir/paxos/SqlitePaxosStateLog.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yMVQyMjowMTo0OVrOGJaWjQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yMVQyMjowMTo0OVrOGJaWjQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMjUyMjEyNQ==", "bodyText": "Table per namespace, interesting.", "url": "https://github.com/palantir/atlasdb/pull/4726#discussion_r412522125", "createdAt": "2020-04-21T22:01:49Z", "author": {"login": "jkozlowski"}, "path": "leader-election-impl/src/main/java/com/palantir/paxos/SqlitePaxosStateLog.java", "diffHunk": "@@ -30,26 +30,34 @@\n \n public final class SqlitePaxosStateLog<V extends Persistable & Versionable> implements PaxosStateLog<V> {\n     private final Supplier<Connection> connectionSupplier;\n+    private final String logNamespace;\n \n-    private SqlitePaxosStateLog(Supplier<Connection> connectionSupplier) {\n+    private SqlitePaxosStateLog(Supplier<Connection> connectionSupplier, String logNamespace) {\n         this.connectionSupplier = connectionSupplier;\n+        this.logNamespace = logNamespace;\n     }\n \n-    public static <V extends Persistable & Versionable> PaxosStateLog<V> createInitialized(Supplier<Connection> conn) {\n-        SqlitePaxosStateLog<V> log = new SqlitePaxosStateLog<>(conn);\n+    public static <V extends Persistable & Versionable> PaxosStateLog<V> createInitialized(\n+            Supplier<Connection> conn,\n+            String logNamespace) {\n+        SqlitePaxosStateLog<V> log = new SqlitePaxosStateLog<>(conn, logNamespace);\n         log.initialize();\n         return log;\n     }\n \n     private void initialize() {\n-        executeVoid(\"CREATE TABLE IF NOT EXISTS paxosLog (seq BIGINT, val BLOB, CONSTRAINT pk_dual PRIMARY KEY (seq))\");\n+        executeVoid(\n+                String.format(\n+                        \"CREATE TABLE IF NOT EXISTS %s (seq BIGINT, val BLOB, CONSTRAINT pk_%s PRIMARY KEY (seq))\",", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f6653971fd81dff19214223b2cff390bfc893263"}, "originalPosition": 26}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjU2MzMyMTI4OnYy", "diffSide": "RIGHT", "path": "leader-election-impl/src/main/java/com/palantir/paxos/SqlitePaxosStateLog.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yMVQyMjowMjoyNlrOGJaXoQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yMVQyMjowMjoyNlrOGJaXoQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMjUyMjQwMQ==", "bodyText": "Can you create as many sqlite instances as you want if it's backed by the filesystem? Does it maintain some on-disk locks or something?", "url": "https://github.com/palantir/atlasdb/pull/4726#discussion_r412522401", "createdAt": "2020-04-21T22:02:26Z", "author": {"login": "jkozlowski"}, "path": "leader-election-impl/src/main/java/com/palantir/paxos/SqlitePaxosStateLog.java", "diffHunk": "@@ -30,26 +30,34 @@\n \n public final class SqlitePaxosStateLog<V extends Persistable & Versionable> implements PaxosStateLog<V> {\n     private final Supplier<Connection> connectionSupplier;\n+    private final String logNamespace;\n \n-    private SqlitePaxosStateLog(Supplier<Connection> connectionSupplier) {\n+    private SqlitePaxosStateLog(Supplier<Connection> connectionSupplier, String logNamespace) {\n         this.connectionSupplier = connectionSupplier;\n+        this.logNamespace = logNamespace;\n     }\n \n-    public static <V extends Persistable & Versionable> PaxosStateLog<V> createInitialized(Supplier<Connection> conn) {\n-        SqlitePaxosStateLog<V> log = new SqlitePaxosStateLog<>(conn);\n+    public static <V extends Persistable & Versionable> PaxosStateLog<V> createInitialized(\n+            Supplier<Connection> conn,", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f6653971fd81dff19214223b2cff390bfc893263"}, "originalPosition": 15}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjU2MzMyNjk2OnYy", "diffSide": "RIGHT", "path": "leader-election-impl/src/main/java/com/palantir/paxos/SqlitePaxosStateLog.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yMVQyMjowMzo1OVrOGJaasQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yMVQyMjowMzo1OVrOGJaasQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMjUyMzE4NQ==", "bodyText": "Do we need to enforce something about the logNamespace, I don't suspect sqlite likes any odd table names?", "url": "https://github.com/palantir/atlasdb/pull/4726#discussion_r412523185", "createdAt": "2020-04-21T22:03:59Z", "author": {"login": "jkozlowski"}, "path": "leader-election-impl/src/main/java/com/palantir/paxos/SqlitePaxosStateLog.java", "diffHunk": "@@ -30,26 +30,34 @@\n \n public final class SqlitePaxosStateLog<V extends Persistable & Versionable> implements PaxosStateLog<V> {\n     private final Supplier<Connection> connectionSupplier;\n+    private final String logNamespace;\n \n-    private SqlitePaxosStateLog(Supplier<Connection> connectionSupplier) {\n+    private SqlitePaxosStateLog(Supplier<Connection> connectionSupplier, String logNamespace) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f6653971fd81dff19214223b2cff390bfc893263"}, "originalPosition": 7}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3077, "cost": 1, "resetAt": "2021-11-12T12:57:47Z"}}}