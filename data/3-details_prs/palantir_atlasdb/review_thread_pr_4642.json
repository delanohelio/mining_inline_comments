{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0Mzg2MDQ4MjAz", "number": 4642, "reviewThreads": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xMFQxNToxMjowN1rODmuWUg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xMFQxNTo1NToxNlrODmvmZA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjQxOTMxODU4OnYy", "diffSide": "RIGHT", "path": "atlasdb-client/src/main/java/com/palantir/atlasdb/transaction/impl/ReadTransaction.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xMFQxNToxMjowN1rOF0TcDg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xMFQxNzoyNjowNFrOF0ZUOQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MDM4ODc1MA==", "bodyText": "Could we change the message to something like - \"Can only read from a table with a no/conservative sweep strategy in a read only transaction.\" ?", "url": "https://github.com/palantir/atlasdb/pull/4642#discussion_r390388750", "createdAt": "2020-03-10T15:12:07Z", "author": {"login": "sudiksha27"}, "path": "atlasdb-client/src/main/java/com/palantir/atlasdb/transaction/impl/ReadTransaction.java", "diffHunk": "@@ -127,7 +126,7 @@ public Transaction delegate() {\n \n     private void checkTableName(TableReference tableRef) {\n         SweepStrategy sweepStrategy = sweepStrategies.get(tableRef);\n-        if (sweepStrategy == SweepStrategy.THOROUGH) {\n+        if (sweepStrategy.mustCheckImmutableLockAfterReads()) {\n             throw new SafeIllegalStateException(\n                     \"Cannot read from a table with a thorough sweep strategy in a read only transaction.\");\n         }", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "27d636fb2967ef7bab814e3a2b833d9af15fa711"}, "originalPosition": 24}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MDQ4NTA0OQ==", "bodyText": "done", "url": "https://github.com/palantir/atlasdb/pull/4642#discussion_r390485049", "createdAt": "2020-03-10T17:26:04Z", "author": {"login": "j-baker"}, "path": "atlasdb-client/src/main/java/com/palantir/atlasdb/transaction/impl/ReadTransaction.java", "diffHunk": "@@ -127,7 +126,7 @@ public Transaction delegate() {\n \n     private void checkTableName(TableReference tableRef) {\n         SweepStrategy sweepStrategy = sweepStrategies.get(tableRef);\n-        if (sweepStrategy == SweepStrategy.THOROUGH) {\n+        if (sweepStrategy.mustCheckImmutableLockAfterReads()) {\n             throw new SafeIllegalStateException(\n                     \"Cannot read from a table with a thorough sweep strategy in a read only transaction.\");\n         }", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MDM4ODc1MA=="}, "originalCommit": {"oid": "27d636fb2967ef7bab814e3a2b833d9af15fa711"}, "originalPosition": 24}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjQxOTUyMzU2OnYy", "diffSide": "RIGHT", "path": "changelog/@unreleased/pr-4642.v2.yml", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xMFQxNTo1NToxNlrOF0VcHA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xMFQxNzoyMDoxNVrOF0ZFCw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MDQyMTUzMg==", "bodyText": "I guess this is fine, would add a bit of caution saying please talk to the AtlasDB team before you do this (if someone forgets that you must e.g. declare an internal schema version in internal framework, then they open themselves to corruption).", "url": "https://github.com/palantir/atlasdb/pull/4642#discussion_r390421532", "createdAt": "2020-03-10T15:55:16Z", "author": {"login": "jeremyk-91"}, "path": "changelog/@unreleased/pr-4642.v2.yml", "diffHunk": "@@ -0,0 +1,5 @@\n+type: improvement\n+improvement:\n+  description: Allow easy migration from/to thorough sweep", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "27d636fb2967ef7bab814e3a2b833d9af15fa711"}, "originalPosition": 3}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MDQ4MTE2Mw==", "bodyText": "done", "url": "https://github.com/palantir/atlasdb/pull/4642#discussion_r390481163", "createdAt": "2020-03-10T17:20:15Z", "author": {"login": "j-baker"}, "path": "changelog/@unreleased/pr-4642.v2.yml", "diffHunk": "@@ -0,0 +1,5 @@\n+type: improvement\n+improvement:\n+  description: Allow easy migration from/to thorough sweep", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MDQyMTUzMg=="}, "originalCommit": {"oid": "27d636fb2967ef7bab814e3a2b833d9af15fa711"}, "originalPosition": 3}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3119, "cost": 1, "resetAt": "2021-11-12T12:57:47Z"}}}