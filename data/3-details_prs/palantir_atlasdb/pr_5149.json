{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTM0Mzc3NjM3", "number": 5149, "title": "Make EC2 Location supplier memoize on failures", "bodyText": "Goals (and why):\nThis stops the constant warn logging from the HostLocationSupplier in environments where services don't get to access the Instance metadata endpoint by default (example, when running on a locked down K8s cluster).\nImplementation Description (bullets):\nWe will now log an warning once if we fail to get location info from the metadata service and then assume we don't have any location info for the lifetime of the process.\nTesting (What was existing testing like?  What have you done to improve it?):\nConcerns (what feedback would you like?):\nWhere should we start reviewing?:\nPriority (whenever / two weeks / yesterday):", "createdAt": "2020-12-08T11:14:20Z", "url": "https://github.com/palantir/atlasdb/pull/5149", "merged": true, "mergeCommit": {"oid": "e351fd79f165e51528b12eb44afa5b4ee9b462d8"}, "closed": true, "closedAt": "2020-12-09T10:06:13Z", "author": {"login": "ashrayjain"}, "timelineItems": {"totalCount": 6, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdkINUlAH2gAyNTM0Mzc3NjM3OjlkODkxNmRkMGQ1YjNkZDY2ZGY2ZjUzNTM2YmFkZWZjZmZjNmM5M2I=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdkb3HmgFqTU0ODAyMzAyMw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "9d8916dd0d5b3dd66df6f53536badefcffc6c93b", "author": {"user": {"login": "ashrayjain", "name": "Ashray Jain"}}, "url": "https://github.com/palantir/atlasdb/commit/9d8916dd0d5b3dd66df6f53536badefcffc6c93b", "committedDate": "2020-12-08T11:12:18Z", "message": "Make EC2 Location supplier memoize on failures"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e969a0cfb38ae3be13e33bda7d2a56100fd16235", "author": {"user": {"login": "ashrayjain", "name": "Ashray Jain"}}, "url": "https://github.com/palantir/atlasdb/commit/e969a0cfb38ae3be13e33bda7d2a56100fd16235", "committedDate": "2020-12-08T11:12:18Z", "message": "Add generated changelog entries"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTQ3MTM1NjM2", "url": "https://github.com/palantir/atlasdb/pull/5149#pullrequestreview-547135636", "createdAt": "2020-12-08T11:25:11Z", "commit": {"oid": "e969a0cfb38ae3be13e33bda7d2a56100fd16235"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0wOFQxMToyNToxMVrOIBUuVA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0wOFQxMToyNToxMVrOIBUuVA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzODI1OTAyOA==", "bodyText": "Does this work?\n\n  \n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                    assertThat(hostLocationSupplier.get())\n          \n          \n            \n                            .hasValue(ec2LocationSupplier.get().get());\n          \n          \n            \n                    assertThat(hostLocationSupplier.get())\n          \n          \n            \n                            .isEqualTo(ec2LocationSupplier.get());", "url": "https://github.com/palantir/atlasdb/pull/5149#discussion_r538259028", "createdAt": "2020-12-08T11:25:11Z", "author": {"login": "Jolyon-S"}, "path": "atlasdb-cassandra/src/test/java/com/palantir/atlasdb/keyvalue/cassandra/pool/HostLocationSupplierTest.java", "diffHunk": "@@ -42,7 +43,8 @@ public void shouldReturnEc2Location() {\n         Supplier<Optional<HostLocation>> hostLocationSupplier =\n                 new HostLocationSupplier(ec2SnitchSupplier, ec2LocationSupplier, Optional.empty());\n \n-        assertThat(hostLocationSupplier.get()).hasValue(ec2LocationSupplier.get());\n+        assertThat(hostLocationSupplier.get())\n+                .hasValue(ec2LocationSupplier.get().get());", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "e969a0cfb38ae3be13e33bda7d2a56100fd16235"}, "originalPosition": 16}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e8fc449278ccc2a915193c808fc723fd70aa207f", "author": {"user": {"login": "ashrayjain", "name": "Ashray Jain"}}, "url": "https://github.com/palantir/atlasdb/commit/e8fc449278ccc2a915193c808fc723fd70aa207f", "committedDate": "2020-12-08T11:29:38Z", "message": "Update atlasdb-cassandra/src/test/java/com/palantir/atlasdb/keyvalue/cassandra/pool/HostLocationSupplierTest.java\n\nCo-authored-by: Jolyon <jshah@palantir.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "9c9b21c10687ced39eda116be581f123e1fed2ce", "author": {"user": {"login": "ashrayjain", "name": "Ashray Jain"}}, "url": "https://github.com/palantir/atlasdb/commit/9c9b21c10687ced39eda116be581f123e1fed2ce", "committedDate": "2020-12-08T11:37:48Z", "message": "Update HostLocationSupplierTest.java"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTQ4MDIzMDIz", "url": "https://github.com/palantir/atlasdb/pull/5149#pullrequestreview-548023023", "createdAt": "2020-12-09T10:06:09Z", "commit": {"oid": "9c9b21c10687ced39eda116be581f123e1fed2ce"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2541, "cost": 1, "resetAt": "2021-11-01T16:19:10Z"}}}