{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTA4NDMxNDg2", "number": 5076, "title": "[TS] Tune sweepdelay metrics", "bodyText": "Goals (and why):\nCurrently the metric reflects the actual delay of each sweep iteration. The problem with this is that if sweep is set up with more threads * nodes than shards, or we run into errors, this introduces noise into the metric. It was interesting to have this to see that it works, but given that these cases can be detected with the sweep outcomes, there is no need to pollute sweep delay.\nImplementation Description (bullets):\nSweep delay now reports the on success delay only\nTesting (What was existing testing like?  What have you done to improve it?):\nFixed unit tests\nConcerns (what feedback would you like?):\nNone\nWhere should we start reviewing?:\nTiny\nPriority (whenever / two weeks / yesterday):\nNot high, but small", "createdAt": "2020-10-22T16:57:07Z", "url": "https://github.com/palantir/atlasdb/pull/5076", "merged": true, "mergeCommit": {"oid": "3478bf9c048b4f5433f8d7385dc22164cf032ec5"}, "closed": true, "closedAt": "2020-10-22T21:30:08Z", "author": {"login": "gmaretic"}, "timelineItems": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdVEzRWAH2gAyNTA4NDMxNDg2OmJiOWYxNjYzZGFhZWI3OTg2MzhjNTkxZjRkYTlhMjA2ODlkZDIwYTg=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdVI388AFqTUxNTEzMzczOQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "bb9f1663daaeb798638c591f4da9a20689dd20a8", "author": {"user": {"login": "gmaretic", "name": null}}, "url": "https://github.com/palantir/atlasdb/commit/bb9f1663daaeb798638c591f4da9a20689dd20a8", "committedDate": "2020-10-22T16:45:16Z", "message": "Update sweepdelay metrics only with successful runs"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTE1MTMzNzM5", "url": "https://github.com/palantir/atlasdb/pull/5076#pullrequestreview-515133739", "createdAt": "2020-10-22T21:29:44Z", "commit": {"oid": "bb9f1663daaeb798638c591f4da9a20689dd20a8"}, "state": "APPROVED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yMlQyMToyOTo0NFrOHm0jmg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yMlQyMToyOTo0NFrOHm0jmg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMDQ2OTAxOA==", "bodyText": "Do we have tests for the case where sweepDelayMetricsUpdater is updated to not INITIAL_DELAY?", "url": "https://github.com/palantir/atlasdb/pull/5076#discussion_r510469018", "createdAt": "2020-10-22T21:29:44Z", "author": {"login": "sudiksha27"}, "path": "atlasdb-impl-shared/src/test/java/com/palantir/atlasdb/sweep/queue/SweepDelayTest.java", "diffHunk": "@@ -60,28 +60,32 @@ public void configurationAboveDefaultMaximumIsRespected() {\n \n     @Test\n     public void unableToAcquireShardReturnsMaxPause() {\n+        delay.getNextPause(SUCCESS);\n         assertThat(delay.getNextPause(SweepIterationResults.unableToAcquireShard()))\n                 .isEqualTo(DEFAULT_MAX_PAUSE_MILLIS);\n-        assertThat(metrics).hasValue(DEFAULT_MAX_PAUSE_MILLIS);\n+        assertThat(metrics).hasValue(INITIAL_DELAY);\n     }", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "bb9f1663daaeb798638c591f4da9a20689dd20a8"}, "originalPosition": 9}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2421, "cost": 1, "resetAt": "2021-11-01T16:19:10Z"}}}