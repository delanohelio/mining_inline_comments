{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTI0MTYyOTY2", "number": 5122, "reviewThreads": {"totalCount": 5, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0yMFQxMTozNjo1MVrOE7gVPw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0yM1QxNjoxNDoxNFrOE8SlMw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzMwODMxMTY3OnYy", "diffSide": "RIGHT", "path": "lock-api/src/main/java/com/palantir/lock/client/DialogueAdaptingMultiClientConjureTimelockService.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0yMFQxMTozNjo1MVrOH3MMZw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0yMFQxMTozNjo1MVrOH3MMZw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNzYzMzUxMQ==", "bodyText": "This should implement MultiClientConjureTimelockService?", "url": "https://github.com/palantir/atlasdb/pull/5122#discussion_r527633511", "createdAt": "2020-11-20T11:36:51Z", "author": {"login": "jeremyk-91"}, "path": "lock-api/src/main/java/com/palantir/lock/client/DialogueAdaptingMultiClientConjureTimelockService.java", "diffHunk": "@@ -0,0 +1,38 @@\n+/*\n+ * (c) Copyright 2020 Palantir Technologies Inc. All rights reserved.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package com.palantir.lock.client;\n+\n+import com.palantir.atlasdb.timelock.api.LeaderTimes;\n+import com.palantir.atlasdb.timelock.api.MultiClientConjureTimelockServiceBlocking;\n+import com.palantir.atlasdb.timelock.api.Namespace;\n+import com.palantir.tokens.auth.AuthHeader;\n+import java.util.Set;\n+\n+public class DialogueAdaptingMultiClientConjureTimelockService {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "0bb112997f793060dfa8c4ab7b49cbe1637977ce"}, "originalPosition": 25}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzMwODMxMjIxOnYy", "diffSide": "RIGHT", "path": "atlasdb-config/src/main/java/com/palantir/atlasdb/factory/AtlasDbDialogueServiceProvider.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0yMFQxMTozNzowM1rOH3MMvQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0yMFQxMTozNzowM1rOH3MMvQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNzYzMzU5Nw==", "bodyText": "This shouldn't depend on the concrete type", "url": "https://github.com/palantir/atlasdb/pull/5122#discussion_r527633597", "createdAt": "2020-11-20T11:37:03Z", "author": {"login": "jeremyk-91"}, "path": "atlasdb-config/src/main/java/com/palantir/atlasdb/factory/AtlasDbDialogueServiceProvider.java", "diffHunk": "@@ -113,6 +115,17 @@ ConjureTimelockService getConjureTimelockService() {\n         return new TimeoutSensitiveConjureTimelockService(shortAndLongTimeoutServices);\n     }\n \n+    DialogueAdaptingMultiClientConjureTimelockService getMultiClientConjureTimelockService() {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "0bb112997f793060dfa8c4ab7b49cbe1637977ce"}, "originalPosition": 20}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzMxNTgwNjAwOnYy", "diffSide": "RIGHT", "path": "lock-api/src/main/java/com/palantir/lock/client/LeaderTimeCoalescingBatcher.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0yM1QxMzozNzozN1rOH4Nx7A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0yM1QxMzozNzozN1rOH4Nx7A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyODcwODA3Ng==", "bodyText": "IntelliJ says this can be package-private, so please do so.", "url": "https://github.com/palantir/atlasdb/pull/5122#discussion_r528708076", "createdAt": "2020-11-23T13:37:37Z", "author": {"login": "Jolyon-S"}, "path": "lock-api/src/main/java/com/palantir/lock/client/LeaderTimeCoalescingBatcher.java", "diffHunk": "@@ -49,15 +47,15 @@ public void close() {\n     }\n \n     static class LeaderTimeCoalescingConsumer implements CoalescingRequestFunction<Namespace, LeaderTime> {\n-        private final MultiClientConjureTimelockService delegate;\n+        private final AuthenticatingMultiClientConjureTimelockService delegate;\n \n-        public LeaderTimeCoalescingConsumer(MultiClientConjureTimelockService delegate) {\n+        public LeaderTimeCoalescingConsumer(AuthenticatingMultiClientConjureTimelockService delegate) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "2a515e50ca64dc01d8ea5a2bca8f6bb76545aa25"}, "originalPosition": 30}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzMxNTgxNDYzOnYy", "diffSide": "RIGHT", "path": "lock-api/src/main/java/com/palantir/lock/client/AuthenticatingMultiClientConjureTimelockService.java", "isResolved": false, "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0yM1QxMzozOTo1NVrOH4N3UQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0yM1QxNjowOTowM1rOH4UqKA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyODcwOTQ1Nw==", "bodyText": "I think I understand why we need the impl, but not the interface - I feel like this is a very specific interface (where I'd rather there is a more generic interface and AMCCTS is one of the implementations). Regardless, this is also possibly a misleading name: this always passes a token that is \"Bearer omitted\", which while technically is on the theme of authentication, feels a bit odd to call this an authenticating service.", "url": "https://github.com/palantir/atlasdb/pull/5122#discussion_r528709457", "createdAt": "2020-11-23T13:39:55Z", "author": {"login": "Jolyon-S"}, "path": "lock-api/src/main/java/com/palantir/lock/client/AuthenticatingMultiClientConjureTimelockService.java", "diffHunk": "@@ -0,0 +1,25 @@\n+/*\n+ * (c) Copyright 2020 Palantir Technologies Inc. All rights reserved.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package com.palantir.lock.client;\n+\n+import com.palantir.atlasdb.timelock.api.LeaderTimes;\n+import com.palantir.atlasdb.timelock.api.Namespace;\n+import java.util.Set;\n+\n+public interface AuthenticatingMultiClientConjureTimelockService {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "2a515e50ca64dc01d8ea5a2bca8f6bb76545aa25"}, "originalPosition": 23}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyODc3Mjg2OQ==", "bodyText": "I wouldn't name this in this way: users elsewhere in the AtlasDB client code shouldn't need to know that authentication (or the lack thereof!) is a thing that's happening beyond this layer, which is an implementation detail. Conceptually this interface should be something like InternalMultiClientConjureTimelockService (possibly not a great name) and then your AuthMCCTSImpl should be AuthIMCCTS (or even UnauthedIMCCTS).", "url": "https://github.com/palantir/atlasdb/pull/5122#discussion_r528772869", "createdAt": "2020-11-23T15:10:35Z", "author": {"login": "jeremyk-91"}, "path": "lock-api/src/main/java/com/palantir/lock/client/AuthenticatingMultiClientConjureTimelockService.java", "diffHunk": "@@ -0,0 +1,25 @@\n+/*\n+ * (c) Copyright 2020 Palantir Technologies Inc. All rights reserved.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package com.palantir.lock.client;\n+\n+import com.palantir.atlasdb.timelock.api.LeaderTimes;\n+import com.palantir.atlasdb.timelock.api.Namespace;\n+import java.util.Set;\n+\n+public interface AuthenticatingMultiClientConjureTimelockService {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyODcwOTQ1Nw=="}, "originalCommit": {"oid": "2a515e50ca64dc01d8ea5a2bca8f6bb76545aa25"}, "originalPosition": 23}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyODgyMDc3Ng==", "bodyText": "I hit a mental block in trying to come up with a name for this interface, InternalMultiClientConjureTimelockService is reasonable.", "url": "https://github.com/palantir/atlasdb/pull/5122#discussion_r528820776", "createdAt": "2020-11-23T16:09:03Z", "author": {"login": "sudiksha27"}, "path": "lock-api/src/main/java/com/palantir/lock/client/AuthenticatingMultiClientConjureTimelockService.java", "diffHunk": "@@ -0,0 +1,25 @@\n+/*\n+ * (c) Copyright 2020 Palantir Technologies Inc. All rights reserved.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package com.palantir.lock.client;\n+\n+import com.palantir.atlasdb.timelock.api.LeaderTimes;\n+import com.palantir.atlasdb.timelock.api.Namespace;\n+import java.util.Set;\n+\n+public interface AuthenticatingMultiClientConjureTimelockService {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyODcwOTQ1Nw=="}, "originalCommit": {"oid": "2a515e50ca64dc01d8ea5a2bca8f6bb76545aa25"}, "originalPosition": 23}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzMxNjU0NDUxOnYy", "diffSide": "RIGHT", "path": "lock-api/src/main/java/com/palantir/lock/client/AuthInternalMultiClientConjureTimelockService.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0yM1QxNjoxNDoxNFrOH4U4nQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0yM1QxNjoxNDoxNFrOH4U4nQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyODgyNDQ3Nw==", "bodyText": "nit: sorry for confusion, AuthIMCCTS was just used as a short-hand, I'd prefer we use either Authenticated or Unauthenticated in full rather than Auth, which doesn't say much", "url": "https://github.com/palantir/atlasdb/pull/5122#discussion_r528824477", "createdAt": "2020-11-23T16:14:14Z", "author": {"login": "jeremyk-91"}, "path": "lock-api/src/main/java/com/palantir/lock/client/AuthInternalMultiClientConjureTimelockService.java", "diffHunk": "@@ -0,0 +1,38 @@\n+/*\n+ * (c) Copyright 2020 Palantir Technologies Inc. All rights reserved.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package com.palantir.lock.client;\n+\n+import com.palantir.atlasdb.timelock.api.LeaderTimes;\n+import com.palantir.atlasdb.timelock.api.MultiClientConjureTimelockServiceBlocking;\n+import com.palantir.atlasdb.timelock.api.Namespace;\n+import com.palantir.tokens.auth.AuthHeader;\n+import java.util.Set;\n+\n+public class AuthInternalMultiClientConjureTimelockService implements InternalMultiClientConjureTimelockService {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "4be23f250658d6b42b2374e009db1f235d96e6a3"}, "originalPosition": 25}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2504, "cost": 1, "resetAt": "2021-11-12T12:57:47Z"}}}