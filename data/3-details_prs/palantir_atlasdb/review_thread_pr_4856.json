{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDM4NDE3NzY1", "number": 4856, "reviewThreads": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yM1QwOTo0MTo0NVrOEH5Mzw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yM1QxOToyNjo0MVrOEIGrzg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjc2NzEyNjU1OnYy", "diffSide": "RIGHT", "path": "atlasdb-client/src/main/java/com/palantir/atlasdb/keyvalue/impl/Cells.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yM1QwOTo0MTo0NVrOGnhiJg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yM1QxMToxMDoxMFrOGnkZyQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NDA5NzA2Mg==", "bodyText": "This one is potentially dev-breaky (generics are invariant), though a quick look internally suggests that it has a few users outside AtlasDB, the last of which was updated in mid-2019 so I think it's fine. I'd suggest calling this one out in changelog to be certain.", "url": "https://github.com/palantir/atlasdb/pull/4856#discussion_r444097062", "createdAt": "2020-06-23T09:41:45Z", "author": {"login": "jeremyk-91"}, "path": "atlasdb-client/src/main/java/com/palantir/atlasdb/keyvalue/impl/Cells.java", "diffHunk": "@@ -111,7 +112,7 @@ public static Cell createLargestCellForRow(byte[] rowName) {\n         return ret;\n     }\n \n-    public static <T> NavigableMap<byte[], SortedMap<byte[], T>> breakCellsUpByRow(Map<Cell, T> map) {\n+    public static <T> NavigableMap<byte[], NavigableMap<byte[], T>> breakCellsUpByRow(Map<Cell, T> map) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "dc723b5b4c98bb27ed0e3098ba757254fbfb02c7"}, "originalPosition": 17}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NDE0NDA3Mw==", "bodyText": "Added to the changelog.", "url": "https://github.com/palantir/atlasdb/pull/4856#discussion_r444144073", "createdAt": "2020-06-23T11:10:10Z", "author": {"login": "jkozlowski"}, "path": "atlasdb-client/src/main/java/com/palantir/atlasdb/keyvalue/impl/Cells.java", "diffHunk": "@@ -111,7 +112,7 @@ public static Cell createLargestCellForRow(byte[] rowName) {\n         return ret;\n     }\n \n-    public static <T> NavigableMap<byte[], SortedMap<byte[], T>> breakCellsUpByRow(Map<Cell, T> map) {\n+    public static <T> NavigableMap<byte[], NavigableMap<byte[], T>> breakCellsUpByRow(Map<Cell, T> map) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NDA5NzA2Mg=="}, "originalCommit": {"oid": "dc723b5b4c98bb27ed0e3098ba757254fbfb02c7"}, "originalPosition": 17}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjc2NzE0MDMyOnYy", "diffSide": "RIGHT", "path": "atlasdb-cassandra/src/main/java/com/palantir/atlasdb/keyvalue/cassandra/ResultsExtractor.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yM1QwOTo0NTozNVrOGnhq2A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yM1QxMToxMDoyMVrOGnkaGQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NDA5OTI4OA==", "bodyText": "This one doesn't seem to have external users, so should be fine", "url": "https://github.com/palantir/atlasdb/pull/4856#discussion_r444099288", "createdAt": "2020-06-23T09:45:35Z", "author": {"login": "jeremyk-91"}, "path": "atlasdb-cassandra/src/main/java/com/palantir/atlasdb/keyvalue/cassandra/ResultsExtractor.java", "diffHunk": "@@ -78,15 +78,15 @@ public ResultsExtractor(MetricsManager metricsManager) {\n             ColumnSelection selection,\n             byte[] endExclusive) {\n         byte[] lastRow = extractResults(colsByKey, startTs, selection);\n-        SortedMap<byte[], SortedMap<byte[], T>> resultsByRow = Cells.breakCellsUpByRow(asMap());\n+        NavigableMap<byte[], NavigableMap<byte[], T>> resultsByRow = Cells.breakCellsUpByRow(asMap());\n         return getRowResults(endExclusive, lastRow, resultsByRow);\n     }\n \n     public static <T> TokenBackedBasicResultsPage<RowResult<T>, byte[]> getRowResults(\n             byte[] endExclusive,\n             byte[] lastRow,\n-            SortedMap<byte[], SortedMap<byte[], T>> resultsByRow) {\n-        SortedMap<byte[], RowResult<T>> ret = RowResults.viewOfSortedMap(resultsByRow);\n+            NavigableMap<byte[], NavigableMap<byte[], T>> resultsByRow) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "4b01ece5d4646dc80d368210b2e480b339dd4d17"}, "originalPosition": 23}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NDE0NDE1Mw==", "bodyText": "Still added to changelog.", "url": "https://github.com/palantir/atlasdb/pull/4856#discussion_r444144153", "createdAt": "2020-06-23T11:10:21Z", "author": {"login": "jkozlowski"}, "path": "atlasdb-cassandra/src/main/java/com/palantir/atlasdb/keyvalue/cassandra/ResultsExtractor.java", "diffHunk": "@@ -78,15 +78,15 @@ public ResultsExtractor(MetricsManager metricsManager) {\n             ColumnSelection selection,\n             byte[] endExclusive) {\n         byte[] lastRow = extractResults(colsByKey, startTs, selection);\n-        SortedMap<byte[], SortedMap<byte[], T>> resultsByRow = Cells.breakCellsUpByRow(asMap());\n+        NavigableMap<byte[], NavigableMap<byte[], T>> resultsByRow = Cells.breakCellsUpByRow(asMap());\n         return getRowResults(endExclusive, lastRow, resultsByRow);\n     }\n \n     public static <T> TokenBackedBasicResultsPage<RowResult<T>, byte[]> getRowResults(\n             byte[] endExclusive,\n             byte[] lastRow,\n-            SortedMap<byte[], SortedMap<byte[], T>> resultsByRow) {\n-        SortedMap<byte[], RowResult<T>> ret = RowResults.viewOfSortedMap(resultsByRow);\n+            NavigableMap<byte[], NavigableMap<byte[], T>> resultsByRow) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NDA5OTI4OA=="}, "originalCommit": {"oid": "4b01ece5d4646dc80d368210b2e480b339dd4d17"}, "originalPosition": 23}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjc2OTMzNTgyOnYy", "diffSide": "RIGHT", "path": "atlasdb-api/src/main/java/com/palantir/atlasdb/transaction/api/Transaction.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yM1QxOToyNjo0MVrOGn3cSg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xNlQxNDowNzoxMVrOIHG9xw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NDQ1NjAxMA==", "bodyText": "isn't this a binary backcompat break?", "url": "https://github.com/palantir/atlasdb/pull/4856#discussion_r444456010", "createdAt": "2020-06-23T19:26:41Z", "author": {"login": "j-baker"}, "path": "atlasdb-api/src/main/java/com/palantir/atlasdb/transaction/api/Transaction.java", "diffHunk": "@@ -65,7 +65,7 @@\n      * @return a mapping of rows to the columns matching the provided column selection\n      */\n     @Idempotent\n-    SortedMap<byte[], RowResult<byte[]>> getRows(\n+    NavigableMap<byte[], RowResult<byte[]>> getRows(", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d7195d2055762e7628dc8eabb379037771c86f4e"}, "originalPosition": 27}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NDMyNTA2Mw==", "bodyText": "Yes, just hit this. It seems that anyone relying on internal libraries (like atlas-event-queue) will need to upgrade as they get errors like this:\njava.lang.NoSuchMethodError: 'java.util.SortedMap com.palantir.atlasdb.transaction.api.Transaction.getRows(com.palantir.atlasdb.keyvalue.api.TableReference, java.lang.Iterable, com.palantir.atlasdb.keyvalue.api.ColumnSelection)'\n\tat com.palantir.atlas.sequential.schema.generated.OffsetsTable.getRows(OffsetsTable.java:613)\n\tat com.palantir.atlas.sequential.store.OffsetsStore.getOffsets(OffsetsStore.java:79)\n\tat com.palantir.atlas.sequential.store.OffsetsStore.getLatestOffsets(OffsetsStore.java:40)\n\tat com.palantir.atlas.sequential.OrderedTableReader.getLatestOffsets(OrderedTableReader.java:95)\n\tat com.palantir.atlas.sequential.ObjectMappingReader.getLatestOffsets(ObjectMappingReader.java:46)\n\tat com.palantir.atlas.sequential.api.SequentialTableReader.getLatestOffset(SequentialTableReader.java:81)\n\tat com.palantir.atlas.eventdriven.AtlasEventReader.lambda$getLatestOffset$1(AtlasEventReader.java:34)", "url": "https://github.com/palantir/atlasdb/pull/4856#discussion_r544325063", "createdAt": "2020-12-16T14:07:11Z", "author": {"login": "iamdanfox"}, "path": "atlasdb-api/src/main/java/com/palantir/atlasdb/transaction/api/Transaction.java", "diffHunk": "@@ -65,7 +65,7 @@\n      * @return a mapping of rows to the columns matching the provided column selection\n      */\n     @Idempotent\n-    SortedMap<byte[], RowResult<byte[]>> getRows(\n+    NavigableMap<byte[], RowResult<byte[]>> getRows(", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NDQ1NjAxMA=="}, "originalCommit": {"oid": "d7195d2055762e7628dc8eabb379037771c86f4e"}, "originalPosition": 27}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2676, "cost": 1, "resetAt": "2021-11-12T12:57:47Z"}}}