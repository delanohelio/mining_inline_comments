{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDA4NDU0NjY1", "number": 4732, "title": "[PDS-117161] Add additional logging on close of Snapshot Transaction Manager", "bodyText": "Goals (and why):\nAs per PDS-117161, there are times where a transaction manager is closed but we do not necessarily call all of the closing callbacks. This PR should help with debugging this case.\nImplementation Description (bullets):\n\nAdd logging for when the Snapshot transaction manager closes;\nAdd logging for when this close has been called before (i.e. transaction manager is already closed).\n\nTesting (What was existing testing like?  What have you done to improve it?):\nN/A\nConcerns (what feedback would you like?):\nAny other places where logging should be added? I know that internal skiing product doesn't (or should not) close transaction managers too frequently, but if there are other uses that do, this could add more logging noise.\nWhere should we start reviewing?:\nSnapshotTransactionManager\nPriority (whenever / two weeks / yesterday):\nToday would be nice.", "createdAt": "2020-04-24T10:02:44Z", "url": "https://github.com/palantir/atlasdb/pull/4732", "merged": true, "mergeCommit": {"oid": "01c34ff54a1ead415f7544b33c9d3c7226309e24"}, "closed": true, "closedAt": "2020-04-27T08:18:48Z", "author": {"login": "Jolyon-S"}, "timelineItems": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcauS3QgH2gAyNDA4NDU0NjY1OjkxYWE2YzM1NmE1YWEwNDZmZTk3MjcyM2RkOGNlODBhMzM3YjA1NDU=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcavCHrAH2gAyNDA4NDU0NjY1OjQyYWUyNzhkMTZhYjkxYTJmOTRjMDAxNWE4YTEzMWQ4MmRjNGY0NTY=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "91aa6c356a5aa046fe972723dd8ce80a337b0545", "author": {"user": {"login": "Jolyon-S", "name": "Jolyon"}}, "url": "https://github.com/palantir/atlasdb/commit/91aa6c356a5aa046fe972723dd8ce80a337b0545", "committedDate": "2020-04-24T09:44:21Z", "message": "add extra logging lines on close of snapshot txn manager"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzk5ODE3MDcx", "url": "https://github.com/palantir/atlasdb/pull/4732#pullrequestreview-399817071", "createdAt": "2020-04-24T10:12:37Z", "commit": {"oid": "91aa6c356a5aa046fe972723dd8ce80a337b0545"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yNFQxMDoxMjozOFrOGLQodA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yNFQxMDoxMjozOFrOGLQodA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNDQ2MDAyMA==", "bodyText": "Maybe logging also towards the end of the method before we exit?", "url": "https://github.com/palantir/atlasdb/pull/4732#discussion_r414460020", "createdAt": "2020-04-24T10:12:38Z", "author": {"login": "jkozlowski"}, "path": "atlasdb-impl-shared/src/main/java/com/palantir/atlasdb/transaction/impl/SnapshotTransactionManager.java", "diffHunk": "@@ -326,7 +326,9 @@ public void registerClosingCallback(Runnable closingCallback) {\n      */\n     @Override\n     public void close() {\n+        log.info(\"Calling close on snapshot transaction manager\");\n         if (!isClosed.compareAndSet(false, true)) {\n+            log.info(\"Snapshot transaction manager has already been closed, performing no action\");\n             return;\n         }", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "91aa6c356a5aa046fe972723dd8ce80a337b0545"}, "originalPosition": 8}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzk5ODMwMDM1", "url": "https://github.com/palantir/atlasdb/pull/4732#pullrequestreview-399830035", "createdAt": "2020-04-24T10:33:00Z", "commit": {"oid": "91aa6c356a5aa046fe972723dd8ce80a337b0545"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "42ae278d16ab91a2f94c0015a8a131d82dc4f456", "author": {"user": {"login": "Jolyon-S", "name": "Jolyon"}}, "url": "https://github.com/palantir/atlasdb/commit/42ae278d16ab91a2f94c0015a8a131d82dc4f456", "committedDate": "2020-04-24T10:35:58Z", "message": "add more logging towards end of method"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3094, "cost": 1, "resetAt": "2021-11-01T16:19:10Z"}}}