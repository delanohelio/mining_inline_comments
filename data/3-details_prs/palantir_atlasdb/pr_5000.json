{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDkyNjc0NzQ4", "number": 5000, "title": "[TimeLock] Fix Antiquated cURL Instructions From TimeLock Documentation", "bodyText": "Goals (and why):\n\nTimeLock docs should allow developers to independently get some understanding of how to talk to timelock.\nThe current docs have a lot of references to paths like bleh/api/timestamp/fresh-timestamp when it should be /api/tl/ts/bleh, which are outdated and end up requiring us to assist people in help-atlasdb.\n\nImplementation Description (bullets):\n\nReplace uses of TimeLock endpoints on TimeLock with the new Conjure paths. Similarly update related guidance on required headers and wire format changes (e.g. for getFreshTimestamp).\n\nTesting (What was existing testing like?  What have you done to improve it?):\n\nN/A, docs change.\n\nConcerns (what feedback would you like?):\n\nIs the Conjure path correctly constructed?\nThere are a few places in the docs where I have deliberately kept the old notation, generally when we are referring to an embedded service. Have I confused anything (i.e. treated an embedded thing as timelock, or vice versa)?\n\nWhere should we start reviewing?: wherever\nPriority (whenever / two weeks / yesterday): whenever", "createdAt": "2020-09-24T20:11:56Z", "url": "https://github.com/palantir/atlasdb/pull/5000", "merged": true, "mergeCommit": {"oid": "e4763c4a75834870ec57cabd773dca763f833c4e"}, "closed": true, "closedAt": "2020-10-19T13:15:49Z", "author": {"login": "jeremyk-91"}, "timelineItems": {"totalCount": 5, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdMG2xdgH2gAyNDkyNjc0NzQ4OmQzZmU0NzkyODFkYjU1ZDVkZTJkZTA5NzAyMmZlZTNhZDQ2MzRlZTE=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdTM_wpAH2gAyNDkyNjc0NzQ4OjdkMDU2MmVkNDg3YjYxNTA4OWNiZjQxNjM1YzUzZmQ1ZDg1NzE5MjQ=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "d3fe479281db55d5de2de097022fee3ad4634ee1", "author": {"user": {"login": "jeremyk-91", "name": "Jeremy Kong"}}, "url": "https://github.com/palantir/atlasdb/commit/d3fe479281db55d5de2de097022fee3ad4634ee1", "committedDate": "2020-09-24T20:03:35Z", "message": "Bad Curls"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "7340dde662ea4b0cbda448ab4d10144e79b4ad81", "author": {"user": {"login": "jeremyk-91", "name": "Jeremy Kong"}}, "url": "https://github.com/palantir/atlasdb/commit/7340dde662ea4b0cbda448ab4d10144e79b4ad81", "committedDate": "2020-09-24T20:06:43Z", "message": "more fixes"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDk1OTYwODM5", "url": "https://github.com/palantir/atlasdb/pull/5000#pullrequestreview-495960839", "createdAt": "2020-09-24T21:23:07Z", "commit": {"oid": "7340dde662ea4b0cbda448ab4d10144e79b4ad81"}, "state": "COMMENTED", "comments": {"totalCount": 5, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yNFQyMToyMzowN1rOHXtHeA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yNFQyMToyODowM1rOHXtQUg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NDYxODQ4OA==", "bodyText": "It'd probably be nice to have a callout/reminder that only the leader will respond, and other nodes will return a 308. Adding a -i to the curl was the only thing that tipped me off to the 308, otherwise there's just no output from non-leaders.", "url": "https://github.com/palantir/atlasdb/pull/5000#discussion_r494618488", "createdAt": "2020-09-24T21:23:07Z", "author": {"login": "lycarter"}, "path": "docs/source/services/timelock_service/manual-migration.rst", "diffHunk": "@@ -79,7 +80,8 @@ To verify that this step was completed correctly, you may curl the Timelock Serv\n \n    .. code:: bash\n \n-      curl -XPOST localhost:8080/test/timestamp/fresh-timestamp\n+      curl -XPOST <protocol>://<host>:<port>/timelock/api/tl/ts/<namespace> \\\n+        --data '{\"numTimestamps\": 1}' -H \"Authorization: Bearer q\" -H \"Content-Type: application/json\"", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "7340dde662ea4b0cbda448ab4d10144e79b4ad81"}, "originalPosition": 21}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NDYxODc4Ng==", "bodyText": "possibly also a reminder about the leader here", "url": "https://github.com/palantir/atlasdb/pull/5000#discussion_r494618786", "createdAt": "2020-09-24T21:23:51Z", "author": {"login": "lycarter"}, "path": "docs/source/services/timelock_service/reverse-migration.rst", "diffHunk": "@@ -44,10 +44,10 @@ of timestamps across TimeLock and the key-value service backed services is monot\n This can be obtained using ``curl`` as follows. Note that if you obtain an HTTP 503 error, this is because you curled a\n node that was not the leader; please try the other nodes.\n \n-.. code-block:: none\n+   .. code:: bash\n \n-   $ curl -XPOST https://<timelock-host>:8421/timelock/api/client/timestamp/fresh-timestamp\n-   123456789\n+      curl -XPOST <protocol>://<host>:<port>/timelock/api/tl/ts/<namespace> \\\n+        --data '{\"numTimestamps\": 1}' -H \"Authorization: Bearer q\" -H \"Content-Type: application/json\"", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "7340dde662ea4b0cbda448ab4d10144e79b4ad81"}, "originalPosition": 19}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NDYxOTg5NA==", "bodyText": "For this endpoint I received a 308, not 503", "url": "https://github.com/palantir/atlasdb/pull/5000#discussion_r494619894", "createdAt": "2020-09-24T21:26:09Z", "author": {"login": "lycarter"}, "path": "docs/source/services/timelock_service/service-management.rst", "diffHunk": "@@ -33,7 +33,8 @@ less than the fresh timestamp. This may be obtained through the fresh timestamp\n \n .. code:: bash\n \n-      curl -XPOST localhost:8080/timelock/api/old_namespace/timelock/fresh-timestamp\n+    curl -XPOST https://localhost:8421/timelock/api/tl/ts/old_namespace \\\n+      --data '{\"numTimestamps\": 1}' -H \"Authorization: Bearer q\" -H \"Content-Type: application/json\"\n \n A cluster of TimeLock servers elects a single leader, so if you contact a node that is not the leader you'll receive a\n ``NotCurrentLeaderException`` and an HTTP 503. In this case, try the same request on other nodes until you find the", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "7340dde662ea4b0cbda448ab4d10144e79b4ad81"}, "originalPosition": 9}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NDYyMDE4MQ==", "bodyText": "here you refer directly to https and localhost while in other files you refer to <protocol> and <host> - probably best to be consistent?", "url": "https://github.com/palantir/atlasdb/pull/5000#discussion_r494620181", "createdAt": "2020-09-24T21:26:46Z", "author": {"login": "lycarter"}, "path": "docs/source/services/timelock_service/service-management.rst", "diffHunk": "@@ -49,7 +50,7 @@ on TimeLock.\n \n .. code:: bash\n \n-      curl -XPOST localhost:8080/timelock/api/new_namespace/timestamp-management/fast-forward?currentTimestamp=TS\n+      curl -XPOST https://localhost:8421/timelock/api/new_namespace/timestamp-management/fast-forward?currentTimestamp=TS", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "7340dde662ea4b0cbda448ab4d10144e79b4ad81"}, "originalPosition": 15}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NDYyMDc1NA==", "bodyText": "As an unrelated comment, it is a bit surprising to me that this method is unauth'd - wouldn't this cause an issue if the endpoint was called with MAX_LONG?", "url": "https://github.com/palantir/atlasdb/pull/5000#discussion_r494620754", "createdAt": "2020-09-24T21:28:03Z", "author": {"login": "lycarter"}, "path": "docs/source/services/timelock_service/service-management.rst", "diffHunk": "@@ -49,7 +50,7 @@ on TimeLock.\n \n .. code:: bash\n \n-      curl -XPOST localhost:8080/timelock/api/new_namespace/timestamp-management/fast-forward?currentTimestamp=TS\n+      curl -XPOST https://localhost:8421/timelock/api/new_namespace/timestamp-management/fast-forward?currentTimestamp=TS", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NDYyMDE4MQ=="}, "originalCommit": {"oid": "7340dde662ea4b0cbda448ab4d10144e79b4ad81"}, "originalPosition": 15}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDk3NjMxNDc2", "url": "https://github.com/palantir/atlasdb/pull/5000#pullrequestreview-497631476", "createdAt": "2020-09-28T15:11:36Z", "commit": {"oid": "7340dde662ea4b0cbda448ab4d10144e79b4ad81"}, "state": "APPROVED", "comments": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yOFQxNToxMTozNlrOHZC2nw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yOFQxNToxOTowNVrOHZDXwA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NjAyMzE5OQ==", "bodyText": "\ud83d\udc4d  we can say this in the beginning", "url": "https://github.com/palantir/atlasdb/pull/5000#discussion_r496023199", "createdAt": "2020-09-28T15:11:36Z", "author": {"login": "gmaretic"}, "path": "docs/source/services/timelock_service/manual-migration.rst", "diffHunk": "@@ -79,7 +80,8 @@ To verify that this step was completed correctly, you may curl the Timelock Serv\n \n    .. code:: bash\n \n-      curl -XPOST localhost:8080/test/timestamp/fresh-timestamp\n+      curl -XPOST <protocol>://<host>:<port>/timelock/api/tl/ts/<namespace> \\\n+        --data '{\"numTimestamps\": 1}' -H \"Authorization: Bearer q\" -H \"Content-Type: application/json\"", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NDYxODQ4OA=="}, "originalCommit": {"oid": "7340dde662ea4b0cbda448ab4d10144e79b4ad81"}, "originalPosition": 21}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NjAyODQ1OA==", "bodyText": "Does this page even serve a purpose now?", "url": "https://github.com/palantir/atlasdb/pull/5000#discussion_r496028458", "createdAt": "2020-09-28T15:16:05Z", "author": {"login": "gmaretic"}, "path": "docs/source/services/timelock_service/product-changes.rst", "diffHunk": "@@ -6,17 +6,4 @@ Developing a product to use the timelock service\n All products deploying against the AtlasDB Timelock service should adhere to the following checklist.", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "7340dde662ea4b0cbda448ab4d10144e79b4ad81"}, "originalPosition": 1}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NjAzMDUzMA==", "bodyText": "The reminder is directly above", "url": "https://github.com/palantir/atlasdb/pull/5000#discussion_r496030530", "createdAt": "2020-09-28T15:18:05Z", "author": {"login": "gmaretic"}, "path": "docs/source/services/timelock_service/reverse-migration.rst", "diffHunk": "@@ -44,10 +44,10 @@ of timestamps across TimeLock and the key-value service backed services is monot\n This can be obtained using ``curl`` as follows. Note that if you obtain an HTTP 503 error, this is because you curled a\n node that was not the leader; please try the other nodes.\n \n-.. code-block:: none\n+   .. code:: bash\n \n-   $ curl -XPOST https://<timelock-host>:8421/timelock/api/client/timestamp/fresh-timestamp\n-   123456789\n+      curl -XPOST <protocol>://<host>:<port>/timelock/api/tl/ts/<namespace> \\\n+        --data '{\"numTimestamps\": 1}' -H \"Authorization: Bearer q\" -H \"Content-Type: application/json\"", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NDYxODc4Ng=="}, "originalCommit": {"oid": "7340dde662ea4b0cbda448ab4d10144e79b4ad81"}, "originalPosition": 19}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NjAzMTY4MA==", "bodyText": "Also make sure you update the info / add the correct info on the other two commented places", "url": "https://github.com/palantir/atlasdb/pull/5000#discussion_r496031680", "createdAt": "2020-09-28T15:19:05Z", "author": {"login": "gmaretic"}, "path": "docs/source/services/timelock_service/service-management.rst", "diffHunk": "@@ -33,7 +33,8 @@ less than the fresh timestamp. This may be obtained through the fresh timestamp\n \n .. code:: bash\n \n-      curl -XPOST localhost:8080/timelock/api/old_namespace/timelock/fresh-timestamp\n+    curl -XPOST https://localhost:8421/timelock/api/tl/ts/old_namespace \\\n+      --data '{\"numTimestamps\": 1}' -H \"Authorization: Bearer q\" -H \"Content-Type: application/json\"\n \n A cluster of TimeLock servers elects a single leader, so if you contact a node that is not the leader you'll receive a\n ``NotCurrentLeaderException`` and an HTTP 503. In this case, try the same request on other nodes until you find the", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NDYxOTg5NA=="}, "originalCommit": {"oid": "7340dde662ea4b0cbda448ab4d10144e79b4ad81"}, "originalPosition": 9}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "7d0562ed487b615089cbf41635c53fd5d8571924", "author": {"user": {"login": "jeremyk-91", "name": "Jeremy Kong"}}, "url": "https://github.com/palantir/atlasdb/commit/7d0562ed487b615089cbf41635c53fd5d8571924", "committedDate": "2020-10-16T21:10:18Z", "message": "Fix"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2597, "cost": 1, "resetAt": "2021-11-01T16:19:10Z"}}}