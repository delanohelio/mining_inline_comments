{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTA0NDI3ODk3", "number": 5038, "title": "make oracle protocol case insensitive", "bodyText": "Goals (and why):\nMakes the protocol (tcp/tcps) case insensitive in oracle configs.\nPreviously oracle connection configs required the protocol to be\nupper-case. Most of our other internal products allow any case\non the oracle protocol, so the requirement here for it to be\nupper-case in config results in some errors when people try to\nconfigure oracle.\nImplementation Description (bullets):\nAdds jackson annotations to the ConnectionProtocol enum.\nTesting (What was existing testing like?  What have you done to improve it?):\nAdded a unit test.\nConcerns (what feedback would you like?): N/A\nWhere should we start reviewing?: N/A\nPriority (whenever / two weeks / yesterday): high - allowing this to be case insensitive avoids configuration errors and helps with interoperability with other products that don't enforce case sensitivity on the oracle protocol.", "createdAt": "2020-10-15T22:46:13Z", "url": "https://github.com/palantir/atlasdb/pull/5038", "merged": true, "mergeCommit": {"oid": "afdd2541569037e945ed3ae7e52b62e31c12b393"}, "closed": true, "closedAt": "2020-10-20T08:28:52Z", "author": {"login": "berler"}, "timelineItems": {"totalCount": 6, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdS5tL8gH2gAyNTA0NDI3ODk3OjZmOTFkM2JjMzYyODZkNGZmYzk1MjY1Njc4YjZhMWRhYjFiZWVkZGE=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdUUgAhgFqTUxMjQ1NzAyNg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "6f91d3bc36286d4ffc95265678b6a1dab1beedda", "author": {"user": {"login": "berler", "name": "Steven Berler"}}, "url": "https://github.com/palantir/atlasdb/commit/6f91d3bc36286d4ffc95265678b6a1dab1beedda", "committedDate": "2020-10-15T22:41:49Z", "message": "make oracle protocol case insensitive\n\nMakes the protocol (tcp/tcps) case insensitive in oracle configs.\nPreviously oracle connection configs required the protocol to be\nupper-case."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "cc98fef8a6184283972f5a807c38610f6b842432", "author": {"user": {"login": "berler", "name": "Steven Berler"}}, "url": "https://github.com/palantir/atlasdb/commit/cc98fef8a6184283972f5a807c38610f6b842432", "committedDate": "2020-10-15T22:41:49Z", "message": "Add generated changelog entries"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "fe5bc6d5ce0bf2ac0c270663430886325298b607", "author": {"user": {"login": "berler", "name": "Steven Berler"}}, "url": "https://github.com/palantir/atlasdb/commit/fe5bc6d5ce0bf2ac0c270663430886325298b607", "committedDate": "2020-10-15T22:47:50Z", "message": "simplify changelog"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTExODk0MzYw", "url": "https://github.com/palantir/atlasdb/pull/5038#pullrequestreview-511894360", "createdAt": "2020-10-19T15:34:14Z", "commit": {"oid": "fe5bc6d5ce0bf2ac0c270663430886325298b607"}, "state": "COMMENTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xOVQxNTozNDoxNFrOHkUsoA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xOVQxNTozNjozNVrOHkUzqg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNzg0OTg4OA==", "bodyText": "While I agree that equalsIgnoreCase is better than what we were doing before, it should be semantically the same - and indeed, reverting this change resulted in the tests passing.\nI think the fix here is actually @JsonCreator if I am not mistaken - before, it was trying to map directly to one of the enums, whereas now it actually goes through this method - is that right?", "url": "https://github.com/palantir/atlasdb/pull/5038#discussion_r507849888", "createdAt": "2020-10-19T15:34:14Z", "author": {"login": "Jolyon-S"}, "path": "atlasdb-dbkvs-hikari/src/main/java/com/palantir/nexus/db/pool/config/ConnectionProtocol.java", "diffHunk": "@@ -28,9 +30,10 @@ public String getUrlString() {\n         return urlStr;\n     }\n \n+    @JsonCreator\n     public static ConnectionProtocol fromUrlString(String val) {\n         for (ConnectionProtocol cp : ConnectionProtocol.values()) {\n-            if (cp.getUrlString().toLowerCase().equals(val.toLowerCase())) {\n+            if (cp.getUrlString().equalsIgnoreCase(val)) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "fe5bc6d5ce0bf2ac0c270663430886325298b607"}, "originalPosition": 17}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNzg1MTY5MA==", "bodyText": "Would you mind writing a test that verifies that this does throw if an invalid protocol is passed?", "url": "https://github.com/palantir/atlasdb/pull/5038#discussion_r507851690", "createdAt": "2020-10-19T15:36:35Z", "author": {"login": "Jolyon-S"}, "path": "atlasdb-dbkvs-hikari/src/test/java/com/palantir/nexus/db/pool/config/OracleConnectionConfigTest.java", "diffHunk": "@@ -163,4 +166,23 @@ public void tcpsSetsTrustStore() throws IOException {\n                 .port(PORT);\n     }\n \n+    @Test\n+    public void protocolCaseInsensitiveTest() throws IOException {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "fe5bc6d5ce0bf2ac0c270663430886325298b607"}, "originalPosition": 20}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "4a77ca4b025bbc1e9f77ca5c2c6667e9e54af9fd", "author": {"user": {"login": "berler", "name": "Steven Berler"}}, "url": "https://github.com/palantir/atlasdb/commit/4a77ca4b025bbc1e9f77ca5c2c6667e9e54af9fd", "committedDate": "2020-10-19T17:00:30Z", "message": "add test case for ConnectionProtocol"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTEyNDU3MDI2", "url": "https://github.com/palantir/atlasdb/pull/5038#pullrequestreview-512457026", "createdAt": "2020-10-20T08:28:47Z", "commit": {"oid": "4a77ca4b025bbc1e9f77ca5c2c6667e9e54af9fd"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2653, "cost": 1, "resetAt": "2021-11-01T16:19:10Z"}}}