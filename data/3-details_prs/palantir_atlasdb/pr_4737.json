{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDA5NTQyNjQz", "number": 4737, "title": "[PaxosLog] Expose batch write method", "bodyText": "Goals (and why):\nBatched writes are going to be useful for migration and benchmarks\nImplementation Description (bullets):\nThere is an efficient implementation for SqlitePaxosStateLog.\nTesting (What was existing testing like?  What have you done to improve it?):\nThere is a unit test\nConcerns (what feedback would you like?):\nIs this polluting the interface? Alternatively we could have a different interface that exposes batched methods, but feels overengineered\nWhere should we start reviewing?:\ntiny\nPriority (whenever / two weeks / yesterday):\nasap", "createdAt": "2020-04-27T14:35:39Z", "url": "https://github.com/palantir/atlasdb/pull/4737", "merged": true, "mergeCommit": {"oid": "b9cb67290dede360f9b3b39f8e1cb4dfb6c965c9"}, "closed": true, "closedAt": "2020-04-28T10:57:41Z", "author": {"login": "gmaretic"}, "timelineItems": {"totalCount": 11, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcaKYjdgH2gAyNDA5NTQyNjQzOjkzYzE2NWRkYTAwM2FlZGQyMTJhM2U2ZmJjNmUyNmUwNzVkYmVhODc=", "endCursor": "Y3Vyc29yOnYyOpPPAAABccBHM8AH2gAyNDA5NTQyNjQzOmMwZDNiN2Y3OGY3M2VkN2UwZWZhYzk5ZmNjYTg1ZWMwZWFhZGMyZTY=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "93c165dda003aedd212a3e6fbc6e26e075dbea87", "author": {"user": {"login": "gmaretic", "name": null}}, "url": "https://github.com/palantir/atlasdb/commit/93c165dda003aedd212a3e6fbc6e26e075dbea87", "committedDate": "2020-04-22T15:53:59Z", "message": "Use JDBI"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "2dadde4e2d42e9f5c256e783ab06b2a4fd3407b4", "author": {"user": {"login": "gmaretic", "name": null}}, "url": "https://github.com/palantir/atlasdb/commit/2dadde4e2d42e9f5c256e783ab06b2a4fd3407b4", "committedDate": "2020-04-22T15:59:19Z", "message": "Package private"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "521a3eec0ba99a626c2e899e44336d60e07234cb", "author": {"user": {"login": "gmaretic", "name": null}}, "url": "https://github.com/palantir/atlasdb/commit/521a3eec0ba99a626c2e899e44336d60e07234cb", "committedDate": "2020-04-23T11:28:13Z", "message": "Prevent test connection from closing so we don't need to have funky factory in production code"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "df3cfc6a11b38b3be2ec40c3705953d497038728", "author": {"user": {"login": "gmaretic", "name": null}}, "url": "https://github.com/palantir/atlasdb/commit/df3cfc6a11b38b3be2ec40c3705953d497038728", "committedDate": "2020-04-23T12:55:39Z", "message": "Add batching support"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b88059c5da41ac7d6d1f7657e564786298ca8c80", "author": {"user": {"login": "gmaretic", "name": null}}, "url": "https://github.com/palantir/atlasdb/commit/b88059c5da41ac7d6d1f7657e564786298ca8c80", "committedDate": "2020-04-23T15:35:59Z", "message": "Address CR"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "7bcb706435d6b1e0dd85495103a6a2a824681d0c", "author": {"user": {"login": "gmaretic", "name": null}}, "url": "https://github.com/palantir/atlasdb/commit/7bcb706435d6b1e0dd85495103a6a2a824681d0c", "committedDate": "2020-04-23T15:36:52Z", "message": "Merge branch 'psl/jdbi' of github.com:palantir/atlasdb into psl/batch-write"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "635cf6eab4d55d3f4a4bfc33d1cc35686e1560df", "author": {"user": {"login": "gmaretic", "name": null}}, "url": "https://github.com/palantir/atlasdb/commit/635cf6eab4d55d3f4a4bfc33d1cc35686e1560df", "committedDate": "2020-04-27T14:07:02Z", "message": "Fix merge conflicts"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "bba27db26f00241b1714126bb42a190768c94e53", "author": {"user": {"login": "gmaretic", "name": null}}, "url": "https://github.com/palantir/atlasdb/commit/bba27db26f00241b1714126bb42a190768c94e53", "committedDate": "2020-04-27T14:30:33Z", "message": "Oops"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDAxMTI5ODUx", "url": "https://github.com/palantir/atlasdb/pull/4737#pullrequestreview-401129851", "createdAt": "2020-04-27T16:37:48Z", "commit": {"oid": "bba27db26f00241b1714126bb42a190768c94e53"}, "state": "APPROVED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yN1QxNjozNzo0OFrOGMsyvw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yN1QxNjo0MDoyNlrOGMs6cQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNTk2OTk4Mw==", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                default void writeBatchOfRounds(Iterable<PaxosRound<V>> rounds) {\n          \n          \n            \n                /**\n          \n          \n            \n                 * Implementations of this method MUST obey the following:\n          \n          \n            \n                 * 1) The end state of the log should be equivalent to applying the operations in \n          \n          \n            \n                 *    iteration order.\n          \n          \n            \n                 * 2) Implementations need not be atomic. However, if they fail, they should apply only\n          \n          \n            \n                 *    prefixes of the input iterable.\n          \n          \n            \n                 */\n          \n          \n            \n                default void writeBatchOfRounds(Iterable<PaxosRound<V>> rounds) {", "url": "https://github.com/palantir/atlasdb/pull/4737#discussion_r415969983", "createdAt": "2020-04-27T16:37:48Z", "author": {"login": "jeremyk-91"}, "path": "leader-election-api/src/main/java/com/palantir/paxos/PaxosStateLog.java", "diffHunk": "@@ -33,6 +33,10 @@\n      */\n     void writeRound(long seq, V round);\n \n+    default void writeBatchOfRounds(Iterable<PaxosRound<V>> rounds) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "bba27db26f00241b1714126bb42a190768c94e53"}, "originalPosition": 4}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNTk3MTk1Mw==", "bodyText": "Discussed why this must be boolean[] offline: required because of the signature of execute()", "url": "https://github.com/palantir/atlasdb/pull/4737#discussion_r415971953", "createdAt": "2020-04-27T16:40:26Z", "author": {"login": "jeremyk-91"}, "path": "leader-election-impl/src/main/java/com/palantir/paxos/SqlitePaxosStateLog.java", "diffHunk": "@@ -100,5 +109,9 @@ public void truncate(long toDeleteInclusive) {\n \n         @SqlUpdate(\"DELETE FROM <table> WHERE seq <= :seq\")\n         boolean truncate(@Define(\"table\") String table, @Bind(\"seq\") long seq);\n+\n+        @SqlBatch(\"INSERT OR REPLACE INTO <table> (seq, val) VALUES (:round.sequence, :round.valueBytes)\")\n+        <V extends Persistable & Versionable> boolean[] writeBatchOfRounds(@Define(\"table\") String table,", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "bba27db26f00241b1714126bb42a190768c94e53"}, "originalPosition": 40}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "645d2e849096aa4ea98f1997d1baa11de01e1bae", "author": {"user": {"login": "gmaretic", "name": null}}, "url": "https://github.com/palantir/atlasdb/commit/645d2e849096aa4ea98f1997d1baa11de01e1bae", "committedDate": "2020-04-28T09:49:25Z", "message": "Update leader-election-api/src/main/java/com/palantir/paxos/PaxosStateLog.java\n\nCo-Authored-By: Jeremy Kong <jeremykong@hotmail.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c0d3b7f78f73ed7e0efac99fcca85ec0eaadc2e6", "author": {"user": {"login": "gmaretic", "name": null}}, "url": "https://github.com/palantir/atlasdb/commit/c0d3b7f78f73ed7e0efac99fcca85ec0eaadc2e6", "committedDate": "2020-04-28T10:13:44Z", "message": "Checkstyle is a joke"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3103, "cost": 1, "resetAt": "2021-11-01T16:19:10Z"}}}