{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDAzMzA0MDcx", "number": 4707, "title": "Executor quality of life and instrumentation", "bodyText": "Goals (and why):\nPreparation for #4701 This will provide additional data to discover and remediate thread bloat.\nImplementation Description (bullets):\n\nPTExecutors thread factory uses daemon threads by default. Most consumers prefer daemon threads to avoid propping up JVMs that want to die.\nPTExecutors.newCachedThreadPool returns ExecutorService instances instead of ThreadPoolExecutor concrete types. This is an ABI break. Please use WC executor factories!\nInstrument NamedThreadFactory using the singleton TaggedMetricRegistry instance to collect data describing thread bloat.\n\nTesting (What was existing testing like?  What have you done to improve it?):\nExisting test coverage is sufficient.\nConcerns (what feedback would you like?):\n\u00af_(\u30c4)_/\u00af", "createdAt": "2020-04-14T16:59:17Z", "url": "https://github.com/palantir/atlasdb/pull/4707", "merged": true, "mergeCommit": {"oid": "782cfb1efe5315dd8a3c0e8bf1c1ea26b5aa489c"}, "closed": true, "closedAt": "2020-04-14T19:54:32Z", "author": {"login": "carterkozak"}, "timelineItems": {"totalCount": 8, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcXmJ33gH2gAyNDAzMzA0MDcxOmI4YWQyMjZiN2MxNDdhZTJiN2Y0ZTJhZWMyNjNhMjQzZjZlMjU0NTA=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcXn-dyAFqTM5MzE5NjkwNQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "b8ad226b7c147ae2b7f4e2aec263a243f6e25450", "author": {"user": {"login": "carterkozak", "name": "Carter Kozak"}}, "url": "https://github.com/palantir/atlasdb/commit/b8ad226b7c147ae2b7f4e2aec263a243f6e25450", "committedDate": "2020-04-14T16:33:31Z", "message": "PTExecutors improvements for cached executors\n\n1. PTExecutors use daemon threads by default to prevent tasks from\n   accidentally pinning up a JVM that wants to die.\n2. Added a new PTExecutors.newCachedThreadPool factory method which\n   takes a string base-name instead of an entire ThreadFactory."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e7e298fc8c90483f76b2772a550843c080afad68", "author": {"user": {"login": "carterkozak", "name": "Carter Kozak"}}, "url": "https://github.com/palantir/atlasdb/commit/e7e298fc8c90483f76b2772a550843c080afad68", "committedDate": "2020-04-14T16:33:31Z", "message": "ABI Break: PTExecutors.newCachedThreadPool returns ExecutorService\n\nThe interface type provide a more reasonable API surface than the\nconcrete implementation, and allows us to do more interesting things\nwithout resorting to terrible hacks that will come back to haunt us\nlater."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "1c5acf6061acdaf5067acd9fdaa11702c89be621", "author": {"user": {"login": "carterkozak", "name": "Carter Kozak"}}, "url": "https://github.com/palantir/atlasdb/commit/1c5acf6061acdaf5067acd9fdaa11702c89be621", "committedDate": "2020-04-14T16:54:05Z", "message": "Instrument PTExecutors thread factory (NamedThreadFactory)"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "dbe829d9ad427f8713b617658ce4e582cae91888", "author": {"user": {"login": "carterkozak", "name": "Carter Kozak"}}, "url": "https://github.com/palantir/atlasdb/commit/dbe829d9ad427f8713b617658ce4e582cae91888", "committedDate": "2020-04-14T16:54:05Z", "message": "Add generated changelog entries"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a8a67696c7eb246eb991d12620b51bfa3ebb1a1c", "author": {"user": {"login": "carterkozak", "name": "Carter Kozak"}}, "url": "https://github.com/palantir/atlasdb/commit/a8a67696c7eb246eb991d12620b51bfa3ebb1a1c", "committedDate": "2020-04-14T18:27:04Z", "message": "more instrumentation"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzkzMTcyNzEy", "url": "https://github.com/palantir/atlasdb/pull/4707#pullrequestreview-393172712", "createdAt": "2020-04-14T18:07:10Z", "commit": {"oid": "dbe829d9ad427f8713b617658ce4e582cae91888"}, "state": "COMMENTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0xNFQxODowNzoxMFrOGFayJg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0xNFQxODowNzo1OFrOGFaz5w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwODMzNDg4Ng==", "bodyText": "nit: Don't feel strongly about which way this falls, but we should probably be consistent on whether we prefer the string literal or ThisClass.class.getName() for these executors.", "url": "https://github.com/palantir/atlasdb/pull/4707#discussion_r408334886", "createdAt": "2020-04-14T18:07:10Z", "author": {"login": "jeremyk-91"}, "path": "lock-impl/src/test/java/com/palantir/lock/impl/ClientAwareLockTest.java", "diffHunk": "@@ -48,8 +47,7 @@\n @ShouldRetry\n public final class ClientAwareLockTest {\n \n-    private static final ExecutorService executor = PTExecutors.newCachedThreadPool(\n-            new NamedThreadFactory(ClientAwareLockTest.class.getName(), true));\n+    private static final ExecutorService executor = PTExecutors.newCachedThreadPool(\"ClientAwareLockTest\");", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "dbe829d9ad427f8713b617658ce4e582cae91888"}, "originalPosition": 14}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwODMzNTMzNQ==", "bodyText": "We could mark this as break if we want to make the ABI break more obvious.", "url": "https://github.com/palantir/atlasdb/pull/4707#discussion_r408335335", "createdAt": "2020-04-14T18:07:58Z", "author": {"login": "jeremyk-91"}, "path": "changelog/@unreleased/pr-4707.v2.yml", "diffHunk": "@@ -0,0 +1,8 @@\n+type: improvement", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "dbe829d9ad427f8713b617658ce4e582cae91888"}, "originalPosition": 1}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "5370831c4bcb8dce5d2d3aab2c136ea3b5985bb5", "author": {"user": {"login": "carterkozak", "name": "Carter Kozak"}}, "url": "https://github.com/palantir/atlasdb/commit/5370831c4bcb8dce5d2d3aab2c136ea3b5985bb5", "committedDate": "2020-04-14T18:34:41Z", "message": "CR"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzkzMTk2OTA1", "url": "https://github.com/palantir/atlasdb/pull/4707#pullrequestreview-393196905", "createdAt": "2020-04-14T18:40:52Z", "commit": {"oid": "5370831c4bcb8dce5d2d3aab2c136ea3b5985bb5"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3055, "cost": 1, "resetAt": "2021-11-01T16:19:10Z"}}}