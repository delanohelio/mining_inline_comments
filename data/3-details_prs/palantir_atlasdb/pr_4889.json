{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDQ2MTg4MTAw", "number": 4889, "title": "Tweak acceptable request rate", "bodyText": "Goals (and why):\nThis PR lowers the minimum threshold for request rate (defensive estimate considering Autobatchers). There is also an additional check to flag badness when p99 is very high, irrespective of request rate.\nTesting (What was existing testing like?  What have you done to improve it?):\nTest case added\nConcerns (what feedback would you like?):\nNone\nWhere should we start reviewing?:\nFeedbackHandler.java\nPriority (whenever / two weeks / yesterday):\nTomorrow", "createdAt": "2020-07-08T11:44:14Z", "url": "https://github.com/palantir/atlasdb/pull/4889", "merged": true, "mergeCommit": {"oid": "74fe9beb19efa6259203af12c78f3082776819a5"}, "closed": true, "closedAt": "2020-07-09T18:36:39Z", "author": {"login": "sudiksha27"}, "timelineItems": {"totalCount": 16, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcy46VpAH2gAyNDQ2MTg4MTAwOmJlNzA3MWQyZjQwNTNiZDQyYzVjYmMwNTU2MmY0NDNkMzcyOTdhMjc=", "endCursor": "Y3Vyc29yOnYyOpPPAAABczTZxdAFqTQ0NTg2OTczOA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "be7071d2f4053bd42c5cbc05562f443d37297a27", "author": {"user": {"login": "sudiksha27", "name": "sudiksha nanda"}}, "url": "https://github.com/palantir/atlasdb/commit/be7071d2f4053bd42c5cbc05562f443d37297a27", "committedDate": "2020-07-08T11:40:42Z", "message": "Add logs | tweak acceptable request rate"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "37f22d0636eca0e540e6065b3f21ae8f2a3121e1", "author": {"user": {"login": "sudiksha27", "name": "sudiksha nanda"}}, "url": "https://github.com/palantir/atlasdb/commit/37f22d0636eca0e540e6065b3f21ae8f2a3121e1", "committedDate": "2020-07-08T11:56:44Z", "message": "Outliers are bad"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "84c1efeb91def9b00f959e9063120043923ce5ef", "author": {"user": {"login": "sudiksha27", "name": "sudiksha nanda"}}, "url": "https://github.com/palantir/atlasdb/commit/84c1efeb91def9b00f959e9063120043923ce5ef", "committedDate": "2020-07-08T12:01:09Z", "message": "log stats"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b413851befe270c66d832fb242422b1fba3c77a2", "author": {"user": {"login": "sudiksha27", "name": "sudiksha nanda"}}, "url": "https://github.com/palantir/atlasdb/commit/b413851befe270c66d832fb242422b1fba3c77a2", "committedDate": "2020-07-08T17:51:19Z", "message": "Remove redundant"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "18998445de67d184eb68a09cc59e2a9142288193", "author": {"user": {"login": "sudiksha27", "name": "sudiksha nanda"}}, "url": "https://github.com/palantir/atlasdb/commit/18998445de67d184eb68a09cc59e2a9142288193", "committedDate": "2020-07-08T18:08:09Z", "message": "Add generated changelog entries"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "4de45efe453749bb001ffe99053fcbee2196d159", "author": {"user": {"login": "sudiksha27", "name": "sudiksha nanda"}}, "url": "https://github.com/palantir/atlasdb/commit/4de45efe453749bb001ffe99053fcbee2196d159", "committedDate": "2020-07-08T18:08:09Z", "message": "Add test"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "1f6d4d0ce3b8dc2202d5f98f8446b52d14ed6855", "author": {"user": {"login": "sudiksha27", "name": "sudiksha nanda"}}, "url": "https://github.com/palantir/atlasdb/commit/1f6d4d0ce3b8dc2202d5f98f8446b52d14ed6855", "committedDate": "2020-07-08T18:08:09Z", "message": "Add generated changelog entries"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDQ1NDcxNDg3", "url": "https://github.com/palantir/atlasdb/pull/4889#pullrequestreview-445471487", "createdAt": "2020-07-09T10:03:51Z", "commit": {"oid": "1f6d4d0ce3b8dc2202d5f98f8446b52d14ed6855"}, "state": "COMMENTED", "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wOVQxMDowMzo1MlrOGvKctA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wOVQxMDoxNzo0NFrOGvK55A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MjEwNzQ0NA==", "bodyText": "On one hand I'd prefer not to add complexity - on the other I think we should special case a flat 0 for the request rate, because this is backed by an exponential metric registry and so an old, slow request might end up hanging for more than we would like.", "url": "https://github.com/palantir/atlasdb/pull/4889#discussion_r452107444", "createdAt": "2020-07-09T10:03:52Z", "author": {"login": "jeremyk-91"}, "path": "timelock-impl/src/main/java/com/palantir/atlasdb/timelock/adjudicate/FeedbackHandler.java", "diffHunk": "@@ -149,7 +148,13 @@ HealthStatus pointFeedbackHealthStatus(ConjureTimeLockClientFeedback healthRepor\n     private HealthStatus getHealthStatusForService(EndpointStatistics endpointStatistics,\n             double rateThreshold,\n             long p99Limit,\n-            double errorRateProportion) {\n+            double errorRateProportion,\n+            double p99Multiplier) {\n+\n+        // Outliers indicate badness, regardless of request rate\n+        if (endpointStatistics.getP99() > p99Limit * p99Multiplier) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "1f6d4d0ce3b8dc2202d5f98f8446b52d14ed6855"}, "originalPosition": 35}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MjExNDAxNA==", "bodyText": "Could we make this 0.02?\nThe reason is because these endpoints on the AtlasDB side are autobatched. So the current p99 multiplier there means we'll say unhealthy on 50 seconds or above, and it would be good to catch a server that is queueing up 40 second autobatcher calls.", "url": "https://github.com/palantir/atlasdb/pull/4889#discussion_r452114014", "createdAt": "2020-07-09T10:16:00Z", "author": {"login": "jeremyk-91"}, "path": "timelock-impl/src/main/java/com/palantir/atlasdb/timelock/adjudicate/Constants.java", "diffHunk": "@@ -34,15 +34,17 @@ private Constants() {\n     public static final ServiceLevelObjectiveSpecification LEADER_TIME_SERVICE_LEVEL_OBJECTIVES\n             = ServiceLevelObjectiveSpecification.builder()\n             .maximumPermittedP99(Duration.ofMillis(200))\n-            .minimumRequestRateForConsideration(1)\n+            .minimumRequestRateForConsideration(0.1)\n             .maximumPermittedErrorProportion(0.5)\n+            .p99Multiplier(100)\n             .build();\n \n     public static final ServiceLevelObjectiveSpecification START_TRANSACTION_SERVICE_LEVEL_OBJECTIVES\n             = ServiceLevelObjectiveSpecification.builder()\n             .maximumPermittedP99(Duration.ofMillis(500))\n-            .minimumRequestRateForConsideration(1)\n+            .minimumRequestRateForConsideration(0.1)", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "1f6d4d0ce3b8dc2202d5f98f8446b52d14ed6855"}, "originalPosition": 14}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MjExNDkxNg==", "bodyText": "I'd prefer a design where we have something like\n  Duration maximumPermittedSteadyStateP99();\n  Duration maximumPermittedQuietP99(); // currently this is maximumPermittedP99 * multiplier\n\nwith comments explaining the difference. The multiplier doesn't really say what it does", "url": "https://github.com/palantir/atlasdb/pull/4889#discussion_r452114916", "createdAt": "2020-07-09T10:17:44Z", "author": {"login": "jeremyk-91"}, "path": "timelock-impl/src/main/java/com/palantir/atlasdb/timelock/adjudicate/ServiceLevelObjectiveSpecification.java", "diffHunk": "@@ -27,6 +27,7 @@\n     Duration maximumPermittedP99();\n     double maximumPermittedErrorProportion();\n     double minimumRequestRateForConsideration();\n+    double p99Multiplier();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "1f6d4d0ce3b8dc2202d5f98f8446b52d14ed6855"}, "originalPosition": 4}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "7eef40195d8c825ae18a64194cd4445445732585", "author": {"user": {"login": "sudiksha27", "name": "sudiksha nanda"}}, "url": "https://github.com/palantir/atlasdb/commit/7eef40195d8c825ae18a64194cd4445445732585", "committedDate": "2020-07-09T13:43:48Z", "message": "Address comments"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e8f9c458883ff16a61a07e24970e2d4827d59c74", "author": {"user": {"login": "sudiksha27", "name": "sudiksha nanda"}}, "url": "https://github.com/palantir/atlasdb/commit/e8f9c458883ff16a61a07e24970e2d4827d59c74", "committedDate": "2020-07-09T13:46:30Z", "message": "Merge branch 'adjudication_limits' of github.com:palantir/atlasdb into adjudication_limits"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "0b97e6d03fb847f3a4cddf96058291d6337eb65b", "author": {"user": {"login": "sudiksha27", "name": "sudiksha nanda"}}, "url": "https://github.com/palantir/atlasdb/commit/0b97e6d03fb847f3a4cddf96058291d6337eb65b", "committedDate": "2020-07-09T14:03:41Z", "message": "Add comment"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "fc3d06d0aa453c4032bf7ce14cc1f8aea4b93ce9", "author": {"user": {"login": "sudiksha27", "name": "sudiksha nanda"}}, "url": "https://github.com/palantir/atlasdb/commit/fc3d06d0aa453c4032bf7ce14cc1f8aea4b93ce9", "committedDate": "2020-07-09T14:43:58Z", "message": "Precondition check"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "1de777b265e634f658a9ccfcded12c7cddd73d76", "author": {"user": {"login": "sudiksha27", "name": "sudiksha nanda"}}, "url": "https://github.com/palantir/atlasdb/commit/1de777b265e634f658a9ccfcded12c7cddd73d76", "committedDate": "2020-07-09T14:55:30Z", "message": "Update comment"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a5444f97f1f59b255ee3f03314d7e1203437ed63", "author": {"user": {"login": "sudiksha27", "name": "sudiksha nanda"}}, "url": "https://github.com/palantir/atlasdb/commit/a5444f97f1f59b255ee3f03314d7e1203437ed63", "committedDate": "2020-07-09T15:13:24Z", "message": "Rectify message"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "da2d66568cab806690a022b81c6a68efc1b2dfad", "author": {"user": {"login": "sudiksha27", "name": "sudiksha nanda"}}, "url": "https://github.com/palantir/atlasdb/commit/da2d66568cab806690a022b81c6a68efc1b2dfad", "committedDate": "2020-07-09T15:13:24Z", "message": "Add generated changelog entries"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDQ1ODY5NzM4", "url": "https://github.com/palantir/atlasdb/pull/4889#pullrequestreview-445869738", "createdAt": "2020-07-09T18:32:34Z", "commit": {"oid": "da2d66568cab806690a022b81c6a68efc1b2dfad"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2721, "cost": 1, "resetAt": "2021-11-01T16:19:10Z"}}}