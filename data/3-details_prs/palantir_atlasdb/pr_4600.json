{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0Mzc5NjE1MTU1", "number": 4600, "title": "Make KeyValueServiceRuntimeConfig jackson discoverable", "bodyText": "Goals (and why):\nDeserializing yml config to AtlasDbRuntimeConfig instance fails when keyValueService is a part of the yml.\nKeyValueServiceRuntimeConfig is an interface with semi-concrete implementation in CassandraKeyValueServiceRuntimeConfig.\nThe organization of modules is such that we cannot specify CassandraKVSRuntimeConfig as JsonSubType in KVSRuntimeConfig (circular dependency).\nJackson has to know that CassandraKVSRuntimeConfig is a subclass of KVSRuntimeConfig for successful deserialization and this information is registered by DiscoverableSubtypeResolver.\nCode path - AtlasDbConfigs.OBJECT_MAPPER#setSubtypeResolver\nTurns out KeyValueServiceRuntimeConfig is not being registered right now which is why deserialization to AtlasDbRuntimeConfig#keyValueService is failing.\nThis change aims to fix that (and some test are modified to verify the fix).\nImplementation Description (bullets):\n\nKeyValueServiceRuntimeConfig added to io.dropwizard.jackson.Discoverable\n\nTesting (What was existing testing like?  What have you done to improve it?):\n\nModifying an existing test to ensure deserialization is working.\n\nConcerns (what feedback would you like?):\n\nDoes this change completely fix the bug?\n\nWhere should we start reviewing?:\n\nio.dropwizard.jackson.Discoverable\n\nPriority (whenever / two weeks / yesterday):\nAs soon as possible", "createdAt": "2020-02-25T14:29:03Z", "url": "https://github.com/palantir/atlasdb/pull/4600", "merged": true, "mergeCommit": {"oid": "7ca9f290fea6dc9e72e954f083703e1cfcfbd609"}, "closed": true, "closedAt": "2020-02-25T18:58:14Z", "author": {"login": "sudiksha27"}, "timelineItems": {"totalCount": 11, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcHyWKogH2gAyMzc5NjE1MTU1OmYyY2MzYjA3MmFkMjQ2MzI0NjUyYmI1ZjU2N2RlODBiZmIwMzliOTg=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcH2uOdgFqTM2NDM2MDgyMw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "f2cc3b072ad246324652bb5f567de80bfb039b98", "author": {"user": {"login": "sudiksha27", "name": "sudiksha nanda"}}, "url": "https://github.com/palantir/atlasdb/commit/f2cc3b072ad246324652bb5f567de80bfb039b98", "committedDate": "2020-02-25T13:43:01Z", "message": "Make KeyValueServiceRuntimeConfig jackson discoverable"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzY0MTg0MTg2", "url": "https://github.com/palantir/atlasdb/pull/4600#pullrequestreview-364184186", "createdAt": "2020-02-25T14:30:57Z", "commit": {"oid": "f2cc3b072ad246324652bb5f567de80bfb039b98"}, "state": "COMMENTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yNVQxNDozMDo1OFrOFuIO9g==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yNVQxNDozMToxOFrOFuIP0A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MzkxMzcxOA==", "bodyText": "I think you want to still use the old form for this test since that's the deprecated version.\nI would also change all the tests to deserialise to KeyValueServiceRuntimeConfig.class instead of the semi-concrete CassandraKeyValueServiceRuntimeConfig test to ensure we're doing the right thing everywhere", "url": "https://github.com/palantir/atlasdb/pull/4600#discussion_r383913718", "createdAt": "2020-02-25T14:30:58Z", "author": {"login": "felixdesouza"}, "path": "atlasdb-cassandra/src/test/java/com/palantir/atlasdb/cassandra/CassandraKeyValueServiceConfigsTest.java", "diffHunk": "@@ -115,8 +116,8 @@ public void canDeserializeRuntimeConfig() throws IOException {\n \n     @Test\n     public void canParseRuntimeDeprecatedConfigType() throws IOException {\n-        CassandraKeyValueServiceRuntimeConfig config =\n-                AtlasDbConfigs.OBJECT_MAPPER.readValue(\"type: CassandraKeyValueServiceRuntimeConfig\",\n-                        CassandraKeyValueServiceRuntimeConfig.class);\n+        KeyValueServiceRuntimeConfig config =", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f2cc3b072ad246324652bb5f567de80bfb039b98"}, "originalPosition": 15}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MzkxMzkzNg==", "bodyText": "I think you need a new line at the end of the file, things seem to scream generally", "url": "https://github.com/palantir/atlasdb/pull/4600#discussion_r383913936", "createdAt": "2020-02-25T14:31:18Z", "author": {"login": "felixdesouza"}, "path": "atlasdb-config/src/test/resources/runtime-config-block.yml", "diffHunk": "@@ -26,3 +26,7 @@ sweep:\n \n internalSchema:\n   targetTransactionsSchemaVersion: 1\n+\n+keyValueService:\n+  type: cassandra\n+  fetchReadLimitPerRow: 1000", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f2cc3b072ad246324652bb5f567de80bfb039b98"}, "originalPosition": 7}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "07f0f1649154716c22c4834364d99437ae3e7a01", "author": {"user": {"login": "sudiksha27", "name": "sudiksha nanda"}}, "url": "https://github.com/palantir/atlasdb/commit/07f0f1649154716c22c4834364d99437ae3e7a01", "committedDate": "2020-02-25T14:49:08Z", "message": "Address comments"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "5fa3a0a9a9f36c7c4b7a27db6601435898fcc47d", "author": {"user": {"login": "sudiksha27", "name": "sudiksha nanda"}}, "url": "https://github.com/palantir/atlasdb/commit/5fa3a0a9a9f36c7c4b7a27db6601435898fcc47d", "committedDate": "2020-02-25T16:43:18Z", "message": "Add generated changelog entries"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "7961ce47bf960ed55864a85d90cb1da3d9544e07", "author": {"user": {"login": "sudiksha27", "name": "sudiksha nanda"}}, "url": "https://github.com/palantir/atlasdb/commit/7961ce47bf960ed55864a85d90cb1da3d9544e07", "committedDate": "2020-02-25T16:43:18Z", "message": "Add generated changelog entries"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "2ad823c4832dcd1c4019086eca29bc66ee617a92", "author": {"user": {"login": "sudiksha27", "name": "sudiksha nanda"}}, "url": "https://github.com/palantir/atlasdb/commit/2ad823c4832dcd1c4019086eca29bc66ee617a92", "committedDate": "2020-02-25T16:43:18Z", "message": "Add generated changelog entries"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "3fd88a3637279f1da0ee8241d62fd32be1aff367", "author": {"user": {"login": "sudiksha27", "name": "sudiksha nanda"}}, "url": "https://github.com/palantir/atlasdb/commit/3fd88a3637279f1da0ee8241d62fd32be1aff367", "committedDate": "2020-02-25T16:43:18Z", "message": "Add generated changelog entries"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "2dd377c2ed4a03f8bcf80aa462f1eade052fc334", "author": {"user": {"login": "sudiksha27", "name": "sudiksha nanda"}}, "url": "https://github.com/palantir/atlasdb/commit/2dd377c2ed4a03f8bcf80aa462f1eade052fc334", "committedDate": "2020-02-25T16:43:18Z", "message": "Add generated changelog entries"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "793fb0f241714830476ee428865c35d1bad309b2", "author": {"user": {"login": "sudiksha27", "name": "sudiksha nanda"}}, "url": "https://github.com/palantir/atlasdb/commit/793fb0f241714830476ee428865c35d1bad309b2", "committedDate": "2020-02-25T16:43:24Z", "message": "Remove invalid test modif"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "fd9f50907fa3de85fa1c657793ac4e8a42e88c1f", "author": {"user": {"login": "sudiksha27", "name": "sudiksha nanda"}}, "url": "https://github.com/palantir/atlasdb/commit/fd9f50907fa3de85fa1c657793ac4e8a42e88c1f", "committedDate": "2020-02-25T16:43:18Z", "message": "Add generated changelog entries"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzY0MzYwODIz", "url": "https://github.com/palantir/atlasdb/pull/4600#pullrequestreview-364360823", "createdAt": "2020-02-25T18:48:55Z", "commit": {"oid": "2dd377c2ed4a03f8bcf80aa462f1eade052fc334"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2291, "cost": 1, "resetAt": "2021-11-01T16:19:10Z"}}}