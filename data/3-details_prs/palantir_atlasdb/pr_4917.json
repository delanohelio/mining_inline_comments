{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDU3MTcxOTc3", "number": 4917, "title": "[PDS-127121] Log refreshed Cassandra hosts at info level", "bodyText": "Goals (and why):\nExpose more information about the state of the Cassandra pool in logs.\nImplementation Description (bullets):\nChanged DEBUG -> INFO on one log line (that details which hosts that have been added and removed).\nTesting (What was existing testing like?  What have you done to improve it?):\nN/A.\nConcerns (what feedback would you like?):\nI don't think this introduces much spam - it is unlikely that anyone refreshes their token ranges / servers more than once per 30 seconds (default is once per 120 seconds), so one log line per refresh is minimal.\nAs for whether this is enough - I believe so, as it would tell us what hosts that are being added/removed at each point so that we can have a reasonable picture of what the pool is. Naturally this doesn't tell us the actual current state of the pool, only the diff - but debugLogStateOfPool is a lot more heavy-handed, and possibly not necessary here.\nWhere should we start reviewing?:\nCassandraClientPoolImpl\nPriority (whenever / two weeks / yesterday):\nWhenever", "createdAt": "2020-07-27T13:40:28Z", "url": "https://github.com/palantir/atlasdb/pull/4917", "merged": true, "mergeCommit": {"oid": "52e8a91e5ee8789a3c73ee7c4b83a040592e9390"}, "closed": true, "closedAt": "2020-07-28T10:03:03Z", "author": {"login": "Jolyon-S"}, "timelineItems": {"totalCount": 7, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABc5B82UAH2gAyNDU3MTcxOTc3OjE1Y2Y4NDY2MTEzNDI3Y2FkM2JkMDJmYTc0NjE0MDM1ODQxZWQ2ODY=", "endCursor": "Y3Vyc29yOnYyOpPPAAABc5CmF9gH2gAyNDU3MTcxOTc3OmQyMGMyNmYyMTJjMDg0MTQyMzZmMjViMTY1YjExZmI2NjI0Yzc2MWY=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "15cf8466113427cad3bd02fa74614035841ed686", "author": {"user": {"login": "Jolyon-S", "name": "Jolyon"}}, "url": "https://github.com/palantir/atlasdb/commit/15cf8466113427cad3bd02fa74614035841ed686", "committedDate": "2020-07-27T13:36:08Z", "message": "set debug logging to info"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "866886e1f227b92f8a54c339f96ab0c823dc20f5", "author": {"user": {"login": "Jolyon-S", "name": "Jolyon"}}, "url": "https://github.com/palantir/atlasdb/commit/866886e1f227b92f8a54c339f96ab0c823dc20f5", "committedDate": "2020-07-27T13:36:08Z", "message": "Add generated changelog entries"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDU1Nzk5MDk1", "url": "https://github.com/palantir/atlasdb/pull/4917#pullrequestreview-455799095", "createdAt": "2020-07-27T13:49:52Z", "commit": {"oid": "866886e1f227b92f8a54c339f96ab0c823dc20f5"}, "state": "APPROVED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yN1QxMzo0OTo1MlrOG3jUbQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yN1QxMzo0OTo1MlrOG3jUbQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MDkwMzUzMw==", "bodyText": "nit: How valuable is an empty refresh line? Maybe we can have a refresh that did something at INFO and a refresh that did nothing at DEBUG.", "url": "https://github.com/palantir/atlasdb/pull/4917#discussion_r460903533", "createdAt": "2020-07-27T13:49:52Z", "author": {"login": "jeremyk-91"}, "path": "atlasdb-cassandra/src/main/java/com/palantir/atlasdb/keyvalue/cassandra/CassandraClientPoolImpl.java", "diffHunk": "@@ -312,7 +312,7 @@ private void setServersInPoolTo(Set<InetSocketAddress> desiredServers) {\n             cassandra.refreshTokenRangesAndGetServers();\n         }\n \n-        log.debug(\"Cassandra pool refresh added hosts {}, removed hosts {}.\",\n+        log.info(\"Cassandra pool refresh added hosts {}, removed hosts {}.\",", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "866886e1f227b92f8a54c339f96ab0c823dc20f5"}, "originalPosition": 5}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "dc3ce6597568bc31a4283b2989ba7fab572c5032", "author": {"user": {"login": "Jolyon-S", "name": "Jolyon"}}, "url": "https://github.com/palantir/atlasdb/commit/dc3ce6597568bc31a4283b2989ba7fab572c5032", "committedDate": "2020-07-27T13:57:51Z", "message": "factor out log method"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c0017822bb986b0312a20839519b7189dedc7e97", "author": {"user": {"login": "Jolyon-S", "name": "Jolyon"}}, "url": "https://github.com/palantir/atlasdb/commit/c0017822bb986b0312a20839519b7189dedc7e97", "committedDate": "2020-07-27T13:58:07Z", "message": "Merge branch 'elevate-to-info' of github.com:palantir/atlasdb into elevate-to-info"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDU1ODI3NDQz", "url": "https://github.com/palantir/atlasdb/pull/4917#pullrequestreview-455827443", "createdAt": "2020-07-27T14:20:01Z", "commit": {"oid": "c0017822bb986b0312a20839519b7189dedc7e97"}, "state": "APPROVED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yN1QxNDoyMDowMVrOG3koug==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yN1QxNDoyMDowMVrOG3koug==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MDkyNTExNA==", "bodyText": "nit: static?", "url": "https://github.com/palantir/atlasdb/pull/4917#discussion_r460925114", "createdAt": "2020-07-27T14:20:01Z", "author": {"login": "jeremyk-91"}, "path": "atlasdb-cassandra/src/main/java/com/palantir/atlasdb/keyvalue/cassandra/CassandraClientPoolImpl.java", "diffHunk": "@@ -312,9 +312,17 @@ private void setServersInPoolTo(Set<InetSocketAddress> desiredServers) {\n             cassandra.refreshTokenRangesAndGetServers();\n         }\n \n-        log.debug(\"Cassandra pool refresh added hosts {}, removed hosts {}.\",\n-                SafeArg.of(\"serversToAdd\", CassandraLogHelper.collectionOfHosts(serversToAdd)),\n-                SafeArg.of(\"serversToRemove\", CassandraLogHelper.collectionOfHosts(serversToRemove)));\n+        logRefreshedHosts(serversToAdd, serversToRemove);\n+    }\n+\n+    private void logRefreshedHosts(Set<InetSocketAddress> serversToAdd, Set<InetSocketAddress> serversToRemove) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c0017822bb986b0312a20839519b7189dedc7e97"}, "originalPosition": 10}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "d20c26f212c08414236f25b165b11fb6624c761f", "author": {"user": {"login": "Jolyon-S", "name": "Jolyon"}}, "url": "https://github.com/palantir/atlasdb/commit/d20c26f212c08414236f25b165b11fb6624c761f", "committedDate": "2020-07-27T14:21:11Z", "message": "make method static"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2758, "cost": 1, "resetAt": "2021-11-01T16:19:10Z"}}}