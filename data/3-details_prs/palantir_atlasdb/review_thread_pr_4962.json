{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDcyNTMyNDc3", "number": 4962, "reviewThreads": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yNFQxNjowNzo0MVrOEbpBTQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yNVQwOToyODoyNVrOEb_CIA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjk3NDE5MDg1OnYy", "diffSide": "RIGHT", "path": "atlasdb-impl-shared/src/main/java/com/palantir/atlasdb/keyvalue/api/watch/ResilientLockWatchEventCache.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yNFQxNjowNzo0MVrOHFsC-w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yNVQwODo1MjowM1rOHGONwQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NTcyNjU4Nw==", "bodyText": "are you sure you want equals here and not ==?", "url": "https://github.com/palantir/atlasdb/pull/4962#discussion_r475726587", "createdAt": "2020-08-24T16:07:41Z", "author": {"login": "jeremyk-91"}, "path": "atlasdb-impl-shared/src/main/java/com/palantir/atlasdb/keyvalue/api/watch/ResilientLockWatchEventCache.java", "diffHunk": "@@ -74,11 +74,15 @@ synchronized RuntimeException handleException(InvocationTargetException rethrow)\n         } catch (TransactionLockWatchFailedException e) {\n             throw e;\n         } catch (Throwable t) {\n-            log.warn(\"Unexpected failure occurred when trying to use the default cache. Switching to the fallback \"\n-                    + \"implementation\", t);\n-            fallbackCacheSelectedCounter.inc();\n-            delegate = fallbackCache;\n-            throw new TransactionLockWatchFailedException(\"Unexpected failure in the lock watch cache\", t);\n+            if (delegate.equals(fallbackCache)) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "818185eeb68b6cb2cbf07d72ba22d932fec8817b"}, "originalPosition": 9}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NjI4NjQwMQ==", "bodyText": "yeah, good catch. equals here would mean we never bother actually falling back, but we probably want to do that even if this was configured with the same (but not same in memory) for each for some reason", "url": "https://github.com/palantir/atlasdb/pull/4962#discussion_r476286401", "createdAt": "2020-08-25T08:52:03Z", "author": {"login": "Jolyon-S"}, "path": "atlasdb-impl-shared/src/main/java/com/palantir/atlasdb/keyvalue/api/watch/ResilientLockWatchEventCache.java", "diffHunk": "@@ -74,11 +74,15 @@ synchronized RuntimeException handleException(InvocationTargetException rethrow)\n         } catch (TransactionLockWatchFailedException e) {\n             throw e;\n         } catch (Throwable t) {\n-            log.warn(\"Unexpected failure occurred when trying to use the default cache. Switching to the fallback \"\n-                    + \"implementation\", t);\n-            fallbackCacheSelectedCounter.inc();\n-            delegate = fallbackCache;\n-            throw new TransactionLockWatchFailedException(\"Unexpected failure in the lock watch cache\", t);\n+            if (delegate.equals(fallbackCache)) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NTcyNjU4Nw=="}, "originalCommit": {"oid": "818185eeb68b6cb2cbf07d72ba22d932fec8817b"}, "originalPosition": 9}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjk3Nzc5NzQ0OnYy", "diffSide": "RIGHT", "path": "atlasdb-impl-shared/src/main/java/com/palantir/atlasdb/keyvalue/api/watch/ResilientLockWatchEventCache.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yNVQwOToyODoyNVrOHGPs_Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yNVQwOToyODoyNVrOHGPs_Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NjMxMDc4MQ==", "bodyText": "Should've been SafeRuntimeException", "url": "https://github.com/palantir/atlasdb/pull/4962#discussion_r476310781", "createdAt": "2020-08-25T09:28:25Z", "author": {"login": "jkozlowski"}, "path": "atlasdb-impl-shared/src/main/java/com/palantir/atlasdb/keyvalue/api/watch/ResilientLockWatchEventCache.java", "diffHunk": "@@ -74,11 +74,15 @@ synchronized RuntimeException handleException(InvocationTargetException rethrow)\n         } catch (TransactionLockWatchFailedException e) {\n             throw e;\n         } catch (Throwable t) {\n-            log.warn(\"Unexpected failure occurred when trying to use the default cache. Switching to the fallback \"\n-                    + \"implementation\", t);\n-            fallbackCacheSelectedCounter.inc();\n-            delegate = fallbackCache;\n-            throw new TransactionLockWatchFailedException(\"Unexpected failure in the lock watch cache\", t);\n+            if (delegate == fallbackCache) {\n+                throw new RuntimeException(t);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "35c42c1b700cc4881e45ef8c27aac79f51e91825"}, "originalPosition": 10}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2542, "cost": 1, "resetAt": "2021-11-12T12:57:47Z"}}}