{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0MzczNjEzMDcw", "number": 4561, "title": "[Conjure Java Runtime] Part 26: Story of Thanatosis (Removing AtlasDB-Feign Entirely)", "bodyText": "Goals (and why):\n\nRemove the atlasdb-feign project from the codebase.\nGenerally leave people fewer complications to think about in the remoting stack (e.g. James thought that we could still fallback when beginning to write the Conjure migration). I thought I'd give a 1 hour stab at this, and it looks like it wasn't as hard as I thought.\n\nImplementation Description (bullets):\n\nRemove atlasdb-feign, fix compile and checkstyle issues that arise from that.\n\nTesting (What was existing testing like?  What have you done to improve it?):\n\nExisting tests still pass.\nThe code compiling serves as verification that it isn't referenced any more.\n\nConcerns (what feedback would you like?):\n\nI wanted to eliminate RemotingClientConfig as well, but wasn't too happy with the API break/mess there.\nShould the experiment running proxy code be retained?\nThere are a few trouble spots:\n\nLeader block mechanism to elide remote calls in a 1 node cluster used Feign but have now been switched to CJR. I've updated the failure mechanism to match, but is this correct?\nBenchmarking infrastructure had some fancy magic with FeignOkHttpClients, which of course isn't used in CJR. Does this still work?\n\n\nAre there some edge cases that I've missed out?\n\nWhere should we start reviewing?: Top down, looking at places which are actually +/- as opposed to just - is probably a good approach.\nPriority (whenever / two weeks / yesterday): Whenever", "createdAt": "2020-02-11T11:44:37Z", "url": "https://github.com/palantir/atlasdb/pull/4561", "merged": true, "mergeCommit": {"oid": "5fa91177e3b5178d901a02295e0ac81181d482d0"}, "closed": true, "closedAt": "2020-03-10T19:07:45Z", "author": {"login": "jeremyk-91"}, "timelineItems": {"totalCount": 21, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcDQeJiAFqTM1NjYwMDQ3MQ==", "endCursor": "Y3Vyc29yOnYyOpPPAAABcMWteEgH2gAyMzczNjEzMDcwOjE0NTRlOTM1ZGM0Y2FlYWQzM2U4MjFlNWE2YTI5NGRlZDVlYjA0YTg=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzU2NjAwNDcx", "url": "https://github.com/palantir/atlasdb/pull/4561#pullrequestreview-356600471", "createdAt": "2020-02-11T11:59:15Z", "commit": {"oid": "466b1ab9f8afd17bdb73fde812265b967867d112"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xMVQxMTo1OToxNVrOFoGXhg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xMVQxMTo1OToxNVrOFoGXhg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NzU5MTY4Ng==", "bodyText": "I haven't read the PR, but we need to make sure we don't miss the code in ExperimentRunningProxy:\nthis.refreshingExperimentalServiceSupplier = Suppliers.memoizeWithExpiration(\n                experimentalServiceSupplier::get, CLIENT_REFRESH_INTERVAL.toMinutes(), TimeUnit.MINUTES);  \n\nWithout this we loose the 30 minute client reload thing, meaning we'll get the lockups back again.", "url": "https://github.com/palantir/atlasdb/pull/4561#discussion_r377591686", "createdAt": "2020-02-11T11:59:15Z", "author": {"login": "jkozlowski"}, "path": "atlasdb-config/src/main/java/com/palantir/atlasdb/http/AtlasDbHttpClients.java", "diffHunk": "@@ -56,54 +51,24 @@ private AtlasDbHttpClients() {\n             ServerListConfig serverListConfig,\n             Class<T> type,\n             AuxiliaryRemotingParameters parameters) {\n-        return createExperimentallyWithFallback(\n-                metricsManager,\n-                () -> ConjureJavaRuntimeTargetFactory.DEFAULT.createProxyWithFailover(\n-                        serverListConfig, type, parameters),\n-                () -> AtlasDbFeignTargetFactory.DEFAULT.createProxyWithFailover(serverListConfig, type, parameters),\n-                type,\n-                parameters);\n+        return VersionSelectingClients.instrumentWithClientVersionTag(", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "466b1ab9f8afd17bdb73fde812265b967867d112"}, "originalPosition": 31}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzU5NzkxNzg0", "url": "https://github.com/palantir/atlasdb/pull/4561#pullrequestreview-359791784", "createdAt": "2020-02-17T14:54:28Z", "commit": {"oid": "efdf886718386734b8f873aeabe8f9a5059ff960"}, "state": "COMMENTED", "comments": {"totalCount": 6, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xN1QxNDo1NDoyOVrOFqnMHw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xN1QxNToxMDoyMVrOFqnu4g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MDIyNjU5MQ==", "bodyText": "can we remove VersionSelectingClients? I don't think it's relevant anymore.", "url": "https://github.com/palantir/atlasdb/pull/4561#discussion_r380226591", "createdAt": "2020-02-17T14:54:29Z", "author": {"login": "felixdesouza"}, "path": "atlasdb-config/src/main/java/com/palantir/atlasdb/http/AtlasDbHttpClients.java", "diffHunk": "@@ -56,54 +55,26 @@ private AtlasDbHttpClients() {\n             ServerListConfig serverListConfig,\n             Class<T> type,\n             AuxiliaryRemotingParameters parameters) {\n-        return createExperimentallyWithFallback(\n-                metricsManager,\n-                () -> ConjureJavaRuntimeTargetFactory.DEFAULT.createProxyWithFailover(\n-                        serverListConfig, type, parameters),\n-                () -> AtlasDbFeignTargetFactory.DEFAULT.createProxyWithFailover(serverListConfig, type, parameters),\n-                type,\n-                parameters);\n+        Supplier<T> clientFactory = () -> VersionSelectingClients.instrumentWithClientVersionTag(", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "efdf886718386734b8f873aeabe8f9a5059ff960"}, "originalPosition": 44}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MDIyNjkyMg==", "bodyText": "Nice, in my hack branch, I have the same thing, although a bit condensed, it's just the Suppliers.memoizeWithExpiration piece etc.", "url": "https://github.com/palantir/atlasdb/pull/4561#discussion_r380226922", "createdAt": "2020-02-17T14:54:59Z", "author": {"login": "felixdesouza"}, "path": "atlasdb-commons/src/main/java/com/palantir/common/proxy/SelfRefreshingProxy.java", "diffHunk": "@@ -0,0 +1,67 @@\n+/*\n+ * (c) Copyright 2020 Palantir Technologies Inc. All rights reserved.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package com.palantir.common.proxy;\n+\n+import java.lang.reflect.InvocationTargetException;\n+import java.lang.reflect.Method;\n+import java.lang.reflect.Proxy;\n+import java.time.Duration;\n+import java.util.concurrent.TimeUnit;\n+import java.util.function.Supplier;\n+\n+import com.google.common.annotations.VisibleForTesting;\n+import com.google.common.base.Suppliers;\n+import com.google.common.reflect.AbstractInvocationHandler;\n+\n+/**\n+ * Proxy that creates a new underlying instance on the first request after a specified amount of time has elapsed on\n+ * the existing instance. Once the refresh interval has expired, a new instance is not guaranteed to be created until\n+ * a method is invoked on the proxy.\n+ */\n+public class SelfRefreshingProxy<T> extends AbstractInvocationHandler {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "efdf886718386734b8f873aeabe8f9a5059ff960"}, "originalPosition": 35}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MDIyNzgwNw==", "bodyText": "can you go into a bit more detail as to why it has to be done this way?", "url": "https://github.com/palantir/atlasdb/pull/4561#discussion_r380227807", "createdAt": "2020-02-17T14:56:28Z", "author": {"login": "felixdesouza"}, "path": "atlasdb-config/src/main/java/com/palantir/atlasdb/factory/TransactionManagers.java", "diffHunk": "@@ -1087,11 +1093,14 @@ private static LockAndTimestampServices createRawLeaderServices(\n                     } catch (ClientErrorException e) {\n                         useLocalServicesFuture.complete(false);\n                         return;\n-                    } catch (Throwable e) {\n-                        if (--logAfter == 0) {\n-                            log.warn(\"Failed to read remote timestamp server ID\", e);\n-                            logAfter = LOGGING_INTERVAL;\n+                    } catch (UnknownRemoteException e) {\n+                        if (400 <= e.getStatus() && e.getStatus() <= 499) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "efdf886718386734b8f873aeabe8f9a5059ff960"}, "originalPosition": 52}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MDIyODc5MA==", "bodyText": "I don't think this is true? still feels like you can have something that gets deserialised into a RemotingClientConfig no?", "url": "https://github.com/palantir/atlasdb/pull/4561#discussion_r380228790", "createdAt": "2020-02-17T14:58:14Z", "author": {"login": "felixdesouza"}, "path": "atlasdb-remoting-api/src/main/java/com/palantir/atlasdb/config/AuxiliaryRemotingParameters.java", "diffHunk": "@@ -48,7 +48,11 @@ default boolean shouldSupportBlockingOperations() {\n         return true;\n     }\n \n+    /**\n+     * @deprecated Conjure is now always used, and supplying alternative configs is not possible.", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "efdf886718386734b8f873aeabe8f9a5059ff960"}, "originalPosition": 5}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MDIyOTA5NQ==", "bodyText": "??", "url": "https://github.com/palantir/atlasdb/pull/4561#discussion_r380229095", "createdAt": "2020-02-17T14:58:44Z", "author": {"login": "felixdesouza"}, "path": "timelock-agent/src/test/java/com/palantir/timelock/paxos/LeaderPingHealthCheckTest.java", "diffHunk": "@@ -188,7 +187,7 @@ private static HealthCheckPinger getMockOfPingableLeaderWherePingReturns(Set<Cli\n \n     private static HealthCheckPinger getMockOfPingableLeaderWherePingThrows() {\n         HealthCheckPinger mockLeader = mock(HealthCheckPinger.class);\n-        when(mockLeader.apply(ALL_CLIENTS)).thenThrow(mock(AtlasDbRemoteException.class));\n+        when(mockLeader.apply(ALL_CLIENTS)).thenThrow(mock(IllegalStateException.class));", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "efdf886718386734b8f873aeabe8f9a5059ff960"}, "originalPosition": 13}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MDIzNTQ5MA==", "bodyText": "I think we should go through and purge the config stuff properly. Deprecations don't really do anything if we never remove them.\nI also don't think we want to deprecate this anyway. Since if we do need to open up other configurations i.e. if we want to add some configurability for our own testing purposes, this is the right place to do it.\nStarting from the config RemotingClientConfig, we can delete the two properties, and if we're super concerned we can do what we did in AtlasDbConfig, where as a class level annotation, we do @JsonIgnoreProperties({\"maximumConjureRemotingProbability\", \"enableLegacyClientFallback\"} and then we delete those properties.\nWe should probably add a RemotingClientConfigs.DEFAULT configuration, and then have the old thing RemotingClientConfigs.ALWAYS_USE_CONJURE refer to that, and change all of our references to that.\nThen we can propagate the deletion of the java properties everywhere (i.e. and continue to get rid of VersionSelectingClients.", "url": "https://github.com/palantir/atlasdb/pull/4561#discussion_r380235490", "createdAt": "2020-02-17T15:10:21Z", "author": {"login": "felixdesouza"}, "path": "atlasdb-remoting-api/src/main/java/com/palantir/atlasdb/config/AuxiliaryRemotingParameters.java", "diffHunk": "@@ -48,7 +48,11 @@ default boolean shouldSupportBlockingOperations() {\n         return true;\n     }\n \n+    /**\n+     * @deprecated Conjure is now always used, and supplying alternative configs is not possible.", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MDIyODc5MA=="}, "originalCommit": {"oid": "efdf886718386734b8f873aeabe8f9a5059ff960"}, "originalPosition": 5}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a5dca24451bf4cebb8936c10dd161af5f00e4068", "author": {"user": {"login": "jeremyk-91", "name": "Jeremy Kong"}}, "url": "https://github.com/palantir/atlasdb/commit/a5dca24451bf4cebb8936c10dd161af5f00e4068", "committedDate": "2020-02-24T18:40:35Z", "message": "Remove atlasdb-feign"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a43266d0b5d33fb1d432a89d0cd2b1b19686211b", "author": {"user": {"login": "jeremyk-91", "name": "Jeremy Kong"}}, "url": "https://github.com/palantir/atlasdb/commit/a43266d0b5d33fb1d432a89d0cd2b1b19686211b", "committedDate": "2020-02-24T18:40:35Z", "message": "Some fixes"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "3e65089b73b911f11449ff8858f2fb452ba0c480", "author": {"user": {"login": "jeremyk-91", "name": "Jeremy Kong"}}, "url": "https://github.com/palantir/atlasdb/commit/3e65089b73b911f11449ff8858f2fb452ba0c480", "committedDate": "2020-02-24T18:40:35Z", "message": "Fix accidental compile break"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "8e45df7ebd01fe56861bbdaec81617f9b87fc9c2", "author": {"user": {"login": "jeremyk-91", "name": "Jeremy Kong"}}, "url": "https://github.com/palantir/atlasdb/commit/8e45df7ebd01fe56861bbdaec81617f9b87fc9c2", "committedDate": "2020-02-24T18:40:35Z", "message": "Fix the build"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "360fa74b19a8ad28aca6ed685fb1655919773b67", "author": {"user": {"login": "jeremyk-91", "name": "Jeremy Kong"}}, "url": "https://github.com/palantir/atlasdb/commit/360fa74b19a8ad28aca6ed685fb1655919773b67", "committedDate": "2020-02-24T18:40:35Z", "message": "Fix broken tests"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b7d5a027d5516840f58ee21f93f50dcc8d049cb4", "author": {"user": {"login": "jeremyk-91", "name": "Jeremy Kong"}}, "url": "https://github.com/palantir/atlasdb/commit/b7d5a027d5516840f58ee21f93f50dcc8d049cb4", "committedDate": "2020-02-24T18:40:35Z", "message": "Baseline"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "cce2b36dbb31acae6314c3c4ed55194a3e71f87f", "author": {"user": {"login": "jeremyk-91", "name": "Jeremy Kong"}}, "url": "https://github.com/palantir/atlasdb/commit/cce2b36dbb31acae6314c3c4ed55194a3e71f87f", "committedDate": "2020-02-24T18:40:35Z", "message": "Add generated changelog entries"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "87308547a8c6b4869bde35827fe431035bddb64f", "author": {"user": {"login": "jeremyk-91", "name": "Jeremy Kong"}}, "url": "https://github.com/palantir/atlasdb/commit/87308547a8c6b4869bde35827fe431035bddb64f", "committedDate": "2020-02-24T18:40:35Z", "message": "Replacement for Exp Running Proxy"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "4cc4efc63da5fe59cd2a6afa7ce1863320f68b37", "author": {"user": {"login": "jeremyk-91", "name": "Jeremy Kong"}}, "url": "https://github.com/palantir/atlasdb/commit/4cc4efc63da5fe59cd2a6afa7ce1863320f68b37", "committedDate": "2020-02-24T18:40:35Z", "message": "Unwrap ITEs"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "16e4e84123197ba2f511be44de3f5b4d4ee0710f", "author": {"user": {"login": "jeremyk-91", "name": "Jeremy Kong"}}, "url": "https://github.com/palantir/atlasdb/commit/16e4e84123197ba2f511be44de3f5b4d4ee0710f", "committedDate": "2020-02-24T18:40:35Z", "message": "bla"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "efdf886718386734b8f873aeabe8f9a5059ff960", "author": {"user": {"login": "jeremyk-91", "name": "Jeremy Kong"}}, "url": "https://github.com/palantir/atlasdb/commit/efdf886718386734b8f873aeabe8f9a5059ff960", "committedDate": "2020-02-11T18:06:25Z", "message": "bla"}, "afterCommit": {"oid": "16e4e84123197ba2f511be44de3f5b4d4ee0710f", "author": {"user": {"login": "jeremyk-91", "name": "Jeremy Kong"}}, "url": "https://github.com/palantir/atlasdb/commit/16e4e84123197ba2f511be44de3f5b4d4ee0710f", "committedDate": "2020-02-24T18:40:35Z", "message": "bla"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "af136ef5a8a446fcacf24a1b4721d8a313ca65f7", "author": {"user": {"login": "jeremyk-91", "name": "Jeremy Kong"}}, "url": "https://github.com/palantir/atlasdb/commit/af136ef5a8a446fcacf24a1b4721d8a313ca65f7", "committedDate": "2020-02-24T19:15:12Z", "message": "CR: simple changes"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzYzNjExNzU3", "url": "https://github.com/palantir/atlasdb/pull/4561#pullrequestreview-363611757", "createdAt": "2020-02-24T18:40:08Z", "commit": {"oid": "efdf886718386734b8f873aeabe8f9a5059ff960"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yNFQxODo0MDowOFrOFtreZg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yNFQxODo0MDowOFrOFtreZg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MzQ0MjUzNA==", "bodyText": "Sure, added a comment. Basically it looks like the treatment of an unmapped 4xx has changed: this was a ClientErrorException in the Feign world, but looks like that has been changed to be a UnknownRemoteException in the CJR world.", "url": "https://github.com/palantir/atlasdb/pull/4561#discussion_r383442534", "createdAt": "2020-02-24T18:40:08Z", "author": {"login": "jeremyk-91"}, "path": "atlasdb-config/src/main/java/com/palantir/atlasdb/factory/TransactionManagers.java", "diffHunk": "@@ -1087,11 +1093,14 @@ private static LockAndTimestampServices createRawLeaderServices(\n                     } catch (ClientErrorException e) {\n                         useLocalServicesFuture.complete(false);\n                         return;\n-                    } catch (Throwable e) {\n-                        if (--logAfter == 0) {\n-                            log.warn(\"Failed to read remote timestamp server ID\", e);\n-                            logAfter = LOGGING_INTERVAL;\n+                    } catch (UnknownRemoteException e) {\n+                        if (400 <= e.getStatus() && e.getStatus() <= 499) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MDIyNzgwNw=="}, "originalCommit": {"oid": "efdf886718386734b8f873aeabe8f9a5059ff960"}, "originalPosition": 52}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a15bb06a3350999faa9c4c30059dbbba3ecfd3df", "author": {"user": {"login": "jeremyk-91", "name": "Jeremy Kong"}}, "url": "https://github.com/palantir/atlasdb/commit/a15bb06a3350999faa9c4c30059dbbba3ecfd3df", "committedDate": "2020-03-10T17:09:45Z", "message": "Remove config options"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "0150b62dd7016c19322cbdf10b812bf650129213", "author": {"user": {"login": "jeremyk-91", "name": "Jeremy Kong"}}, "url": "https://github.com/palantir/atlasdb/commit/0150b62dd7016c19322cbdf10b812bf650129213", "committedDate": "2020-03-10T17:14:02Z", "message": "Update RCC"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzcyMTYyMzk2", "url": "https://github.com/palantir/atlasdb/pull/4561#pullrequestreview-372162396", "createdAt": "2020-03-10T17:19:25Z", "commit": {"oid": "a15bb06a3350999faa9c4c30059dbbba3ecfd3df"}, "state": "APPROVED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xMFQxNzoxOToyNVrOF0ZDEQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xMFQxNzoyMToxMVrOF0ZHjg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MDQ4MDY1Nw==", "bodyText": "iirc, instrumentation has always been separate from creating clients. i.e. ServiceCreator and in timelock (before and after my changes). Unless they're all changed, we're going to double report, and likely we'll have wrong metrics on our dashboards.", "url": "https://github.com/palantir/atlasdb/pull/4561#discussion_r390480657", "createdAt": "2020-03-10T17:19:25Z", "author": {"login": "felixdesouza"}, "path": "atlasdb-config/src/main/java/com/palantir/atlasdb/http/AtlasDbHttpClients.java", "diffHunk": "@@ -83,11 +87,23 @@ private AtlasDbHttpClients() {\n             ServerListConfig serverListConfig,\n             Class<T> type,\n             AuxiliaryRemotingParameters parameters) {\n-        Supplier<T> clientFactory = () -> VersionSelectingClients.instrumentWithClientVersionTag(\n+        Supplier<T> clientFactory = () -> instrument(\n                 metricsManager.getTaggedRegistry(),\n                 ConjureJavaRuntimeTargetFactory.DEFAULT.createProxyWithQuickFailoverForTesting(\n                         serverListConfig, type, parameters),\n                 type);\n         return SelfRefreshingProxy.create(clientFactory, type);\n     }\n+\n+    private static <T> T instrument(", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "a15bb06a3350999faa9c4c30059dbbba3ecfd3df"}, "originalPosition": 49}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MDQ4MTgwNg==", "bodyText": "note to self/you: you'll have to change the places where this is referred to explicitly namely big internal product and it's related projects.", "url": "https://github.com/palantir/atlasdb/pull/4561#discussion_r390481806", "createdAt": "2020-03-10T17:21:11Z", "author": {"login": "felixdesouza"}, "path": "atlasdb-remoting-api/src/main/java/com/palantir/atlasdb/config/RemotingClientConfigs.java", "diffHunk": "@@ -21,8 +21,5 @@ private RemotingClientConfigs() {\n         // Constants\n     }\n \n-    public static final RemotingClientConfig ALWAYS_USE_CONJURE = ImmutableRemotingClientConfig.builder()", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "a15bb06a3350999faa9c4c30059dbbba3ecfd3df"}, "originalPosition": 4}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "0e0e951887f161c87582b81f1d0f298420f966e2", "author": {"user": {"login": "jeremyk-91", "name": "Jeremy Kong"}}, "url": "https://github.com/palantir/atlasdb/commit/0e0e951887f161c87582b81f1d0f298420f966e2", "committedDate": "2020-03-10T17:52:16Z", "message": "kein tags"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a9fe2103e512a7e99bcc01f7fa5ccf18ae821333", "author": {"user": {"login": "jeremyk-91", "name": "Jeremy Kong"}}, "url": "https://github.com/palantir/atlasdb/commit/a9fe2103e512a7e99bcc01f7fa5ccf18ae821333", "committedDate": "2020-03-10T18:09:41Z", "message": "Merge branch 'develop' into jkong/cjr-burn"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "1454e935dc4caead33e821e5a6a294ded5eb04a8", "author": {"user": {"login": "jeremyk-91", "name": "Jeremy Kong"}}, "url": "https://github.com/palantir/atlasdb/commit/1454e935dc4caead33e821e5a6a294ded5eb04a8", "committedDate": "2020-03-10T18:20:45Z", "message": "Optimize imports"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2249, "cost": 1, "resetAt": "2021-11-01T16:19:10Z"}}}