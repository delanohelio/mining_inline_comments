{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDE4MjA0MzUw", "number": 4778, "title": "[Dialogue] Part 6: Road to Multitenancy", "bodyText": "Goals (and why):\n\nAllow users to pass in a DialogueClients.ReloadingFactory for Atlas to use\n\nImplementation Description (bullets):\n\nIf a ReloadingFactory is configured, use it, otherwise create an Atlas-internal one.\n\nTesting (What was existing testing like?  What have you done to improve it?):\n\nAdded new tests around multiple users of a single underlying factory, both with the same and different TimeLocks.\n\nConcerns (what feedback would you like?):\n\nI'm not entirely happy with introducing a Dialogue class to AtlasDbConfig, but alternatives like allowing users to supply an AtlasDbDialogueServiceProvider also seemed awful - and if you're using atlasdb-config you will have Dialogue-using things on your classpath anyway.\n\nWhere should we start reviewing?: AtlasDbConfig.java\nPriority (whenever / two weeks / yesterday): this week", "createdAt": "2020-05-14T19:33:04Z", "url": "https://github.com/palantir/atlasdb/pull/4778", "merged": true, "mergeCommit": {"oid": "e3c27c5054ea8cc0cecf3d71c34047460a4e1090"}, "closed": true, "closedAt": "2020-05-18T08:02:47Z", "author": {"login": "jeremyk-91"}, "timelineItems": {"totalCount": 19, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABchQyCTgH2gAyNDE4MjA0MzUwOjI4NDYxNmY0Yjc2YTMxMzMyYzJjNTE3NTNkZTg3YTVhYjJmOTI0MGY=", "endCursor": "Y3Vyc29yOnYyOpPPAAABciazXwgH2gAyNDE4MjA0MzUwOjk5ODY5MmUwMjUyZWU2NWUwMThhYzM0OTliNmQyMGYxZDliYmZlYTI=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "284616f4b76a31332c2c51753de87a5ab2f9240f", "author": {"user": {"login": "jeremyk-91", "name": "Jeremy Kong"}}, "url": "https://github.com/palantir/atlasdb/commit/284616f4b76a31332c2c51753de87a5ab2f9240f", "committedDate": "2020-05-14T17:18:43Z", "message": "Wiring through TMs"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a66dc04020f5c3e4071241f572e82b74b3dbf7bd", "author": {"user": {"login": "jeremyk-91", "name": "Jeremy Kong"}}, "url": "https://github.com/palantir/atlasdb/commit/a66dc04020f5c3e4071241f572e82b74b3dbf7bd", "committedDate": "2020-05-14T19:00:42Z", "message": "Finish off"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "cd590a9e88368910913454955a6784b00b4c197f", "author": {"user": {"login": "jeremyk-91", "name": "Jeremy Kong"}}, "url": "https://github.com/palantir/atlasdb/commit/cd590a9e88368910913454955a6784b00b4c197f", "committedDate": "2020-05-14T19:03:22Z", "message": ":hocho"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "4e04ae0da49018f658eedbc8536b6aa205739a7f", "author": {"user": {"login": "jeremyk-91", "name": "Jeremy Kong"}}, "url": "https://github.com/palantir/atlasdb/commit/4e04ae0da49018f658eedbc8536b6aa205739a7f", "committedDate": "2020-05-14T19:10:14Z", "message": "Fix console"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "0782fbbe1f8f9d0065d24cbd4983432f53392335", "author": {"user": {"login": "jeremyk-91", "name": "Jeremy Kong"}}, "url": "https://github.com/palantir/atlasdb/commit/0782fbbe1f8f9d0065d24cbd4983432f53392335", "committedDate": "2020-05-14T19:46:14Z", "message": "bleh"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f44df3d5c6be770064324fc38439673c5b251aa8", "author": {"user": {"login": "jeremyk-91", "name": "Jeremy Kong"}}, "url": "https://github.com/palantir/atlasdb/commit/f44df3d5c6be770064324fc38439673c5b251aa8", "committedDate": "2020-05-14T19:46:14Z", "message": "Add generated changelog entries"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "d4eefbdecf2505f3f5513fa2fbd1d112fa16f9d6", "author": {"user": {"login": "jeremyk-91", "name": "Jeremy Kong"}}, "url": "https://github.com/palantir/atlasdb/commit/d4eefbdecf2505f3f5513fa2fbd1d112fa16f9d6", "committedDate": "2020-05-14T19:46:14Z", "message": "Add generated changelog entries"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b82607b3fb68536fff223b3268eb0373387351ac", "author": {"user": {"login": "jeremyk-91", "name": "Jeremy Kong"}}, "url": "https://github.com/palantir/atlasdb/commit/b82607b3fb68536fff223b3268eb0373387351ac", "committedDate": "2020-05-14T19:46:14Z", "message": "Add generated changelog entries"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDEyNDQ2OTgy", "url": "https://github.com/palantir/atlasdb/pull/4778#pullrequestreview-412446982", "createdAt": "2020-05-15T08:27:25Z", "commit": {"oid": "d4eefbdecf2505f3f5513fa2fbd1d112fa16f9d6"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xNVQwODoyNzoyNVrOGV7Xlw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xNVQwODoyNzoyNVrOGV7Xlw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNTY0NTk3NQ==", "bodyText": "AtlasDbConfig is the wrong place, this should really be in TransactionManagers (and mark the method as 'deprecated').", "url": "https://github.com/palantir/atlasdb/pull/4778#discussion_r425645975", "createdAt": "2020-05-15T08:27:25Z", "author": {"login": "j-baker"}, "path": "atlasdb-config/src/main/java/com/palantir/atlasdb/config/AtlasDbConfig.java", "diffHunk": "@@ -271,6 +272,16 @@ public int getDefaultLockTimeoutSeconds() {\n      */\n     public abstract Optional<TimestampCache> timestampCache();\n \n+    /**\n+     * If set, a {@link com.palantir.dialogue.clients.DialogueClients.ReloadingFactory} that a\n+     * {@link com.palantir.atlasdb.transaction.api.TransactionManager} based on this configuration should use.\n+     * This may be useful for ensuring that connection pools are shared between multitenant services, for instance.\n+     *\n+     * WARNING: Providing reloading factories to multiple distinct TimeLock servers may result in undefined\n+     * behaviour.\n+     */\n+    public abstract Optional<DialogueClients.ReloadingFactory> reloadingFactory();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d4eefbdecf2505f3f5513fa2fbd1d112fa16f9d6"}, "originalPosition": 20}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDEyNDQ4NjE2", "url": "https://github.com/palantir/atlasdb/pull/4778#pullrequestreview-412448616", "createdAt": "2020-05-15T08:29:36Z", "commit": {"oid": "d4eefbdecf2505f3f5513fa2fbd1d112fa16f9d6"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xNVQwODoyOTozNlrOGV7chg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xNVQwODoyOTozNlrOGV7chg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNTY0NzIzOA==", "bodyText": "Please don't use 'multitenant' in this context, the noun is already 'taken' so it's likely to be confusing.", "url": "https://github.com/palantir/atlasdb/pull/4778#discussion_r425647238", "createdAt": "2020-05-15T08:29:36Z", "author": {"login": "j-baker"}, "path": "changelog/@unreleased/pr-4778.v2.yml", "diffHunk": "@@ -0,0 +1,8 @@\n+type: improvement\n+improvement:\n+  description: AtlasDB now allows users to pass in a `DialogueClients.ReloadingFactory`\n+    in install configuration. This is likely to be useful for multitenant users of", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d4eefbdecf2505f3f5513fa2fbd1d112fa16f9d6"}, "originalPosition": 4}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a632169ff0d68750784e7ca31f6484a717d4c59a", "author": {"user": {"login": "jeremyk-91", "name": "Jeremy Kong"}}, "url": "https://github.com/palantir/atlasdb/commit/a632169ff0d68750784e7ca31f6484a717d4c59a", "committedDate": "2020-05-15T11:22:11Z", "message": "shift config block to TMs"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "bfb9325fd66a9a7dda6784d25989c1da8966c610", "author": {"user": {"login": "jeremyk-91", "name": "Jeremy Kong"}}, "url": "https://github.com/palantir/atlasdb/commit/bfb9325fd66a9a7dda6784d25989c1da8966c610", "committedDate": "2020-05-15T11:22:45Z", "message": "Merge branch 'jkong/path-to-multitenancy' of github.com:palantir/atlasdb into jkong/path-to-multitenancy"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "7579f60a4f990e4fd97fb187a9773dec6f66dcb0", "author": {"user": {"login": "jeremyk-91", "name": "Jeremy Kong"}}, "url": "https://github.com/palantir/atlasdb/commit/7579f60a4f990e4fd97fb187a9773dec6f66dcb0", "committedDate": "2020-05-15T11:33:51Z", "message": "Merge branch 'develop' into jkong/path-to-multitenancy"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "8601feda5b0579618a539f9cea5f167abf982a51", "author": {"user": {"login": "jeremyk-91", "name": "Jeremy Kong"}}, "url": "https://github.com/palantir/atlasdb/commit/8601feda5b0579618a539f9cea5f167abf982a51", "committedDate": "2020-05-15T11:37:59Z", "message": "unused crap"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f42b0f0228654a082b88cde6c9a2a2d9803b2615", "author": {"user": {"login": "jeremyk-91", "name": "Jeremy Kong"}}, "url": "https://github.com/palantir/atlasdb/commit/f42b0f0228654a082b88cde6c9a2a2d9803b2615", "committedDate": "2020-05-15T12:32:39Z", "message": "More unused things"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "d0cff2472ba00b2cc6c10331e97c720ea0783e6a", "author": {"user": {"login": "jeremyk-91", "name": "Jeremy Kong"}}, "url": "https://github.com/palantir/atlasdb/commit/d0cff2472ba00b2cc6c10331e97c720ea0783e6a", "committedDate": "2020-05-15T12:32:39Z", "message": "Add generated changelog entries"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "4fd92f0ce7894ca413a24357fbfd14f4a07a5677", "author": {"user": {"login": "jeremyk-91", "name": "Jeremy Kong"}}, "url": "https://github.com/palantir/atlasdb/commit/4fd92f0ce7894ca413a24357fbfd14f4a07a5677", "committedDate": "2020-05-15T12:32:39Z", "message": "Add generated changelog entries"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDEyNjcxNTU1", "url": "https://github.com/palantir/atlasdb/pull/4778#pullrequestreview-412671555", "createdAt": "2020-05-15T13:56:08Z", "commit": {"oid": "f42b0f0228654a082b88cde6c9a2a2d9803b2615"}, "state": "APPROVED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xNVQxMzo1NjowOFrOGWF8Sg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xNVQxMzo1NjowOFrOGWF8Sg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNTgxOTIxMA==", "bodyText": "\ud83d\udd2a", "url": "https://github.com/palantir/atlasdb/pull/4778#discussion_r425819210", "createdAt": "2020-05-15T13:56:08Z", "author": {"login": "gmaretic"}, "path": "changelog/@unreleased/pr-4778.v2.yml", "diffHunk": "@@ -0,0 +1,8 @@\n+type: improvement\n+improvement:\n+  description: AtlasDB now allows users to pass in a `DialogueClients.ReloadingFactory`\n+    in install configuration. This is likely to be useful for AtlasDB-Proxy, which", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f42b0f0228654a082b88cde6c9a2a2d9803b2615"}, "originalPosition": 4}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "998692e0252ee65e018ac3499b6d20f1d9bbfea2", "author": {"user": {"login": "j-baker", "name": "James Baker"}}, "url": "https://github.com/palantir/atlasdb/commit/998692e0252ee65e018ac3499b6d20f1d9bbfea2", "committedDate": "2020-05-18T07:33:09Z", "message": "Update TransactionManagers.java"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2848, "cost": 1, "resetAt": "2021-11-01T16:19:10Z"}}}