{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDYzNjA3MjY2", "number": 4930, "title": "[PDS-129897] Fix Memory Leak in the Publication Controller", "bodyText": "Goals (and why):\n\nFix memory leak in TopNMetricPublicationController. Specifically, note that if you call ToplistDeltaFilteringTableLevelMetricsController#createAndRegisterCounter with the same metric data repeatedly, because we create a new CachedGauge and stick it in the TopNMetricPublicationController, that quickly becomes an unbounded set.\nI noticed that in profiles, a service that previously was able to reclaim about 2 GB of memory in a full collection gradually started reclaiming less and eventually started having ~300 MB STW GCs.\n\nImplementation Description (bullets):\n\nMemoize creations of the top-N counters in TableLevelMetricsController\n\nTesting (What was existing testing like?  What have you done to improve it?):\n\nAdded test for the memoized creator.\n\nConcerns (what feedback would you like?):\n\nIs there another leak I've missed?\n\nWhere should we start reviewing?: MemoizingTableLevelMetricsController\nPriority (whenever / two weeks / yesterday): Yesterday, but let's go for the easier fix first and do this one in business hours tomorrow", "createdAt": "2020-08-05T19:49:55Z", "url": "https://github.com/palantir/atlasdb/pull/4930", "merged": true, "mergeCommit": {"oid": "cbee8144023ff553a24a6ccc1144911d09474821"}, "closed": true, "closedAt": "2020-08-07T13:51:01Z", "author": {"login": "jeremyk-91"}, "timelineItems": {"totalCount": 12, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABc8AmbrgH2gAyNDYzNjA3MjY2Ojc1Yzg2YWZmZTA3MDBiYzM0ODk3NjI0ODczMDVlNzdhMjQ0ZTdhMDk=", "endCursor": "Y3Vyc29yOnYyOpPPAAABc8j1jzgH2gAyNDYzNjA3MjY2OmU3ZjYwMzhjNDU2MzZmOTRmM2ExODIwMmI4NGI1ODBmMjY0NTM5NmU=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "75c86affe0700bc3489762487305e77a244e7a09", "author": {"user": {"login": "jeremyk-91", "name": "Jeremy Kong"}}, "url": "https://github.com/palantir/atlasdb/commit/75c86affe0700bc3489762487305e77a244e7a09", "committedDate": "2020-08-05T19:43:31Z", "message": "fix memory leak"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDYxOTgxNzIz", "url": "https://github.com/palantir/atlasdb/pull/4930#pullrequestreview-461981723", "createdAt": "2020-08-05T20:01:32Z", "commit": {"oid": "75c86affe0700bc3489762487305e77a244e7a09"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0wNVQyMDowMTozMlrOG8Yl-Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0wNVQyMDowMTozMlrOG8Yl-Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NTk3MDY4MQ==", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            }\n          \n          \n            \n            }", "url": "https://github.com/palantir/atlasdb/pull/4930#discussion_r465970681", "createdAt": "2020-08-05T20:01:32Z", "author": {"login": "jeremyk-91"}, "path": "atlasdb-impl-shared/src/test/java/com/palantir/atlasdb/transaction/impl/metrics/MemoizingTableLevelMetricsControllerTest.java", "diffHunk": "@@ -0,0 +1,66 @@\n+/*\n+ * (c) Copyright 2020 Palantir Technologies Inc. All rights reserved.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package com.palantir.atlasdb.transaction.impl.metrics;\n+\n+import static org.assertj.core.api.Assertions.assertThat;\n+import static org.mockito.ArgumentMatchers.any;\n+import static org.mockito.ArgumentMatchers.anyString;\n+import static org.mockito.Mockito.mock;\n+import static org.mockito.Mockito.times;\n+import static org.mockito.Mockito.verify;\n+import static org.mockito.Mockito.when;\n+\n+import org.junit.Before;\n+import org.junit.Test;\n+\n+import com.codahale.metrics.Counter;\n+import com.palantir.atlasdb.keyvalue.api.TableReference;\n+\n+public class MemoizingTableLevelMetricsControllerTest {\n+    private static final String METRIC_NAME = \"name\";\n+    private static final Class<String> STRING_CLASS = String.class;\n+    private static final TableReference TABLE_REFERENCE = TableReference.createFromFullyQualifiedName(\"a.b\");\n+    private static final TableReference TABLE_REFERENCE_2 = TableReference.createFromFullyQualifiedName(\"a.bc\");\n+\n+    private final TableLevelMetricsController delegate = mock(TableLevelMetricsController.class);\n+\n+    @Before\n+    public void setUp() {\n+        when(delegate.createAndRegisterCounter(any(), anyString(), any())).thenAnswer(_invocation -> new Counter());\n+    }\n+\n+    @Test\n+    public void metricIsOnlyRegisteredOnce() {\n+        TableLevelMetricsController memoizing = new MemoizingTableLevelMetricsController(delegate);\n+        Counter c1 = memoizing.createAndRegisterCounter(STRING_CLASS, METRIC_NAME, TABLE_REFERENCE);\n+        Counter c2 = memoizing.createAndRegisterCounter(STRING_CLASS, METRIC_NAME, TABLE_REFERENCE);\n+\n+        assertThat(c1).isSameAs(c2);\n+        verify(delegate, times(1)).createAndRegisterCounter(STRING_CLASS, METRIC_NAME, TABLE_REFERENCE);\n+    }\n+\n+    @Test\n+    public void registersDifferentMetricsSeparately() {\n+        TableLevelMetricsController memoizing = new MemoizingTableLevelMetricsController(delegate);\n+        Counter c1 = memoizing.createAndRegisterCounter(STRING_CLASS, METRIC_NAME, TABLE_REFERENCE);\n+        Counter c2 = memoizing.createAndRegisterCounter(STRING_CLASS, METRIC_NAME, TABLE_REFERENCE_2);\n+\n+        assertThat(c1).isNotSameAs(c2);\n+        verify(delegate, times(1)).createAndRegisterCounter(STRING_CLASS, METRIC_NAME, TABLE_REFERENCE);\n+        verify(delegate, times(1)).createAndRegisterCounter(STRING_CLASS, METRIC_NAME, TABLE_REFERENCE_2);\n+    }\n+}", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "75c86affe0700bc3489762487305e77a244e7a09"}, "originalPosition": 66}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "0b56a729240a4aa952b8c7f49816d02991de1102", "author": {"user": {"login": "jeremyk-91", "name": "Jeremy Kong"}}, "url": "https://github.com/palantir/atlasdb/commit/0b56a729240a4aa952b8c7f49816d02991de1102", "committedDate": "2020-08-05T20:01:37Z", "message": "Update atlasdb-impl-shared/src/test/java/com/palantir/atlasdb/transaction/impl/metrics/MemoizingTableLevelMetricsControllerTest.java"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDYxOTgyMDEw", "url": "https://github.com/palantir/atlasdb/pull/4930#pullrequestreview-461982010", "createdAt": "2020-08-05T20:01:58Z", "commit": {"oid": "0b56a729240a4aa952b8c7f49816d02991de1102"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0wNVQyMDowMTo1OFrOG8YmzA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0wNVQyMDowMTo1OFrOG8YmzA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NTk3MDg5Mg==", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                    verify(delegate, times(1)).createAndRegisterCounter(STRING_CLASS, METRIC_NAME, TABLE_REFERENCE);\n          \n          \n            \n                    verify(delegate, times(1)).createAndRegisterCounter(STRING_CLASS, METRIC_NAME, TABLE_REFERENCE_2);\n          \n          \n            \n                    verify(delegate).createAndRegisterCounter(STRING_CLASS, METRIC_NAME, TABLE_REFERENCE);\n          \n          \n            \n                    verify(delegate).createAndRegisterCounter(STRING_CLASS, METRIC_NAME, TABLE_REFERENCE_2);", "url": "https://github.com/palantir/atlasdb/pull/4930#discussion_r465970892", "createdAt": "2020-08-05T20:01:58Z", "author": {"login": "jeremyk-91"}, "path": "atlasdb-impl-shared/src/test/java/com/palantir/atlasdb/transaction/impl/metrics/MemoizingTableLevelMetricsControllerTest.java", "diffHunk": "@@ -0,0 +1,66 @@\n+/*\n+ * (c) Copyright 2020 Palantir Technologies Inc. All rights reserved.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package com.palantir.atlasdb.transaction.impl.metrics;\n+\n+import static org.assertj.core.api.Assertions.assertThat;\n+import static org.mockito.ArgumentMatchers.any;\n+import static org.mockito.ArgumentMatchers.anyString;\n+import static org.mockito.Mockito.mock;\n+import static org.mockito.Mockito.times;\n+import static org.mockito.Mockito.verify;\n+import static org.mockito.Mockito.when;\n+\n+import org.junit.Before;\n+import org.junit.Test;\n+\n+import com.codahale.metrics.Counter;\n+import com.palantir.atlasdb.keyvalue.api.TableReference;\n+\n+public class MemoizingTableLevelMetricsControllerTest {\n+    private static final String METRIC_NAME = \"name\";\n+    private static final Class<String> STRING_CLASS = String.class;\n+    private static final TableReference TABLE_REFERENCE = TableReference.createFromFullyQualifiedName(\"a.b\");\n+    private static final TableReference TABLE_REFERENCE_2 = TableReference.createFromFullyQualifiedName(\"a.bc\");\n+\n+    private final TableLevelMetricsController delegate = mock(TableLevelMetricsController.class);\n+\n+    @Before\n+    public void setUp() {\n+        when(delegate.createAndRegisterCounter(any(), anyString(), any())).thenAnswer(_invocation -> new Counter());\n+    }\n+\n+    @Test\n+    public void metricIsOnlyRegisteredOnce() {\n+        TableLevelMetricsController memoizing = new MemoizingTableLevelMetricsController(delegate);\n+        Counter c1 = memoizing.createAndRegisterCounter(STRING_CLASS, METRIC_NAME, TABLE_REFERENCE);\n+        Counter c2 = memoizing.createAndRegisterCounter(STRING_CLASS, METRIC_NAME, TABLE_REFERENCE);\n+\n+        assertThat(c1).isSameAs(c2);\n+        verify(delegate, times(1)).createAndRegisterCounter(STRING_CLASS, METRIC_NAME, TABLE_REFERENCE);\n+    }\n+\n+    @Test\n+    public void registersDifferentMetricsSeparately() {\n+        TableLevelMetricsController memoizing = new MemoizingTableLevelMetricsController(delegate);\n+        Counter c1 = memoizing.createAndRegisterCounter(STRING_CLASS, METRIC_NAME, TABLE_REFERENCE);\n+        Counter c2 = memoizing.createAndRegisterCounter(STRING_CLASS, METRIC_NAME, TABLE_REFERENCE_2);\n+\n+        assertThat(c1).isNotSameAs(c2);\n+        verify(delegate, times(1)).createAndRegisterCounter(STRING_CLASS, METRIC_NAME, TABLE_REFERENCE);\n+        verify(delegate, times(1)).createAndRegisterCounter(STRING_CLASS, METRIC_NAME, TABLE_REFERENCE_2);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "0b56a729240a4aa952b8c7f49816d02991de1102"}, "originalPosition": 64}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "130bf04f2a885e1947f444a32685fc2f5f031c02", "author": {"user": {"login": "jeremyk-91", "name": "Jeremy Kong"}}, "url": "https://github.com/palantir/atlasdb/commit/130bf04f2a885e1947f444a32685fc2f5f031c02", "committedDate": "2020-08-05T20:02:03Z", "message": "Update atlasdb-impl-shared/src/test/java/com/palantir/atlasdb/transaction/impl/metrics/MemoizingTableLevelMetricsControllerTest.java"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "044f27bcd5f6b4beea7591ad3be96487b32a3047", "author": {"user": {"login": "jeremyk-91", "name": "Jeremy Kong"}}, "url": "https://github.com/palantir/atlasdb/commit/044f27bcd5f6b4beea7591ad3be96487b32a3047", "committedDate": "2020-08-05T20:02:03Z", "message": "Add generated changelog entries"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "7a562ef23f4095900f05639d923b3e47038f7c4e", "author": {"user": {"login": "jeremyk-91", "name": "Jeremy Kong"}}, "url": "https://github.com/palantir/atlasdb/commit/7a562ef23f4095900f05639d923b3e47038f7c4e", "committedDate": "2020-08-06T09:16:48Z", "message": "Autorelease 0.240.1-rc2"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "38e64ca6b46553dc19f3be1cf3d6397bffd4294b", "author": {"user": {"login": "jeremyk-91", "name": "Jeremy Kong"}}, "url": "https://github.com/palantir/atlasdb/commit/38e64ca6b46553dc19f3be1cf3d6397bffd4294b", "committedDate": "2020-08-06T10:21:35Z", "message": "Kick allowing new tag"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "d9b805b7d21878b2cbfa1924875d751fc7ce8190", "author": {"user": {"login": "jeremyk-91", "name": "Jeremy Kong"}}, "url": "https://github.com/palantir/atlasdb/commit/d9b805b7d21878b2cbfa1924875d751fc7ce8190", "committedDate": "2020-08-06T10:22:14Z", "message": "Autorelease 0.240.1-rc3"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "7e48d1b53c90683d7567547a21d57d334daec071", "author": {"user": {"login": "jeremyk-91", "name": "Jeremy Kong"}}, "url": "https://github.com/palantir/atlasdb/commit/7e48d1b53c90683d7567547a21d57d334daec071", "committedDate": "2020-08-06T10:22:14Z", "message": "Add generated changelog entries"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDYzMTkxMDE1", "url": "https://github.com/palantir/atlasdb/pull/4930#pullrequestreview-463191015", "createdAt": "2020-08-07T10:02:06Z", "commit": {"oid": "d9b805b7d21878b2cbfa1924875d751fc7ce8190"}, "state": "APPROVED", "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0wN1QxMDowMjowNlrOG9UFrw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0wN1QxMDowMzoyNVrOG9UH_A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2Njk0NTQ1NQ==", "bodyText": "Why not use verify(delegate) here as well?", "url": "https://github.com/palantir/atlasdb/pull/4930#discussion_r466945455", "createdAt": "2020-08-07T10:02:06Z", "author": {"login": "sudiksha27"}, "path": "atlasdb-impl-shared/src/test/java/com/palantir/atlasdb/transaction/impl/metrics/MemoizingTableLevelMetricsControllerTest.java", "diffHunk": "@@ -0,0 +1,66 @@\n+/*\n+ * (c) Copyright 2020 Palantir Technologies Inc. All rights reserved.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package com.palantir.atlasdb.transaction.impl.metrics;\n+\n+import static org.assertj.core.api.Assertions.assertThat;\n+import static org.mockito.ArgumentMatchers.any;\n+import static org.mockito.ArgumentMatchers.anyString;\n+import static org.mockito.Mockito.mock;\n+import static org.mockito.Mockito.times;\n+import static org.mockito.Mockito.verify;\n+import static org.mockito.Mockito.when;\n+\n+import org.junit.Before;\n+import org.junit.Test;\n+\n+import com.codahale.metrics.Counter;\n+import com.palantir.atlasdb.keyvalue.api.TableReference;\n+\n+public class MemoizingTableLevelMetricsControllerTest {\n+    private static final String METRIC_NAME = \"name\";\n+    private static final Class<String> STRING_CLASS = String.class;\n+    private static final TableReference TABLE_REFERENCE = TableReference.createFromFullyQualifiedName(\"a.b\");\n+    private static final TableReference TABLE_REFERENCE_2 = TableReference.createFromFullyQualifiedName(\"a.bc\");\n+\n+    private final TableLevelMetricsController delegate = mock(TableLevelMetricsController.class);\n+\n+    @Before\n+    public void setUp() {\n+        when(delegate.createAndRegisterCounter(any(), anyString(), any())).thenAnswer(_invocation -> new Counter());\n+    }\n+\n+    @Test\n+    public void metricIsOnlyRegisteredOnce() {\n+        TableLevelMetricsController memoizing = new MemoizingTableLevelMetricsController(delegate);\n+        Counter c1 = memoizing.createAndRegisterCounter(STRING_CLASS, METRIC_NAME, TABLE_REFERENCE);\n+        Counter c2 = memoizing.createAndRegisterCounter(STRING_CLASS, METRIC_NAME, TABLE_REFERENCE);\n+\n+        assertThat(c1).isSameAs(c2);\n+        verify(delegate, times(1)).createAndRegisterCounter(STRING_CLASS, METRIC_NAME, TABLE_REFERENCE);\n+    }", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d9b805b7d21878b2cbfa1924875d751fc7ce8190"}, "originalPosition": 54}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2Njk0NTkwMw==", "bodyText": "Would it be possible to add a stress test here?", "url": "https://github.com/palantir/atlasdb/pull/4930#discussion_r466945903", "createdAt": "2020-08-07T10:03:05Z", "author": {"login": "sudiksha27"}, "path": "atlasdb-impl-shared/src/test/java/com/palantir/atlasdb/transaction/impl/metrics/MemoizingTableLevelMetricsControllerTest.java", "diffHunk": "@@ -0,0 +1,66 @@\n+/*\n+ * (c) Copyright 2020 Palantir Technologies Inc. All rights reserved.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package com.palantir.atlasdb.transaction.impl.metrics;\n+\n+import static org.assertj.core.api.Assertions.assertThat;\n+import static org.mockito.ArgumentMatchers.any;\n+import static org.mockito.ArgumentMatchers.anyString;\n+import static org.mockito.Mockito.mock;\n+import static org.mockito.Mockito.times;\n+import static org.mockito.Mockito.verify;\n+import static org.mockito.Mockito.when;\n+\n+import org.junit.Before;\n+import org.junit.Test;\n+\n+import com.codahale.metrics.Counter;\n+import com.palantir.atlasdb.keyvalue.api.TableReference;\n+\n+public class MemoizingTableLevelMetricsControllerTest {\n+    private static final String METRIC_NAME = \"name\";\n+    private static final Class<String> STRING_CLASS = String.class;\n+    private static final TableReference TABLE_REFERENCE = TableReference.createFromFullyQualifiedName(\"a.b\");\n+    private static final TableReference TABLE_REFERENCE_2 = TableReference.createFromFullyQualifiedName(\"a.bc\");\n+\n+    private final TableLevelMetricsController delegate = mock(TableLevelMetricsController.class);\n+\n+    @Before\n+    public void setUp() {\n+        when(delegate.createAndRegisterCounter(any(), anyString(), any())).thenAnswer(_invocation -> new Counter());\n+    }\n+\n+    @Test\n+    public void metricIsOnlyRegisteredOnce() {\n+        TableLevelMetricsController memoizing = new MemoizingTableLevelMetricsController(delegate);\n+        Counter c1 = memoizing.createAndRegisterCounter(STRING_CLASS, METRIC_NAME, TABLE_REFERENCE);\n+        Counter c2 = memoizing.createAndRegisterCounter(STRING_CLASS, METRIC_NAME, TABLE_REFERENCE);\n+\n+        assertThat(c1).isSameAs(c2);\n+        verify(delegate, times(1)).createAndRegisterCounter(STRING_CLASS, METRIC_NAME, TABLE_REFERENCE);\n+    }\n+\n+    @Test\n+    public void registersDifferentMetricsSeparately() {\n+        TableLevelMetricsController memoizing = new MemoizingTableLevelMetricsController(delegate);\n+        Counter c1 = memoizing.createAndRegisterCounter(STRING_CLASS, METRIC_NAME, TABLE_REFERENCE);\n+        Counter c2 = memoizing.createAndRegisterCounter(STRING_CLASS, METRIC_NAME, TABLE_REFERENCE_2);\n+\n+        assertThat(c1).isNotSameAs(c2);\n+        verify(delegate).createAndRegisterCounter(STRING_CLASS, METRIC_NAME, TABLE_REFERENCE);\n+        verify(delegate).createAndRegisterCounter(STRING_CLASS, METRIC_NAME, TABLE_REFERENCE_2);\n+    }", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d9b805b7d21878b2cbfa1924875d751fc7ce8190"}, "originalPosition": 65}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2Njk0NjA0NA==", "bodyText": "Is the hyphen intentional?", "url": "https://github.com/palantir/atlasdb/pull/4930#discussion_r466946044", "createdAt": "2020-08-07T10:03:25Z", "author": {"login": "sudiksha27"}, "path": "changelog/0.240.1-rc2/pr-4930.v2.yml", "diffHunk": "@@ -0,0 +1,5 @@\n+type: improvement\n+improvement:\n+  description: '- Fix memory leak in `TopNMetricPublicationController`.'\n+  links:", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d9b805b7d21878b2cbfa1924875d751fc7ce8190"}, "originalPosition": 4}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e7f6038c45636f94f3a18202b84b580f2645396e", "author": {"user": {"login": "jeremyk-91", "name": "Jeremy Kong"}}, "url": "https://github.com/palantir/atlasdb/commit/e7f6038c45636f94f3a18202b84b580f2645396e", "committedDate": "2020-08-07T12:46:43Z", "message": "CR comments"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2771, "cost": 1, "resetAt": "2021-11-01T16:19:10Z"}}}