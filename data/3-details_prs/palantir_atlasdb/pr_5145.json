{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTMyNTMzMzM4", "number": 5145, "title": "[LW] Smile for the snapshot", "bodyText": "Goals (and why):\nThere was yet another edge case where this check was bad. Let's fix it.\nImplementation Description (bullets):\nFix the check.\nTesting (What was existing testing like?  What have you done to improve it?):\nAdded yet another test.\nConcerns (what feedback would you like?):\nMake sure we don't mess this up.\nWhere should we start reviewing?:\nClientLogEvents\nPriority (whenever / two weeks / yesterday):\nYesterday \ud83d\udd25", "createdAt": "2020-12-04T13:25:25Z", "url": "https://github.com/palantir/atlasdb/pull/5145", "merged": true, "mergeCommit": {"oid": "96d48c494a24a6198c4d81e1cf9d2c6a86634396"}, "closed": true, "closedAt": "2020-12-04T13:49:22Z", "author": {"login": "Jolyon-S"}, "timelineItems": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdi3oYogH2gAyNTMyNTMzMzM4OmExMjlmMzIyYmNlZWMxNmY4NGFmZGFhYmMwNDVmZGI5N2NjZTVlMzU=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdi4CoUgFqTU0NDk3MTMyMA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "a129f322bceec16f84afdaabc045fdb97cce5e35", "author": {"user": {"login": "Jolyon-S", "name": "Jolyon"}}, "url": "https://github.com/palantir/atlasdb/commit/a129f322bceec16f84afdaabc045fdb97cce5e35", "committedDate": "2020-12-04T13:19:33Z", "message": "really let us make this right"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "53cd3e27210d4260fe256e3a620cd0d45b414ecc", "author": {"user": {"login": "Jolyon-S", "name": "Jolyon"}}, "url": "https://github.com/palantir/atlasdb/commit/53cd3e27210d4260fe256e3a620cd0d45b414ecc", "committedDate": "2020-12-04T13:19:33Z", "message": "Add generated changelog entries"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTQ0OTcxMzIw", "url": "https://github.com/palantir/atlasdb/pull/5145#pullrequestreview-544971320", "createdAt": "2020-12-04T13:47:15Z", "commit": {"oid": "53cd3e27210d4260fe256e3a620cd0d45b414ecc"}, "state": "APPROVED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0wNFQxMzo0NzoxNVrOH_Rmwg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0wNFQxMzo0NzoxNVrOH_Rmwg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNjExMDc4Ng==", "bodyText": "doh", "url": "https://github.com/palantir/atlasdb/pull/5145#discussion_r536110786", "createdAt": "2020-12-04T13:47:15Z", "author": {"login": "jeremyk-91"}, "path": "atlasdb-impl-shared/src/main/java/com/palantir/atlasdb/keyvalue/api/watch/ClientLogEvents.java", "diffHunk": "@@ -65,9 +65,12 @@ each version starting with the client version (exclusive) and ending with latest\n          Case 3: client is completely up-to-date. Here, we don't need to check for any versions.\n          Case 4: client has no version. Then we expect that the events returned at least enclose the versions of\n                  the transactions.\n+         Case 5: the client is very far behind, but still has a version. In this case, we should not check based on the\n+                 client version, but rather the lower bound of the timestamp mapping.\n         */\n         verifyReturnedEventsEnclosesTransactionVersions(\n                 lastKnownVersion\n+                        .filter(_unused -> !clearCache())", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "53cd3e27210d4260fe256e3a620cd0d45b414ecc"}, "originalPosition": 9}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2535, "cost": 1, "resetAt": "2021-11-01T16:19:10Z"}}}