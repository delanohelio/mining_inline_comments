{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDkwOTY0MDY2", "number": 4993, "title": "Remote history resource", "bodyText": "Goals (and why):\nImplements the remote history provider piece\nImplementation Description (bullets):\n\nAdd conjure endpoint that provides history\n\nTesting (What was existing testing like?  What have you done to improve it?):\nAdded new tests\nConcerns (what feedback would you like?):\n\nDo the Conjure definitions seem reasonable?\n\nWhere should we start reviewing?:\ntimelock-history.yml\nPriority (whenever / two weeks / yesterday):\nASAP", "createdAt": "2020-09-22T14:02:54Z", "url": "https://github.com/palantir/atlasdb/pull/4993", "merged": true, "mergeCommit": {"oid": "5aae22b2116433e6a0b30658ad9a9293486eebe5"}, "closed": true, "closedAt": "2020-09-24T12:00:02Z", "author": {"login": "sudiksha27"}, "timelineItems": {"totalCount": 50, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdLdQ2LgFqTQ5Mzc2NDQ2Mg==", "endCursor": "Y3Vyc29yOnYyOpPPAAABdL_JhGgH2gAyNDkwOTY0MDY2OjdlNzJjYmY5YjQ4N2EyZjBiZjgyMzcxNTQ1ODU3MWJiZGUwYTkwODI=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDkzNzY0NDYy", "url": "https://github.com/palantir/atlasdb/pull/4993#pullrequestreview-493764462", "createdAt": "2020-09-22T19:06:11Z", "commit": {"oid": "823dd176550db19f4740b1993a2953978d928b57"}, "state": "COMMENTED", "comments": {"totalCount": 12, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yMlQxOTowOTozNVrOHWImuQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yMlQxOTozMjowNlrOHWJVig==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5Mjk3MTcwNQ==", "bodyText": "nit: no need to depend on objects project directly", "url": "https://github.com/palantir/atlasdb/pull/4993#discussion_r492971705", "createdAt": "2020-09-22T19:09:35Z", "author": {"login": "jeremyk-91"}, "path": "timelock-corruption-detection/build.gradle", "diffHunk": "@@ -1,7 +1,21 @@\n apply from: \"../gradle/shared.gradle\"\n+apply plugin: 'com.palantir.conjure'\n+\n+conjure {\n+    java {\n+        undertowServicePrefixes = true\n+        undertowListenableFutures = true\n+        useImmutableBytes = true\n+    }\n+}\n \n dependencies {\n-    compile project(\":leader-election-impl\")\n+    conjureCompiler 'com.palantir.conjure:conjure'\n+    conjureJava 'com.palantir.conjure.java:conjure-java'\n+\n+    compile project(\":timelock-corruption-detection:timelock-corruption-detection-undertow\")\n+    compile project(\":timelock-corruption-detection:timelock-corruption-detection-jersey\")\n+    compile project(\":timelock-corruption-detection:timelock-corruption-detection-objects\")", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "823dd176550db19f4740b1993a2953978d928b57"}, "originalPosition": 19}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5Mjk3Mzk1Mw==", "bodyText": "I'm afraid this won't actually work in its current form, because PaxosValue is not JSON serializable.", "url": "https://github.com/palantir/atlasdb/pull/4993#discussion_r492973953", "createdAt": "2020-09-22T19:13:55Z", "author": {"login": "jeremyk-91"}, "path": "timelock-corruption-detection/src/main/conjure/timelock-history.yml", "diffHunk": "@@ -0,0 +1,52 @@\n+types:\n+  imports:\n+    PaxosValue:\n+      base-type: any\n+      external:\n+        java: com.palantir.paxos.PaxosValue", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "823dd176550db19f4740b1993a2953978d928b57"}, "originalPosition": 6}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5Mjk3NDYxOA==", "bodyText": "I think for this one we should probably still have a separate layer, because this class is used internally within the Paxos implementation. (Unlike PaxosValue, this one isn't a part of TimeLock's internode API.)", "url": "https://github.com/palantir/atlasdb/pull/4993#discussion_r492974618", "createdAt": "2020-09-22T19:15:08Z", "author": {"login": "jeremyk-91"}, "path": "timelock-corruption-detection/src/main/conjure/timelock-history.yml", "diffHunk": "@@ -0,0 +1,52 @@\n+types:\n+  imports:\n+    PaxosValue:\n+      base-type: any\n+      external:\n+        java: com.palantir.paxos.PaxosValue\n+    PaxosAcceptorState:\n+      base-type: any\n+      external:\n+        java: com.palantir.paxos.PaxosAcceptorState", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "823dd176550db19f4740b1993a2953978d928b57"}, "originalPosition": 10}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5Mjk3NTU3Mw==", "bodyText": "We should standardise on the package to be used (I think, unless I'm missing something - you've used both com.palantir.timelock.history and com.palantir.history). I think the former is the correct one (i.e. no changes here, but we might want to move the others around).", "url": "https://github.com/palantir/atlasdb/pull/4993#discussion_r492975573", "createdAt": "2020-09-22T19:16:55Z", "author": {"login": "jeremyk-91"}, "path": "timelock-corruption-detection/src/main/conjure/timelock-history.yml", "diffHunk": "@@ -0,0 +1,52 @@\n+types:\n+  imports:\n+    PaxosValue:\n+      base-type: any\n+      external:\n+        java: com.palantir.paxos.PaxosValue\n+    PaxosAcceptorState:\n+      base-type: any\n+      external:\n+        java: com.palantir.paxos.PaxosAcceptorState\n+    NamespaceAndUseCase:\n+      base-type: any\n+      external:\n+        java: com.palantir.paxos.NamespaceAndUseCase\n+    Long:\n+      base-type: any\n+      external:\n+        java: java.lang.Long\n+  definitions:\n+    default-package: com.palantir.timelock.history\n+    objects:\n+      HistoryQuery:\n+        fields:\n+          namespaceAndUseCase: NamespaceAndUseCase\n+          seq: Long\n+      PaxosLogWithAcceptedAndLearnedValues:\n+        fields:\n+          acceptedState: optional<PaxosAcceptorState>\n+          paxosValue: optional<PaxosValue>\n+          seq: Long\n+      LogsForNamespaceAndUseCase:\n+        fields:\n+          namespaceAndUseCase: NamespaceAndUseCase\n+          logs: list<PaxosLogWithAcceptedAndLearnedValues>\n+      PaxosHistoryOnRemote:\n+        fields:\n+          logs: list<LogsForNamespaceAndUseCase>\n+\n+services:\n+  TimeLockPaxosHistoryProvider:\n+    name: TimeLock Paxos History Provider Service\n+    default-auth: header\n+    package: com.palantir.timelock.history", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "823dd176550db19f4740b1993a2953978d928b57"}, "originalPosition": 43}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5Mjk3NTg0OA==", "bodyText": "nit: This is fine, but have a look at the documentation of get().", "url": "https://github.com/palantir/atlasdb/pull/4993#discussion_r492975848", "createdAt": "2020-09-22T19:17:30Z", "author": {"login": "jeremyk-91"}, "path": "timelock-corruption-detection/src/main/java/com/palantir/history/models/LearnerAndAcceptorRecords.java", "diffHunk": "@@ -31,4 +33,34 @@\n \n     @Value.Parameter\n     Map<Long, PaxosAcceptorState> acceptorRecords();\n+\n+    default Optional<PaxosValue> getLearnedValueAtSeqIfExists(long seq) {\n+        return Optional.ofNullable(learnerRecords().getOrDefault(seq, null));", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "823dd176550db19f4740b1993a2953978d928b57"}, "originalPosition": 16}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5Mjk3Njc5NQ==", "bodyText": "Yeah, I think this function is correct, though this is maybe a bit neater?\n\n  \n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                    long minSeq = Long.MAX_VALUE;\n          \n          \n            \n                    if (!learnerRecords().isEmpty()) {\n          \n          \n            \n                        minSeq = Math.min(minSeq, Collections.min(learnerRecords().keySet()));\n          \n          \n            \n                    }\n          \n          \n            \n                    if (!acceptorRecords().isEmpty()) {\n          \n          \n            \n                        minSeq = Math.min(minSeq, Collections.min(acceptorRecords().keySet()));\n          \n          \n            \n                    }\n          \n          \n            \n                    return minSeq;\n          \n          \n            \n                    return Stream.of(learnerRecords(), acceptorRecords())\n          \n          \n            \n                            .map(Map::keySet)\n          \n          \n            \n                            .flatMap(Set::stream)\n          \n          \n            \n                            .min(Comparator.naturalOrder())\n          \n          \n            \n                            .orElse(Long.MAX_VALUE);", "url": "https://github.com/palantir/atlasdb/pull/4993#discussion_r492976795", "createdAt": "2020-09-22T19:19:12Z", "author": {"login": "jeremyk-91"}, "path": "timelock-corruption-detection/src/main/java/com/palantir/history/models/LearnerAndAcceptorRecords.java", "diffHunk": "@@ -31,4 +33,34 @@\n \n     @Value.Parameter\n     Map<Long, PaxosAcceptorState> acceptorRecords();\n+\n+    default Optional<PaxosValue> getLearnedValueAtSeqIfExists(long seq) {\n+        return Optional.ofNullable(learnerRecords().getOrDefault(seq, null));\n+    }\n+\n+    default Optional<PaxosAcceptorState> getAcceptedValueAtSeqIfExists(long seq) {\n+        return Optional.ofNullable(acceptorRecords().getOrDefault(seq, null));\n+    }\n+\n+    default long getMinSequence() {\n+        long minSeq = Long.MAX_VALUE;\n+        if (!learnerRecords().isEmpty()) {\n+            minSeq = Math.min(minSeq, Collections.min(learnerRecords().keySet()));\n+        }\n+        if (!acceptorRecords().isEmpty()) {\n+            minSeq = Math.min(minSeq, Collections.min(acceptorRecords().keySet()));\n+        }\n+        return minSeq;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "823dd176550db19f4740b1993a2953978d928b57"}, "originalPosition": 31}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5Mjk3NzEzMg==", "bodyText": "Looks like this could be @Value.Lazy", "url": "https://github.com/palantir/atlasdb/pull/4993#discussion_r492977132", "createdAt": "2020-09-22T19:19:46Z", "author": {"login": "jeremyk-91"}, "path": "timelock-corruption-detection/src/main/java/com/palantir/history/models/LearnerAndAcceptorRecords.java", "diffHunk": "@@ -31,4 +33,34 @@\n \n     @Value.Parameter\n     Map<Long, PaxosAcceptorState> acceptorRecords();\n+\n+    default Optional<PaxosValue> getLearnedValueAtSeqIfExists(long seq) {\n+        return Optional.ofNullable(learnerRecords().getOrDefault(seq, null));\n+    }\n+\n+    default Optional<PaxosAcceptorState> getAcceptedValueAtSeqIfExists(long seq) {\n+        return Optional.ofNullable(acceptorRecords().getOrDefault(seq, null));\n+    }\n+\n+    default long getMinSequence() {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "823dd176550db19f4740b1993a2953978d928b57"}, "originalPosition": 23}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5Mjk3NzMwMg==", "bodyText": "as above, I don't know if we want to cache the value for recomputations, and I think streams give an easier pipeline.", "url": "https://github.com/palantir/atlasdb/pull/4993#discussion_r492977302", "createdAt": "2020-09-22T19:20:04Z", "author": {"login": "jeremyk-91"}, "path": "timelock-corruption-detection/src/main/java/com/palantir/history/models/LearnerAndAcceptorRecords.java", "diffHunk": "@@ -31,4 +33,34 @@\n \n     @Value.Parameter\n     Map<Long, PaxosAcceptorState> acceptorRecords();\n+\n+    default Optional<PaxosValue> getLearnedValueAtSeqIfExists(long seq) {\n+        return Optional.ofNullable(learnerRecords().getOrDefault(seq, null));\n+    }\n+\n+    default Optional<PaxosAcceptorState> getAcceptedValueAtSeqIfExists(long seq) {\n+        return Optional.ofNullable(acceptorRecords().getOrDefault(seq, null));\n+    }\n+\n+    default long getMinSequence() {\n+        long minSeq = Long.MAX_VALUE;\n+        if (!learnerRecords().isEmpty()) {\n+            minSeq = Math.min(minSeq, Collections.min(learnerRecords().keySet()));\n+        }\n+        if (!acceptorRecords().isEmpty()) {\n+            minSeq = Math.min(minSeq, Collections.min(acceptorRecords().keySet()));\n+        }\n+        return minSeq;\n+    }\n+\n+    default long getMaxSequence() {\n+        long maxSeq = Long.MIN_VALUE;\n+        if (!learnerRecords().isEmpty()) {\n+            maxSeq = Math.max(maxSeq, Collections.max(learnerRecords().keySet()));\n+        }\n+        if (!acceptorRecords().isEmpty()) {\n+            maxSeq = Math.max(maxSeq, Collections.max(acceptorRecords().keySet()));\n+        }\n+        return maxSeq;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "823dd176550db19f4740b1993a2953978d928b57"}, "originalPosition": 42}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5Mjk3ODIyMw==", "bodyText": "nice!", "url": "https://github.com/palantir/atlasdb/pull/4993#discussion_r492978223", "createdAt": "2020-09-22T19:21:52Z", "author": {"login": "jeremyk-91"}, "path": "timelock-corruption-detection/src/main/java/com/palantir/history/remote/HistoryLoaderAndTransformer.java", "diffHunk": "@@ -0,0 +1,67 @@\n+/*\n+ * (c) Copyright 2020 Palantir Technologies Inc. All rights reserved.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package com.palantir.history.remote;\n+\n+import java.util.List;\n+import java.util.Map;\n+import java.util.stream.Collectors;\n+import java.util.stream.LongStream;\n+\n+import com.google.common.collect.Maps;\n+import com.palantir.common.streams.KeyedStream;\n+import com.palantir.history.LocalHistoryLoader;\n+import com.palantir.history.models.LearnerAndAcceptorRecords;\n+import com.palantir.history.models.PaxosHistoryOnSingleNode;\n+import com.palantir.paxos.NamespaceAndUseCase;\n+import com.palantir.timelock.history.HistoryQuery;\n+import com.palantir.timelock.history.LogsForNamespaceAndUseCase;\n+import com.palantir.timelock.history.PaxosLogWithAcceptedAndLearnedValues;\n+\n+public final class HistoryLoaderAndTransformer {\n+    private HistoryLoaderAndTransformer() {\n+        //no op\n+    }\n+\n+    public static List<LogsForNamespaceAndUseCase> getLogsForHistoryQueries(LocalHistoryLoader localHistoryLoader,\n+            List<HistoryQuery> historyQueries) {\n+        Map<NamespaceAndUseCase, Long> lastVerifiedSequences = historyQueries.stream().collect(\n+                Collectors.toMap(HistoryQuery::getNamespaceAndUseCase, HistoryQuery::getSeq, Math::min));", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "823dd176550db19f4740b1993a2953978d928b57"}, "originalPosition": 42}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5Mjk4MDY0Nw==", "bodyText": "Can we iterate over the map entries, as opposed to over this range? I'm a bit worried about this at deployments like big internal stack, where we truncated a good number of these entries so we have -1 and then a big gap, and then four million.", "url": "https://github.com/palantir/atlasdb/pull/4993#discussion_r492980647", "createdAt": "2020-09-22T19:26:24Z", "author": {"login": "jeremyk-91"}, "path": "timelock-corruption-detection/src/main/java/com/palantir/history/remote/HistoryLoaderAndTransformer.java", "diffHunk": "@@ -0,0 +1,67 @@\n+/*\n+ * (c) Copyright 2020 Palantir Technologies Inc. All rights reserved.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package com.palantir.history.remote;\n+\n+import java.util.List;\n+import java.util.Map;\n+import java.util.stream.Collectors;\n+import java.util.stream.LongStream;\n+\n+import com.google.common.collect.Maps;\n+import com.palantir.common.streams.KeyedStream;\n+import com.palantir.history.LocalHistoryLoader;\n+import com.palantir.history.models.LearnerAndAcceptorRecords;\n+import com.palantir.history.models.PaxosHistoryOnSingleNode;\n+import com.palantir.paxos.NamespaceAndUseCase;\n+import com.palantir.timelock.history.HistoryQuery;\n+import com.palantir.timelock.history.LogsForNamespaceAndUseCase;\n+import com.palantir.timelock.history.PaxosLogWithAcceptedAndLearnedValues;\n+\n+public final class HistoryLoaderAndTransformer {\n+    private HistoryLoaderAndTransformer() {\n+        //no op\n+    }\n+\n+    public static List<LogsForNamespaceAndUseCase> getLogsForHistoryQueries(LocalHistoryLoader localHistoryLoader,\n+            List<HistoryQuery> historyQueries) {\n+        Map<NamespaceAndUseCase, Long> lastVerifiedSequences = historyQueries.stream().collect(\n+                Collectors.toMap(HistoryQuery::getNamespaceAndUseCase, HistoryQuery::getSeq, Math::min));\n+\n+        PaxosHistoryOnSingleNode localPaxosHistory = localHistoryLoader.getLocalPaxosHistory(lastVerifiedSequences);\n+\n+        return KeyedStream.stream(localPaxosHistory.history())\n+                .mapEntries(HistoryLoaderAndTransformer::processHistory)\n+                .values()\n+                .collect(Collectors.toList());\n+    }\n+\n+    private static Map.Entry<NamespaceAndUseCase, LogsForNamespaceAndUseCase> processHistory(\n+            NamespaceAndUseCase namespaceAndUseCase, LearnerAndAcceptorRecords records) {\n+\n+        long minSeq = records.getMinSequence();\n+        long maxSeq = records.getMaxSequence();\n+\n+        List<PaxosLogWithAcceptedAndLearnedValues> logs = LongStream.rangeClosed(minSeq, maxSeq).boxed().map(\n+                sequence -> PaxosLogWithAcceptedAndLearnedValues.builder()\n+                        .paxosValue(records.getLearnedValueAtSeqIfExists(sequence))\n+                        .acceptedState(records.getAcceptedValueAtSeqIfExists(sequence))\n+                        .seq(sequence)\n+                        .build()).collect(Collectors.toList());", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "823dd176550db19f4740b1993a2953978d928b57"}, "originalPosition": 63}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5Mjk4MjU2OQ==", "bodyText": "This probably doesn't need to be exposed \ud83d\ude05", "url": "https://github.com/palantir/atlasdb/pull/4993#discussion_r492982569", "createdAt": "2020-09-22T19:29:57Z", "author": {"login": "jeremyk-91"}, "path": "timelock-corruption-detection/src/test/java/com/palantir/history/HistoryLoaderAndTransformerTest.java", "diffHunk": "@@ -0,0 +1,183 @@\n+/*\n+ * (c) Copyright 2020 Palantir Technologies Inc. All rights reserved.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package com.palantir.history;\n+\n+import static org.assertj.core.api.Assertions.assertThat;\n+\n+import static com.palantir.history.utils.PaxosSerializationTestUtils.writeAcceptorStateForLogAndRound;\n+import static com.palantir.history.utils.PaxosSerializationTestUtils.writeValueForLogAndRound;\n+\n+import java.util.List;\n+import java.util.stream.Collectors;\n+import java.util.stream.IntStream;\n+\n+import javax.sql.DataSource;\n+\n+import org.junit.Before;\n+import org.junit.Rule;\n+import org.junit.Test;\n+import org.junit.rules.TemporaryFolder;\n+\n+import com.google.common.collect.ImmutableList;\n+import com.palantir.history.remote.HistoryLoaderAndTransformer;\n+import com.palantir.history.sqlite.SqlitePaxosStateLogHistory;\n+import com.palantir.paxos.Client;\n+import com.palantir.paxos.ImmutableNamespaceAndUseCase;\n+import com.palantir.paxos.PaxosAcceptorState;\n+import com.palantir.paxos.PaxosStateLog;\n+import com.palantir.paxos.PaxosValue;\n+import com.palantir.paxos.SqliteConnections;\n+import com.palantir.paxos.SqlitePaxosStateLog;\n+import com.palantir.timelock.history.HistoryQuery;\n+import com.palantir.timelock.history.LogsForNamespaceAndUseCase;\n+import com.palantir.timelock.history.PaxosLogWithAcceptedAndLearnedValues;\n+\n+public class HistoryLoaderAndTransformerTest {\n+    @Rule\n+    public TemporaryFolder tempFolder = new TemporaryFolder();\n+\n+    private static final Client CLIENT = Client.of(\"client\");\n+    private static final String USE_CASE = \"useCase\";\n+    private static final String USE_CASE_LEARNER = \"useCase!learner\";\n+    private static final String USE_CASE_ACCEPTOR = \"useCase!acceptor\";\n+\n+    private DataSource dataSource;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "823dd176550db19f4740b1993a2953978d928b57"}, "originalPosition": 58}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5Mjk4MzY5MA==", "bodyText": "This is pretty solid. I think you might want to add a test for a discontinuity (i.e. logs only exist from 45 - 100, and lastVerified was 3 or something like that), but other than that there's good coverage here.", "url": "https://github.com/palantir/atlasdb/pull/4993#discussion_r492983690", "createdAt": "2020-09-22T19:32:06Z", "author": {"login": "jeremyk-91"}, "path": "timelock-corruption-detection/src/test/java/com/palantir/history/HistoryLoaderAndTransformerTest.java", "diffHunk": "@@ -0,0 +1,183 @@\n+/*\n+ * (c) Copyright 2020 Palantir Technologies Inc. All rights reserved.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package com.palantir.history;\n+\n+import static org.assertj.core.api.Assertions.assertThat;\n+\n+import static com.palantir.history.utils.PaxosSerializationTestUtils.writeAcceptorStateForLogAndRound;\n+import static com.palantir.history.utils.PaxosSerializationTestUtils.writeValueForLogAndRound;\n+\n+import java.util.List;\n+import java.util.stream.Collectors;\n+import java.util.stream.IntStream;\n+\n+import javax.sql.DataSource;\n+\n+import org.junit.Before;\n+import org.junit.Rule;\n+import org.junit.Test;\n+import org.junit.rules.TemporaryFolder;\n+\n+import com.google.common.collect.ImmutableList;\n+import com.palantir.history.remote.HistoryLoaderAndTransformer;\n+import com.palantir.history.sqlite.SqlitePaxosStateLogHistory;\n+import com.palantir.paxos.Client;\n+import com.palantir.paxos.ImmutableNamespaceAndUseCase;\n+import com.palantir.paxos.PaxosAcceptorState;\n+import com.palantir.paxos.PaxosStateLog;\n+import com.palantir.paxos.PaxosValue;\n+import com.palantir.paxos.SqliteConnections;\n+import com.palantir.paxos.SqlitePaxosStateLog;\n+import com.palantir.timelock.history.HistoryQuery;\n+import com.palantir.timelock.history.LogsForNamespaceAndUseCase;\n+import com.palantir.timelock.history.PaxosLogWithAcceptedAndLearnedValues;\n+\n+public class HistoryLoaderAndTransformerTest {\n+    @Rule\n+    public TemporaryFolder tempFolder = new TemporaryFolder();\n+\n+    private static final Client CLIENT = Client.of(\"client\");\n+    private static final String USE_CASE = \"useCase\";\n+    private static final String USE_CASE_LEARNER = \"useCase!learner\";\n+    private static final String USE_CASE_ACCEPTOR = \"useCase!acceptor\";\n+\n+    private DataSource dataSource;\n+    private PaxosStateLog<PaxosValue> learnerLog;\n+    private PaxosStateLog<PaxosAcceptorState> acceptorLog;\n+    private LocalHistoryLoader history;\n+\n+    @Before\n+    public void setup() {\n+        dataSource = SqliteConnections.getPooledDataSource(tempFolder.getRoot().toPath());\n+        learnerLog = SqlitePaxosStateLog.create(\n+                ImmutableNamespaceAndUseCase.of(CLIENT, USE_CASE_LEARNER), dataSource);\n+        acceptorLog = SqlitePaxosStateLog.create(\n+                ImmutableNamespaceAndUseCase.of(CLIENT, USE_CASE_ACCEPTOR), dataSource);\n+        history = LocalHistoryLoader.create(SqlitePaxosStateLogHistory.create(dataSource));\n+    }\n+\n+    @Test\n+    public void canFetchLogsForQuery() {\n+        writeToLogs(100);\n+        int lastVerified = 27;\n+        List<HistoryQuery> historyQueries = ImmutableList.of(HistoryQuery.of(\n+                ImmutableNamespaceAndUseCase.of(CLIENT, USE_CASE), lastVerified));\n+        List<LogsForNamespaceAndUseCase> paxosHistory\n+                = HistoryLoaderAndTransformer.getLogsForHistoryQueries(history, historyQueries);\n+\n+        assertThat(paxosHistory.size()).isEqualTo(1);\n+        LogsForNamespaceAndUseCase logsForNamespaceAndUseCase = paxosHistory.get(0);\n+\n+        assertThat(logsForNamespaceAndUseCase.getNamespaceAndUseCase().namespace()).isEqualTo(CLIENT);\n+        assertThat(logsForNamespaceAndUseCase.getNamespaceAndUseCase().useCase()).isEqualTo(USE_CASE);\n+        assertThat(logsForNamespaceAndUseCase.getLogs().size()).isEqualTo(100 - lastVerified);\n+    }\n+\n+    @Test\n+    public void canHandleDuplicateQueries() {\n+        writeToLogs(100);\n+        int minLastVerified = 27;\n+\n+        List<HistoryQuery> queries = IntStream.range(0, 10).boxed().map(\n+                idx -> HistoryQuery.of(ImmutableNamespaceAndUseCase.of(CLIENT, USE_CASE), minLastVerified + idx))\n+                .collect(Collectors.toList());\n+\n+        List<LogsForNamespaceAndUseCase> paxosHistory\n+                = HistoryLoaderAndTransformer.getLogsForHistoryQueries(history, queries);\n+\n+        assertThat(paxosHistory.size()).isEqualTo(1);\n+        LogsForNamespaceAndUseCase logsForNamespaceAndUseCase = paxosHistory.get(0);\n+\n+        assertThat(logsForNamespaceAndUseCase.getNamespaceAndUseCase().namespace()).isEqualTo(CLIENT);\n+        assertThat(logsForNamespaceAndUseCase.getNamespaceAndUseCase().useCase()).isEqualTo(USE_CASE);\n+        assertThat(logsForNamespaceAndUseCase.getLogs().size()).isEqualTo(100 - minLastVerified);\n+    }\n+\n+    @Test\n+    public void canHandleHistoryWithOnlyAcceptorLogs() {\n+        IntStream.range(0, 100).forEach(i -> {\n+            writeAcceptorStateForLogAndRound(acceptorLog, i + 1);\n+        });\n+\n+        int lastVerified = 27;\n+        List<HistoryQuery> historyQueries = ImmutableList.of(HistoryQuery.of(\n+                ImmutableNamespaceAndUseCase.of(CLIENT, USE_CASE), lastVerified));\n+\n+        List<LogsForNamespaceAndUseCase> paxosHistory\n+                = HistoryLoaderAndTransformer.getLogsForHistoryQueries(history, historyQueries);\n+\n+        assertThat(paxosHistory.size()).isEqualTo(1);\n+        LogsForNamespaceAndUseCase logsForNamespaceAndUseCase = paxosHistory.get(0);\n+\n+        assertThat(logsForNamespaceAndUseCase.getNamespaceAndUseCase().namespace()).isEqualTo(CLIENT);\n+        assertThat(logsForNamespaceAndUseCase.getNamespaceAndUseCase().useCase()).isEqualTo(USE_CASE);\n+        assertThat(logsForNamespaceAndUseCase.getLogs().size()).isEqualTo(100 - lastVerified);\n+\n+        PaxosLogWithAcceptedAndLearnedValues singleLog = logsForNamespaceAndUseCase.getLogs().get(0);\n+        assertThat(singleLog.getAcceptedState()).isPresent();\n+        assertThat(singleLog.getPaxosValue()).isNotPresent();\n+    }\n+\n+    @Test\n+    public void canHandleHistoryWithOnlyLearnerLogs() {\n+        IntStream.range(0, 100).forEach(i -> {\n+            writeValueForLogAndRound(learnerLog, i + 1);\n+        });\n+\n+        int lastVerified = 52;\n+        List<HistoryQuery> historyQueries = ImmutableList.of(HistoryQuery.of(\n+                ImmutableNamespaceAndUseCase.of(CLIENT, USE_CASE), lastVerified));\n+\n+        List<LogsForNamespaceAndUseCase> paxosHistory\n+                = HistoryLoaderAndTransformer.getLogsForHistoryQueries(history, historyQueries);\n+\n+        assertThat(paxosHistory.size()).isEqualTo(1);\n+        LogsForNamespaceAndUseCase logsForNamespaceAndUseCase = paxosHistory.get(0);\n+\n+        assertThat(logsForNamespaceAndUseCase.getNamespaceAndUseCase().namespace()).isEqualTo(CLIENT);\n+        assertThat(logsForNamespaceAndUseCase.getNamespaceAndUseCase().useCase()).isEqualTo(USE_CASE);\n+        assertThat(logsForNamespaceAndUseCase.getLogs().size()).isEqualTo(100 - lastVerified);\n+\n+        PaxosLogWithAcceptedAndLearnedValues singleLog = logsForNamespaceAndUseCase.getLogs().get(0);\n+        assertThat(singleLog.getAcceptedState()).isNotPresent();\n+        assertThat(singleLog.getPaxosValue()).isPresent();\n+    }\n+\n+    @Test\n+    public void canHandleHistoryWithNoLogs() {\n+        int lastVerified = 102;\n+        List<HistoryQuery> historyQueries = ImmutableList.of(HistoryQuery.of(\n+                ImmutableNamespaceAndUseCase.of(CLIENT, USE_CASE), lastVerified));\n+\n+        List<LogsForNamespaceAndUseCase> paxosHistory\n+                = HistoryLoaderAndTransformer.getLogsForHistoryQueries(history, historyQueries);\n+\n+        assertThat(paxosHistory.size()).isEqualTo(1);\n+        LogsForNamespaceAndUseCase logsForNamespaceAndUseCase = paxosHistory.get(0);\n+\n+        assertThat(logsForNamespaceAndUseCase.getNamespaceAndUseCase().namespace()).isEqualTo(CLIENT);\n+        assertThat(logsForNamespaceAndUseCase.getNamespaceAndUseCase().useCase()).isEqualTo(USE_CASE);\n+        assertThat(logsForNamespaceAndUseCase.getLogs().size()).isEqualTo(0);\n+    }\n+\n+    private void writeToLogs(int range) {\n+        IntStream.range(0, range).forEach(i -> {\n+            writeAcceptorStateForLogAndRound(acceptorLog, i + 1);\n+            writeValueForLogAndRound(learnerLog, i + 1);\n+        });\n+    }", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "823dd176550db19f4740b1993a2953978d928b57"}, "originalPosition": 182}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDkzNzg2NTg2", "url": "https://github.com/palantir/atlasdb/pull/4993#pullrequestreview-493786586", "createdAt": "2020-09-22T19:38:00Z", "commit": {"oid": "823dd176550db19f4740b1993a2953978d928b57"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yMlQxOTozODowMFrOHWJhkw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yMlQxOTozODowMFrOHWJhkw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5Mjk4Njc3MQ==", "bodyText": "nit: This object's used quite a bit, you can just extract it as a constant and then use it. Also for the assertions you can then use assertThat(bleh.getNamespaceAndUseCase()).isEqualTo(NAMESPACE_AND_USE_CASE)", "url": "https://github.com/palantir/atlasdb/pull/4993#discussion_r492986771", "createdAt": "2020-09-22T19:38:00Z", "author": {"login": "jeremyk-91"}, "path": "timelock-corruption-detection/src/test/java/com/palantir/history/HistoryLoaderAndTransformerTest.java", "diffHunk": "@@ -0,0 +1,183 @@\n+/*\n+ * (c) Copyright 2020 Palantir Technologies Inc. All rights reserved.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package com.palantir.history;\n+\n+import static org.assertj.core.api.Assertions.assertThat;\n+\n+import static com.palantir.history.utils.PaxosSerializationTestUtils.writeAcceptorStateForLogAndRound;\n+import static com.palantir.history.utils.PaxosSerializationTestUtils.writeValueForLogAndRound;\n+\n+import java.util.List;\n+import java.util.stream.Collectors;\n+import java.util.stream.IntStream;\n+\n+import javax.sql.DataSource;\n+\n+import org.junit.Before;\n+import org.junit.Rule;\n+import org.junit.Test;\n+import org.junit.rules.TemporaryFolder;\n+\n+import com.google.common.collect.ImmutableList;\n+import com.palantir.history.remote.HistoryLoaderAndTransformer;\n+import com.palantir.history.sqlite.SqlitePaxosStateLogHistory;\n+import com.palantir.paxos.Client;\n+import com.palantir.paxos.ImmutableNamespaceAndUseCase;\n+import com.palantir.paxos.PaxosAcceptorState;\n+import com.palantir.paxos.PaxosStateLog;\n+import com.palantir.paxos.PaxosValue;\n+import com.palantir.paxos.SqliteConnections;\n+import com.palantir.paxos.SqlitePaxosStateLog;\n+import com.palantir.timelock.history.HistoryQuery;\n+import com.palantir.timelock.history.LogsForNamespaceAndUseCase;\n+import com.palantir.timelock.history.PaxosLogWithAcceptedAndLearnedValues;\n+\n+public class HistoryLoaderAndTransformerTest {\n+    @Rule\n+    public TemporaryFolder tempFolder = new TemporaryFolder();\n+\n+    private static final Client CLIENT = Client.of(\"client\");\n+    private static final String USE_CASE = \"useCase\";\n+    private static final String USE_CASE_LEARNER = \"useCase!learner\";\n+    private static final String USE_CASE_ACCEPTOR = \"useCase!acceptor\";\n+\n+    private DataSource dataSource;\n+    private PaxosStateLog<PaxosValue> learnerLog;\n+    private PaxosStateLog<PaxosAcceptorState> acceptorLog;\n+    private LocalHistoryLoader history;\n+\n+    @Before\n+    public void setup() {\n+        dataSource = SqliteConnections.getPooledDataSource(tempFolder.getRoot().toPath());\n+        learnerLog = SqlitePaxosStateLog.create(\n+                ImmutableNamespaceAndUseCase.of(CLIENT, USE_CASE_LEARNER), dataSource);\n+        acceptorLog = SqlitePaxosStateLog.create(\n+                ImmutableNamespaceAndUseCase.of(CLIENT, USE_CASE_ACCEPTOR), dataSource);\n+        history = LocalHistoryLoader.create(SqlitePaxosStateLogHistory.create(dataSource));\n+    }\n+\n+    @Test\n+    public void canFetchLogsForQuery() {\n+        writeToLogs(100);\n+        int lastVerified = 27;\n+        List<HistoryQuery> historyQueries = ImmutableList.of(HistoryQuery.of(\n+                ImmutableNamespaceAndUseCase.of(CLIENT, USE_CASE), lastVerified));\n+        List<LogsForNamespaceAndUseCase> paxosHistory\n+                = HistoryLoaderAndTransformer.getLogsForHistoryQueries(history, historyQueries);\n+\n+        assertThat(paxosHistory.size()).isEqualTo(1);\n+        LogsForNamespaceAndUseCase logsForNamespaceAndUseCase = paxosHistory.get(0);\n+\n+        assertThat(logsForNamespaceAndUseCase.getNamespaceAndUseCase().namespace()).isEqualTo(CLIENT);\n+        assertThat(logsForNamespaceAndUseCase.getNamespaceAndUseCase().useCase()).isEqualTo(USE_CASE);\n+        assertThat(logsForNamespaceAndUseCase.getLogs().size()).isEqualTo(100 - lastVerified);\n+    }\n+\n+    @Test\n+    public void canHandleDuplicateQueries() {\n+        writeToLogs(100);\n+        int minLastVerified = 27;\n+\n+        List<HistoryQuery> queries = IntStream.range(0, 10).boxed().map(\n+                idx -> HistoryQuery.of(ImmutableNamespaceAndUseCase.of(CLIENT, USE_CASE), minLastVerified + idx))", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "823dd176550db19f4740b1993a2953978d928b57"}, "originalPosition": 96}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDk0ODQzMDY3", "url": "https://github.com/palantir/atlasdb/pull/4993#pullrequestreview-494843067", "createdAt": "2020-09-23T16:31:32Z", "commit": {"oid": "664dfc52858cb17941e619c15c7c9958c6de70e1"}, "state": "APPROVED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yM1QxNjozMTozMlrOHW28WQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yM1QxNjozMTo0OVrOHW29CA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MzczMDkwNQ==", "bodyText": "nit: as above", "url": "https://github.com/palantir/atlasdb/pull/4993#discussion_r493730905", "createdAt": "2020-09-23T16:31:32Z", "author": {"login": "jeremyk-91"}, "path": "timelock-corruption-detection/src/main/java/com/palantir/timelock/history/models/LearnerAndAcceptorRecords.java", "diffHunk": "@@ -31,4 +35,21 @@\n \n     @Value.Parameter\n     Map<Long, PaxosAcceptorState> acceptorRecords();\n+\n+    default Optional<PaxosValue> getLearnedValueAtSeqIfExists(long seq) {\n+        return Optional.ofNullable(learnerRecords().get(seq));\n+    }\n+\n+    default Optional<PaxosAcceptorState> getAcceptedValueAtSeqIfExists(long seq) {\n+        return Optional.ofNullable(acceptorRecords().getOrDefault(seq, null));", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "664dfc52858cb17941e619c15c7c9958c6de70e1"}, "originalPosition": 25}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MzczMTA4MA==", "bodyText": "\ud83d\udcaf", "url": "https://github.com/palantir/atlasdb/pull/4993#discussion_r493731080", "createdAt": "2020-09-23T16:31:49Z", "author": {"login": "jeremyk-91"}, "path": "timelock-corruption-detection/src/main/java/com/palantir/timelock/history/models/LearnerAndAcceptorRecords.java", "diffHunk": "@@ -31,4 +35,21 @@\n \n     @Value.Parameter\n     Map<Long, PaxosAcceptorState> acceptorRecords();\n+\n+    default Optional<PaxosValue> getLearnedValueAtSeqIfExists(long seq) {\n+        return Optional.ofNullable(learnerRecords().get(seq));\n+    }\n+\n+    default Optional<PaxosAcceptorState> getAcceptedValueAtSeqIfExists(long seq) {\n+        return Optional.ofNullable(acceptorRecords().getOrDefault(seq, null));\n+    }\n+\n+    // it is okay to have a set of longs as learner and acceptor records have a limit of 500 entries.", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "664dfc52858cb17941e619c15c7c9958c6de70e1"}, "originalPosition": 28}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "74ed0dee8c39ab27c1a1809c48957007d992c590", "author": {"user": {"login": "sudiksha27", "name": "sudiksha nanda"}}, "url": "https://github.com/palantir/atlasdb/commit/74ed0dee8c39ab27c1a1809c48957007d992c590", "committedDate": "2020-09-24T07:33:08Z", "message": "Local history loader"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "4b703fb4da82bf939f4a0e92b992cd87c56ac79c", "author": {"user": {"login": "sudiksha27", "name": "sudiksha nanda"}}, "url": "https://github.com/palantir/atlasdb/commit/4b703fb4da82bf939f4a0e92b992cd87c56ac79c", "committedDate": "2020-09-24T07:33:08Z", "message": "Refactor"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "87b8c564526a76963d5dfe6da066f5eb86b149ea", "author": {"user": {"login": "sudiksha27", "name": "sudiksha nanda"}}, "url": "https://github.com/palantir/atlasdb/commit/87b8c564526a76963d5dfe6da066f5eb86b149ea", "committedDate": "2020-09-24T07:33:08Z", "message": "Minor cleanup"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b747102d6dedb78132bbbab767ead2bbd7786288", "author": {"user": {"login": "sudiksha27", "name": "sudiksha nanda"}}, "url": "https://github.com/palantir/atlasdb/commit/b747102d6dedb78132bbbab767ead2bbd7786288", "committedDate": "2020-09-24T07:33:08Z", "message": "Refactor"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "bbdbfee637221f6e083cc4007faf134e4217a26f", "author": {"user": {"login": "sudiksha27", "name": "sudiksha nanda"}}, "url": "https://github.com/palantir/atlasdb/commit/bbdbfee637221f6e083cc4007faf134e4217a26f", "committedDate": "2020-09-24T07:33:08Z", "message": "Test"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "380b763df4d6c9a9bd3339bae86c16eb2af02314", "author": {"user": {"login": "sudiksha27", "name": "sudiksha nanda"}}, "url": "https://github.com/palantir/atlasdb/commit/380b763df4d6c9a9bd3339bae86c16eb2af02314", "committedDate": "2020-09-24T07:33:08Z", "message": "Refactor + remove todos"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a480f122c5cc9f44544bad07fb33d23cbe95b08c", "author": {"user": {"login": "sudiksha27", "name": "sudiksha nanda"}}, "url": "https://github.com/palantir/atlasdb/commit/a480f122c5cc9f44544bad07fb33d23cbe95b08c", "committedDate": "2020-09-24T07:33:08Z", "message": "More tests"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b7333af831c1f1b50f3d728166cc0a5e797be3ce", "author": {"user": {"login": "sudiksha27", "name": "sudiksha nanda"}}, "url": "https://github.com/palantir/atlasdb/commit/b7333af831c1f1b50f3d728166cc0a5e797be3ce", "committedDate": "2020-09-24T07:33:08Z", "message": "Remove redundant + refactor"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a543bedd107cfbad1efad4f4015a5097bc32292c", "author": {"user": {"login": "sudiksha27", "name": "sudiksha nanda"}}, "url": "https://github.com/palantir/atlasdb/commit/a543bedd107cfbad1efad4f4015a5097bc32292c", "committedDate": "2020-09-24T07:33:08Z", "message": "Fix test?"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c8ac86fd1b8446671006ccef1eb9fc08056e27e3", "author": {"user": {"login": "sudiksha27", "name": "sudiksha nanda"}}, "url": "https://github.com/palantir/atlasdb/commit/c8ac86fd1b8446671006ccef1eb9fc08056e27e3", "committedDate": "2020-09-24T07:33:08Z", "message": "Address comments - 1 | Refactor"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a7820b2d9fabe720671ddb9f88de799ccd6e7e68", "author": {"user": {"login": "sudiksha27", "name": "sudiksha nanda"}}, "url": "https://github.com/palantir/atlasdb/commit/a7820b2d9fabe720671ddb9f88de799ccd6e7e68", "committedDate": "2020-09-24T07:47:56Z", "message": "Address comments - 2 | Rename project"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "9248c39d8f09f4e9596cc52191bad5b3d820806e", "author": {"user": {"login": "sudiksha27", "name": "sudiksha nanda"}}, "url": "https://github.com/palantir/atlasdb/commit/9248c39d8f09f4e9596cc52191bad5b3d820806e", "committedDate": "2020-09-24T07:50:21Z", "message": "Add generated changelog entries"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "1ad6f004bdd8b2c7934447256e12ad44d8e13b18", "author": {"user": {"login": "sudiksha27", "name": "sudiksha nanda"}}, "url": "https://github.com/palantir/atlasdb/commit/1ad6f004bdd8b2c7934447256e12ad44d8e13b18", "committedDate": "2020-09-24T07:50:21Z", "message": "WIP | conjure"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "5dc805432541a9f4224a7e7959236afe3efc23b3", "author": {"user": {"login": "sudiksha27", "name": "sudiksha nanda"}}, "url": "https://github.com/palantir/atlasdb/commit/5dc805432541a9f4224a7e7959236afe3efc23b3", "committedDate": "2020-09-24T07:50:21Z", "message": "History provider resource"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "5a07ab04b93cb2aff969bdc12f28d6d65c0e0362", "author": {"user": {"login": "sudiksha27", "name": "sudiksha nanda"}}, "url": "https://github.com/palantir/atlasdb/commit/5a07ab04b93cb2aff969bdc12f28d6d65c0e0362", "committedDate": "2020-09-24T07:50:21Z", "message": "Fixes"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "176a050dba2c45ae6242a7bec69a394d82130d5f", "author": {"user": {"login": "sudiksha27", "name": "sudiksha nanda"}}, "url": "https://github.com/palantir/atlasdb/commit/176a050dba2c45ae6242a7bec69a394d82130d5f", "committedDate": "2020-09-24T07:50:21Z", "message": "Tests + bug fix"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "36f987984d3ad9cfd66e55fe0199a06e4f62673d", "author": {"user": {"login": "sudiksha27", "name": "sudiksha nanda"}}, "url": "https://github.com/palantir/atlasdb/commit/36f987984d3ad9cfd66e55fe0199a06e4f62673d", "committedDate": "2020-09-24T07:50:21Z", "message": "Add tests"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "cefe632b00b651860b3aa029922339a9d4d661a5", "author": {"user": {"login": "sudiksha27", "name": "sudiksha nanda"}}, "url": "https://github.com/palantir/atlasdb/commit/cefe632b00b651860b3aa029922339a9d4d661a5", "committedDate": "2020-09-24T07:50:21Z", "message": "Address comments - 1"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "bd28f1f4cd9b3ffef45720b2bd563140241f5e0b", "author": {"user": {"login": "sudiksha27", "name": "sudiksha nanda"}}, "url": "https://github.com/palantir/atlasdb/commit/bd28f1f4cd9b3ffef45720b2bd563140241f5e0b", "committedDate": "2020-09-24T07:50:21Z", "message": "Move api to timelock-corruption-detection"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b167810a5b589f29ca678e2c3cebec6ab43f2069", "author": {"user": {"login": "sudiksha27", "name": "sudiksha nanda"}}, "url": "https://github.com/palantir/atlasdb/commit/b167810a5b589f29ca678e2c3cebec6ab43f2069", "committedDate": "2020-09-24T07:50:21Z", "message": "Nits"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "2dbe59a2938364bc197ac7bb89b1f4ef99ec2588", "author": {"user": {"login": "sudiksha27", "name": "sudiksha nanda"}}, "url": "https://github.com/palantir/atlasdb/commit/2dbe59a2938364bc197ac7bb89b1f4ef99ec2588", "committedDate": "2020-09-24T07:50:22Z", "message": "Refactor"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "af1855b692cc8923d6eb7e40b291210abb578bf3", "author": {"user": {"login": "sudiksha27", "name": "sudiksha nanda"}}, "url": "https://github.com/palantir/atlasdb/commit/af1855b692cc8923d6eb7e40b291210abb578bf3", "committedDate": "2020-09-24T07:50:22Z", "message": "gitignore conjure"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c2d72587ce7a34a31bf7e5fc1ae9f5cee65f41d7", "author": {"user": {"login": "sudiksha27", "name": "sudiksha nanda"}}, "url": "https://github.com/palantir/atlasdb/commit/c2d72587ce7a34a31bf7e5fc1ae9f5cee65f41d7", "committedDate": "2020-09-24T07:50:22Z", "message": "Remove redundant"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "459f82a408775f6aaf15cfc05de8d444814114a3", "author": {"user": {"login": "sudiksha27", "name": "sudiksha nanda"}}, "url": "https://github.com/palantir/atlasdb/commit/459f82a408775f6aaf15cfc05de8d444814114a3", "committedDate": "2020-09-24T07:50:22Z", "message": "Checkstyle"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "91625c8376260f1efaae6ea458f3f4502a149dc3", "author": {"user": {"login": "sudiksha27", "name": "sudiksha nanda"}}, "url": "https://github.com/palantir/atlasdb/commit/91625c8376260f1efaae6ea458f3f4502a149dc3", "committedDate": "2020-09-24T07:50:22Z", "message": "Bump schema"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "fcc59cae584ea85f6969cb1db5cab7adf1ecfa5f", "author": {"user": {"login": "sudiksha27", "name": "sudiksha nanda"}}, "url": "https://github.com/palantir/atlasdb/commit/fcc59cae584ea85f6969cb1db5cab7adf1ecfa5f", "committedDate": "2020-09-24T07:50:22Z", "message": "Remote history response pojo"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "306893d34028624d18e9dfab4604329842e396b2", "author": {"user": {"login": "sudiksha27", "name": "sudiksha nanda"}}, "url": "https://github.com/palantir/atlasdb/commit/306893d34028624d18e9dfab4604329842e396b2", "committedDate": "2020-09-24T07:50:22Z", "message": "Address comments - 1 | tests"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "026044f18e7033640cb78122e00233d19f665e69", "author": {"user": {"login": "sudiksha27", "name": "sudiksha nanda"}}, "url": "https://github.com/palantir/atlasdb/commit/026044f18e7033640cb78122e00233d19f665e69", "committedDate": "2020-09-24T07:50:22Z", "message": "Address comments - 2"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "735a5d1713dcdafb308767c5e9257ccc985249c0", "author": {"user": {"login": "sudiksha27", "name": "sudiksha nanda"}}, "url": "https://github.com/palantir/atlasdb/commit/735a5d1713dcdafb308767c5e9257ccc985249c0", "committedDate": "2020-09-24T07:54:23Z", "message": "Address comments - 3 | Major refactor"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "7b40899857be0abfd3b122d94e52b75c36afe878", "author": {"user": {"login": "sudiksha27", "name": "sudiksha nanda"}}, "url": "https://github.com/palantir/atlasdb/commit/7b40899857be0abfd3b122d94e52b75c36afe878", "committedDate": "2020-09-24T07:54:23Z", "message": "bug fix | optional fields"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c13197f4727bda70f61b282b5002efd33071c725", "author": {"user": {"login": "sudiksha27", "name": "sudiksha nanda"}}, "url": "https://github.com/palantir/atlasdb/commit/c13197f4727bda70f61b282b5002efd33071c725", "committedDate": "2020-09-24T07:54:23Z", "message": "remove redundant code + comment"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "04dae916a70585388c89ac072435463f18d08391", "author": {"user": {"login": "sudiksha27", "name": "sudiksha nanda"}}, "url": "https://github.com/palantir/atlasdb/commit/04dae916a70585388c89ac072435463f18d08391", "committedDate": "2020-09-24T07:55:57Z", "message": "Wire"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "de621c3ad66dfcf112d453baa0ab7b3b893b9e7c", "author": {"user": {"login": "sudiksha27", "name": "sudiksha nanda"}}, "url": "https://github.com/palantir/atlasdb/commit/de621c3ad66dfcf112d453baa0ab7b3b893b9e7c", "committedDate": "2020-09-24T07:55:57Z", "message": "Address comments"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "0373296016aefb0251c9c120f338e9bb259578f8", "author": {"user": {"login": "sudiksha27", "name": "sudiksha nanda"}}, "url": "https://github.com/palantir/atlasdb/commit/0373296016aefb0251c9c120f338e9bb259578f8", "committedDate": "2020-09-24T07:55:57Z", "message": "Autorelease 0.247.2-rc2"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "42f2c0e5be70a45be40d8af8cdfb560b490059b9", "author": {"user": {"login": "sudiksha27", "name": "sudiksha nanda"}}, "url": "https://github.com/palantir/atlasdb/commit/42f2c0e5be70a45be40d8af8cdfb560b490059b9", "committedDate": "2020-09-24T07:57:33Z", "message": "Checkstyles"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "465d0b0e6e89bfc75a34501068decbc07dfa858c", "author": {"user": {"login": "sudiksha27", "name": "sudiksha nanda"}}, "url": "https://github.com/palantir/atlasdb/commit/465d0b0e6e89bfc75a34501068decbc07dfa858c", "committedDate": "2020-09-24T07:57:59Z", "message": "CheckstyleTest"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "6bb6457db06ec586bb38be1a24d7c8d02f15522d", "author": {"user": {"login": "sudiksha27", "name": "sudiksha nanda"}}, "url": "https://github.com/palantir/atlasdb/commit/6bb6457db06ec586bb38be1a24d7c8d02f15522d", "committedDate": "2020-09-23T17:30:52Z", "message": "Autorelease 0.247.2-rc4"}, "afterCommit": {"oid": "465d0b0e6e89bfc75a34501068decbc07dfa858c", "author": {"user": {"login": "sudiksha27", "name": "sudiksha nanda"}}, "url": "https://github.com/palantir/atlasdb/commit/465d0b0e6e89bfc75a34501068decbc07dfa858c", "committedDate": "2020-09-24T07:57:59Z", "message": "CheckstyleTest"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c1816c2c0c9b052decc2acb475d0316c4e56a0f8", "author": {"user": {"login": "sudiksha27", "name": "sudiksha nanda"}}, "url": "https://github.com/palantir/atlasdb/commit/c1816c2c0c9b052decc2acb475d0316c4e56a0f8", "committedDate": "2020-09-24T08:38:15Z", "message": "FIx"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "1400b8524bd5ee8f885ced8b07f7afe88aad2d38", "author": {"user": {"login": "sudiksha27", "name": "sudiksha nanda"}}, "url": "https://github.com/palantir/atlasdb/commit/1400b8524bd5ee8f885ced8b07f7afe88aad2d38", "committedDate": "2020-09-24T09:23:41Z", "message": "Bug fix + refactor"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "caccb19e3df6cbe4894e1581fa876f65a70fd724", "author": {"user": {"login": "sudiksha27", "name": "sudiksha nanda"}}, "url": "https://github.com/palantir/atlasdb/commit/caccb19e3df6cbe4894e1581fa876f65a70fd724", "committedDate": "2020-09-24T09:24:56Z", "message": "Minor"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a8d392011d9136fa063be17d8b2ffbb6526c9b50", "author": {"user": {"login": "sudiksha27", "name": "sudiksha nanda"}}, "url": "https://github.com/palantir/atlasdb/commit/a8d392011d9136fa063be17d8b2ffbb6526c9b50", "committedDate": "2020-09-24T10:02:14Z", "message": "Bug fix + checkstyle"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "97744926b4006e5e4f7c1533b4bf921d33c93aba", "author": {"user": {"login": "sudiksha27", "name": "sudiksha nanda"}}, "url": "https://github.com/palantir/atlasdb/commit/97744926b4006e5e4f7c1533b4bf921d33c93aba", "committedDate": "2020-09-24T10:02:14Z", "message": "Add generated changelog entries"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e3d8ed2831d5ebe56a52ead27396650559d0e31a", "author": {"user": {"login": "sudiksha27", "name": "sudiksha nanda"}}, "url": "https://github.com/palantir/atlasdb/commit/e3d8ed2831d5ebe56a52ead27396650559d0e31a", "committedDate": "2020-09-24T10:12:59Z", "message": "Bump schema"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "2023cccb0d66d3f5ba78d7c78b87d4b57f460982", "author": {"user": {"login": "sudiksha27", "name": "sudiksha nanda"}}, "url": "https://github.com/palantir/atlasdb/commit/2023cccb0d66d3f5ba78d7c78b87d4b57f460982", "committedDate": "2020-09-24T10:16:05Z", "message": "Fix"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f549c84364c8ae91e32f7ba7df50ff40ca4bdd41", "author": {"user": {"login": "sudiksha27", "name": "sudiksha nanda"}}, "url": "https://github.com/palantir/atlasdb/commit/f549c84364c8ae91e32f7ba7df50ff40ca4bdd41", "committedDate": "2020-09-24T10:16:54Z", "message": "Minor refactor"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "80fd9d15f564a81235ae61fcfeff9bdbfe8393db", "author": {"user": {"login": "sudiksha27", "name": "sudiksha nanda"}}, "url": "https://github.com/palantir/atlasdb/commit/80fd9d15f564a81235ae61fcfeff9bdbfe8393db", "committedDate": "2020-09-24T10:18:47Z", "message": "remove redundant"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "7e72cbf9b487a2f0bf823715458571bbde0a9082", "author": {"user": {"login": "sudiksha27", "name": "sudiksha nanda"}}, "url": "https://github.com/palantir/atlasdb/commit/7e72cbf9b487a2f0bf823715458571bbde0a9082", "committedDate": "2020-09-24T11:04:49Z", "message": "Schema bump not required"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2587, "cost": 1, "resetAt": "2021-11-01T16:19:10Z"}}}