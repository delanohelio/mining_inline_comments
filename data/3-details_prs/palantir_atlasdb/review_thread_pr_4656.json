{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0MzkxMTE1ODEw", "number": 4656, "reviewThreads": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yNFQxMTo1MToyNVrODqwcvA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wN1QxOTozMzo1MVrODvtfcw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjQ2MTYwNTcyOnYy", "diffSide": "RIGHT", "path": "atlasdb-impl-shared/src/main/java/com/palantir/atlasdb/transaction/impl/SnapshotTransaction.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yNFQxMTo1MToyNVrOF6ssnQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yNFQxMTo1MToyNVrOF6ssnQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NzA5NDA0NQ==", "bodyText": "We should have a comment here as to why this method is supposed to be static", "url": "https://github.com/palantir/atlasdb/pull/4656#discussion_r397094045", "createdAt": "2020-03-24T11:51:25Z", "author": {"login": "sudiksha27"}, "path": "atlasdb-impl-shared/src/main/java/com/palantir/atlasdb/transaction/impl/SnapshotTransaction.java", "diffHunk": "@@ -1928,7 +1928,7 @@ private boolean rollbackFailedTransactions(\n         return true;\n     }\n \n-    private void deleteCells(TableReference tableRef, Map<Cell, Long> keysToDelete) {\n+    private static void deleteCells(KeyValueService keyValueService, TableReference tableRef, Map<Cell, Long> keysToDelete) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "3e578efd676fd92703ff4f7cc1cab1fb24243f5e"}, "originalPosition": 14}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjUxMTc2MDIwOnYy", "diffSide": "RIGHT", "path": "atlasdb-impl-shared/src/main/java/com/palantir/atlasdb/transaction/impl/SnapshotTransaction.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wN1QxMjozNTozMlrOGCBYWA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wN1QxMjozNTozMlrOGCBYWA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNDc3Mjk1Mg==", "bodyText": "nit: bracketing\n\n  \n    \n  \n    \n\n  \n  This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters. Learn more about bidirectional Unicode characters\n\n\n  \n\n\n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                        Map<Cell, Long> keysToDelete\n          \n          \n            \n                ) {\n          \n          \n            \n                        Map<Cell, Long> keysToDelete) {", "url": "https://github.com/palantir/atlasdb/pull/4656#discussion_r404772952", "createdAt": "2020-04-07T12:35:32Z", "author": {"login": "jeremyk-91"}, "path": "atlasdb-impl-shared/src/main/java/com/palantir/atlasdb/transaction/impl/SnapshotTransaction.java", "diffHunk": "@@ -1928,7 +1928,15 @@ private boolean rollbackFailedTransactions(\n         return true;\n     }\n \n-    private void deleteCells(TableReference tableRef, Map<Cell, Long> keysToDelete) {\n+    /**\n+     * This method is made static so it loses reference to the SnapshotTransaction reference\n+     * when passed to deleteExecutor::execute in a lambda reducing its retained memory size.\n+     */\n+    private static void deleteCells(\n+            KeyValueService keyValueService,\n+            TableReference tableRef,\n+            Map<Cell, Long> keysToDelete\n+    ) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "3e3bd57163e74560f81cada7a59810439d0e443b"}, "originalPosition": 22}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjUxMzU0OTk1OnYy", "diffSide": "RIGHT", "path": "changelog/@unreleased/pr-4656.v2.yml", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wN1QxOTozMzo1MVrOGCS_4w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wN1QxOTozMzo1MVrOGCS_4w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNTA2MTYwMw==", "bodyText": "minor nits/technicalities: the reference to a SnapshotTransaction can't be huge, it's just the word size. Maybe instead something like which could mean a lot of memory was unnecessarily retained?", "url": "https://github.com/palantir/atlasdb/pull/4656#discussion_r405061603", "createdAt": "2020-04-07T19:33:51Z", "author": {"login": "jeremyk-91"}, "path": "changelog/@unreleased/pr-4656.v2.yml", "diffHunk": "@@ -0,0 +1,6 @@\n+type: improvement\n+improvement:\n+  description: |\n+    The retained memory in delete executor work queue is reduced. Previously, each runnable in deleteExecutor had SnapshotTransaction reference, which can be potentially huge.", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "3e3bd57163e74560f81cada7a59810439d0e443b"}, "originalPosition": 4}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2985, "cost": 1, "resetAt": "2021-11-12T12:57:47Z"}}}