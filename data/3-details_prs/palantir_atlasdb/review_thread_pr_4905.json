{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDUzMjE5OTQ3", "number": 4905, "reviewThreads": {"totalCount": 6, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yMFQwOTowNzo1OVrOEQD7gA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yMFQwOTowOToxNFrOEQD9yw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjg1Mjc3MDU2OnYy", "diffSide": "RIGHT", "path": "atlasdb-dbkvs-hikari/src/main/java/com/palantir/nexus/db/pool/HikariCPConnectionManager.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yMFQwOTowNzo1OVrOG0BcfQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yMFQwOTowNzo1OVrOG0BcfQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NzIwMjgxMw==", "bodyText": "I think these all become unsafe anyway, but it's good hygiene.", "url": "https://github.com/palantir/atlasdb/pull/4905#discussion_r457202813", "createdAt": "2020-07-20T09:07:59Z", "author": {"login": "jkozlowski"}, "path": "atlasdb-dbkvs-hikari/src/main/java/com/palantir/nexus/db/pool/HikariCPConnectionManager.java", "diffHunk": "@@ -237,7 +237,7 @@ public synchronized void close() {\n                     if (log.isDebugEnabled()) {\n                         log.debug(\n                                 \"Closing connection pool: {}\",\n-                                connConfig,\n+                                UnsafeArg.of(\"connConfig\", connConfig),", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "464c4082c4043702d1f34700301b03318149d160"}, "originalPosition": 5}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjg1Mjc3MTI3OnYy", "diffSide": "RIGHT", "path": "atlasdb-dbkvs-hikari/src/main/java/com/palantir/nexus/db/pool/HikariCPConnectionManager.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yMFQwOTowODoxMlrOG0Bc7w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yMFQwOToxOTo1OVrOG0B-Yg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NzIwMjkyNw==", "bodyText": "Remove the '{}'", "url": "https://github.com/palantir/atlasdb/pull/4905#discussion_r457202927", "createdAt": "2020-07-20T09:08:12Z", "author": {"login": "jkozlowski"}, "path": "atlasdb-dbkvs-hikari/src/main/java/com/palantir/nexus/db/pool/HikariCPConnectionManager.java", "diffHunk": "@@ -237,7 +237,7 @@ public synchronized void close() {\n                     if (log.isDebugEnabled()) {\n                         log.debug(\n                                 \"Closing connection pool: {}\",", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "464c4082c4043702d1f34700301b03318149d160"}, "originalPosition": 3}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NzIxMTQ5MA==", "bodyText": "Done", "url": "https://github.com/palantir/atlasdb/pull/4905#discussion_r457211490", "createdAt": "2020-07-20T09:19:59Z", "author": {"login": "Jolyon-S"}, "path": "atlasdb-dbkvs-hikari/src/main/java/com/palantir/nexus/db/pool/HikariCPConnectionManager.java", "diffHunk": "@@ -237,7 +237,7 @@ public synchronized void close() {\n                     if (log.isDebugEnabled()) {\n                         log.debug(\n                                 \"Closing connection pool: {}\",", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NzIwMjkyNw=="}, "originalCommit": {"oid": "464c4082c4043702d1f34700301b03318149d160"}, "originalPosition": 3}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjg1Mjc3MTk4OnYy", "diffSide": "RIGHT", "path": "atlasdb-dbkvs-hikari/src/main/java/com/palantir/nexus/db/pool/HikariCPConnectionManager.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yMFQwOTowODoyMFrOG0BdSg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yMFQwOToyMDoxOVrOG0B_Rw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NzIwMzAxOA==", "bodyText": "Ditto", "url": "https://github.com/palantir/atlasdb/pull/4905#discussion_r457203018", "createdAt": "2020-07-20T09:08:20Z", "author": {"login": "jkozlowski"}, "path": "atlasdb-dbkvs-hikari/src/main/java/com/palantir/nexus/db/pool/HikariCPConnectionManager.java", "diffHunk": "@@ -282,7 +282,8 @@ private State normalState() throws SQLException {\n     private HikariDataSource getDataSourcePool() {\n         // Print a stack trace whenever we initialize a pool\n         if (log.isDebugEnabled()) {\n-            log.debug(\"Initializing connection pool: {}\", connConfig,\n+            log.debug(\"Initializing connection pool: {}\",", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "464c4082c4043702d1f34700301b03318149d160"}, "originalPosition": 14}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NzIxMTcxOQ==", "bodyText": "Done", "url": "https://github.com/palantir/atlasdb/pull/4905#discussion_r457211719", "createdAt": "2020-07-20T09:20:19Z", "author": {"login": "Jolyon-S"}, "path": "atlasdb-dbkvs-hikari/src/main/java/com/palantir/nexus/db/pool/HikariCPConnectionManager.java", "diffHunk": "@@ -282,7 +282,8 @@ private State normalState() throws SQLException {\n     private HikariDataSource getDataSourcePool() {\n         // Print a stack trace whenever we initialize a pool\n         if (log.isDebugEnabled()) {\n-            log.debug(\"Initializing connection pool: {}\", connConfig,\n+            log.debug(\"Initializing connection pool: {}\",", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NzIwMzAxOA=="}, "originalCommit": {"oid": "464c4082c4043702d1f34700301b03318149d160"}, "originalPosition": 14}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjg1Mjc3NDEwOnYy", "diffSide": "RIGHT", "path": "atlasdb-dbkvs-hikari/src/main/java/com/palantir/nexus/db/pool/HikariCPConnectionManager.java", "isResolved": true, "comments": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yMFQwOTowODo0NVrOG0BecQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yMFQwOToyNjowNFrOG0CP4Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NzIwMzMxMw==", "bodyText": "Check if this has hostnames, cause I don't think these are allowed?", "url": "https://github.com/palantir/atlasdb/pull/4905#discussion_r457203313", "createdAt": "2020-07-20T09:08:45Z", "author": {"login": "jkozlowski"}, "path": "atlasdb-dbkvs-hikari/src/main/java/com/palantir/nexus/db/pool/HikariCPConnectionManager.java", "diffHunk": "@@ -304,7 +305,9 @@ private HikariDataSource getDataSourcePool() {\n             }\n         } catch (PoolInitializationException e) {\n             log.error(\"[{}] Failed to initialize hikari data source: {}\",\n-                    connConfig.getConnectionPoolName(), connConfig.getUrl(), e);\n+                    SafeArg.of(\"connectionPoolName\", connConfig.getConnectionPoolName()),", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "464c4082c4043702d1f34700301b03318149d160"}, "originalPosition": 24}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NzIwNDgyNQ==", "bodyText": "Yeah, so internal spec says that managed hosts are safe. But I'm not convinced that this will always be the case here e.g. if this is running with Oracle (would this be running on Oracle?), so I'd prefer we keep unsafe until we're told otherwise.", "url": "https://github.com/palantir/atlasdb/pull/4905#discussion_r457204825", "createdAt": "2020-07-20T09:10:55Z", "author": {"login": "jkozlowski"}, "path": "atlasdb-dbkvs-hikari/src/main/java/com/palantir/nexus/db/pool/HikariCPConnectionManager.java", "diffHunk": "@@ -304,7 +305,9 @@ private HikariDataSource getDataSourcePool() {\n             }\n         } catch (PoolInitializationException e) {\n             log.error(\"[{}] Failed to initialize hikari data source: {}\",\n-                    connConfig.getConnectionPoolName(), connConfig.getUrl(), e);\n+                    SafeArg.of(\"connectionPoolName\", connConfig.getConnectionPoolName()),", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NzIwMzMxMw=="}, "originalCommit": {"oid": "464c4082c4043702d1f34700301b03318149d160"}, "originalPosition": 24}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NzIxNTE4MQ==", "bodyText": "In the previous PR to add some safe logging, this was added as Safe in other places, so I was following suit.\ngetConnectionPoolName is constructed as getConnectionPoolIdentifier()-getConnId(), where the former is db-pool and the latter is atlas as defaults. Obviously these can be overridden in the config, but I'd assume those two fields, given that they are just config (and not passwords or anything of that calibre either) would be fine, but maybe not.", "url": "https://github.com/palantir/atlasdb/pull/4905#discussion_r457215181", "createdAt": "2020-07-20T09:25:00Z", "author": {"login": "Jolyon-S"}, "path": "atlasdb-dbkvs-hikari/src/main/java/com/palantir/nexus/db/pool/HikariCPConnectionManager.java", "diffHunk": "@@ -304,7 +305,9 @@ private HikariDataSource getDataSourcePool() {\n             }\n         } catch (PoolInitializationException e) {\n             log.error(\"[{}] Failed to initialize hikari data source: {}\",\n-                    connConfig.getConnectionPoolName(), connConfig.getUrl(), e);\n+                    SafeArg.of(\"connectionPoolName\", connConfig.getConnectionPoolName()),", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NzIwMzMxMw=="}, "originalCommit": {"oid": "464c4082c4043702d1f34700301b03318149d160"}, "originalPosition": 24}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NzIxNTk2OQ==", "bodyText": "ok", "url": "https://github.com/palantir/atlasdb/pull/4905#discussion_r457215969", "createdAt": "2020-07-20T09:26:04Z", "author": {"login": "jkozlowski"}, "path": "atlasdb-dbkvs-hikari/src/main/java/com/palantir/nexus/db/pool/HikariCPConnectionManager.java", "diffHunk": "@@ -304,7 +305,9 @@ private HikariDataSource getDataSourcePool() {\n             }\n         } catch (PoolInitializationException e) {\n             log.error(\"[{}] Failed to initialize hikari data source: {}\",\n-                    connConfig.getConnectionPoolName(), connConfig.getUrl(), e);\n+                    SafeArg.of(\"connectionPoolName\", connConfig.getConnectionPoolName()),", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NzIwMzMxMw=="}, "originalCommit": {"oid": "464c4082c4043702d1f34700301b03318149d160"}, "originalPosition": 24}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjg1Mjc3NTMwOnYy", "diffSide": "RIGHT", "path": "atlasdb-dbkvs-hikari/src/main/java/com/palantir/nexus/db/pool/HikariCPConnectionManager.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yMFQwOTowODo1OVrOG0BfIQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yMFQwOToyMDozNFrOG0CAEA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NzIwMzQ4OQ==", "bodyText": "Remove placeholders", "url": "https://github.com/palantir/atlasdb/pull/4905#discussion_r457203489", "createdAt": "2020-07-20T09:08:59Z", "author": {"login": "jkozlowski"}, "path": "atlasdb-dbkvs-hikari/src/main/java/com/palantir/nexus/db/pool/HikariCPConnectionManager.java", "diffHunk": "@@ -304,7 +305,9 @@ private HikariDataSource getDataSourcePool() {\n             }\n         } catch (PoolInitializationException e) {\n             log.error(\"[{}] Failed to initialize hikari data source: {}\",", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "464c4082c4043702d1f34700301b03318149d160"}, "originalPosition": 22}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NzIxMTkyMA==", "bodyText": "Done", "url": "https://github.com/palantir/atlasdb/pull/4905#discussion_r457211920", "createdAt": "2020-07-20T09:20:34Z", "author": {"login": "Jolyon-S"}, "path": "atlasdb-dbkvs-hikari/src/main/java/com/palantir/nexus/db/pool/HikariCPConnectionManager.java", "diffHunk": "@@ -304,7 +305,9 @@ private HikariDataSource getDataSourcePool() {\n             }\n         } catch (PoolInitializationException e) {\n             log.error(\"[{}] Failed to initialize hikari data source: {}\",", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NzIwMzQ4OQ=="}, "originalCommit": {"oid": "464c4082c4043702d1f34700301b03318149d160"}, "originalPosition": 22}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjg1Mjc3NjQzOnYy", "diffSide": "RIGHT", "path": "atlasdb-dbkvs-hikari/src/main/java/com/palantir/nexus/db/pool/HikariCPConnectionManager.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yMFQwOTowOToxNFrOG0Bfwg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yMFQwOTowOToxNFrOG0Bfwg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NzIwMzY1MA==", "bodyText": "Same here, check conection pool what it contains", "url": "https://github.com/palantir/atlasdb/pull/4905#discussion_r457203650", "createdAt": "2020-07-20T09:09:14Z", "author": {"login": "jkozlowski"}, "path": "atlasdb-dbkvs-hikari/src/main/java/com/palantir/nexus/db/pool/HikariCPConnectionManager.java", "diffHunk": "@@ -345,7 +348,9 @@ private HikariPoolMXBean initPoolMbeans() {\n         try {\n             poolName = new ObjectName(\"com.zaxxer.hikari:type=Pool (\" + connConfig.getConnectionPoolName() + \")\");\n         } catch (MalformedObjectNameException e) {\n-            log.error(\"Unable to setup mBean monitoring for pool {}.\", connConfig.getConnectionPoolName(), e);\n+            log.error(\"Unable to setup mBean monitoring for pool {}.\",\n+                    SafeArg.of(\"connectionPoolName\", connConfig.getConnectionPoolName()),", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "464c4082c4043702d1f34700301b03318149d160"}, "originalPosition": 36}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2731, "cost": 1, "resetAt": "2021-11-12T12:57:47Z"}}}