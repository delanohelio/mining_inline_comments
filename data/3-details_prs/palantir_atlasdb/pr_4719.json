{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDA1MTIwNTYw", "number": 4719, "title": "[Timelock Partitioning] Tag remote hosts for internode communication", "bodyText": "Goals (and why):\nTag remote hosts for internode communication\nImplementation Description (bullets):\nAdd the tag at the rpc client level\nTesting (What was existing testing like?  What have you done to improve it?):\nNone\nConcerns (what feedback would you like?):\nWe don't tag the clients at the level of NetworkClientFactories. We can easily do this, but it requires some more wiring, and increases our metrics cardinality. Is it worth it>\nWhere should we start reviewing?:\ntiny\nPriority (whenever / two weeks / yesterday):\nNow?", "createdAt": "2020-04-17T13:04:39Z", "url": "https://github.com/palantir/atlasdb/pull/4719", "merged": true, "mergeCommit": {"oid": "79b31f2b8f903c02e42fc2ad5805674f827b9980"}, "closed": true, "closedAt": "2020-04-20T11:35:30Z", "author": {"login": "gmaretic"}, "timelineItems": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcYgz7ogH2gAyNDA1MTIwNTYwOmRmYWEzOWI4YjZjNDk0ZTM3YTNlM2EwYmFiNGZhYzg0ZjQyZGRlYWY=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcYkj5DgFqTM5NTYzMzI1OQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "dfaa39b8b6c494e37a3e3a0bab4fac84f42ddeaf", "author": {"user": {"login": "gmaretic", "name": null}}, "url": "https://github.com/palantir/atlasdb/commit/dfaa39b8b6c494e37a3e3a0bab4fac84f42ddeaf", "committedDate": "2020-04-17T12:53:57Z", "message": "Tag remote hosts for internode communication"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzk1NjEwMTA1", "url": "https://github.com/palantir/atlasdb/pull/4719#pullrequestreview-395610105", "createdAt": "2020-04-17T16:42:00Z", "commit": {"oid": "dfaa39b8b6c494e37a3e3a0bab4fac84f42ddeaf"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0xN1QxNjo0MjowMFrOGHVTJg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0xN1QxNjo0MjowMFrOGHVTJg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMDM0MjE4Mg==", "bodyText": "Is this risky in terms of metrics cardinality? I'm in the process of checking with the internal team that's responsible for this", "url": "https://github.com/palantir/atlasdb/pull/4719#discussion_r410342182", "createdAt": "2020-04-17T16:42:00Z", "author": {"login": "jeremyk-91"}, "path": "timelock-agent/src/main/java/com/palantir/atlasdb/timelock/paxos/PaxosRemoteClients.java", "diffHunk": "@@ -160,7 +161,11 @@\n                                 .remotingClientConfig(() -> RemotingClientConfigs.DEFAULT)\n                                 .shouldSupportBlockingOperations(false)\n                                 .build()))\n-                .map(proxy -> AtlasDbMetrics.instrumentWithTaggedMetrics(metrics().getTaggedRegistry(), clazz, proxy));\n+                .map((host, proxy) -> AtlasDbMetrics.instrumentWithTaggedMetrics(\n+                        metrics().getTaggedRegistry(),\n+                        clazz,\n+                        proxy,\n+                        any -> ImmutableMap.of(AtlasDbMetricNames.TAG_REMOTE_HOST, host)));", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "dfaa39b8b6c494e37a3e3a0bab4fac84f42ddeaf"}, "originalPosition": 17}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzk1NjMzMjU5", "url": "https://github.com/palantir/atlasdb/pull/4719#pullrequestreview-395633259", "createdAt": "2020-04-17T17:16:03Z", "commit": {"oid": "dfaa39b8b6c494e37a3e3a0bab4fac84f42ddeaf"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3072, "cost": 1, "resetAt": "2021-11-01T16:19:10Z"}}}