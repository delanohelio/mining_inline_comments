{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDUzMjE5OTQ3", "number": 4905, "title": "Make all logging HikariCPConnectionManager SLS", "bodyText": "Goals (and why):\n\nNot all arguments logged are correctly captured by (Un)safe args.\n\nImplementation Description (bullets):\n\nAll arguments passed into logging messages (with the exception of exceptions) are captured in Safe or Unsafe args.\n\nTesting (What was existing testing like?  What have you done to improve it?):\nN/A\nConcerns (what feedback would you like?):\nPlease verify that this fully adheres to internal specifications.\nWhere should we start reviewing?:\nHikariCPConnectionManager.\nPriority (whenever / two weeks / yesterday):\nThis week.", "createdAt": "2020-07-20T09:00:04Z", "url": "https://github.com/palantir/atlasdb/pull/4905", "merged": true, "mergeCommit": {"oid": "022f6f15dcccff9440200cfa1fc798b9e0924a11"}, "closed": true, "closedAt": "2020-07-20T09:38:24Z", "author": {"login": "Jolyon-S"}, "timelineItems": {"totalCount": 7, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABc2twkLAH2gAyNDUzMjE5OTQ3Ojc5YmEwY2NmODZmYjg1NDcyNzNhMzMwY2U1NTY0NzIwOWZjZjM0MWI=", "endCursor": "Y3Vyc29yOnYyOpPPAAABc2uMnGAH2gAyNDUzMjE5OTQ3OjZiNDEzMzE3OGQ1MmZkZmY1NjViYjJhYjcxZjcxYzMwMzg3MTg5ZGM=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "79ba0ccf86fb8547273a330ce55647209fcf341b", "author": {"user": {"login": "Jolyon-S", "name": "Jolyon"}}, "url": "https://github.com/palantir/atlasdb/commit/79ba0ccf86fb8547273a330ce55647209fcf341b", "committedDate": "2020-07-20T08:56:46Z", "message": "SLS logging the rest"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "464c4082c4043702d1f34700301b03318149d160", "author": {"user": {"login": "Jolyon-S", "name": "Jolyon"}}, "url": "https://github.com/palantir/atlasdb/commit/464c4082c4043702d1f34700301b03318149d160", "committedDate": "2020-07-20T08:56:46Z", "message": "Add generated changelog entries"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDUxNDI3ODEw", "url": "https://github.com/palantir/atlasdb/pull/4905#pullrequestreview-451427810", "createdAt": "2020-07-20T09:07:59Z", "commit": {"oid": "464c4082c4043702d1f34700301b03318149d160"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yMFQwOTowNzo1OVrOG0BcfQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yMFQwOTowNzo1OVrOG0BcfQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NzIwMjgxMw==", "bodyText": "I think these all become unsafe anyway, but it's good hygiene.", "url": "https://github.com/palantir/atlasdb/pull/4905#discussion_r457202813", "createdAt": "2020-07-20T09:07:59Z", "author": {"login": "jkozlowski"}, "path": "atlasdb-dbkvs-hikari/src/main/java/com/palantir/nexus/db/pool/HikariCPConnectionManager.java", "diffHunk": "@@ -237,7 +237,7 @@ public synchronized void close() {\n                     if (log.isDebugEnabled()) {\n                         log.debug(\n                                 \"Closing connection pool: {}\",\n-                                connConfig,\n+                                UnsafeArg.of(\"connConfig\", connConfig),", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "464c4082c4043702d1f34700301b03318149d160"}, "originalPosition": 5}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDUxNDI3OTYx", "url": "https://github.com/palantir/atlasdb/pull/4905#pullrequestreview-451427961", "createdAt": "2020-07-20T09:08:12Z", "commit": {"oid": "464c4082c4043702d1f34700301b03318149d160"}, "state": "COMMENTED", "comments": {"totalCount": 6, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yMFQwOTowODoxMlrOG0Bc7w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yMFQwOToxMDo1NVrOG0BkWQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NzIwMjkyNw==", "bodyText": "Remove the '{}'", "url": "https://github.com/palantir/atlasdb/pull/4905#discussion_r457202927", "createdAt": "2020-07-20T09:08:12Z", "author": {"login": "jkozlowski"}, "path": "atlasdb-dbkvs-hikari/src/main/java/com/palantir/nexus/db/pool/HikariCPConnectionManager.java", "diffHunk": "@@ -237,7 +237,7 @@ public synchronized void close() {\n                     if (log.isDebugEnabled()) {\n                         log.debug(\n                                 \"Closing connection pool: {}\",", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "464c4082c4043702d1f34700301b03318149d160"}, "originalPosition": 3}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NzIwMzAxOA==", "bodyText": "Ditto", "url": "https://github.com/palantir/atlasdb/pull/4905#discussion_r457203018", "createdAt": "2020-07-20T09:08:20Z", "author": {"login": "jkozlowski"}, "path": "atlasdb-dbkvs-hikari/src/main/java/com/palantir/nexus/db/pool/HikariCPConnectionManager.java", "diffHunk": "@@ -282,7 +282,8 @@ private State normalState() throws SQLException {\n     private HikariDataSource getDataSourcePool() {\n         // Print a stack trace whenever we initialize a pool\n         if (log.isDebugEnabled()) {\n-            log.debug(\"Initializing connection pool: {}\", connConfig,\n+            log.debug(\"Initializing connection pool: {}\",", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "464c4082c4043702d1f34700301b03318149d160"}, "originalPosition": 14}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NzIwMzMxMw==", "bodyText": "Check if this has hostnames, cause I don't think these are allowed?", "url": "https://github.com/palantir/atlasdb/pull/4905#discussion_r457203313", "createdAt": "2020-07-20T09:08:45Z", "author": {"login": "jkozlowski"}, "path": "atlasdb-dbkvs-hikari/src/main/java/com/palantir/nexus/db/pool/HikariCPConnectionManager.java", "diffHunk": "@@ -304,7 +305,9 @@ private HikariDataSource getDataSourcePool() {\n             }\n         } catch (PoolInitializationException e) {\n             log.error(\"[{}] Failed to initialize hikari data source: {}\",\n-                    connConfig.getConnectionPoolName(), connConfig.getUrl(), e);\n+                    SafeArg.of(\"connectionPoolName\", connConfig.getConnectionPoolName()),", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "464c4082c4043702d1f34700301b03318149d160"}, "originalPosition": 24}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NzIwMzQ4OQ==", "bodyText": "Remove placeholders", "url": "https://github.com/palantir/atlasdb/pull/4905#discussion_r457203489", "createdAt": "2020-07-20T09:08:59Z", "author": {"login": "jkozlowski"}, "path": "atlasdb-dbkvs-hikari/src/main/java/com/palantir/nexus/db/pool/HikariCPConnectionManager.java", "diffHunk": "@@ -304,7 +305,9 @@ private HikariDataSource getDataSourcePool() {\n             }\n         } catch (PoolInitializationException e) {\n             log.error(\"[{}] Failed to initialize hikari data source: {}\",", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "464c4082c4043702d1f34700301b03318149d160"}, "originalPosition": 22}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NzIwMzY1MA==", "bodyText": "Same here, check conection pool what it contains", "url": "https://github.com/palantir/atlasdb/pull/4905#discussion_r457203650", "createdAt": "2020-07-20T09:09:14Z", "author": {"login": "jkozlowski"}, "path": "atlasdb-dbkvs-hikari/src/main/java/com/palantir/nexus/db/pool/HikariCPConnectionManager.java", "diffHunk": "@@ -345,7 +348,9 @@ private HikariPoolMXBean initPoolMbeans() {\n         try {\n             poolName = new ObjectName(\"com.zaxxer.hikari:type=Pool (\" + connConfig.getConnectionPoolName() + \")\");\n         } catch (MalformedObjectNameException e) {\n-            log.error(\"Unable to setup mBean monitoring for pool {}.\", connConfig.getConnectionPoolName(), e);\n+            log.error(\"Unable to setup mBean monitoring for pool {}.\",\n+                    SafeArg.of(\"connectionPoolName\", connConfig.getConnectionPoolName()),", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "464c4082c4043702d1f34700301b03318149d160"}, "originalPosition": 36}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NzIwNDgyNQ==", "bodyText": "Yeah, so internal spec says that managed hosts are safe. But I'm not convinced that this will always be the case here e.g. if this is running with Oracle (would this be running on Oracle?), so I'd prefer we keep unsafe until we're told otherwise.", "url": "https://github.com/palantir/atlasdb/pull/4905#discussion_r457204825", "createdAt": "2020-07-20T09:10:55Z", "author": {"login": "jkozlowski"}, "path": "atlasdb-dbkvs-hikari/src/main/java/com/palantir/nexus/db/pool/HikariCPConnectionManager.java", "diffHunk": "@@ -304,7 +305,9 @@ private HikariDataSource getDataSourcePool() {\n             }\n         } catch (PoolInitializationException e) {\n             log.error(\"[{}] Failed to initialize hikari data source: {}\",\n-                    connConfig.getConnectionPoolName(), connConfig.getUrl(), e);\n+                    SafeArg.of(\"connectionPoolName\", connConfig.getConnectionPoolName()),", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NzIwMzMxMw=="}, "originalCommit": {"oid": "464c4082c4043702d1f34700301b03318149d160"}, "originalPosition": 24}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDUxNDQxMDgy", "url": "https://github.com/palantir/atlasdb/pull/4905#pullrequestreview-451441082", "createdAt": "2020-07-20T09:26:14Z", "commit": {"oid": "464c4082c4043702d1f34700301b03318149d160"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "47ba4124bd2d2724edca1721faf844fe49ef8da8", "author": {"user": {"login": "Jolyon-S", "name": "Jolyon"}}, "url": "https://github.com/palantir/atlasdb/commit/47ba4124bd2d2724edca1721faf844fe49ef8da8", "committedDate": "2020-07-20T09:27:08Z", "message": "PR comments"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "6b4133178d52fdff565bb2ab71f71c30387189dc", "author": {"user": {"login": "Jolyon-S", "name": "Jolyon"}}, "url": "https://github.com/palantir/atlasdb/commit/6b4133178d52fdff565bb2ab71f71c30387189dc", "committedDate": "2020-07-20T09:27:24Z", "message": "Merge branch 'safe-log-rest-hikari' of github.com:palantir/atlasdb into safe-log-rest-hikari"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2749, "cost": 1, "resetAt": "2021-11-01T16:19:10Z"}}}