{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDEyNTYxMzM5", "number": 807, "title": "FINERACT-730: Fixing bootRun and removing embedded Tomcat", "bodyText": "Description\nFixed bootRun / bootJar by:\n\nRewriting ServerApplication class based on SpringBoot documentation\nFixing SSL configuration for Tomcat by removing trust store config\nReworking dependencies to remove conflicts (conflicting HikariCP, missing commons-logging and commons-io,\n\nTo avoid conflict between embedded Tomcat and Spring Boot Tomcat:\n\nAdded Cargo plugin for Gradle to start a separate Tomcat instance\nChanged integrationTest to use separate Tomcat instance through Cargo plugin\nRemoved embedded Tomcat and Gradle Tomcat plugin\n\nTODO:\n\nGet the dev profile (using MariaDB4j) to work in the same way with integrationTest etc\nUpdate Confluence pages to remove references to tomcatRunWar etc\n\nChecklist\nPlease make sure these boxes are checked before submitting your pull request - thanks!\n\n\n Commit message starts with the issue number from https://issues.apache.org/jira/projects/FINERACT/. Ex: FINERACT-646 Pockets API.\n\n\n Coding conventions at https://cwiki.apache.org/confluence/display/FINERACT/Coding+Conventions have been followed.\n\n\n API documentation at https://github.com/apache/fineract/blob/develop/api-docs/apiLive.htm has been updated with details of any API changes.\n\n\n Integration tests have been created/updated for verifying the changes made.\n\n\n All Integrations tests are passing with the new commits.\n\n\n Submission is not a \"code dump\".  (Large changes can be made \"in repository\" via a branch.  Ask on the list.)\n\n\nOur guidelines for code reviews is at https://cwiki.apache.org/confluence/display/FINERACT/Code+Review+Guide", "createdAt": "2020-05-03T07:12:15Z", "url": "https://github.com/apache/fineract/pull/807", "merged": true, "mergeCommit": {"oid": "b05162f60ba13be3f9a520960e8e224e5cb154e9"}, "closed": true, "closedAt": "2020-05-05T20:04:05Z", "author": {"login": "ptuomola"}, "timelineItems": {"totalCount": 12, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcdojA6AFqTQwNDYwNDgxNQ==", "endCursor": "Y3Vyc29yOnYyOpPPAAABceZYaTABqjMzMDU3MjA1MTI=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDA0NjA0ODE1", "url": "https://github.com/apache/fineract/pull/807#pullrequestreview-404604815", "createdAt": "2020-05-03T10:44:11Z", "commit": {"oid": "2460fc7b92f5810479b0390814fbf0c5a958545c"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wM1QxMDo0NDoxMlrOGPq4QQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wM1QxMDo0NDoxMlrOGPq4QQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxOTA4NDM1Mw==", "bodyText": "@ptuomola would you consider raising this change as a separate PR instead of as part of this one? Or we could try to make a real better fix, based on what you described in FINERACT-855...", "url": "https://github.com/apache/fineract/pull/807#discussion_r419084353", "createdAt": "2020-05-03T10:44:12Z", "author": {"login": "vorburger"}, "path": "fineract-provider/src/integrationTest/java/org/apache/fineract/integrationtests/common/SchedulerJobHelper.java", "diffHunk": "@@ -115,6 +115,9 @@ public void executeJob(String jobName) throws InterruptedException {\n \n                 // Executing Scheduler Job\n                 runSchedulerJob(this.requestSpec, jobId.toString());\n+                \n+                // Need to give the job an opportunity to start - otherwise below might return false as job not yet started\n+                Thread.sleep(15000);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "2460fc7b92f5810479b0390814fbf0c5a958545c"}, "originalPosition": 6}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "09611e91df83d796094327f6169575d14a5e1ccd", "author": {"user": {"login": "ptuomola", "name": "Petri Tuomola"}}, "url": "https://github.com/apache/fineract/commit/09611e91df83d796094327f6169575d14a5e1ccd", "committedDate": "2020-05-03T18:40:39Z", "message": "Fixing whitespace"}, "afterCommit": {"oid": "70a81ec689e940dc3b7114a53a4325372c345713", "author": {"user": {"login": "ptuomola", "name": "Petri Tuomola"}}, "url": "https://github.com/apache/fineract/commit/70a81ec689e940dc3b7114a53a4325372c345713", "committedDate": "2020-05-03T19:13:56Z", "message": "FINERACT-730: Fixed dependencies, SSL config and main class etc to get bootRun to work. Migrated from Gradle Tomcat plugin to Cargo plugin to fix integration test"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "70a81ec689e940dc3b7114a53a4325372c345713", "author": {"user": {"login": "ptuomola", "name": "Petri Tuomola"}}, "url": "https://github.com/apache/fineract/commit/70a81ec689e940dc3b7114a53a4325372c345713", "committedDate": "2020-05-03T19:13:56Z", "message": "FINERACT-730: Fixed dependencies, SSL config and main class etc to get bootRun to work. Migrated from Gradle Tomcat plugin to Cargo plugin to fix integration test"}, "afterCommit": {"oid": "4e7108230b34384aaa67db4d8a8edbfb8fa0597c", "author": {"user": {"login": "ptuomola", "name": "Petri Tuomola"}}, "url": "https://github.com/apache/fineract/commit/4e7108230b34384aaa67db4d8a8edbfb8fa0597c", "committedDate": "2020-05-03T19:35:12Z", "message": "FINERACT-730: Fixed dependencies, SSL config and main class etc to get bootRun to work. Migrated from Gradle Tomcat plugin to Cargo plugin to fix integration test"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "4e7108230b34384aaa67db4d8a8edbfb8fa0597c", "author": {"user": {"login": "ptuomola", "name": "Petri Tuomola"}}, "url": "https://github.com/apache/fineract/commit/4e7108230b34384aaa67db4d8a8edbfb8fa0597c", "committedDate": "2020-05-03T19:35:12Z", "message": "FINERACT-730: Fixed dependencies, SSL config and main class etc to get bootRun to work. Migrated from Gradle Tomcat plugin to Cargo plugin to fix integration test"}, "afterCommit": {"oid": "b916037316a2ed3977e354866082279ead168189", "author": {"user": {"login": "ptuomola", "name": "Petri Tuomola"}}, "url": "https://github.com/apache/fineract/commit/b916037316a2ed3977e354866082279ead168189", "committedDate": "2020-05-03T20:04:30Z", "message": "FINERACT-730: Fixed dependencies, SSL config and main class etc to get bootRun to work. Migrated from Gradle Tomcat plugin to Cargo plugin to fix integration test"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "b916037316a2ed3977e354866082279ead168189", "author": {"user": {"login": "ptuomola", "name": "Petri Tuomola"}}, "url": "https://github.com/apache/fineract/commit/b916037316a2ed3977e354866082279ead168189", "committedDate": "2020-05-03T20:04:30Z", "message": "FINERACT-730: Fixed dependencies, SSL config and main class etc to get bootRun to work. Migrated from Gradle Tomcat plugin to Cargo plugin to fix integration test"}, "afterCommit": {"oid": "46b9d3b97e16a65bd4e50a7a74ab53c5ec634588", "author": {"user": {"login": "ptuomola", "name": "Petri Tuomola"}}, "url": "https://github.com/apache/fineract/commit/46b9d3b97e16a65bd4e50a7a74ab53c5ec634588", "committedDate": "2020-05-04T07:14:37Z", "message": "FINERACT-730: Fixed dependencies, SSL config and main class etc to get bootRun to work. Migrated from Gradle Tomcat plugin to Cargo plugin to fix integration test"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "46b9d3b97e16a65bd4e50a7a74ab53c5ec634588", "author": {"user": {"login": "ptuomola", "name": "Petri Tuomola"}}, "url": "https://github.com/apache/fineract/commit/46b9d3b97e16a65bd4e50a7a74ab53c5ec634588", "committedDate": "2020-05-04T07:14:37Z", "message": "FINERACT-730: Fixed dependencies, SSL config and main class etc to get bootRun to work. Migrated from Gradle Tomcat plugin to Cargo plugin to fix integration test"}, "afterCommit": {"oid": "dc76496f6aaeb15896d1ad4cf89073265f58864d", "author": {"user": {"login": "ptuomola", "name": "Petri Tuomola"}}, "url": "https://github.com/apache/fineract/commit/dc76496f6aaeb15896d1ad4cf89073265f58864d", "committedDate": "2020-05-04T09:37:42Z", "message": "FINERACT-730: Fixed dependencies, SSL config and main class etc to get bootRun to work. Migrated from Gradle Tomcat plugin to Cargo plugin to fix integration test"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDA1NjQ1Mzc5", "url": "https://github.com/apache/fineract/pull/807#pullrequestreview-405645379", "createdAt": "2020-05-05T09:57:01Z", "commit": {"oid": "dc76496f6aaeb15896d1ad4cf89073265f58864d"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wNVQwOTo1NzowMVrOGQiW_A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wNVQwOTo1OToyMFrOGQicEQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxOTk5MzM0MA==", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            FROM bitnami/tomcat:latest as fineract\n          \n          \n            \n            FROM bitnami/tomcat:9.0 as fineract\n          \n      \n    \n    \n  \n\nbecause :latest is always dangerous (it could silently break us when Tomcat 10 is released)", "url": "https://github.com/apache/fineract/pull/807#discussion_r419993340", "createdAt": "2020-05-05T09:57:01Z", "author": {"login": "vorburger"}, "path": "Dockerfile", "diffHunk": "@@ -37,18 +37,20 @@ RUN ./gradlew clean -x rat -x test war\n \n # =========================================\n \n-FROM bitnami/tomcat:7.0.94 as fineract\n+FROM bitnami/tomcat:latest as fineract", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "dc76496f6aaeb15896d1ad4cf89073265f58864d"}, "originalPosition": 5}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxOTk5NDY0MQ==", "bodyText": "Hm, a \"magical\" \ud83d\udc7f secret... I doubt anyone uses the AJP Connector with Tomcat in a Container, and for better security than shipping with a default password (bad best practice) I suggest that we just remove (or at least comment out) this Connector entirely here, what do you think?", "url": "https://github.com/apache/fineract/pull/807#discussion_r419994641", "createdAt": "2020-05-05T09:59:20Z", "author": {"login": "vorburger"}, "path": "docker/server.xml", "diffHunk": "@@ -108,7 +108,7 @@\n     -->\n \n     <!-- Define an AJP 1.3 Connector on port 8009 -->\n-    <Connector port=\"8009\" protocol=\"AJP/1.3\" redirectPort=\"8443\" />\n+    <Connector port=\"8009\" protocol=\"AJP/1.3\" redirectPort=\"8443\" secret=\"xyz123\" />", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "dc76496f6aaeb15896d1ad4cf89073265f58864d"}, "originalPosition": 14}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "7a25031117c51a2fa339f4fc21b161603da9839d", "author": {"user": {"login": "ptuomola", "name": "Petri Tuomola"}}, "url": "https://github.com/apache/fineract/commit/7a25031117c51a2fa339f4fc21b161603da9839d", "committedDate": "2020-05-05T18:43:50Z", "message": "Update Dockerfile\n\nCo-authored-by: Michael Vorburger \u26d1\ufe0f <mike@vorburger.ch>"}, "afterCommit": {"oid": "1a9ec367471719dfbb1dd97c844e3197e7fc9935", "author": {"user": {"login": "ptuomola", "name": "Petri Tuomola"}}, "url": "https://github.com/apache/fineract/commit/1a9ec367471719dfbb1dd97c844e3197e7fc9935", "committedDate": "2020-05-05T18:56:05Z", "message": "FINERACT-730: Fixed dependencies, SSL config and main class etc to get bootRun to work. Migrated from Gradle Tomcat plugin to Cargo plugin to fix integration test"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDA2MDc2MzIy", "url": "https://github.com/apache/fineract/pull/807#pullrequestreview-406076322", "createdAt": "2020-05-05T19:07:15Z", "commit": {"oid": "1a9ec367471719dfbb1dd97c844e3197e7fc9935"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDA2MDkxMTAx", "url": "https://github.com/apache/fineract/pull/807#pullrequestreview-406091101", "createdAt": "2020-05-05T19:28:45Z", "commit": {"oid": "1a9ec367471719dfbb1dd97c844e3197e7fc9935"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wNVQxOToyODo0NVrOGQ4XIg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wNVQxOToyODo0NVrOGQ4XIg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMDM1MzgyNg==", "bodyText": "@ptuomola partially out of curiosity, what's this for, being commented out? If it's not required, is cool to remove this? We can do this in a follow-up PR, just to get this one in... \ud83d\ude03", "url": "https://github.com/apache/fineract/pull/807#discussion_r420353826", "createdAt": "2020-05-05T19:28:45Z", "author": {"login": "vorburger"}, "path": "Dockerfile", "diffHunk": "@@ -37,18 +37,20 @@ RUN ./gradlew clean -x rat -x test war\n \n # =========================================\n \n-FROM bitnami/tomcat:7.0.94 as fineract\n+FROM bitnami/tomcat:latest as fineract\n \n-ENV JAVA_HOME /usr/lib/jvm/java-8-openjdk-amd64/jre\n+ENV JAVA_HOME /usr/local/openjdk-8/jre\n \n USER root\n RUN apt-get update -qq && apt-get install -y wget\n \n COPY --from=builder /fineract/build/libs/fineract-provider.war /opt/bitnami/tomcat/webapps\n+COPY --from=builder /usr/local/openjdk-8/jre /usr/local/openjdk-8/jre\n \n RUN keytool -genkey -keyalg RSA -alias tomcat -keystore /opt/bitnami/tomcat/tomcat.keystore -keypass xyz123 -storepass xyz123 -noprompt -dname \"CN=Fineract, OU=Fineract, O=Fineract, L=Unknown, ST=Unknown, C=Unknown\"\n COPY ./docker/server.xml /opt/bitnami/tomcat/conf\n RUN chmod 664 /opt/bitnami/tomcat/conf/server.xml\n+#RUN chown -R tomcat /opt/bitnami/tomcat", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "1a9ec367471719dfbb1dd97c844e3197e7fc9935"}, "originalPosition": 19}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "61e4d0b57708f3f823a26d146d3cbbbb2db45d53", "author": {"user": {"login": "ptuomola", "name": "Petri Tuomola"}}, "url": "https://github.com/apache/fineract/commit/61e4d0b57708f3f823a26d146d3cbbbb2db45d53", "committedDate": "2020-05-05T19:37:53Z", "message": "FINERACT-730: Fixed dependencies, SSL config and main class etc to get bootRun to work. Migrated from Gradle Tomcat plugin to Cargo plugin to fix integration test"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "1a9ec367471719dfbb1dd97c844e3197e7fc9935", "author": {"user": {"login": "ptuomola", "name": "Petri Tuomola"}}, "url": "https://github.com/apache/fineract/commit/1a9ec367471719dfbb1dd97c844e3197e7fc9935", "committedDate": "2020-05-05T18:56:05Z", "message": "FINERACT-730: Fixed dependencies, SSL config and main class etc to get bootRun to work. Migrated from Gradle Tomcat plugin to Cargo plugin to fix integration test"}, "afterCommit": {"oid": "61e4d0b57708f3f823a26d146d3cbbbb2db45d53", "author": {"user": {"login": "ptuomola", "name": "Petri Tuomola"}}, "url": "https://github.com/apache/fineract/commit/61e4d0b57708f3f823a26d146d3cbbbb2db45d53", "committedDate": "2020-05-05T19:37:53Z", "message": "FINERACT-730: Fixed dependencies, SSL config and main class etc to get bootRun to work. Migrated from Gradle Tomcat plugin to Cargo plugin to fix integration test"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1972, "cost": 1, "resetAt": "2021-10-29T17:30:11Z"}}}