{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDIxODMyNjY2", "number": 924, "title": "FINERACT-609 TopUp", "bodyText": "Build from #574\nDescription\nDescribe the changes made and why they were made. Ignore if these details are present on the associated Jira ticket  https://issues.apache.org/jira/browse/FINERACT-609\nChecklist\nPlease make sure these boxes are checked before submitting your pull request - thanks!\n\n\n Commit message starts with the issue number from https://issues.apache.org/jira/projects/FINERACT/. Ex: FINERACT-646 Pockets API.\n\n\n Coding conventions at https://cwiki.apache.org/confluence/display/FINERACT/Coding+Conventions have been followed.\n\n\n API documentation at fineract-provider/src/main/resources/static/api-docs/apiLive.htm has been updated with details of any API changes.\n\n\n Integration tests have been created/updated for verifying the changes made.\n\n\n All Integrations tests are passing with the new commits.\n\n\n Submission is not a \"code dump\".  (Large changes can be made \"in repository\" via a branch.  Ask on the list.)\n\n\nOur guidelines for code reviews is at https://cwiki.apache.org/confluence/display/FINERACT/Code+Review+Guide", "createdAt": "2020-05-22T10:06:11Z", "url": "https://github.com/apache/fineract/pull/924", "merged": true, "mergeCommit": {"oid": "096d842c38c0f7d876821250b26daff51b4cc987"}, "closed": true, "closedAt": "2020-05-30T05:38:42Z", "author": {"login": "percyashu"}, "timelineItems": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcj19qSgFqTQxNzA4NDk3Ng==", "endCursor": "Y3Vyc29yOnYyOpPPAAABclyB7DABqjMzODQwNjA1NjM=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDE3MDg0OTc2", "url": "https://github.com/apache/fineract/pull/924#pullrequestreview-417084976", "createdAt": "2020-05-22T17:45:41Z", "commit": {"oid": "1988b9b4eea33aa201a0eb4e2efeba6bdc3a401d"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yMlQxNzo0NTo0MVrOGZfHYg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yMlQxNzo0NTo0MVrOGZfHYg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyOTM3NzM3OA==", "bodyText": "This still doesn't seem to take the code review feedback that @vishwasbabu had provided in #574 into account?", "url": "https://github.com/apache/fineract/pull/924#discussion_r429377378", "createdAt": "2020-05-22T17:45:41Z", "author": {"login": "vorburger"}, "path": "fineract-provider/src/main/java/org/apache/fineract/portfolio/accountdetails/service/AccountDetailsReadPlatformServiceJpaRepositoryImpl.java", "diffHunk": "@@ -171,6 +172,12 @@ public AccountSummaryCollectionData retrieveGroupAccountDetails(final Long group\n         return this.jdbcTemplate.query(sql, rm, new Object[]{groupId , glimAccount});\n     }\n \n+    @Override\n+    public Collection<LoanAccountSummaryData> retrieveGroupActiveLoanAccountSummary(final Long groupId) {\n+        final String loanWhereClause = \" where l.group_id = ? and l.loan_status_id = 300 \";", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "1988b9b4eea33aa201a0eb4e2efeba6bdc3a401d"}, "originalPosition": 16}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDIwMjc0ODA4", "url": "https://github.com/apache/fineract/pull/924#pullrequestreview-420274808", "createdAt": "2020-05-28T16:13:06Z", "commit": {"oid": "1988b9b4eea33aa201a0eb4e2efeba6bdc3a401d"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yOFQxNjoxMzowNlrOGb8mew==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yOFQxNjoxNjoxOVrOGb8v7A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMTk1NzYyNw==", "bodyText": "We shouldn't be removing the existing condition which checks for client loans, rather we should be adding an else if for additionally checking for group loans", "url": "https://github.com/apache/fineract/pull/924#discussion_r431957627", "createdAt": "2020-05-28T16:13:06Z", "author": {"login": "vishwasbabu"}, "path": "fineract-provider/src/main/java/org/apache/fineract/portfolio/loanaccount/service/LoanReadPlatformServiceImpl.java", "diffHunk": "@@ -1428,15 +1428,15 @@ public LoanAccountData retrieveLoanProductDetailsTemplate(final Long productId,\n             }\n         }\n \n-        Collection<LoanAccountSummaryData> clientActiveLoanOptions = null;\n-        if(loanProduct.canUseForTopup() && clientId != null){\n-            clientActiveLoanOptions = this.accountDetailsReadPlatformService.retrieveClientActiveLoanAccountSummary(clientId);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "1988b9b4eea33aa201a0eb4e2efeba6bdc3a401d"}, "originalPosition": 6}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMTk2MDA0NA==", "bodyText": "I would append a clause to the effect of \"l.client_id is NULL\", this ensures that only group loans are fetched by the query all JLG loans are ignored (loans which are associated with clients and groups and fetched as a part of the retrieveClientActiveLoanAccountSummary method)", "url": "https://github.com/apache/fineract/pull/924#discussion_r431960044", "createdAt": "2020-05-28T16:16:19Z", "author": {"login": "vishwasbabu"}, "path": "fineract-provider/src/main/java/org/apache/fineract/portfolio/accountdetails/service/AccountDetailsReadPlatformServiceJpaRepositoryImpl.java", "diffHunk": "@@ -171,6 +172,12 @@ public AccountSummaryCollectionData retrieveGroupAccountDetails(final Long group\n         return this.jdbcTemplate.query(sql, rm, new Object[]{groupId , glimAccount});\n     }\n \n+    @Override\n+    public Collection<LoanAccountSummaryData> retrieveGroupActiveLoanAccountSummary(final Long groupId) {\n+        final String loanWhereClause = \" where l.group_id = ? and l.loan_status_id = 300 \";", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyOTM3NzM3OA=="}, "originalCommit": {"oid": "1988b9b4eea33aa201a0eb4e2efeba6bdc3a401d"}, "originalPosition": 16}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c1ca960acefd7d97e630915b06c6e772d984bd33", "author": {"user": {"login": "percyashu", "name": "Percy Enoabane"}}, "url": "https://github.com/apache/fineract/commit/c1ca960acefd7d97e630915b06c6e772d984bd33", "committedDate": "2020-05-28T18:16:47Z", "message": "FINERACT-609 TopUp"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "1988b9b4eea33aa201a0eb4e2efeba6bdc3a401d", "author": {"user": {"login": "percyashu", "name": "Percy Enoabane"}}, "url": "https://github.com/apache/fineract/commit/1988b9b4eea33aa201a0eb4e2efeba6bdc3a401d", "committedDate": "2020-05-22T10:00:41Z", "message": "FINERACT-609 TopUp"}, "afterCommit": {"oid": "c1ca960acefd7d97e630915b06c6e772d984bd33", "author": {"user": {"login": "percyashu", "name": "Percy Enoabane"}}, "url": "https://github.com/apache/fineract/commit/c1ca960acefd7d97e630915b06c6e772d984bd33", "committedDate": "2020-05-28T18:16:47Z", "message": "FINERACT-609 TopUp"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1933, "cost": 1, "resetAt": "2021-10-29T17:30:11Z"}}}