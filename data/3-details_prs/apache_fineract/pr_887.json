{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDE3NzM1NDc4", "number": 887, "title": "FINERACT-830: Configuring Dockerfile to use Google Distroless base image", "bodyText": "Using Google Distroless with OpenJDK 11 as base image for Fineract Docker build\nFINERACT-830", "createdAt": "2020-05-14T03:58:16Z", "url": "https://github.com/apache/fineract/pull/887", "merged": true, "mergeCommit": {"oid": "1bff035d3ce47317c3748fcb6c02e6530a39d1d8"}, "closed": true, "closedAt": "2020-05-21T13:47:13Z", "author": {"login": "ptuomola"}, "timelineItems": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABchldqOAFqTQxMjgzMjgzNQ==", "endCursor": "Y3Vyc29yOnYyOpPPAAABci6b9AABqjMzNTM1Nzg3MzY=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDEyODMyODM1", "url": "https://github.com/apache/fineract/pull/887#pullrequestreview-412832835", "createdAt": "2020-05-15T17:23:56Z", "commit": {"oid": "c7e029b4fc5815ac2ef7443350e9ee72d303dece"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xNVQxNzoyMzo1NlrOGWNi4w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xNVQxNzoyMzo1NlrOGWNi4w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNTk0Mzc3OQ==", "bodyText": "This loss of the mysql-connector-java-8.0.19.jar is a problem for those who want to use that instead of Drizzle (e.g. I actually do, on https://www.fineract.dev...). It means e.g. that if you (quote) \"comment out lines in the docker-compose.yml illustrate how to do this\" it won't find it anymore after this PR.\n@ptuomola do you think we could keep somehow that? Unfortunately, you can't just add it to dependencies.gradle - because we cannot distribute an LGPL library with Fineract release ZIPs that can be downloaded from https://fineract.apache.org. I know and totally agree that this is a bit of a mess; ask for references if you want more details. I guess you could still keep the wget here, and add it to the classpath when launching the JAR? BTW I'm sure you've also come across posts suggesting that a bit of startup time can be gained by \"exploding\" (uncompressing) \"FAT JARs\", and directly specifying the main class. I don't know if that's something you would be willing to already do here? Or we could of course look into that later. It just occurred to me that it may go naturally together with adding an additional JAR.", "url": "https://github.com/apache/fineract/pull/887#discussion_r425943779", "createdAt": "2020-05-15T17:23:56Z", "author": {"login": "vorburger"}, "path": "Dockerfile", "diffHunk": "@@ -32,30 +32,11 @@ COPY *LICENSE* fineract/\n COPY *NOTICE* fineract/\n \n WORKDIR fineract\n-# RUN find .\n-RUN ./gradlew clean -x rat -x test war\n+RUN ./gradlew clean -x rat -x test bootJar\n \n # =========================================\n \n-FROM bitnami/tomcat:9.0 as fineract\n+FROM gcr.io/distroless/java:11 as fineract\n \n-USER root\n-RUN apt-get update -qq && apt-get install -y wget\n-\n-COPY --from=builder /fineract/build/libs/fineract-provider.war /opt/bitnami/tomcat/webapps\n-\n-RUN keytool -genkey -keyalg RSA -alias tomcat -keystore /opt/bitnami/tomcat/tomcat.keystore -keypass xyz123 -storepass xyz123 -noprompt -dname \"CN=Fineract, OU=Fineract, O=Fineract, L=Unknown, ST=Unknown, C=Unknown\"\n-COPY ./docker/server.xml /opt/bitnami/tomcat/conf\n-RUN chmod 664 /opt/bitnami/tomcat/conf/server.xml\n-\n-WORKDIR /opt/bitnami/tomcat/lib\n-# org.drizzle.jdbc.DrizzleDriver is used by default for both the all tenants and demo tenant DB DataSource\n-RUN wget https://repo1.maven.org/maven2/org/drizzle/jdbc/drizzle-jdbc/1.4/drizzle-jdbc-1.4.jar\n-\n-# https://issues.apache.org/jira/browse/LEGAL-462\n-# https://issues.apache.org/jira/browse/FINERACT-762\n-# We include an alternative JDBC driver (which is faster, but not allowed to be default in Apache distribution)\n-# allowing implementations to switch the driver used by changing start-up parameters (for both tenants and each tenant DB)\n-# The commented out lines in the docker-compose.yml illustrate how to do this.\n-# To be sure that this instead of Drizlle is used, comment out wget above.\n-RUN wget https://repo1.maven.org/maven2/mysql/mysql-connector-java/8.0.19/mysql-connector-java-8.0.19.jar", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c7e029b4fc5815ac2ef7443350e9ee72d303dece"}, "originalPosition": 32}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ddb029e99451dd463386c82be273fb65441799fa", "author": {"user": {"login": "ptuomola", "name": "Petri Tuomola"}}, "url": "https://github.com/apache/fineract/commit/ddb029e99451dd463386c82be273fb65441799fa", "committedDate": "2020-05-19T20:24:18Z", "message": "FINERACT-830: Configuring Dockerfile to use Google Distroless base image"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "c7e029b4fc5815ac2ef7443350e9ee72d303dece", "author": {"user": {"login": "ptuomola", "name": "Petri Tuomola"}}, "url": "https://github.com/apache/fineract/commit/c7e029b4fc5815ac2ef7443350e9ee72d303dece", "committedDate": "2020-05-14T03:56:35Z", "message": "FINERACT-830: Configuring Dockerfile to use Google Distroless base image"}, "afterCommit": {"oid": "ddb029e99451dd463386c82be273fb65441799fa", "author": {"user": {"login": "ptuomola", "name": "Petri Tuomola"}}, "url": "https://github.com/apache/fineract/commit/ddb029e99451dd463386c82be273fb65441799fa", "committedDate": "2020-05-19T20:24:18Z", "message": "FINERACT-830: Configuring Dockerfile to use Google Distroless base image"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1911, "cost": 1, "resetAt": "2021-10-29T17:30:11Z"}}}