{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDIyMDIwMzM0", "number": 925, "reviewThreads": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yMlQxNzo0MDozN1rOD_Bn2w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yMlQxNzo0MDozN1rOD_Bn2w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjY3NDEzNDY3OnYy", "diffSide": "RIGHT", "path": "fineract-provider/src/main/java/org/apache/fineract/accounting/producttoaccountmapping/domain/ProductToGLAccountMappingRepository.java", "isResolved": true, "comments": {"totalCount": 11, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yMlQxNzo0MDozN1rOGZe-8w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yMlQyMDowMDozN1rOGZiZXA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyOTM3NTIxOQ==", "bodyText": "@maektwain I'd like to better understand what problem this fixes how... At first glance, to me this looks like we are just writing an explicit @Query for what Spring Data otherwise automagically internally generates with from its findBy syntax... can you help me understand what I'm missing? What Query does the current version generate, and what is wrong with it which this explicit version fixes? How is the auto-generated query wrong?", "url": "https://github.com/apache/fineract/pull/925#discussion_r429375219", "createdAt": "2020-05-22T17:40:37Z", "author": {"login": "vorburger"}, "path": "fineract-provider/src/main/java/org/apache/fineract/accounting/producttoaccountmapping/domain/ProductToGLAccountMappingRepository.java", "diffHunk": "@@ -30,8 +30,9 @@\n     ProductToGLAccountMapping findByProductIdAndProductTypeAndFinancialAccountTypeAndPaymentTypeId(Long productId, int productType,\n             int financialAccountType, Long paymentType);\n \n-    ProductToGLAccountMapping findByProductIdAndProductTypeAndFinancialAccountTypeAndChargeId(Long productId, int productType,\n-            int financialAccountType, Long chargeId);\n+    @Query(\"select mapping from ProductToGLAccountMapping mapping where mapping.productId= :productId and mapping.productType= :productType and mapping.financialAccountType= :financialAccountType and mapping.charge.id= :chargeId\")\n+    ProductToGLAccountMapping findProductIdAndProductTypeAndFinancialAccountTypeAndChargeId(@Param(\"productId\") Long productId, @Param(\"productType\") int productType,\n+            @Param(\"financialAccountType\") int financialAccountType, @Param(\"chargeId\") Long ChargeId);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "051caa0be58a50fba92ade501e02a8b5306066ae"}, "originalPosition": 8}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyOTM3NzQ2Mg==", "bodyText": "So, with findBy  query it does not return data , it return null value, even data is available, making it more dumb and simple.", "url": "https://github.com/apache/fineract/pull/925#discussion_r429377462", "createdAt": "2020-05-22T17:45:52Z", "author": {"login": "maektwain"}, "path": "fineract-provider/src/main/java/org/apache/fineract/accounting/producttoaccountmapping/domain/ProductToGLAccountMappingRepository.java", "diffHunk": "@@ -30,8 +30,9 @@\n     ProductToGLAccountMapping findByProductIdAndProductTypeAndFinancialAccountTypeAndPaymentTypeId(Long productId, int productType,\n             int financialAccountType, Long paymentType);\n \n-    ProductToGLAccountMapping findByProductIdAndProductTypeAndFinancialAccountTypeAndChargeId(Long productId, int productType,\n-            int financialAccountType, Long chargeId);\n+    @Query(\"select mapping from ProductToGLAccountMapping mapping where mapping.productId= :productId and mapping.productType= :productType and mapping.financialAccountType= :financialAccountType and mapping.charge.id= :chargeId\")\n+    ProductToGLAccountMapping findProductIdAndProductTypeAndFinancialAccountTypeAndChargeId(@Param(\"productId\") Long productId, @Param(\"productType\") int productType,\n+            @Param(\"financialAccountType\") int financialAccountType, @Param(\"chargeId\") Long ChargeId);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyOTM3NTIxOQ=="}, "originalCommit": {"oid": "051caa0be58a50fba92ade501e02a8b5306066ae"}, "originalPosition": 8}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyOTM3OTIyMA==", "bodyText": "So, I tested it across steps to reproduce the above  now.\nCreate a savings product, define accounting and associate charges with advanced accounting mapping to Income and Fees.\nMake a transaction, Charges associate to advanced accounting should go to those headers defined in previous step.\nDebugged and realised its coming null and with this query its appropriately returning and posting in journal entries.", "url": "https://github.com/apache/fineract/pull/925#discussion_r429379220", "createdAt": "2020-05-22T17:49:59Z", "author": {"login": "maektwain"}, "path": "fineract-provider/src/main/java/org/apache/fineract/accounting/producttoaccountmapping/domain/ProductToGLAccountMappingRepository.java", "diffHunk": "@@ -30,8 +30,9 @@\n     ProductToGLAccountMapping findByProductIdAndProductTypeAndFinancialAccountTypeAndPaymentTypeId(Long productId, int productType,\n             int financialAccountType, Long paymentType);\n \n-    ProductToGLAccountMapping findByProductIdAndProductTypeAndFinancialAccountTypeAndChargeId(Long productId, int productType,\n-            int financialAccountType, Long chargeId);\n+    @Query(\"select mapping from ProductToGLAccountMapping mapping where mapping.productId= :productId and mapping.productType= :productType and mapping.financialAccountType= :financialAccountType and mapping.charge.id= :chargeId\")\n+    ProductToGLAccountMapping findProductIdAndProductTypeAndFinancialAccountTypeAndChargeId(@Param(\"productId\") Long productId, @Param(\"productType\") int productType,\n+            @Param(\"financialAccountType\") int financialAccountType, @Param(\"chargeId\") Long ChargeId);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyOTM3NTIxOQ=="}, "originalCommit": {"oid": "051caa0be58a50fba92ade501e02a8b5306066ae"}, "originalPosition": 8}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyOTM4Mzg2Nw==", "bodyText": "So, with findBy query it does not return data , it return null value, even data is available, making it more dumb and simple.\n\nI found this puzzling, and had a closer look... and noticed that AndChargeId is curious - there is no chargeId getter and field on ProductToGLAccountMapping - only a charge. Do you want to try to see if just renaming the method instead of having to manually specify the query also fixes this? If that is so, then I'm interested how to find a way to validate those Spring Data Repository interfaces...\n\nSo, I tested it across steps to reproduce the above now.\n\ndo you think you would be able to write an integration test for this problem in this PR? Just asking!", "url": "https://github.com/apache/fineract/pull/925#discussion_r429383867", "createdAt": "2020-05-22T17:59:57Z", "author": {"login": "vorburger"}, "path": "fineract-provider/src/main/java/org/apache/fineract/accounting/producttoaccountmapping/domain/ProductToGLAccountMappingRepository.java", "diffHunk": "@@ -30,8 +30,9 @@\n     ProductToGLAccountMapping findByProductIdAndProductTypeAndFinancialAccountTypeAndPaymentTypeId(Long productId, int productType,\n             int financialAccountType, Long paymentType);\n \n-    ProductToGLAccountMapping findByProductIdAndProductTypeAndFinancialAccountTypeAndChargeId(Long productId, int productType,\n-            int financialAccountType, Long chargeId);\n+    @Query(\"select mapping from ProductToGLAccountMapping mapping where mapping.productId= :productId and mapping.productType= :productType and mapping.financialAccountType= :financialAccountType and mapping.charge.id= :chargeId\")\n+    ProductToGLAccountMapping findProductIdAndProductTypeAndFinancialAccountTypeAndChargeId(@Param(\"productId\") Long productId, @Param(\"productType\") int productType,\n+            @Param(\"financialAccountType\") int financialAccountType, @Param(\"chargeId\") Long ChargeId);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyOTM3NTIxOQ=="}, "originalCommit": {"oid": "051caa0be58a50fba92ade501e02a8b5306066ae"}, "originalPosition": 8}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyOTM4OTY2OQ==", "bodyText": "Didn't realise that JPA binds them with getters ( :() ) I think no need , the test is already there I guess , if it's  not there then I can write.", "url": "https://github.com/apache/fineract/pull/925#discussion_r429389669", "createdAt": "2020-05-22T18:14:09Z", "author": {"login": "maektwain"}, "path": "fineract-provider/src/main/java/org/apache/fineract/accounting/producttoaccountmapping/domain/ProductToGLAccountMappingRepository.java", "diffHunk": "@@ -30,8 +30,9 @@\n     ProductToGLAccountMapping findByProductIdAndProductTypeAndFinancialAccountTypeAndPaymentTypeId(Long productId, int productType,\n             int financialAccountType, Long paymentType);\n \n-    ProductToGLAccountMapping findByProductIdAndProductTypeAndFinancialAccountTypeAndChargeId(Long productId, int productType,\n-            int financialAccountType, Long chargeId);\n+    @Query(\"select mapping from ProductToGLAccountMapping mapping where mapping.productId= :productId and mapping.productType= :productType and mapping.financialAccountType= :financialAccountType and mapping.charge.id= :chargeId\")\n+    ProductToGLAccountMapping findProductIdAndProductTypeAndFinancialAccountTypeAndChargeId(@Param(\"productId\") Long productId, @Param(\"productType\") int productType,\n+            @Param(\"financialAccountType\") int financialAccountType, @Param(\"chargeId\") Long ChargeId);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyOTM3NTIxOQ=="}, "originalCommit": {"oid": "051caa0be58a50fba92ade501e02a8b5306066ae"}, "originalPosition": 8}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyOTM5MzQ3OA==", "bodyText": "So, if we rename the method then we eventually have to change the existing method sigs, since it uses the ChargeId , and then in that case we need to pass the Charge. This fixes the problem.", "url": "https://github.com/apache/fineract/pull/925#discussion_r429393478", "createdAt": "2020-05-22T18:23:48Z", "author": {"login": "maektwain"}, "path": "fineract-provider/src/main/java/org/apache/fineract/accounting/producttoaccountmapping/domain/ProductToGLAccountMappingRepository.java", "diffHunk": "@@ -30,8 +30,9 @@\n     ProductToGLAccountMapping findByProductIdAndProductTypeAndFinancialAccountTypeAndPaymentTypeId(Long productId, int productType,\n             int financialAccountType, Long paymentType);\n \n-    ProductToGLAccountMapping findByProductIdAndProductTypeAndFinancialAccountTypeAndChargeId(Long productId, int productType,\n-            int financialAccountType, Long chargeId);\n+    @Query(\"select mapping from ProductToGLAccountMapping mapping where mapping.productId= :productId and mapping.productType= :productType and mapping.financialAccountType= :financialAccountType and mapping.charge.id= :chargeId\")\n+    ProductToGLAccountMapping findProductIdAndProductTypeAndFinancialAccountTypeAndChargeId(@Param(\"productId\") Long productId, @Param(\"productType\") int productType,\n+            @Param(\"financialAccountType\") int financialAccountType, @Param(\"chargeId\") Long ChargeId);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyOTM3NTIxOQ=="}, "originalCommit": {"oid": "051caa0be58a50fba92ade501e02a8b5306066ae"}, "originalPosition": 8}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyOTM5NDcwNQ==", "bodyText": "Fields Types are different and usage is also different if you look here\nFile is AccountingProcessorHelper.java\nif (accountMappingTypeId == CashAccountsForLoan.INCOME_FROM_FEES.getValue()\n                || accountMappingTypeId == CashAccountsForLoan.INCOME_FROM_PENALTIES.getValue()) {\n            final ProductToGLAccountMapping chargeSpecificIncomeAccountMapping = this.accountMappingRepository\n                    .findByProductIdAndProductTypeAndFinancialAccountTypeAndChargeId(loanProductId, PortfolioProductType.LOAN.getValue(),\n                            accountMappingTypeId, chargeId);\n            if (chargeSpecificIncomeAccountMapping != null) {\n                accountMapping = chargeSpecificIncomeAccountMapping;\n            }\n        }\nIt uses the chargeId\nand perviously it gets passed here\nfinal GLAccount chargeSpecificAccount = getLinkedGLAccountForSavingsCharges(savingsProductId, accountTypeToBeCredited.getValue(),\n                chargePaymentDTO.getChargeId());", "url": "https://github.com/apache/fineract/pull/925#discussion_r429394705", "createdAt": "2020-05-22T18:26:52Z", "author": {"login": "maektwain"}, "path": "fineract-provider/src/main/java/org/apache/fineract/accounting/producttoaccountmapping/domain/ProductToGLAccountMappingRepository.java", "diffHunk": "@@ -30,8 +30,9 @@\n     ProductToGLAccountMapping findByProductIdAndProductTypeAndFinancialAccountTypeAndPaymentTypeId(Long productId, int productType,\n             int financialAccountType, Long paymentType);\n \n-    ProductToGLAccountMapping findByProductIdAndProductTypeAndFinancialAccountTypeAndChargeId(Long productId, int productType,\n-            int financialAccountType, Long chargeId);\n+    @Query(\"select mapping from ProductToGLAccountMapping mapping where mapping.productId= :productId and mapping.productType= :productType and mapping.financialAccountType= :financialAccountType and mapping.charge.id= :chargeId\")\n+    ProductToGLAccountMapping findProductIdAndProductTypeAndFinancialAccountTypeAndChargeId(@Param(\"productId\") Long productId, @Param(\"productType\") int productType,\n+            @Param(\"financialAccountType\") int financialAccountType, @Param(\"chargeId\") Long ChargeId);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyOTM3NTIxOQ=="}, "originalCommit": {"oid": "051caa0be58a50fba92ade501e02a8b5306066ae"}, "originalPosition": 8}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyOTQxODE2Mw==", "bodyText": "@maektwain thanks for your explanations, I now (kind of) see what you mean - I had previously missed the Charge vs. Long chargeId ... then I guess this fix makes sense. I'm still puzzled as to why Spring doesn't flag this, but let's pick that up separately in FINERACT-998 later. I'm going to LGTM this PR, but not merge it, to let others review it as well, and give you a chance to still add an IT for it, that would be nice, but I don't want to blocking merging this even if no IT.", "url": "https://github.com/apache/fineract/pull/925#discussion_r429418163", "createdAt": "2020-05-22T19:21:31Z", "author": {"login": "vorburger"}, "path": "fineract-provider/src/main/java/org/apache/fineract/accounting/producttoaccountmapping/domain/ProductToGLAccountMappingRepository.java", "diffHunk": "@@ -30,8 +30,9 @@\n     ProductToGLAccountMapping findByProductIdAndProductTypeAndFinancialAccountTypeAndPaymentTypeId(Long productId, int productType,\n             int financialAccountType, Long paymentType);\n \n-    ProductToGLAccountMapping findByProductIdAndProductTypeAndFinancialAccountTypeAndChargeId(Long productId, int productType,\n-            int financialAccountType, Long chargeId);\n+    @Query(\"select mapping from ProductToGLAccountMapping mapping where mapping.productId= :productId and mapping.productType= :productType and mapping.financialAccountType= :financialAccountType and mapping.charge.id= :chargeId\")\n+    ProductToGLAccountMapping findProductIdAndProductTypeAndFinancialAccountTypeAndChargeId(@Param(\"productId\") Long productId, @Param(\"productType\") int productType,\n+            @Param(\"financialAccountType\") int financialAccountType, @Param(\"chargeId\") Long ChargeId);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyOTM3NTIxOQ=="}, "originalCommit": {"oid": "051caa0be58a50fba92ade501e02a8b5306066ae"}, "originalPosition": 8}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyOTQxODcwMw==", "bodyText": "@maektwain small practical thing, normally the commit message itself should include the JIRA, which is missing here, as you just added it to the PR title afterwards.. perhaps you want to amend the commit message?", "url": "https://github.com/apache/fineract/pull/925#discussion_r429418703", "createdAt": "2020-05-22T19:22:59Z", "author": {"login": "vorburger"}, "path": "fineract-provider/src/main/java/org/apache/fineract/accounting/producttoaccountmapping/domain/ProductToGLAccountMappingRepository.java", "diffHunk": "@@ -30,8 +30,9 @@\n     ProductToGLAccountMapping findByProductIdAndProductTypeAndFinancialAccountTypeAndPaymentTypeId(Long productId, int productType,\n             int financialAccountType, Long paymentType);\n \n-    ProductToGLAccountMapping findByProductIdAndProductTypeAndFinancialAccountTypeAndChargeId(Long productId, int productType,\n-            int financialAccountType, Long chargeId);\n+    @Query(\"select mapping from ProductToGLAccountMapping mapping where mapping.productId= :productId and mapping.productType= :productType and mapping.financialAccountType= :financialAccountType and mapping.charge.id= :chargeId\")\n+    ProductToGLAccountMapping findProductIdAndProductTypeAndFinancialAccountTypeAndChargeId(@Param(\"productId\") Long productId, @Param(\"productType\") int productType,\n+            @Param(\"financialAccountType\") int financialAccountType, @Param(\"chargeId\") Long ChargeId);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyOTM3NTIxOQ=="}, "originalCommit": {"oid": "051caa0be58a50fba92ade501e02a8b5306066ae"}, "originalPosition": 8}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyOTQyODI2Mw==", "bodyText": "Thanks for the understanding . ACK.\nIt has been that way, I will try to add IT too soon.", "url": "https://github.com/apache/fineract/pull/925#discussion_r429428263", "createdAt": "2020-05-22T19:50:15Z", "author": {"login": "maektwain"}, "path": "fineract-provider/src/main/java/org/apache/fineract/accounting/producttoaccountmapping/domain/ProductToGLAccountMappingRepository.java", "diffHunk": "@@ -30,8 +30,9 @@\n     ProductToGLAccountMapping findByProductIdAndProductTypeAndFinancialAccountTypeAndPaymentTypeId(Long productId, int productType,\n             int financialAccountType, Long paymentType);\n \n-    ProductToGLAccountMapping findByProductIdAndProductTypeAndFinancialAccountTypeAndChargeId(Long productId, int productType,\n-            int financialAccountType, Long chargeId);\n+    @Query(\"select mapping from ProductToGLAccountMapping mapping where mapping.productId= :productId and mapping.productType= :productType and mapping.financialAccountType= :financialAccountType and mapping.charge.id= :chargeId\")\n+    ProductToGLAccountMapping findProductIdAndProductTypeAndFinancialAccountTypeAndChargeId(@Param(\"productId\") Long productId, @Param(\"productType\") int productType,\n+            @Param(\"financialAccountType\") int financialAccountType, @Param(\"chargeId\") Long ChargeId);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyOTM3NTIxOQ=="}, "originalCommit": {"oid": "051caa0be58a50fba92ade501e02a8b5306066ae"}, "originalPosition": 8}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyOTQzMTEzMg==", "bodyText": "Sure", "url": "https://github.com/apache/fineract/pull/925#discussion_r429431132", "createdAt": "2020-05-22T20:00:37Z", "author": {"login": "maektwain"}, "path": "fineract-provider/src/main/java/org/apache/fineract/accounting/producttoaccountmapping/domain/ProductToGLAccountMappingRepository.java", "diffHunk": "@@ -30,8 +30,9 @@\n     ProductToGLAccountMapping findByProductIdAndProductTypeAndFinancialAccountTypeAndPaymentTypeId(Long productId, int productType,\n             int financialAccountType, Long paymentType);\n \n-    ProductToGLAccountMapping findByProductIdAndProductTypeAndFinancialAccountTypeAndChargeId(Long productId, int productType,\n-            int financialAccountType, Long chargeId);\n+    @Query(\"select mapping from ProductToGLAccountMapping mapping where mapping.productId= :productId and mapping.productType= :productType and mapping.financialAccountType= :financialAccountType and mapping.charge.id= :chargeId\")\n+    ProductToGLAccountMapping findProductIdAndProductTypeAndFinancialAccountTypeAndChargeId(@Param(\"productId\") Long productId, @Param(\"productType\") int productType,\n+            @Param(\"financialAccountType\") int financialAccountType, @Param(\"chargeId\") Long ChargeId);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyOTM3NTIxOQ=="}, "originalCommit": {"oid": "051caa0be58a50fba92ade501e02a8b5306066ae"}, "originalPosition": 8}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1990, "cost": 1, "resetAt": "2021-11-12T11:18:39Z"}}}