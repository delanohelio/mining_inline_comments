{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDYwMzE5NTQ4", "number": 1220, "title": "FINERACT-1109 appropriate-interest-larger-than-emi", "bodyText": "Description\nDescribe the changes made and why they were made. Ignore if these details are present on the associated Jira ticket\nhttps://mifosforge.jira.com/browse/AL-14\nChecklist\nPlease make sure these boxes are checked before submitting your pull request - thanks!\n\n\n Commit message starts with the issue number from https://issues.apache.org/jira/projects/FINERACT/. Ex: FINERACT-646 Pockets API.\n\n\n Coding conventions at https://cwiki.apache.org/confluence/display/FINERACT/Coding+Conventions have been followed.\n\n\n API documentation at fineract-provider/src/main/resources/static/api-docs/apiLive.htm has been updated with details of any API changes.\n\n\n Integration tests have been created/updated for verifying the changes made.\n\n\n All Integrations tests are passing with the new commits.\n\n\n Submission is not a \"code dump\".  (Large changes can be made \"in repository\" via a branch.  Ask on the list.)\n\n\nOur guidelines for code reviews is at https://cwiki.apache.org/confluence/display/FINERACT/Code+Review+Guide", "createdAt": "2020-07-31T16:58:17Z", "url": "https://github.com/apache/fineract/pull/1220", "merged": true, "mergeCommit": {"oid": "899eab8ebc4f42388b875fcda481b1d3b8e848fe"}, "closed": true, "closedAt": "2020-08-19T14:50:26Z", "author": {"login": "fynmanoj"}, "timelineItems": {"totalCount": 10, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABc6YHmpgBqjM2MDk2NDA3ODU=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdAK0A9AH2gAyNDYwMzE5NTQ4OmRiOTgwMjM2YWQyNGY5YTE1YTkyZjY0ZTkxOGM2MjlmMWVlYzkyN2E=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "d759ef6ad48e7c6bff51dc0a5343ab8d9519d6ef", "author": {"user": null}, "url": "https://github.com/apache/fineract/commit/d759ef6ad48e7c6bff51dc0a5343ab8d9519d6ef", "committedDate": "2020-07-31T16:57:21Z", "message": "AL-14-approppritae-interest-larger-than-emi"}, "afterCommit": {"oid": "33a72da5e38c05fc7761a1322964488f8cd89593", "author": {"user": null}, "url": "https://github.com/apache/fineract/commit/33a72da5e38c05fc7761a1322964488f8cd89593", "committedDate": "2020-07-31T17:59:29Z", "message": "AL-14-appropritae-interest-larger-than-emi"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDY3MTI5MjI2", "url": "https://github.com/apache/fineract/pull/1220#pullrequestreview-467129226", "createdAt": "2020-08-13T21:05:12Z", "commit": {"oid": "33a72da5e38c05fc7761a1322964488f8cd89593"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xM1QyMTowNToxMlrOHAdpfw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xM1QyMToxMToxNlrOHAd08g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MDI0NzgwNw==", "bodyText": "This should have been part of PR FIN-1106.", "url": "https://github.com/apache/fineract/pull/1220#discussion_r470247807", "createdAt": "2020-08-13T21:05:12Z", "author": {"login": "avikganguly01"}, "path": "fineract-provider/src/main/java/org/apache/fineract/infrastructure/configuration/domain/ConfigurationDomainServiceJpa.java", "diffHunk": "@@ -252,6 +252,16 @@ public boolean isSkippingMeetingOnFirstDayOfMonthEnabled() {\n         return getGlobalConfigurationPropertyData(\"skip-repayment-on-first-day-of-month\").isEnabled();\n     }\n \n+    @Override\n+    public boolean isFirstRepaymentDateAfterRescheduleAllowedOnHoliday() {\n+        return getGlobalConfigurationPropertyData(\"loan-reschedule-is-first-payday-allowed-on-holiday\").isEnabled();\n+    }", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "33a72da5e38c05fc7761a1322964488f8cd89593"}, "originalPosition": 7}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MDI0ODk3Nw==", "bodyText": "Is tranche loan approval failing due to flag?", "url": "https://github.com/apache/fineract/pull/1220#discussion_r470248977", "createdAt": "2020-08-13T21:07:38Z", "author": {"login": "avikganguly01"}, "path": "fineract-provider/src/main/java/org/apache/fineract/portfolio/loanaccount/loanschedule/domain/AbstractLoanScheduleGenerator.java", "diffHunk": "@@ -279,7 +282,8 @@ private LoanScheduleModel generate(final MathContext mc, final LoanApplicationTe\n \n             // will check for EMI amount greater than interest calculated\n             if (loanApplicationTerms.getFixedEmiAmount() != null\n-                    && loanApplicationTerms.getFixedEmiAmount().compareTo(principalInterestForThisPeriod.interest().getAmount()) < 0) {\n+                    && loanApplicationTerms.getFixedEmiAmount().compareTo(principalInterestForThisPeriod.interest().getAmount()) < 0\n+                    && !loanApplicationTerms.isInterestToBeAppropriatedEquallyWhenGreaterThanEMIEnabled()) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "33a72da5e38c05fc7761a1322964488f8cd89593"}, "originalPosition": 31}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MDI0OTk3OA==", "bodyText": "LGTM", "url": "https://github.com/apache/fineract/pull/1220#discussion_r470249978", "createdAt": "2020-08-13T21:09:41Z", "author": {"login": "avikganguly01"}, "path": "fineract-provider/src/main/java/org/apache/fineract/portfolio/loanaccount/loanschedule/domain/DecliningBalanceInterestLoanScheduleGenerator.java", "diffHunk": "@@ -125,7 +125,30 @@ public PrincipalInterest calculatePrincipalInterestComponentsForPeriod(final Pay\n                 interestCalculationGraceOnRepaymentPeriodFraction, periodNumber, mc, cumulatingInterestDueToGrace,\n                 balanceForInterestCalculation, interestStartDate, periodEndDate);\n \n-        interestForThisInstallment = interestForThisInstallment.plus(result.interest());\n+        if (loanApplicationTerms.isInterestToBeAppropriatedEquallyWhenGreaterThanEMIEnabled() && !result.interest().isZero()\n+                && !interestForThisInstallment.isZero()) {\n+            loanApplicationTerms.setInterestTobeApproppriated(result.interest());\n+        } else {\n+            interestForThisInstallment = interestForThisInstallment.plus(result.interest());\n+        }\n+\n+        if (loanApplicationTerms.getFixedEmiAmount() != null\n+                && loanApplicationTerms.isInterestToBeAppropriatedEquallyWhenGreaterThanEMIEnabled() && interestForThisInstallment\n+                        .isGreaterThan(Money.of(interestForThisInstallment.getCurrency(), loanApplicationTerms.getFixedEmiAmount()))) {\n+            LocalDate actualPeriodEndDate = this.scheduledDateGenerator.generateNextRepaymentDate(interestStartDate, loanApplicationTerms,\n+                    false);\n+            // AdjustedDateDetailsDTO adjustedDateDetailsDTO = this.scheduledDateGenerator\n+            // .adjustRepaymentDate(actualPeriodEndDate, loanApplicationTerms,\n+            // loanApplicationTerms.getHolidayDetailDTO());\n+\n+            PrincipalInterest tempInterest = loanApplicationTerms.calculateTotalInterestForPeriod(calculator,\n+                    interestCalculationGraceOnRepaymentPeriodFraction, periodNumber, mc, cumulatingInterestDueToGrace,\n+                    balanceForInterestCalculation, interestStartDate, actualPeriodEndDate);\n+\n+            loanApplicationTerms.setInterestTobeApproppriated(interestForThisInstallment.minus(tempInterest.interest()));\n+            interestForThisInstallment = tempInterest.interest();\n+        }", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "33a72da5e38c05fc7761a1322964488f8cd89593"}, "originalPosition": 27}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MDI1MDczOA==", "bodyText": "Looks like a different bug got squashed here. What effects could this bug have been producing? Shall we create a different ticket to track this?", "url": "https://github.com/apache/fineract/pull/1220#discussion_r470250738", "createdAt": "2020-08-13T21:11:16Z", "author": {"login": "avikganguly01"}, "path": "fineract-provider/src/main/java/org/apache/fineract/portfolio/loanaccount/loanschedule/domain/LoanScheduleModelRepaymentPeriod.java", "diffHunk": "@@ -154,7 +154,7 @@ public boolean isRecalculatedInterestComponent() {\n     @Override\n     public void addInterestAmount(Money interestDue) {\n         this.interestDue = this.interestDue.plus(interestDue);\n-        this.totalDue = this.totalDue.plus(principalDue);\n+        this.totalDue = this.totalDue.plus(interestDue);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "33a72da5e38c05fc7761a1322964488f8cd89593"}, "originalPosition": 5}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "33a72da5e38c05fc7761a1322964488f8cd89593", "author": {"user": null}, "url": "https://github.com/apache/fineract/commit/33a72da5e38c05fc7761a1322964488f8cd89593", "committedDate": "2020-07-31T17:59:29Z", "message": "AL-14-appropritae-interest-larger-than-emi"}, "afterCommit": {"oid": "9963a2376174bc8b4f457a5bcf8393a5a9a358e8", "author": {"user": null}, "url": "https://github.com/apache/fineract/commit/9963a2376174bc8b4f457a5bcf8393a5a9a358e8", "committedDate": "2020-08-14T17:08:11Z", "message": "AL-14-appropritae-interest-larger-than-emi"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "9963a2376174bc8b4f457a5bcf8393a5a9a358e8", "author": {"user": null}, "url": "https://github.com/apache/fineract/commit/9963a2376174bc8b4f457a5bcf8393a5a9a358e8", "committedDate": "2020-08-14T17:08:11Z", "message": "AL-14-appropritae-interest-larger-than-emi"}, "afterCommit": {"oid": "9f000683d07a614672ed0d21be95cc8d727909fe", "author": {"user": {"login": "fynmanoj", "name": "Manoj"}}, "url": "https://github.com/apache/fineract/commit/9f000683d07a614672ed0d21be95cc8d727909fe", "committedDate": "2020-08-14T20:12:34Z", "message": "FINERACT-1109 appropriate-interest-larger-than-emi"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "9f000683d07a614672ed0d21be95cc8d727909fe", "author": {"user": {"login": "fynmanoj", "name": "Manoj"}}, "url": "https://github.com/apache/fineract/commit/9f000683d07a614672ed0d21be95cc8d727909fe", "committedDate": "2020-08-14T20:12:34Z", "message": "FINERACT-1109 appropriate-interest-larger-than-emi"}, "afterCommit": {"oid": "a0644ff037c2683336b6b1ee62007f2ff471882e", "author": {"user": {"login": "fynmanoj", "name": "Manoj"}}, "url": "https://github.com/apache/fineract/commit/a0644ff037c2683336b6b1ee62007f2ff471882e", "committedDate": "2020-08-14T20:35:58Z", "message": "FINERACT-1109 appropriate-interest-larger-than-emi"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "60ead7857a2590518af057dc954bb627675c0bfd", "author": {"user": {"login": "fynmanoj", "name": "Manoj"}}, "url": "https://github.com/apache/fineract/commit/60ead7857a2590518af057dc954bb627675c0bfd", "committedDate": "2020-08-17T07:38:32Z", "message": "merge issue fix"}, "afterCommit": {"oid": "bb7fb6d91b473d429a6790b2cc38c92f0866f18a", "author": {"user": {"login": "fynmanoj", "name": "Manoj"}}, "url": "https://github.com/apache/fineract/commit/bb7fb6d91b473d429a6790b2cc38c92f0866f18a", "committedDate": "2020-08-17T16:10:27Z", "message": "FINERACT-1109 appropriate-interest-larger-than-emi"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "bb7fb6d91b473d429a6790b2cc38c92f0866f18a", "author": {"user": {"login": "fynmanoj", "name": "Manoj"}}, "url": "https://github.com/apache/fineract/commit/bb7fb6d91b473d429a6790b2cc38c92f0866f18a", "committedDate": "2020-08-17T16:10:27Z", "message": "FINERACT-1109 appropriate-interest-larger-than-emi"}, "afterCommit": {"oid": "548f383a89fdf795eb5042a685cdc955f4cde378", "author": {"user": {"login": "fynmanoj", "name": "Manoj"}}, "url": "https://github.com/apache/fineract/commit/548f383a89fdf795eb5042a685cdc955f4cde378", "committedDate": "2020-08-18T16:51:11Z", "message": "FINERACT-1109 appropriate-interest-larger-than-emi"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "548f383a89fdf795eb5042a685cdc955f4cde378", "author": {"user": {"login": "fynmanoj", "name": "Manoj"}}, "url": "https://github.com/apache/fineract/commit/548f383a89fdf795eb5042a685cdc955f4cde378", "committedDate": "2020-08-18T16:51:11Z", "message": "FINERACT-1109 appropriate-interest-larger-than-emi"}, "afterCommit": {"oid": "e53eb23013058c13df95bd35e44f74fbdcbb5709", "author": {"user": {"login": "fynmanoj", "name": "Manoj"}}, "url": "https://github.com/apache/fineract/commit/e53eb23013058c13df95bd35e44f74fbdcbb5709", "committedDate": "2020-08-18T17:17:16Z", "message": "FINERACT-1109 appropriate-interest-larger-than-emi"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "e53eb23013058c13df95bd35e44f74fbdcbb5709", "author": {"user": {"login": "fynmanoj", "name": "Manoj"}}, "url": "https://github.com/apache/fineract/commit/e53eb23013058c13df95bd35e44f74fbdcbb5709", "committedDate": "2020-08-18T17:17:16Z", "message": "FINERACT-1109 appropriate-interest-larger-than-emi"}, "afterCommit": {"oid": "db980236ad24f9a15a92f64e918c629f1eec927a", "author": {"user": {"login": "fynmanoj", "name": "Manoj"}}, "url": "https://github.com/apache/fineract/commit/db980236ad24f9a15a92f64e918c629f1eec927a", "committedDate": "2020-08-18T17:53:06Z", "message": "FINERACT-1109 appropriate-interest-larger-than-emi"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "db980236ad24f9a15a92f64e918c629f1eec927a", "author": {"user": {"login": "fynmanoj", "name": "Manoj"}}, "url": "https://github.com/apache/fineract/commit/db980236ad24f9a15a92f64e918c629f1eec927a", "committedDate": "2020-08-18T17:53:06Z", "message": "FINERACT-1109 appropriate-interest-larger-than-emi"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1780, "cost": 1, "resetAt": "2021-10-29T17:30:11Z"}}}