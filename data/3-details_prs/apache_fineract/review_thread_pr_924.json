{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDIxODMyNjY2", "number": 924, "reviewThreads": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yMlQxNzo0NTo0MVrOD_Bs-A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yOFQxNjoxMzowNlrOEAlD4g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjY3NDE0Nzc2OnYy", "diffSide": "RIGHT", "path": "fineract-provider/src/main/java/org/apache/fineract/portfolio/accountdetails/service/AccountDetailsReadPlatformServiceJpaRepositoryImpl.java", "isResolved": true, "comments": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yMlQxNzo0NTo0MVrOGZfHYg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yOFQxNjoxNjoxOVrOGb8v7A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyOTM3NzM3OA==", "bodyText": "This still doesn't seem to take the code review feedback that @vishwasbabu had provided in #574 into account?", "url": "https://github.com/apache/fineract/pull/924#discussion_r429377378", "createdAt": "2020-05-22T17:45:41Z", "author": {"login": "vorburger"}, "path": "fineract-provider/src/main/java/org/apache/fineract/portfolio/accountdetails/service/AccountDetailsReadPlatformServiceJpaRepositoryImpl.java", "diffHunk": "@@ -171,6 +172,12 @@ public AccountSummaryCollectionData retrieveGroupAccountDetails(final Long group\n         return this.jdbcTemplate.query(sql, rm, new Object[]{groupId , glimAccount});\n     }\n \n+    @Override\n+    public Collection<LoanAccountSummaryData> retrieveGroupActiveLoanAccountSummary(final Long groupId) {\n+        final String loanWhereClause = \" where l.group_id = ? and l.loan_status_id = 300 \";", "state": "SUBMITTED", "replyTo": null, "originalCommit": null, "originalPosition": 16}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyOTM5NjEwMQ==", "bodyText": "From\n\n(since you check if client ID is not null in the service method), it might introduce bugs in the future when someone tries to reuse this method. I would suggest returning only loans of type 3.\n\nI removed the conditional statement to check if client ID is null from LoanReadPlatformServiceImpl", "url": "https://github.com/apache/fineract/pull/924#discussion_r429396101", "createdAt": "2020-05-22T18:30:11Z", "author": {"login": "percyashu"}, "path": "fineract-provider/src/main/java/org/apache/fineract/portfolio/accountdetails/service/AccountDetailsReadPlatformServiceJpaRepositoryImpl.java", "diffHunk": "@@ -171,6 +172,12 @@ public AccountSummaryCollectionData retrieveGroupAccountDetails(final Long group\n         return this.jdbcTemplate.query(sql, rm, new Object[]{groupId , glimAccount});\n     }\n \n+    @Override\n+    public Collection<LoanAccountSummaryData> retrieveGroupActiveLoanAccountSummary(final Long groupId) {\n+        final String loanWhereClause = \" where l.group_id = ? and l.loan_status_id = 300 \";", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyOTM3NzM3OA=="}, "originalCommit": null, "originalPosition": 16}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyOTQwNzI0Mg==", "bodyText": "@vishwasbabu does this LGTY?", "url": "https://github.com/apache/fineract/pull/924#discussion_r429407242", "createdAt": "2020-05-22T18:58:26Z", "author": {"login": "vorburger"}, "path": "fineract-provider/src/main/java/org/apache/fineract/portfolio/accountdetails/service/AccountDetailsReadPlatformServiceJpaRepositoryImpl.java", "diffHunk": "@@ -171,6 +172,12 @@ public AccountSummaryCollectionData retrieveGroupAccountDetails(final Long group\n         return this.jdbcTemplate.query(sql, rm, new Object[]{groupId , glimAccount});\n     }\n \n+    @Override\n+    public Collection<LoanAccountSummaryData> retrieveGroupActiveLoanAccountSummary(final Long groupId) {\n+        final String loanWhereClause = \" where l.group_id = ? and l.loan_status_id = 300 \";", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyOTM3NzM3OA=="}, "originalCommit": null, "originalPosition": 16}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMTk2MDA0NA==", "bodyText": "I would append a clause to the effect of \"l.client_id is NULL\", this ensures that only group loans are fetched by the query all JLG loans are ignored (loans which are associated with clients and groups and fetched as a part of the retrieveClientActiveLoanAccountSummary method)", "url": "https://github.com/apache/fineract/pull/924#discussion_r431960044", "createdAt": "2020-05-28T16:16:19Z", "author": {"login": "vishwasbabu"}, "path": "fineract-provider/src/main/java/org/apache/fineract/portfolio/accountdetails/service/AccountDetailsReadPlatformServiceJpaRepositoryImpl.java", "diffHunk": "@@ -171,6 +172,12 @@ public AccountSummaryCollectionData retrieveGroupAccountDetails(final Long group\n         return this.jdbcTemplate.query(sql, rm, new Object[]{groupId , glimAccount});\n     }\n \n+    @Override\n+    public Collection<LoanAccountSummaryData> retrieveGroupActiveLoanAccountSummary(final Long groupId) {\n+        final String loanWhereClause = \" where l.group_id = ? and l.loan_status_id = 300 \";", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyOTM3NzM3OA=="}, "originalCommit": null, "originalPosition": 16}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjY5MDQyNjU4OnYy", "diffSide": "LEFT", "path": "fineract-provider/src/main/java/org/apache/fineract/portfolio/loanaccount/service/LoanReadPlatformServiceImpl.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yOFQxNjoxMzowNlrOGb8mew==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yOFQxNjoxMzowNlrOGb8mew==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMTk1NzYyNw==", "bodyText": "We shouldn't be removing the existing condition which checks for client loans, rather we should be adding an else if for additionally checking for group loans", "url": "https://github.com/apache/fineract/pull/924#discussion_r431957627", "createdAt": "2020-05-28T16:13:06Z", "author": {"login": "vishwasbabu"}, "path": "fineract-provider/src/main/java/org/apache/fineract/portfolio/loanaccount/service/LoanReadPlatformServiceImpl.java", "diffHunk": "@@ -1428,15 +1428,15 @@ public LoanAccountData retrieveLoanProductDetailsTemplate(final Long productId,\n             }\n         }\n \n-        Collection<LoanAccountSummaryData> clientActiveLoanOptions = null;\n-        if(loanProduct.canUseForTopup() && clientId != null){\n-            clientActiveLoanOptions = this.accountDetailsReadPlatformService.retrieveClientActiveLoanAccountSummary(clientId);", "state": "SUBMITTED", "replyTo": null, "originalCommit": null, "originalPosition": 6}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1987, "cost": 1, "resetAt": "2021-11-12T11:18:39Z"}}}