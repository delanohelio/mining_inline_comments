{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDMyMTkyOTQy", "number": 1024, "title": "FINERACT-995: Rewriting logic to remove call to rs.previous()", "bodyText": "FINERACT-995\nDescription\nRewrote the logic to remove call to rs.previous() that was throwing an SQLException.\nChecklist\nPlease make sure these boxes are checked before submitting your pull request - thanks!\n\n\n Commit message starts with the issue number from https://issues.apache.org/jira/projects/FINERACT/. Ex: FINERACT-646 Pockets API.\n\n\n Coding conventions at https://cwiki.apache.org/confluence/display/FINERACT/Coding+Conventions have been followed.\n\n\n API documentation at fineract-provider/src/main/resources/static/api-docs/apiLive.htm has been updated with details of any API changes.\n\n\n Integration tests have been created/updated for verifying the changes made.\n\n\n All Integrations tests are passing with the new commits.\n\n\n Submission is not a \"code dump\".  (Large changes can be made \"in repository\" via a branch.  Ask on the list.)\n\n\nOur guidelines for code reviews is at https://cwiki.apache.org/confluence/display/FINERACT/Code+Review+Guide", "createdAt": "2020-06-10T04:27:28Z", "url": "https://github.com/apache/fineract/pull/1024", "merged": true, "mergeCommit": {"oid": "6438063a7ff0267db3816817c71a3ea73ca9157d"}, "closed": true, "closedAt": "2020-06-20T20:32:07Z", "author": {"login": "ptuomola"}, "timelineItems": {"totalCount": 7, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcqYL6VAFqTQyOTM5NzQ4OA==", "endCursor": "Y3Vyc29yOnYyOpPPAAABctNt9BAFqTQzNDQ1MjE5Ng==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDI5Mzk3NDg4", "url": "https://github.com/apache/fineract/pull/1024#pullrequestreview-429397488", "createdAt": "2020-06-12T01:01:38Z", "commit": {"oid": "558002c6187733d31cbc49b3ec9ff754bede0e8e"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xMlQwMTowMTozOFrOGizzEQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xMlQwMTowMTozOFrOGizzEQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzOTE1MzQyNQ==", "bodyText": "I'm trying to understand this to the best I can but I just have the feeling that this piece of logic is missing. Can you maybe make it a little clearer for me?\nThanks.", "url": "https://github.com/apache/fineract/pull/1024#discussion_r439153425", "createdAt": "2020-06-12T01:01:38Z", "author": {"login": "xurror"}, "path": "fineract-provider/src/main/java/org/apache/fineract/portfolio/loanaccount/service/LoanArrearsAgingServiceImpl.java", "diffHunk": "@@ -423,18 +423,14 @@ public OriginalScheduleExtractor(final String loanIdsAsString) {\n \n             while (rs.next()) {\n                 Long loanId = rs.getLong(\"loanId\");\n-                List<LoanSchedulePeriodData> periodDatas = new ArrayList<>();\n-                LoanSchedulePeriodData loanSchedulePeriodData = fetchLoanSchedulePeriodData(rs);\n-                periodDatas.add(loanSchedulePeriodData);\n-                while (rs.next()) {\n-                    Long tempLoanId = rs.getLong(\"loanId\");\n-                    if (loanId.equals(tempLoanId)) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "558002c6187733d31cbc49b3ec9ff754bede0e8e"}, "originalPosition": 9}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "558002c6187733d31cbc49b3ec9ff754bede0e8e", "author": {"user": {"login": "ptuomola", "name": "Petri Tuomola"}}, "url": "https://github.com/apache/fineract/commit/558002c6187733d31cbc49b3ec9ff754bede0e8e", "committedDate": "2020-06-10T04:25:37Z", "message": "FINERACT-995: Rewriting logic to remove call to rs.previous()"}, "afterCommit": {"oid": "311f861ee59628690d43ac8673366dc9ce9b8f12", "author": {"user": {"login": "ptuomola", "name": "Petri Tuomola"}}, "url": "https://github.com/apache/fineract/commit/311f861ee59628690d43ac8673366dc9ce9b8f12", "committedDate": "2020-06-20T10:07:16Z", "message": "FINERACT-995: Rewriting logic to remove call to rs.previous()"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDM0NDE4Mzgy", "url": "https://github.com/apache/fineract/pull/1024#pullrequestreview-434418382", "createdAt": "2020-06-20T10:13:42Z", "commit": {"oid": "558002c6187733d31cbc49b3ec9ff754bede0e8e"}, "state": "APPROVED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yMFQxMDoxMzo0MlrOGml29Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yMFQxMDoxMzo0MlrOGml29Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MzExOTM0OQ==", "bodyText": "@ptuomola sorry for delay in reviewing this (I wanted to do it with a clear mind instead of clicking through it half asleep a night after day job work...) and after staring at this a little bit, I get it now - this makes good sense to me as well, and I have no objection to merging this even without having any way to functionally test this myself either (no idea if existing ITs, recently re-enable, would catch this, but doesn't matter, it \"makes sense\").\nOne very small feedback I would have is that, now that I understand this logic, it seems to me that moving that scheduleDate.put(loanId, periodDatas); now in line 449 (originally 434) up into the if(periodDatas == null) right after the periodDatas = new ArrayList<>(); would make it a tiny bit more clear and explicit what we're doing here? It's too minor to hold back merging this important fix, so I'll just go ahead and merge it ASAP, and let you raise a very small minor follow-up PR, if you like (or not, fine). I originally wrote this before seeing the Spotless style failure, if you're going over this again, might as well do that too here - if you agree that makes sense?", "url": "https://github.com/apache/fineract/pull/1024#discussion_r443119349", "createdAt": "2020-06-20T10:13:42Z", "author": {"login": "vorburger"}, "path": "fineract-provider/src/main/java/org/apache/fineract/portfolio/loanaccount/service/LoanArrearsAgingServiceImpl.java", "diffHunk": "@@ -423,18 +423,14 @@ public OriginalScheduleExtractor(final String loanIdsAsString) {\n \n             while (rs.next()) {\n                 Long loanId = rs.getLong(\"loanId\");\n-                List<LoanSchedulePeriodData> periodDatas = new ArrayList<>();\n-                LoanSchedulePeriodData loanSchedulePeriodData = fetchLoanSchedulePeriodData(rs);\n-                periodDatas.add(loanSchedulePeriodData);\n-                while (rs.next()) {\n-                    Long tempLoanId = rs.getLong(\"loanId\");\n-                    if (loanId.equals(tempLoanId)) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzOTE1MzQyNQ=="}, "originalCommit": {"oid": "558002c6187733d31cbc49b3ec9ff754bede0e8e"}, "originalPosition": 9}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "311f861ee59628690d43ac8673366dc9ce9b8f12", "author": {"user": {"login": "ptuomola", "name": "Petri Tuomola"}}, "url": "https://github.com/apache/fineract/commit/311f861ee59628690d43ac8673366dc9ce9b8f12", "committedDate": "2020-06-20T10:07:16Z", "message": "FINERACT-995: Rewriting logic to remove call to rs.previous()"}, "afterCommit": {"oid": "3ffa06e7dc0e390f8e9c9095a625f320b1523751", "author": {"user": {"login": "ptuomola", "name": "Petri Tuomola"}}, "url": "https://github.com/apache/fineract/commit/3ffa06e7dc0e390f8e9c9095a625f320b1523751", "committedDate": "2020-06-20T17:43:52Z", "message": "FINERACT-995: Rewriting logic to remove call to rs.previous()"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "8bba9323e07c0bc863cc7cee1bc315f722705381", "author": {"user": {"login": "ptuomola", "name": "Petri Tuomola"}}, "url": "https://github.com/apache/fineract/commit/8bba9323e07c0bc863cc7cee1bc315f722705381", "committedDate": "2020-06-20T18:20:58Z", "message": "FINERACT-995: Rewriting logic to remove call to rs.previous()"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "3ffa06e7dc0e390f8e9c9095a625f320b1523751", "author": {"user": {"login": "ptuomola", "name": "Petri Tuomola"}}, "url": "https://github.com/apache/fineract/commit/3ffa06e7dc0e390f8e9c9095a625f320b1523751", "committedDate": "2020-06-20T17:43:52Z", "message": "FINERACT-995: Rewriting logic to remove call to rs.previous()"}, "afterCommit": {"oid": "8bba9323e07c0bc863cc7cee1bc315f722705381", "author": {"user": {"login": "ptuomola", "name": "Petri Tuomola"}}, "url": "https://github.com/apache/fineract/commit/8bba9323e07c0bc863cc7cee1bc315f722705381", "committedDate": "2020-06-20T18:20:58Z", "message": "FINERACT-995: Rewriting logic to remove call to rs.previous()"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDM0NDUyMTk2", "url": "https://github.com/apache/fineract/pull/1024#pullrequestreview-434452196", "createdAt": "2020-06-20T20:31:37Z", "commit": {"oid": "8bba9323e07c0bc863cc7cee1bc315f722705381"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yMFQyMDozMTozN1rOGmoNog==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yMFQyMDozMTozN1rOGmoNog==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MzE1NzkyMg==", "bodyText": "@ptuomola just noticed while merging this that you haven't actually changed the sleep 30s so this comment is perhaps a left over? I'll merge this PR anyway, you can always clean it up later, if you like.", "url": "https://github.com/apache/fineract/pull/1024#discussion_r443157922", "createdAt": "2020-06-20T20:31:37Z", "author": {"login": "vorburger"}, "path": ".travis.yml", "diffHunk": "@@ -73,6 +73,7 @@ script:\n # using \"&&\" instead of several \"-\" means that integrationTest does not run if test fails,\n # and Docker test does not run if integration test fails, which makes PR failure easier to understand.\n # @see https://docs.travis-ci.com/user/job-lifecycle/#customizing-the-build-phase\n+# NOTE: Sleep after docker-compose increased to 60 seconds as often Travis would fail to get Docker up in 30 seconds", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "8bba9323e07c0bc863cc7cee1bc315f722705381"}, "originalPosition": 4}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1890, "cost": 1, "resetAt": "2021-10-29T17:30:11Z"}}}