{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0Mzg2MDc2MzY5", "number": 730, "title": "Added: SQL builder toString function", "bodyText": "Description\nTo continue to work done in #725 by @vorburger this PR intends to complete one of the remaining tasks.\nPlease use the following for functional testing: http://tpcg.io/QfG1joot [outdated] (directly run for sample output)\nAfter this PR, I intend to write proper test statements as required.\nNote: Another approach could have been directly using sb, I decided to do it this way any suggestions are welcome :)\nChecklist\nPlease make sure these boxes are checked before submitting your pull request - thanks!\n\n\n Commit message starts with the issue number from https://issues.apache.org/jira/projects/FINERACT/. Ex: FINERACT-646 Pockets API.\n\n\n Coding conventions at https://cwiki.apache.org/confluence/display/FINERACT/Coding+Conventions have been followed.\n\n\n API documentation at https://github.com/apache/fineract/blob/develop/api-docs/apiLive.htm has been updated with details of any API changes.\n\n\n Integration tests have been created/updated for verifying the changes made.\n\n\n All Integrations tests are passing with the new commits.\n\n\n Submission is not a \"code dump\".  (Large changes can be made \"in repository\" via a branch.  Ask on the list.)\n\n\nOur guidelines for code reviews is at https://cwiki.apache.org/confluence/display/FINERACT/Code+Review+Guide", "createdAt": "2020-03-10T11:22:41Z", "url": "https://github.com/apache/fineract/pull/730", "merged": true, "mergeCommit": {"oid": "93d171663078ad883d1e1242a8c35c02b8230741"}, "closed": true, "closedAt": "2020-03-12T11:54:47Z", "author": {"login": "thesmallstar"}, "timelineItems": {"totalCount": 8, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcMRNpeAFqTM3MTg4NDA4Nw==", "endCursor": "Y3Vyc29yOnYyOpPPAAABcMVeL2gFqTM3MjE0MTAwMQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzcxODg0MDg3", "url": "https://github.com/apache/fineract/pull/730#pullrequestreview-371884087", "createdAt": "2020-03-10T11:51:01Z", "commit": {"oid": "6c24faf7d8a10e4bf509449e95a1135ad4570221"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xMFQxMTo1MTowMVrOF0LnGw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xMFQxMTo1Mzo1MFrOF0LsKw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MDI2MDUwNw==", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                    StringBuilder whereClause  = new StringBuilder();\n          \n          \n            \n                    StringBuilder whereClause  = new StringBuilder(\"SQLBuilder{ \");", "url": "https://github.com/apache/fineract/pull/730#discussion_r390260507", "createdAt": "2020-03-10T11:51:01Z", "author": {"login": "vorburger"}, "path": "fineract-provider/src/main/java/org/apache/fineract/infrastructure/security/utils/SQLBuilder.java", "diffHunk": "@@ -118,9 +121,34 @@ public String getSQLTemplate() {\n     /*\n      * Returns a String representation suitable for debugging and log output.\n      * This is ONLY intended for debugging in logs, and NEVER for passing to a JDBC database.\n+     */\n     @Override\n     public String toString() {\n-        return \"SQLBuilder{...\"; // TODO implement this...\n+        StringBuilder whereClause  = new StringBuilder();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "6c24faf7d8a10e4bf509449e95a1135ad4570221"}, "originalPosition": 25}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MDI2MTE2NA==", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                    return \"SQLBuilder{\"+ whereClause.toString() +\"}\";\n          \n          \n            \n                    whereClause.append(\" }\");\n          \n          \n            \n                    return whereClause.toString();\n          \n      \n    \n    \n  \n\nThe point of this is to avoid unnecessary String concatenation object creation.\nYou should also avoid any other String + in this method - just append() everything.", "url": "https://github.com/apache/fineract/pull/730#discussion_r390261164", "createdAt": "2020-03-10T11:52:27Z", "author": {"login": "vorburger"}, "path": "fineract-provider/src/main/java/org/apache/fineract/infrastructure/security/utils/SQLBuilder.java", "diffHunk": "@@ -118,9 +121,34 @@ public String getSQLTemplate() {\n     /*\n      * Returns a String representation suitable for debugging and log output.\n      * This is ONLY intended for debugging in logs, and NEVER for passing to a JDBC database.\n+     */\n     @Override\n     public String toString() {\n-        return \"SQLBuilder{...\"; // TODO implement this...\n+        StringBuilder whereClause  = new StringBuilder();\n+        ArrayList<String> modifiedArgs = new ArrayList<String>();\n+        for (Object obj : args)\n+        {\n+            if(obj instanceof String)\n+            {\n+                modifiedArgs.add(\"['\"+ obj + \"']\");\n+            }else if(obj == null)\n+            {\n+                modifiedArgs.add(\"[null]\");\n+            }else{\n+                modifiedArgs.add(\"[\"+ String.valueOf(obj) +\"]\");\n+            }\n+        }\n+        for (int i=0;i<crts.size();i++)\n+        {    if (whereClause.length() > 0)\n+            {\n+                whereClause.append(\"  AND  \");\n+            }\n+            if(whereClause.length()==0)\n+            {\n+                whereClause.append(\"WHERE  \");\n+            }\n+            whereClause.append(crts.get(i) + \" \" + modifiedArgs.get(i));\n+        }\n+        return \"SQLBuilder{\"+ whereClause.toString() +\"}\";", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "6c24faf7d8a10e4bf509449e95a1135ad4570221"}, "originalPosition": 50}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MDI2MTgwMw==", "bodyText": "you can probably avoid creating this intermediate list? Just iterate and append to the StringBuilder, no? Or perhaps I'm missing something here (quick review only; didn't read the code in full details).", "url": "https://github.com/apache/fineract/pull/730#discussion_r390261803", "createdAt": "2020-03-10T11:53:50Z", "author": {"login": "vorburger"}, "path": "fineract-provider/src/main/java/org/apache/fineract/infrastructure/security/utils/SQLBuilder.java", "diffHunk": "@@ -118,9 +121,34 @@ public String getSQLTemplate() {\n     /*\n      * Returns a String representation suitable for debugging and log output.\n      * This is ONLY intended for debugging in logs, and NEVER for passing to a JDBC database.\n+     */\n     @Override\n     public String toString() {\n-        return \"SQLBuilder{...\"; // TODO implement this...\n+        StringBuilder whereClause  = new StringBuilder();\n+        ArrayList<String> modifiedArgs = new ArrayList<String>();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "6c24faf7d8a10e4bf509449e95a1135ad4570221"}, "originalPosition": 26}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "6c24faf7d8a10e4bf509449e95a1135ad4570221", "author": {"user": {"login": "thesmallstar", "name": "Manthan Surkar"}}, "url": "https://github.com/apache/fineract/commit/6c24faf7d8a10e4bf509449e95a1135ad4570221", "committedDate": "2020-03-10T11:17:31Z", "message": "Added: SQL builder toString function"}, "afterCommit": {"oid": "3d872624523e73d87e513384b8edc33ba4da9433", "author": {"user": {"login": "thesmallstar", "name": "Manthan Surkar"}}, "url": "https://github.com/apache/fineract/commit/3d872624523e73d87e513384b8edc33ba4da9433", "committedDate": "2020-03-10T15:30:47Z", "message": "Added: SQL builder toString function"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "3d872624523e73d87e513384b8edc33ba4da9433", "author": {"user": {"login": "thesmallstar", "name": "Manthan Surkar"}}, "url": "https://github.com/apache/fineract/commit/3d872624523e73d87e513384b8edc33ba4da9433", "committedDate": "2020-03-10T15:30:47Z", "message": "Added: SQL builder toString function"}, "afterCommit": {"oid": "1be08bbb582646404a112223804ac25898d8bddb", "author": {"user": {"login": "thesmallstar", "name": "Manthan Surkar"}}, "url": "https://github.com/apache/fineract/commit/1be08bbb582646404a112223804ac25898d8bddb", "committedDate": "2020-03-10T15:36:53Z", "message": "Added: SQL builder toString function"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzcyMDg4ODY2", "url": "https://github.com/apache/fineract/pull/730#pullrequestreview-372088866", "createdAt": "2020-03-10T15:55:51Z", "commit": {"oid": "1be08bbb582646404a112223804ac25898d8bddb"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xMFQxNTo1NTo1MVrOF0Vd5w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xMFQxNTo1NTo1MVrOF0Vd5w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MDQyMTk5MQ==", "bodyText": "I think you could still save this StringBuilder and just whereClause.append(...) as you go? Just a thought.", "url": "https://github.com/apache/fineract/pull/730#discussion_r390421991", "createdAt": "2020-03-10T15:55:51Z", "author": {"login": "vorburger"}, "path": "fineract-provider/src/main/java/org/apache/fineract/infrastructure/security/utils/SQLBuilder.java", "diffHunk": "@@ -118,9 +121,40 @@ public String getSQLTemplate() {\n     /*\n      * Returns a String representation suitable for debugging and log output.\n      * This is ONLY intended for debugging in logs, and NEVER for passing to a JDBC database.\n+     */\n     @Override\n     public String toString() {\n-        return \"SQLBuilder{...\"; // TODO implement this...\n+       StringBuilder whereClause  = new StringBuilder(\"SQLBuilder{\");\n+       for (int i=0;i<args.size();i++)\n+        {\n+            if (i!=0)\n+            {\n+                whereClause.append(\"  AND  \");\n+            }\n+            else\n+            {\n+                whereClause.append(\"WHERE  \");\n+            }\n+            Object currentArg = args.get(i);\n+            String currentCri = crts.get(i);\n+            StringBuilder modifiedArg  = new StringBuilder(\"[\");", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "1be08bbb582646404a112223804ac25898d8bddb"}, "originalPosition": 38}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "1be08bbb582646404a112223804ac25898d8bddb", "author": {"user": {"login": "thesmallstar", "name": "Manthan Surkar"}}, "url": "https://github.com/apache/fineract/commit/1be08bbb582646404a112223804ac25898d8bddb", "committedDate": "2020-03-10T15:36:53Z", "message": "Added: SQL builder toString function"}, "afterCommit": {"oid": "02aa96e3cec3a8e359be1684f95b59c8d77e0814", "author": {"user": {"login": "thesmallstar", "name": "Manthan Surkar"}}, "url": "https://github.com/apache/fineract/commit/02aa96e3cec3a8e359be1684f95b59c8d77e0814", "committedDate": "2020-03-10T16:38:31Z", "message": "Added: SQL builder toString function"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f434ba8702dd660b0523c612fe1945b8a240088d", "author": {"user": {"login": "thesmallstar", "name": "Manthan Surkar"}}, "url": "https://github.com/apache/fineract/commit/f434ba8702dd660b0523c612fe1945b8a240088d", "committedDate": "2020-03-10T16:39:57Z", "message": "Added: SQL builder toString function"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "02aa96e3cec3a8e359be1684f95b59c8d77e0814", "author": {"user": {"login": "thesmallstar", "name": "Manthan Surkar"}}, "url": "https://github.com/apache/fineract/commit/02aa96e3cec3a8e359be1684f95b59c8d77e0814", "committedDate": "2020-03-10T16:38:31Z", "message": "Added: SQL builder toString function"}, "afterCommit": {"oid": "f434ba8702dd660b0523c612fe1945b8a240088d", "author": {"user": {"login": "thesmallstar", "name": "Manthan Surkar"}}, "url": "https://github.com/apache/fineract/commit/f434ba8702dd660b0523c612fe1945b8a240088d", "committedDate": "2020-03-10T16:39:57Z", "message": "Added: SQL builder toString function"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzcyMTQxMDAx", "url": "https://github.com/apache/fineract/pull/730#pullrequestreview-372141001", "createdAt": "2020-03-10T16:54:09Z", "commit": {"oid": "f434ba8702dd660b0523c612fe1945b8a240088d"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2020, "cost": 1, "resetAt": "2021-10-29T17:30:11Z"}}}