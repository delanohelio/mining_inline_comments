{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDgyNzE3NDkx", "number": 8538, "title": "Introduce stage overview on pipeline activity page.", "bodyText": "Description:\nShow stage overview on pipeline activity page.", "createdAt": "2020-09-09T09:47:37Z", "url": "https://github.com/gocd/gocd/pull/8538", "merged": true, "mergeCommit": {"oid": "42b62685968ad85a0603ddf188aa66034339aa97"}, "closed": true, "closedAt": "2020-09-09T10:11:07Z", "author": {"login": "GaneshSPatil"}, "timelineItems": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdHJAQkAH2gAyNDgyNzE3NDkxOmYxZTU4NTVjNWM2YTk2M2MzNjBmOTMxNTE1MGMwYjM4ZWY4NmZhNmE=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdHJRznAH2gAyNDgyNzE3NDkxOmUxMTFiNTNlNWJhNmQ0NjdmYWNjNDljMjI0ZWQ5YmY4ZWY2Zjc4OTE=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "f1e5855c5c6a963c360f9315150c0b38ef86fa6a", "author": {"user": {"login": "GaneshSPatil", "name": "Ganesh S Patil"}}, "url": "https://github.com/gocd/gocd/commit/f1e5855c5c6a963c360f9315150c0b38ef86fa6a", "committedDate": "2020-09-09T09:44:08Z", "message": "Introduce stage overview on pipeline activity page."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDg0ODQ0MjU3", "url": "https://github.com/gocd/gocd/pull/8538#pullrequestreview-484844257", "createdAt": "2020-09-09T09:49:49Z", "commit": {"oid": "f1e5855c5c6a963c360f9315150c0b38ef86fa6a"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0wOVQwOTo0OTo0OVrOHO_qrQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0wOVQwOTo0OTo0OVrOHO_qrQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NTQ4NTIyOQ==", "bodyText": "Fix this!\nFix stage settings page when pipeline is defined from a template.", "url": "https://github.com/gocd/gocd/pull/8538#discussion_r485485229", "createdAt": "2020-09-09T09:49:49Z", "author": {"login": "GaneshSPatil"}, "path": "server/src/main/webapp/WEB-INF/rails/webpack/views/pages/pipeline_activity/pipeline_run_info_widget.tsx", "diffHunk": "@@ -100,16 +103,54 @@ export class PipelineRunWidget extends MithrilViewComponent<PipelineRunAttrs> {\n       </td>\n       <td class={styles.right} data-test-id=\"stage-status\">\n         {pipelineRunInfo.stages().map((stage, index) => {\n+\n+          const pipelineName = stage.pipelineName();\n+          const pipelineCounter = stage.pipelineCounter();\n+          const stageName = stage.stageName();\n+          const stageCounter = stage.stageCounter();\n+\n+          let optionalStageOverview: m.Children | undefined;\n+\n+          let isModelOpen = vnode.attrs.stageOverviewState.isOpen(pipelineName, pipelineCounter, stageName, stageCounter);\n+          if (!isModelOpen && vnode.attrs.stageOverviewState.getPipelineCounter() === pipelineCounter) {\n+            const previousStageCounter = `${((+stageCounter) - 1)}`;\n+            const isOpenForPreviousStageInstance = vnode.attrs.stageOverviewState.isOpen(pipelineName, pipelineCounter, stageName, previousStageCounter);\n+\n+            if (isOpenForPreviousStageInstance) {\n+              isModelOpen = true;\n+              vnode.attrs.stageOverviewState.hide();\n+              vnode.attrs.showStageOverview(pipelineName, pipelineCounter, stageName, stageCounter, stage.stageStatus(), {stopPropagation: () => undefined});\n+            }\n+          }\n+\n+          if (isModelOpen) {\n+            // @ts-ignore\n+            stage.status = stage.stageStatus();\n+            // @ts-ignore\n+            stage.canOperate = vnode.attrs.canOperatePipeline;\n+\n+            optionalStageOverview = <StageOverview pipelineName={stage.pipelineName()}\n+                                                   isDisplayedOnPipelineActivityPage={true}\n+                                                   canAdminister={vnode.attrs.canAdministerPipeline}\n+                                                   pipelineCounter={stage.pipelineCounter()}\n+                                                   stageName={stageName}\n+                                                   stageCounter={stageCounter}\n+                                                   stages={pipelineRunInfo.stages()}\n+                                                   templateName={undefined}", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f1e5855c5c6a963c360f9315150c0b38ef86fa6a"}, "originalPosition": 61}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e111b53e5ba6d467facc49c224ed9bf8ef6f7891", "author": {"user": {"login": "GaneshSPatil", "name": "Ganesh S Patil"}}, "url": "https://github.com/gocd/gocd/commit/e111b53e5ba6d467facc49c224ed9bf8ef6f7891", "committedDate": "2020-09-09T10:03:18Z", "message": "Link to template stage config edit page when pipeline is defined from a template"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1814, "cost": 1, "resetAt": "2021-11-01T14:20:25Z"}}}