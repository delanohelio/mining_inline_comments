{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0MzYwMzgxOTY1", "number": 7555, "reviewThreads": {"totalCount": 5, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0wOVQwNToyMTowNFrODWvedg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0wOVQwOToyNDozN1rODWyPtQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjI1MTczMTEwOnYy", "diffSide": "RIGHT", "path": "api/api-feeds-api-v1/build.gradle", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0wOVQwNToyMTowNFrOFbrLZw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0wOVQwNTo1NTo0N1rOFbrjfg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NDU2MzMwMw==", "bodyText": "Update copyright year to 2020?\nMaybe we change it for all the files?", "url": "https://github.com/gocd/gocd/pull/7555#discussion_r364563303", "createdAt": "2020-01-09T05:21:04Z", "author": {"login": "GaneshSPatil"}, "path": "api/api-feeds-api-v1/build.gradle", "diffHunk": "@@ -0,0 +1,27 @@\n+/*\n+ * Copyright 2019 ThoughtWorks, Inc.", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "9a7a0378ab184359a5fa81b058ce8eedd86a7dce"}, "originalPosition": 2}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NDU2OTQ3MA==", "bodyText": "Done in 175304d", "url": "https://github.com/gocd/gocd/pull/7555#discussion_r364569470", "createdAt": "2020-01-09T05:55:47Z", "author": {"login": "bdpiprava"}, "path": "api/api-feeds-api-v1/build.gradle", "diffHunk": "@@ -0,0 +1,27 @@\n+/*\n+ * Copyright 2019 ThoughtWorks, Inc.", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NDU2MzMwMw=="}, "originalCommit": {"oid": "9a7a0378ab184359a5fa81b058ce8eedd86a7dce"}, "originalPosition": 2}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjI1MTc3MzkxOnYy", "diffSide": "RIGHT", "path": "api/api-feeds-api-v1/src/main/java/com/thoughtworks/go/apiv1/feedsapi/FeedsApiControllerV1.java", "isResolved": false, "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0wOVQwNTo1ODoyNFrOFbrlkQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0wOVQwNjowMjowNFrOFbroWA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NDU3MDAwMQ==", "bodyText": "Feeds APIs do not need Accept header.\nShould FeedsApiControllerV1 implement implements SparkController, ControllerMethods, SparkSpringController instead of extends ApiController implements SparkSpringController?\nRefer: ApiSupportController", "url": "https://github.com/gocd/gocd/pull/7555#discussion_r364570001", "createdAt": "2020-01-09T05:58:24Z", "author": {"login": "GaneshSPatil"}, "path": "api/api-feeds-api-v1/src/main/java/com/thoughtworks/go/apiv1/feedsapi/FeedsApiControllerV1.java", "diffHunk": "@@ -0,0 +1,146 @@\n+/*\n+ * Copyright 2020 ThoughtWorks, Inc.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+package com.thoughtworks.go.apiv1.feedsapi;\n+\n+import com.thoughtworks.go.api.ApiController;\n+import com.thoughtworks.go.api.ApiVersion;\n+import com.thoughtworks.go.api.spring.ApiAuthenticationHelper;\n+import com.thoughtworks.go.config.exceptions.BadRequestException;\n+import com.thoughtworks.go.server.service.FeedService;\n+import com.thoughtworks.go.spark.RequestContext;\n+import com.thoughtworks.go.spark.Routes;\n+import com.thoughtworks.go.spark.spring.SparkSpringController;\n+import org.dom4j.Document;\n+import org.dom4j.io.OutputFormat;\n+import org.dom4j.io.XMLWriter;\n+import org.springframework.beans.factory.annotation.Autowired;\n+import org.springframework.stereotype.Component;\n+import spark.Request;\n+import spark.Response;\n+\n+import java.io.IOException;\n+import java.io.StringWriter;\n+\n+import static java.lang.String.format;\n+import static org.apache.commons.io.FilenameUtils.removeExtension;\n+import static org.apache.commons.lang3.StringUtils.isBlank;\n+import static org.springframework.http.MediaType.APPLICATION_XML_VALUE;\n+import static spark.Spark.*;\n+\n+@Component\n+public class FeedsApiControllerV1 extends ApiController implements SparkSpringController {\n+    private final ApiAuthenticationHelper apiAuthenticationHelper;\n+    private final FeedService feedService;\n+\n+    @Autowired\n+    public FeedsApiControllerV1(ApiAuthenticationHelper apiAuthenticationHelper,\n+                                FeedService feedService) {\n+        super(ApiVersion.v1);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "175304df230bc03b8c43810bf2b2cc7eb5832c1b"}, "originalPosition": 51}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NDU3MDU3Nw==", "bodyText": "IMO, Since it is an API I should implement and ApiController", "url": "https://github.com/gocd/gocd/pull/7555#discussion_r364570577", "createdAt": "2020-01-09T06:01:26Z", "author": {"login": "bdpiprava"}, "path": "api/api-feeds-api-v1/src/main/java/com/thoughtworks/go/apiv1/feedsapi/FeedsApiControllerV1.java", "diffHunk": "@@ -0,0 +1,146 @@\n+/*\n+ * Copyright 2020 ThoughtWorks, Inc.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+package com.thoughtworks.go.apiv1.feedsapi;\n+\n+import com.thoughtworks.go.api.ApiController;\n+import com.thoughtworks.go.api.ApiVersion;\n+import com.thoughtworks.go.api.spring.ApiAuthenticationHelper;\n+import com.thoughtworks.go.config.exceptions.BadRequestException;\n+import com.thoughtworks.go.server.service.FeedService;\n+import com.thoughtworks.go.spark.RequestContext;\n+import com.thoughtworks.go.spark.Routes;\n+import com.thoughtworks.go.spark.spring.SparkSpringController;\n+import org.dom4j.Document;\n+import org.dom4j.io.OutputFormat;\n+import org.dom4j.io.XMLWriter;\n+import org.springframework.beans.factory.annotation.Autowired;\n+import org.springframework.stereotype.Component;\n+import spark.Request;\n+import spark.Response;\n+\n+import java.io.IOException;\n+import java.io.StringWriter;\n+\n+import static java.lang.String.format;\n+import static org.apache.commons.io.FilenameUtils.removeExtension;\n+import static org.apache.commons.lang3.StringUtils.isBlank;\n+import static org.springframework.http.MediaType.APPLICATION_XML_VALUE;\n+import static spark.Spark.*;\n+\n+@Component\n+public class FeedsApiControllerV1 extends ApiController implements SparkSpringController {\n+    private final ApiAuthenticationHelper apiAuthenticationHelper;\n+    private final FeedService feedService;\n+\n+    @Autowired\n+    public FeedsApiControllerV1(ApiAuthenticationHelper apiAuthenticationHelper,\n+                                FeedService feedService) {\n+        super(ApiVersion.v1);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NDU3MDAwMQ=="}, "originalCommit": {"oid": "175304df230bc03b8c43810bf2b2cc7eb5832c1b"}, "originalPosition": 51}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NDU3MDcxMg==", "bodyText": "ControllerMethods is not there as I am not making use of the methods from it.", "url": "https://github.com/gocd/gocd/pull/7555#discussion_r364570712", "createdAt": "2020-01-09T06:02:04Z", "author": {"login": "bdpiprava"}, "path": "api/api-feeds-api-v1/src/main/java/com/thoughtworks/go/apiv1/feedsapi/FeedsApiControllerV1.java", "diffHunk": "@@ -0,0 +1,146 @@\n+/*\n+ * Copyright 2020 ThoughtWorks, Inc.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+package com.thoughtworks.go.apiv1.feedsapi;\n+\n+import com.thoughtworks.go.api.ApiController;\n+import com.thoughtworks.go.api.ApiVersion;\n+import com.thoughtworks.go.api.spring.ApiAuthenticationHelper;\n+import com.thoughtworks.go.config.exceptions.BadRequestException;\n+import com.thoughtworks.go.server.service.FeedService;\n+import com.thoughtworks.go.spark.RequestContext;\n+import com.thoughtworks.go.spark.Routes;\n+import com.thoughtworks.go.spark.spring.SparkSpringController;\n+import org.dom4j.Document;\n+import org.dom4j.io.OutputFormat;\n+import org.dom4j.io.XMLWriter;\n+import org.springframework.beans.factory.annotation.Autowired;\n+import org.springframework.stereotype.Component;\n+import spark.Request;\n+import spark.Response;\n+\n+import java.io.IOException;\n+import java.io.StringWriter;\n+\n+import static java.lang.String.format;\n+import static org.apache.commons.io.FilenameUtils.removeExtension;\n+import static org.apache.commons.lang3.StringUtils.isBlank;\n+import static org.springframework.http.MediaType.APPLICATION_XML_VALUE;\n+import static spark.Spark.*;\n+\n+@Component\n+public class FeedsApiControllerV1 extends ApiController implements SparkSpringController {\n+    private final ApiAuthenticationHelper apiAuthenticationHelper;\n+    private final FeedService feedService;\n+\n+    @Autowired\n+    public FeedsApiControllerV1(ApiAuthenticationHelper apiAuthenticationHelper,\n+                                FeedService feedService) {\n+        super(ApiVersion.v1);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NDU3MDAwMQ=="}, "originalCommit": {"oid": "175304df230bc03b8c43810bf2b2cc7eb5832c1b"}, "originalPosition": 51}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjI1MTc4MDIyOnYy", "diffSide": "RIGHT", "path": "api/api-feeds-api-v1/src/main/java/com/thoughtworks/go/apiv1/feedsapi/FeedsApiControllerV1.java", "isResolved": false, "comments": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0wOVQwNjowMzozNlrOFbrpcw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0wOVQwNjo0MTo0MFrOFbsICA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NDU3MDk5NQ==", "bodyText": "NormalUserSecurity? Should this be based on some permissions (pipeline, pipeline group level view permissions)?\nNot sure if keeping it public for all has any security implications.\n\\cc: @arvindsv @bdpiparva", "url": "https://github.com/gocd/gocd/pull/7555#discussion_r364570995", "createdAt": "2020-01-09T06:03:36Z", "author": {"login": "GaneshSPatil"}, "path": "api/api-feeds-api-v1/src/main/java/com/thoughtworks/go/apiv1/feedsapi/FeedsApiControllerV1.java", "diffHunk": "@@ -0,0 +1,146 @@\n+/*\n+ * Copyright 2020 ThoughtWorks, Inc.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+package com.thoughtworks.go.apiv1.feedsapi;\n+\n+import com.thoughtworks.go.api.ApiController;\n+import com.thoughtworks.go.api.ApiVersion;\n+import com.thoughtworks.go.api.spring.ApiAuthenticationHelper;\n+import com.thoughtworks.go.config.exceptions.BadRequestException;\n+import com.thoughtworks.go.server.service.FeedService;\n+import com.thoughtworks.go.spark.RequestContext;\n+import com.thoughtworks.go.spark.Routes;\n+import com.thoughtworks.go.spark.spring.SparkSpringController;\n+import org.dom4j.Document;\n+import org.dom4j.io.OutputFormat;\n+import org.dom4j.io.XMLWriter;\n+import org.springframework.beans.factory.annotation.Autowired;\n+import org.springframework.stereotype.Component;\n+import spark.Request;\n+import spark.Response;\n+\n+import java.io.IOException;\n+import java.io.StringWriter;\n+\n+import static java.lang.String.format;\n+import static org.apache.commons.io.FilenameUtils.removeExtension;\n+import static org.apache.commons.lang3.StringUtils.isBlank;\n+import static org.springframework.http.MediaType.APPLICATION_XML_VALUE;\n+import static spark.Spark.*;\n+\n+@Component\n+public class FeedsApiControllerV1 extends ApiController implements SparkSpringController {\n+    private final ApiAuthenticationHelper apiAuthenticationHelper;\n+    private final FeedService feedService;\n+\n+    @Autowired\n+    public FeedsApiControllerV1(ApiAuthenticationHelper apiAuthenticationHelper,\n+                                FeedService feedService) {\n+        super(ApiVersion.v1);\n+        this.mimeType = APPLICATION_XML_VALUE;\n+        this.apiAuthenticationHelper = apiAuthenticationHelper;\n+        this.feedService = feedService;\n+    }\n+\n+    @Override\n+    public String controllerBasePath() {\n+        return Routes.FeedsAPI.BASE;\n+    }\n+\n+    @Override\n+    public void setupRoutes() {\n+        path(controllerBasePath(), () -> {\n+            before(\"/*\", mimeType, this::setContentType);\n+            before(\"/*\", mimeType, this.apiAuthenticationHelper::checkUserAnd403);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "175304df230bc03b8c43810bf2b2cc7eb5832c1b"}, "originalPosition": 66}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NDU3MTU1OQ==", "bodyText": "@GaneshSPatil - That is verified at the service level so I skipped that check from the controller.", "url": "https://github.com/gocd/gocd/pull/7555#discussion_r364571559", "createdAt": "2020-01-09T06:06:31Z", "author": {"login": "bdpiprava"}, "path": "api/api-feeds-api-v1/src/main/java/com/thoughtworks/go/apiv1/feedsapi/FeedsApiControllerV1.java", "diffHunk": "@@ -0,0 +1,146 @@\n+/*\n+ * Copyright 2020 ThoughtWorks, Inc.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+package com.thoughtworks.go.apiv1.feedsapi;\n+\n+import com.thoughtworks.go.api.ApiController;\n+import com.thoughtworks.go.api.ApiVersion;\n+import com.thoughtworks.go.api.spring.ApiAuthenticationHelper;\n+import com.thoughtworks.go.config.exceptions.BadRequestException;\n+import com.thoughtworks.go.server.service.FeedService;\n+import com.thoughtworks.go.spark.RequestContext;\n+import com.thoughtworks.go.spark.Routes;\n+import com.thoughtworks.go.spark.spring.SparkSpringController;\n+import org.dom4j.Document;\n+import org.dom4j.io.OutputFormat;\n+import org.dom4j.io.XMLWriter;\n+import org.springframework.beans.factory.annotation.Autowired;\n+import org.springframework.stereotype.Component;\n+import spark.Request;\n+import spark.Response;\n+\n+import java.io.IOException;\n+import java.io.StringWriter;\n+\n+import static java.lang.String.format;\n+import static org.apache.commons.io.FilenameUtils.removeExtension;\n+import static org.apache.commons.lang3.StringUtils.isBlank;\n+import static org.springframework.http.MediaType.APPLICATION_XML_VALUE;\n+import static spark.Spark.*;\n+\n+@Component\n+public class FeedsApiControllerV1 extends ApiController implements SparkSpringController {\n+    private final ApiAuthenticationHelper apiAuthenticationHelper;\n+    private final FeedService feedService;\n+\n+    @Autowired\n+    public FeedsApiControllerV1(ApiAuthenticationHelper apiAuthenticationHelper,\n+                                FeedService feedService) {\n+        super(ApiVersion.v1);\n+        this.mimeType = APPLICATION_XML_VALUE;\n+        this.apiAuthenticationHelper = apiAuthenticationHelper;\n+        this.feedService = feedService;\n+    }\n+\n+    @Override\n+    public String controllerBasePath() {\n+        return Routes.FeedsAPI.BASE;\n+    }\n+\n+    @Override\n+    public void setupRoutes() {\n+        path(controllerBasePath(), () -> {\n+            before(\"/*\", mimeType, this::setContentType);\n+            before(\"/*\", mimeType, this.apiAuthenticationHelper::checkUserAnd403);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NDU3MDk5NQ=="}, "originalCommit": {"oid": "175304df230bc03b8c43810bf2b2cc7eb5832c1b"}, "originalPosition": 66}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NDU3MzE5MQ==", "bodyText": "Hmm, thanks.\nIdeally, the checks should have been moved from the service to the controller. But the services would have used as part of the rails controller too!", "url": "https://github.com/gocd/gocd/pull/7555#discussion_r364573191", "createdAt": "2020-01-09T06:14:27Z", "author": {"login": "GaneshSPatil"}, "path": "api/api-feeds-api-v1/src/main/java/com/thoughtworks/go/apiv1/feedsapi/FeedsApiControllerV1.java", "diffHunk": "@@ -0,0 +1,146 @@\n+/*\n+ * Copyright 2020 ThoughtWorks, Inc.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+package com.thoughtworks.go.apiv1.feedsapi;\n+\n+import com.thoughtworks.go.api.ApiController;\n+import com.thoughtworks.go.api.ApiVersion;\n+import com.thoughtworks.go.api.spring.ApiAuthenticationHelper;\n+import com.thoughtworks.go.config.exceptions.BadRequestException;\n+import com.thoughtworks.go.server.service.FeedService;\n+import com.thoughtworks.go.spark.RequestContext;\n+import com.thoughtworks.go.spark.Routes;\n+import com.thoughtworks.go.spark.spring.SparkSpringController;\n+import org.dom4j.Document;\n+import org.dom4j.io.OutputFormat;\n+import org.dom4j.io.XMLWriter;\n+import org.springframework.beans.factory.annotation.Autowired;\n+import org.springframework.stereotype.Component;\n+import spark.Request;\n+import spark.Response;\n+\n+import java.io.IOException;\n+import java.io.StringWriter;\n+\n+import static java.lang.String.format;\n+import static org.apache.commons.io.FilenameUtils.removeExtension;\n+import static org.apache.commons.lang3.StringUtils.isBlank;\n+import static org.springframework.http.MediaType.APPLICATION_XML_VALUE;\n+import static spark.Spark.*;\n+\n+@Component\n+public class FeedsApiControllerV1 extends ApiController implements SparkSpringController {\n+    private final ApiAuthenticationHelper apiAuthenticationHelper;\n+    private final FeedService feedService;\n+\n+    @Autowired\n+    public FeedsApiControllerV1(ApiAuthenticationHelper apiAuthenticationHelper,\n+                                FeedService feedService) {\n+        super(ApiVersion.v1);\n+        this.mimeType = APPLICATION_XML_VALUE;\n+        this.apiAuthenticationHelper = apiAuthenticationHelper;\n+        this.feedService = feedService;\n+    }\n+\n+    @Override\n+    public String controllerBasePath() {\n+        return Routes.FeedsAPI.BASE;\n+    }\n+\n+    @Override\n+    public void setupRoutes() {\n+        path(controllerBasePath(), () -> {\n+            before(\"/*\", mimeType, this::setContentType);\n+            before(\"/*\", mimeType, this.apiAuthenticationHelper::checkUserAnd403);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NDU3MDk5NQ=="}, "originalCommit": {"oid": "175304df230bc03b8c43810bf2b2cc7eb5832c1b"}, "originalPosition": 66}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NDU3ODgyNA==", "bodyText": "I think we have a check at the controller level to early return based on the user's permission. This makes authorization logic scattered between controller and services. Ideally, I prefer to have it at the service level. Controllers are something that can change based on libraries like sparks or languages but in most of the applications, services will remain in the same(changing services mean rewriting entire application).", "url": "https://github.com/gocd/gocd/pull/7555#discussion_r364578824", "createdAt": "2020-01-09T06:41:40Z", "author": {"login": "bdpiprava"}, "path": "api/api-feeds-api-v1/src/main/java/com/thoughtworks/go/apiv1/feedsapi/FeedsApiControllerV1.java", "diffHunk": "@@ -0,0 +1,146 @@\n+/*\n+ * Copyright 2020 ThoughtWorks, Inc.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+package com.thoughtworks.go.apiv1.feedsapi;\n+\n+import com.thoughtworks.go.api.ApiController;\n+import com.thoughtworks.go.api.ApiVersion;\n+import com.thoughtworks.go.api.spring.ApiAuthenticationHelper;\n+import com.thoughtworks.go.config.exceptions.BadRequestException;\n+import com.thoughtworks.go.server.service.FeedService;\n+import com.thoughtworks.go.spark.RequestContext;\n+import com.thoughtworks.go.spark.Routes;\n+import com.thoughtworks.go.spark.spring.SparkSpringController;\n+import org.dom4j.Document;\n+import org.dom4j.io.OutputFormat;\n+import org.dom4j.io.XMLWriter;\n+import org.springframework.beans.factory.annotation.Autowired;\n+import org.springframework.stereotype.Component;\n+import spark.Request;\n+import spark.Response;\n+\n+import java.io.IOException;\n+import java.io.StringWriter;\n+\n+import static java.lang.String.format;\n+import static org.apache.commons.io.FilenameUtils.removeExtension;\n+import static org.apache.commons.lang3.StringUtils.isBlank;\n+import static org.springframework.http.MediaType.APPLICATION_XML_VALUE;\n+import static spark.Spark.*;\n+\n+@Component\n+public class FeedsApiControllerV1 extends ApiController implements SparkSpringController {\n+    private final ApiAuthenticationHelper apiAuthenticationHelper;\n+    private final FeedService feedService;\n+\n+    @Autowired\n+    public FeedsApiControllerV1(ApiAuthenticationHelper apiAuthenticationHelper,\n+                                FeedService feedService) {\n+        super(ApiVersion.v1);\n+        this.mimeType = APPLICATION_XML_VALUE;\n+        this.apiAuthenticationHelper = apiAuthenticationHelper;\n+        this.feedService = feedService;\n+    }\n+\n+    @Override\n+    public String controllerBasePath() {\n+        return Routes.FeedsAPI.BASE;\n+    }\n+\n+    @Override\n+    public void setupRoutes() {\n+        path(controllerBasePath(), () -> {\n+            before(\"/*\", mimeType, this::setContentType);\n+            before(\"/*\", mimeType, this.apiAuthenticationHelper::checkUserAnd403);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NDU3MDk5NQ=="}, "originalCommit": {"oid": "175304df230bc03b8c43810bf2b2cc7eb5832c1b"}, "originalPosition": 66}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjI1MTc4MTYxOnYy", "diffSide": "RIGHT", "path": "api/api-feeds-api-v1/src/main/java/com/thoughtworks/go/apiv1/feedsapi/FeedsApiControllerV1.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0wOVQwNjowNDozMlrOFbrqMg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0wOVQwNjowNDozMlrOFbrqMg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NDU3MTE4Ng==", "bodyText": "should we extract request param strings into class field constants?", "url": "https://github.com/gocd/gocd/pull/7555#discussion_r364571186", "createdAt": "2020-01-09T06:04:32Z", "author": {"login": "GaneshSPatil"}, "path": "api/api-feeds-api-v1/src/main/java/com/thoughtworks/go/apiv1/feedsapi/FeedsApiControllerV1.java", "diffHunk": "@@ -0,0 +1,146 @@\n+/*\n+ * Copyright 2020 ThoughtWorks, Inc.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+package com.thoughtworks.go.apiv1.feedsapi;\n+\n+import com.thoughtworks.go.api.ApiController;\n+import com.thoughtworks.go.api.ApiVersion;\n+import com.thoughtworks.go.api.spring.ApiAuthenticationHelper;\n+import com.thoughtworks.go.config.exceptions.BadRequestException;\n+import com.thoughtworks.go.server.service.FeedService;\n+import com.thoughtworks.go.spark.RequestContext;\n+import com.thoughtworks.go.spark.Routes;\n+import com.thoughtworks.go.spark.spring.SparkSpringController;\n+import org.dom4j.Document;\n+import org.dom4j.io.OutputFormat;\n+import org.dom4j.io.XMLWriter;\n+import org.springframework.beans.factory.annotation.Autowired;\n+import org.springframework.stereotype.Component;\n+import spark.Request;\n+import spark.Response;\n+\n+import java.io.IOException;\n+import java.io.StringWriter;\n+\n+import static java.lang.String.format;\n+import static org.apache.commons.io.FilenameUtils.removeExtension;\n+import static org.apache.commons.lang3.StringUtils.isBlank;\n+import static org.springframework.http.MediaType.APPLICATION_XML_VALUE;\n+import static spark.Spark.*;\n+\n+@Component\n+public class FeedsApiControllerV1 extends ApiController implements SparkSpringController {\n+    private final ApiAuthenticationHelper apiAuthenticationHelper;\n+    private final FeedService feedService;\n+\n+    @Autowired\n+    public FeedsApiControllerV1(ApiAuthenticationHelper apiAuthenticationHelper,\n+                                FeedService feedService) {\n+        super(ApiVersion.v1);\n+        this.mimeType = APPLICATION_XML_VALUE;\n+        this.apiAuthenticationHelper = apiAuthenticationHelper;\n+        this.feedService = feedService;\n+    }\n+\n+    @Override\n+    public String controllerBasePath() {\n+        return Routes.FeedsAPI.BASE;\n+    }\n+\n+    @Override\n+    public void setupRoutes() {\n+        path(controllerBasePath(), () -> {\n+            before(\"/*\", mimeType, this::setContentType);\n+            before(\"/*\", mimeType, this.apiAuthenticationHelper::checkUserAnd403);\n+\n+            get(Routes.FeedsAPI.PIPELINES_XML, this.mimeType, this::pipelinesXML);\n+            get(Routes.FeedsAPI.STAGES_XML, this.mimeType, this::stagesXML);\n+            get(Routes.FeedsAPI.PIPELINE_XML, this.mimeType, this::pipelineXML);\n+            get(Routes.FeedsAPI.STAGE_XML, this.mimeType, this::stageXML);\n+            get(Routes.FeedsAPI.JOB_XML, this.mimeType, this::jobXML);\n+            get(Routes.FeedsAPI.SCHEDULED_JOB_XML, this.mimeType, this::scheduledJobs);\n+            get(Routes.FeedsAPI.MATERIAL_URL, this.mimeType, this::materialXML);\n+        });\n+    }\n+\n+    public String pipelinesXML(Request request, Response response) throws IOException {\n+        return prettyPrint(feedService.pipelinesXml(currentUsername(), baseUrl(request)));\n+    }\n+\n+    public String pipelineXML(Request request, Response response) throws IOException {\n+        String pipelineName = request.params(\"pipeline_name\");\n+        Integer pipelineCounter = parseInt(removeExtension(request.params(\"pipeline_counter\")), \"pipeline counter\");\n+        return prettyPrint(feedService.pipelineXml(currentUsername(), pipelineName, pipelineCounter, baseUrl(request)));\n+    }\n+\n+    public String stagesXML(Request request, Response response) throws IOException {\n+        String pipelineName = request.params(\"pipeline_name\");\n+        String beforeFromRequest = request.queryParams(\"before\");\n+        Integer before = isBlank(beforeFromRequest) ? null : parseInt(beforeFromRequest, \"before\");\n+        return prettyPrint(feedService.stagesXml(currentUsername(), pipelineName, before, baseUrl(request)));\n+    }\n+\n+    public String stageXML(Request request, Response response) throws IOException {\n+        String pipelineName = request.params(\"pipeline_name\");\n+        Integer pipelineCounter = parseInt(request.params(\"pipeline_counter\"), \"pipeline counter\");\n+        String stageName = request.params(\"stage_name\");\n+        Integer stageCounter = parseInt(removeExtension(request.params(\"stage_counter\")), \"stage counter\");\n+        return prettyPrint(feedService.stageXml(currentUsername(), pipelineName, pipelineCounter, stageName, stageCounter, baseUrl(request)));\n+    }\n+\n+    public String jobXML(Request request, Response response) throws IOException {\n+        String pipelineName = request.params(\"pipeline_name\");\n+        Integer pipelineCounter = parseInt(request.params(\"pipeline_counter\"), \"pipeline counter\");\n+        String stageName = request.params(\"stage_name\");\n+        Integer stageCounter = parseInt(request.params(\"stage_counter\"), \"stage counter\");\n+        String jobName = removeExtension(request.params(\"job_name\"));\n+\n+        return prettyPrint(feedService.jobXml(currentUsername(), pipelineName, pipelineCounter, stageName, stageCounter, jobName, baseUrl(request)));\n+    }\n+\n+    public String scheduledJobs(Request request, Response response) throws IOException {\n+        return prettyPrint(feedService.waitingJobPlansXml(baseUrl(request)));\n+    }\n+\n+    public String materialXML(Request request, Response response) throws IOException {\n+        String pipelineName = request.params(\"pipeline_name\");\n+        Integer pipelineCounter = parseInt(request.params(\"pipeline_counter\"), \"pipeline counter\");\n+        String fingerprint = removeExtension(request.params(\"fingerprint\"));\n+\n+        return prettyPrint(feedService.materialXml(currentUsername(), pipelineName, pipelineCounter, fingerprint, baseUrl(request)));\n+    }", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "175304df230bc03b8c43810bf2b2cc7eb5832c1b"}, "originalPosition": 123}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjI1MjE4NDg1OnYy", "diffSide": "RIGHT", "path": "api/api-feeds-api-v1/src/main/java/com/thoughtworks/go/apiv1/feedsapi/FeedsApiControllerV1.java", "isResolved": false, "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0wOVQwOToyNDozN1rOFbvZZg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0wOVQwOTozMjowOFrOFbvofA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NDYzMjQyMg==", "bodyText": "this.mimeType?? may be after(\"/*\", this.mimeType, this::setContentType);", "url": "https://github.com/gocd/gocd/pull/7555#discussion_r364632422", "createdAt": "2020-01-09T09:24:37Z", "author": {"login": "GaneshSPatil"}, "path": "api/api-feeds-api-v1/src/main/java/com/thoughtworks/go/apiv1/feedsapi/FeedsApiControllerV1.java", "diffHunk": "@@ -76,6 +79,8 @@ public void setupRoutes() {\n             get(Routes.FeedsAPI.JOB_XML, this.mimeType, this::jobXML);\n             get(Routes.FeedsAPI.SCHEDULED_JOB_XML, this.mimeType, this::scheduledJobs);\n             get(Routes.FeedsAPI.MATERIAL_URL, this.mimeType, this::materialXML);\n+\n+            after(\"/*\", this::setContentType);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "3ceb79cbb19e7c9230c4cbd3e83341721d194f6b"}, "originalPosition": 30}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NDYzNTQxNA==", "bodyText": "Failure: send error message based on the requested accept header type. This will allow the client to interpret the error message as per the requested types.\n\n\nSuccess: Feed APIs always sends a response as XML. Hence expected content types can be one from application/xml, text/xml, application/rss+xml or application/atom+xml. Content-type will be set based on the Accept header. Defaults to application/xml if accept header contains non XML content type", "url": "https://github.com/gocd/gocd/pull/7555#discussion_r364635414", "createdAt": "2020-01-09T09:30:26Z", "author": {"login": "bdpiprava"}, "path": "api/api-feeds-api-v1/src/main/java/com/thoughtworks/go/apiv1/feedsapi/FeedsApiControllerV1.java", "diffHunk": "@@ -76,6 +79,8 @@ public void setupRoutes() {\n             get(Routes.FeedsAPI.JOB_XML, this.mimeType, this::jobXML);\n             get(Routes.FeedsAPI.SCHEDULED_JOB_XML, this.mimeType, this::scheduledJobs);\n             get(Routes.FeedsAPI.MATERIAL_URL, this.mimeType, this::materialXML);\n+\n+            after(\"/*\", this::setContentType);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NDYzMjQyMg=="}, "originalCommit": {"oid": "3ceb79cbb19e7c9230c4cbd3e83341721d194f6b"}, "originalPosition": 30}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NDYzNjI4NA==", "bodyText": "this.mimeType?? may be after(\"/*\", this.mimeType, this::setContentType);\n\nNot sure if that will make any difference", "url": "https://github.com/gocd/gocd/pull/7555#discussion_r364636284", "createdAt": "2020-01-09T09:32:08Z", "author": {"login": "bdpiprava"}, "path": "api/api-feeds-api-v1/src/main/java/com/thoughtworks/go/apiv1/feedsapi/FeedsApiControllerV1.java", "diffHunk": "@@ -76,6 +79,8 @@ public void setupRoutes() {\n             get(Routes.FeedsAPI.JOB_XML, this.mimeType, this::jobXML);\n             get(Routes.FeedsAPI.SCHEDULED_JOB_XML, this.mimeType, this::scheduledJobs);\n             get(Routes.FeedsAPI.MATERIAL_URL, this.mimeType, this::materialXML);\n+\n+            after(\"/*\", this::setContentType);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NDYzMjQyMg=="}, "originalCommit": {"oid": "3ceb79cbb19e7c9230c4cbd3e83341721d194f6b"}, "originalPosition": 30}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2768, "cost": 1, "resetAt": "2021-11-12T19:05:54Z"}}}