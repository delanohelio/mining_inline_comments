{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDAzNTQ0OTQ3", "number": 8008, "title": "Updated the material popup to disable scm based material type options", "bodyText": "Description: Updated the material popup to disable scm based material type options\n\nif other materials in the pipeline have a blank destination\nupdated the material editor to disable options", "createdAt": "2020-04-15T05:10:56Z", "url": "https://github.com/gocd/gocd/pull/8008", "merged": true, "mergeCommit": {"oid": "271bdf5df32d141e42740c383992000abcd7f60c"}, "closed": true, "closedAt": "2020-04-15T05:16:21Z", "author": {"login": "kritika-singh3"}, "timelineItems": {"totalCount": 6, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcXxBqJAH2gAyNDAzNTQ0OTQ3OmE3NTdhNjkzY2UwYWE0NmI4ZGFhNDU4NTA2NTcxYmFhODgxM2ZhNzY=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcXxNyggFqTM5MzQ2NDM3MA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "a757a693ce0aa46b8daa458506571baa8813fa76", "author": {"user": {"login": "kritika-singh3", "name": "Kritika"}}, "url": "https://github.com/gocd/gocd/commit/a757a693ce0aa46b8daa458506571baa8813fa76", "committedDate": "2020-04-15T05:13:30Z", "message": "Updated the material popup to disable scm based material type options if other materials in the pipeline have a blank destination\n - updated the material editor to disable options"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "4040a3f27744240dac61488ee4197f3b2f0ebad7", "author": {"user": {"login": "kritika-singh3", "name": "Kritika"}}, "url": "https://github.com/gocd/gocd/commit/4040a3f27744240dac61488ee4197f3b2f0ebad7", "committedDate": "2020-04-15T05:09:08Z", "message": "Updated the material popup to disable scm based material type options if other materials in the pipeline have a blank destination\n - updated the material editor to disable options"}, "afterCommit": {"oid": "a757a693ce0aa46b8daa458506571baa8813fa76", "author": {"user": {"login": "kritika-singh3", "name": "Kritika"}}, "url": "https://github.com/gocd/gocd/commit/a757a693ce0aa46b8daa458506571baa8813fa76", "committedDate": "2020-04-15T05:13:30Z", "message": "Updated the material popup to disable scm based material type options if other materials in the pipeline have a blank destination\n - updated the material editor to disable options"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzkzNDYyNjA1", "url": "https://github.com/gocd/gocd/pull/8008#pullrequestreview-393462605", "createdAt": "2020-04-15T05:21:19Z", "commit": {"oid": "a757a693ce0aa46b8daa458506571baa8813fa76"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0xNVQwNToyMToxOVrOGFqLVQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0xNVQwNToyMToxOVrOGFqLVQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwODU4NzA5Mw==", "bodyText": "this would iterate the collection twice.\nHow about moving the material.attributes() instanceof ScmMaterialAttributes check inside some?", "url": "https://github.com/gocd/gocd/pull/8008#discussion_r408587093", "createdAt": "2020-04-15T05:21:19Z", "author": {"login": "GaneshSPatil"}, "path": "server/src/main/webapp/WEB-INF/rails/webpack/models/pipeline_configs/pipeline_config.ts", "diffHunk": "@@ -281,4 +281,20 @@ export class Materials extends Array<Material> {\n       this.splice(index, 1);\n     }\n   }\n+\n+  scmMaterialsHaveDestination(): boolean {\n+    const hasScmMaterialWithEmptyDestination          = this\n+      .filter((material) => material.attributes() instanceof ScmMaterialAttributes)\n+      .some((material) => {\n+        const attrs = material.attributes() as ScmMaterialAttributes;\n+        return _.isEmpty(attrs.destination());\n+      });", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "a757a693ce0aa46b8daa458506571baa8813fa76"}, "originalPosition": 42}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzkzNDYyNjY2", "url": "https://github.com/gocd/gocd/pull/8008#pullrequestreview-393462666", "createdAt": "2020-04-15T05:21:33Z", "commit": {"oid": "a757a693ce0aa46b8daa458506571baa8813fa76"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0xNVQwNToyMTozM1rOGFqLhQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0xNVQwNToyMTozM1rOGFqLhQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwODU4NzE0MQ==", "bodyText": "this would iterate the collection twice.\nHow about moving the material.attributes() instanceof ScmMaterialAttributes check inside some?", "url": "https://github.com/gocd/gocd/pull/8008#discussion_r408587141", "createdAt": "2020-04-15T05:21:33Z", "author": {"login": "GaneshSPatil"}, "path": "server/src/main/webapp/WEB-INF/rails/webpack/models/pipeline_configs/pipeline_config.ts", "diffHunk": "@@ -281,4 +281,20 @@ export class Materials extends Array<Material> {\n       this.splice(index, 1);\n     }\n   }\n+\n+  scmMaterialsHaveDestination(): boolean {\n+    const hasScmMaterialWithEmptyDestination          = this\n+      .filter((material) => material.attributes() instanceof ScmMaterialAttributes)\n+      .some((material) => {\n+        const attrs = material.attributes() as ScmMaterialAttributes;\n+        return _.isEmpty(attrs.destination());\n+      });\n+    const hasPluggableScmMaterialWithEmptyDestination = this\n+      .filter((material) => material.attributes() instanceof PluggableScmMaterialAttributes)\n+      .some((material) => {\n+        const attrs = material.attributes() as PluggableScmMaterialAttributes;\n+        return _.isEmpty(attrs.destination());\n+      });", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "a757a693ce0aa46b8daa458506571baa8813fa76"}, "originalPosition": 48}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzkzNDYzMDcw", "url": "https://github.com/gocd/gocd/pull/8008#pullrequestreview-393463070", "createdAt": "2020-04-15T05:22:41Z", "commit": {"oid": "a757a693ce0aa46b8daa458506571baa8813fa76"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0xNVQwNToyMjo0MVrOGFqM4Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0xNVQwNToyMjo0MVrOGFqM4Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwODU4NzQ4OQ==", "bodyText": "should we use if for better readability?", "url": "https://github.com/gocd/gocd/pull/8008#discussion_r408587489", "createdAt": "2020-04-15T05:22:41Z", "author": {"login": "GaneshSPatil"}, "path": "server/src/main/webapp/WEB-INF/rails/webpack/views/pages/clicky_pipeline_config/modal/material_modal.tsx", "diffHunk": "@@ -71,9 +72,18 @@ export class MaterialModal extends Modal {\n   }\n \n   body(): m.Children {\n+    const allScmMaterialsHaveDestination = this.materials().scmMaterialsHaveDestination();\n+    const maybeMsg                       = this.isNew && !allScmMaterialsHaveDestination\n+      ? <FlashMessage type={MessageType.warning} dataTestId={\"materials-destination-warning-message\"}>\n+        In order to configure multiple SCM materials for this pipeline, each of its material needs have to a 'Destination Directory' specified. Please\n+        edit the existing material and specify a 'Destination Directory' in order to proceed with this operation.\n+      </FlashMessage>\n+      : undefined;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "a757a693ce0aa46b8daa458506571baa8813fa76"}, "originalPosition": 20}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzkzNDY0Mzcw", "url": "https://github.com/gocd/gocd/pull/8008#pullrequestreview-393464370", "createdAt": "2020-04-15T05:26:44Z", "commit": {"oid": "a757a693ce0aa46b8daa458506571baa8813fa76"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0xNVQwNToyNjo0NFrOGFqRbg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0xNVQwNToyNjo0NFrOGFqRbg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwODU4ODY1NA==", "bodyText": "Generally, we should avoid writing loops and logic in the tests. Or else we will need to write a test for the test too :)\nHere, can we write multiple assertions, one for each material type?", "url": "https://github.com/gocd/gocd/pull/8008#discussion_r408588654", "createdAt": "2020-04-15T05:26:44Z", "author": {"login": "GaneshSPatil"}, "path": "server/src/main/webapp/WEB-INF/rails/webpack/views/pages/pipelines/spec/material_editor_spec.tsx", "diffHunk": "@@ -148,4 +148,25 @@ describe(\"AddPipeline: Material Editor\", () => {\n     expect(helper.byTestId('form-field-input-material-type')).toBeDisabled();\n     expect(helper.byTestId('form-field-input-repository-url')).not.toBeDisabled();\n   });\n+\n+  it('should disable only scm material type options when `disableScmMaterials` is set to true', () => {\n+    helper.mount(() => <MaterialEditor material={material} showExtraMaterials={true} disableScmMaterials={true}/>);\n+\n+    const materialTypeSelection = helper.byTestId('form-field-input-material-type');\n+    expect(materialTypeSelection).not.toBeDisabled();\n+\n+    const disabled: string[] = [];\n+    const enabled: string[]  = [];\n+    helper.qa('option', materialTypeSelection)\n+          .forEach((option) => {\n+            if (option.hasAttribute('disabled')) {\n+              disabled.push(option.textContent!);\n+            } else {\n+              enabled.push(option.textContent!);\n+            }\n+          });\n+\n+    expect(enabled).toEqual([\"Another Pipeline\", \"Package\"]);\n+    expect(disabled).toEqual([\"Git\", \"Mercurial\", \"Subversion\", \"Perforce\", \"Team Foundation Server\", \"SCM\"]);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "a757a693ce0aa46b8daa458506571baa8813fa76"}, "originalPosition": 23}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1917, "cost": 1, "resetAt": "2021-11-01T14:20:25Z"}}}