{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDg3MTU1MTA4", "number": 8557, "title": "Gradle 6 deprecations", "bodyText": "Removing deprecated dependency configurations and other miscellany that will be removed in Gradle 7.0.\nMany of these features have existed for several major versions of Gradle, so this is long overdue.\n\n change dependency scopes away from deprecated compile, testCompile, runtime, testRuntime in favor of implementation and friends\n upgrade plugins to remove other deprecations\n\nNOTE: not all can be removed because certain plugins we are using (e.g., license reporting) have not resolved deprecation warnings\n\n\n\nNote to reviewers\nI also removed an explicit dependency on commons-digester3 in an attempt to clean up some old deps. It required quite a bit of refactoring in the go-plugin-infra module. I gave up doing other upgrades after that. If it makes the diff too complex, I can pull it out as a separate PR.", "createdAt": "2020-09-15T09:14:41Z", "url": "https://github.com/gocd/gocd/pull/8557", "merged": true, "mergeCommit": {"oid": "628a5cad1cf95dcc073b1ffd9f7e0cb3a4ecc1a7"}, "closed": true, "closedAt": "2020-10-13T04:37:48Z", "author": {"login": "marques-work"}, "timelineItems": {"totalCount": 16, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdJE5eSgBqjM3Njc1MjEzODU=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdSA_wvgBqjM4NjkyMzU5ODI=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "06c70834f9d916832efff30889e53789b2bd925e", "author": {"user": {"login": "marques-work", "name": null}}, "url": "https://github.com/gocd/gocd/commit/06c70834f9d916832efff30889e53789b2bd925e", "committedDate": "2020-09-12T11:43:40Z", "message": "Fix compilation and license report woes\n\n  - Created a test-api module to house common test deps for api/* modules\n  - Update gradle license report plugin\n  - Add exceptions and missing license data to accommodate changes"}, "afterCommit": {"oid": "c7dddc6eff5a4997ebb00b30918abf68b5979f98", "author": {"user": {"login": "marques-work", "name": null}}, "url": "https://github.com/gocd/gocd/commit/c7dddc6eff5a4997ebb00b30918abf68b5979f98", "committedDate": "2020-09-15T09:30:26Z", "message": "Remove guard on VerifyJarTask that prevents building in local dev without setting an env var.\n\nBecause, why???"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "c7dddc6eff5a4997ebb00b30918abf68b5979f98", "author": {"user": {"login": "marques-work", "name": null}}, "url": "https://github.com/gocd/gocd/commit/c7dddc6eff5a4997ebb00b30918abf68b5979f98", "committedDate": "2020-09-15T09:30:26Z", "message": "Remove guard on VerifyJarTask that prevents building in local dev without setting an env var.\n\nBecause, why???"}, "afterCommit": {"oid": "fe87c322e901b00da9abbafca3fba044a3f7e136", "author": {"user": {"login": "marques-work", "name": null}}, "url": "https://github.com/gocd/gocd/commit/fe87c322e901b00da9abbafca3fba044a3f7e136", "committedDate": "2020-09-16T11:26:11Z", "message": "Remove guard on VerifyJarTask that prevents building in local dev without setting an env var.\n\nBecause, why???"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "fe87c322e901b00da9abbafca3fba044a3f7e136", "author": {"user": {"login": "marques-work", "name": null}}, "url": "https://github.com/gocd/gocd/commit/fe87c322e901b00da9abbafca3fba044a3f7e136", "committedDate": "2020-09-16T11:26:11Z", "message": "Remove guard on VerifyJarTask that prevents building in local dev without setting an env var.\n\nBecause, why???"}, "afterCommit": {"oid": "9d9b5588a761b6898145de7dd79e62fa2b68ff06", "author": {"user": {"login": "marques-work", "name": null}}, "url": "https://github.com/gocd/gocd/commit/9d9b5588a761b6898145de7dd79e62fa2b68ff06", "committedDate": "2020-09-23T11:39:03Z", "message": "wip"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "9d9b5588a761b6898145de7dd79e62fa2b68ff06", "author": {"user": {"login": "marques-work", "name": null}}, "url": "https://github.com/gocd/gocd/commit/9d9b5588a761b6898145de7dd79e62fa2b68ff06", "committedDate": "2020-09-23T11:39:03Z", "message": "wip"}, "afterCommit": {"oid": "35e83b9d77376365d88c50a48a15035603a43529", "author": {"user": {"login": "marques-work", "name": null}}, "url": "https://github.com/gocd/gocd/commit/35e83b9d77376365d88c50a48a15035603a43529", "committedDate": "2020-10-01T11:24:53Z", "message": "Working! (?)"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "6ca38c09e2e6c1d16966a6a825f024d80f5a7315", "author": {"user": {"login": "marques-work", "name": null}}, "url": "https://github.com/gocd/gocd/commit/6ca38c09e2e6c1d16966a6a825f024d80f5a7315", "committedDate": "2020-10-02T10:33:32Z", "message": "remove unneccessary decl"}, "afterCommit": {"oid": "743babf458061a811c349043f13e1f947666b40b", "author": {"user": {"login": "marques-work", "name": null}}, "url": "https://github.com/gocd/gocd/commit/743babf458061a811c349043f13e1f947666b40b", "committedDate": "2020-10-02T19:03:21Z", "message": "Remove `exportForPackaging` configuration in favor of built-in `api` configuration\n\n`exportForPackaging` was functionally the same as `api` and only meant to communicate intent.\nHowever, it's better to just use the built-in configuration as folks will likely be familiar\nwith how `api` works anyway.\n\nKeep it simple."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTAyNzIwOTQ0", "url": "https://github.com/gocd/gocd/pull/8557#pullrequestreview-502720944", "createdAt": "2020-10-06T08:51:55Z", "commit": {"oid": "743babf458061a811c349043f13e1f947666b40b"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wNlQwODo1MTo1NVrOHc8aeg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wNlQwODo1MTo1NVrOHc8aeg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMDExMTk5NA==", "bodyText": "This bit is partly redundant since compileClasspath already extendsFrom compileOnly.\nAdding the compileClasspath to test{Compile,Runtime}Classpath is achieved on line 296:\n    // it's rather convenient to allow compile and runtime classpaths for tests inherit from the main compile classpath\n    testImplementation.extendsFrom compileClasspath", "url": "https://github.com/gocd/gocd/pull/8557#discussion_r500111994", "createdAt": "2020-10-06T08:51:55Z", "author": {"login": "marques-work"}, "path": "build.gradle", "diffHunk": "@@ -423,42 +483,11 @@ subprojects {\n       fatJarConfig\n \n       testOutput {\n-        extendsFrom testRuntime\n+        extendsFrom testRuntimeClasspath\n         transitive = true\n       }\n     }\n \n-    sourceSets {\n-      main {\n-        java {\n-          compileClasspath += configurations.compileOnly\n-        }\n-      }\n-      test {\n-        java {\n-          compileClasspath += configurations.compileOnly\n-          runtimeClasspath += configurations.compileOnly\n-        }\n-      }\n-    }", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "743babf458061a811c349043f13e1f947666b40b"}, "originalPosition": 131}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTAyNzI1ODU3", "url": "https://github.com/gocd/gocd/pull/8557#pullrequestreview-502725857", "createdAt": "2020-10-06T08:57:28Z", "commit": {"oid": "743babf458061a811c349043f13e1f947666b40b"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wNlQwODo1NzoyOFrOHc8o1A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wNlQwODo1NzoyOFrOHc8o1A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMDExNTY2OA==", "bodyText": "None of these were used (anymore?).", "url": "https://github.com/gocd/gocd/pull/8557#discussion_r500115668", "createdAt": "2020-10-06T08:57:28Z", "author": {"login": "marques-work"}, "path": "server/build.gradle", "diffHunk": "@@ -88,14 +88,7 @@ sourceSets {\n configurations {\n   jrubyGems\n \n-  sharedTestCompile.extendsFrom testCompile\n-  sharedTestRuntime.extendsFrom testRuntime\n-\n-  fastUnitTestCompile.extendsFrom sharedTestCompile\n-  fastUnitTestRuntime.extendsFrom sharedTestRuntime", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "743babf458061a811c349043f13e1f947666b40b"}, "originalPosition": 28}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTAyNzI4NTg4", "url": "https://github.com/gocd/gocd/pull/8557#pullrequestreview-502728588", "createdAt": "2020-10-06T09:00:36Z", "commit": {"oid": "743babf458061a811c349043f13e1f947666b40b"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wNlQwOTowMDozNlrOHc8whQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wNlQwOTowMDozNlrOHc8whQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMDExNzYzNw==", "bodyText": "All of this exclusion logic is handled during packaging in the war task. See the lines pertaining to configurations \"arithmetic\" when building the classpath.", "url": "https://github.com/gocd/gocd/pull/8557#discussion_r500117637", "createdAt": "2020-10-06T09:00:36Z", "author": {"login": "marques-work"}, "path": "server/build.gradle", "diffHunk": "@@ -110,19 +103,15 @@ configurations {\n   }\n \n   sharedTestOutput {\n-    extendsFrom testRuntime\n+    extendsFrom testRuntimeClasspath\n     transitive = true\n   }\n \n-  compile.exclude(group: 'org.springframework', module: 'spring-support')\n-  runtime.exclude(group: 'org.springframework', module: 'spring-support')\n-\n-  // this dependency is a \"provided\" dependency\n-  compile.exclude(group: 'ch.qos.logback', module: 'logback-classic')\n-  runtime.exclude(group: 'ch.qos.logback', module: 'logback-classic')\n-  apiBase.exclude(group: 'ch.qos.logback', module: 'logback-classic')\n-  api.exclude(group: 'ch.qos.logback', module: 'logback-classic')\n-  spark.exclude(group: 'ch.qos.logback', module: 'logback-classic')", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "743babf458061a811c349043f13e1f947666b40b"}, "originalPosition": 53}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTAyNzI5OTY0", "url": "https://github.com/gocd/gocd/pull/8557#pullrequestreview-502729964", "createdAt": "2020-10-06T09:02:19Z", "commit": {"oid": "743babf458061a811c349043f13e1f947666b40b"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wNlQwOTowMjoyMFrOHc80hw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wNlQwOTowMjoyMFrOHc80hw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMDExODY2Mw==", "bodyText": "In other words, Set<String> is better at deduplicating paths to jars than Set<File>.", "url": "https://github.com/gocd/gocd/pull/8557#discussion_r500118663", "createdAt": "2020-10-06T09:02:20Z", "author": {"login": "marques-work"}, "path": "server/build.gradle", "diffHunk": "@@ -725,23 +723,40 @@ task war(type: Jar) {\n   dependsOn rootProject.generateLicenseReport\n   dependsOn configureWar\n   dependsOn ':server:jar', ':server:compileAssets'\n-  dependsOn project.configurations.compile\n-  dependsOn project.configurations.api\n+  dependsOn project.configurations.compileClasspath\n+  dependsOn project.configurations.allApis\n   dependsOn project.configurations.spark\n   finalizedBy 'verifyWar'\n   archiveBaseName = 'cruise'\n-  extension 'war'\n+  archiveExtension = 'war'\n+\n+  // Using a Set<String> is more reliable than Set<File> because File.equals() may be affected by other internal fields\n+  // aside from `path` that aren't important to us; thus, Set<File> may allow duplicate paths and Set<String> will not.\n+  Set<String> classpath = (", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "743babf458061a811c349043f13e1f947666b40b"}, "originalPosition": 271}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "46fd97ac1e88682b9461d8f467fb6cec452e988e", "author": {"user": {"login": "marques-work", "name": null}}, "url": "https://github.com/gocd/gocd/commit/46fd97ac1e88682b9461d8f467fb6cec452e988e", "committedDate": "2020-10-13T04:37:20Z", "message": "Clean up LicenseReport.groovy\n\n  - Update gradle license plugin\n  - Better normalization\n  - Move certain license exception strings into existing license keys as alternate variants\n\nRemove buildSrc deprecations\n\n  - Upgrading the download task removed a lot of deprecations\n  - Fix annotations around `workingDir` for yarn tasks"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "989a8e2a6e85dc6e2180e9cc200fb731a5ac2aca", "author": {"user": {"login": "marques-work", "name": null}}, "url": "https://github.com/gocd/gocd/commit/989a8e2a6e85dc6e2180e9cc200fb731a5ac2aca", "committedDate": "2020-10-13T04:37:20Z", "message": "Remove commons-digester and its transitive deps in favor of JAXB\n\n  - Add CDDL + GPL dual license for jaxb and istack jars"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "91c23c0efdd11a75967a9d29aefd906edc07107b", "author": {"user": {"login": "marques-work", "name": null}}, "url": "https://github.com/gocd/gocd/commit/91c23c0efdd11a75967a9d29aefd906edc07107b", "committedDate": "2020-10-13T04:37:21Z", "message": "Massive refactor to remove (most) deprecations that will break in the next Gradle major release (7.0)\n\nNearly all of the changes are around dependency configurations. Gradle 7.0 will remove support for:\n\n  - `compile` => replace with `implementation` or `api`\n  - `runtime` => replace with `runtimeOnly`\n  - `compileOnly` for resolution (but not consumption) => replace with `compileClasspath`\n\nIn most cases, the above simple replacements work. But there are a number of cases that were problematic\nthat required more substantial refactoring in order to work with the different nuances of the replaced\nconfigurations."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "d70f05b9b47f4a5c73b4ad39e96c1ae9c242efa8", "author": {"user": {"login": "marques-work", "name": null}}, "url": "https://github.com/gocd/gocd/commit/d70f05b9b47f4a5c73b4ad39e96c1ae9c242efa8", "committedDate": "2020-10-13T04:37:21Z", "message": "Remove `exportForPackaging` configuration in favor of built-in `api` configuration\n\n`exportForPackaging` was functionally the same as `api` and only meant to communicate intent.\nHowever, it's better to just use the built-in configuration as folks will likely be familiar\nwith how `api` works anyway.\n\nKeep it simple."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "bbea8b3d6cd9db5b018047ed5027f95e600937f7", "author": {"user": {"login": "marques-work", "name": null}}, "url": "https://github.com/gocd/gocd/commit/bbea8b3d6cd9db5b018047ed5027f95e600937f7", "committedDate": "2020-10-13T04:37:21Z", "message": "Tiny whitespace fix"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "7434475dec01b8bebf7d8334975f2fec2f490021", "author": {"user": {"login": "marques-work", "name": null}}, "url": "https://github.com/gocd/gocd/commit/7434475dec01b8bebf7d8334975f2fec2f490021", "committedDate": "2020-10-13T04:37:21Z", "message": "providedAtPackageTime does not need to be resolvable, only consumable"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "781757ca6d2aeb736f156bb821c9d0efeae6860a", "author": {"user": {"login": "marques-work", "name": null}}, "url": "https://github.com/gocd/gocd/commit/781757ca6d2aeb736f156bb821c9d0efeae6860a", "committedDate": "2020-10-07T06:33:49Z", "message": "providedAtPackageTime does not need to be resolvable, only consumable"}, "afterCommit": {"oid": "7434475dec01b8bebf7d8334975f2fec2f490021", "author": {"user": {"login": "marques-work", "name": null}}, "url": "https://github.com/gocd/gocd/commit/7434475dec01b8bebf7d8334975f2fec2f490021", "committedDate": "2020-10-13T04:37:21Z", "message": "providedAtPackageTime does not need to be resolvable, only consumable"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1820, "cost": 1, "resetAt": "2021-11-01T14:20:25Z"}}}