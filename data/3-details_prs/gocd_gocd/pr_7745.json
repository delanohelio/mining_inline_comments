{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0Mzc2NDM5NTU2", "number": 7745, "title": "Migrate Package Repositories SPA to typescript", "bodyText": "Issue: #7333\nDescription:\n\nmigrated the package repository spa to typescript based\nwill include the feature of creating a new package as well as a package repository\n\nTODO\n\n we don't ask for view from the template, instead we build one on the basis of the configuration. Need to build such a component using typescript and utilize the same.", "createdAt": "2020-02-18T06:26:10Z", "url": "https://github.com/gocd/gocd/pull/7745", "merged": true, "mergeCommit": {"oid": "e333731fe4741fc9d3ad0513a998c36a971df3fd"}, "closed": true, "closedAt": "2020-03-25T10:04:01Z", "author": {"login": "kritika-singh3"}, "timelineItems": {"totalCount": 22, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcFcjIUgBqjMwNDU5MzA0MjE=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcQ4EBkgBqjMxNjEyNDc3MTI=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "70c0d86fd578ddb345202691d6794b1bb15f28b7", "author": {"user": {"login": "kritika-singh3", "name": "Kritika"}}, "url": "https://github.com/gocd/gocd/commit/70c0d86fd578ddb345202691d6794b1bb15f28b7", "committedDate": "2020-02-18T07:01:11Z", "message": "Added search functionality for package repo spa"}, "afterCommit": {"oid": "984bfc669702165bfddda3ec1c1c7a2bdbb35f00", "author": {"user": {"login": "kritika-singh3", "name": "Kritika"}}, "url": "https://github.com/gocd/gocd/commit/984bfc669702165bfddda3ec1c1c7a2bdbb35f00", "committedDate": "2020-02-18T07:10:58Z", "message": "Added search functionality for package repo spa"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzYwMjI1OTcw", "url": "https://github.com/gocd/gocd/pull/7745#pullrequestreview-360225970", "createdAt": "2020-02-18T10:28:38Z", "commit": {"oid": "2aec3029d9fbeacbe8808eaebe50f75d1a21f818"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xOFQxMDoyODozOFrOFq9Eow==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xOFQxMDoyODozOFrOFq9Eow==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MDU4NTEyMw==", "bodyText": "@kritika-singh3 - can we use the publicly documented Package Repositories and Packages API to fetch this information.\nIMO, we should always prefer public APIs for rendering entity information on the SPAs, unless its absolutely required to build a newer internal API.", "url": "https://github.com/gocd/gocd/pull/7745#discussion_r380585123", "createdAt": "2020-02-18T10:28:38Z", "author": {"login": "GaneshSPatil"}, "path": "api/api-internal-package-repositories-v1/src/main/java/com/thoughtworks/go/apiv1/internalpackagerepositories/InternalPackageRepositoriesControllerV1.java", "diffHunk": "@@ -0,0 +1,76 @@\n+/*\n+ * Copyright 2020 ThoughtWorks, Inc.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package com.thoughtworks.go.apiv1.internalpackagerepositories;\n+\n+import com.thoughtworks.go.api.ApiController;\n+import com.thoughtworks.go.api.ApiVersion;\n+import com.thoughtworks.go.api.CrudController;\n+import com.thoughtworks.go.api.base.OutputWriter;\n+import com.thoughtworks.go.api.spring.ApiAuthenticationHelper;\n+import com.thoughtworks.go.apiv1.internalpackagerepositories.representers.PackageRepositoriesRepresenter;\n+import com.thoughtworks.go.config.exceptions.EntityType;\n+import com.thoughtworks.go.config.exceptions.HttpException;\n+import com.thoughtworks.go.domain.packagerepository.PackageRepositories;\n+import com.thoughtworks.go.server.service.EntityHashingService;\n+import com.thoughtworks.go.server.service.materials.PackageRepositoryService;\n+import com.thoughtworks.go.spark.Routes;\n+import com.thoughtworks.go.spark.spring.SparkSpringController;\n+import org.springframework.beans.factory.annotation.Autowired;\n+import org.springframework.stereotype.Component;\n+import spark.Request;\n+import spark.Response;\n+\n+import java.io.IOException;\n+import java.util.function.Consumer;\n+\n+import static spark.Spark.*;\n+\n+@Component\n+public class InternalPackageRepositoriesControllerV1 extends ApiController implements SparkSpringController {\n+\n+    private final ApiAuthenticationHelper apiAuthenticationHelper;\n+    private final PackageRepositoryService packageRepositoryService;\n+\n+    @Autowired\n+    public InternalPackageRepositoriesControllerV1(ApiAuthenticationHelper apiAuthenticationHelper, PackageRepositoryService packageRepositoryService) {\n+        super(ApiVersion.v1);\n+        this.apiAuthenticationHelper = apiAuthenticationHelper;\n+        this.packageRepositoryService = packageRepositoryService;\n+    }\n+\n+    @Override\n+    public String controllerBasePath() {\n+        return Routes.PackageRepository.INTERNAL_BASE;\n+    }\n+\n+    @Override\n+    public void setupRoutes() {\n+        path(controllerBasePath(), () -> {\n+             before(\"\", mimeType, this::setContentType);\n+             before(\"/*\", mimeType, this::setContentType);\n+\n+            before(\"\", mimeType, this.apiAuthenticationHelper::checkAdminUserOrGroupAdminUserAnd403);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "2aec3029d9fbeacbe8808eaebe50f75d1a21f818"}, "originalPosition": 66}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "2132a7ff54b7b005085f2f6fe6b1e7f2d243b4f1", "author": {"user": {"login": "kritika-singh3", "name": "Kritika"}}, "url": "https://github.com/gocd/gocd/commit/2132a7ff54b7b005085f2f6fe6b1e7f2d243b4f1", "committedDate": "2020-02-18T10:08:49Z", "message": "Showcase no plugin installed msg along side package repos installed.\n - removed the plugin info passed down the hierarchy"}, "afterCommit": {"oid": "6b612117091541bf18d8b7dc0740d6aa018ef56f", "author": {"user": {"login": "kritika-singh3", "name": "Kritika"}}, "url": "https://github.com/gocd/gocd/commit/6b612117091541bf18d8b7dc0740d6aa018ef56f", "committedDate": "2020-02-19T06:18:00Z", "message": "update packages repo spa to fetch all pkg repos and pkgs separately and merge them during rendering"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzYwOTMxMzE1", "url": "https://github.com/gocd/gocd/pull/7745#pullrequestreview-360931315", "createdAt": "2020-02-19T08:52:41Z", "commit": {"oid": "6b612117091541bf18d8b7dc0740d6aa018ef56f"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xOVQwODo1Mjo0MVrOFrflNw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xOVQwODo1Mjo0MVrOFrflNw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MTE1MDUxOQ==", "bodyText": "remove this controller?", "url": "https://github.com/gocd/gocd/pull/7745#discussion_r381150519", "createdAt": "2020-02-19T08:52:41Z", "author": {"login": "GaneshSPatil"}, "path": "api/api-packages-v1/src/main/java/com/thoughtworks/go/apiv1/packages/InternalPackagesControllerV1.java", "diffHunk": "@@ -0,0 +1,76 @@\n+/*\n+ * Copyright 2020 ThoughtWorks, Inc.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package com.thoughtworks.go.apiv1.packages;\n+\n+import com.thoughtworks.go.api.ApiController;\n+import com.thoughtworks.go.api.ApiVersion;\n+import com.thoughtworks.go.api.spring.ApiAuthenticationHelper;\n+import com.thoughtworks.go.apiv1.packages.representers.PackageUsageRepresenter;\n+import com.thoughtworks.go.config.PipelineConfig;\n+import com.thoughtworks.go.config.PipelineConfigs;\n+import com.thoughtworks.go.server.service.GoConfigService;\n+import com.thoughtworks.go.server.service.materials.PackageRepositoryService;\n+import com.thoughtworks.go.spark.Routes;\n+import com.thoughtworks.go.spark.spring.SparkSpringController;\n+import com.thoughtworks.go.util.Pair;\n+import org.springframework.beans.factory.annotation.Autowired;\n+import spark.Request;\n+import spark.Response;\n+\n+import java.io.IOException;\n+import java.util.List;\n+import java.util.Map;\n+\n+import static java.util.Collections.emptyList;\n+import static spark.Spark.*;\n+\n+public class InternalPackagesControllerV1 extends ApiController implements SparkSpringController {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "6b612117091541bf18d8b7dc0740d6aa018ef56f"}, "originalPosition": 41}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "bccf97a1d5b82ab76b97c1ae6a2dd690bf510159", "author": {"user": {"login": "kritika-singh3", "name": "Kritika"}}, "url": "https://github.com/gocd/gocd/commit/bccf97a1d5b82ab76b97c1ae6a2dd690bf510159", "committedDate": "2020-02-21T11:38:35Z", "message": "Showcase some info abt pkg repos if none are configured\n\n - updated models to recognise errors from server"}, "afterCommit": {"oid": "1a4ede7ed65cf9740109303ed11ec7b106ba396b", "author": {"user": {"login": "kritika-singh3", "name": "Kritika"}}, "url": "https://github.com/gocd/gocd/commit/1a4ede7ed65cf9740109303ed11ec7b106ba396b", "committedDate": "2020-03-18T14:25:59Z", "message": "Fix failing tests"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "1a4ede7ed65cf9740109303ed11ec7b106ba396b", "author": {"user": {"login": "kritika-singh3", "name": "Kritika"}}, "url": "https://github.com/gocd/gocd/commit/1a4ede7ed65cf9740109303ed11ec7b106ba396b", "committedDate": "2020-03-18T14:25:59Z", "message": "Fix failing tests"}, "afterCommit": {"oid": "c891b164c9ef7e91abd3ea11e6ef70c3a3259a60", "author": {"user": {"login": "kritika-singh3", "name": "Kritika"}}, "url": "https://github.com/gocd/gocd/commit/c891b164c9ef7e91abd3ea11e6ef70c3a3259a60", "committedDate": "2020-03-18T14:28:54Z", "message": "Fix failing tests"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "c891b164c9ef7e91abd3ea11e6ef70c3a3259a60", "author": {"user": {"login": "kritika-singh3", "name": "Kritika"}}, "url": "https://github.com/gocd/gocd/commit/c891b164c9ef7e91abd3ea11e6ef70c3a3259a60", "committedDate": "2020-03-18T14:28:54Z", "message": "Fix failing tests"}, "afterCommit": {"oid": "9b6b0de8f0e178e7c8c57c0f318f054a34c5c9f8", "author": {"user": {"login": "kritika-singh3", "name": "Kritika"}}, "url": "https://github.com/gocd/gocd/commit/9b6b0de8f0e178e7c8c57c0f318f054a34c5c9f8", "committedDate": "2020-03-18T14:43:39Z", "message": "Fix failing tests"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "9b6b0de8f0e178e7c8c57c0f318f054a34c5c9f8", "author": {"user": {"login": "kritika-singh3", "name": "Kritika"}}, "url": "https://github.com/gocd/gocd/commit/9b6b0de8f0e178e7c8c57c0f318f054a34c5c9f8", "committedDate": "2020-03-18T14:43:39Z", "message": "Fix failing tests"}, "afterCommit": {"oid": "5a7ce49a2269a075d632ad163b263bf57005c426", "author": {"user": {"login": "kritika-singh3", "name": "Kritika"}}, "url": "https://github.com/gocd/gocd/commit/5a7ce49a2269a075d632ad163b263bf57005c426", "committedDate": "2020-03-19T03:15:10Z", "message": "Fix failing tests"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "8e64943d1f78f5c2cdd5f2876b222bcb3b5e45c7", "author": {"user": {"login": "kritika-singh3", "name": "Kritika"}}, "url": "https://github.com/gocd/gocd/commit/8e64943d1f78f5c2cdd5f2876b222bcb3b5e45c7", "committedDate": "2020-03-24T15:42:17Z", "message": "Move package repositories page to typescript\n\n - added a toggle `show_old_pkg_repos_spa` for the page. Default is false.\n - initial commit for the new spa"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "36625cc8fa4dcafa782435e88608a3e065114429", "author": {"user": {"login": "kritika-singh3", "name": "Kritika"}}, "url": "https://github.com/gocd/gocd/commit/36625cc8fa4dcafa782435e88608a3e065114429", "committedDate": "2020-03-24T15:48:20Z", "message": "Added CRUD and relevant models\nAdded CRUD operations for package repository and packages - Updated the models for validations"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "31975798425afd92e0df08cc285c4a39f1001180", "author": {"user": {"login": "kritika-singh3", "name": "Kritika"}}, "url": "https://github.com/gocd/gocd/commit/31975798425afd92e0df08cc285c4a39f1001180", "committedDate": "2020-03-24T15:48:20Z", "message": "Update CollapsiblePanel component to recognize nonExpandable attribute which will prevent any user interactions to collapse the panel. It will always be in expanded state"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "558555513655808ea12816f921a8d0715d14abc7", "author": {"user": {"login": "kritika-singh3", "name": "Kritika"}}, "url": "https://github.com/gocd/gocd/commit/558555513655808ea12816f921a8d0715d14abc7", "committedDate": "2020-03-24T15:48:21Z", "message": "Showcase all the package repositories and the associated packages in a read-only view."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "551807d8acd00aa97ccb2e35462fdf032b369a20", "author": {"user": {"login": "kritika-singh3", "name": "Kritika"}}, "url": "https://github.com/gocd/gocd/commit/551807d8acd00aa97ccb2e35462fdf032b369a20", "committedDate": "2020-03-24T15:48:43Z", "message": "Added usages api to get the usages of a particular package id"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "8cef5be1e6f997f35d62b1aa76328f7fe0172e15", "author": {"user": {"login": "kritika-singh3", "name": "Kritika"}}, "url": "https://github.com/gocd/gocd/commit/8cef5be1e6f997f35d62b1aa76328f7fe0172e15", "committedDate": "2020-03-24T15:48:44Z", "message": "Updated the package repository and package widget to showcase action buttons as applicable.\n\nCurrently the plugin view is not rendered as the plugin does not send any view template."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "2bfd948f4bf00ab1bae7494949466e96c4a336dd", "author": {"user": {"login": "kritika-singh3", "name": "Kritika"}}, "url": "https://github.com/gocd/gocd/commit/2bfd948f4bf00ab1bae7494949466e96c4a336dd", "committedDate": "2020-03-24T15:49:04Z", "message": "Added specs"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "59c5ea62d4ef38527c46ceac821682e66bba6e4b", "author": {"user": {"login": "kritika-singh3", "name": "Kritika"}}, "url": "https://github.com/gocd/gocd/commit/59c5ea62d4ef38527c46ceac821682e66bba6e4b", "committedDate": "2020-03-24T15:49:05Z", "message": "Added search functionality for package repo spa"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "2c044122118fcfa675505bf1d4b164953bd1a410", "author": {"user": {"login": "kritika-singh3", "name": "Kritika"}}, "url": "https://github.com/gocd/gocd/commit/2c044122118fcfa675505bf1d4b164953bd1a410", "committedDate": "2020-03-24T15:49:05Z", "message": "Showcase no plugin installed msg along side package repos installed.\n - removed the plugin info passed down the hierarchy"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "603a163561bdb9f2c81c49b44d2c8edd77dd332e", "author": {"user": {"login": "kritika-singh3", "name": "Kritika"}}, "url": "https://github.com/gocd/gocd/commit/603a163561bdb9f2c81c49b44d2c8edd77dd332e", "committedDate": "2020-03-24T15:49:05Z", "message": "update packages repo spa to fetch all pkg repos and pkgs separately and merge them during rendering"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ab33e260463a40f063c977245d8f4e7a7b6e4718", "author": {"user": {"login": "GaneshSPatil", "name": "Ganesh S Patil"}}, "url": "https://github.com/gocd/gocd/commit/ab33e260463a40f063c977245d8f4e7a7b6e4718", "committedDate": "2020-03-24T15:49:05Z", "message": "Render plugin view"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "d8517dd7557b731a0c0a6ade680344f7b161ad49", "author": {"user": {"login": "kritika-singh3", "name": "Kritika"}}, "url": "https://github.com/gocd/gocd/commit/d8517dd7557b731a0c0a6ade680344f7b161ad49", "committedDate": "2020-03-24T15:49:25Z", "message": "Showcase some info abt pkg repos if none are configured\n\n - updated models to recognise errors from server"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f2359debdf20735569436039117343c472c7e0d6", "author": {"user": {"login": "kritika-singh3", "name": "Kritika"}}, "url": "https://github.com/gocd/gocd/commit/f2359debdf20735569436039117343c472c7e0d6", "committedDate": "2020-03-24T15:49:27Z", "message": "Fix failing tests"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "5a7ce49a2269a075d632ad163b263bf57005c426", "author": {"user": {"login": "kritika-singh3", "name": "Kritika"}}, "url": "https://github.com/gocd/gocd/commit/5a7ce49a2269a075d632ad163b263bf57005c426", "committedDate": "2020-03-19T03:15:10Z", "message": "Fix failing tests"}, "afterCommit": {"oid": "f2359debdf20735569436039117343c472c7e0d6", "author": {"user": {"login": "kritika-singh3", "name": "Kritika"}}, "url": "https://github.com/gocd/gocd/commit/f2359debdf20735569436039117343c472c7e0d6", "committedDate": "2020-03-24T15:49:27Z", "message": "Fix failing tests"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1967, "cost": 1, "resetAt": "2021-11-01T14:20:25Z"}}}