{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDgyNzE3NDkx", "number": 8538, "reviewThreads": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0wOVQwOTo0OTo0OVrOEhmKRQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0wOVQwOTo0OTo0OVrOEhmKRQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzAzNjYzNjg1OnYy", "diffSide": "RIGHT", "path": "server/src/main/webapp/WEB-INF/rails/webpack/views/pages/pipeline_activity/pipeline_run_info_widget.tsx", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0wOVQwOTo0OTo0OVrOHO_qrQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0wOVQwOTo0OTo0OVrOHO_qrQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NTQ4NTIyOQ==", "bodyText": "Fix this!\nFix stage settings page when pipeline is defined from a template.", "url": "https://github.com/gocd/gocd/pull/8538#discussion_r485485229", "createdAt": "2020-09-09T09:49:49Z", "author": {"login": "GaneshSPatil"}, "path": "server/src/main/webapp/WEB-INF/rails/webpack/views/pages/pipeline_activity/pipeline_run_info_widget.tsx", "diffHunk": "@@ -100,16 +103,54 @@ export class PipelineRunWidget extends MithrilViewComponent<PipelineRunAttrs> {\n       </td>\n       <td class={styles.right} data-test-id=\"stage-status\">\n         {pipelineRunInfo.stages().map((stage, index) => {\n+\n+          const pipelineName = stage.pipelineName();\n+          const pipelineCounter = stage.pipelineCounter();\n+          const stageName = stage.stageName();\n+          const stageCounter = stage.stageCounter();\n+\n+          let optionalStageOverview: m.Children | undefined;\n+\n+          let isModelOpen = vnode.attrs.stageOverviewState.isOpen(pipelineName, pipelineCounter, stageName, stageCounter);\n+          if (!isModelOpen && vnode.attrs.stageOverviewState.getPipelineCounter() === pipelineCounter) {\n+            const previousStageCounter = `${((+stageCounter) - 1)}`;\n+            const isOpenForPreviousStageInstance = vnode.attrs.stageOverviewState.isOpen(pipelineName, pipelineCounter, stageName, previousStageCounter);\n+\n+            if (isOpenForPreviousStageInstance) {\n+              isModelOpen = true;\n+              vnode.attrs.stageOverviewState.hide();\n+              vnode.attrs.showStageOverview(pipelineName, pipelineCounter, stageName, stageCounter, stage.stageStatus(), {stopPropagation: () => undefined});\n+            }\n+          }\n+\n+          if (isModelOpen) {\n+            // @ts-ignore\n+            stage.status = stage.stageStatus();\n+            // @ts-ignore\n+            stage.canOperate = vnode.attrs.canOperatePipeline;\n+\n+            optionalStageOverview = <StageOverview pipelineName={stage.pipelineName()}\n+                                                   isDisplayedOnPipelineActivityPage={true}\n+                                                   canAdminister={vnode.attrs.canAdministerPipeline}\n+                                                   pipelineCounter={stage.pipelineCounter()}\n+                                                   stageName={stageName}\n+                                                   stageCounter={stageCounter}\n+                                                   stages={pipelineRunInfo.stages()}\n+                                                   templateName={undefined}", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f1e5855c5c6a963c360f9315150c0b38ef86fa6a"}, "originalPosition": 61}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2784, "cost": 1, "resetAt": "2021-11-12T19:05:54Z"}}}