{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDAwMTE3NDU2", "number": 7970, "reviewThreads": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wN1QyMjo0MzowMFrODvxJSw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wN1QyMjo0MzowMFrODvxJSw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjUxNDE0ODU5OnYy", "diffSide": "RIGHT", "path": "server/src/main/java/com/thoughtworks/go/server/service/support/toggle/FeatureToggleService.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wN1QyMjo0MzowMFrOGCYxDg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wOVQyMjoyODozM1rOGDriMw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNTE1NjExMA==", "bodyText": "It may not be obvious, but allToggles() is not really all toggles. It filters out toggles that are not known to available.toggles. Because we may have dynamically generated toggle keys for route toggles, we need to account for these in case users set them in <configDir>/go.feature.toggles.\nThus, we first search userToggles() alone before defaulting to allToggles().", "url": "https://github.com/gocd/gocd/pull/7970#discussion_r405156110", "createdAt": "2020-04-07T22:43:00Z", "author": {"login": "marques-work"}, "path": "server/src/main/java/com/thoughtworks/go/server/service/support/toggle/FeatureToggleService.java", "diffHunk": "@@ -42,25 +42,56 @@ public FeatureToggleService(FeatureToggleRepository repository, GoCache goCache)\n     }\n \n     public boolean isToggleOn(String key) {\n-        FeatureToggle toggle = allToggles().find(key);\n+        // handle any key, really.\n+        FeatureToggle toggle = userToggles().find(key);\n+        if (toggle != null) {\n+            return toggle.isOn();\n+        }\n+\n+        toggle = allToggles().find(key);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "356356f43dfa8f9ce56f441c9177b4e17aa06c83"}, "originalPosition": 29}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNjUxMjE3OQ==", "bodyText": "@marques-work I realized we cannot change the value for a dynamic toggle key. If you try to update the dynamic toggle key config_repo_v4 using the feature_toggles API it fails.\nThe reason for the failure is this check - \n  \n    \n      gocd/server/src/main/java/com/thoughtworks/go/server/service/support/toggle/FeatureToggleService.java\n    \n    \n         Line 102\n      in\n      3423ef9\n    \n    \n    \n    \n\n        \n          \n           throw new RecordNotFoundException(MessageFormat.format(\"Feature toggle: ''{0}'' is not valid.\", key));", "url": "https://github.com/gocd/gocd/pull/7970#discussion_r406512179", "createdAt": "2020-04-09T22:28:33Z", "author": {"login": "maheshp"}, "path": "server/src/main/java/com/thoughtworks/go/server/service/support/toggle/FeatureToggleService.java", "diffHunk": "@@ -42,25 +42,56 @@ public FeatureToggleService(FeatureToggleRepository repository, GoCache goCache)\n     }\n \n     public boolean isToggleOn(String key) {\n-        FeatureToggle toggle = allToggles().find(key);\n+        // handle any key, really.\n+        FeatureToggle toggle = userToggles().find(key);\n+        if (toggle != null) {\n+            return toggle.isOn();\n+        }\n+\n+        toggle = allToggles().find(key);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNTE1NjExMA=="}, "originalCommit": {"oid": "356356f43dfa8f9ce56f441c9177b4e17aa06c83"}, "originalPosition": 29}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2700, "cost": 1, "resetAt": "2021-11-12T19:05:54Z"}}}