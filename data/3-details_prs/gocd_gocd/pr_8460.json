{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDY3NzY5NTAy", "number": 8460, "title": "Mask user info on materials tab on pipeline config spa", "bodyText": "Use url-parse library to mask user-info (if present) on the materials tab", "createdAt": "2020-08-14T05:03:06Z", "url": "https://github.com/gocd/gocd/pull/8460", "merged": true, "mergeCommit": {"oid": "8755541fe4835509d450e8f7356ee4e5c1600fa4"}, "closed": true, "closedAt": "2020-08-14T05:22:11Z", "author": {"login": "kritika-singh3"}, "timelineItems": {"totalCount": 5, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABc-tcpIABqjM2NTQ3NzI2NDg=", "endCursor": "Y3Vyc29yOnYyOpPPAAABc-tqmrgBqjM2NTQ4MDA3NDU=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "34165c79c226284fcd0a3137e181a266ef806294", "author": {"user": {"login": "kritika-singh3", "name": "Kritika"}}, "url": "https://github.com/gocd/gocd/commit/34165c79c226284fcd0a3137e181a266ef806294", "committedDate": "2020-08-14T04:59:59Z", "message": "Use url-parse library to mask user-info (if present) on the materials tab"}, "afterCommit": {"oid": "dacc77d19d5d8ab3a34f8e5bbfcfcb3a60b3e5c0", "author": {"user": {"login": "kritika-singh3", "name": "Kritika"}}, "url": "https://github.com/gocd/gocd/commit/dacc77d19d5d8ab3a34f8e5bbfcfcb3a60b3e5c0", "committedDate": "2020-08-14T05:06:15Z", "message": "Use url-parse library to mask user-info (if present) on the materials tab"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDY3MzExOTc3", "url": "https://github.com/gocd/gocd/pull/8460#pullrequestreview-467311977", "createdAt": "2020-08-14T05:15:49Z", "commit": {"oid": "dacc77d19d5d8ab3a34f8e5bbfcfcb3a60b3e5c0"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xNFQwNToxNTo0OVrOHAn0Yw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xNFQwNToxNTo0OVrOHAn0Yw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MDQxNDQzNQ==", "bodyText": "how about renaming the method name urlForDisplay?\n\n\nHow about simplifying the above code as:\n\n\nfunction urlForDisplay(url?: string) {\n  if (!url) { return undefined;}\n\n  const parsed = urlParse(url, {});\n  // do not mask passwords\n  if (_.isEmpty(parsed.auth) || parsed.protocol.includes('ssh') || parsed.protocol.includes('svn+ssh')) {\n    return parsed.href;\n  }\n\n  if (parsed.auth.includes(\":\")) {\n    // mask password when username and password is provided as username:password@url\n    parsed.set('password', '******');\n  } else {\n    // mask token when credentials are provided as token@url\n    parsed.set('username', '******');\n  }\n\n  return parsed.href;\n}", "url": "https://github.com/gocd/gocd/pull/8460#discussion_r470414435", "createdAt": "2020-08-14T05:15:49Z", "author": {"login": "GaneshSPatil"}, "path": "server/src/main/webapp/WEB-INF/rails/webpack/models/materials/types.ts", "diffHunk": "@@ -51,6 +51,24 @@ export const mapTypeToDisplayType: { [key: string]: string; } = {\n   plugin:     \"Plugin\"\n };\n \n+function clean(url?: string) {\n+  if (!url) {\n+    return url;\n+  }\n+  const parsedUrl = urlParse(url, {});\n+  if (!_.isEmpty(parsedUrl.auth)) {\n+    if (parsedUrl.auth.includes(\":\")) {\n+      parsedUrl.set('password', '******');\n+      return parsedUrl.href;\n+    }\n+    if (parsedUrl.protocol.includes('ssh') || parsedUrl.protocol.includes('svn+ssh')) {\n+      return parsedUrl.href;\n+    }\n+    parsedUrl.set('username', '******');\n+  }\n+  return parsedUrl.href;\n+}\n+", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "dacc77d19d5d8ab3a34f8e5bbfcfcb3a60b3e5c0"}, "originalPosition": 21}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDY3MzEyMTU4", "url": "https://github.com/gocd/gocd/pull/8460#pullrequestreview-467312158", "createdAt": "2020-08-14T05:16:27Z", "commit": {"oid": "dacc77d19d5d8ab3a34f8e5bbfcfcb3a60b3e5c0"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "d7524a78198207cdb6afa44724ed0cce4d45c896", "author": {"user": {"login": "kritika-singh3", "name": "Kritika"}}, "url": "https://github.com/gocd/gocd/commit/d7524a78198207cdb6afa44724ed0cce4d45c896", "committedDate": "2020-08-14T05:21:29Z", "message": "Use url-parse library to mask user-info (if present) on the materials tab"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "dacc77d19d5d8ab3a34f8e5bbfcfcb3a60b3e5c0", "author": {"user": {"login": "kritika-singh3", "name": "Kritika"}}, "url": "https://github.com/gocd/gocd/commit/dacc77d19d5d8ab3a34f8e5bbfcfcb3a60b3e5c0", "committedDate": "2020-08-14T05:06:15Z", "message": "Use url-parse library to mask user-info (if present) on the materials tab"}, "afterCommit": {"oid": "d7524a78198207cdb6afa44724ed0cce4d45c896", "author": {"user": {"login": "kritika-singh3", "name": "Kritika"}}, "url": "https://github.com/gocd/gocd/commit/d7524a78198207cdb6afa44724ed0cce4d45c896", "committedDate": "2020-08-14T05:21:29Z", "message": "Use url-parse library to mask user-info (if present) on the materials tab"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1853, "cost": 1, "resetAt": "2021-11-01T14:20:25Z"}}}