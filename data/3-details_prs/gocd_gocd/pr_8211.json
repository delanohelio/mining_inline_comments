{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDI3MTY3Mzc5", "number": 8211, "title": "Allow loading external assets into analytics iframe", "bodyText": "Uses the same mechanism as the one used to load the plugin-server-communication JS file.", "createdAt": "2020-06-03T12:23:48Z", "url": "https://github.com/gocd/gocd/pull/8211", "merged": true, "mergeCommit": {"oid": "31093180cc4b4a647c8a67717ac64ed1479a5cdd"}, "closed": true, "closedAt": "2020-06-09T11:12:40Z", "author": {"login": "arvindsv"}, "timelineItems": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcn4Is5gFqTQyNDEzNzUxMQ==", "endCursor": "Y3Vyc29yOnYyOpPPAAABcn6ojXgBqjM0MDU5NTU3NjU=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDI0MTM3NTEx", "url": "https://github.com/gocd/gocd/pull/8211#pullrequestreview-424137511", "createdAt": "2020-06-04T06:31:46Z", "commit": {"oid": "5ea191440a7e40cfd78e6174b2aeee5f37d645c9"}, "state": "APPROVED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wNFQwNjozMTo0NlrOGe3kJQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wNFQwNjozMTo0NlrOGe3kJQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNTAyMDgzNw==", "bodyText": "@arvindsv we bubble up an error when we fail to write the other plugin static assets to disk. Shouldn't we do the same here? If highcharts is not present, nothing will work, so we should make that more apparent than a log message, no? I didn't follow the usages, but I'm making an assumption that thrown exceptions become visible in the UI.", "url": "https://github.com/gocd/gocd/pull/8211#discussion_r435020837", "createdAt": "2020-06-04T06:31:46Z", "author": {"login": "marques-work"}, "path": "server/src/main/java/com/thoughtworks/go/server/service/plugins/AnalyticsPluginAssetsService.java", "diffHunk": "@@ -132,6 +138,26 @@ private void cacheStaticAssets(String pluginId) {\n         }\n     }\n \n+    private void safeCopyExternalAssetsToPluginAssetRoot(final String pluginAssetsRoot) {\n+        Path externalAssetsPath = Paths.get(systemEnvironment.get(SystemEnvironment.GO_ANALYTICS_PLUGIN_EXTERNAL_ASSETS));\n+        if (externalAssetsPath == null || !Files.exists(externalAssetsPath) || !Files.isDirectory(externalAssetsPath)) {\n+            LOGGER.debug(\"Analytics plugin external assets path ({}) does not exist or is not a directory. Not loading any assets.\", externalAssetsPath);\n+            return;\n+        }\n+\n+        try {\n+            Files.list(externalAssetsPath).forEach(path -> {\n+                try {\n+                    Files.copy(path, Paths.get(pluginAssetsRoot, path.getFileName().toString()));\n+                } catch (Exception e) {\n+                    LOGGER.error(\"Unable to copy analytics plugin external asset ({}) to plugin assets root.\", path, e);\n+                }\n+            });\n+        } catch (Exception e) {\n+            LOGGER.error(\"Unable to list files in analytics plugin external assets location ({}).\", externalAssetsPath, e);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "5ea191440a7e40cfd78e6174b2aeee5f37d645c9"}, "originalPosition": 64}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "5ea191440a7e40cfd78e6174b2aeee5f37d645c9", "author": {"user": {"login": "arvindsv", "name": "Aravind SV"}}, "url": "https://github.com/gocd/gocd/commit/5ea191440a7e40cfd78e6174b2aeee5f37d645c9", "committedDate": "2020-06-03T12:20:51Z", "message": "#000 - Allow loading external assets into analytics iframe\n\n- Uses the same mechanism as the one used to load the plugin-server-communication JS file."}, "afterCommit": {"oid": "50ef5bca39025e763228500341958386ecf2d535", "author": {"user": {"login": "arvindsv", "name": "Aravind SV"}}, "url": "https://github.com/gocd/gocd/commit/50ef5bca39025e763228500341958386ecf2d535", "committedDate": "2020-06-04T09:20:33Z", "message": "#000 - Allow loading external assets into analytics iframe\n\n- Uses the same mechanism as the one used to load the plugin-server-communication JS file."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b6c92b977115665009c7e7f488c0f5ad98f5a14b", "author": {"user": {"login": "arvindsv", "name": "Aravind SV"}}, "url": "https://github.com/gocd/gocd/commit/b6c92b977115665009c7e7f488c0f5ad98f5a14b", "committedDate": "2020-06-04T09:27:44Z", "message": "#000 - Allow loading external assets into analytics iframe\n\n- Uses the same mechanism as the one used to load the plugin-server-communication JS file."}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "50ef5bca39025e763228500341958386ecf2d535", "author": {"user": {"login": "arvindsv", "name": "Aravind SV"}}, "url": "https://github.com/gocd/gocd/commit/50ef5bca39025e763228500341958386ecf2d535", "committedDate": "2020-06-04T09:20:33Z", "message": "#000 - Allow loading external assets into analytics iframe\n\n- Uses the same mechanism as the one used to load the plugin-server-communication JS file."}, "afterCommit": {"oid": "b6c92b977115665009c7e7f488c0f5ad98f5a14b", "author": {"user": {"login": "arvindsv", "name": "Aravind SV"}}, "url": "https://github.com/gocd/gocd/commit/b6c92b977115665009c7e7f488c0f5ad98f5a14b", "committedDate": "2020-06-04T09:27:44Z", "message": "#000 - Allow loading external assets into analytics iframe\n\n- Uses the same mechanism as the one used to load the plugin-server-communication JS file."}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1892, "cost": 1, "resetAt": "2021-11-01T14:20:25Z"}}}