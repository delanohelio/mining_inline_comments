{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDAwMTE3NDU2", "number": 7970, "title": "Add an annotation that allows API routes to be conditionally mapped to `latest` version via feature-toggle", "bodyText": "Useful for developing new API versions that may not be yet finalized for release. Now you don't really have to revert your code only to undo the revert after release.\nAlso hides config repo v4 from being aliased as latest.\nNote\nToggling a route will require a restart. It won't hot-update due to how we map latest aliases.", "createdAt": "2020-04-07T08:26:03Z", "url": "https://github.com/gocd/gocd/pull/7970", "merged": true, "mergeCommit": {"oid": "383d22994083c3b0384b7a240b888d46360c9dc9"}, "closed": true, "closedAt": "2020-04-07T20:32:12Z", "author": {"login": "marques-work"}, "timelineItems": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcVPtKkAH2gAyNDAwMTE3NDU2OjM1NjM1NmY0M2RmYThmOWNlNTZmNDQxYzkxNzdiNGUxN2FhMDZjODM=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcVbPpQgFqTM4OTU0MDcxOQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "356356f43dfa8f9ce56f441c9177b4e17aa06c83", "author": {"user": {"login": "marques-work", "name": null}}, "url": "https://github.com/gocd/gocd/commit/356356f43dfa8f9ce56f441c9177b4e17aa06c83", "committedDate": "2020-04-07T09:16:24Z", "message": "Add an annotation that allows API routes to be conditionally mapped to `latest` version via feature-toggle\n\nUseful for developing new API versions that may not be yet finalized for release. Now you don't really have\nto revert your code only to undo the revert after release."}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "2dca6b32557ff3508c76d4446adaf60b48ac886f", "author": {"user": {"login": "marques-work", "name": null}}, "url": "https://github.com/gocd/gocd/commit/2dca6b32557ff3508c76d4446adaf60b48ac886f", "committedDate": "2020-04-07T08:24:42Z", "message": "Add an annotation that allows API routes to be conditionally mapped to `latest` version via feature-toggle\n\nUseful for developing new API versions that may not be yet finalized for release. Now you don't really have\nto revert your code only to undo the revert after release."}, "afterCommit": {"oid": "356356f43dfa8f9ce56f441c9177b4e17aa06c83", "author": {"user": {"login": "marques-work", "name": null}}, "url": "https://github.com/gocd/gocd/commit/356356f43dfa8f9ce56f441c9177b4e17aa06c83", "committedDate": "2020-04-07T09:16:24Z", "message": "Add an annotation that allows API routes to be conditionally mapped to `latest` version via feature-toggle\n\nUseful for developing new API versions that may not be yet finalized for release. Now you don't really have\nto revert your code only to undo the revert after release."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzg5NTQwNzE5", "url": "https://github.com/gocd/gocd/pull/7970#pullrequestreview-389540719", "createdAt": "2020-04-07T22:43:00Z", "commit": {"oid": "356356f43dfa8f9ce56f441c9177b4e17aa06c83"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wN1QyMjo0MzowMFrOGCYxDg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wN1QyMjo0MzowMFrOGCYxDg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNTE1NjExMA==", "bodyText": "It may not be obvious, but allToggles() is not really all toggles. It filters out toggles that are not known to available.toggles. Because we may have dynamically generated toggle keys for route toggles, we need to account for these in case users set them in <configDir>/go.feature.toggles.\nThus, we first search userToggles() alone before defaulting to allToggles().", "url": "https://github.com/gocd/gocd/pull/7970#discussion_r405156110", "createdAt": "2020-04-07T22:43:00Z", "author": {"login": "marques-work"}, "path": "server/src/main/java/com/thoughtworks/go/server/service/support/toggle/FeatureToggleService.java", "diffHunk": "@@ -42,25 +42,56 @@ public FeatureToggleService(FeatureToggleRepository repository, GoCache goCache)\n     }\n \n     public boolean isToggleOn(String key) {\n-        FeatureToggle toggle = allToggles().find(key);\n+        // handle any key, really.\n+        FeatureToggle toggle = userToggles().find(key);\n+        if (toggle != null) {\n+            return toggle.isOn();\n+        }\n+\n+        toggle = allToggles().find(key);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "356356f43dfa8f9ce56f441c9177b4e17aa06c83"}, "originalPosition": 29}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1914, "cost": 1, "resetAt": "2021-11-01T14:20:25Z"}}}