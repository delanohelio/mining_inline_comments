{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTAxNTE3Mzg5", "number": 8646, "title": "Update webhook endpoints to support `SCM_NAME`", "bodyText": "Issue: #8170\nDescription:\n\nadded support for query param SCM_NAME. The param can be specified multiple times.\nthe names if received will be mapped w.r.t. schedulable pluggable scm materials - if matched, a MDU will be triggered fr the same.\nthe none-matches will be silently ignored\nfixed the broken bitbucket authentication\n\nTODO\n\n Test for Github\n Test for Gitlab\n Test for Bitbucket cloud\n Update docs. (gocd/api.go.cd#817)", "createdAt": "2020-10-12T11:34:22Z", "url": "https://github.com/gocd/gocd/pull/8646", "merged": true, "mergeCommit": {"oid": "8c5f5d13e5970f00615049d7c61aee195f1a7484"}, "closed": true, "closedAt": "2020-10-13T06:10:58Z", "author": {"login": "kritika-singh3"}, "timelineItems": {"totalCount": 7, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdSBClaABqjM4NjkyNDI2MDc=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdSB1gMgBqjM4NjkzNjQzODI=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "fe52ff288caba83f5020e49d402f0affe08ce74d", "author": {"user": {"login": "kritika-singh3", "name": "Kritika"}}, "url": "https://github.com/gocd/gocd/commit/fe52ff288caba83f5020e49d402f0affe08ce74d", "committedDate": "2020-10-12T11:31:50Z", "message": "Update webhook endpoints to support `SCM_NAME`\n\n - added support for query param `SCM_NAME`. The param can be specified multiple times.\n - the names if received will be mapped w.r.t. schedulable pluggable scm materials - if matched, a MDU will be triggered fr the same.\n - the none-matches will be silently ignored"}, "afterCommit": {"oid": "4d7824676191816418e7eaa2a177e58a175ef46e", "author": {"user": {"login": "kritika-singh3", "name": "Kritika"}}, "url": "https://github.com/gocd/gocd/commit/4d7824676191816418e7eaa2a177e58a175ef46e", "committedDate": "2020-10-13T04:40:23Z", "message": "Fix the bitbucket authentication check: we accept token as user but were checking with password which lead to no token provided error"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTA3MDcyOTYw", "url": "https://github.com/gocd/gocd/pull/8646#pullrequestreview-507072960", "createdAt": "2020-10-13T05:11:00Z", "commit": {"oid": "4d7824676191816418e7eaa2a177e58a175ef46e"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xM1QwNToxMTowMFrOHgVmug==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xM1QwNToxMTowMFrOHgVmug==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMzY3MDQ1OA==", "bodyText": "Wouldn't this take the username and not the personal token?", "url": "https://github.com/gocd/gocd/pull/8646#discussion_r503670458", "createdAt": "2020-10-13T05:11:00Z", "author": {"login": "marques-work"}, "path": "api/api-webhook-v1/src/main/java/com/thoughtworks/go/apiv1/webhook/request/mixins/bitbucketcloud/BitBucketCloudAuth.java", "diffHunk": "@@ -63,7 +63,7 @@ private String getTokenFromHeader(Request request) {\n             }\n \n             String encodedCredentials = new String(Base64.getDecoder().decode(credentials), UTF_8);\n-            return encodedCredentials.contains(\":\") ? split(encodedCredentials, \":\", 2)[1] : encodedCredentials;\n+            return encodedCredentials.contains(\":\") ? split(encodedCredentials, \":\", 2)[0] : encodedCredentials;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "4d7824676191816418e7eaa2a177e58a175ef46e"}, "originalPosition": 5}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTA3MDc0MjUz", "url": "https://github.com/gocd/gocd/pull/8646#pullrequestreview-507074253", "createdAt": "2020-10-13T05:14:58Z", "commit": {"oid": "4d7824676191816418e7eaa2a177e58a175ef46e"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xM1QwNToxNDo1OFrOHgVq6w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xM1QwNToxNDo1OFrOHgVq6w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMzY3MTUzMQ==", "bodyText": "This isn't wrong, but isn't this more simply new String[]{\"scm1\"}?", "url": "https://github.com/gocd/gocd/pull/8646#discussion_r503671531", "createdAt": "2020-10-13T05:14:58Z", "author": {"login": "marques-work"}, "path": "api/api-webhook-v1/src/test/groovy/com/thoughtworks/go/apiv1/webhook/request/push/BitBucketCloudPushRequestTest.java", "diffHunk": "@@ -93,6 +96,26 @@ void shouldGuessTheWebhookUrls(String body) {\n                 );\n     }\n \n+    @ParameterizedTest\n+    @FileSource(files = \"/bitbucket-payload.json\")\n+    void shouldReturnScmNameIfAny(String body) {\n+        Request request = newRequestWithAuthorizationHeader(\"repo:push\", \"\", body);\n+\n+        BitBucketCloudPushRequest bitBucketCloudPushRequest = new BitBucketCloudPushRequest(request);\n+        QueryParamsMap map = mock(QueryParamsMap.class);\n+        when(request.queryMap()).thenReturn(map);\n+        when(map.hasKey(KEY_SCM_NAME)).thenReturn(false);\n+        assertThat(bitBucketCloudPushRequest.getScmNames()).isEmpty();\n+\n+        when(request.queryMap()).thenReturn(map);\n+        when(map.hasKey(KEY_SCM_NAME)).thenReturn(true);\n+\n+        QueryParamsMap value = mock(QueryParamsMap.class);\n+        when(map.get(KEY_SCM_NAME)).thenReturn(value);\n+        when(value.values()).thenReturn(singletonList(\"scm1\").toArray(new String[]{}));", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "4d7824676191816418e7eaa2a177e58a175ef46e"}, "originalPosition": 35}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTA3MDc5Njgz", "url": "https://github.com/gocd/gocd/pull/8646#pullrequestreview-507079683", "createdAt": "2020-10-13T05:31:03Z", "commit": {"oid": "4d7824676191816418e7eaa2a177e58a175ef46e"}, "state": "COMMENTED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a556e479b927c9f6657bdab73ab317fad34b9b35", "author": {"user": {"login": "kritika-singh3", "name": "Kritika"}}, "url": "https://github.com/gocd/gocd/commit/a556e479b927c9f6657bdab73ab317fad34b9b35", "committedDate": "2020-10-13T05:35:59Z", "message": "Update webhook endpoints to support `SCM_NAME`\n\n - added support for query param `SCM_NAME`. The param can be specified multiple times.\n - the names if received will be mapped w.r.t. schedulable pluggable scm materials - if matched, a MDU will be triggered fr the same.\n - the none-matches will be silently ignored"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "4ff35b24f6fd8e4e652ed950c2f56ce7f5ca2aed", "author": {"user": {"login": "kritika-singh3", "name": "Kritika"}}, "url": "https://github.com/gocd/gocd/commit/4ff35b24f6fd8e4e652ed950c2f56ce7f5ca2aed", "committedDate": "2020-10-13T05:35:59Z", "message": "Fix the bitbucket authentication check: we accept token as user but were checking with password which lead to no token provided error"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "4d7824676191816418e7eaa2a177e58a175ef46e", "author": {"user": {"login": "kritika-singh3", "name": "Kritika"}}, "url": "https://github.com/gocd/gocd/commit/4d7824676191816418e7eaa2a177e58a175ef46e", "committedDate": "2020-10-13T04:40:23Z", "message": "Fix the bitbucket authentication check: we accept token as user but were checking with password which lead to no token provided error"}, "afterCommit": {"oid": "4ff35b24f6fd8e4e652ed950c2f56ce7f5ca2aed", "author": {"user": {"login": "kritika-singh3", "name": "Kritika"}}, "url": "https://github.com/gocd/gocd/commit/4ff35b24f6fd8e4e652ed950c2f56ce7f5ca2aed", "committedDate": "2020-10-13T05:35:59Z", "message": "Fix the bitbucket authentication check: we accept token as user but were checking with password which lead to no token provided error"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1798, "cost": 1, "resetAt": "2021-11-01T14:20:25Z"}}}