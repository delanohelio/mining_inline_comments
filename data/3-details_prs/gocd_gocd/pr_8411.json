{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDYyMDI2MDEw", "number": 8411, "title": "Implement Permissions for Config Repository Material Test Connection", "bodyText": "Implement Permissions for Config Repository Material Test Connection\n\n\nIntroduce config repo material test connection API\n\nIntroduce AbstractMaterialTestController which contains a controller method to verify check connection.\nUse the AbstractMaterialTestController in InternalMaterialTestControllerV1 and ConfigReposControllerV4.\n\n\n\nAllow only admins and pipeline group admins to perform check connection on pipeline materials.\n\nThis commit brings back the authorization check to allow only super admin and group admin users to perform material check connection.\n\n\n\nAllow users to perform config repo check connection when user can administer config repo.\n\n\nContext:\n\n\nPrior to GoCD release v20.6.0, GoCD had a common material check connection API to perform material test for pipeline as well as config repo materials.\n\n\nAs part of GoCD release v20.2.0, GoCD added support for granular auth on config repositories. Which in turn required users with granular auth on config repositories to perform material test connection.\n\n\nDue to implementation complexities to allow users with access to config repos to perform material test on such config repo materials, was not possible, hence, the material test connection API was made accessible for all authenticated GoCD users (in GoCD release v20.2.0).\n\n\nThis PR allows pipeline material check connection to be performed by super admin and group admin users; And config repo material check connection to be performed by users who can administer config repo.", "createdAt": "2020-08-03T08:19:14Z", "url": "https://github.com/gocd/gocd/pull/8411", "merged": true, "mergeCommit": {"oid": "56b74176c42da89211f1efbe4769d24e419ef9df"}, "closed": true, "closedAt": "2020-08-04T22:42:11Z", "author": {"login": "GaneshSPatil"}, "timelineItems": {"totalCount": 7, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABc7Mbv5gH2gAyNDYyMDI2MDEwOmYwZGIxOTExZTE1ZjYyM2ZhNDA5NDkwYjA3MDQ1Zjc5ODgwNjY2NTc=", "endCursor": "Y3Vyc29yOnYyOpPPAAABc7eTo4gH2gAyNDYyMDI2MDEwOmViYTMzMGUzNjAwY2QxODRjZTRhYTQzYzdjMGYzYzM2ODQ4MTIxNWM=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "f0db1911e15f623fa409490b07045f7988066657", "author": {"user": {"login": "GaneshSPatil", "name": "Ganesh S Patil"}}, "url": "https://github.com/gocd/gocd/commit/f0db1911e15f623fa409490b07045f7988066657", "committedDate": "2020-08-03T06:56:47Z", "message": "Introduce config repo material test connection API\n\n* Introduce AbstractMaterialTestController which contains a controller\n  method to verify check connection.\n\n* Use the AbstractMaterialTestController in InternalMaterialTestControllerV1\n  and ConfigReposControllerV4."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "02e164633cb61d6cfe05d4a0bed285e79e39b8f2", "author": {"user": {"login": "GaneshSPatil", "name": "Ganesh S Patil"}}, "url": "https://github.com/gocd/gocd/commit/02e164633cb61d6cfe05d4a0bed285e79e39b8f2", "committedDate": "2020-08-03T06:56:51Z", "message": "Allow only admins and pipeline group admins to perform check connection on pipeline materials.\n\nContext:\n\n* Prior to GoCD release v20.6.0, GoCD had a common material check connection\n  API to perform material test for pipeline as well as config repo materials.\n\n* As part of GoCD release v20.2.0, GoCD added support for granular auth on\n  config repositories. Which in turn required users with granular auth on\n  config repositories to perform material test connection.\n\n* Due to implementation complexities to allow users with access to config\n  repos to perform material test on such config repo materials, was not possible,\n  hence, the material test connection API was made accessible for all\n  authenticated GoCD users (in GoCD release v20.2.0).\n\nChangeset:\n\n* This commit brings back the authorization check to allow only super admin\n  and group admin users to perform material check connection."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "cffbe4534d0a9a8b106eceb2272c2aaf599cc68f", "author": {"user": {"login": "GaneshSPatil", "name": "Ganesh S Patil"}}, "url": "https://github.com/gocd/gocd/commit/cffbe4534d0a9a8b106eceb2272c2aaf599cc68f", "committedDate": "2020-08-03T08:56:48Z", "message": "Use config repos material test connection API on SPA"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "529b550ecd5cd3b36b3c0ef3fd3164f8c93e7866", "author": {"user": {"login": "GaneshSPatil", "name": "Ganesh S Patil"}}, "url": "https://github.com/gocd/gocd/commit/529b550ecd5cd3b36b3c0ef3fd3164f8c93e7866", "committedDate": "2020-08-03T08:14:47Z", "message": "Use config repos material test connection API on SPA"}, "afterCommit": {"oid": "cffbe4534d0a9a8b106eceb2272c2aaf599cc68f", "author": {"user": {"login": "GaneshSPatil", "name": "Ganesh S Patil"}}, "url": "https://github.com/gocd/gocd/commit/cffbe4534d0a9a8b106eceb2272c2aaf599cc68f", "committedDate": "2020-08-03T08:56:48Z", "message": "Use config repos material test connection API on SPA"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDYwMDc5Mzc0", "url": "https://github.com/gocd/gocd/pull/8411#pullrequestreview-460079374", "createdAt": "2020-08-03T14:34:51Z", "commit": {"oid": "f0db1911e15f623fa409490b07045f7988066657"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0wM1QxNDozNDo1MVrOG68Bdw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0wM1QxNDozNDo1MVrOG68Bdw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NDQ1NDAwNw==", "bodyText": "Are you planning to document the test connection endpoint? I remember there was a conversation earlier if we should document the test connection API or keep it internal. I think it was decided to keep it internal as the assumption was it will be used only on the SPA. If we are planning to keep it internal we should not add the endpoint in this controller.", "url": "https://github.com/gocd/gocd/pull/8411#discussion_r464454007", "createdAt": "2020-08-03T14:34:51Z", "author": {"login": "maheshp"}, "path": "api/api-config-repos-v4/src/main/java/com/thoughtworks/go/apiv4/configrepos/ConfigReposControllerV4.java", "diffHunk": "@@ -57,16 +57,18 @@\n \n @ToggleRegisterLatest(controllerPath = Routes.ConfigRepos.BASE, apiVersion = ApiVersion.v4, as = \"branch_support\")\n @Component\n-public class ConfigReposControllerV4 extends ApiController implements SparkSpringController, CrudController<ConfigRepoConfig> {\n+public class ConfigReposControllerV4 extends AbstractMaterialTestController implements SparkSpringController, CrudController<ConfigRepoConfig> {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f0db1911e15f623fa409490b07045f7988066657"}, "originalPosition": 37}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "fed8a7769b7d3482ae829d8c39a6f97c2831219f", "author": {"user": {"login": "GaneshSPatil", "name": "Ganesh S Patil"}}, "url": "https://github.com/gocd/gocd/commit/fed8a7769b7d3482ae829d8c39a6f97c2831219f", "committedDate": "2020-08-04T03:42:33Z", "message": "Move config repos check connection to internal config repos api"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "eba330e3600cd184ce4aa43c7c0f3c368481215c", "author": {"user": {"login": "GaneshSPatil", "name": "Ganesh S Patil"}}, "url": "https://github.com/gocd/gocd/commit/eba330e3600cd184ce4aa43c7c0f3c368481215c", "committedDate": "2020-08-04T03:46:13Z", "message": "Use config repos internal test connection api on the spa"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1844, "cost": 1, "resetAt": "2021-11-01T14:20:25Z"}}}