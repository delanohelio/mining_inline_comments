{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTAxNjEyNjY0", "number": 3159, "reviewThreads": {"totalCount": 44, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xM1QwOTozMTo0MVrOEs84lA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xNFQxNTozNjoyNFrOEti3Dw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzE1NTcwMzI0OnYy", "diffSide": "RIGHT", "path": "drools-alphanetwork-compiler/pom.xml", "isResolved": true, "comments": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xM1QwOTozMTo0MVrOHgd5hA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xNFQwODozNTozMlrOHhIPcQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMzgwNjM0MA==", "bodyText": "Will we have OSGi bundle for ANC? I thought that new/optional modules will not be OSGi bundle. But if it's intentional, of course, it's fine.", "url": "https://github.com/kiegroup/drools/pull/3159#discussion_r503806340", "createdAt": "2020-10-13T09:31:41Z", "author": {"login": "tkobayas"}, "path": "drools-alphanetwork-compiler/pom.xml", "diffHunk": "@@ -0,0 +1,142 @@\n+<?xml version=\"1.0\" encoding=\"UTF-8\"?>\n+<project xmlns=\"http://maven.apache.org/POM/4.0.0\"\n+         xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\"\n+         xsi:schemaLocation=\"http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd\">\n+  <parent>\n+    <artifactId>drools</artifactId>\n+    <groupId>org.drools</groupId>\n+    <version>7.45.0-SNAPSHOT</version>\n+  </parent>\n+  <modelVersion>4.0.0</modelVersion>\n+\n+  <artifactId>drools-alphanetwork-compiler</artifactId>\n+\n+  <packaging>bundle</packaging><!-- bundle = jar + OSGi metadata -->", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c51fa98beb73ec23d0ded4482d1bfcacad30c750"}, "originalPosition": 14}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNDQ2MDgwOQ==", "bodyText": "Yes you're right, I removed this", "url": "https://github.com/kiegroup/drools/pull/3159#discussion_r504460809", "createdAt": "2020-10-14T07:31:13Z", "author": {"login": "lucamolteni"}, "path": "drools-alphanetwork-compiler/pom.xml", "diffHunk": "@@ -0,0 +1,142 @@\n+<?xml version=\"1.0\" encoding=\"UTF-8\"?>\n+<project xmlns=\"http://maven.apache.org/POM/4.0.0\"\n+         xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\"\n+         xsi:schemaLocation=\"http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd\">\n+  <parent>\n+    <artifactId>drools</artifactId>\n+    <groupId>org.drools</groupId>\n+    <version>7.45.0-SNAPSHOT</version>\n+  </parent>\n+  <modelVersion>4.0.0</modelVersion>\n+\n+  <artifactId>drools-alphanetwork-compiler</artifactId>\n+\n+  <packaging>bundle</packaging><!-- bundle = jar + OSGi metadata -->", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMzgwNjM0MA=="}, "originalCommit": {"oid": "c51fa98beb73ec23d0ded4482d1bfcacad30c750"}, "originalPosition": 14}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNDQ3MDAzMA==", "bodyText": "After checking again, it seems like I put the OSGi bundle also in drools-traits (albeit with wrong package, will fix) and @mariofusco did the same in drools-mvel so let's put it in here for uniformity", "url": "https://github.com/kiegroup/drools/pull/3159#discussion_r504470030", "createdAt": "2020-10-14T07:47:40Z", "author": {"login": "lucamolteni"}, "path": "drools-alphanetwork-compiler/pom.xml", "diffHunk": "@@ -0,0 +1,142 @@\n+<?xml version=\"1.0\" encoding=\"UTF-8\"?>\n+<project xmlns=\"http://maven.apache.org/POM/4.0.0\"\n+         xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\"\n+         xsi:schemaLocation=\"http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd\">\n+  <parent>\n+    <artifactId>drools</artifactId>\n+    <groupId>org.drools</groupId>\n+    <version>7.45.0-SNAPSHOT</version>\n+  </parent>\n+  <modelVersion>4.0.0</modelVersion>\n+\n+  <artifactId>drools-alphanetwork-compiler</artifactId>\n+\n+  <packaging>bundle</packaging><!-- bundle = jar + OSGi metadata -->", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMzgwNjM0MA=="}, "originalCommit": {"oid": "c51fa98beb73ec23d0ded4482d1bfcacad30c750"}, "originalPosition": 14}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNDUwMDA4MQ==", "bodyText": "@lucamolteni drools-mvel and drools-serialization-protobuf are OSGi compatible (they have to be otherwise I'd broke all existing OSGi usages). I agree that both this module and the traits one shouldn't support OSGi (at least for now) so using the bundle packaging here is at least misleading, if not wrong. I suggest to remove it.", "url": "https://github.com/kiegroup/drools/pull/3159#discussion_r504500081", "createdAt": "2020-10-14T08:35:32Z", "author": {"login": "mariofusco"}, "path": "drools-alphanetwork-compiler/pom.xml", "diffHunk": "@@ -0,0 +1,142 @@\n+<?xml version=\"1.0\" encoding=\"UTF-8\"?>\n+<project xmlns=\"http://maven.apache.org/POM/4.0.0\"\n+         xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\"\n+         xsi:schemaLocation=\"http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd\">\n+  <parent>\n+    <artifactId>drools</artifactId>\n+    <groupId>org.drools</groupId>\n+    <version>7.45.0-SNAPSHOT</version>\n+  </parent>\n+  <modelVersion>4.0.0</modelVersion>\n+\n+  <artifactId>drools-alphanetwork-compiler</artifactId>\n+\n+  <packaging>bundle</packaging><!-- bundle = jar + OSGi metadata -->", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMzgwNjM0MA=="}, "originalCommit": {"oid": "c51fa98beb73ec23d0ded4482d1bfcacad30c750"}, "originalPosition": 14}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzE1NTcxNjEyOnYy", "diffSide": "RIGHT", "path": "drools-model/drools-model-compiler/src/test/java/org/drools/modelcompiler/BaseModelTest.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xM1QwOTozNDo1MFrOHgeBZg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xM1QwOTozNDo1MFrOHgeBZg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMzgwODM1OA==", "bodyText": "It's better to change the variable name from \"kproj\"? (e.g. to \"model\")", "url": "https://github.com/kiegroup/drools/pull/3159#discussion_r503808358", "createdAt": "2020-10-13T09:34:50Z", "author": {"login": "tkobayas"}, "path": "drools-model/drools-model-compiler/src/test/java/org/drools/modelcompiler/BaseModelTest.java", "diffHunk": "@@ -210,7 +215,7 @@ public KieFile( String path, String content ) {\n \n     private KieModuleModel getKieModuleModelWithAlphaNetworkCompiler() {\n         KieModuleModel kproj = KieServices.get().newKieModuleModel();\n-        kproj.setConfigurationProperty( org.drools.compiler.kie.builder.impl.KieContainerImpl.ALPHA_NETWORK_COMPILER_OPTION, \"true\" );\n+        kproj.setConfigurationProperty(AlphaNetworkCompilerOption.PROPERTY_NAME, AlphaNetworkCompilerOption.INMEMORY.toString());\n         return kproj;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c51fa98beb73ec23d0ded4482d1bfcacad30c750"}, "originalPosition": 34}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzE1NTcxODcyOnYy", "diffSide": "RIGHT", "path": "drools-alphanetwork-compiler/src/test/java/org/drools/ancompiler/BaseModelTest.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xM1QwOTozNToyMVrOHgeC4w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xM1QwOTozNToyMVrOHgeC4w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMzgwODczOQ==", "bodyText": "It's better to change the variable name from \"kproj\"? (e.g. to \"model\")", "url": "https://github.com/kiegroup/drools/pull/3159#discussion_r503808739", "createdAt": "2020-10-13T09:35:21Z", "author": {"login": "tkobayas"}, "path": "drools-alphanetwork-compiler/src/test/java/org/drools/ancompiler/BaseModelTest.java", "diffHunk": "@@ -0,0 +1,216 @@\n+/*\n+ * Copyright 2005 JBoss Inc\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *      http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package org.drools.ancompiler;\n+\n+import java.util.List;\n+import java.util.UUID;\n+import java.util.stream.Collectors;\n+\n+import org.drools.compiler.kie.builder.impl.DrlProject;\n+import org.drools.compiler.kie.builder.impl.InternalKieModule;\n+import org.drools.core.impl.InternalKnowledgeBase;\n+import org.drools.core.reteoo.ObjectTypeNode;\n+import org.drools.core.reteoo.Rete;\n+import org.drools.modelcompiler.ExecutableModelFlowProject;\n+import org.drools.modelcompiler.ExecutableModelProject;\n+import org.junit.runner.RunWith;\n+import org.junit.runners.Parameterized;\n+import org.junit.runners.Parameterized.Parameters;\n+import org.kie.api.KieServices;\n+import org.kie.api.builder.KieBuilder;\n+import org.kie.api.builder.KieFileSystem;\n+import org.kie.api.builder.Message;\n+import org.kie.api.builder.ReleaseId;\n+import org.kie.api.builder.model.KieModuleModel;\n+import org.kie.api.runtime.ClassObjectFilter;\n+import org.kie.api.runtime.KieContainer;\n+import org.kie.api.runtime.KieSession;\n+import org.kie.internal.builder.conf.AlphaNetworkCompilerOption;\n+\n+import static java.util.Arrays.asList;\n+import static org.junit.Assert.assertTrue;\n+import static org.junit.Assert.fail;\n+\n+@RunWith(Parameterized.class)\n+public abstract class BaseModelTest {\n+    public enum RUN_TYPE {\n+        FLOW_DSL( false ),\n+        PATTERN_DSL( false ),\n+        STANDARD_FROM_DRL( false ),\n+        STANDARD_WITH_ALPHA_NETWORK( true ),\n+        PATTERN_WITH_ALPHA_NETWORK( true ),\n+        FLOW_WITH_ALPHA_NETWORK( true );\n+\n+        private boolean alphaNetworkCompiler;\n+\n+        RUN_TYPE( boolean isAlphaNetworkCompiler ) {\n+            this.alphaNetworkCompiler = isAlphaNetworkCompiler;\n+        }\n+\n+        public boolean isAlphaNetworkCompiler() {\n+            return alphaNetworkCompiler;\n+        }\n+    }\n+\n+\n+    final static Object[] WITH_ALPHA_NETWORK = {\n+            RUN_TYPE.STANDARD_FROM_DRL,\n+            RUN_TYPE.FLOW_DSL,\n+            RUN_TYPE.PATTERN_DSL,\n+            RUN_TYPE.STANDARD_WITH_ALPHA_NETWORK,\n+            RUN_TYPE.PATTERN_WITH_ALPHA_NETWORK,\n+            RUN_TYPE.FLOW_WITH_ALPHA_NETWORK,\n+    };\n+\n+    @Parameters(name = \"{0}\")\n+    public static Object[] params() {\n+        return WITH_ALPHA_NETWORK;\n+    }\n+\n+    protected final RUN_TYPE testRunType;\n+\n+    public BaseModelTest(RUN_TYPE testRunType ) {\n+        this.testRunType = testRunType;\n+    }\n+\n+    protected KieSession getKieSession(String... rules) {\n+        KieModuleModel kproj = testRunType.isAlphaNetworkCompiler() ? getKieModuleModelWithAlphaNetworkCompiler() : null;\n+        return getKieSession(kproj, rules);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c51fa98beb73ec23d0ded4482d1bfcacad30c750"}, "originalPosition": 92}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzE1NTcyMDQ0OnYy", "diffSide": "RIGHT", "path": "drools-alphanetwork-compiler/src/test/java/org/drools/ancompiler/BaseModelTest.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xM1QwOTozNTo0MlrOHgeD6A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xM1QwOTozNTo0MlrOHgeD6A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMzgwOTAwMA==", "bodyText": "It's better to change the variable name from \"kproj\"? (e.g. to \"model\")", "url": "https://github.com/kiegroup/drools/pull/3159#discussion_r503809000", "createdAt": "2020-10-13T09:35:42Z", "author": {"login": "tkobayas"}, "path": "drools-alphanetwork-compiler/src/test/java/org/drools/ancompiler/BaseModelTest.java", "diffHunk": "@@ -0,0 +1,216 @@\n+/*\n+ * Copyright 2005 JBoss Inc\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *      http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package org.drools.ancompiler;\n+\n+import java.util.List;\n+import java.util.UUID;\n+import java.util.stream.Collectors;\n+\n+import org.drools.compiler.kie.builder.impl.DrlProject;\n+import org.drools.compiler.kie.builder.impl.InternalKieModule;\n+import org.drools.core.impl.InternalKnowledgeBase;\n+import org.drools.core.reteoo.ObjectTypeNode;\n+import org.drools.core.reteoo.Rete;\n+import org.drools.modelcompiler.ExecutableModelFlowProject;\n+import org.drools.modelcompiler.ExecutableModelProject;\n+import org.junit.runner.RunWith;\n+import org.junit.runners.Parameterized;\n+import org.junit.runners.Parameterized.Parameters;\n+import org.kie.api.KieServices;\n+import org.kie.api.builder.KieBuilder;\n+import org.kie.api.builder.KieFileSystem;\n+import org.kie.api.builder.Message;\n+import org.kie.api.builder.ReleaseId;\n+import org.kie.api.builder.model.KieModuleModel;\n+import org.kie.api.runtime.ClassObjectFilter;\n+import org.kie.api.runtime.KieContainer;\n+import org.kie.api.runtime.KieSession;\n+import org.kie.internal.builder.conf.AlphaNetworkCompilerOption;\n+\n+import static java.util.Arrays.asList;\n+import static org.junit.Assert.assertTrue;\n+import static org.junit.Assert.fail;\n+\n+@RunWith(Parameterized.class)\n+public abstract class BaseModelTest {\n+    public enum RUN_TYPE {\n+        FLOW_DSL( false ),\n+        PATTERN_DSL( false ),\n+        STANDARD_FROM_DRL( false ),\n+        STANDARD_WITH_ALPHA_NETWORK( true ),\n+        PATTERN_WITH_ALPHA_NETWORK( true ),\n+        FLOW_WITH_ALPHA_NETWORK( true );\n+\n+        private boolean alphaNetworkCompiler;\n+\n+        RUN_TYPE( boolean isAlphaNetworkCompiler ) {\n+            this.alphaNetworkCompiler = isAlphaNetworkCompiler;\n+        }\n+\n+        public boolean isAlphaNetworkCompiler() {\n+            return alphaNetworkCompiler;\n+        }\n+    }\n+\n+\n+    final static Object[] WITH_ALPHA_NETWORK = {\n+            RUN_TYPE.STANDARD_FROM_DRL,\n+            RUN_TYPE.FLOW_DSL,\n+            RUN_TYPE.PATTERN_DSL,\n+            RUN_TYPE.STANDARD_WITH_ALPHA_NETWORK,\n+            RUN_TYPE.PATTERN_WITH_ALPHA_NETWORK,\n+            RUN_TYPE.FLOW_WITH_ALPHA_NETWORK,\n+    };\n+\n+    @Parameters(name = \"{0}\")\n+    public static Object[] params() {\n+        return WITH_ALPHA_NETWORK;\n+    }\n+\n+    protected final RUN_TYPE testRunType;\n+\n+    public BaseModelTest(RUN_TYPE testRunType ) {\n+        this.testRunType = testRunType;\n+    }\n+\n+    protected KieSession getKieSession(String... rules) {\n+        KieModuleModel kproj = testRunType.isAlphaNetworkCompiler() ? getKieModuleModelWithAlphaNetworkCompiler() : null;\n+        return getKieSession(kproj, rules);\n+    }\n+\n+    protected KieSession getKieSession(KieModuleModel model, String... stringRules) {\n+        return getKieContainer( model, stringRules ).newKieSession();\n+    }\n+\n+    protected KieContainer getKieContainer( KieModuleModel model, String... stringRules ) {\n+        return getKieContainer( model, toKieFiles( stringRules ) );\n+    }\n+\n+    protected KieContainer getKieContainer( KieModuleModel model, KieFile... stringRules ) {\n+        KieServices ks = KieServices.get();\n+        ReleaseId releaseId = ks.newReleaseId( \"org.kie\", \"kjar-test-\" + UUID.randomUUID(), \"1.0\" );\n+\n+        KieBuilder kieBuilder = createKieBuilder( ks, model, releaseId, stringRules );\n+        return ks.newKieContainer( releaseId );\n+    }\n+\n+    protected KieBuilder createKieBuilder( String... stringRules ) {\n+        KieServices ks = KieServices.get();\n+        ReleaseId releaseId = ks.newReleaseId( \"org.kie\", \"kjar-test-\" + UUID.randomUUID(), \"1.0\" );\n+        return createKieBuilder( ks, null, releaseId, false, toKieFiles( stringRules ) );\n+    }\n+\n+    protected KieBuilder createKieBuilder( KieServices ks, KieModuleModel model, ReleaseId releaseId, KieFile... stringRules ) {\n+        return createKieBuilder( ks, model, releaseId, true, stringRules );\n+    }\n+\n+    protected KieBuilder createKieBuilder( KieServices ks, KieModuleModel model, ReleaseId releaseId, boolean failIfBuildError, KieFile... stringRules ) {\n+        ks.getRepository().removeKieModule( releaseId );\n+\n+        KieFileSystem kfs = ks.newKieFileSystem();\n+        if ( model != null ) {\n+            kfs.writeKModuleXML( model.toXML() );\n+        }\n+        kfs.writePomXML( KJARUtils.getPom( releaseId ) );\n+        for (int i = 0; i < stringRules.length; i++) {\n+            kfs.write( stringRules[i].path, stringRules[i].content );\n+        }\n+\n+        KieBuilder kieBuilder;\n+        if (asList(RUN_TYPE.FLOW_DSL, RUN_TYPE.FLOW_WITH_ALPHA_NETWORK).contains(testRunType)) {\n+            kieBuilder = ks.newKieBuilder(kfs).buildAll(ExecutableModelFlowProject.class);\n+        } else if (asList(RUN_TYPE.PATTERN_DSL, RUN_TYPE.PATTERN_WITH_ALPHA_NETWORK).contains(testRunType)) {\n+            kieBuilder = ks.newKieBuilder(kfs).buildAll(ExecutableModelProject.class);\n+        } else {\n+            kieBuilder = ks.newKieBuilder(kfs).buildAll(DrlProject.class);\n+        }\n+\n+        if ( failIfBuildError ) {\n+            List<Message> messages = kieBuilder.getResults().getMessages();\n+            if ( !messages.isEmpty() ) {\n+                fail( messages.toString() );\n+            }\n+        }\n+\n+        return kieBuilder;\n+    }\n+\n+    protected KieModuleModel getDefaultKieModuleModel( KieServices ks ) {\n+        KieModuleModel kproj = ks.newKieModuleModel();\n+        kproj.newKieBaseModel( \"kbase\" ).setDefault( true ).newKieSessionModel( \"ksession\" ).setDefault( true );\n+        return kproj;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c51fa98beb73ec23d0ded4482d1bfcacad30c750"}, "originalPosition": 155}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzE1NTcyMTUwOnYy", "diffSide": "RIGHT", "path": "drools-alphanetwork-compiler/src/test/java/org/drools/ancompiler/BaseModelTest.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xM1QwOTozNTo1NlrOHgeEjw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xM1QwOTozNTo1NlrOHgeEjw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMzgwOTE2Nw==", "bodyText": "It's better to change the variable name from \"kproj\"? (e.g. to \"model\")", "url": "https://github.com/kiegroup/drools/pull/3159#discussion_r503809167", "createdAt": "2020-10-13T09:35:56Z", "author": {"login": "tkobayas"}, "path": "drools-alphanetwork-compiler/src/test/java/org/drools/ancompiler/BaseModelTest.java", "diffHunk": "@@ -0,0 +1,216 @@\n+/*\n+ * Copyright 2005 JBoss Inc\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *      http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package org.drools.ancompiler;\n+\n+import java.util.List;\n+import java.util.UUID;\n+import java.util.stream.Collectors;\n+\n+import org.drools.compiler.kie.builder.impl.DrlProject;\n+import org.drools.compiler.kie.builder.impl.InternalKieModule;\n+import org.drools.core.impl.InternalKnowledgeBase;\n+import org.drools.core.reteoo.ObjectTypeNode;\n+import org.drools.core.reteoo.Rete;\n+import org.drools.modelcompiler.ExecutableModelFlowProject;\n+import org.drools.modelcompiler.ExecutableModelProject;\n+import org.junit.runner.RunWith;\n+import org.junit.runners.Parameterized;\n+import org.junit.runners.Parameterized.Parameters;\n+import org.kie.api.KieServices;\n+import org.kie.api.builder.KieBuilder;\n+import org.kie.api.builder.KieFileSystem;\n+import org.kie.api.builder.Message;\n+import org.kie.api.builder.ReleaseId;\n+import org.kie.api.builder.model.KieModuleModel;\n+import org.kie.api.runtime.ClassObjectFilter;\n+import org.kie.api.runtime.KieContainer;\n+import org.kie.api.runtime.KieSession;\n+import org.kie.internal.builder.conf.AlphaNetworkCompilerOption;\n+\n+import static java.util.Arrays.asList;\n+import static org.junit.Assert.assertTrue;\n+import static org.junit.Assert.fail;\n+\n+@RunWith(Parameterized.class)\n+public abstract class BaseModelTest {\n+    public enum RUN_TYPE {\n+        FLOW_DSL( false ),\n+        PATTERN_DSL( false ),\n+        STANDARD_FROM_DRL( false ),\n+        STANDARD_WITH_ALPHA_NETWORK( true ),\n+        PATTERN_WITH_ALPHA_NETWORK( true ),\n+        FLOW_WITH_ALPHA_NETWORK( true );\n+\n+        private boolean alphaNetworkCompiler;\n+\n+        RUN_TYPE( boolean isAlphaNetworkCompiler ) {\n+            this.alphaNetworkCompiler = isAlphaNetworkCompiler;\n+        }\n+\n+        public boolean isAlphaNetworkCompiler() {\n+            return alphaNetworkCompiler;\n+        }\n+    }\n+\n+\n+    final static Object[] WITH_ALPHA_NETWORK = {\n+            RUN_TYPE.STANDARD_FROM_DRL,\n+            RUN_TYPE.FLOW_DSL,\n+            RUN_TYPE.PATTERN_DSL,\n+            RUN_TYPE.STANDARD_WITH_ALPHA_NETWORK,\n+            RUN_TYPE.PATTERN_WITH_ALPHA_NETWORK,\n+            RUN_TYPE.FLOW_WITH_ALPHA_NETWORK,\n+    };\n+\n+    @Parameters(name = \"{0}\")\n+    public static Object[] params() {\n+        return WITH_ALPHA_NETWORK;\n+    }\n+\n+    protected final RUN_TYPE testRunType;\n+\n+    public BaseModelTest(RUN_TYPE testRunType ) {\n+        this.testRunType = testRunType;\n+    }\n+\n+    protected KieSession getKieSession(String... rules) {\n+        KieModuleModel kproj = testRunType.isAlphaNetworkCompiler() ? getKieModuleModelWithAlphaNetworkCompiler() : null;\n+        return getKieSession(kproj, rules);\n+    }\n+\n+    protected KieSession getKieSession(KieModuleModel model, String... stringRules) {\n+        return getKieContainer( model, stringRules ).newKieSession();\n+    }\n+\n+    protected KieContainer getKieContainer( KieModuleModel model, String... stringRules ) {\n+        return getKieContainer( model, toKieFiles( stringRules ) );\n+    }\n+\n+    protected KieContainer getKieContainer( KieModuleModel model, KieFile... stringRules ) {\n+        KieServices ks = KieServices.get();\n+        ReleaseId releaseId = ks.newReleaseId( \"org.kie\", \"kjar-test-\" + UUID.randomUUID(), \"1.0\" );\n+\n+        KieBuilder kieBuilder = createKieBuilder( ks, model, releaseId, stringRules );\n+        return ks.newKieContainer( releaseId );\n+    }\n+\n+    protected KieBuilder createKieBuilder( String... stringRules ) {\n+        KieServices ks = KieServices.get();\n+        ReleaseId releaseId = ks.newReleaseId( \"org.kie\", \"kjar-test-\" + UUID.randomUUID(), \"1.0\" );\n+        return createKieBuilder( ks, null, releaseId, false, toKieFiles( stringRules ) );\n+    }\n+\n+    protected KieBuilder createKieBuilder( KieServices ks, KieModuleModel model, ReleaseId releaseId, KieFile... stringRules ) {\n+        return createKieBuilder( ks, model, releaseId, true, stringRules );\n+    }\n+\n+    protected KieBuilder createKieBuilder( KieServices ks, KieModuleModel model, ReleaseId releaseId, boolean failIfBuildError, KieFile... stringRules ) {\n+        ks.getRepository().removeKieModule( releaseId );\n+\n+        KieFileSystem kfs = ks.newKieFileSystem();\n+        if ( model != null ) {\n+            kfs.writeKModuleXML( model.toXML() );\n+        }\n+        kfs.writePomXML( KJARUtils.getPom( releaseId ) );\n+        for (int i = 0; i < stringRules.length; i++) {\n+            kfs.write( stringRules[i].path, stringRules[i].content );\n+        }\n+\n+        KieBuilder kieBuilder;\n+        if (asList(RUN_TYPE.FLOW_DSL, RUN_TYPE.FLOW_WITH_ALPHA_NETWORK).contains(testRunType)) {\n+            kieBuilder = ks.newKieBuilder(kfs).buildAll(ExecutableModelFlowProject.class);\n+        } else if (asList(RUN_TYPE.PATTERN_DSL, RUN_TYPE.PATTERN_WITH_ALPHA_NETWORK).contains(testRunType)) {\n+            kieBuilder = ks.newKieBuilder(kfs).buildAll(ExecutableModelProject.class);\n+        } else {\n+            kieBuilder = ks.newKieBuilder(kfs).buildAll(DrlProject.class);\n+        }\n+\n+        if ( failIfBuildError ) {\n+            List<Message> messages = kieBuilder.getResults().getMessages();\n+            if ( !messages.isEmpty() ) {\n+                fail( messages.toString() );\n+            }\n+        }\n+\n+        return kieBuilder;\n+    }\n+\n+    protected KieModuleModel getDefaultKieModuleModel( KieServices ks ) {\n+        KieModuleModel kproj = ks.newKieModuleModel();\n+        kproj.newKieBaseModel( \"kbase\" ).setDefault( true ).newKieSessionModel( \"ksession\" ).setDefault( true );\n+        return kproj;\n+    }\n+\n+    public static <T> List<T> getObjectsIntoList(KieSession ksession, Class<T> clazz) {\n+        return (List<T>) ksession.getObjects(new ClassObjectFilter(clazz)).stream().collect(Collectors.toList());\n+    }\n+\n+    protected void createAndDeployJar( KieServices ks, ReleaseId releaseId, String... drls ) {\n+        createAndDeployJar( ks, null, releaseId, drls );\n+    }\n+\n+    protected void createAndDeployJar( KieServices ks, ReleaseId releaseId, KieFile... ruleFiles ) {\n+        createAndDeployJar( ks, null, releaseId, ruleFiles );\n+    }\n+\n+    protected void createAndDeployJar( KieServices ks, KieModuleModel model, ReleaseId releaseId, String... drls ) {\n+        createAndDeployJar( ks, model, releaseId, toKieFiles( drls ) );\n+    }\n+\n+    protected void createAndDeployJar( KieServices ks, KieModuleModel model, ReleaseId releaseId, KieFile... ruleFiles ) {\n+        KieBuilder kieBuilder = createKieBuilder( ks, model, releaseId, ruleFiles );\n+        InternalKieModule kieModule = (InternalKieModule) kieBuilder.getKieModule();\n+        ks.getRepository().addKieModule( kieModule );\n+    }\n+\n+    public static class KieFile {\n+\n+        public final String path;\n+        public final String content;\n+\n+        public KieFile( int index, String content ) {\n+            this( String.format(\"src/main/resources/r%d.drl\", index), content );\n+        }\n+\n+        public KieFile( String path, String content ) {\n+            this.path = path;\n+            this.content = content;\n+        }\n+    }\n+\n+    public KieFile[] toKieFiles(String[] stringRules) {\n+        KieFile[] kieFiles = new KieFile[stringRules.length];\n+        for (int i = 0; i < stringRules.length; i++) {\n+            kieFiles[i] = new KieFile( i, stringRules[i] );\n+        }\n+        return kieFiles;\n+    }\n+\n+    private KieModuleModel getKieModuleModelWithAlphaNetworkCompiler() {\n+        KieModuleModel kproj = KieServices.get().newKieModuleModel();\n+        kproj.setConfigurationProperty(AlphaNetworkCompilerOption.PROPERTY_NAME, AlphaNetworkCompilerOption.INMEMORY.toString());\n+        return kproj;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c51fa98beb73ec23d0ded4482d1bfcacad30c750"}, "originalPosition": 206}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzE2MDE2NTkxOnYy", "diffSide": "RIGHT", "path": "drools-alphanetwork-compiler/pom.xml", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xNFQwODozNjo0MlrOHhISig==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xNFQwODozNjo0MlrOHhISig==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNDUwMDg3NA==", "bodyText": "If you remove the bundle packaging also remove this.", "url": "https://github.com/kiegroup/drools/pull/3159#discussion_r504500874", "createdAt": "2020-10-14T08:36:42Z", "author": {"login": "mariofusco"}, "path": "drools-alphanetwork-compiler/pom.xml", "diffHunk": "@@ -0,0 +1,130 @@\n+<?xml version=\"1.0\" encoding=\"UTF-8\"?>\n+<project xmlns=\"http://maven.apache.org/POM/4.0.0\"\n+         xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\"\n+         xsi:schemaLocation=\"http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd\">\n+  <parent>\n+    <artifactId>drools</artifactId>\n+    <groupId>org.drools</groupId>\n+    <version>7.45.0-SNAPSHOT</version>\n+  </parent>\n+  <modelVersion>4.0.0</modelVersion>\n+\n+  <artifactId>drools-alphanetwork-compiler</artifactId>\n+\n+  <packaging>bundle</packaging><!-- bundle = jar + OSGi metadata -->\n+\n+  <name>Drools :: Alpha Network Compiler</name>\n+\n+  <properties>\n+    <java.module.name>org.drools.core.alphanetworkcompiler</java.module.name>\n+  </properties>\n+\n+  <dependencies>\n+\n+    <dependency>\n+      <groupId>org.drools</groupId>\n+      <artifactId>drools-core</artifactId>\n+    </dependency>\n+\n+    <dependency>\n+      <groupId>org.drools</groupId>\n+      <artifactId>drools-mvel</artifactId>\n+    </dependency>\n+\n+    <dependency>\n+      <groupId>org.drools</groupId>\n+      <artifactId>drools-compiler</artifactId>\n+    </dependency>\n+\n+    <dependency>\n+      <groupId>org.kie</groupId>\n+      <artifactId>kie-api</artifactId>\n+    </dependency>\n+    <dependency>\n+      <groupId>org.kie</groupId>\n+      <artifactId>kie-internal</artifactId>\n+    </dependency>\n+\n+\n+    <!-- Logging -->\n+    <dependency>\n+      <groupId>org.slf4j</groupId>\n+      <artifactId>slf4j-api</artifactId>\n+    </dependency>\n+    <dependency><!-- For unit test logging: configure in src/test/resources/logback-test.xml -->\n+      <groupId>ch.qos.logback</groupId>\n+      <artifactId>logback-classic</artifactId>\n+      <scope>test</scope>\n+    </dependency>\n+    <dependency>\n+      <groupId>org.kie</groupId>\n+      <artifactId>kie-test-util</artifactId>\n+      <scope>test</scope>\n+    </dependency>\n+    <dependency>\n+      <groupId>org.kie</groupId>\n+      <artifactId>kie-memory-compiler</artifactId>\n+      <scope>provided</scope>\n+    </dependency>\n+    <dependency>\n+      <groupId>org.drools</groupId>\n+      <artifactId>drools-model-compiler</artifactId>\n+    </dependency>\n+  </dependencies>\n+\n+  <build>\n+    <resources>\n+      <resource>\n+        <directory>src/main/resources</directory>\n+      </resource>\n+      <resource>\n+        <filtering>true</filtering>\n+        <directory>src/main/filtered-resources</directory>\n+      </resource>\n+    </resources>\n+\n+    <testResources>\n+      <testResource>\n+        <directory>src/test/resources</directory>\n+        <filtering>false</filtering>\n+      </testResource>\n+      <testResource>\n+        <directory>src/test/filtered-resources</directory>\n+        <filtering>true</filtering>\n+      </testResource>\n+    </testResources>\n+\n+\n+    <plugins>\n+      <plugin>\n+        <groupId>org.apache.felix</groupId>", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "2ef8fae363a6c0d1737e62b3e309222ad761e01b"}, "originalPosition": 100}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzE2MDIwNjkzOnYy", "diffSide": "RIGHT", "path": "drools-alphanetwork-compiler/src/main/java/org/drools/ancompiler/KieBaseUpdaterANC.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xNFQwODo0NjoxMVrOHhIqyQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xNFQxMjoyNToyOVrOHhQY-A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNDUwNzA4MQ==", "bodyText": "@lucamolteni for sure I'm missing something but it seems to me that this LOAD option is covering the case when the compiled alpha network is in the kjar so this could be actually replaced with COMPILE. Can you please clarify?", "url": "https://github.com/kiegroup/drools/pull/3159#discussion_r504507081", "createdAt": "2020-10-14T08:46:11Z", "author": {"login": "mariofusco"}, "path": "drools-alphanetwork-compiler/src/main/java/org/drools/ancompiler/KieBaseUpdaterANC.java", "diffHunk": "@@ -0,0 +1,74 @@\n+package org.drools.ancompiler;\n+\n+import java.util.Map;\n+import java.util.Optional;\n+\n+import org.drools.compiler.kie.builder.impl.KieBaseUpdater;\n+import org.drools.compiler.kie.builder.impl.KieBaseUpdatersContext;\n+import org.drools.core.reteoo.Rete;\n+import org.kie.api.conf.Option;\n+import org.kie.internal.builder.conf.AlphaNetworkCompilerOption;\n+import org.kie.memorycompiler.KieMemoryCompiler;\n+import org.slf4j.Logger;\n+import org.slf4j.LoggerFactory;\n+\n+import static org.drools.core.util.MapUtils.mapValues;\n+\n+public class KieBaseUpdaterANC implements KieBaseUpdater {\n+\n+    private final Logger logger = LoggerFactory.getLogger(KieBaseUpdaterANC.class);\n+\n+    private final KieBaseUpdatersContext ctx;\n+\n+    public KieBaseUpdaterANC(KieBaseUpdatersContext ctx) {\n+        this.ctx = ctx;\n+    }\n+\n+    public void run() {\n+        Optional<Option> ancMode = ctx.getOption(AlphaNetworkCompilerOption.class);\n+\n+        // find the new compiled alpha network in the classpath, if it's not there,\n+        // generate compile it and reattach it\n+        if (ancMode.filter(AlphaNetworkCompilerOption.INMEMORY::equals).isPresent()) {\n+            inMemoryUpdate(ctx.getClassLoader(), ctx.getRete());\n+        } // load it from the kjar\n+        else if (ancMode.filter(AlphaNetworkCompilerOption.LOAD::equals).isPresent()) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "2ef8fae363a6c0d1737e62b3e309222ad761e01b"}, "originalPosition": 35}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNDYzMzU5Mg==", "bodyText": "when the drools-anc-compiler file exists, the option LOAD is set, so that the updater listeners doesn't have to depend on the full module\nsee https://github.com/kiegroup/drools/pull/3159/files#diff-947e341bb9ead75ab95767577467570b3a13c9068a09a4255e169050f21343d8R246", "url": "https://github.com/kiegroup/drools/pull/3159#discussion_r504633592", "createdAt": "2020-10-14T12:25:29Z", "author": {"login": "lucamolteni"}, "path": "drools-alphanetwork-compiler/src/main/java/org/drools/ancompiler/KieBaseUpdaterANC.java", "diffHunk": "@@ -0,0 +1,74 @@\n+package org.drools.ancompiler;\n+\n+import java.util.Map;\n+import java.util.Optional;\n+\n+import org.drools.compiler.kie.builder.impl.KieBaseUpdater;\n+import org.drools.compiler.kie.builder.impl.KieBaseUpdatersContext;\n+import org.drools.core.reteoo.Rete;\n+import org.kie.api.conf.Option;\n+import org.kie.internal.builder.conf.AlphaNetworkCompilerOption;\n+import org.kie.memorycompiler.KieMemoryCompiler;\n+import org.slf4j.Logger;\n+import org.slf4j.LoggerFactory;\n+\n+import static org.drools.core.util.MapUtils.mapValues;\n+\n+public class KieBaseUpdaterANC implements KieBaseUpdater {\n+\n+    private final Logger logger = LoggerFactory.getLogger(KieBaseUpdaterANC.class);\n+\n+    private final KieBaseUpdatersContext ctx;\n+\n+    public KieBaseUpdaterANC(KieBaseUpdatersContext ctx) {\n+        this.ctx = ctx;\n+    }\n+\n+    public void run() {\n+        Optional<Option> ancMode = ctx.getOption(AlphaNetworkCompilerOption.class);\n+\n+        // find the new compiled alpha network in the classpath, if it's not there,\n+        // generate compile it and reattach it\n+        if (ancMode.filter(AlphaNetworkCompilerOption.INMEMORY::equals).isPresent()) {\n+            inMemoryUpdate(ctx.getClassLoader(), ctx.getRete());\n+        } // load it from the kjar\n+        else if (ancMode.filter(AlphaNetworkCompilerOption.LOAD::equals).isPresent()) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNDUwNzA4MQ=="}, "originalCommit": {"oid": "2ef8fae363a6c0d1737e62b3e309222ad761e01b"}, "originalPosition": 35}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzE2MDI4Njc0OnYy", "diffSide": "RIGHT", "path": "drools-compiler/src/main/java/org/drools/compiler/kie/builder/impl/MemoryKieModule.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xNFQwOTowNDoyN1rOHhJbdw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xNFQwOTowNDoyN1rOHhJbdw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNDUxOTU0Mw==", "bodyText": "It seems you're creating this variable but never using it.", "url": "https://github.com/kiegroup/drools/pull/3159#discussion_r504519543", "createdAt": "2020-10-14T09:04:27Z", "author": {"login": "mariofusco"}, "path": "drools-compiler/src/main/java/org/drools/compiler/kie/builder/impl/MemoryKieModule.java", "diffHunk": "@@ -110,6 +116,33 @@ public long getCreationTimestamp() {\n         return creationTimestamp;\n     }\n \n+    @Override\n+    public void afterKieBaseCreationUpdate(String kBaseName, InternalKnowledgeBase kBase) {\n+        KnowledgeBuilder knowledgeBuilderForKieBase = getKnowledgeBuilderForKieBase(kBaseName);\n+\n+        if(knowledgeBuilderForKieBase instanceof KnowledgeBuilderImpl) {\n+            KnowledgeBuilderImpl knowledgeBuilderForImpl = (KnowledgeBuilderImpl)knowledgeBuilderForKieBase;\n+            KnowledgeBuilderConfigurationImpl builderConfiguration = knowledgeBuilderForImpl.getBuilderConfiguration();\n+\n+            // TODO LUCA ask Mario if we need to enqueue this or we can just run it\n+            KieContainerImpl.CompositeRunnable compositeUpdater = new KieContainerImpl.CompositeRunnable();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "2ef8fae363a6c0d1737e62b3e309222ad761e01b"}, "originalPosition": 36}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzE2MDM4MjgyOnYy", "diffSide": "LEFT", "path": "drools-alphanetwork-compiler/src/main/java/org/drools/ancompiler/CompiledNetwork.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xNFQwOToyODo0NVrOHhKXVA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xNFQxNTo1NjoxN1rOHhaDhg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNDUzNDg2OA==", "bodyText": "Is it possible to reach this code? What about a log.debug?", "url": "https://github.com/kiegroup/drools/pull/3159#discussion_r504534868", "createdAt": "2020-10-14T09:28:45Z", "author": {"login": "danielezonca"}, "path": "drools-alphanetwork-compiler/src/main/java/org/drools/ancompiler/CompiledNetwork.java", "diffHunk": "@@ -65,7 +74,6 @@ public RuleBasePartitionId getPartitionId() {\n      * method of this Externalizable class.\n      */\n     public void writeExternal(ObjectOutput out) throws IOException {\n-        // todo is this needed??", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "2ef8fae363a6c0d1737e62b3e309222ad761e01b"}, "originalPosition": 43}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNDc5MTk0Mg==", "bodyText": "not sure it was there before", "url": "https://github.com/kiegroup/drools/pull/3159#discussion_r504791942", "createdAt": "2020-10-14T15:56:17Z", "author": {"login": "lucamolteni"}, "path": "drools-alphanetwork-compiler/src/main/java/org/drools/ancompiler/CompiledNetwork.java", "diffHunk": "@@ -65,7 +74,6 @@ public RuleBasePartitionId getPartitionId() {\n      * method of this Externalizable class.\n      */\n     public void writeExternal(ObjectOutput out) throws IOException {\n-        // todo is this needed??", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNDUzNDg2OA=="}, "originalCommit": {"oid": "2ef8fae363a6c0d1737e62b3e309222ad761e01b"}, "originalPosition": 43}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzE2MDM4MzIzOnYy", "diffSide": "LEFT", "path": "drools-alphanetwork-compiler/src/main/java/org/drools/ancompiler/CompiledNetwork.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xNFQwOToyODo1MlrOHhKXlA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xNFQwOToyODo1MlrOHhKXlA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNDUzNDkzMg==", "bodyText": "Is it possible to reach this code? What about a log.debug?", "url": "https://github.com/kiegroup/drools/pull/3159#discussion_r504534932", "createdAt": "2020-10-14T09:28:52Z", "author": {"login": "danielezonca"}, "path": "drools-alphanetwork-compiler/src/main/java/org/drools/ancompiler/CompiledNetwork.java", "diffHunk": "@@ -81,22 +89,39 @@ public void writeExternal(ObjectOutput out) throws IOException {\n      *                                restored cannot be found.\n      */\n     public void readExternal(ObjectInput in) throws IOException, ClassNotFoundException {\n-        // todo is this needed??", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "2ef8fae363a6c0d1737e62b3e309222ad761e01b"}, "originalPosition": 51}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzE2MDM5OTkyOnYy", "diffSide": "RIGHT", "path": "drools-alphanetwork-compiler/src/main/java/org/drools/ancompiler/CompiledNetworkSource.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xNFQwOTozMzoxM1rOHhKh6w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xNFQwOTozMzoxM1rOHhKh6w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNDUzNzU3OQ==", "bodyText": "License", "url": "https://github.com/kiegroup/drools/pull/3159#discussion_r504537579", "createdAt": "2020-10-14T09:33:13Z", "author": {"login": "danielezonca"}, "path": "drools-alphanetwork-compiler/src/main/java/org/drools/ancompiler/CompiledNetworkSource.java", "diffHunk": "@@ -0,0 +1,63 @@\n+package org.drools.ancompiler;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "2ef8fae363a6c0d1737e62b3e309222ad761e01b"}, "originalPosition": 1}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzE2MDQwMzc4OnYy", "diffSide": "RIGHT", "path": "drools-alphanetwork-compiler/src/main/java/org/drools/ancompiler/CouldNotCreateAlphaNetworkCompilerException.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xNFQwOTozNDoxOVrOHhKkUw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xNFQwOTozNDoxOVrOHhKkUw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNDUzODE5NQ==", "bodyText": "License", "url": "https://github.com/kiegroup/drools/pull/3159#discussion_r504538195", "createdAt": "2020-10-14T09:34:19Z", "author": {"login": "danielezonca"}, "path": "drools-alphanetwork-compiler/src/main/java/org/drools/ancompiler/CouldNotCreateAlphaNetworkCompilerException.java", "diffHunk": "@@ -0,0 +1,8 @@\n+package org.drools.ancompiler;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "2ef8fae363a6c0d1737e62b3e309222ad761e01b"}, "originalPosition": 1}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzE2MDQxMDU3OnYy", "diffSide": "RIGHT", "path": "drools-alphanetwork-compiler/src/main/java/org/drools/ancompiler/KieBaseUpdaterANC.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xNFQwOTozNTo1NVrOHhKoVg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xNFQwOTozNTo1NVrOHhKoVg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNDUzOTIyMg==", "bodyText": "License", "url": "https://github.com/kiegroup/drools/pull/3159#discussion_r504539222", "createdAt": "2020-10-14T09:35:55Z", "author": {"login": "danielezonca"}, "path": "drools-alphanetwork-compiler/src/main/java/org/drools/ancompiler/KieBaseUpdaterANC.java", "diffHunk": "@@ -0,0 +1,74 @@\n+package org.drools.ancompiler;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "2ef8fae363a6c0d1737e62b3e309222ad761e01b"}, "originalPosition": 1}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzE2MDQxMTUzOnYy", "diffSide": "RIGHT", "path": "drools-alphanetwork-compiler/src/main/java/org/drools/ancompiler/KieBaseUpdaterANCFactory.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xNFQwOTozNjowN1rOHhKo2A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xNFQwOTozNjowN1rOHhKo2A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNDUzOTM1Mg==", "bodyText": "License", "url": "https://github.com/kiegroup/drools/pull/3159#discussion_r504539352", "createdAt": "2020-10-14T09:36:07Z", "author": {"login": "danielezonca"}, "path": "drools-alphanetwork-compiler/src/main/java/org/drools/ancompiler/KieBaseUpdaterANCFactory.java", "diffHunk": "@@ -0,0 +1,13 @@\n+package org.drools.ancompiler;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "2ef8fae363a6c0d1737e62b3e309222ad761e01b"}, "originalPosition": 1}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzE2MDQxODI5OnYy", "diffSide": "RIGHT", "path": "drools-traits/src/main/java/org/drools/traits/core/reteoo/TraitObjectTypeNode.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xNFQwOTozNzo0NVrOHhKs0Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xNFQxNTo1OTo1NlrOHhaOPg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNDU0MDM2OQ==", "bodyText": "Log?", "url": "https://github.com/kiegroup/drools/pull/3159#discussion_r504540369", "createdAt": "2020-10-14T09:37:45Z", "author": {"login": "danielezonca"}, "path": "drools-traits/src/main/java/org/drools/traits/core/reteoo/TraitObjectTypeNode.java", "diffHunk": "@@ -142,29 +142,22 @@ public void modifyObject( InternalFactHandle factHandle,\n \n         checkDirty();\n \n-        if ( compiledNetwork != null ) {\n-            compiledNetwork.modifyObject( factHandle,\n-                    modifyPreviousTuples,\n-                    context.adaptModificationMaskForObjectType( objectType, workingMemory ),\n-                    workingMemory );\n-        } else {\n-            if ( factHandle.isTraiting() )  {\n-                if ( isModifyAllowed( factHandle )  ) {\n-                    this.sink.propagateModifyObject( factHandle,\n-                                                     modifyPreviousTuples,\n-                                                     context.adaptModificationMaskForObjectType( objectType, workingMemory ),\n-                                                     workingMemory );\n-                } else {\n-                    //System.err.println( ((ClassObjectType) this.getObjectType()).getClassName() + \" : MODIFY BLOCK !! \" + ( (TraitProxy) factHandle.getObject() ).getTraitName() + \" \" + ( (TraitProxy) factHandle.getObject() )._getTypeCode() + \" >> \" + \" checks in \" + typeMask );\n-                }\n+        if (factHandle.isTraiting()) {\n+            if (isModifyAllowed(factHandle)) {\n+                this.sink.propagateModifyObject(factHandle,\n+                                                modifyPreviousTuples,\n+                                                context.adaptModificationMaskForObjectType(objectType, workingMemory),\n+                                                workingMemory);\n             } else {\n-                this.sink.propagateModifyObject( factHandle,\n-                                                 modifyPreviousTuples,\n-                                                 !context.getModificationMask().isSet(PropertySpecificUtil.TRAITABLE_BIT) ?\n-                                                        context.adaptModificationMaskForObjectType( objectType, workingMemory ) :\n-                                                        context,\n-                                                 workingMemory );\n+                //System.err.println( ((ClassObjectType) this.getObjectType()).getClassName() + \" : MODIFY BLOCK !! \" + ( (TraitProxy) factHandle.getObject() ).getTraitName() + \" \" + ( (TraitProxy) factHandle.getObject() )._getTypeCode() + \" >> \" + \" checks in \" + typeMask );", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "2ef8fae363a6c0d1737e62b3e309222ad761e01b"}, "originalPosition": 32}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNDc5NDY4Ng==", "bodyText": "not sure it was there before", "url": "https://github.com/kiegroup/drools/pull/3159#discussion_r504794686", "createdAt": "2020-10-14T15:59:56Z", "author": {"login": "lucamolteni"}, "path": "drools-traits/src/main/java/org/drools/traits/core/reteoo/TraitObjectTypeNode.java", "diffHunk": "@@ -142,29 +142,22 @@ public void modifyObject( InternalFactHandle factHandle,\n \n         checkDirty();\n \n-        if ( compiledNetwork != null ) {\n-            compiledNetwork.modifyObject( factHandle,\n-                    modifyPreviousTuples,\n-                    context.adaptModificationMaskForObjectType( objectType, workingMemory ),\n-                    workingMemory );\n-        } else {\n-            if ( factHandle.isTraiting() )  {\n-                if ( isModifyAllowed( factHandle )  ) {\n-                    this.sink.propagateModifyObject( factHandle,\n-                                                     modifyPreviousTuples,\n-                                                     context.adaptModificationMaskForObjectType( objectType, workingMemory ),\n-                                                     workingMemory );\n-                } else {\n-                    //System.err.println( ((ClassObjectType) this.getObjectType()).getClassName() + \" : MODIFY BLOCK !! \" + ( (TraitProxy) factHandle.getObject() ).getTraitName() + \" \" + ( (TraitProxy) factHandle.getObject() )._getTypeCode() + \" >> \" + \" checks in \" + typeMask );\n-                }\n+        if (factHandle.isTraiting()) {\n+            if (isModifyAllowed(factHandle)) {\n+                this.sink.propagateModifyObject(factHandle,\n+                                                modifyPreviousTuples,\n+                                                context.adaptModificationMaskForObjectType(objectType, workingMemory),\n+                                                workingMemory);\n             } else {\n-                this.sink.propagateModifyObject( factHandle,\n-                                                 modifyPreviousTuples,\n-                                                 !context.getModificationMask().isSet(PropertySpecificUtil.TRAITABLE_BIT) ?\n-                                                        context.adaptModificationMaskForObjectType( objectType, workingMemory ) :\n-                                                        context,\n-                                                 workingMemory );\n+                //System.err.println( ((ClassObjectType) this.getObjectType()).getClassName() + \" : MODIFY BLOCK !! \" + ( (TraitProxy) factHandle.getObject() ).getTraitName() + \" \" + ( (TraitProxy) factHandle.getObject() )._getTypeCode() + \" >> \" + \" checks in \" + typeMask );", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNDU0MDM2OQ=="}, "originalCommit": {"oid": "2ef8fae363a6c0d1737e62b3e309222ad761e01b"}, "originalPosition": 32}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzE2MDQyMzc3OnYy", "diffSide": "RIGHT", "path": "drools-model/drools-model-compiler/src/test/resources/logback-test.xml", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xNFQwOTozOToxM1rOHhKwGw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xNFQwOTozOToxM1rOHhKwGw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNDU0MTIxMQ==", "bodyText": "Remember to revert this before merging", "url": "https://github.com/kiegroup/drools/pull/3159#discussion_r504541211", "createdAt": "2020-10-14T09:39:13Z", "author": {"login": "danielezonca"}, "path": "drools-model/drools-model-compiler/src/test/resources/logback-test.xml", "diffHunk": "@@ -11,7 +11,7 @@\n   <logger name=\"org.drools.compiler.kie.builder.impl\" level=\"ERROR\" />\n   <!--<logger name=\"org.drools.modelcompiler.builder.generator.expressiontyper\" level=\"debug\"/>-->\n <!--  <logger name=\"org.drools.modelcompiler.builder\" level=\"debug\"/>-->\n-  <!--<logger name=\"org.drools.compiler.reteoo.compiled\" level=\"debug\"/>-->\n+  <logger name=\"org.drools.ancompiler\" level=\"debug\"/>", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "2ef8fae363a6c0d1737e62b3e309222ad761e01b"}, "originalPosition": 5}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzE2MTU0NzExOnYy", "diffSide": "RIGHT", "path": "drools-alphanetwork-compiler/src/test/java/org/drools/ancompiler/KJARUtils.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xNFQxNDoyMDoyOFrOHhVgPw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xNFQxNDoyMDoyOFrOHhVgPw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNDcxNzM3NQ==", "bodyText": "License", "url": "https://github.com/kiegroup/drools/pull/3159#discussion_r504717375", "createdAt": "2020-10-14T14:20:28Z", "author": {"login": "danielezonca"}, "path": "drools-alphanetwork-compiler/src/test/java/org/drools/ancompiler/KJARUtils.java", "diffHunk": "@@ -0,0 +1,19 @@\n+package org.drools.ancompiler;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "e30d54b8fdc994abac85f49043faee61993e55a4"}, "originalPosition": 1}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzE2MTU0Nzc1OnYy", "diffSide": "RIGHT", "path": "drools-alphanetwork-compiler/src/test/java/org/drools/ancompiler/Person.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xNFQxNDoyMDozNlrOHhVgmQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xNFQxNDoyMDozNlrOHhVgmQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNDcxNzQ2NQ==", "bodyText": "License", "url": "https://github.com/kiegroup/drools/pull/3159#discussion_r504717465", "createdAt": "2020-10-14T14:20:36Z", "author": {"login": "danielezonca"}, "path": "drools-alphanetwork-compiler/src/test/java/org/drools/ancompiler/Person.java", "diffHunk": "@@ -0,0 +1,206 @@\n+package org.drools.ancompiler;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "e30d54b8fdc994abac85f49043faee61993e55a4"}, "originalPosition": 1}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzE2MTU1MDQ0OnYy", "diffSide": "RIGHT", "path": "drools-alphanetwork-compiler/src/test/resources/logback-test.xml", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xNFQxNDoyMToxMFrOHhViOQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xNFQxNDoyMToxMFrOHhViOQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNDcxNzg4MQ==", "bodyText": "To be changed before merging", "url": "https://github.com/kiegroup/drools/pull/3159#discussion_r504717881", "createdAt": "2020-10-14T14:21:10Z", "author": {"login": "danielezonca"}, "path": "drools-alphanetwork-compiler/src/test/resources/logback-test.xml", "diffHunk": "@@ -0,0 +1,20 @@\n+<?xml version=\"1.0\" encoding=\"UTF-8\"?>\n+<configuration>\n+\n+  <appender name=\"consoleAppender\" class=\"ch.qos.logback.core.ConsoleAppender\">\n+    <encoder>\n+      <pattern>%date{HH:mm:ss.SSS} [%thread] %-5level %class{36}.%method:%line - %msg%n</pattern>\n+    </encoder>\n+  </appender>\n+\n+  <logger name=\"org.kie\" level=\"info\"/>\n+  <logger name=\"org.drools.compiler.kie.builder.impl\" level=\"ERROR\" />\n+  <logger name=\"org.drools.ancompiler\" level=\"debug\"/>", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "e30d54b8fdc994abac85f49043faee61993e55a4"}, "originalPosition": 12}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzE2MTU1NjczOnYy", "diffSide": "RIGHT", "path": "drools-compiler/src/main/java/org/drools/compiler/builder/impl/KnowledgeBuilderConfigurationImpl.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xNFQxNDoyMjozMFrOHhVmWg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xNFQxNjowMjowMFrOHhaT_g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNDcxODkzOA==", "bodyText": "Isn't this a fatal error? If user is explicitly asking for AlphaNetworkCompilerOption and it fails to load it I expect we should log and propagate the exception.", "url": "https://github.com/kiegroup/drools/pull/3159#discussion_r504718938", "createdAt": "2020-10-14T14:22:30Z", "author": {"login": "danielezonca"}, "path": "drools-compiler/src/main/java/org/drools/compiler/builder/impl/KnowledgeBuilderConfigurationImpl.java", "diffHunk": "@@ -328,6 +330,12 @@ public void setProperty(String name,\n         \tsetParallelRulesBuildThreshold(Integer.valueOf(value));\n         }  else if (name.equals(ExternaliseCanonicalModelLambdaOption.PROPERTY_NAME)) {\n             setExternaliseCanonicalModelLambda(Boolean.valueOf(value));\n+        } else if (name.equals(AlphaNetworkCompilerOption.PROPERTY_NAME)) {\n+            try {\n+                setAlphaNetworkCompilerOption(AlphaNetworkCompilerOption.determineAlphaNetworkCompilerMode(value.toUpperCase()));\n+            } catch (IllegalArgumentException e) {\n+                log.warn(\"Invalid value \" + value + \" for option \" + LanguageLevelOption.PROPERTY_NAME);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "e30d54b8fdc994abac85f49043faee61993e55a4"}, "originalPosition": 24}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNDc5NjE1OA==", "bodyText": "I'd put the same behaviour as the other options for consistency", "url": "https://github.com/kiegroup/drools/pull/3159#discussion_r504796158", "createdAt": "2020-10-14T16:02:00Z", "author": {"login": "lucamolteni"}, "path": "drools-compiler/src/main/java/org/drools/compiler/builder/impl/KnowledgeBuilderConfigurationImpl.java", "diffHunk": "@@ -328,6 +330,12 @@ public void setProperty(String name,\n         \tsetParallelRulesBuildThreshold(Integer.valueOf(value));\n         }  else if (name.equals(ExternaliseCanonicalModelLambdaOption.PROPERTY_NAME)) {\n             setExternaliseCanonicalModelLambda(Boolean.valueOf(value));\n+        } else if (name.equals(AlphaNetworkCompilerOption.PROPERTY_NAME)) {\n+            try {\n+                setAlphaNetworkCompilerOption(AlphaNetworkCompilerOption.determineAlphaNetworkCompilerMode(value.toUpperCase()));\n+            } catch (IllegalArgumentException e) {\n+                log.warn(\"Invalid value \" + value + \" for option \" + LanguageLevelOption.PROPERTY_NAME);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNDcxODkzOA=="}, "originalCommit": {"oid": "e30d54b8fdc994abac85f49043faee61993e55a4"}, "originalPosition": 24}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzE2MTU2NDgyOnYy", "diffSide": "RIGHT", "path": "drools-compiler/src/main/java/org/drools/compiler/kie/builder/impl/FileKieModule.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xNFQxNDoyNDowM1rOHhVrcQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xNFQxNDoyNDowM1rOHhVrcQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNDcyMDI0MQ==", "bodyText": "Unused import?", "url": "https://github.com/kiegroup/drools/pull/3159#discussion_r504720241", "createdAt": "2020-10-14T14:24:03Z", "author": {"login": "danielezonca"}, "path": "drools-compiler/src/main/java/org/drools/compiler/kie/builder/impl/FileKieModule.java", "diffHunk": "@@ -21,6 +21,7 @@\n import java.io.Serializable;\n import java.util.Collection;\n \n+import org.drools.core.impl.InternalKnowledgeBase;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "e30d54b8fdc994abac85f49043faee61993e55a4"}, "originalPosition": 4}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzE2MTU2NzE3OnYy", "diffSide": "RIGHT", "path": "drools-compiler/src/main/java/org/drools/compiler/kie/builder/impl/KieBaseUpdater.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xNFQxNDoyNDoyOVrOHhVs0w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xNFQxNDoyNDoyOVrOHhVs0w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNDcyMDU5NQ==", "bodyText": "License", "url": "https://github.com/kiegroup/drools/pull/3159#discussion_r504720595", "createdAt": "2020-10-14T14:24:29Z", "author": {"login": "danielezonca"}, "path": "drools-compiler/src/main/java/org/drools/compiler/kie/builder/impl/KieBaseUpdater.java", "diffHunk": "@@ -1,249 +1,6 @@\n-/*\n- * Copyright 2005 JBoss Inc\n- *\n- * Licensed under the Apache License; private final  Version 2.0 (the \"License\");\n- * you may not use this file except in compliance with the License.\n- * You may obtain a copy of the License at\n- *\n- *      http://www.apache.org/licenses/LICENSE-2.0\n- *\n- * Unless required by applicable law or agreed to in writing; private final  software\n- * distributed under the License is distributed on an \"AS IS\" BASIS; private final \n- * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND; private final  either express or implied.\n- * See the License for the specific language governing permissions and\n- * limitations under the License.\n- */\n-\n package org.drools.compiler.kie.builder.impl;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "e30d54b8fdc994abac85f49043faee61993e55a4"}, "originalPosition": 17}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzE2MTU2ODg3OnYy", "diffSide": "RIGHT", "path": "drools-compiler/src/main/java/org/drools/compiler/kie/builder/impl/KieBaseUpdaterFactory.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xNFQxNDoyNDo1MlrOHhVt9A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xNFQxNDoyNDo1MlrOHhVt9A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNDcyMDg4NA==", "bodyText": "License", "url": "https://github.com/kiegroup/drools/pull/3159#discussion_r504720884", "createdAt": "2020-10-14T14:24:52Z", "author": {"login": "danielezonca"}, "path": "drools-compiler/src/main/java/org/drools/compiler/kie/builder/impl/KieBaseUpdaterFactory.java", "diffHunk": "@@ -0,0 +1,6 @@\n+package org.drools.compiler.kie.builder.impl;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "e30d54b8fdc994abac85f49043faee61993e55a4"}, "originalPosition": 1}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzE2MTU4NjU4OnYy", "diffSide": "RIGHT", "path": "drools-compiler/src/main/java/org/drools/compiler/kie/builder/impl/KieBaseUpdaterImplContext.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xNFQxNDoyODoxOFrOHhV4tQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xNFQxNjowMzoyOFrOHhaXgA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNDcyMzYzNw==", "bodyText": "Is this field used somewhere? If so, can you please add a getter?", "url": "https://github.com/kiegroup/drools/pull/3159#discussion_r504723637", "createdAt": "2020-10-14T14:28:18Z", "author": {"login": "danielezonca"}, "path": "drools-compiler/src/main/java/org/drools/compiler/kie/builder/impl/KieBaseUpdaterImplContext.java", "diffHunk": "@@ -54,5 +57,6 @@ public KieBaseUpdateContext( KieProject kProject, InternalKnowledgeBase kBase, I\n         this.results = results;\n         this.newKieBaseModel = newKieBaseModel;\n         this.currentKieBaseModel = currentKieBaseModel;\n+        this.kbuilder = kbuilder;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "e30d54b8fdc994abac85f49043faee61993e55a4"}, "originalPosition": 37}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNDc5NzA1Ng==", "bodyText": "every other field in the context class is set to public", "url": "https://github.com/kiegroup/drools/pull/3159#discussion_r504797056", "createdAt": "2020-10-14T16:03:28Z", "author": {"login": "lucamolteni"}, "path": "drools-compiler/src/main/java/org/drools/compiler/kie/builder/impl/KieBaseUpdaterImplContext.java", "diffHunk": "@@ -54,5 +57,6 @@ public KieBaseUpdateContext( KieProject kProject, InternalKnowledgeBase kBase, I\n         this.results = results;\n         this.newKieBaseModel = newKieBaseModel;\n         this.currentKieBaseModel = currentKieBaseModel;\n+        this.kbuilder = kbuilder;", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNDcyMzYzNw=="}, "originalCommit": {"oid": "e30d54b8fdc994abac85f49043faee61993e55a4"}, "originalPosition": 37}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzE2MTU4NzUwOnYy", "diffSide": "RIGHT", "path": "drools-compiler/src/main/java/org/drools/compiler/kie/builder/impl/KieBaseUpdaterOptions.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xNFQxNDoyODoyN1rOHhV5Rg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xNFQxNDoyODoyN1rOHhV5Rg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNDcyMzc4Mg==", "bodyText": "License", "url": "https://github.com/kiegroup/drools/pull/3159#discussion_r504723782", "createdAt": "2020-10-14T14:28:27Z", "author": {"login": "danielezonca"}, "path": "drools-compiler/src/main/java/org/drools/compiler/kie/builder/impl/KieBaseUpdaterOptions.java", "diffHunk": "@@ -0,0 +1,37 @@\n+package org.drools.compiler.kie.builder.impl;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "e30d54b8fdc994abac85f49043faee61993e55a4"}, "originalPosition": 1}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzE2MTYyMDA1OnYy", "diffSide": "RIGHT", "path": "drools-compiler/src/main/java/org/drools/compiler/kie/builder/impl/KieBaseUpdaters.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xNFQxNDozNDo1MlrOHhWN1w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xNFQxNDozNDo1MlrOHhWN1w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNDcyOTA0Nw==", "bodyText": "License", "url": "https://github.com/kiegroup/drools/pull/3159#discussion_r504729047", "createdAt": "2020-10-14T14:34:52Z", "author": {"login": "danielezonca"}, "path": "drools-compiler/src/main/java/org/drools/compiler/kie/builder/impl/KieBaseUpdaters.java", "diffHunk": "@@ -0,0 +1,8 @@\n+package org.drools.compiler.kie.builder.impl;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "e30d54b8fdc994abac85f49043faee61993e55a4"}, "originalPosition": 1}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzE2MTYyMDY2OnYy", "diffSide": "RIGHT", "path": "drools-compiler/src/main/java/org/drools/compiler/kie/builder/impl/KieBaseUpdatersContext.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xNFQxNDozNDo1OVrOHhWOPA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xNFQxNDozNDo1OVrOHhWOPA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNDcyOTE0OA==", "bodyText": "License", "url": "https://github.com/kiegroup/drools/pull/3159#discussion_r504729148", "createdAt": "2020-10-14T14:34:59Z", "author": {"login": "danielezonca"}, "path": "drools-compiler/src/main/java/org/drools/compiler/kie/builder/impl/KieBaseUpdatersContext.java", "diffHunk": "@@ -0,0 +1,33 @@\n+package org.drools.compiler.kie.builder.impl;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "e30d54b8fdc994abac85f49043faee61993e55a4"}, "originalPosition": 1}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzE2MTYyMzA0OnYy", "diffSide": "RIGHT", "path": "drools-compiler/src/main/java/org/drools/compiler/kie/builder/impl/KieBaseUpdatersImpl.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xNFQxNDozNToyMFrOHhWPqA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xNFQxNDozNToyMFrOHhWPqA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNDcyOTUxMg==", "bodyText": "License", "url": "https://github.com/kiegroup/drools/pull/3159#discussion_r504729512", "createdAt": "2020-10-14T14:35:20Z", "author": {"login": "danielezonca"}, "path": "drools-compiler/src/main/java/org/drools/compiler/kie/builder/impl/KieBaseUpdatersImpl.java", "diffHunk": "@@ -0,0 +1,24 @@\n+package org.drools.compiler.kie.builder.impl;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "e30d54b8fdc994abac85f49043faee61993e55a4"}, "originalPosition": 1}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzE2MTYyNDM1OnYy", "diffSide": "RIGHT", "path": "drools-compiler/src/main/java/org/drools/compiler/kie/builder/impl/KieBaseUpdatersImpl.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xNFQxNDozNTozNFrOHhWQaw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xNFQxNDozNTozNFrOHhWQaw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNDcyOTcwNw==", "bodyText": "Why an explicit empty constructor?", "url": "https://github.com/kiegroup/drools/pull/3159#discussion_r504729707", "createdAt": "2020-10-14T14:35:34Z", "author": {"login": "danielezonca"}, "path": "drools-compiler/src/main/java/org/drools/compiler/kie/builder/impl/KieBaseUpdatersImpl.java", "diffHunk": "@@ -0,0 +1,24 @@\n+package org.drools.compiler.kie.builder.impl;\n+\n+import java.util.ArrayList;\n+import java.util.List;\n+import java.util.function.Consumer;\n+\n+public class KieBaseUpdatersImpl implements Consumer<KieBaseUpdaterFactory>,\n+                                            KieBaseUpdaters {\n+\n+    List<KieBaseUpdaterFactory> children = new ArrayList<>();\n+\n+    public KieBaseUpdatersImpl() {\n+    }", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "e30d54b8fdc994abac85f49043faee61993e55a4"}, "originalPosition": 13}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzE2MTYzMTAzOnYy", "diffSide": "RIGHT", "path": "drools-compiler/src/main/java/org/drools/compiler/kie/builder/impl/ZipKieModule.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xNFQxNDozNjo1MVrOHhWUmQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xNFQxNDozNjo1MVrOHhWUmQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNDczMDc3Nw==", "bodyText": "Unused import?", "url": "https://github.com/kiegroup/drools/pull/3159#discussion_r504730777", "createdAt": "2020-10-14T14:36:51Z", "author": {"login": "danielezonca"}, "path": "drools-compiler/src/main/java/org/drools/compiler/kie/builder/impl/ZipKieModule.java", "diffHunk": "@@ -31,6 +31,7 @@\n import java.util.zip.ZipEntry;\n import java.util.zip.ZipInputStream;\n \n+import org.drools.core.impl.InternalKnowledgeBase;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "e30d54b8fdc994abac85f49043faee61993e55a4"}, "originalPosition": 4}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzE2MTYzODM2OnYy", "diffSide": "RIGHT", "path": "drools-compiler/src/main/java/org/drools/compiler/kie/builder/impl/ZipKieModule.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xNFQxNDozODoxNFrOHhWZJw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xNFQxNjoxNjo1NVrOHha70g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNDczMTk0Mw==", "bodyText": "What is the reason of this change?", "url": "https://github.com/kiegroup/drools/pull/3159#discussion_r504731943", "createdAt": "2020-10-14T14:38:14Z", "author": {"login": "danielezonca"}, "path": "drools-compiler/src/main/java/org/drools/compiler/kie/builder/impl/ZipKieModule.java", "diffHunk": "@@ -57,7 +58,7 @@ public ZipKieModule(ReleaseId releaseId,\n     @Override\n     public InternalResource getResource( String fileName) {\n         byte[] bytes = getBytes(fileName);\n-        if (bytes != null && bytes.length > 0) {\n+        if (bytes != null) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "e30d54b8fdc994abac85f49043faee61993e55a4"}, "originalPosition": 13}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNDgwNjM1NA==", "bodyText": "Allow 0 byte file in a zipkiemodule", "url": "https://github.com/kiegroup/drools/pull/3159#discussion_r504806354", "createdAt": "2020-10-14T16:16:55Z", "author": {"login": "lucamolteni"}, "path": "drools-compiler/src/main/java/org/drools/compiler/kie/builder/impl/ZipKieModule.java", "diffHunk": "@@ -57,7 +58,7 @@ public ZipKieModule(ReleaseId releaseId,\n     @Override\n     public InternalResource getResource( String fileName) {\n         byte[] bytes = getBytes(fileName);\n-        if (bytes != null && bytes.length > 0) {\n+        if (bytes != null) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNDczMTk0Mw=="}, "originalCommit": {"oid": "e30d54b8fdc994abac85f49043faee61993e55a4"}, "originalPosition": 13}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzE2MTY0MDYzOnYy", "diffSide": "RIGHT", "path": "drools-core/src/main/java/org/drools/core/util/MapUtils.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xNFQxNDozODo0M1rOHhWaoQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xNFQxNDozODo0M1rOHhWaoQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNDczMjMyMQ==", "bodyText": "License", "url": "https://github.com/kiegroup/drools/pull/3159#discussion_r504732321", "createdAt": "2020-10-14T14:38:43Z", "author": {"login": "danielezonca"}, "path": "drools-core/src/main/java/org/drools/core/util/MapUtils.java", "diffHunk": "@@ -0,0 +1,19 @@\n+package org.drools.core.util;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "e30d54b8fdc994abac85f49043faee61993e55a4"}, "originalPosition": 1}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzE2MTY0NTE0OnYy", "diffSide": "RIGHT", "path": "drools-core/src/main/java/org/drools/core/util/StreamUtils.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xNFQxNDozOTozOVrOHhWdag==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xNFQxNDozOTozOVrOHhWdag==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNDczMzAzNA==", "bodyText": "Please remove the license", "url": "https://github.com/kiegroup/drools/pull/3159#discussion_r504733034", "createdAt": "2020-10-14T14:39:39Z", "author": {"login": "danielezonca"}, "path": "drools-core/src/main/java/org/drools/core/util/StreamUtils.java", "diffHunk": "@@ -0,0 +1,29 @@\n+/*\n+ * Copyright (c) 2020. Red Hat, Inc. and/or its affiliates.\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ *\n+ *       http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "e30d54b8fdc994abac85f49043faee61993e55a4"}, "originalPosition": 13}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzE2MTY1MTAyOnYy", "diffSide": "RIGHT", "path": "drools-model/drools-model-compiler/src/main/java/org/drools/modelcompiler/builder/AdditionalFileGenerator.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xNFQxNDo0MDo0MVrOHhWhAg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xNFQxNDo0MDo0MVrOHhWhAg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNDczMzk1NA==", "bodyText": "License", "url": "https://github.com/kiegroup/drools/pull/3159#discussion_r504733954", "createdAt": "2020-10-14T14:40:41Z", "author": {"login": "danielezonca"}, "path": "drools-model/drools-model-compiler/src/main/java/org/drools/modelcompiler/builder/AdditionalFileGenerator.java", "diffHunk": "@@ -0,0 +1,11 @@\n+package org.drools.modelcompiler.builder;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "e30d54b8fdc994abac85f49043faee61993e55a4"}, "originalPosition": 1}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzE2MTY1MjA3OnYy", "diffSide": "RIGHT", "path": "drools-model/drools-model-compiler/src/main/java/org/drools/modelcompiler/builder/AdditionalFileGenerators.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xNFQxNDo0MDo1MlrOHhWhqg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xNFQxNDo0MDo1MlrOHhWhqg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNDczNDEyMg==", "bodyText": "License", "url": "https://github.com/kiegroup/drools/pull/3159#discussion_r504734122", "createdAt": "2020-10-14T14:40:52Z", "author": {"login": "danielezonca"}, "path": "drools-model/drools-model-compiler/src/main/java/org/drools/modelcompiler/builder/AdditionalFileGenerators.java", "diffHunk": "@@ -0,0 +1,8 @@\n+package org.drools.modelcompiler.builder;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "e30d54b8fdc994abac85f49043faee61993e55a4"}, "originalPosition": 1}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzE2MTY1MjgzOnYy", "diffSide": "RIGHT", "path": "drools-model/drools-model-compiler/src/main/java/org/drools/modelcompiler/builder/AdditionalFileGeneratorsImpl.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xNFQxNDo0MTowMVrOHhWiGg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xNFQxNDo0MTowMVrOHhWiGg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNDczNDIzNA==", "bodyText": "License", "url": "https://github.com/kiegroup/drools/pull/3159#discussion_r504734234", "createdAt": "2020-10-14T14:41:01Z", "author": {"login": "danielezonca"}, "path": "drools-model/drools-model-compiler/src/main/java/org/drools/modelcompiler/builder/AdditionalFileGeneratorsImpl.java", "diffHunk": "@@ -0,0 +1,21 @@\n+package org.drools.modelcompiler.builder;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "e30d54b8fdc994abac85f49043faee61993e55a4"}, "originalPosition": 1}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzE2MTY4MDMyOnYy", "diffSide": "RIGHT", "path": "drools-model/drools-model-compiler/pom.xml", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xNFQxNDo0NjoyNVrOHhWzLA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xNFQxNDo0NjoyNVrOHhWzLA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNDczODYwNA==", "bodyText": "Where is it used?", "url": "https://github.com/kiegroup/drools/pull/3159#discussion_r504738604", "createdAt": "2020-10-14T14:46:25Z", "author": {"login": "danielezonca"}, "path": "drools-model/drools-model-compiler/pom.xml", "diffHunk": "@@ -117,6 +117,12 @@\n       <artifactId>logback-classic</artifactId>\n       <scope>test</scope>\n     </dependency>\n+\n+    <dependency>\n+      <groupId>org.kie</groupId>\n+      <artifactId>kie-memory-compiler</artifactId>\n+      <scope>test</scope>\n+    </dependency>", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "e30d54b8fdc994abac85f49043faee61993e55a4"}, "originalPosition": 9}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzE2MTY4NjI2OnYy", "diffSide": "RIGHT", "path": "drools-model/drools-model-compiler/src/main/java/org/drools/modelcompiler/CanonicalKieModule.java", "isResolved": true, "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xNFQxNDo0Nzo0MlrOHhW3Bw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xNVQxMDowMTowM1rOHiATdQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNDczOTU5MQ==", "bodyText": "Is this case possible? If yes please add a comment.\nAs far as I can see this will produce a NPE inside KieBaseUpdaterOptions because it iterates over this value. Can you please verify?", "url": "https://github.com/kiegroup/drools/pull/3159#discussion_r504739591", "createdAt": "2020-10-14T14:47:42Z", "author": {"login": "danielezonca"}, "path": "drools-model/drools-model-compiler/src/main/java/org/drools/modelcompiler/CanonicalKieModule.java", "diffHunk": "@@ -218,6 +231,35 @@ public InternalKnowledgeBase createKieBase(KieBaseModelImpl kBaseModel, KieProje\n         return kieBase;\n     }\n \n+    @Override\n+    public void afterKieBaseCreationUpdate(String name, InternalKnowledgeBase kBase) {\n+        KnowledgeBuilder knowledgeBuilderForKieBase = getKnowledgeBuilderForKieBase(name);\n+\n+\n+        final KieBaseUpdaterOptions.OptionEntry options;\n+        if(knowledgeBuilderForKieBase instanceof KnowledgeBuilderImpl) {\n+            KnowledgeBuilderImpl knowledgeBuilderForImpl = (KnowledgeBuilderImpl) knowledgeBuilderForKieBase;\n+            KnowledgeBuilderConfigurationImpl builderConfiguration = knowledgeBuilderForImpl.getBuilderConfiguration();\n+            options = new KieBaseUpdaterOptions.OptionEntry(AlphaNetworkCompilerOption.class, builderConfiguration.getAlphaNetworkCompilerOption());\n+        } else if(resourceFileExists(getANCFile(internalKieModule.getReleaseId()))) {\n+            options = new KieBaseUpdaterOptions.OptionEntry(AlphaNetworkCompilerOption.class, AlphaNetworkCompilerOption.LOAD);\n+        } else {\n+            options = null;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "e30d54b8fdc994abac85f49043faee61993e55a4"}, "originalPosition": 71}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNTMxMjQ3MA==", "bodyText": "https://github.com/lucamolteni/drools/blob/86432a855251e12de1ae29426d8f5eb84794ca01/drools-compiler/src/main/java/org/drools/compiler/kie/builder/impl/KieBaseUpdaterOptions.java#L32\nI agree this is not as nice as it could be though", "url": "https://github.com/kiegroup/drools/pull/3159#discussion_r505312470", "createdAt": "2020-10-15T08:08:41Z", "author": {"login": "lucamolteni"}, "path": "drools-model/drools-model-compiler/src/main/java/org/drools/modelcompiler/CanonicalKieModule.java", "diffHunk": "@@ -218,6 +231,35 @@ public InternalKnowledgeBase createKieBase(KieBaseModelImpl kBaseModel, KieProje\n         return kieBase;\n     }\n \n+    @Override\n+    public void afterKieBaseCreationUpdate(String name, InternalKnowledgeBase kBase) {\n+        KnowledgeBuilder knowledgeBuilderForKieBase = getKnowledgeBuilderForKieBase(name);\n+\n+\n+        final KieBaseUpdaterOptions.OptionEntry options;\n+        if(knowledgeBuilderForKieBase instanceof KnowledgeBuilderImpl) {\n+            KnowledgeBuilderImpl knowledgeBuilderForImpl = (KnowledgeBuilderImpl) knowledgeBuilderForKieBase;\n+            KnowledgeBuilderConfigurationImpl builderConfiguration = knowledgeBuilderForImpl.getBuilderConfiguration();\n+            options = new KieBaseUpdaterOptions.OptionEntry(AlphaNetworkCompilerOption.class, builderConfiguration.getAlphaNetworkCompilerOption());\n+        } else if(resourceFileExists(getANCFile(internalKieModule.getReleaseId()))) {\n+            options = new KieBaseUpdaterOptions.OptionEntry(AlphaNetworkCompilerOption.class, AlphaNetworkCompilerOption.LOAD);\n+        } else {\n+            options = null;", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNDczOTU5MQ=="}, "originalCommit": {"oid": "e30d54b8fdc994abac85f49043faee61993e55a4"}, "originalPosition": 71}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNTQxODYxMw==", "bodyText": "Replaced with singletonlist", "url": "https://github.com/kiegroup/drools/pull/3159#discussion_r505418613", "createdAt": "2020-10-15T10:01:03Z", "author": {"login": "lucamolteni"}, "path": "drools-model/drools-model-compiler/src/main/java/org/drools/modelcompiler/CanonicalKieModule.java", "diffHunk": "@@ -218,6 +231,35 @@ public InternalKnowledgeBase createKieBase(KieBaseModelImpl kBaseModel, KieProje\n         return kieBase;\n     }\n \n+    @Override\n+    public void afterKieBaseCreationUpdate(String name, InternalKnowledgeBase kBase) {\n+        KnowledgeBuilder knowledgeBuilderForKieBase = getKnowledgeBuilderForKieBase(name);\n+\n+\n+        final KieBaseUpdaterOptions.OptionEntry options;\n+        if(knowledgeBuilderForKieBase instanceof KnowledgeBuilderImpl) {\n+            KnowledgeBuilderImpl knowledgeBuilderForImpl = (KnowledgeBuilderImpl) knowledgeBuilderForKieBase;\n+            KnowledgeBuilderConfigurationImpl builderConfiguration = knowledgeBuilderForImpl.getBuilderConfiguration();\n+            options = new KieBaseUpdaterOptions.OptionEntry(AlphaNetworkCompilerOption.class, builderConfiguration.getAlphaNetworkCompilerOption());\n+        } else if(resourceFileExists(getANCFile(internalKieModule.getReleaseId()))) {\n+            options = new KieBaseUpdaterOptions.OptionEntry(AlphaNetworkCompilerOption.class, AlphaNetworkCompilerOption.LOAD);\n+        } else {\n+            options = null;", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNDczOTU5MQ=="}, "originalCommit": {"oid": "e30d54b8fdc994abac85f49043faee61993e55a4"}, "originalPosition": 71}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzE2MTg3MjA2OnYy", "diffSide": "RIGHT", "path": "drools-model/drools-model-compiler/src/main/java/org/drools/modelcompiler/CanonicalKieModule.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xNFQxNToyNToxNVrOHhYqGg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xNVQwODoyMDozNlrOHh6rWQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNDc2OTA1MA==", "bodyText": "Why in similar other classes (i.e. MemoryKieModule.java) the code is\nkBase.enqueueModification(compositeUpdater);\nwhile here it is executed in place?", "url": "https://github.com/kiegroup/drools/pull/3159#discussion_r504769050", "createdAt": "2020-10-14T15:25:15Z", "author": {"login": "danielezonca"}, "path": "drools-model/drools-model-compiler/src/main/java/org/drools/modelcompiler/CanonicalKieModule.java", "diffHunk": "@@ -218,6 +231,35 @@ public InternalKnowledgeBase createKieBase(KieBaseModelImpl kBaseModel, KieProje\n         return kieBase;\n     }\n \n+    @Override\n+    public void afterKieBaseCreationUpdate(String name, InternalKnowledgeBase kBase) {\n+        KnowledgeBuilder knowledgeBuilderForKieBase = getKnowledgeBuilderForKieBase(name);\n+\n+\n+        final KieBaseUpdaterOptions.OptionEntry options;\n+        if(knowledgeBuilderForKieBase instanceof KnowledgeBuilderImpl) {\n+            KnowledgeBuilderImpl knowledgeBuilderForImpl = (KnowledgeBuilderImpl) knowledgeBuilderForKieBase;\n+            KnowledgeBuilderConfigurationImpl builderConfiguration = knowledgeBuilderForImpl.getBuilderConfiguration();\n+            options = new KieBaseUpdaterOptions.OptionEntry(AlphaNetworkCompilerOption.class, builderConfiguration.getAlphaNetworkCompilerOption());\n+        } else if(resourceFileExists(getANCFile(internalKieModule.getReleaseId()))) {\n+            options = new KieBaseUpdaterOptions.OptionEntry(AlphaNetworkCompilerOption.class, AlphaNetworkCompilerOption.LOAD);\n+        } else {\n+            options = null;\n+        }\n+\n+        KieContainerImpl.CompositeRunnable compositeUpdater = new KieContainerImpl.CompositeRunnable();\n+        KieBaseUpdaters updaters = ServiceRegistry.getService(KieBaseUpdaters.class);\n+        updaters.getChildren()\n+                .stream()\n+                .map(kbu -> kbu.create(new KieBaseUpdatersContext(new KieBaseUpdaterOptions(options),\n+                                                              kBase.getRete(),\n+                                                              kBase.getRootClassLoader()\n+                )))\n+                .forEach(compositeUpdater::add);\n+\n+        compositeUpdater.run();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "e30d54b8fdc994abac85f49043faee61993e55a4"}, "originalPosition": 84}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNTMyNjQyNQ==", "bodyText": "During incremental compilation we need to enqueue(lock?) the kbase as it's being used\n\n  \n    \n      drools/drools-core/src/main/java/org/drools/core/impl/KnowledgeBaseImpl.java\n    \n    \n         Line 743\n      in\n      3df9c20\n    \n    \n    \n    \n\n        \n          \n           try { \n        \n    \n  \n\n\nJust after creation we don't need that", "url": "https://github.com/kiegroup/drools/pull/3159#discussion_r505326425", "createdAt": "2020-10-15T08:20:36Z", "author": {"login": "lucamolteni"}, "path": "drools-model/drools-model-compiler/src/main/java/org/drools/modelcompiler/CanonicalKieModule.java", "diffHunk": "@@ -218,6 +231,35 @@ public InternalKnowledgeBase createKieBase(KieBaseModelImpl kBaseModel, KieProje\n         return kieBase;\n     }\n \n+    @Override\n+    public void afterKieBaseCreationUpdate(String name, InternalKnowledgeBase kBase) {\n+        KnowledgeBuilder knowledgeBuilderForKieBase = getKnowledgeBuilderForKieBase(name);\n+\n+\n+        final KieBaseUpdaterOptions.OptionEntry options;\n+        if(knowledgeBuilderForKieBase instanceof KnowledgeBuilderImpl) {\n+            KnowledgeBuilderImpl knowledgeBuilderForImpl = (KnowledgeBuilderImpl) knowledgeBuilderForKieBase;\n+            KnowledgeBuilderConfigurationImpl builderConfiguration = knowledgeBuilderForImpl.getBuilderConfiguration();\n+            options = new KieBaseUpdaterOptions.OptionEntry(AlphaNetworkCompilerOption.class, builderConfiguration.getAlphaNetworkCompilerOption());\n+        } else if(resourceFileExists(getANCFile(internalKieModule.getReleaseId()))) {\n+            options = new KieBaseUpdaterOptions.OptionEntry(AlphaNetworkCompilerOption.class, AlphaNetworkCompilerOption.LOAD);\n+        } else {\n+            options = null;\n+        }\n+\n+        KieContainerImpl.CompositeRunnable compositeUpdater = new KieContainerImpl.CompositeRunnable();\n+        KieBaseUpdaters updaters = ServiceRegistry.getService(KieBaseUpdaters.class);\n+        updaters.getChildren()\n+                .stream()\n+                .map(kbu -> kbu.create(new KieBaseUpdatersContext(new KieBaseUpdaterOptions(options),\n+                                                              kBase.getRete(),\n+                                                              kBase.getRootClassLoader()\n+                )))\n+                .forEach(compositeUpdater::add);\n+\n+        compositeUpdater.run();", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNDc2OTA1MA=="}, "originalCommit": {"oid": "e30d54b8fdc994abac85f49043faee61993e55a4"}, "originalPosition": 84}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzE2MTg3NTc2OnYy", "diffSide": "RIGHT", "path": "drools-model/drools-model-compiler/src/main/java/org/drools/modelcompiler/CanonicalKieModule.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xNFQxNToyNTo1N1rOHhYsTA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xNFQxNToyNTo1N1rOHhYsTA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNDc2OTYxMg==", "bodyText": "This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters. Learn more about bidirectional Unicode characters\n\n\n  \n\n\n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                        throw new RuntimeException(e);\n          \n          \n            \n                        throw new UncheckedIOException(e);", "url": "https://github.com/kiegroup/drools/pull/3159#discussion_r504769612", "createdAt": "2020-10-14T15:25:57Z", "author": {"login": "danielezonca"}, "path": "drools-model/drools-model-compiler/src/main/java/org/drools/modelcompiler/CanonicalKieModule.java", "diffHunk": "@@ -437,6 +473,22 @@ private void initModels(CanonicalKieModuleModel kmodel) throws ClassNotFoundExce\n         return Stream.of(lines).skip(1).collect(toList());\n     }\n \n+    private String readExistingResourceWithName(String fileName) {\n+        String modelFiles;\n+        try {\n+            Resource modelFile = internalKieModule.getResource(fileName);\n+            modelFiles = new String(IoUtils.readBytesFromInputStream(modelFile.getInputStream()));\n+        } catch (IOException e) {\n+            throw new RuntimeException(e);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "e30d54b8fdc994abac85f49043faee61993e55a4"}, "originalPosition": 115}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzE2MTg5MzE3OnYy", "diffSide": "RIGHT", "path": "drools-alphanetwork-compiler/pom.xml", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xNFQxNToyOTozMVrOHhY3PA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xNFQxNjowNjo1MFrOHhag8Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNDc3MjQxMg==", "bodyText": "Is it using MVEL? If yes, do we plan to make it work without MVEL in the future?", "url": "https://github.com/kiegroup/drools/pull/3159#discussion_r504772412", "createdAt": "2020-10-14T15:29:31Z", "author": {"login": "danielezonca"}, "path": "drools-alphanetwork-compiler/pom.xml", "diffHunk": "@@ -0,0 +1,100 @@\n+<?xml version=\"1.0\" encoding=\"UTF-8\"?>\n+<project xmlns=\"http://maven.apache.org/POM/4.0.0\"\n+         xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\"\n+         xsi:schemaLocation=\"http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd\">\n+  <parent>\n+    <artifactId>drools</artifactId>\n+    <groupId>org.drools</groupId>\n+    <version>7.45.0-SNAPSHOT</version>\n+  </parent>\n+  <modelVersion>4.0.0</modelVersion>\n+\n+  <artifactId>drools-alphanetwork-compiler</artifactId>\n+\n+  <name>Drools :: Alpha Network Compiler</name>\n+\n+  <properties>\n+    <java.module.name>org.drools.core.alphanetworkcompiler</java.module.name>\n+  </properties>\n+\n+  <dependencies>\n+\n+    <dependency>\n+      <groupId>org.drools</groupId>\n+      <artifactId>drools-core</artifactId>\n+    </dependency>\n+\n+    <dependency>\n+      <groupId>org.drools</groupId>\n+      <artifactId>drools-mvel</artifactId>", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "e30d54b8fdc994abac85f49043faee61993e55a4"}, "originalPosition": 29}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNDc5OTQ3Mw==", "bodyText": "it works for both classic and engine", "url": "https://github.com/kiegroup/drools/pull/3159#discussion_r504799473", "createdAt": "2020-10-14T16:06:50Z", "author": {"login": "lucamolteni"}, "path": "drools-alphanetwork-compiler/pom.xml", "diffHunk": "@@ -0,0 +1,100 @@\n+<?xml version=\"1.0\" encoding=\"UTF-8\"?>\n+<project xmlns=\"http://maven.apache.org/POM/4.0.0\"\n+         xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\"\n+         xsi:schemaLocation=\"http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd\">\n+  <parent>\n+    <artifactId>drools</artifactId>\n+    <groupId>org.drools</groupId>\n+    <version>7.45.0-SNAPSHOT</version>\n+  </parent>\n+  <modelVersion>4.0.0</modelVersion>\n+\n+  <artifactId>drools-alphanetwork-compiler</artifactId>\n+\n+  <name>Drools :: Alpha Network Compiler</name>\n+\n+  <properties>\n+    <java.module.name>org.drools.core.alphanetworkcompiler</java.module.name>\n+  </properties>\n+\n+  <dependencies>\n+\n+    <dependency>\n+      <groupId>org.drools</groupId>\n+      <artifactId>drools-core</artifactId>\n+    </dependency>\n+\n+    <dependency>\n+      <groupId>org.drools</groupId>\n+      <artifactId>drools-mvel</artifactId>", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNDc3MjQxMg=="}, "originalCommit": {"oid": "e30d54b8fdc994abac85f49043faee61993e55a4"}, "originalPosition": 29}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzE2MTg5NzYxOnYy", "diffSide": "RIGHT", "path": "drools-alphanetwork-compiler/pom.xml", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xNFQxNTozMDoyM1rOHhY5-w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xNFQxNjowNzoxN1rOHhaiAQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNDc3MzExNQ==", "bodyText": "What about use drools-engine-classic dependency?", "url": "https://github.com/kiegroup/drools/pull/3159#discussion_r504773115", "createdAt": "2020-10-14T15:30:23Z", "author": {"login": "danielezonca"}, "path": "drools-alphanetwork-compiler/pom.xml", "diffHunk": "@@ -0,0 +1,100 @@\n+<?xml version=\"1.0\" encoding=\"UTF-8\"?>\n+<project xmlns=\"http://maven.apache.org/POM/4.0.0\"\n+         xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\"\n+         xsi:schemaLocation=\"http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd\">\n+  <parent>\n+    <artifactId>drools</artifactId>\n+    <groupId>org.drools</groupId>\n+    <version>7.45.0-SNAPSHOT</version>\n+  </parent>\n+  <modelVersion>4.0.0</modelVersion>\n+\n+  <artifactId>drools-alphanetwork-compiler</artifactId>\n+\n+  <name>Drools :: Alpha Network Compiler</name>\n+\n+  <properties>\n+    <java.module.name>org.drools.core.alphanetworkcompiler</java.module.name>\n+  </properties>\n+\n+  <dependencies>\n+\n+    <dependency>\n+      <groupId>org.drools</groupId>\n+      <artifactId>drools-core</artifactId>\n+    </dependency>\n+\n+    <dependency>\n+      <groupId>org.drools</groupId>\n+      <artifactId>drools-mvel</artifactId>\n+    </dependency>\n+\n+    <dependency>\n+      <groupId>org.drools</groupId>\n+      <artifactId>drools-compiler</artifactId>\n+    </dependency>", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "e30d54b8fdc994abac85f49043faee61993e55a4"}, "originalPosition": 35}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNDc5OTc0NQ==", "bodyText": "see above, as it supports both implementatiosn I'm not sure it's correct to use those modules", "url": "https://github.com/kiegroup/drools/pull/3159#discussion_r504799745", "createdAt": "2020-10-14T16:07:17Z", "author": {"login": "lucamolteni"}, "path": "drools-alphanetwork-compiler/pom.xml", "diffHunk": "@@ -0,0 +1,100 @@\n+<?xml version=\"1.0\" encoding=\"UTF-8\"?>\n+<project xmlns=\"http://maven.apache.org/POM/4.0.0\"\n+         xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\"\n+         xsi:schemaLocation=\"http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd\">\n+  <parent>\n+    <artifactId>drools</artifactId>\n+    <groupId>org.drools</groupId>\n+    <version>7.45.0-SNAPSHOT</version>\n+  </parent>\n+  <modelVersion>4.0.0</modelVersion>\n+\n+  <artifactId>drools-alphanetwork-compiler</artifactId>\n+\n+  <name>Drools :: Alpha Network Compiler</name>\n+\n+  <properties>\n+    <java.module.name>org.drools.core.alphanetworkcompiler</java.module.name>\n+  </properties>\n+\n+  <dependencies>\n+\n+    <dependency>\n+      <groupId>org.drools</groupId>\n+      <artifactId>drools-core</artifactId>\n+    </dependency>\n+\n+    <dependency>\n+      <groupId>org.drools</groupId>\n+      <artifactId>drools-mvel</artifactId>\n+    </dependency>\n+\n+    <dependency>\n+      <groupId>org.drools</groupId>\n+      <artifactId>drools-compiler</artifactId>\n+    </dependency>", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNDc3MzExNQ=="}, "originalCommit": {"oid": "e30d54b8fdc994abac85f49043faee61993e55a4"}, "originalPosition": 35}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzE2MTkwNzczOnYy", "diffSide": "RIGHT", "path": "drools-alphanetwork-compiler/src/main/java/org/drools/ancompiler/CompiledNetworkSource.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xNFQxNTozMjozOFrOHhZAog==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xNFQxNTozMjozOFrOHhZAog==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNDc3NDgxOA==", "bodyText": "Is it possible to add a type bound to prevent arbitrary classes?", "url": "https://github.com/kiegroup/drools/pull/3159#discussion_r504774818", "createdAt": "2020-10-14T15:32:38Z", "author": {"login": "danielezonca"}, "path": "drools-alphanetwork-compiler/src/main/java/org/drools/ancompiler/CompiledNetworkSource.java", "diffHunk": "@@ -0,0 +1,63 @@\n+package org.drools.ancompiler;\n+\n+import org.drools.core.reteoo.ObjectTypeNode;\n+import org.drools.core.rule.IndexableConstraint;\n+import org.drools.core.spi.InternalReadAccessor;\n+import org.slf4j.Logger;\n+import org.slf4j.LoggerFactory;\n+\n+public class CompiledNetworkSource {\n+\n+    private final Logger logger = LoggerFactory.getLogger(CompiledNetworkSource.class);\n+\n+    private final String source;\n+    private final IndexableConstraint indexableConstraint;\n+    private final String name;\n+    private final String sourceName;\n+    private final ObjectTypeNode objectTypeNode;\n+\n+    public CompiledNetworkSource(String source,\n+                                 IndexableConstraint indexableConstraint,\n+                                 String name,\n+                                 String sourceName,\n+                                 ObjectTypeNode objectTypeNode) {\n+        this.source = source;\n+        this.indexableConstraint = indexableConstraint;\n+        this.name = name;\n+        this.sourceName = sourceName;\n+        this.objectTypeNode = objectTypeNode;\n+    }\n+\n+    public String getSource() {\n+        return source;\n+    }\n+\n+    public String getName() {\n+        return name;\n+    }\n+\n+    public String getSourceName() {\n+        return sourceName;\n+    }\n+\n+    public void setCompiledNetwork(Class<?> compiledNetworkClass) {\n+        CompiledNetwork compiledNetwork = newCompiledNetworkInstance(compiledNetworkClass);\n+        compiledNetwork.setNetwork(objectTypeNode);\n+        logger.debug(\"Updating {} with instance of class: {}\",\n+                     objectTypeNode,\n+                     compiledNetworkClass.getName());\n+    }\n+\n+    public CompiledNetwork newCompiledNetworkInstance(Class<?> aClass) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "e30d54b8fdc994abac85f49043faee61993e55a4"}, "originalPosition": 51}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzE2MTkyNTI3OnYy", "diffSide": "RIGHT", "path": "drools-alphanetwork-compiler/src/main/java/org/drools/ancompiler/ObjectTypeNodeCompiler.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xNFQxNTozNjoyNFrOHhZLyQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xNFQxNTozNjoyNFrOHhZLyQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNDc3NzY3Mw==", "bodyText": "This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters. Learn more about bidirectional Unicode characters\n\n\n  \n\n\n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                            .collect(Collectors.toMap(CompiledNetworkSource::getName, c -> c));\n          \n          \n            \n                            .collect(Collectors.toMap(CompiledNetworkSource::getName, Function.identity()));", "url": "https://github.com/kiegroup/drools/pull/3159#discussion_r504777673", "createdAt": "2020-10-14T15:36:24Z", "author": {"login": "danielezonca"}, "path": "drools-alphanetwork-compiler/src/main/java/org/drools/ancompiler/ObjectTypeNodeCompiler.java", "diffHunk": "@@ -221,59 +201,38 @@ private String getPackageName() {\n         return PACKAGE_NAME;\n     }\n \n-    private static final JavaCompiler JAVA_COMPILER = JavaCompilerFactory.INSTANCE.loadCompiler( JavaConfiguration.CompilerType.NATIVE, \"1.8\");\n-\n-    /**\n-     * Creates a {@link CompiledNetwork} for the specified {@link ObjectTypeNode}. The {@link PackageBuilder} is used\n-     * to compile the generated source and load the class.\n-     *\n-     * @param kBuilder     builder used to compile and load class\n-     * @param objectTypeNode OTN we are generating a compiled network for\n-     * @return CompiledNetwork\n-     */\n-    public static CompiledNetwork compile( InternalKnowledgeBuilder kBuilder, ObjectTypeNode objectTypeNode) {\n-        if (objectTypeNode == null) {\n-            throw new IllegalArgumentException(\"ObjectTypeNode cannot be null!\");\n-        }\n-        if (kBuilder == null) {\n-            throw new IllegalArgumentException(\"PackageBuilder cannot be null!\");\n-        }\n-        ObjectTypeNodeCompiler compiler = new ObjectTypeNodeCompiler(objectTypeNode);\n-\n-        String packageName = compiler.getPackageName();\n-\n-        PackageRegistry pkgReg = kBuilder.getPackageRegistry(packageName);\n-        if (pkgReg == null) {\n-            kBuilder.addPackage(new PackageDescr(packageName));\n-            pkgReg = kBuilder.getPackageRegistry(packageName);\n-        }\n-\n-        SourceGenerated source = compiler.generateSource();\n-\n-        logger.debug(\"Generated alpha node compiled network source:\\n\" + source.source);\n-\n-        MemoryFileSystem mfs = new MemoryFileSystem();\n-        mfs.write(compiler.getSourceName(), source.source.getBytes(IoUtils.UTF8_CHARSET));\n-\n-        MemoryFileSystem trg = new MemoryFileSystem();\n-        ProjectClassLoader rootClassLoader = (ProjectClassLoader) kBuilder.getRootClassLoader();\n-        CompilationResult compiled = JAVA_COMPILER.compile(new String[]{compiler.getSourceName()}, mfs, trg, rootClassLoader);\n+    public static List<CompiledNetworkSource> compiledNetworkSources(Rete rete) {\n+        return objectTypeNodeCompiler(rete)\n+                .stream()\n+                .map(ObjectTypeNodeCompiler::generateSource)\n+                .collect(Collectors.toList());\n+    }\n \n-        if (compiled.getErrors().length > 0) {\n-            throw new RuntimeException(\"This is a bug. Please contact the development team:\\n\" + Arrays.toString(compiled.getErrors()));\n-        }\n+    public static List<ObjectTypeNodeCompiler> objectTypeNodeCompiler(Rete rete) {\n+        return objectTypeNodes(rete)\n+                .stream()\n+                .map(ObjectTypeNodeCompiler::new)\n+                .collect(Collectors.toList());\n+    }\n \n-        rootClassLoader.defineClass(compiler.getName(), trg.getBytes(compiler.getBinaryName()));\n+    public static List<ObjectTypeNode> objectTypeNodes(Rete rete) {\n+        return rete.getEntryPointNodes().values().stream()\n+                .flatMap(ep -> ep.getObjectTypeNodes().values().stream())\n+                .filter(f -> !InitialFact.class.isAssignableFrom(f.getObjectType().getClassType()))\n+                .collect(Collectors.toList());\n+    }\n \n-        CompiledNetwork network;\n-        try {\n-            final Class<?> aClass = Class.forName(compiler.getName(), true, rootClassLoader);\n-            final IndexableConstraint indexableConstraint = source.indexableConstraint;\n-            network = (CompiledNetwork) aClass.getConstructor(InternalReadAccessor.class).newInstance(indexableConstraint != null ? indexableConstraint.getFieldExtractor(): null);\n-        } catch (Exception e) {\n-            throw new RuntimeException(\"This is a bug. Please contact the development team\", e);\n-        }\n+    public static Map<String, CompiledNetworkSource> compiledNetworkSourceMap(Rete rete) {\n+        List<CompiledNetworkSource> compiledNetworkSources = ObjectTypeNodeCompiler.compiledNetworkSources(rete);\n+        return compiledNetworkSources\n+                .stream()\n+                .collect(Collectors.toMap(CompiledNetworkSource::getName, c -> c));", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "e30d54b8fdc994abac85f49043faee61993e55a4"}, "originalPosition": 229}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2348, "cost": 1, "resetAt": "2021-11-12T20:28:25Z"}}}