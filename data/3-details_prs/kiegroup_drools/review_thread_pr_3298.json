{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTQ0MDc0MTc3", "number": 3298, "reviewThreads": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0yOVQxNzozMzowNVrOFJ0_SQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wMS0wNVQwOTozNTo1NlrOFLNW_w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzQ1ODQ5NjczOnYy", "diffSide": "RIGHT", "path": "drools-core/src/main/java/org/drools/core/common/LeftTupleIterator.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0yOVQxNzozMzowNVrOIMUbLw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0zMFQwOTo0MDo0NFrOIMmmLg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0OTc4ODQ2Mw==", "bodyText": "Want to leave this here?", "url": "https://github.com/kiegroup/drools/pull/3298#discussion_r549788463", "createdAt": "2020-12-29T17:33:05Z", "author": {"login": "triceo"}, "path": "drools-core/src/main/java/org/drools/core/common/LeftTupleIterator.java", "diffHunk": "@@ -76,7 +76,7 @@ public void setFirstLeftTupleForNode() {\n     public LeftTuple getFirstLeftTuple(LeftTupleSource source,\n                                        LeftTupleSink sink,\n                                        InternalWorkingMemory wm) {\n-        if ( source instanceof AccumulateNode ) {\n+        if ( source instanceof AccumulateNode ) { // TODO WHAT ABOUTGROUPBY ? (mdp)", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "a8a04f37cb5565124f7799837bab8862ee9726c8"}, "originalPosition": 5}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1MDA4NjE5MA==", "bodyText": "This is used only for session serialization and at the moment groupby doesn't fully support it. I believe that since the GroupByNode extends the Accumulate one and not much is changed on this regard this should work as it is, but I'd need to write some test to prove this.", "url": "https://github.com/kiegroup/drools/pull/3298#discussion_r550086190", "createdAt": "2020-12-30T09:40:44Z", "author": {"login": "mariofusco"}, "path": "drools-core/src/main/java/org/drools/core/common/LeftTupleIterator.java", "diffHunk": "@@ -76,7 +76,7 @@ public void setFirstLeftTupleForNode() {\n     public LeftTuple getFirstLeftTuple(LeftTupleSource source,\n                                        LeftTupleSink sink,\n                                        InternalWorkingMemory wm) {\n-        if ( source instanceof AccumulateNode ) {\n+        if ( source instanceof AccumulateNode ) { // TODO WHAT ABOUTGROUPBY ? (mdp)", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0OTc4ODQ2Mw=="}, "originalCommit": {"oid": "a8a04f37cb5565124f7799837bab8862ee9726c8"}, "originalPosition": 5}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzQ1ODUwMjQ5OnYy", "diffSide": "RIGHT", "path": "drools-core/src/main/java/org/drools/core/phreak/PhreakAccumulateNode.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0yOVQxNzozNTo1N1rOIMUegA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0zMFQwOTo0MjowNFrOIMmqNg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0OTc4OTMxMg==", "bodyText": "Want to leave this here?", "url": "https://github.com/kiegroup/drools/pull/3298#discussion_r549789312", "createdAt": "2020-12-29T17:35:57Z", "author": {"login": "triceo"}, "path": "drools-core/src/main/java/org/drools/core/phreak/PhreakAccumulateNode.java", "diffHunk": "@@ -577,14 +576,14 @@ public void doRightDeletes(AccumulateNode accNode,\n                         LeftTuple nextLeft = match.getRightParentNext();\n \n                         LeftTuple leftTuple = match.getLeftParent();\n-                        final AccumulateContext accctx = (AccumulateContext) leftTuple.getContextObject();\n+                        final BaseAccumulation accctx = (BaseAccumulation) leftTuple.getContextObject();\n+                        // FIXME This will be really slow, if it re-accumulates on the same LeftTuple (MDP)", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "a8a04f37cb5565124f7799837bab8862ee9726c8"}, "originalPosition": 345}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1MDA4NzIyMg==", "bodyText": "This is an inefficiency that was preexisting to the introduction of the GroupByNode. I'm discussing with Mark how to improve this, but there's nothing that prevents the merging of this PR.", "url": "https://github.com/kiegroup/drools/pull/3298#discussion_r550087222", "createdAt": "2020-12-30T09:42:04Z", "author": {"login": "mariofusco"}, "path": "drools-core/src/main/java/org/drools/core/phreak/PhreakAccumulateNode.java", "diffHunk": "@@ -577,14 +576,14 @@ public void doRightDeletes(AccumulateNode accNode,\n                         LeftTuple nextLeft = match.getRightParentNext();\n \n                         LeftTuple leftTuple = match.getLeftParent();\n-                        final AccumulateContext accctx = (AccumulateContext) leftTuple.getContextObject();\n+                        final BaseAccumulation accctx = (BaseAccumulation) leftTuple.getContextObject();\n+                        // FIXME This will be really slow, if it re-accumulates on the same LeftTuple (MDP)", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0OTc4OTMxMg=="}, "originalCommit": {"oid": "a8a04f37cb5565124f7799837bab8862ee9726c8"}, "originalPosition": 345}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzQ3Mjk3NTM1OnYy", "diffSide": "RIGHT", "path": "drools-model/drools-model-compiler/src/test/java/org/drools/modelcompiler/GroupByTest.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wMS0wNVQwOTozNTo1NlrOIOQOoQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wMS0wNVQwOTozNTo1NlrOIOQOoQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1MTgxNjg2NQ==", "bodyText": "I'm not sure I understood this comment", "url": "https://github.com/kiegroup/drools/pull/3298#discussion_r551816865", "createdAt": "2021-01-05T09:35:56Z", "author": {"login": "lucamolteni"}, "path": "drools-model/drools-model-compiler/src/test/java/org/drools/modelcompiler/GroupByTest.java", "diffHunk": "@@ -171,16 +175,22 @@ public void testGroupPersonsInitial() throws Exception {\n \n         Variable<String> var_$key = D.declarationOf(String.class);\n         Variable<Person> var_$p = D.declarationOf(Person.class);\n+        Variable<List> var_$list = D.declarationOf(List.class);\n \n         Rule rule1 = D.rule(\"R1\").build(\n                 D.groupBy(\n                         // Patterns\n                         D.pattern(var_$p),\n                         // Grouping Function\n-                        var_$p, var_$key, person -> person.getName().substring(0, 1)),\n+                        var_$p, var_$key, person -> person.getName().substring(0, 1)//,\n+                        //D.accFunction(org.drools.core.base.accumulators.CollectListAccumulateFunction::new, var_$p).as(var_$list)", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "4007d604f95c2b7d2a782b47bda1a07017070b66"}, "originalPosition": 51}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2235, "cost": 1, "resetAt": "2021-11-12T20:28:25Z"}}}