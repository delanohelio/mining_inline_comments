{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDYzMjM3MzY0", "number": 3032, "title": "[DROOLS-5517] Enhance DMNResult/DMNContext to be able to return stron\u2026", "bodyText": "\u2026gly typed OutputSet\nWIP: This is a draft PR. Feel free to share your thoughts/ideas. @tarilabs @lucamolteni\n\nI created DMNResultFPAImpl which has getOutputSet() method. But it means you need to cast the result in order to use the method. Should I move the method to Interface DMNResult?\nIn this draft, DMNResultFPAImpl receives an OutputSet instance from DMNContextFPAImpl. It means that you need to instantiate InputSet/OutputSet instances before executing DMNRuntime. (as we do in BaseVariantTest.createTypeSafeInput/evaluateTypeSafe). Or do we want to encapsulate those logic inside DMNRuntime?", "createdAt": "2020-08-05T08:40:07Z", "url": "https://github.com/kiegroup/drools/pull/3032", "merged": true, "mergeCommit": {"oid": "7703a541596bfa242e278ddd496245dcd17151d7"}, "closed": true, "closedAt": "2020-09-10T08:53:20Z", "author": {"login": "tkobayas"}, "timelineItems": {"totalCount": 12, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABc8QTujAFqTQ2MjU0ODQxMg==", "endCursor": "Y3Vyc29yOnYyOpPPAAABdHc3g6gFqTQ4NTcyMTMwOA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDYyNTQ4NDEy", "url": "https://github.com/kiegroup/drools/pull/3032#pullrequestreview-462548412", "createdAt": "2020-08-06T14:01:30Z", "commit": {"oid": "27a29f8a54e8f82ef80b2ad0bba6a87689a9803b"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0wNlQxNDowMTozMVrOG806_w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0wNlQxNDowMTozMVrOG806_w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NjQzNDgxNQ==", "bodyText": "I am not sure we need for a context to hold reference for an input Vs output, given this would lead to a different design and semantic.\nI believe it should be possible to keep DMNContextFPAImpl as is.\nI also believe it should be possible to keep DMNResultImpl without any need for an additional specialization, but this less of a concern to me.\nWhen the DMNRuntimeImpl creates the DMNResultImpl, it should be possible to supply a DMNContext which has for the wrapped FEELPropertyAccessible fpa the full list of inputs,decisions,bkms, etc.\nWhat do you think?", "url": "https://github.com/kiegroup/drools/pull/3032#discussion_r466434815", "createdAt": "2020-08-06T14:01:31Z", "author": {"login": "tarilabs"}, "path": "kie-dmn/kie-dmn-core/src/main/java/org/kie/dmn/core/impl/DMNContextFPAImpl.java", "diffHunk": "@@ -29,12 +29,20 @@\n \n public class DMNContextFPAImpl implements DMNContext {\n \n-    private final FEELPropertyAccessible fpa;\n+    private final FEELPropertyAccessible inputSet;\n+    private final FEELPropertyAccessible outputSet;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "27a29f8a54e8f82ef80b2ad0bba6a87689a9803b"}, "originalPosition": 6}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDYzMTkyMDI5", "url": "https://github.com/kiegroup/drools/pull/3032#pullrequestreview-463192029", "createdAt": "2020-08-07T10:03:48Z", "commit": {"oid": "5c3708685e1526fddf9c4e00bbc6294c3d786709"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0wN1QxMDowMzo0OVrOG9UImw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0wN1QxMDowMzo0OVrOG9UImw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2Njk0NjIwMw==", "bodyText": "Here I supply OutputSet class.", "url": "https://github.com/kiegroup/drools/pull/3032#discussion_r466946203", "createdAt": "2020-08-07T10:03:49Z", "author": {"login": "tkobayas"}, "path": "kie-dmn/kie-dmn-core/src/test/java/org/kie/dmn/core/stronglytyped/DMNRuntimeTypesTest.java", "diffHunk": "@@ -98,7 +99,8 @@ public void testOneOfEachType() {\n         assertThat(dmnResult.getDecisionResultByName(\"DecisionTime\").getResult(), is(LocalTime.of(10, 0)));\n \n         if (isTypeSafe()) {\n-            FEELPropertyAccessible outputSet = convertToOutputSet(dmnModel, dmnResult);\n+            DMNContextTypeSafeImpl resultContext = (DMNContextTypeSafeImpl)dmnResult.getContext();\n+            FEELPropertyAccessible outputSet = resultContext.getFpa(getOutputSetClass(dmnModel));", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "5c3708685e1526fddf9c4e00bbc6294c3d786709"}, "originalPosition": 14}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "3656b6796a048522a3819ed4e2f9ff206ac415c9", "author": {"user": {"login": "tkobayas", "name": "Toshiya Kobayashi"}}, "url": "https://github.com/kiegroup/drools/commit/3656b6796a048522a3819ed4e2f9ff206ac415c9", "committedDate": "2020-08-21T08:13:42Z", "message": "- Use DMNContextFPAImpl for DMNRuntimeImpl evaluation"}, "afterCommit": {"oid": "5ec05a85067c99b9ca788bb3b9d123d6f0196708", "author": {"user": {"login": "tkobayas", "name": "Toshiya Kobayashi"}}, "url": "https://github.com/kiegroup/drools/commit/5ec05a85067c99b9ca788bb3b9d123d6f0196708", "committedDate": "2020-08-24T07:14:47Z", "message": "- set Collection"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDc2NTc3MTI1", "url": "https://github.com/kiegroup/drools/pull/3032#pullrequestreview-476577125", "createdAt": "2020-08-27T10:12:50Z", "commit": {"oid": "5ec05a85067c99b9ca788bb3b9d123d6f0196708"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yN1QxMDoxMjo1MFrOHIJqLA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yN1QxMDoxMjo1MFrOHIJqLA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3ODMwODkwOA==", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                    DMNContextFPAImpl newCtx = new DMNContextFPAImpl(newFpa, metadata.asMap(), fallbackMap);\n          \n          \n            \n                    DMNContextFPAImpl newCtx = new DMNContextFPAImpl(newFpa, metadata.asMap(), fallbackMap.clone());\n          \n      \n    \n    \n  \n\nI assume?", "url": "https://github.com/kiegroup/drools/pull/3032#discussion_r478308908", "createdAt": "2020-08-27T10:12:50Z", "author": {"login": "tarilabs"}, "path": "kie-dmn/kie-dmn-core/src/main/java/org/kie/dmn/core/impl/DMNContextFPAImpl.java", "diffHunk": "@@ -93,7 +149,15 @@ public DMNMetadata getMetadata() {\n \n     @Override\n     public DMNContext clone() {\n-        DMNContextImpl newCtx = new DMNContextImpl(fpa.allFEELProperties(), metadata.asMap());\n+        FEELPropertyAccessible newFpa;\n+        try {\n+            newFpa = fpa.getClass().getDeclaredConstructor().newInstance();\n+        } catch (InstantiationException | IllegalAccessException | IllegalArgumentException | InvocationTargetException\n+                | NoSuchMethodException | SecurityException e) {\n+                    throw new DMNTypeSafeException(\"Exception while instantiating \" + fpa.getClass(), e);\n+        }\n+        newFpa.fromMap(fpa.allFEELProperties());\n+        DMNContextFPAImpl newCtx = new DMNContextFPAImpl(newFpa, metadata.asMap(), fallbackMap);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "5ec05a85067c99b9ca788bb3b9d123d6f0196708"}, "originalPosition": 130}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "7ec873ad0fa579486c6e9f09dd97fdebd6b3005f", "author": {"user": {"login": "tkobayas", "name": "Toshiya Kobayashi"}}, "url": "https://github.com/kiegroup/drools/commit/7ec873ad0fa579486c6e9f09dd97fdebd6b3005f", "committedDate": "2020-09-01T06:46:00Z", "message": "[DROOLS-5517] Enhance DMNResult/DMNContext to be able to return strongly typed OutputSet"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "5ec05a85067c99b9ca788bb3b9d123d6f0196708", "author": {"user": {"login": "tkobayas", "name": "Toshiya Kobayashi"}}, "url": "https://github.com/kiegroup/drools/commit/5ec05a85067c99b9ca788bb3b9d123d6f0196708", "committedDate": "2020-08-24T07:14:47Z", "message": "- set Collection"}, "afterCommit": {"oid": "7ec873ad0fa579486c6e9f09dd97fdebd6b3005f", "author": {"user": {"login": "tkobayas", "name": "Toshiya Kobayashi"}}, "url": "https://github.com/kiegroup/drools/commit/7ec873ad0fa579486c6e9f09dd97fdebd6b3005f", "committedDate": "2020-09-01T06:46:00Z", "message": "[DROOLS-5517] Enhance DMNResult/DMNContext to be able to return strongly typed OutputSet"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "9b92f3b33028f019c58e7de7c172e958c7226e95", "author": {"user": {"login": "tkobayas", "name": "Toshiya Kobayashi"}}, "url": "https://github.com/kiegroup/drools/commit/9b92f3b33028f019c58e7de7c172e958c7226e95", "committedDate": "2020-09-03T09:37:34Z", "message": "- cover evaluateById and evaluateByName"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDgxNzE5ODE5", "url": "https://github.com/kiegroup/drools/pull/3032#pullrequestreview-481719819", "createdAt": "2020-09-03T10:49:25Z", "commit": {"oid": "9b92f3b33028f019c58e7de7c172e958c7226e95"}, "state": "COMMENTED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "0d6d49910fd615817a5a2bc4df888ba383685243", "author": {"user": {"login": "tkobayas", "name": "Toshiya Kobayashi"}}, "url": "https://github.com/kiegroup/drools/commit/0d6d49910fd615817a5a2bc4df888ba383685243", "committedDate": "2020-09-05T01:33:19Z", "message": "- Move conversion to the test infrastructure"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDgzODgwMzQ1", "url": "https://github.com/kiegroup/drools/pull/3032#pullrequestreview-483880345", "createdAt": "2020-09-08T07:51:20Z", "commit": {"oid": "0d6d49910fd615817a5a2bc4df888ba383685243"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDg0NzE3Mjg3", "url": "https://github.com/kiegroup/drools/pull/3032#pullrequestreview-484717287", "createdAt": "2020-09-09T07:06:54Z", "commit": {"oid": "0d6d49910fd615817a5a2bc4df888ba383685243"}, "state": "APPROVED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0wOVQwNzowNjo1NVrOHO5jyw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0wOVQwNzowNjo1NVrOHO5jyw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NTM4NTE2Mw==", "bodyText": "just to be sure I understood the latest modifications. This extraFields is used to store the DefinedKeySetField which is a Set<String> of the properties which have been set on the Input/Output Set pojo. However, this is not really \"used\" so far, since DMNRuntimeImpl uses the Map-backed DMNContextImpl. Correct?\nIt's fine I just wanted to check the intention :)", "url": "https://github.com/kiegroup/drools/pull/3032#discussion_r485385163", "createdAt": "2020-09-09T07:06:55Z", "author": {"login": "tarilabs"}, "path": "kie-dmn/kie-dmn-core/src/main/java/org/kie/dmn/typesafe/AbstractDMNSetType.java", "diffHunk": "@@ -32,7 +32,8 @@\n \n abstract class AbstractDMNSetType implements TypeDefinition {\n \n-    List<DMNDeclaredField> fields = new ArrayList<>();\n+    List<DMNDeclaredField> dmnFields = new ArrayList<>();\n+    List<FieldDefinition> extraFields = new ArrayList<>();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "0d6d49910fd615817a5a2bc4df888ba383685243"}, "originalPosition": 6}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDg1NzIxMzA4", "url": "https://github.com/kiegroup/drools/pull/3032#pullrequestreview-485721308", "createdAt": "2020-09-10T08:52:41Z", "commit": {"oid": "0d6d49910fd615817a5a2bc4df888ba383685243"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1892, "cost": 1, "resetAt": "2021-11-01T15:33:45Z"}}}