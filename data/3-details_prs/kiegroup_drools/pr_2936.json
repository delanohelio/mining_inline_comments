{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDI3NzM5NjE3", "number": 2936, "title": "[Drools-5373] Refactor PMMLAssembler with delegates ", "bodyText": "@danielezonca @jiripetrlik @mariofusco\nsee https://issues.redhat.com/browse/DROOLS-5373\nThis PR simply separate code from PMMLAssemblerService in two delegates\n\nPMMLCompilerService is meant to invoke the PMMLCompiler\nPMMLLoaderService is meant to load resources from classpath\n\nSince it is not exactly known, yet, how they will work inside Kogito, this PR is just a structure refactoring - when requirements for Kogito will be clearer code will be adapted if/where needed", "createdAt": "2020-06-04T10:28:05Z", "url": "https://github.com/kiegroup/drools/pull/2936", "merged": true, "mergeCommit": {"oid": "a2380cc5c9ec04aa243d525da5b46a25b4f3e988"}, "closed": true, "closedAt": "2020-06-05T11:18:07Z", "author": {"login": "gitgabrio"}, "timelineItems": {"totalCount": 5, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcn7cKGgH2gAyNDI3NzM5NjE3OjAzMTBiNjY3Y2U2YzhmNmNjOTI3MjBjNzUwZDlkNjE1NTg0OTQzMzg=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcoQxwigFqTQyNTIxMDA5Ng==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "0310b667ce6c8f6cc92720c750d9d61558494338", "author": {"user": {"login": "gitgabrio", "name": "Gabriele Cardosi"}}, "url": "https://github.com/kiegroup/drools/commit/0310b667ce6c8f6cc92720c750d9d61558494338", "committedDate": "2020-06-04T10:24:17Z", "message": "[Drools-5373] Refactored PMMLAssembler - implemented two delegates PMMLCompilerService and PMMLLoaderService"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDI0NjY1Nzk1", "url": "https://github.com/kiegroup/drools/pull/2936#pullrequestreview-424665795", "createdAt": "2020-06-04T17:19:46Z", "commit": {"oid": "0310b667ce6c8f6cc92720c750d9d61558494338"}, "state": "COMMENTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wNFQxNzoxOTo0NlrOGfQBjA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wNFQxNzoxOTo1N1rOGfQB7g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNTQyMTU4MA==", "bodyText": "Can you please clarify the logic?\nDoes it try to load (aka parse and compile) from resources and only if there are no file it tries to load compiled?\nI think we should identify if it is a compiled kjar or not and decide what to do.\n@mariofusco\nHow does it work with Drools core?\nDoes it try both load from resource and compiled or just one of them?", "url": "https://github.com/kiegroup/drools/pull/2936#discussion_r435421580", "createdAt": "2020-06-04T17:19:46Z", "author": {"login": "danielezonca"}, "path": "kie-pmml-new/kie-pmml-evaluator/kie-pmml-evaluator-assembler/src/main/java/org/kie/pmml/evaluator/assembler/service/PMMLAssemblerService.java", "diffHunk": "@@ -66,7 +80,11 @@ public void addResources(Object kbuilder, Collection<ResourceWithConfiguration>\n         if (isBuildFromMaven()) {\n             addModels(kbuilderImpl, getKiePMMLModelsFromResourcesWithConfigurationsFromPlugin(kbuilderImpl, resources));\n         } else {\n-            addModels(kbuilderImpl, getKiePMMLModelsFromResourcesWithConfigurations(kbuilderImpl, resources));\n+            List<KiePMMLModel> toAdd = getKiePMMLModelsLoadedFromResourcesWithConfigurations(kbuilderImpl, resources);\n+            if (toAdd.isEmpty()) {\n+                toAdd = getKiePMMLModelsCompiledFromResourcesWithConfigurations(kbuilderImpl, resources);\n+            }\n+            addModels(kbuilderImpl, toAdd);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "0310b667ce6c8f6cc92720c750d9d61558494338"}, "originalPosition": 69}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNTQyMTY3OA==", "bodyText": "Same as above", "url": "https://github.com/kiegroup/drools/pull/2936#discussion_r435421678", "createdAt": "2020-06-04T17:19:57Z", "author": {"login": "danielezonca"}, "path": "kie-pmml-new/kie-pmml-evaluator/kie-pmml-evaluator-assembler/src/main/java/org/kie/pmml/evaluator/assembler/service/PMMLAssemblerService.java", "diffHunk": "@@ -77,7 +95,11 @@ public void addResource(Object kbuilder, Resource resource, ResourceType type, R\n         if (isBuildFromMaven()) {\n             addModels(kbuilderImpl, getKiePMMLModelsFromResourceFromPlugin(kbuilderImpl, resource));\n         } else {\n-            addModels(kbuilderImpl, getKiePMMLModelsFromResource(kbuilderImpl, resource));\n+            List<KiePMMLModel> toAdd = getKiePMMLModelsLoadedFromResource(kbuilderImpl, resource);\n+            if (toAdd.isEmpty()) {\n+                toAdd = getKiePMMLModelsCompiledFromResource(kbuilderImpl, resource);\n+            }\n+            addModels(kbuilderImpl, toAdd);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "0310b667ce6c8f6cc92720c750d9d61558494338"}, "originalPosition": 82}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDI1MTMzMjg4", "url": "https://github.com/kiegroup/drools/pull/2936#pullrequestreview-425133288", "createdAt": "2020-06-05T09:16:59Z", "commit": {"oid": "0310b667ce6c8f6cc92720c750d9d61558494338"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDI1MTM4MjI1", "url": "https://github.com/kiegroup/drools/pull/2936#pullrequestreview-425138225", "createdAt": "2020-06-05T09:23:54Z", "commit": {"oid": "0310b667ce6c8f6cc92720c750d9d61558494338"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDI1MjEwMDk2", "url": "https://github.com/kiegroup/drools/pull/2936#pullrequestreview-425210096", "createdAt": "2020-06-05T11:15:53Z", "commit": {"oid": "0310b667ce6c8f6cc92720c750d9d61558494338"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1571, "cost": 1, "resetAt": "2021-11-01T15:33:45Z"}}}