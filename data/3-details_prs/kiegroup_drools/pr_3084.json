{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDgyMDEyMjQz", "number": 3084, "title": "[DROOLS-5617] Refactor MiningModel source generation", "bodyText": "@danielezonca @mariofusco @jiripetrlik\nSee https://issues.redhat.com/browse/DROOLS-5617\nWith this PR\n\nnested model sources are not put inside the MiningModel (container) sources map anymore\nnested models are add to\nKiePMMLMiningModelWithSources.nestedModels\nlist as \"KiePMMLModel+HasSources\" models\nSuch list will be populated during code-generation and read during compilation", "createdAt": "2020-09-08T12:39:03Z", "url": "https://github.com/kiegroup/drools/pull/3084", "merged": true, "mergeCommit": {"oid": "0fc095edd23c1b9c8f8bf787f6d31786c1b8161e"}, "closed": true, "closedAt": "2020-09-10T12:54:07Z", "author": {"login": "gitgabrio"}, "timelineItems": {"totalCount": 7, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdGzScUgH2gAyNDgyMDEyMjQzOmIzZmJjYzgyM2RjNmVmNzdiMGE3NTVlYzY1NDQxY2UyYTg4Mjc3NzU=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdHdqglgFqTQ4NTc2NjIyOA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "b3fbcc823dc6ef77b0a755ec65441ce2a8827775", "author": {"user": {"login": "gitgabrio", "name": "Gabriele Cardosi"}}, "url": "https://github.com/kiegroup/drools/commit/b3fbcc823dc6ef77b0a755ec65441ce2a8827775", "committedDate": "2020-09-08T08:26:05Z", "message": "[DROOLS-5617] Adding sources map as nested models inside MiningModel"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a7d45b5387610bded330018bd9888075e060b106", "author": {"user": {"login": "gitgabrio", "name": "Gabriele Cardosi"}}, "url": "https://github.com/kiegroup/drools/commit/a7d45b5387610bded330018bd9888075e060b106", "committedDate": "2020-09-08T08:26:27Z", "message": "Merge remote-tracking branch 'origin/master' into DROOLS-5617"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "60da5f9fd76fc59c009996bbe6ac5237d87682f5", "author": {"user": {"login": "gitgabrio", "name": "Gabriele Cardosi"}}, "url": "https://github.com/kiegroup/drools/commit/60da5f9fd76fc59c009996bbe6ac5237d87682f5", "committedDate": "2020-09-08T12:27:50Z", "message": "Merge remote-tracking branch 'origin/master' into DROOLS-5617"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDg0NzI2MDUz", "url": "https://github.com/kiegroup/drools/pull/3084#pullrequestreview-484726053", "createdAt": "2020-09-09T07:21:00Z", "commit": {"oid": "60da5f9fd76fc59c009996bbe6ac5237d87682f5"}, "state": "APPROVED", "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0wOVQwNzoyMTowMVrOHO5-4g==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0wOVQwNzoyMzoxN1rOHO6Dlg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NTM5MjA5OA==", "bodyText": "Fix formatting", "url": "https://github.com/kiegroup/drools/pull/3084#discussion_r485392098", "createdAt": "2020-09-09T07:21:01Z", "author": {"login": "danielezonca"}, "path": "kie-pmml-trusty/kie-pmml-models/kie-pmml-models-mining/kie-pmml-models-mining-compiler/src/main/java/org/kie/pmml/models/mining/compiler/factories/KiePMMLSegmentationFactory.java", "diffHunk": "@@ -85,14 +86,16 @@ public static KiePMMLSegmentation getSegmentation(final DataDictionary dataDicti\n                                                                 final TransformationDictionary transformationDictionary,\n                                                                 final Segmentation segmentation,\n                                                                 final String segmentationName,\n-                                                                final KnowledgeBuilder kBuilder) {\n+                                                                final KnowledgeBuilder kBuilder,\n+                                                                final List<KiePMMLModel> nestedModels) {\n         logger.debug(\"getSegmentationSourcesMap {}\", segmentation);\n         final String packageName = getSanitizedPackageName(parentPackageName + \".\" + segmentationName);\n         final Map<String, String> toReturn = getSegmentsSourcesMap(packageName,\n                                                                   dataDictionary,\n                                                                   transformationDictionary,\n                                                                   segmentation.getSegments(),\n-                                                                  kBuilder);\n+                                                                  kBuilder,\n+                                                                   nestedModels);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "60da5f9fd76fc59c009996bbe6ac5237d87682f5"}, "originalPosition": 23}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NTM5MjY5OQ==", "bodyText": "Can you please add an assertion related to number of expected nested models?", "url": "https://github.com/kiegroup/drools/pull/3084#discussion_r485392699", "createdAt": "2020-09-09T07:22:12Z", "author": {"login": "danielezonca"}, "path": "kie-pmml-trusty/kie-pmml-models/kie-pmml-models-mining/kie-pmml-models-mining-compiler/src/test/java/org/kie/pmml/models/mining/compiler/factories/KiePMMLMiningModelFactoryTest.java", "diffHunk": "@@ -77,13 +81,16 @@ public void getKiePMMLMiningModel() {\n     @Test\n     public void getKiePMMLMiningModelSourcesMap() {\n         final String packageName = \"packagename\";\n+        final List<KiePMMLModel> nestedModels = new ArrayList<>();\n         final Map<String, String> retrieved = KiePMMLMiningModelFactory.getKiePMMLMiningModelSourcesMap(\n                                                                                                        DATA_DICTIONARY,\n                                                                                                        TRANSFORMATION_DICTIONARY,\n                                                                                                        MINING_MODEL,\n                                                                                                        packageName,\n-                                                                                                       KNOWLEDGE_BUILDER);\n+                                                                                                       KNOWLEDGE_BUILDER,\n+                                                                                                       nestedModels);\n         assertNotNull(retrieved);\n+        assertFalse(nestedModels.isEmpty());", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "60da5f9fd76fc59c009996bbe6ac5237d87682f5"}, "originalPosition": 40}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NTM5MzMwMg==", "bodyText": "Can you please add an assertion related to number of expected nested models?", "url": "https://github.com/kiegroup/drools/pull/3084#discussion_r485393302", "createdAt": "2020-09-09T07:23:17Z", "author": {"login": "danielezonca"}, "path": "kie-pmml-trusty/kie-pmml-models/kie-pmml-models-mining/kie-pmml-models-mining-compiler/src/test/java/org/kie/pmml/models/mining/compiler/factories/KiePMMLSegmentationFactoryTest.java", "diffHunk": "@@ -52,12 +56,15 @@ public void getSegmentation() {\n     public void getSegmentationSourcesMap() {\n         final String segmentationName = \"SEGMENTATION_NAME\";\n         final String packageName = \"packagename\";\n+        final List<KiePMMLModel> nestedModels = new ArrayList<>();\n         final Map<String, String> retrieved = KiePMMLSegmentationFactory.getSegmentationSourcesMap(packageName,\n                                                                                                    DATA_DICTIONARY,\n                                                                                                    TRANSFORMATION_DICTIONARY,\n                                                                                                    MINING_MODEL.getSegmentation(),\n                                                                                                    segmentationName,\n-                                                                                                   KNOWLEDGE_BUILDER);\n+                                                                                                   KNOWLEDGE_BUILDER,\n+                                                                                                   nestedModels);\n         assertNotNull(retrieved);\n+        assertFalse(nestedModels.isEmpty());", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "60da5f9fd76fc59c009996bbe6ac5237d87682f5"}, "originalPosition": 35}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "8213a6d408354f4b5d6eec4220706564d7719710", "author": {"user": {"login": "gitgabrio", "name": "Gabriele Cardosi"}}, "url": "https://github.com/kiegroup/drools/commit/8213a6d408354f4b5d6eec4220706564d7719710", "committedDate": "2020-09-10T09:00:19Z", "message": "[DROOLS-5617] Fixed as per PR suggestion"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "21dc4ff5a220b9cc5c856e3dd2ba7a8d70a13e76", "author": {"user": {"login": "gitgabrio", "name": "Gabriele Cardosi"}}, "url": "https://github.com/kiegroup/drools/commit/21dc4ff5a220b9cc5c856e3dd2ba7a8d70a13e76", "committedDate": "2020-09-10T09:00:52Z", "message": "Merge remote-tracking branch 'origin/master' into DROOLS-5617"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDg1NzY2MjI4", "url": "https://github.com/kiegroup/drools/pull/3084#pullrequestreview-485766228", "createdAt": "2020-09-10T09:48:23Z", "commit": {"oid": "21dc4ff5a220b9cc5c856e3dd2ba7a8d70a13e76"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1781, "cost": 1, "resetAt": "2021-11-01T15:33:45Z"}}}