{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDI0NTc1NjU4", "number": 2921, "title": "DROOLS-5331 & DROOLS-5078: Support for Enums in Rule Test Scenario", "bodyText": "@danielezonca @dupliaka Can you please review and test it?\nDescription of the PR will be provided into DROOLS-WB related PR\nRelated PR: kiegroup/drools-wb#1377\nThis PR fixes this ticket as well: https://issues.redhat.com/browse/DROOLS-5078\nI changed the error message: Impossible to parse  ..... is not natively supported. Please use an MVEL expression to use it\nhttps://issues.redhat.com/browse/BAPL-1617\nhttps://issues.redhat.com/browse/DROOLS-5331", "createdAt": "2020-05-28T15:46:34Z", "url": "https://github.com/kiegroup/drools/pull/2921", "merged": true, "mergeCommit": {"oid": "11b3b3161934c635a6d03ef4b397062fa7f491cb"}, "closed": true, "closedAt": "2020-06-03T15:05:58Z", "author": {"login": "yesamer"}, "timelineItems": {"totalCount": 18, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABclbMNPgH2gAyNDI0NTc1NjU4OjAyMjQzNDQ3NDRlNWYzYjEzN2EzY2RlMzJjNjRjNThkZTMxNTNkYTg=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcno4MzgFqTQyMzUxNTE5OA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "0224344744e5f3b137a3cde32c64c58de3153da8", "author": {"user": {"login": "yesamer", "name": "Yeser Amer"}}, "url": "https://github.com/kiegroup/drools/commit/0224344744e5f3b137a3cde32c64c58de3153da8", "committedDate": "2020-05-27T15:42:03Z", "message": "DROOLS-5331: Add isEnum check"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "796a1f9a7056b990913835193edb8e3de309f53a", "author": {"user": {"login": "yesamer", "name": "Yeser Amer"}}, "url": "https://github.com/kiegroup/drools/commit/796a1f9a7056b990913835193edb8e3de309f53a", "committedDate": "2020-05-27T22:54:10Z", "message": "DROOLS-5331: Managing Enums"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "308e7b9bfc496c76a9b9f48d758b8bcc8c2c4af3", "author": {"user": {"login": "yesamer", "name": "Yeser Amer"}}, "url": "https://github.com/kiegroup/drools/commit/308e7b9bfc496c76a9b9f48d758b8bcc8c2c4af3", "committedDate": "2020-05-28T14:48:28Z", "message": "DROOLS-5331: Managing Enums"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f593b2cd41d3d471878eba074a07aab8ac86ef8b", "author": {"user": {"login": "yesamer", "name": "Yeser Amer"}}, "url": "https://github.com/kiegroup/drools/commit/f593b2cd41d3d471878eba074a07aab8ac86ef8b", "committedDate": "2020-05-28T14:48:38Z", "message": "Merge remote-tracking branch 'origin/master' into DROOLS-5331"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "12a23b2e3ec9eb38401bea121357bf40dc50e581", "author": {"user": {"login": "yesamer", "name": "Yeser Amer"}}, "url": "https://github.com/kiegroup/drools/commit/12a23b2e3ec9eb38401bea121357bf40dc50e581", "committedDate": "2020-05-28T15:42:25Z", "message": "DROOLS-5331: Managing Enums"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b9493bf6382fff15fe9b7d525e7d5b26527c39d5", "author": {"user": {"login": "yesamer", "name": "Yeser Amer"}}, "url": "https://github.com/kiegroup/drools/commit/b9493bf6382fff15fe9b7d525e7d5b26527c39d5", "committedDate": "2020-05-28T15:43:51Z", "message": "DROOLS-5331: Tests"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "cfb1ef9377e566a7af5f3a1fe9d98553c5886672", "author": {"user": {"login": "yesamer", "name": "Yeser Amer"}}, "url": "https://github.com/kiegroup/drools/commit/cfb1ef9377e566a7af5f3a1fe9d98553c5886672", "committedDate": "2020-05-28T15:48:56Z", "message": "DROOLS-5331: Tests"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "1a31a6631bc882716e23b03109f510910a1fc141", "author": {"user": {"login": "yesamer", "name": "Yeser Amer"}}, "url": "https://github.com/kiegroup/drools/commit/1a31a6631bc882716e23b03109f510910a1fc141", "committedDate": "2020-05-29T12:55:13Z", "message": "Merge remote-tracking branch 'origin/master' into DROOLS-5331"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDIwOTA5Njkx", "url": "https://github.com/kiegroup/drools/pull/2921#pullrequestreview-420909691", "createdAt": "2020-05-29T12:34:53Z", "commit": {"oid": "cfb1ef9377e566a7af5f3a1fe9d98553c5886672"}, "state": "COMMENTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yOVQxMjozNDo1M1rOGca0MQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yOVQxMzoyNjoyOFrOGcci-Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMjQ1MjY1Nw==", "bodyText": "I think this method is quite misleading compared to similar n this utils (isList, isMap etc): all the others accept \"target\" class while this method works only if the parameter is the parent class. What about at least change the name?", "url": "https://github.com/kiegroup/drools/pull/2921#discussion_r432452657", "createdAt": "2020-05-29T12:34:53Z", "author": {"login": "danielezonca"}, "path": "drools-scenario-simulation/drools-scenario-simulation-api/src/main/java/org/drools/scenariosimulation/api/utils/ScenarioSimulationSharedUtils.java", "diffHunk": "@@ -56,4 +60,13 @@ public static boolean isMap(String className) {\n                 HashMap.class.getCanonicalName().equals(className) ||\n                 LinkedHashMap.class.getCanonicalName().equals(className);\n     }\n+\n+    /**\n+     * Returns true if given string equals to canonical name of <code>java.lang.Enum</code>\n+     * @param className\n+     * @return\n+     */\n+    public static boolean isEnum(String className) {\n+        return Enum.class.getCanonicalName().equals(className);\n+    }", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "cfb1ef9377e566a7af5f3a1fe9d98553c5886672"}, "originalPosition": 23}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMjQ4MTAxNw==", "bodyText": "Can you please add DROOLS-5078 to the title of this PR :)", "url": "https://github.com/kiegroup/drools/pull/2921#discussion_r432481017", "createdAt": "2020-05-29T13:26:28Z", "author": {"login": "danielezonca"}, "path": "drools-scenario-simulation/drools-scenario-simulation-backend/src/main/java/org/drools/scenariosimulation/backend/util/ScenarioBeanUtil.java", "diffHunk": "@@ -178,13 +178,18 @@ public static Object convertValue(String className, Object cleanValue, ClassLoad\n                 return Short.parseShort(cleanStringForNumberParsing(value));\n             } else if (clazz.isAssignableFrom(LocalDate.class)) {\n                 return LocalDate.parse(value, DateTimeFormatter.ofPattern(\"yyyy-MM-dd\"));\n+            } else if (Enum.class.isAssignableFrom(clazz)) {\n+                return Enum.valueOf(((Class<? extends Enum>) clazz), value);\n             }\n         } catch (RuntimeException e) {\n-            throw new IllegalArgumentException(new StringBuilder().append(\"Impossible to parse '\").append(value).append(\"' as \").append(className).append(\" [\").append(e.getMessage()).append(\"]\").toString());\n+            throw new IllegalArgumentException(new StringBuilder().append(\"Impossible to parse '\")\n+                                                       .append(value).append(\"' as \").append(className).append(\" [\")\n+                                                       .append(e.getMessage()).append(\"]\").toString());\n         }\n \n         throw new IllegalArgumentException(new StringBuilder().append(\"Class \").append(className)\n-                                                   .append(\" is not supported\").toString());\n+                                                   .append(\" is not natively supported. Please use an MVEL expression\" +\n+                                                                   \" to use it.\").toString());", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "cfb1ef9377e566a7af5f3a1fe9d98553c5886672"}, "originalPosition": 17}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "62a533e78703eb62c01107874ef37b049b8f94a0", "author": {"user": {"login": "yesamer", "name": "Yeser Amer"}}, "url": "https://github.com/kiegroup/drools/commit/62a533e78703eb62c01107874ef37b049b8f94a0", "committedDate": "2020-06-01T06:42:45Z", "message": "DROOLS-5331: Changes required after CR"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "9c438dfcaf92aaa3b649dc631055fc6792381f32", "author": {"user": {"login": "yesamer", "name": "Yeser Amer"}}, "url": "https://github.com/kiegroup/drools/commit/9c438dfcaf92aaa3b649dc631055fc6792381f32", "committedDate": "2020-06-01T06:42:54Z", "message": "Merge remote-tracking branch 'origin/master' into DROOLS-5331"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDIxNzQ5ODg3", "url": "https://github.com/kiegroup/drools/pull/2921#pullrequestreview-421749887", "createdAt": "2020-06-01T10:43:02Z", "commit": {"oid": "9c438dfcaf92aaa3b649dc631055fc6792381f32"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wMVQxMDo0MzowM1rOGdGMtQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wMVQxMDo0MzowM1rOGdGMtQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMzE2MzQ0NQ==", "bodyText": "Just an idea: maybe we can provide a link for MVEL expression? BCS well as I understand that not every illegal argument could be replaced by MVEL.", "url": "https://github.com/kiegroup/drools/pull/2921#discussion_r433163445", "createdAt": "2020-06-01T10:43:03Z", "author": {"login": "dupliaka"}, "path": "drools-scenario-simulation/drools-scenario-simulation-backend/src/main/java/org/drools/scenariosimulation/backend/util/ScenarioBeanUtil.java", "diffHunk": "@@ -178,13 +178,18 @@ public static Object convertValue(String className, Object cleanValue, ClassLoad\n                 return Short.parseShort(cleanStringForNumberParsing(value));\n             } else if (clazz.isAssignableFrom(LocalDate.class)) {\n                 return LocalDate.parse(value, DateTimeFormatter.ofPattern(\"yyyy-MM-dd\"));\n+            } else if (Enum.class.isAssignableFrom(clazz)) {\n+                return Enum.valueOf(((Class<? extends Enum>) clazz), value);\n             }\n         } catch (RuntimeException e) {\n-            throw new IllegalArgumentException(new StringBuilder().append(\"Impossible to parse '\").append(value).append(\"' as \").append(className).append(\" [\").append(e.getMessage()).append(\"]\").toString());\n+            throw new IllegalArgumentException(new StringBuilder().append(\"Impossible to parse '\")\n+                                                       .append(value).append(\"' as \").append(className).append(\" [\")\n+                                                       .append(e.getMessage()).append(\"]\").toString());\n         }\n \n         throw new IllegalArgumentException(new StringBuilder().append(\"Class \").append(className)\n-                                                   .append(\" is not supported\").toString());\n+                                                   .append(\" is not natively supported. Please use an MVEL expression\" +", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "9c438dfcaf92aaa3b649dc631055fc6792381f32"}, "originalPosition": 16}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDIxNzcxMDAy", "url": "https://github.com/kiegroup/drools/pull/2921#pullrequestreview-421771002", "createdAt": "2020-06-01T11:23:56Z", "commit": {"oid": "9c438dfcaf92aaa3b649dc631055fc6792381f32"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wMVQxMToyMzo1NlrOGdHMMA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wMVQxMToyMzo1NlrOGdHMMA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMzE3OTY5Ng==", "bodyText": "Suggestion:\nFrom my perspective that looks a bit like code repetition.\nWould you please tell me why cant we use\n        assertTrue(ScenarioSimulationSharedUtils.isEnumCanonicalName(\"java.lang.Enum\")); assertFalse(ScenarioSimulationSharedUtils.isEnumCanonicalName(\"Enum\"));", "url": "https://github.com/kiegroup/drools/pull/2921#discussion_r433179696", "createdAt": "2020-06-01T11:23:56Z", "author": {"login": "dupliaka"}, "path": "drools-scenario-simulation/drools-scenario-simulation-api/src/test/java/org/drools/scenariosimulation/api/utils/ScenarioSimulationSharedUtilsTest.java", "diffHunk": "@@ -52,4 +52,9 @@ public void isList() {\n     public void isMap() {\n         assertTrue(mapValues.stream().allMatch(ScenarioSimulationSharedUtils::isMap));\n     }\n+\n+    @Test\n+    public void isEnumCanonicalName() {\n+        assertTrue(ScenarioSimulationSharedUtils.isEnumCanonicalName(Enum.class.getCanonicalName()));\n+    }", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "9c438dfcaf92aaa3b649dc631055fc6792381f32"}, "originalPosition": 8}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "8948ec17ad1898864e176ea0d7c022e0ab38bebf", "author": {"user": {"login": "yesamer", "name": "Yeser Amer"}}, "url": "https://github.com/kiegroup/drools/commit/8948ec17ad1898864e176ea0d7c022e0ab38bebf", "committedDate": "2020-06-01T11:29:57Z", "message": "DROOLS-5331: Changes required after CR"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ad761b7109811ebd753397f4d67654d843d41e17", "author": {"user": {"login": "yesamer", "name": "Yeser Amer"}}, "url": "https://github.com/kiegroup/drools/commit/ad761b7109811ebd753397f4d67654d843d41e17", "committedDate": "2020-06-01T11:30:35Z", "message": "Merge remote-tracking branch 'origin/master' into DROOLS-5331"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDIxNzc1MjUx", "url": "https://github.com/kiegroup/drools/pull/2921#pullrequestreview-421775251", "createdAt": "2020-06-01T11:32:19Z", "commit": {"oid": "9c438dfcaf92aaa3b649dc631055fc6792381f32"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "1d255651c813f94c4e7ff164191989ea33478188", "author": {"user": {"login": "yesamer", "name": "Yeser Amer"}}, "url": "https://github.com/kiegroup/drools/commit/1d255651c813f94c4e7ff164191989ea33478188", "committedDate": "2020-06-03T09:42:57Z", "message": "Merge remote-tracking branch 'origin/master' into DROOLS-5331"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDIzNTE1MTk4", "url": "https://github.com/kiegroup/drools/pull/2921#pullrequestreview-423515198", "createdAt": "2020-06-03T12:46:43Z", "commit": {"oid": "1d255651c813f94c4e7ff164191989ea33478188"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1556, "cost": 1, "resetAt": "2021-11-01T15:33:45Z"}}}