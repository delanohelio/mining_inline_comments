{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDc3NjYxOTYz", "number": 3073, "reviewThreads": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0wM1QxMDowNzo0OFrOEf67eQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0wM1QxMDoxMDoyOFrOEf6_Hg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzAxOTA2ODA5OnYy", "diffSide": "RIGHT", "path": "kie-dmn/kie-dmn-core/src/main/resources/org/kie/dmn/core/impl/DMNTypeSafeTypeTemplate.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0wM1QxMDowNzo0OFrOHMfr9w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0wN1QwODo0MDo0MFrOHN2LSg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4Mjg2NDExOQ==", "bodyText": "@tkobayas definitely worth a separate ticket, but noticing now PropertyType is a placeholder not following the $name$ convention. Could you kindly record and separately revise this to become $PropertyType$, please? I believe requires changes only in this template and here: \n  \n    \n      drools/kie-dmn/kie-dmn-core/src/main/java/org/kie/dmn/typesafe/DMNDeclaredField.java\n    \n    \n         Line 195\n      in\n      a91703d\n    \n    \n    \n    \n\n        \n          \n           return n.toString().equals(\"PropertyType\"); \n        \n    \n  \n\n\nplease notice, imho, the \"<PROPERTY_NAME>\" is fine as-is, as that's a different kind of placeholder used by another processing \"stage\".\n@lucamolteni can comment if agree or other ideas here too.", "url": "https://github.com/kiegroup/drools/pull/3073#discussion_r482864119", "createdAt": "2020-09-03T10:07:48Z", "author": {"login": "tarilabs"}, "path": "kie-dmn/kie-dmn-core/src/main/resources/org/kie/dmn/core/impl/DMNTypeSafeTypeTemplate.java", "diffHunk": "@@ -57,15 +57,7 @@ void fromMap(Map<String, Object> values) {\n             Object propertyValues = values.get(\"$property$\");\n             if(propertyValues != null) {\n                 $property$ = new java.util.ArrayList<>();\n-                for (Object v : (java.util.Collection<Object>) propertyValues) {\n-                    if (v instanceof PropertyType) {\n-                        $property$.add((PropertyType)v);\n-                    } else {\n-                        PropertyType item = new PropertyType();\n-                        item.fromMap((java.util.Map<String, Object>)v);\n-                        $property$.add(item);\n-                    }\n-                }\n+                processCompositeCollection($property$, (java.util.Collection)propertyValues, PropertyType.class);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "9e82eb0e8e000c98dd2e3bb3c9fcd377ef0aa4a4"}, "originalPosition": 13}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NDI4MTE2Mg==", "bodyText": "@tarilabs Sure! I have filed https://issues.redhat.com/browse/DROOLS-5623", "url": "https://github.com/kiegroup/drools/pull/3073#discussion_r484281162", "createdAt": "2020-09-07T08:40:40Z", "author": {"login": "tkobayas"}, "path": "kie-dmn/kie-dmn-core/src/main/resources/org/kie/dmn/core/impl/DMNTypeSafeTypeTemplate.java", "diffHunk": "@@ -57,15 +57,7 @@ void fromMap(Map<String, Object> values) {\n             Object propertyValues = values.get(\"$property$\");\n             if(propertyValues != null) {\n                 $property$ = new java.util.ArrayList<>();\n-                for (Object v : (java.util.Collection<Object>) propertyValues) {\n-                    if (v instanceof PropertyType) {\n-                        $property$.add((PropertyType)v);\n-                    } else {\n-                        PropertyType item = new PropertyType();\n-                        item.fromMap((java.util.Map<String, Object>)v);\n-                        $property$.add(item);\n-                    }\n-                }\n+                processCompositeCollection($property$, (java.util.Collection)propertyValues, PropertyType.class);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4Mjg2NDExOQ=="}, "originalCommit": {"oid": "9e82eb0e8e000c98dd2e3bb3c9fcd377ef0aa4a4"}, "originalPosition": 13}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzAxOTA3NTAzOnYy", "diffSide": "RIGHT", "path": "kie-dmn/kie-dmn-core/src/main/resources/org/kie/dmn/core/impl/DMNTypeSafeTypeTemplate.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0wM1QxMDowOTo0OFrOHMfwLQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0wM1QxMDowOTo0OFrOHMfwLQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4Mjg2NTE5Nw==", "bodyText": "lgtm, thanks! \ud83d\udc4d", "url": "https://github.com/kiegroup/drools/pull/3073#discussion_r482865197", "createdAt": "2020-09-03T10:09:48Z", "author": {"login": "tarilabs"}, "path": "kie-dmn/kie-dmn-core/src/main/resources/org/kie/dmn/core/impl/DMNTypeSafeTypeTemplate.java", "diffHunk": "@@ -81,4 +73,23 @@ void fromMap(Map<String, Object> values) {\n         }\n     }\n \n+    void processCompositeCollection(java.util.Collection destCol, java.util.Collection srcCol, Class<?> baseClass) {\n+        for (Object v : (java.util.Collection<Object>) srcCol) {\n+            if (v instanceof java.util.Collection) {\n+                java.util.Collection innerDestcol = new java.util.ArrayList();\n+                processCompositeCollection(innerDestcol, (java.util.Collection) v, baseClass);\n+                destCol.add(innerDestcol);\n+            } else if (baseClass.isAssignableFrom(v.getClass())) {\n+                destCol.add(v);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "9e82eb0e8e000c98dd2e3bb3c9fcd377ef0aa4a4"}, "originalPosition": 28}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzAxOTA3NzQyOnYy", "diffSide": "RIGHT", "path": "kie-dmn/kie-dmn-core/src/main/resources/org/kie/dmn/core/impl/DMNTypeSafeTypeTemplate.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0wM1QxMDoxMDoyOFrOHMfxpA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0wN1QwODo0Mzo0NFrOHN2Shg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4Mjg2NTU3Mg==", "bodyText": "this is fine, but it's not clear to me why this cannot be simply as\n                        PropertyType item = new PropertyType();\t\n                        item.fromMap((java.util.Map<String, Object>)v);\t\n                        $property$.add(item);\n\nas it was before, please?", "url": "https://github.com/kiegroup/drools/pull/3073#discussion_r482865572", "createdAt": "2020-09-03T10:10:28Z", "author": {"login": "tarilabs"}, "path": "kie-dmn/kie-dmn-core/src/main/resources/org/kie/dmn/core/impl/DMNTypeSafeTypeTemplate.java", "diffHunk": "@@ -81,4 +73,23 @@ void fromMap(Map<String, Object> values) {\n         }\n     }\n \n+    void processCompositeCollection(java.util.Collection destCol, java.util.Collection srcCol, Class<?> baseClass) {\n+        for (Object v : (java.util.Collection<Object>) srcCol) {\n+            if (v instanceof java.util.Collection) {\n+                java.util.Collection innerDestcol = new java.util.ArrayList();\n+                processCompositeCollection(innerDestcol, (java.util.Collection) v, baseClass);\n+                destCol.add(innerDestcol);\n+            } else if (baseClass.isAssignableFrom(v.getClass())) {\n+                destCol.add(v);\n+            } else {\n+                try {\n+                    org.kie.dmn.api.core.FEELPropertyAccessible item = (org.kie.dmn.api.core.FEELPropertyAccessible) baseClass.newInstance();\n+                    item.fromMap((java.util.Map<String, Object>) v);\n+                    destCol.add(item);\n+                } catch (InstantiationException | IllegalAccessException e) {\n+                    throw new org.kie.dmn.typesafe.DMNTypeSafeException(e);\n+                }", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "9e82eb0e8e000c98dd2e3bb3c9fcd377ef0aa4a4"}, "originalPosition": 36}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NDI4MzAxNA==", "bodyText": "@tarilabs processCompositeCollection() is a separate method because we want to invoke it recursively. Then, if we use a placeholder for replacement in the method, we would need to generate processCompositeCollection method per property (just like the statement blocks in fromMap()). By not using a placeholder, we can have only one processCompositeCollection() in a class. :)", "url": "https://github.com/kiegroup/drools/pull/3073#discussion_r484283014", "createdAt": "2020-09-07T08:43:44Z", "author": {"login": "tkobayas"}, "path": "kie-dmn/kie-dmn-core/src/main/resources/org/kie/dmn/core/impl/DMNTypeSafeTypeTemplate.java", "diffHunk": "@@ -81,4 +73,23 @@ void fromMap(Map<String, Object> values) {\n         }\n     }\n \n+    void processCompositeCollection(java.util.Collection destCol, java.util.Collection srcCol, Class<?> baseClass) {\n+        for (Object v : (java.util.Collection<Object>) srcCol) {\n+            if (v instanceof java.util.Collection) {\n+                java.util.Collection innerDestcol = new java.util.ArrayList();\n+                processCompositeCollection(innerDestcol, (java.util.Collection) v, baseClass);\n+                destCol.add(innerDestcol);\n+            } else if (baseClass.isAssignableFrom(v.getClass())) {\n+                destCol.add(v);\n+            } else {\n+                try {\n+                    org.kie.dmn.api.core.FEELPropertyAccessible item = (org.kie.dmn.api.core.FEELPropertyAccessible) baseClass.newInstance();\n+                    item.fromMap((java.util.Map<String, Object>) v);\n+                    destCol.add(item);\n+                } catch (InstantiationException | IllegalAccessException e) {\n+                    throw new org.kie.dmn.typesafe.DMNTypeSafeException(e);\n+                }", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4Mjg2NTU3Mg=="}, "originalCommit": {"oid": "9e82eb0e8e000c98dd2e3bb3c9fcd377ef0aa4a4"}, "originalPosition": 36}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2304, "cost": 1, "resetAt": "2021-11-12T20:28:25Z"}}}