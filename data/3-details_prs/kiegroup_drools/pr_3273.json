{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTMwMzk5MTg3", "number": 3273, "title": "[Drools 5867] - Update ApplyPmmlModelCommand to manage both PMML implementations", "bodyText": "@danielezonca @mariofusco @jiripetrlik\nSee https://issues.redhat.com/browse/DROOLS-5867", "createdAt": "2020-12-01T15:49:31Z", "url": "https://github.com/kiegroup/drools/pull/3273", "merged": true, "mergeCommit": {"oid": "3e5fd82980b8b1d2524735841555d6d23a3c784a"}, "closed": true, "closedAt": "2020-12-09T09:04:01Z", "author": {"login": "gitgabrio"}, "timelineItems": {"totalCount": 17, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdh4b93AH2gAyNTMwMzk5MTg3OmZkOWZiNDk2NzY5MTY5OTFhMjI2ZWJiYTgzMmUwMTA1OTZkMjYyYTA=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdi3fZcAFqTU0NDk0NDEyNQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "fd9fb49676916991a226ebba832e010596d262a0", "author": {"user": {"login": "gitgabrio", "name": "Gabriele Cardosi"}}, "url": "https://github.com/kiegroup/drools/commit/fd9fb49676916991a226ebba832e010596d262a0", "committedDate": "2020-12-01T11:41:58Z", "message": "[DROOLS-5867] Implemented PMMLCommandExecutorImpl and PMMLCommandExecutorFactoryImpl. Updated kie.conf"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "0b82658497c393983db1c14e1f9aaac486796683", "author": {"user": {"login": "gitgabrio", "name": "Gabriele Cardosi"}}, "url": "https://github.com/kiegroup/drools/commit/0b82658497c393983db1c14e1f9aaac486796683", "committedDate": "2020-12-01T13:56:00Z", "message": "[DROOLS-5867] Using static method inside PMMLAssemblerServices. Fixed kie.conf"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "7fdd09e1fd8fc9a464846d8ab81e5c15ad5a4e12", "author": {"user": {"login": "gitgabrio", "name": "Gabriele Cardosi"}}, "url": "https://github.com/kiegroup/drools/commit/7fdd09e1fd8fc9a464846d8ab81e5c15ad5a4e12", "committedDate": "2020-12-01T15:21:44Z", "message": "[DROOLS-5867] Update for PMMLImplementationsUtil refactoring"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "9c9fee325aa2a7f2ed7794efc6b067b1236471a5", "author": {"user": {"login": "gitgabrio", "name": "Gabriele Cardosi"}}, "url": "https://github.com/kiegroup/drools/commit/9c9fee325aa2a7f2ed7794efc6b067b1236471a5", "committedDate": "2020-12-01T15:42:46Z", "message": "[DROOLS-5867] Implemented/updated ApplyPmmlModelCommand and related test. Cleanup."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "dea58dac5fe8cfac7930f4596967d977179147b9", "author": {"user": {"login": "gitgabrio", "name": "Gabriele Cardosi"}}, "url": "https://github.com/kiegroup/drools/commit/dea58dac5fe8cfac7930f4596967d977179147b9", "committedDate": "2020-12-02T10:18:09Z", "message": "[DROOLS-5867] Retrieving Classloader from Context."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTQyNzE4Mjk1", "url": "https://github.com/kiegroup/drools/pull/3273#pullrequestreview-542718295", "createdAt": "2020-12-02T10:55:12Z", "commit": {"oid": "dea58dac5fe8cfac7930f4596967d977179147b9"}, "state": "COMMENTED", "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0wMlQxMDo1NToxMlrOH9VY6g==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0wMlQxMDo1Njo1NlrOH9VdOA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNDA3NTYyNg==", "bodyText": "What about something similar to\n\n  \n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                    KieSession kieSession = registryContext.lookup(KieSession.class);\n          \n          \n            \n                    InternalKnowledgeBase kieBase = (InternalKnowledgeBase) kieSession.getKieBase();\n          \n          \n            \n                    return kieBase.getRootClassLoader();\n          \n          \n            \n                    try {\n          \n          \n            \n                        KieSession kieSession = registryContext.lookup(KieSession.class);\n          \n          \n            \n                        InternalKnowledgeBase kieBase = (InternalKnowledgeBase) kieSession.getKieBase();\n          \n          \n            \n                        return kieBase.getRootClassLoader();\n          \n          \n            \n                    catch (Exception e) {\n          \n          \n            \n                        logger.warn(\"Impossible to retrieve RootClassLoader, using ContextClassLoader [\" + e.getMessage() + \"]\", e);\n          \n          \n            \n                        return Thread.currentThread().getContextClassLoader();\n          \n          \n            \n                    }", "url": "https://github.com/kiegroup/drools/pull/3273#discussion_r534075626", "createdAt": "2020-12-02T10:55:12Z", "author": {"login": "danielezonca"}, "path": "drools-core/src/main/java/org/drools/core/command/runtime/pmml/ApplyPmmlModelCommand.java", "diffHunk": "@@ -119,6 +127,36 @@ public void setOutIdentifier(String outIdentifier) {\n     \n     @Override\n     public PMML4Result execute(Context context) {\n+        if (requestData == null) {\n+            throw new IllegalStateException(\"ApplyPmmlModelCommand requires request data (PMMLRequestData) to execute\");\n+        }\n+        final PMMLConstants toInvoke = getToInvoke(context);\n+        switch (toInvoke) {\n+            case NEW:\n+                return executePMMLTrusty();\n+            case LEGACY:\n+                return executePMMLLegacy(context);\n+            default:\n+                throw new RuntimeException(\"Unmanaged PMMLConstants \" + toInvoke);\n+        }\n+    }\n+\n+    protected PMMLConstants getToInvoke(Context context) {\n+        ClassLoader classLoader = getClassLoader((RegistryContext)context);\n+        return toEnable(classLoader);\n+    }\n+\n+    private ClassLoader getClassLoader(RegistryContext registryContext) {\n+        KieSession kieSession = registryContext.lookup(KieSession.class);\n+        InternalKnowledgeBase kieBase = (InternalKnowledgeBase) kieSession.getKieBase();\n+        return kieBase.getRootClassLoader();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "dea58dac5fe8cfac7930f4596967d977179147b9"}, "originalPosition": 48}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNDA3NjYxMw==", "bodyText": "Please don't use Test suffix otherwise Maven will consider this class as a test class and try to load. What about Mock instead?", "url": "https://github.com/kiegroup/drools/pull/3273#discussion_r534076613", "createdAt": "2020-12-02T10:56:46Z", "author": {"login": "danielezonca"}, "path": "drools-ruleunit/src/test/java/org/drools/ruleunit/command/pmml/mock/PMMLCommandExecutorFactoryTest.java", "diffHunk": "@@ -0,0 +1,27 @@\n+/*\n+ * Copyright 2020 Red Hat, Inc. and/or its affiliates.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+package org.drools.ruleunit.command.pmml.mock;\n+\n+import org.kie.internal.pmml.PMMLCommandExecutor;\n+import org.kie.internal.pmml.PMMLCommandExecutorFactory;\n+\n+public class PMMLCommandExecutorFactoryTest implements PMMLCommandExecutorFactory {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "dea58dac5fe8cfac7930f4596967d977179147b9"}, "originalPosition": 21}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNDA3NjcyOA==", "bodyText": "Same as above", "url": "https://github.com/kiegroup/drools/pull/3273#discussion_r534076728", "createdAt": "2020-12-02T10:56:56Z", "author": {"login": "danielezonca"}, "path": "drools-ruleunit/src/test/java/org/drools/ruleunit/command/pmml/mock/PMMLCommandExecutorTest.java", "diffHunk": "@@ -0,0 +1,30 @@\n+/*\n+ * Copyright 2020 Red Hat, Inc. and/or its affiliates.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+package org.drools.ruleunit.command.pmml.mock;\n+\n+import org.kie.api.pmml.PMML4Result;\n+import org.kie.api.pmml.PMMLRequestData;\n+import org.kie.internal.pmml.PMMLCommandExecutor;\n+\n+public class PMMLCommandExecutorTest implements PMMLCommandExecutor {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "dea58dac5fe8cfac7930f4596967d977179147b9"}, "originalPosition": 22}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "daddc2d66c0789eea87838e1af0d4d53004abe67", "author": {"user": {"login": "gitgabrio", "name": "Gabriele Cardosi"}}, "url": "https://github.com/kiegroup/drools/commit/daddc2d66c0789eea87838e1af0d4d53004abe67", "committedDate": "2020-12-02T14:54:50Z", "message": "[DROOLS-5867] Fixed as per PR requests"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "977a71dc075d79d637add733de0a4614bac05c6b", "author": {"user": {"login": "gitgabrio", "name": "Gabriele Cardosi"}}, "url": "https://github.com/kiegroup/drools/commit/977a71dc075d79d637add733de0a4614bac05c6b", "committedDate": "2020-12-03T09:12:22Z", "message": "Merge remote-tracking branch 'origin/master' into DROOLS-5867"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTQzODA4MTAy", "url": "https://github.com/kiegroup/drools/pull/3273#pullrequestreview-543808102", "createdAt": "2020-12-03T10:24:05Z", "commit": {"oid": "1fd4b69e23b6e7ce52354a22892f9151d4031774"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "df204d7489d4cdf7c34ec10bc64e6de733424e54", "author": {"user": {"login": "gitgabrio", "name": "Gabriele Cardosi"}}, "url": "https://github.com/kiegroup/drools/commit/df204d7489d4cdf7c34ec10bc64e6de733424e54", "committedDate": "2020-12-03T11:58:00Z", "message": "[DROOLS-5867] Fixing as per SONAR suggestion"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c11523eb39638721930ca6e221fd1336084bf572", "author": {"user": {"login": "gitgabrio", "name": "Gabriele Cardosi"}}, "url": "https://github.com/kiegroup/drools/commit/c11523eb39638721930ca6e221fd1336084bf572", "committedDate": "2020-12-03T11:58:13Z", "message": "[DROOLS-5867] Fixing as per SONAR suggestion"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "198dc27dd077608b70744c0bdc1735d75614baaa", "author": {"user": {"login": "gitgabrio", "name": "Gabriele Cardosi"}}, "url": "https://github.com/kiegroup/drools/commit/198dc27dd077608b70744c0bdc1735d75614baaa", "committedDate": "2020-12-03T11:58:21Z", "message": "[DROOLS-5867] Rollback method implementation"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "0750b8f175f5c0a74eb14cd57089248f6324b200", "author": {"user": {"login": "gitgabrio", "name": "Gabriele Cardosi"}}, "url": "https://github.com/kiegroup/drools/commit/0750b8f175f5c0a74eb14cd57089248f6324b200", "committedDate": "2020-12-03T11:32:22Z", "message": "[DROOLS-5878] Fixing as per SONAR suggestion"}, "afterCommit": {"oid": "198dc27dd077608b70744c0bdc1735d75614baaa", "author": {"user": {"login": "gitgabrio", "name": "Gabriele Cardosi"}}, "url": "https://github.com/kiegroup/drools/commit/198dc27dd077608b70744c0bdc1735d75614baaa", "committedDate": "2020-12-03T11:58:21Z", "message": "[DROOLS-5867] Rollback method implementation"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a2a0a8fa850a5744e790f7d005afd35fbff56a23", "author": {"user": {"login": "gitgabrio", "name": "Gabriele Cardosi"}}, "url": "https://github.com/kiegroup/drools/commit/a2a0a8fa850a5744e790f7d005afd35fbff56a23", "committedDate": "2020-12-03T15:25:51Z", "message": "Merge remote-tracking branch 'origin/master' into DROOLS-5867\n\n# Conflicts:\n#\tdrools-ruleunit/src/test/java/org/drools/ruleunit/command/pmml/ApplyPmmlModelCommandTest.java"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTQ0MDgzOTIy", "url": "https://github.com/kiegroup/drools/pull/3273#pullrequestreview-544083922", "createdAt": "2020-12-03T15:31:56Z", "commit": {"oid": "a2a0a8fa850a5744e790f7d005afd35fbff56a23"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "20cc58fc9594863cd39533c56e07e6dd460b891a", "author": {"user": {"login": "gitgabrio", "name": "Gabriele Cardosi"}}, "url": "https://github.com/kiegroup/drools/commit/20cc58fc9594863cd39533c56e07e6dd460b891a", "committedDate": "2020-12-03T16:21:22Z", "message": "[DROOLS-5867] Switching to org.kie.internal.pmml.PMMLImplementationsUtil.isjPMMLAvailableToClassLoader method"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTQ0OTQ0MTI1", "url": "https://github.com/kiegroup/drools/pull/3273#pullrequestreview-544944125", "createdAt": "2020-12-04T13:09:45Z", "commit": {"oid": "20cc58fc9594863cd39533c56e07e6dd460b891a"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1674, "cost": 1, "resetAt": "2021-11-01T15:33:45Z"}}}