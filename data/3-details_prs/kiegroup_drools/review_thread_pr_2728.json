{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0MzY0ODEwODYw", "number": 2728, "reviewThreads": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0yMlQxODoxMTowN1rODZ7VWQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0yM1QwNzoxOToxMFrODaEnzQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjI4NTEzMTEzOnYy", "diffSide": "RIGHT", "path": "drools-workbench-models/drools-workbench-models-commons/src/main/java/org/drools/workbench/models/commons/backend/rule/RuleModelDRLPersistenceImpl.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0yMlQxODoxMTowN1rOFgl62A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0yMlQxODoxMTowN1rOFgl62A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2OTcyMDAyNA==", "bodyText": "I think we use instanceof in many places. Is is possible to change this to use it for consistency or is the isAssignableFrom check needed?", "url": "https://github.com/kiegroup/drools/pull/2728#discussion_r369720024", "createdAt": "2020-01-22T18:11:07Z", "author": {"login": "Rikkola"}, "path": "drools-workbench-models/drools-workbench-models-commons/src/main/java/org/drools/workbench/models/commons/backend/rule/RuleModelDRLPersistenceImpl.java", "diffHunk": "@@ -4291,6 +4292,17 @@ public FieldConstraint asFieldConstraint(final RuleModel m,\n                 comp.addConstraint(expr.asFieldConstraint(m,\n                                                           factPattern));\n             }\n+            String fieldName = \"\";\n+            for (FieldConstraint field : comp.getConstraints()) {\n+                if (SingleFieldConstraint.class.isAssignableFrom(field.getClass())) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "e5980649db9174f9b4b54cd17874805c865e00f1"}, "originalPosition": 14}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjI4NjY0ODA4OnYy", "diffSide": "RIGHT", "path": "drools-workbench-models/drools-workbench-models-commons/src/main/java/org/drools/workbench/models/commons/backend/rule/RuleModelDRLPersistenceImpl.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0yM1QwNzoxNjowOVrOFg0kdw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0yM1QwNzoxNjowOVrOFg0kdw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2OTk2MDA1NQ==", "bodyText": "Please simplify this as:\nif (StringUtils.isEmpty(constraint.getFieldName()) \n        && (Objects.equals(constraint.getOperator(), \"matches\") || Objects.equals(constraint.getOperator(), \"not matches\"))) {", "url": "https://github.com/kiegroup/drools/pull/2728#discussion_r369960055", "createdAt": "2020-01-23T07:16:09Z", "author": {"login": "jomarko"}, "path": "drools-workbench-models/drools-workbench-models-commons/src/main/java/org/drools/workbench/models/commons/backend/rule/RuleModelDRLPersistenceImpl.java", "diffHunk": "@@ -4291,6 +4292,17 @@ public FieldConstraint asFieldConstraint(final RuleModel m,\n                 comp.addConstraint(expr.asFieldConstraint(m,\n                                                           factPattern));\n             }\n+            String fieldName = \"\";\n+            for (FieldConstraint field : comp.getConstraints()) {\n+                if (field instanceof SingleFieldConstraint) {\n+                    SingleFieldConstraint constraint = (SingleFieldConstraint) field;\n+                    if (StringUtils.isEmpty(constraint.getFieldName()) && !StringUtils.isEmpty(constraint.getOperator())\n+                            && (constraint.getOperator().equals(\"matches\") || constraint.getOperator().equals(\"not matches\"))) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "2948863ffeea0a8bc4352dc0f1cf7413a6d0858f"}, "originalPosition": 17}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjI4NjY1MjkzOnYy", "diffSide": "RIGHT", "path": "drools-workbench-models/drools-workbench-models-commons/src/test/java/org/drools/workbench/models/commons/backend/rule/RuleModelDRLPersistenceTest.java", "isResolved": false, "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0yM1QwNzoxOToxMVrOFg0ndQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0yM1QxMzozNDozOFrOFg-QEQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2OTk2MDgyMQ==", "bodyText": "Maybe this would be good to mention also in RuleModelDRLPersistenceImpl, or wrap the new code there into some private method with some meaningful name. The name of the test is nice - helps to explain what is ongoing.", "url": "https://github.com/kiegroup/drools/pull/2728#discussion_r369960821", "createdAt": "2020-01-23T07:19:11Z", "author": {"login": "jomarko"}, "path": "drools-workbench-models/drools-workbench-models-commons/src/test/java/org/drools/workbench/models/commons/backend/rule/RuleModelDRLPersistenceTest.java", "diffHunk": "@@ -5057,4 +5057,56 @@ public boolean hasDSLSentences() {\n \n         checkMarshalling(expected, model);\n     }\n+\n+    @Test\n+    public void testMatchesLegacyToNewVersion() {\n+\n+        // Fact(something != null && matches \"P.*\") = was supported before, now is deprecated.\n+        // It breaks the UI if user has a rule with this case, so we convert to the new format:\n+        // Fact(something != null && something matches \"P.*\")\n+        //                           ^^^^^^^^^", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "2948863ffeea0a8bc4352dc0f1cf7413a6d0858f"}, "originalPosition": 11}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2OTk2OTYwNg==", "bodyText": "I vote for private method. Comments in code tend to get separated or not updated over long periods of time.", "url": "https://github.com/kiegroup/drools/pull/2728#discussion_r369969606", "createdAt": "2020-01-23T07:48:52Z", "author": {"login": "Rikkola"}, "path": "drools-workbench-models/drools-workbench-models-commons/src/test/java/org/drools/workbench/models/commons/backend/rule/RuleModelDRLPersistenceTest.java", "diffHunk": "@@ -5057,4 +5057,56 @@ public boolean hasDSLSentences() {\n \n         checkMarshalling(expected, model);\n     }\n+\n+    @Test\n+    public void testMatchesLegacyToNewVersion() {\n+\n+        // Fact(something != null && matches \"P.*\") = was supported before, now is deprecated.\n+        // It breaks the UI if user has a rule with this case, so we convert to the new format:\n+        // Fact(something != null && something matches \"P.*\")\n+        //                           ^^^^^^^^^", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2OTk2MDgyMQ=="}, "originalCommit": {"oid": "2948863ffeea0a8bc4352dc0f1cf7413a6d0858f"}, "originalPosition": 11}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MDExODY3Mw==", "bodyText": "Good idea! Thank you, guys!", "url": "https://github.com/kiegroup/drools/pull/2728#discussion_r370118673", "createdAt": "2020-01-23T13:34:38Z", "author": {"login": "danielzhe"}, "path": "drools-workbench-models/drools-workbench-models-commons/src/test/java/org/drools/workbench/models/commons/backend/rule/RuleModelDRLPersistenceTest.java", "diffHunk": "@@ -5057,4 +5057,56 @@ public boolean hasDSLSentences() {\n \n         checkMarshalling(expected, model);\n     }\n+\n+    @Test\n+    public void testMatchesLegacyToNewVersion() {\n+\n+        // Fact(something != null && matches \"P.*\") = was supported before, now is deprecated.\n+        // It breaks the UI if user has a rule with this case, so we convert to the new format:\n+        // Fact(something != null && something matches \"P.*\")\n+        //                           ^^^^^^^^^", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2OTk2MDgyMQ=="}, "originalCommit": {"oid": "2948863ffeea0a8bc4352dc0f1cf7413a6d0858f"}, "originalPosition": 11}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2631, "cost": 1, "resetAt": "2021-11-12T20:28:25Z"}}}