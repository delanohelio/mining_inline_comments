{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0MzY0ODEwODYw", "number": 2728, "title": "DROOLS-4968: Guided Rule Editor removes matches statement from rule", "bodyText": "", "createdAt": "2020-01-20T12:32:28Z", "url": "https://github.com/kiegroup/drools/pull/2728", "merged": true, "mergeCommit": {"oid": "aa4864c9cf72ea859f92e81a6e01a501f20dadb4"}, "closed": true, "closedAt": "2020-01-24T07:37:39Z", "author": {"login": "danielzhe"}, "timelineItems": {"totalCount": 8, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABb85iV0gBqjI5NzEwMTcwODY=", "endCursor": "Y3Vyc29yOnYyOpPPAAABb9X-ANgFqTM0Nzc1NTA2NQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "035183314a3aea16b8ee30751fe8e738e1af2ccc", "author": {"user": {"login": "danielzhe", "name": "Daniel J dos Santos"}}, "url": "https://github.com/kiegroup/drools/commit/035183314a3aea16b8ee30751fe8e738e1af2ccc", "committedDate": "2020-01-16T21:10:09Z", "message": "RHPAM-2631: Guided Rule Editor removes matches statement from rule"}, "afterCommit": {"oid": "e5980649db9174f9b4b54cd17874805c865e00f1", "author": {"user": {"login": "danielzhe", "name": "Daniel J dos Santos"}}, "url": "https://github.com/kiegroup/drools/commit/e5980649db9174f9b4b54cd17874805c865e00f1", "committedDate": "2020-01-22T17:52:16Z", "message": "RHPAM-2631: Guided Rule Editor removes matches statement from rule"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzQ2Nzk1Njg3", "url": "https://github.com/kiegroup/drools/pull/2728#pullrequestreview-346795687", "createdAt": "2020-01-22T18:11:07Z", "commit": {"oid": "e5980649db9174f9b4b54cd17874805c865e00f1"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0yMlQxODoxMTowN1rOFgl62A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0yMlQxODoxMTowN1rOFgl62A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2OTcyMDAyNA==", "bodyText": "I think we use instanceof in many places. Is is possible to change this to use it for consistency or is the isAssignableFrom check needed?", "url": "https://github.com/kiegroup/drools/pull/2728#discussion_r369720024", "createdAt": "2020-01-22T18:11:07Z", "author": {"login": "Rikkola"}, "path": "drools-workbench-models/drools-workbench-models-commons/src/main/java/org/drools/workbench/models/commons/backend/rule/RuleModelDRLPersistenceImpl.java", "diffHunk": "@@ -4291,6 +4292,17 @@ public FieldConstraint asFieldConstraint(final RuleModel m,\n                 comp.addConstraint(expr.asFieldConstraint(m,\n                                                           factPattern));\n             }\n+            String fieldName = \"\";\n+            for (FieldConstraint field : comp.getConstraints()) {\n+                if (SingleFieldConstraint.class.isAssignableFrom(field.getClass())) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "e5980649db9174f9b4b54cd17874805c865e00f1"}, "originalPosition": 14}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "2948863ffeea0a8bc4352dc0f1cf7413a6d0858f", "author": {"user": {"login": "danielzhe", "name": "Daniel J dos Santos"}}, "url": "https://github.com/kiegroup/drools/commit/2948863ffeea0a8bc4352dc0f1cf7413a6d0858f", "committedDate": "2020-01-22T18:34:09Z", "message": "DROOLS-4968: Guided Rule Editor removes matches statement from rule"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "e5980649db9174f9b4b54cd17874805c865e00f1", "author": {"user": {"login": "danielzhe", "name": "Daniel J dos Santos"}}, "url": "https://github.com/kiegroup/drools/commit/e5980649db9174f9b4b54cd17874805c865e00f1", "committedDate": "2020-01-22T17:52:16Z", "message": "RHPAM-2631: Guided Rule Editor removes matches statement from rule"}, "afterCommit": {"oid": "2948863ffeea0a8bc4352dc0f1cf7413a6d0858f", "author": {"user": {"login": "danielzhe", "name": "Daniel J dos Santos"}}, "url": "https://github.com/kiegroup/drools/commit/2948863ffeea0a8bc4352dc0f1cf7413a6d0858f", "committedDate": "2020-01-22T18:34:09Z", "message": "DROOLS-4968: Guided Rule Editor removes matches statement from rule"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzQ3MDk0Mzgw", "url": "https://github.com/kiegroup/drools/pull/2728#pullrequestreview-347094380", "createdAt": "2020-01-23T07:16:08Z", "commit": {"oid": "2948863ffeea0a8bc4352dc0f1cf7413a6d0858f"}, "state": "COMMENTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0yM1QwNzoxNjowOVrOFg0kdw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0yM1QwNzoxOToxMVrOFg0ndQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2OTk2MDA1NQ==", "bodyText": "Please simplify this as:\nif (StringUtils.isEmpty(constraint.getFieldName()) \n        && (Objects.equals(constraint.getOperator(), \"matches\") || Objects.equals(constraint.getOperator(), \"not matches\"))) {", "url": "https://github.com/kiegroup/drools/pull/2728#discussion_r369960055", "createdAt": "2020-01-23T07:16:09Z", "author": {"login": "jomarko"}, "path": "drools-workbench-models/drools-workbench-models-commons/src/main/java/org/drools/workbench/models/commons/backend/rule/RuleModelDRLPersistenceImpl.java", "diffHunk": "@@ -4291,6 +4292,17 @@ public FieldConstraint asFieldConstraint(final RuleModel m,\n                 comp.addConstraint(expr.asFieldConstraint(m,\n                                                           factPattern));\n             }\n+            String fieldName = \"\";\n+            for (FieldConstraint field : comp.getConstraints()) {\n+                if (field instanceof SingleFieldConstraint) {\n+                    SingleFieldConstraint constraint = (SingleFieldConstraint) field;\n+                    if (StringUtils.isEmpty(constraint.getFieldName()) && !StringUtils.isEmpty(constraint.getOperator())\n+                            && (constraint.getOperator().equals(\"matches\") || constraint.getOperator().equals(\"not matches\"))) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "2948863ffeea0a8bc4352dc0f1cf7413a6d0858f"}, "originalPosition": 17}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2OTk2MDgyMQ==", "bodyText": "Maybe this would be good to mention also in RuleModelDRLPersistenceImpl, or wrap the new code there into some private method with some meaningful name. The name of the test is nice - helps to explain what is ongoing.", "url": "https://github.com/kiegroup/drools/pull/2728#discussion_r369960821", "createdAt": "2020-01-23T07:19:11Z", "author": {"login": "jomarko"}, "path": "drools-workbench-models/drools-workbench-models-commons/src/test/java/org/drools/workbench/models/commons/backend/rule/RuleModelDRLPersistenceTest.java", "diffHunk": "@@ -5057,4 +5057,56 @@ public boolean hasDSLSentences() {\n \n         checkMarshalling(expected, model);\n     }\n+\n+    @Test\n+    public void testMatchesLegacyToNewVersion() {\n+\n+        // Fact(something != null && matches \"P.*\") = was supported before, now is deprecated.\n+        // It breaks the UI if user has a rule with this case, so we convert to the new format:\n+        // Fact(something != null && something matches \"P.*\")\n+        //                           ^^^^^^^^^", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "2948863ffeea0a8bc4352dc0f1cf7413a6d0858f"}, "originalPosition": 11}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "aa73c7fe1d16588da7fd2360f2076e781c5d08fb", "author": {"user": {"login": "danielzhe", "name": "Daniel J dos Santos"}}, "url": "https://github.com/kiegroup/drools/commit/aa73c7fe1d16588da7fd2360f2076e781c5d08fb", "committedDate": "2020-01-23T14:23:12Z", "message": "Code review."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzQ3MzkwNTA5", "url": "https://github.com/kiegroup/drools/pull/2728#pullrequestreview-347390509", "createdAt": "2020-01-23T15:32:35Z", "commit": {"oid": "aa73c7fe1d16588da7fd2360f2076e781c5d08fb"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzQ3NzU1MDY1", "url": "https://github.com/kiegroup/drools/pull/2728#pullrequestreview-347755065", "createdAt": "2020-01-24T05:19:51Z", "commit": {"oid": "aa73c7fe1d16588da7fd2360f2076e781c5d08fb"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1661, "cost": 1, "resetAt": "2021-11-01T15:33:45Z"}}}