{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTAyMDMxNjM3", "number": 3162, "title": "[DROOLS-5688] Implement public API", "bodyText": "@danielezonca @mariofusco @jiripetrlik\nSee https://issues.redhat.com/browse/DROOLS-5688\nOverall modifications of this PR.\n\ncreate kie-pmml-api module to contain API meant to be used by final user\nrenaming/moving/adapt code to follow such modifications\nrefactor integration tests to use the public API.\n\nClasses to verify:\n\norg.kie.pmml.api.runtime.PMMLRuntime: the PMMLRuntime public API interface\norg.kie.pmml.evaluator.api.executor.PMMLRuntimeInternal: API to be used internally by pmml-trusty code (extends the previous one)\norg.kie.pmml.evaluator.core.service.PMMLRuntimeInternalImpl: implementation of the above\norg.kie.pmml.api.PMMLRuntimeFactory: the PMMLRuntimeFactory public API interface\norg.kie.pmml.evaluator.assembler.factories.PMMLRuntimeFactoryImpl: implementation of the above\norg.kie.pmml.evaluator.assembler.factories.PMMLRuntimeFactoryInternal: Implementation to be used internally by PMMLRuntimeFactoryImpl, to decouple the public API from the inner implementation\norg.kie.pmml.api.models.PMMLModel: public, stripped-down, user-friendly view of original Model\norg.kie.pmml.api.models.PMMLModelImpl: implementation of the above\norg.kie.pmml.api.models.MiningModel: public, stripped-down, user-friendly view of original MiningModel\norg.kie.pmml.api.models.OutputField: public, stripped-down, user-friendly view of original OutputField\n\nAlmost all the other files have been modified in this PR, but only for method renaming/class moving\nDepends on kiegroup/droolsjbpm-build-bootstrap#1499\nNeeded by kiegroup/droolsjbpm-integration#2279\nNeeded by kiegroup/kogito-runtimes#829", "createdAt": "2020-10-13T06:45:37Z", "url": "https://github.com/kiegroup/drools/pull/3162", "merged": true, "mergeCommit": {"oid": "bde3a6698d4ea8f9eb9128a728274e679b28ee80"}, "closed": true, "closedAt": "2020-10-16T20:08:01Z", "author": {"login": "gitgabrio"}, "timelineItems": {"totalCount": 24, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdQJsHGgH2gAyNTAyMDMxNjM3Ojc1NjUyN2IxNmI1OTc0MWZjMTZmYzBjYzgwNjE3NTVkYzY0MmVlMWQ=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdSs9zYAH2gAyNTAyMDMxNjM3OmZhNzAyN2RkNjFiMGEzMWU5NzdkODZmNTg3MmY3ODdkNjBhMzc1MWE=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "756527b16b59741fc16fc0cc8061755dc642ee1d", "author": {"user": {"login": "gitgabrio", "name": "Gabriele Cardosi"}}, "url": "https://github.com/kiegroup/drools/commit/756527b16b59741fc16fc0cc8061755dc642ee1d", "committedDate": "2020-10-07T09:37:21Z", "message": "[DROOLS-5688] Public \"api\" classes"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "43d7606e6d8ad10678c4ab853633f8eb33021ec7", "author": {"user": {"login": "gitgabrio", "name": "Gabriele Cardosi"}}, "url": "https://github.com/kiegroup/drools/commit/43d7606e6d8ad10678c4ab853633f8eb33021ec7", "committedDate": "2020-10-07T09:38:21Z", "message": "[DROOLS-5688] Moving classes to new api module"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "8c599eaefc6c750b107933a23533611f7a09da0d", "author": {"user": {"login": "gitgabrio", "name": "Gabriele Cardosi"}}, "url": "https://github.com/kiegroup/drools/commit/8c599eaefc6c750b107933a23533611f7a09da0d", "committedDate": "2020-10-07T10:07:53Z", "message": "[DROOLS-5688] Moving classes to new \"api\" module"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "622d438f4b906de2d968bed5fff11e7fe434def8", "author": {"user": {"login": "gitgabrio", "name": "Gabriele Cardosi"}}, "url": "https://github.com/kiegroup/drools/commit/622d438f4b906de2d968bed5fff11e7fe434def8", "committedDate": "2020-10-08T09:43:35Z", "message": "[DROOLS-5688] Method rename"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b94a97641c3ece6c70677262e08251573d9922c5", "author": {"user": {"login": "gitgabrio", "name": "Gabriele Cardosi"}}, "url": "https://github.com/kiegroup/drools/commit/b94a97641c3ece6c70677262e08251573d9922c5", "committedDate": "2020-10-08T13:47:13Z", "message": "[DROOLS-5688] Moving classes to new \"api\" module"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "28e1f658525a2c183a6caed322c22c68e15ae76b", "author": {"user": {"login": "gitgabrio", "name": "Gabriele Cardosi"}}, "url": "https://github.com/kiegroup/drools/commit/28e1f658525a2c183a6caed322c22c68e15ae76b", "committedDate": "2020-10-09T12:11:26Z", "message": "[DROOLS-5688] Populating MiningField/OutputField lists. Broken tests"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b3b38ede972d225e510d8a8e0875a93b2ab1f121", "author": {"user": {"login": "gitgabrio", "name": "Gabriele Cardosi"}}, "url": "https://github.com/kiegroup/drools/commit/b3b38ede972d225e510d8a8e0875a93b2ab1f121", "committedDate": "2020-10-09T12:11:59Z", "message": "Merge remote-tracking branch 'origin/master' into DROOLS-5688"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "6d057b05726ee569b3b45f54af806d3ed71b3936", "author": {"user": {"login": "gitgabrio", "name": "Gabriele Cardosi"}}, "url": "https://github.com/kiegroup/drools/commit/6d057b05726ee569b3b45f54af806d3ed71b3936", "committedDate": "2020-10-09T12:42:07Z", "message": "[DROOLS-5688] Populating MiningField/OutputField lists. Broken tests"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a48623d421f451a4e64788ec911af3c51e7daf9c", "author": {"user": {"login": "mariofusco", "name": "Mario Fusco"}}, "url": "https://github.com/kiegroup/drools/commit/a48623d421f451a4e64788ec911af3c51e7daf9c", "committedDate": "2020-10-12T17:45:42Z", "message": "[DROOLS-5720] make PMML to work without mvel"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "2bec21e0870368fa18586e0aab7fa1141ec5a623", "author": {"user": {"login": "gitgabrio", "name": "Gabriele Cardosi"}}, "url": "https://github.com/kiegroup/drools/commit/2bec21e0870368fa18586e0aab7fa1141ec5a623", "committedDate": "2020-10-13T05:53:31Z", "message": "[DROOLS-5688] Implemented public RuntimeFactory"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "8c24beb25ae1a3d11f9856e12485a62a78a266b9", "author": {"user": {"login": "gitgabrio", "name": "Gabriele Cardosi"}}, "url": "https://github.com/kiegroup/drools/commit/8c24beb25ae1a3d11f9856e12485a62a78a266b9", "committedDate": "2020-10-13T06:22:38Z", "message": "[DROOLS-5688] Fixing public API usage inside tests"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "31bf55b4e1c36feeea67d8323d58716ab2a44b85", "author": {"user": {"login": "mariofusco", "name": "Mario Fusco"}}, "url": "https://github.com/kiegroup/drools/commit/31bf55b4e1c36feeea67d8323d58716ab2a44b85", "committedDate": "2020-10-13T09:02:32Z", "message": "wip"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTA3MTIxNTIy", "url": "https://github.com/kiegroup/drools/pull/3162#pullrequestreview-507121522", "createdAt": "2020-10-13T06:59:17Z", "commit": {"oid": "8c24beb25ae1a3d11f9856e12485a62a78a266b9"}, "state": "COMMENTED", "comments": {"totalCount": 25, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xM1QwNjo1OToxOFrOHgX_7A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xM1QxMTo1OTo0NFrOHgjH8g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMzcwOTY3Ng==", "bodyText": "Fix formatting", "url": "https://github.com/kiegroup/drools/pull/3162#discussion_r503709676", "createdAt": "2020-10-13T06:59:18Z", "author": {"login": "danielezonca"}, "path": "kie-pmml-trusty/kie-pmml-compiler/kie-pmml-compiler-api/pom.xml", "diffHunk": "@@ -17,9 +17,13 @@\n   <dependencies>\n     <!-- PMML -->\n     <dependency>\n+      <groupId>org.kie</groupId>\n+      <artifactId>kie-pmml-api</artifactId>\n+</dependency>\n+<dependency>\n       <groupId>org.kie</groupId>\n       <artifactId>kie-pmml-commons</artifactId>\n-    </dependency>\n+</dependency>", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "8c24beb25ae1a3d11f9856e12485a62a78a266b9"}, "originalPosition": 11}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMzcxMTkzOQ==", "bodyText": "Fix formatting", "url": "https://github.com/kiegroup/drools/pull/3162#discussion_r503711939", "createdAt": "2020-10-13T07:03:47Z", "author": {"login": "danielezonca"}, "path": "kie-pmml-trusty/kie-pmml-dependencies/pom.xml", "diffHunk": "@@ -20,9 +20,13 @@\n   <dependencies>\n     <!-- PMML -->\n     <dependency>\n+      <groupId>org.kie</groupId>\n+      <artifactId>kie-pmml-api</artifactId>\n+</dependency>\n+<dependency>\n       <groupId>org.kie</groupId>\n       <artifactId>kie-pmml-commons</artifactId>\n-    </dependency>\n+</dependency>", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "8c24beb25ae1a3d11f9856e12485a62a78a266b9"}, "originalPosition": 11}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMzcxMjM1Mw==", "bodyText": "Fix formatting", "url": "https://github.com/kiegroup/drools/pull/3162#discussion_r503712353", "createdAt": "2020-10-13T07:04:37Z", "author": {"login": "danielezonca"}, "path": "kie-pmml-trusty/kie-pmml-evaluator/kie-pmml-evaluator-api/pom.xml", "diffHunk": "@@ -17,9 +17,13 @@\n   <dependencies>\n     <!-- PMML -->\n     <dependency>\n+      <groupId>org.kie</groupId>\n+      <artifactId>kie-pmml-api</artifactId>\n+</dependency>\n+<dependency>\n       <groupId>org.kie</groupId>\n       <artifactId>kie-pmml-commons</artifactId>\n-    </dependency>\n+</dependency>", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "8c24beb25ae1a3d11f9856e12485a62a78a266b9"}, "originalPosition": 11}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMzcxNjA4MQ==", "bodyText": "To be removed? It is a mock", "url": "https://github.com/kiegroup/drools/pull/3162#discussion_r503716081", "createdAt": "2020-10-13T07:12:21Z", "author": {"login": "danielezonca"}, "path": "kie-pmml-trusty/kie-pmml-evaluator/kie-pmml-evaluator-core/src/main/java/org/kie/pmml/evaluator/core/converters/PMMLModelConverter.java", "diffHunk": "@@ -0,0 +1,33 @@\n+/*\n+ * Copyright 2020 Red Hat, Inc. and/or its affiliates.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+package org.kie.pmml.evaluator.core.converters;\n+\n+import org.kie.pmml.api.models.PMMLModelImpl;\n+import org.kie.pmml.commons.model.KiePMMLModel;\n+\n+public class PMMLModelConverter {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "8c24beb25ae1a3d11f9856e12485a62a78a266b9"}, "originalPosition": 21}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMzcxNjYzNA==", "bodyText": "Are you sure the generic should be PMMLRuntimeInternal and not PMMLRuntime?", "url": "https://github.com/kiegroup/drools/pull/3162#discussion_r503716634", "createdAt": "2020-10-13T07:13:27Z", "author": {"login": "danielezonca"}, "path": "kie-pmml-trusty/kie-pmml-evaluator/kie-pmml-evaluator-core/src/main/java/org/kie/pmml/evaluator/core/service/PMMLRuntimeService.java", "diffHunk": "@@ -17,18 +17,18 @@\n \n import org.kie.api.KieBase;\n import org.kie.api.internal.runtime.KieRuntimeService;\n-import org.kie.pmml.evaluator.api.executor.PMMLRuntime;\n+import org.kie.pmml.evaluator.api.executor.PMMLRuntimeInternal;\n import org.kie.pmml.evaluator.core.executor.PMMLModelEvaluatorFinderImpl;\n \n-public class PMMLRuntimeService implements KieRuntimeService<PMMLRuntime> {\n+public class PMMLRuntimeService implements KieRuntimeService<PMMLRuntimeInternal> {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "8c24beb25ae1a3d11f9856e12485a62a78a266b9"}, "originalPosition": 9}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMzcxNzA0Nw==", "bodyText": "Fix formatting", "url": "https://github.com/kiegroup/drools/pull/3162#discussion_r503717047", "createdAt": "2020-10-13T07:14:15Z", "author": {"login": "danielezonca"}, "path": "kie-pmml-trusty/kie-pmml-models-archetype/src/test/resources-filtered/projects/generated-naivebayes/reference/kie-pmml-models-naivebayes-model/pom.xml", "diffHunk": "@@ -15,9 +15,13 @@\n   <dependencies>\n     <!-- PMML -->\n     <dependency>\n+      <groupId>org.kie</groupId>\n+      <artifactId>kie-pmml-api</artifactId>\n+</dependency>\n+<dependency>\n       <groupId>org.kie</groupId>\n       <artifactId>kie-pmml-commons</artifactId>\n-    </dependency>\n+</dependency>", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "8c24beb25ae1a3d11f9856e12485a62a78a266b9"}, "originalPosition": 11}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMzcxNzE5NA==", "bodyText": "Fix formatting", "url": "https://github.com/kiegroup/drools/pull/3162#discussion_r503717194", "createdAt": "2020-10-13T07:14:34Z", "author": {"login": "danielezonca"}, "path": "kie-pmml-trusty/kie-pmml-models-archetype/src/test/resources-filtered/projects/generated-tree/reference/kie-pmml-models-tree-model/pom.xml", "diffHunk": "@@ -15,9 +15,13 @@\n   <dependencies>\n     <!-- PMML -->\n     <dependency>\n+      <groupId>org.kie</groupId>\n+      <artifactId>kie-pmml-api</artifactId>\n+</dependency>\n+<dependency>\n       <groupId>org.kie</groupId>\n       <artifactId>kie-pmml-commons</artifactId>\n-    </dependency>\n+</dependency>", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "8c24beb25ae1a3d11f9856e12485a62a78a266b9"}, "originalPosition": 11}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMzcxNzQwMw==", "bodyText": "Fix formatting", "url": "https://github.com/kiegroup/drools/pull/3162#discussion_r503717403", "createdAt": "2020-10-13T07:14:58Z", "author": {"login": "danielezonca"}, "path": "kie-pmml-trusty/kie-pmml-models-drools-archetype/src/test/resources-filtered/projects/generated-naivebayes/reference/kie-pmml-models-naivebayes-model/pom.xml", "diffHunk": "@@ -15,9 +15,13 @@\n   <dependencies>\n     <!-- PMML -->\n     <dependency>\n+      <groupId>org.kie</groupId>\n+      <artifactId>kie-pmml-api</artifactId>\n+</dependency>\n+<dependency>\n       <groupId>org.kie</groupId>\n       <artifactId>kie-pmml-commons</artifactId>\n-    </dependency>\n+</dependency>", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "8c24beb25ae1a3d11f9856e12485a62a78a266b9"}, "originalPosition": 11}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMzcxNzU5OA==", "bodyText": "Fix formatting", "url": "https://github.com/kiegroup/drools/pull/3162#discussion_r503717598", "createdAt": "2020-10-13T07:15:15Z", "author": {"login": "danielezonca"}, "path": "kie-pmml-trusty/kie-pmml-models-drools-archetype/src/test/resources-filtered/projects/generated-tree/reference/kie-pmml-models-tree-model/pom.xml", "diffHunk": "@@ -15,9 +15,13 @@\n   <dependencies>\n     <!-- PMML -->\n     <dependency>\n+      <groupId>org.kie</groupId>\n+      <artifactId>kie-pmml-api</artifactId>\n+</dependency>\n+<dependency>\n       <groupId>org.kie</groupId>\n       <artifactId>kie-pmml-commons</artifactId>\n-    </dependency>\n+</dependency>", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "8c24beb25ae1a3d11f9856e12485a62a78a266b9"}, "originalPosition": 11}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMzcxODQ3OQ==", "bodyText": "Fix formatting", "url": "https://github.com/kiegroup/drools/pull/3162#discussion_r503718479", "createdAt": "2020-10-13T07:16:46Z", "author": {"login": "danielezonca"}, "path": "kie-pmml-trusty/kie-pmml-models/kie-pmml-models-drools/kie-pmml-models-drools-common/pom.xml", "diffHunk": "@@ -17,9 +17,13 @@\n   <dependencies>\n     <!-- PMML -->\n     <dependency>\n+      <groupId>org.kie</groupId>\n+      <artifactId>kie-pmml-api</artifactId>\n+</dependency>\n+<dependency>\n       <groupId>org.kie</groupId>\n       <artifactId>kie-pmml-commons</artifactId>\n-    </dependency>\n+</dependency>", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "8c24beb25ae1a3d11f9856e12485a62a78a266b9"}, "originalPosition": 11}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMzcxOTMxNQ==", "bodyText": "Fix formatting", "url": "https://github.com/kiegroup/drools/pull/3162#discussion_r503719315", "createdAt": "2020-10-13T07:18:26Z", "author": {"login": "danielezonca"}, "path": "kie-pmml-trusty/kie-pmml-models/kie-pmml-models-drools/kie-pmml-models-drools-scorecard/kie-pmml-models-drools-scorecard-model/pom.xml", "diffHunk": "@@ -15,9 +15,13 @@\n   <dependencies>\n     <!-- PMML -->\n     <dependency>\n+      <groupId>org.kie</groupId>\n+      <artifactId>kie-pmml-api</artifactId>\n+</dependency>\n+<dependency>\n       <groupId>org.kie</groupId>\n       <artifactId>kie-pmml-commons</artifactId>\n-    </dependency>\n+</dependency>", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "8c24beb25ae1a3d11f9856e12485a62a78a266b9"}, "originalPosition": 11}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMzcxOTg1OQ==", "bodyText": "Fix dependency", "url": "https://github.com/kiegroup/drools/pull/3162#discussion_r503719859", "createdAt": "2020-10-13T07:19:24Z", "author": {"login": "danielezonca"}, "path": "kie-pmml-trusty/kie-pmml-models/kie-pmml-models-drools/kie-pmml-models-drools-tree/kie-pmml-models-drools-tree-model/pom.xml", "diffHunk": "@@ -15,9 +15,13 @@\n   <dependencies>\n     <!-- PMML -->\n     <dependency>\n+      <groupId>org.kie</groupId>\n+      <artifactId>kie-pmml-api</artifactId>\n+</dependency>\n+<dependency>\n       <groupId>org.kie</groupId>\n       <artifactId>kie-pmml-commons</artifactId>\n-    </dependency>\n+</dependency>", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "8c24beb25ae1a3d11f9856e12485a62a78a266b9"}, "originalPosition": 11}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMzcyMTUxMg==", "bodyText": "To be reverted?", "url": "https://github.com/kiegroup/drools/pull/3162#discussion_r503721512", "createdAt": "2020-10-13T07:22:19Z", "author": {"login": "danielezonca"}, "path": "kie-pmml-trusty/kie-pmml-models/kie-pmml-models-regression/kie-pmml-models-regression-compiler/src/test/java/org/kie/pmml/models/regression/compiler/factories/KiePMMLRegressionModelFactoryTest.java", "diffHunk": "@@ -151,7 +152,12 @@ public void getKiePMMLRegressionModelClasses() throws IOException, IllegalAccess\n     public void getKiePMMLRegressionModelSourcesMap() throws IOException {\n         Map<String, String> retrieved = KiePMMLRegressionModelFactory.getKiePMMLRegressionModelSourcesMap(dataDictionary, transformationDictionary, regressionModel, PACKAGE_NAME);\n         assertNotNull(retrieved);\n-        int expectedSize = regressionTables.size() + 2; // One for classification and one for the whole model\n+//        int miningFields = regressionModel.getMiningSchema() != null ? regressionModel.getMiningSchema().getMiningFields().size() : 0;\n+//        int outputFields = regressionModel.getOutput() != null ? regressionModel.getOutput().getOutputFields().size() : 0;\n+        int expectedSize = regressionTables.size()\n+//                + miningFields  // for each MiningField an \"add\" statement is created\n+//                + outputFields  // for each OutputField an \"add\" statement is created\n+                + 2; // One for classification and one for the whole model", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "8c24beb25ae1a3d11f9856e12485a62a78a266b9"}, "originalPosition": 31}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMzcyMTgwNg==", "bodyText": "Fix formatting", "url": "https://github.com/kiegroup/drools/pull/3162#discussion_r503721806", "createdAt": "2020-10-13T07:22:49Z", "author": {"login": "danielezonca"}, "path": "kie-pmml-trusty/kie-pmml-models/kie-pmml-models-regression/kie-pmml-models-regression-model/pom.xml", "diffHunk": "@@ -17,9 +17,13 @@\n   <dependencies>\n     <!-- PMML -->\n     <dependency>\n+      <groupId>org.kie</groupId>\n+      <artifactId>kie-pmml-api</artifactId>\n+</dependency>\n+<dependency>\n       <groupId>org.kie</groupId>\n       <artifactId>kie-pmml-commons</artifactId>\n-    </dependency>\n+</dependency>", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "8c24beb25ae1a3d11f9856e12485a62a78a266b9"}, "originalPosition": 11}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMzczMDc3Mg==", "bodyText": "Fix formatting", "url": "https://github.com/kiegroup/drools/pull/3162#discussion_r503730772", "createdAt": "2020-10-13T07:37:07Z", "author": {"login": "danielezonca"}, "path": "kie-pmml-trusty/kie-pmml-models/kie-pmml-models-mining/kie-pmml-models-mining-model/pom.xml", "diffHunk": "@@ -19,9 +19,13 @@\n   <dependencies>\n     <!-- PMML -->\n     <dependency>\n+      <groupId>org.kie</groupId>\n+      <artifactId>kie-pmml-api</artifactId>\n+</dependency>\n+<dependency>\n       <groupId>org.kie</groupId>\n       <artifactId>kie-pmml-commons</artifactId>\n-    </dependency>\n+</dependency>", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "8c24beb25ae1a3d11f9856e12485a62a78a266b9"}, "originalPosition": 11}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMzczMjQ3OA==", "bodyText": "To be removed", "url": "https://github.com/kiegroup/drools/pull/3162#discussion_r503732478", "createdAt": "2020-10-13T07:39:53Z", "author": {"login": "danielezonca"}, "path": "kie-pmml-trusty/kie-pmml-models/kie-pmml-models-mining/kie-pmml-models-mining-compiler/src/main/java/org/kie/pmml/models/mining/compiler/factories/KiePMMLMiningModelFactory.java", "diffHunk": "@@ -114,37 +117,63 @@ public static KiePMMLMiningModel getKiePMMLMiningModel(final DataDictionary data\n         CompilationUnit cloneCU = JavaParserUtils.getKiePMMLModelCompilationUnit(className, parentPackageName, KIE_PMML_MINING_MODEL_TEMPLATE_JAVA, KIE_PMML_MINING_MODEL_TEMPLATE);\n         ClassOrInterfaceDeclaration modelTemplate = cloneCU.getClassByName(className)\n                 .orElseThrow(() -> new KiePMMLException(MAIN_CLASS_NOT_FOUND + \": \" + className));\n-        String modelName = model.getModelName();\n         String targetFieldName = getTargetFieldName(dataDictionary, model).orElse(null);\n         List<KiePMMLOutputField> outputFields = getOutputFields(model);\n         final ConstructorDeclaration constructorDeclaration = modelTemplate.getDefaultConstructor().orElseThrow(() -> new KiePMMLInternalException(String.format(MISSING_DEFAULT_CONSTRUCTOR, modelTemplate.getName())));\n-        setConstructor(className,\n-                       constructorDeclaration,\n+        setConstructor(model,\n+                        constructorDeclaration,\n                        targetFieldName,\n-                       MINING_FUNCTION.byName(model.getMiningFunction().value()),\n-                       modelName,\n                        segmentationClass);\n-        addOutputFieldsPopulation(constructorDeclaration.getBody(), outputFields);\n+        addKiePMMLOutputFieldsPopulation(constructorDeclaration.getBody(), outputFields);\n         addTransformationsInClassOrInterfaceDeclaration(modelTemplate, transformationDictionary, model.getLocalTransformations());\n         toReturn.put(getFullClassName(cloneCU), cloneCU.toString());\n         return toReturn;\n     }\n \n-    static void setConstructor(final String generatedClassName,\n+    static void setConstructor(final MiningModel miningModel,\n                                final ConstructorDeclaration constructorDeclaration,\n                                final String targetField,\n-                               final MINING_FUNCTION miningFunction,\n-                               final String modelName,\n                                final String segmentationClass) {\n-        setConstructorSuperNameInvocation(generatedClassName, constructorDeclaration, modelName);\n+        final List<org.kie.pmml.api.models.MiningField> miningFields = ModelUtils.convertToKieMiningFieldList(miningModel.getMiningSchema());\n+        final List<org.kie.pmml.api.models.OutputField> outputFields = ModelUtils.convertToKieOutputFieldList(miningModel.getOutput());\n+        setKiePMMLModelConstructor(getSanitizedClassName(miningModel.getModelName()), constructorDeclaration, miningModel.getModelName(), miningFields, outputFields);\n+        Expression miningFunctionExpression;\n+        if (miningModel.getMiningFunction() != null) {\n+            MINING_FUNCTION miningFunction = MINING_FUNCTION.byName(miningModel.getMiningFunction().value());\n+            miningFunctionExpression = new NameExpr(miningFunction.getClass().getName() + \".\" + miningFunction.name());\n+        } else {\n+            miningFunctionExpression = new NullLiteralExpr();\n+        }\n         final BlockStmt body = constructorDeclaration.getBody();\n         CommonCodegenUtils.setAssignExpressionValue(body, \"targetField\", new StringLiteralExpr(targetField));\n-        CommonCodegenUtils.setAssignExpressionValue(body, \"miningFunction\", new NameExpr(miningFunction.getClass().getName() + \".\" + miningFunction.name()));\n+        CommonCodegenUtils.setAssignExpressionValue(body, \"miningFunction\", miningFunctionExpression);\n         CommonCodegenUtils.setAssignExpressionValue(body, \"pmmlMODEL\", new NameExpr(PMML_MODEL.MINING_MODEL.getClass().getName() + \".\" + PMML_MODEL.MINING_MODEL.name()));\n         ClassOrInterfaceType kiePMMLSegmentationClass = parseClassOrInterfaceType(segmentationClass);\n         ObjectCreationExpr objectCreationExpr = new ObjectCreationExpr();\n         objectCreationExpr.setType(kiePMMLSegmentationClass);\n         CommonCodegenUtils.setAssignExpressionValue(body, \"segmentation\", objectCreationExpr);\n     }\n \n+//\n+//    static void setConstructor(final String generatedClassName,\n+//                               final ConstructorDeclaration constructorDeclaration,\n+//                               final String targetField,\n+//                               final MINING_FUNCTION miningFunction,\n+//                               final String modelName,\n+//                               final String segmentationClass) {\n+//        final List<org.kie.pmml.api.models.MiningField> miningFields = ModelUtils.convertToKieMiningFieldList(treeModel.getMiningSchema());\n+//        final List<org.kie.pmml.api.models.OutputField> outputFields = ModelUtils.convertToKieOutputFieldList(treeModel.getOutput());\n+//        setKiePMMLModelConstructor(generatedClassName, constructorDeclaration, modelName, miningFields, outputFields);\n+//\n+////        setKiePMMLModelConstructor(generatedClassName, constructorDeclaration, modelName);\n+//        final BlockStmt body = constructorDeclaration.getBody();\n+//        CommonCodegenUtils.setAssignExpressionValue(body, \"targetField\", new StringLiteralExpr(targetField));\n+//        CommonCodegenUtils.setAssignExpressionValue(body, \"miningFunction\", new NameExpr(miningFunction.getClass().getName() + \".\" + miningFunction.name()));\n+//        CommonCodegenUtils.setAssignExpressionValue(body, \"pmmlMODEL\", new NameExpr(PMML_MODEL.MINING_MODEL.getClass().getName() + \".\" + PMML_MODEL.MINING_MODEL.name()));\n+//        ClassOrInterfaceType kiePMMLSegmentationClass = parseClassOrInterfaceType(segmentationClass);\n+//        ObjectCreationExpr objectCreationExpr = new ObjectCreationExpr();\n+//        objectCreationExpr.setType(kiePMMLSegmentationClass);\n+//        CommonCodegenUtils.setAssignExpressionValue(body, \"segmentation\", objectCreationExpr);\n+//    }", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "8c24beb25ae1a3d11f9856e12485a62a78a266b9"}, "originalPosition": 115}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMzczMjY5Mw==", "bodyText": "Fix formatting", "url": "https://github.com/kiegroup/drools/pull/3162#discussion_r503732693", "createdAt": "2020-10-13T07:40:10Z", "author": {"login": "danielezonca"}, "path": "kie-pmml-trusty/kie-pmml-models/kie-pmml-models-mining/kie-pmml-models-mining-compiler/src/main/java/org/kie/pmml/models/mining/compiler/factories/KiePMMLMiningModelFactory.java", "diffHunk": "@@ -114,37 +117,63 @@ public static KiePMMLMiningModel getKiePMMLMiningModel(final DataDictionary data\n         CompilationUnit cloneCU = JavaParserUtils.getKiePMMLModelCompilationUnit(className, parentPackageName, KIE_PMML_MINING_MODEL_TEMPLATE_JAVA, KIE_PMML_MINING_MODEL_TEMPLATE);\n         ClassOrInterfaceDeclaration modelTemplate = cloneCU.getClassByName(className)\n                 .orElseThrow(() -> new KiePMMLException(MAIN_CLASS_NOT_FOUND + \": \" + className));\n-        String modelName = model.getModelName();\n         String targetFieldName = getTargetFieldName(dataDictionary, model).orElse(null);\n         List<KiePMMLOutputField> outputFields = getOutputFields(model);\n         final ConstructorDeclaration constructorDeclaration = modelTemplate.getDefaultConstructor().orElseThrow(() -> new KiePMMLInternalException(String.format(MISSING_DEFAULT_CONSTRUCTOR, modelTemplate.getName())));\n-        setConstructor(className,\n-                       constructorDeclaration,\n+        setConstructor(model,\n+                        constructorDeclaration,", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "8c24beb25ae1a3d11f9856e12485a62a78a266b9"}, "originalPosition": 54}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMzczMzg1OQ==", "bodyText": "Where is this used?", "url": "https://github.com/kiegroup/drools/pull/3162#discussion_r503733859", "createdAt": "2020-10-13T07:42:02Z", "author": {"login": "danielezonca"}, "path": "kie-pmml-trusty/kie-pmml-evaluator/kie-pmml-evaluator-core/src/main/java/org/kie/pmml/evaluator/core/service/PMMLRuntimeInternalImpl.java", "diffHunk": "@@ -145,6 +160,17 @@ protected void executeTransformations(final KiePMMLModel model, final PMMLContex\n         });\n     }\n \n+    PMMLRequestData getPMMLRequestData(String modelName, Map<String, Object> parameters) {\n+        String correlationId = \"CORRELATION_ID\";\n+        PMMLRequestDataBuilder pmmlRequestDataBuilder = new PMMLRequestDataBuilder(correlationId, modelName);\n+        for (Map.Entry<String, Object> entry : parameters.entrySet()) {\n+            Object pValue = entry.getValue();\n+            Class class1 = pValue.getClass();\n+            pmmlRequestDataBuilder.addParameter(entry.getKey(), pValue, class1);\n+        }\n+        return pmmlRequestDataBuilder.build();\n+    }", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "8c24beb25ae1a3d11f9856e12485a62a78a266b9"}, "originalPosition": 90}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMzczNTQ2MQ==", "bodyText": "Where is it used?", "url": "https://github.com/kiegroup/drools/pull/3162#discussion_r503735461", "createdAt": "2020-10-13T07:44:44Z", "author": {"login": "danielezonca"}, "path": "kie-pmml-trusty/kie-pmml-evaluator/kie-pmml-evaluator-assembler/pom.xml", "diffHunk": "@@ -45,6 +45,11 @@\n       <groupId>org.drools</groupId>\n       <artifactId>drools-model-compiler</artifactId>\n     </dependency>\n+    <!-- EXTERNAL -->\n+    <dependency>\n+      <groupId>commons-io</groupId>\n+      <artifactId>commons-io</artifactId>\n+    </dependency>", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "8c24beb25ae1a3d11f9856e12485a62a78a266b9"}, "originalPosition": 8}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMzczNzQxOQ==", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n              <description>Public APIs fro Trusty PMML</description>\n          \n          \n            \n              <description>Public APIs for Trusty PMML</description>", "url": "https://github.com/kiegroup/drools/pull/3162#discussion_r503737419", "createdAt": "2020-10-13T07:48:00Z", "author": {"login": "danielezonca"}, "path": "kie-pmml-trusty/kie-pmml-api/pom.xml", "diffHunk": "@@ -0,0 +1,26 @@\n+<?xml version=\"1.0\" encoding=\"UTF-8\"?>\n+<project xmlns=\"http://maven.apache.org/POM/4.0.0\"\n+         xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\"\n+         xsi:schemaLocation=\"http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd\">\n+  <parent>\n+    <artifactId>kie-pmml-trusty</artifactId>\n+    <groupId>org.kie</groupId>\n+    <version>7.45.0-SNAPSHOT</version>\n+  </parent>\n+  <modelVersion>4.0.0</modelVersion>\n+\n+  <artifactId>kie-pmml-api</artifactId>\n+\n+  <name>KIE :: PMML :: API</name>\n+  <description>Public APIs fro Trusty PMML</description>", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "8c24beb25ae1a3d11f9856e12485a62a78a266b9"}, "originalPosition": 15}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMzc0Mjk5NQ==", "bodyText": "How is the user supposed to obtain an instance of this interface? Do you expect an explicit\nPMMLRuntimeFactory factory = new PMMLRuntimeFactoryImpl();\n?\nWhat about add a kie.conf for PMMLRuntimeFactoryImpl and then replicate the same mechanism of KieServices?", "url": "https://github.com/kiegroup/drools/pull/3162#discussion_r503742995", "createdAt": "2020-10-13T07:56:55Z", "author": {"login": "danielezonca"}, "path": "kie-pmml-trusty/kie-pmml-api/src/main/java/org/kie/pmml/api/PMMLRuntimeFactory.java", "diffHunk": "@@ -0,0 +1,60 @@\n+/*\n+ * Copyright 2020 Red Hat, Inc. and/or its affiliates.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+package org.kie.pmml.api;\n+\n+import java.io.File;\n+\n+import org.kie.pmml.api.runtime.PMMLRuntime;\n+\n+public interface PMMLRuntimeFactory {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "8c24beb25ae1a3d11f9856e12485a62a78a266b9"}, "originalPosition": 22}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMzg2NjYzNg==", "bodyText": "What about overload this method with another one without kieBase parameter so that user can leverage on default kieBase if available? I expect most of the users might not be aware of the name of the kBase when there is a default", "url": "https://github.com/kiegroup/drools/pull/3162#discussion_r503866636", "createdAt": "2020-10-13T11:14:35Z", "author": {"login": "danielezonca"}, "path": "kie-pmml-trusty/kie-pmml-api/src/main/java/org/kie/pmml/api/PMMLRuntimeFactory.java", "diffHunk": "@@ -0,0 +1,60 @@\n+/*\n+ * Copyright 2020 Red Hat, Inc. and/or its affiliates.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+package org.kie.pmml.api;\n+\n+import java.io.File;\n+\n+import org.kie.pmml.api.runtime.PMMLRuntime;\n+\n+public interface PMMLRuntimeFactory {\n+\n+    /**\n+     * Retrieve a <code>PMMLRuntime</code> bound to the <code>org.dmg.pmml.Model</code>\n+     * with the given <b>modelName</b> that should be present in the given <code><File</code>\n+     * @param modelName\n+     * @param pmmlFile\n+     * @return\n+     */\n+    PMMLRuntime getPMMLRuntimeFromFile(String modelName, File pmmlFile);\n+\n+    /**\n+     * Retrieve a <code>PMMLRuntime</code> bound to the <code>org.dmg.pmml.Model</code>\n+     * with the given <b>modelName</b> that should be present in the <code><File</code>\n+     * with the given <b>pmmlFileName</b>. Such file will be looked for in the classpath\n+     * (e.g. provided by <b>Maven</b> dependency)\n+     *\n+     * @param modelName\n+     * @param pmmlFileName\n+     * @return\n+     */\n+    PMMLRuntime getPMMLRuntimeFromClasspath(String modelName, String pmmlFileName);\n+\n+    /**\n+     * Retrieve a <code>PMMLRuntime</code> bound to the <code>org.dmg.pmml.Model</code>\n+     * with the given <b>modelName</b> that should be present in the <code><File</code>\n+     * with the given <b>pmmlFileName</b>. Such file will be looked for in the <code>kjar</code>\n+     * loaded inside the <code>KieContainer</code>\n+     * with the given <b>gav</b>\n+     *\n+     * @param modelName\n+     * @param pmmlFileName\n+     * @param kieBase the name of the Kiebase configured inside the <b>kmodule.xml</b> of the loaded <b>kjar</b>\n+     * @param gav\n+     * @return\n+     */\n+    PMMLRuntime getPMMLRuntimeFromKieContainer(String modelName, String kieBase, String pmmlFileName, String gav);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "8c24beb25ae1a3d11f9856e12485a62a78a266b9"}, "originalPosition": 58}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMzg4NzYxMw==", "bodyText": "Where are these fields populated? Is it something that subclasses has to handle? If so I think is quite error prone because if I forget to do that, no error is thrown but the fields are not populated.\nWhat about an abstract method like populateMiningAndOutputFields() invoked in the constructor so that each subclass has to implement it?", "url": "https://github.com/kiegroup/drools/pull/3162#discussion_r503887613", "createdAt": "2020-10-13T11:52:14Z", "author": {"login": "danielezonca"}, "path": "kie-pmml-trusty/kie-pmml-commons/src/main/java/org/kie/pmml/commons/model/KiePMMLModel.java", "diffHunk": "@@ -39,6 +43,8 @@\n     protected Map<String, Object> missingValueReplacementMap = new HashMap<>();\n     protected Map<String, Function<List<KiePMMLNameValue>, Object>> commonTransformationsMap = new HashMap<>();\n     protected Map<String, Function<List<KiePMMLNameValue>, Object>> localTransformationsMap = new HashMap<>();\n+    protected List<MiningField> miningFields = new ArrayList<>();\n+    protected List<OutputField> outputFields = new ArrayList<>();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "8c24beb25ae1a3d11f9856e12485a62a78a266b9"}, "originalPosition": 35}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMzg5MDkzMQ==", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                    Optional<KiePMMLModel> toReturn = getModelImplementationProviderStream(model)\n          \n          \n            \n                            .map(implementation -> implementation.getKiePMMLModel(dataDictionary, transformationDictionary, model\n          \n          \n            \n                                    , kBuilder))\n          \n          \n            \n                            .findFirst();\n          \n          \n            \n                    toReturn.ifPresent(kiePMMLModel ->\n          \n          \n            \n                                               populateWithPMMLModelFields(kiePMMLModel,\n          \n          \n            \n                                                                           model.getMiningSchema(),\n          \n          \n            \n                                                                           model.getOutput()));\n          \n          \n            \n                    return toReturn;\n          \n          \n            \n                    return getModelImplementationProviderStream(model)\n          \n          \n            \n                            .map(implementation -> implementation.getKiePMMLModel(dataDictionary, transformationDictionary, model\n          \n          \n            \n                                    , kBuilder))\n          \n          \n            \n                            .peek(kiePMMLModel -> populateWithPMMLModelFields(kiePMMLModel, model.getMiningSchema(), model.getOutput()))\n          \n          \n            \n                            .findFirst();\n          \n      \n    \n    \n  \n\nNOTE: if you make populateWithPMMLModelFields returns KiePMMLModel you can replace peek with map", "url": "https://github.com/kiegroup/drools/pull/3162#discussion_r503890931", "createdAt": "2020-10-13T11:57:59Z", "author": {"login": "danielezonca"}, "path": "kie-pmml-trusty/kie-pmml-compiler/kie-pmml-compiler-commons/src/main/java/org/kie/pmml/compiler/commons/implementations/KiePMMLModelRetriever.java", "diffHunk": "@@ -53,13 +62,20 @@ private KiePMMLModelRetriever() {\n         logger.trace(\"getFromCommonDataAndTransformationDictionaryAndModel {}\", model);\n         final PMML_MODEL pmmlMODEL = PMML_MODEL.byName(model.getClass().getSimpleName());\n         logger.debug(\"pmmlModelType {}\", pmmlMODEL);\n-        return getModelImplementationProviderStream(model)\n-                .map(implementation -> implementation.getKiePMMLModel(dataDictionary, transformationDictionary, model, kBuilder))\n+        Optional<KiePMMLModel> toReturn = getModelImplementationProviderStream(model)\n+                .map(implementation -> implementation.getKiePMMLModel(dataDictionary, transformationDictionary, model\n+                        , kBuilder))\n                 .findFirst();\n+        toReturn.ifPresent(kiePMMLModel ->\n+                                   populateWithPMMLModelFields(kiePMMLModel,\n+                                                               model.getMiningSchema(),\n+                                                               model.getOutput()));\n+        return toReturn;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "8c24beb25ae1a3d11f9856e12485a62a78a266b9"}, "originalPosition": 58}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMzg5MTk1NA==", "bodyText": "?", "url": "https://github.com/kiegroup/drools/pull/3162#discussion_r503891954", "createdAt": "2020-10-13T11:59:44Z", "author": {"login": "danielezonca"}, "path": "kie-pmml-trusty/kie-pmml-compiler/kie-pmml-compiler-commons/src/main/java/org/kie/pmml/compiler/commons/utils/KiePMMLModelFactoryUtils.java", "diffHunk": "@@ -94,41 +125,118 @@ public static void addOutputFieldsPopulation(final BlockStmt body, final List<Ki\n                 builder = new MethodCallExpr(builder, \"withTargetField\", expressions);\n             }\n             if (outputField.getResultFeature() != null) {\n-                expressions = NodeList.nodeList(new NameExpr(RESULT_FEATURE.class.getName() + \".\" + outputField.getResultFeature().toString()));\n+                expressions =\n+                        NodeList.nodeList(new NameExpr(RESULT_FEATURE.class.getName() + \".\" + outputField.getResultFeature().toString()));\n                 builder = new MethodCallExpr(builder, \"withResultFeature\", expressions);\n             }\n             Expression newOutputField = new MethodCallExpr(builder, \"build\");\n             expressions = NodeList.nodeList(newOutputField);\n-            body.addStatement(new MethodCallExpr(new NameExpr(\"outputFields\"), \"add\", expressions));\n+            body.addStatement(new MethodCallExpr(new NameExpr(\"kiePMMLOutputFields\"), \"add\", expressions));\n         }\n     }\n \n     /**\n-     * Add <b>common</b> and <b>local</b> local transformations management inside the given <code>ClassOrInterfaceDeclaration</code>\n+     * Add <b>common</b> and <b>local</b> local transformations management inside the given\n+     * <code>ClassOrInterfaceDeclaration</code>\n      * @param toPopulate\n      * @param transformationDictionary\n      * @param localTransformations\n      */\n-    public static void addTransformationsInClassOrInterfaceDeclaration(final ClassOrInterfaceDeclaration toPopulate, final TransformationDictionary transformationDictionary, final LocalTransformations localTransformations) {\n+    public static void addTransformationsInClassOrInterfaceDeclaration(final ClassOrInterfaceDeclaration toPopulate,\n+                                                                       final TransformationDictionary transformationDictionary, final LocalTransformations localTransformations) {\n         final AtomicInteger arityCounter = new AtomicInteger(0);\n-        final Map<String, MethodDeclaration> commonDerivedFieldsMethodMap = (transformationDictionary != null && transformationDictionary.getDerivedFields() != null) ? getDerivedFieldsMethodMap(transformationDictionary.getDerivedFields(), arityCounter) : Collections.emptyMap();\n-        final Map<String, MethodDeclaration> localDerivedFieldsMethodMap = (localTransformations != null && localTransformations.getDerivedFields() != null) ? getDerivedFieldsMethodMap(localTransformations.getDerivedFields(), arityCounter) : Collections.emptyMap();\n-        final Map<String, MethodDeclaration> defineFunctionsMethodMap = (transformationDictionary != null && transformationDictionary.getDefineFunctions() != null) ? getDefineFunctionsMethodMap(transformationDictionary.getDefineFunctions()) : Collections.emptyMap();\n+        final Map<String, MethodDeclaration> commonDerivedFieldsMethodMap =\n+                (transformationDictionary != null && transformationDictionary.getDerivedFields() != null) ?\n+                        getDerivedFieldsMethodMap(transformationDictionary.getDerivedFields(), arityCounter) :\n+                        Collections.emptyMap();\n+        final Map<String, MethodDeclaration> localDerivedFieldsMethodMap =\n+                (localTransformations != null && localTransformations.getDerivedFields() != null) ?\n+                        getDerivedFieldsMethodMap(localTransformations.getDerivedFields(), arityCounter) :\n+                        Collections.emptyMap();\n+        final Map<String, MethodDeclaration> defineFunctionsMethodMap =\n+                (transformationDictionary != null && transformationDictionary.getDefineFunctions() != null) ?\n+                        getDefineFunctionsMethodMap(transformationDictionary.getDefineFunctions()) :\n+                        Collections.emptyMap();\n         populateMethodDeclarations(toPopulate, commonDerivedFieldsMethodMap.values());\n         populateMethodDeclarations(toPopulate, localDerivedFieldsMethodMap.values());\n         populateMethodDeclarations(toPopulate, defineFunctionsMethodMap.values());\n-        final ConstructorDeclaration constructorDeclaration = toPopulate.getDefaultConstructor().orElseThrow(() -> new KiePMMLInternalException(String.format(MISSING_DEFAULT_CONSTRUCTOR, toPopulate.getName())));\n-        populateTransformationsInConstructor(constructorDeclaration, commonDerivedFieldsMethodMap, localDerivedFieldsMethodMap);\n+        final ConstructorDeclaration constructorDeclaration =\n+                toPopulate.getDefaultConstructor().orElseThrow(() -> new KiePMMLInternalException(String.format(MISSING_DEFAULT_CONSTRUCTOR, toPopulate.getName())));\n+        populateTransformationsInConstructor(constructorDeclaration, commonDerivedFieldsMethodMap,\n+                                             localDerivedFieldsMethodMap);\n         //", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "8c24beb25ae1a3d11f9856e12485a62a78a266b9"}, "originalPosition": 143}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "2cd62767a0eee684a06b1ea7e0005ef99b733dc6", "author": {"user": {"login": "mariofusco", "name": "Mario Fusco"}}, "url": "https://github.com/kiegroup/drools/commit/2cd62767a0eee684a06b1ea7e0005ef99b733dc6", "committedDate": "2020-10-13T17:17:36Z", "message": "wip"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c8a9fcf636d5a6317fab8e2bffcfaf896ee946c9", "author": {"user": {"login": "mariofusco", "name": "Mario Fusco"}}, "url": "https://github.com/kiegroup/drools/commit/c8a9fcf636d5a6317fab8e2bffcfaf896ee946c9", "committedDate": "2020-10-14T06:46:51Z", "message": "wip"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "eb56e9575ebed0dd09b3a7bb7b25d531446e5814", "author": {"user": {"login": "gitgabrio", "name": "Gabriele Cardosi"}}, "url": "https://github.com/kiegroup/drools/commit/eb56e9575ebed0dd09b3a7bb7b25d531446e5814", "committedDate": "2020-10-14T07:05:59Z", "message": "Merge remote-tracking branch 'origin/master' into DROOLS-5688"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "70a49d8ced70fee192d88b9b2b619099a9a50c46", "author": {"user": {"login": "gitgabrio", "name": "Gabriele Cardosi"}}, "url": "https://github.com/kiegroup/drools/commit/70a49d8ced70fee192d88b9b2b619099a9a50c46", "committedDate": "2020-10-14T10:19:23Z", "message": "[DROOLS-5688] Fixed as per PR suggestion"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f575a3a5bd582af6400ee6e1206de79958fd5eef", "author": {"user": {"login": "gitgabrio", "name": "Gabriele Cardosi"}}, "url": "https://github.com/kiegroup/drools/commit/f575a3a5bd582af6400ee6e1206de79958fd5eef", "committedDate": "2020-10-14T10:38:34Z", "message": "Merge remote-tracking branch 'mariofusco/d5720' into DROOLS-5688\n\n# Conflicts:\n#\tkie-dmn/kie-dmn-core/src/main/java/org/kie/dmn/core/pmml/DMNKiePMMLTrustyInvocationEvaluator.java\n#\tkie-pmml-trusty/kie-pmml-evaluator/kie-pmml-evaluator-assembler/src/main/java/org/kie/pmml/evaluator/assembler/factories/PMMLRuntimeFactoryInternal.java"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ece4afc23595fb741d32079946ce223354903c4a", "author": {"user": {"login": "gitgabrio", "name": "Gabriele Cardosi"}}, "url": "https://github.com/kiegroup/drools/commit/ece4afc23595fb741d32079946ce223354903c4a", "committedDate": "2020-10-14T11:19:58Z", "message": "[DROOLS-5688] Merged with d5720. API cleanup"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTA4MjA1ODQx", "url": "https://github.com/kiegroup/drools/pull/3162#pullrequestreview-508205841", "createdAt": "2020-10-14T10:25:25Z", "commit": {"oid": "70a49d8ced70fee192d88b9b2b619099a9a50c46"}, "state": "COMMENTED", "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xNFQxMDoyNToyNVrOHhMbTw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xNFQxMTo0MDoyMVrOHhO2PQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNDU2ODY1NQ==", "bodyText": "Unused import", "url": "https://github.com/kiegroup/drools/pull/3162#discussion_r504568655", "createdAt": "2020-10-14T10:25:25Z", "author": {"login": "danielezonca"}, "path": "kie-pmml-trusty/kie-pmml-api/src/main/java/org/kie/pmml/api/runtime/PMMLRuntime.java", "diffHunk": "@@ -0,0 +1,51 @@\n+/*\n+ * Copyright 2020 Red Hat, Inc. and/or its affiliates.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+package org.kie.pmml.api.runtime;\n+\n+import java.util.List;\n+import java.util.Optional;\n+\n+import org.kie.api.pmml.PMML4Result;\n+import org.kie.pmml.api.models.PMMLModel;\n+import org.kie.pmml.api.models.PMMLModelImpl;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "70a49d8ced70fee192d88b9b2b619099a9a50c46"}, "originalPosition": 23}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNDU2OTU1Mg==", "bodyText": "To be removed", "url": "https://github.com/kiegroup/drools/pull/3162#discussion_r504569552", "createdAt": "2020-10-14T10:27:06Z", "author": {"login": "danielezonca"}, "path": "kie-pmml-trusty/kie-pmml-evaluator/kie-pmml-evaluator-assembler/src/main/java/org/kie/pmml/evaluator/assembler/factories/PMMLRuntimeFactoryImpl.java", "diffHunk": "@@ -0,0 +1,146 @@\n+/*\n+ * Copyright 2020 Red Hat, Inc. and/or its affiliates.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+package org.kie.pmml.evaluator.assembler.factories;\n+\n+import java.io.File;\n+import java.io.FileOutputStream;\n+import java.io.InputStream;\n+\n+import org.drools.compiler.kie.builder.impl.InternalKieModule;\n+import org.drools.compiler.kie.builder.impl.KieContainerImpl;\n+import org.drools.compiler.kproject.ReleaseIdImpl;\n+import org.drools.core.io.internal.InternalResource;\n+import org.kie.api.KieServices;\n+import org.kie.api.builder.ReleaseId;\n+import org.kie.pmml.api.PMMLRuntimeFactory;\n+import org.kie.pmml.api.exceptions.ExternalException;\n+import org.kie.pmml.api.runtime.PMMLRuntime;\n+import org.slf4j.Logger;\n+import org.slf4j.LoggerFactory;\n+\n+import static org.apache.commons.io.FileUtils.getFile;\n+\n+public class PMMLRuntimeFactoryImpl implements PMMLRuntimeFactory {\n+\n+    private static final Logger logger = LoggerFactory.getLogger(PMMLRuntimeFactoryImpl.class);\n+    private static  final KieServices KIE_SERVICES = KieServices.get();\n+\n+    @Override\n+    public PMMLRuntime getPMMLRuntimeFromFile(String modelName, File pmmlFile) {\n+        return PMMLRuntimeFactoryInternal.getPMMLRuntime(modelName, pmmlFile);\n+    }\n+\n+    @Override\n+    public PMMLRuntime getPMMLRuntimeFromClasspath(String modelName, String pmmlFileName) {\n+        File pmmlFile = getPMMLFileFromClasspath(pmmlFileName);\n+        return PMMLRuntimeFactoryInternal.getPMMLRuntime(modelName, pmmlFile);\n+    }\n+\n+    @Override\n+    public PMMLRuntime getPMMLRuntimeFromKieContainerByKieBase(String modelName, String kieBase, String pmmlFileName, String gav) {\n+        ReleaseId releaseId = new ReleaseIdImpl(gav);\n+        File pmmlFile = getPMMLFileFromKieContainerByKieBase(pmmlFileName, kieBase, releaseId);\n+        return PMMLRuntimeFactoryInternal.getPMMLRuntime(modelName, pmmlFile, releaseId);\n+    }\n+\n+    @Override\n+    public PMMLRuntime getPMMLRuntimeFromKieContainerByDefaultKieBase(String modelName, String pmmlFileName, String gav) {\n+        ReleaseId releaseId = new ReleaseIdImpl(gav);\n+        File pmmlFile = getPMMLFileFromKieContainerByDefaultKieBase(pmmlFileName, releaseId);\n+        return PMMLRuntimeFactoryInternal.getPMMLRuntime(modelName, pmmlFile, releaseId);\n+    }\n+\n+    /**\n+     * Load a <code>File</code> with the given <b>pmmlFileName</b> from the\n+     * current <code>Classloader</code>\n+     *\n+     * @param pmmlFileName\n+     * @return\n+     */\n+    private File getPMMLFileFromClasspath(final String pmmlFileName) {\n+        return getFile(pmmlFileName);\n+    }\n+\n+    /**\n+     * Load a <code>File</code> with the given <b>pmmlFileName</b> from the <code>kjar</code> contained in the\n+     * <code>KieContainer</code> with the given <code>ReleaseId</code>\n+     *\n+     * @param pmmlFileName\n+     * @param kieBase the name of the Kiebase configured inside the <b>kmodule.xml</b> of the loaded <b>kjar</b>\n+     * @param releaseId\n+     * @return\n+     */\n+    private File getPMMLFileFromKieContainerByKieBase(final String pmmlFileName, final String kieBase, final ReleaseId releaseId) {\n+        //kieContainer.getKieProject().getDefaultKieBaseModel().getName()", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "70a49d8ced70fee192d88b9b2b619099a9a50c46"}, "originalPosition": 87}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNDYwODMxNw==", "bodyText": "Ok let's revisit it in another iteration", "url": "https://github.com/kiegroup/drools/pull/3162#discussion_r504608317", "createdAt": "2020-10-14T11:40:21Z", "author": {"login": "danielezonca"}, "path": "kie-pmml-trusty/kie-pmml-api/src/main/java/org/kie/pmml/api/PMMLRuntimeFactory.java", "diffHunk": "@@ -0,0 +1,60 @@\n+/*\n+ * Copyright 2020 Red Hat, Inc. and/or its affiliates.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+package org.kie.pmml.api;\n+\n+import java.io.File;\n+\n+import org.kie.pmml.api.runtime.PMMLRuntime;\n+\n+public interface PMMLRuntimeFactory {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMzc0Mjk5NQ=="}, "originalCommit": {"oid": "8c24beb25ae1a3d11f9856e12485a62a78a266b9"}, "originalPosition": 22}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTA4MjU3MzA2", "url": "https://github.com/kiegroup/drools/pull/3162#pullrequestreview-508257306", "createdAt": "2020-10-14T11:41:19Z", "commit": {"oid": "ece4afc23595fb741d32079946ce223354903c4a"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "bcd758b49cbeeba7bb8474cd469ffb6077029505", "author": {"user": {"login": "gitgabrio", "name": "Gabriele Cardosi"}}, "url": "https://github.com/kiegroup/drools/commit/bcd758b49cbeeba7bb8474cd469ffb6077029505", "committedDate": "2020-10-14T13:47:37Z", "message": "Merge remote-tracking branch 'origin/master' into DROOLS-5688\n\n# Conflicts:\n#\tkie-dmn/kie-dmn-core/src/main/java/org/kie/dmn/core/pmml/DMNKiePMMLTrustyInvocationEvaluator.java\n#\tkie-pmml-trusty/kie-pmml-evaluator/kie-pmml-evaluator-assembler/src/main/java/org/kie/pmml/evaluator/assembler/factories/PMMLRuntimeFactoryInternal.java"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "2175dd33d873127f31538a8f66b0dd6a2190aeb2", "author": {"user": {"login": "gitgabrio", "name": "Gabriele Cardosi"}}, "url": "https://github.com/kiegroup/drools/commit/2175dd33d873127f31538a8f66b0dd6a2190aeb2", "committedDate": "2020-10-14T16:00:01Z", "message": "[DROOLS-5688] Fixed consistent use of PMMLRuntime"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "fa7027dd61b0a31e977d86f5872f787d60a3751a", "author": {"user": {"login": "gitgabrio", "name": "Gabriele Cardosi"}}, "url": "https://github.com/kiegroup/drools/commit/fa7027dd61b0a31e977d86f5872f787d60a3751a", "committedDate": "2020-10-15T07:51:12Z", "message": "Merge remote-tracking branch 'origin/master' into DROOLS-5688"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1828, "cost": 1, "resetAt": "2021-11-01T15:33:45Z"}}}