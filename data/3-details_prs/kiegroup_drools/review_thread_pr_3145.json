{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDk5MDUxOTc2", "number": 3145, "reviewThreads": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yMlQwNjoxNjo1NFrOEwnIWw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yM1QwNzo0NTo0NlrOExF2Gg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzE5NDA4MjE5OnYy", "diffSide": "RIGHT", "path": "drools-alphanetwork-compiler/src/main/java/org/drools/ancompiler/CompiledNetwork.java", "isResolved": false, "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yMlQwNjoxNjo1NFrOHmSFpg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yM1QwMzoxODoxNlrOHm6yww==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwOTkwNDI5NA==", "bodyText": "A little uncomfortable to change the method signature for this minor tuning parameter. But I follow the same approach as alphaNodeHashingThreshold at the moment. We may file another JIRA to check if we can simplify it.", "url": "https://github.com/kiegroup/drools/pull/3145#discussion_r509904294", "createdAt": "2020-10-22T06:16:54Z", "author": {"login": "tkobayas"}, "path": "drools-alphanetwork-compiler/src/main/java/org/drools/ancompiler/CompiledNetwork.java", "diffHunk": "@@ -167,8 +167,8 @@ public void startWindowNode(WindowNode windowNode) {\n     }\n \n     @Override\n-    public ObjectSinkPropagator addObjectSink(ObjectSink sink, int alphaNodeHashingThreshold) {\n-        return originalSinkPropagator.addObjectSink(sink, alphaNodeHashingThreshold);\n+    public ObjectSinkPropagator addObjectSink(ObjectSink sink, int alphaNodeHashingThreshold, int alphaNodeRangeIndexThreshold) {\n+        return originalSinkPropagator.addObjectSink(sink, alphaNodeHashingThreshold, alphaNodeRangeIndexThreshold);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "9f5c7b12a6dc242d00fbe038bb8eb49a2769fbb0"}, "originalPosition": 7}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMDIwODUwMQ==", "bodyText": "@tkobayas I agree, it would be better to encapsulate all this configuration parameter in single conf object and pass it around, but this is an improvement that we can add later. Please create another jira to avoid forgetting it.", "url": "https://github.com/kiegroup/drools/pull/3145#discussion_r510208501", "createdAt": "2020-10-22T14:28:53Z", "author": {"login": "mariofusco"}, "path": "drools-alphanetwork-compiler/src/main/java/org/drools/ancompiler/CompiledNetwork.java", "diffHunk": "@@ -167,8 +167,8 @@ public void startWindowNode(WindowNode windowNode) {\n     }\n \n     @Override\n-    public ObjectSinkPropagator addObjectSink(ObjectSink sink, int alphaNodeHashingThreshold) {\n-        return originalSinkPropagator.addObjectSink(sink, alphaNodeHashingThreshold);\n+    public ObjectSinkPropagator addObjectSink(ObjectSink sink, int alphaNodeHashingThreshold, int alphaNodeRangeIndexThreshold) {\n+        return originalSinkPropagator.addObjectSink(sink, alphaNodeHashingThreshold, alphaNodeRangeIndexThreshold);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwOTkwNDI5NA=="}, "originalCommit": {"oid": "9f5c7b12a6dc242d00fbe038bb8eb49a2769fbb0"}, "originalPosition": 7}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMDU3MTIwMw==", "bodyText": "@mariofusco Thanks. I filed https://issues.redhat.com/browse/DROOLS-5755", "url": "https://github.com/kiegroup/drools/pull/3145#discussion_r510571203", "createdAt": "2020-10-23T03:18:16Z", "author": {"login": "tkobayas"}, "path": "drools-alphanetwork-compiler/src/main/java/org/drools/ancompiler/CompiledNetwork.java", "diffHunk": "@@ -167,8 +167,8 @@ public void startWindowNode(WindowNode windowNode) {\n     }\n \n     @Override\n-    public ObjectSinkPropagator addObjectSink(ObjectSink sink, int alphaNodeHashingThreshold) {\n-        return originalSinkPropagator.addObjectSink(sink, alphaNodeHashingThreshold);\n+    public ObjectSinkPropagator addObjectSink(ObjectSink sink, int alphaNodeHashingThreshold, int alphaNodeRangeIndexThreshold) {\n+        return originalSinkPropagator.addObjectSink(sink, alphaNodeHashingThreshold, alphaNodeRangeIndexThreshold);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwOTkwNDI5NA=="}, "originalCommit": {"oid": "9f5c7b12a6dc242d00fbe038bb8eb49a2769fbb0"}, "originalPosition": 7}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzE5NjAzNzEyOnYy", "diffSide": "RIGHT", "path": "drools-core/src/main/java/org/drools/core/reteoo/CompositeObjectSinkAdapter.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yMlQxNDozNDoyOVrOHmk8hA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yM1QwNTozNToxOFrOHm9o0Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMDIxMzI1Mg==", "bodyText": "Is this necessary? Isn't the AlphaNodeRangeIndexThreshold enough to also completely disable the range indexing when required?", "url": "https://github.com/kiegroup/drools/pull/3145#discussion_r510213252", "createdAt": "2020-10-22T14:34:29Z", "author": {"login": "mariofusco"}, "path": "drools-core/src/main/java/org/drools/core/reteoo/CompositeObjectSinkAdapter.java", "diffHunk": "@@ -51,43 +57,59 @@\n     //    public static final int    THRESHOLD_TO_HASH              = Integer.parseInt( System.getProperty( HASH_THRESHOLD_SYSTEM_PROPERTY,\n     //                                                                                                      \"3\" ) );\n \n+    public static final boolean RANGE_INDEX_ENABLED = Boolean.parseBoolean( System.getProperty( \"drools.alphaNodeRangeIndex.enabled\", \"true\"));", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "9f5c7b12a6dc242d00fbe038bb8eb49a2769fbb0"}, "originalPosition": 29}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMDYxNzgwOQ==", "bodyText": "Sure, I'll remove the system property.", "url": "https://github.com/kiegroup/drools/pull/3145#discussion_r510617809", "createdAt": "2020-10-23T05:35:18Z", "author": {"login": "tkobayas"}, "path": "drools-core/src/main/java/org/drools/core/reteoo/CompositeObjectSinkAdapter.java", "diffHunk": "@@ -51,43 +57,59 @@\n     //    public static final int    THRESHOLD_TO_HASH              = Integer.parseInt( System.getProperty( HASH_THRESHOLD_SYSTEM_PROPERTY,\n     //                                                                                                      \"3\" ) );\n \n+    public static final boolean RANGE_INDEX_ENABLED = Boolean.parseBoolean( System.getProperty( \"drools.alphaNodeRangeIndex.enabled\", \"true\"));", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMDIxMzI1Mg=="}, "originalCommit": {"oid": "9f5c7b12a6dc242d00fbe038bb8eb49a2769fbb0"}, "originalPosition": 29}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzE5OTExNDUwOnYy", "diffSide": "RIGHT", "path": "drools-core/src/test/java/org/drools/core/util/index/RangeIndexTest.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yM1QwNzo0NTo0NlrOHnCdcw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yM1QwODowMTowNFrOHnC-rg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMDY5NjgxOQ==", "bodyText": "Is this rule used as reference for the test below? I'd add a comment", "url": "https://github.com/kiegroup/drools/pull/3145#discussion_r510696819", "createdAt": "2020-10-23T07:45:46Z", "author": {"login": "lucamolteni"}, "path": "drools-core/src/test/java/org/drools/core/util/index/RangeIndexTest.java", "diffHunk": "@@ -0,0 +1,120 @@\n+/*\n+ * Copyright 2020 Red Hat, Inc. and/or its affiliates.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * \n+ *      http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+*/\n+\n+package org.drools.core.util.index;\n+\n+import java.util.ArrayList;\n+import java.util.Collection;\n+import java.util.List;\n+import java.util.function.IntPredicate;\n+\n+import org.assertj.core.api.Assertions;\n+import org.drools.core.reteoo.AlphaNode;\n+import org.drools.core.test.model.Person;\n+import org.drools.core.util.Entry;\n+import org.drools.core.util.FastIterator;\n+import org.drools.core.util.RBTree.Node;\n+import org.junit.Test;\n+\n+public class RangeIndexTest {\n+\n+    final String drl =", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "9f5c7b12a6dc242d00fbe038bb8eb49a2769fbb0"}, "originalPosition": 33}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMDcwNTMyNg==", "bodyText": "@lucamolteni Thanks! I'll add a comment", "url": "https://github.com/kiegroup/drools/pull/3145#discussion_r510705326", "createdAt": "2020-10-23T08:01:04Z", "author": {"login": "tkobayas"}, "path": "drools-core/src/test/java/org/drools/core/util/index/RangeIndexTest.java", "diffHunk": "@@ -0,0 +1,120 @@\n+/*\n+ * Copyright 2020 Red Hat, Inc. and/or its affiliates.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * \n+ *      http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+*/\n+\n+package org.drools.core.util.index;\n+\n+import java.util.ArrayList;\n+import java.util.Collection;\n+import java.util.List;\n+import java.util.function.IntPredicate;\n+\n+import org.assertj.core.api.Assertions;\n+import org.drools.core.reteoo.AlphaNode;\n+import org.drools.core.test.model.Person;\n+import org.drools.core.util.Entry;\n+import org.drools.core.util.FastIterator;\n+import org.drools.core.util.RBTree.Node;\n+import org.junit.Test;\n+\n+public class RangeIndexTest {\n+\n+    final String drl =", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMDY5NjgxOQ=="}, "originalCommit": {"oid": "9f5c7b12a6dc242d00fbe038bb8eb49a2769fbb0"}, "originalPosition": 33}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2330, "cost": 1, "resetAt": "2021-11-12T20:28:25Z"}}}