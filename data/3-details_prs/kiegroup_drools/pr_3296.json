{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTQyNjcxNTYz", "number": 3296, "title": "[DROOLS-5861] Fixing KieBase/Classloader usage", "bodyText": "@danielezonca @mariofusco @jiripetrlik\nSee https://issues.redhat.com/browse/DROOLS-5861\nDepends on\nkiegroup/droolsjbpm-knowledge#492\nNeeded by:\nkiegroup/kogito-runtimes#973", "createdAt": "2020-12-18T17:13:50Z", "url": "https://github.com/kiegroup/drools/pull/3296", "merged": true, "mergeCommit": {"oid": "f3fc686e4eeb449a804e1247b47f9f7a526a8304"}, "closed": true, "closedAt": "2021-01-22T16:11:00Z", "author": {"login": "gitgabrio"}, "timelineItems": {"totalCount": 54, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdmDNNXAH2gAyNTQyNjcxNTYzOjI0YTZjZjUwOGU5NjdmZjkxNzcyNzkwMjRkMzVkOGJhMzIxZjQ1ODM=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdyoErvAFqTU3NDIwNjMzMA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "24a6cf508e967ff9177279024d35d8ba321f4583", "author": {"user": {"login": "gitgabrio", "name": "Gabriele Cardosi"}}, "url": "https://github.com/kiegroup/drools/commit/24a6cf508e967ff9177279024d35d8ba321f4583", "committedDate": "2020-12-14T10:30:30Z", "message": "[DROOLS-5860] Implementing interfaces to propagate classloader"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b973b0bdde633f4e8bb53f9f5856961fe4ecdbb4", "author": {"user": {"login": "gitgabrio", "name": "Gabriele Cardosi"}}, "url": "https://github.com/kiegroup/drools/commit/b973b0bdde633f4e8bb53f9f5856961fe4ecdbb4", "committedDate": "2020-12-14T10:32:08Z", "message": "Merge remote-tracking branch 'origin/master' into DROOLS-5860"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "d00ba0b5b789e3dec6765fe661e61be5997b39f9", "author": {"user": {"login": "gitgabrio", "name": "Gabriele Cardosi"}}, "url": "https://github.com/kiegroup/drools/commit/d00ba0b5b789e3dec6765fe661e61be5997b39f9", "committedDate": "2020-12-14T13:48:59Z", "message": "[DROOLS-5860] Update kie-pmml-dependencies definition"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e4b51a18bb0c90ce1f07427130b00f92c3ba98bc", "author": {"user": {"login": "gitgabrio", "name": "Gabriele Cardosi"}}, "url": "https://github.com/kiegroup/drools/commit/e4b51a18bb0c90ce1f07427130b00f92c3ba98bc", "committedDate": "2020-12-14T16:35:03Z", "message": "[DROOLS-5860] Fixing AbstractPMMLInvocationEvaluator to use PMMLImplementationsUtil.toEnable"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "3af6f6b0720af1239e32653eb70bce241afc6447", "author": {"user": {"login": "gitgabrio", "name": "Gabriele Cardosi"}}, "url": "https://github.com/kiegroup/drools/commit/3af6f6b0720af1239e32653eb70bce241afc6447", "committedDate": "2020-12-15T13:39:34Z", "message": "[DROOLS-5860] Fixing as per PR request"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "73c5ef3bebdf1ba01cc83c9f61c01ea98d262c1f", "author": {"user": {"login": "gitgabrio", "name": "Gabriele Cardosi"}}, "url": "https://github.com/kiegroup/drools/commit/73c5ef3bebdf1ba01cc83c9f61c01ea98d262c1f", "committedDate": "2020-12-15T13:44:48Z", "message": "Merge branch 'DROOLS-5860' into DROOLS-5898"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "0d8cc04cecd1f0bc96c5f97720bbd2d5494fae35", "author": {"user": {"login": "gitgabrio", "name": "Gabriele Cardosi"}}, "url": "https://github.com/kiegroup/drools/commit/0d8cc04cecd1f0bc96c5f97720bbd2d5494fae35", "committedDate": "2020-12-15T15:30:12Z", "message": "[DROOLS-5898] Implementing Serializable on PMML models"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "2e263e75edf845b57b8a7f04cfd90173ab3981d3", "author": {"user": {"login": "gitgabrio", "name": "Gabriele Cardosi"}}, "url": "https://github.com/kiegroup/drools/commit/2e263e75edf845b57b8a7f04cfd90173ab3981d3", "committedDate": "2020-12-16T16:16:55Z", "message": "Merge remote-tracking branch 'origin/master' into DROOLS-5898\n\n# Conflicts:\n#\tkie-pmml-trusty/kie-pmml-models/kie-pmml-models-drools/kie-pmml-models-drools-scorecard/kie-pmml-models-drools-scorecard-compiler/src/test/java/org/kie/pmml/models/drools/scorecard/compiler/executor/ScorecardModelImplementationProviderTest.java\n#\tkie-pmml-trusty/kie-pmml-models/kie-pmml-models-drools/kie-pmml-models-drools-tree/kie-pmml-models-drools-tree-compiler/src/test/java/org/kie/pmml/models/drools/tree/compiler/executor/TreeModelImplementationProviderTest.java\n#\tkie-pmml-trusty/kie-pmml-models/kie-pmml-models-mining/kie-pmml-models-mining-compiler/src/test/java/org/kie/pmml/models/mining/compiler/executor/MiningModelImplementationProviderTest.java"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "103d8bde2036ffbdc5ebab77de0a5ad23c9bea68", "author": {"user": {"login": "gitgabrio", "name": "Gabriele Cardosi"}}, "url": "https://github.com/kiegroup/drools/commit/103d8bde2036ffbdc5ebab77de0a5ad23c9bea68", "committedDate": "2020-12-16T16:21:42Z", "message": "[DROOLS-5898] Merge master"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "0c2538b1dd54bf99e3c3c94855dcbad5b8d60dc9", "author": {"user": {"login": "gitgabrio", "name": "Gabriele Cardosi"}}, "url": "https://github.com/kiegroup/drools/commit/0c2538b1dd54bf99e3c3c94855dcbad5b8d60dc9", "committedDate": "2020-12-17T09:05:21Z", "message": "Merge remote-tracking branch 'origin/master' into DROOLS-5898"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "4dcf840d0a5c11e8e536ad7d6d77d8af119ef283", "author": {"user": {"login": "gitgabrio", "name": "Gabriele Cardosi"}}, "url": "https://github.com/kiegroup/drools/commit/4dcf840d0a5c11e8e536ad7d6d77d8af119ef283", "committedDate": "2020-12-17T09:42:20Z", "message": "[DROOLS-5898] Make KiePMMLExtension serializable"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "44c94bbe4d187d17b6f15d752fb4627fbb54735b", "author": {"user": {"login": "gitgabrio", "name": "Gabriele Cardosi"}}, "url": "https://github.com/kiegroup/drools/commit/44c94bbe4d187d17b6f15d752fb4627fbb54735b", "committedDate": "2020-12-18T17:12:22Z", "message": "[DROOLS-5861] Retrieveing kiebase from command Context. Populating classloader with compiled sources."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "95d274a7d86f06982f2bf268c07f92d9baa1e4f5", "author": {"user": {"login": "danielezonca", "name": "Daniele Zonca"}}, "url": "https://github.com/kiegroup/drools/commit/95d274a7d86f06982f2bf268c07f92d9baa1e4f5", "committedDate": "2020-12-20T17:55:14Z", "message": "Make KieMemoryCompiler more flexible"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTU2MDM3NDEy", "url": "https://github.com/kiegroup/drools/pull/3296#pullrequestreview-556037412", "createdAt": "2020-12-20T17:41:31Z", "commit": {"oid": "44c94bbe4d187d17b6f15d752fb4627fbb54735b"}, "state": "COMMENTED", "comments": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0yMFQxNzo0MTozMVrOIJGDKQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0yMFQxNzo1ODowOVrOIJGKTA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NjQwNzIwOQ==", "bodyText": "Please add a comment like \"configure result to be equivalent of old kie-pmml impl\"", "url": "https://github.com/kiegroup/drools/pull/3296#discussion_r546407209", "createdAt": "2020-12-20T17:41:31Z", "author": {"login": "danielezonca"}, "path": "drools-core/src/main/java/org/drools/core/command/runtime/pmml/ApplyPmmlModelCommand.java", "diffHunk": "@@ -167,7 +170,14 @@ protected PMML4Result executePMMLLegacy(Context context) {\n                                                                                          packageName, isMining());\n     }\n \n-    protected PMML4Result executePMMLTrusty() {\n-        return PMMLCommandExecutorFactory.get().newPMMLCommandExecutor().execute(requestData);\n+    protected PMML4Result executePMMLTrusty(Context context) {\n+        RegistryContext registryContext = (RegistryContext) context;\n+        PMML4Result toReturn = PMMLCommandExecutorFactory.get().newPMMLCommandExecutor().execute(requestData, context);\n+        Optional<ExecutionResultImpl> execRes = Optional.ofNullable(registryContext.lookup(ExecutionResultImpl.class));\n+        registryContext.register(PMML4Result.class, toReturn);\n+        execRes.ifPresent(result -> {\n+            result.setResult(\"results\", toReturn);\n+        });", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "44c94bbe4d187d17b6f15d752fb4627fbb54735b"}, "originalPosition": 43}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NjQwNzI2OA==", "bodyText": "To be removed", "url": "https://github.com/kiegroup/drools/pull/3296#discussion_r546407268", "createdAt": "2020-12-20T17:42:08Z", "author": {"login": "danielezonca"}, "path": "kie-pmml-trusty/kie-pmml-compiler/kie-pmml-compiler-commons/pom.xml", "diffHunk": "@@ -47,11 +56,11 @@\n         </exclusion>\n       </exclusions>\n     </dependency>\n-    <dependency>\n-      <groupId>org.kie</groupId>\n-      <artifactId>kie-memory-compiler</artifactId>\n-      <scope>test</scope>\n-    </dependency>\n+<!--    <dependency>-->\n+<!--      <groupId>org.kie</groupId>-->\n+<!--      <artifactId>kie-memory-compiler</artifactId>-->\n+<!--      <scope>test</scope>-->\n+<!--    </dependency>-->", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "44c94bbe4d187d17b6f15d752fb4627fbb54735b"}, "originalPosition": 29}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NjQwNzQ4OA==", "bodyText": "Please add a Javadoc to refer JSONMarshallerPMMLParamInfo behavior", "url": "https://github.com/kiegroup/drools/pull/3296#discussion_r546407488", "createdAt": "2020-12-20T17:43:54Z", "author": {"login": "danielezonca"}, "path": "kie-pmml-trusty/kie-pmml-evaluator/kie-pmml-evaluator-assembler/src/main/java/org/kie/pmml/evaluator/assembler/command/PMMLCommandExecutorImpl.java", "diffHunk": "@@ -60,7 +67,22 @@ private PMML4Result evaluate(final PMMLRequestData pmmlRequestData, final PMMLRu\n         return pmmlRuntime.evaluate(modelName, pmmlContext);\n     }\n \n-    private PMMLRuntime getPMMLRuntime(String pmmlFileName) {\n-        return PMML_RUNTIME_FACTORY.getPMMLRuntimeFromClasspath(pmmlFileName);\n+    private PMMLRuntime getPMMLRuntime(String pmmlFileName, String pmmlModelName, KieBase kieBase) {\n+        return PMML_RUNTIME_FACTORY.getPMMLRuntimeFromFileNameModelNameAndKieBase(pmmlFileName, pmmlModelName, kieBase);\n+    }\n+\n+    @SuppressWarnings(\"rawtype\")\n+    private PMMLRequestData getCleanedRequestData(PMMLRequestData toClean) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "44c94bbe4d187d17b6f15d752fb4627fbb54735b"}, "originalPosition": 54}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NjQwOTAzNg==", "bodyText": "Please accept this PR to make compile method more flexible\ngitgabrio#1", "url": "https://github.com/kiegroup/drools/pull/3296#discussion_r546409036", "createdAt": "2020-12-20T17:58:09Z", "author": {"login": "danielezonca"}, "path": "kie-memory-compiler/src/main/java/org/kie/memorycompiler/KieMemoryCompiler.java", "diffHunk": "@@ -29,14 +29,39 @@\n     private KieMemoryCompiler() { }\n \n     /**\n-     * Compile the given sources and add compiled classes to the given <code>ClassLoader</code>\n+     * Compile the given sources <b>without</b> adding compiled classes to the given <code>ClassLoader</code>\n      * <b>classNameSourceMap</b>' key must be the <b>FQDN</b> of the class to compile\n      *\n      * @param classNameSourceMap\n      * @param classLoader\n      * @return\n      */\n     public static Map<String, Class<?>> compile(Map<String, String> classNameSourceMap, ClassLoader classLoader) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "44c94bbe4d187d17b6f15d752fb4627fbb54735b"}, "originalPosition": 12}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "348dba2b7d4636d21d4e1a446eb1fee9bb96b499", "author": {"user": {"login": "gitgabrio", "name": "Gabriele Cardosi"}}, "url": "https://github.com/kiegroup/drools/commit/348dba2b7d4636d21d4e1a446eb1fee9bb96b499", "committedDate": "2020-12-21T08:06:07Z", "message": "Merge remote-tracking branch 'origin/master' into DROOLS-5861"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "7b2d3a9d80e6833c0da5bc8167f59454bceb3b55", "author": {"user": {"login": "gitgabrio", "name": "Gabriele Cardosi"}}, "url": "https://github.com/kiegroup/drools/commit/7b2d3a9d80e6833c0da5bc8167f59454bceb3b55", "committedDate": "2020-12-21T09:34:40Z", "message": "[DROOLS-5861] Avoid propagation of drools dependency."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "bb75a2250c3ba5cbc952aa66c72b66394621e9a9", "author": {"user": {"login": "gitgabrio", "name": "Gabriele Cardosi"}}, "url": "https://github.com/kiegroup/drools/commit/bb75a2250c3ba5cbc952aa66c72b66394621e9a9", "committedDate": "2020-12-21T09:39:32Z", "message": "Merge pull request #1 from danielezonca/improve_kiememorycompiler\n\nMake KieMemoryCompiler more flexible"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c7f46c32a4d66c200a29b9df35c166f55c9a128d", "author": {"user": {"login": "gitgabrio", "name": "Gabriele Cardosi"}}, "url": "https://github.com/kiegroup/drools/commit/c7f46c32a4d66c200a29b9df35c166f55c9a128d", "committedDate": "2020-12-21T09:41:20Z", "message": "Merge branch 'DROOLS-5861' of github.com:gitgabrio/drools into DROOLS-5861"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "64a10334c63a86086158e35557c58e124c3d90c1", "author": {"user": {"login": "gitgabrio", "name": "Gabriele Cardosi"}}, "url": "https://github.com/kiegroup/drools/commit/64a10334c63a86086158e35557c58e124c3d90c1", "committedDate": "2020-12-21T09:43:53Z", "message": "Merge remote-tracking branch 'origin/master' into DROOLS-5861"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "1ea635ec5fbc446b3896f04585546cea187bdaa5", "author": {"user": {"login": "gitgabrio", "name": "Gabriele Cardosi"}}, "url": "https://github.com/kiegroup/drools/commit/1ea635ec5fbc446b3896f04585546cea187bdaa5", "committedDate": "2020-12-21T10:10:09Z", "message": "[DROOLS-5861] Fixed as per PR suggestion"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTU2MzE5NTEy", "url": "https://github.com/kiegroup/drools/pull/3296#pullrequestreview-556319512", "createdAt": "2020-12-21T11:41:55Z", "commit": {"oid": "1ea635ec5fbc446b3896f04585546cea187bdaa5"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b1b23a13ca312536b43318fcfab4c9e6d829eeca", "author": {"user": {"login": "gitgabrio", "name": "Gabriele Cardosi"}}, "url": "https://github.com/kiegroup/drools/commit/b1b23a13ca312536b43318fcfab4c9e6d829eeca", "committedDate": "2020-12-21T13:22:38Z", "message": "[DROOLS-5861] Add tests"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTU2NDY0ODcx", "url": "https://github.com/kiegroup/drools/pull/3296#pullrequestreview-556464871", "createdAt": "2020-12-21T15:32:12Z", "commit": {"oid": "b1b23a13ca312536b43318fcfab4c9e6d829eeca"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0yMVQxNTozMjoxMlrOIJcRPw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0yMVQxNTozMjoxMlrOIJcRPw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0Njc3MTI2Mw==", "bodyText": "This use of Optional is very questionable. I don't see any valid reason to wrap the result of that lookup into an Optional only to test if it is empty or not and take some action accordingly.", "url": "https://github.com/kiegroup/drools/pull/3296#discussion_r546771263", "createdAt": "2020-12-21T15:32:12Z", "author": {"login": "mariofusco"}, "path": "drools-core/src/main/java/org/drools/core/command/runtime/pmml/ApplyPmmlModelCommand.java", "diffHunk": "@@ -167,7 +170,14 @@ protected PMML4Result executePMMLLegacy(Context context) {\n                                                                                          packageName, isMining());\n     }\n \n-    protected PMML4Result executePMMLTrusty() {\n-        return PMMLCommandExecutorFactory.get().newPMMLCommandExecutor().execute(requestData);\n+    protected PMML4Result executePMMLTrusty(Context context) {\n+        RegistryContext registryContext = (RegistryContext) context;\n+        PMML4Result toReturn = PMMLCommandExecutorFactory.get().newPMMLCommandExecutor().execute(requestData, context);\n+        // Needed to update the ExecutionResultImpl and the Registry context,\n+        // has done inside legacy implementation\n+        Optional<ExecutionResultImpl> execRes = Optional.ofNullable(registryContext.lookup(ExecutionResultImpl.class));", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b1b23a13ca312536b43318fcfab4c9e6d829eeca"}, "originalPosition": 41}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTU2NTIwMDUz", "url": "https://github.com/kiegroup/drools/pull/3296#pullrequestreview-556520053", "createdAt": "2020-12-21T16:50:45Z", "commit": {"oid": "b1b23a13ca312536b43318fcfab4c9e6d829eeca"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "0167e89f68c810942ea1ee0e5e8c8d171430ad90", "author": {"user": {"login": "gitgabrio", "name": "Gabriele Cardosi"}}, "url": "https://github.com/kiegroup/drools/commit/0167e89f68c810942ea1ee0e5e8c8d171430ad90", "committedDate": "2020-12-21T17:16:15Z", "message": "[DROOLS-5861] Fix type"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e6fbd0f08576105a77be81304426173369ba7eae", "author": {"user": {"login": "gitgabrio", "name": "Gabriele Cardosi"}}, "url": "https://github.com/kiegroup/drools/commit/e6fbd0f08576105a77be81304426173369ba7eae", "committedDate": "2020-12-22T07:29:31Z", "message": "Merge remote-tracking branch 'origin/master' into DROOLS-5861"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f20134baca33d8013feeefb5c135e5fb3779a8fe", "author": {"user": {"login": "gitgabrio", "name": "Gabriele Cardosi"}}, "url": "https://github.com/kiegroup/drools/commit/f20134baca33d8013feeefb5c135e5fb3779a8fe", "committedDate": "2021-01-07T10:20:53Z", "message": "Merge remote-tracking branch 'origin/master' into DROOLS-5861"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "d798280834e18f64bcfef4d2fc1474ab2826d493", "author": {"user": {"login": "gitgabrio", "name": "Gabriele Cardosi"}}, "url": "https://github.com/kiegroup/drools/commit/d798280834e18f64bcfef4d2fc1474ab2826d493", "committedDate": "2021-01-11T11:37:10Z", "message": "[DROOLS-5940] Fix Project Model code generation - created tests"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b1ec187ecc25a67c5d7620fdecf676342d48762d", "author": {"user": {"login": "gitgabrio", "name": "Gabriele Cardosi"}}, "url": "https://github.com/kiegroup/drools/commit/b1ec187ecc25a67c5d7620fdecf676342d48762d", "committedDate": "2021-01-11T11:45:17Z", "message": "[DROOLS-5861] WIP (TODO: remove mvel dependency from kie-pmml-models-drools-common)"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "0e3dbafe7acec8181dbc4555ea789193f3ffdcb5", "author": {"user": {"login": "gitgabrio", "name": "Gabriele Cardosi"}}, "url": "https://github.com/kiegroup/drools/commit/0e3dbafe7acec8181dbc4555ea789193f3ffdcb5", "committedDate": "2021-01-11T11:45:39Z", "message": "Merge remote-tracking branch 'origin/master' into DROOLS-5861"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b363127be0cc38bb921cc3d4deaab5584be15d7d", "author": {"user": {"login": "gitgabrio", "name": "Gabriele Cardosi"}}, "url": "https://github.com/kiegroup/drools/commit/b363127be0cc38bb921cc3d4deaab5584be15d7d", "committedDate": "2021-01-11T11:46:24Z", "message": "Merge remote-tracking branch 'gitgabrio/DROOLS-5940' into DROOLS-5861"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "543ae6242a5ba474354c9470fdbd9c81a537d353", "author": {"user": {"login": "gitgabrio", "name": "Gabriele Cardosi"}}, "url": "https://github.com/kiegroup/drools/commit/543ae6242a5ba474354c9470fdbd9c81a537d353", "committedDate": "2021-01-11T15:06:29Z", "message": "Merge remote-tracking branch 'origin/master' into DROOLS-5861"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a1e031caf18a81ce24d541dd2a2df179c607f5a1", "author": {"user": {"login": "gitgabrio", "name": "Gabriele Cardosi"}}, "url": "https://github.com/kiegroup/drools/commit/a1e031caf18a81ce24d541dd2a2df179c607f5a1", "committedDate": "2021-01-12T15:23:09Z", "message": "[DROOLS-5861] Populating nested models (Mining): to verify"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a134b22576914941c49874b335c376b20833f5f3", "author": {"user": {"login": "gitgabrio", "name": "Gabriele Cardosi"}}, "url": "https://github.com/kiegroup/drools/commit/a134b22576914941c49874b335c376b20833f5f3", "committedDate": "2021-01-13T09:46:06Z", "message": "Merge remote-tracking branch 'origin/master' into DROOLS-5861"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "9630c090db4dd3767942e5b21fb73563f6c21507", "author": {"user": {"login": "gitgabrio", "name": "Gabriele Cardosi"}}, "url": "https://github.com/kiegroup/drools/commit/9630c090db4dd3767942e5b21fb73563f6c21507", "committedDate": "2021-01-13T11:59:48Z", "message": "[DROOLS-5861] Populating kiebase with nested models."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a6c6fd914a5f8e4af45b257b07ad9145d4e12e57", "author": {"user": {"login": "gitgabrio", "name": "Gabriele Cardosi"}}, "url": "https://github.com/kiegroup/drools/commit/a6c6fd914a5f8e4af45b257b07ad9145d4e12e57", "committedDate": "2021-01-14T08:52:09Z", "message": "Merge remote-tracking branch 'origin/master' into DROOLS-5861"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c7905d81f60e85016bde3acd3cf136b79b913476", "author": {"user": {"login": "gitgabrio", "name": "Gabriele Cardosi"}}, "url": "https://github.com/kiegroup/drools/commit/c7905d81f60e85016bde3acd3cf136b79b913476", "committedDate": "2021-01-15T08:23:05Z", "message": "Merge remote-tracking branch 'origin/master' into DROOLS-5861"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTY5MTI0Njg5", "url": "https://github.com/kiegroup/drools/pull/3296#pullrequestreview-569124689", "createdAt": "2021-01-15T10:07:58Z", "commit": {"oid": "9630c090db4dd3767942e5b21fb73563f6c21507"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wMS0xNVQxMDowNzo1OVrOIUUupw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wMS0xNVQxMDoxNTo0NVrOIUVYmA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1ODE4MjA1NQ==", "bodyText": "Is this comment necessary?", "url": "https://github.com/kiegroup/drools/pull/3296#discussion_r558182055", "createdAt": "2021-01-15T10:07:59Z", "author": {"login": "jiripetrlik"}, "path": "kie-pmml-trusty/kie-pmml-compiler/kie-pmml-compiler-commons/pom.xml", "diffHunk": "@@ -20,6 +20,7 @@\n       <groupId>org.kie</groupId>\n       <artifactId>kie-pmml-compiler-api</artifactId>\n     </dependency>\n+    <!-- DROOLS -->", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "9630c090db4dd3767942e5b21fb73563f6c21507"}, "originalPosition": 4}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1ODE4OTM1Ng==", "bodyText": "Please remove commented code.", "url": "https://github.com/kiegroup/drools/pull/3296#discussion_r558189356", "createdAt": "2021-01-15T10:13:07Z", "author": {"login": "jiripetrlik"}, "path": "kie-pmml-trusty/kie-pmml-evaluator/kie-pmml-evaluator-assembler/src/main/java/org/kie/pmml/evaluator/assembler/factories/PMMLRuntimeFactoryInternal.java", "diffHunk": "@@ -47,8 +49,10 @@ private PMMLRuntimeFactoryInternal() {\n     }\n \n     public static PMMLRuntime getPMMLRuntime(final File pmmlFile) {\n-        KnowledgeBuilderImpl kbuilderImpl = (KnowledgeBuilderImpl) KnowledgeBuilderFactory.newKnowledgeBuilder();\n-        return getPMMLRuntime(pmmlFile, kbuilderImpl);\n+        KieBase kieBase = createKieBase(pmmlFile);\n+        return getPMMLRuntime(kieBase);\n+//        KnowledgeBuilderImpl kbuilderImpl = (KnowledgeBuilderImpl) KnowledgeBuilderFactory.newKnowledgeBuilder();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "9630c090db4dd3767942e5b21fb73563f6c21507"}, "originalPosition": 24}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1ODE5Mjc5Mg==", "bodyText": "It seems a little bit suspicious that there is no assert in this test.", "url": "https://github.com/kiegroup/drools/pull/3296#discussion_r558192792", "createdAt": "2021-01-15T10:15:45Z", "author": {"login": "jiripetrlik"}, "path": "kie-pmml-trusty/kie-pmml-evaluator/kie-pmml-evaluator-assembler/src/test/java/org/kie/pmml/evaluator/assembler/implementations/HasKnowledgeBuilderImplTest.java", "diffHunk": "@@ -0,0 +1,70 @@\n+/*\n+ * Copyright 2020 Red Hat, Inc. and/or its affiliates.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package org.kie.pmml.evaluator.assembler.implementations;\n+\n+import java.util.HashMap;\n+import java.util.Map;\n+import java.util.function.IntConsumer;\n+import java.util.stream.IntStream;\n+\n+import org.drools.compiler.builder.impl.KnowledgeBuilderImpl;\n+import org.drools.reflective.classloader.ProjectClassLoader;\n+import org.junit.Before;\n+import org.junit.BeforeClass;\n+import org.junit.Test;\n+import org.kie.pmml.api.exceptions.KiePMMLException;\n+\n+import static org.junit.Assert.*;\n+\n+public class HasKnowledgeBuilderImplTest {\n+\n+    private static final String CLASS_SOURCE_NAME = \"ClassSource\";\n+    private static final String CLASS_SOURCE = String.format(\"public class %s {}\" , CLASS_SOURCE_NAME);\n+    private KnowledgeBuilderImpl knowledgeBuilder;\n+    private HasKnowledgeBuilderImpl hasKnowledgeBuilder;\n+\n+    @Before\n+    public void setup() {\n+        knowledgeBuilder = new KnowledgeBuilderImpl();\n+        hasKnowledgeBuilder = new HasKnowledgeBuilderImpl(knowledgeBuilder);\n+    }\n+\n+    @Test\n+    public void getClassLoader() {\n+        ClassLoader retrieved = hasKnowledgeBuilder.getClassLoader();\n+        assertNotNull(retrieved);\n+        assertEquals(knowledgeBuilder.getRootClassLoader(),retrieved);\n+        assertTrue(retrieved instanceof ProjectClassLoader);\n+    }\n+\n+    @Test\n+    public void compileAndLoadClass() {\n+        Map<String, String> sourcesMap = new HashMap<>();\n+        sourcesMap.put(CLASS_SOURCE_NAME, CLASS_SOURCE);\n+        Class<?> retrieved = hasKnowledgeBuilder.compileAndLoadClass(sourcesMap, CLASS_SOURCE_NAME);\n+        assertNotNull(retrieved);\n+        assertEquals(CLASS_SOURCE_NAME, retrieved.getName());\n+    }\n+\n+    @Test\n+    public void compileAndLoadClassMultipleTimes() {\n+        Map<String, String> sourcesMap = new HashMap<>();\n+        sourcesMap.put(CLASS_SOURCE_NAME, CLASS_SOURCE);\n+        IntStream.range(0,3).forEach(value -> hasKnowledgeBuilder.compileAndLoadClass(sourcesMap, CLASS_SOURCE_NAME));", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "9630c090db4dd3767942e5b21fb73563f6c21507"}, "originalPosition": 67}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "703d80a4d10e1c5c394cf9eace8374344d4ff936", "author": {"user": {"login": "gitgabrio", "name": "Gabriele Cardosi"}}, "url": "https://github.com/kiegroup/drools/commit/703d80a4d10e1c5c394cf9eace8374344d4ff936", "committedDate": "2021-01-18T07:55:00Z", "message": "Merge remote-tracking branch 'origin/master' into DROOLS-5861"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b610b7abac4d19421dbeaccfcac0ed1801510319", "author": {"user": {"login": "gitgabrio", "name": "Gabriele Cardosi"}}, "url": "https://github.com/kiegroup/drools/commit/b610b7abac4d19421dbeaccfcac0ed1801510319", "committedDate": "2021-01-19T09:39:08Z", "message": "[DROOLS-5861] Fixing DMNKiePMMLTrustyInvocationEvaluator to re-use already compiled kiebases, if present"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c9345e40bb9a34efdc739632393f25a6b0eb6674", "author": {"user": {"login": "gitgabrio", "name": "Gabriele Cardosi"}}, "url": "https://github.com/kiegroup/drools/commit/c9345e40bb9a34efdc739632393f25a6b0eb6674", "committedDate": "2021-01-19T09:39:56Z", "message": "Merge remote-tracking branch 'origin/master' into DROOLS-5861"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "3e76ad7e230c65ea50ea76b2a182bfdbb6e7b197", "author": {"user": {"login": "gitgabrio", "name": "Gabriele Cardosi"}}, "url": "https://github.com/kiegroup/drools/commit/3e76ad7e230c65ea50ea76b2a182bfdbb6e7b197", "committedDate": "2021-01-19T12:27:07Z", "message": "[DROOLS-5861] Fixing declaration/usage of List<KiePMMLOutputField> kiePMMLOutputFields inside KiePMMLModel"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "8d60d0501724d98677a800d8fcb0bb6af94963da", "author": {"user": {"login": "gitgabrio", "name": "Gabriele Cardosi"}}, "url": "https://github.com/kiegroup/drools/commit/8d60d0501724d98677a800d8fcb0bb6af94963da", "committedDate": "2021-01-20T08:53:33Z", "message": "[DROOLS-5861] Propagating packagename for runtime compilation"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "35c4ba0b19efd9365a0d949a9c4cb75a864e2169", "author": {"user": {"login": "gitgabrio", "name": "Gabriele Cardosi"}}, "url": "https://github.com/kiegroup/drools/commit/35c4ba0b19efd9365a0d949a9c4cb75a864e2169", "committedDate": "2021-01-20T08:54:06Z", "message": "Merge remote-tracking branch 'origin/master' into DROOLS-5861"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "2b105d9195446bb7dbe3462421cc7c49a8bd8039", "author": {"user": {"login": "gitgabrio", "name": "Gabriele Cardosi"}}, "url": "https://github.com/kiegroup/drools/commit/2b105d9195446bb7dbe3462421cc7c49a8bd8039", "committedDate": "2021-01-21T07:45:56Z", "message": "[DROOLS-5861] Fix MVELConstraint equals"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "87be832aea58f682c851ef3f06bdeecb96c46565", "author": {"user": {"login": "gitgabrio", "name": "Gabriele Cardosi"}}, "url": "https://github.com/kiegroup/drools/commit/87be832aea58f682c851ef3f06bdeecb96c46565", "committedDate": "2021-01-21T07:46:29Z", "message": "Merge remote-tracking branch 'origin/master' into DROOLS-5861"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a0f5f78f146e700e47a6d031755599f8bcace77e", "author": {"user": {"login": "gitgabrio", "name": "Gabriele Cardosi"}}, "url": "https://github.com/kiegroup/drools/commit/a0f5f78f146e700e47a6d031755599f8bcace77e", "committedDate": "2021-01-21T11:47:20Z", "message": "[DROOLS-5861] Replacing HashSet with LinkedHashSet to have ordered set"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "889d2f27f89bcabbf42d78b8bae34e463a891230", "author": {"user": {"login": "gitgabrio", "name": "Gabriele Cardosi"}}, "url": "https://github.com/kiegroup/drools/commit/889d2f27f89bcabbf42d78b8bae34e463a891230", "committedDate": "2021-01-22T08:38:22Z", "message": "[DROOLS-5861] Fixing bug indication by SONAR"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "cd79d9ad5a6c19ca3074819eae59b7a3e68c61b8", "author": {"user": {"login": "gitgabrio", "name": "Gabriele Cardosi"}}, "url": "https://github.com/kiegroup/drools/commit/cd79d9ad5a6c19ca3074819eae59b7a3e68c61b8", "committedDate": "2021-01-22T08:45:30Z", "message": "[DROOLS-5861] Removed import"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "0e995456c8dd8dadf3b4a0aa77f221aea7999116", "author": {"user": {"login": "gitgabrio", "name": "Gabriele Cardosi"}}, "url": "https://github.com/kiegroup/drools/commit/0e995456c8dd8dadf3b4a0aa77f221aea7999116", "committedDate": "2021-01-22T08:45:51Z", "message": "Merge remote-tracking branch 'origin/master' into DROOLS-5861"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "4b6bd7a9978a1e2c11d0c58fc4c2731846623f5a", "author": {"user": {"login": "gitgabrio", "name": "Gabriele Cardosi"}}, "url": "https://github.com/kiegroup/drools/commit/4b6bd7a9978a1e2c11d0c58fc4c2731846623f5a", "committedDate": "2021-01-22T08:50:05Z", "message": "[DROOLS-5861] Fixing logger complaint"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "6354221f670c1ca021b68a6131908e8f0dba543d", "author": {"user": {"login": "gitgabrio", "name": "Gabriele Cardosi"}}, "url": "https://github.com/kiegroup/drools/commit/6354221f670c1ca021b68a6131908e8f0dba543d", "committedDate": "2021-01-22T09:00:57Z", "message": "[DROOLS-5861] Fixing SONAR warnings"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "4d320432415f165427f5a2ad06665ca6539ab993", "author": {"user": {"login": "gitgabrio", "name": "Gabriele Cardosi"}}, "url": "https://github.com/kiegroup/drools/commit/4d320432415f165427f5a2ad06665ca6539ab993", "committedDate": "2021-01-22T09:53:50Z", "message": "[DROOLS-5861] Add tests"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTc0MjA2MzMw", "url": "https://github.com/kiegroup/drools/pull/3296#pullrequestreview-574206330", "createdAt": "2021-01-22T12:14:46Z", "commit": {"oid": "4d320432415f165427f5a2ad06665ca6539ab993"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1702, "cost": 1, "resetAt": "2021-11-01T15:33:45Z"}}}