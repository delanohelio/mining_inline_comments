{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTI2NTYyNTM5", "number": 3263, "title": "DROOLS-5848 : CallMethod with ActionFieldFunctions does not compile", "bodyText": "Thank you for submitting this pull request\nJIRA:\nlink\n\n\nHow to retest this PR or trigger a specific build:\n\n\n\na pull request please add comment: Jenkins retest this\n\n\na full downstream build please add comment: Jenkins run fdb\n\n\na compile downstream build please  add comment: Jenkins run cdb\n\n\na full production downstream build please add comment: Jenkins execute product fdb\n\n\nan upstream build please add comment: Jenkins run upstream", "createdAt": "2020-11-24T15:23:35Z", "url": "https://github.com/kiegroup/drools/pull/3263", "merged": true, "mergeCommit": {"oid": "00c9b28010aced286f5b1db3fbec77f148310806"}, "closed": true, "closedAt": "2021-01-21T10:19:14Z", "author": {"login": "Rikkola"}, "timelineItems": {"totalCount": 7, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdiSTVOAFqTU0MzA5MTUwOA==", "endCursor": "Y3Vyc29yOnYyOpPPAAABdjydoOAH2gAyNTI2NTYyNTM5OjdiZDg2MmE5MDZlY2Q2YmFjYjE4MjI0OTcxYzBjNTY2OWRjNzE1MzU=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTQzMDkxNTA4", "url": "https://github.com/kiegroup/drools/pull/3263#pullrequestreview-543091508", "createdAt": "2020-12-02T17:50:04Z", "commit": {"oid": "59eee42bdef14a1177d5e1eaf03896703ba0e495"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTQzMDY3MDYy", "url": "https://github.com/kiegroup/drools/pull/3263#pullrequestreview-543067062", "createdAt": "2020-12-02T17:22:14Z", "commit": {"oid": "59eee42bdef14a1177d5e1eaf03896703ba0e495"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0wMlQxNzoyMjoxNFrOH9l2xg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0wMlQxNzoyMjoxNFrOH9l2xg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNDM0NTQxNA==", "bodyText": "Shouldn't we use DataType.TYPE_VOID? Or isn't this the return type of the method add ?", "url": "https://github.com/kiegroup/drools/pull/3263#discussion_r534345414", "createdAt": "2020-12-02T17:22:14Z", "author": {"login": "jomarko"}, "path": "drools-workbench-models/drools-workbench-models-guided-dtable/src/test/java/org/drools/workbench/models/guided/dtable/backend/BRLRuleModelTest.java", "diffHunk": "@@ -1227,6 +1228,52 @@ public void testActionCallIsNotIgnored() {\n                                      drl);\n     }\n \n+    @Test\n+    public void testActionCallMethodWithActionFieldFunction() {\n+        final GuidedDecisionTable52 dt = new GuidedDecisionTable52();\n+\n+        final Pattern52 p1 = new Pattern52();\n+        p1.setBoundName(\"x\");\n+        p1.setFactType(\"Context\");\n+\n+        final ConditionCol52 c = new ConditionCol52();\n+        c.setConstraintValueType(BaseSingleFieldConstraint.TYPE_LITERAL);\n+        p1.getChildColumns().add(c);\n+        dt.getConditions().add(p1);\n+\n+        final BRLActionColumn brlAction1 = new BRLActionColumn();\n+        final ActionCallMethod actionCallMethod = new ActionCallMethod(\"x\");\n+        actionCallMethod.setState(ActionCallMethod.TYPE_DEFINED);\n+        actionCallMethod.setMethodName(\"add\");\n+        actionCallMethod.addFieldValue(new ActionFieldFunction(\"name\",\n+                                                               \"Toni\",\n+                                                               DataType.TYPE_STRING));\n+\n+        brlAction1.getDefinition().add(actionCallMethod);\n+        brlAction1.getChildColumns().add(new BRLActionVariableColumn(\"\",\n+                                                                     DataType.TYPE_BOOLEAN,", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "59eee42bdef14a1177d5e1eaf03896703ba0e495"}, "originalPosition": 35}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "049ede75d7a2f05fb99d146f2795e8b246f23a55", "author": {"user": {"login": "Rikkola", "name": "Toni Rikkola"}}, "url": "https://github.com/kiegroup/drools/commit/049ede75d7a2f05fb99d146f2795e8b246f23a55", "committedDate": "2020-12-04T09:06:03Z", "message": "DROOLS-5848 : CallMethod with ActionFieldFunctions does not compile"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "59eee42bdef14a1177d5e1eaf03896703ba0e495", "author": {"user": {"login": "Rikkola", "name": "Toni Rikkola"}}, "url": "https://github.com/kiegroup/drools/commit/59eee42bdef14a1177d5e1eaf03896703ba0e495", "committedDate": "2020-11-24T15:22:32Z", "message": "DROOLS-5848 : CallMethod with ActionFieldFunctions does not compile"}, "afterCommit": {"oid": "049ede75d7a2f05fb99d146f2795e8b246f23a55", "author": {"user": {"login": "Rikkola", "name": "Toni Rikkola"}}, "url": "https://github.com/kiegroup/drools/commit/049ede75d7a2f05fb99d146f2795e8b246f23a55", "committedDate": "2020-12-04T09:06:03Z", "message": "DROOLS-5848 : CallMethod with ActionFieldFunctions does not compile"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTQ0Nzc0MDkw", "url": "https://github.com/kiegroup/drools/pull/3263#pullrequestreview-544774090", "createdAt": "2020-12-04T09:09:27Z", "commit": {"oid": "049ede75d7a2f05fb99d146f2795e8b246f23a55"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0wNFQwOTowOToyN1rOH_Hf-g==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0wNFQwOTowOToyN1rOH_Hf-g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNTk0NTIxMA==", "bodyText": "@jomarko The problem with the old fix was that this line was never added to the DRL.\nThe problem appears when there is ActionCallMethod in a BRL before Set or Update column that is not BRL. The two columns use the same fact variable, so when searching by name the ActionCallMethod is found and we try to append the set/update to that. We should just ignore the call.", "url": "https://github.com/kiegroup/drools/pull/3263#discussion_r535945210", "createdAt": "2020-12-04T09:09:27Z", "author": {"login": "Rikkola"}, "path": "drools-workbench-models/drools-workbench-models-guided-dtable/src/test/java/org/drools/workbench/models/guided/dtable/backend/BRLRuleModelTest.java", "diffHunk": "@@ -1227,6 +1228,58 @@ public void testActionCallIsNotIgnored() {\n                                      drl);\n     }\n \n+    @Test\n+    public void testActionCallMethodWithActionFieldFunction() {\n+        final GuidedDecisionTable52 dt = new GuidedDecisionTable52();\n+\n+        final Pattern52 p1 = new Pattern52();\n+        p1.setBoundName(\"x\");\n+        p1.setFactType(\"Context\");\n+\n+        final ConditionCol52 c = new ConditionCol52();\n+        c.setConstraintValueType(BaseSingleFieldConstraint.TYPE_LITERAL);\n+        p1.getChildColumns().add(c);\n+        dt.getConditions().add(p1);\n+\n+        final BRLActionColumn brlAction1 = new BRLActionColumn();\n+        final ActionCallMethod actionCallMethod = new ActionCallMethod(\"x\");\n+        actionCallMethod.setState(ActionCallMethod.TYPE_DEFINED);\n+        actionCallMethod.setMethodName(\"add\");\n+        actionCallMethod.addFieldValue(new ActionFieldFunction(\"name\",\n+                                                               \"Toni\",\n+                                                               DataType.TYPE_STRING));\n+\n+        brlAction1.getDefinition().add(actionCallMethod);\n+        brlAction1.getChildColumns().add(new BRLActionVariableColumn(\"\",\n+                                                                     DataType.TYPE_BOOLEAN,\n+                                                                     null,\n+                                                                     null));\n+        dt.getActionCols().add(brlAction1);\n+        ActionSetFieldCol52 set = new ActionSetFieldCol52();\n+        set.setBoundName(\"x\");\n+        set.setFactField(\"name\");\n+\n+        dt.getActionCols().add(set);\n+\n+        dt.setData(DataUtilities.makeDataLists(new Object[][]{\n+                new Object[]{\"1\", \"\", \"desc\", \"x\", true, \"ToniR\"}\n+        }));\n+        final String drl = GuidedDTDRLPersistence.getInstance().marshal(dt);\n+        final String expected = \"//from row number: 1\\n\" +\n+                \"//desc\\n\" +\n+                \"rule \\\"Row 1 null\\\"\\n\" +\n+                \"dialect \\\"mvel\\\"\\n\" +\n+                \"when\\n\" +\n+                \"  x : Context( )\\n\" +\n+                \"then\\n\" +\n+                \"  x.add( \\\"Toni\\\" );\\n\" +\n+                \"  x.setName( \\\"ToniR\\\" );\\n\" +", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "049ede75d7a2f05fb99d146f2795e8b246f23a55"}, "originalPosition": 57}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTQ1OTI0Nzk5", "url": "https://github.com/kiegroup/drools/pull/3263#pullrequestreview-545924799", "createdAt": "2020-12-07T08:34:46Z", "commit": {"oid": "049ede75d7a2f05fb99d146f2795e8b246f23a55"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "7bd862a906ecd6bacb18224971c0c5669dc71535", "author": {"user": {"login": "jomarko", "name": "Jozef Marko"}}, "url": "https://github.com/kiegroup/drools/commit/7bd862a906ecd6bacb18224971c0c5669dc71535", "committedDate": "2020-12-07T09:52:12Z", "message": "DROOLS-5848: Extend coverage"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1765, "cost": 1, "resetAt": "2021-11-01T15:33:45Z"}}}