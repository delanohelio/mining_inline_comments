{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDA5NDQwMTQ1", "number": 2871, "reviewThreads": {"totalCount": 6, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yN1QxMjozNjo1OFrOD2qKnw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yN1QxMjo0MTozNFrOD2qS7w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjU4NjQwNTQzOnYy", "diffSide": "RIGHT", "path": "kie-dmn/kie-dmn-core/src/main/java/org/kie/dmn/typesafe/DMNAllTypesIndex.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yN1QxMjozNjo1OFrOGMg5Bw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yN1QxMjozNjo1OFrOGMg5Bw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNTc3NDk4Mw==", "bodyText": "typo conver", "url": "https://github.com/kiegroup/drools/pull/2871#discussion_r415774983", "createdAt": "2020-04-27T12:36:58Z", "author": {"login": "lucamolteni"}, "path": "kie-dmn/kie-dmn-core/src/main/java/org/kie/dmn/typesafe/DMNAllTypesIndex.java", "diffHunk": "@@ -39,19 +47,90 @@ public DMNAllTypesIndex(DMNTypeSafePackageName.Factory packageName, DMNModel...\n         }\n     }\n \n-    public DMNAllTypesIndex(List<DMNModel> allModels, DMNTypeSafePackageName.Factory packageName) {\n-        this(packageName, allModels.toArray(new DMNModel[0]));\n-    }\n-\n     public List<DMNType> allTypesToGenerate() {\n         return indexedTypes;\n     }\n \n+    @Deprecated\n     public Optional<DMNTypeSafePackageName> namespaceOfClass(String typeName) {\n-        return Optional.ofNullable(mapNamespaceIndex.get(typeName)).map(DMNModelTypesIndex.IndexValue::getPackageName);\n+        return mapNamespaceIndex.entrySet().stream()\n+                                .filter(kv -> kv.getKey().getName().equals(typeName))\n+                                .findFirst()\n+                                .map(Entry::getValue)\n+                                .map(DMNModelTypesIndex.IndexValue::getPackageName);\n     }\n \n+    @Deprecated\n     public boolean isIndexedClass(String typeName) {\n         return namespaceOfClass(typeName).isPresent();\n     }\n+\n+    public String asJava(DMNType fieldDMNType) {\n+        String converted = converDMNTypeAsJava(fieldDMNType);\n+        return converted;\n+    }\n+\n+    public String converDMNTypeAsJava(DMNType dmnType) {\n+        if (mapNamespaceIndex.containsKey(IndexKey.from(dmnType))) {\n+            String simpleName = DMNDeclaredType.asJavaSimpleName(dmnType);\n+            return mapNamespaceIndex.get(IndexKey.from(dmnType)).getPackageName().appendPackage(simpleName);\n+        }\n+        if (DMNTypeUtils.isFEELBuiltInType(dmnType)) {\n+            return convertBuiltin(dmnType);\n+        }\n+        if (dmnType.getBaseType() == null) {\n+            throw new IllegalStateException();\n+        }\n+        String baseConverted = converDMNTypeAsJava(dmnType.getBaseType());", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "95770c222601deda482984c04f9670467f59c762"}, "originalPosition": 73}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjU4NjQwODc2OnYy", "diffSide": "RIGHT", "path": "kie-dmn/kie-dmn-core/src/main/java/org/kie/dmn/typesafe/DMNAllTypesIndex.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yN1QxMjozNzo0MVrOGMg67A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yN1QxMjozNzo0MVrOGMg67A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNTc3NTQ2OA==", "bodyText": "inline", "url": "https://github.com/kiegroup/drools/pull/2871#discussion_r415775468", "createdAt": "2020-04-27T12:37:41Z", "author": {"login": "lucamolteni"}, "path": "kie-dmn/kie-dmn-core/src/main/java/org/kie/dmn/typesafe/DMNAllTypesIndex.java", "diffHunk": "@@ -39,19 +47,90 @@ public DMNAllTypesIndex(DMNTypeSafePackageName.Factory packageName, DMNModel...\n         }\n     }\n \n-    public DMNAllTypesIndex(List<DMNModel> allModels, DMNTypeSafePackageName.Factory packageName) {\n-        this(packageName, allModels.toArray(new DMNModel[0]));\n-    }\n-\n     public List<DMNType> allTypesToGenerate() {\n         return indexedTypes;\n     }\n \n+    @Deprecated\n     public Optional<DMNTypeSafePackageName> namespaceOfClass(String typeName) {\n-        return Optional.ofNullable(mapNamespaceIndex.get(typeName)).map(DMNModelTypesIndex.IndexValue::getPackageName);\n+        return mapNamespaceIndex.entrySet().stream()\n+                                .filter(kv -> kv.getKey().getName().equals(typeName))\n+                                .findFirst()\n+                                .map(Entry::getValue)\n+                                .map(DMNModelTypesIndex.IndexValue::getPackageName);\n     }\n \n+    @Deprecated\n     public boolean isIndexedClass(String typeName) {\n         return namespaceOfClass(typeName).isPresent();\n     }\n+\n+    public String asJava(DMNType fieldDMNType) {\n+        String converted = converDMNTypeAsJava(fieldDMNType);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "95770c222601deda482984c04f9670467f59c762"}, "originalPosition": 58}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjU4NjQxMjY3OnYy", "diffSide": "RIGHT", "path": "kie-dmn/kie-dmn-core/src/main/java/org/kie/dmn/typesafe/DMNAllTypesIndex.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yN1QxMjozODozNFrOGMg9Ug==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yN1QxMjozODozNFrOGMg9Ug==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNTc3NjA4Mg==", "bodyText": ".containsKey + get is a double lookup, can this be done wth one statement?", "url": "https://github.com/kiegroup/drools/pull/2871#discussion_r415776082", "createdAt": "2020-04-27T12:38:34Z", "author": {"login": "lucamolteni"}, "path": "kie-dmn/kie-dmn-core/src/main/java/org/kie/dmn/typesafe/DMNAllTypesIndex.java", "diffHunk": "@@ -39,19 +47,90 @@ public DMNAllTypesIndex(DMNTypeSafePackageName.Factory packageName, DMNModel...\n         }\n     }\n \n-    public DMNAllTypesIndex(List<DMNModel> allModels, DMNTypeSafePackageName.Factory packageName) {\n-        this(packageName, allModels.toArray(new DMNModel[0]));\n-    }\n-\n     public List<DMNType> allTypesToGenerate() {\n         return indexedTypes;\n     }\n \n+    @Deprecated\n     public Optional<DMNTypeSafePackageName> namespaceOfClass(String typeName) {\n-        return Optional.ofNullable(mapNamespaceIndex.get(typeName)).map(DMNModelTypesIndex.IndexValue::getPackageName);\n+        return mapNamespaceIndex.entrySet().stream()\n+                                .filter(kv -> kv.getKey().getName().equals(typeName))\n+                                .findFirst()\n+                                .map(Entry::getValue)\n+                                .map(DMNModelTypesIndex.IndexValue::getPackageName);\n     }\n \n+    @Deprecated\n     public boolean isIndexedClass(String typeName) {\n         return namespaceOfClass(typeName).isPresent();\n     }\n+\n+    public String asJava(DMNType fieldDMNType) {\n+        String converted = converDMNTypeAsJava(fieldDMNType);\n+        return converted;\n+    }\n+\n+    public String converDMNTypeAsJava(DMNType dmnType) {\n+        if (mapNamespaceIndex.containsKey(IndexKey.from(dmnType))) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "95770c222601deda482984c04f9670467f59c762"}, "originalPosition": 63}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjU4NjQxNzczOnYy", "diffSide": "RIGHT", "path": "kie-dmn/kie-dmn-core/src/main/java/org/kie/dmn/typesafe/DMNDeclaredField.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yN1QxMjozOTozOVrOGMhAIA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yN1QxMjozOTozOVrOGMhAIA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNTc3NjgwMA==", "bodyText": "here we rather\n\ninline the whole statement\nsplit into significant different statements (index.asJava and fieldDMNType.getBaseType)", "url": "https://github.com/kiegroup/drools/pull/2871#discussion_r415776800", "createdAt": "2020-04-27T12:39:39Z", "author": {"login": "lucamolteni"}, "path": "kie-dmn/kie-dmn-core/src/main/java/org/kie/dmn/typesafe/DMNDeclaredField.java", "diffHunk": "@@ -66,89 +60,16 @@ public String getOriginalMapKey() {\n \n     @Override\n     public String getObjectType() {\n-        if (fieldDMNType.isCollection()) {\n-            String typeName = getBaseType(fieldDMNType);\n-            String typeNameWithPackage = withPackage(typeName);\n-            String convertedType = convertType(typeNameWithPackage);\n-            return String.format(\"java.util.Collection<%s>\", convertedType);\n-        } else {\n-            return fieldTypeWithPackage();\n-        }\n-    }\n-\n-    private String fieldTypeWithPackage() {\n-        String fieldNameWithAnyCheck = getRecursiveBaseType(fieldDMNType)\n-                .map(this::getFieldNameWithAnyCheck)\n-                .orElse(Object.class.getCanonicalName());\n-        String withPackage = withPackage(fieldNameWithAnyCheck);\n-        return convertType(withPackage);\n-    }\n-\n-    private String getFieldNameWithAnyCheck(DMNType fieldDMNType) {\n-        String name = fieldDMNType.getName();\n-        if (\"Any\".equals(name)) {\n-            return OBJECT_TYPE;\n-        } else {\n-            return CodegenStringUtil.escapeIdentifier(name);\n-        }\n+        return index.asJava(fieldDMNType);\n     }\n \n     // This returns the generic type i.e. when Collection<String> then String\n     private String fieldTypeUnwrapped() {\n         if (fieldDMNType.isCollection()) {\n-            String typeName = getBaseType(fieldDMNType);\n-            return withPackage(typeName);\n+            String typeName = index.asJava(fieldDMNType.getBaseType());", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "95770c222601deda482984c04f9670467f59c762"}, "originalPosition": 53}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjU4NjQyMTI5OnYy", "diffSide": "RIGHT", "path": "kie-dmn/kie-dmn-core/src/main/java/org/kie/dmn/typesafe/DMNDeclaredField.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yN1QxMjo0MDoyOVrOGMhCIA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yN1QxMzo1MToxOFrOGMkQdg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNTc3NzMxMg==", "bodyText": "rename to isNotObjectType", "url": "https://github.com/kiegroup/drools/pull/2871#discussion_r415777312", "createdAt": "2020-04-27T12:40:29Z", "author": {"login": "lucamolteni"}, "path": "kie-dmn/kie-dmn-core/src/main/java/org/kie/dmn/typesafe/DMNDeclaredField.java", "diffHunk": "@@ -204,7 +127,11 @@ private boolean fieldIsBasic() {\n     }\n \n     private boolean fieldIsDifferentThanObject() {\n-        return !fieldTypeUnwrapped().equals(OBJECT_TYPE);\n+        if (DMNTypeUtils.isFEELAny(fieldDMNType)) {\n+            return false;\n+        }\n+        boolean isOtherObject = fieldDMNType.isCollection() ? fieldTypeUnwrapped().equals(OBJECT_TYPE) : getObjectType().equals(OBJECT_TYPE);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "95770c222601deda482984c04f9670467f59c762"}, "originalPosition": 132}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNTgzMDEzNA==", "bodyText": "? this statement represent if it IS an OBJECT_TYPE.\nline 134 returns the negated.", "url": "https://github.com/kiegroup/drools/pull/2871#discussion_r415830134", "createdAt": "2020-04-27T13:51:18Z", "author": {"login": "tarilabs"}, "path": "kie-dmn/kie-dmn-core/src/main/java/org/kie/dmn/typesafe/DMNDeclaredField.java", "diffHunk": "@@ -204,7 +127,11 @@ private boolean fieldIsBasic() {\n     }\n \n     private boolean fieldIsDifferentThanObject() {\n-        return !fieldTypeUnwrapped().equals(OBJECT_TYPE);\n+        if (DMNTypeUtils.isFEELAny(fieldDMNType)) {\n+            return false;\n+        }\n+        boolean isOtherObject = fieldDMNType.isCollection() ? fieldTypeUnwrapped().equals(OBJECT_TYPE) : getObjectType().equals(OBJECT_TYPE);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNTc3NzMxMg=="}, "originalCommit": {"oid": "95770c222601deda482984c04f9670467f59c762"}, "originalPosition": 132}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjU4NjQyNjcxOnYy", "diffSide": "RIGHT", "path": "kie-dmn/kie-dmn-core/src/main/java/org/kie/dmn/typesafe/DMNTypeUtils.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yN1QxMjo0MTozNFrOGMhFCg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yN1QxMzo0NzoxOFrOGMkEDw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNTc3ODA1OA==", "bodyText": "extract dmnType.getNamespace()", "url": "https://github.com/kiegroup/drools/pull/2871#discussion_r415778058", "createdAt": "2020-04-27T12:41:34Z", "author": {"login": "lucamolteni"}, "path": "kie-dmn/kie-dmn-core/src/main/java/org/kie/dmn/typesafe/DMNTypeUtils.java", "diffHunk": "@@ -0,0 +1,67 @@\n+/*\n+ * Copyright 2020 Red Hat, Inc. and/or its affiliates.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package org.kie.dmn.typesafe;\n+\n+import org.kie.dmn.api.core.DMNType;\n+import org.kie.dmn.core.impl.BaseDMNTypeImpl;\n+import org.kie.dmn.feel.lang.Type;\n+import org.kie.dmn.feel.lang.types.BuiltInType;\n+\n+/**\n+ * Internal utility class\n+ */\n+public class DMNTypeUtils {\n+\n+    private DMNTypeUtils() {\n+        // only static method in this class.\n+    }\n+\n+    public static boolean isFEELBuiltInType(DMNType dmnType) {\n+        return dmnType.getNamespace().equals(org.kie.dmn.model.v1_1.KieDMNModelInstrumentedBase.URI_FEEL) ||", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "95770c222601deda482984c04f9670467f59c762"}, "originalPosition": 34}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNTgyNjk1OQ==", "bodyText": "of all the comments, this one I don't see the benefit, that is I don't see the benefit to extract a method which invokes a getter.", "url": "https://github.com/kiegroup/drools/pull/2871#discussion_r415826959", "createdAt": "2020-04-27T13:47:18Z", "author": {"login": "tarilabs"}, "path": "kie-dmn/kie-dmn-core/src/main/java/org/kie/dmn/typesafe/DMNTypeUtils.java", "diffHunk": "@@ -0,0 +1,67 @@\n+/*\n+ * Copyright 2020 Red Hat, Inc. and/or its affiliates.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package org.kie.dmn.typesafe;\n+\n+import org.kie.dmn.api.core.DMNType;\n+import org.kie.dmn.core.impl.BaseDMNTypeImpl;\n+import org.kie.dmn.feel.lang.Type;\n+import org.kie.dmn.feel.lang.types.BuiltInType;\n+\n+/**\n+ * Internal utility class\n+ */\n+public class DMNTypeUtils {\n+\n+    private DMNTypeUtils() {\n+        // only static method in this class.\n+    }\n+\n+    public static boolean isFEELBuiltInType(DMNType dmnType) {\n+        return dmnType.getNamespace().equals(org.kie.dmn.model.v1_1.KieDMNModelInstrumentedBase.URI_FEEL) ||", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNTc3ODA1OA=="}, "originalCommit": {"oid": "95770c222601deda482984c04f9670467f59c762"}, "originalPosition": 34}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2499, "cost": 1, "resetAt": "2021-11-12T20:28:25Z"}}}