{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDQ0NTgxNTE4", "number": 2977, "title": "[DROOLS-5411] Externalize lambda for CEP", "bodyText": "", "createdAt": "2020-07-06T07:03:17Z", "url": "https://github.com/kiegroup/drools/pull/2977", "merged": true, "mergeCommit": {"oid": "a8507fae382ec5d815cce03792aa18b0020a1915"}, "closed": true, "closedAt": "2020-07-10T13:18:42Z", "author": {"login": "tkobayas"}, "timelineItems": {"totalCount": 5, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcyLlSpgH2gAyNDQ0NTgxNTE4OjUyN2I2MGQzZjUwM2NjNjliODQ2MWU1MzJkNGFiZDE2MTE0ZDk3ODk=", "endCursor": "Y3Vyc29yOnYyOpPPAAABczjfY9gFqTQ0NjM5MjE5MQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "527b60d3f503cc69b8461e532d4abd16114d9789", "author": {"user": {"login": "tkobayas", "name": "Toshiya Kobayashi"}}, "url": "https://github.com/kiegroup/drools/commit/527b60d3f503cc69b8461e532d4abd16114d9789", "committedDate": "2020-07-06T06:51:59Z", "message": "[DROOLS-5411] Externalize lambda for CEP"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDQyODc2MDY4", "url": "https://github.com/kiegroup/drools/pull/2977#pullrequestreview-442876068", "createdAt": "2020-07-06T08:32:20Z", "commit": {"oid": "527b60d3f503cc69b8461e532d4abd16114d9789"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wNlQwODozMjoyMVrOGtN2wA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wNlQwODozMjoyMVrOGtN2wA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MDA2NjExMg==", "bodyText": "In case of temporal constraints, the generated code is like this:\nexpr(\"40AE484C3A9BF23BE65C0B135D4B1E33\",\n     (org.drools.modelcompiler.domain.StockTick _this) -> _this.getTimeFieldAsLong(),\n     var_$a,\n     (org.drools.modelcompiler.domain.StockTick $a) -> $a.getTimeFieldAsLong(),\n     D.after(5L, java.util.concurrent.TimeUnit.MILLISECONDS, 8L, java.util.concurrent.TimeUnit.MILLISECONDS)\n)\n\nSo I externalize lambdas one-by-one calling replaceLambda() instead of calling extractLambdaFromMethodCall().", "url": "https://github.com/kiegroup/drools/pull/2977#discussion_r450066112", "createdAt": "2020-07-06T08:32:21Z", "author": {"login": "tkobayas"}, "path": "drools-model/drools-model-compiler/src/main/java/org/drools/modelcompiler/util/lambdareplace/ExecModelLambdaPostProcessor.java", "diffHunk": "@@ -137,6 +144,31 @@ public void convertLambdas() {\n              });\n     }\n \n+    private void convertTemporalExpr(MethodCallExpr methodCallExpr) {\n+        // TemporalExpr methodCallExpr may have 2 lambdas\n+        methodCallExpr.getArguments().forEach(a -> {\n+            if (a.isLambdaExpr()) {\n+                LambdaExpr lambdaExpr = a.asLambdaExpr();\n+                Optional<MaterializedLambdaExtractor> extractorOpt = createMaterializedLambdaExtractor(lambdaExpr);\n+                if (!extractorOpt.isPresent()) {\n+                    logger.debug(\"Unable to create MaterializedLambdaExtractor for {}\", lambdaExpr);\n+                } else {\n+                    MaterializedLambdaExtractor extractor = extractorOpt.get();\n+                    replaceLambda(lambdaExpr, () -> extractor);\n+                }\n+            }\n+        });\n+    }\n+", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "527b60d3f503cc69b8461e532d4abd16114d9789"}, "originalPosition": 42}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b73cec173db855197fa45dddae8d44bdbeccba72", "author": {"user": {"login": "tkobayas", "name": "Toshiya Kobayashi"}}, "url": "https://github.com/kiegroup/drools/commit/b73cec173db855197fa45dddae8d44bdbeccba72", "committedDate": "2020-07-06T10:07:04Z", "message": "- add test case"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDQzNjQ3MjAw", "url": "https://github.com/kiegroup/drools/pull/2977#pullrequestreview-443647200", "createdAt": "2020-07-07T07:53:53Z", "commit": {"oid": "b73cec173db855197fa45dddae8d44bdbeccba72"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDQ2MzkyMTkx", "url": "https://github.com/kiegroup/drools/pull/2977#pullrequestreview-446392191", "createdAt": "2020-07-10T13:17:11Z", "commit": {"oid": "b73cec173db855197fa45dddae8d44bdbeccba72"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1849, "cost": 1, "resetAt": "2021-11-01T15:33:45Z"}}}