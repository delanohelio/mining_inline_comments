{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0MzcxMjU5NzQy", "number": 2747, "title": "DROOLS-4942 DMN DT Analysis hit policy recommender", "bodyText": "@etirelli @baldimir @jiripetrlik @hellowdan", "createdAt": "2020-02-05T09:12:11Z", "url": "https://github.com/kiegroup/drools/pull/2747", "merged": true, "mergeCommit": {"oid": "28cb7e0b9494758b02a203b19e8492f6882254d9"}, "closed": true, "closedAt": "2020-02-07T08:24:29Z", "author": {"login": "tarilabs"}, "timelineItems": {"totalCount": 5, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcBBIhOgH2gAyMzcxMjU5NzQyOjRiNmY1OGFjYmM3MGMyYTZjMjE2YTczYjQ3YTM5ZWEzZDdiZGMzYzM=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcB7NDoAFqTM1NDk5ODU1Ng==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "4b6f58acbc70c2a6c216a73b47a39ea3d7bdc3c3", "author": {"user": {"login": "tarilabs", "name": "Matteo Mortari"}}, "url": "https://github.com/kiegroup/drools/commit/4b6f58acbc70c2a6c216a73b47a39ea3d7bdc3c3", "committedDate": "2020-02-04T12:59:13Z", "message": "DROOLS-4942 DMN DT Analysis hit policy recommender\n\nWIP"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e2d3c9be3d21fed7116dae971cd742cb656f646e", "author": {"user": {"login": "tarilabs", "name": "Matteo Mortari"}}, "url": "https://github.com/kiegroup/drools/commit/e2d3c9be3d21fed7116dae971cd742cb656f646e", "committedDate": "2020-02-05T09:00:08Z", "message": "update according to feedback received"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f35dceb643bbef0c0165af19b2be0a14644382f8", "author": {"user": {"login": "tarilabs", "name": "Matteo Mortari"}}, "url": "https://github.com/kiegroup/drools/commit/f35dceb643bbef0c0165af19b2be0a14644382f8", "committedDate": "2020-02-05T09:09:40Z", "message": "cleanup"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c88ea2789f80df1d98515772d50bad5691073788", "author": {"user": {"login": "tarilabs", "name": "Matteo Mortari"}}, "url": "https://github.com/kiegroup/drools/commit/c88ea2789f80df1d98515772d50bad5691073788", "committedDate": "2020-02-06T15:28:29Z", "message": "."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzU0OTk4NTU2", "url": "https://github.com/kiegroup/drools/pull/2747#pullrequestreview-354998556", "createdAt": "2020-02-07T08:37:20Z", "commit": {"oid": "c88ea2789f80df1d98515772d50bad5691073788"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0wN1QwODozNzoyMFrOFm1qpw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0wN1QwODozNzoyMFrOFm1qpw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NjI2OTQ3OQ==", "bodyText": "it could be more readable if the function's name starts with \"get\"", "url": "https://github.com/kiegroup/drools/pull/2747#discussion_r376269479", "createdAt": "2020-02-07T08:37:20Z", "author": {"login": "hellowdan"}, "path": "kie-dmn/kie-dmn-validation/src/main/java/org/kie/dmn/validation/dtanalysis/model/DTAnalysis.java", "diffHunk": "@@ -692,4 +694,51 @@ public boolean is2ndNFViolation() {\n         return Collections.unmodifiableCollection(contractionsViolating2ndNF);\n     }\n \n+    public void computeHitPolicyRecommender() {\n+        if (!gaps.isEmpty() || !isHitPolicySingle(sourceDT.getHitPolicy())) {\n+            return;\n+        }\n+        if (overlaps.isEmpty() && sourceDT.getHitPolicy() != HitPolicy.UNIQUE) {\n+            passThruMessages.add(new DMNDTAnalysisMessage(this,\n+                                                          Severity.WARN,\n+                                                          MsgUtil.createMessage(Msg.DTANALYSIS_HITPOLICY_RECOMMENDER_UNIQUE,\n+                                                                                nameOrIDOfTable()),\n+                                                          Msg.DTANALYSIS_HITPOLICY_RECOMMENDER_UNIQUE.getType()));\n+        } else if (!overlaps.isEmpty()) {\n+            boolean overlapsShareSameOutput = true;\n+            for (Overlap ol : overlaps) {\n+                List<Integer> rules = ol.getRules();\n+                Set<List<Comparable<?>>> outputsForOverlap = new HashSet<>();\n+                for (Integer ruleID : rules) {\n+                    outputsForOverlap.add(ddtaTable.getRule().get(ruleID - 1).getOutputEntry());\n+                }\n+                overlapsShareSameOutput &= outputsForOverlap.size() == 1;\n+            }\n+            if (overlapsShareSameOutput && sourceDT.getHitPolicy() != HitPolicy.ANY) {\n+                passThruMessages.add(new DMNDTAnalysisMessage(this,\n+                                                              sourceDT.getHitPolicy() == HitPolicy.UNIQUE ? Severity.ERROR : Severity.WARN,\n+                                                              MsgUtil.createMessage(Msg.DTANALYSIS_HITPOLICY_RECOMMENDER_ANY,\n+                                                                                    nameOrIDOfTable()),\n+                                                              Msg.DTANALYSIS_HITPOLICY_RECOMMENDER_ANY.getType()));\n+            } else if (!overlapsShareSameOutput && sourceDT.getHitPolicy() != HitPolicy.PRIORITY) {\n+                passThruMessages.add(new DMNDTAnalysisMessage(this,\n+                                                              Severity.ERROR,\n+                                                              MsgUtil.createMessage(Msg.DTANALYSIS_HITPOLICY_RECOMMENDER_PRIORITY,\n+                                                                                    nameOrIDOfTable()),\n+                                                              Msg.DTANALYSIS_HITPOLICY_RECOMMENDER_PRIORITY.getType()));\n+            }\n+        }\n+    }\n+\n+    public boolean isHitPolicySingle(HitPolicy hp) {\n+        return hp == HitPolicy.UNIQUE || hp == HitPolicy.ANY || hp == HitPolicy.PRIORITY || hp == HitPolicy.FIRST;\n+    }\n+\n+    private String nameOrIDOfTable() {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c88ea2789f80df1d98515772d50bad5691073788"}, "originalPosition": 94}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1579, "cost": 1, "resetAt": "2021-11-01T15:33:45Z"}}}