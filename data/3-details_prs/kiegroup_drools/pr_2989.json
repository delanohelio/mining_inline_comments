{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDQ4Nzg1MDg1", "number": 2989, "title": "DROOLS-5394: Coverage Report Improvements (CSV File)", "bodyText": "@danielezonca @jstastny-cz Can you please review and test it?\n@jstastny-cz Based on your observations, I applied this change:\n\nI substituted LEVEL with RESULT: NOT_EVALUATED, EVALUATING, SUCCEEDED, SKIPPED, FAILED are the possibile values for DMN Test Scenarios, while Rule Test Scenario manage only SUCCEEDED value.\nMESSAGE Now contains the old LEVEL field with an error message. Please consider this message will appear in case of errors only, therefore I expect to see it empty most of times. (eg. ERROR: An error message)\n\nDMN Test Scenario Case:\n\n\n\nAVAILABLE DECISIONS\nDECISIONS FIRED\nPERCENTAGE OF DECISIONS FIRED\n\u00a0\n\u00a0\n\u00a0\n\n\n\n\n2\n2\n100\n\u00a0\n\u00a0\n\u00a0\n\n\n\u00a0\n\u00a0\n\u00a0\n\u00a0\n\u00a0\n\u00a0\n\n\nDECISION\nNUMBER OF TIMES\n\u00a0\n\u00a0\n\u00a0\n\u00a0\n\n\nShould the driver be suspended?\n5\n\u00a0\n\u00a0\n\u00a0\n\u00a0\n\n\nFine\n5\n\u00a0\n\u00a0\n\u00a0\n\u00a0\n\n\n\u00a0\n\u00a0\n\u00a0\n\u00a0\n\u00a0\n\u00a0\n\n\nTEST SCENARIO INDEX\nTEST SCENARIO NAME\nDECISION INDEX\nEVALUATED DECISION\nRESULT\nMESSAGE\n\n\n1\nAbove speed limit: 10km/h and 30 km/h\n1\nShould the driver be suspended?\nSUCCEEDED\n\u00a0\n\n\n1\nAbove speed limit: 10km/h and 30 km/h\n2\nFine\nSUCCEEDED\n\u00a0\n\n\n2\nAbove speed limit: more than 30 km/h\n1\nShould the driver be suspended?\nSUCCEEDED\n\u00a0\n\n\n2\nAbove speed limit: more than 30 km/h\n2\nFine\nSUCCEEDED\n\u00a0\n\n\n3\nParking violation\n1\nShould the driver be suspended?\nSUCCEEDED\n\u00a0\n\n\n3\nParking violation\n2\nFine\nSUCCEEDED\n\u00a0\n\n\n4\nDUI violation\n1\nShould the driver be suspended?\nSUCCEEDED\n\u00a0\n\n\n4\nDUI violation\n2\nFine\nSUCCEEDED\n\u00a0\n\n\n5\nDriver suspended\n1\nShould the driver be suspended?\nSUCCEEDED\n\u00a0\n\n\n5\nDriver suspended\n2\nFine\nSUCCEEDED\n\u00a0\n\n\n\nRule Test Scenario Case:\n\n\n\nAVAILABLE RULES\nRULES FIRED\nPERCENTAGE OF RULES FIRED\n\u00a0\n\u00a0\n\u00a0\n\n\n\n\n3\n3\n100\n\u00a0\n\u00a0\n\u00a0\n\n\n\u00a0\n\u00a0\n\u00a0\n\u00a0\n\u00a0\n\u00a0\n\n\nRULE\nNUMBER OF TIMES\n\u00a0\n\u00a0\n\u00a0\n\u00a0\n\n\nBook is unavailable if the number of copies is zero (com)\n1\n\u00a0\n\u00a0\n\u00a0\n\u00a0\n\n\nBook does not exist if the number of copies is less then zero (com)\n1\n\u00a0\n\u00a0\n\u00a0\n\u00a0\n\n\nBook is available if the number of copies is more than zero (com)\n1\n\u00a0\n\u00a0\n\u00a0\n\u00a0 \u00a0\n\n\n\u00a0\n\u00a0\n\u00a0\n\u00a0\n\u00a0\n\u00a0\n\n\nTEST SCENARIO INDEX\nTEST SCENARIO NAME\nRULE INDEX\nFIRED RULE\nRESULT\nMESSAGE\n\n\n1\nFirst\n1\nBook is available if the number of copies is more than zero (com)\nSUCCEEDED\n\n\n\n2\nSecond\n1\nBook is unavailable if the number of copies is zero (com)\nSUCCEEDED\n\n\n\n3\nThird\n1\nBook does not exist if the number of copies is less then zero (com)\nSUCCEEDED\n\n\n\n\nRelated client side PR: kiegroup/drools-wb#1382\nhttps://issues.redhat.com/browse/DROOLS-5394\nhttps://issues.redhat.com/browse/RHPAM-2616", "createdAt": "2020-07-14T10:12:05Z", "url": "https://github.com/kiegroup/drools/pull/2989", "merged": true, "mergeCommit": {"oid": "014a3a4f86c1372273d293d5739e0cdaa4329ece"}, "closed": true, "closedAt": "2020-07-27T11:09:07Z", "author": {"login": "yesamer"}, "timelineItems": {"totalCount": 17, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABc0yWrVAH2gAyNDQ4Nzg1MDg1OmViZjJhNDNjMzUzZDkxODQ1NTBhMDUyYWUyOGQ4OTRiM2M3YTQwNDk=", "endCursor": "Y3Vyc29yOnYyOpPPAAABc4FFyIgH2gAyNDQ4Nzg1MDg1OjhjNzgyNTllMmQ3ZTQwMmM2ZGFmMDBmMjA1Y2E5YzRkYjJiZjA3Yjc=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "ebf2a43c353d9184550a052ae28d894b3c7a4049", "author": {"user": {"login": "yesamer", "name": "Yeser Amer"}}, "url": "https://github.com/kiegroup/drools/commit/ebf2a43c353d9184550a052ae28d894b3c7a4049", "committedDate": "2020-07-14T09:10:10Z", "message": "DROOLS-5394: Improvements on Coverage Report"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "6c01994aa263b20ed09afd01b8953b29d3824a10", "author": {"user": {"login": "yesamer", "name": "Yeser Amer"}}, "url": "https://github.com/kiegroup/drools/commit/6c01994aa263b20ed09afd01b8953b29d3824a10", "committedDate": "2020-07-14T10:09:28Z", "message": "DROOLS-5394: Improvements on Coverage Report"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f0a82d82ca3b50662c55796f178d768ec9eb4b73", "author": {"user": {"login": "yesamer", "name": "Yeser Amer"}}, "url": "https://github.com/kiegroup/drools/commit/f0a82d82ca3b50662c55796f178d768ec9eb4b73", "committedDate": "2020-07-14T13:31:00Z", "message": "DROOLS-5394: Improvements on Coverage Report"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "96f88a29cd7fa607e1291233da2b82e8bb4f1400", "author": {"user": {"login": "yesamer", "name": "Yeser Amer"}}, "url": "https://github.com/kiegroup/drools/commit/96f88a29cd7fa607e1291233da2b82e8bb4f1400", "committedDate": "2020-07-16T09:18:20Z", "message": "DROOLS-5394: Tests"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "be254407ef29b84857f49410954cf0b1a5475a87", "author": {"user": {"login": "yesamer", "name": "Yeser Amer"}}, "url": "https://github.com/kiegroup/drools/commit/be254407ef29b84857f49410954cf0b1a5475a87", "committedDate": "2020-07-16T09:22:26Z", "message": "DROOLS-5394: Tests"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "6dd3b971cd0c07bd554ed3fce079d0f1f4fb7dbf", "author": {"user": {"login": "yesamer", "name": "Yeser Amer"}}, "url": "https://github.com/kiegroup/drools/commit/6dd3b971cd0c07bd554ed3fce079d0f1f4fb7dbf", "committedDate": "2020-07-16T09:22:36Z", "message": "Merge remote-tracking branch 'origin/master' into DROOLS-5394"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "342fbebc02b85563a950293b79059dcefb5dfb54", "author": {"user": {"login": "yesamer", "name": "Yeser Amer"}}, "url": "https://github.com/kiegroup/drools/commit/342fbebc02b85563a950293b79059dcefb5dfb54", "committedDate": "2020-07-16T09:46:59Z", "message": "DROOLS-5394: Tests + Minors"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c12b8451215c962c4f397fa34ed11883e6afd416", "author": {"user": {"login": "yesamer", "name": "Yeser Amer"}}, "url": "https://github.com/kiegroup/drools/commit/c12b8451215c962c4f397fa34ed11883e6afd416", "committedDate": "2020-07-23T11:53:05Z", "message": "Merge remote-tracking branch 'origin/master' into DROOLS-5394"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "9c9b270e497945345e9e6343a9e8a67dc11cedc7", "author": {"user": {"login": "yesamer", "name": "Yeser Amer"}}, "url": "https://github.com/kiegroup/drools/commit/9c9b270e497945345e9e6343a9e8a67dc11cedc7", "committedDate": "2020-07-23T11:54:22Z", "message": "DROOLS-5394: Changes Required during code review"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "203ef64465e1f8e7a2bb25e1abd9d9913fcadf55", "author": {"user": {"login": "yesamer", "name": "Yeser Amer"}}, "url": "https://github.com/kiegroup/drools/commit/203ef64465e1f8e7a2bb25e1abd9d9913fcadf55", "committedDate": "2020-07-23T11:58:57Z", "message": "DROOLS-5394: Changes Required during code review"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDU0MTUxODM1", "url": "https://github.com/kiegroup/drools/pull/2989#pullrequestreview-454151835", "createdAt": "2020-07-23T13:52:37Z", "commit": {"oid": "342fbebc02b85563a950293b79059dcefb5dfb54"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDU0NDkxODU2", "url": "https://github.com/kiegroup/drools/pull/2989#pullrequestreview-454491856", "createdAt": "2020-07-23T21:00:38Z", "commit": {"oid": "203ef64465e1f8e7a2bb25e1abd9d9913fcadf55"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yM1QyMTowMDozOFrOG2bacw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yM1QyMTowMDozOFrOG2bacw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1OTcyNTQyNw==", "bodyText": "Not sure about this change: old logic is an audit log with ordered list of fired rules while now we will not have duplication\n(if a rule fires 10 times instead of once I think it is important to know) and neither ordering.\nFor the ordering should be enough to use a LinkedHashMap but still not sure about losing the duplication.\nIs this on purpose? Can you please clarify?", "url": "https://github.com/kiegroup/drools/pull/2989#discussion_r459725427", "createdAt": "2020-07-23T21:00:38Z", "author": {"login": "danielezonca"}, "path": "drools-scenario-simulation/drools-scenario-simulation-backend/src/main/java/org/drools/scenariosimulation/backend/runner/RuleScenarioRunnerHelper.java", "diffHunk": "@@ -99,8 +100,7 @@ protected ScenarioResultMetadata extractResultMetadata(Map<String, Object> reque\n         scenarioResultMetadata.addAllAvailable(availableRules);\n         scenarioResultMetadata.addAllExecuted(ruleExecuted);\n         final AtomicInteger counter = new AtomicInteger(0);\n-        coverageAgendaListener\n-                .getAuditsMessages().forEach(auditMessage -> scenarioResultMetadata.addAuditMessage(counter.addAndGet(1), auditMessage, \"INFO\"));\n+        ruleExecuted.keySet().forEach(ruleName -> scenarioResultMetadata.addAuditMessage(counter.addAndGet(1), ruleName, ConstantsHolder.EXECUTED));", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "203ef64465e1f8e7a2bb25e1abd9d9913fcadf55"}, "originalPosition": 14}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "7d6258d42a80ef35a7f92ab58ec328720f242b44", "author": {"user": {"login": "yesamer", "name": "Yeser Amer"}}, "url": "https://github.com/kiegroup/drools/commit/7d6258d42a80ef35a7f92ab58ec328720f242b44", "committedDate": "2020-07-24T06:10:20Z", "message": "DROOLS-5394: Changes Required during code review"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDU0NjgwODcz", "url": "https://github.com/kiegroup/drools/pull/2989#pullrequestreview-454680873", "createdAt": "2020-07-24T07:25:21Z", "commit": {"oid": "7d6258d42a80ef35a7f92ab58ec328720f242b44"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDU0ODY5Mjk3", "url": "https://github.com/kiegroup/drools/pull/2989#pullrequestreview-454869297", "createdAt": "2020-07-24T13:05:43Z", "commit": {"oid": "7d6258d42a80ef35a7f92ab58ec328720f242b44"}, "state": "APPROVED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yNFQxMzowNTo0NFrOG2ulrA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yNFQxMzowNTo0NFrOG2ulrA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MDAzOTU5Ng==", "bodyText": "Can you move rule1 to a variable?", "url": "https://github.com/kiegroup/drools/pull/2989#discussion_r460039596", "createdAt": "2020-07-24T13:05:44Z", "author": {"login": "danielezonca"}, "path": "drools-scenario-simulation/drools-scenario-simulation-backend/src/test/java/org/drools/scenariosimulation/backend/fluent/CoverageAgendaListenerTest.java", "diffHunk": "@@ -38,6 +38,6 @@ public void beforeMatchFired() {\n         assertEquals((Integer) 1, ruleExecuted.get(\"rule1\"));\n         List<String> auditMessages = coverageAgendaListener.getAuditsMessages();\n         assertEquals(1, auditMessages.size());\n-        assertEquals(auditMessages.get(0), CoverageAgendaListener.generateAuditMessage(\"rule1\"));\n+        assertEquals(\"rule1\", auditMessages.get(0));", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "7d6258d42a80ef35a7f92ab58ec328720f242b44"}, "originalPosition": 5}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "644c378e59f3ee51a03908947555349f8d99297f", "author": {"user": {"login": "yesamer", "name": "Yeser Amer"}}, "url": "https://github.com/kiegroup/drools/commit/644c378e59f3ee51a03908947555349f8d99297f", "committedDate": "2020-07-24T14:41:23Z", "message": "Merge remote-tracking branch 'origin/master' into DROOLS-5394"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "8c78259e2d7e402c6daf00f205ca9c4db2bf07b7", "author": {"user": {"login": "yesamer", "name": "Yeser Amer"}}, "url": "https://github.com/kiegroup/drools/commit/8c78259e2d7e402c6daf00f205ca9c4db2bf07b7", "committedDate": "2020-07-24T14:41:41Z", "message": "DROOLS-5394: Changes Required during code review"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1856, "cost": 1, "resetAt": "2021-11-01T15:33:45Z"}}}