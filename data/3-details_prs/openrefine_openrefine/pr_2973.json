{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDU0NzI4MjQ2", "number": 2973, "title": "Faster rendering of rows and cells", "bodyText": "The rendering functions for rows and cells use jQuery which causes a greater overhead. Replacing it (in cases where it isn't necessary) by javascript speeds up the functions tremendously.\nThe comparison below is across 10 rows and 15 columns. The difference increases with greater number of rows and columns.\nBefore\n\nAfter", "createdAt": "2020-07-21T20:26:30Z", "url": "https://github.com/OpenRefine/OpenRefine/pull/2973", "merged": true, "mergeCommit": {"oid": "1dcc83209c5a1f052d0fb78fa3d388ef319ab753"}, "closed": true, "closedAt": "2020-07-28T16:25:33Z", "author": {"login": "lisa761"}, "timelineItems": {"totalCount": 8, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABc3LmJEAH2gAyNDU0NzI4MjQ2OmFiYzkzZDZjYjk3OGU5NzUyZmU3MTYxOWJiM2Y2ZGVkNTZmZTgwNTU=", "endCursor": "Y3Vyc29yOnYyOpPPAAABc5YmS9gFqTQ1Njc4MTQ1MQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "abc93d6cb978e9752fe71619bb3f6ded56fe8055", "author": {"user": {"login": "lisa761", "name": "Lisa Chandra"}}, "url": "https://github.com/OpenRefine/OpenRefine/commit/abc93d6cb978e9752fe71619bb3f6ded56fe8055", "committedDate": "2020-07-21T19:42:32Z", "message": "changes to rendering of rows"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a98f4eea749c5ecae407d3de661510cc88cd3c28", "author": {"user": {"login": "lisa761", "name": "Lisa Chandra"}}, "url": "https://github.com/OpenRefine/OpenRefine/commit/a98f4eea749c5ecae407d3de661510cc88cd3c28", "committedDate": "2020-07-21T19:59:28Z", "message": "some cell rendering improvements"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "28272bdfccb62d884f69c8084a1a49370f254d6a", "author": {"user": {"login": "lisa761", "name": "Lisa Chandra"}}, "url": "https://github.com/OpenRefine/OpenRefine/commit/28272bdfccb62d884f69c8084a1a49370f254d6a", "committedDate": "2020-07-21T20:07:16Z", "message": "more render row improvements"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDU0NjA2NTgz", "url": "https://github.com/OpenRefine/OpenRefine/pull/2973#pullrequestreview-454606583", "createdAt": "2020-07-24T02:33:38Z", "commit": {"oid": "28272bdfccb62d884f69c8084a1a49370f254d6a"}, "state": "COMMENTED", "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yNFQwMjozMzozOVrOG2hh_w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yNFQwMjozODoxNlrOG2hlLw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1OTgyNTY2Mw==", "bodyText": "I haven't investigated in detail, so I may be completely off base, but is there an opportunity to use a single global function here which knows how to find the relevant element and visible/hidden status based on information from the event so that we don't have to create N*2 functions?", "url": "https://github.com/OpenRefine/OpenRefine/pull/2973#discussion_r459825663", "createdAt": "2020-07-24T02:33:39Z", "author": {"login": "tfmorris"}, "path": "main/webapp/modules/core/scripts/views/data-table/cell-ui.js", "diffHunk": "@@ -62,43 +62,50 @@ DataTableCellUI.prototype._render = function() {\n   var self = this;\n   var cell = this._cell;\n \n-  var divContent = $('<div/>')\n-  .addClass(\"data-table-cell-content\");\n+  var divContent = document.createElement('div');\n+  divContent.className = 'data-table-cell-content';\n \n-  var editLink = $('<a href=\"javascript:{}\">&nbsp;</a>')\n-  .addClass(\"data-table-cell-edit\")\n-  .attr(\"title\", $.i18n('core-views/edit-cell'))\n-  .appendTo(divContent)\n-  .click(function() { self._startEdit(this); });\n+  var editLink = document.createElement('a');\n+  editLink.className = 'data-table-cell-edit';\n+  editLink.setAttribute('title', $.i18n('core-views/edit-cell'));\n+  editLink.href = 'javascript:{}';\n+  divContent.appendChild(editLink).appendChild(document.createTextNode('\\u00A0'));\n+  editLink.addEventListener('click', function() { self._startEdit(this); });\n \n   $(this._td).empty()\n   .unbind()\n-  .mouseenter(function() { editLink.css(\"visibility\", \"visible\"); })\n-  .mouseleave(function() { editLink.css(\"visibility\", \"hidden\"); });\n+  .mouseenter(function() { editLink.style.visibility = \"visible\" })", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "28272bdfccb62d884f69c8084a1a49370f254d6a"}, "originalPosition": 25}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1OTgyNTg2NA==", "bodyText": "Is this duplication correct? (I know it has nothing to do with your change)", "url": "https://github.com/OpenRefine/OpenRefine/pull/2973#discussion_r459825864", "createdAt": "2020-07-24T02:34:48Z", "author": {"login": "tfmorris"}, "path": "main/webapp/modules/core/scripts/views/data-table/cell-ui.js", "diffHunk": "@@ -62,43 +62,50 @@ DataTableCellUI.prototype._render = function() {\n   var self = this;\n   var cell = this._cell;\n \n-  var divContent = $('<div/>')\n-  .addClass(\"data-table-cell-content\");\n+  var divContent = document.createElement('div');\n+  divContent.className = 'data-table-cell-content';\n \n-  var editLink = $('<a href=\"javascript:{}\">&nbsp;</a>')\n-  .addClass(\"data-table-cell-edit\")\n-  .attr(\"title\", $.i18n('core-views/edit-cell'))\n-  .appendTo(divContent)\n-  .click(function() { self._startEdit(this); });\n+  var editLink = document.createElement('a');\n+  editLink.className = 'data-table-cell-edit';\n+  editLink.setAttribute('title', $.i18n('core-views/edit-cell'));\n+  editLink.href = 'javascript:{}';\n+  divContent.appendChild(editLink).appendChild(document.createTextNode('\\u00A0'));\n+  editLink.addEventListener('click', function() { self._startEdit(this); });\n \n   $(this._td).empty()\n   .unbind()\n-  .mouseenter(function() { editLink.css(\"visibility\", \"visible\"); })\n-  .mouseleave(function() { editLink.css(\"visibility\", \"hidden\"); });\n+  .mouseenter(function() { editLink.style.visibility = \"visible\" })\n+  .mouseleave(function() { editLink.style.visibility = \"hidden\" });\n \n   if (!cell || (\"v\" in cell && cell.v === null)) {\n-    $('<span>').addClass(\"data-table-null\").html('null').appendTo(divContent);\n+    var nullSpan = document.createElement('span');\n+    nullSpan.className = 'data-table-null';\n+    nullSpan.innerHTML = 'null';\n+    divContent.appendChild(nullSpan);\n   } else if (\"e\" in cell) {\n-    $('<span>').addClass(\"data-table-error\").text(cell.e).appendTo(divContent);\n+    var errorSpan = document.createElement('span');\n+    errorSpan.className = 'data-table-error';\n+    errorSpan.textContent = cell.e;\n+    divContent.appendChild(errorSpan);\n   } else if (!(\"r\" in cell) || !cell.r) {\n     if (typeof cell.v !== \"string\" || \"t\" in cell) {\n       if (typeof cell.v == \"number\") {\n         divContent.addClass(\"data-table-cell-content-numeric\");\n       }\n-      $('<span>')\n-      .addClass(\"data-table-value-nonstring\")\n-      .text(cell.v)\n-      .appendTo(divContent);\n+      var nonstringSpan = document.createElement('span');\n+      nonstringSpan.className = 'data-table-value-nonstring';\n+      nonstringSpan.textContent = cell.v;\n+      divContent.appendChild(nonstringSpan);\n     } else if (URL.looksLikeUrl(cell.v)) {\n-      $('<a>')\n-      .text(cell.v)\n-      .attr(\"href\", cell.v)\n-      .attr(\"target\", \"_blank\")\n-      .appendTo(divContent);\n+      var url = document.createElement('a');\n+      url.textContent = cell.v;\n+      url.setAttribute('href', cell.v);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "28272bdfccb62d884f69c8084a1a49370f254d6a"}, "originalPosition": 61}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1OTgyNjQ3OQ==", "bodyText": "I don't recognize the \\u00A0 text node idiom. What is it doing? If it's uncommon, as opposed to just my Javascript na\u00efvet\u00e9, perhaps a comment on first appearance is in order.", "url": "https://github.com/OpenRefine/OpenRefine/pull/2973#discussion_r459826479", "createdAt": "2020-07-24T02:38:16Z", "author": {"login": "tfmorris"}, "path": "main/webapp/modules/core/scripts/views/data-table/data-table-view.js", "diffHunk": "@@ -397,11 +397,12 @@ DataTableView.prototype._renderDataTables = function(table, tableHeader) {\n     $(tr).empty();\n     var cells = row.cells;\n     var tdStar = tr.insertCell(tr.cells.length);\n-    var star = $('<a href=\"javascript:{}\">&nbsp;</a>')\n-    .addClass(row.starred ? \"data-table-star-on\" : \"data-table-star-off\")\n-    .appendTo(tdStar)\n-    .click(function() {\n-      var newStarred = !row.starred;\n+    var star = document.createElement('a');\n+    star.href = \"javascript:{}\";\n+    star.classList.add(row.starred ? \"data-table-star-on\" : \"data-table-star-off\");\n+    tdStar.appendChild(star).appendChild(document.createTextNode('\\u00A0'));", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "28272bdfccb62d884f69c8084a1a49370f254d6a"}, "originalPosition": 12}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "94e5e7b4330d9bd6c996ca6d7bef0249b8f35b0e", "author": {"user": {"login": "lisa761", "name": "Lisa Chandra"}}, "url": "https://github.com/OpenRefine/OpenRefine/commit/94e5e7b4330d9bd6c996ca6d7bef0249b8f35b0e", "committedDate": "2020-07-27T12:52:43Z", "message": "fixed jQuery methods on js elements"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f090797e958ab5187c5bf910dc5fa4ca3e21af05", "author": {"user": {"login": "lisa761", "name": "Lisa Chandra"}}, "url": "https://github.com/OpenRefine/OpenRefine/commit/f090797e958ab5187c5bf910dc5fa4ca3e21af05", "committedDate": "2020-07-27T21:05:53Z", "message": "added comment for nbsp"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDU2MzQ3MTYy", "url": "https://github.com/OpenRefine/OpenRefine/pull/2973#pullrequestreview-456347162", "createdAt": "2020-07-28T06:50:22Z", "commit": {"oid": "f090797e958ab5187c5bf910dc5fa4ca3e21af05"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDU2NzgxNDUx", "url": "https://github.com/OpenRefine/OpenRefine/pull/2973#pullrequestreview-456781451", "createdAt": "2020-07-28T15:59:19Z", "commit": {"oid": "f090797e958ab5187c5bf910dc5fa4ca3e21af05"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3069, "cost": 1, "resetAt": "2021-11-01T15:33:45Z"}}}