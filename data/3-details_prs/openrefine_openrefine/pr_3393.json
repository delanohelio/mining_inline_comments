{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTM0NDYwMzg2", "number": 3393, "title": "Run UI tests in continuous integration", "bodyText": "Fixed flaky tests\nRefactored ui_test command\nIntegration with Github actions", "createdAt": "2020-12-08T13:43:42Z", "url": "https://github.com/OpenRefine/OpenRefine/pull/3393", "merged": true, "mergeCommit": {"oid": "4b6106a386d529a79eb7c23484f8ad9e78a86196"}, "closed": true, "closedAt": "2020-12-15T19:34:16Z", "author": {"login": "fgiroud"}, "timelineItems": {"totalCount": 10, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdkJy4lAH2gAyNTM0NDYwMzg2OmNhNWJhNWE2YzM5ZGVjMThlODMwYjFhMjNlZTI3ZWVjZDNlZjZhMWY=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdmflBRgFqTU1MjgwMTgzNQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "ca5ba5a6c39dec18e830b1a23ee27eecd3ef6a1f", "author": {"user": {"login": "fgiroud", "name": "Florian Giroud"}}, "url": "https://github.com/OpenRefine/OpenRefine/commit/ca5ba5a6c39dec18e830b1a23ee27eecd3ef6a1f", "committedDate": "2020-12-08T13:03:14Z", "message": "Fixed flaky tests"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ca7bb99a74fb88f3cb47dbbfe519f0b75b87a0c5", "author": {"user": {"login": "fgiroud", "name": "Florian Giroud"}}, "url": "https://github.com/OpenRefine/OpenRefine/commit/ca7bb99a74fb88f3cb47dbbfe519f0b75b87a0c5", "committedDate": "2020-12-08T13:18:57Z", "message": "Refactored ui_test commans-line, added documentation"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "4c954705301443f6cecc44e1e3946e3566aec663", "author": {"user": {"login": "fgiroud", "name": "Florian Giroud"}}, "url": "https://github.com/OpenRefine/OpenRefine/commit/4c954705301443f6cecc44e1e3946e3566aec663", "committedDate": "2020-12-08T13:42:46Z", "message": "Attempt to build a workflow with cypress"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTQ5MzQxNzkw", "url": "https://github.com/OpenRefine/OpenRefine/pull/3393#pullrequestreview-549341790", "createdAt": "2020-12-10T15:54:21Z", "commit": {"oid": "4c954705301443f6cecc44e1e3946e3566aec663"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xMFQxNTo1NDoyMVrOIDQQIA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xMFQxNTo1NDoyMVrOIDQQIA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MDI4MjkxMg==", "bodyText": "what is this for or does?", "url": "https://github.com/OpenRefine/OpenRefine/pull/3393#discussion_r540282912", "createdAt": "2020-12-10T15:54:21Z", "author": {"login": "thadguidry"}, "path": "refine", "diffHunk": "@@ -498,23 +514,37 @@ ui_test() {\n     fi\n     echo \"... proceed with the tests.\"\n     echo \"\"\n-    \n-    load_data \"$REFINE_TEST_DIR/data/food.csv\" \"Food\"\n-    sleep 3\n-    echo \"\"\n-    \n-    echo \"Starting Windmill...\"\n-    if [ -z \"$INTERACTIVE\" ] ; then\n-        \"$WINDMILL\" firefox firebug loglevel=WARN http://${REFINE_HOST}:${REFINE_PORT}/ jsdir=$REFINE_TEST_DIR/client/src exit\n+\n+    echo \"Starting Cypress...\"\n+    CYPRESS_RUN_CMD=\"yarn --cwd ./main/tests/cypress run cypress run --browser $BROWSER --headless --quiet --reporter list --env OPENREFINE_URL=http://$REFINE_HOST:$REFINE_PORT\"\n+    if [ \"$CYPRESS_RECORD\" = \"1\" ] ; then\n+        # if tests are recorded, project id is added to env vars, and --record flag is added to the cmd-line\n+        export CYPRESS_PROJECT_ID=$CYPRESS_PROJECT_ID\n+        CYPRESS_RUN_CMD=\"$CYPRESS_RUN_CMD --record --key $CYPRESS_RECORD_KEY --tag $BROWSER,$REVISION\"\n+    fi\n+    export MOZ_FORCE_DISABLE_E10S=1", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "4c954705301443f6cecc44e1e3946e3566aec663"}, "originalPosition": 65}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "10151b252fe089fe11926d5b278f84e48710a104", "author": {"user": {"login": "fgiroud", "name": "Florian Giroud"}}, "url": "https://github.com/OpenRefine/OpenRefine/commit/10151b252fe089fe11926d5b278f84e48710a104", "committedDate": "2020-12-11T07:26:24Z", "message": "Fixed CI UX tests build"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ac7fed5182365d0480b70194c74a5b6190e98955", "author": {"user": {"login": "fgiroud", "name": "Florian Giroud"}}, "url": "https://github.com/OpenRefine/OpenRefine/commit/ac7fed5182365d0480b70194c74a5b6190e98955", "committedDate": "2020-12-11T16:25:15Z", "message": "Changed cyprss actions for pull-request"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "650a7bb4c476da21507ce17efecc69a320fd2067", "author": {"user": {"login": "fgiroud", "name": "Florian Giroud"}}, "url": "https://github.com/OpenRefine/OpenRefine/commit/650a7bb4c476da21507ce17efecc69a320fd2067", "committedDate": "2020-12-14T11:05:13Z", "message": "Merged Cypress workflow into the regular PR target workflow"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "2a3f039e44b4fec826cdb83f19ae6fc70151c476", "author": {"user": {"login": "fgiroud", "name": "Florian Giroud"}}, "url": "https://github.com/OpenRefine/OpenRefine/commit/2a3f039e44b4fec826cdb83f19ae6fc70151c476", "committedDate": "2020-12-14T11:14:03Z", "message": "Refactored Github workflows to include Cypress Tests"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "fc8316e0347014c0396353a615bd0c53077088b9", "author": {"user": {"login": "fgiroud", "name": "Florian Giroud"}}, "url": "https://github.com/OpenRefine/OpenRefine/commit/fc8316e0347014c0396353a615bd0c53077088b9", "committedDate": "2020-12-15T09:16:02Z", "message": "Revert Ci build to pull_request_target"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTUyODAxODM1", "url": "https://github.com/OpenRefine/OpenRefine/pull/3393#pullrequestreview-552801835", "createdAt": "2020-12-15T19:33:51Z", "commit": {"oid": "fc8316e0347014c0396353a615bd0c53077088b9"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3385, "cost": 1, "resetAt": "2021-11-01T15:33:45Z"}}}