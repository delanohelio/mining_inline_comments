{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0Mzg4NDY3MTIy", "number": 2414, "title": "Fix silent error in JSON/XML importers", "bodyText": "Address issue #2403 .\nCause of issue\nException is caught but not thrown at XmlImportUtilities.java.\nImplementation\n\nAdd exception handler at  XmlImportUtilities.java, TreeImportingParserBase.java \nPass more user friendly message in DefaultImportingController.java  when writing exceptions into response.\n\nTest\n\n\nTry with error mentioned in issue #2403, and the expected result is aquired.\n\n\n\nImplement test method at JsonImporterTests.java", "createdAt": "2020-03-14T22:40:48Z", "url": "https://github.com/OpenRefine/OpenRefine/pull/2414", "merged": true, "mergeCommit": {"oid": "1f0111eaede5285ef6663a2730359d5786131fb9"}, "closed": true, "closedAt": "2020-03-27T08:41:50Z", "author": {"login": "zengchu2"}, "timelineItems": {"totalCount": 20, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcNsGGZgH2gAyMzg4NDY3MTIyOjcyZWE4ZmE2ODEyMjA1OTFjZWYzNmJmZDgwMjkyNmFhMWNhMzkyMDA=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcQyXZogFqTM4MDI3NTA5Mw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "72ea8fa681220591cef36bfd802926aa1ca39200", "author": {"user": {"login": "zengchu2", "name": "chuhao zeng"}}, "url": "https://github.com/OpenRefine/OpenRefine/commit/72ea8fa681220591cef36bfd802926aa1ca39200", "committedDate": "2020-03-14T21:49:35Z", "message": "Add error handler for parse error"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "1728b4761508b57945bcd031999919445e9da018", "author": {"user": {"login": "zengchu2", "name": "chuhao zeng"}}, "url": "https://github.com/OpenRefine/OpenRefine/commit/1728b4761508b57945bcd031999919445e9da018", "committedDate": "2020-03-14T22:32:22Z", "message": "Add test for parsing json with incorrect strecture"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzc0NzYxMjc2", "url": "https://github.com/OpenRefine/OpenRefine/pull/2414#pullrequestreview-374761276", "createdAt": "2020-03-14T23:45:21Z", "commit": {"oid": "1728b4761508b57945bcd031999919445e9da018"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xNFQyMzo0NToyMlrOF2cIgQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xNFQyMzo0NToyMlrOF2cIgQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MjYyODM1Mw==", "bodyText": "We should probably add 1 more new line to separate from the error itself more in the dialog and make it stand out.\nAlso, will this get localized properly for our translations support?", "url": "https://github.com/OpenRefine/OpenRefine/pull/2414#discussion_r392628353", "createdAt": "2020-03-14T23:45:22Z", "author": {"login": "thadguidry"}, "path": "main/src/com/google/refine/importing/DefaultImportingController.java", "diffHunk": "@@ -290,7 +292,12 @@ static public void writeErrors(JsonGenerator writer, List<Exception> exceptions)\n             e.printStackTrace(new PrintWriter(sw));\n             \n             writer.writeStartObject();\n-            writer.writeStringField(\"message\", e.getLocalizedMessage());\n+            String errorMessage = e.getLocalizedMessage();\n+            if(e instanceof TreeReaderException) {\n+                errorMessage += \"\\nPlease correct the format of your input file, or choose another\" +", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "1728b4761508b57945bcd031999919445e9da018"}, "originalPosition": 16}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "1b0111271114309b8423cae89f23eee36638b8c6", "author": {"user": {"login": "zengchu2", "name": "chuhao zeng"}}, "url": "https://github.com/OpenRefine/OpenRefine/commit/1b0111271114309b8423cae89f23eee36638b8c6", "committedDate": "2020-03-15T04:52:08Z", "message": "Enable localization from front-end"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "2f0b064f1bd6b97b2ac4f51657d572e4c9cbe70e", "author": {"user": {"login": "zengchu2", "name": "chuhao zeng"}}, "url": "https://github.com/OpenRefine/OpenRefine/commit/2f0b064f1bd6b97b2ac4f51657d572e4c9cbe70e", "committedDate": "2020-03-15T05:03:43Z", "message": "Add methods to get localized error messages"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzc0Nzk5NzY0", "url": "https://github.com/OpenRefine/OpenRefine/pull/2414#pullrequestreview-374799764", "createdAt": "2020-03-15T13:35:02Z", "commit": {"oid": "2f0b064f1bd6b97b2ac4f51657d572e4c9cbe70e"}, "state": "COMMENTED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "124874f5ae36b8983a0b748f9cfb0760452c1faa", "author": {"user": {"login": "zengchu2", "name": "chuhao zeng"}}, "url": "https://github.com/OpenRefine/OpenRefine/commit/124874f5ae36b8983a0b748f9cfb0760452c1faa", "committedDate": "2020-03-15T22:27:35Z", "message": "Update returned exception message"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzc0ODQwNTgy", "url": "https://github.com/OpenRefine/OpenRefine/pull/2414#pullrequestreview-374840582", "createdAt": "2020-03-15T22:33:25Z", "commit": {"oid": "124874f5ae36b8983a0b748f9cfb0760452c1faa"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xNVQyMjozMzoyNVrOF2huiw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xNVQyMjozMzoyNVrOF2huiw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MjcyMDAxMQ==", "bodyText": "console.log should be removed.", "url": "https://github.com/OpenRefine/OpenRefine/pull/2414#discussion_r392720011", "createdAt": "2020-03-15T22:33:25Z", "author": {"login": "wetneb"}, "path": "main/webapp/modules/core/scripts/index/default-importing-controller/controller.js", "diffHunk": "@@ -375,7 +375,8 @@ Refine.TagsManager._getAllProjectTags = function() {\n \n // Helper function to provide more localized message from plain Java Exception message.\n function getLocalizedErrorMessage(message) {\n-    if(message.contains(\"JsonParseException\")){\n+    console.log(message);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "124874f5ae36b8983a0b748f9cfb0760452c1faa"}, "originalPosition": 14}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "5cdbb39b164eeef0ceb68f394f1a6b7a9dc16a77", "author": {"user": {"login": "zengchu2", "name": "chuhao zeng"}}, "url": "https://github.com/OpenRefine/OpenRefine/commit/5cdbb39b164eeef0ceb68f394f1a6b7a9dc16a77", "committedDate": "2020-03-16T05:47:26Z", "message": "Remove unused log and fix file diff issue"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "4c164b4aa4b7333d5b004c0eff1278a4ca0ef233", "author": {"user": {"login": "zengchu2", "name": "chuhao zeng"}}, "url": "https://github.com/OpenRefine/OpenRefine/commit/4c164b4aa4b7333d5b004c0eff1278a4ca0ef233", "committedDate": "2020-03-16T01:47:00Z", "message": "Revert \"Update returned exception message\"\n\nThis reverts commit 124874f5ae36b8983a0b748f9cfb0760452c1faa."}, "afterCommit": {"oid": "5cdbb39b164eeef0ceb68f394f1a6b7a9dc16a77", "author": {"user": {"login": "zengchu2", "name": "chuhao zeng"}}, "url": "https://github.com/OpenRefine/OpenRefine/commit/5cdbb39b164eeef0ceb68f394f1a6b7a9dc16a77", "committedDate": "2020-03-16T05:47:26Z", "message": "Remove unused log and fix file diff issue"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "be4c5d525cfeb632955aaaf39ae80c3cfa1a0380", "author": {"user": {"login": "zengchu2", "name": "chuhao zeng"}}, "url": "https://github.com/OpenRefine/OpenRefine/commit/be4c5d525cfeb632955aaaf39ae80c3cfa1a0380", "committedDate": "2020-03-16T21:02:22Z", "message": "Test auto build"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f1aa73a440889e48f6e85be2f29687c65559436a", "author": {"user": {"login": "zengchu2", "name": "chuhao zeng"}}, "url": "https://github.com/OpenRefine/OpenRefine/commit/f1aa73a440889e48f6e85be2f29687c65559436a", "committedDate": "2020-03-16T21:15:28Z", "message": "Refactor getOptions in newly created test"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzc4MzEwMDk1", "url": "https://github.com/OpenRefine/OpenRefine/pull/2414#pullrequestreview-378310095", "createdAt": "2020-03-20T08:52:14Z", "commit": {"oid": "f1aa73a440889e48f6e85be2f29687c65559436a"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yMFQwODo1MjoxNFrOF5LkMw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yMFQwODo1MjoxNFrOF5LkMw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NTUwMjY0Mw==", "bodyText": "This code is specific to the JSON\u00a0importer, but it was added to a general purpose importing class. This is a problem: writing importers should not require making changes to generic classes like this.\nInstead, we should have a generic way to report parsing exceptions to the user. So I propose we do this:\n\nCatch the JsonParseException in the JSON importer;\nExtract the message as you are doing here;\nStore this message in a new exception, that we could introduce in this PR but could then be reused by other importers (we could call it ImportingParserException);\nThen we can still have your isImportingParserException logic with \"core-views/check-format\" as message that we concatenate.", "url": "https://github.com/OpenRefine/OpenRefine/pull/2414#discussion_r395502643", "createdAt": "2020-03-20T08:52:14Z", "author": {"login": "wetneb"}, "path": "main/src/com/google/refine/importing/DefaultImportingController.java", "diffHunk": "@@ -290,7 +293,15 @@ static public void writeErrors(JsonGenerator writer, List<Exception> exceptions)\n             e.printStackTrace(new PrintWriter(sw));\n             \n             writer.writeStartObject();\n-            writer.writeStringField(\"message\", e.getLocalizedMessage());\n+            String message = e.getLocalizedMessage();\n+            \n+            if(e.getCause() instanceof JsonParseException) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f1aa73a440889e48f6e85be2f29687c65559436a"}, "originalPosition": 24}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "8e25752fe40909e662126b7b19c53e1e466a4a89", "author": {"user": {"login": "zengchu2", "name": "chuhao zeng"}}, "url": "https://github.com/OpenRefine/OpenRefine/commit/8e25752fe40909e662126b7b19c53e1e466a4a89", "committedDate": "2020-03-23T22:46:42Z", "message": "Use new exception to unwrap original message"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "929d5436122a69ee6f20e3df662c5fa448248e6d", "author": {"user": {"login": "zengchu2", "name": "chuhao zeng"}}, "url": "https://github.com/OpenRefine/OpenRefine/commit/929d5436122a69ee6f20e3df662c5fa448248e6d", "committedDate": "2020-03-23T22:48:02Z", "message": "Undo unexpected fix"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "04d85e962069ae3ccd39663f9a764d974f79fb32", "author": {"user": {"login": "zengchu2", "name": "chuhao zeng"}}, "url": "https://github.com/OpenRefine/OpenRefine/commit/04d85e962069ae3ccd39663f9a764d974f79fb32", "committedDate": "2020-03-23T22:51:23Z", "message": "Remove unused lines"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzgwMDUwOTk2", "url": "https://github.com/OpenRefine/OpenRefine/pull/2414#pullrequestreview-380050996", "createdAt": "2020-03-24T07:24:33Z", "commit": {"oid": "8e25752fe40909e662126b7b19c53e1e466a4a89"}, "state": "COMMENTED", "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yNFQwNzoyNDozNFrOF6jlgw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yNFQwNzoyNzozMFrOF6jqEw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5Njk0NDc3MQ==", "bodyText": "I don't think we can assume that all TreeReaderException instances are JsonParseException\u2026 Especially since JsonParseException is not a subclass of TreeReaderException! It would be good to have a unit test to show how this works. (This sort of mistake should be caught by any unit test covering these lines)", "url": "https://github.com/OpenRefine/OpenRefine/pull/2414#discussion_r396944771", "createdAt": "2020-03-24T07:24:34Z", "author": {"login": "wetneb"}, "path": "main/src/com/google/refine/importers/tree/XmlImportUtilities.java", "diffHunk": "@@ -265,13 +268,13 @@ static public void importTreeData(\n             }\n         } catch (TreeReaderException e) {\n             logger.error(\"Exception from XML parse\",e);\n-            throw e;\n+            throw new ImportingParserException(((JsonParseException)e.getCause()).getOriginalMessage());", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "8e25752fe40909e662126b7b19c53e1e466a4a89"}, "originalPosition": 25}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5Njk0NDkwMA==", "bodyText": "Why?", "url": "https://github.com/OpenRefine/OpenRefine/pull/2414#discussion_r396944900", "createdAt": "2020-03-24T07:24:57Z", "author": {"login": "wetneb"}, "path": "main/src/com/google/refine/importers/tree/XmlImportUtilities.java", "diffHunk": "@@ -265,13 +268,13 @@ static public void importTreeData(\n             }\n         } catch (TreeReaderException e) {\n             logger.error(\"Exception from XML parse\",e);\n-            throw e;\n+            throw new ImportingParserException(((JsonParseException)e.getCause()).getOriginalMessage());\n         }\n     }\n \n     /**\n      *\n-     * @param project\n+     * @param pro", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "8e25752fe40909e662126b7b19c53e1e466a4a89"}, "originalPosition": 32}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5Njk0NTkzOQ==", "bodyText": "\"This exception should contain\"\u2026 what?", "url": "https://github.com/OpenRefine/OpenRefine/pull/2414#discussion_r396945939", "createdAt": "2020-03-24T07:27:30Z", "author": {"login": "wetneb"}, "path": "main/src/com/google/refine/importers/ImportingParserException.java", "diffHunk": "@@ -0,0 +1,13 @@\n+package com.google.refine.importers;\n+\n+/**\n+ * Exception thrown by importers.  \n+ * This exception should contain ", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "04d85e962069ae3ccd39663f9a764d974f79fb32"}, "originalPosition": 5}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "49bc7e408bdd4d407e24f790724252dcb892a50a", "author": {"user": {"login": "zengchu2", "name": "chuhao zeng"}}, "url": "https://github.com/OpenRefine/OpenRefine/commit/49bc7e408bdd4d407e24f790724252dcb892a50a", "committedDate": "2020-03-24T12:01:42Z", "message": "Fix exception logic"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "4d725b2d3b6393c5c52d58a191b2c7a09f84513d", "author": {"user": {"login": "zengchu2", "name": "chuhao zeng"}}, "url": "https://github.com/OpenRefine/OpenRefine/commit/4d725b2d3b6393c5c52d58a191b2c7a09f84513d", "committedDate": "2020-03-24T12:14:55Z", "message": "Fix typo"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzgwMjc1MDkz", "url": "https://github.com/OpenRefine/OpenRefine/pull/2414#pullrequestreview-380275093", "createdAt": "2020-03-24T12:49:41Z", "commit": {"oid": "4d725b2d3b6393c5c52d58a191b2c7a09f84513d"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3322, "cost": 1, "resetAt": "2021-11-01T15:33:45Z"}}}