{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDkyMzk4NDY0", "number": 3212, "title": "Validate Host header of incoming HTTP requests", "bodyText": "Fixes #3288\nThis patch adds a simple HTTP Host header check to prevent DNS rebinding attacks. As OpenRefine offers endpoints with intentional remote code execution without authentication (like running Python or Clojure transformations), normal desktop use would expose users to Remote Code Execution via DNS rebinding attacks. (Please note that this type of attack bypasses the CSRF protections built into OpenRefine, since /command/core/get-csrf-token can be called once cross-origin policies are bypassed.)\nAs a consequence of this patch, any normal execution of OpenRefine will have Host header checks enabled, except when binding to 0.0.0.0 or if the user explicitly opts out by specifying -Drefine.host.validate=false as a command line option. This won't affect desktop users at all who are using the default configuration, or variations of it, but will affect those running OpenRefine on a server or behind a proxy, and there is a mismatch in host names. (Alternatively, the default value of refine.host.validate could be altered to make this behavior opt-in, but a secure default value would be better.)\nThe patch itself should be pretty low impact, but since I am not extremely familiar with Jetty's peculiarities, there could be some issues I missed.", "createdAt": "2020-09-24T12:05:20Z", "url": "https://github.com/OpenRefine/OpenRefine/pull/3212", "merged": true, "mergeCommit": {"oid": "6234a61e82235f69363764c9b9016c0c7d3da778"}, "closed": true, "closedAt": "2021-03-22T11:53:39Z", "author": {"login": "dzsibi"}, "timelineItems": {"totalCount": 23, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdN2uaQgFqTQ5OTExNTMxNQ==", "endCursor": "Y3Vyc29yOnYyOpPPAAABeFltXfgH2gAyNDkyMzk4NDY0Ojg1NTNmOGY5YmI0ZjFkODlhZmU3NGY4MTFmM2YxZTlmN2NlMTI1YzU=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDk5MTE1MzE1", "url": "https://github.com/OpenRefine/OpenRefine/pull/3212#pullrequestreview-499115315", "createdAt": "2020-09-30T06:23:49Z", "commit": {"oid": "453f1f8e4cbd1df392392bcc93d39a29b62fa32e"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "453f1f8e4cbd1df392392bcc93d39a29b62fa32e", "author": {"user": {"login": "dzsibi", "name": "B\u00e1lint J\u00f3zsef J\u00e1nv\u00e1ri"}}, "url": "https://github.com/OpenRefine/OpenRefine/commit/453f1f8e4cbd1df392392bcc93d39a29b62fa32e", "committedDate": "2020-09-24T11:23:25Z", "message": "Validate Host header of incoming HTTP requests"}, "afterCommit": {"oid": "400b95b69db0c6d565f95bd79bc636c45e49abd4", "author": {"user": {"login": "dzsibi", "name": "B\u00e1lint J\u00f3zsef J\u00e1nv\u00e1ri"}}, "url": "https://github.com/OpenRefine/OpenRefine/commit/400b95b69db0c6d565f95bd79bc636c45e49abd4", "committedDate": "2020-10-26T15:21:22Z", "message": "Validate Host header of incoming HTTP requests"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTIxMTY1MDky", "url": "https://github.com/OpenRefine/OpenRefine/pull/3212#pullrequestreview-521165092", "createdAt": "2020-10-31T19:54:16Z", "commit": {"oid": "046862e92e8981f87fd473bdbd47fddc4aa84466"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0zMVQxOTo1NDoxNlrOHrpoeg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0zMVQxOTo1NDoxNlrOHrpoeg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNTUzMjkyMg==", "bodyText": "I wonder if it would make sense to write one or two simple tests to show which hosts are allowed.\nYou would probably need to move this class to its own file or making it a nested class of Refine.\n(I have to admit I wasn't aware of the fact that we had multiple top-level classes in Refine.java, it looks a bit confusing to me, and does not seem to be a widely recommended practice.)", "url": "https://github.com/OpenRefine/OpenRefine/pull/3212#discussion_r515532922", "createdAt": "2020-10-31T19:54:16Z", "author": {"login": "wetneb"}, "path": "server/src/com/google/refine/Refine.java", "diffHunk": "@@ -435,32 +447,92 @@ static private String fixWindowsUnicodePath(String path) {\n             return path;\n         }\n         int pathSep = path.indexOf(File.separatorChar, q);\n-        \n+\n         String goodPath = System.getenv(\"APPDATA\");\n         if (goodPath == null || goodPath.length() == 0) {\n             goodPath = System.getenv(\"USERPROFILE\");\n             if (!goodPath.endsWith(File.separator)) {\n                 goodPath = goodPath + File.separator;\n             }\n         }\n-        \n+\n         int goodPathSep = goodPath.indexOf(File.separatorChar, q);\n-        \n+\n         return path.substring(0, q) + goodPath.substring(q, goodPathSep) + path.substring(pathSep);\n     }\n-    \n+\n+}\n+\n+/**\n+ * Validate the Host header of the HTTP request to see if it matches either a loopback IP\n+ * address, localhost or an explicitly specified hostname. This is required to avoid DNS\n+ * rebinding attacks against users running OpenRefine on their desktop computers.\n+ */\n+class ValidateHostHandler extends HandlerWrapper {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "046862e92e8981f87fd473bdbd47fddc4aa84466"}, "originalPosition": 395}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c39798bb6a1eb9d5d41d3eebac258c959f47a4fa", "author": {"user": {"login": "dzsibi", "name": "B\u00e1lint J\u00f3zsef J\u00e1nv\u00e1ri"}}, "url": "https://github.com/OpenRefine/OpenRefine/commit/c39798bb6a1eb9d5d41d3eebac258c959f47a4fa", "committedDate": "2020-12-02T09:23:05Z", "message": "Validate Host header of incoming HTTP requests"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "6895caf4ab5a452dd7b2a786750c6ab6f0589cff", "author": {"user": {"login": "dzsibi", "name": "B\u00e1lint J\u00f3zsef J\u00e1nv\u00e1ri"}}, "url": "https://github.com/OpenRefine/OpenRefine/commit/6895caf4ab5a452dd7b2a786750c6ab6f0589cff", "committedDate": "2020-12-02T09:23:05Z", "message": "Always allow requests with loopback IP addresses and localhost"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "1c66774851bc7e384e79f729e4e710cf272ab691", "author": {"user": {"login": "dzsibi", "name": "B\u00e1lint J\u00f3zsef J\u00e1nv\u00e1ri"}}, "url": "https://github.com/OpenRefine/OpenRefine/commit/1c66774851bc7e384e79f729e4e710cf272ab691", "committedDate": "2020-12-02T10:09:56Z", "message": "Split off ValidateHostHandler to a separate file"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "046862e92e8981f87fd473bdbd47fddc4aa84466", "author": {"user": {"login": "dzsibi", "name": "B\u00e1lint J\u00f3zsef J\u00e1nv\u00e1ri"}}, "url": "https://github.com/OpenRefine/OpenRefine/commit/046862e92e8981f87fd473bdbd47fddc4aa84466", "committedDate": "2020-10-26T18:29:10Z", "message": "Always allow requests with loopback IP addresses and localhost"}, "afterCommit": {"oid": "1c66774851bc7e384e79f729e4e710cf272ab691", "author": {"user": {"login": "dzsibi", "name": "B\u00e1lint J\u00f3zsef J\u00e1nv\u00e1ri"}}, "url": "https://github.com/OpenRefine/OpenRefine/commit/1c66774851bc7e384e79f729e4e710cf272ab691", "committedDate": "2020-12-02T10:09:56Z", "message": "Split off ValidateHostHandler to a separate file"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e546766a0cf1ab647f1fdd917d2f94a97d424a74", "author": {"user": {"login": "dzsibi", "name": "B\u00e1lint J\u00f3zsef J\u00e1nv\u00e1ri"}}, "url": "https://github.com/OpenRefine/OpenRefine/commit/e546766a0cf1ab647f1fdd917d2f94a97d424a74", "committedDate": "2020-12-04T09:40:17Z", "message": "Allow IPv4-mapped loopback addresses in ValidateHostHandler"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e0d432c3d413b8323df8fa202ec07b1d2de8cca1", "author": {"user": {"login": "dzsibi", "name": "B\u00e1lint J\u00f3zsef J\u00e1nv\u00e1ri"}}, "url": "https://github.com/OpenRefine/OpenRefine/commit/e0d432c3d413b8323df8fa202ec07b1d2de8cca1", "committedDate": "2020-12-04T09:51:39Z", "message": "Add error description to 404 error returned by ValidateHostHandler"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "4dbdca4ac3693a95bbc32f4cb97c1c008701171e", "author": {"user": {"login": "dzsibi", "name": "B\u00e1lint J\u00f3zsef J\u00e1nv\u00e1ri"}}, "url": "https://github.com/OpenRefine/OpenRefine/commit/4dbdca4ac3693a95bbc32f4cb97c1c008701171e", "committedDate": "2021-02-19T16:35:34Z", "message": "Add refine.interface parameter to override interface and host separately"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "d9937e2915b5337634c360a8b47ef580174dd322", "author": {"user": {"login": "dzsibi", "name": "B\u00e1lint J\u00f3zsef J\u00e1nv\u00e1ri"}}, "url": "https://github.com/OpenRefine/OpenRefine/commit/d9937e2915b5337634c360a8b47ef580174dd322", "committedDate": "2021-02-19T16:49:40Z", "message": "Fix some whitespace inconsistencies"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "1fa6fc5e3d63054a9b8be6c50bcf5d2fd0222c30", "author": {"user": {"login": "wetneb", "name": "Antonin Delpeuch"}}, "url": "https://github.com/OpenRefine/OpenRefine/commit/1fa6fc5e3d63054a9b8be6c50bcf5d2fd0222c30", "committedDate": "2021-02-20T08:25:56Z", "message": "Merge branch 'master' into master"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "187c007363052e0a5ffe17c0d005f83ecd5e9e18", "author": {"user": {"login": "wetneb", "name": "Antonin Delpeuch"}}, "url": "https://github.com/OpenRefine/OpenRefine/commit/187c007363052e0a5ffe17c0d005f83ecd5e9e18", "committedDate": "2021-02-20T10:40:16Z", "message": "Merge branch 'master' into master"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTk0NzQyMTIx", "url": "https://github.com/OpenRefine/OpenRefine/pull/3212#pullrequestreview-594742121", "createdAt": "2021-02-20T11:10:07Z", "commit": {"oid": "187c007363052e0a5ffe17c0d005f83ecd5e9e18"}, "state": "COMMENTED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "3af6a59570ec5075e1f609d6a6f68f1f7ad71982", "author": {"user": {"login": "dzsibi", "name": "B\u00e1lint J\u00f3zsef J\u00e1nv\u00e1ri"}}, "url": "https://github.com/OpenRefine/OpenRefine/commit/3af6a59570ec5075e1f609d6a6f68f1f7ad71982", "committedDate": "2021-02-22T16:43:21Z", "message": "Update refine and refine.bat with separate host and interface arguments"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "1c900740ff0a8962592c02386b7d0a246d84cadb", "author": {"user": {"login": "dzsibi", "name": "B\u00e1lint J\u00f3zsef J\u00e1nv\u00e1ri"}}, "url": "https://github.com/OpenRefine/OpenRefine/commit/1c900740ff0a8962592c02386b7d0a246d84cadb", "committedDate": "2021-02-22T16:55:43Z", "message": "Add -h switch to usage message"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTk3NjA2OTIz", "url": "https://github.com/OpenRefine/OpenRefine/pull/3212#pullrequestreview-597606923", "createdAt": "2021-02-24T15:28:02Z", "commit": {"oid": "1c900740ff0a8962592c02386b7d0a246d84cadb"}, "state": "DISMISSED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "dec6b0f86b530f5f5aeab1858bbca2e7844ba8eb", "author": {"user": {"login": "dzsibi", "name": "B\u00e1lint J\u00f3zsef J\u00e1nv\u00e1ri"}}, "url": "https://github.com/OpenRefine/OpenRefine/commit/dec6b0f86b530f5f5aeab1858bbca2e7844ba8eb", "committedDate": "2021-02-24T23:37:29Z", "message": "Use -H instead of -h for the host argument"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTk4MjgwOTIy", "url": "https://github.com/OpenRefine/OpenRefine/pull/3212#pullrequestreview-598280922", "createdAt": "2021-02-25T07:57:13Z", "commit": {"oid": "dec6b0f86b530f5f5aeab1858bbca2e7844ba8eb"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "69f277d4b9ba31bd3a3874a1c522d25c9f51664a", "author": {"user": {"login": "dzsibi", "name": "B\u00e1lint J\u00f3zsef J\u00e1nv\u00e1ri"}}, "url": "https://github.com/OpenRefine/OpenRefine/commit/69f277d4b9ba31bd3a3874a1c522d25c9f51664a", "committedDate": "2021-03-02T09:49:11Z", "message": "Merge branch 'master' into master"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "988ea5b80311ac844d8501215f1daecb64a181a4", "author": {"user": {"login": "dzsibi", "name": "B\u00e1lint J\u00f3zsef J\u00e1nv\u00e1ri"}}, "url": "https://github.com/OpenRefine/OpenRefine/commit/988ea5b80311ac844d8501215f1daecb64a181a4", "committedDate": "2021-03-22T10:01:37Z", "message": "Merge branch 'master' of github.com:OpenRefine/OpenRefine"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "fc759597392cf9167af65f323cb9540d7fd46c99", "author": {"user": {"login": "dzsibi", "name": "B\u00e1lint J\u00f3zsef J\u00e1nv\u00e1ri"}}, "url": "https://github.com/OpenRefine/OpenRefine/commit/fc759597392cf9167af65f323cb9540d7fd46c99", "committedDate": "2021-03-22T10:12:59Z", "message": "Bring changes in line with new Jetty version"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "8553f8f9bb4f1d89afe74f811f3f1e9f7ce125c5", "author": {"user": {"login": "dzsibi", "name": "B\u00e1lint J\u00f3zsef J\u00e1nv\u00e1ri"}}, "url": "https://github.com/OpenRefine/OpenRefine/commit/8553f8f9bb4f1d89afe74f811f3f1e9f7ce125c5", "committedDate": "2021-03-22T10:14:03Z", "message": "Merge branch 'master' of github.com:dzsibi/OpenRefine"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3430, "cost": 1, "resetAt": "2021-11-01T15:33:45Z"}}}