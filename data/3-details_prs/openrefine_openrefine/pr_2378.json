{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0Mzg1NDA5NDI1", "number": 2378, "title": "Added feature to create column containing Q values", "bodyText": "Fixes #1975", "createdAt": "2020-03-09T06:31:30Z", "url": "https://github.com/OpenRefine/OpenRefine/pull/2378", "merged": true, "mergeCommit": {"oid": "e8f2a98cf03448a212b3553ebfe152b835c12628"}, "closed": true, "closedAt": "2020-03-11T09:34:50Z", "author": {"login": "madham32"}, "timelineItems": {"totalCount": 9, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcL3wRMgH2gAyMzg1NDA5NDI1OmQ1M2FmNTU2NmMyOTJhN2I3MTUwZGRmOTAwNTNhYjBiMTNiYTdjN2Y=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcMT8rngH2gAyMzg1NDA5NDI1OmVjZWZkNjg4ZjBlMGVjMjAxN2Q4ZDg1NTcwN2Q2ZjcwY2U1YTYxYmE=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "d53af5566c292a7b7150ddf90053ab0b13ba7c7f", "author": {"user": null}, "url": "https://github.com/OpenRefine/OpenRefine/commit/d53af5566c292a7b7150ddf90053ab0b13ba7c7f", "committedDate": "2020-03-09T06:16:45Z", "message": "Added feature to create column containing Q values"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzcxMDA5ODM2", "url": "https://github.com/OpenRefine/OpenRefine/pull/2378#pullrequestreview-371009836", "createdAt": "2020-03-09T09:19:11Z", "commit": {"oid": "d53af5566c292a7b7150ddf90053ab0b13ba7c7f"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c18ee6e0b79d227c005aba7d3b2703854c828825", "author": {"user": null}, "url": "https://github.com/OpenRefine/OpenRefine/commit/c18ee6e0b79d227c005aba7d3b2703854c828825", "committedDate": "2020-03-10T12:26:05Z", "message": "Defined better language for adding IDs column"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "014bba9cd7e5e7ef079fa00cf071687b3e3a375a", "author": {"user": null}, "url": "https://github.com/OpenRefine/OpenRefine/commit/014bba9cd7e5e7ef079fa00cf071687b3e3a375a", "committedDate": "2020-03-10T13:11:04Z", "message": "Fixed notations"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzcxOTM3NzA0", "url": "https://github.com/OpenRefine/OpenRefine/pull/2378#pullrequestreview-371937704", "createdAt": "2020-03-10T13:14:43Z", "commit": {"oid": "014bba9cd7e5e7ef079fa00cf071687b3e3a375a"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzcxOTkwODU2", "url": "https://github.com/OpenRefine/OpenRefine/pull/2378#pullrequestreview-371990856", "createdAt": "2020-03-10T14:15:24Z", "commit": {"oid": "014bba9cd7e5e7ef079fa00cf071687b3e3a375a"}, "state": "COMMENTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xMFQxNDoxNToyNVrOF0QtgQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xMFQxNDoxNToyOVrOF0Qtvg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MDM0NDA2NQ==", "bodyText": "Localizing text in this way makes it impossible for translators to reorder the column name to a different position in the message. I am really not blaming you since there are loads of places where we do that in the UI at the moment - I'll open an issue to clean these up.\nBecause we are introducing a new message here, let's try to get this right. We use the Wikimedia jQuery i18n plugin, which lets you define templates like this:\nhttps://github.com/wikimedia/jquery.i18n#jqueryi18n-plugin\nSo you should be able to pass column.name as an extra argument to the function and insert it with $1 in the message text.", "url": "https://github.com/OpenRefine/OpenRefine/pull/2378#discussion_r390344065", "createdAt": "2020-03-10T14:15:25Z", "author": {"login": "wetneb"}, "path": "main/webapp/modules/core/scripts/views/data-table/menu-reconcile.js", "diffHunk": "@@ -188,6 +189,49 @@ DataTableColumnHeaderUI.extendMenu(function(column, columnHeaderUI, menu) {\n     var level = DialogSystem.showDialog(frame);\n   };\n \n+  var doAddIdcolumn = function() {\n+    var frame = $(\n+      DOM.loadHTML(\"core\", \"scripts/views/data-table/add-q-column-dialog.html\"));\n+\n+    var elmts = DOM.bind(frame);\n+    elmts.dialogHeader.text($.i18n('core-views/add-id-col')+\" \" + column.name);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "014bba9cd7e5e7ef079fa00cf071687b3e3a375a"}, "originalPosition": 17}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MDM0NDEyNg==", "bodyText": "I think onError is meant to determine what to store when evaluating the expression gives an error, so I don't think you can have an expression here? According to the \"Add column\" dialog it can be one of set-to-blank, store-error or keep-original (which probably only makes sense when editing an existing column). I would intuitively go for set-to-blank here.", "url": "https://github.com/OpenRefine/OpenRefine/pull/2378#discussion_r390344126", "createdAt": "2020-03-10T14:15:29Z", "author": {"login": "wetneb"}, "path": "main/webapp/modules/core/scripts/views/data-table/menu-reconcile.js", "diffHunk": "@@ -188,6 +189,49 @@ DataTableColumnHeaderUI.extendMenu(function(column, columnHeaderUI, menu) {\n     var level = DialogSystem.showDialog(frame);\n   };\n \n+  var doAddIdcolumn = function() {\n+    var frame = $(\n+      DOM.loadHTML(\"core\", \"scripts/views/data-table/add-q-column-dialog.html\"));\n+\n+    var elmts = DOM.bind(frame);\n+    elmts.dialogHeader.text($.i18n('core-views/add-id-col')+\" \" + column.name);\n+    \n+    elmts.or_views_newCol.text($.i18n('core-views/new-col-name'));\n+    elmts.okButton.html($.i18n('core-buttons/ok'));\n+    elmts.cancelButton.text($.i18n('core-buttons/cancel'));\n+\n+    var level = DialogSystem.showDialog(frame);\n+    var dismiss = function() { DialogSystem.dismissUntil(level - 1); };\n+\n+    var o = DataTableView.sampleVisibleRows(column);\n+    \n+    elmts.cancelButton.click(dismiss);\n+    elmts.okButton.click(function() {\n+      var columnName = $.trim(elmts.columnNameInput[0].value);\n+      if (!columnName.length) {\n+        alert($.i18n('core-views/warning-col-name'));\n+        return;\n+      }\n+\n+      Refine.postCoreProcess(\n+        \"add-column\", \n+        {\n+          baseColumnName: column.name,  \n+          newColumnName: columnName, \n+          columnInsertIndex: columnIndex + 1,\n+          onError: \"cell.recon.match.id\"", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "014bba9cd7e5e7ef079fa00cf071687b3e3a375a"}, "originalPosition": 42}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "6484f085b4e60b384f4ddcd825565e40ffb88f60", "author": {"user": null}, "url": "https://github.com/OpenRefine/OpenRefine/commit/6484f085b4e60b384f4ddcd825565e40ffb88f60", "committedDate": "2020-03-10T14:49:48Z", "message": "Add id column final fix"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzcyMDM3MjQ3", "url": "https://github.com/OpenRefine/OpenRefine/pull/2378#pullrequestreview-372037247", "createdAt": "2020-03-10T15:02:13Z", "commit": {"oid": "6484f085b4e60b384f4ddcd825565e40ffb88f60"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xMFQxNTowMjoxNFrOF0S-Jw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xMFQxNTowMjoxNFrOF0S-Jw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MDM4MTA5NQ==", "bodyText": "Why use {{plural}} here? Isn't plural intended to be used for numbers? $1 represents a string, not a number here.", "url": "https://github.com/OpenRefine/OpenRefine/pull/2378#discussion_r390381095", "createdAt": "2020-03-10T15:02:14Z", "author": {"login": "wetneb"}, "path": "main/webapp/modules/core/langs/translation-en.json", "diffHunk": "@@ -518,7 +518,7 @@\n     \"core-views/word-facet\": \"Word facet\",\n     \"core-views/add-id-column\": \"Add entity identifiers column\",\n     \"core-views/add-id-column2\": \"Add a column containing entity identifiers from items\",\n-    \"core-views/add-id-col\": \"Add column containing entity identifiers on column\",\n+    \"core-views/add-id-col\": \"Add column containing entity identifiers on $1 {{plural:$1|column}}\",", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "6484f085b4e60b384f4ddcd825565e40ffb88f60"}, "originalPosition": 5}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ecefd688f0e0ec2017d8d855707d6f70ce5a61ba", "author": {"user": null}, "url": "https://github.com/OpenRefine/OpenRefine/commit/ecefd688f0e0ec2017d8d855707d6f70ce5a61ba", "committedDate": "2020-03-10T15:07:39Z", "message": "Add id column final fix"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3305, "cost": 1, "resetAt": "2021-11-01T15:33:45Z"}}}