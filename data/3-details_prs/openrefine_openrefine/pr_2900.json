{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDQ1MTI4NDM1", "number": 2900, "title": "Use standard text normalization - fixes #2898", "bodyText": "Fixes #2898. Fixes #409. Refs #650\nReplaces homegrown ISO Latin-1 only character subsitition with standard Java Normalize to NFD, followed by diacritic removal and a few custom character expansions/replacements.", "createdAt": "2020-07-07T03:43:04Z", "url": "https://github.com/OpenRefine/OpenRefine/pull/2900", "merged": true, "mergeCommit": {"oid": "0562638ffa2344a58753cad972bdc6638ffab4b3"}, "closed": true, "closedAt": "2020-07-07T19:35:42Z", "author": {"login": "tfmorris"}, "timelineItems": {"totalCount": 8, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcyddWYAH2gAyNDQ1MTI4NDM1Ojg1ZmJkNmU3YTM5NzVlNGRkMzFjZDAyODY3ZjY4NGE2ZDMzMjdhMjQ=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcyrGv1gFqTQ0NDE5MTQxNg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "85fbd6e7a3975e4dd31cd02867f684a6d3327a24", "author": {"user": {"login": "tfmorris", "name": "Tom Morris"}}, "url": "https://github.com/OpenRefine/OpenRefine/commit/85fbd6e7a3975e4dd31cd02867f684a6d3327a24", "committedDate": "2020-07-07T03:41:36Z", "message": "Use standard text normalization - fixes #2898\n\nFixes #2898. Fixes #409. Refs #650\n\nReplaces homegrown ISO Latin-1 only character subsitition\nwith standard Java Normalize to NFD, followed by diacritic\nremoval and a few custom character expansions/replacements."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "de51a9178bb775b280442c4e2300afda68391545", "author": {"user": {"login": "tfmorris", "name": "Tom Morris"}}, "url": "https://github.com/OpenRefine/OpenRefine/commit/de51a9178bb775b280442c4e2300afda68391545", "committedDate": "2020-07-07T04:03:26Z", "message": "Fix Mac build"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDQzNjI3ODE5", "url": "https://github.com/OpenRefine/OpenRefine/pull/2900#pullrequestreview-443627819", "createdAt": "2020-07-07T07:25:47Z", "commit": {"oid": "de51a9178bb775b280442c4e2300afda68391545"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wN1QwNzoyNTo0OFrOGtyOqA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wN1QwNzoyNTo0OFrOGtyOqA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MDY2MjA1Ng==", "bodyText": "Random thought: to make sure we are not missing any of these cases by expressing the conversion with your regular expression, would it make sense to just transform this deleted code into a unit test which would check that all the behaviour is preserved for all the cases listed here?", "url": "https://github.com/OpenRefine/OpenRefine/pull/2900#discussion_r450662056", "createdAt": "2020-07-07T07:25:48Z", "author": {"login": "wetneb"}, "path": "main/src/com/google/refine/clustering/binning/FingerprintKeyer.java", "diffHunk": "@@ -69,222 +96,32 @@ public String key(String s, Object... o) {\n         return b.toString();\n     }\n \n+    protected String normalize(String s) {\n+        s = stripDiacritics(s);\n+        s = stripNonDiacritics(s);\n+        return s;\n+    }\n+\n+    @Deprecated\n     protected String asciify(String s) {\n-        char[] c = s.toCharArray();\n-        StringBuffer b = new StringBuffer();\n-        for (char element : c) {\n-            b.append(translate(element));\n-        }\n-        return b.toString();\n+        return normalize(s);\n     }\n-    \n-    /**\n-     * Translate the given unicode char in the closest ASCII representation\n-     * NOTE: this function deals only with latin-1 supplement and latin-1 extended code charts\n-     */\n-    private char translate(char c) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "de51a9178bb775b280442c4e2300afda68391545"}, "originalPosition": 85}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "cc62db96adf0560a658b3ad77b142650b163c47d", "author": {"user": {"login": "tfmorris", "name": "Tom Morris"}}, "url": "https://github.com/OpenRefine/OpenRefine/commit/cc62db96adf0560a658b3ad77b142650b163c47d", "committedDate": "2020-07-07T17:12:39Z", "message": "Improve compatibility with previous code\n\nOne intentional change is folding O with stroke to\noe instead of o.\n\n- Use more powerful NFKD instead of NFD\n- strip punctuation after decomposition since it can generate\n  new punctuation\n- Add compatibility test for old asciify() method\n- Add some graphically similar characters to substitution table"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c2ff64d354615e9ef12b5bd1602b025b4ae5b8ff", "author": {"user": {"login": "tfmorris", "name": "Tom Morris"}}, "url": "https://github.com/OpenRefine/OpenRefine/commit/c2ff64d354615e9ef12b5bd1602b025b4ae5b8ff", "committedDate": "2020-07-07T18:35:26Z", "message": "Add oe character/ligature & more long S forms"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "08fa4b292be36fa6fbc46f3ac3bc0b80a89275f8", "author": {"user": {"login": "tfmorris", "name": "Tom Morris"}}, "url": "https://github.com/OpenRefine/OpenRefine/commit/08fa4b292be36fa6fbc46f3ac3bc0b80a89275f8", "committedDate": "2020-07-07T18:35:59Z", "message": "More tests for ligatures and Latin Extended"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "4ce584f35e866564689af78c5a4a497bf23e7fad", "author": {"user": {"login": "tfmorris", "name": "Tom Morris"}}, "url": "https://github.com/OpenRefine/OpenRefine/commit/4ce584f35e866564689af78c5a4a497bf23e7fad", "committedDate": "2020-07-07T19:02:01Z", "message": "Add Latin-1 Supplement tests"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDQ0MTkxNDE2", "url": "https://github.com/OpenRefine/OpenRefine/pull/2900#pullrequestreview-444191416", "createdAt": "2020-07-07T19:35:35Z", "commit": {"oid": "4ce584f35e866564689af78c5a4a497bf23e7fad"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3151, "cost": 1, "resetAt": "2021-11-01T15:33:45Z"}}}