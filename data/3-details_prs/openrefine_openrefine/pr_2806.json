{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDM5MzcwNDA1", "number": 2806, "title": "Create Project import improvements", "bodyText": "Fixes #2805. Fixes #2800. This includes three fixes / improvements:\n\nFix Content-Type handling to correctly extract the charset (which we call \"encoding\") - no issue\nImplement support for Structured Syntax Name Suffixes on media types so that we'll fall back to text/json or text/xml for mediatypes which have +json or +xml suffixes if we don't have an entry for the full type - issue #2800 / #2805\nSwitch the default fallback type from text/line-based to text so that we try the most general guessing strategy. The other will only try to guess TSV, CSV, or Fixed formats, so will never find JSON or XML files with the character frequency guesser. - no issue", "createdAt": "2020-06-24T18:09:50Z", "url": "https://github.com/OpenRefine/OpenRefine/pull/2806", "merged": true, "mergeCommit": {"oid": "4b146acc6ef8a4f41168824db0967e24d7efb45c"}, "closed": true, "closedAt": "2020-06-25T06:36:58Z", "author": {"login": "tfmorris"}, "timelineItems": {"totalCount": 5, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcudZfIgH2gAyNDM5MzcwNDA1OjlhMjdhODVkNTBhNWQ1ZmUxYzczNzc5MDRkYTk2MmQzNDBhY2Q1ZGY=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcuoqsXAFqTQzNzIwMTc4Nw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "9a27a85d50a5d5fe1c7377904da962d340acd5df", "author": {"user": {"login": "tfmorris", "name": "Tom Morris"}}, "url": "https://github.com/OpenRefine/OpenRefine/commit/9a27a85d50a5d5fe1c7377904da962d340acd5df", "committedDate": "2020-06-24T17:21:41Z", "message": "Fix charset encoding & MIME type handling\n\nCharacter set (ie what we call \"encoding\") is part of the Content-Type,\n*not* the Content-Encoding, which specifies compression (e.g. gzip).\n\nThis correctly sets the character set encoding as well as cleaning\nthe MIME type so that additional parsing doesn't need to be done\ndownstream (and removes that code)."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "9b6199b2ceb0c1ec95299541c598b23dbac2b9c2", "author": {"user": {"login": "tfmorris", "name": "Tom Morris"}}, "url": "https://github.com/OpenRefine/OpenRefine/commit/9b6199b2ceb0c1ec95299541c598b23dbac2b9c2", "committedDate": "2020-06-24T17:22:14Z", "message": "Use \"text\" instead of \"text/line-based\" as default fallback format\n\nThe TextLineBasedGuesser only tries a limited number of\nformats (CSV, TSV, fixed), so we can't get out of that hole to\nfind JSON, XML, etc.\n\nStart with a more general format instead to improve our\nguessing odds."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c8abfc3d52fc3e4d1d2c8006f1144e2e0c394e2b", "author": {"user": {"login": "tfmorris", "name": "Tom Morris"}}, "url": "https://github.com/OpenRefine/OpenRefine/commit/c8abfc3d52fc3e4d1d2c8006f1144e2e0c394e2b", "committedDate": "2020-06-24T17:44:19Z", "message": "Support content type Structured Name Syntax Suffixes (+json +xml)\n\nIf we can't find a fully specified content type in our lookup,\nfall back to just the suffix (which is registered with a leading +)\nFixes #2800 Fixes #2805"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDM2OTI4MDM4", "url": "https://github.com/OpenRefine/OpenRefine/pull/2806#pullrequestreview-436928038", "createdAt": "2020-06-24T19:06:01Z", "commit": {"oid": "c8abfc3d52fc3e4d1d2c8006f1144e2e0c394e2b"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yNFQxOTowNjowMVrOGofWAQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yNFQxOTowNjowMVrOGofWAQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NTEwOTc2MQ==", "bodyText": "Is it never useful to read the encoding from entity.getContentEncoding()? Is the getCharset() call you replaced it with always preferable (or should there be a fallback mechanism)?", "url": "https://github.com/OpenRefine/OpenRefine/pull/2806#discussion_r445109761", "createdAt": "2020-06-24T19:06:01Z", "author": {"login": "wetneb"}, "path": "main/src/com/google/refine/importing/ImportingUtilities.java", "diffHunk": "@@ -313,17 +315,20 @@ public void update(long bytesRead, long contentLength, int itemCount) {\n                                 throw new Exception(\"No content found in \" + url.toString());\n                             }\n                             InputStream stream2 = entity.getContent();\n-                            String encoding = null;\n-                            if (entity.getContentEncoding() != null) {\n-                                encoding = entity.getContentEncoding().getValue();\n-                            }\n-                            JSONUtilities.safePut(fileRecord, \"declaredEncoding\", encoding);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c8abfc3d52fc3e4d1d2c8006f1144e2e0c394e2b"}, "originalPosition": 24}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDM3MjAxNzg3", "url": "https://github.com/OpenRefine/OpenRefine/pull/2806#pullrequestreview-437201787", "createdAt": "2020-06-25T06:29:26Z", "commit": {"oid": "c8abfc3d52fc3e4d1d2c8006f1144e2e0c394e2b"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3102, "cost": 1, "resetAt": "2021-11-01T15:33:45Z"}}}