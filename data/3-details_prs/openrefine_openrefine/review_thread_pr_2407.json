{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0Mzg3OTM3Nzk2", "number": 2407, "reviewThreads": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xNFQwOToyNToxNlrODoCrtw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xNFQxNDoxMTo0NlrODoDlaw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjQzMzEzNTkxOnYy", "diffSide": "RIGHT", "path": "main/webapp/modules/core/scripts/index/parser-interfaces/xml-parser-ui.js", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xNFQwOToyNToxNlrOF2Yo-w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xNFQwOToyNToxNlrOF2Yo-w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MjU3MTEzMQ==", "bodyText": "I think it'd be cleaner if this was not a global variable, I would store it as an attribute of the importer.", "url": "https://github.com/OpenRefine/OpenRefine/pull/2407#discussion_r392571131", "createdAt": "2020-03-14T09:25:16Z", "author": {"login": "wetneb"}, "path": "main/webapp/modules/core/scripts/index/parser-interfaces/xml-parser-ui.js", "diffHunk": "@@ -31,6 +31,8 @@ OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.\n \n  */\n \n+var recordElementSelected = false;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d01309f40f63f5fb3ed8f5cef8bb98c0976b6a77"}, "originalPosition": 4}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjQzMzE0NDE2OnYy", "diffSide": "RIGHT", "path": "main/webapp/modules/core/scripts/index/parser-interfaces/xml-parser-ui.js", "isResolved": true, "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xNFQwOTo0Mzo0OFrOF2YtIg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xNFQwOTo0NzozM1rOF2Yt_g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MjU3MjE5NA==", "bodyText": "Oh, and that's clearly something we want to localize using i18n. And perhaps avoid the exclamation mark in the message.", "url": "https://github.com/OpenRefine/OpenRefine/pull/2407#discussion_r392572194", "createdAt": "2020-03-14T09:43:48Z", "author": {"login": "wetneb"}, "path": "main/webapp/modules/core/scripts/index/parser-interfaces/xml-parser-ui.js", "diffHunk": "@@ -257,6 +260,11 @@ Refine.XmlParserUI.prototype._setRecordPath = function(path) {\n \n Refine.XmlParserUI.prototype._updatePreview = function() {\n   var self = this;\n+  \n+  if(!self._recordElementSelected) {\n+    alert(\"No record element selected! Please select one first.\");", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "45a4d1a2fc9fcd8d953e4ba8985f31478d995ab9"}, "originalPosition": 30}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MjU3MjM2Nw==", "bodyText": "Hang on, we already have this message: core-index-import/warning-record-path.", "url": "https://github.com/OpenRefine/OpenRefine/pull/2407#discussion_r392572367", "createdAt": "2020-03-14T09:46:37Z", "author": {"login": "wetneb"}, "path": "main/webapp/modules/core/scripts/index/parser-interfaces/xml-parser-ui.js", "diffHunk": "@@ -257,6 +260,11 @@ Refine.XmlParserUI.prototype._setRecordPath = function(path) {\n \n Refine.XmlParserUI.prototype._updatePreview = function() {\n   var self = this;\n+  \n+  if(!self._recordElementSelected) {\n+    alert(\"No record element selected! Please select one first.\");", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MjU3MjE5NA=="}, "originalCommit": {"oid": "45a4d1a2fc9fcd8d953e4ba8985f31478d995ab9"}, "originalPosition": 30}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MjU3MjQxNA==", "bodyText": "This seems to duplicate the error message above.", "url": "https://github.com/OpenRefine/OpenRefine/pull/2407#discussion_r392572414", "createdAt": "2020-03-14T09:47:33Z", "author": {"login": "wetneb"}, "path": "main/webapp/modules/core/scripts/index/parser-interfaces/xml-parser-ui.js", "diffHunk": "@@ -257,6 +260,11 @@ Refine.XmlParserUI.prototype._setRecordPath = function(path) {\n \n Refine.XmlParserUI.prototype._updatePreview = function() {\n   var self = this;\n+  \n+  if(!self._recordElementSelected) {\n+    alert(\"No record element selected! Please select one first.\");", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MjU3MjE5NA=="}, "originalCommit": {"oid": "45a4d1a2fc9fcd8d953e4ba8985f31478d995ab9"}, "originalPosition": 30}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjQzMzE2NTIzOnYy", "diffSide": "RIGHT", "path": "main/webapp/modules/core/scripts/index/parser-interfaces/xml-parser-ui.js", "isResolved": true, "comments": {"totalCount": 6, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xNFQxMDozMDo1NlrOF2Y3qg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xNFQxMzoxNzozOVrOF2Zp6Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MjU3NDg5MA==", "bodyText": "It's still not clear to me why we have to duplicate the existing check, where the same message is used?", "url": "https://github.com/OpenRefine/OpenRefine/pull/2407#discussion_r392574890", "createdAt": "2020-03-14T10:30:56Z", "author": {"login": "wetneb"}, "path": "main/webapp/modules/core/scripts/index/parser-interfaces/xml-parser-ui.js", "diffHunk": "@@ -262,7 +262,7 @@ Refine.XmlParserUI.prototype._updatePreview = function() {\n   var self = this;\n   \n   if(!self._recordElementSelected) {\n-    alert(\"No record element selected! Please select one first.\");\n+    window.alert($.i18n('core-index-import/warning-record-path'));", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "47f9968af4e7b314e7715493aa9d8526301ca20e"}, "originalPosition": 5}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MjU3NTI4MQ==", "bodyText": "The existing check works only when the user clicks the Create Project button. The Update Preview gets stuck if the user does not select one and clicks on any other configuration option. Once that happens, the user cannot do anything (and this happens before Create Project), there isn't any check for this right now. Maybe we can remove the one in Create Project because the check in Update Preview will make sure that a Record Element is always selected?", "url": "https://github.com/OpenRefine/OpenRefine/pull/2407#discussion_r392575281", "createdAt": "2020-03-14T10:37:56Z", "author": {"login": "lisa761"}, "path": "main/webapp/modules/core/scripts/index/parser-interfaces/xml-parser-ui.js", "diffHunk": "@@ -262,7 +262,7 @@ Refine.XmlParserUI.prototype._updatePreview = function() {\n   var self = this;\n   \n   if(!self._recordElementSelected) {\n-    alert(\"No record element selected! Please select one first.\");\n+    window.alert($.i18n('core-index-import/warning-record-path'));", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MjU3NDg5MA=="}, "originalCommit": {"oid": "47f9968af4e7b314e7715493aa9d8526301ca20e"}, "originalPosition": 5}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MjU3NTk2NQ==", "bodyText": "I think this happens because once _updatePreview calls ._getOptions, the recordPath is set to a defualt value (because it is 0 currently), which in this case is an empty array. Once the flow of control reaches XMLImportUtilities, an error ArrayIndexOutOfBoundsException is generated in findRecord method because recordPath is empty and we cannot access its 0th index.", "url": "https://github.com/OpenRefine/OpenRefine/pull/2407#discussion_r392575965", "createdAt": "2020-03-14T10:50:29Z", "author": {"login": "lisa761"}, "path": "main/webapp/modules/core/scripts/index/parser-interfaces/xml-parser-ui.js", "diffHunk": "@@ -262,7 +262,7 @@ Refine.XmlParserUI.prototype._updatePreview = function() {\n   var self = this;\n   \n   if(!self._recordElementSelected) {\n-    alert(\"No record element selected! Please select one first.\");\n+    window.alert($.i18n('core-index-import/warning-record-path'));", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MjU3NDg5MA=="}, "originalCommit": {"oid": "47f9968af4e7b314e7715493aa9d8526301ca20e"}, "originalPosition": 5}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MjU3NzUzMQ==", "bodyText": "It looks like we could potentially remove the boolean you introduce and do the same check as for the other window.alert, no?", "url": "https://github.com/OpenRefine/OpenRefine/pull/2407#discussion_r392577531", "createdAt": "2020-03-14T11:17:05Z", "author": {"login": "wetneb"}, "path": "main/webapp/modules/core/scripts/index/parser-interfaces/xml-parser-ui.js", "diffHunk": "@@ -262,7 +262,7 @@ Refine.XmlParserUI.prototype._updatePreview = function() {\n   var self = this;\n   \n   if(!self._recordElementSelected) {\n-    alert(\"No record element selected! Please select one first.\");\n+    window.alert($.i18n('core-index-import/warning-record-path'));", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MjU3NDg5MA=="}, "originalCommit": {"oid": "47f9968af4e7b314e7715493aa9d8526301ca20e"}, "originalPosition": 5}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MjU4NzA0MA==", "bodyText": "Yes okay, I wll do that then. Should I also remove the check from confirmCreateProject then?", "url": "https://github.com/OpenRefine/OpenRefine/pull/2407#discussion_r392587040", "createdAt": "2020-03-14T13:04:54Z", "author": {"login": "lisa761"}, "path": "main/webapp/modules/core/scripts/index/parser-interfaces/xml-parser-ui.js", "diffHunk": "@@ -262,7 +262,7 @@ Refine.XmlParserUI.prototype._updatePreview = function() {\n   var self = this;\n   \n   if(!self._recordElementSelected) {\n-    alert(\"No record element selected! Please select one first.\");\n+    window.alert($.i18n('core-index-import/warning-record-path'));", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MjU3NDg5MA=="}, "originalCommit": {"oid": "47f9968af4e7b314e7715493aa9d8526301ca20e"}, "originalPosition": 5}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MjU4Nzc1Mw==", "bodyText": "If that is redundant, sure.", "url": "https://github.com/OpenRefine/OpenRefine/pull/2407#discussion_r392587753", "createdAt": "2020-03-14T13:17:39Z", "author": {"login": "wetneb"}, "path": "main/webapp/modules/core/scripts/index/parser-interfaces/xml-parser-ui.js", "diffHunk": "@@ -262,7 +262,7 @@ Refine.XmlParserUI.prototype._updatePreview = function() {\n   var self = this;\n   \n   if(!self._recordElementSelected) {\n-    alert(\"No record element selected! Please select one first.\");\n+    window.alert($.i18n('core-index-import/warning-record-path'));", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MjU3NDg5MA=="}, "originalCommit": {"oid": "47f9968af4e7b314e7715493aa9d8526301ca20e"}, "originalPosition": 5}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjQzMzI4MzYzOnYy", "diffSide": "RIGHT", "path": "main/webapp/modules/core/scripts/index/parser-interfaces/xml-parser-ui.js", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xNFQxNDoxMTo0NlrOF2Z3uA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xNFQxNDoxMTo0NlrOF2Z3uA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MjU5MTI4OA==", "bodyText": "I did this because if I did setRecordPath, the flow reaches updatePreview first and then the same thing happened. Also I let the check in confirmCreateProject be beacuse that would be required when someone directly clicks that button.", "url": "https://github.com/OpenRefine/OpenRefine/pull/2407#discussion_r392591288", "createdAt": "2020-03-14T14:11:46Z", "author": {"login": "lisa761"}, "path": "main/webapp/modules/core/scripts/index/parser-interfaces/xml-parser-ui.js", "diffHunk": "@@ -131,6 +131,7 @@ Refine.XmlParserUI.prototype._initialize = function() {\n     this._optionContainerElmts.includeFileSourcesCheckbox.prop(\"checked\", true);\n   }\n   this._optionContainerElmts.pickRecordElementsButton.click(function() {\n+    self._config.recordPath = undefined;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "18277ef4e692257b4c3eb0b126540853350fe815"}, "originalPosition": 4}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2790, "cost": 1, "resetAt": "2021-11-13T12:10:21Z"}}}