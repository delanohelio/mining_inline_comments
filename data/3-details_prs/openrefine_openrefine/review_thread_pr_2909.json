{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDQ2NDUwMjA5", "number": 2909, "reviewThreads": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wOVQwNjoxMzozMVrOEMwUog==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wOVQwNjoxMzozMVrOEMwUog==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjgxODEwMDgyOnYy", "diffSide": "RIGHT", "path": "main/src/com/google/refine/expr/functions/ToDate.java", "isResolved": false, "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wOVQwNjoxMzozMVrOGvDBkA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wOVQxOTozOToxN1rOGvfK0w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MTk4NTgwOA==", "bodyText": "Should these things live in this class? This is the class for the GREL function, these methods look more like utility methods used throughout the code, so I would put them in a utility class.", "url": "https://github.com/OpenRefine/OpenRefine/pull/2909#discussion_r451985808", "createdAt": "2020-07-09T06:13:31Z", "author": {"login": "wetneb"}, "path": "main/src/com/google/refine/expr/functions/ToDate.java", "diffHunk": "@@ -202,4 +203,16 @@ public String getParams() {\n     public String getReturns() {\n         return \"date\";\n     }\n+\n+    public static boolean isDate(Object o) {\n+        return o instanceof OffsetDateTime;\n+    }\n+\n+    public static OffsetDateTime toDate(Date date) {\n+        return date.toInstant().atOffset(ZoneOffset.UTC);\n+    }\n+\n+    public static OffsetDateTime toDate(Calendar date) {\n+        return date.toInstant().atOffset(ZoneOffset.UTC);\n+    }", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "872fd60cc7c85e63dc210774364548feda555c0a"}, "originalPosition": 23}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MjQxNTU5Mg==", "bodyText": "The \"right\" way to do this would probably be to have an OpenRefine Date class which encapsulates all the date handling and then the GREL ToDate could call com.google.refine...Date.parse() but the date handling is such a mess I didn't want to risk a big refactor when my goal was to get this fixed for 3.4 once I learned you were still considering adding stuff to the release.\nThe point of putting the methods here was to keep them co-located with at least some of the date handling code, so people couldn't easily change one without the other. The other date handling utility methods are in ParsingUtilities which isn't a great fit either.\nI can create a separate tiny DateUtility class to hold these for the time being.", "url": "https://github.com/OpenRefine/OpenRefine/pull/2909#discussion_r452415592", "createdAt": "2020-07-09T18:38:18Z", "author": {"login": "tfmorris"}, "path": "main/src/com/google/refine/expr/functions/ToDate.java", "diffHunk": "@@ -202,4 +203,16 @@ public String getParams() {\n     public String getReturns() {\n         return \"date\";\n     }\n+\n+    public static boolean isDate(Object o) {\n+        return o instanceof OffsetDateTime;\n+    }\n+\n+    public static OffsetDateTime toDate(Date date) {\n+        return date.toInstant().atOffset(ZoneOffset.UTC);\n+    }\n+\n+    public static OffsetDateTime toDate(Calendar date) {\n+        return date.toInstant().atOffset(ZoneOffset.UTC);\n+    }", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MTk4NTgwOA=="}, "originalCommit": {"oid": "872fd60cc7c85e63dc210774364548feda555c0a"}, "originalPosition": 23}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MjQ0NjkzMQ==", "bodyText": "I decided having them colocated with the rest of the date handling was more important than the inappropriate name, so moved the to ParsingUtilities. Investigating the build failures now.", "url": "https://github.com/OpenRefine/OpenRefine/pull/2909#discussion_r452446931", "createdAt": "2020-07-09T19:39:17Z", "author": {"login": "tfmorris"}, "path": "main/src/com/google/refine/expr/functions/ToDate.java", "diffHunk": "@@ -202,4 +203,16 @@ public String getParams() {\n     public String getReturns() {\n         return \"date\";\n     }\n+\n+    public static boolean isDate(Object o) {\n+        return o instanceof OffsetDateTime;\n+    }\n+\n+    public static OffsetDateTime toDate(Date date) {\n+        return date.toInstant().atOffset(ZoneOffset.UTC);\n+    }\n+\n+    public static OffsetDateTime toDate(Calendar date) {\n+        return date.toInstant().atOffset(ZoneOffset.UTC);\n+    }", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MTk4NTgwOA=="}, "originalCommit": {"oid": "872fd60cc7c85e63dc210774364548feda555c0a"}, "originalPosition": 23}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2672, "cost": 1, "resetAt": "2021-11-13T12:10:21Z"}}}