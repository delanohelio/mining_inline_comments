{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0MzkyMDQwNzU3", "number": 2458, "title": "Added google sheet feature and moved features to the export drop-down", "bodyText": "Signed-off-by: Agha Saad Fraz agha.saad04@gmail.com\nFIX #2453\nI have added the feature of exporting the OpenRefine project to google sheets, and have moved the export features out of dialogs and placed into the export menu.", "createdAt": "2020-03-22T17:20:53Z", "url": "https://github.com/OpenRefine/OpenRefine/pull/2458", "merged": true, "mergeCommit": {"oid": "cff88e6267b1d636fd00ba076598af6c658a9b2b"}, "closed": true, "closedAt": "2020-03-23T10:14:03Z", "author": {"login": "AghaSaad04"}, "timelineItems": {"totalCount": 8, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcM6P_aAH2gAyMzkyMDQwNzU3OjlhZjQyOWI2ZTBjMjFmNzVjMjhiNjRkZjQ2M2IxNTg4YTU0YmZjNzA=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcQZr6uAFqTM3OTE5OTExOQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "9af429b6e0c21f75c28b64df463b1588a54bfc70", "author": {"user": {"login": "AghaSaad04", "name": "Agha Saad Fraz"}}, "url": "https://github.com/OpenRefine/OpenRefine/commit/9af429b6e0c21f75c28b64df463b1588a54bfc70", "committedDate": "2020-03-12T11:45:08Z", "message": "fixed minor typos"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "69ff6cdd8e5b014f6c97ea4e460e489335f3dec0", "author": {"user": {"login": "AghaSaad04", "name": "Agha Saad Fraz"}}, "url": "https://github.com/OpenRefine/OpenRefine/commit/69ff6cdd8e5b014f6c97ea4e460e489335f3dec0", "committedDate": "2020-03-22T14:12:11Z", "message": "Added google sheet feature and moved features to the export drop-down menu"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "6fcb552e04dc362a2fa80e948ab38244d3413412", "author": {"user": {"login": "AghaSaad04", "name": "Agha Saad Fraz"}}, "url": "https://github.com/OpenRefine/OpenRefine/commit/6fcb552e04dc362a2fa80e948ab38244d3413412", "committedDate": "2020-03-22T14:58:39Z", "message": "Merge branch 'master' of https://github.com/OpenRefine/OpenRefine"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c3b0ff3f0012e4be1caf743c7cd333ed7d0cd9b5", "author": {"user": {"login": "AghaSaad04", "name": "Agha Saad Fraz"}}, "url": "https://github.com/OpenRefine/OpenRefine/commit/c3b0ff3f0012e4be1caf743c7cd333ed7d0cd9b5", "committedDate": "2020-03-22T15:31:49Z", "message": "added google sheet feature and moved export features to export menu"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "136d4b68292bb57c8f6fca8df42d72075cc7bb3f", "author": {"user": {"login": "AghaSaad04", "name": "Agha Saad Fraz"}}, "url": "https://github.com/OpenRefine/OpenRefine/commit/136d4b68292bb57c8f6fca8df42d72075cc7bb3f", "committedDate": "2020-03-22T17:06:17Z", "message": "minor change"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzc5MDI5NjE1", "url": "https://github.com/OpenRefine/OpenRefine/pull/2458#pullrequestreview-379029615", "createdAt": "2020-03-22T17:42:53Z", "commit": {"oid": "136d4b68292bb57c8f6fca8df42d72075cc7bb3f"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yMlQxNzo0Mjo1M1rOF5xTgA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yMlQxNzo0ODo0MlrOF5xVyQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NjEyMDk2MA==", "bodyText": "Is it really worth adding \"file\" at the end of all these labels? For instance, \"ODF spreadsheet file\" sounds quite redundant for me. I would keep these labels as they were.", "url": "https://github.com/OpenRefine/OpenRefine/pull/2458#discussion_r396120960", "createdAt": "2020-03-22T17:42:53Z", "author": {"login": "wetneb"}, "path": "main/webapp/modules/core/langs/translation-en.json", "diffHunk": "@@ -343,12 +344,12 @@\n     \"core-project/remove-all\": \"Remove all facets\",\n     \"core-project/export-project\": \"Export project\",\n     \"core-project/project-data-package\": \"Project data package\",\n-    \"core-project/tab-value\": \"Tab-separated value\",\n-    \"core-project/comma-sep\": \"Comma-separated value\",\n-    \"core-project/html-table\": \"HTML table\",\n-    \"core-project/excel\": \"Excel (.xls)\",\n-    \"core-project/excel-xml\": \"Excel 2007+ (.xlsx)\",\n-    \"core-project/odf\": \"ODF spreadsheet\",\n+    \"core-project/tab-value\": \"Tab-separated value file\",\n+    \"core-project/comma-sep\": \"Comma-separated value file\",\n+    \"core-project/html-table\": \"HTML table file\",\n+    \"core-project/excel\": \"Excel (.xls) file\",\n+    \"core-project/excel-xml\": \"Excel 2007+ (.xlsx) file\",\n+    \"core-project/odf\": \"ODF spreadsheet file\",", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "136d4b68292bb57c8f6fca8df42d72075cc7bb3f"}, "originalPosition": 27}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NjEyMTEwMw==", "bodyText": "Menu items related to Google services should be added in the gdata extension. It is possible to add menu items to common menus in extensions (see for instance how it is done in the Wikidata extension).", "url": "https://github.com/OpenRefine/OpenRefine/pull/2458#discussion_r396121103", "createdAt": "2020-03-22T17:44:19Z", "author": {"login": "wetneb"}, "path": "main/webapp/modules/core/scripts/project/exporters.js", "diffHunk": "@@ -150,90 +160,95 @@ ExporterManager.prepareExportRowsForm = function(format, includeEngine, ext) {\n     .attr(\"value\", JSON.stringify(ui.browsingEngine.getJSON()))\n     .appendTo(form);\n   }\n-  \n+\n   return form;\n };\n \n-ExporterManager.handlers.exportProject = function() {\n+ExporterManager.handlers.exportProjectToLocal = function() {\n   var name = ExporterManager.stripNonFileChars(theProject.metadata.name);\n-  // dialog\n-  var dialog = $(DOM.loadHTML(\"core\", \"scripts/dialogs/export-project-dialog.html\"));\n-  var _elmts = DOM.bind(dialog);\n-  \n-  _elmts.dialogHeader.html($.i18n('core-dialogs/choose-export-destination'));\n-  _elmts.toLocalRadio.html($.i18n('core-dialogs/export-to-local'));\n-  _elmts.toGoogleDriveRadio.html($.i18n('core-dialogs/export-to-google-drive'));\n-  _elmts.exportButton.html($.i18n('core-buttons/export'));\n-  _elmts.cancelButton.html($.i18n('core-buttons/cancel'));\n-  \n-  _elmts.exportButton.click(function() { \n-      if ($(\"input[name='export-destination']\")[0].checked) {\n-          exportToLocal(name);\n-      } else {\n-          exportToGoogleDrive(name);\n-      }\n-      \n-      DialogSystem.dismissAll(); \n-  });\n-  \n-  _elmts.cancelButton.click(function() { DialogSystem.dismissAll(); });\n-  \n-  DialogSystem.showDialog(dialog);\n-  \n-  // save to google drive\n-  var doExportToGoogleDrive = function() {\n-      var name = window.prompt($.i18n('gdata-exporter/enter-filename'), theProject.metadata.name);\n-      if (name) {\n-        var dismiss = DialogSystem.showBusy($.i18n('gdata-exporter/uploading'));\n-        Refine.postCSRF(\n-          \"command/gdata/upload\",\n-          {\n-            \"project\" : theProject.id,\n-            \"name\" : name,\n-            \"format\" : \"raw/openrefine-project\"\n-          },\n-          function(o) {\n-            dismiss();\n-\n-            if (o.url) {\n-                alert($.i18n('gdata-exporter/upload-success'));\n-            } else {\n-                alert($.i18n('gdata-exporter/upload-error') + o.message)\n-            }\n-            onDone();\n-          },\n-          \"json\"\n-        );\n-      }\n-    };\n-\n-  function exportToGoogleDrive(name) {\n-    if (GdataExtension.isAuthorized()) {\n-        doExportToGoogleDrive();\n-    } else {\n-        GdataExtension.showAuthorizationDialog(doExportToGoogleDrive);\n+  var form = document.createElement(\"form\");\n+  $(form)\n+  .css(\"display\", \"none\")\n+  .attr(\"method\", \"post\")\n+  .attr(\"action\", \"command/core/export-project/\" + name + \".openrefine.tar.gz\")\n+  .attr(\"target\", \"refine-export\");\n+  $('<input />')\n+  .attr(\"name\", \"project\")\n+  .attr(\"value\", theProject.id)\n+  .appendTo(form);\n+\n+  document.body.appendChild(form);\n+\n+  window.open(\" \", \"refine-export\");\n+  form.submit();\n+\n+  document.body.removeChild(form);\n+};\n+\n+ExporterManager.handlers.exportProjectToGoogleDrive = function () {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "136d4b68292bb57c8f6fca8df42d72075cc7bb3f"}, "originalPosition": 132}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NjEyMTIyNQ==", "bodyText": "The Google Sheets option should be in the second section and should not be named \"OpenRefine project archive to Google Sheets\", since it does not export the project archive, it just exports the current state of the table like the other exporters. I think we could just use \"Google Sheets\" as label for that item.\nAlso these translations should be in the gdata extension (since the menu items should be added in the gdata extension, see below).", "url": "https://github.com/OpenRefine/OpenRefine/pull/2458#discussion_r396121225", "createdAt": "2020-03-22T17:45:33Z", "author": {"login": "wetneb"}, "path": "main/webapp/modules/core/langs/translation-en.json", "diffHunk": "@@ -284,8 +284,9 @@\n     \"core-dialogs/for-include-if-exist-drop-stmt-checkbox\": \"Include 'IF EXISTS' in DROP statement\",\n     \"core-dialogs/for-null-cell-value-to-empty-str-label\": \"Convert null value to NULL in INSERT\",\n     \"core-dialogs/choose-export-destination\": \"Please choose the destination for project export\",\n-    \"core-dialogs/export-to-local\": \"Export to local\",\n-    \"core-dialogs/export-to-google-drive\": \"Export to Google Drive\",\n+    \"core-dialogs/export-to-local\": \"OpenRefine project archive to file\",\n+    \"core-dialogs/export-to-google-drive\": \"OpenRefine project archive to Google Drive...\",\n+    \"core-dialogs/export-to-google-sheets\": \"OpenRefine project archive to Google Sheets...\",", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "136d4b68292bb57c8f6fca8df42d72075cc7bb3f"}, "originalPosition": 8}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NjEyMTU0NQ==", "bodyText": "This label is also used in the Wikidata extension menu, and in that context we do need to keep \"Export\" in the label because the menu contains all sorts of actions, not just export ones. So I would keep this existing string and add a new one without \"export\" (and without adding \"to file\" either, see below).", "url": "https://github.com/OpenRefine/OpenRefine/pull/2458#discussion_r396121545", "createdAt": "2020-03-22T17:48:42Z", "author": {"login": "wetneb"}, "path": "extensions/wikidata/module/langs/translation-en.json", "diffHunk": "@@ -3,10 +3,10 @@\n     \"wikidata-extension/edit-wikidata-schema\": \"Edit Wikidata schema\",\n     \"wikidata-extension/import-wikidata-schema\": \"Import schema\",\n     \"wikidata-extension/manage-wikidata-account\": \"Manage Wikidata account\",\n-    \"wikidata-extension/perform-edits-on-wikidata\": \"Upload edits to Wikidata\",\n-    \"wikidata-extension/export-to-qs\": \"Export to QuickStatements\",\n+    \"wikidata-extension/perform-edits-on-wikidata\": \"Wikidata edits...\",\n+    \"wikidata-extension/export-to-qs\": \"QuickStatements file...\",\n     \"wikidata-extension/export-schema\": \"Export schema\",\n-    \"wikidata-extension/export-wikidata-schema\": \"Export Wikidata schema\",\n+    \"wikidata-extension/export-wikidata-schema\": \"Wikidata schema to file\",", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "136d4b68292bb57c8f6fca8df42d72075cc7bb3f"}, "originalPosition": 10}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ee45260536e5930e6c33096f0e5c9d63eadf1bf1", "author": {"user": {"login": "AghaSaad04", "name": "Agha Saad Fraz"}}, "url": "https://github.com/OpenRefine/OpenRefine/commit/ee45260536e5930e6c33096f0e5c9d63eadf1bf1", "committedDate": "2020-03-22T21:59:56Z", "message": "removed redundant text and moved code and translations into their respective extensions"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzc5MTk5MTE5", "url": "https://github.com/OpenRefine/OpenRefine/pull/2458#pullrequestreview-379199119", "createdAt": "2020-03-23T08:04:28Z", "commit": {"oid": "ee45260536e5930e6c33096f0e5c9d63eadf1bf1"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3339, "cost": 1, "resetAt": "2021-11-01T15:33:45Z"}}}