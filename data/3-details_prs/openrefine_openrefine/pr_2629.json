{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDIwODU2MTg5", "number": 2629, "title": "Add Multi-value Scrutinizer", "bodyText": "Implemented Multi-value constraints as part of #2354", "createdAt": "2020-05-20T16:16:09Z", "url": "https://github.com/OpenRefine/OpenRefine/pull/2629", "merged": true, "mergeCommit": {"oid": "29a757dc57d0cc4b246eac004f9edf2729a26881"}, "closed": true, "closedAt": "2020-05-31T13:24:51Z", "author": {"login": "darecoder"}, "timelineItems": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcmWYCJAFqTQyMTQwMjAxNg==", "endCursor": "Y3Vyc29yOnYyOpPPAAABcmrng-gFqTQyMTQ5NDQxMA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDIxNDAyMDE2", "url": "https://github.com/OpenRefine/OpenRefine/pull/2629#pullrequestreview-421402016", "createdAt": "2020-05-30T12:34:01Z", "commit": {"oid": "1439e41328f731409764e09bcd7f1dedd1bb4bd3"}, "state": "COMMENTED", "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0zMFQxMjozNDowMVrOGcyVbg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0zMFQxMjozOToxNFrOGcyWwQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMjgzNzk5OA==", "bodyText": "\"one statements\" -> \"one statement\". Also, it could be good to change the title to something like {property_entity} should have more than one statement on new items to make it clear what the difference is with the second issue. (This is mostly useful if both issues get reported at the same time).\nThe same applies to the other issue title.", "url": "https://github.com/OpenRefine/OpenRefine/pull/2629#discussion_r432837998", "createdAt": "2020-05-30T12:34:01Z", "author": {"login": "wetneb"}, "path": "extensions/wikidata/module/langs/translation-en.json", "diffHunk": "@@ -126,6 +126,10 @@\n     \"warnings-messages/no-edit-generated/body\": \"There might be something wrong with your schema.\",\n     \"warnings-messages/no-issue-detected/title\": \"No issue was detected in your edits.\",\n     \"warnings-messages/no-issue-detected/body\": \"Note that OpenRefine cannot detect all the types of problems Wikidata edits can have.\",\n+    \"warnings-messages/multi-valued-property-is-required-for-new-item/title\": \"{property_entity} should have more than one statements.\",", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "1439e41328f731409764e09bcd7f1dedd1bb4bd3"}, "originalPosition": 4}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMjgzODI5OA==", "bodyText": "In the second sentence, capital letter for \"Wikidata\". I would also rephrase the sentence to something like If the item already has statements with this property in Wikidata, then this warning can be ignored.", "url": "https://github.com/OpenRefine/OpenRefine/pull/2629#discussion_r432838298", "createdAt": "2020-05-30T12:38:38Z", "author": {"login": "wetneb"}, "path": "extensions/wikidata/module/langs/translation-en.json", "diffHunk": "@@ -126,6 +126,10 @@\n     \"warnings-messages/no-edit-generated/body\": \"There might be something wrong with your schema.\",\n     \"warnings-messages/no-issue-detected/title\": \"No issue was detected in your edits.\",\n     \"warnings-messages/no-issue-detected/body\": \"Note that OpenRefine cannot detect all the types of problems Wikidata edits can have.\",\n+    \"warnings-messages/multi-valued-property-is-required-for-new-item/title\": \"{property_entity} should have more than one statements.\",\n+    \"warnings-messages/multi-valued-property-is-required-for-new-item/body\": \"This property is expected to have more than one statement on each item but it has single statement, for instance on {example_entity}.\",\n+    \"warnings-messages/multi-valued-property-is-required-for-existing-item/title\": \"{property_entity} should have more than one statements.\",\n+    \"warnings-messages/multi-valued-property-is-required-for-existing-item/body\": \"This property is expected to have more than one statement on each item but it has single statement, for instance on {example_entity}. It could be a false warning that would be removed once the item is uploaded to wikidata as it might have additional values over there already.\",", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "1439e41328f731409764e09bcd7f1dedd1bb4bd3"}, "originalPosition": 7}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMjgzODMzNw==", "bodyText": "Should we use a lower severity level for warnings on existing items?", "url": "https://github.com/OpenRefine/OpenRefine/pull/2629#discussion_r432838337", "createdAt": "2020-05-30T12:39:14Z", "author": {"login": "wetneb"}, "path": "extensions/wikidata/src/org/openrefine/wikidata/qa/scrutinizers/MultiValueScrutinizer.java", "diffHunk": "@@ -0,0 +1,50 @@\n+package org.openrefine.wikidata.qa.scrutinizers;\n+\n+import org.openrefine.wikidata.qa.QAWarning;\n+import org.openrefine.wikidata.updates.ItemUpdate;\n+import org.wikidata.wdtk.datamodel.interfaces.PropertyIdValue;\n+import org.wikidata.wdtk.datamodel.interfaces.Statement;\n+\n+import java.util.HashMap;\n+import java.util.Map;\n+\n+public class MultiValueScrutinizer extends EditScrutinizer {\n+\n+    public static final String new_type = \"multi-valued-property-is-required-for-new-item\";\n+    public static final String existing_type = \"multi-valued-property-is-required-for-existing-item\";\n+\n+    @Override\n+    public void scrutinize(ItemUpdate update) {\n+        Map<PropertyIdValue, Integer> propertyCount = new HashMap<>();\n+\n+        for (Statement statement : update.getAddedStatements()) {\n+            PropertyIdValue pid = statement.getClaim().getMainSnak().getPropertyId();\n+            if (propertyCount.containsKey(pid)) {\n+                propertyCount.put(pid, propertyCount.get(pid) + 1);\n+            } else if (_fetcher.hasMultiValue(pid)) {\n+                propertyCount.put(pid, 1);\n+            }\n+        }\n+\n+        if (update.isNew()) {\n+            for (PropertyIdValue pid : propertyCount.keySet()) {\n+                if (propertyCount.get(pid) == 1) {\n+                    QAWarning issue = new QAWarning(new_type, pid.getId(), QAWarning.Severity.WARNING, 1);\n+                    issue.setProperty(\"property_entity\", pid);\n+                    issue.setProperty(\"example_entity\", update.getItemId());\n+                    addIssue(issue);\n+                }\n+            }\n+        } else {\n+            for (PropertyIdValue pid : propertyCount.keySet()) {\n+                if (propertyCount.get(pid) == 1) {\n+                    QAWarning issue = new QAWarning(existing_type, pid.getId(), QAWarning.Severity.WARNING, 1);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "1439e41328f731409764e09bcd7f1dedd1bb4bd3"}, "originalPosition": 41}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "9396996a3f04af4110ce089b09d4abe8704f3e6e", "author": {"user": {"login": "darecoder", "name": "Ekta Mishra"}}, "url": "https://github.com/OpenRefine/OpenRefine/commit/9396996a3f04af4110ce089b09d4abe8704f3e6e", "committedDate": "2020-05-30T17:47:12Z", "message": "Added Multi-value Constraint"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDIxNDk0NDEw", "url": "https://github.com/OpenRefine/OpenRefine/pull/2629#pullrequestreview-421494410", "createdAt": "2020-05-31T13:24:17Z", "commit": {"oid": "9396996a3f04af4110ce089b09d4abe8704f3e6e"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3256, "cost": 1, "resetAt": "2021-11-01T15:33:45Z"}}}