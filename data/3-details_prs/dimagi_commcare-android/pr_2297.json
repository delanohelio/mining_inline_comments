{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDU3Mzc2MDkw", "number": 2297, "title": "Don't crash when no form is found in storage while XForm Uninstall", "bodyText": "Fix for -\nCaused by java.util.NoSuchElementException: No record in table form_def for ID 41\n       at org.commcare.models.database.SqlStorage.readBytes(SqlStorage.java:458)\n       at org.commcare.models.database.SqlStorage.read(SqlStorage.java:449)\n       at org.commcare.android.resource.installers.XFormAndroidInstaller.uninstall(XFormAndroidInstaller.java:129)\n       at org.commcare.android.resource.installers.XFormAndroidInstaller.uninstall(XFormAndroidInstaller.java:52)\n       at org.commcare.resources.model.ResourceTable.uninstallResourcesForStatus(ResourceTable.java:877)\n       at org.commcare.resources.model.ResourceTable.clearUpgrade(ResourceTable.java:852)\n\nCL link\nI have not been able to reproduce it but I think it's ok behaviour for us to not crash the App when the form id of a form we are uninstalling is not found in the storage as we were going to remove that form id anyway.", "createdAt": "2020-07-27T20:08:53Z", "url": "https://github.com/dimagi/commcare-android/pull/2297", "merged": true, "mergeCommit": {"oid": "5e779d2be56a766016174bb2a81dcef0b18fbddf"}, "closed": true, "closedAt": "2020-07-30T07:03:31Z", "author": {"login": "shubham1g5"}, "timelineItems": {"totalCount": 5, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABc5HWwAgH2gAyNDU3Mzc2MDkwOjZhMjA1ZjFlN2UwZTk3NzQ5YjU5NzBkYzYyYjJiNzdkYmE0MDBlOTY=", "endCursor": "Y3Vyc29yOnYyOpPPAAABc56IWngH2gAyNDU3Mzc2MDkwOjQ2MWE5NjQ3M2NlYjgxYTllNTA0MzZhNTgwNmZmNTFhMjA1OWVhZmI=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "6a205f1e7e0e97749b5970dc62b2b77dba400e96", "author": {"user": {"login": "shubham1g5", "name": "Shubham Goyal"}}, "url": "https://github.com/dimagi/commcare-android/commit/6a205f1e7e0e97749b5970dc62b2b77dba400e96", "committedDate": "2020-07-27T19:53:57Z", "message": "don't crash when no form is found in storage while uninstall"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDU2MDk5MDY3", "url": "https://github.com/dimagi/commcare-android/pull/2297#pullrequestreview-456099067", "createdAt": "2020-07-27T20:10:48Z", "commit": {"oid": "6a205f1e7e0e97749b5970dc62b2b77dba400e96"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yN1QyMDoxMDo0OFrOG3xzAg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yN1QyMDoxMDo0OFrOG3xzAg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MTE0MDczOA==", "bodyText": "Separately trying to confirm a suspicion that this fails sometimes causing the update installation to get blocked.", "url": "https://github.com/dimagi/commcare-android/pull/2297#discussion_r461140738", "createdAt": "2020-07-27T20:10:48Z", "author": {"login": "shubham1g5"}, "path": "app/src/org/commcare/android/resource/installers/FileSystemInstaller.java", "diffHunk": "@@ -213,6 +213,10 @@ public boolean upgrade(Resource r, AndroidCommCarePlatform platform) {\n             String finalLocation = localDestination + \"/\" + filepart;\r\n \r\n             if (!FileSystemUtils.moveFrom(localLocation, finalLocation, false)) {\r\n+                Logger.log(LogTypes.TYPE_RESOURCES, \"Failed to move resource \" + r.getDescriptor() +\r\n+                        \" during upgrade from origin file path \" + localLocation + \" to  desination file path \" +\r\n+                        finalLocation + \". Origin file exists = \" + new File(localLocation).exists()\r\n+                        + \" and Destination File exits = \" + new File(finalLocation).exists());\r", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "6a205f1e7e0e97749b5970dc62b2b77dba400e96"}, "originalPosition": 7}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "5ea9af6f276885189933a6ce22ad13f67014bb56", "author": {"user": {"login": "shubham1g5", "name": "Shubham Goyal"}}, "url": "https://github.com/dimagi/commcare-android/commit/5ea9af6f276885189933a6ce22ad13f67014bb56", "committedDate": "2020-07-27T20:49:54Z", "message": "Better comment"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDU3OTg0MDM3", "url": "https://github.com/dimagi/commcare-android/pull/2297#pullrequestreview-457984037", "createdAt": "2020-07-30T00:23:22Z", "commit": {"oid": "5ea9af6f276885189933a6ce22ad13f67014bb56"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "461a96473ceb81a9e50436a5806ff51a2059eafb", "author": {"user": {"login": "shubham1g5", "name": "Shubham Goyal"}}, "url": "https://github.com/dimagi/commcare-android/commit/461a96473ceb81a9e50436a5806ff51a2059eafb", "committedDate": "2020-07-30T07:03:23Z", "message": "Merge branch 'master' into xformUninstallCrashFix"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2086, "cost": 1, "resetAt": "2021-11-01T13:51:04Z"}}}