{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTA1NzAyNDI1", "number": 2379, "reviewThreads": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xOVQwOTowNjowMlrOEvN5dQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xOVQwOTowNzowOFrOEvN7Xw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzE3OTQ2MjI5OnYy", "diffSide": "RIGHT", "path": "app/instrumentation-tests/src/org/commcare/androidTests/FormSettingsTest.kt", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xOVQwOTowNjowMlrOHkEwyg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xOVQwOTo0NTo1OFrOHkGT6w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNzU4ODgxMA==", "bodyText": "Should we have a similar check as L118 for checking if the size changed to medium or not ?", "url": "https://github.com/dimagi/commcare-android/pull/2379#discussion_r507588810", "createdAt": "2020-10-19T09:06:02Z", "author": {"login": "shubham1g5"}, "path": "app/instrumentation-tests/src/org/commcare/androidTests/FormSettingsTest.kt", "diffHunk": "@@ -0,0 +1,139 @@\n+package org.commcare.androidTests\n+\n+import androidx.annotation.IdRes\n+import androidx.test.espresso.Espresso\n+import androidx.test.espresso.Espresso.*\n+import androidx.test.espresso.action.ViewActions.click\n+import androidx.test.espresso.action.ViewActions.typeText\n+import androidx.test.espresso.assertion.ViewAssertions.doesNotExist\n+import androidx.test.espresso.assertion.ViewAssertions.matches\n+import androidx.test.espresso.matcher.ViewMatchers.*\n+import androidx.test.ext.junit.runners.AndroidJUnit4\n+import androidx.test.filters.LargeTest\n+import androidx.test.platform.app.InstrumentationRegistry\n+import org.commcare.dalvik.R\n+import org.commcare.utils.CustomMatchers\n+import org.commcare.utils.InstrumentationUtility\n+import org.hamcrest.Matchers.*\n+import org.junit.Before\n+import org.junit.Test\n+import org.junit.runner.RunWith\n+\n+@RunWith(AndroidJUnit4::class)\n+@LargeTest\n+class FormSettingsTest: BaseTest() {\n+\n+    companion object {\n+        const val CCZ_NAME = \"settings_sheet_tests.ccz\"\n+        const val APP_NAME = \"App for Settings Sheet\"\n+    }\n+\n+    @Before\n+    fun setup() {\n+        installApp(APP_NAME, CCZ_NAME)\n+        InstrumentationUtility.login(\"settings.test\", \"123\")\n+    }\n+\n+    @Test\n+    fun testSaveFormSetting() {\n+        InstrumentationUtility.openForm(0, 1)\n+        onView(withId(R.id.nav_btn_next))\n+                .perform(click())\n+        onView(withClassName(endsWith(\"EditText\")))\n+                .perform(typeText(\"Test Value 123\"))\n+        Espresso.closeSoftKeyboard()\n+        selectSetting(R.string.save_all_answers)\n+\n+        Espresso.pressBack()\n+        onView(withText(R.string.do_not_save))\n+                .perform(click())\n+        InstrumentationUtility.gotoHome()\n+\n+        InstrumentationUtility.openFirstIncompleteForm()\n+        onView(withText(\"Test Value 123\"))\n+                .check(matches(isDisplayed()))\n+    }\n+\n+    @Test\n+    fun testGoToPromptSetting() {\n+        InstrumentationUtility.openForm(0, 1)\n+        selectSetting(R.string.view_hierarchy)\n+\n+        // Confirm you're seeing all the options.\n+        onView(withId(R.id.jumpPreviousButton))\n+                .check(matches(isDisplayed()))\n+        onView(withId(R.id.jumpBeginningButton))\n+                .check(matches(isDisplayed()))\n+        onView(withId(R.id.jumpEndButton))\n+                .check(matches(isDisplayed()))\n+\n+        // Click go to end\n+        onView(withId(R.id.jumpEndButton))\n+                .perform(click())\n+\n+        // Confirm you can see the finish button\n+        onView(withId(R.id.nav_btn_finish))\n+                .check(matches(isDisplayed()))\n+    }\n+\n+    @Test\n+    fun testChangeLanguageSetting() {\n+        InstrumentationUtility.openForm(0, 1 )\n+        selectSetting(R.string.change_language)\n+        // We see 2 choices::\n+        onView(withId(R.id.choices_list_view))\n+                .check(matches(CustomMatchers.matchListSize(2)))\n+        // English and Hindi\n+        onView(withText(\"English\"))\n+                .check(matches(isDisplayed()))\n+        onView(withText(\"\u0939\u093f\u0902\u0926\u0940\"))\n+                .check(matches(isDisplayed()))\n+\n+        onView(withText(\"\u0939\u093f\u0902\u0926\u0940\"))\n+                .perform(click())\n+\n+        onView(withText(startsWith(\"HINDI TRANSLATION\")))\n+                .check(matches(isDisplayed()))\n+        selectSetting(R.string.change_language)\n+        // Again we see 2 choices\n+        onView(withId(R.id.choices_list_view))\n+                .check(matches(CustomMatchers.matchListSize(2)))\n+\n+        onView(withText(\"English\"))\n+                .perform(click())\n+        onView(withText(startsWith(\"HINDI TRANSLATION\")))\n+                .check(doesNotExist())\n+    }\n+\n+    @Test\n+    fun testTextSizeSetting() {\n+        InstrumentationUtility.openForm(0, 1 )\n+        val context = InstrumentationRegistry.getInstrumentation().targetContext\n+        val fontNames = context.resources.getStringArray(R.array.font_size_entries)\n+        val fontValues = context.resources.getStringArray(R.array.font_size_entry_values)\n+\n+        // Change font size to extra small and confirm if the question text size changes\n+        val extraSmallFontIndex = fontNames.size - 1\n+        changeFontSize(fontNames[extraSmallFontIndex])\n+        onView(withText(startsWith(\"The following questions\")))\n+                .check(matches(CustomMatchers.withFontSize(fontValues[extraSmallFontIndex].toFloat())))\n+\n+        val mediumFontIndex = 2\n+        changeFontSize(fontNames[mediumFontIndex])", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "42226dbfd8a741e55c1f5c0652d0b4484e1e91f6"}, "originalPosition": 122}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNzYxNDE4Nw==", "bodyText": "Sounds good, will add the check for it.", "url": "https://github.com/dimagi/commcare-android/pull/2379#discussion_r507614187", "createdAt": "2020-10-19T09:45:58Z", "author": {"login": "ShivamPokhriyal"}, "path": "app/instrumentation-tests/src/org/commcare/androidTests/FormSettingsTest.kt", "diffHunk": "@@ -0,0 +1,139 @@\n+package org.commcare.androidTests\n+\n+import androidx.annotation.IdRes\n+import androidx.test.espresso.Espresso\n+import androidx.test.espresso.Espresso.*\n+import androidx.test.espresso.action.ViewActions.click\n+import androidx.test.espresso.action.ViewActions.typeText\n+import androidx.test.espresso.assertion.ViewAssertions.doesNotExist\n+import androidx.test.espresso.assertion.ViewAssertions.matches\n+import androidx.test.espresso.matcher.ViewMatchers.*\n+import androidx.test.ext.junit.runners.AndroidJUnit4\n+import androidx.test.filters.LargeTest\n+import androidx.test.platform.app.InstrumentationRegistry\n+import org.commcare.dalvik.R\n+import org.commcare.utils.CustomMatchers\n+import org.commcare.utils.InstrumentationUtility\n+import org.hamcrest.Matchers.*\n+import org.junit.Before\n+import org.junit.Test\n+import org.junit.runner.RunWith\n+\n+@RunWith(AndroidJUnit4::class)\n+@LargeTest\n+class FormSettingsTest: BaseTest() {\n+\n+    companion object {\n+        const val CCZ_NAME = \"settings_sheet_tests.ccz\"\n+        const val APP_NAME = \"App for Settings Sheet\"\n+    }\n+\n+    @Before\n+    fun setup() {\n+        installApp(APP_NAME, CCZ_NAME)\n+        InstrumentationUtility.login(\"settings.test\", \"123\")\n+    }\n+\n+    @Test\n+    fun testSaveFormSetting() {\n+        InstrumentationUtility.openForm(0, 1)\n+        onView(withId(R.id.nav_btn_next))\n+                .perform(click())\n+        onView(withClassName(endsWith(\"EditText\")))\n+                .perform(typeText(\"Test Value 123\"))\n+        Espresso.closeSoftKeyboard()\n+        selectSetting(R.string.save_all_answers)\n+\n+        Espresso.pressBack()\n+        onView(withText(R.string.do_not_save))\n+                .perform(click())\n+        InstrumentationUtility.gotoHome()\n+\n+        InstrumentationUtility.openFirstIncompleteForm()\n+        onView(withText(\"Test Value 123\"))\n+                .check(matches(isDisplayed()))\n+    }\n+\n+    @Test\n+    fun testGoToPromptSetting() {\n+        InstrumentationUtility.openForm(0, 1)\n+        selectSetting(R.string.view_hierarchy)\n+\n+        // Confirm you're seeing all the options.\n+        onView(withId(R.id.jumpPreviousButton))\n+                .check(matches(isDisplayed()))\n+        onView(withId(R.id.jumpBeginningButton))\n+                .check(matches(isDisplayed()))\n+        onView(withId(R.id.jumpEndButton))\n+                .check(matches(isDisplayed()))\n+\n+        // Click go to end\n+        onView(withId(R.id.jumpEndButton))\n+                .perform(click())\n+\n+        // Confirm you can see the finish button\n+        onView(withId(R.id.nav_btn_finish))\n+                .check(matches(isDisplayed()))\n+    }\n+\n+    @Test\n+    fun testChangeLanguageSetting() {\n+        InstrumentationUtility.openForm(0, 1 )\n+        selectSetting(R.string.change_language)\n+        // We see 2 choices::\n+        onView(withId(R.id.choices_list_view))\n+                .check(matches(CustomMatchers.matchListSize(2)))\n+        // English and Hindi\n+        onView(withText(\"English\"))\n+                .check(matches(isDisplayed()))\n+        onView(withText(\"\u0939\u093f\u0902\u0926\u0940\"))\n+                .check(matches(isDisplayed()))\n+\n+        onView(withText(\"\u0939\u093f\u0902\u0926\u0940\"))\n+                .perform(click())\n+\n+        onView(withText(startsWith(\"HINDI TRANSLATION\")))\n+                .check(matches(isDisplayed()))\n+        selectSetting(R.string.change_language)\n+        // Again we see 2 choices\n+        onView(withId(R.id.choices_list_view))\n+                .check(matches(CustomMatchers.matchListSize(2)))\n+\n+        onView(withText(\"English\"))\n+                .perform(click())\n+        onView(withText(startsWith(\"HINDI TRANSLATION\")))\n+                .check(doesNotExist())\n+    }\n+\n+    @Test\n+    fun testTextSizeSetting() {\n+        InstrumentationUtility.openForm(0, 1 )\n+        val context = InstrumentationRegistry.getInstrumentation().targetContext\n+        val fontNames = context.resources.getStringArray(R.array.font_size_entries)\n+        val fontValues = context.resources.getStringArray(R.array.font_size_entry_values)\n+\n+        // Change font size to extra small and confirm if the question text size changes\n+        val extraSmallFontIndex = fontNames.size - 1\n+        changeFontSize(fontNames[extraSmallFontIndex])\n+        onView(withText(startsWith(\"The following questions\")))\n+                .check(matches(CustomMatchers.withFontSize(fontValues[extraSmallFontIndex].toFloat())))\n+\n+        val mediumFontIndex = 2\n+        changeFontSize(fontNames[mediumFontIndex])", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNzU4ODgxMA=="}, "originalCommit": {"oid": "42226dbfd8a741e55c1f5c0652d0b4484e1e91f6"}, "originalPosition": 122}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzE3OTQ2NzE5OnYy", "diffSide": "RIGHT", "path": "app/instrumentation-tests/src/org/commcare/utils/CustomMatchers.kt", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xOVQwOTowNzowOFrOHkEzwQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xOVQwOTowNzowOFrOHkEzwQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNzU4OTU2OQ==", "bodyText": "nice work implementing this.", "url": "https://github.com/dimagi/commcare-android/pull/2379#discussion_r507589569", "createdAt": "2020-10-19T09:07:08Z", "author": {"login": "shubham1g5"}, "path": "app/instrumentation-tests/src/org/commcare/utils/CustomMatchers.kt", "diffHunk": "@@ -105,4 +107,22 @@ object CustomMatchers {\n         }\n     }\n \n+    fun withFontSize(expectedSize: Float): Matcher<View> {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "42226dbfd8a741e55c1f5c0652d0b4484e1e91f6"}, "originalPosition": 20}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3184, "cost": 1, "resetAt": "2021-11-12T13:16:51Z"}}}