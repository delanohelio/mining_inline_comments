{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDg5OTUyMzYy", "number": 2351, "title": "Orphan Progress dialog fix", "bodyText": "https://dimagi-dev.atlassian.net/browse/QA-1893\nBecause we were using dialog.show instead of dialog.showNow, it allowed Fragment manager to lazily execute on committed fragment transactions resulting in a state where dismiss was called even before the show transaction executes resulting in a hanging progress dialog as described in the JIRA linked above.\nThis PR changes the showProgressDialog to use dialog.showNow and then make other supporting changes so that a task only dismisses the progress dialog generated by itself. This is done to avoid incorrect dialog cancellation in case of a task transition. For example in case of sync, if we don't use task specific dialog cancellation the DataPullTask new dialog gets cancelled by the concluding ProcessAndSendTask dismiss dialog call resulting in the pull task dialog to never gets visible.\nIt is not clear to me why this issue is only surfacing now in 2.50. Nothing related seems to have changed in between 2.49 and 2.50 and the whole code path is same line to line.", "createdAt": "2020-09-20T20:15:23Z", "url": "https://github.com/dimagi/commcare-android/pull/2351", "merged": true, "mergeCommit": {"oid": "745bf83e2947c79487e6d6f0cc35a24c72c43750"}, "closed": true, "closedAt": "2020-09-21T19:08:23Z", "author": {"login": "shubham1g5"}, "timelineItems": {"totalCount": 6, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdK0Xx_gH2gAyNDg5OTUyMzYyOmEzZDU1M2VmMzc1NGJkOWQzMmY2Mzg5MWE2Y2MwNDU2YTJiN2Q1NmE=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdLDA0sgFqTQ5MjU3NTg1NQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "a3d553ef3754bd9d32f63891a6cc0456a2b7d56a", "author": {"user": {"login": "shubham1g5", "name": "Shubham Goyal"}}, "url": "https://github.com/dimagi/commcare-android/commit/a3d553ef3754bd9d32f63891a6cc0456a2b7d56a", "committedDate": "2020-09-20T19:57:31Z", "message": "Fixes an issue where progress dialogs would be left hanging because of pending fragment transactions"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDkyMjE5OTM1", "url": "https://github.com/dimagi/commcare-android/pull/2351#pullrequestreview-492219935", "createdAt": "2020-09-20T20:16:35Z", "commit": {"oid": "a3d553ef3754bd9d32f63891a6cc0456a2b7d56a"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yMFQyMDoxNjozNVrOHU8zeQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yMFQyMDoxNjozNVrOHU8zeQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MTcyOTc4NQ==", "bodyText": "crux of the issue", "url": "https://github.com/dimagi/commcare-android/pull/2351#discussion_r491729785", "createdAt": "2020-09-20T20:16:35Z", "author": {"login": "shubham1g5"}, "path": "app/src/org/commcare/activities/CommCareActivity.java", "diffHunk": "@@ -591,7 +593,7 @@ public void showProgressDialog(int taskId) {\n         if (taskId >= 0) {\r\n             CustomProgressDialog dialog = generateProgressDialog(taskId);\r\n             if (dialog != null) {\r\n-                dialog.show(getSupportFragmentManager(), KEY_PROGRESS_DIALOG_FRAG);\r\n+                dialog.showNow(getSupportFragmentManager(), KEY_PROGRESS_DIALOG_FRAG);\r", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "a3d553ef3754bd9d32f63891a6cc0456a2b7d56a"}, "originalPosition": 77}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a94801081730b7748ce9637cb17d7c80041fcad4", "author": {"user": {"login": "shubham1g5", "name": "Shubham Goyal"}}, "url": "https://github.com/dimagi/commcare-android/commit/a94801081730b7748ce9637cb17d7c80041fcad4", "committedDate": "2020-09-20T20:17:27Z", "message": "minor cleanup"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDkyMjUxNTI4", "url": "https://github.com/dimagi/commcare-android/pull/2351#pullrequestreview-492251528", "createdAt": "2020-09-21T02:19:19Z", "commit": {"oid": "a94801081730b7748ce9637cb17d7c80041fcad4"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "9c03271e48c40498dccfcf24f6a27b63160b057e", "author": {"user": {"login": "shubham1g5", "name": "Shubham Goyal"}}, "url": "https://github.com/dimagi/commcare-android/commit/9c03271e48c40498dccfcf24f6a27b63160b057e", "committedDate": "2020-09-21T12:12:40Z", "message": "fix for \"FragmentManager is already executing transactions\""}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDkyNTc1ODU1", "url": "https://github.com/dimagi/commcare-android/pull/2351#pullrequestreview-492575855", "createdAt": "2020-09-21T13:01:01Z", "commit": {"oid": "9c03271e48c40498dccfcf24f6a27b63160b057e"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1937, "cost": 1, "resetAt": "2021-11-01T13:51:04Z"}}}