{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDcwNDU4MzU5", "number": 2320, "reviewThreads": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xOVQyMToxMjo0NVrOEaJ0qA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yMFQwNToyNjowNFrOEaUEWw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjk1ODU5MzY4OnYy", "diffSide": "LEFT", "path": "app/src/org/commcare/activities/GeoPointMapActivity.java", "isResolved": false, "comments": {"totalCount": 5, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xOVQyMToxMjo0NVrOHDZf4w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yMFQwNzoxMzo0NFrOHDvLKA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MzMyNTUzOQ==", "bodyText": "this was breaking when there is no initial location set on the map as new location's accuracy is always greater than 0 while base location's accuracy is set to 0 on start up", "url": "https://github.com/dimagi/commcare-android/pull/2320#discussion_r473325539", "createdAt": "2020-08-19T21:12:45Z", "author": {"login": "shubham1g5"}, "path": "app/src/org/commcare/activities/GeoPointMapActivity.java", "diffHunk": "@@ -153,7 +164,8 @@ private void loadProviders() {\n     public void onLocationChanged(Location location) {\n         if (!inViewMode && !isManualSelectedLocation) {\n             if (location != null &&\n-                    (this.location == null || (location.getAccuracy() < this.location.getAccuracy()))) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "bc8a7d8ee138c43baee752f2b790709010525f9f"}, "originalPosition": 49}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MzYwODE1Ng==", "bodyText": "Shouldn't the this.location == null check work when there's no initial location?", "url": "https://github.com/dimagi/commcare-android/pull/2320#discussion_r473608156", "createdAt": "2020-08-20T05:31:11Z", "author": {"login": "ShivamPokhriyal"}, "path": "app/src/org/commcare/activities/GeoPointMapActivity.java", "diffHunk": "@@ -153,7 +164,8 @@ private void loadProviders() {\n     public void onLocationChanged(Location location) {\n         if (!inViewMode && !isManualSelectedLocation) {\n             if (location != null &&\n-                    (this.location == null || (location.getAccuracy() < this.location.getAccuracy()))) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MzMyNTUzOQ=="}, "originalCommit": {"oid": "bc8a7d8ee138c43baee752f2b790709010525f9f"}, "originalPosition": 49}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MzY2MjY3Ng==", "bodyText": "location is initialized to non null value to start with. So I don't think if it will ever be null.", "url": "https://github.com/dimagi/commcare-android/pull/2320#discussion_r473662676", "createdAt": "2020-08-20T06:51:07Z", "author": {"login": "shubham1g5"}, "path": "app/src/org/commcare/activities/GeoPointMapActivity.java", "diffHunk": "@@ -153,7 +164,8 @@ private void loadProviders() {\n     public void onLocationChanged(Location location) {\n         if (!inViewMode && !isManualSelectedLocation) {\n             if (location != null &&\n-                    (this.location == null || (location.getAccuracy() < this.location.getAccuracy()))) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MzMyNTUzOQ=="}, "originalCommit": {"oid": "bc8a7d8ee138c43baee752f2b790709010525f9f"}, "originalPosition": 49}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MzY3NzQxMQ==", "bodyText": "Got it, so this.location == null is never going to be true or do you think there can be a possibility of a null location?", "url": "https://github.com/dimagi/commcare-android/pull/2320#discussion_r473677411", "createdAt": "2020-08-20T07:09:45Z", "author": {"login": "ShivamPokhriyal"}, "path": "app/src/org/commcare/activities/GeoPointMapActivity.java", "diffHunk": "@@ -153,7 +164,8 @@ private void loadProviders() {\n     public void onLocationChanged(Location location) {\n         if (!inViewMode && !isManualSelectedLocation) {\n             if (location != null &&\n-                    (this.location == null || (location.getAccuracy() < this.location.getAccuracy()))) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MzMyNTUzOQ=="}, "originalCommit": {"oid": "bc8a7d8ee138c43baee752f2b790709010525f9f"}, "originalPosition": 49}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MzY4MDY4MA==", "bodyText": "yeah, I don't think there is such a possibility though have not removed it to minimize changes in the hotfix", "url": "https://github.com/dimagi/commcare-android/pull/2320#discussion_r473680680", "createdAt": "2020-08-20T07:13:44Z", "author": {"login": "shubham1g5"}, "path": "app/src/org/commcare/activities/GeoPointMapActivity.java", "diffHunk": "@@ -153,7 +164,8 @@ private void loadProviders() {\n     public void onLocationChanged(Location location) {\n         if (!inViewMode && !isManualSelectedLocation) {\n             if (location != null &&\n-                    (this.location == null || (location.getAccuracy() < this.location.getAccuracy()))) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MzMyNTUzOQ=="}, "originalCommit": {"oid": "bc8a7d8ee138c43baee752f2b790709010525f9f"}, "originalPosition": 49}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjk2MDI3MjI3OnYy", "diffSide": "RIGHT", "path": "app/src/org/commcare/activities/GeoPointMapActivity.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yMFQwNToyNjowNFrOHDqiYA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yMFQwNjo1MTo1OFrOHDuHhw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MzYwNDcwNA==", "bodyText": "What if location is null?", "url": "https://github.com/dimagi/commcare-android/pull/2320#discussion_r473604704", "createdAt": "2020-08-20T05:26:04Z", "author": {"login": "ShivamPokhriyal"}, "path": "app/src/org/commcare/activities/GeoPointMapActivity.java", "diffHunk": "@@ -120,12 +123,20 @@ private void changeMapLayer() {\n     }\n \n     private void returnLocation() {\n-        if (location != null) {\n+        if (location != null &&\n+                (location.getLatitude() == 0d && location.getLongitude() == 0d && location.getAccuracy() == 0d)) {\n+            // we do not have a location fix yet, show an error to the user\n+            Toast.makeText(\n+                    this,\n+                    StringUtils.getStringRobust(CommCareApplication.instance(), R.string.wait_for_location_fix),\n+                    Toast.LENGTH_LONG).show();\n+\n+        } else {\n             Intent i = new Intent();\n             i.putExtra(FormEntryConstants.LOCATION_RESULT, GeoUtils.locationToString(location));", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "bc8a7d8ee138c43baee752f2b790709010525f9f"}, "originalPosition": 37}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MzY2MzM2Nw==", "bodyText": "my bad, corrected.", "url": "https://github.com/dimagi/commcare-android/pull/2320#discussion_r473663367", "createdAt": "2020-08-20T06:51:58Z", "author": {"login": "shubham1g5"}, "path": "app/src/org/commcare/activities/GeoPointMapActivity.java", "diffHunk": "@@ -120,12 +123,20 @@ private void changeMapLayer() {\n     }\n \n     private void returnLocation() {\n-        if (location != null) {\n+        if (location != null &&\n+                (location.getLatitude() == 0d && location.getLongitude() == 0d && location.getAccuracy() == 0d)) {\n+            // we do not have a location fix yet, show an error to the user\n+            Toast.makeText(\n+                    this,\n+                    StringUtils.getStringRobust(CommCareApplication.instance(), R.string.wait_for_location_fix),\n+                    Toast.LENGTH_LONG).show();\n+\n+        } else {\n             Intent i = new Intent();\n             i.putExtra(FormEntryConstants.LOCATION_RESULT, GeoUtils.locationToString(location));", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MzYwNDcwNA=="}, "originalCommit": {"oid": "bc8a7d8ee138c43baee752f2b790709010525f9f"}, "originalPosition": 37}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3310, "cost": 1, "resetAt": "2021-11-12T13:16:51Z"}}}