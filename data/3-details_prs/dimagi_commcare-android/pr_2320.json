{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDcwNDU4MzU5", "number": 2320, "title": "[2.49.7 hotfix] Fix to current location for Maps Location Capture", "bodyText": "Corrects the accuracy check to let the initial location fix go through\nDon't allow 0,0,0,0 location to be recorded\n\nProduce Notes:\n\nMove the maps to user's initial location on start up in case no existing location is set\nDon't allow locatin with values \"0.0 0.0 0.0 0.0\" to be recorded as a valid location", "createdAt": "2020-08-19T21:10:03Z", "url": "https://github.com/dimagi/commcare-android/pull/2320", "merged": true, "mergeCommit": {"oid": "e780e58b223ea4287e4a1ebf2cd1fbe760b48f0c"}, "closed": true, "closedAt": "2020-08-20T07:19:33Z", "author": {"login": "shubham1g5"}, "timelineItems": {"totalCount": 6, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdAhvCmgH2gAyNDcwNDU4MzU5OjJlMDIzNzc3ZTgzMTk5MzFmYWU2M2U5ZTQ2Y2JjOWZjY2UzOTU0NjQ=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdAq8NogFqTQ3MTMwNzczMg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "2e023777e8319931fae63e9e46cbc9fcce395464", "author": {"user": {"login": "shubham1g5", "name": "Shubham Goyal"}}, "url": "https://github.com/dimagi/commcare-android/commit/2e023777e8319931fae63e9e46cbc9fcce395464", "committedDate": "2020-08-19T20:35:29Z", "message": "Corrects the accuracy check to consider the initial location fix"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "bc8a7d8ee138c43baee752f2b790709010525f9f", "author": {"user": {"login": "shubham1g5", "name": "Shubham Goyal"}}, "url": "https://github.com/dimagi/commcare-android/commit/bc8a7d8ee138c43baee752f2b790709010525f9f", "committedDate": "2020-08-19T21:07:38Z", "message": "Don't allow 0,0,0,0 location to be recorded"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDcwOTY4Nzkx", "url": "https://github.com/dimagi/commcare-android/pull/2320#pullrequestreview-470968791", "createdAt": "2020-08-19T21:12:45Z", "commit": {"oid": "bc8a7d8ee138c43baee752f2b790709010525f9f"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xOVQyMToxMjo0NVrOHDZf4w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xOVQyMToxMjo0NVrOHDZf4w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MzMyNTUzOQ==", "bodyText": "this was breaking when there is no initial location set on the map as new location's accuracy is always greater than 0 while base location's accuracy is set to 0 on start up", "url": "https://github.com/dimagi/commcare-android/pull/2320#discussion_r473325539", "createdAt": "2020-08-19T21:12:45Z", "author": {"login": "shubham1g5"}, "path": "app/src/org/commcare/activities/GeoPointMapActivity.java", "diffHunk": "@@ -153,7 +164,8 @@ private void loadProviders() {\n     public void onLocationChanged(Location location) {\n         if (!inViewMode && !isManualSelectedLocation) {\n             if (location != null &&\n-                    (this.location == null || (location.getAccuracy() < this.location.getAccuracy()))) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "bc8a7d8ee138c43baee752f2b790709010525f9f"}, "originalPosition": 49}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDcxMjU2MDE3", "url": "https://github.com/dimagi/commcare-android/pull/2320#pullrequestreview-471256017", "createdAt": "2020-08-20T05:26:04Z", "commit": {"oid": "bc8a7d8ee138c43baee752f2b790709010525f9f"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yMFQwNToyNjowNFrOHDqiYA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yMFQwNToyNjowNFrOHDqiYA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MzYwNDcwNA==", "bodyText": "What if location is null?", "url": "https://github.com/dimagi/commcare-android/pull/2320#discussion_r473604704", "createdAt": "2020-08-20T05:26:04Z", "author": {"login": "ShivamPokhriyal"}, "path": "app/src/org/commcare/activities/GeoPointMapActivity.java", "diffHunk": "@@ -120,12 +123,20 @@ private void changeMapLayer() {\n     }\n \n     private void returnLocation() {\n-        if (location != null) {\n+        if (location != null &&\n+                (location.getLatitude() == 0d && location.getLongitude() == 0d && location.getAccuracy() == 0d)) {\n+            // we do not have a location fix yet, show an error to the user\n+            Toast.makeText(\n+                    this,\n+                    StringUtils.getStringRobust(CommCareApplication.instance(), R.string.wait_for_location_fix),\n+                    Toast.LENGTH_LONG).show();\n+\n+        } else {\n             Intent i = new Intent();\n             i.putExtra(FormEntryConstants.LOCATION_RESULT, GeoUtils.locationToString(location));", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "bc8a7d8ee138c43baee752f2b790709010525f9f"}, "originalPosition": 37}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "2c54d6d82f8869fe5cef62ecf2891044b24ae8df", "author": {"user": {"login": "shubham1g5", "name": "Shubham Goyal"}}, "url": "https://github.com/dimagi/commcare-android/commit/2c54d6d82f8869fe5cef62ecf2891044b24ae8df", "committedDate": "2020-08-20T06:51:40Z", "message": "Handles null value correctly for location"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDcxMzA3NzMy", "url": "https://github.com/dimagi/commcare-android/pull/2320#pullrequestreview-471307732", "createdAt": "2020-08-20T07:19:01Z", "commit": {"oid": "2c54d6d82f8869fe5cef62ecf2891044b24ae8df"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2109, "cost": 1, "resetAt": "2021-11-01T13:51:04Z"}}}