{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0MzY2NzkwNjU0", "number": 2176, "title": "Update app to target Android 10 ", "bodyText": "", "createdAt": "2020-01-24T11:21:08Z", "url": "https://github.com/dimagi/commcare-android/pull/2176", "merged": true, "mergeCommit": {"oid": "761bbaafb1f4a1d40f8e76b07b37147c028cddae"}, "closed": true, "closedAt": "2020-02-25T10:25:55Z", "author": {"login": "ShivamPokhriyal"}, "timelineItems": {"totalCount": 22, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABb-WeK9AFqTM0ODQ1MjAyMw==", "endCursor": "Y3Vyc29yOnYyOpPPAAABcHvVQ7gFqTM2NDAxODgzMw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzQ4NDUyMDIz", "url": "https://github.com/dimagi/commcare-android/pull/2176#pullrequestreview-348452023", "createdAt": "2020-01-27T06:09:06Z", "commit": {"oid": "4de4064d9bc8a1df5eb88471faea6bb610933f6d"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0yN1QwNjowOTowNlrOFh4j8w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0yN1QwNjowOTowNlrOFh4j8w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MTA3NDAzNQ==", "bodyText": "Not Sure about the use-case of this particular method, but it won't work with android 10.\nAndroid best practices suggest See 3rd option using either a random UUID(we'll have to save it in preferences to make sure it doesn't change) or Firebase Instance ID(read here).\nThough both of them have a drawback: if application is reinstalled or user clears app data then the id will be lost and a new id will be generated.\nLet me know, if this is something important and should we use one of the above approaches to get a id.", "url": "https://github.com/dimagi/commcare-android/pull/2176#discussion_r371074035", "createdAt": "2020-01-27T06:09:06Z", "author": {"login": "ShivamPokhriyal"}, "path": "app/src/org/commcare/CommCareApplication.java", "diffHunk": "@@ -410,20 +410,27 @@ public void initializeGlobalResources(CommCareApp app) {\n     }\r\n \r\n     @NonNull\r\n+    @Deprecated\r\n     public String getPhoneId() {\r", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "4de4064d9bc8a1df5eb88471faea6bb610933f6d"}, "originalPosition": 5}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzQ4NTM5NzQ3", "url": "https://github.com/dimagi/commcare-android/pull/2176#pullrequestreview-348539747", "createdAt": "2020-01-27T09:52:37Z", "commit": {"oid": "4a7bdda28d2b3e45705db6becd8b43bb5f6316fd"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0yN1QwOTo1MjozOFrOFh84TQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0yN1QwOTo1MjozOFrOFh84TQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MTE0NDc4MQ==", "bodyText": "Read here for more information :: https://developer.android.com/training/data-storage#scoped-storage\nIf not enabled, this method throws error https://github.com/dimagi/commcare-android/blob/master/app/src/org/commcare/models/ODKStorage.java#L22\nGet better idea of the issue : https://issuetracker.google.com/issues/128591846", "url": "https://github.com/dimagi/commcare-android/pull/2176#discussion_r371144781", "createdAt": "2020-01-27T09:52:38Z", "author": {"login": "ShivamPokhriyal"}, "path": "app/AndroidManifest.xml", "diffHunk": "@@ -64,6 +64,7 @@\n         android:label=\"@string/application_name\"\n         android:hardwareAccelerated=\"true\"\n         android:usesCleartextTraffic=\"true\"\n+        android:requestLegacyExternalStorage=\"true\"", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "4a7bdda28d2b3e45705db6becd8b43bb5f6316fd"}, "originalPosition": 4}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzQ5MTQ2MjUx", "url": "https://github.com/dimagi/commcare-android/pull/2176#pullrequestreview-349146251", "createdAt": "2020-01-28T06:08:33Z", "commit": {"oid": "4a7bdda28d2b3e45705db6becd8b43bb5f6316fd"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0yOFQwNjowODozM1rOFiaFVw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0yOFQwNjowODozM1rOFiaFVw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MTYyMzI1NQ==", "bodyText": "Also, https://github.com/dimagi/commcare-android/blob/master/app/src/org/commcare/utils/MediaUtil.java#L500 BitmapFactory decodeFile fails if we try and decode the image chosen from gallery.", "url": "https://github.com/dimagi/commcare-android/pull/2176#discussion_r371623255", "createdAt": "2020-01-28T06:08:33Z", "author": {"login": "ShivamPokhriyal"}, "path": "app/AndroidManifest.xml", "diffHunk": "@@ -64,6 +64,7 @@\n         android:label=\"@string/application_name\"\n         android:hardwareAccelerated=\"true\"\n         android:usesCleartextTraffic=\"true\"\n+        android:requestLegacyExternalStorage=\"true\"", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "4a7bdda28d2b3e45705db6becd8b43bb5f6316fd"}, "originalPosition": 4}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzQ5Mjg4OTAy", "url": "https://github.com/dimagi/commcare-android/pull/2176#pullrequestreview-349288902", "createdAt": "2020-01-28T11:01:14Z", "commit": {"oid": "ce3eda49affec893200ab103d1affaeaf57f0c54"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0yOFQxMTowMToxNFrOFig-oQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0yOFQxMTowMToxNFrOFig-oQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MTczNjIyNQ==", "bodyText": "Though I'm not sure whether we should be adding all the files to the content provider.\nIMO, it makes sense for the video that are recorded using the record button in app, but for videos that are chosen from gallery, we just make a copy of that inside our app's directory so if we add it to content provider there'll be 2 copies of the same video shown to the user in the gallery app.", "url": "https://github.com/dimagi/commcare-android/pull/2176#discussion_r371736225", "createdAt": "2020-01-28T11:01:14Z", "author": {"login": "ShivamPokhriyal"}, "path": "app/src/org/commcare/views/widgets/MediaWidget.java", "diffHunk": "@@ -237,21 +235,12 @@ public void setBinaryData(Object binaryuri) {\n             }\n         }\n \n-        if (newMedia.exists()) {\n-            // Add the copy to the content provider", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ce3eda49affec893200ab103d1affaeaf57f0c54"}, "originalPosition": 17}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzQ5Mjg5MzIz", "url": "https://github.com/dimagi/commcare-android/pull/2176#pullrequestreview-349289323", "createdAt": "2020-01-28T11:01:55Z", "commit": {"oid": "ce3eda49affec893200ab103d1affaeaf57f0c54"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0yOFQxMTowMTo1NVrOFig_9Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0yOFQxMTowMTo1NVrOFig_9Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MTczNjU2NQ==", "bodyText": "PS: Though, this change will only prevent crashes and won't change the earlier behaviour.", "url": "https://github.com/dimagi/commcare-android/pull/2176#discussion_r371736565", "createdAt": "2020-01-28T11:01:55Z", "author": {"login": "ShivamPokhriyal"}, "path": "app/src/org/commcare/views/widgets/MediaWidget.java", "diffHunk": "@@ -237,21 +235,12 @@ public void setBinaryData(Object binaryuri) {\n             }\n         }\n \n-        if (newMedia.exists()) {\n-            // Add the copy to the content provider", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ce3eda49affec893200ab103d1affaeaf57f0c54"}, "originalPosition": 17}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzQ5MzAyNDA3", "url": "https://github.com/dimagi/commcare-android/pull/2176#pullrequestreview-349302407", "createdAt": "2020-01-28T11:26:41Z", "commit": {"oid": "0b0e3927dcc27eae881a90f5b96e993e208b4fe4"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 5, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0yOFQxMToyNjo0MVrOFihnww==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0yOFQxMTo1Nzo1MVrOFiia8A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MTc0Njc1NQ==", "bodyText": "For Android 10 adding this sounds good. Though we should add Soft asserts log  statements to the code paths that we identified that were still accesing code paths. So that we know in future if they are indeed getting hit or not.", "url": "https://github.com/dimagi/commcare-android/pull/2176#discussion_r371746755", "createdAt": "2020-01-28T11:26:41Z", "author": {"login": "shubham1g5"}, "path": "app/AndroidManifest.xml", "diffHunk": "@@ -64,6 +64,7 @@\n         android:label=\"@string/application_name\"\n         android:hardwareAccelerated=\"true\"\n         android:usesCleartextTraffic=\"true\"\n+        android:requestLegacyExternalStorage=\"true\"", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MTE0NDc4MQ=="}, "originalCommit": {"oid": "4a7bdda28d2b3e45705db6becd8b43bb5f6316fd"}, "originalPosition": 4}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MTc0OTYzMw==", "bodyText": "So deviceId was useful to identify the 2 separate installations of the app. I think using Firebase Instance Id seems like a good workaround here to separate out the installations as we don't have any other id currently that we maintain that's unique per CC installation.", "url": "https://github.com/dimagi/commcare-android/pull/2176#discussion_r371749633", "createdAt": "2020-01-28T11:33:41Z", "author": {"login": "shubham1g5"}, "path": "app/src/org/commcare/CommCareApplication.java", "diffHunk": "@@ -410,20 +410,27 @@ public void initializeGlobalResources(CommCareApp app) {\n     }\r\n \r\n     @NonNull\r\n+    @Deprecated\r\n     public String getPhoneId() {\r", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MTA3NDAzNQ=="}, "originalCommit": {"oid": "4de4064d9bc8a1df5eb88471faea6bb610933f6d"}, "originalPosition": 5}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MTc1MDI5OQ==", "bodyText": "Thanks for looking at it as part of this work. Though if it isn't realted to Android 10 work, would be nice to separate this out in another PR so that it's easy to revert in case of any edge cases.", "url": "https://github.com/dimagi/commcare-android/pull/2176#discussion_r371750299", "createdAt": "2020-01-28T11:35:26Z", "author": {"login": "shubham1g5"}, "path": "app/src/org/commcare/utils/MediaUtil.java", "diffHunk": "@@ -414,7 +414,7 @@ private static int getApproxScaleDownFactor(int newWidth, int originalWidth) {\n         double widthScaleDownFactor =  (double)boundingWidth / originalWidth;\r\n         // Choosing the larger of the scale down factors, so that the image still fills the entire\r\n         // container\r\n-        double dominantScaleDownFactor = Math.max(widthScaleDownFactor, heightScaleDownFactor);\r\n+        double dominantScaleDownFactor = Math.min(widthScaleDownFactor, heightScaleDownFactor);\r", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "0b0e3927dcc27eae881a90f5b96e993e208b4fe4"}, "originalPosition": 5}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MTc1OTYzMA==", "bodyText": "Agree that we should not save it to content Providers. @ctsims we did remove it for Images sometime back in here, so guessing no objections in removing them for audio and videos as well.", "url": "https://github.com/dimagi/commcare-android/pull/2176#discussion_r371759630", "createdAt": "2020-01-28T11:57:18Z", "author": {"login": "shubham1g5"}, "path": "app/src/org/commcare/views/widgets/MediaWidget.java", "diffHunk": "@@ -237,21 +235,12 @@ public void setBinaryData(Object binaryuri) {\n             }\n         }\n \n-        if (newMedia.exists()) {\n-            // Add the copy to the content provider", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MTczNjIyNQ=="}, "originalCommit": {"oid": "ce3eda49affec893200ab103d1affaeaf57f0c54"}, "originalPosition": 17}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MTc1OTg1Ng==", "bodyText": "We should let the app crash in case of exceptions here if we are going to retain this functionality.", "url": "https://github.com/dimagi/commcare-android/pull/2176#discussion_r371759856", "createdAt": "2020-01-28T11:57:51Z", "author": {"login": "shubham1g5"}, "path": "app/src/org/commcare/views/widgets/MediaWidget.java", "diffHunk": "@@ -237,21 +235,12 @@ public void setBinaryData(Object binaryuri) {\n             }\n         }\n \n-        if (newMedia.exists()) {\n-            // Add the copy to the content provider\n-            ContentValues values = new ContentValues(6);\n-            values.put(MediaStore.Audio.Media.TITLE, newMedia.getName());\n-            values.put(MediaStore.Audio.Media.DISPLAY_NAME, newMedia.getName());\n-            values.put(MediaStore.Audio.Media.DATE_ADDED, System.currentTimeMillis());\n-            values.put(MediaStore.Audio.Media.DATA, newMedia.getAbsolutePath());\n-\n-            Uri mediaUri =\n-                    getContext().getContentResolver().insert(MediaStore.Audio.Media.EXTERNAL_CONTENT_URI, values);\n-            String mediaUriString = mediaUri == null ? \"null\" : mediaUri.toString();\n-            Log.i(TAG, \"Inserting media returned uri = \" + mediaUriString);\n+        try {\n+            FileUtil.addMediaToGallery(getContext(), newMedia);\n             showToast(\"form.attachment.success\");\n-        } else {\n+        } catch (Exception e) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "0b0e3927dcc27eae881a90f5b96e993e208b4fe4"}, "originalPosition": 32}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "0b0e3927dcc27eae881a90f5b96e993e208b4fe4", "author": {"user": {"login": "ShivamPokhriyal", "name": "Shivam Pokhriyal"}}, "url": "https://github.com/dimagi/commcare-android/commit/0b0e3927dcc27eae881a90f5b96e993e208b4fe4", "committedDate": "2020-01-28T11:14:54Z", "message": "Change scaleDownFactor to make sure we don't load large image in imageview"}, "afterCommit": {"oid": "ce3eda49affec893200ab103d1affaeaf57f0c54", "author": {"user": {"login": "ShivamPokhriyal", "name": "Shivam Pokhriyal"}}, "url": "https://github.com/dimagi/commcare-android/commit/ce3eda49affec893200ab103d1affaeaf57f0c54", "committedDate": "2020-01-28T10:56:30Z", "message": "Fix a crash where we added video using MediaStore.Audio contentValues"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzU1ODE5NTIw", "url": "https://github.com/dimagi/commcare-android/pull/2176#pullrequestreview-355819520", "createdAt": "2020-02-10T10:14:59Z", "commit": {"oid": "78fef8f0b4788e2dd6b5b650083dea2aa454ef6b"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xMFQxMDoxNDo1OVrOFnggaw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xMFQxMDoxNDo1OVrOFnggaw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3Njk3MTM3MQ==", "bodyText": "Using SharedPreference to store this unique id. We can also choose to create a text file and store UUID to that file. I'm not sure which option is more suitable of the two so using the sharedpreferences approach here.", "url": "https://github.com/dimagi/commcare-android/pull/2176#discussion_r376971371", "createdAt": "2020-02-10T10:14:59Z", "author": {"login": "ShivamPokhriyal"}, "path": "app/src/org/commcare/utils/DeviceIdentifier.java", "diffHunk": "@@ -0,0 +1,41 @@\n+package org.commcare.utils;\n+\n+import android.content.Context;\n+import android.content.SharedPreferences;\n+import androidx.preference.PreferenceManager;\n+import java.util.UUID;\n+\n+/**\n+ * A Utility to get a unique identifier for app's installation.\n+ * @author $|-|!\u02c5@M\n+ */\n+public final class DeviceIdentifier {\n+\n+    private static volatile String uuid;\n+    private static final String PREFIX = \"commcare_\";\n+    private static final String KEY_DEVICE_IDENTIFIER = \"commcare_device_id\";\n+\n+    /**\n+     * Returns a unique(very highly likely) identifier for this device.\n+     * This identifier is prefixed with \"commcare_\"\n+     *\n+     * This id may change when user re-installs the app or does a factory reset.\n+     */\n+    public static String getDeviceIdentifier(Context context) {\n+        if (uuid == null) {\n+            synchronized (DeviceIdentifier.class) {\n+                if (uuid == null) {\n+                    SharedPreferences sharedPreferences = PreferenceManager.getDefaultSharedPreferences(context);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "78fef8f0b4788e2dd6b5b650083dea2aa454ef6b"}, "originalPosition": 28}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "91a7ebebf14177c629a6e3025abf01b8c654047c", "author": {"user": {"login": "ShivamPokhriyal", "name": "Shivam Pokhriyal"}}, "url": "https://github.com/dimagi/commcare-android/commit/91a7ebebf14177c629a6e3025abf01b8c654047c", "committedDate": "2020-02-14T12:43:45Z", "message": "Update compile and target sdk version to 29"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "765d2145c1cccd8783e54139123b2464c086425f", "author": {"user": {"login": "ShivamPokhriyal", "name": "Shivam Pokhriyal"}}, "url": "https://github.com/dimagi/commcare-android/commit/765d2145c1cccd8783e54139123b2464c086425f", "committedDate": "2020-02-14T12:43:45Z", "message": "Deprecate getting phone IMEI since it gives SecurityException"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c5c5930378fcaa656206daaaa79771760e2d4f95", "author": {"user": {"login": "ShivamPokhriyal", "name": "Shivam Pokhriyal"}}, "url": "https://github.com/dimagi/commcare-android/commit/c5c5930378fcaa656206daaaa79771760e2d4f95", "committedDate": "2020-02-14T12:43:45Z", "message": "Temporarily opt-out of scoped storage till we add full support"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "572ad9f18b9d3bd11802dec523136e57dd11e919", "author": {"user": {"login": "ShivamPokhriyal", "name": "Shivam Pokhriyal"}}, "url": "https://github.com/dimagi/commcare-android/commit/572ad9f18b9d3bd11802dec523136e57dd11e919", "committedDate": "2020-02-14T12:43:45Z", "message": "Fix a crash where we added video using MediaStore.Audio contentValues"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c8f22b98c4a8dd174f5a35ef5a843ce7f3acc76f", "author": {"user": {"login": "ShivamPokhriyal", "name": "Shivam Pokhriyal"}}, "url": "https://github.com/dimagi/commcare-android/commit/c8f22b98c4a8dd174f5a35ef5a843ce7f3acc76f", "committedDate": "2020-02-14T12:43:45Z", "message": "Use random UUID as a unique device identifier"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "26a3e8cf05df4a52e6bd43463e33347537b5e742", "author": {"user": {"login": "ShivamPokhriyal", "name": "Shivam Pokhriyal"}}, "url": "https://github.com/dimagi/commcare-android/commit/26a3e8cf05df4a52e6bd43463e33347537b5e742", "committedDate": "2020-02-14T12:43:45Z", "message": "Use androidX PreferenceManager\n\nandroid.preference.PreferenceManager is deprecated in API level 29 so updating to the androidX implementation"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a2907d6428e80be71c5ed65ded47a0ea412cd544", "author": {"user": {"login": "ShivamPokhriyal", "name": "Shivam Pokhriyal"}}, "url": "https://github.com/dimagi/commcare-android/commit/a2907d6428e80be71c5ed65ded47a0ea412cd544", "committedDate": "2020-02-14T12:43:45Z", "message": "Fix failing tests by hardcoding deviceId"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "4fa2268471b18ad8483d037bcb4e15fa17c3367f", "author": {"user": {"login": "ShivamPokhriyal", "name": "Shivam Pokhriyal"}}, "url": "https://github.com/dimagi/commcare-android/commit/4fa2268471b18ad8483d037bcb4e15fa17c3367f", "committedDate": "2020-02-14T11:03:29Z", "message": "Improve URI to filepath conversion"}, "afterCommit": {"oid": "a2907d6428e80be71c5ed65ded47a0ea412cd544", "author": {"user": {"login": "ShivamPokhriyal", "name": "Shivam Pokhriyal"}}, "url": "https://github.com/dimagi/commcare-android/commit/a2907d6428e80be71c5ed65ded47a0ea412cd544", "committedDate": "2020-02-14T12:43:45Z", "message": "Fix failing tests by hardcoding deviceId"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e204cda43f56302be8fb968e0f9f6528feaeb127", "author": {"user": {"login": "ShivamPokhriyal", "name": "Shivam Pokhriyal"}}, "url": "https://github.com/dimagi/commcare-android/commit/e204cda43f56302be8fb968e0f9f6528feaeb127", "committedDate": "2020-02-16T13:42:35Z", "message": "Add soft assert logs where external storage directory is used"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "614e927891fab52212ee364e453fbc0548af9633", "author": {"user": {"login": "ShivamPokhriyal", "name": "Shivam Pokhriyal"}}, "url": "https://github.com/dimagi/commcare-android/commit/614e927891fab52212ee364e453fbc0548af9633", "committedDate": "2020-02-17T06:36:54Z", "message": "Remove saving redundant media to content providers"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzYzOTUwNjU2", "url": "https://github.com/dimagi/commcare-android/pull/2176#pullrequestreview-363950656", "createdAt": "2020-02-25T08:35:59Z", "commit": {"oid": "614e927891fab52212ee364e453fbc0548af9633"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yNVQwODozNTo1OVrOFt8xzg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yNVQwODo0MDoxMVrOFt86Dg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MzcyNjAzMA==", "bodyText": "It seems like this path will definitely get hit if someone is using this functionality. So there is no point in adding soft assert here and we will likely need to disable this functionality in Android 11 if there is no other alternate provided in Android 11 for file searching.", "url": "https://github.com/dimagi/commcare-android/pull/2176#discussion_r383726030", "createdAt": "2020-02-25T08:35:59Z", "author": {"login": "shubham1g5"}, "path": "app/src/org/commcare/activities/MultimediaInflaterActivity.java", "diffHunk": "@@ -162,6 +164,7 @@ private void searchForDefault() {\n \r\n         if (Environment.MEDIA_MOUNTED.equals(Environment.getExternalStorageState()) ||\r\n                 Environment.MEDIA_MOUNTED_READ_ONLY.equals(Environment.getExternalStorageState())) {\r\n+            Logger.log(LogTypes.SOFT_ASSERT, \"Access outside scoped storage in searching zip file\");\r", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "614e927891fab52212ee364e453fbc0548af9633"}, "originalPosition": 17}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MzcyNjQzOA==", "bodyText": "We can remove this soft assert as well as this path will definitely get hit for someone using this functionality,", "url": "https://github.com/dimagi/commcare-android/pull/2176#discussion_r383726438", "createdAt": "2020-02-25T08:36:45Z", "author": {"login": "shubham1g5"}, "path": "app/src/org/commcare/recovery/measures/ScanCczTask.java", "diffHunk": "@@ -94,6 +96,7 @@ private void locateAppCcz(File[] files, int depth) {\n         if (!StringUtils.isEmpty(lastKnownCczLocation)) {\n             filePathsToScan.add(new File(lastKnownCczLocation));\n         }\n+        Logger.log(LogTypes.SOFT_ASSERT, \"Access outside scoped storage in scanning cczs.\");", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "614e927891fab52212ee364e453fbc0548af9633"}, "originalPosition": 14}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MzcyODE0Mg==", "bodyText": "there are 2 nested if here with uuid == null check. Is there a particular reason behind that ?", "url": "https://github.com/dimagi/commcare-android/pull/2176#discussion_r383728142", "createdAt": "2020-02-25T08:40:11Z", "author": {"login": "shubham1g5"}, "path": "app/src/org/commcare/utils/DeviceIdentifier.java", "diffHunk": "@@ -0,0 +1,41 @@\n+package org.commcare.utils;\n+\n+import android.content.Context;\n+import android.content.SharedPreferences;\n+import androidx.preference.PreferenceManager;\n+import java.util.UUID;\n+\n+/**\n+ * A Utility to get a unique identifier for app's installation.\n+ * @author $|-|!\u02c5@M\n+ */\n+public final class DeviceIdentifier {\n+\n+    private static volatile String uuid;\n+    private static final String PREFIX = \"commcare_\";\n+    private static final String KEY_DEVICE_IDENTIFIER = \"commcare_device_id\";\n+\n+    /**\n+     * Returns a unique(very highly likely) identifier for this device.\n+     * This identifier is prefixed with \"commcare_\"\n+     *\n+     * This id may change when user re-installs the app or does a factory reset.\n+     */\n+    public static String getDeviceIdentifier(Context context) {\n+        if (uuid == null) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "614e927891fab52212ee364e453fbc0548af9633"}, "originalPosition": 25}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "0229a29967de8a0d643f48cb331ab80b5d1a3210", "author": {"user": {"login": "ShivamPokhriyal", "name": "Shivam Pokhriyal"}}, "url": "https://github.com/dimagi/commcare-android/commit/0229a29967de8a0d643f48cb331ab80b5d1a3210", "committedDate": "2020-02-25T09:47:15Z", "message": "Remove soft asserts from paths that will definitely get hit"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzY0MDE2NzQx", "url": "https://github.com/dimagi/commcare-android/pull/2176#pullrequestreview-364016741", "createdAt": "2020-02-25T10:09:15Z", "commit": {"oid": "0229a29967de8a0d643f48cb331ab80b5d1a3210"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzY0MDE4ODMz", "url": "https://github.com/dimagi/commcare-android/pull/2176#pullrequestreview-364018833", "createdAt": "2020-02-25T10:12:18Z", "commit": {"oid": "0229a29967de8a0d643f48cb331ab80b5d1a3210"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yNVQxMDoxMjoxOFrOFuAJMw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yNVQxMDoxMjoxOFrOFuAJMw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4Mzc4MTE3MQ==", "bodyText": "@ctsims  Goint to merge this to go ahead with code freeze though can you review this class and see the device identifier makes sense to you.", "url": "https://github.com/dimagi/commcare-android/pull/2176#discussion_r383781171", "createdAt": "2020-02-25T10:12:18Z", "author": {"login": "shubham1g5"}, "path": "app/src/org/commcare/utils/DeviceIdentifier.java", "diffHunk": "@@ -0,0 +1,41 @@\n+package org.commcare.utils;\n+\n+import android.content.Context;\n+import android.content.SharedPreferences;\n+import androidx.preference.PreferenceManager;\n+import java.util.UUID;\n+\n+/**\n+ * A Utility to get a unique identifier for app's installation.\n+ * @author $|-|!\u02c5@M\n+ */\n+public final class DeviceIdentifier {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "0229a29967de8a0d643f48cb331ab80b5d1a3210"}, "originalPosition": 12}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2123, "cost": 1, "resetAt": "2021-11-01T13:51:04Z"}}}