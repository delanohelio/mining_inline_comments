{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDkyNDE5OTUy", "number": 2358, "title": "Add fixtures test", "bodyText": "Added FixtureTest from calabash to espresso.", "createdAt": "2020-09-24T12:43:31Z", "url": "https://github.com/dimagi/commcare-android/pull/2358", "merged": true, "mergeCommit": {"oid": "c980ea615df1fc739767ab1bcbbecd64175437f5"}, "closed": true, "closedAt": "2020-09-29T10:51:38Z", "author": {"login": "ShivamPokhriyal"}, "timelineItems": {"totalCount": 10, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdMAi8vAH2gAyNDkyNDE5OTUyOmQ2OTM3ZjkwNWRjM2NiZjNiYWFlZDA0MWY1YTVlZjVhNmIwZmIzOTA=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdNl5-qAFqTQ5ODM0MjEwNA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "d6937f905dc3cbf3baaed041f5a5ef5a6b0fb390", "author": {"user": {"login": "ShivamPokhriyal", "name": "Shivam Pokhriyal"}}, "url": "https://github.com/dimagi/commcare-android/commit/d6937f905dc3cbf3baaed041f5a5ef5a6b0fb390", "committedDate": "2020-09-24T12:42:30Z", "message": "Add fixtures test"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDk1NTI5NzIz", "url": "https://github.com/dimagi/commcare-android/pull/2358#pullrequestreview-495529723", "createdAt": "2020-09-24T12:43:51Z", "commit": {"oid": "d6937f905dc3cbf3baaed041f5a5ef5a6b0fb390"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yNFQxMjo0Mzo1MVrOHXY0BQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yNFQxMjo0Mzo1MVrOHXY0BQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NDI4NTgyOQ==", "bodyText": "This should fail on master right now.", "url": "https://github.com/dimagi/commcare-android/pull/2358#discussion_r494285829", "createdAt": "2020-09-24T12:43:51Z", "author": {"login": "ShivamPokhriyal"}, "path": "app/instrumentation-tests/src/org/commcare/androidTests/FixturesTest.kt", "diffHunk": "@@ -0,0 +1,166 @@\n+package org.commcare.androidTests\n+\n+import androidx.test.espresso.Espresso.onView\n+import androidx.test.espresso.action.ViewActions.click\n+import androidx.test.espresso.assertion.ViewAssertions.doesNotExist\n+import androidx.test.espresso.assertion.ViewAssertions.matches\n+import androidx.test.espresso.matcher.ViewMatchers.*\n+import androidx.test.ext.junit.runners.AndroidJUnit4\n+import androidx.test.filters.LargeTest\n+import org.commcare.dalvik.R\n+import org.commcare.utils.CustomMatchers\n+import org.commcare.utils.InstrumentationUtility\n+import org.hamcrest.Matchers.*\n+import org.junit.Before\n+import org.junit.Test\n+import org.junit.runner.RunWith\n+\n+@RunWith(AndroidJUnit4::class)\n+@LargeTest\n+class FixturesTest: BaseTest() {\n+\n+    companion object {\n+        const val CCZ_NAME = \"fixtures.ccz\"\n+        const val APP_NAME = \"Fixtures\"\n+    }\n+\n+    @Before\n+    fun setup() {\n+        installApp(APP_NAME, CCZ_NAME)\n+    }\n+\n+    @Test\n+    fun testMissingFixture_throwsError() {\n+        InstrumentationUtility.login(\"fixtures_fails\", \"123\")\n+        openFixtureForm()\n+        onView(withId(R.id.nav_btn_next))\n+                .perform(click())\n+        onView(withText(\"Error Occurred\"))\n+                .check(matches(isDisplayed()))\n+        onView(withText(startsWith(\"Make sure the 'Test' lookup table is available\")))\n+                .check(matches(isDisplayed()))\n+    }\n+\n+    @Test\n+    fun testFixturesWork() {\n+        InstrumentationUtility.login(\"fixtures_works\", \"123\")\n+        openFixtureForm_andSelectFirstTwoCheckboxes()\n+        onView(withText(\"Essex\"))\n+                .perform(click())\n+        onView(withId(R.id.nav_btn_next))\n+                .perform(click())\n+        onView(withText(\"Saugus\"))\n+                .perform(click())\n+        onView(withId(R.id.nav_btn_finish))\n+                .perform(click())\n+        onView(withText(\"Saved\"))\n+                .perform(click())\n+        onView(withText(\"Fixtures Form\"))\n+                .perform(click())\n+        onView(withText(\"3 3 \"))\n+                .check(matches(isDisplayed()))\n+        onView(withText(\"Essex\"))\n+                .check(matches(isDisplayed()))\n+        onView(withText(\"Saugus\"))\n+                .check(matches(isDisplayed()))\n+    }\n+\n+    @Test\n+    fun testFixtureFiltering() {\n+        InstrumentationUtility.login(\"fixtures_works\", \"123\")\n+        openFixtureForm_andSelectFirstTwoCheckboxes()\n+        // Proceed without selecting country\n+        onView(withId(R.id.nav_btn_next))\n+                .perform(click())\n+        // confirm you don't see any radio button now to select a city.\n+        onView(withClassName(endsWith(\"RadioButton\")))\n+                .check(doesNotExist())\n+\n+        // Go back now and pick a country and confirm the cities are filtered.\n+        onView(withId(R.id.nav_btn_prev))\n+                .perform(click())\n+        onView(withText(\"Essex\"))\n+                .perform(click())\n+        onView(withId(R.id.nav_btn_next))\n+                .perform(click())\n+        onView(withText(\"Saugus\"))\n+                .check(matches(isDisplayed()))\n+        onView(withText(\"Andover\"))\n+                .check(matches(isDisplayed()))\n+\n+        onView(withId(R.id.nav_btn_prev))\n+                .perform(click())\n+        onView(withText(\"Middlesex\"))\n+                .perform(click())\n+        onView(withId(R.id.nav_btn_next))\n+                .perform(click())\n+        onView(withText(\"Cambridge\"))\n+                .check(matches(isDisplayed()))\n+        onView(withText(\"Wilmington\"))\n+                .check(matches(isDisplayed()))\n+        onView(withText(\"Billerica\"))\n+                .check(matches(isDisplayed()))\n+\n+        onView(withId(R.id.nav_btn_prev))\n+                .perform(click())\n+        onView(withText(\"Suffolk\"))\n+                .perform(click())\n+        onView(withId(R.id.nav_btn_next))\n+                .perform(click())\n+        onView(withText(\"Boston\"))\n+                .check(matches(isDisplayed()))\n+        onView(withText(\"Winthrop\"))\n+                .check(matches(isDisplayed()))\n+\n+        onView(withText(\"Boston\"))\n+                .perform(click())\n+        onView(withId(R.id.nav_btn_finish))\n+                .perform(click())\n+    }\n+\n+    @Test\n+    fun testFixture_with1Mb_works() {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d6937f905dc3cbf3baaed041f5a5ef5a6b0fb390"}, "originalPosition": 122}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDk2MTQ2NDE4", "url": "https://github.com/dimagi/commcare-android/pull/2358#pullrequestreview-496146418", "createdAt": "2020-09-25T06:39:06Z", "commit": {"oid": "d6937f905dc3cbf3baaed041f5a5ef5a6b0fb390"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yNVQwNjozOTowNlrOHX22pg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yNVQwNjozOTowNlrOHX22pg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NDc3ODAyMg==", "bodyText": "both next and prev navigations can be encapsulated into functions so that if we ever change the view id of buttons, we only need to change the ui tests in one place.", "url": "https://github.com/dimagi/commcare-android/pull/2358#discussion_r494778022", "createdAt": "2020-09-25T06:39:06Z", "author": {"login": "shubham1g5"}, "path": "app/instrumentation-tests/src/org/commcare/androidTests/FixturesTest.kt", "diffHunk": "@@ -0,0 +1,166 @@\n+package org.commcare.androidTests\n+\n+import androidx.test.espresso.Espresso.onView\n+import androidx.test.espresso.action.ViewActions.click\n+import androidx.test.espresso.assertion.ViewAssertions.doesNotExist\n+import androidx.test.espresso.assertion.ViewAssertions.matches\n+import androidx.test.espresso.matcher.ViewMatchers.*\n+import androidx.test.ext.junit.runners.AndroidJUnit4\n+import androidx.test.filters.LargeTest\n+import org.commcare.dalvik.R\n+import org.commcare.utils.CustomMatchers\n+import org.commcare.utils.InstrumentationUtility\n+import org.hamcrest.Matchers.*\n+import org.junit.Before\n+import org.junit.Test\n+import org.junit.runner.RunWith\n+\n+@RunWith(AndroidJUnit4::class)\n+@LargeTest\n+class FixturesTest: BaseTest() {\n+\n+    companion object {\n+        const val CCZ_NAME = \"fixtures.ccz\"\n+        const val APP_NAME = \"Fixtures\"\n+    }\n+\n+    @Before\n+    fun setup() {\n+        installApp(APP_NAME, CCZ_NAME)\n+    }\n+\n+    @Test\n+    fun testMissingFixture_throwsError() {\n+        InstrumentationUtility.login(\"fixtures_fails\", \"123\")\n+        openFixtureForm()\n+        onView(withId(R.id.nav_btn_next))\n+                .perform(click())\n+        onView(withText(\"Error Occurred\"))\n+                .check(matches(isDisplayed()))\n+        onView(withText(startsWith(\"Make sure the 'Test' lookup table is available\")))\n+                .check(matches(isDisplayed()))\n+    }\n+\n+    @Test\n+    fun testFixturesWork() {\n+        InstrumentationUtility.login(\"fixtures_works\", \"123\")\n+        openFixtureForm_andSelectFirstTwoCheckboxes()\n+        onView(withText(\"Essex\"))\n+                .perform(click())\n+        onView(withId(R.id.nav_btn_next))", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d6937f905dc3cbf3baaed041f5a5ef5a6b0fb390"}, "originalPosition": 50}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDk2MTQ2NzAz", "url": "https://github.com/dimagi/commcare-android/pull/2358#pullrequestreview-496146703", "createdAt": "2020-09-25T06:39:40Z", "commit": {"oid": "d6937f905dc3cbf3baaed041f5a5ef5a6b0fb390"}, "state": "DISMISSED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "42e40ea3369a3dad91e880d7ce71e20764258a04", "author": {"user": {"login": "ShivamPokhriyal", "name": "Shivam Pokhriyal"}}, "url": "https://github.com/dimagi/commcare-android/commit/42e40ea3369a3dad91e880d7ce71e20764258a04", "committedDate": "2020-09-28T07:38:51Z", "message": "Merge branch 'master' into fixture-test"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "171f1c236e5f598a0a1c4a4e8f1a0fd42002a1b1", "author": {"user": {"login": "ShivamPokhriyal", "name": "Shivam Pokhriyal"}}, "url": "https://github.com/dimagi/commcare-android/commit/171f1c236e5f598a0a1c4a4e8f1a0fd42002a1b1", "committedDate": "2020-09-28T11:54:09Z", "message": "Merge branch 'master' into fixture-test"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "06360d09183d05ce0dee0a3f0b32ce826ca21914", "author": {"user": {"login": "ShivamPokhriyal", "name": "Shivam Pokhriyal"}}, "url": "https://github.com/dimagi/commcare-android/commit/06360d09183d05ce0dee0a3f0b32ce826ca21914", "committedDate": "2020-09-28T13:33:59Z", "message": "Fix 1mb fixture test"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDk3NTM2NDc4", "url": "https://github.com/dimagi/commcare-android/pull/2358#pullrequestreview-497536478", "createdAt": "2020-09-28T13:55:04Z", "commit": {"oid": "06360d09183d05ce0dee0a3f0b32ce826ca21914"}, "state": "DISMISSED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c7e3aff8f7a800ea70f1695ca2d8e20d57d40f5c", "author": {"user": {"login": "ShivamPokhriyal", "name": "Shivam Pokhriyal"}}, "url": "https://github.com/dimagi/commcare-android/commit/c7e3aff8f7a800ea70f1695ca2d8e20d57d40f5c", "committedDate": "2020-09-29T06:11:52Z", "message": "Fix Ambigious View matcher exception\n\nwith text: a string starting with 'Increase Enalapril' matches multiple views in the hierarchy causing the tests to fail."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDk4MzQyMTA0", "url": "https://github.com/dimagi/commcare-android/pull/2358#pullrequestreview-498342104", "createdAt": "2020-09-29T10:48:04Z", "commit": {"oid": "c7e3aff8f7a800ea70f1695ca2d8e20d57d40f5c"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1943, "cost": 1, "resetAt": "2021-11-01T13:51:04Z"}}}