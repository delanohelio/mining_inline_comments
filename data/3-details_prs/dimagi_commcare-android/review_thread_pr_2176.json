{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0MzY2NzkwNjU0", "number": 2176, "reviewThreads": {"totalCount": 12, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0yN1QwNjowOTowNlrODaxX1w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yNVQxMDoxMjoxOFrODipBRQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjI5Mzk4NDg3OnYy", "diffSide": "RIGHT", "path": "app/src/org/commcare/CommCareApplication.java", "isResolved": false, "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0yN1QwNjowOTowNlrOFh4j8w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0zMFQxMjo1NzoyM1rOFjp9tQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MTA3NDAzNQ==", "bodyText": "Not Sure about the use-case of this particular method, but it won't work with android 10.\nAndroid best practices suggest See 3rd option using either a random UUID(we'll have to save it in preferences to make sure it doesn't change) or Firebase Instance ID(read here).\nThough both of them have a drawback: if application is reinstalled or user clears app data then the id will be lost and a new id will be generated.\nLet me know, if this is something important and should we use one of the above approaches to get a id.", "url": "https://github.com/dimagi/commcare-android/pull/2176#discussion_r371074035", "createdAt": "2020-01-27T06:09:06Z", "author": {"login": "ShivamPokhriyal"}, "path": "app/src/org/commcare/CommCareApplication.java", "diffHunk": "@@ -410,20 +410,27 @@ public void initializeGlobalResources(CommCareApp app) {\n     }\r\n \r\n     @NonNull\r\n+    @Deprecated\r\n     public String getPhoneId() {\r", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "4de4064d9bc8a1df5eb88471faea6bb610933f6d"}, "originalPosition": 5}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MTc0OTYzMw==", "bodyText": "So deviceId was useful to identify the 2 separate installations of the app. I think using Firebase Instance Id seems like a good workaround here to separate out the installations as we don't have any other id currently that we maintain that's unique per CC installation.", "url": "https://github.com/dimagi/commcare-android/pull/2176#discussion_r371749633", "createdAt": "2020-01-28T11:33:41Z", "author": {"login": "shubham1g5"}, "path": "app/src/org/commcare/CommCareApplication.java", "diffHunk": "@@ -410,20 +410,27 @@ public void initializeGlobalResources(CommCareApp app) {\n     }\r\n \r\n     @NonNull\r\n+    @Deprecated\r\n     public String getPhoneId() {\r", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MTA3NDAzNQ=="}, "originalCommit": {"oid": "4de4064d9bc8a1df5eb88471faea6bb610933f6d"}, "originalPosition": 5}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MjkzMjAyMQ==", "bodyText": "That's annoying, although I suppose it makes sense against the backdrop of other changes.\nMy vote is for a random ID we set on first install (and probably/potentially prefix with an identifier that lets us see that it's different from other device ID's) rather than a Firebase ID. It's not clear to me that it's good practice for us to get dependent on firebase features for apps which we don't want communicating metadata up to us (like apps with analytics disabled) and I could imagine rules about using firebase features like that also evolving in ways that force changes.", "url": "https://github.com/dimagi/commcare-android/pull/2176#discussion_r372932021", "createdAt": "2020-01-30T12:57:23Z", "author": {"login": "ctsims"}, "path": "app/src/org/commcare/CommCareApplication.java", "diffHunk": "@@ -410,20 +410,27 @@ public void initializeGlobalResources(CommCareApp app) {\n     }\r\n \r\n     @NonNull\r\n+    @Deprecated\r\n     public String getPhoneId() {\r", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MTA3NDAzNQ=="}, "originalCommit": {"oid": "4de4064d9bc8a1df5eb88471faea6bb610933f6d"}, "originalPosition": 5}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjI5NDQ2MTcwOnYy", "diffSide": "RIGHT", "path": "app/AndroidManifest.xml", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0yN1QwOTo1MjozOFrOFh84TQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0yOFQxMToyNjo0MVrOFihnww==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MTE0NDc4MQ==", "bodyText": "Read here for more information :: https://developer.android.com/training/data-storage#scoped-storage\nIf not enabled, this method throws error https://github.com/dimagi/commcare-android/blob/master/app/src/org/commcare/models/ODKStorage.java#L22\nGet better idea of the issue : https://issuetracker.google.com/issues/128591846", "url": "https://github.com/dimagi/commcare-android/pull/2176#discussion_r371144781", "createdAt": "2020-01-27T09:52:38Z", "author": {"login": "ShivamPokhriyal"}, "path": "app/AndroidManifest.xml", "diffHunk": "@@ -64,6 +64,7 @@\n         android:label=\"@string/application_name\"\n         android:hardwareAccelerated=\"true\"\n         android:usesCleartextTraffic=\"true\"\n+        android:requestLegacyExternalStorage=\"true\"", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "4a7bdda28d2b3e45705db6becd8b43bb5f6316fd"}, "originalPosition": 4}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MTc0Njc1NQ==", "bodyText": "For Android 10 adding this sounds good. Though we should add Soft asserts log  statements to the code paths that we identified that were still accesing code paths. So that we know in future if they are indeed getting hit or not.", "url": "https://github.com/dimagi/commcare-android/pull/2176#discussion_r371746755", "createdAt": "2020-01-28T11:26:41Z", "author": {"login": "shubham1g5"}, "path": "app/AndroidManifest.xml", "diffHunk": "@@ -64,6 +64,7 @@\n         android:label=\"@string/application_name\"\n         android:hardwareAccelerated=\"true\"\n         android:usesCleartextTraffic=\"true\"\n+        android:requestLegacyExternalStorage=\"true\"", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MTE0NDc4MQ=="}, "originalCommit": {"oid": "4a7bdda28d2b3e45705db6becd8b43bb5f6316fd"}, "originalPosition": 4}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjI5NzUzNDUyOnYy", "diffSide": "RIGHT", "path": "app/AndroidManifest.xml", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0yOFQwNjowODozM1rOFiaFVw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0zMFQxMzowMDo1M1rOFjqD5w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MTYyMzI1NQ==", "bodyText": "Also, https://github.com/dimagi/commcare-android/blob/master/app/src/org/commcare/utils/MediaUtil.java#L500 BitmapFactory decodeFile fails if we try and decode the image chosen from gallery.", "url": "https://github.com/dimagi/commcare-android/pull/2176#discussion_r371623255", "createdAt": "2020-01-28T06:08:33Z", "author": {"login": "ShivamPokhriyal"}, "path": "app/AndroidManifest.xml", "diffHunk": "@@ -64,6 +64,7 @@\n         android:label=\"@string/application_name\"\n         android:hardwareAccelerated=\"true\"\n         android:usesCleartextTraffic=\"true\"\n+        android:requestLegacyExternalStorage=\"true\"", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "4a7bdda28d2b3e45705db6becd8b43bb5f6316fd"}, "originalPosition": 4}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MjkzMzYwNw==", "bodyText": "We likely need to explicitly request permissions to the filepath beforehand the same way that we now do for things like camera widget capture. I think Shubham reviewed usage of File handles previously, but some of these places where raw paths are used likely didn't get caught.", "url": "https://github.com/dimagi/commcare-android/pull/2176#discussion_r372933607", "createdAt": "2020-01-30T13:00:53Z", "author": {"login": "ctsims"}, "path": "app/AndroidManifest.xml", "diffHunk": "@@ -64,6 +64,7 @@\n         android:label=\"@string/application_name\"\n         android:hardwareAccelerated=\"true\"\n         android:usesCleartextTraffic=\"true\"\n+        android:requestLegacyExternalStorage=\"true\"", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MTYyMzI1NQ=="}, "originalCommit": {"oid": "4a7bdda28d2b3e45705db6becd8b43bb5f6316fd"}, "originalPosition": 4}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjI5ODI2MTU0OnYy", "diffSide": "LEFT", "path": "app/src/org/commcare/views/widgets/MediaWidget.java", "isResolved": false, "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0yOFQxMTowMToxNFrOFig-oQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0zMFQxMjo1OTo0MVrOFjqB2w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MTczNjIyNQ==", "bodyText": "Though I'm not sure whether we should be adding all the files to the content provider.\nIMO, it makes sense for the video that are recorded using the record button in app, but for videos that are chosen from gallery, we just make a copy of that inside our app's directory so if we add it to content provider there'll be 2 copies of the same video shown to the user in the gallery app.", "url": "https://github.com/dimagi/commcare-android/pull/2176#discussion_r371736225", "createdAt": "2020-01-28T11:01:14Z", "author": {"login": "ShivamPokhriyal"}, "path": "app/src/org/commcare/views/widgets/MediaWidget.java", "diffHunk": "@@ -237,21 +235,12 @@ public void setBinaryData(Object binaryuri) {\n             }\n         }\n \n-        if (newMedia.exists()) {\n-            // Add the copy to the content provider", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ce3eda49affec893200ab103d1affaeaf57f0c54"}, "originalPosition": 17}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MTc1OTYzMA==", "bodyText": "Agree that we should not save it to content Providers. @ctsims we did remove it for Images sometime back in here, so guessing no objections in removing them for audio and videos as well.", "url": "https://github.com/dimagi/commcare-android/pull/2176#discussion_r371759630", "createdAt": "2020-01-28T11:57:18Z", "author": {"login": "shubham1g5"}, "path": "app/src/org/commcare/views/widgets/MediaWidget.java", "diffHunk": "@@ -237,21 +235,12 @@ public void setBinaryData(Object binaryuri) {\n             }\n         }\n \n-        if (newMedia.exists()) {\n-            // Add the copy to the content provider", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MTczNjIyNQ=="}, "originalCommit": {"oid": "ce3eda49affec893200ab103d1affaeaf57f0c54"}, "originalPosition": 17}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MjkzMzA4Mw==", "bodyText": "Totally agree that we should remove adding stuff to the content provider. That was old, weird ODK behavior that I think is harmful.", "url": "https://github.com/dimagi/commcare-android/pull/2176#discussion_r372933083", "createdAt": "2020-01-30T12:59:41Z", "author": {"login": "ctsims"}, "path": "app/src/org/commcare/views/widgets/MediaWidget.java", "diffHunk": "@@ -237,21 +235,12 @@ public void setBinaryData(Object binaryuri) {\n             }\n         }\n \n-        if (newMedia.exists()) {\n-            // Add the copy to the content provider", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MTczNjIyNQ=="}, "originalCommit": {"oid": "ce3eda49affec893200ab103d1affaeaf57f0c54"}, "originalPosition": 17}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjI5ODI2MzkxOnYy", "diffSide": "LEFT", "path": "app/src/org/commcare/views/widgets/MediaWidget.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0yOFQxMTowMTo1NVrOFig_9Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0yOFQxMTowMTo1NVrOFig_9Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MTczNjU2NQ==", "bodyText": "PS: Though, this change will only prevent crashes and won't change the earlier behaviour.", "url": "https://github.com/dimagi/commcare-android/pull/2176#discussion_r371736565", "createdAt": "2020-01-28T11:01:55Z", "author": {"login": "ShivamPokhriyal"}, "path": "app/src/org/commcare/views/widgets/MediaWidget.java", "diffHunk": "@@ -237,21 +235,12 @@ public void setBinaryData(Object binaryuri) {\n             }\n         }\n \n-        if (newMedia.exists()) {\n-            // Add the copy to the content provider", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ce3eda49affec893200ab103d1affaeaf57f0c54"}, "originalPosition": 17}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjI5ODM1MjUyOnYy", "diffSide": "RIGHT", "path": "app/src/org/commcare/utils/MediaUtil.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0yOFQxMTozNToyNlrOFih1mw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0yOFQxMTozNToyNlrOFih1mw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MTc1MDI5OQ==", "bodyText": "Thanks for looking at it as part of this work. Though if it isn't realted to Android 10 work, would be nice to separate this out in another PR so that it's easy to revert in case of any edge cases.", "url": "https://github.com/dimagi/commcare-android/pull/2176#discussion_r371750299", "createdAt": "2020-01-28T11:35:26Z", "author": {"login": "shubham1g5"}, "path": "app/src/org/commcare/utils/MediaUtil.java", "diffHunk": "@@ -414,7 +414,7 @@ private static int getApproxScaleDownFactor(int newWidth, int originalWidth) {\n         double widthScaleDownFactor =  (double)boundingWidth / originalWidth;\r\n         // Choosing the larger of the scale down factors, so that the image still fills the entire\r\n         // container\r\n-        double dominantScaleDownFactor = Math.max(widthScaleDownFactor, heightScaleDownFactor);\r\n+        double dominantScaleDownFactor = Math.min(widthScaleDownFactor, heightScaleDownFactor);\r", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "0b0e3927dcc27eae881a90f5b96e993e208b4fe4"}, "originalPosition": 5}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjI5ODQxNTYwOnYy", "diffSide": "RIGHT", "path": "app/src/org/commcare/views/widgets/MediaWidget.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0yOFQxMTo1Nzo1MVrOFiia8A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0yOFQxMTo1Nzo1MVrOFiia8A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MTc1OTg1Ng==", "bodyText": "We should let the app crash in case of exceptions here if we are going to retain this functionality.", "url": "https://github.com/dimagi/commcare-android/pull/2176#discussion_r371759856", "createdAt": "2020-01-28T11:57:51Z", "author": {"login": "shubham1g5"}, "path": "app/src/org/commcare/views/widgets/MediaWidget.java", "diffHunk": "@@ -237,21 +235,12 @@ public void setBinaryData(Object binaryuri) {\n             }\n         }\n \n-        if (newMedia.exists()) {\n-            // Add the copy to the content provider\n-            ContentValues values = new ContentValues(6);\n-            values.put(MediaStore.Audio.Media.TITLE, newMedia.getName());\n-            values.put(MediaStore.Audio.Media.DISPLAY_NAME, newMedia.getName());\n-            values.put(MediaStore.Audio.Media.DATE_ADDED, System.currentTimeMillis());\n-            values.put(MediaStore.Audio.Media.DATA, newMedia.getAbsolutePath());\n-\n-            Uri mediaUri =\n-                    getContext().getContentResolver().insert(MediaStore.Audio.Media.EXTERNAL_CONTENT_URI, values);\n-            String mediaUriString = mediaUri == null ? \"null\" : mediaUri.toString();\n-            Log.i(TAG, \"Inserting media returned uri = \" + mediaUriString);\n+        try {\n+            FileUtil.addMediaToGallery(getContext(), newMedia);\n             showToast(\"form.attachment.success\");\n-        } else {\n+        } catch (Exception e) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "0b0e3927dcc27eae881a90f5b96e993e208b4fe4"}, "originalPosition": 32}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjMzMjAwMzI1OnYy", "diffSide": "RIGHT", "path": "app/src/org/commcare/utils/DeviceIdentifier.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xMFQxMDoxNDo1OVrOFnggaw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xMFQxMDoxNDo1OVrOFnggaw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3Njk3MTM3MQ==", "bodyText": "Using SharedPreference to store this unique id. We can also choose to create a text file and store UUID to that file. I'm not sure which option is more suitable of the two so using the sharedpreferences approach here.", "url": "https://github.com/dimagi/commcare-android/pull/2176#discussion_r376971371", "createdAt": "2020-02-10T10:14:59Z", "author": {"login": "ShivamPokhriyal"}, "path": "app/src/org/commcare/utils/DeviceIdentifier.java", "diffHunk": "@@ -0,0 +1,41 @@\n+package org.commcare.utils;\n+\n+import android.content.Context;\n+import android.content.SharedPreferences;\n+import androidx.preference.PreferenceManager;\n+import java.util.UUID;\n+\n+/**\n+ * A Utility to get a unique identifier for app's installation.\n+ * @author $|-|!\u02c5@M\n+ */\n+public final class DeviceIdentifier {\n+\n+    private static volatile String uuid;\n+    private static final String PREFIX = \"commcare_\";\n+    private static final String KEY_DEVICE_IDENTIFIER = \"commcare_device_id\";\n+\n+    /**\n+     * Returns a unique(very highly likely) identifier for this device.\n+     * This identifier is prefixed with \"commcare_\"\n+     *\n+     * This id may change when user re-installs the app or does a factory reset.\n+     */\n+    public static String getDeviceIdentifier(Context context) {\n+        if (uuid == null) {\n+            synchronized (DeviceIdentifier.class) {\n+                if (uuid == null) {\n+                    SharedPreferences sharedPreferences = PreferenceManager.getDefaultSharedPreferences(context);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "78fef8f0b4788e2dd6b5b650083dea2aa454ef6b"}, "originalPosition": 28}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjM3NjE1NTM5OnYy", "diffSide": "RIGHT", "path": "app/src/org/commcare/activities/MultimediaInflaterActivity.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yNVQwODozNTo1OVrOFt8xzg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yNVQwODozNTo1OVrOFt8xzg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MzcyNjAzMA==", "bodyText": "It seems like this path will definitely get hit if someone is using this functionality. So there is no point in adding soft assert here and we will likely need to disable this functionality in Android 11 if there is no other alternate provided in Android 11 for file searching.", "url": "https://github.com/dimagi/commcare-android/pull/2176#discussion_r383726030", "createdAt": "2020-02-25T08:35:59Z", "author": {"login": "shubham1g5"}, "path": "app/src/org/commcare/activities/MultimediaInflaterActivity.java", "diffHunk": "@@ -162,6 +164,7 @@ private void searchForDefault() {\n \r\n         if (Environment.MEDIA_MOUNTED.equals(Environment.getExternalStorageState()) ||\r\n                 Environment.MEDIA_MOUNTED_READ_ONLY.equals(Environment.getExternalStorageState())) {\r\n+            Logger.log(LogTypes.SOFT_ASSERT, \"Access outside scoped storage in searching zip file\");\r", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "614e927891fab52212ee364e453fbc0548af9633"}, "originalPosition": 17}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjM3NjE1ODI3OnYy", "diffSide": "RIGHT", "path": "app/src/org/commcare/recovery/measures/ScanCczTask.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yNVQwODozNjo0NVrOFt8zZg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yNVQwODozNjo0NVrOFt8zZg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MzcyNjQzOA==", "bodyText": "We can remove this soft assert as well as this path will definitely get hit for someone using this functionality,", "url": "https://github.com/dimagi/commcare-android/pull/2176#discussion_r383726438", "createdAt": "2020-02-25T08:36:45Z", "author": {"login": "shubham1g5"}, "path": "app/src/org/commcare/recovery/measures/ScanCczTask.java", "diffHunk": "@@ -94,6 +96,7 @@ private void locateAppCcz(File[] files, int depth) {\n         if (!StringUtils.isEmpty(lastKnownCczLocation)) {\n             filePathsToScan.add(new File(lastKnownCczLocation));\n         }\n+        Logger.log(LogTypes.SOFT_ASSERT, \"Access outside scoped storage in scanning cczs.\");", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "614e927891fab52212ee364e453fbc0548af9633"}, "originalPosition": 14}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjM3NjE2OTA5OnYy", "diffSide": "RIGHT", "path": "app/src/org/commcare/utils/DeviceIdentifier.java", "isResolved": false, "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yNVQwODo0MDoxMVrOFt86Dg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yNVQxMDowODozMVrOFuABOQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MzcyODE0Mg==", "bodyText": "there are 2 nested if here with uuid == null check. Is there a particular reason behind that ?", "url": "https://github.com/dimagi/commcare-android/pull/2176#discussion_r383728142", "createdAt": "2020-02-25T08:40:11Z", "author": {"login": "shubham1g5"}, "path": "app/src/org/commcare/utils/DeviceIdentifier.java", "diffHunk": "@@ -0,0 +1,41 @@\n+package org.commcare.utils;\n+\n+import android.content.Context;\n+import android.content.SharedPreferences;\n+import androidx.preference.PreferenceManager;\n+import java.util.UUID;\n+\n+/**\n+ * A Utility to get a unique identifier for app's installation.\n+ * @author $|-|!\u02c5@M\n+ */\n+public final class DeviceIdentifier {\n+\n+    private static volatile String uuid;\n+    private static final String PREFIX = \"commcare_\";\n+    private static final String KEY_DEVICE_IDENTIFIER = \"commcare_device_id\";\n+\n+    /**\n+     * Returns a unique(very highly likely) identifier for this device.\n+     * This identifier is prefixed with \"commcare_\"\n+     *\n+     * This id may change when user re-installs the app or does a factory reset.\n+     */\n+    public static String getDeviceIdentifier(Context context) {\n+        if (uuid == null) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "614e927891fab52212ee364e453fbc0548af9633"}, "originalPosition": 25}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4Mzc2NDE0NQ==", "bodyText": "Yeah, this pattern is also popular as double-checked locking idiom, used to reduce the overhead of acquiring a lock by first testing the locking criterion without actually acquiring the lock.", "url": "https://github.com/dimagi/commcare-android/pull/2176#discussion_r383764145", "createdAt": "2020-02-25T09:43:22Z", "author": {"login": "ShivamPokhriyal"}, "path": "app/src/org/commcare/utils/DeviceIdentifier.java", "diffHunk": "@@ -0,0 +1,41 @@\n+package org.commcare.utils;\n+\n+import android.content.Context;\n+import android.content.SharedPreferences;\n+import androidx.preference.PreferenceManager;\n+import java.util.UUID;\n+\n+/**\n+ * A Utility to get a unique identifier for app's installation.\n+ * @author $|-|!\u02c5@M\n+ */\n+public final class DeviceIdentifier {\n+\n+    private static volatile String uuid;\n+    private static final String PREFIX = \"commcare_\";\n+    private static final String KEY_DEVICE_IDENTIFIER = \"commcare_device_id\";\n+\n+    /**\n+     * Returns a unique(very highly likely) identifier for this device.\n+     * This identifier is prefixed with \"commcare_\"\n+     *\n+     * This id may change when user re-installs the app or does a factory reset.\n+     */\n+    public static String getDeviceIdentifier(Context context) {\n+        if (uuid == null) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MzcyODE0Mg=="}, "originalCommit": {"oid": "614e927891fab52212ee364e453fbc0548af9633"}, "originalPosition": 25}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4Mzc3OTEyOQ==", "bodyText": "Interesting!", "url": "https://github.com/dimagi/commcare-android/pull/2176#discussion_r383779129", "createdAt": "2020-02-25T10:08:31Z", "author": {"login": "shubham1g5"}, "path": "app/src/org/commcare/utils/DeviceIdentifier.java", "diffHunk": "@@ -0,0 +1,41 @@\n+package org.commcare.utils;\n+\n+import android.content.Context;\n+import android.content.SharedPreferences;\n+import androidx.preference.PreferenceManager;\n+import java.util.UUID;\n+\n+/**\n+ * A Utility to get a unique identifier for app's installation.\n+ * @author $|-|!\u02c5@M\n+ */\n+public final class DeviceIdentifier {\n+\n+    private static volatile String uuid;\n+    private static final String PREFIX = \"commcare_\";\n+    private static final String KEY_DEVICE_IDENTIFIER = \"commcare_device_id\";\n+\n+    /**\n+     * Returns a unique(very highly likely) identifier for this device.\n+     * This identifier is prefixed with \"commcare_\"\n+     *\n+     * This id may change when user re-installs the app or does a factory reset.\n+     */\n+    public static String getDeviceIdentifier(Context context) {\n+        if (uuid == null) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MzcyODE0Mg=="}, "originalCommit": {"oid": "614e927891fab52212ee364e453fbc0548af9633"}, "originalPosition": 25}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjM3NjUwMjQ1OnYy", "diffSide": "RIGHT", "path": "app/src/org/commcare/utils/DeviceIdentifier.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yNVQxMDoxMjoxOFrOFuAJMw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yNVQxMDoxMjoxOFrOFuAJMw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4Mzc4MTE3MQ==", "bodyText": "@ctsims  Goint to merge this to go ahead with code freeze though can you review this class and see the device identifier makes sense to you.", "url": "https://github.com/dimagi/commcare-android/pull/2176#discussion_r383781171", "createdAt": "2020-02-25T10:12:18Z", "author": {"login": "shubham1g5"}, "path": "app/src/org/commcare/utils/DeviceIdentifier.java", "diffHunk": "@@ -0,0 +1,41 @@\n+package org.commcare.utils;\n+\n+import android.content.Context;\n+import android.content.SharedPreferences;\n+import androidx.preference.PreferenceManager;\n+import java.util.UUID;\n+\n+/**\n+ * A Utility to get a unique identifier for app's installation.\n+ * @author $|-|!\u02c5@M\n+ */\n+public final class DeviceIdentifier {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "0229a29967de8a0d643f48cb331ab80b5d1a3210"}, "originalPosition": 12}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3320, "cost": 1, "resetAt": "2021-11-12T13:16:51Z"}}}