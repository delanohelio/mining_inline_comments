{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDc5NjQxMDg5", "number": 2338, "title": "[2.48.10 hotfix] Update retry time overflow fix", "bodyText": "Issue: In case numberOfRestarts become greater than 15, the long value 17.8^16 overflows and become negative causing the updates to be retried continuously without any delay.\nAffects CommCare 2.48.[8-9], prior to this we were resetting the update on every 5 trials causing numberOfRestarts to not become greater than 5 ever.\nAlso ports #2219 in 2.48 to fix the debug builds.\nProduct Note: Fixes an issue with CommCare 2.48.8 and CommCare 2.48.9 LTS where updates gets retries continuously without any delay.", "createdAt": "2020-09-04T12:31:23Z", "url": "https://github.com/dimagi/commcare-android/pull/2338", "merged": true, "mergeCommit": {"oid": "17f30a39dd8da0e5699d68029ebde4f8da1caf69"}, "closed": true, "closedAt": "2020-09-04T12:56:53Z", "author": {"login": "shubham1g5"}, "timelineItems": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdFkRgxAH2gAyNDc5NjQxMDg5OmRmMDQzZWY5NmMyZDg2YWQ1MzMxOWMyNmIzODkxZGEwNjcwMzczNjE=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdGeD5DgFqTQ4MzMyMjc1Mg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "df043ef96c2d86ad53319c26b3891da067037361", "author": {"user": {"login": "shubham1g5", "name": "Shubham Goyal"}}, "url": "https://github.com/dimagi/commcare-android/commit/df043ef96c2d86ad53319c26b3891da067037361", "committedDate": "2020-09-04T12:22:34Z", "message": "Port crashlytics debug fix"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "56371f0a95b73cd40c61f73f14424154c1671919", "author": {"user": {"login": "shubham1g5", "name": "Shubham Goyal"}}, "url": "https://github.com/dimagi/commcare-android/commit/56371f0a95b73cd40c61f73f14424154c1671919", "committedDate": "2020-09-04T12:23:31Z", "message": "fixes calculation for exponential delay to not overflow"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDgyNjI3NjUx", "url": "https://github.com/dimagi/commcare-android/pull/2338#pullrequestreview-482627651", "createdAt": "2020-09-04T12:55:57Z", "commit": {"oid": "56371f0a95b73cd40c61f73f14424154c1671919"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDgzMzIyNzUy", "url": "https://github.com/dimagi/commcare-android/pull/2338#pullrequestreview-483322752", "createdAt": "2020-09-07T07:42:08Z", "commit": {"oid": "56371f0a95b73cd40c61f73f14424154c1671919"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0wN1QwNzo0MjowOFrOHNzrFg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0wN1QwNzo0MjowOFrOHNzrFg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NDI0MDE1MA==", "bodyText": "A comment would be helpful for future reference. Are there no tests for this code?", "url": "https://github.com/dimagi/commcare-android/pull/2338#discussion_r484240150", "createdAt": "2020-09-07T07:42:08Z", "author": {"login": "snopoke"}, "path": "app/src/org/commcare/engine/resource/AndroidResourceManager.java", "diffHunk": "@@ -287,11 +287,11 @@ private static boolean canUpdateRetryRun() {\n      * @param numberOfRestarts used as the exponent for the delay calculation\n      * @return delay in MS, which grows exponentially over the number of restarts.\n      */\n-    private long exponentionalRetryDelay(int numberOfRestarts) {\n+    private static long exponentionalRetryDelay(int numberOfRestarts) {\n         final Double base = 10 * (1.78);\n         final long thirtySeconds = 30 * 1000;\n-        long exponentialDelay = thirtySeconds + (long)Math.pow(base, numberOfRestarts);\n-        return Math.min(exponentialDelay, MAX_UPDATE_RETRY_DELAY_IN_MS);\n+        long exponentialDelay = numberOfRestarts < 6 ? thirtySeconds + (long)Math.pow(base, numberOfRestarts) : MAX_UPDATE_RETRY_DELAY_IN_MS;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "56371f0a95b73cd40c61f73f14424154c1671919"}, "originalPosition": 10}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1923, "cost": 1, "resetAt": "2021-11-01T13:51:04Z"}}}