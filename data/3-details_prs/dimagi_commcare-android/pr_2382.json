{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTA1ODQwOTg3", "number": 2382, "title": "Add languages test", "bodyText": "#2341", "createdAt": "2020-10-19T09:51:57Z", "url": "https://github.com/dimagi/commcare-android/pull/2382", "merged": true, "mergeCommit": {"oid": "2af069d4d384d0715a87fdba869ec3b8d8d30488"}, "closed": true, "closedAt": "2020-10-22T10:20:56Z", "author": {"login": "ShivamPokhriyal"}, "timelineItems": {"totalCount": 7, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdUqrRiAFqTUxMzUxMTkwMg==", "endCursor": "Y3Vyc29yOnYyOpPPAAABdU_J5agFqTUxNDU2NzM2MA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTEzNTExOTAy", "url": "https://github.com/dimagi/commcare-android/pull/2382#pullrequestreview-513511902", "createdAt": "2020-10-21T10:04:19Z", "commit": {"oid": "d53d4bbef158d0a2a20b00fb1cb8bd94d1bb25c9"}, "state": "DISMISSED", "comments": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yMVQxMDowNDoxOVrOHlkNqA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yMVQxMDoxMjo0OVrOHlkh5A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwOTE1MjY4MA==", "bodyText": "BaseTest::installApp do just the same right ?", "url": "https://github.com/dimagi/commcare-android/pull/2382#discussion_r509152680", "createdAt": "2020-10-21T10:04:19Z", "author": {"login": "shubham1g5"}, "path": "app/instrumentation-tests/src/org/commcare/androidTests/LanguagesTest.kt", "diffHunk": "@@ -0,0 +1,135 @@\n+package org.commcare.androidTests\n+\n+import androidx.test.espresso.Espresso\n+import androidx.test.espresso.Espresso.closeSoftKeyboard\n+import androidx.test.espresso.Espresso.onView\n+import androidx.test.espresso.action.ViewActions.click\n+import androidx.test.espresso.assertion.ViewAssertions.doesNotExist\n+import androidx.test.espresso.assertion.ViewAssertions.matches\n+import androidx.test.espresso.matcher.ViewMatchers.*\n+import androidx.test.ext.junit.runners.AndroidJUnit4\n+import androidx.test.filters.LargeTest\n+import org.commcare.CommCareApplication\n+import org.commcare.dalvik.R\n+import org.commcare.utils.CustomMatchers\n+import org.commcare.utils.InstrumentationUtility\n+import org.junit.Before\n+import org.junit.Test\n+import org.junit.runner.RunWith\n+\n+@RunWith(AndroidJUnit4::class)\n+@LargeTest\n+class LanguagesTest : BaseTest() {\n+\n+    companion object {\n+        const val CCZ_NAME = \"languages.ccz\"\n+    }\n+\n+    @Before\n+    fun setup() {\n+        if (CommCareApplication.instance().currentApp == null) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d53d4bbef158d0a2a20b00fb1cb8bd94d1bb25c9"}, "originalPosition": 30}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwOTE1NTEwNA==", "bodyText": "should move this to InstrumentationUtility as it's useful for most tests.", "url": "https://github.com/dimagi/commcare-android/pull/2382#discussion_r509155104", "createdAt": "2020-10-21T10:08:19Z", "author": {"login": "shubham1g5"}, "path": "app/instrumentation-tests/src/org/commcare/androidTests/LanguagesTest.kt", "diffHunk": "@@ -0,0 +1,135 @@\n+package org.commcare.androidTests\n+\n+import androidx.test.espresso.Espresso\n+import androidx.test.espresso.Espresso.closeSoftKeyboard\n+import androidx.test.espresso.Espresso.onView\n+import androidx.test.espresso.action.ViewActions.click\n+import androidx.test.espresso.assertion.ViewAssertions.doesNotExist\n+import androidx.test.espresso.assertion.ViewAssertions.matches\n+import androidx.test.espresso.matcher.ViewMatchers.*\n+import androidx.test.ext.junit.runners.AndroidJUnit4\n+import androidx.test.filters.LargeTest\n+import org.commcare.CommCareApplication\n+import org.commcare.dalvik.R\n+import org.commcare.utils.CustomMatchers\n+import org.commcare.utils.InstrumentationUtility\n+import org.junit.Before\n+import org.junit.Test\n+import org.junit.runner.RunWith\n+\n+@RunWith(AndroidJUnit4::class)\n+@LargeTest\n+class LanguagesTest : BaseTest() {\n+\n+    companion object {\n+        const val CCZ_NAME = \"languages.ccz\"\n+    }\n+\n+    @Before\n+    fun setup() {\n+        if (CommCareApplication.instance().currentApp == null) {\n+            InstrumentationUtility.installApp(FormEntryTest.CCZ_NAME)\n+        } else {\n+            InstrumentationUtility.uninstallCurrentApp()\n+            InstrumentationUtility.installApp(FormEntryTest.CCZ_NAME)\n+            Espresso.pressBack()\n+        }\n+        InstrumentationUtility.login(\"user_with_no_data\", \"123\")\n+    }\n+\n+    @Test\n+    fun testLanguageChanges() {\n+        InstrumentationUtility.openForm(0, 0)\n+        onView(withText(\"Enter a name:\"))\n+                .check(matches(isDisplayed()))\n+        exitForm()", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d53d4bbef158d0a2a20b00fb1cb8bd94d1bb25c9"}, "originalPosition": 45}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwOTE1NjM0Nw==", "bodyText": "This can be generalized and move to InstrumentationUtility as selectMenu(int textId),", "url": "https://github.com/dimagi/commcare-android/pull/2382#discussion_r509156347", "createdAt": "2020-10-21T10:10:14Z", "author": {"login": "shubham1g5"}, "path": "app/instrumentation-tests/src/org/commcare/androidTests/LanguagesTest.kt", "diffHunk": "@@ -0,0 +1,135 @@\n+package org.commcare.androidTests\n+\n+import androidx.test.espresso.Espresso\n+import androidx.test.espresso.Espresso.closeSoftKeyboard\n+import androidx.test.espresso.Espresso.onView\n+import androidx.test.espresso.action.ViewActions.click\n+import androidx.test.espresso.assertion.ViewAssertions.doesNotExist\n+import androidx.test.espresso.assertion.ViewAssertions.matches\n+import androidx.test.espresso.matcher.ViewMatchers.*\n+import androidx.test.ext.junit.runners.AndroidJUnit4\n+import androidx.test.filters.LargeTest\n+import org.commcare.CommCareApplication\n+import org.commcare.dalvik.R\n+import org.commcare.utils.CustomMatchers\n+import org.commcare.utils.InstrumentationUtility\n+import org.junit.Before\n+import org.junit.Test\n+import org.junit.runner.RunWith\n+\n+@RunWith(AndroidJUnit4::class)\n+@LargeTest\n+class LanguagesTest : BaseTest() {\n+\n+    companion object {\n+        const val CCZ_NAME = \"languages.ccz\"\n+    }\n+\n+    @Before\n+    fun setup() {\n+        if (CommCareApplication.instance().currentApp == null) {\n+            InstrumentationUtility.installApp(FormEntryTest.CCZ_NAME)\n+        } else {\n+            InstrumentationUtility.uninstallCurrentApp()\n+            InstrumentationUtility.installApp(FormEntryTest.CCZ_NAME)\n+            Espresso.pressBack()\n+        }\n+        InstrumentationUtility.login(\"user_with_no_data\", \"123\")\n+    }\n+\n+    @Test\n+    fun testLanguageChanges() {\n+        InstrumentationUtility.openForm(0, 0)\n+        onView(withText(\"Enter a name:\"))\n+                .check(matches(isDisplayed()))\n+        exitForm()\n+        InstrumentationUtility.gotoHome()\n+        selectLanguageChangeOption()\n+        checkLanguageOptions()\n+\n+        // Confirm the options persist on rotation\n+        InstrumentationUtility.rotateLeft()\n+        checkLanguageOptions()\n+        InstrumentationUtility.rotatePortrait()\n+        checkLanguageOptions()\n+\n+        // Clicking just after rotating doesn't work for some reason, so waiting here for a moment.\n+        InstrumentationUtility.sleep(2)\n+        onView(withText(\"Hindi\"))\n+                .perform(click())\n+        onView(withText(\"Start\"))\n+                .perform(click())\n+        onView(withText(\"Basic Form Tests\"))\n+                .perform(click())\n+        onView(withText(\"HIN: Languages\"))\n+                .perform(click())\n+\n+        onView(withText(\"HIN: Enter a name:\"))\n+                .check(matches(isDisplayed()))\n+\n+        // Check form language changes\n+        selectLanguageChangeOption()\n+        checkLanguageOptions()\n+        onView(withText(\"English\"))\n+                .perform(click())\n+\n+        onView(withText(\"HIN: Enter a name:\"))\n+                .check(doesNotExist())\n+        onView(withText(\"Enter a name:\"))\n+                .check(matches(isDisplayed()))\n+\n+        // Confirm app language remains the same.\n+        exitForm()\n+        onView(withText(\"HIN: Languages\"))\n+                .check(matches(isDisplayed()))\n+    }\n+\n+    @Test\n+    fun testAppUpdate_dontInterfereLanguageChanges() {\n+        selectLanguageChangeOption()\n+        checkLanguageOptions()\n+        // Change language to hindi\n+        onView(withText(\"Hindi\"))\n+                .perform(click())\n+\n+        // Update app\n+        InstrumentationUtility.openOptionsMenu()\n+        onView(withText(\"Update App\"))\n+                .perform(click())\n+        onView(withText(\"Update to version 103 & log out\"))\n+                .perform(click())\n+        InstrumentationUtility.login(\"user_with_no_data\", \"123\")\n+\n+        // Confirm app language remains hindi\n+        onView(withText(\"Start\"))\n+                .perform(click())\n+        onView(withText(\"Basic Form Tests\"))\n+                .perform(click())\n+        onView(withText(\"HIN: Languages\"))\n+                .check(matches(isDisplayed()))\n+    }\n+\n+    private fun selectLanguageChangeOption() {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d53d4bbef158d0a2a20b00fb1cb8bd94d1bb25c9"}, "originalPosition": 112}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwOTE1Nzg2MA==", "bodyText": "can reuse InstrumentationUtility.openForm(0, 0)", "url": "https://github.com/dimagi/commcare-android/pull/2382#discussion_r509157860", "createdAt": "2020-10-21T10:12:49Z", "author": {"login": "shubham1g5"}, "path": "app/instrumentation-tests/src/org/commcare/androidTests/LanguagesTest.kt", "diffHunk": "@@ -0,0 +1,135 @@\n+package org.commcare.androidTests\n+\n+import androidx.test.espresso.Espresso\n+import androidx.test.espresso.Espresso.closeSoftKeyboard\n+import androidx.test.espresso.Espresso.onView\n+import androidx.test.espresso.action.ViewActions.click\n+import androidx.test.espresso.assertion.ViewAssertions.doesNotExist\n+import androidx.test.espresso.assertion.ViewAssertions.matches\n+import androidx.test.espresso.matcher.ViewMatchers.*\n+import androidx.test.ext.junit.runners.AndroidJUnit4\n+import androidx.test.filters.LargeTest\n+import org.commcare.CommCareApplication\n+import org.commcare.dalvik.R\n+import org.commcare.utils.CustomMatchers\n+import org.commcare.utils.InstrumentationUtility\n+import org.junit.Before\n+import org.junit.Test\n+import org.junit.runner.RunWith\n+\n+@RunWith(AndroidJUnit4::class)\n+@LargeTest\n+class LanguagesTest : BaseTest() {\n+\n+    companion object {\n+        const val CCZ_NAME = \"languages.ccz\"\n+    }\n+\n+    @Before\n+    fun setup() {\n+        if (CommCareApplication.instance().currentApp == null) {\n+            InstrumentationUtility.installApp(FormEntryTest.CCZ_NAME)\n+        } else {\n+            InstrumentationUtility.uninstallCurrentApp()\n+            InstrumentationUtility.installApp(FormEntryTest.CCZ_NAME)\n+            Espresso.pressBack()\n+        }\n+        InstrumentationUtility.login(\"user_with_no_data\", \"123\")\n+    }\n+\n+    @Test\n+    fun testLanguageChanges() {\n+        InstrumentationUtility.openForm(0, 0)\n+        onView(withText(\"Enter a name:\"))\n+                .check(matches(isDisplayed()))\n+        exitForm()\n+        InstrumentationUtility.gotoHome()\n+        selectLanguageChangeOption()\n+        checkLanguageOptions()\n+\n+        // Confirm the options persist on rotation\n+        InstrumentationUtility.rotateLeft()\n+        checkLanguageOptions()\n+        InstrumentationUtility.rotatePortrait()\n+        checkLanguageOptions()\n+\n+        // Clicking just after rotating doesn't work for some reason, so waiting here for a moment.\n+        InstrumentationUtility.sleep(2)\n+        onView(withText(\"Hindi\"))\n+                .perform(click())\n+        onView(withText(\"Start\"))\n+                .perform(click())\n+        onView(withText(\"Basic Form Tests\"))", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d53d4bbef158d0a2a20b00fb1cb8bd94d1bb25c9"}, "originalPosition": 62}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c2878d830a58c75bae0881b7c363f08f559d772b", "author": {"user": {"login": "ShivamPokhriyal", "name": "Shivam Pokhriyal"}}, "url": "https://github.com/dimagi/commcare-android/commit/c2878d830a58c75bae0881b7c363f08f559d772b", "committedDate": "2020-10-21T12:42:23Z", "message": "Add languages test"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "d515d5df0ccc51b0a280011bbdf181ffe5846f37", "author": {"user": {"login": "ShivamPokhriyal", "name": "Shivam Pokhriyal"}}, "url": "https://github.com/dimagi/commcare-android/commit/d515d5df0ccc51b0a280011bbdf181ffe5846f37", "committedDate": "2020-10-21T13:05:59Z", "message": "PR suggestions"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "d53d4bbef158d0a2a20b00fb1cb8bd94d1bb25c9", "author": {"user": {"login": "ShivamPokhriyal", "name": "Shivam Pokhriyal"}}, "url": "https://github.com/dimagi/commcare-android/commit/d53d4bbef158d0a2a20b00fb1cb8bd94d1bb25c9", "committedDate": "2020-10-19T09:44:37Z", "message": "Add languages test"}, "afterCommit": {"oid": "d515d5df0ccc51b0a280011bbdf181ffe5846f37", "author": {"user": {"login": "ShivamPokhriyal", "name": "Shivam Pokhriyal"}}, "url": "https://github.com/dimagi/commcare-android/commit/d515d5df0ccc51b0a280011bbdf181ffe5846f37", "committedDate": "2020-10-21T13:05:59Z", "message": "PR suggestions"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "8a19146e680f3f79dbcb848d83d63e1c988385b4", "author": {"user": {"login": "ShivamPokhriyal", "name": "Shivam Pokhriyal"}}, "url": "https://github.com/dimagi/commcare-android/commit/8a19146e680f3f79dbcb848d83d63e1c988385b4", "committedDate": "2020-10-22T08:25:22Z", "message": "Modify BaseTest appinstall method to use force flag"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "03d49fe563a3554246024ea72e0a59886deca98f", "author": {"user": {"login": "ShivamPokhriyal", "name": "Shivam Pokhriyal"}}, "url": "https://github.com/dimagi/commcare-android/commit/03d49fe563a3554246024ea72e0a59886deca98f", "committedDate": "2020-10-22T09:21:19Z", "message": "Fix delegaterunner couldn't be loaded crash"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTE0NTY3MzYw", "url": "https://github.com/dimagi/commcare-android/pull/2382#pullrequestreview-514567360", "createdAt": "2020-10-22T10:10:33Z", "commit": {"oid": "03d49fe563a3554246024ea72e0a59886deca98f"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1970, "cost": 1, "resetAt": "2021-11-01T13:51:04Z"}}}