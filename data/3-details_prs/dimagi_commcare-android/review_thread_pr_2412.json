{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTMxMDQxNTU5", "number": 2412, "reviewThreads": {"totalCount": 8, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0wOVQxNjo0Mjo0OVrOFDBiHg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xNlQxNjo1Mjo1MVrOFGS1VQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzM4NzE1MTY2OnYy", "diffSide": "RIGHT", "path": "app/src/org/commcare/activities/DispatchActivity.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0wOVQxNjo0Mjo0OVrOICeb8g==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0wOVQxNjo0MzoyMlrOICedvA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzOTQ2NjczOA==", "bodyText": "Wouldn't these arguments need to be a Map (name to value) rather than a list?", "url": "https://github.com/dimagi/commcare-android/pull/2412#discussion_r539466738", "createdAt": "2020-12-09T16:42:49Z", "author": {"login": "ctsims"}, "path": "app/src/org/commcare/activities/DispatchActivity.java", "diffHunk": "@@ -321,14 +330,24 @@ private void handleUnvalidatedApp() {\n     private void handleExternalLaunch() {\n         //First off, make sure the incoming session is clear\n         CommCareApplication.instance().getSession().proceedWithSavedSessionIfNeeded(() -> {\n-                    String sessionRequest = this.getIntent().getStringExtra(SESSION_REQUEST);\n-                    SessionStateDescriptor ssd = new SessionStateDescriptor();\n-                    ssd.fromBundle(sessionRequest);\n-                    CommCareApplication.instance().getCurrentSessionWrapper().loadFromStateDescription(ssd);\n-                    Intent i = new Intent(this, StandardHomeActivity.class);\n-                    i.putExtra(WAS_EXTERNAL, true);\n-                    startActivityForResult(i, HOME_SCREEN);\n-        }\n+                    if (getIntent().hasExtra(SESSION_REQUEST)) {\n+                        String sessionRequest = this.getIntent().getStringExtra(SESSION_REQUEST);\n+                        SessionStateDescriptor ssd = new SessionStateDescriptor();\n+                        ssd.fromBundle(sessionRequest);\n+                        CommCareApplication.instance().getCurrentSessionWrapper().loadFromStateDescription(ssd);\n+                        Intent i = new Intent(this, StandardHomeActivity.class);\n+                        i.putExtra(WAS_EXTERNAL, true);\n+                        startActivityForResult(i, HOME_SCREEN);\n+                    } else if (getIntent().hasExtra(SESSION_ENDPOINT_ID)) {\n+                        String sessionEndpointId = this.getIntent().getStringExtra(SESSION_ENDPOINT_ID);\n+                        ArrayList<String> args = this.getIntent().getStringArrayListExtra(SESSION_ENDPOINT_ARGUMENTS);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "7287d568b83b39ef45ef0e2132bd0185d1786a66"}, "originalPosition": 70}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzOTQ2NzE5Ng==", "bodyText": "^ If this were true, we might also want to consider having the args provided as a bundle map.", "url": "https://github.com/dimagi/commcare-android/pull/2412#discussion_r539467196", "createdAt": "2020-12-09T16:43:22Z", "author": {"login": "ctsims"}, "path": "app/src/org/commcare/activities/DispatchActivity.java", "diffHunk": "@@ -321,14 +330,24 @@ private void handleUnvalidatedApp() {\n     private void handleExternalLaunch() {\n         //First off, make sure the incoming session is clear\n         CommCareApplication.instance().getSession().proceedWithSavedSessionIfNeeded(() -> {\n-                    String sessionRequest = this.getIntent().getStringExtra(SESSION_REQUEST);\n-                    SessionStateDescriptor ssd = new SessionStateDescriptor();\n-                    ssd.fromBundle(sessionRequest);\n-                    CommCareApplication.instance().getCurrentSessionWrapper().loadFromStateDescription(ssd);\n-                    Intent i = new Intent(this, StandardHomeActivity.class);\n-                    i.putExtra(WAS_EXTERNAL, true);\n-                    startActivityForResult(i, HOME_SCREEN);\n-        }\n+                    if (getIntent().hasExtra(SESSION_REQUEST)) {\n+                        String sessionRequest = this.getIntent().getStringExtra(SESSION_REQUEST);\n+                        SessionStateDescriptor ssd = new SessionStateDescriptor();\n+                        ssd.fromBundle(sessionRequest);\n+                        CommCareApplication.instance().getCurrentSessionWrapper().loadFromStateDescription(ssd);\n+                        Intent i = new Intent(this, StandardHomeActivity.class);\n+                        i.putExtra(WAS_EXTERNAL, true);\n+                        startActivityForResult(i, HOME_SCREEN);\n+                    } else if (getIntent().hasExtra(SESSION_ENDPOINT_ID)) {\n+                        String sessionEndpointId = this.getIntent().getStringExtra(SESSION_ENDPOINT_ID);\n+                        ArrayList<String> args = this.getIntent().getStringArrayListExtra(SESSION_ENDPOINT_ARGUMENTS);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzOTQ2NjczOA=="}, "originalCommit": {"oid": "7287d568b83b39ef45ef0e2132bd0185d1786a66"}, "originalPosition": 70}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzM4NzE2NTgzOnYy", "diffSide": "RIGHT", "path": "app/src/org/commcare/activities/HomeScreenBaseActivity.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0wOVQxNjo0NToyMFrOICekQw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0wOVQxNjo0NToyMFrOICekQw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzOTQ2ODg2Nw==", "bodyText": "I mentioned this in the commcare-core PR, but I think we should be setting the arguments by setting them as XPath variables on the evaluation context, since that will naturally and robustly substitute them in as needed as the stack ops are calculated.", "url": "https://github.com/dimagi/commcare-android/pull/2412#discussion_r539468867", "createdAt": "2020-12-09T16:45:20Z", "author": {"login": "ctsims"}, "path": "app/src/org/commcare/activities/HomeScreenBaseActivity.java", "diffHunk": "@@ -194,10 +199,59 @@ private void loadInstanceState(Bundle savedInstanceState) {\n     private void processFromExternalLaunch(Bundle savedInstanceState) {\n         if (savedInstanceState == null && getIntent().hasExtra(DispatchActivity.WAS_EXTERNAL)) {\n             wasExternal = true;\n+            processSessionEndpoint();\n             sessionNavigator.startNextSessionStep();\n         }\n     }\n \n+    private void processSessionEndpoint() {\n+        if (getIntent().hasExtra(SESSION_ENDPOINT_ID)) {\n+            Endpoint endpoint = validateIntentForSessionEndpoint(getIntent());\n+            if (endpoint != null) {\n+                Vector<String> endpointArguments = endpoint.getArguments();\n+                ArrayList<String> intentArguments = getIntent().getStringArrayListExtra(SESSION_ENDPOINT_ARGUMENTS);\n+                HashMap<String, String> compositeArguments = new HashMap<>(endpointArguments.size());\n+                for (int i = 0; i < endpointArguments.size(); i++) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "7287d568b83b39ef45ef0e2132bd0185d1786a66"}, "originalPosition": 68}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzM4NzE2NzM3OnYy", "diffSide": "RIGHT", "path": "app/src/org/commcare/activities/HomeScreenBaseActivity.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0wOVQxNjo0NTozNlrOICelHQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0wOVQxNjo0NTozNlrOICelHQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzOTQ2OTA4NQ==", "bodyText": "Should we be ensuring the stack is clean here before firing everything?", "url": "https://github.com/dimagi/commcare-android/pull/2412#discussion_r539469085", "createdAt": "2020-12-09T16:45:36Z", "author": {"login": "ctsims"}, "path": "app/src/org/commcare/activities/HomeScreenBaseActivity.java", "diffHunk": "@@ -194,10 +199,59 @@ private void loadInstanceState(Bundle savedInstanceState) {\n     private void processFromExternalLaunch(Bundle savedInstanceState) {\n         if (savedInstanceState == null && getIntent().hasExtra(DispatchActivity.WAS_EXTERNAL)) {\n             wasExternal = true;\n+            processSessionEndpoint();\n             sessionNavigator.startNextSessionStep();\n         }\n     }\n \n+    private void processSessionEndpoint() {\n+        if (getIntent().hasExtra(SESSION_ENDPOINT_ID)) {\n+            Endpoint endpoint = validateIntentForSessionEndpoint(getIntent());\n+            if (endpoint != null) {\n+                Vector<String> endpointArguments = endpoint.getArguments();\n+                ArrayList<String> intentArguments = getIntent().getStringArrayListExtra(SESSION_ENDPOINT_ARGUMENTS);\n+                HashMap<String, String> compositeArguments = new HashMap<>(endpointArguments.size());\n+                for (int i = 0; i < endpointArguments.size(); i++) {\n+                    compositeArguments.put(endpointArguments.elementAt(i),\n+                            intentArguments.get(i));\n+                }\n+\n+                CommCareApplication.instance().getCurrentSessionWrapper()", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "7287d568b83b39ef45ef0e2132bd0185d1786a66"}, "originalPosition": 73}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzQwNjQxNjEzOnYy", "diffSide": "RIGHT", "path": "app/src/org/commcare/activities/HomeScreenBaseActivity.java", "isResolved": true, "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xNFQwODozMjo0OFrOIFFGog==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xNVQxMToxMToxMVrOIGFlSA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MjE5NzQxMA==", "bodyText": "Should we be creating a copy of evaluationContext here ?", "url": "https://github.com/dimagi/commcare-android/pull/2412#discussion_r542197410", "createdAt": "2020-12-14T08:32:48Z", "author": {"login": "shubham1g5"}, "path": "app/src/org/commcare/activities/HomeScreenBaseActivity.java", "diffHunk": "@@ -189,15 +194,75 @@ private void loadInstanceState(Bundle savedInstanceState) {\n     }\n \n     /**\n-     * Set state that signifies activity was launch from external app.\n+     * Set state that signifies activity was launch from external app\n      */\n     private void processFromExternalLaunch(Bundle savedInstanceState) {\n         if (savedInstanceState == null && getIntent().hasExtra(DispatchActivity.WAS_EXTERNAL)) {\n             wasExternal = true;\n+            processSessionEndpoint();\n             sessionNavigator.startNextSessionStep();\n         }\n     }\n \n+    private void processSessionEndpoint() {\n+        if (getIntent().hasExtra(SESSION_ENDPOINT_ID)) {\n+            Endpoint endpoint = validateIntentForSessionEndpoint(getIntent());\n+            if (endpoint != null) {\n+                Vector<String> endpointArguments = endpoint.getArguments();\n+                Bundle intentArguments = getIntent().getBundleExtra(SESSION_ENDPOINT_ARGUMENTS);\n+                EvaluationContext evaluationContext = CommCareApplication.instance().getCurrentSessionWrapper().getEvaluationContext();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "a991bc316e140d61dde641a446954267a0345266"}, "originalPosition": 73}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MjM5OTk3NA==", "bodyText": "Requests to the session wrapper for an EC should always return a new, clean evaluation context, so I don't think you explicitly need to fork it here unless it will be used in more than one subcontext (IE: If, for example, you needed to evaluate expressions with different sets of argument variables being set).", "url": "https://github.com/dimagi/commcare-android/pull/2412#discussion_r542399974", "createdAt": "2020-12-14T13:53:32Z", "author": {"login": "ctsims"}, "path": "app/src/org/commcare/activities/HomeScreenBaseActivity.java", "diffHunk": "@@ -189,15 +194,75 @@ private void loadInstanceState(Bundle savedInstanceState) {\n     }\n \n     /**\n-     * Set state that signifies activity was launch from external app.\n+     * Set state that signifies activity was launch from external app\n      */\n     private void processFromExternalLaunch(Bundle savedInstanceState) {\n         if (savedInstanceState == null && getIntent().hasExtra(DispatchActivity.WAS_EXTERNAL)) {\n             wasExternal = true;\n+            processSessionEndpoint();\n             sessionNavigator.startNextSessionStep();\n         }\n     }\n \n+    private void processSessionEndpoint() {\n+        if (getIntent().hasExtra(SESSION_ENDPOINT_ID)) {\n+            Endpoint endpoint = validateIntentForSessionEndpoint(getIntent());\n+            if (endpoint != null) {\n+                Vector<String> endpointArguments = endpoint.getArguments();\n+                Bundle intentArguments = getIntent().getBundleExtra(SESSION_ENDPOINT_ARGUMENTS);\n+                EvaluationContext evaluationContext = CommCareApplication.instance().getCurrentSessionWrapper().getEvaluationContext();", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MjE5NzQxMA=="}, "originalCommit": {"oid": "a991bc316e140d61dde641a446954267a0345266"}, "originalPosition": 73}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MzI1MzgzMg==", "bodyText": "that makes sense. Thanks!", "url": "https://github.com/dimagi/commcare-android/pull/2412#discussion_r543253832", "createdAt": "2020-12-15T11:11:11Z", "author": {"login": "shubham1g5"}, "path": "app/src/org/commcare/activities/HomeScreenBaseActivity.java", "diffHunk": "@@ -189,15 +194,75 @@ private void loadInstanceState(Bundle savedInstanceState) {\n     }\n \n     /**\n-     * Set state that signifies activity was launch from external app.\n+     * Set state that signifies activity was launch from external app\n      */\n     private void processFromExternalLaunch(Bundle savedInstanceState) {\n         if (savedInstanceState == null && getIntent().hasExtra(DispatchActivity.WAS_EXTERNAL)) {\n             wasExternal = true;\n+            processSessionEndpoint();\n             sessionNavigator.startNextSessionStep();\n         }\n     }\n \n+    private void processSessionEndpoint() {\n+        if (getIntent().hasExtra(SESSION_ENDPOINT_ID)) {\n+            Endpoint endpoint = validateIntentForSessionEndpoint(getIntent());\n+            if (endpoint != null) {\n+                Vector<String> endpointArguments = endpoint.getArguments();\n+                Bundle intentArguments = getIntent().getBundleExtra(SESSION_ENDPOINT_ARGUMENTS);\n+                EvaluationContext evaluationContext = CommCareApplication.instance().getCurrentSessionWrapper().getEvaluationContext();", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MjE5NzQxMA=="}, "originalCommit": {"oid": "a991bc316e140d61dde641a446954267a0345266"}, "originalPosition": 73}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzQyMTM5ODM5OnYy", "diffSide": "RIGHT", "path": "app/src/org/commcare/activities/HomeScreenBaseActivity.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xNlQxNjo0NDoyNFrOIHOxsw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xNlQxNjo0NDoyNFrOIHOxsw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NDQ1MzA0Mw==", "bodyText": "Nit: It feels a bit error prone to me for the processing to not fork to being either Dictionary based or List Order based upfront and then in their own block, rather than inline under the same process, but just a style thing.", "url": "https://github.com/dimagi/commcare-android/pull/2412#discussion_r544453043", "createdAt": "2020-12-16T16:44:24Z", "author": {"login": "ctsims"}, "path": "app/src/org/commcare/activities/HomeScreenBaseActivity.java", "diffHunk": "@@ -189,15 +194,86 @@ private void loadInstanceState(Bundle savedInstanceState) {\n     }\n \n     /**\n-     * Set state that signifies activity was launch from external app.\n+     * Set state that signifies activity was launch from external app\n      */\n     private void processFromExternalLaunch(Bundle savedInstanceState) {\n         if (savedInstanceState == null && getIntent().hasExtra(DispatchActivity.WAS_EXTERNAL)) {\n             wasExternal = true;\n+            processSessionEndpoint();\n             sessionNavigator.startNextSessionStep();\n         }\n     }\n \n+    private void processSessionEndpoint() {\n+        if (getIntent().hasExtra(SESSION_ENDPOINT_ID)) {\n+            Endpoint endpoint = validateIntentForSessionEndpoint(getIntent());\n+            if (endpoint != null) {\n+                Vector<String> endpointArguments = endpoint.getArguments();\n+                EvaluationContext evaluationContext = CommCareApplication.instance().getCurrentSessionWrapper().getEvaluationContext();\n+\n+                Bundle intentArgumentsAsBundle = getIntent().getBundleExtra(SESSION_ENDPOINT_ARGUMENTS_BUNDLE);\n+                ArrayList<String> intentArgumentsAsList = getIntent().getStringArrayListExtra(SESSION_ENDPOINT_ARGUMENTS_LIST);\n+\n+                for (int i = 0; i < endpointArguments.size(); i++) {\n+                    String argumentName = endpointArguments.elementAt(i);\n+                    if (intentArgumentsAsBundle != null && !intentArgumentsAsBundle.containsKey(argumentName)) {\n+                        String noArgumentWithNameError = org.commcare.utils.StringUtils.getStringRobust(\n+                                this,\n+                                R.string.session_endpoint_no_argument_with_name,\n+                                new String[]{argumentName, endpoint.getId()});\n+                        UserfacingErrorHandling.createErrorDialog(this, noArgumentWithNameError, true);\n+                        return;\n+                    }\n+\n+                    // Bundle Arguments take precdence over list arguments", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "5567d2a1151a224a61cd7d2909a27393e951a9ab"}, "originalPosition": 88}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzQyMTQxOTIyOnYy", "diffSide": "RIGHT", "path": "app/src/org/commcare/activities/HomeScreenBaseActivity.java", "isResolved": false, "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xNlQxNjo0ODowOFrOIHO9sg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xOFQxMDoxNDoyMFrOIIc7uA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NDQ1NjExNA==", "bodyText": "Just realized: We should be doing the session stack reset here, rather than below, since the EC here depends on the current session state, and this could introduce unpredictable behavior for the stack ops depending on the session state when the callout was received.", "url": "https://github.com/dimagi/commcare-android/pull/2412#discussion_r544456114", "createdAt": "2020-12-16T16:48:08Z", "author": {"login": "ctsims"}, "path": "app/src/org/commcare/activities/HomeScreenBaseActivity.java", "diffHunk": "@@ -189,15 +194,86 @@ private void loadInstanceState(Bundle savedInstanceState) {\n     }\n \n     /**\n-     * Set state that signifies activity was launch from external app.\n+     * Set state that signifies activity was launch from external app\n      */\n     private void processFromExternalLaunch(Bundle savedInstanceState) {\n         if (savedInstanceState == null && getIntent().hasExtra(DispatchActivity.WAS_EXTERNAL)) {\n             wasExternal = true;\n+            processSessionEndpoint();\n             sessionNavigator.startNextSessionStep();\n         }\n     }\n \n+    private void processSessionEndpoint() {\n+        if (getIntent().hasExtra(SESSION_ENDPOINT_ID)) {\n+            Endpoint endpoint = validateIntentForSessionEndpoint(getIntent());\n+            if (endpoint != null) {\n+                Vector<String> endpointArguments = endpoint.getArguments();\n+                EvaluationContext evaluationContext = CommCareApplication.instance().getCurrentSessionWrapper().getEvaluationContext();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "5567d2a1151a224a61cd7d2909a27393e951a9ab"}, "originalPosition": 72}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NDQ1NzM4Mw==", "bodyText": "Another consideration on that point: We may need the Endpoint definition to be able to provide its own <instance> connectors, since it won't necessarily be connected to any of the other components where connectors are defined. This can be \"future\" addition, since most of the inbound expressions now will just be Strings or whatnot, but I'd expect us to run into it at some point.", "url": "https://github.com/dimagi/commcare-android/pull/2412#discussion_r544457383", "createdAt": "2020-12-16T16:49:47Z", "author": {"login": "ctsims"}, "path": "app/src/org/commcare/activities/HomeScreenBaseActivity.java", "diffHunk": "@@ -189,15 +194,86 @@ private void loadInstanceState(Bundle savedInstanceState) {\n     }\n \n     /**\n-     * Set state that signifies activity was launch from external app.\n+     * Set state that signifies activity was launch from external app\n      */\n     private void processFromExternalLaunch(Bundle savedInstanceState) {\n         if (savedInstanceState == null && getIntent().hasExtra(DispatchActivity.WAS_EXTERNAL)) {\n             wasExternal = true;\n+            processSessionEndpoint();\n             sessionNavigator.startNextSessionStep();\n         }\n     }\n \n+    private void processSessionEndpoint() {\n+        if (getIntent().hasExtra(SESSION_ENDPOINT_ID)) {\n+            Endpoint endpoint = validateIntentForSessionEndpoint(getIntent());\n+            if (endpoint != null) {\n+                Vector<String> endpointArguments = endpoint.getArguments();\n+                EvaluationContext evaluationContext = CommCareApplication.instance().getCurrentSessionWrapper().getEvaluationContext();", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NDQ1NjExNA=="}, "originalCommit": {"oid": "5567d2a1151a224a61cd7d2909a27393e951a9ab"}, "originalPosition": 72}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NTczMzU2MA==", "bodyText": "Sounds good. Keeping it as a future addition.", "url": "https://github.com/dimagi/commcare-android/pull/2412#discussion_r545733560", "createdAt": "2020-12-18T10:14:20Z", "author": {"login": "shubham1g5"}, "path": "app/src/org/commcare/activities/HomeScreenBaseActivity.java", "diffHunk": "@@ -189,15 +194,86 @@ private void loadInstanceState(Bundle savedInstanceState) {\n     }\n \n     /**\n-     * Set state that signifies activity was launch from external app.\n+     * Set state that signifies activity was launch from external app\n      */\n     private void processFromExternalLaunch(Bundle savedInstanceState) {\n         if (savedInstanceState == null && getIntent().hasExtra(DispatchActivity.WAS_EXTERNAL)) {\n             wasExternal = true;\n+            processSessionEndpoint();\n             sessionNavigator.startNextSessionStep();\n         }\n     }\n \n+    private void processSessionEndpoint() {\n+        if (getIntent().hasExtra(SESSION_ENDPOINT_ID)) {\n+            Endpoint endpoint = validateIntentForSessionEndpoint(getIntent());\n+            if (endpoint != null) {\n+                Vector<String> endpointArguments = endpoint.getArguments();\n+                EvaluationContext evaluationContext = CommCareApplication.instance().getCurrentSessionWrapper().getEvaluationContext();", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NDQ1NjExNA=="}, "originalCommit": {"oid": "5567d2a1151a224a61cd7d2909a27393e951a9ab"}, "originalPosition": 72}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzQyMTQzOTM2OnYy", "diffSide": "RIGHT", "path": "app/src/org/commcare/activities/HomeScreenBaseActivity.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xNlQxNjo1MjowN1rOIHPJ0g==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xNlQxNjo1MjowN1rOIHPJ0g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NDQ1OTIxOA==", "bodyText": "Idea: The notion of supporting either a list or a dictionary to populate the list feels like it is in a funny place where it's part of the core app contract but implemented in Android.\nI wonder whether it would be helpful to put more of this code into commcare-core in a method that receives either a list or dict and populates (or even retrieves then populates, based on the line 212 comment) an EC, just so the behavior is clearly part of the core contract.", "url": "https://github.com/dimagi/commcare-android/pull/2412#discussion_r544459218", "createdAt": "2020-12-16T16:52:07Z", "author": {"login": "ctsims"}, "path": "app/src/org/commcare/activities/HomeScreenBaseActivity.java", "diffHunk": "@@ -189,15 +194,86 @@ private void loadInstanceState(Bundle savedInstanceState) {\n     }\n \n     /**\n-     * Set state that signifies activity was launch from external app.\n+     * Set state that signifies activity was launch from external app\n      */\n     private void processFromExternalLaunch(Bundle savedInstanceState) {\n         if (savedInstanceState == null && getIntent().hasExtra(DispatchActivity.WAS_EXTERNAL)) {\n             wasExternal = true;\n+            processSessionEndpoint();\n             sessionNavigator.startNextSessionStep();\n         }\n     }\n \n+    private void processSessionEndpoint() {\n+        if (getIntent().hasExtra(SESSION_ENDPOINT_ID)) {\n+            Endpoint endpoint = validateIntentForSessionEndpoint(getIntent());\n+            if (endpoint != null) {\n+                Vector<String> endpointArguments = endpoint.getArguments();\n+                EvaluationContext evaluationContext = CommCareApplication.instance().getCurrentSessionWrapper().getEvaluationContext();\n+\n+                Bundle intentArgumentsAsBundle = getIntent().getBundleExtra(SESSION_ENDPOINT_ARGUMENTS_BUNDLE);\n+                ArrayList<String> intentArgumentsAsList = getIntent().getStringArrayListExtra(SESSION_ENDPOINT_ARGUMENTS_LIST);\n+\n+                for (int i = 0; i < endpointArguments.size(); i++) {\n+                    String argumentName = endpointArguments.elementAt(i);\n+                    if (intentArgumentsAsBundle != null && !intentArgumentsAsBundle.containsKey(argumentName)) {\n+                        String noArgumentWithNameError = org.commcare.utils.StringUtils.getStringRobust(\n+                                this,\n+                                R.string.session_endpoint_no_argument_with_name,\n+                                new String[]{argumentName, endpoint.getId()});\n+                        UserfacingErrorHandling.createErrorDialog(this, noArgumentWithNameError, true);\n+                        return;\n+                    }\n+\n+                    // Bundle Arguments take precdence over list arguments\n+                    String argValue = intentArgumentsAsBundle == null ? intentArgumentsAsList.get(i)\n+                            : intentArgumentsAsBundle.getString(argumentName);\n+\n+                    evaluationContext.setVariable(argumentName, argValue);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "5567d2a1151a224a61cd7d2909a27393e951a9ab"}, "originalPosition": 92}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzQyMTQ0MzQxOnYy", "diffSide": "RIGHT", "path": "app/src/org/commcare/activities/HomeScreenBaseActivity.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xNlQxNjo1Mjo1MVrOIHPMGA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xNlQxNjo1Mjo1MVrOIHPMGA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NDQ1OTgwMA==", "bodyText": "do we need the check block on line 219 if this validation code runs over things first?", "url": "https://github.com/dimagi/commcare-android/pull/2412#discussion_r544459800", "createdAt": "2020-12-16T16:52:51Z", "author": {"login": "ctsims"}, "path": "app/src/org/commcare/activities/HomeScreenBaseActivity.java", "diffHunk": "@@ -189,15 +194,86 @@ private void loadInstanceState(Bundle savedInstanceState) {\n     }\n \n     /**\n-     * Set state that signifies activity was launch from external app.\n+     * Set state that signifies activity was launch from external app\n      */\n     private void processFromExternalLaunch(Bundle savedInstanceState) {\n         if (savedInstanceState == null && getIntent().hasExtra(DispatchActivity.WAS_EXTERNAL)) {\n             wasExternal = true;\n+            processSessionEndpoint();\n             sessionNavigator.startNextSessionStep();\n         }\n     }\n \n+    private void processSessionEndpoint() {\n+        if (getIntent().hasExtra(SESSION_ENDPOINT_ID)) {\n+            Endpoint endpoint = validateIntentForSessionEndpoint(getIntent());\n+            if (endpoint != null) {\n+                Vector<String> endpointArguments = endpoint.getArguments();\n+                EvaluationContext evaluationContext = CommCareApplication.instance().getCurrentSessionWrapper().getEvaluationContext();\n+\n+                Bundle intentArgumentsAsBundle = getIntent().getBundleExtra(SESSION_ENDPOINT_ARGUMENTS_BUNDLE);\n+                ArrayList<String> intentArgumentsAsList = getIntent().getStringArrayListExtra(SESSION_ENDPOINT_ARGUMENTS_LIST);\n+\n+                for (int i = 0; i < endpointArguments.size(); i++) {\n+                    String argumentName = endpointArguments.elementAt(i);\n+                    if (intentArgumentsAsBundle != null && !intentArgumentsAsBundle.containsKey(argumentName)) {\n+                        String noArgumentWithNameError = org.commcare.utils.StringUtils.getStringRobust(\n+                                this,\n+                                R.string.session_endpoint_no_argument_with_name,\n+                                new String[]{argumentName, endpoint.getId()});\n+                        UserfacingErrorHandling.createErrorDialog(this, noArgumentWithNameError, true);\n+                        return;\n+                    }\n+\n+                    // Bundle Arguments take precdence over list arguments\n+                    String argValue = intentArgumentsAsBundle == null ? intentArgumentsAsList.get(i)\n+                            : intentArgumentsAsBundle.getString(argumentName);\n+\n+                    evaluationContext.setVariable(argumentName, argValue);\n+                }\n+\n+                CommCareApplication.instance().getCurrentSessionWrapper().reset();\n+                CommCareApplication.instance().getCurrentSessionWrapper()\n+                        .executeStackActions(endpoint.getStackOperations(), evaluationContext);\n+            }\n+        }\n+    }\n+\n+    private Endpoint validateIntentForSessionEndpoint(Intent intent) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "5567d2a1151a224a61cd7d2909a27393e951a9ab"}, "originalPosition": 102}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3235, "cost": 1, "resetAt": "2021-11-12T13:16:51Z"}}}