{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDcyMTAxMjEy", "number": 2322, "title": "Implements request age and source in Install requests headers", "bodyText": "Spec: https://docs.google.com/document/d/1apnkFHZ9c38DKmUSarb67w5PJYQ74L0Xwy56Nb13Gpo/edit (Approach 1)\nAlso contains:\n\nImplements a ResourceInstallContext object in platform that keeps tracks of InstallRequestSource during resource installs. It also removes the need of having another recovery param in ResourceInstallers.\nFixes an issue where lazy media would get skipped during App install as well\nAdds tests around lazy media download\nAdds Mockk to assist with mocking objects in unit tests\n\ncross-request: dimagi/commcare-core#929", "createdAt": "2020-08-23T09:48:01Z", "url": "https://github.com/dimagi/commcare-android/pull/2322", "merged": true, "mergeCommit": {"oid": "2043d253cff3b7447c09e76628ee4d2d7d82d4f0"}, "closed": true, "closedAt": "2020-09-14T07:02:31Z", "author": {"login": "shubham1g5"}, "timelineItems": {"totalCount": 41, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABc873LCAH2gAyNDcyMTAxMjEyOjcyZWRiNDE4NTU0YjQzMTIwOGVhMjc1MTMwZTllMWI2NTlhNzQ3NGM=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdItiP9AFqTQ4NzQ1OTc1MA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "72edb418554b431208ea275130e9e1b659a7474c", "author": {"user": {"login": "shubham1g5", "name": "Shubham Goyal"}}, "url": "https://github.com/dimagi/commcare-android/commit/72edb418554b431208ea275130e9e1b659a7474c", "committedDate": "2020-08-08T16:46:12Z", "message": "Adds ParameterizedReference to support custom headers in a resource request"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "db531acf5222f36164a7d33757362c2869f5c056", "author": {"user": {"login": "shubham1g5", "name": "Shubham Goyal"}}, "url": "https://github.com/dimagi/commcare-android/commit/db531acf5222f36164a7d33757362c2869f5c056", "committedDate": "2020-08-10T09:55:13Z", "message": "Adds recovery headers"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "d9c1b860590e9d439555885f765be4b70dcd08d4", "author": {"user": {"login": "shubham1g5", "name": "Shubham Goyal"}}, "url": "https://github.com/dimagi/commcare-android/commit/d9c1b860590e9d439555885f765be4b70dcd08d4", "committedDate": "2020-08-13T06:26:36Z", "message": "handles lazy download headers"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f1026626fed561735819d046493468e46a4a79ac", "author": {"user": {"login": "shubham1g5", "name": "Shubham Goyal"}}, "url": "https://github.com/dimagi/commcare-android/commit/f1026626fed561735819d046493468e46a4a79ac", "committedDate": "2020-08-13T12:15:07Z", "message": "Adds custom headers for update requests"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "9f6dd20f44bc5628d6669cfc627951f46167a1e5", "author": {"user": {"login": "shubham1g5", "name": "Shubham Goyal"}}, "url": "https://github.com/dimagi/commcare-android/commit/9f6dd20f44bc5628d6669cfc627951f46167a1e5", "committedDate": "2020-08-19T09:56:19Z", "message": "Merge branch 'master' into updateRequestHeaders"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a3cb00b4ca17c3217077fce86f9452a912d38e04", "author": {"user": {"login": "shubham1g5", "name": "Shubham Goyal"}}, "url": "https://github.com/dimagi/commcare-android/commit/a3cb00b4ca17c3217077fce86f9452a912d38e04", "committedDate": "2020-08-19T12:18:34Z", "message": "Merge branch 'master' into updateRequestHeaders"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ad1e2fffbd9e68042cfe64ef2e188086c50d1b9e", "author": {"user": {"login": "shubham1g5", "name": "Shubham Goyal"}}, "url": "https://github.com/dimagi/commcare-android/commit/ad1e2fffbd9e68042cfe64ef2e188086c50d1b9e", "committedDate": "2020-08-19T16:56:09Z", "message": "Fixes a bug where update worker would throw unknown failure after completion"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b8f34a5edc9ddcccce1adaf83284c431a9e8ede1", "author": {"user": {"login": "shubham1g5", "name": "Shubham Goyal"}}, "url": "https://github.com/dimagi/commcare-android/commit/b8f34a5edc9ddcccce1adaf83284c431a9e8ede1", "committedDate": "2020-08-19T17:59:35Z", "message": "Adds register request calls"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "d1137fed26eba77382933a805d07337215425f3c", "author": {"user": {"login": "shubham1g5", "name": "Shubham Goyal"}}, "url": "https://github.com/dimagi/commcare-android/commit/d1137fed26eba77382933a805d07337215425f3c", "committedDate": "2020-08-19T18:00:23Z", "message": "test for request age with mockk"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "249a681dc97fee9c76d1e60189859317b1bd7561", "author": {"user": {"login": "shubham1g5", "name": "Shubham Goyal"}}, "url": "https://github.com/dimagi/commcare-android/commit/249a681dc97fee9c76d1e60189859317b1bd7561", "committedDate": "2020-08-19T19:45:56Z", "message": "corrects the success check for background update"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "3f2c73acec6ba1ffb1e6645681709dd4d868420e", "author": {"user": {"login": "shubham1g5", "name": "Shubham Goyal"}}, "url": "https://github.com/dimagi/commcare-android/commit/3f2c73acec6ba1ffb1e6645681709dd4d868420e", "committedDate": "2020-08-21T09:31:17Z", "message": "moved file package"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b3b34727a02fc5bdd1b5a4965475a854f7019a7f", "author": {"user": {"login": "shubham1g5", "name": "Shubham Goyal"}}, "url": "https://github.com/dimagi/commcare-android/commit/b3b34727a02fc5bdd1b5a4965475a854f7019a7f", "committedDate": "2020-08-21T09:48:48Z", "message": "convert the app update test to kotlin"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b5526b9a4826f91340346a86a25daa85fd62980e", "author": {"user": {"login": "shubham1g5", "name": "Shubham Goyal"}}, "url": "https://github.com/dimagi/commcare-android/commit/b5526b9a4826f91340346a86a25daa85fd62980e", "committedDate": "2020-08-21T12:51:47Z", "message": "Corrects the status code for upgrade success with tests"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "6e2ae91511c9e59201f5f384fc7742fcebe59c8d", "author": {"user": {"login": "shubham1g5", "name": "Shubham Goyal"}}, "url": "https://github.com/dimagi/commcare-android/commit/6e2ae91511c9e59201f5f384fc7742fcebe59c8d", "committedDate": "2020-08-22T08:07:23Z", "message": "Merge branch 'updateRequestHeaders' of https://github.com/dimagi/commcare-android into updateRequestHeaders"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f0bc70c384e52274d8ed6d59affb56a19313ebac", "author": {"user": {"login": "shubham1g5", "name": "Shubham Goyal"}}, "url": "https://github.com/dimagi/commcare-android/commit/f0bc70c384e52274d8ed6d59affb56a19313ebac", "committedDate": "2020-08-22T09:16:09Z", "message": "cleanup"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "cec404ea2d2e3975c13a1e23a952d02d51520e45", "author": {"user": {"login": "shubham1g5", "name": "Shubham Goyal"}}, "url": "https://github.com/dimagi/commcare-android/commit/cec404ea2d2e3975c13a1e23a952d02d51520e45", "committedDate": "2020-08-22T18:59:35Z", "message": "Adds tests for lazy media download"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f5dc48355fa804d2609ffe0144ae06d795953834", "author": {"user": {"login": "shubham1g5", "name": "Shubham Goyal"}}, "url": "https://github.com/dimagi/commcare-android/commit/f5dc48355fa804d2609ffe0144ae06d795953834", "committedDate": "2020-08-23T07:15:32Z", "message": "Only skip lazy media during update"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "46dabc4b2a34aa06134c18135d974223ef792f11", "author": {"user": {"login": "shubham1g5", "name": "Shubham Goyal"}}, "url": "https://github.com/dimagi/commcare-android/commit/46dabc4b2a34aa06134c18135d974223ef792f11", "committedDate": "2020-08-23T09:27:55Z", "message": "KDocs"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDczNzIwODQ5", "url": "https://github.com/dimagi/commcare-android/pull/2322#pullrequestreview-473720849", "createdAt": "2020-08-24T17:42:32Z", "commit": {"oid": "46dabc4b2a34aa06134c18135d974223ef792f11"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yNFQxNzo0MjozMlrOHFvt5w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yNFQxNzo0NTozNFrOHFv0MA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NTc4NjcyNw==", "bodyText": "It's best practice to treat these map objects as immutable to ensure that params don't leak between requests as is done here", "url": "https://github.com/dimagi/commcare-android/pull/2322#discussion_r475786727", "createdAt": "2020-08-24T17:42:32Z", "author": {"login": "ctsims"}, "path": "app/src/org/commcare/network/CommcareRequestGenerator.java", "diffHunk": "@@ -226,17 +233,19 @@ private static String getDigest() {\n \r\n     @Override\r\n     public Response<ResponseBody> simpleGet(String uri) throws IOException {\r\n-        return simpleGet(uri, new HashMap());\r\n+        return simpleGet(uri, new HashMap<>(), new HashMap<>());\r\n     }\r\n \r\n     @Override\r\n-    public Response<ResponseBody> simpleGet(String uri, Map<String, String> httpParams) throws IOException {\r\n+    public Response<ResponseBody> simpleGet(String uri, Map<String, String> httpParams, Map<String, String> httpHeaders) throws IOException {\r\n+        HashMap<String, String> headers = getHeaders(\"\");\r\n+        headers.putAll(httpHeaders);\r", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "46dabc4b2a34aa06134c18135d974223ef792f11"}, "originalPosition": 44}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NTc4ODMzNg==", "bodyText": "This is going to make the SharedPreferences object enormous, right? With potentially thousands of entries?\nI don't think that's a best practice for how we use these buckets. It could affect their perforamnce for what we expected to be very fast I/O lookups, and it will be hard for us to do things like migrate them. I think it would be better to store this data in its own db tables like we do for a few other models like the geocoder entity cache", "url": "https://github.com/dimagi/commcare-android/pull/2322#discussion_r475788336", "createdAt": "2020-08-24T17:45:34Z", "author": {"login": "ctsims"}, "path": "app/src/org/commcare/network/RequestStats.kt", "diffHunk": "@@ -0,0 +1,73 @@\n+package org.commcare.network\n+\n+import org.commcare.CommCareApp\n+import org.commcare.CommCareApplication\n+import org.commcare.resources.model.InstallRequestSource\n+import org.commcare.utils.SyncDetailCalculations.getDaysBetweenJavaDatetimes\n+import org.commcare.utils.TimeProvider\n+import java.util.*\n+\n+/**\n+ *  Used to keep track of metrics like time since last suceess for various resource install requests\n+ *  Any resource install workflows from [InstallRequestSource] should [register] before starting and\n+ *  [markSuccess] on a successful run\n+ */\n+object RequestStats {\n+\n+    @JvmStatic\n+    fun register(installRequestSource: InstallRequestSource) {\n+        register(CommCareApplication.instance().currentApp, installRequestSource)\n+    }\n+\n+    @JvmStatic\n+    fun register(app: CommCareApp, installRequestSource: InstallRequestSource) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "46dabc4b2a34aa06134c18135d974223ef792f11"}, "originalPosition": 23}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "34d9d17a6e6a51cbb4d420d755fc26268f18e5b5", "author": {"user": {"login": "shubham1g5", "name": "Shubham Goyal"}}, "url": "https://github.com/dimagi/commcare-android/commit/34d9d17a6e6a51cbb4d420d755fc26268f18e5b5", "committedDate": "2020-08-27T06:52:02Z", "message": "Wires install source via platform"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "94867c22b8402296f54d9c7bbb2515a22197f7e5", "author": {"user": {"login": "shubham1g5", "name": "Shubham Goyal"}}, "url": "https://github.com/dimagi/commcare-android/commit/94867c22b8402296f54d9c7bbb2515a22197f7e5", "committedDate": "2020-08-27T11:33:56Z", "message": "lower case enum values"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "161dac9d86717ba04d344fd8d7ee8f0f2ee8d280", "author": {"user": {"login": "shubham1g5", "name": "Shubham Goyal"}}, "url": "https://github.com/dimagi/commcare-android/commit/161dac9d86717ba04d344fd8d7ee8f0f2ee8d280", "committedDate": "2020-08-27T11:34:12Z", "message": "Adds commcare version as header in requests"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c1a5e43c88544858cc4dd4c209fb39dd7a90a4b9", "author": {"user": {"login": "shubham1g5", "name": "Shubham Goyal"}}, "url": "https://github.com/dimagi/commcare-android/commit/c1a5e43c88544858cc4dd4c209fb39dd7a90a4b9", "committedDate": "2020-08-27T11:40:33Z", "message": "make a new mutable copy of headers"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "5d5d5ad334b5d49b4f9df4d91304118c34a0f730", "author": {"user": {"login": "shubham1g5", "name": "Shubham Goyal"}}, "url": "https://github.com/dimagi/commcare-android/commit/5d5d5ad334b5d49b4f9df4d91304118c34a0f730", "committedDate": "2020-08-27T12:24:38Z", "message": "clears the install context"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDc2NjcyMzQ5", "url": "https://github.com/dimagi/commcare-android/pull/2322#pullrequestreview-476672349", "createdAt": "2020-08-27T12:32:13Z", "commit": {"oid": "5d5d5ad334b5d49b4f9df4d91304118c34a0f730"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yN1QxMjozMjoxM1rOHIOKEg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yN1QxMjozMjoxM1rOHIOKEg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3ODM4MjYxMA==", "bodyText": "Curious how is it different from BuildConfig.VERSION_NAME", "url": "https://github.com/dimagi/commcare-android/pull/2322#discussion_r478382610", "createdAt": "2020-08-27T12:32:13Z", "author": {"login": "ShivamPokhriyal"}, "path": "app/src/org/commcare/AppUtils.java", "diffHunk": "@@ -177,6 +177,13 @@ public static String getCurrentVersionString() {\n         return Localization.get(application.getString(R.string.app_version_string), new String[]{pi.versionName, String.valueOf(pi.versionCode), ccv, buildNumber, buildDate, profileVersion});\n     }\n \n+    public static String getCommCareVersion() throws PackageManager.NameNotFoundException {\n+        CommCareApplication application = CommCareApplication.instance();\n+        PackageManager pm = application.getPackageManager();\n+        PackageInfo pi = pm.getPackageInfo(application.getPackageName(), 0);\n+        return pi.versionName;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "5d5d5ad334b5d49b4f9df4d91304118c34a0f730"}, "originalPosition": 8}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "9ce804477231844805bf5bd545aabf223ad3cb5b", "author": {"user": {"login": "shubham1g5", "name": "Shubham Goyal"}}, "url": "https://github.com/dimagi/commcare-android/commit/9ce804477231844805bf5bd545aabf223ad3cb5b", "committedDate": "2020-08-27T13:12:30Z", "message": "using static version name from Build Config"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDc2NzU1NDI2", "url": "https://github.com/dimagi/commcare-android/pull/2322#pullrequestreview-476755426", "createdAt": "2020-08-27T14:05:40Z", "commit": {"oid": "5d5d5ad334b5d49b4f9df4d91304118c34a0f730"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yN1QxNDowNTo0MVrOHIR_FQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yN1QxNDowNTo0MVrOHIR_FQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3ODQ0NTMzMw==", "bodyText": "Also wondering why we removed suspend here?", "url": "https://github.com/dimagi/commcare-android/pull/2322#discussion_r478445333", "createdAt": "2020-08-27T14:05:41Z", "author": {"login": "ShivamPokhriyal"}, "path": "app/src/org/commcare/mediadownload/MissingMediaDownloadHelper.kt", "diffHunk": "@@ -171,7 +177,7 @@ object MissingMediaDownloadHelper : TableStateListener {\n     }\n \n \n-    private suspend fun downloadMissingMediaResource(uri: String): MissingMediaDownloadResult {\n+    private fun downloadMissingMediaResource(uri: String): MissingMediaDownloadResult {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "5d5d5ad334b5d49b4f9df4d91304118c34a0f730"}, "originalPosition": 61}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDc2NzYwNDIy", "url": "https://github.com/dimagi/commcare-android/pull/2322#pullrequestreview-476760422", "createdAt": "2020-08-27T14:10:47Z", "commit": {"oid": "5d5d5ad334b5d49b4f9df4d91304118c34a0f730"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yN1QxNDoxMDo0N1rOHISNzA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yN1QxNDoxMDo0N1rOHISNzA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3ODQ0OTEwMA==", "bodyText": "Earlier, we were using getHeaders(\"\") and now we're using getHeaders(null) which means now we'd not be having X_COMMCAREHQ_LAST_SYNC_TOKEN in the headers(Although it would be sent with empty value earlier). Is this expected?", "url": "https://github.com/dimagi/commcare-android/pull/2322#discussion_r478449100", "createdAt": "2020-08-27T14:10:47Z", "author": {"login": "ShivamPokhriyal"}, "path": "app/src/org/commcare/network/CommcareRequestGenerator.java", "diffHunk": "@@ -226,17 +242,19 @@ private static String getDigest() {\n \r\n     @Override\r\n     public Response<ResponseBody> simpleGet(String uri) throws IOException {\r\n-        return simpleGet(uri, new HashMap());\r\n+        return simpleGet(uri, new HashMap<>(), new HashMap<>());\r\n     }\r\n \r\n     @Override\r\n-    public Response<ResponseBody> simpleGet(String uri, Map<String, String> httpParams) throws IOException {\r\n+    public Response<ResponseBody> simpleGet(String uri, Map<String, String> httpParams, Map<String, String> httpHeaders) throws IOException {\r\n+        HashMap<String, String> headers = new HashMap<>(getHeaders(null));\r", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "5d5d5ad334b5d49b4f9df4d91304118c34a0f730"}, "originalPosition": 60}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDc2Nzk4OTkx", "url": "https://github.com/dimagi/commcare-android/pull/2322#pullrequestreview-476798991", "createdAt": "2020-08-27T14:49:42Z", "commit": {"oid": "9ce804477231844805bf5bd545aabf223ad3cb5b"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yN1QxNDo0OTo0MlrOHIT-XA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yN1QxNDo0OTo0MlrOHIT-XA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3ODQ3NzkxNg==", "bodyText": "nit: we can move -1 to a constant", "url": "https://github.com/dimagi/commcare-android/pull/2322#discussion_r478477916", "createdAt": "2020-08-27T14:49:42Z", "author": {"login": "ShivamPokhriyal"}, "path": "app/src/org/commcare/network/RequestStats.kt", "diffHunk": "@@ -0,0 +1,73 @@\n+package org.commcare.network\n+\n+import org.commcare.CommCareApp\n+import org.commcare.CommCareApplication\n+import org.commcare.resources.model.InstallRequestSource\n+import org.commcare.utils.SyncDetailCalculations.getDaysBetweenJavaDatetimes\n+import org.commcare.utils.TimeProvider\n+import java.util.*\n+\n+/**\n+ *  Used to keep track of metrics like time since last suceess for various resource install requests\n+ *  Any resource install workflows from [InstallRequestSource] should [register] before starting and\n+ *  [markSuccess] on a successful run\n+ */\n+object RequestStats {\n+\n+    @JvmStatic\n+    fun register(installRequestSource: InstallRequestSource) {\n+        register(CommCareApplication.instance().currentApp, installRequestSource)\n+    }\n+\n+    @JvmStatic\n+    fun register(app: CommCareApp, installRequestSource: InstallRequestSource) {\n+        val firstAttempt = getFirstRequestAttempt(app, installRequestSource);\n+        if (firstAttempt == -1L) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "9ce804477231844805bf5bd545aabf223ad3cb5b"}, "originalPosition": 25}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDc2ODAwNzk1", "url": "https://github.com/dimagi/commcare-android/pull/2322#pullrequestreview-476800795", "createdAt": "2020-08-27T14:51:17Z", "commit": {"oid": "9ce804477231844805bf5bd545aabf223ad3cb5b"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yN1QxNDo1MToxOFrOHIUDFA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yN1QxNDo1MToxOFrOHIUDFA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3ODQ3OTEyNA==", "bodyText": "Should we call markSuccess here?", "url": "https://github.com/dimagi/commcare-android/pull/2322#discussion_r478479124", "createdAt": "2020-08-27T14:51:18Z", "author": {"login": "ShivamPokhriyal"}, "path": "app/src/org/commcare/update/UpdateHelper.java", "diffHunk": "@@ -81,11 +83,11 @@ public static UpdateHelper getNewInstance(boolean autoUpdate, UpdateProgressList\n     }\n \n     // Main UpdateHelper function for staging updates\n-    public ResultAndError<AppInstallStatus> update(String profileRef) {\n-        setupUpdate(profileRef);\n+    public ResultAndError<AppInstallStatus> update(String profileRef, InstallRequestSource installRequestSource) {\n+        setupUpdate(profileRef, installRequestSource);\n \n         try {\n-            return new ResultAndError<>(stageUpdate(profileRef));\n+            return new ResultAndError<>(stageUpdate(profileRef, installRequestSource));", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "9ce804477231844805bf5bd545aabf223ad3cb5b"}, "originalPosition": 25}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b54772fabcf42b12b15c965e3474993929f41720", "author": {"user": {"login": "shubham1g5", "name": "Shubham Goyal"}}, "url": "https://github.com/dimagi/commcare-android/commit/b54772fabcf42b12b15c965e3474993929f41720", "committedDate": "2020-08-28T17:13:46Z", "message": "Removes unused param"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "d77da47e92d52430890be04bdffc9c64a9e8888f", "author": {"user": {"login": "shubham1g5", "name": "Shubham Goyal"}}, "url": "https://github.com/dimagi/commcare-android/commit/d77da47e92d52430890be04bdffc9c64a9e8888f", "committedDate": "2020-08-28T17:23:16Z", "message": "Adds installContext for install workflows"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "17ee141ff1e9fba1168a246195c777aa33be44fc", "author": {"user": {"login": "shubham1g5", "name": "Shubham Goyal"}}, "url": "https://github.com/dimagi/commcare-android/commit/17ee141ff1e9fba1168a246195c777aa33be44fc", "committedDate": "2020-08-28T17:58:47Z", "message": "Removes recovery param from install"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "4dfcf2cc969aee309aac45888abf783d81f280f1", "author": {"user": {"login": "shubham1g5", "name": "Shubham Goyal"}}, "url": "https://github.com/dimagi/commcare-android/commit/4dfcf2cc969aee309aac45888abf783d81f280f1", "committedDate": "2020-08-28T18:04:40Z", "message": "Merge branch 'lazyMediaTestsAndFixes' into updateRequestHeaders"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDc3OTM4MTYy", "url": "https://github.com/dimagi/commcare-android/pull/2322#pullrequestreview-477938162", "createdAt": "2020-08-28T18:21:41Z", "commit": {"oid": "4dfcf2cc969aee309aac45888abf783d81f280f1"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yOFQxODoyMTo0MVrOHJQTJg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yOFQxODoyMTo0MVrOHJQTJg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3OTQ2NjI3OA==", "bodyText": "was changed to support running on main thread for unit tests.", "url": "https://github.com/dimagi/commcare-android/pull/2322#discussion_r479466278", "createdAt": "2020-08-28T18:21:41Z", "author": {"login": "shubham1g5"}, "path": "app/src/org/commcare/mediadownload/MissingMediaDownloadHelper.kt", "diffHunk": "@@ -147,14 +153,14 @@ object MissingMediaDownloadHelper : TableStateListener {\n      * Downloads a resource with it's location represented by {@param mediaUri}\n      */\n     @JvmStatic\n-    fun requestMediaDownload(mediaUri: String, missingMediaDownloadListener: MissingMediaDownloadListener) {\n+    fun requestMediaDownload(mediaUri: String, defaultDispatcher: CoroutineDispatcher,", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "4dfcf2cc969aee309aac45888abf783d81f280f1"}, "originalPosition": 70}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "6f8c007476e1a49900426a2c4c43dd2ac536fdbc", "author": {"user": {"login": "shubham1g5", "name": "Shubham Goyal"}}, "url": "https://github.com/dimagi/commcare-android/commit/6f8c007476e1a49900426a2c4c43dd2ac536fdbc", "committedDate": "2020-08-28T18:41:04Z", "message": "Abstract Requeststat register and success for update in same method"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "51e61ee498fe11160de2889d516f551c2514b3f1", "author": {"user": {"login": "shubham1g5", "name": "Shubham Goyal"}}, "url": "https://github.com/dimagi/commcare-android/commit/51e61ee498fe11160de2889d516f551c2514b3f1", "committedDate": "2020-08-28T18:43:04Z", "message": "Imports"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDg1OTc5NDQ4", "url": "https://github.com/dimagi/commcare-android/pull/2322#pullrequestreview-485979448", "createdAt": "2020-09-10T14:12:55Z", "commit": {"oid": "51e61ee498fe11160de2889d516f551c2514b3f1"}, "state": "DISMISSED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "bd98b11d861530e2ef29d5f05533f80ea720a6bb", "author": {"user": {"login": "shubham1g5", "name": "Shubham Goyal"}}, "url": "https://github.com/dimagi/commcare-android/commit/bd98b11d861530e2ef29d5f05533f80ea720a6bb", "committedDate": "2020-09-11T09:38:00Z", "message": "Decouple ResourceInstallContext from platform"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "28700d14918be1a4977dd0155654b038d7f7a6b1", "author": {"user": {"login": "shubham1g5", "name": "Shubham Goyal"}}, "url": "https://github.com/dimagi/commcare-android/commit/28700d14918be1a4977dd0155654b038d7f7a6b1", "committedDate": "2020-09-11T10:13:05Z", "message": "Merge branch 'master' into updateRequestHeaders"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDg3NDU5NzUw", "url": "https://github.com/dimagi/commcare-android/pull/2322#pullrequestreview-487459750", "createdAt": "2020-09-14T06:51:46Z", "commit": {"oid": "28700d14918be1a4977dd0155654b038d7f7a6b1"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2111, "cost": 1, "resetAt": "2021-11-01T13:51:04Z"}}}