{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTIxNjMwMDA5", "number": 2407, "title": "Support for CommCare Identity Hooks", "bodyText": "Merges CommCare Support Lib in CommCare Android\nAdds support for Commcare Identity Hooks to support a generalized Identity Integration\n\nProduct Note: Adds support for out of box callout based integration with third party Identity Providers", "createdAt": "2020-11-16T12:23:22Z", "url": "https://github.com/dimagi/commcare-android/pull/2407", "merged": true, "mergeCommit": {"oid": "5ca13beee07b59d3e473de9d05fe99ce64449f24"}, "closed": true, "closedAt": "2021-01-07T07:49:14Z", "author": {"login": "shubham1g5"}, "timelineItems": {"totalCount": 14, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdawOaTgH2gAyNTIxNjMwMDA5OmFiMjBmMTIyNjcyYjRlNmU5MzA0ZTZjZDYxNmFhNTQ5ZDE4MDBjMDI=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdthA67AFqTU2Mjc4NTg4OA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "ab20f122672b4e6e9304e6cd616aa549d1800c02", "author": {"user": {"login": "shubham1g5", "name": "Shubham Goyal"}}, "url": "https://github.com/dimagi/commcare-android/commit/ab20f122672b4e6e9304e6cd616aa549d1800c02", "committedDate": "2020-11-09T08:10:27Z", "message": "Merge Support Library"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "847f26ac7bf24e510c8a0cf6c124f5fbefabdaeb", "author": {"user": {"login": "shubham1g5", "name": "Shubham Goyal"}}, "url": "https://github.com/dimagi/commcare-android/commit/847f26ac7bf24e510c8a0cf6c124f5fbefabdaeb", "committedDate": "2020-11-10T19:05:48Z", "message": "Adds handling for generalized Indentity Provider callouts"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "1c0b753ac06eed0aade36fa566d55034576ec594", "author": {"user": {"login": "shubham1g5", "name": "Shubham Goyal"}}, "url": "https://github.com/dimagi/commcare-android/commit/1c0b753ac06eed0aade36fa566d55034576ec594", "committedDate": "2020-11-16T12:13:24Z", "message": "Tests for Identity Worlflows with some test cleanup"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "397297c05f0d624001acaa5561262b53a6fff778", "author": {"user": {"login": "shubham1g5", "name": "Shubham Goyal"}}, "url": "https://github.com/dimagi/commcare-android/commit/397297c05f0d624001acaa5561262b53a6fff778", "committedDate": "2020-11-16T12:16:45Z", "message": "Merge branch 'master' into supportLibMerge"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b57827b47f104aa5e2db3bb5c5cadde36d0cad04", "author": {"user": {"login": "shubham1g5", "name": "Shubham Goyal"}}, "url": "https://github.com/dimagi/commcare-android/commit/b57827b47f104aa5e2db3bb5c5cadde36d0cad04", "committedDate": "2020-11-16T12:31:50Z", "message": "Bumps target version for support lib to be same as commcare"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTMxNDAwMzQx", "url": "https://github.com/dimagi/commcare-android/pull/2407#pullrequestreview-531400341", "createdAt": "2020-11-16T14:59:05Z", "commit": {"oid": "b57827b47f104aa5e2db3bb5c5cadde36d0cad04"}, "state": "COMMENTED", "comments": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xNlQxNDo1OTowNVrOH0Cm2Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xNlQxNjoxMjo1NVrOH0GEXw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNDMzMDcxMw==", "bodyText": "Woah, What does this annotation do?", "url": "https://github.com/dimagi/commcare-android/pull/2407#discussion_r524330713", "createdAt": "2020-11-16T14:59:05Z", "author": {"login": "ctsims"}, "path": "app/src/org/commcare/activities/EntitySelectActivity.java", "diffHunk": "@@ -664,9 +669,16 @@ private void handleSearchStringCallout(Intent intent) {\n         }\r\n     }\r\n \r\n-    private void handleFingerprintMatchCallout(Intent intent) {\r\n-        OrderedHashtable<String, String> guidToMatchConfidenceMap =\r\n-                SimprintsCalloutProcessing.getConfidenceMatchesFromCalloutResponse(intent);\r\n+    private void handleFingerprintMatchCallout(\r\n+            Intent intent,\r\n+            @IdentityCalloutHandler.IdentityProvider String identityProvider) {\r", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b57827b47f104aa5e2db3bb5c5cadde36d0cad04"}, "originalPosition": 38}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNDM4NDc3Nw==", "bodyText": "Is there still some way to specifically choose each identity provider (with, say, an ID the same way that SimPrints works?)?\nI doubt there will often be more than one in use at a time, but I imagine inside of an app, when people configure \"Their identify provider\" they may want to choose a specific one.", "url": "https://github.com/dimagi/commcare-android/pull/2407#discussion_r524384777", "createdAt": "2020-11-16T16:09:11Z", "author": {"login": "ctsims"}, "path": "app/src/org/commcare/provider/IdentityCalloutHandler.java", "diffHunk": "@@ -0,0 +1,174 @@\n+package org.commcare.provider;\n+\n+import android.content.Intent;\n+\n+import org.commcare.android.javarosa.IntentCallout;\n+import org.commcare.commcaresupportlibrary.identity.IdentityResponseBuilder;\n+import org.commcare.commcaresupportlibrary.identity.model.IdentificationMatch;\n+import org.commcare.commcaresupportlibrary.identity.model.MatchResult;\n+import org.commcare.commcaresupportlibrary.identity.model.MatchStrength;\n+import org.commcare.commcaresupportlibrary.identity.model.RegistrationResult;\n+import org.commcare.commcaresupportlibrary.identity.model.VerificationMatch;\n+import org.commcare.util.LogTypes;\n+import org.javarosa.core.model.FormDef;\n+import org.javarosa.core.model.condition.EvaluationContext;\n+import org.javarosa.core.model.instance.AbstractTreeElement;\n+import org.javarosa.core.model.instance.TreeReference;\n+import org.javarosa.core.services.Logger;\n+import org.javarosa.core.services.locale.Localization;\n+import org.javarosa.core.util.OrderedHashtable;\n+\n+import java.lang.annotation.Retention;\n+import java.lang.annotation.RetentionPolicy;\n+import java.util.Collections;\n+import java.util.Hashtable;\n+import java.util.List;\n+import java.util.Vector;\n+\n+import androidx.annotation.StringDef;\n+\n+public class IdentityCalloutHandler {\n+\n+\n+    private static final String REF_GUID = \"guid\";\n+    private static final String REF_CONFIDENCE = \"confidence\";\n+    private static final String REF_MATCH_STRENGTH = \"match_strength\";\n+\n+    public static final String GENERALIZED_IDENTITY_PROVIDER = \"generalized_identity_provider\";\n+\n+\n+    @StringDef({GENERALIZED_IDENTITY_PROVIDER, SimprintsCalloutProcessing.SIMPRINTS_IDENTITY_PROVIDER})\n+    @Retention(RetentionPolicy.SOURCE)\n+    public @interface IdentityProvider {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b57827b47f104aa5e2db3bb5c5cadde36d0cad04"}, "originalPosition": 42}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNDM4NTYxNw==", "bodyText": "Is there something unique to how this app works? The pattern of having the class itself consist ~entirely of static members makes it seem like it's doing something specific that I don't quite understand, but I could also see this just being a set of helper methods.", "url": "https://github.com/dimagi/commcare-android/pull/2407#discussion_r524385617", "createdAt": "2020-11-16T16:10:22Z", "author": {"login": "ctsims"}, "path": "app/src/org/commcare/provider/IdentityCalloutHandler.java", "diffHunk": "@@ -0,0 +1,174 @@\n+package org.commcare.provider;\n+\n+import android.content.Intent;\n+\n+import org.commcare.android.javarosa.IntentCallout;\n+import org.commcare.commcaresupportlibrary.identity.IdentityResponseBuilder;\n+import org.commcare.commcaresupportlibrary.identity.model.IdentificationMatch;\n+import org.commcare.commcaresupportlibrary.identity.model.MatchResult;\n+import org.commcare.commcaresupportlibrary.identity.model.MatchStrength;\n+import org.commcare.commcaresupportlibrary.identity.model.RegistrationResult;\n+import org.commcare.commcaresupportlibrary.identity.model.VerificationMatch;\n+import org.commcare.util.LogTypes;\n+import org.javarosa.core.model.FormDef;\n+import org.javarosa.core.model.condition.EvaluationContext;\n+import org.javarosa.core.model.instance.AbstractTreeElement;\n+import org.javarosa.core.model.instance.TreeReference;\n+import org.javarosa.core.services.Logger;\n+import org.javarosa.core.services.locale.Localization;\n+import org.javarosa.core.util.OrderedHashtable;\n+\n+import java.lang.annotation.Retention;\n+import java.lang.annotation.RetentionPolicy;\n+import java.util.Collections;\n+import java.util.Hashtable;\n+import java.util.List;\n+import java.util.Vector;\n+\n+import androidx.annotation.StringDef;\n+\n+public class IdentityCalloutHandler {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b57827b47f104aa5e2db3bb5c5cadde36d0cad04"}, "originalPosition": 30}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNDM4NzQyMw==", "bodyText": "I'm presuming these were copied over ~identically from the support library and don't need new review, is that assumption correct?", "url": "https://github.com/dimagi/commcare-android/pull/2407#discussion_r524387423", "createdAt": "2020-11-16T16:12:55Z", "author": {"login": "ctsims"}, "path": "commcare-support-library/src/main/java/org/commcare/commcaresupportlibrary/CaseUtils.java", "diffHunk": "@@ -0,0 +1,252 @@\n+package org.commcare.commcaresupportlibrary;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b57827b47f104aa5e2db3bb5c5cadde36d0cad04"}, "originalPosition": 1}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "776e6728f0543a1321e7592e492ecaa62aa04c86", "author": {"user": {"login": "shubham1g5", "name": "Shubham Goyal"}}, "url": "https://github.com/dimagi/commcare-android/commit/776e6728f0543a1321e7592e492ecaa62aa04c86", "committedDate": "2020-11-23T12:55:01Z", "message": "Duplicate handling during identity registration"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c00603e7325557912ea711711b9d737c865cd297", "author": {"user": {"login": "shubham1g5", "name": "Shubham Goyal"}}, "url": "https://github.com/dimagi/commcare-android/commit/c00603e7325557912ea711711b9d737c865cd297", "committedDate": "2020-12-11T10:21:37Z", "message": "Update identity_integration.md\n\ndoc correction"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "dbffa263e9329d1eadd134567ec035da60406249", "author": {"user": {"login": "shubham1g5", "name": "Shubham Goyal"}}, "url": "https://github.com/dimagi/commcare-android/commit/dbffa263e9329d1eadd134567ec035da60406249", "committedDate": "2020-12-11T10:22:11Z", "message": "Update identity_integration.md\n\nfinalize -> finalizeResponse"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a8daf62e6386779f42f1c606701a912e70d553fa", "author": {"user": {"login": "shubham1g5", "name": "Shubham Goyal"}}, "url": "https://github.com/dimagi/commcare-android/commit/a8daf62e6386779f42f1c606701a912e70d553fa", "committedDate": "2020-12-15T07:22:29Z", "message": "Update identity_integration.md\n\ncorrect docs for Identification -> IdentificationMatch"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "36e7cfb222c6bce3f1d8333f65e3b644e9b9ab84", "author": {"user": {"login": "shubham1g5", "name": "Shubham Goyal"}}, "url": "https://github.com/dimagi/commcare-android/commit/36e7cfb222c6bce3f1d8333f65e3b644e9b9ab84", "committedDate": "2020-12-17T10:48:48Z", "message": "fixes return values for identity callouts"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "bd641df727017cf294c8f0fe79733985ad4c136f", "author": {"user": {"login": "shubham1g5", "name": "Shubham Goyal"}}, "url": "https://github.com/dimagi/commcare-android/commit/bd641df727017cf294c8f0fe79733985ad4c136f", "committedDate": "2020-12-17T11:43:48Z", "message": "set responses to intent question reference for identity callouts"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "d7139c9aac3b6cf5be42097ebe04e917112520bc", "author": {"user": {"login": "shubham1g5", "name": "Shubham Goyal"}}, "url": "https://github.com/dimagi/commcare-android/commit/d7139c9aac3b6cf5be42097ebe04e917112520bc", "committedDate": "2020-12-17T11:45:02Z", "message": "Merge branch 'supportLibMerge' of https://github.com/dimagi/commcare-android into supportLibMerge"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTYyNzg1ODg4", "url": "https://github.com/dimagi/commcare-android/pull/2407#pullrequestreview-562785888", "createdAt": "2021-01-06T15:11:42Z", "commit": {"oid": "d7139c9aac3b6cf5be42097ebe04e917112520bc"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2010, "cost": 1, "resetAt": "2021-11-01T13:51:04Z"}}}