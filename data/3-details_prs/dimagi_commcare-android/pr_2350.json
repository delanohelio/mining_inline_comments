{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDg5MjIyNjg0", "number": 2350, "title": "fix update completion indicator in case of background update", "bodyText": "Issue: When user opens up the Update check while a background update is in progress, the update UI fails to transition to update \"ready to install\" state because of incorrect check on updateStats in case of a success", "createdAt": "2020-09-18T10:22:18Z", "url": "https://github.com/dimagi/commcare-android/pull/2350", "merged": true, "mergeCommit": {"oid": "074386542460e4dd6ffb85b66d83f19f3ea4a891"}, "closed": true, "closedAt": "2020-09-18T11:15:58Z", "author": {"login": "shubham1g5"}, "timelineItems": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdKC6-JAH2gAyNDg5MjIyNjg0OjNmMjg3OWU2ODZhNDk5YTljMjE4NjlmM2NiZGVhYmUzMmMyMDU1ZTM=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdKDo1sAFqTQ5MTM2NzY3Nw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "3f2879e686a499a9c21869f3cbdeabe32c2055e3", "author": {"user": {"login": "shubham1g5", "name": "Shubham Goyal"}}, "url": "https://github.com/dimagi/commcare-android/commit/3f2879e686a499a9c21869f3cbdeabe32c2055e3", "committedDate": "2020-09-18T10:20:42Z", "message": "fix update completion indicator in case of background update"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f02e591cd867c1ed9846a5de7dbed095385a574a", "author": {"user": {"login": "shubham1g5", "name": "Shubham Goyal"}}, "url": "https://github.com/dimagi/commcare-android/commit/f02e591cd867c1ed9846a5de7dbed095385a574a", "committedDate": "2020-09-18T10:25:14Z", "message": "throw unknown failure in case update is not ready"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDkxMzYwMjkw", "url": "https://github.com/dimagi/commcare-android/pull/2350#pullrequestreview-491360290", "createdAt": "2020-09-18T10:59:22Z", "commit": {"oid": "f02e591cd867c1ed9846a5de7dbed095385a574a"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xOFQxMDo1OToyMlrOHUIP8A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xOFQxMDo1OToyMlrOHUIP8A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MDg2ODcyMA==", "bodyText": "Why are we using this one if ResourceInstallUtils.isUpdateReadyToInstall() gives the correct result?", "url": "https://github.com/dimagi/commcare-android/pull/2350#discussion_r490868720", "createdAt": "2020-09-18T10:59:22Z", "author": {"login": "ShivamPokhriyal"}, "path": "app/src/org/commcare/activities/UpdateActivity.java", "diffHunk": "@@ -177,17 +177,22 @@ private void connectToUpdateWorker() {\n                                 data.getInt(UpdateWorker.Progress_Total, -1));\n                     } else {\n                         // Worker getting fired when not running imply completion of worker\n-                        ResultAndError<AppInstallStatus> lastUpdateResult = getlastStageUpdateResult();\n-                        if (lastUpdateResult != null) {\n-                            handleTaskCompletion(getlastStageUpdateResult());\n-                        }\n+                        handleTaskCompletion(getlastStageUpdateResult());\n                     }\n                 });\n     }\n \n     private ResultAndError<AppInstallStatus> getlastStageUpdateResult() {\n         UpdateStats updateStats = UpdateStats.loadUpdateStats(CommCareApplication.instance().getCurrentApp());\n-        return updateStats.getLastStageUpdateResult();\n+        ResultAndError<AppInstallStatus> lastUpdateResult = updateStats.getLastStageUpdateResult();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f02e591cd867c1ed9846a5de7dbed095385a574a"}, "originalPosition": 16}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDkxMzY3Njc3", "url": "https://github.com/dimagi/commcare-android/pull/2350#pullrequestreview-491367677", "createdAt": "2020-09-18T11:10:48Z", "commit": {"oid": "f02e591cd867c1ed9846a5de7dbed095385a574a"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1934, "cost": 1, "resetAt": "2021-11-01T13:51:04Z"}}}