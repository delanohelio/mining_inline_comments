{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTEyMTU1OTAx", "number": 2396, "title": "Add manual quarantine tests", "bodyText": "#2341", "createdAt": "2020-10-29T10:01:18Z", "url": "https://github.com/dimagi/commcare-android/pull/2396", "merged": true, "mergeCommit": {"oid": "346ab5ad02636b4b7db8869625ce3125e5c638a3"}, "closed": true, "closedAt": "2020-11-05T12:22:39Z", "author": {"login": "ShivamPokhriyal"}, "timelineItems": {"totalCount": 9, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdXgvrcAFqTUyMDQwMDI2OQ==", "endCursor": "Y3Vyc29yOnYyOpPPAAABdZhSn2gFqTUyNDIwMDQ1Mg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTIwNDAwMjY5", "url": "https://github.com/dimagi/commcare-android/pull/2396#pullrequestreview-520400269", "createdAt": "2020-10-30T06:19:58Z", "commit": {"oid": "19543378bb8be61d6ce1f182fafc1ba21660bfe1"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0zMFQwNjoxOTo1OFrOHrCiww==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0zMFQwNjoyNTo1OVrOHrCpLw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNDg5MjQ4Mw==", "bodyText": "nit: if we are using position as input to openModule, we should put a comment here specifiying the text of module we want to open for better readability or move the value 12 in a constant whose name indicates what module this position is for.", "url": "https://github.com/dimagi/commcare-android/pull/2396#discussion_r514892483", "createdAt": "2020-10-30T06:19:58Z", "author": {"login": "shubham1g5"}, "path": "app/instrumentation-tests/src/org/commcare/androidTests/ManualQuarantineTest.kt", "diffHunk": "@@ -0,0 +1,126 @@\n+package org.commcare.androidTests\n+\n+import android.os.Build\n+import androidx.test.espresso.Espresso.onView\n+import androidx.test.espresso.action.ViewActions.click\n+import androidx.test.espresso.action.ViewActions.longClick\n+import androidx.test.espresso.matcher.ViewMatchers.withId\n+import androidx.test.espresso.matcher.ViewMatchers.withText\n+import androidx.test.ext.junit.runners.AndroidJUnit4\n+import androidx.test.filters.LargeTest\n+import androidx.test.filters.SdkSuppress\n+import org.commcare.dalvik.R\n+import org.commcare.utils.CustomMatchers\n+import org.commcare.utils.InstrumentationUtility\n+import org.commcare.utils.doesNotExist\n+import org.commcare.utils.isDisplayed\n+import org.hamcrest.Matchers.allOf\n+import org.junit.Before\n+import org.junit.FixMethodOrder\n+import org.junit.Test\n+import org.junit.runner.RunWith\n+import org.junit.runners.MethodSorters\n+\n+@RunWith(AndroidJUnit4::class)\n+@LargeTest\n+@SdkSuppress(maxSdkVersion = Build.VERSION_CODES.Q)\n+@FixMethodOrder(MethodSorters.NAME_ASCENDING)\n+class ManualQuarantineTest: BaseTest() {\n+\n+    companion object {\n+        const val CCZ_NAME = \"ccqa.ccz\"\n+        const val APP_NAME = \"Basic Tests\"\n+    }\n+\n+    @Before\n+    fun setup() {\n+        installApp(APP_NAME, CCZ_NAME)\n+        InstrumentationUtility.login(\"test\", \"1234\")\n+        // Enable quarantine\n+        enableFormQuarantine()\n+        InstrumentationUtility.changeWifi(false)\n+    }\n+\n+    private fun enableFormQuarantine() {\n+        InstrumentationUtility.gotoHome()\n+        InstrumentationUtility.selectOptionItem(withText(\"Advanced\"))\n+        onView(withText(\"Enable Manual Form Quarantine\"))\n+                .perform(click())\n+        InstrumentationUtility.gotoHome()\n+    }\n+\n+    @Test\n+    fun test_A_Quarantine() {\n+        InstrumentationUtility.openModule(12)", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "19543378bb8be61d6ce1f182fafc1ba21660bfe1"}, "originalPosition": 54}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNDg5MzI5NA==", "bodyText": "we should add an additional step that just checks that you can't quarantine without this call.", "url": "https://github.com/dimagi/commcare-android/pull/2396#discussion_r514893294", "createdAt": "2020-10-30T06:23:08Z", "author": {"login": "shubham1g5"}, "path": "app/instrumentation-tests/src/org/commcare/androidTests/ManualQuarantineTest.kt", "diffHunk": "@@ -0,0 +1,126 @@\n+package org.commcare.androidTests\n+\n+import android.os.Build\n+import androidx.test.espresso.Espresso.onView\n+import androidx.test.espresso.action.ViewActions.click\n+import androidx.test.espresso.action.ViewActions.longClick\n+import androidx.test.espresso.matcher.ViewMatchers.withId\n+import androidx.test.espresso.matcher.ViewMatchers.withText\n+import androidx.test.ext.junit.runners.AndroidJUnit4\n+import androidx.test.filters.LargeTest\n+import androidx.test.filters.SdkSuppress\n+import org.commcare.dalvik.R\n+import org.commcare.utils.CustomMatchers\n+import org.commcare.utils.InstrumentationUtility\n+import org.commcare.utils.doesNotExist\n+import org.commcare.utils.isDisplayed\n+import org.hamcrest.Matchers.allOf\n+import org.junit.Before\n+import org.junit.FixMethodOrder\n+import org.junit.Test\n+import org.junit.runner.RunWith\n+import org.junit.runners.MethodSorters\n+\n+@RunWith(AndroidJUnit4::class)\n+@LargeTest\n+@SdkSuppress(maxSdkVersion = Build.VERSION_CODES.Q)\n+@FixMethodOrder(MethodSorters.NAME_ASCENDING)\n+class ManualQuarantineTest: BaseTest() {\n+\n+    companion object {\n+        const val CCZ_NAME = \"ccqa.ccz\"\n+        const val APP_NAME = \"Basic Tests\"\n+    }\n+\n+    @Before\n+    fun setup() {\n+        installApp(APP_NAME, CCZ_NAME)\n+        InstrumentationUtility.login(\"test\", \"1234\")\n+        // Enable quarantine\n+        enableFormQuarantine()\n+        InstrumentationUtility.changeWifi(false)\n+    }\n+\n+    private fun enableFormQuarantine() {\n+        InstrumentationUtility.gotoHome()\n+        InstrumentationUtility.selectOptionItem(withText(\"Advanced\"))\n+        onView(withText(\"Enable Manual Form Quarantine\"))\n+                .perform(click())\n+        InstrumentationUtility.gotoHome()\n+    }\n+\n+    @Test\n+    fun test_A_Quarantine() {\n+        InstrumentationUtility.openModule(12)\n+        onView(withId(R.id.nav_btn_finish))\n+                .perform(click())\n+        InstrumentationUtility.openModule(12)\n+        onView(withId(R.id.nav_btn_finish))\n+                .perform(click())\n+\n+        // Go to saved forms and quarantine them\n+        InstrumentationUtility.selectOptionItem(withText(\"Saved Forms\"))\n+\n+        // Quarantine first form.\n+        onView(CustomMatchers.find(\n+                allOf(withText(\"Display Form\")),\n+                1\n+        )).perform(longClick())\n+        // Unsent forms should not be delete-able\n+        withText(\"Delete Record\").doesNotExist()\n+        onView(withText(\"Scan Record Integrity\"))\n+                .perform(click())\n+        onView(withText(\"QUARANTINE FORM\"))\n+                .perform(click())\n+\n+        // After quarantining one form we'll have to re-enable quarantine setting.\n+        enableFormQuarantine()", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "19543378bb8be61d6ce1f182fafc1ba21660bfe1"}, "originalPosition": 77}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNDg5NDEyNw==", "bodyText": "Need to suppress below Android 10", "url": "https://github.com/dimagi/commcare-android/pull/2396#discussion_r514894127", "createdAt": "2020-10-30T06:25:59Z", "author": {"login": "shubham1g5"}, "path": "app/instrumentation-tests/src/org/commcare/androidTests/ManualQuarantineTest.kt", "diffHunk": "@@ -0,0 +1,126 @@\n+package org.commcare.androidTests\n+\n+import android.os.Build\n+import androidx.test.espresso.Espresso.onView\n+import androidx.test.espresso.action.ViewActions.click\n+import androidx.test.espresso.action.ViewActions.longClick\n+import androidx.test.espresso.matcher.ViewMatchers.withId\n+import androidx.test.espresso.matcher.ViewMatchers.withText\n+import androidx.test.ext.junit.runners.AndroidJUnit4\n+import androidx.test.filters.LargeTest\n+import androidx.test.filters.SdkSuppress\n+import org.commcare.dalvik.R\n+import org.commcare.utils.CustomMatchers\n+import org.commcare.utils.InstrumentationUtility\n+import org.commcare.utils.doesNotExist\n+import org.commcare.utils.isDisplayed\n+import org.hamcrest.Matchers.allOf\n+import org.junit.Before\n+import org.junit.FixMethodOrder\n+import org.junit.Test\n+import org.junit.runner.RunWith\n+import org.junit.runners.MethodSorters\n+\n+@RunWith(AndroidJUnit4::class)\n+@LargeTest\n+@SdkSuppress(maxSdkVersion = Build.VERSION_CODES.Q)\n+@FixMethodOrder(MethodSorters.NAME_ASCENDING)\n+class ManualQuarantineTest: BaseTest() {\n+\n+    companion object {\n+        const val CCZ_NAME = \"ccqa.ccz\"\n+        const val APP_NAME = \"Basic Tests\"\n+    }\n+\n+    @Before\n+    fun setup() {\n+        installApp(APP_NAME, CCZ_NAME)\n+        InstrumentationUtility.login(\"test\", \"1234\")\n+        // Enable quarantine\n+        enableFormQuarantine()\n+        InstrumentationUtility.changeWifi(false)", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "19543378bb8be61d6ce1f182fafc1ba21660bfe1"}, "originalPosition": 41}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "5f8e6611e069ff8da727a5cbbe09367ccee66b9f", "author": {"user": {"login": "ShivamPokhriyal", "name": "Shivam Pokhriyal"}}, "url": "https://github.com/dimagi/commcare-android/commit/5f8e6611e069ff8da727a5cbbe09367ccee66b9f", "committedDate": "2020-11-04T09:40:24Z", "message": "Add manual quarantine tests"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "323fc84e8108f23626bb185afbdda8a9ee926bf9", "author": {"user": {"login": "ShivamPokhriyal", "name": "Shivam Pokhriyal"}}, "url": "https://github.com/dimagi/commcare-android/commit/323fc84e8108f23626bb185afbdda8a9ee926bf9", "committedDate": "2020-11-04T09:40:24Z", "message": "PR suggestion"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "7d87c33356a44ab86b2e1e3e462dc76c34c9df3f", "author": {"user": {"login": "ShivamPokhriyal", "name": "Shivam Pokhriyal"}}, "url": "https://github.com/dimagi/commcare-android/commit/7d87c33356a44ab86b2e1e3e462dc76c34c9df3f", "committedDate": "2020-11-04T09:40:24Z", "message": "Add custom annotation for wifi dependent tests"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "989224c7fc5c0da54602cdb995ed5e9691922677", "author": {"user": {"login": "ShivamPokhriyal", "name": "Shivam Pokhriyal"}}, "url": "https://github.com/dimagi/commcare-android/commit/989224c7fc5c0da54602cdb995ed5e9691922677", "committedDate": "2020-11-04T09:52:30Z", "message": "Add custom annotation for running tests on browserstack"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "5afb762f5280e0dbe5a0da417e9eddbbac412d78", "author": {"user": {"login": "ShivamPokhriyal", "name": "Shivam Pokhriyal"}}, "url": "https://github.com/dimagi/commcare-android/commit/5afb762f5280e0dbe5a0da417e9eddbbac412d78", "committedDate": "2020-11-04T07:56:54Z", "message": "Add custom annotation for wifi dependent tests"}, "afterCommit": {"oid": "989224c7fc5c0da54602cdb995ed5e9691922677", "author": {"user": {"login": "ShivamPokhriyal", "name": "Shivam Pokhriyal"}}, "url": "https://github.com/dimagi/commcare-android/commit/989224c7fc5c0da54602cdb995ed5e9691922677", "committedDate": "2020-11-04T09:52:30Z", "message": "Add custom annotation for running tests on browserstack"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "0c7dffdfc69e911f188c943a0b4f3b37f62dbc66", "author": {"user": {"login": "ShivamPokhriyal", "name": "Shivam Pokhriyal"}}, "url": "https://github.com/dimagi/commcare-android/commit/0c7dffdfc69e911f188c943a0b4f3b37f62dbc66", "committedDate": "2020-11-04T10:18:54Z", "message": "Fix annotation param value for browserstack"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c26ad19f40d000ac886c96537bc673811b07a733", "author": {"user": {"login": "ShivamPokhriyal", "name": "Shivam Pokhriyal"}}, "url": "https://github.com/dimagi/commcare-android/commit/c26ad19f40d000ac886c96537bc673811b07a733", "committedDate": "2020-11-04T10:25:11Z", "message": "Use notAnnotation to run tests skipped on browserstack"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTI0MjAwNDUy", "url": "https://github.com/dimagi/commcare-android/pull/2396#pullrequestreview-524200452", "createdAt": "2020-11-05T12:12:33Z", "commit": {"oid": "c26ad19f40d000ac886c96537bc673811b07a733"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1993, "cost": 1, "resetAt": "2021-11-01T13:51:04Z"}}}