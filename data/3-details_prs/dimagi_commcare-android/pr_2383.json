{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTA2NDkzMTcz", "number": 2383, "title": "Add case list search and sort tests ", "bodyText": "#2341", "createdAt": "2020-10-20T05:52:27Z", "url": "https://github.com/dimagi/commcare-android/pull/2383", "merged": true, "mergeCommit": {"oid": "c8d6e8d9fe04de8ac211c00c6c47f4e469a20b09"}, "closed": true, "closedAt": "2020-10-28T09:34:55Z", "author": {"login": "ShivamPokhriyal"}, "timelineItems": {"totalCount": 6, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdUYsaQgH2gAyNTA2NDkzMTczOjM4NzQwNmZhOTc1MWMyMDY5NGM1MzkyYjExOTRiYWFjN2JjY2M1MDI=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdUpkJxgFqTUxMzQ1NDcyNA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "387406fa9751c20694c5392b1194baac7bccc502", "author": {"user": {"login": "ShivamPokhriyal", "name": "Shivam Pokhriyal"}}, "url": "https://github.com/dimagi/commcare-android/commit/387406fa9751c20694c5392b1194baac7bccc502", "committedDate": "2020-10-20T13:21:57Z", "message": "Add case list search tests"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "67996a4057912a803b1e5bea344d6bbb111cd697", "author": {"user": {"login": "ShivamPokhriyal", "name": "Shivam Pokhriyal"}}, "url": "https://github.com/dimagi/commcare-android/commit/67996a4057912a803b1e5bea344d6bbb111cd697", "committedDate": "2020-10-20T13:21:57Z", "message": "Add case list sort tests"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "9c6135cc4d28537fb4cf22ff3782dc0e65a17479", "author": {"user": {"login": "ShivamPokhriyal", "name": "Shivam Pokhriyal"}}, "url": "https://github.com/dimagi/commcare-android/commit/9c6135cc4d28537fb4cf22ff3782dc0e65a17479", "committedDate": "2020-10-20T05:51:16Z", "message": "Add case list search tests"}, "afterCommit": {"oid": "67996a4057912a803b1e5bea344d6bbb111cd697", "author": {"user": {"login": "ShivamPokhriyal", "name": "Shivam Pokhriyal"}}, "url": "https://github.com/dimagi/commcare-android/commit/67996a4057912a803b1e5bea344d6bbb111cd697", "committedDate": "2020-10-20T13:21:57Z", "message": "Add case list sort tests"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "efd7bf26a5818f14262903e6db53b8da0c465e09", "author": {"user": {"login": "ShivamPokhriyal", "name": "Shivam Pokhriyal"}}, "url": "https://github.com/dimagi/commcare-android/commit/efd7bf26a5818f14262903e6db53b8da0c465e09", "committedDate": "2020-10-21T06:07:15Z", "message": "Fix case list search test"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "800a73667f5c5f5491c6030a332bf90aeca5519f", "author": {"user": {"login": "ShivamPokhriyal", "name": "Shivam Pokhriyal"}}, "url": "https://github.com/dimagi/commcare-android/commit/800a73667f5c5f5491c6030a332bf90aeca5519f", "committedDate": "2020-10-21T06:47:37Z", "message": "Fix import issues"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTEzNDU0NzI0", "url": "https://github.com/dimagi/commcare-android/pull/2383#pullrequestreview-513454724", "createdAt": "2020-10-21T08:57:31Z", "commit": {"oid": "800a73667f5c5f5491c6030a332bf90aeca5519f"}, "state": "APPROVED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yMVQwODo1NzozMVrOHlhf5g==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yMVQwODo1NzozMVrOHlhf5g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwOTEwODE5OA==", "bodyText": "reason is outlined here and we should retain that comment.", "url": "https://github.com/dimagi/commcare-android/pull/2383#discussion_r509108198", "createdAt": "2020-10-21T08:57:31Z", "author": {"login": "shubham1g5"}, "path": "app/instrumentation-tests/src/org/commcare/androidTests/CaseListSearchTest.kt", "diffHunk": "@@ -0,0 +1,138 @@\n+package org.commcare.androidTests\n+\n+import android.content.res.Resources\n+import androidx.test.espresso.Espresso\n+import androidx.test.espresso.Espresso.closeSoftKeyboard\n+import androidx.test.espresso.Espresso.onView\n+import androidx.test.espresso.action.ViewActions.click\n+import androidx.test.espresso.action.ViewActions.typeText\n+import androidx.test.espresso.assertion.ViewAssertions.doesNotExist\n+import androidx.test.espresso.assertion.ViewAssertions.matches\n+import androidx.test.espresso.matcher.ViewMatchers.*\n+import androidx.test.ext.junit.runners.AndroidJUnit4\n+import androidx.test.filters.LargeTest\n+import org.commcare.dalvik.R\n+import org.commcare.utils.CustomMatchers\n+import org.commcare.utils.InstrumentationUtility\n+import org.hamcrest.Matchers.*\n+import org.junit.Before\n+import org.junit.Test\n+import org.junit.runner.RunWith\n+\n+@RunWith(AndroidJUnit4::class)\n+@LargeTest\n+class CaseListSearchTest: BaseTest() {\n+\n+    companion object {\n+        const val CCZ_NAME = \"test_list_search.ccz\"\n+        const val APP_NAME = \"Test: List Searching\"\n+        val entities = arrayOf(\"Christy\", \"Matthew\", \"Steven\", \"Tuco\")\n+    }\n+\n+    @Before\n+    fun setup() {\n+        installApp(APP_NAME, CCZ_NAME)\n+        InstrumentationUtility.login(\"test_list_search\", \"123\")\n+    }\n+\n+    @Test\n+    fun testSearch() {\n+        gotoSearchTestModule()\n+\n+        // Confirm 4 items in the list\n+        onView(withId(R.id.screen_entity_select_list))\n+                .check(matches(CustomMatchers.matchListSize(4)))\n+        matchListItems(entities)\n+\n+        onView(withId(R.id.search_action_bar))\n+                .perform(click())\n+\n+        val searchTextId = Resources.getSystem().getIdentifier(\"android:id/search_src_text\", null, null)\n+\n+        // type `c` and search\n+        onView(withClassName(endsWith(\"SearchAutoComplete\")))\n+                .perform(typeText(\"c\"))\n+        matchList(2, 4, \"c\", arrayOf(entities[0], entities[3]))\n+\n+        // type `h` and search\n+        onView(withClassName(endsWith(\"SearchAutoComplete\")))\n+                .perform(typeText(\"h\"))\n+        matchList(1, 4, \"ch\", arrayOf(entities[0]))\n+\n+        // Confirm it persists on rotation\n+        InstrumentationUtility.rotateLeft()\n+        Espresso.closeSoftKeyboard()\n+        matchList(1, 4, \"ch\", arrayOf(entities[0]))\n+\n+        InstrumentationUtility.rotatePortrait()\n+        Espresso.closeSoftKeyboard()\n+        matchList(1, 4, \"ch\", arrayOf(entities[0]))\n+\n+        onView(allOf(withClassName(endsWith(\"ImageView\")), withContentDescription(\"Clear query\")))\n+                .perform(click())\n+        onView(withText(containsString(\"results for your search\")))\n+                .check(matches(not(isDisplayed())))\n+        matchListItems(entities)\n+\n+        onView(withText(\"Search Tests\"))\n+                .check(doesNotExist())\n+        InstrumentationUtility.gotoHome()\n+\n+        // Start Over\n+        gotoSearchTestModule()\n+\n+        // Clearing searches the other way\n+        onView(withId(R.id.search_action_bar))\n+                .perform(click())\n+        onView(withClassName(endsWith(\"SearchAutoComplete\")))\n+                .perform(typeText(\"x\"))\n+        matchList(0, 4, \"x\", null)\n+        closeSoftKeyboard()\n+        // Use back to clear search\n+        // For some weird reasons, pressing back once doesn't work with searchview.", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "800a73667f5c5f5491c6030a332bf90aeca5519f"}, "originalPosition": 92}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1973, "cost": 1, "resetAt": "2021-11-01T13:51:04Z"}}}