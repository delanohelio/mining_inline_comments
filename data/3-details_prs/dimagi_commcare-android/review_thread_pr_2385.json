{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTA2Nzg0MzI5", "number": 2385, "reviewThreads": {"totalCount": 5, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yMFQxNDozNDo1MVrOEv0Abg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yMFQxOTowNzoxM1rOEv78jw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzE4NTcwNjA2OnYy", "diffSide": "RIGHT", "path": "app/src/org/commcare/tasks/CleanRawMedia.kt", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yMFQxNDozNDo1MVrOHlAOCg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yMFQxNTo0Njo0NlrOHlEcfA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwODU2Mjk1NA==", "bodyText": "I think we should only be doing this for Forms in a specific state, right? It doesn't seem correct to me for this to delete the raw storage for, say, a form that's currently in progress. I wonder if it's safest to, say, only do this for forms that were saved more than a few days ago, too, but that's probably overly conservative", "url": "https://github.com/dimagi/commcare-android/pull/2385#discussion_r508562954", "createdAt": "2020-10-20T14:34:51Z", "author": {"login": "ctsims"}, "path": "app/src/org/commcare/tasks/CleanRawMedia.kt", "diffHunk": "@@ -0,0 +1,30 @@\n+package org.commcare.tasks\n+\n+import android.content.Context\n+import androidx.work.Worker\n+import androidx.work.WorkerParameters\n+import org.commcare.CommCareApplication\n+import org.commcare.android.database.user.models.FormRecord\n+import org.commcare.utils.CrashUtil\n+import java.io.File\n+import java.lang.Exception\n+\n+class CleanRawMedia(appContext: Context, workerParams: WorkerParameters)\n+    : Worker(appContext, workerParams) {\n+\n+    override fun doWork(): Result {\n+        try {\n+            val storage = CommCareApplication.instance().getUserStorage(FormRecord::class.java)\n+            for (formRecord in storage) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "7c501905c66a24c3ffad1df51d0eda7467f45a2e"}, "originalPosition": 18}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwODYzMjE4OA==", "bodyText": "Yeah thats a good point. Though given on some devices users face storage issues even in normal conditions, I am inclined to remove it for all completely saved forms. I don't see value in retaining the original images for any forms which are not in progress or incomplete.", "url": "https://github.com/dimagi/commcare-android/pull/2385#discussion_r508632188", "createdAt": "2020-10-20T15:46:46Z", "author": {"login": "shubham1g5"}, "path": "app/src/org/commcare/tasks/CleanRawMedia.kt", "diffHunk": "@@ -0,0 +1,30 @@\n+package org.commcare.tasks\n+\n+import android.content.Context\n+import androidx.work.Worker\n+import androidx.work.WorkerParameters\n+import org.commcare.CommCareApplication\n+import org.commcare.android.database.user.models.FormRecord\n+import org.commcare.utils.CrashUtil\n+import java.io.File\n+import java.lang.Exception\n+\n+class CleanRawMedia(appContext: Context, workerParams: WorkerParameters)\n+    : Worker(appContext, workerParams) {\n+\n+    override fun doWork(): Result {\n+        try {\n+            val storage = CommCareApplication.instance().getUserStorage(FormRecord::class.java)\n+            for (formRecord in storage) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwODU2Mjk1NA=="}, "originalCommit": {"oid": "7c501905c66a24c3ffad1df51d0eda7467f45a2e"}, "originalPosition": 18}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzE4NTcxNzQ5OnYy", "diffSide": "RIGHT", "path": "app/src/org/commcare/tasks/CleanRawMedia.kt", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yMFQxNDozNzowMlrOHlAVFA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yMFQxNTo0ODoxNFrOHlEjmA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwODU2NDc1Ng==", "bodyText": "Do we want to fail the loop for one failed record? Given what this task is doing I'd guess we should report each exception (And return failure for the task), but proceed with the next record. Otherwise one bad record will prevent cleaning up the remaining ones", "url": "https://github.com/dimagi/commcare-android/pull/2385#discussion_r508564756", "createdAt": "2020-10-20T14:37:02Z", "author": {"login": "ctsims"}, "path": "app/src/org/commcare/tasks/CleanRawMedia.kt", "diffHunk": "@@ -0,0 +1,30 @@\n+package org.commcare.tasks\n+\n+import android.content.Context\n+import androidx.work.Worker\n+import androidx.work.WorkerParameters\n+import org.commcare.CommCareApplication\n+import org.commcare.android.database.user.models.FormRecord\n+import org.commcare.utils.CrashUtil\n+import java.io.File\n+import java.lang.Exception\n+\n+class CleanRawMedia(appContext: Context, workerParams: WorkerParameters)\n+    : Worker(appContext, workerParams) {\n+\n+    override fun doWork(): Result {\n+        try {\n+            val storage = CommCareApplication.instance().getUserStorage(FormRecord::class.java)\n+            for (formRecord in storage) {\n+                File(formRecord.filePath).parent?.let {\n+                    val rawDirPath = \"$it/raw\"\n+                    File(rawDirPath).deleteRecursively()\n+                }\n+            }\n+        } catch (e: Exception) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "7c501905c66a24c3ffad1df51d0eda7467f45a2e"}, "originalPosition": 24}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwODYzNDAwOA==", "bodyText": "Yeah totally agree. Will add this.", "url": "https://github.com/dimagi/commcare-android/pull/2385#discussion_r508634008", "createdAt": "2020-10-20T15:48:14Z", "author": {"login": "shubham1g5"}, "path": "app/src/org/commcare/tasks/CleanRawMedia.kt", "diffHunk": "@@ -0,0 +1,30 @@\n+package org.commcare.tasks\n+\n+import android.content.Context\n+import androidx.work.Worker\n+import androidx.work.WorkerParameters\n+import org.commcare.CommCareApplication\n+import org.commcare.android.database.user.models.FormRecord\n+import org.commcare.utils.CrashUtil\n+import java.io.File\n+import java.lang.Exception\n+\n+class CleanRawMedia(appContext: Context, workerParams: WorkerParameters)\n+    : Worker(appContext, workerParams) {\n+\n+    override fun doWork(): Result {\n+        try {\n+            val storage = CommCareApplication.instance().getUserStorage(FormRecord::class.java)\n+            for (formRecord in storage) {\n+                File(formRecord.filePath).parent?.let {\n+                    val rawDirPath = \"$it/raw\"\n+                    File(rawDirPath).deleteRecursively()\n+                }\n+            }\n+        } catch (e: Exception) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwODU2NDc1Ng=="}, "originalCommit": {"oid": "7c501905c66a24c3ffad1df51d0eda7467f45a2e"}, "originalPosition": 24}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzE4Njk5OTcwOnYy", "diffSide": "RIGHT", "path": "app/src/org/commcare/tasks/CleanRawMedia.kt", "isResolved": false, "comments": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yMFQxOTowNToxOFrOHlM9yg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yMVQwNjoxOTo1NlrOHlb3hw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwODc3MTc4Ng==", "bodyText": "NIT: Missing endline", "url": "https://github.com/dimagi/commcare-android/pull/2385#discussion_r508771786", "createdAt": "2020-10-20T19:05:18Z", "author": {"login": "ctsims"}, "path": "app/src/org/commcare/tasks/CleanRawMedia.kt", "diffHunk": "@@ -0,0 +1,31 @@\n+package org.commcare.tasks\n+\n+import android.content.Context\n+import androidx.work.Worker\n+import androidx.work.WorkerParameters\n+import org.commcare.CommCareApplication\n+import org.commcare.android.database.user.models.FormRecord\n+import org.commcare.utils.CrashUtil\n+import org.commcare.utils.StorageUtils.getUnsentCompleteOrSavedFormIdsForCurrentApp\n+import java.io.File\n+\n+class CleanRawMedia(appContext: Context, workerParams: WorkerParameters)\n+    : Worker(appContext, workerParams) {\n+\n+    override fun doWork(): Result {\n+        val storage = CommCareApplication.instance().getUserStorage(FormRecord::class.java)\n+        val recordsToRemove = getUnsentCompleteOrSavedFormIdsForCurrentApp(storage)\n+        for (formId in recordsToRemove) {\n+            try {\n+                val filePath = storage.getMetaDataFieldForRecord(formId, FormRecord.META_FILE_PATH)\n+                File(filePath).parent?.let {\n+                    val rawDirPath = \"$it/raw\"\n+                    File(rawDirPath).deleteRecursively()\n+                }\n+            } catch (e: Exception) {\n+                CrashUtil.reportException(e)\n+            }\n+        }\n+        return Result.success()\n+    }\n+}", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "7982372753aaeead13a4e0d10de1658c32d20fdb"}, "originalPosition": 31}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwOTAwNTUyMQ==", "bodyText": "Ahh I am not sure what are you pointing at here ? Is it nicer to give a line break at the end of file ?", "url": "https://github.com/dimagi/commcare-android/pull/2385#discussion_r509005521", "createdAt": "2020-10-21T05:50:58Z", "author": {"login": "shubham1g5"}, "path": "app/src/org/commcare/tasks/CleanRawMedia.kt", "diffHunk": "@@ -0,0 +1,31 @@\n+package org.commcare.tasks\n+\n+import android.content.Context\n+import androidx.work.Worker\n+import androidx.work.WorkerParameters\n+import org.commcare.CommCareApplication\n+import org.commcare.android.database.user.models.FormRecord\n+import org.commcare.utils.CrashUtil\n+import org.commcare.utils.StorageUtils.getUnsentCompleteOrSavedFormIdsForCurrentApp\n+import java.io.File\n+\n+class CleanRawMedia(appContext: Context, workerParams: WorkerParameters)\n+    : Worker(appContext, workerParams) {\n+\n+    override fun doWork(): Result {\n+        val storage = CommCareApplication.instance().getUserStorage(FormRecord::class.java)\n+        val recordsToRemove = getUnsentCompleteOrSavedFormIdsForCurrentApp(storage)\n+        for (formId in recordsToRemove) {\n+            try {\n+                val filePath = storage.getMetaDataFieldForRecord(formId, FormRecord.META_FILE_PATH)\n+                File(filePath).parent?.let {\n+                    val rawDirPath = \"$it/raw\"\n+                    File(rawDirPath).deleteRecursively()\n+                }\n+            } catch (e: Exception) {\n+                CrashUtil.reportException(e)\n+            }\n+        }\n+        return Result.success()\n+    }\n+}", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwODc3MTc4Ng=="}, "originalCommit": {"oid": "7982372753aaeead13a4e0d10de1658c32d20fdb"}, "originalPosition": 31}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwOTAxMzgzOQ==", "bodyText": "Found an explanation here, so sorted on this. Configured my editor to do this in future for all files.", "url": "https://github.com/dimagi/commcare-android/pull/2385#discussion_r509013839", "createdAt": "2020-10-21T06:14:29Z", "author": {"login": "shubham1g5"}, "path": "app/src/org/commcare/tasks/CleanRawMedia.kt", "diffHunk": "@@ -0,0 +1,31 @@\n+package org.commcare.tasks\n+\n+import android.content.Context\n+import androidx.work.Worker\n+import androidx.work.WorkerParameters\n+import org.commcare.CommCareApplication\n+import org.commcare.android.database.user.models.FormRecord\n+import org.commcare.utils.CrashUtil\n+import org.commcare.utils.StorageUtils.getUnsentCompleteOrSavedFormIdsForCurrentApp\n+import java.io.File\n+\n+class CleanRawMedia(appContext: Context, workerParams: WorkerParameters)\n+    : Worker(appContext, workerParams) {\n+\n+    override fun doWork(): Result {\n+        val storage = CommCareApplication.instance().getUserStorage(FormRecord::class.java)\n+        val recordsToRemove = getUnsentCompleteOrSavedFormIdsForCurrentApp(storage)\n+        for (formId in recordsToRemove) {\n+            try {\n+                val filePath = storage.getMetaDataFieldForRecord(formId, FormRecord.META_FILE_PATH)\n+                File(filePath).parent?.let {\n+                    val rawDirPath = \"$it/raw\"\n+                    File(rawDirPath).deleteRecursively()\n+                }\n+            } catch (e: Exception) {\n+                CrashUtil.reportException(e)\n+            }\n+        }\n+        return Result.success()\n+    }\n+}", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwODc3MTc4Ng=="}, "originalCommit": {"oid": "7982372753aaeead13a4e0d10de1658c32d20fdb"}, "originalPosition": 31}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwOTAxNTk0Mw==", "bodyText": "Wow, I didn't know about this. Will configure my editor for the same.", "url": "https://github.com/dimagi/commcare-android/pull/2385#discussion_r509015943", "createdAt": "2020-10-21T06:19:56Z", "author": {"login": "ShivamPokhriyal"}, "path": "app/src/org/commcare/tasks/CleanRawMedia.kt", "diffHunk": "@@ -0,0 +1,31 @@\n+package org.commcare.tasks\n+\n+import android.content.Context\n+import androidx.work.Worker\n+import androidx.work.WorkerParameters\n+import org.commcare.CommCareApplication\n+import org.commcare.android.database.user.models.FormRecord\n+import org.commcare.utils.CrashUtil\n+import org.commcare.utils.StorageUtils.getUnsentCompleteOrSavedFormIdsForCurrentApp\n+import java.io.File\n+\n+class CleanRawMedia(appContext: Context, workerParams: WorkerParameters)\n+    : Worker(appContext, workerParams) {\n+\n+    override fun doWork(): Result {\n+        val storage = CommCareApplication.instance().getUserStorage(FormRecord::class.java)\n+        val recordsToRemove = getUnsentCompleteOrSavedFormIdsForCurrentApp(storage)\n+        for (formId in recordsToRemove) {\n+            try {\n+                val filePath = storage.getMetaDataFieldForRecord(formId, FormRecord.META_FILE_PATH)\n+                File(filePath).parent?.let {\n+                    val rawDirPath = \"$it/raw\"\n+                    File(rawDirPath).deleteRecursively()\n+                }\n+            } catch (e: Exception) {\n+                CrashUtil.reportException(e)\n+            }\n+        }\n+        return Result.success()\n+    }\n+}", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwODc3MTc4Ng=="}, "originalCommit": {"oid": "7982372753aaeead13a4e0d10de1658c32d20fdb"}, "originalPosition": 31}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzE4NzAwMjY3OnYy", "diffSide": "RIGHT", "path": "app/src/org/commcare/tasks/CleanRawMedia.kt", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yMFQxOTowNjowNFrOHlM_mA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yMVQwNTo0ODoyMFrOHlbLdA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwODc3MjI0OA==", "bodyText": "I think we should fail at the bottom of the loop still if one iteration didn't process right? That will let it retry later, although if we are launching at-most-one of these per startup maybe it's not worth worrying about the distinciton.", "url": "https://github.com/dimagi/commcare-android/pull/2385#discussion_r508772248", "createdAt": "2020-10-20T19:06:04Z", "author": {"login": "ctsims"}, "path": "app/src/org/commcare/tasks/CleanRawMedia.kt", "diffHunk": "@@ -0,0 +1,31 @@\n+package org.commcare.tasks\n+\n+import android.content.Context\n+import androidx.work.Worker\n+import androidx.work.WorkerParameters\n+import org.commcare.CommCareApplication\n+import org.commcare.android.database.user.models.FormRecord\n+import org.commcare.utils.CrashUtil\n+import org.commcare.utils.StorageUtils.getUnsentCompleteOrSavedFormIdsForCurrentApp\n+import java.io.File\n+\n+class CleanRawMedia(appContext: Context, workerParams: WorkerParameters)\n+    : Worker(appContext, workerParams) {\n+\n+    override fun doWork(): Result {\n+        val storage = CommCareApplication.instance().getUserStorage(FormRecord::class.java)\n+        val recordsToRemove = getUnsentCompleteOrSavedFormIdsForCurrentApp(storage)\n+        for (formId in recordsToRemove) {\n+            try {\n+                val filePath = storage.getMetaDataFieldForRecord(formId, FormRecord.META_FILE_PATH)\n+                File(filePath).parent?.let {\n+                    val rawDirPath = \"$it/raw\"\n+                    File(rawDirPath).deleteRecursively()\n+                }\n+            } catch (e: Exception) {\n+                CrashUtil.reportException(e)", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "7982372753aaeead13a4e0d10de1658c32d20fdb"}, "originalPosition": 26}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwOTAwNDY2MA==", "bodyText": "We are launching these at-most-once per user login, though still think that it's not worth the distinction here as it's not crticial to keep retrying for a few failed records.", "url": "https://github.com/dimagi/commcare-android/pull/2385#discussion_r509004660", "createdAt": "2020-10-21T05:48:20Z", "author": {"login": "shubham1g5"}, "path": "app/src/org/commcare/tasks/CleanRawMedia.kt", "diffHunk": "@@ -0,0 +1,31 @@\n+package org.commcare.tasks\n+\n+import android.content.Context\n+import androidx.work.Worker\n+import androidx.work.WorkerParameters\n+import org.commcare.CommCareApplication\n+import org.commcare.android.database.user.models.FormRecord\n+import org.commcare.utils.CrashUtil\n+import org.commcare.utils.StorageUtils.getUnsentCompleteOrSavedFormIdsForCurrentApp\n+import java.io.File\n+\n+class CleanRawMedia(appContext: Context, workerParams: WorkerParameters)\n+    : Worker(appContext, workerParams) {\n+\n+    override fun doWork(): Result {\n+        val storage = CommCareApplication.instance().getUserStorage(FormRecord::class.java)\n+        val recordsToRemove = getUnsentCompleteOrSavedFormIdsForCurrentApp(storage)\n+        for (formId in recordsToRemove) {\n+            try {\n+                val filePath = storage.getMetaDataFieldForRecord(formId, FormRecord.META_FILE_PATH)\n+                File(filePath).parent?.let {\n+                    val rawDirPath = \"$it/raw\"\n+                    File(rawDirPath).deleteRecursively()\n+                }\n+            } catch (e: Exception) {\n+                CrashUtil.reportException(e)", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwODc3MjI0OA=="}, "originalCommit": {"oid": "7982372753aaeead13a4e0d10de1658c32d20fdb"}, "originalPosition": 26}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzE4NzAwNjg3OnYy", "diffSide": "RIGHT", "path": "app/src/org/commcare/tasks/CleanRawMedia.kt", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yMFQxOTowNzoxM1rOHlNCKg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yMVQwNTo0OTo0N1rOHlbNTQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwODc3MjkwNg==", "bodyText": "Probably best for us to encode this in a static with the other part of the code, to make sure if a change is made that someone knows it affects this cleanup as well.", "url": "https://github.com/dimagi/commcare-android/pull/2385#discussion_r508772906", "createdAt": "2020-10-20T19:07:13Z", "author": {"login": "ctsims"}, "path": "app/src/org/commcare/tasks/CleanRawMedia.kt", "diffHunk": "@@ -0,0 +1,31 @@\n+package org.commcare.tasks\n+\n+import android.content.Context\n+import androidx.work.Worker\n+import androidx.work.WorkerParameters\n+import org.commcare.CommCareApplication\n+import org.commcare.android.database.user.models.FormRecord\n+import org.commcare.utils.CrashUtil\n+import org.commcare.utils.StorageUtils.getUnsentCompleteOrSavedFormIdsForCurrentApp\n+import java.io.File\n+\n+class CleanRawMedia(appContext: Context, workerParams: WorkerParameters)\n+    : Worker(appContext, workerParams) {\n+\n+    override fun doWork(): Result {\n+        val storage = CommCareApplication.instance().getUserStorage(FormRecord::class.java)\n+        val recordsToRemove = getUnsentCompleteOrSavedFormIdsForCurrentApp(storage)\n+        for (formId in recordsToRemove) {\n+            try {\n+                val filePath = storage.getMetaDataFieldForRecord(formId, FormRecord.META_FILE_PATH)\n+                File(filePath).parent?.let {\n+                    val rawDirPath = \"$it/raw\"", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "7982372753aaeead13a4e0d10de1658c32d20fdb"}, "originalPosition": 22}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwOTAwNTEzMw==", "bodyText": "agree though keeping it unchanged for now to avoid another review cycle and  I will implement the suggestion in the master version of this PR>", "url": "https://github.com/dimagi/commcare-android/pull/2385#discussion_r509005133", "createdAt": "2020-10-21T05:49:47Z", "author": {"login": "shubham1g5"}, "path": "app/src/org/commcare/tasks/CleanRawMedia.kt", "diffHunk": "@@ -0,0 +1,31 @@\n+package org.commcare.tasks\n+\n+import android.content.Context\n+import androidx.work.Worker\n+import androidx.work.WorkerParameters\n+import org.commcare.CommCareApplication\n+import org.commcare.android.database.user.models.FormRecord\n+import org.commcare.utils.CrashUtil\n+import org.commcare.utils.StorageUtils.getUnsentCompleteOrSavedFormIdsForCurrentApp\n+import java.io.File\n+\n+class CleanRawMedia(appContext: Context, workerParams: WorkerParameters)\n+    : Worker(appContext, workerParams) {\n+\n+    override fun doWork(): Result {\n+        val storage = CommCareApplication.instance().getUserStorage(FormRecord::class.java)\n+        val recordsToRemove = getUnsentCompleteOrSavedFormIdsForCurrentApp(storage)\n+        for (formId in recordsToRemove) {\n+            try {\n+                val filePath = storage.getMetaDataFieldForRecord(formId, FormRecord.META_FILE_PATH)\n+                File(filePath).parent?.let {\n+                    val rawDirPath = \"$it/raw\"", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwODc3MjkwNg=="}, "originalCommit": {"oid": "7982372753aaeead13a4e0d10de1658c32d20fdb"}, "originalPosition": 22}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3192, "cost": 1, "resetAt": "2021-11-12T13:16:51Z"}}}