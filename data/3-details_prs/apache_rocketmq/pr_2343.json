{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTAwNjEwNTc3", "number": 2343, "title": "[ISSUE# 2330] Store the properties of MessageBatch", "bodyText": "What is the purpose of the change\nstore the properties of MessageBatch", "createdAt": "2020-10-09T13:59:40Z", "url": "https://github.com/apache/rocketmq/pull/2343", "merged": true, "mergeCommit": {"oid": "3f48c174343223ec0dc5258595c19c8291d5e21d"}, "closed": true, "closedAt": "2020-10-19T00:48:46Z", "author": {"login": "AVP42"}, "timelineItems": {"totalCount": 5, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdQ2lyJAH2gAyNTAwNjEwNTc3OmJiMjY0NjE3ZGFiNTQ1ZWExODA0MjVkOTQ5M2Q1MzdjODU3ZWRhMTM=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdSG9gYgH2gAyNTAwNjEwNTc3OmNlZDcyN2U2M2FiZTNiOGM1MjM3YTdjMGZlM2VjYzNmZGMyZWNjNDc=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "bb264617dab545ea180425d9493d537c857eda13", "author": {"user": null}, "url": "https://github.com/apache/rocketmq/commit/bb264617dab545ea180425d9493d537c857eda13", "committedDate": "2020-10-09T13:56:10Z", "message": "[ISSUE# 2330]store the properties of MessageBatch"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "18e2acc4fda9bfdfc73794cb0518653ff407cc05", "author": {"user": null}, "url": "https://github.com/apache/rocketmq/commit/18e2acc4fda9bfdfc73794cb0518653ff407cc05", "committedDate": "2020-10-09T16:32:39Z", "message": "[ISSUE# 2330]fix style problem"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTA2MTM2NDQ0", "url": "https://github.com/apache/rocketmq/pull/2343#pullrequestreview-506136444", "createdAt": "2020-10-11T01:27:58Z", "commit": {"oid": "18e2acc4fda9bfdfc73794cb0518653ff407cc05"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xMVQwMToyNzo1OFrOHfjpOg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xMVQwMToyNzo1OFrOHfjpOg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMjg1MTg5OA==", "bodyText": "IMO, set properties has been done in this code MessageAccessor.setProperties(messageExtBatch, MessageDecoder.string2messageProperties(requestHeader.getProperties()));, so we don't need add a new variable named propertiesString to MessageExtBatch to do this thing.", "url": "https://github.com/apache/rocketmq/pull/2343#discussion_r502851898", "createdAt": "2020-10-11T01:27:58Z", "author": {"login": "RongtongJin"}, "path": "broker/src/main/java/org/apache/rocketmq/broker/processor/SendMessageProcessor.java", "diffHunk": "@@ -577,6 +577,7 @@ private RemotingCommand handlePutMessageResult(PutMessageResult putMessageResult\n         messageExtBatch.setFlag(requestHeader.getFlag());\n         MessageAccessor.setProperties(messageExtBatch, MessageDecoder.string2messageProperties(requestHeader.getProperties()));\n         messageExtBatch.setBody(request.getBody());\n+        messageExtBatch.setPropertiesString(requestHeader.getProperties());", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "18e2acc4fda9bfdfc73794cb0518653ff407cc05"}, "originalPosition": 4}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTA2MTM2Nzcz", "url": "https://github.com/apache/rocketmq/pull/2343#pullrequestreview-506136773", "createdAt": "2020-10-11T01:38:15Z", "commit": {"oid": "18e2acc4fda9bfdfc73794cb0518653ff407cc05"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xMVQwMTozODoxNlrOHfjsCA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xMVQwMTozODoxNlrOHfjsCA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMjg1MjYxNg==", "bodyText": "Just put properties of MessageExtBatch into msgBatchMemory. The original code takes the properties of a single message, so it does not exist.", "url": "https://github.com/apache/rocketmq/pull/2343#discussion_r502852616", "createdAt": "2020-10-11T01:38:16Z", "author": {"login": "RongtongJin"}, "path": "store/src/main/java/org/apache/rocketmq/store/CommitLog.java", "diffHunk": "@@ -1871,9 +1878,13 @@ public ByteBuffer encode(final MessageExtBatch messageExtBatch) {\n                 this.msgBatchMemory.put((byte) topicLength);\n                 this.msgBatchMemory.put(topicData);\n                 // 17 PROPERTIES\n-                this.msgBatchMemory.putShort(propertiesLen);\n-                if (propertiesLen > 0)\n+                this.msgBatchMemory.putShort((short) (propertiesLen + batchPropLen));\n+                if (propertiesLen > 0) {\n                     this.msgBatchMemory.put(messagesByteBuff.array(), propertiesPos, propertiesLen);\n+                }\n+                if (batchPropLen > 0) {\n+                    this.msgBatchMemory.put(batchPropData, 0, batchPropLen);\n+                }", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "18e2acc4fda9bfdfc73794cb0518653ff407cc05"}, "originalPosition": 35}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ced727e63abe3b8c5237a7c0fe3ecc3fdc2ecc47", "author": {"user": null}, "url": "https://github.com/apache/rocketmq/commit/ced727e63abe3b8c5237a7c0fe3ecc3fdc2ecc47", "committedDate": "2020-10-13T11:34:29Z", "message": "[ISSUE# 2330]Undo newly added property in the MessageBatch"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4890, "cost": 1, "resetAt": "2021-11-01T11:59:11Z"}}}