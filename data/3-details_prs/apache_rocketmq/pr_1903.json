{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0Mzk2NzY5MTMx", "number": 1903, "title": "[ISSUE #1904] Print log when flush timeout", "bodyText": "What is the purpose of the change\nPrint log when flush timeout", "createdAt": "2020-04-01T05:29:21Z", "url": "https://github.com/apache/rocketmq/pull/1903", "merged": true, "mergeCommit": {"oid": "bb9f106e31c01e7b38f0c0f130d211da5a4f31cb"}, "closed": true, "closedAt": "2020-12-04T07:43:29Z", "author": {"login": "rushsky518"}, "timelineItems": {"totalCount": 9, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcTUw8KAH2gAyMzk2NzY5MTMxOjQ4NzExMDhlYzk1ZjBhMTNiYTYyMDRiNTM5ODJkOTJjMmI2ODcxYjc=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdiy0coAFqTU0NDcxODk4NA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "4871108ec95f0a13ba6204b53982d92c2b6871b7", "author": {"user": {"login": "rushsky518", "name": null}}, "url": "https://github.com/apache/rocketmq/commit/4871108ec95f0a13ba6204b53982d92c2b6871b7", "committedDate": "2020-04-01T10:02:12Z", "message": "rollback my code"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "b251e1e2512641a32898366d95dd26c8eb9a1e1c", "author": {"user": {"login": "rushsky518", "name": null}}, "url": "https://github.com/apache/rocketmq/commit/b251e1e2512641a32898366d95dd26c8eb9a1e1c", "committedDate": "2020-04-01T05:25:08Z", "message": "print log when flush timeout"}, "afterCommit": {"oid": "4871108ec95f0a13ba6204b53982d92c2b6871b7", "author": {"user": {"login": "rushsky518", "name": null}}, "url": "https://github.com/apache/rocketmq/commit/4871108ec95f0a13ba6204b53982d92c2b6871b7", "committedDate": "2020-04-01T10:02:12Z", "message": "rollback my code"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzg3MTM1ODYz", "url": "https://github.com/apache/rocketmq/pull/1903#pullrequestreview-387135863", "createdAt": "2020-04-03T10:25:56Z", "commit": {"oid": "4871108ec95f0a13ba6204b53982d92c2b6871b7"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wM1QxMDoyNTo1NlrOGAPn2Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wM1QxMDoyNTo1NlrOGAPn2Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMjkwOTE0NQ==", "bodyText": "If the disk flashing has failed, and continue to log here, it will increase the system load and increase disk IO.\nIMO, as the status will be sent to the client, it is better to remove the error log here.", "url": "https://github.com/apache/rocketmq/pull/1903#discussion_r402909145", "createdAt": "2020-04-03T10:25:56Z", "author": {"login": "ShannonDing"}, "path": "store/src/main/java/org/apache/rocketmq/store/CommitLog.java", "diffHunk": "@@ -761,15 +767,20 @@ public long getBeginTimeInLock() {\n         storeStatsService.getSinglePutMessageTopicTimesTotal(messageExtBatch.getTopic()).addAndGet(result.getMsgNum());\n         storeStatsService.getSinglePutMessageTopicSizeTotal(messageExtBatch.getTopic()).addAndGet(result.getWroteBytes());\n \n-        CompletableFuture<PutMessageStatus> flushOKFuture = submitFlushRequest(result, putMessageResult, messageExtBatch);\n-        CompletableFuture<PutMessageStatus> replicaOKFuture = submitReplicaRequest(result, putMessageResult, messageExtBatch);\n+        CompletableFuture<PutMessageStatus> flushOKFuture = submitFlushRequest(result, messageExtBatch);\n+        CompletableFuture<PutMessageStatus> replicaOKFuture = submitReplicaRequest(result, messageExtBatch);\n         return flushOKFuture.thenCombine(replicaOKFuture, (flushStatus, replicaStatus) -> {\n             if (flushStatus != PutMessageStatus.PUT_OK) {\n-                putMessageResult.setPutMessageStatus(PutMessageStatus.FLUSH_DISK_TIMEOUT);\n+                putMessageResult.setPutMessageStatus(flushStatus);\n+                log.error(\"do groupcommit, wait for flush failed, topic: {} tags: {} client address: {}\",", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "4871108ec95f0a13ba6204b53982d92c2b6871b7"}, "originalPosition": 36}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b3c1ba7dcbaa4f40f0e26f1834df5f118c65e3f1", "author": {"user": {"login": "rushsky518", "name": null}}, "url": "https://github.com/apache/rocketmq/commit/b3c1ba7dcbaa4f40f0e26f1834df5f118c65e3f1", "committedDate": "2020-04-03T14:58:44Z", "message": "avoid log when disk flush"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "80ebef3120d9c66d916a0fbbdf665be7b7d1033e", "author": {"user": {"login": "rushsky518", "name": null}}, "url": "https://github.com/apache/rocketmq/commit/80ebef3120d9c66d916a0fbbdf665be7b7d1033e", "committedDate": "2020-04-04T02:27:33Z", "message": "when msg is in next file, flushOK value may be wrong"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzkyNjIzMTY0", "url": "https://github.com/apache/rocketmq/pull/1903#pullrequestreview-392623164", "createdAt": "2020-04-14T05:59:17Z", "commit": {"oid": "80ebef3120d9c66d916a0fbbdf665be7b7d1033e"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzkyNjI0NzQ2", "url": "https://github.com/apache/rocketmq/pull/1903#pullrequestreview-392624746", "createdAt": "2020-04-14T06:03:25Z", "commit": {"oid": "80ebef3120d9c66d916a0fbbdf665be7b7d1033e"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDE4Nzk4NTA0", "url": "https://github.com/apache/rocketmq/pull/1903#pullrequestreview-418798504", "createdAt": "2020-05-27T01:31:58Z", "commit": {"oid": "80ebef3120d9c66d916a0fbbdf665be7b7d1033e"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTQ0NzE4OTg0", "url": "https://github.com/apache/rocketmq/pull/1903#pullrequestreview-544718984", "createdAt": "2020-12-04T07:43:12Z", "commit": {"oid": "80ebef3120d9c66d916a0fbbdf665be7b7d1033e"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4997, "cost": 1, "resetAt": "2021-11-01T11:59:11Z"}}}