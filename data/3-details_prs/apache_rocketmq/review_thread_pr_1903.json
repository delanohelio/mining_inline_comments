{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0Mzk2NzY5MTMx", "number": 1903, "reviewThreads": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wM1QxMDoyNTo1NlrODuUZgQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wM1QxMDoyNTo1NlrODuUZgQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjQ5ODk1Mjk3OnYy", "diffSide": "RIGHT", "path": "store/src/main/java/org/apache/rocketmq/store/CommitLog.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wM1QxMDoyNTo1NlrOGAPn2Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wM1QxNTowOTo0NVrOGAZs4Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMjkwOTE0NQ==", "bodyText": "If the disk flashing has failed, and continue to log here, it will increase the system load and increase disk IO.\nIMO, as the status will be sent to the client, it is better to remove the error log here.", "url": "https://github.com/apache/rocketmq/pull/1903#discussion_r402909145", "createdAt": "2020-04-03T10:25:56Z", "author": {"login": "ShannonDing"}, "path": "store/src/main/java/org/apache/rocketmq/store/CommitLog.java", "diffHunk": "@@ -761,15 +767,20 @@ public long getBeginTimeInLock() {\n         storeStatsService.getSinglePutMessageTopicTimesTotal(messageExtBatch.getTopic()).addAndGet(result.getMsgNum());\n         storeStatsService.getSinglePutMessageTopicSizeTotal(messageExtBatch.getTopic()).addAndGet(result.getWroteBytes());\n \n-        CompletableFuture<PutMessageStatus> flushOKFuture = submitFlushRequest(result, putMessageResult, messageExtBatch);\n-        CompletableFuture<PutMessageStatus> replicaOKFuture = submitReplicaRequest(result, putMessageResult, messageExtBatch);\n+        CompletableFuture<PutMessageStatus> flushOKFuture = submitFlushRequest(result, messageExtBatch);\n+        CompletableFuture<PutMessageStatus> replicaOKFuture = submitReplicaRequest(result, messageExtBatch);\n         return flushOKFuture.thenCombine(replicaOKFuture, (flushStatus, replicaStatus) -> {\n             if (flushStatus != PutMessageStatus.PUT_OK) {\n-                putMessageResult.setPutMessageStatus(PutMessageStatus.FLUSH_DISK_TIMEOUT);\n+                putMessageResult.setPutMessageStatus(flushStatus);\n+                log.error(\"do groupcommit, wait for flush failed, topic: {} tags: {} client address: {}\",", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "4871108ec95f0a13ba6204b53982d92c2b6871b7"}, "originalPosition": 36}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMzA3NDI3Mw==", "bodyText": "Indeed so.\nI still have a question about [#1894 pr]\nreq.wakeupCustomer(flushOK ? PutMessageStatus.PUT_OK : PutMessageStatus.FLUSH_DISK_TIMEOUT);\nflushOK is false means FLUSH_DISK_TIMEOUT?", "url": "https://github.com/apache/rocketmq/pull/1903#discussion_r403074273", "createdAt": "2020-04-03T15:09:45Z", "author": {"login": "rushsky518"}, "path": "store/src/main/java/org/apache/rocketmq/store/CommitLog.java", "diffHunk": "@@ -761,15 +767,20 @@ public long getBeginTimeInLock() {\n         storeStatsService.getSinglePutMessageTopicTimesTotal(messageExtBatch.getTopic()).addAndGet(result.getMsgNum());\n         storeStatsService.getSinglePutMessageTopicSizeTotal(messageExtBatch.getTopic()).addAndGet(result.getWroteBytes());\n \n-        CompletableFuture<PutMessageStatus> flushOKFuture = submitFlushRequest(result, putMessageResult, messageExtBatch);\n-        CompletableFuture<PutMessageStatus> replicaOKFuture = submitReplicaRequest(result, putMessageResult, messageExtBatch);\n+        CompletableFuture<PutMessageStatus> flushOKFuture = submitFlushRequest(result, messageExtBatch);\n+        CompletableFuture<PutMessageStatus> replicaOKFuture = submitReplicaRequest(result, messageExtBatch);\n         return flushOKFuture.thenCombine(replicaOKFuture, (flushStatus, replicaStatus) -> {\n             if (flushStatus != PutMessageStatus.PUT_OK) {\n-                putMessageResult.setPutMessageStatus(PutMessageStatus.FLUSH_DISK_TIMEOUT);\n+                putMessageResult.setPutMessageStatus(flushStatus);\n+                log.error(\"do groupcommit, wait for flush failed, topic: {} tags: {} client address: {}\",", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMjkwOTE0NQ=="}, "originalCommit": {"oid": "4871108ec95f0a13ba6204b53982d92c2b6871b7"}, "originalPosition": 36}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1686, "cost": 1, "resetAt": "2021-11-11T21:28:48Z"}}}