{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDk1ODk2MjY4", "number": 2335, "title": "[ISSUE #2334] Polish the log and response remark when service not available", "bodyText": "What is the purpose of the change\nPolish the log and response remark when service not available\nBrief changelog\nXX\nVerifying this change\nXXXX\nFollow this checklist to help us incorporate your contribution quickly and easily. Notice, it would be helpful if you could finish the following 5 checklist(the last one is not necessary)before request the community to review your PR.\n\n Make sure there is a Github issue filed for the change (usually before you start working on it). Trivial changes like typos do not require a Github issue. Your pull request should address just this issue, without pulling in other changes - one PR resolves one issue.\n Format the pull request title like [ISSUE #123] Fix UnknownException when host config not exist. Each commit in the pull request should have a meaningful subject line and body.\n Write a pull request description that is detailed enough to understand what the pull request does, how, and why.\n Write necessary unit-test(over 80% coverage) to verify your logic correction, more mock a little better when cross module dependency exist. If the new feature or significant change is committed, please remember to add integration-test in test module.\n Run mvn -B clean apache-rat:check findbugs:findbugs checkstyle:checkstyle to make sure basic checks pass. Run mvn clean install -DskipITs to make sure unit-test pass. Run mvn clean test-compile failsafe:integration-test  to make sure integration-test pass.\n If this contribution is large, please file an Apache Individual Contributor License Agreement.", "createdAt": "2020-10-01T01:55:00Z", "url": "https://github.com/apache/rocketmq/pull/2335", "merged": true, "mergeCommit": {"oid": "c932941f30803257579b118571a735a3d464a8a0"}, "closed": true, "closedAt": "2020-10-12T00:58:22Z", "author": {"login": "RongtongJin"}, "timelineItems": {"totalCount": 5, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdOHY0QgH2gAyNDk1ODk2MjY4OjJiMWZmNTUzZGMyYmMzMzQyODQ5OWJmZjczMTFiNWZjOTFkZWJhYzQ=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdRpQQsgFqTUwNjIzODM1OA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "2b1ff553dc2bc33428499bff7311b5fc91debac4", "author": {"user": {"login": "RongtongJin", "name": "rongtong"}}, "url": "https://github.com/apache/rocketmq/commit/2b1ff553dc2bc33428499bff7311b5fc91debac4", "committedDate": "2020-10-01T01:48:37Z", "message": "enhancement(response & log):polish the log and response remark when service not available"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTA1NjEzODk5", "url": "https://github.com/apache/rocketmq/pull/2335#pullrequestreview-505613899", "createdAt": "2020-10-09T12:11:11Z", "commit": {"oid": "2b1ff553dc2bc33428499bff7311b5fc91debac4"}, "state": "COMMENTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wOVQxMjoxMToxMVrOHfHD0g==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wOVQxMjoxMjozNFrOHfHGaA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMjM4MzU3MA==", "bodyText": "Too many uncertain reasons can drive people crazy. You are advised to change them to \u201cyou could check...\u201d if not any diagnosis could be provided furtherly.", "url": "https://github.com/apache/rocketmq/pull/2335#discussion_r502383570", "createdAt": "2020-10-09T12:11:11Z", "author": {"login": "vongosling"}, "path": "broker/src/main/java/org/apache/rocketmq/broker/processor/ReplyMessageProcessor.java", "diffHunk": "@@ -263,7 +263,7 @@ private void handlePutMessageResult(PutMessageResult putMessageResult,\n                 break;\n             case SERVICE_NOT_AVAILABLE:\n                 log.info(\n-                    \"service not available now, maybe disk full, maybe your broker machine memory too small.\");\n+                    \"service not available now, maybe disk full, maybe put messages to slave, maybe message store shutdown, etc.\");", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "2b1ff553dc2bc33428499bff7311b5fc91debac4"}, "originalPosition": 5}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMjM4NDIzMg==", "bodyText": "IMO, maybe is not a strict customer advice.", "url": "https://github.com/apache/rocketmq/pull/2335#discussion_r502384232", "createdAt": "2020-10-09T12:12:34Z", "author": {"login": "vongosling"}, "path": "store/src/main/java/org/apache/rocketmq/store/DefaultMessageStore.java", "diffHunk": "@@ -392,15 +392,15 @@ private PutMessageStatus checkStoreStatus() {\n         if (BrokerRole.SLAVE == this.messageStoreConfig.getBrokerRole()) {\n             long value = this.printTimes.getAndIncrement();\n             if ((value % 50000) == 0) {\n-                log.warn(\"message store has shutdown, so putMessage is forbidden\");\n+                log.warn(\"broke role is slave, so putMessage is forbidden\");\n             }\n             return PutMessageStatus.SERVICE_NOT_AVAILABLE;\n         }\n \n         if (!this.runningFlags.isWriteable()) {\n             long value = this.printTimes.getAndIncrement();\n             if ((value % 50000) == 0) {\n-                log.warn(\"message store has shutdown, so putMessage is forbidden\");\n+                log.warn(\"message store could not write (may be disk full) so putMessage is forbidden\");", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "2b1ff553dc2bc33428499bff7311b5fc91debac4"}, "originalPosition": 14}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "671edc05a0b267e77253facefabd7b511a4864b4", "author": {"user": {"login": "RongtongJin", "name": "rongtong"}}, "url": "https://github.com/apache/rocketmq/commit/671edc05a0b267e77253facefabd7b511a4864b4", "committedDate": "2020-10-10T14:47:14Z", "message": "enhancement(response remark & log): make log and response remark better understand"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a07764fb785375ce970eaac8389be7b0f329d2f0", "author": {"user": {"login": "RongtongJin", "name": "rongtong"}}, "url": "https://github.com/apache/rocketmq/commit/a07764fb785375ce970eaac8389be7b0f329d2f0", "committedDate": "2020-10-10T14:52:09Z", "message": "chore(style): modify code style to pass CI tests"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTA2MjM4MzU4", "url": "https://github.com/apache/rocketmq/pull/2335#pullrequestreview-506238358", "createdAt": "2020-10-12T00:56:23Z", "commit": {"oid": "a07764fb785375ce970eaac8389be7b0f329d2f0"}, "state": "APPROVED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xMlQwMDo1NjoyM1rOHfsKkQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xMlQwMDo1NjoyM1rOHfsKkQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMjk5MTUwNQ==", "bodyText": "Good catch", "url": "https://github.com/apache/rocketmq/pull/2335#discussion_r502991505", "createdAt": "2020-10-12T00:56:23Z", "author": {"login": "vongosling"}, "path": "broker/src/main/java/org/apache/rocketmq/broker/processor/ReplyMessageProcessor.java", "diffHunk": "@@ -251,28 +251,29 @@ private void handlePutMessageResult(PutMessageResult putMessageResult,\n \n             // Failed\n             case CREATE_MAPEDFILE_FAILED:\n-                log.info(\"create mapped file failed, server is busy or broken.\");\n+                log.warn(\"create mapped file failed, server is busy or broken.\");", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "a07764fb785375ce970eaac8389be7b0f329d2f0"}, "originalPosition": 5}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4887, "cost": 1, "resetAt": "2021-11-01T11:59:11Z"}}}