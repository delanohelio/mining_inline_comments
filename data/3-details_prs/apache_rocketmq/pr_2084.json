{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDMyMjU5MDg0", "number": 2084, "title": "[ISSUE#2085]support graceful shutdown push consumer", "bodyText": "What is the purpose of the change\nIssue :  #2085\nFor now, RocketMQ does not support a graceful shutdown for push consumer, which means that when a user shutdown a push consumer, the threadpool will shutdown but rocketmq client will not wait for the existing task to be completed, which may cause\n\nError is found when shutdown. Since the application since application may shutdown some external source like datasource when application shutdowns, so the existing task may fail.\nMessage duplication. Even though the task can be completed, since rocketmq will update consumer offset after the shutdown method returns, so the latest consumer offset should be updated after the remaining tasks are completed\n\nBrief changelog\nAdd a parameter awaitTerminationMillisWhenShutdown(default is 0), to determine how long should the rocketmq client to await for the consumer threadpool to terminate before update consumer offset", "createdAt": "2020-06-10T07:30:24Z", "url": "https://github.com/apache/rocketmq/pull/2084", "merged": true, "mergeCommit": {"oid": "00b914d3570683bc05748e549ff6d48324e52879"}, "closed": true, "closedAt": "2020-06-12T12:45:42Z", "author": {"login": "Jaskey"}, "timelineItems": {"totalCount": 6, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcp0aPRAH2gAyNDMyMjU5MDg0OmM3N2UxMjMxMDZiOThmYTc5ODYwNmRiMzQ4NWUxZGQyYzYyZjBjZmU=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcqc6mZgFqTQyOTQ5MjYyNQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "c77e123106b98fa798606db3485e1dd2c62f0cfe", "author": {"user": {"login": "Jaskey", "name": "Jaskey"}}, "url": "https://github.com/apache/rocketmq/commit/c77e123106b98fa798606db3485e1dd2c62f0cfe", "committedDate": "2020-06-10T07:20:42Z", "message": "support graceful shutdown push consumer"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDI3ODMxMjQ5", "url": "https://github.com/apache/rocketmq/pull/2084#pullrequestreview-427831249", "createdAt": "2020-06-10T08:32:46Z", "commit": {"oid": "c77e123106b98fa798606db3485e1dd2c62f0cfe"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDI3ODMyOTEy", "url": "https://github.com/apache/rocketmq/pull/2084#pullrequestreview-427832912", "createdAt": "2020-06-10T08:34:54Z", "commit": {"oid": "c77e123106b98fa798606db3485e1dd2c62f0cfe"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xMFQwODozNDo1NFrOGhqrIg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xMFQwODozNDo1NFrOGhqrIg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNzk1NTM2Mg==", "bodyText": "It would be better to keep this method forward compatible.", "url": "https://github.com/apache/rocketmq/pull/2084#discussion_r437955362", "createdAt": "2020-06-10T08:34:54Z", "author": {"login": "duhenglucky"}, "path": "client/src/main/java/org/apache/rocketmq/client/impl/consumer/ConsumeMessageConcurrentlyService.java", "diffHunk": "@@ -92,9 +93,9 @@ public void run() {\n         }, this.defaultMQPushConsumer.getConsumeTimeout(), this.defaultMQPushConsumer.getConsumeTimeout(), TimeUnit.MINUTES);\n     }\n \n-    public void shutdown() {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c77e123106b98fa798606db3485e1dd2c62f0cfe"}, "originalPosition": 12}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "d09624529a4556e3c19f81932b56c91ac7a16f62", "author": {"user": {"login": "Jaskey", "name": "Jaskey"}}, "url": "https://github.com/apache/rocketmq/commit/d09624529a4556e3c19f81932b56c91ac7a16f62", "committedDate": "2020-06-10T08:38:54Z", "message": "remains the old shutdown method of DefaultMQPushConsumerImpl"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "38f983ec27d9913e79b014a974b5f8acd8472944", "author": {"user": {"login": "Jaskey", "name": "Jaskey"}}, "url": "https://github.com/apache/rocketmq/commit/38f983ec27d9913e79b014a974b5f8acd8472944", "committedDate": "2020-06-10T09:23:28Z", "message": "add unit test for graceful shutdown"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDI5NDkyNjI1", "url": "https://github.com/apache/rocketmq/pull/2084#pullrequestreview-429492625", "createdAt": "2020-06-12T06:32:15Z", "commit": {"oid": "38f983ec27d9913e79b014a974b5f8acd8472944"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4937, "cost": 1, "resetAt": "2021-11-01T11:59:11Z"}}}