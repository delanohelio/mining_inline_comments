{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDAwMzIzNjg3", "number": 983, "reviewThreads": {"totalCount": 9, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wN1QyMTo0MjoyOFrODvwKgA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wOFQwMjowNDoyOFrODvzjlw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjUxMzk4Nzg0OnYy", "diffSide": "RIGHT", "path": "docs/en/siem/rules-api-create.asciidoc", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wN1QyMTo0MjoyOFrOGCXOiQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wOFQwMTozNzoxNlrOGCb_Uw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNTEzMDg4OQ==", "bodyText": "Nice! Thanks for providing a reference to the ML API here \ud83d\ude42", "url": "https://github.com/elastic/stack-docs/pull/983#discussion_r405130889", "createdAt": "2020-04-07T21:42:28Z", "author": {"login": "spong"}, "path": "docs/en/siem/rules-api-create.asciidoc", "diffHunk": "@@ -3,6 +3,43 @@\n \n Creates a new signal detection rule.\n \n+You can create two types of rules:\n+\n+* Query-based rules, which search the defined indices and creates a signal when\n+a document matches the rule's query.\n+* {ml-cap} rules, which create a signal when a {ml} job discovers an anomaly above the defined threshold (see <<machine-learning>>).\n+\n+IMPORTANT: You can only create {ml} jobs when you have a\n+https://www.elastic.co/subscriptions[Platinum License], are using a\n+{ess-trial}[Cloud] deployment, or are testing out a *Free Trial*. Additionally,\n+for the {ml} rule to function, the associated {ml} job must be running.\n+\n+To retrieve {ml} job IDs, which are required to create {ml} jobs, call the\n+{ref}/ml-get-job.html[{es} Get jobs API].", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ac700565fa5bcb219ec04efb23a70f44099881b5"}, "originalPosition": 16}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNTIwODkxNQ==", "bodyText": "We may want a caveat here about the \"siem\" group/tag. Although there's nothing currently preventing API users from creating rules against non-siem jobs, once we tighten our ML integration and implement our auto-installation/starting of jobs we'll want to ensure that we're only doing so for jobs in the siem group.", "url": "https://github.com/elastic/stack-docs/pull/983#discussion_r405208915", "createdAt": "2020-04-08T01:37:16Z", "author": {"login": "rylnd"}, "path": "docs/en/siem/rules-api-create.asciidoc", "diffHunk": "@@ -3,6 +3,43 @@\n \n Creates a new signal detection rule.\n \n+You can create two types of rules:\n+\n+* Query-based rules, which search the defined indices and creates a signal when\n+a document matches the rule's query.\n+* {ml-cap} rules, which create a signal when a {ml} job discovers an anomaly above the defined threshold (see <<machine-learning>>).\n+\n+IMPORTANT: You can only create {ml} jobs when you have a\n+https://www.elastic.co/subscriptions[Platinum License], are using a\n+{ess-trial}[Cloud] deployment, or are testing out a *Free Trial*. Additionally,\n+for the {ml} rule to function, the associated {ml} job must be running.\n+\n+To retrieve {ml} job IDs, which are required to create {ml} jobs, call the\n+{ref}/ml-get-job.html[{es} Get jobs API].", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNTEzMDg4OQ=="}, "originalCommit": {"oid": "ac700565fa5bcb219ec04efb23a70f44099881b5"}, "originalPosition": 16}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjUxNDEwNTAyOnYy", "diffSide": "RIGHT", "path": "docs/en/siem/rules-api-create.asciidoc", "isResolved": false, "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wN1QyMjoyNTo1NVrOGCYXGw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wOFQwNTo0MDoxM1rOGCfrwg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNTE0OTQ2Nw==", "bodyText": "Not sure if it makes sense to capture this here, but just want to mention that certain fields are forbidden depending on the rule type. For instance, for type: \"machine_learning\", noth query and language fields are forbidden. It may be a little hard to read, but explicit details are in the create_rules_schema if necessary.", "url": "https://github.com/elastic/stack-docs/pull/983#discussion_r405149467", "createdAt": "2020-04-07T22:25:55Z", "author": {"login": "spong"}, "path": "docs/en/siem/rules-api-create.asciidoc", "diffHunk": "@@ -41,19 +84,21 @@ time).\n is converted from a third-party security solution. |No, automatically created \n when it is not provided.\n \n-|index |String[] |Indices on which the rule functions. |No, defaults to the \n-{siem-soln} indices defined on the {kib} Advanced Settings page (*Kibana* \u2192 \n-*Management* \u2192 *Advanced Settings* \u2192 `siem:defaultIndex`).\n+|index |String[] |Indices on which the rule functions. |No, for query rules,\n+defaults to the {siem-soln} indices defined on the {kib} Advanced Settings page\n+(*Kibana* \u2192 *Management* \u2192 *Advanced Settings* \u2192 `siem:defaultIndex`).\n \n |interval |String |Frequency of rule execution, using a\n {ref}/common-options.html#date-math[date math range]. For example, `\"1h\"` \n means the rule runs every hour. |No, defaults to `5m` (5 minutes).\n \n+|machine_learning_job_id |String |{ml} job ID of the job for which you want to generate signals. |Yes, for {ml} rules.\n+\n |query |String |{kibana-ref}/search.html[Query] used by the rule to create a \n-signal. |No, defaults to an empty string.\n+signal. |No, for query rules, defaults to an empty string.", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ac700565fa5bcb219ec04efb23a70f44099881b5"}, "originalPosition": 76}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNTIxMDc2OA==", "bodyText": "These are somewhat discoverable through the 400 responses we'll generate (you can google the Joi message if you're not familiar), but saving the user a step here would probably be appreciated \ud83d\udc4d", "url": "https://github.com/elastic/stack-docs/pull/983#discussion_r405210768", "createdAt": "2020-04-08T01:44:45Z", "author": {"login": "rylnd"}, "path": "docs/en/siem/rules-api-create.asciidoc", "diffHunk": "@@ -41,19 +84,21 @@ time).\n is converted from a third-party security solution. |No, automatically created \n when it is not provided.\n \n-|index |String[] |Indices on which the rule functions. |No, defaults to the \n-{siem-soln} indices defined on the {kib} Advanced Settings page (*Kibana* \u2192 \n-*Management* \u2192 *Advanced Settings* \u2192 `siem:defaultIndex`).\n+|index |String[] |Indices on which the rule functions. |No, for query rules,\n+defaults to the {siem-soln} indices defined on the {kib} Advanced Settings page\n+(*Kibana* \u2192 *Management* \u2192 *Advanced Settings* \u2192 `siem:defaultIndex`).\n \n |interval |String |Frequency of rule execution, using a\n {ref}/common-options.html#date-math[date math range]. For example, `\"1h\"` \n means the rule runs every hour. |No, defaults to `5m` (5 minutes).\n \n+|machine_learning_job_id |String |{ml} job ID of the job for which you want to generate signals. |Yes, for {ml} rules.\n+\n |query |String |{kibana-ref}/search.html[Query] used by the rule to create a \n-signal. |No, defaults to an empty string.\n+signal. |No, for query rules, defaults to an empty string.", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNTE0OTQ2Nw=="}, "originalCommit": {"oid": "ac700565fa5bcb219ec04efb23a70f44099881b5"}, "originalPosition": 76}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNTI2OTQ0Mg==", "bodyText": "Thanks @spong and @rylnd\nYep - definitely needs correcting", "url": "https://github.com/elastic/stack-docs/pull/983#discussion_r405269442", "createdAt": "2020-04-08T05:40:13Z", "author": {"login": "benskelker"}, "path": "docs/en/siem/rules-api-create.asciidoc", "diffHunk": "@@ -41,19 +84,21 @@ time).\n is converted from a third-party security solution. |No, automatically created \n when it is not provided.\n \n-|index |String[] |Indices on which the rule functions. |No, defaults to the \n-{siem-soln} indices defined on the {kib} Advanced Settings page (*Kibana* \u2192 \n-*Management* \u2192 *Advanced Settings* \u2192 `siem:defaultIndex`).\n+|index |String[] |Indices on which the rule functions. |No, for query rules,\n+defaults to the {siem-soln} indices defined on the {kib} Advanced Settings page\n+(*Kibana* \u2192 *Management* \u2192 *Advanced Settings* \u2192 `siem:defaultIndex`).\n \n |interval |String |Frequency of rule execution, using a\n {ref}/common-options.html#date-math[date math range]. For example, `\"1h\"` \n means the rule runs every hour. |No, defaults to `5m` (5 minutes).\n \n+|machine_learning_job_id |String |{ml} job ID of the job for which you want to generate signals. |Yes, for {ml} rules.\n+\n |query |String |{kibana-ref}/search.html[Query] used by the rule to create a \n-signal. |No, defaults to an empty string.\n+signal. |No, for query rules, defaults to an empty string.", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNTE0OTQ2Nw=="}, "originalCommit": {"oid": "ac700565fa5bcb219ec04efb23a70f44099881b5"}, "originalPosition": 76}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjUxNDQ5MDA4OnYy", "diffSide": "RIGHT", "path": "docs/en/siem/rules-api-create.asciidoc", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wOFQwMTozMjo0OFrOGCb6xw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wOFQwNTo0MjoyOFrOGCfuQg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNTIwNzc1MQ==", "bodyText": "function is a bit ambiguous here (which I realize may be intentional!), so I'll over-explain the behavior:\nIf the associated job is not running, the rule will (barring any other exceptions):\n\ncomplete (i.e. it will perform a query for anomalies, and exit)\npotentially generate signals (if anomalies were found above)\nhave an error (indicating that the job was not running during execution)", "url": "https://github.com/elastic/stack-docs/pull/983#discussion_r405207751", "createdAt": "2020-04-08T01:32:48Z", "author": {"login": "rylnd"}, "path": "docs/en/siem/rules-api-create.asciidoc", "diffHunk": "@@ -3,6 +3,43 @@\n \n Creates a new signal detection rule.\n \n+You can create two types of rules:\n+\n+* Query-based rules, which search the defined indices and creates a signal when\n+a document matches the rule's query.\n+* {ml-cap} rules, which create a signal when a {ml} job discovers an anomaly above the defined threshold (see <<machine-learning>>).\n+\n+IMPORTANT: You can only create {ml} jobs when you have a\n+https://www.elastic.co/subscriptions[Platinum License], are using a\n+{ess-trial}[Cloud] deployment, or are testing out a *Free Trial*. Additionally,\n+for the {ml} rule to function, the associated {ml} job must be running.", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ac700565fa5bcb219ec04efb23a70f44099881b5"}, "originalPosition": 13}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNTI3MDA4Mg==", "bodyText": "I will add this info - but to the ui/overview section. Here, I'll just change it to function correctly.\nThanks", "url": "https://github.com/elastic/stack-docs/pull/983#discussion_r405270082", "createdAt": "2020-04-08T05:42:28Z", "author": {"login": "benskelker"}, "path": "docs/en/siem/rules-api-create.asciidoc", "diffHunk": "@@ -3,6 +3,43 @@\n \n Creates a new signal detection rule.\n \n+You can create two types of rules:\n+\n+* Query-based rules, which search the defined indices and creates a signal when\n+a document matches the rule's query.\n+* {ml-cap} rules, which create a signal when a {ml} job discovers an anomaly above the defined threshold (see <<machine-learning>>).\n+\n+IMPORTANT: You can only create {ml} jobs when you have a\n+https://www.elastic.co/subscriptions[Platinum License], are using a\n+{ess-trial}[Cloud] deployment, or are testing out a *Free Trial*. Additionally,\n+for the {ml} rule to function, the associated {ml} job must be running.", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNTIwNzc1MQ=="}, "originalCommit": {"oid": "ac700565fa5bcb219ec04efb23a70f44099881b5"}, "originalPosition": 13}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjUxNDUwMzEzOnYy", "diffSide": "RIGHT", "path": "docs/en/siem/rules-api-create.asciidoc", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wOFQwMTo0MDoyNlrOGCcCYw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wOFQwMTo0MDoyNlrOGCcCYw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNTIwOTY5OQ==", "bodyText": "article/noun disagreement here", "url": "https://github.com/elastic/stack-docs/pull/983#discussion_r405209699", "createdAt": "2020-04-08T01:40:26Z", "author": {"login": "rylnd"}, "path": "docs/en/siem/rules-api-create.asciidoc", "diffHunk": "@@ -3,6 +3,43 @@\n \n Creates a new signal detection rule.\n \n+You can create two types of rules:\n+\n+* Query-based rules, which search the defined indices and creates a signal when\n+a document matches the rule's query.\n+* {ml-cap} rules, which create a signal when a {ml} job discovers an anomaly above the defined threshold (see <<machine-learning>>).\n+\n+IMPORTANT: You can only create {ml} jobs when you have a\n+https://www.elastic.co/subscriptions[Platinum License], are using a\n+{ess-trial}[Cloud] deployment, or are testing out a *Free Trial*. Additionally,\n+for the {ml} rule to function, the associated {ml} job must be running.\n+\n+To retrieve {ml} job IDs, which are required to create {ml} jobs, call the\n+{ref}/ml-get-job.html[{es} Get jobs API].\n+\n+Additionally, you can set up notification when a rule creates a signal. The", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ac700565fa5bcb219ec04efb23a70f44099881b5"}, "originalPosition": 18}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjUxNDUwNTY3OnYy", "diffSide": "RIGHT", "path": "docs/en/siem/rules-api-create.asciidoc", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wOFQwMTo0MjowOFrOGCcD4w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wOFQwMTo0MjowOFrOGCcD4w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNTIxMDA4Mw==", "bodyText": "Integer between 0 and 100 inclusive, if that matters.", "url": "https://github.com/elastic/stack-docs/pull/983#discussion_r405210083", "createdAt": "2020-04-08T01:42:08Z", "author": {"login": "rylnd"}, "path": "docs/en/siem/rules-api-create.asciidoc", "diffHunk": "@@ -15,6 +52,12 @@ A JSON object with these fields:\n |==============================================\n |Name |Type |Description |Required\n \n+|actions |<<actions-object-schema, actions[]>> |Array defining the automated\n+actions (notifications) taken signals are produced. |No\n+\n+|anomaly_threshold |Integer |Anomaly threshold above which signals are", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ac700565fa5bcb219ec04efb23a70f44099881b5"}, "originalPosition": 51}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjUxNDUxMzcwOnYy", "diffSide": "RIGHT", "path": "docs/en/siem/rules-api-create.asciidoc", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wOFQwMTo0Njo0OVrOGCcItA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wOFQwNTo0Njo0MVrOGCfzNg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNTIxMTMxNg==", "bodyText": "My own curiosity: why do some of these fields have |String | and others have |String a| ? Why do they appear identical in the preview?", "url": "https://github.com/elastic/stack-docs/pull/983#discussion_r405211316", "createdAt": "2020-04-08T01:46:49Z", "author": {"login": "rylnd"}, "path": "docs/en/siem/rules-api-create.asciidoc", "diffHunk": "@@ -94,14 +141,25 @@ occurred\n |tags |String[] |String array containing words and phrases to help categorize,\n filter, and search rules. |No, defaults to an empty array.\n \n+|throttle |String a|Determines how often actions are taken:", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ac700565fa5bcb219ec04efb23a70f44099881b5"}, "originalPosition": 97}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNTI3MTM1MA==", "bodyText": "Sure. adding a before the | separator tells asciidoc that the cell contains markup characters. Without the a, all text is rendered literally.", "url": "https://github.com/elastic/stack-docs/pull/983#discussion_r405271350", "createdAt": "2020-04-08T05:46:41Z", "author": {"login": "benskelker"}, "path": "docs/en/siem/rules-api-create.asciidoc", "diffHunk": "@@ -94,14 +141,25 @@ occurred\n |tags |String[] |String array containing words and phrases to help categorize,\n filter, and search rules. |No, defaults to an empty array.\n \n+|throttle |String a|Determines how often actions are taken:", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNTIxMTMxNg=="}, "originalCommit": {"oid": "ac700565fa5bcb219ec04efb23a70f44099881b5"}, "originalPosition": 97}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjUxNDUxNjM3OnYy", "diffSide": "RIGHT", "path": "docs/en/siem/rules-api-create.asciidoc", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wOFQwMTo0ODoyMlrOGCcKZQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wOFQwMTo0ODoyMlrOGCcKZQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNTIxMTc0OQ==", "bodyText": "\ud83d\udc4f great example!", "url": "https://github.com/elastic/stack-docs/pull/983#discussion_r405211749", "createdAt": "2020-04-08T01:48:22Z", "author": {"login": "rylnd"}, "path": "docs/en/siem/rules-api-create.asciidoc", "diffHunk": "@@ -196,26 +340,88 @@ POST api/detection_engine/rules\n If the rule starts to run at 15:00, it analyzes data from 13:50 until 15:00. \n When it runs next, at 16:00, it will analyze data from 14:50 until 16:00.\n \n+{ml-cap} rule that creates signals, and sends Slack notification, when the", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ac700565fa5bcb219ec04efb23a70f44099881b5"}, "originalPosition": 237}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjUxNDUxOTIwOnYy", "diffSide": "RIGHT", "path": "docs/en/siem/rules-api-create.asciidoc", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wOFQwMTo0OTo1NVrOGCcMEw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wOFQwMTo1Mzo0NVrOGCcQAQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNTIxMjE3OQ==", "bodyText": "@FrankHassanabad what's the status of output index? Are we still supporting this in 7.7?", "url": "https://github.com/elastic/stack-docs/pull/983#discussion_r405212179", "createdAt": "2020-04-08T01:49:55Z", "author": {"login": "rylnd"}, "path": "docs/en/siem/rules-api-create.asciidoc", "diffHunk": "@@ -196,26 +340,88 @@ POST api/detection_engine/rules\n If the rule starts to run at 15:00, it analyzes data from 13:50 until 15:00. \n When it runs next, at 16:00, it will analyze data from 14:50 until 16:00.\n \n+{ml-cap} rule that creates signals, and sends Slack notification, when the\n+`linux_anomalous_network_activity_ecs` {ml} job discovers anomalies with a\n+threshold of 70 or above:\n+\n+[source,console]\n+--------------------------------------------------\n+POST api/detection_engine/rules\n+{\n+  \"anomaly_threshold\": 70,\n+  \"rule_id\": \"ml_linux_network_high_threshold\",\n+  \"risk_score\": 70,\n+  \"machine_learning_job_id\": \"linux_anomalous_network_activity_ecs\",\n+  \"description\": \"Generates signals when the job discovers anomalies over 70\",\n+  \"interval\": \"5m\",\n+  \"name\": \"Anomalous Linux network activity\",\n+  \"note\": \"Shut down the internet.\",\n+  \"severity\": \"high\",\n+  \"tags\": [\n+   \"machine learning\",\n+   \"Linux\"\n+   ],\n+  \"type\": \"machine_learning\",\n+  \"from\": \"now-6m\",\n+  \"enabled\": true,\n+  \"throttle\": \"rule\",\n+  \"actions\": [\n+    {\n+      \"action_type_id\": \".slack\",\n+      \"group\": \"default\",\n+      \"id\": \"5ad22cd5-5e6e-4c6c-a81a-54b626a4cec5\",\n+      \"params\": {\n+        \"message\": \"Urgent: {{context.rule.description}}\"\n+      }\n+    }\n+  ]\n+}\n+--------------------------------------------------\n+// KIBANA\n+\n ==== Response code\n \n `200`:: \n     Indicates a successful call.\n     \n ==== Response payload\n \n-A JSON object that includes a unique ID, the time the rule was created, and its version number. If the request payload did not include a `rule_id` field, a unique rule ID is also generated.\n+A JSON object that includes a unique ID, the time the rule was created, and its\n+version number. If the request payload did not include a `rule_id` field, a\n+unique rule ID is also generated.\n \n-Example response:\n+Example response for a query-based rule:\n \n [source,json]\n --------------------------------------------------\n {\n-  \"created_at\": \"2020-01-05T09:56:11.805Z\",\n-  \"updated_at\": \"2020-01-05T09:56:11.805Z\",\n-  \"created_by\": \"elastic\",\n+  \"created_at\": \"2020-04-07T14:51:09.755Z\",\n+  \"updated_at\": \"2020-04-07T14:51:09.970Z\",\n+  \"created_by\": \"LiverpoolFC\",\n   \"description\": \"Process started by MS Office program - possible payload\",\n   \"enabled\": false,\n   \"false_positives\": [],\n+  \"from\": \"now-70m\",\n+  \"id\": \"6541b99a-dee9-4f6d-a86d-dbd1869d73b1\",\n+  \"immutable\": false,\n+  \"interval\": \"1h\",\n+  \"rule_id\": \"process_started_by_ms_office_program\",\n+  \"output_index\": \".siem-signals-default\",", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ac700565fa5bcb219ec04efb23a70f44099881b5"}, "originalPosition": 308}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNTIxMzE4NQ==", "bodyText": "Oh right, I created the issue \ud83e\udd26\u200d\u2642 : elastic/kibana#59103. We want to drop support for this but I think it's staying for 7.7.", "url": "https://github.com/elastic/stack-docs/pull/983#discussion_r405213185", "createdAt": "2020-04-08T01:53:45Z", "author": {"login": "rylnd"}, "path": "docs/en/siem/rules-api-create.asciidoc", "diffHunk": "@@ -196,26 +340,88 @@ POST api/detection_engine/rules\n If the rule starts to run at 15:00, it analyzes data from 13:50 until 15:00. \n When it runs next, at 16:00, it will analyze data from 14:50 until 16:00.\n \n+{ml-cap} rule that creates signals, and sends Slack notification, when the\n+`linux_anomalous_network_activity_ecs` {ml} job discovers anomalies with a\n+threshold of 70 or above:\n+\n+[source,console]\n+--------------------------------------------------\n+POST api/detection_engine/rules\n+{\n+  \"anomaly_threshold\": 70,\n+  \"rule_id\": \"ml_linux_network_high_threshold\",\n+  \"risk_score\": 70,\n+  \"machine_learning_job_id\": \"linux_anomalous_network_activity_ecs\",\n+  \"description\": \"Generates signals when the job discovers anomalies over 70\",\n+  \"interval\": \"5m\",\n+  \"name\": \"Anomalous Linux network activity\",\n+  \"note\": \"Shut down the internet.\",\n+  \"severity\": \"high\",\n+  \"tags\": [\n+   \"machine learning\",\n+   \"Linux\"\n+   ],\n+  \"type\": \"machine_learning\",\n+  \"from\": \"now-6m\",\n+  \"enabled\": true,\n+  \"throttle\": \"rule\",\n+  \"actions\": [\n+    {\n+      \"action_type_id\": \".slack\",\n+      \"group\": \"default\",\n+      \"id\": \"5ad22cd5-5e6e-4c6c-a81a-54b626a4cec5\",\n+      \"params\": {\n+        \"message\": \"Urgent: {{context.rule.description}}\"\n+      }\n+    }\n+  ]\n+}\n+--------------------------------------------------\n+// KIBANA\n+\n ==== Response code\n \n `200`:: \n     Indicates a successful call.\n     \n ==== Response payload\n \n-A JSON object that includes a unique ID, the time the rule was created, and its version number. If the request payload did not include a `rule_id` field, a unique rule ID is also generated.\n+A JSON object that includes a unique ID, the time the rule was created, and its\n+version number. If the request payload did not include a `rule_id` field, a\n+unique rule ID is also generated.\n \n-Example response:\n+Example response for a query-based rule:\n \n [source,json]\n --------------------------------------------------\n {\n-  \"created_at\": \"2020-01-05T09:56:11.805Z\",\n-  \"updated_at\": \"2020-01-05T09:56:11.805Z\",\n-  \"created_by\": \"elastic\",\n+  \"created_at\": \"2020-04-07T14:51:09.755Z\",\n+  \"updated_at\": \"2020-04-07T14:51:09.970Z\",\n+  \"created_by\": \"LiverpoolFC\",\n   \"description\": \"Process started by MS Office program - possible payload\",\n   \"enabled\": false,\n   \"false_positives\": [],\n+  \"from\": \"now-70m\",\n+  \"id\": \"6541b99a-dee9-4f6d-a86d-dbd1869d73b1\",\n+  \"immutable\": false,\n+  \"interval\": \"1h\",\n+  \"rule_id\": \"process_started_by_ms_office_program\",\n+  \"output_index\": \".siem-signals-default\",", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNTIxMjE3OQ=="}, "originalCommit": {"oid": "ac700565fa5bcb219ec04efb23a70f44099881b5"}, "originalPosition": 308}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjUxNDU0MzU5OnYy", "diffSide": "RIGHT", "path": "docs/en/siem/rules-api-create.asciidoc", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wOFQwMjowNDoyOFrOGCcbYA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wOFQwNTo0ODoyMFrOGCf1VQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNTIxNjA5Ng==", "bodyText": "Super nitpick: should this be \"...generated by  {ml} rules\"?\nIn my mind, signals are generated by rules, from data (anomalies, events, signals), for ... users? Now I'm getting semantic satiation for prepositions...", "url": "https://github.com/elastic/stack-docs/pull/983#discussion_r405216096", "createdAt": "2020-04-08T02:04:28Z", "author": {"login": "rylnd"}, "path": "docs/en/siem/rules-api-create.asciidoc", "diffHunk": "@@ -15,6 +52,12 @@ A JSON object with these fields:\n |==============================================\n |Name |Type |Description |Required\n \n+|actions |<<actions-object-schema, actions[]>> |Array defining the automated\n+actions (notifications) taken signals are produced. |No\n+\n+|anomaly_threshold |Integer |Anomaly threshold above which signals are\n+generated for {ml} rules |Yes, for {ml} rules.", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ac700565fa5bcb219ec04efb23a70f44099881b5"}, "originalPosition": 52}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNTI3MTg5Mw==", "bodyText": "you are 100% correct - should be by", "url": "https://github.com/elastic/stack-docs/pull/983#discussion_r405271893", "createdAt": "2020-04-08T05:48:20Z", "author": {"login": "benskelker"}, "path": "docs/en/siem/rules-api-create.asciidoc", "diffHunk": "@@ -15,6 +52,12 @@ A JSON object with these fields:\n |==============================================\n |Name |Type |Description |Required\n \n+|actions |<<actions-object-schema, actions[]>> |Array defining the automated\n+actions (notifications) taken signals are produced. |No\n+\n+|anomaly_threshold |Integer |Anomaly threshold above which signals are\n+generated for {ml} rules |Yes, for {ml} rules.", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNTIxNjA5Ng=="}, "originalCommit": {"oid": "ac700565fa5bcb219ec04efb23a70f44099881b5"}, "originalPosition": 52}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1171, "cost": 1, "resetAt": "2021-11-12T13:16:51Z"}}}