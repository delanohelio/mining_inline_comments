{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0Mzk3NjQ1NjM5", "number": 974, "title": "[Docs][SIEM] 7.7 detection rule updates", "bodyText": "Updates the docs with added detections functionality.\nPreview", "createdAt": "2020-04-02T15:19:11Z", "url": "https://github.com/elastic/stack-docs/pull/974", "merged": true, "mergeCommit": {"oid": "c913faee5990d62870851d50f2712db16e0af39e"}, "closed": true, "closedAt": "2020-04-08T09:36:44Z", "author": {"login": "benskelker"}, "timelineItems": {"totalCount": 19, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcUkF66gH2gAyMzk3NjQ1NjM5OmRmZWE0MDY5MmM1MGIzZDg0YzdlYjAyNzdmZTEzYTgyZTFhZjQyMmQ=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcVj_TngH2gAyMzk3NjQ1NjM5OmEyNWNmNTg3YjY5YmE3Y2EyNjkzYjY1NzYyNTVjMDAwZDk0MDJjNTY=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "dfea40692c50b3d84c7eb0277fe13a82e1af422d", "author": {"user": {"login": "benskelker", "name": "Ben Skelker"}}, "url": "https://github.com/elastic/stack-docs/commit/dfea40692c50b3d84c7eb0277fe13a82e1af422d", "committedDate": "2020-04-05T06:27:37Z", "message": "starts rule updates"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "635df5104214397ccbb21a0d14c03a049de038f1", "author": {"user": {"login": "benskelker", "name": "Ben Skelker"}}, "url": "https://github.com/elastic/stack-docs/commit/635df5104214397ccbb21a0d14c03a049de038f1", "committedDate": "2020-04-02T15:17:23Z", "message": "starts rule updates"}, "afterCommit": {"oid": "dfea40692c50b3d84c7eb0277fe13a82e1af422d", "author": {"user": {"login": "benskelker", "name": "Ben Skelker"}}, "url": "https://github.com/elastic/stack-docs/commit/dfea40692c50b3d84c7eb0277fe13a82e1af422d", "committedDate": "2020-04-05T06:27:37Z", "message": "starts rule updates"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "7836b4bb92892989693f639ec36a6fb5dd9fe7cf", "author": {"user": {"login": "benskelker", "name": "Ben Skelker"}}, "url": "https://github.com/elastic/stack-docs/commit/7836b4bb92892989693f639ec36a6fb5dd9fe7cf", "committedDate": "2020-04-05T11:48:58Z", "message": "starts ml rule type"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "7efdd68b7797db4f9bc17e60544a0ddae9e44232", "author": {"user": {"login": "benskelker", "name": "Ben Skelker"}}, "url": "https://github.com/elastic/stack-docs/commit/7efdd68b7797db4f9bc17e60544a0ddae9e44232", "committedDate": "2020-04-05T15:00:27Z", "message": "more create rules stuff"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c86f4831115ecf36dc009e50c646ed379ce5b867", "author": {"user": {"login": "benskelker", "name": "Ben Skelker"}}, "url": "https://github.com/elastic/stack-docs/commit/c86f4831115ecf36dc009e50c646ed379ce5b867", "committedDate": "2020-04-05T16:42:08Z", "message": "rule types cont"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "18f617607fe287c0df4a60af165b161bf7dcaf4b", "author": {"user": {"login": "benskelker", "name": "Ben Skelker"}}, "url": "https://github.com/elastic/stack-docs/commit/18f617607fe287c0df4a60af165b161bf7dcaf4b", "committedDate": "2020-04-05T16:54:16Z", "message": "add cases kib space info"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "0b38b8010bbf44bc0c8e99d3a32d44db5ae46244", "author": {"user": {"login": "benskelker", "name": "Ben Skelker"}}, "url": "https://github.com/elastic/stack-docs/commit/0b38b8010bbf44bc0c8e99d3a32d44db5ae46244", "committedDate": "2020-04-06T06:26:47Z", "message": "rule monitoring"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "99419d15ca40d572108922e01b12029b2f3fda7d", "author": {"user": {"login": "benskelker", "name": "Ben Skelker"}}, "url": "https://github.com/elastic/stack-docs/commit/99419d15ca40d572108922e01b12029b2f3fda7d", "committedDate": "2020-04-06T06:28:26Z", "message": "monitor cont"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "499ef64241aed96d43489ad2290d42a2f2244f9a", "author": {"user": {"login": "benskelker", "name": "Ben Skelker"}}, "url": "https://github.com/elastic/stack-docs/commit/499ef64241aed96d43489ad2290d42a2f2244f9a", "committedDate": "2020-04-06T09:05:11Z", "message": "typo"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzg4NTIwODEz", "url": "https://github.com/elastic/stack-docs/pull/974#pullrequestreview-388520813", "createdAt": "2020-04-06T18:42:58Z", "commit": {"oid": "499ef64241aed96d43489ad2290d42a2f2244f9a"}, "state": "APPROVED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wNlQxODo0Mjo1OVrOGBlFWQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wNlQxODo1MTo1OFrOGBlZqw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNDMwOTMzNw==", "bodyText": "I'm sure you're aware, but with #62396 this is changing to ML job settings and will only be visible on the Detections page.", "url": "https://github.com/elastic/stack-docs/pull/974#discussion_r404309337", "createdAt": "2020-04-06T18:42:59Z", "author": {"login": "rylnd"}, "path": "docs/en/siem/machine-learning.asciidoc", "diffHunk": "@@ -20,9 +20,9 @@ image::ml-ui.png[]\n [float]\n [[manage-jobs]]\n === Manage machine learning jobs\n-For users with the `ml_admin` role, the `Anomaly Detection` interface within\n-the main navigation header can be used for for viewing, starting, and stopping\n-SIEM machine learning jobs.\n+For users with the `machine_learning_admin` role, the `Anomaly Detection`", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "499ef64241aed96d43489ad2290d42a2f2244f9a"}, "originalPosition": 16}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNDMxNDUzOQ==", "bodyText": "This isn't new, but I think that the same feedback as this comment applies, where the verb \"tag\" is potentially misleading.", "url": "https://github.com/elastic/stack-docs/pull/974#discussion_r404314539", "createdAt": "2020-04-06T18:51:58Z", "author": {"login": "rylnd"}, "path": "docs/en/siem/machine-learning.asciidoc", "diffHunk": "@@ -20,9 +20,9 @@ image::ml-ui.png[]\n [float]\n [[manage-jobs]]\n === Manage machine learning jobs\n-For users with the `ml_admin` role, the `Anomaly Detection` interface within\n-the main navigation header can be used for for viewing, starting, and stopping\n-SIEM machine learning jobs.\n+For users with the `machine_learning_admin` role, the `Anomaly Detection`\n+interface within the main navigation header can be used for for viewing,\n+starting, and stopping SIEM machine learning jobs.\n \n TIP: To add a custom job to the `Anomaly Detection` interface, add a `SIEM` tag ", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "499ef64241aed96d43489ad2290d42a2f2244f9a"}, "originalPosition": 20}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzg4NTQ4OTYy", "url": "https://github.com/elastic/stack-docs/pull/974#pullrequestreview-388548962", "createdAt": "2020-04-06T19:23:34Z", "commit": {"oid": "499ef64241aed96d43489ad2290d42a2f2244f9a"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wNlQxOToyMzozNVrOGBmfWg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wNlQxOToyMzozNVrOGBmfWg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNDMzMjM3OA==", "bodyText": "I think you want base to be based here.\n\n  \n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            * To create a rule base on a KQL or Lucene query, select _Custom query_ and\n          \n          \n            \n            * To create a rule based on a KQL or Lucene query, select _Custom query_ and", "url": "https://github.com/elastic/stack-docs/pull/974#discussion_r404332378", "createdAt": "2020-04-06T19:23:35Z", "author": {"login": "dhurley14"}, "path": "docs/en/siem/rules-ui-create.asciidoc", "diffHunk": "@@ -70,25 +71,41 @@ ones.\n [[create-rule-ui]]\n === Create a new rule\n \n+You can create two types of rules:\n+\n+* *Custom query*: Query-based rule, which searches the defined indices and creates a signal when a document matches the rule's query.\n+* *Machine learning*: {ml-cap} rule, which creates a signal when a {ml} job discovers an anomaly above the defined threshold (see <<machine-learning>>).\n+\n+IMPORTANT: You can only create {ml} jobs when you have a\n+https://www.elastic.co/subscriptions[Platinum License] or you are using a\n+{ess-trial}[Cloud] deployment.\n+\n . Go to *SIEM* -> *Detections* -> *Manage signal detection rules*.\n . Click *Create new rule*.\n +\n The *Create new rule* page is displayed.\n [role=\"screenshot\"]\n-image::create-new-rule.png[]\n-. Define which {es} indices the rule analyzes for signals.\n-. Use the filter and query fields to create the criteria used for detecting \n+image::images/create-new-rule.png[]\n+. Do *one* of the following:\n+* To create a rule based on a {ml} anomaly threshold, select _Machine Learning_\n+and then:\n+.. The required {ml} job.\n+.. The anomaly score threshold above which signals are created.\n+* To create a rule base on a KQL or Lucene query, select _Custom query_ and", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "499ef64241aed96d43489ad2290d42a2f2244f9a"}, "originalPosition": 48}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzg4NTU2NTEw", "url": "https://github.com/elastic/stack-docs/pull/974#pullrequestreview-388556510", "createdAt": "2020-04-06T19:34:53Z", "commit": {"oid": "499ef64241aed96d43489ad2290d42a2f2244f9a"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "050444ef66430e4fef9f3b662b3c72720cec1707", "author": {"user": {"login": "benskelker", "name": "Ben Skelker"}}, "url": "https://github.com/elastic/stack-docs/commit/050444ef66430e4fef9f3b662b3c72720cec1707", "committedDate": "2020-04-07T08:50:08Z", "message": "corrections and screenshots"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c26c2c3836bed55ad590e5865bc3801f696aa23a", "author": {"user": {"login": "benskelker", "name": "Ben Skelker"}}, "url": "https://github.com/elastic/stack-docs/commit/c26c2c3836bed55ad590e5865bc3801f696aa23a", "committedDate": "2020-04-07T09:10:04Z", "message": "more screenshots"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c6c8a5c67aa6c662e2c2f200afb46be87dd37c57", "author": {"user": {"login": "benskelker", "name": "Ben Skelker"}}, "url": "https://github.com/elastic/stack-docs/commit/c6c8a5c67aa6c662e2c2f200afb46be87dd37c57", "committedDate": "2020-04-07T09:35:00Z", "message": "updates rule failure note"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzg5NDk5MjEy", "url": "https://github.com/elastic/stack-docs/pull/974#pullrequestreview-389499212", "createdAt": "2020-04-07T21:20:43Z", "commit": {"oid": "c6c8a5c67aa6c662e2c2f200afb46be87dd37c57"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wN1QyMToyMDo0M1rOGCWk7A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wN1QyMToyMDo0M1rOGCWk7A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNTEyMDIzNg==", "bodyText": "Thanks for the distinction here as we've (myself at least \ud83d\ude05) been conflating the users/roles -- ml_admin is the user, with the roles being machine_learning_admin, machine_learning_user, etc.", "url": "https://github.com/elastic/stack-docs/pull/974#discussion_r405120236", "createdAt": "2020-04-07T21:20:43Z", "author": {"login": "spong"}, "path": "docs/en/siem/machine-learning.asciidoc", "diffHunk": "@@ -20,12 +20,12 @@ image::ml-ui.png[]\n [float]\n [[manage-jobs]]\n === Manage machine learning jobs\n-For users with the `ml_admin` role, the `Anomaly Detection` interface within\n-the main navigation header can be used for for viewing, starting, and stopping\n-SIEM machine learning jobs.\n+For users with the `machine_learning_admin` role, the `ML job settings`", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c6c8a5c67aa6c662e2c2f200afb46be87dd37c57"}, "originalPosition": 24}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzg5NTAyNzY2", "url": "https://github.com/elastic/stack-docs/pull/974#pullrequestreview-389502766", "createdAt": "2020-04-07T21:26:28Z", "commit": {"oid": "c6c8a5c67aa6c662e2c2f200afb46be87dd37c57"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wN1QyMToyNjoyOFrOGCWwmw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wN1QyMToyNjoyOFrOGCWwmw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNTEyMzIyNw==", "bodyText": "Docs render fine of course, but extra space here:\n\n  \n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            . Select the timeline template used when you  send a signal created by the rule\n          \n          \n            \n            . Select the timeline template used when you send a signal created by the rule", "url": "https://github.com/elastic/stack-docs/pull/974#discussion_r405123227", "createdAt": "2020-04-07T21:26:28Z", "author": {"login": "spong"}, "path": "docs/en/siem/rules-ui-create.asciidoc", "diffHunk": "@@ -99,11 +116,17 @@ image::rule-query-example.png[]\n TIP: This example is based on the\n <<volume-shadow-copy-deletion-via-vssadmin, Volume Shadow Copy Deletion via VssAdmin>> prebuilt rule.\n \n+. Select the timeline template used when you  send a signal created by the rule", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c6c8a5c67aa6c662e2c2f200afb46be87dd37c57"}, "originalPosition": 92}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzg5NTA3NDg1", "url": "https://github.com/elastic/stack-docs/pull/974#pullrequestreview-389507485", "createdAt": "2020-04-07T21:34:51Z", "commit": {"oid": "c6c8a5c67aa6c662e2c2f200afb46be87dd37c57"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a25cf587b69ba7ca2693b6576255c000d9402c56", "author": {"user": {"login": "benskelker", "name": "Ben Skelker"}}, "url": "https://github.com/elastic/stack-docs/commit/a25cf587b69ba7ca2693b6576255c000d9402c56", "committedDate": "2020-04-08T08:54:19Z", "message": "cleanup and remove api key requirement"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4789, "cost": 1, "resetAt": "2021-11-01T14:20:25Z"}}}