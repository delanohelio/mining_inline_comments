{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDI3MjMyMTE3", "number": 3768, "reviewThreads": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wNFQwOTo0MToyMFrOECe--A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wNVQwMjoyNzoyNVrOECzAiQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjcxMDQwMjQ4OnYy", "diffSide": "RIGHT", "path": "fe/src/main/java/org/apache/doris/catalog/AggregateType.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wNFQwOTo0MToyMFrOGe980Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wNFQwOTo1ODo0NVrOGe-lUA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNTEyNTQ1Nw==", "bodyText": "Why remove the primitiveTypeList.clear();.\nNow, the BITMAP_UNION is compatible with both BITMAP and HLL?", "url": "https://github.com/apache/incubator-doris/pull/3768#discussion_r435125457", "createdAt": "2020-06-04T09:41:20Z", "author": {"login": "morningman"}, "path": "fe/src/main/java/org/apache/doris/catalog/AggregateType.java", "diffHunk": "@@ -85,20 +85,22 @@\n         compatibilityMap.put(MAX, EnumSet.copyOf(primitiveTypeList));\n \n         primitiveTypeList.clear();\n-        compatibilityMap.put(REPLACE, EnumSet.allOf(PrimitiveType.class));\n+        // all types except bitmap and hll.\n+        EnumSet<PrimitiveType> exc_bitmap_hll = EnumSet.allOf(PrimitiveType.class);\n+        exc_bitmap_hll.remove(PrimitiveType.BITMAP);\n+        exc_bitmap_hll.remove(PrimitiveType.HLL);\n+        compatibilityMap.put(REPLACE, EnumSet.copyOf(exc_bitmap_hll));\n+\n+        compatibilityMap.put(REPLACE_IF_NOT_NULL, EnumSet.copyOf(exc_bitmap_hll));\n \n-        primitiveTypeList.clear();\n-        compatibilityMap.put(REPLACE_IF_NOT_NULL, EnumSet.allOf(PrimitiveType.class));\n-       \n-        primitiveTypeList.clear();\n         primitiveTypeList.add(PrimitiveType.HLL);\n         compatibilityMap.put(HLL_UNION, EnumSet.copyOf(primitiveTypeList));\n \n-        primitiveTypeList.clear();\n+\n         primitiveTypeList.add(PrimitiveType.BITMAP);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "2035bce6696d8770b98ff8921ae8e78c4ae40cc5"}, "originalPosition": 22}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNTEzNTgyNA==", "bodyText": "By mistake.\nThanks for reminding.", "url": "https://github.com/apache/incubator-doris/pull/3768#discussion_r435135824", "createdAt": "2020-06-04T09:58:45Z", "author": {"login": "spaces-X"}, "path": "fe/src/main/java/org/apache/doris/catalog/AggregateType.java", "diffHunk": "@@ -85,20 +85,22 @@\n         compatibilityMap.put(MAX, EnumSet.copyOf(primitiveTypeList));\n \n         primitiveTypeList.clear();\n-        compatibilityMap.put(REPLACE, EnumSet.allOf(PrimitiveType.class));\n+        // all types except bitmap and hll.\n+        EnumSet<PrimitiveType> exc_bitmap_hll = EnumSet.allOf(PrimitiveType.class);\n+        exc_bitmap_hll.remove(PrimitiveType.BITMAP);\n+        exc_bitmap_hll.remove(PrimitiveType.HLL);\n+        compatibilityMap.put(REPLACE, EnumSet.copyOf(exc_bitmap_hll));\n+\n+        compatibilityMap.put(REPLACE_IF_NOT_NULL, EnumSet.copyOf(exc_bitmap_hll));\n \n-        primitiveTypeList.clear();\n-        compatibilityMap.put(REPLACE_IF_NOT_NULL, EnumSet.allOf(PrimitiveType.class));\n-       \n-        primitiveTypeList.clear();\n         primitiveTypeList.add(PrimitiveType.HLL);\n         compatibilityMap.put(HLL_UNION, EnumSet.copyOf(primitiveTypeList));\n \n-        primitiveTypeList.clear();\n+\n         primitiveTypeList.add(PrimitiveType.BITMAP);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNTEyNTQ1Nw=="}, "originalCommit": {"oid": "2035bce6696d8770b98ff8921ae8e78c4ae40cc5"}, "originalPosition": 22}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjcxMzY4MzA1OnYy", "diffSide": "RIGHT", "path": "fe/src/main/java/org/apache/doris/analysis/ColumnDef.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wNVQwMjoyNzoxNlrOGfeW9A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wNVQwMjoyNzoxNlrOGfeW9A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNTY1NjQzNg==", "bodyText": "Should keep code style with original code.\n\n  \n    \n  \n    \n\n  \n  This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters. Learn more about bidirectional Unicode characters\n\n\n  \n\n\n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                    if ( type.isBitmapType() || type.isHllType() ){\n          \n          \n            \n                    if (type.isBitmapType() || type.isHllType()) {", "url": "https://github.com/apache/incubator-doris/pull/3768#discussion_r435656436", "createdAt": "2020-06-05T02:27:16Z", "author": {"login": "imay"}, "path": "fe/src/main/java/org/apache/doris/analysis/ColumnDef.java", "diffHunk": "@@ -131,6 +131,16 @@ public void analyze(boolean isOlap) throws AnalysisException {\n \n         Type type = typeDef.getType();\n \n+        // disable Bitmap Hll type in keys, values without aggregate function.\n+        if ( type.isBitmapType() || type.isHllType() ){", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "8f172e92481890a99176d726a786ab27c78ccec3"}, "originalPosition": 5}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjcxMzY4MzI5OnYy", "diffSide": "RIGHT", "path": "fe/src/main/java/org/apache/doris/analysis/ColumnDef.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wNVQwMjoyNzoyNVrOGfeXGA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wNVQwMjoyNzoyNVrOGfeXGA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNTY1NjQ3Mg==", "bodyText": "This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters. Learn more about bidirectional Unicode characters\n\n\n  \n\n\n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                        if (isKey){\n          \n          \n            \n                        if (isKey) {", "url": "https://github.com/apache/incubator-doris/pull/3768#discussion_r435656472", "createdAt": "2020-06-05T02:27:25Z", "author": {"login": "imay"}, "path": "fe/src/main/java/org/apache/doris/analysis/ColumnDef.java", "diffHunk": "@@ -131,6 +131,16 @@ public void analyze(boolean isOlap) throws AnalysisException {\n \n         Type type = typeDef.getType();\n \n+        // disable Bitmap Hll type in keys, values without aggregate function.\n+        if ( type.isBitmapType() || type.isHllType() ){\n+            if (isKey){", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "8f172e92481890a99176d726a786ab27c78ccec3"}, "originalPosition": 6}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1456, "cost": 1, "resetAt": "2021-11-12T09:44:50Z"}}}