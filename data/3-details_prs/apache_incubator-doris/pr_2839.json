{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0MzcxMzkzMzYz", "number": 2839, "title": "[Compaction] Avoid unnecessary compaction", "bodyText": "It is not necessary to perform compaction in the following cases\n\n\nA tablet has only 2 rowsets, the versions are [0-1] and [2-x]. In this case,\nthere is no need to perform base compaction because the [0-1] version is an empty version.\nSome tables will be partitioned by day, and then each partition will only load one batch of data\neach day, so a large number of tablets with rowsets [0-1][2-2] will appear. And these tablets\ndo not need to be base compaction.\n\n\nThe initial value of the last successful execution time of compaction is 0,\nwhich causes the first time to determine the time interval from the\nlast successful execution time of compaction, which always meets the\nconditions to trigger cumulative compaction.\n\n\nISSUE: #2838", "createdAt": "2020-02-05T14:09:24Z", "url": "https://github.com/apache/incubator-doris/pull/2839", "merged": true, "mergeCommit": {"oid": "f77cfcdb617c7ec470bad848e2e999f8e6fbcb8d"}, "closed": true, "closedAt": "2020-02-06T08:40:39Z", "author": {"login": "morningman"}, "timelineItems": {"totalCount": 5, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcBWsWzAH2gAyMzcxMzkzMzYzOmI0MTA5MzNmNmU0NGRjZWNiMTVlNTcwMDgxMTYwMmNhNzcxMmNjNGE=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcBl8_rgFqTM1NDI1MjY0Nw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "b410933f6e44dcecb15e5700811602ca7712cc4a", "author": {"user": {"login": "morningman", "name": "Mingyu Chen"}}, "url": "https://github.com/apache/incubator-doris/commit/b410933f6e44dcecb15e5700811602ca7712cc4a", "committedDate": "2020-02-05T14:06:22Z", "message": "avoid compaction"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzUzODM4MzIy", "url": "https://github.com/apache/incubator-doris/pull/2839#pullrequestreview-353838322", "createdAt": "2020-02-05T16:04:49Z", "commit": {"oid": "b410933f6e44dcecb15e5700811602ca7712cc4a"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0wNVQxNjowNDo0OVrOFl9hVQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0wNVQxNjowNDo0OVrOFl9hVQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NTM0OTU4OQ==", "bodyText": "We have checked input_rowsets.size  firstly, so _input_rowsets.size() at least should be 2 and the base_size should larger than zero.\n   if (_input_rowsets.size() <= 1) {\n        return OLAP_ERR_BE_NO_SUITABLE_VERSION;\n    }", "url": "https://github.com/apache/incubator-doris/pull/2839#discussion_r375349589", "createdAt": "2020-02-05T16:04:49Z", "author": {"login": "kangkaisen"}, "path": "be/src/olap/base_compaction.cpp", "diffHunk": "@@ -87,6 +93,11 @@ OLAPStatus BaseCompaction::pick_rowsets_to_compact() {\n     }\n \n     double base_cumulative_delta_ratio = config::base_cumulative_delta_ratio;\n+    if (base_size == 0) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b410933f6e44dcecb15e5700811602ca7712cc4a"}, "originalPosition": 17}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzU0MjAzNDUx", "url": "https://github.com/apache/incubator-doris/pull/2839#pullrequestreview-354203451", "createdAt": "2020-02-06T05:10:02Z", "commit": {"oid": "b410933f6e44dcecb15e5700811602ca7712cc4a"}, "state": "DISMISSED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a58b2a82142022e940407b9539b906c989b4b778", "author": {"user": {"login": "morningman", "name": "Mingyu Chen"}}, "url": "https://github.com/apache/incubator-doris/commit/a58b2a82142022e940407b9539b906c989b4b778", "committedDate": "2020-02-06T07:22:29Z", "message": "fix compile bug"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzU0MjUyNjQ3", "url": "https://github.com/apache/incubator-doris/pull/2839#pullrequestreview-354252647", "createdAt": "2020-02-06T07:53:07Z", "commit": {"oid": "a58b2a82142022e940407b9539b906c989b4b778"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3694, "cost": 1, "resetAt": "2021-10-28T17:48:14Z"}}}