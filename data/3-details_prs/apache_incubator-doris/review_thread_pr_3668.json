{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDIxODczODQ0", "number": 3668, "reviewThreads": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yNlQwNjoxNjoyMlrOD_iO-g==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yN1QxNDo1NjowMFrOEAIp3A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjY3OTQ3NzcwOnYy", "diffSide": "RIGHT", "path": "be/src/olap/base_tablet.h", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yNlQwNjoxNjoyMlrOGaP9dQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yOVQwNDo0OTozN1rOGcOrew==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMDE3NzY1Mw==", "bodyText": "It may be not set default.", "url": "https://github.com/apache/incubator-doris/pull/3668#discussion_r430177653", "createdAt": "2020-05-26T06:16:22Z", "author": {"login": "chaoyli"}, "path": "be/src/olap/base_tablet.h", "diffHunk": "@@ -84,6 +85,10 @@ inline const TabletMetaSharedPtr BaseTablet::tablet_meta() {\n     return _tablet_meta;\n }\n \n+inline bool BaseTablet::is_memory() const {\n+    return _tablet_meta->tablet_type() == TabletTypePB::TABLET_TYPE_MEMORY;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "4c20b5d7e14a15f59aefcc9e90a944f78abb03ed"}, "originalPosition": 13}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMjI1MzgxOQ==", "bodyText": "fixed", "url": "https://github.com/apache/incubator-doris/pull/3668#discussion_r432253819", "createdAt": "2020-05-29T04:49:37Z", "author": {"login": "decster"}, "path": "be/src/olap/base_tablet.h", "diffHunk": "@@ -84,6 +85,10 @@ inline const TabletMetaSharedPtr BaseTablet::tablet_meta() {\n     return _tablet_meta;\n }\n \n+inline bool BaseTablet::is_memory() const {\n+    return _tablet_meta->tablet_type() == TabletTypePB::TABLET_TYPE_MEMORY;", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMDE3NzY1Mw=="}, "originalCommit": {"oid": "4c20b5d7e14a15f59aefcc9e90a944f78abb03ed"}, "originalPosition": 13}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjY3OTQ4MTI0OnYy", "diffSide": "RIGHT", "path": "be/src/olap/tablet_meta.cpp", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yNlQwNjoxODowMlrOGaP_sQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yOVQwNDo0OToyNlrOGcOrVA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMDE3ODIyNQ==", "bodyText": "Normal upgrade procedure is upgrading BE process proceeding of upgrading FE.\nWhen upgrading BE, tabletType may be not set.", "url": "https://github.com/apache/incubator-doris/pull/3668#discussion_r430178225", "createdAt": "2020-05-26T06:18:02Z", "author": {"login": "chaoyli"}, "path": "be/src/olap/tablet_meta.cpp", "diffHunk": "@@ -101,6 +89,8 @@ TabletMeta::TabletMeta(int64_t table_id, int64_t partition_id,\n     tablet_meta_pb.set_cumulative_layer_point(-1);\n     tablet_meta_pb.set_tablet_state(PB_RUNNING);\n     *(tablet_meta_pb.mutable_tablet_uid()) = tablet_uid.to_proto();\n+    tablet_meta_pb.set_tablet_type(tabletType == TTabletType::TABLET_TYPE_MEMORY ?", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "4c20b5d7e14a15f59aefcc9e90a944f78abb03ed"}, "originalPosition": 43}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMjI1Mzc4MA==", "bodyText": "fixed", "url": "https://github.com/apache/incubator-doris/pull/3668#discussion_r432253780", "createdAt": "2020-05-29T04:49:26Z", "author": {"login": "decster"}, "path": "be/src/olap/tablet_meta.cpp", "diffHunk": "@@ -101,6 +89,8 @@ TabletMeta::TabletMeta(int64_t table_id, int64_t partition_id,\n     tablet_meta_pb.set_cumulative_layer_point(-1);\n     tablet_meta_pb.set_tablet_state(PB_RUNNING);\n     *(tablet_meta_pb.mutable_tablet_uid()) = tablet_uid.to_proto();\n+    tablet_meta_pb.set_tablet_type(tabletType == TTabletType::TABLET_TYPE_MEMORY ?", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMDE3ODIyNQ=="}, "originalCommit": {"oid": "4c20b5d7e14a15f59aefcc9e90a944f78abb03ed"}, "originalPosition": 43}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjY3OTUxNzM4OnYy", "diffSide": "RIGHT", "path": "fe/src/main/java/org/apache/doris/alter/SchemaChangeJobV2.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yNlQwNjozMjo0OVrOGaQV4A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yNlQwNjozMjo0OVrOGaQV4A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMDE4MzkwNA==", "bodyText": "You should add constraint about ALTER TABLE.\nIf I have a disk table.\nALTER TABLE test SET(\"tablet_type\"=\"memory\");\n\nwill be encounter error in BE processing.", "url": "https://github.com/apache/incubator-doris/pull/3668#discussion_r430183904", "createdAt": "2020-05-26T06:32:49Z", "author": {"login": "chaoyli"}, "path": "fe/src/main/java/org/apache/doris/alter/SchemaChangeJobV2.java", "diffHunk": "@@ -240,7 +240,8 @@ protected void runPendingJob() throws AlterCancelException {\n                                     Partition.PARTITION_INIT_VERSION, Partition.PARTITION_INIT_VERSION_HASH,\n                                     tbl.getKeysType(), TStorageType.COLUMN, storageMedium,\n                                     shadowSchema, bfColumns, bfFpp, countDownLatch, indexes,\n-                                    tbl.isInMemory());\n+                                    tbl.isInMemory(),\n+                                    tbl.getPartitionInfo().getTabletType(partitionId));\n                             createReplicaTask.setBaseTablet(partitionIndexTabletMap.get(partitionId, shadowIdxId).get(shadowTabletId), originSchemaHash);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "4c20b5d7e14a15f59aefcc9e90a944f78abb03ed"}, "originalPosition": 7}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjY4NTc3MjQ0OnYy", "diffSide": "RIGHT", "path": "fe/src/main/java/org/apache/doris/common/util/PropertyAnalyzer.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yN1QxNDo1NjowMFrOGbOh2g==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yOFQwODoyNDo0M1rOGbqwuw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMTIwMjc3OA==", "bodyText": "modify the comment", "url": "https://github.com/apache/incubator-doris/pull/3668#discussion_r431202778", "createdAt": "2020-05-27T14:56:00Z", "author": {"login": "morningman"}, "path": "fe/src/main/java/org/apache/doris/common/util/PropertyAnalyzer.java", "diffHunk": "@@ -233,6 +236,23 @@ public static TStorageType analyzeStorageType(Map<String, String> properties) th\n         return tStorageType;\n     }\n \n+    public static TTabletType analyzeTabletType(Map<String, String> properties) throws AnalysisException {\n+        // default is COLUMN", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "1cef0cb5ce8743ec68f0d1baaecb71a108c8965e"}, "originalPosition": 22}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMTY2NTMzOQ==", "bodyText": "fixed", "url": "https://github.com/apache/incubator-doris/pull/3668#discussion_r431665339", "createdAt": "2020-05-28T08:24:43Z", "author": {"login": "decster"}, "path": "fe/src/main/java/org/apache/doris/common/util/PropertyAnalyzer.java", "diffHunk": "@@ -233,6 +236,23 @@ public static TStorageType analyzeStorageType(Map<String, String> properties) th\n         return tStorageType;\n     }\n \n+    public static TTabletType analyzeTabletType(Map<String, String> properties) throws AnalysisException {\n+        // default is COLUMN", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMTIwMjc3OA=="}, "originalCommit": {"oid": "1cef0cb5ce8743ec68f0d1baaecb71a108c8965e"}, "originalPosition": 22}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1603, "cost": 1, "resetAt": "2021-11-12T09:44:50Z"}}}