{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0Mzg5ODA2ODY2", "number": 3135, "title": "support subquery in case when statement", "bodyText": "#3153\nimplement subquery support for  sub query in case when statement like\nSELECT CASE\n        WHEN (\n            SELECT COUNT(*) / 2\n            FROM t\n        ) > k4 THEN (\n            SELECT AVG(k4)\n            FROM t\n        )\n        ELSE (\n            SELECT SUM(k4)\n            FROM t\n        )\n    END AS kk4\nFROM t;\n\nthis statement will be rewrite to\nSELECT CASE\n        WHEN t1.a > k4 THEN t2.a\n        ELSE t3.a\n    END AS kk4\nFROM t, (\n        SELECT COUNT(*) / 2 AS a\n        FROM t\n    ) t1,  (\n        SELECT AVG(k4) AS a\n        FROM t\n    ) t2,  (\n        SELECT SUM(k4) AS a\n        FROM t\n    ) t3;", "createdAt": "2020-03-17T12:28:59Z", "url": "https://github.com/apache/incubator-doris/pull/3135", "merged": true, "mergeCommit": {"oid": "71bc815b20ce589873a6baa0390bb2de36fa0dce"}, "closed": true, "closedAt": "2020-03-25T09:12:55Z", "author": {"login": "yangzhg"}, "timelineItems": {"totalCount": 27, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcOh6a7ABqjMxMzcxMTc0NDQ=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcRDGuFgFqTM4MDkzMjI0Ng==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "1f9e7b2c8cf5bd19d3aac67f2d176c67497d5ecc", "author": {"user": {"login": "yangzhg", "name": "Zhengguo Yang"}}, "url": "https://github.com/apache/incubator-doris/commit/1f9e7b2c8cf5bd19d3aac67f2d176c67497d5ecc", "committedDate": "2020-03-17T12:01:53Z", "message": "support subquery in case when statement"}, "afterCommit": {"oid": "8c4e7fdf7723b37151e453cb43d12698625bb76e", "author": {"user": {"login": "yangzhg", "name": "Zhengguo Yang"}}, "url": "https://github.com/apache/incubator-doris/commit/8c4e7fdf7723b37151e453cb43d12698625bb76e", "committedDate": "2020-03-17T12:31:33Z", "message": "support subquery in case when statement"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzc2MDk0OTc3", "url": "https://github.com/apache/incubator-doris/pull/3135#pullrequestreview-376094977", "createdAt": "2020-03-17T14:36:41Z", "commit": {"oid": "8c4e7fdf7723b37151e453cb43d12698625bb76e"}, "state": "COMMENTED", "comments": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xN1QxNDozNjo0MVrOF3fKEA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xN1QxNDo0NjoxOFrOF3fkzQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MzcyNjQ4MA==", "bodyText": "Add comment for this member~", "url": "https://github.com/apache/incubator-doris/pull/3135#discussion_r393726480", "createdAt": "2020-03-17T14:36:41Z", "author": {"login": "morningman"}, "path": "fe/src/main/java/org/apache/doris/analysis/SelectStmt.java", "diffHunk": "@@ -102,6 +103,8 @@\n     // Set in analyze().\n     protected String sqlString_;\n \n+    private boolean subqueryInCase = false;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "8c4e7fdf7723b37151e453cb43d12698625bb76e"}, "originalPosition": 12}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MzcyNzY3NQ==", "bodyText": "Add comments for this method.", "url": "https://github.com/apache/incubator-doris/pull/3135#discussion_r393727675", "createdAt": "2020-03-17T14:38:23Z", "author": {"login": "morningman"}, "path": "fe/src/main/java/org/apache/doris/analysis/SelectStmt.java", "diffHunk": "@@ -1244,6 +1213,46 @@ public void rewriteExprs(ExprRewriter rewriter) throws AnalysisException {\n                 orderByElem.setExpr(rewriter.rewrite(orderByElem.getExpr(), analyzer));\n             }\n         }\n+        if (subqueryInCase) {\n+            for (SelectListItem item : selectList.getItems()) {\n+                if (!(item.getExpr() instanceof CaseExpr)) {\n+                    continue;\n+                }\n+                if (!item.getExpr().contains(Predicates.instanceOf(Subquery.class))) {\n+                    continue;\n+                }\n+                item.setExpr(rewriteSubquery(item.getExpr()));\n+            }\n+        }\n+    }\n+\n+\n+    private Expr rewriteSubquery(Expr expr) throws AnalysisException {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "8c4e7fdf7723b37151e453cb43d12698625bb76e"}, "originalPosition": 100}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MzcyOTcyNQ==", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                       expr = new SlotRef(new TableName(null, alias), colAlias);\n          \n          \n            \n                        expr = new SlotRef(new TableName(null, alias), colAlias);", "url": "https://github.com/apache/incubator-doris/pull/3135#discussion_r393729725", "createdAt": "2020-03-17T14:41:09Z", "author": {"login": "morningman"}, "path": "fe/src/main/java/org/apache/doris/analysis/SelectStmt.java", "diffHunk": "@@ -1244,6 +1213,46 @@ public void rewriteExprs(ExprRewriter rewriter) throws AnalysisException {\n                 orderByElem.setExpr(rewriter.rewrite(orderByElem.getExpr(), analyzer));\n             }\n         }\n+        if (subqueryInCase) {\n+            for (SelectListItem item : selectList.getItems()) {\n+                if (!(item.getExpr() instanceof CaseExpr)) {\n+                    continue;\n+                }\n+                if (!item.getExpr().contains(Predicates.instanceOf(Subquery.class))) {\n+                    continue;\n+                }\n+                item.setExpr(rewriteSubquery(item.getExpr()));\n+            }\n+        }\n+    }\n+\n+\n+    private Expr rewriteSubquery(Expr expr) throws AnalysisException {\n+        if (expr instanceof Subquery) {\n+            if (!(((Subquery) expr).getStatement() instanceof SelectStmt) ) {\n+                throw new AnalysisException(\"only support select subquery in case statement.\");\n+            }\n+            SelectStmt subquery = (SelectStmt)((Subquery) expr).getStatement();\n+            if (subquery.getSelectList().getItems().size() != 1) {\n+                throw new AnalysisException(\"only support scala select subquery in case statement.\");\n+            }\n+            String alias = getTableAliasGenerator().getNextAlias();\n+            String colAlias = getColumnAliasGenerator().getNextAlias();\n+            InlineViewRef inlineViewRef = new InlineViewRef(alias, subquery, Arrays.asList(colAlias));\n+            try {\n+                inlineViewRef.analyze(analyzer);\n+            } catch (UserException e) {\n+                throw new AnalysisException(e.getMessage());\n+            }\n+            fromClause_.add(inlineViewRef);\n+           expr = new SlotRef(new TableName(null, alias), colAlias);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "8c4e7fdf7723b37151e453cb43d12698625bb76e"}, "originalPosition": 118}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MzczMzMyNQ==", "bodyText": "How do you make sure the subquery is like select sum(k1) from tbl, not select k1 from tbl?", "url": "https://github.com/apache/incubator-doris/pull/3135#discussion_r393733325", "createdAt": "2020-03-17T14:46:18Z", "author": {"login": "morningman"}, "path": "fe/src/main/java/org/apache/doris/analysis/SelectStmt.java", "diffHunk": "@@ -1244,6 +1213,46 @@ public void rewriteExprs(ExprRewriter rewriter) throws AnalysisException {\n                 orderByElem.setExpr(rewriter.rewrite(orderByElem.getExpr(), analyzer));\n             }\n         }\n+        if (subqueryInCase) {\n+            for (SelectListItem item : selectList.getItems()) {\n+                if (!(item.getExpr() instanceof CaseExpr)) {\n+                    continue;\n+                }\n+                if (!item.getExpr().contains(Predicates.instanceOf(Subquery.class))) {\n+                    continue;\n+                }\n+                item.setExpr(rewriteSubquery(item.getExpr()));\n+            }\n+        }\n+    }\n+\n+\n+    private Expr rewriteSubquery(Expr expr) throws AnalysisException {\n+        if (expr instanceof Subquery) {\n+            if (!(((Subquery) expr).getStatement() instanceof SelectStmt) ) {\n+                throw new AnalysisException(\"only support select subquery in case statement.\");\n+            }\n+            SelectStmt subquery = (SelectStmt)((Subquery) expr).getStatement();\n+            if (subquery.getSelectList().getItems().size() != 1) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "8c4e7fdf7723b37151e453cb43d12698625bb76e"}, "originalPosition": 106}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "8c4e7fdf7723b37151e453cb43d12698625bb76e", "author": {"user": {"login": "yangzhg", "name": "Zhengguo Yang"}}, "url": "https://github.com/apache/incubator-doris/commit/8c4e7fdf7723b37151e453cb43d12698625bb76e", "committedDate": "2020-03-17T12:31:33Z", "message": "support subquery in case when statement"}, "afterCommit": {"oid": "0d70e001cc07eea5446e142afdb5f5fea1d13039", "author": {"user": {"login": "yangzhg", "name": "Zhengguo Yang"}}, "url": "https://github.com/apache/incubator-doris/commit/0d70e001cc07eea5446e142afdb5f5fea1d13039", "committedDate": "2020-03-18T02:45:56Z", "message": "support subquery in case when statement"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "0d70e001cc07eea5446e142afdb5f5fea1d13039", "author": {"user": {"login": "yangzhg", "name": "Zhengguo Yang"}}, "url": "https://github.com/apache/incubator-doris/commit/0d70e001cc07eea5446e142afdb5f5fea1d13039", "committedDate": "2020-03-18T02:45:56Z", "message": "support subquery in case when statement"}, "afterCommit": {"oid": "77da1914393aae772a0c07ea96ea72b5e0a8bc6d", "author": {"user": {"login": "yangzhg", "name": "Zhengguo Yang"}}, "url": "https://github.com/apache/incubator-doris/commit/77da1914393aae772a0c07ea96ea72b5e0a8bc6d", "committedDate": "2020-03-18T03:28:58Z", "message": "support subquery in case when statement"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "77da1914393aae772a0c07ea96ea72b5e0a8bc6d", "author": {"user": {"login": "yangzhg", "name": "Zhengguo Yang"}}, "url": "https://github.com/apache/incubator-doris/commit/77da1914393aae772a0c07ea96ea72b5e0a8bc6d", "committedDate": "2020-03-18T03:28:58Z", "message": "support subquery in case when statement"}, "afterCommit": {"oid": "f86db203a09b72be782ed69dd22c03a6d81b45f1", "author": {"user": {"login": "yangzhg", "name": "Zhengguo Yang"}}, "url": "https://github.com/apache/incubator-doris/commit/f86db203a09b72be782ed69dd22c03a6d81b45f1", "committedDate": "2020-03-18T10:22:19Z", "message": "support subquery in case when statement"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "f86db203a09b72be782ed69dd22c03a6d81b45f1", "author": {"user": {"login": "yangzhg", "name": "Zhengguo Yang"}}, "url": "https://github.com/apache/incubator-doris/commit/f86db203a09b72be782ed69dd22c03a6d81b45f1", "committedDate": "2020-03-18T10:22:19Z", "message": "support subquery in case when statement"}, "afterCommit": {"oid": "14ec1fc12b5b754fb36950d7619b5d287c616b32", "author": {"user": {"login": "yangzhg", "name": "Zhengguo Yang"}}, "url": "https://github.com/apache/incubator-doris/commit/14ec1fc12b5b754fb36950d7619b5d287c616b32", "committedDate": "2020-03-18T11:44:55Z", "message": "support subquery in case when statement"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "14ec1fc12b5b754fb36950d7619b5d287c616b32", "author": {"user": {"login": "yangzhg", "name": "Zhengguo Yang"}}, "url": "https://github.com/apache/incubator-doris/commit/14ec1fc12b5b754fb36950d7619b5d287c616b32", "committedDate": "2020-03-18T11:44:55Z", "message": "support subquery in case when statement"}, "afterCommit": {"oid": "93074c980c66d9964baade9aafa127c19f78ecb9", "author": {"user": {"login": "yangzhg", "name": "Zhengguo Yang"}}, "url": "https://github.com/apache/incubator-doris/commit/93074c980c66d9964baade9aafa127c19f78ecb9", "committedDate": "2020-03-19T02:01:26Z", "message": "support subquery in case when statement"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzc3NDA5NjI0", "url": "https://github.com/apache/incubator-doris/pull/3135#pullrequestreview-377409624", "createdAt": "2020-03-19T04:01:21Z", "commit": {"oid": "93074c980c66d9964baade9aafa127c19f78ecb9"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xOVQwNDowMToyMVrOF4fZfA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xOVQwNDowMjozMlrOF4faRA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NDc3OTAwNA==", "bodyText": "The entire query should be reanalyzed if there is subquery is rewritten. So maybe this method should be move to StmtRewriter.", "url": "https://github.com/apache/incubator-doris/pull/3135#discussion_r394779004", "createdAt": "2020-03-19T04:01:21Z", "author": {"login": "EmmyMiao87"}, "path": "fe/src/main/java/org/apache/doris/analysis/SelectStmt.java", "diffHunk": "@@ -1246,6 +1228,68 @@ public void rewriteExprs(ExprRewriter rewriter) throws AnalysisException {\n         }\n     }\n \n+    /** rewrite subquery in case when to an inline view\n+     *  subquery in case when statement like\n+     *\n+     * SELECT CASE\n+     *         WHEN (\n+     *             SELECT COUNT(*) / 2\n+     *             FROM t\n+     *         ) > k4 THEN (\n+     *             SELECT AVG(k4)\n+     *             FROM t\n+     *         )\n+     *         ELSE (\n+     *             SELECT SUM(k4)\n+     *             FROM t\n+     *         )\n+     *     END AS kk4\n+     * FROM t;\n+     * this statement will be rewrite to\n+     *\n+     * SELECT CASE\n+     *         WHEN t1.a > k4 THEN t2.a\n+     *         ELSE t3.a\n+     *     END AS kk4\n+     * FROM t, (\n+     *         SELECT COUNT(*) / 2 AS a\n+     *         FROM t\n+     *     ) t1,  (\n+     *         SELECT AVG(k4) AS a\n+     *         FROM t\n+     *     ) t2,  (\n+     *         SELECT SUM(k4) AS a\n+     *         FROM t\n+     *     ) t3;\n+     */\n+    private Expr rewriteSubquery(Expr expr) throws AnalysisException {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "93074c980c66d9964baade9aafa127c19f78ecb9"}, "originalPosition": 143}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NDc3OTEyNQ==", "bodyText": "The subquery should be reset before it is reanalyzed.", "url": "https://github.com/apache/incubator-doris/pull/3135#discussion_r394779125", "createdAt": "2020-03-19T04:02:05Z", "author": {"login": "EmmyMiao87"}, "path": "fe/src/main/java/org/apache/doris/analysis/SelectStmt.java", "diffHunk": "@@ -1246,6 +1228,68 @@ public void rewriteExprs(ExprRewriter rewriter) throws AnalysisException {\n         }\n     }\n \n+    /** rewrite subquery in case when to an inline view\n+     *  subquery in case when statement like\n+     *\n+     * SELECT CASE\n+     *         WHEN (\n+     *             SELECT COUNT(*) / 2\n+     *             FROM t\n+     *         ) > k4 THEN (\n+     *             SELECT AVG(k4)\n+     *             FROM t\n+     *         )\n+     *         ELSE (\n+     *             SELECT SUM(k4)\n+     *             FROM t\n+     *         )\n+     *     END AS kk4\n+     * FROM t;\n+     * this statement will be rewrite to\n+     *\n+     * SELECT CASE\n+     *         WHEN t1.a > k4 THEN t2.a\n+     *         ELSE t3.a\n+     *     END AS kk4\n+     * FROM t, (\n+     *         SELECT COUNT(*) / 2 AS a\n+     *         FROM t\n+     *     ) t1,  (\n+     *         SELECT AVG(k4) AS a\n+     *         FROM t\n+     *     ) t2,  (\n+     *         SELECT SUM(k4) AS a\n+     *         FROM t\n+     *     ) t3;\n+     */\n+    private Expr rewriteSubquery(Expr expr) throws AnalysisException {\n+        if (expr instanceof Subquery) {\n+            if (!(((Subquery) expr).getStatement() instanceof SelectStmt)) {\n+                throw new AnalysisException(\"only support select subquery in case statement.\");\n+            }\n+            SelectStmt subquery = (SelectStmt) ((Subquery) expr).getStatement();\n+            if (subquery.getSelectList().getItems().size() != 1) {\n+                throw new AnalysisException(\"only support scala select subquery in case statement.\");\n+            }\n+            String alias = getTableAliasGenerator().getNextAlias();\n+            String colAlias = getColumnAliasGenerator().getNextAlias();\n+            InlineViewRef inlineViewRef = new InlineViewRef(alias, subquery, Arrays.asList(colAlias));", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "93074c980c66d9964baade9aafa127c19f78ecb9"}, "originalPosition": 154}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NDc3OTIwNA==", "bodyText": "How about the case expr in the where predicate?", "url": "https://github.com/apache/incubator-doris/pull/3135#discussion_r394779204", "createdAt": "2020-03-19T04:02:32Z", "author": {"login": "EmmyMiao87"}, "path": "fe/src/main/java/org/apache/doris/analysis/SelectStmt.java", "diffHunk": "@@ -341,7 +345,11 @@ public void analyze(Analyzer analyzer) throws AnalysisException, UserException {\n                 // of expr child and depth limits (toColumn() label may call toSql()).\n                 item.getExpr().analyze(analyzer);\n                 if (item.getExpr().contains(Predicates.instanceOf(Subquery.class))) {\n-                    throw new AnalysisException(\"Subquery is not supported in the select list.\");\n+                    if (item.getExpr() instanceof CaseExpr) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "93074c980c66d9964baade9aafa127c19f78ecb9"}, "originalPosition": 23}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "93074c980c66d9964baade9aafa127c19f78ecb9", "author": {"user": {"login": "yangzhg", "name": "Zhengguo Yang"}}, "url": "https://github.com/apache/incubator-doris/commit/93074c980c66d9964baade9aafa127c19f78ecb9", "committedDate": "2020-03-19T02:01:26Z", "message": "support subquery in case when statement"}, "afterCommit": {"oid": "70a9580ab39819648ed545871198b00645363a8b", "author": {"user": {"login": "yangzhg", "name": "Zhengguo Yang"}}, "url": "https://github.com/apache/incubator-doris/commit/70a9580ab39819648ed545871198b00645363a8b", "committedDate": "2020-03-19T06:37:29Z", "message": "support subquery in case when statement"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "70a9580ab39819648ed545871198b00645363a8b", "author": {"user": {"login": "yangzhg", "name": "Zhengguo Yang"}}, "url": "https://github.com/apache/incubator-doris/commit/70a9580ab39819648ed545871198b00645363a8b", "committedDate": "2020-03-19T06:37:29Z", "message": "support subquery in case when statement"}, "afterCommit": {"oid": "744d4531c9b612828aa423fdda00d926658a4bb1", "author": {"user": {"login": "yangzhg", "name": "Zhengguo Yang"}}, "url": "https://github.com/apache/incubator-doris/commit/744d4531c9b612828aa423fdda00d926658a4bb1", "committedDate": "2020-03-19T06:42:07Z", "message": "support subquery in case when statement"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzc3NTA3MzA3", "url": "https://github.com/apache/incubator-doris/pull/3135#pullrequestreview-377507307", "createdAt": "2020-03-19T08:27:16Z", "commit": {"oid": "744d4531c9b612828aa423fdda00d926658a4bb1"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xOVQwODoyNzoxNlrOF4kQ0A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xOVQwODoyNzoxNlrOF4kQ0A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NDg1ODcwNA==", "bodyText": "Reorder your import order in your IDE:\norg.apache.doris\ncom\norg\njava\njavax", "url": "https://github.com/apache/incubator-doris/pull/3135#discussion_r394858704", "createdAt": "2020-03-19T08:27:16Z", "author": {"login": "morningman"}, "path": "fe/src/main/java/org/apache/doris/analysis/SelectStmt.java", "diffHunk": "@@ -17,6 +17,15 @@\n \n package org.apache.doris.analysis;\n \n+import com.google.common.base.Preconditions;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "744d4531c9b612828aa423fdda00d926658a4bb1"}, "originalPosition": 4}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "adfeb6cb2ca8d24c25624789a01b789b7d53b88e", "author": {"user": {"login": "yangzhg", "name": "Zhengguo Yang"}}, "url": "https://github.com/apache/incubator-doris/commit/adfeb6cb2ca8d24c25624789a01b789b7d53b88e", "committedDate": "2020-03-19T11:36:16Z", "message": "support subquery in case when statement"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "744d4531c9b612828aa423fdda00d926658a4bb1", "author": {"user": {"login": "yangzhg", "name": "Zhengguo Yang"}}, "url": "https://github.com/apache/incubator-doris/commit/744d4531c9b612828aa423fdda00d926658a4bb1", "committedDate": "2020-03-19T06:42:07Z", "message": "support subquery in case when statement"}, "afterCommit": {"oid": "adfeb6cb2ca8d24c25624789a01b789b7d53b88e", "author": {"user": {"login": "yangzhg", "name": "Zhengguo Yang"}}, "url": "https://github.com/apache/incubator-doris/commit/adfeb6cb2ca8d24c25624789a01b789b7d53b88e", "committedDate": "2020-03-19T11:36:16Z", "message": "support subquery in case when statement"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f65df269a6f0a1ed3db52e60dd3077e1642e2f9d", "author": {"user": {"login": "yangzhg", "name": "Zhengguo Yang"}}, "url": "https://github.com/apache/incubator-doris/commit/f65df269a6f0a1ed3db52e60dd3077e1642e2f9d", "committedDate": "2020-03-20T02:37:42Z", "message": "reorder rewrite"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzc4MjA3Njg0", "url": "https://github.com/apache/incubator-doris/pull/3135#pullrequestreview-378207684", "createdAt": "2020-03-20T02:41:43Z", "commit": {"oid": "f65df269a6f0a1ed3db52e60dd3077e1642e2f9d"}, "state": "COMMENTED", "comments": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yMFQwMjo0MTo0M1rOF5GUjQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yMFQwMjo0NzowNVrOF5GYmQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NTQxNjcxNw==", "bodyText": "If the item of select list is '*'", "url": "https://github.com/apache/incubator-doris/pull/3135#discussion_r395416717", "createdAt": "2020-03-20T02:41:43Z", "author": {"login": "EmmyMiao87"}, "path": "fe/src/main/java/org/apache/doris/analysis/StmtRewriter.java", "diffHunk": "@@ -953,5 +957,81 @@ private static Expr createJoinConjunct(Expr exprWithSubquery, InlineViewRef inli\n         smap.put(subquery, subquerySubstitute);\n         return exprWithSubquery.substitute(smap, analyzer, false);\n     }\n+\n+    /** rewrite subquery in case when to an inline view\n+     *  subquery in case when statement like\n+     *\n+     * SELECT CASE\n+     *         WHEN (\n+     *             SELECT COUNT(*) / 2\n+     *             FROM t\n+     *         ) > k4 THEN (\n+     *             SELECT AVG(k4)\n+     *             FROM t\n+     *         )\n+     *         ELSE (\n+     *             SELECT SUM(k4)\n+     *             FROM t\n+     *         )\n+     *     END AS kk4\n+     * FROM t;\n+     * this statement will be rewrite to\n+     *\n+     * SELECT CASE\n+     *         WHEN t1.a > k4 THEN t2.a\n+     *         ELSE t3.a\n+     *     END AS kk4\n+     * FROM t, (\n+     *         SELECT COUNT(*) / 2 AS a\n+     *         FROM t\n+     *     ) t1,  (\n+     *         SELECT AVG(k4) AS a\n+     *         FROM t\n+     *     ) t2,  (\n+     *         SELECT SUM(k4) AS a\n+     *         FROM t\n+     *     ) t3;\n+     */\n+    private static void rewriteCaseWhenSubqueries(SelectStmt stmt, Analyzer analyzer) throws AnalysisException {\n+        for (SelectListItem item: stmt.getSelectList().getItems()) {\n+            if (!(item.getExpr() instanceof CaseExpr)) {\n+                continue;\n+            }\n+            if (!item.getExpr().contains(Predicates.instanceOf(Subquery.class))) {\n+                continue;\n+            }\n+            item.setExpr(rewriteCaseWhenSubquery(item.getExpr(), stmt, analyzer));\n+        }\n+\n+    }\n+\n+    private static Expr rewriteCaseWhenSubquery(Expr expr, SelectStmt stmt, Analyzer analyzer)\n+            throws AnalysisException {\n+        if (expr instanceof Subquery) {\n+            if (!(((Subquery) expr).getStatement() instanceof SelectStmt)) {\n+                throw new AnalysisException(\"only support select subquery in case statement.\");\n+            }\n+            SelectStmt subquery = (SelectStmt) ((Subquery) expr).getStatement();\n+            if (subquery.getSelectList().getItems().size() != 1) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f65df269a6f0a1ed3db52e60dd3077e1642e2f9d"}, "originalPosition": 84}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NTQxNzE3OQ==", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                            throw new AnalysisException(\"only support scala select subquery in case statement.\");\n          \n          \n            \n                            throw new AnalysisException(\"Only support one result column of subquery in case statement.\");", "url": "https://github.com/apache/incubator-doris/pull/3135#discussion_r395417179", "createdAt": "2020-03-20T02:43:47Z", "author": {"login": "EmmyMiao87"}, "path": "fe/src/main/java/org/apache/doris/analysis/StmtRewriter.java", "diffHunk": "@@ -953,5 +957,81 @@ private static Expr createJoinConjunct(Expr exprWithSubquery, InlineViewRef inli\n         smap.put(subquery, subquerySubstitute);\n         return exprWithSubquery.substitute(smap, analyzer, false);\n     }\n+\n+    /** rewrite subquery in case when to an inline view\n+     *  subquery in case when statement like\n+     *\n+     * SELECT CASE\n+     *         WHEN (\n+     *             SELECT COUNT(*) / 2\n+     *             FROM t\n+     *         ) > k4 THEN (\n+     *             SELECT AVG(k4)\n+     *             FROM t\n+     *         )\n+     *         ELSE (\n+     *             SELECT SUM(k4)\n+     *             FROM t\n+     *         )\n+     *     END AS kk4\n+     * FROM t;\n+     * this statement will be rewrite to\n+     *\n+     * SELECT CASE\n+     *         WHEN t1.a > k4 THEN t2.a\n+     *         ELSE t3.a\n+     *     END AS kk4\n+     * FROM t, (\n+     *         SELECT COUNT(*) / 2 AS a\n+     *         FROM t\n+     *     ) t1,  (\n+     *         SELECT AVG(k4) AS a\n+     *         FROM t\n+     *     ) t2,  (\n+     *         SELECT SUM(k4) AS a\n+     *         FROM t\n+     *     ) t3;\n+     */\n+    private static void rewriteCaseWhenSubqueries(SelectStmt stmt, Analyzer analyzer) throws AnalysisException {\n+        for (SelectListItem item: stmt.getSelectList().getItems()) {\n+            if (!(item.getExpr() instanceof CaseExpr)) {\n+                continue;\n+            }\n+            if (!item.getExpr().contains(Predicates.instanceOf(Subquery.class))) {\n+                continue;\n+            }\n+            item.setExpr(rewriteCaseWhenSubquery(item.getExpr(), stmt, analyzer));\n+        }\n+\n+    }\n+\n+    private static Expr rewriteCaseWhenSubquery(Expr expr, SelectStmt stmt, Analyzer analyzer)\n+            throws AnalysisException {\n+        if (expr instanceof Subquery) {\n+            if (!(((Subquery) expr).getStatement() instanceof SelectStmt)) {\n+                throw new AnalysisException(\"only support select subquery in case statement.\");\n+            }\n+            SelectStmt subquery = (SelectStmt) ((Subquery) expr).getStatement();\n+            if (subquery.getSelectList().getItems().size() != 1) {\n+                throw new AnalysisException(\"only support scala select subquery in case statement.\");", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f65df269a6f0a1ed3db52e60dd3077e1642e2f9d"}, "originalPosition": 85}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NTQxNzM1MA==", "bodyText": "The correlated subquery should be forbidden.", "url": "https://github.com/apache/incubator-doris/pull/3135#discussion_r395417350", "createdAt": "2020-03-20T02:44:53Z", "author": {"login": "EmmyMiao87"}, "path": "fe/src/main/java/org/apache/doris/analysis/StmtRewriter.java", "diffHunk": "@@ -953,5 +957,81 @@ private static Expr createJoinConjunct(Expr exprWithSubquery, InlineViewRef inli\n         smap.put(subquery, subquerySubstitute);\n         return exprWithSubquery.substitute(smap, analyzer, false);\n     }\n+\n+    /** rewrite subquery in case when to an inline view\n+     *  subquery in case when statement like\n+     *\n+     * SELECT CASE\n+     *         WHEN (\n+     *             SELECT COUNT(*) / 2\n+     *             FROM t\n+     *         ) > k4 THEN (\n+     *             SELECT AVG(k4)\n+     *             FROM t\n+     *         )\n+     *         ELSE (\n+     *             SELECT SUM(k4)\n+     *             FROM t\n+     *         )\n+     *     END AS kk4\n+     * FROM t;\n+     * this statement will be rewrite to\n+     *\n+     * SELECT CASE\n+     *         WHEN t1.a > k4 THEN t2.a\n+     *         ELSE t3.a\n+     *     END AS kk4\n+     * FROM t, (\n+     *         SELECT COUNT(*) / 2 AS a\n+     *         FROM t\n+     *     ) t1,  (\n+     *         SELECT AVG(k4) AS a\n+     *         FROM t\n+     *     ) t2,  (\n+     *         SELECT SUM(k4) AS a\n+     *         FROM t\n+     *     ) t3;\n+     */\n+    private static void rewriteCaseWhenSubqueries(SelectStmt stmt, Analyzer analyzer) throws AnalysisException {\n+        for (SelectListItem item: stmt.getSelectList().getItems()) {\n+            if (!(item.getExpr() instanceof CaseExpr)) {\n+                continue;\n+            }\n+            if (!item.getExpr().contains(Predicates.instanceOf(Subquery.class))) {\n+                continue;\n+            }\n+            item.setExpr(rewriteCaseWhenSubquery(item.getExpr(), stmt, analyzer));\n+        }\n+\n+    }\n+\n+    private static Expr rewriteCaseWhenSubquery(Expr expr, SelectStmt stmt, Analyzer analyzer)\n+            throws AnalysisException {\n+        if (expr instanceof Subquery) {\n+            if (!(((Subquery) expr).getStatement() instanceof SelectStmt)) {\n+                throw new AnalysisException(\"only support select subquery in case statement.\");\n+            }\n+            SelectStmt subquery = (SelectStmt) ((Subquery) expr).getStatement();\n+            if (subquery.getSelectList().getItems().size() != 1) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f65df269a6f0a1ed3db52e60dd3077e1642e2f9d"}, "originalPosition": 84}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NTQxNzc1Mw==", "bodyText": "The table name could be fetch from inline view ref", "url": "https://github.com/apache/incubator-doris/pull/3135#discussion_r395417753", "createdAt": "2020-03-20T02:47:05Z", "author": {"login": "EmmyMiao87"}, "path": "fe/src/main/java/org/apache/doris/analysis/StmtRewriter.java", "diffHunk": "@@ -953,5 +957,81 @@ private static Expr createJoinConjunct(Expr exprWithSubquery, InlineViewRef inli\n         smap.put(subquery, subquerySubstitute);\n         return exprWithSubquery.substitute(smap, analyzer, false);\n     }\n+\n+    /** rewrite subquery in case when to an inline view\n+     *  subquery in case when statement like\n+     *\n+     * SELECT CASE\n+     *         WHEN (\n+     *             SELECT COUNT(*) / 2\n+     *             FROM t\n+     *         ) > k4 THEN (\n+     *             SELECT AVG(k4)\n+     *             FROM t\n+     *         )\n+     *         ELSE (\n+     *             SELECT SUM(k4)\n+     *             FROM t\n+     *         )\n+     *     END AS kk4\n+     * FROM t;\n+     * this statement will be rewrite to\n+     *\n+     * SELECT CASE\n+     *         WHEN t1.a > k4 THEN t2.a\n+     *         ELSE t3.a\n+     *     END AS kk4\n+     * FROM t, (\n+     *         SELECT COUNT(*) / 2 AS a\n+     *         FROM t\n+     *     ) t1,  (\n+     *         SELECT AVG(k4) AS a\n+     *         FROM t\n+     *     ) t2,  (\n+     *         SELECT SUM(k4) AS a\n+     *         FROM t\n+     *     ) t3;\n+     */\n+    private static void rewriteCaseWhenSubqueries(SelectStmt stmt, Analyzer analyzer) throws AnalysisException {\n+        for (SelectListItem item: stmt.getSelectList().getItems()) {\n+            if (!(item.getExpr() instanceof CaseExpr)) {\n+                continue;\n+            }\n+            if (!item.getExpr().contains(Predicates.instanceOf(Subquery.class))) {\n+                continue;\n+            }\n+            item.setExpr(rewriteCaseWhenSubquery(item.getExpr(), stmt, analyzer));\n+        }\n+\n+    }\n+\n+    private static Expr rewriteCaseWhenSubquery(Expr expr, SelectStmt stmt, Analyzer analyzer)\n+            throws AnalysisException {\n+        if (expr instanceof Subquery) {\n+            if (!(((Subquery) expr).getStatement() instanceof SelectStmt)) {\n+                throw new AnalysisException(\"only support select subquery in case statement.\");\n+            }\n+            SelectStmt subquery = (SelectStmt) ((Subquery) expr).getStatement();\n+            if (subquery.getSelectList().getItems().size() != 1) {\n+                throw new AnalysisException(\"only support scala select subquery in case statement.\");\n+            }\n+            subquery.reset();\n+            String alias = stmt.getTableAliasGenerator().getNextAlias();\n+            String colAlias = stmt.getColumnAliasGenerator().getNextAlias();\n+            InlineViewRef inlineViewRef = new InlineViewRef(alias, subquery, Arrays.asList(colAlias));\n+            try {\n+                inlineViewRef.analyze(analyzer);\n+            } catch (UserException e) {\n+                throw new AnalysisException(e.getMessage());\n+            }\n+            stmt.fromClause_.add(inlineViewRef);\n+            expr = new SlotRef(new TableName(null, alias), colAlias);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f65df269a6f0a1ed3db52e60dd3077e1642e2f9d"}, "originalPosition": 97}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "73c965b41a9666f52a7be8d49513e225a5d677db", "author": {"user": {"login": "yangzhg", "name": "Zhengguo Yang"}}, "url": "https://github.com/apache/incubator-doris/commit/73c965b41a9666f52a7be8d49513e225a5d677db", "committedDate": "2020-03-20T03:13:29Z", "message": "reorder rewrite"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "0e6a0d0438f871e5f6c632d0c6e1c5988e5f8522", "author": {"user": {"login": "yangzhg", "name": "Zhengguo Yang"}}, "url": "https://github.com/apache/incubator-doris/commit/0e6a0d0438f871e5f6c632d0c6e1c5988e5f8522", "committedDate": "2020-03-23T03:27:25Z", "message": "use inlineview alias"}, "afterCommit": {"oid": "f0377c4f2d8a13a42ae76b6abad1d6303289ac20", "author": {"user": {"login": "yangzhg", "name": "Zhengguo Yang"}}, "url": "https://github.com/apache/incubator-doris/commit/f0377c4f2d8a13a42ae76b6abad1d6303289ac20", "committedDate": "2020-03-23T06:32:09Z", "message": "use inlineview alias"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "f0377c4f2d8a13a42ae76b6abad1d6303289ac20", "author": {"user": {"login": "yangzhg", "name": "Zhengguo Yang"}}, "url": "https://github.com/apache/incubator-doris/commit/f0377c4f2d8a13a42ae76b6abad1d6303289ac20", "committedDate": "2020-03-23T06:32:09Z", "message": "use inlineview alias"}, "afterCommit": {"oid": "a64cda770051514c0c41e83a22c4f80003f856c5", "author": {"user": {"login": "yangzhg", "name": "Zhengguo Yang"}}, "url": "https://github.com/apache/incubator-doris/commit/a64cda770051514c0c41e83a22c4f80003f856c5", "committedDate": "2020-03-23T09:19:47Z", "message": "use inlineview alias"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "a64cda770051514c0c41e83a22c4f80003f856c5", "author": {"user": {"login": "yangzhg", "name": "Zhengguo Yang"}}, "url": "https://github.com/apache/incubator-doris/commit/a64cda770051514c0c41e83a22c4f80003f856c5", "committedDate": "2020-03-23T09:19:47Z", "message": "use inlineview alias"}, "afterCommit": {"oid": "dcfd0bed0162c897ea1e91b300c73e637db2366e", "author": {"user": {"login": "yangzhg", "name": "Zhengguo Yang"}}, "url": "https://github.com/apache/incubator-doris/commit/dcfd0bed0162c897ea1e91b300c73e637db2366e", "committedDate": "2020-03-23T09:27:53Z", "message": "use inlineview alias"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzc5MzMxNTgw", "url": "https://github.com/apache/incubator-doris/pull/3135#pullrequestreview-379331580", "createdAt": "2020-03-23T11:12:35Z", "commit": {"oid": "dcfd0bed0162c897ea1e91b300c73e637db2366e"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yM1QxMToxMjozNVrOF6AvAw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yM1QxMToxMjozNVrOF6AvAw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NjM3Mzc2Mw==", "bodyText": "The meaning of these two lines is not clear\u3002", "url": "https://github.com/apache/incubator-doris/pull/3135#discussion_r396373763", "createdAt": "2020-03-23T11:12:35Z", "author": {"login": "wutiangan"}, "path": "fe/src/main/java/org/apache/doris/analysis/SelectList.java", "diffHunk": "@@ -83,7 +84,18 @@ public void reset() {\n     public void rewriteExprs(ExprRewriter rewriter, Analyzer analyzer)\n             throws AnalysisException {\n         for (SelectListItem item : items) {\n-            if (item.isStar()) continue;\n+            if (item.isStar()) {\n+                continue;\n+            }\n+            // when select list contain case when, for now subquery is supported in case-when\n+            // (or more subquery is supported in future) so subquery all need to rewrite", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "dcfd0bed0162c897ea1e91b300c73e637db2366e"}, "originalPosition": 17}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "dcfd0bed0162c897ea1e91b300c73e637db2366e", "author": {"user": {"login": "yangzhg", "name": "Zhengguo Yang"}}, "url": "https://github.com/apache/incubator-doris/commit/dcfd0bed0162c897ea1e91b300c73e637db2366e", "committedDate": "2020-03-23T09:27:53Z", "message": "use inlineview alias"}, "afterCommit": {"oid": "2ed350fd722bf8ee6917af94397789f21b1d5e43", "author": {"user": {"login": "yangzhg", "name": "Zhengguo Yang"}}, "url": "https://github.com/apache/incubator-doris/commit/2ed350fd722bf8ee6917af94397789f21b1d5e43", "committedDate": "2020-03-23T13:04:56Z", "message": "use inlineview alias"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "2ed350fd722bf8ee6917af94397789f21b1d5e43", "author": {"user": {"login": "yangzhg", "name": "Zhengguo Yang"}}, "url": "https://github.com/apache/incubator-doris/commit/2ed350fd722bf8ee6917af94397789f21b1d5e43", "committedDate": "2020-03-23T13:04:56Z", "message": "use inlineview alias"}, "afterCommit": {"oid": "89a5db691360869df47b7285bb111751b438bab8", "author": {"user": {"login": "yangzhg", "name": "Zhengguo Yang"}}, "url": "https://github.com/apache/incubator-doris/commit/89a5db691360869df47b7285bb111751b438bab8", "committedDate": "2020-03-24T01:58:13Z", "message": "use inlineview alias"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "89a5db691360869df47b7285bb111751b438bab8", "author": {"user": {"login": "yangzhg", "name": "Zhengguo Yang"}}, "url": "https://github.com/apache/incubator-doris/commit/89a5db691360869df47b7285bb111751b438bab8", "committedDate": "2020-03-24T01:58:13Z", "message": "use inlineview alias"}, "afterCommit": {"oid": "2fee5b1b76e7c7cf59136eced42ab5bc421968e6", "author": {"user": {"login": "yangzhg", "name": "Zhengguo Yang"}}, "url": "https://github.com/apache/incubator-doris/commit/2fee5b1b76e7c7cf59136eced42ab5bc421968e6", "committedDate": "2020-03-24T07:02:41Z", "message": "use inlineview alias"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "2fee5b1b76e7c7cf59136eced42ab5bc421968e6", "author": {"user": {"login": "yangzhg", "name": "Zhengguo Yang"}}, "url": "https://github.com/apache/incubator-doris/commit/2fee5b1b76e7c7cf59136eced42ab5bc421968e6", "committedDate": "2020-03-24T07:02:41Z", "message": "use inlineview alias"}, "afterCommit": {"oid": "dcc95d015b50f34c9c8c9fab0435ca9e7bc150a6", "author": {"user": {"login": "yangzhg", "name": "Zhengguo Yang"}}, "url": "https://github.com/apache/incubator-doris/commit/dcc95d015b50f34c9c8c9fab0435ca9e7bc150a6", "committedDate": "2020-03-24T07:03:53Z", "message": "use inlineview alias"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "0b78fd8c697f8a2e0f76650253d97b4d0731d8f1", "author": {"user": {"login": "yangzhg", "name": "Zhengguo Yang"}}, "url": "https://github.com/apache/incubator-doris/commit/0b78fd8c697f8a2e0f76650253d97b4d0731d8f1", "committedDate": "2020-03-24T08:54:25Z", "message": "use inlineview alias"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "dcc95d015b50f34c9c8c9fab0435ca9e7bc150a6", "author": {"user": {"login": "yangzhg", "name": "Zhengguo Yang"}}, "url": "https://github.com/apache/incubator-doris/commit/dcc95d015b50f34c9c8c9fab0435ca9e7bc150a6", "committedDate": "2020-03-24T07:03:53Z", "message": "use inlineview alias"}, "afterCommit": {"oid": "0b78fd8c697f8a2e0f76650253d97b4d0731d8f1", "author": {"user": {"login": "yangzhg", "name": "Zhengguo Yang"}}, "url": "https://github.com/apache/incubator-doris/commit/0b78fd8c697f8a2e0f76650253d97b4d0731d8f1", "committedDate": "2020-03-24T08:54:25Z", "message": "use inlineview alias"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzgwOTMyMjQ2", "url": "https://github.com/apache/incubator-doris/pull/3135#pullrequestreview-380932246", "createdAt": "2020-03-25T08:19:51Z", "commit": {"oid": "0b78fd8c697f8a2e0f76650253d97b4d0731d8f1"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3309, "cost": 1, "resetAt": "2021-10-28T17:48:14Z"}}}