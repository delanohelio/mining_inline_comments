{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDAxMjA1NzU3", "number": 3283, "reviewThreads": {"totalCount": 14, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wOVQxNDowNDo0MVrODwa2kQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0xMVQxMzoxODowM1rODw8oVg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjUyMDk4MTkzOnYy", "diffSide": "RIGHT", "path": "docs/documentation/cn/sql-reference/sql-statements/Data Definition/ALTER DATABASE.md", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wOVQxNDowNDo0MVrOGDaN9g==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wOVQxNDowNDo0MVrOGDaN9g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNjIyODQ3MA==", "bodyText": "Plz indicate the default value of replica quota and data quota in the following \u8bf4\u660e section.", "url": "https://github.com/apache/incubator-doris/pull/3283#discussion_r406228470", "createdAt": "2020-04-09T14:04:41Z", "author": {"login": "morningman"}, "path": "docs/documentation/cn/sql-reference/sql-statements/Data Definition/ALTER DATABASE.md", "diffHunk": "@@ -27,6 +27,9 @@ under the License.\n         2) \u91cd\u547d\u540d\u6570\u636e\u5e93\n             ALTER DATABASE db_name RENAME new_db_name;\n             \n+        3) \u8bbe\u7f6e\u6570\u636e\u5e93\u7684\u526f\u672c\u6570\u91cf\u914d\u989d", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c6bbc5ddfd11dab91c8e731a71346413942fc20a"}, "originalPosition": 4}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjUyMTAwMjExOnYy", "diffSide": "RIGHT", "path": "fe/src/main/cup/sql_parser.cup", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wOVQxNDowOTowM1rOGDaakw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wOVQxNDowOTowM1rOGDaakw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNjIzMTY5OQ==", "bodyText": "This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters. Learn more about bidirectional Unicode characters\n\n\n  \n\n\n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                | KW_ALTER KW_DATABASE ident:dbName KW_SET KW_REPLICA KW_QUOTA quantity:quota_quantity\n          \n          \n            \n                | KW_ALTER KW_DATABASE ident:dbName KW_SET KW_REPLICA KW_QUOTA INTEGER_LITERAL: number\n          \n      \n    \n    \n  \n\nquantity is for quota like 1KB, 1MB, 1GB", "url": "https://github.com/apache/incubator-doris/pull/3283#discussion_r406231699", "createdAt": "2020-04-09T14:09:03Z", "author": {"login": "morningman"}, "path": "fe/src/main/cup/sql_parser.cup", "diffHunk": "@@ -711,8 +712,13 @@ alter_stmt ::=\n     :}\n     | KW_ALTER KW_DATABASE ident:dbName KW_SET KW_DATA KW_QUOTA quantity:quota_quantity\n     {:\n-        RESULT = new AlterDatabaseQuotaStmt(dbName, quota_quantity);\n+        RESULT = new AlterDatabaseQuotaStmt(dbName, QuotaType.DATA, quota_quantity);\n     :}\n+    | KW_ALTER KW_DATABASE ident:dbName KW_SET KW_REPLICA KW_QUOTA quantity:quota_quantity", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c6bbc5ddfd11dab91c8e731a71346413942fc20a"}, "originalPosition": 15}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjUyMTAwNzY3OnYy", "diffSide": "RIGHT", "path": "fe/src/main/java/org/apache/doris/analysis/ShowDataStmt.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wOVQxNDoxMDoyMlrOGDaeJw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wOVQxNDoxMDoyMlrOGDaeJw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNjIzMjYxNQ==", "bodyText": "Plz do not modify the origin column name \"Size\", it may cause some compatibility problem.", "url": "https://github.com/apache/incubator-doris/pull/3283#discussion_r406232615", "createdAt": "2020-04-09T14:10:22Z", "author": {"login": "morningman"}, "path": "fe/src/main/java/org/apache/doris/analysis/ShowDataStmt.java", "diffHunk": "@@ -52,14 +52,16 @@\n     private static final ShowResultSetMetaData SHOW_TABLE_DATA_META_DATA =\n             ShowResultSetMetaData.builder()\n                     .addColumn(new Column(\"TableName\", ScalarType.createVarchar(20)))\n-                    .addColumn(new Column(\"Size\", ScalarType.createVarchar(30)))\n+                    .addColumn(new Column(\"DataSize\", ScalarType.createVarchar(30)))", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c6bbc5ddfd11dab91c8e731a71346413942fc20a"}, "originalPosition": 5}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjUyMTAyOTA3OnYy", "diffSide": "RIGHT", "path": "fe/src/main/java/org/apache/doris/catalog/Catalog.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wOVQxNDoxNToyOVrOGDasHg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wOVQxNDoxNToyOVrOGDasHg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNjIzNjE5MA==", "bodyText": "This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters. Learn more about bidirectional Unicode characters\n\n\n  \n\n\n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                    long quota = (quotaType == QuotaType.DATA ? db.getDataQuota() : db.getReplicaQuota());\n          \n          \n            \n                    long quota = stmt.getQuota();", "url": "https://github.com/apache/incubator-doris/pull/3283#discussion_r406236190", "createdAt": "2020-04-09T14:15:29Z", "author": {"login": "morningman"}, "path": "fe/src/main/java/org/apache/doris/catalog/Catalog.java", "diffHunk": "@@ -2781,16 +2782,25 @@ public void alterDatabaseQuota(AlterDatabaseQuotaStmt stmt) throws DdlException\n             ErrorReport.reportDdlException(ErrorCode.ERR_BAD_DB_ERROR, dbName);\n         }\n \n-        db.setDataQuotaWithLock(stmt.getQuota());\n-\n-        DatabaseInfo dbInfo = new DatabaseInfo(dbName, \"\", db.getDataQuota());\n+        QuotaType quotaType = stmt.getQuotaType();\n+        if (quotaType == QuotaType.DATA) {\n+            db.setDataQuotaWithLock(stmt.getQuota());\n+        } else if (quotaType == QuotaType.REPLICA) {\n+            db.setReplicaQuotaWithLock(stmt.getQuota());\n+        }\n+        long quota = (quotaType == QuotaType.DATA ? db.getDataQuota() : db.getReplicaQuota());", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c6bbc5ddfd11dab91c8e731a71346413942fc20a"}, "originalPosition": 21}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjUyMTAzNDY0OnYy", "diffSide": "RIGHT", "path": "fe/src/main/java/org/apache/doris/catalog/Catalog.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wOVQxNDoxNjozM1rOGDavZw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0xMFQwNDozMjo1NVrOGDwwwA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNjIzNzAzMQ==", "bodyText": "How about change QuotaType.DATA to null? For better understanding?", "url": "https://github.com/apache/incubator-doris/pull/3283#discussion_r406237031", "createdAt": "2020-04-09T14:16:33Z", "author": {"login": "morningman"}, "path": "fe/src/main/java/org/apache/doris/catalog/Catalog.java", "diffHunk": "@@ -2835,7 +2845,7 @@ public void renameDatabase(AlterDatabaseRename stmt) throws DdlException {\n             fullNameToDb.remove(fullDbName);\n             fullNameToDb.put(newFullDbName, db);\n \n-            DatabaseInfo dbInfo = new DatabaseInfo(fullDbName, newFullDbName, -1L);\n+            DatabaseInfo dbInfo = new DatabaseInfo(fullDbName, newFullDbName, -1L, QuotaType.DATA);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c6bbc5ddfd11dab91c8e731a71346413942fc20a"}, "originalPosition": 44}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNjU5NzgyNA==", "bodyText": "@morningman null may cause NullPointerException, so I use QuotaType.NONE instead of null", "url": "https://github.com/apache/incubator-doris/pull/3283#discussion_r406597824", "createdAt": "2020-04-10T04:32:55Z", "author": {"login": "caiconghui"}, "path": "fe/src/main/java/org/apache/doris/catalog/Catalog.java", "diffHunk": "@@ -2835,7 +2845,7 @@ public void renameDatabase(AlterDatabaseRename stmt) throws DdlException {\n             fullNameToDb.remove(fullDbName);\n             fullNameToDb.put(newFullDbName, db);\n \n-            DatabaseInfo dbInfo = new DatabaseInfo(fullDbName, newFullDbName, -1L);\n+            DatabaseInfo dbInfo = new DatabaseInfo(fullDbName, newFullDbName, -1L, QuotaType.DATA);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNjIzNzAzMQ=="}, "originalCommit": {"oid": "c6bbc5ddfd11dab91c8e731a71346413942fc20a"}, "originalPosition": 44}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjUyMTA0MDc2OnYy", "diffSide": "RIGHT", "path": "fe/src/main/java/org/apache/doris/common/util/ParseUtil.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wOVQxNDoxNzo1NVrOGDazRA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wOVQxNDoxNzo1NVrOGDazRA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNjIzODAyMA==", "bodyText": "This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters. Learn more about bidirectional Unicode characters\n\n\n  \n\n\n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                    if (replicaVolumn < 0L) {\n          \n          \n            \n                    if (replicaVolumn <= 0L) {", "url": "https://github.com/apache/incubator-doris/pull/3283#discussion_r406238020", "createdAt": "2020-04-09T14:17:55Z", "author": {"login": "morningman"}, "path": "fe/src/main/java/org/apache/doris/common/util/ParseUtil.java", "diffHunk": "@@ -71,4 +71,17 @@ public static long analyzeDataVolumn(String dataVolumnStr) throws UserException\n         return dataVolumn;\n     }\n \n+    public static long analyzeReplicaVolumn(String replicaVolumnStr) throws AnalysisException {\n+        long replicaVolumn = 0;\n+        try {\n+            replicaVolumn = Long.parseLong(replicaVolumnStr);\n+        } catch (NumberFormatException nfe) {\n+            throw new AnalysisException(\"invalid data volumn:\" + replicaVolumnStr);\n+        }\n+        if (replicaVolumn < 0L) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c6bbc5ddfd11dab91c8e731a71346413942fc20a"}, "originalPosition": 11}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjUyMTA0NTIxOnYy", "diffSide": "RIGHT", "path": "fe/src/main/java/org/apache/doris/catalog/Database.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wOVQxNDoxODo1NlrOGDa2Dg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wOVQxNDoxODo1NlrOGDa2Dg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNjIzODczNA==", "bodyText": "Why not just using table.getReplicaCount()?", "url": "https://github.com/apache/incubator-doris/pull/3283#discussion_r406238734", "createdAt": "2020-04-09T14:18:56Z", "author": {"login": "morningman"}, "path": "fe/src/main/java/org/apache/doris/catalog/Database.java", "diffHunk": "@@ -232,7 +250,34 @@ public long getDataQuotaLeftWithLock() {\n         }\n     }\n \n-    public void checkQuota() throws DdlException {\n+\n+    public long getReplicaQuotaLeftWithLock() {\n+        long usedReplicaQuota = 0;\n+        readLock();\n+        try {\n+            for (Table table : this.idToTable.values()) {\n+                if (table.getType() != TableType.OLAP) {\n+                    continue;\n+                }\n+\n+                OlapTable olapTable = (OlapTable) table;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c6bbc5ddfd11dab91c8e731a71346413942fc20a"}, "originalPosition": 58}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjUyMTA1NDU4OnYy", "diffSide": "RIGHT", "path": "fe/src/main/java/org/apache/doris/catalog/Database.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wOVQxNDoyMToxNVrOGDa8Hw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wOVQxNDoyMToxNVrOGDa8Hw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNjI0MDI4Nw==", "bodyText": "This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters. Learn more about bidirectional Unicode characters\n\n\n  \n\n\n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                    }\n          \n          \n            \n                    } else {\n          \n          \n            \n                        this.replicaQuotaSize = FeConstants.default_db_replica_quota_size;\n          \n          \n            \n                    }", "url": "https://github.com/apache/incubator-doris/pull/3283#discussion_r406240287", "createdAt": "2020-04-09T14:21:15Z", "author": {"login": "morningman"}, "path": "fe/src/main/java/org/apache/doris/catalog/Database.java", "diffHunk": "@@ -450,6 +513,10 @@ public void readFields(DataInput in) throws IOException {\n                 name2Function.put(name, builder.build());\n             }\n         }\n+\n+        if (Catalog.getCurrentCatalogJournalVersion() >= FeMetaVersion.VERSION_80) {\n+            replicaQuotaSize = in.readLong();\n+        }", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c6bbc5ddfd11dab91c8e731a71346413942fc20a"}, "originalPosition": 118}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjUyMTA2MDUzOnYy", "diffSide": "RIGHT", "path": "fe/src/main/java/org/apache/doris/common/proc/DbsProcDir.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wOVQxNDoyMjo0M1rOGDa_zw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wOVQxNDoyMjo0M1rOGDa_zw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNjI0MTIzMQ==", "bodyText": "Plz not modify the origin column name Quota, for compatibility.", "url": "https://github.com/apache/incubator-doris/pull/3283#discussion_r406241231", "createdAt": "2020-04-09T14:22:43Z", "author": {"login": "morningman"}, "path": "fe/src/main/java/org/apache/doris/common/proc/DbsProcDir.java", "diffHunk": "@@ -39,7 +39,7 @@\n  */\n public class DbsProcDir implements ProcDirInterface {\n     public static final ImmutableList<String> TITLE_NAMES = new ImmutableList.Builder<String>()\n-            .add(\"DbId\").add(\"DbName\").add(\"TableNum\").add(\"Quota\")\n+            .add(\"DbId\").add(\"DbName\").add(\"TableNum\").add(\"DataQuota\").add(\"ReplicaQuota\")", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c6bbc5ddfd11dab91c8e731a71346413942fc20a"}, "originalPosition": 5}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjUyMTA2NDUyOnYy", "diffSide": "RIGHT", "path": "fe/src/main/java/org/apache/doris/common/proc/TablesProcDir.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wOVQxNDoyMzozNlrOGDbCTA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wOVQxNDoyMzozNlrOGDbCTA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNjI0MTg2OA==", "bodyText": "Add the new column at the end of columns, for compatibility", "url": "https://github.com/apache/incubator-doris/pull/3283#discussion_r406241868", "createdAt": "2020-04-09T14:23:36Z", "author": {"login": "morningman"}, "path": "fe/src/main/java/org/apache/doris/common/proc/TablesProcDir.java", "diffHunk": "@@ -43,7 +43,7 @@\n public class TablesProcDir implements ProcDirInterface {\n     public static final ImmutableList<String> TITLE_NAMES = new ImmutableList.Builder<String>()\n             .add(\"TableId\").add(\"TableName\").add(\"IndexNum\").add(\"PartitionColumnName\")\n-            .add(\"PartitionNum\").add(\"State\").add(\"Type\").add(\"LastConsistencyCheckTime\")\n+            .add(\"PartitionNum\").add(\"ReplicaCount\").add(\"State\").add(\"Type\").add(\"LastConsistencyCheckTime\")", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c6bbc5ddfd11dab91c8e731a71346413942fc20a"}, "originalPosition": 5}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjUyMTA2OTUyOnYy", "diffSide": "RIGHT", "path": "fe/src/main/java/org/apache/doris/persist/DatabaseInfo.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wOVQxNDoyNDo0MlrOGDbFcg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wOVQxNDoyNDo0MlrOGDbFcg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNjI0MjY3NA==", "bodyText": "remove the unused set method.", "url": "https://github.com/apache/incubator-doris/pull/3283#discussion_r406242674", "createdAt": "2020-04-09T14:24:42Z", "author": {"login": "morningman"}, "path": "fe/src/main/java/org/apache/doris/persist/DatabaseInfo.java", "diffHunk": "@@ -107,4 +115,12 @@ public void setDbState(DbState dbState) {\n         this.dbState = dbState;\n     }\n \n+    public QuotaType getQuotaType() {\n+        return quotaType;\n+    }\n+\n+    public void setQuotaType(QuotaType quotaType) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c6bbc5ddfd11dab91c8e731a71346413942fc20a"}, "originalPosition": 60}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjUyMzc2NDQxOnYy", "diffSide": "RIGHT", "path": "fe/src/main/java/org/apache/doris/common/FeConstants.java", "isResolved": false, "comments": {"totalCount": 5, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0xMFQwODozMDoxNVrOGD0mIA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0xMFQwOToxMTo0NlrOGD1gKg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNjY2MDY0MA==", "bodyText": "The 1000000 is too small.  In meituan.com, the replica number for one database has exceeded 1000000. I think your initial value 1024 * 1024 * 1024 is OK.", "url": "https://github.com/apache/incubator-doris/pull/3283#discussion_r406660640", "createdAt": "2020-04-10T08:30:15Z", "author": {"login": "kangkaisen"}, "path": "fe/src/main/java/org/apache/doris/common/FeConstants.java", "diffHunk": "@@ -31,6 +31,7 @@\n     public static int shortkey_max_column_count = 3;\n     public static int shortkey_maxsize_bytes = 36;\n     public static long default_db_data_quota_bytes = 1024 * 1024 * 1024 * 1024L; // 1TB\n+    public static long default_db_replica_quota_size = 1000000;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f211d2a2ea0e6b939ff044f76e25c11e3ab4aa6d"}, "originalPosition": 4}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNjY2MTkyNA==", "bodyText": "Why not set -1 as default value, which means no limit?\nOtherwise I'm afraid some cluster can't create table after cluster upgrade.", "url": "https://github.com/apache/incubator-doris/pull/3283#discussion_r406661924", "createdAt": "2020-04-10T08:34:00Z", "author": {"login": "imay"}, "path": "fe/src/main/java/org/apache/doris/common/FeConstants.java", "diffHunk": "@@ -31,6 +31,7 @@\n     public static int shortkey_max_column_count = 3;\n     public static int shortkey_maxsize_bytes = 36;\n     public static long default_db_data_quota_bytes = 1024 * 1024 * 1024 * 1024L; // 1TB\n+    public static long default_db_replica_quota_size = 1000000;", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNjY2MDY0MA=="}, "originalCommit": {"oid": "f211d2a2ea0e6b939ff044f76e25c11e3ab4aa6d"}, "originalPosition": 4}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNjY2NjM4Ng==", "bodyText": "OK. I will change it to original default value", "url": "https://github.com/apache/incubator-doris/pull/3283#discussion_r406666386", "createdAt": "2020-04-10T08:46:43Z", "author": {"login": "caiconghui"}, "path": "fe/src/main/java/org/apache/doris/common/FeConstants.java", "diffHunk": "@@ -31,6 +31,7 @@\n     public static int shortkey_max_column_count = 3;\n     public static int shortkey_maxsize_bytes = 36;\n     public static long default_db_data_quota_bytes = 1024 * 1024 * 1024 * 1024L; // 1TB\n+    public static long default_db_replica_quota_size = 1000000;", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNjY2MDY0MA=="}, "originalCommit": {"oid": "f211d2a2ea0e6b939ff044f76e25c11e3ab4aa6d"}, "originalPosition": 4}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNjY3MDYxMA==", "bodyText": "@imay 1024 * 1024 * 1024 is a large value and enough, if one table has 100000 tablets , about 10000 tables can exits in on db?", "url": "https://github.com/apache/incubator-doris/pull/3283#discussion_r406670610", "createdAt": "2020-04-10T08:58:52Z", "author": {"login": "caiconghui"}, "path": "fe/src/main/java/org/apache/doris/common/FeConstants.java", "diffHunk": "@@ -31,6 +31,7 @@\n     public static int shortkey_max_column_count = 3;\n     public static int shortkey_maxsize_bytes = 36;\n     public static long default_db_data_quota_bytes = 1024 * 1024 * 1024 * 1024L; // 1TB\n+    public static long default_db_replica_quota_size = 1000000;", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNjY2MDY0MA=="}, "originalCommit": {"oid": "f211d2a2ea0e6b939ff044f76e25c11e3ab4aa6d"}, "originalPosition": 4}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNjY3NTQ5OA==", "bodyText": "in my point of view, quota is a necessary limit for resource usage, the resource is limited, replica quota should like data quota, not set to be -1 @imay", "url": "https://github.com/apache/incubator-doris/pull/3283#discussion_r406675498", "createdAt": "2020-04-10T09:11:46Z", "author": {"login": "caiconghui"}, "path": "fe/src/main/java/org/apache/doris/common/FeConstants.java", "diffHunk": "@@ -31,6 +31,7 @@\n     public static int shortkey_max_column_count = 3;\n     public static int shortkey_maxsize_bytes = 36;\n     public static long default_db_data_quota_bytes = 1024 * 1024 * 1024 * 1024L; // 1TB\n+    public static long default_db_replica_quota_size = 1000000;", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNjY2MDY0MA=="}, "originalCommit": {"oid": "f211d2a2ea0e6b939ff044f76e25c11e3ab4aa6d"}, "originalPosition": 4}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjUyMzc4ODAxOnYy", "diffSide": "RIGHT", "path": "fe/src/main/java/org/apache/doris/catalog/Database.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0xMFQwODo0MDo1M1rOGD00gA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0xMFQwODo0NjoxOVrOGD08Dg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNjY2NDMyMA==", "bodyText": "Why not enlarge the meta version?", "url": "https://github.com/apache/incubator-doris/pull/3283#discussion_r406664320", "createdAt": "2020-04-10T08:40:53Z", "author": {"login": "kangkaisen"}, "path": "fe/src/main/java/org/apache/doris/catalog/Database.java", "diffHunk": "@@ -450,6 +488,12 @@ public void readFields(DataInput in) throws IOException {\n                 name2Function.put(name, builder.build());\n             }\n         }\n+\n+        if (Catalog.getCurrentCatalogJournalVersion() >= FeMetaVersion.VERSION_80) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f211d2a2ea0e6b939ff044f76e25c11e3ab4aa6d"}, "originalPosition": 147}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNjY2NjI1NA==", "bodyText": "ok, it is a bug", "url": "https://github.com/apache/incubator-doris/pull/3283#discussion_r406666254", "createdAt": "2020-04-10T08:46:19Z", "author": {"login": "caiconghui"}, "path": "fe/src/main/java/org/apache/doris/catalog/Database.java", "diffHunk": "@@ -450,6 +488,12 @@ public void readFields(DataInput in) throws IOException {\n                 name2Function.put(name, builder.build());\n             }\n         }\n+\n+        if (Catalog.getCurrentCatalogJournalVersion() >= FeMetaVersion.VERSION_80) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNjY2NDMyMA=="}, "originalCommit": {"oid": "f211d2a2ea0e6b939ff044f76e25c11e3ab4aa6d"}, "originalPosition": 147}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjUyNjUxNjA2OnYy", "diffSide": "RIGHT", "path": "fe/src/main/cup/sql_parser.cup", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0xMVQxMzoxODowM1rOGENKEA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0xMVQxMzoxODowM1rOGENKEA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNzA2MzA1Ng==", "bodyText": "This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters. Learn more about bidirectional Unicode characters\n\n\n  \n\n\n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                | KW_ALTER KW_DATABASE ident:dbName KW_SET KW_REPLICA KW_QUOTA INTEGER_LITERAL: number\n          \n          \n            \n                | KW_ALTER KW_DATABASE ident:dbName KW_SET KW_REPLICA KW_QUOTA INTEGER_LITERAL:number", "url": "https://github.com/apache/incubator-doris/pull/3283#discussion_r407063056", "createdAt": "2020-04-11T13:18:03Z", "author": {"login": "morningman"}, "path": "fe/src/main/cup/sql_parser.cup", "diffHunk": "@@ -714,9 +714,9 @@ alter_stmt ::=\n     {:\n         RESULT = new AlterDatabaseQuotaStmt(dbName, QuotaType.DATA, quota_quantity);\n     :}\n-    | KW_ALTER KW_DATABASE ident:dbName KW_SET KW_REPLICA KW_QUOTA quantity:quota_quantity\n+    | KW_ALTER KW_DATABASE ident:dbName KW_SET KW_REPLICA KW_QUOTA INTEGER_LITERAL: number", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b8337ee3d0ebb16c89e7c5524f641ef9b66a7110"}, "originalPosition": 5}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1889, "cost": 1, "resetAt": "2021-11-12T09:44:50Z"}}}