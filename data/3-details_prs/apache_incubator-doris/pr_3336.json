{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDA0MjMxMjI2", "number": 3336, "title": "fix cooldown timestamp bug", "bodyText": "when add a parition with storage_cooldown_time property like this:\nalter table tablexxx ADD PARTITION p20200421 VALUES LESS THAN(\"1588262400\") (\"storage_medium\" = \"SSD\", \"storage_cooldown_time\" = \"2020-05-01 00:00:00\");\nand show partitions from tablexxx;\nthe CooldownTime is wrong: 2610-02-17 10:16:40, and what is more, the storage migration is based on the wrong timestamp.\nThe reason is that the result of DateLiteral.getLongValue is not timestamp.", "createdAt": "2020-04-16T09:28:40Z", "url": "https://github.com/apache/incubator-doris/pull/3336", "merged": true, "mergeCommit": {"oid": "77a7037346e7dfa3c962b7a4e7c4d4e227f380ac"}, "closed": true, "closedAt": "2020-04-18T14:47:23Z", "author": {"login": "kangpinghuang"}, "timelineItems": {"totalCount": 5, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcYMz7tgFqTM5NDYzODMyNA==", "endCursor": "Y3Vyc29yOnYyOpPPAAABcY3BtxgFqTM5NTkyMDAyNg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzk0NjM4MzI0", "url": "https://github.com/apache/incubator-doris/pull/3336#pullrequestreview-394638324", "createdAt": "2020-04-16T13:35:50Z", "commit": {"oid": "39434ff3e4a8026e90e223fcf100c5984d7ae9e2"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0xNlQxMzozNTo1MFrOGGll1A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0xNlQxMzozNTo1MFrOGGll1A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwOTU2MDUzMg==", "bodyText": "Please add a UT for this bug", "url": "https://github.com/apache/incubator-doris/pull/3336#discussion_r409560532", "createdAt": "2020-04-16T13:35:50Z", "author": {"login": "kangkaisen"}, "path": "fe/src/main/java/org/apache/doris/common/util/PropertyAnalyzer.java", "diffHunk": "@@ -110,7 +110,7 @@ public static DataProperty analyzeDataProperty(Map<String, String> properties, D\n             } else if (!hasCooldown && key.equalsIgnoreCase(PROPERTIES_STORAGE_COLDOWN_TIME)) {\n                 hasCooldown = true;\n                 DateLiteral dateLiteral = new DateLiteral(value, Type.DATETIME);\n-                coolDownTimeStamp = dateLiteral.getLongValue();\n+                coolDownTimeStamp = dateLiteral.unixTimestamp(TimeUtils.getTimeZone());", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "39434ff3e4a8026e90e223fcf100c5984d7ae9e2"}, "originalPosition": 5}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f5dd6e90cbfdbd6e0475a35f536c78628d4ac148", "author": {"user": {"login": "kangpinghuang", "name": null}}, "url": "https://github.com/apache/incubator-doris/commit/f5dd6e90cbfdbd6e0475a35f536c78628d4ac148", "committedDate": "2020-04-17T11:40:42Z", "message": "fix cooldown timestamp bug\n\nwhen add a parition with storage_cooldown_time property like this:\nalter table tablexxx ADD PARTITION p20200421 VALUES LESS THAN(\"1588262400\") (\"storage_medium\" = \"SSD\", \"storage_cooldown_time\" = \"2020-05-01 00:00:00\");\nand show partitions from tablexxx;\nthe CooldownTime is wrong: 2610-02-17 10:16:40, and what is more, the storage migration is based on the wrong timestamp.\nThe reason is that the result of DateLiteral.getLongValue is not timestamp."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "3672a23425043b4902e971ead4e476134dd56e66", "author": {"user": {"login": "kangpinghuang", "name": null}}, "url": "https://github.com/apache/incubator-doris/commit/3672a23425043b4902e971ead4e476134dd56e66", "committedDate": "2020-04-17T11:52:52Z", "message": "add unit test for cool down time"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "39434ff3e4a8026e90e223fcf100c5984d7ae9e2", "author": {"user": {"login": "kangpinghuang", "name": null}}, "url": "https://github.com/apache/incubator-doris/commit/39434ff3e4a8026e90e223fcf100c5984d7ae9e2", "committedDate": "2020-04-16T09:26:52Z", "message": "fix cooldown timestamp bug\n\nwhen add a parition with storage_cooldown_time property like this:\nalter table tablexxx ADD PARTITION p20200421 VALUES LESS THAN(\"1588262400\") (\"storage_medium\" = \"SSD\", \"storage_cooldown_time\" = \"2020-05-01 00:00:00\");\nand show partitions from tablexxx;\nthe CooldownTime is wrong: 2610-02-17 10:16:40, and what is more, the storage migration is based on the wrong timestamp.\nThe reason is that the result of DateLiteral.getLongValue is not timestamp."}, "afterCommit": {"oid": "3672a23425043b4902e971ead4e476134dd56e66", "author": {"user": {"login": "kangpinghuang", "name": null}}, "url": "https://github.com/apache/incubator-doris/commit/3672a23425043b4902e971ead4e476134dd56e66", "committedDate": "2020-04-17T11:52:52Z", "message": "add unit test for cool down time"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzk1OTIwMDI2", "url": "https://github.com/apache/incubator-doris/pull/3336#pullrequestreview-395920026", "createdAt": "2020-04-18T14:46:55Z", "commit": {"oid": "3672a23425043b4902e971ead4e476134dd56e66"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3252, "cost": 1, "resetAt": "2021-10-28T17:48:14Z"}}}