{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDQxNzk3MjQx", "number": 3985, "reviewThreads": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0zMFQwNjowMzoxNlrOEJ8Ypw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0zMFQwNjowMzoxNlrOEJ8Ypw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjc4ODYxOTkxOnYy", "diffSide": "RIGHT", "path": "be/src/exec/es/es_predicate.cpp", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0zMFQwNjowMzoxNlrOGqs8Vw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0zMFQwNjowMzoxNlrOGqs8Vw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NzQyOTcxOQ==", "bodyText": "\u5224\u65ad\u4e0b conjunt->children_size()?\n\u6211\u770b\u540e\u9762\u5f88\u591a\u76f4\u63a5\u53d6index\u7684\u3002", "url": "https://github.com/apache/incubator-doris/pull/3985#discussion_r447429719", "createdAt": "2020-06-30T06:03:16Z", "author": {"login": "blackfox1983"}, "path": "be/src/exec/es/es_predicate.cpp", "diffHunk": "@@ -283,93 +283,91 @@ Status EsPredicate::build_disjuncts_list(const Expr* conjunct) {\n         _disjuncts.push_back(predicate);\n         return Status::OK();\n     }\n-    \n-    if (is_match_func(conjunct)) {\n-        Expr* expr = conjunct->get_child(1);\n-        ExtLiteral literal(expr->type().type, _context->get_value(expr, NULL));\n-        vector<ExtLiteral> query_conditions;\n-        query_conditions.emplace_back(literal);\n-        vector<ExtColumnDesc> cols; //TODO\n-        ExtPredicate* predicate = new ExtFunction(\n-                        TExprNodeType::FUNCTION_CALL,\n-                        conjunct->fn().name.function_name,\n-                        cols,\n-                        query_conditions);\n-        if (_es_query_status.ok()) {\n-            _es_query_status \n-                = BooleanQueryBuilder::check_es_query(*(ExtFunction *)predicate); \n-            if (!_es_query_status.ok()) {\n-                delete predicate;\n-                return _es_query_status;\n-            }\n-        }\n-        _disjuncts.push_back(predicate);\n-\n-        return Status::OK();\n-    }\n-\n-    if (TExprNodeType::FUNCTION_CALL == conjunct->node_type()\n-        && (conjunct->fn().name.function_name == \"is_null_pred\" || conjunct->fn().name.function_name == \"is_not_null_pred\")) {\n-        // such as sub-query: select * from (select split_part(k, \"_\", 1) as new_field from case_replay_for_milimin) t where t.new_field > 1;\n-        // conjunct->get_child(0)->node_type() == TExprNodeType::FUNCTION_CALL, at present doris on es can not support push down function \n-        RETURN_ERROR_IF_EXPR_IS_NOT_SLOTREF(conjunct->get_child(0));\n-        SlotRef* slot_ref = (SlotRef*)(conjunct->get_child(0));\n-        const SlotDescriptor* slot_desc = get_slot_desc(slot_ref);\n-        bool is_not_null;\n-        if (conjunct->fn().name.function_name == \"is_null_pred\") {\n-            is_not_null = false;\n-        } else {\n-            is_not_null = true;\n-        }\n-        std::string col = slot_desc->col_name();\n-        if (_field_context.find(col) != _field_context.end()) {\n-            col = _field_context[col];\n-        }\n-        // use TExprNodeType::IS_NULL_PRED for BooleanQueryBuilder translate\n-        ExtIsNullPredicate* predicate = new ExtIsNullPredicate(TExprNodeType::IS_NULL_PRED, col, slot_desc->type(), is_not_null);\n-        _disjuncts.push_back(predicate);\n-        return Status::OK();\n-    }\n-\n+    // process function call predicate: esquery, is_null_pred, is_not_null_pred\n     if (TExprNodeType::FUNCTION_CALL == conjunct->node_type()) {\n         std::string fname = conjunct->fn().name.function_name;\n-        if (fname != \"like\") {\n-            return Status::InternalError(\"build disjuncts failed: function name is not like\");\n-        }\n+        if (fname == \"esquery\") {\n+            Expr* expr = conjunct->get_child(1);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "e54f060cfbb609f251ddb21fcf8cffeb5672bef0"}, "originalPosition": 81}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1336, "cost": 1, "resetAt": "2021-11-12T09:44:50Z"}}}