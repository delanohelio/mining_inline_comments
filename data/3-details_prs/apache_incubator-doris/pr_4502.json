{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDc3MDY1NTE3", "number": 4502, "title": "[SQL] Support where, limit, order clause in show resourcestmt.", "bodyText": "Grammar\nSHOW RESOURCES\n[\n    WHERE\n    [NAME [ = \"your_resource_name\" | LIKE \"name_matcher\"]]\n    [RESOURCETYPE = [\"SPARK\"]]\n]\n[ORDER BY ...]\n[LIMIT limit][OFFSET offset];\n\nFix #4501\nTypes of changes\nWhat types of changes does your code introduce to Doris?\nPut an x in the boxes that apply\n\n[] Bugfix (non-breaking change which fixes an issue)\n New feature (non-breaking change which adds functionality)\n[] Breaking change (fix or feature that would cause existing functionality to not work as expected)\n[] Documentation Update (if none of the other choices apply)\n[] Code refactor (Modify the code structure, format the code, etc...)\n\nChecklist\nPut an x in the boxes that apply. You can also fill these out after creating the PR. If you're unsure about any of them, don't hesitate to ask. We're here to help! This is simply a reminder of what we are going to look for before merging your code.\n\n I have create an issue on (Fix #ISSUE), and have described the bug/feature there in detail\n Compiling and unit tests pass locally with my changes\n I have added tests that prove my fix is effective or that my feature works\n If this change need a document change, I have updated the document\n Any dependent changes have been merged", "createdAt": "2020-09-01T13:01:46Z", "url": "https://github.com/apache/incubator-doris/pull/4502", "merged": true, "mergeCommit": {"oid": "a1f52ec2abbf7b0d5cdc242c7312173934c2265e"}, "closed": true, "closedAt": "2020-09-16T09:57:49Z", "author": {"login": "HappenLee"}, "timelineItems": {"totalCount": 11, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdEm_HkAH2gAyNDc3MDY1NTE3Ojk1NTIzMjk5NzE1OWU0YTA4OWM2Mzc2YTM1NGE4MGUxNTNjNjNkMjk=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdI0p8_gFqTQ4Nzg3MjQwMg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "955232997159e4a089c6376a354a80e153c63d29", "author": {"user": {"login": "HappenLee", "name": "HappenLee"}}, "url": "https://github.com/apache/incubator-doris/commit/955232997159e4a089c6376a354a80e153c63d29", "committedDate": "2020-09-01T12:58:16Z", "message": "[SQL] Support where, limit, order clause in show resourcestmt.\n\nGrammar\n\n    SHOW RESOURCES\n    [\n        WHERE\n        [NAME [ = \"your_resource_name\" | LIKE \"name_matcher\"]]\n        [RESOURCETYPE = [\"SPARK\"]]\n    ]\n    [ORDER BY ...]\n    [LIMIT limit][OFFSET offset];\n\nissue #4501"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "39dd11b8ebef521a42274087a93dab9a7b45208d", "author": {"user": {"login": "HappenLee", "name": "HappenLee"}}, "url": "https://github.com/apache/incubator-doris/commit/39dd11b8ebef521a42274087a93dab9a7b45208d", "committedDate": "2020-09-01T13:03:40Z", "message": "change log back"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDgwMzUzMzc1", "url": "https://github.com/apache/incubator-doris/pull/4502#pullrequestreview-480353375", "createdAt": "2020-09-02T02:15:20Z", "commit": {"oid": "39dd11b8ebef521a42274087a93dab9a7b45208d"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0wMlQwMjoxNToyMFrOHLP6nw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0wMlQwMjoxNToyMFrOHLP6nw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MTU1NzE1MQ==", "bodyText": "how many resource do we have\uff1f", "url": "https://github.com/apache/incubator-doris/pull/4502#discussion_r481557151", "createdAt": "2020-09-02T02:15:20Z", "author": {"login": "wutiangan"}, "path": "docs/zh-CN/sql-reference/sql-statements/Data Definition/SHOW RESOURCES.md", "diffHunk": "@@ -32,7 +32,33 @@ under the License.\n     \u8bed\u6cd5\n     \n         SHOW RESOURCES\n+        [\n+            WHERE \n+            [NAME [ = \"your_resource_name\" | LIKE \"name_matcher\"]]\n+            [RESOURCETYPE = [\"SPARK\"]]\n+        ]\n+        [ORDER BY ...]\n+        [LIMIT limit][OFFSET offset];\n+        \n+     \u8bf4\u660e\uff1a\n+        1) \u5982\u679c\u4f7f\u7528 NAME LIKE\uff0c\u5219\u4f1a\u5339\u914dRESOURCES\u7684Name\u5305\u542b name_matcher\u7684Resource\n+        2) \u5982\u679c\u4f7f\u7528 NAME = \uff0c\u5219\u7cbe\u786e\u5339\u914d\u6307\u5b9a\u7684 Name\n+        3) \u5982\u679c\u6307\u5b9a\u4e86RESOURCETYPE\uff0c\u5219\u5339\u914d\u5bf9\u5e94\u7684Resrouce\u7c7b\u578b", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "39dd11b8ebef521a42274087a93dab9a7b45208d"}, "originalPosition": 15}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDgwMzkxODU2", "url": "https://github.com/apache/incubator-doris/pull/4502#pullrequestreview-480391856", "createdAt": "2020-09-02T02:40:56Z", "commit": {"oid": "39dd11b8ebef521a42274087a93dab9a7b45208d"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0wMlQwMjo0MDo1NlrOHLQ64w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0wMlQwMjo0MDo1NlrOHLQ64w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MTU3MzYwMw==", "bodyText": "the ResourceType has two definations but has different meanings\uff1a\n1\u3001org.apache.doris.catalog.Resource.ResourceType\n2\u3001org.apache.doris.catalog.ResourceType\nshould be fix", "url": "https://github.com/apache/incubator-doris/pull/4502#discussion_r481573603", "createdAt": "2020-09-02T02:40:56Z", "author": {"login": "wutiangan"}, "path": "fe/fe-core/src/main/java/org/apache/doris/catalog/ResourceMgr.java", "diffHunk": "@@ -17,9 +17,11 @@\n \n package org.apache.doris.catalog;\n \n+import com.google.common.collect.Lists;\n import org.apache.doris.analysis.CreateResourceStmt;\n import org.apache.doris.analysis.DropResourceStmt;\n import org.apache.doris.catalog.Resource.ResourceType;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "39dd11b8ebef521a42274087a93dab9a7b45208d"}, "originalPosition": 7}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDgwMzk1Njg2", "url": "https://github.com/apache/incubator-doris/pull/4502#pullrequestreview-480395686", "createdAt": "2020-09-02T02:43:28Z", "commit": {"oid": "39dd11b8ebef521a42274087a93dab9a7b45208d"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0wMlQwMjo0MzoyOFrOHLRBBQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0wMlQwMjo0MzoyOFrOHLRBBQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MTU3NTE3Mw==", "bodyText": "equalsIgnore()", "url": "https://github.com/apache/incubator-doris/pull/4502#discussion_r481575173", "createdAt": "2020-09-02T02:43:28Z", "author": {"login": "wutiangan"}, "path": "fe/fe-core/src/main/java/org/apache/doris/catalog/ResourceMgr.java", "diffHunk": "@@ -109,8 +112,41 @@ public int getResourceNum() {\n         return nameToResource.size();\n     }\n \n-    public List<List<String>> getResourcesInfo() {\n-        return procNode.fetchResult().getRows();\n+    public List<List<Comparable>> getResourcesInfo(String name, boolean accurateMatch, Set<String> typeSets) {\n+        List<List<String>> targetRows = procNode.fetchResult().getRows();\n+        List<List<Comparable>> returnRows = Lists.newArrayList();\n+\n+        for (List<String> row : targetRows) {\n+            if (row == null || row.size() < 2) {\n+                continue;\n+            }\n+\n+            String resourceName = row.get(0);\n+            String resourceType = row.get(1);\n+\n+            if (name != null) {\n+                if (accurateMatch && !resourceName.equals(name)) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "39dd11b8ebef521a42274087a93dab9a7b45208d"}, "originalPosition": 57}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDgwMzk4NjY5", "url": "https://github.com/apache/incubator-doris/pull/4502#pullrequestreview-480398669", "createdAt": "2020-09-02T02:45:24Z", "commit": {"oid": "39dd11b8ebef521a42274087a93dab9a7b45208d"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0wMlQwMjo0NToyNFrOHLRGBQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0wMlQwMjo0NToyNFrOHLRGBQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MTU3NjQ1Mw==", "bodyText": "solt --> slot", "url": "https://github.com/apache/incubator-doris/pull/4502#discussion_r481576453", "createdAt": "2020-09-02T02:45:24Z", "author": {"login": "wutiangan"}, "path": "fe/fe-core/src/main/java/org/apache/doris/catalog/ResourceMgr.java", "diffHunk": "@@ -109,8 +112,41 @@ public int getResourceNum() {\n         return nameToResource.size();\n     }\n \n-    public List<List<String>> getResourcesInfo() {\n-        return procNode.fetchResult().getRows();\n+    public List<List<Comparable>> getResourcesInfo(String name, boolean accurateMatch, Set<String> typeSets) {\n+        List<List<String>> targetRows = procNode.fetchResult().getRows();\n+        List<List<Comparable>> returnRows = Lists.newArrayList();\n+\n+        for (List<String> row : targetRows) {\n+            if (row == null || row.size() < 2) {\n+                continue;\n+            }\n+\n+            String resourceName = row.get(0);\n+            String resourceType = row.get(1);\n+\n+            if (name != null) {\n+                if (accurateMatch && !resourceName.equals(name)) {\n+                    continue;\n+                }\n+                if (!accurateMatch && !resourceName.contains(name)) {\n+                    continue;\n+                }\n+            }\n+\n+            if (typeSets != null) {\n+                if (!typeSets.contains(resourceType.toUpperCase())) {\n+                    continue;\n+                }\n+            }\n+\n+            List<Comparable> comparableRow = Lists.newArrayList();\n+            for (Comparable solt : row) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "39dd11b8ebef521a42274087a93dab9a7b45208d"}, "originalPosition": 72}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "2e2ded6d8f276f437dfc28c79a7475f4508520fd", "author": {"user": {"login": "HappenLee", "name": "HappenLee"}}, "url": "https://github.com/apache/incubator-doris/commit/2e2ded6d8f276f437dfc28c79a7475f4508520fd", "committedDate": "2020-09-02T12:26:50Z", "message": "revise some code"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDgzMTA0NTI2", "url": "https://github.com/apache/incubator-doris/pull/4502#pullrequestreview-483104526", "createdAt": "2020-09-06T01:48:20Z", "commit": {"oid": "2e2ded6d8f276f437dfc28c79a7475f4508520fd"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0wNlQwMTo0ODoyMVrOHNljJg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0wNlQwMTo0ODoyMVrOHNljJg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NDAwODc0Mg==", "bodyText": "Better don't use 'key' annd 'value' because they are keywords in doris.\nFor example , show resources where name like \"test\" and resourcetype = \"spark\" order by KEY; will report an error", "url": "https://github.com/apache/incubator-doris/pull/4502#discussion_r484008742", "createdAt": "2020-09-06T01:48:21Z", "author": {"login": "xy720"}, "path": "fe/fe-core/src/main/java/org/apache/doris/catalog/ResourceMgr.java", "diffHunk": "@@ -52,7 +55,7 @@\n     private static final Logger LOG = LogManager.getLogger(ResourceMgr.class);\n \n     public static final ImmutableList<String> RESOURCE_PROC_NODE_TITLE_NAMES = new ImmutableList.Builder<String>()\n-            .add(\"Name\").add(\"ResourceType\").add(\"Key\").add(\"Value\")", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "2e2ded6d8f276f437dfc28c79a7475f4508520fd"}, "originalPosition": 24}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDg3MzA0Mzgy", "url": "https://github.com/apache/incubator-doris/pull/4502#pullrequestreview-487304382", "createdAt": "2020-09-13T12:50:50Z", "commit": {"oid": "2e2ded6d8f276f437dfc28c79a7475f4508520fd"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xM1QxMjo1MDo1MFrOHQ8OPQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xM1QxMjo1MDo1MFrOHQ8OPQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NzUyNTk0OQ==", "bodyText": "Why changing them to uppercase?\nAnd as @xy720 said, better not using KEY, I prefer Item.", "url": "https://github.com/apache/incubator-doris/pull/4502#discussion_r487525949", "createdAt": "2020-09-13T12:50:50Z", "author": {"login": "morningman"}, "path": "fe/fe-core/src/main/java/org/apache/doris/catalog/ResourceMgr.java", "diffHunk": "@@ -52,7 +55,7 @@\n     private static final Logger LOG = LogManager.getLogger(ResourceMgr.class);\n \n     public static final ImmutableList<String> RESOURCE_PROC_NODE_TITLE_NAMES = new ImmutableList.Builder<String>()\n-            .add(\"Name\").add(\"ResourceType\").add(\"Key\").add(\"Value\")\n+            .add(\"NAME\").add(\"RESOURCETYPE\").add(\"KEY\").add(\"VALUE\")", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "2e2ded6d8f276f437dfc28c79a7475f4508520fd"}, "originalPosition": 25}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "00420ce8e33841430e1b5b710f799567c65b635d", "author": {"user": {"login": "HappenLee", "name": "HappenLee"}}, "url": "https://github.com/apache/incubator-doris/commit/00420ce8e33841430e1b5b710f799567c65b635d", "committedDate": "2020-09-13T16:31:53Z", "message": "change resource title name"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDg3ODcyNDAy", "url": "https://github.com/apache/incubator-doris/pull/4502#pullrequestreview-487872402", "createdAt": "2020-09-14T15:09:31Z", "commit": {"oid": "00420ce8e33841430e1b5b710f799567c65b635d"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4909, "cost": 1, "resetAt": "2021-10-28T18:00:02Z"}}}