{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDQwODc4Njc0", "number": 3955, "reviewThreads": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wNFQwMDo1Mzo1OFrOELV_vw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xOVQxMjozNzoxOFrOEP2dKw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjgwMzMwMTc1OnYy", "diffSide": "RIGHT", "path": "fe/src/main/java/org/apache/doris/common/Config.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wNFQwMDo1Mzo1OFrOGs5CqA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wNFQwOToxMzo1N1rOGs66FA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0OTcyNTA5Ng==", "bodyText": "I think this can be set to true by default.", "url": "https://github.com/apache/incubator-doris/pull/3955#discussion_r449725096", "createdAt": "2020-07-04T00:53:58Z", "author": {"login": "morningman"}, "path": "fe/src/main/java/org/apache/doris/common/Config.java", "diffHunk": "@@ -873,6 +873,18 @@\n      */\n     @ConfField(mutable = true, masterOnly = true)\n     public static boolean disable_load_job = false;\n+\n+    /*\n+     * if this is set to true, all load job will check db data quota when call begin txn api\n+     */\n+    @ConfField(mutable = true, masterOnly = true)\n+    public static boolean enable_check_data_quota_on_load = false;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "21a49bb293503a3aeb83b0f6597ce9b5abccb766"}, "originalPosition": 9}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0OTc1NTY2OA==", "bodyText": "done", "url": "https://github.com/apache/incubator-doris/pull/3955#discussion_r449755668", "createdAt": "2020-07-04T09:13:57Z", "author": {"login": "caiconghui"}, "path": "fe/src/main/java/org/apache/doris/common/Config.java", "diffHunk": "@@ -873,6 +873,18 @@\n      */\n     @ConfField(mutable = true, masterOnly = true)\n     public static boolean disable_load_job = false;\n+\n+    /*\n+     * if this is set to true, all load job will check db data quota when call begin txn api\n+     */\n+    @ConfField(mutable = true, masterOnly = true)\n+    public static boolean enable_check_data_quota_on_load = false;", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0OTcyNTA5Ng=="}, "originalCommit": {"oid": "21a49bb293503a3aeb83b0f6597ce9b5abccb766"}, "originalPosition": 9}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjgwMzMwMjcxOnYy", "diffSide": "RIGHT", "path": "fe/src/main/java/org/apache/doris/transaction/DatabaseTransactionMgr.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wNFQwMDo1NTozN1rOGs5DGQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wNFQwOToxNDowOFrOGs66HA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0OTcyNTIwOQ==", "bodyText": "This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters. Learn more about bidirectional Unicode characters\n\n\n  \n\n\n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                       checkDatabaseDataQuota();\n          \n          \n            \n                        checkDatabaseDataQuota();", "url": "https://github.com/apache/incubator-doris/pull/3955#discussion_r449725209", "createdAt": "2020-07-04T00:55:37Z", "author": {"login": "morningman"}, "path": "fe/src/main/java/org/apache/doris/transaction/DatabaseTransactionMgr.java", "diffHunk": "@@ -246,6 +249,10 @@ private void getTxnStateInfo(TransactionState txnState, List<String> info) {\n     public long beginTransaction(List<Long> tableIdList, String label, TUniqueId requestId,\n                                  TransactionState.TxnCoordinator coordinator, TransactionState.LoadJobSourceType sourceType, long listenerId, long timeoutSecond)\n             throws DuplicatedRequestException, LabelAlreadyUsedException, BeginTransactionException, AnalysisException {\n+        if (Config.enable_check_data_quota_on_load) {\n+           checkDatabaseDataQuota();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "21a49bb293503a3aeb83b0f6597ce9b5abccb766"}, "originalPosition": 15}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0OTc1NTY3Ng==", "bodyText": "fix", "url": "https://github.com/apache/incubator-doris/pull/3955#discussion_r449755676", "createdAt": "2020-07-04T09:14:08Z", "author": {"login": "caiconghui"}, "path": "fe/src/main/java/org/apache/doris/transaction/DatabaseTransactionMgr.java", "diffHunk": "@@ -246,6 +249,10 @@ private void getTxnStateInfo(TransactionState txnState, List<String> info) {\n     public long beginTransaction(List<Long> tableIdList, String label, TUniqueId requestId,\n                                  TransactionState.TxnCoordinator coordinator, TransactionState.LoadJobSourceType sourceType, long listenerId, long timeoutSecond)\n             throws DuplicatedRequestException, LabelAlreadyUsedException, BeginTransactionException, AnalysisException {\n+        if (Config.enable_check_data_quota_on_load) {\n+           checkDatabaseDataQuota();", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0OTcyNTIwOQ=="}, "originalCommit": {"oid": "21a49bb293503a3aeb83b0f6597ce9b5abccb766"}, "originalPosition": 15}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjg1MDU2Mjk5OnYy", "diffSide": "RIGHT", "path": "docs/en/administrator-guide/config/fe_config.md", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xOVQxMjozNzoxOFrOGzvMJg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xOVQxNjoxNzo0NFrOGzwnFg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NjkwMzcxOA==", "bodyText": "I think check database quota can be checked upon every load. So we can check every time without this config.\nHow about data quota update frequency previously?  It's used by table report, It seems that we can continue to use it or not ?", "url": "https://github.com/apache/incubator-doris/pull/3955#discussion_r456903718", "createdAt": "2020-07-19T12:37:18Z", "author": {"login": "chaoyli"}, "path": "docs/en/administrator-guide/config/fe_config.md", "diffHunk": "@@ -261,6 +267,12 @@ This configuration can play a role in certain scenarios. Assume that the initial\n \n ### `enable_auth_check`\n \n+### `enable_check_data_quota_on_load`", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b34093a701533ead0b554e8ba5c36cb94693fa81"}, "originalPosition": 17}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NjkyNjk5OA==", "bodyText": "@chaoyli\n\nThe main consideration is to make the user's load task not fail if they don't want use this load quota limit, but now it seems a bug?\nTabletStatMgr will update replica rowcount and datasize every 5min now, but not compute data quota, data quota will be computed only when show data operation is executed or create table or alter table schema.", "url": "https://github.com/apache/incubator-doris/pull/3955#discussion_r456926998", "createdAt": "2020-07-19T16:17:44Z", "author": {"login": "caiconghui"}, "path": "docs/en/administrator-guide/config/fe_config.md", "diffHunk": "@@ -261,6 +267,12 @@ This configuration can play a role in certain scenarios. Assume that the initial\n \n ### `enable_auth_check`\n \n+### `enable_check_data_quota_on_load`", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NjkwMzcxOA=="}, "originalCommit": {"oid": "b34093a701533ead0b554e8ba5c36cb94693fa81"}, "originalPosition": 17}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1322, "cost": 1, "resetAt": "2021-11-12T09:44:50Z"}}}