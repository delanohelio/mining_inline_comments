{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDQwODc4Njc0", "number": 3955, "title": "Support checking database used data quota when data load job begin a new txn", "bodyText": "Now, we only check database used data quota when create or alter table, or in some old type load job, but not for routine load job and stream load job. This PR provide a uniform solution to check db used data quota when data load job begin a new txn.", "createdAt": "2020-06-27T07:55:29Z", "url": "https://github.com/apache/incubator-doris/pull/3955", "merged": true, "mergeCommit": {"oid": "4608f9786ebaf0ab10b1b415d6a0b919f7b130ee"}, "closed": true, "closedAt": "2020-07-24T02:03:43Z", "author": {"login": "caiconghui"}, "timelineItems": {"totalCount": 11, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcxdZY6gFqTQ0MjU3ODQ4Mw==", "endCursor": "Y3Vyc29yOnYyOpPPAAABc36L6EgFqTQ1NDU5OTMyOQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDQyNTc4NDgz", "url": "https://github.com/apache/incubator-doris/pull/3955#pullrequestreview-442578483", "createdAt": "2020-07-04T00:53:58Z", "commit": {"oid": "21a49bb293503a3aeb83b0f6597ce9b5abccb766"}, "state": "COMMENTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wNFQwMDo1Mzo1OFrOGs5CqA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wNFQwMDo1NTozN1rOGs5DGQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0OTcyNTA5Ng==", "bodyText": "I think this can be set to true by default.", "url": "https://github.com/apache/incubator-doris/pull/3955#discussion_r449725096", "createdAt": "2020-07-04T00:53:58Z", "author": {"login": "morningman"}, "path": "fe/src/main/java/org/apache/doris/common/Config.java", "diffHunk": "@@ -873,6 +873,18 @@\n      */\n     @ConfField(mutable = true, masterOnly = true)\n     public static boolean disable_load_job = false;\n+\n+    /*\n+     * if this is set to true, all load job will check db data quota when call begin txn api\n+     */\n+    @ConfField(mutable = true, masterOnly = true)\n+    public static boolean enable_check_data_quota_on_load = false;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "21a49bb293503a3aeb83b0f6597ce9b5abccb766"}, "originalPosition": 9}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0OTcyNTIwOQ==", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                       checkDatabaseDataQuota();\n          \n          \n            \n                        checkDatabaseDataQuota();", "url": "https://github.com/apache/incubator-doris/pull/3955#discussion_r449725209", "createdAt": "2020-07-04T00:55:37Z", "author": {"login": "morningman"}, "path": "fe/src/main/java/org/apache/doris/transaction/DatabaseTransactionMgr.java", "diffHunk": "@@ -246,6 +249,10 @@ private void getTxnStateInfo(TransactionState txnState, List<String> info) {\n     public long beginTransaction(List<Long> tableIdList, String label, TUniqueId requestId,\n                                  TransactionState.TxnCoordinator coordinator, TransactionState.LoadJobSourceType sourceType, long listenerId, long timeoutSecond)\n             throws DuplicatedRequestException, LabelAlreadyUsedException, BeginTransactionException, AnalysisException {\n+        if (Config.enable_check_data_quota_on_load) {\n+           checkDatabaseDataQuota();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "21a49bb293503a3aeb83b0f6597ce9b5abccb766"}, "originalPosition": 15}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDUxMTI3OTQw", "url": "https://github.com/apache/incubator-doris/pull/3955#pullrequestreview-451127940", "createdAt": "2020-07-19T12:37:17Z", "commit": {"oid": "b34093a701533ead0b554e8ba5c36cb94693fa81"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xOVQxMjozNzoxOFrOGzvMJg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xOVQxMjozNzoxOFrOGzvMJg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NjkwMzcxOA==", "bodyText": "I think check database quota can be checked upon every load. So we can check every time without this config.\nHow about data quota update frequency previously?  It's used by table report, It seems that we can continue to use it or not ?", "url": "https://github.com/apache/incubator-doris/pull/3955#discussion_r456903718", "createdAt": "2020-07-19T12:37:18Z", "author": {"login": "chaoyli"}, "path": "docs/en/administrator-guide/config/fe_config.md", "diffHunk": "@@ -261,6 +267,12 @@ This configuration can play a role in certain scenarios. Assume that the initial\n \n ### `enable_auth_check`\n \n+### `enable_check_data_quota_on_load`", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b34093a701533ead0b554e8ba5c36cb94693fa81"}, "originalPosition": 17}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDUzODA1Mzcx", "url": "https://github.com/apache/incubator-doris/pull/3955#pullrequestreview-453805371", "createdAt": "2020-07-23T02:38:12Z", "commit": {"oid": "83a53e5c383c15e9f7f0d24c331ad1c080df9b44"}, "state": "DISMISSED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "923b16566ea129734e44219f6ba3d78a53746987", "author": {"user": {"login": "caiconghui", "name": "caiconghui"}}, "url": "https://github.com/apache/incubator-doris/commit/923b16566ea129734e44219f6ba3d78a53746987", "committedDate": "2020-07-23T03:04:15Z", "message": "Support checking database used data quota when begin a new txn"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "fbb80222c437de337e5a16370d16987e11497b7c", "author": {"user": {"login": "caiconghui", "name": "caiconghui"}}, "url": "https://github.com/apache/incubator-doris/commit/fbb80222c437de337e5a16370d16987e11497b7c", "committedDate": "2020-07-23T03:04:15Z", "message": "Update doc content for enable_check_data_quota_on_load and db_used_data_quota_update_interval_secs config"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e25de031552089bd1d6b8f4b7fa700147469d03b", "author": {"user": {"login": "caiconghui", "name": "caiconghui"}}, "url": "https://github.com/apache/incubator-doris/commit/e25de031552089bd1d6b8f4b7fa700147469d03b", "committedDate": "2020-07-23T03:04:15Z", "message": "Add debug log for UpdateDbUsedDataQuotaDaemon"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ac2383f6828f479ccbf0944f54b78e150db7177f", "author": {"user": {"login": "caiconghui", "name": "caiconghui"}}, "url": "https://github.com/apache/incubator-doris/commit/ac2383f6828f479ccbf0944f54b78e150db7177f", "committedDate": "2020-07-23T03:04:15Z", "message": "fix by review"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "9af3c7fde26caa75dfdc005ae0dfdbc0e020a4cc", "author": {"user": null}, "url": "https://github.com/apache/incubator-doris/commit/9af3c7fde26caa75dfdc005ae0dfdbc0e020a4cc", "committedDate": "2020-07-23T03:04:15Z", "message": "remove enable_check_data_quota_on_load config"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "83a53e5c383c15e9f7f0d24c331ad1c080df9b44", "author": {"user": null}, "url": "https://github.com/apache/incubator-doris/commit/83a53e5c383c15e9f7f0d24c331ad1c080df9b44", "committedDate": "2020-07-20T03:22:39Z", "message": "remove enable_check_data_quota_on_load config"}, "afterCommit": {"oid": "9af3c7fde26caa75dfdc005ae0dfdbc0e020a4cc", "author": {"user": null}, "url": "https://github.com/apache/incubator-doris/commit/9af3c7fde26caa75dfdc005ae0dfdbc0e020a4cc", "committedDate": "2020-07-23T03:04:15Z", "message": "remove enable_check_data_quota_on_load config"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "2d6e17e3a9df680e71cbb1508eda75e416b4b1db", "author": {"user": null}, "url": "https://github.com/apache/incubator-doris/commit/2d6e17e3a9df680e71cbb1508eda75e416b4b1db", "committedDate": "2020-07-23T03:25:19Z", "message": "fix compile failed"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDU0NTk5MzI5", "url": "https://github.com/apache/incubator-doris/pull/3955#pullrequestreview-454599329", "createdAt": "2020-07-24T01:59:26Z", "commit": {"oid": "2d6e17e3a9df680e71cbb1508eda75e416b4b1db"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2205, "cost": 1, "resetAt": "2021-10-28T17:48:14Z"}}}