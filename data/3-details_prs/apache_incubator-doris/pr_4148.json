{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDU1MjA0MjEz", "number": 4148, "title": "[Bug][TabletRepair] Fix bug that too many replicas generated when decommission BE", "bodyText": "Proposed changes\nTry to select the BE with an existing replicas as the destination BE for\nREPLICA_RELOCATING clone task.\nFix #4147\nAlso add 2 new FE configs max_clone_task_timeout_sec and min_clone_task_timeout_sec\nTypes of changes\n\n Bugfix (non-breaking change which fixes an issue)\n\nChecklist\nPut an x in the boxes that apply. You can also fill these out after creating the PR. If you're unsure about any of them, don't hesitate to ask. We're here to help! This is simply a reminder of what we are going to look for before merging your code.\n\n I have create an issue on Doris's issues, and have described the bug/feature there in detail\n Compiling and unit tests pass locally with my changes\n If this change need a document change, I have updated the document\n Any dependent changes have been merged", "createdAt": "2020-07-22T15:49:08Z", "url": "https://github.com/apache/incubator-doris/pull/4148", "merged": true, "mergeCommit": {"oid": "8a169981cf4a30834db381c73f7a6cd1ce7398b3"}, "closed": true, "closedAt": "2020-07-30T01:46:34Z", "author": {"login": "morningman"}, "timelineItems": {"totalCount": 8, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABc3v4OWAFqTQ1NDE2MDI5Mg==", "endCursor": "Y3Vyc29yOnYyOpPPAAABc5ncEHgFqTQ1NzM0MTQ3NQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDU0MTYwMjky", "url": "https://github.com/apache/incubator-doris/pull/4148#pullrequestreview-454160292", "createdAt": "2020-07-23T13:58:52Z", "commit": {"oid": "58134bac1297d59001a7d29ac8133688d908d5bb"}, "state": "DISMISSED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "58134bac1297d59001a7d29ac8133688d908d5bb", "author": {"user": {"login": "morningman", "name": "Mingyu Chen"}}, "url": "https://github.com/apache/incubator-doris/commit/58134bac1297d59001a7d29ac8133688d908d5bb", "committedDate": "2020-07-22T15:35:25Z", "message": "[Bug][TabletRepair] Fix bug that too many replicas generated when decommission BE\n\nTry to select the BE with an existing replicas as the destination BE for\nREPLICA_RELOCATING clone task."}, "afterCommit": {"oid": "ee2ad8b7ec20eac5b7872555290708bf54c6667c", "author": {"user": {"login": "morningman", "name": "Mingyu Chen"}}, "url": "https://github.com/apache/incubator-doris/commit/ee2ad8b7ec20eac5b7872555290708bf54c6667c", "committedDate": "2020-07-23T14:15:12Z", "message": "[Bug][TabletRepair] Fix bug that too many replicas generated when decommission BE\n\nTry to select the BE with an existing replicas as the destination BE for\nREPLICA_RELOCATING clone task."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDU0NjAxMjgw", "url": "https://github.com/apache/incubator-doris/pull/4148#pullrequestreview-454601280", "createdAt": "2020-07-24T02:08:27Z", "commit": {"oid": "ee2ad8b7ec20eac5b7872555290708bf54c6667c"}, "state": "DISMISSED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "3fc294dbef8bce084552d12c6974d7525c529998", "author": {"user": {"login": "morningman", "name": "Mingyu Chen"}}, "url": "https://github.com/apache/incubator-doris/commit/3fc294dbef8bce084552d12c6974d7525c529998", "committedDate": "2020-07-29T08:38:00Z", "message": "[Bug][TabletRepair] Fix bug that too many replicas generated when decommission BE\n\nTry to select the BE with an existing replicas as the destination BE for\nREPLICA_RELOCATING clone task."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "2c8a3a064942d528f72eb20704de996c30f05842", "author": {"user": {"login": "morningman", "name": "Mingyu Chen"}}, "url": "https://github.com/apache/incubator-doris/commit/2c8a3a064942d528f72eb20704de996c30f05842", "committedDate": "2020-07-29T08:43:03Z", "message": "Release slot before schedule again"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "d6fd636f60a68c91f6a758b5fc55c3546963a957", "author": {"user": {"login": "morningman", "name": "Mingyu Chen"}}, "url": "https://github.com/apache/incubator-doris/commit/d6fd636f60a68c91f6a758b5fc55c3546963a957", "committedDate": "2020-07-27T01:31:02Z", "message": "Release slot before schedule again"}, "afterCommit": {"oid": "2c8a3a064942d528f72eb20704de996c30f05842", "author": {"user": {"login": "morningman", "name": "Mingyu Chen"}}, "url": "https://github.com/apache/incubator-doris/commit/2c8a3a064942d528f72eb20704de996c30f05842", "committedDate": "2020-07-29T08:43:03Z", "message": "Release slot before schedule again"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDU3MzE3NDMy", "url": "https://github.com/apache/incubator-doris/pull/4148#pullrequestreview-457317432", "createdAt": "2020-07-29T08:46:03Z", "commit": {"oid": "2c8a3a064942d528f72eb20704de996c30f05842"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yOVQwODo0NjowM1rOG4uv7A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yOVQwODo0NjowM1rOG4uv7A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MjEzOTM3Mg==", "bodyText": "For reviewer:\nIn the original design logic, when the status of a replica is bad, it cannot become not bad again.\nThis is a clerical error and will cause the admin set replica status function to fail.", "url": "https://github.com/apache/incubator-doris/pull/4148#discussion_r462139372", "createdAt": "2020-07-29T08:46:03Z", "author": {"login": "morningman"}, "path": "fe/fe-core/src/main/java/org/apache/doris/master/ReportHandler.java", "diffHunk": "@@ -481,7 +481,6 @@ private static void sync(Map<Long, TTablet> backendTablets, ListMultimap<Long, L\n                             // 1. PUSH finished in BE but failed or not yet report to FE\n                             // 2. repair for VERSION_INCOMPLETE finished in BE, but failed or not yet report to FE\n                             replica.updateVersionInfo(backendVersion, backendVersionHash, dataSize, rowCount);\n-                            replica.setBad(false);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "2c8a3a064942d528f72eb20704de996c30f05842"}, "originalPosition": 4}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDU3MzQxNDc1", "url": "https://github.com/apache/incubator-doris/pull/4148#pullrequestreview-457341475", "createdAt": "2020-07-29T09:16:43Z", "commit": {"oid": "2c8a3a064942d528f72eb20704de996c30f05842"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1999, "cost": 1, "resetAt": "2021-10-28T17:48:14Z"}}}