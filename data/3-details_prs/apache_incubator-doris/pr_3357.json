{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDA1OTc1Njg0", "number": 3357, "title": "disable some unsupported syntax", "bodyText": "#3373\ndisable some syntax when subquery is not in binary predicate in case when clause", "createdAt": "2020-04-20T10:31:54Z", "url": "https://github.com/apache/incubator-doris/pull/3357", "merged": true, "mergeCommit": {"oid": "0e66385235933efc1c09b21d64599eb3873c7f48"}, "closed": true, "closedAt": "2020-04-24T14:01:36Z", "author": {"login": "yangzhg"}, "timelineItems": {"totalCount": 10, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcZci5jgH2gAyNDA1OTc1Njg0OmRjYjVkNmRmZWUzOWJlOGI2NDNjODEzNzIxZTUyY2RjNzU5YTE3YWQ=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcasOXxAFqTM5OTY5NzU0Ng==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "dcb5d6dfee39be8b643c813721e52cdc759a17ad", "author": {"user": {"login": "yangzhg", "name": "Zhengguo Yang"}}, "url": "https://github.com/apache/incubator-doris/commit/dcb5d6dfee39be8b643c813721e52cdc759a17ad", "committedDate": "2020-04-20T10:29:39Z", "message": "disable some unsupported syntax"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzk4MjU0MjI1", "url": "https://github.com/apache/incubator-doris/pull/3357#pullrequestreview-398254225", "createdAt": "2020-04-22T14:32:54Z", "commit": {"oid": "dcb5d6dfee39be8b643c813721e52cdc759a17ad"}, "state": "COMMENTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yMlQxNDozMjo1NVrOGJ5t3Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yMlQxNDozNDoyMlrOGJ5yZQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMzAzNTk5Nw==", "bodyText": "caseExpr.getChild(childIdx++) here you got the when expr", "url": "https://github.com/apache/incubator-doris/pull/3357#discussion_r413035997", "createdAt": "2020-04-22T14:32:55Z", "author": {"login": "morningman"}, "path": "fe/src/main/java/org/apache/doris/analysis/SelectStmt.java", "diffHunk": "@@ -1362,9 +1362,24 @@ private void rewriteSelectList(ExprRewriter rewriter) throws AnalysisException {\n             if (!item.getExpr().contains(Predicates.instanceOf(Subquery.class))) {\n                 continue;\n             }\n+            CaseExpr caseExpr = (CaseExpr) item.getExpr();\n+\n+            int childIdx = 0;\n+            if (caseExpr.hasCaseExpr()\n+                    && caseExpr.getChild(childIdx++).contains(Predicates.instanceOf(Subquery.class))) {\n+                throw new AnalysisException(\"Only support subquery in binary predicate in case statement.\");\n+            }\n+            while (childIdx + 2 <= caseExpr.getChildren().size()) {\n+                Expr child = caseExpr.getChild(childIdx++);\n+                // case", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "dcb5d6dfee39be8b643c813721e52cdc759a17ad"}, "originalPosition": 13}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMzAzNzE1Nw==", "bodyText": "Here is to skip then expr, not when", "url": "https://github.com/apache/incubator-doris/pull/3357#discussion_r413037157", "createdAt": "2020-04-22T14:34:22Z", "author": {"login": "morningman"}, "path": "fe/src/main/java/org/apache/doris/analysis/SelectStmt.java", "diffHunk": "@@ -1362,9 +1362,24 @@ private void rewriteSelectList(ExprRewriter rewriter) throws AnalysisException {\n             if (!item.getExpr().contains(Predicates.instanceOf(Subquery.class))) {\n                 continue;\n             }\n+            CaseExpr caseExpr = (CaseExpr) item.getExpr();\n+\n+            int childIdx = 0;\n+            if (caseExpr.hasCaseExpr()\n+                    && caseExpr.getChild(childIdx++).contains(Predicates.instanceOf(Subquery.class))) {\n+                throw new AnalysisException(\"Only support subquery in binary predicate in case statement.\");\n+            }\n+            while (childIdx + 2 <= caseExpr.getChildren().size()) {\n+                Expr child = caseExpr.getChild(childIdx++);\n+                // case\n+                if (!(child instanceof BinaryPredicate) && child.contains(Predicates.instanceOf(Subquery.class))) {\n+                    throw new AnalysisException(\"Only support subquery in binary predicate in case statement.\");\n+                }\n+                // when", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "dcb5d6dfee39be8b643c813721e52cdc759a17ad"}, "originalPosition": 17}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "87577355a15c7001d7048cd4e96c4a9e50d7c83b", "author": {"user": {"login": "yangzhg", "name": "Zhengguo Yang"}}, "url": "https://github.com/apache/incubator-doris/commit/87577355a15c7001d7048cd4e96c4a9e50d7c83b", "committedDate": "2020-04-23T06:50:57Z", "message": "fix typo"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "07aef0dd660f116b5afe13d763a1658258a3afc7", "author": {"user": {"login": "yangzhg", "name": "Zhengguo Yang"}}, "url": "https://github.com/apache/incubator-doris/commit/07aef0dd660f116b5afe13d763a1658258a3afc7", "committedDate": "2020-04-23T08:57:08Z", "message": "xx"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "8eb374639c359398f59556f6afb38323045be40f", "author": {"user": {"login": "yangzhg", "name": "Zhengguo Yang"}}, "url": "https://github.com/apache/incubator-doris/commit/8eb374639c359398f59556f6afb38323045be40f", "committedDate": "2020-04-23T09:18:37Z", "message": "xx"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "337f8ee74849645c04c0a1fcaacae0dcbd164fbb", "author": {"user": {"login": "yangzhg", "name": "Zhengguo Yang"}}, "url": "https://github.com/apache/incubator-doris/commit/337f8ee74849645c04c0a1fcaacae0dcbd164fbb", "committedDate": "2020-04-23T11:34:15Z", "message": "xx"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e70decd43af666f0efc31e4c813b7c168ef10180", "author": {"user": {"login": "yangzhg", "name": "Zhengguo Yang"}}, "url": "https://github.com/apache/incubator-doris/commit/e70decd43af666f0efc31e4c813b7c168ef10180", "committedDate": "2020-04-24T03:10:24Z", "message": "remove change"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a852f13b49eabde07c2dde293c2ba662dab0b83c", "author": {"user": {"login": "yangzhg", "name": "Zhengguo Yang"}}, "url": "https://github.com/apache/incubator-doris/commit/a852f13b49eabde07c2dde293c2ba662dab0b83c", "committedDate": "2020-04-24T03:12:34Z", "message": "remove change"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "7005e612bc1189ce198e40de7d6a509886654385", "author": {"user": {"login": "yangzhg", "name": "Zhengguo Yang"}}, "url": "https://github.com/apache/incubator-doris/commit/7005e612bc1189ce198e40de7d6a509886654385", "committedDate": "2020-04-24T03:13:08Z", "message": "remove change"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzk5Njk3NTQ2", "url": "https://github.com/apache/incubator-doris/pull/3357#pullrequestreview-399697546", "createdAt": "2020-04-24T07:19:38Z", "commit": {"oid": "7005e612bc1189ce198e40de7d6a509886654385"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3271, "cost": 1, "resetAt": "2021-10-28T17:48:14Z"}}}