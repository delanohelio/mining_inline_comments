{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0MzU5MTk0Mzc0", "number": 2658, "title": "[AlphaRowset] set num_segments field in rowset meta if missing", "bodyText": "the num segments should be read from rowset meta pb.\nBut the previous code error caused this value not to be set in some cases.\nSo when init the rowset meta and find that the num_segments is 0(not set),\nwe will try to calculate the num segments from AlphaRowsetExtraMetaPB,\nand then set the num_segments field.\nThis should only happen in some rowsets converted from old version.\nand for all newly created rowsets, the num_segments field must be set.\nISSUE #2656", "createdAt": "2020-01-04T08:13:31Z", "url": "https://github.com/apache/incubator-doris/pull/2658", "merged": true, "mergeCommit": {"oid": "13e5fdd512c77d502e2585a7b684e8c7a7488e04"}, "closed": true, "closedAt": "2020-01-07T13:46:02Z", "author": {"login": "morningman"}, "timelineItems": {"totalCount": 19, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABb3CdRmgFqTMzODM1MjIxMQ==", "endCursor": "Y3Vyc29yOnYyOpPPAAABb4BArYAFqTMzOTI0Mjc2NQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzM4MzUyMjEx", "url": "https://github.com/apache/incubator-doris/pull/2658#pullrequestreview-338352211", "createdAt": "2020-01-04T12:52:33Z", "commit": {"oid": "bee2ebc69e9083c82e31c2124d9a4a52a3e5cdce"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0wNFQxMjo1MjozM1rOFaN1XQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0wNFQxMjo1MjozM1rOFaN1XQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2MzAzMzk0OQ==", "bodyText": "I think the cumulative rowsets will hit above if clause. So this comment is some misleading.", "url": "https://github.com/apache/incubator-doris/pull/2658#discussion_r363033949", "createdAt": "2020-01-04T12:52:33Z", "author": {"login": "imay"}, "path": "be/src/olap/rowset/rowset_meta.h", "diffHunk": "@@ -326,11 +326,12 @@ class RowsetMeta {\n     //    so the segments in it are non overlapping.\n     // 2. the segments_overlap() flag in rowset meta is set to NONOVERLAPPING, explicitly.\n     bool is_segments_overlapping() const {\n-        if (num_segments() == 0) {\n-            // specially for delete version\n+        if (end_version() > start_version() || segments_overlap() == NONOVERLAPPING) {\n             return false;\n         }\n-        if (end_version() > start_version() || segments_overlap() == NONOVERLAPPING) {\n+\n+        // some of cumulative rowsets may have no segments.(no data, or a delete version)", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "bee2ebc69e9083c82e31c2124d9a4a52a3e5cdce"}, "originalPosition": 11}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzM4NTIwNTg4", "url": "https://github.com/apache/incubator-doris/pull/2658#pullrequestreview-338520588", "createdAt": "2020-01-06T08:39:18Z", "commit": {"oid": "69ad890ea31879a26b3bc60352df490fdeb4a062"}, "state": "DISMISSED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "1a5dabae7cfb41f4cd294a17ebcfa59d3279e78f", "author": {"user": {"login": "morningman", "name": "Mingyu Chen"}}, "url": "https://github.com/apache/incubator-doris/commit/1a5dabae7cfb41f4cd294a17ebcfa59d3279e78f", "committedDate": "2020-01-06T09:01:04Z", "message": "first"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "861160d0cb0b88e6c3db18486848a31a5e9b0a07", "author": {"user": {"login": "morningman", "name": "Mingyu Chen"}}, "url": "https://github.com/apache/incubator-doris/commit/861160d0cb0b88e6c3db18486848a31a5e9b0a07", "committedDate": "2020-01-06T09:01:04Z", "message": "second"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "d14420c199c1a89dd92423647251edb7c8ee28d1", "author": {"user": {"login": "morningman", "name": "Mingyu Chen"}}, "url": "https://github.com/apache/incubator-doris/commit/d14420c199c1a89dd92423647251edb7c8ee28d1", "committedDate": "2020-01-06T09:01:04Z", "message": "third"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "7b6dfa1a1202aea54218181e6ffbb454c8dba4b3", "author": {"user": {"login": "morningman", "name": "Mingyu Chen"}}, "url": "https://github.com/apache/incubator-doris/commit/7b6dfa1a1202aea54218181e6ffbb454c8dba4b3", "committedDate": "2020-01-06T09:01:04Z", "message": "fix comment"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "3aac8a97ff879f31bda4ccd98ae8b316ab093a03", "author": {"user": {"login": "morningman", "name": "Mingyu Chen"}}, "url": "https://github.com/apache/incubator-doris/commit/3aac8a97ff879f31bda4ccd98ae8b316ab093a03", "committedDate": "2020-01-06T09:01:04Z", "message": "fix log"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f4c3bd87f354105447f878d4d7aa615e8b3d038d", "author": {"user": {"login": "morningman", "name": "Mingyu Chen"}}, "url": "https://github.com/apache/incubator-doris/commit/f4c3bd87f354105447f878d4d7aa615e8b3d038d", "committedDate": "2020-01-06T09:01:04Z", "message": "add log"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "d21c827409ed2e8ead5305b14cd1376d8a25070c", "author": {"user": {"login": "morningman", "name": "Mingyu Chen"}}, "url": "https://github.com/apache/incubator-doris/commit/d21c827409ed2e8ead5305b14cd1376d8a25070c", "committedDate": "2020-01-06T09:01:04Z", "message": "fix"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "69ad890ea31879a26b3bc60352df490fdeb4a062", "author": {"user": {"login": "morningman", "name": "Mingyu Chen"}}, "url": "https://github.com/apache/incubator-doris/commit/69ad890ea31879a26b3bc60352df490fdeb4a062", "committedDate": "2020-01-06T08:02:33Z", "message": "add log"}, "afterCommit": {"oid": "d21c827409ed2e8ead5305b14cd1376d8a25070c", "author": {"user": {"login": "morningman", "name": "Mingyu Chen"}}, "url": "https://github.com/apache/incubator-doris/commit/d21c827409ed2e8ead5305b14cd1376d8a25070c", "committedDate": "2020-01-06T09:01:04Z", "message": "fix"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "041d06601e283dbe0eba0569014b536abe2229c8", "author": {"user": {"login": "morningman", "name": "Mingyu Chen"}}, "url": "https://github.com/apache/incubator-doris/commit/041d06601e283dbe0eba0569014b536abe2229c8", "committedDate": "2020-01-06T11:23:17Z", "message": "fix num row bug"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "45ed0b8a58c12a33bc625ff3904f7150a6da51ad", "author": {"user": {"login": "morningman", "name": "Mingyu Chen"}}, "url": "https://github.com/apache/incubator-doris/commit/45ed0b8a58c12a33bc625ff3904f7150a6da51ad", "committedDate": "2020-01-06T12:04:50Z", "message": "check row nums"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzM4NjQzODE3", "url": "https://github.com/apache/incubator-doris/pull/2658#pullrequestreview-338643817", "createdAt": "2020-01-06T13:34:34Z", "commit": {"oid": "45ed0b8a58c12a33bc625ff3904f7150a6da51ad"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0wNlQxMzozNDozNFrOFadu-w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0wNlQxMzozNDozNFrOFadu-w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2MzI5NDQ1OQ==", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                const AlphaRowsetExtraMetaPB& alpha_rowset_extra_meta_pb() {\n          \n          \n            \n                const AlphaRowsetExtraMetaPB& alpha_rowset_extra_meta_pb() const {", "url": "https://github.com/apache/incubator-doris/pull/2658#discussion_r363294459", "createdAt": "2020-01-06T13:34:34Z", "author": {"login": "imay"}, "path": "be/src/olap/rowset/rowset_meta.h", "diffHunk": "@@ -350,6 +352,9 @@ class RowsetMeta {\n         return score;\n     }\n \n+    const AlphaRowsetExtraMetaPB& alpha_rowset_extra_meta_pb() {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "45ed0b8a58c12a33bc625ff3904f7150a6da51ad"}, "originalPosition": 32}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "abf82d767f25f6fb61d93845225d3c55f977617f", "author": {"user": {"login": "morningman", "name": "Mingyu Chen"}}, "url": "https://github.com/apache/incubator-doris/commit/abf82d767f25f6fb61d93845225d3c55f977617f", "committedDate": "2020-01-06T14:06:19Z", "message": "Update be/src/olap/rowset/rowset_meta.h\n\nCo-Authored-By: ZHAO Chun <buaa.zhaoc@gmail.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "3fc38d606d6c1652c53369c3c996cf77beffad40", "author": {"user": {"login": "morningman", "name": "Mingyu Chen"}}, "url": "https://github.com/apache/incubator-doris/commit/3fc38d606d6c1652c53369c3c996cf77beffad40", "committedDate": "2020-01-06T15:02:30Z", "message": "fix ut"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "71baa08ad9a919b109fdd508936bf829462bd680", "author": {"user": {"login": "morningman", "name": "Mingyu Chen"}}, "url": "https://github.com/apache/incubator-doris/commit/71baa08ad9a919b109fdd508936bf829462bd680", "committedDate": "2020-01-07T01:02:46Z", "message": "fix bug"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "210d80e41a7b1babf8042718ae12a38033833104", "author": {"user": {"login": "morningman", "name": "Mingyu Chen"}}, "url": "https://github.com/apache/incubator-doris/commit/210d80e41a7b1babf8042718ae12a38033833104", "committedDate": "2020-01-07T01:09:16Z", "message": "fix bug"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "3947d1c92125113cedc41ae54ecc566945a8e201", "author": {"user": {"login": "morningman", "name": "Mingyu Chen"}}, "url": "https://github.com/apache/incubator-doris/commit/3947d1c92125113cedc41ae54ecc566945a8e201", "committedDate": "2020-01-07T01:24:42Z", "message": "fix debug"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzM5MjQyNzY1", "url": "https://github.com/apache/incubator-doris/pull/2658#pullrequestreview-339242765", "createdAt": "2020-01-07T13:45:20Z", "commit": {"oid": "3947d1c92125113cedc41ae54ecc566945a8e201"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3859, "cost": 1, "resetAt": "2021-10-28T17:48:14Z"}}}