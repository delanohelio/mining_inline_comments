{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDE0MDI3MzQ4", "number": 3488, "title": "[Config] allow user to config BRPC socket_max_unwritten_bytes", "bodyText": "Fixes #3487\nWe have some queries failed with the following logs\nW0429 15:19:08.580521 38042 data_stream_sender.cpp:136] failed to send brpc batch, error=The server is overcrowded, error_text=[E1011]The server is overcrowded @xx.xx.xx.xx:8060 [R1][E1011]The server is overcrowded @10.16.212.49:8060 [R2][E1011]The server is overcrowded @xx.xx.xx.xx:8060 [R3][E1011]The server is overcrowded @xx.xx.xx.xx:8060\n\nThe reason is that the query needs to shuffle some large batches (with big value like HLL or bitmap), and the default limit for BRPC socket_max_unwritten_bytes (64MB) is exceeded.\nI think we should allow user to config that parameter, just like 'brpc_max_body_size'.", "createdAt": "2020-05-06T11:05:55Z", "url": "https://github.com/apache/incubator-doris/pull/3488", "merged": true, "mergeCommit": {"oid": "56db6e7a35f5bcacf842e4c122a56c9605f0bfaa"}, "closed": true, "closedAt": "2020-05-10T09:56:15Z", "author": {"login": "gaodayue"}, "timelineItems": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcemg6SgH2gAyNDE0MDI3MzQ4OjMzOGMxOGRmNDk3MzQ5MGMyYzk0M2JjZTFjNjgyOGUwYTIzNzJlMTI=", "endCursor": "Y3Vyc29yOnYyOpPPAAABce_qFmAFqTQwNjYzNTMyMQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "338c18df4973490c2c943bce1c6828e0a2372e12", "author": {"user": {"login": "gaodayue", "name": "Dayue Gao"}}, "url": "https://github.com/apache/incubator-doris/commit/338c18df4973490c2c943bce1c6828e0a2372e12", "committedDate": "2020-05-06T10:56:09Z", "message": "[Config] allow user to config BRPC socket_max_unwritten_bytes"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "61af7e13eee6316cfcdd14def9184a8176ef9bca", "author": {"user": {"login": "gaodayue", "name": "Dayue Gao"}}, "url": "https://github.com/apache/incubator-doris/commit/61af7e13eee6316cfcdd14def9184a8176ef9bca", "committedDate": "2020-05-07T03:23:41Z", "message": "update be_config.md"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDA3NTYyOTI3", "url": "https://github.com/apache/incubator-doris/pull/3488#pullrequestreview-407562927", "createdAt": "2020-05-07T15:02:34Z", "commit": {"oid": "61af7e13eee6316cfcdd14def9184a8176ef9bca"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDA2NjM1MzIx", "url": "https://github.com/apache/incubator-doris/pull/3488#pullrequestreview-406635321", "createdAt": "2020-05-06T13:53:30Z", "commit": {"oid": "338c18df4973490c2c943bce1c6828e0a2372e12"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wNlQxMzo1MzozMFrOGRUIaQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wNlQxMzo1MzozMFrOGRUIaQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMDgwODgwOQ==", "bodyText": "If this value is set large, eg, 200MB, by default, are there any side effects?", "url": "https://github.com/apache/incubator-doris/pull/3488#discussion_r420808809", "createdAt": "2020-05-06T13:53:30Z", "author": {"login": "morningman"}, "path": "be/src/common/config.h", "diffHunk": "@@ -488,8 +488,10 @@ namespace config {\n     // Valid configs: ALPHA, BETA\n     CONF_String(default_rowset_type, \"ALPHA\");\n \n-    // brpc config, 200M\n+    // Maximum size of a single message body in all protocols\n     CONF_Int64(brpc_max_body_size, \"209715200\")\n+    // Max unwritten bytes in each socket, if the limit is reached, Socket.Write fails with EOVERCROWDED\n+    CONF_Int64(brpc_socket_max_unwritten_bytes, \"67108864\")", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "338c18df4973490c2c943bce1c6828e0a2372e12"}, "originalPosition": 8}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2969, "cost": 1, "resetAt": "2021-10-28T17:48:14Z"}}}