{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0MzY0NTI4NDk1", "number": 2799, "title": "Return NullLiteral in castTo method instead of throwing a exception", "bodyText": "Issue\n#2399\n#2396 (2.2)\nWe used to use Precondition to throw an exception when encounter a NullLiteral in castTo method. So if the child of CastExpr is NullLiteral, then this CastExpr will throw an exception when invoking the castTo method.\nAnd this may make the user not get the desired result.\nFor example, we get an unexpected exception in query: (In sql mode PIPES_AS_CONCAT_MODE)\nselect (1 || 'a' > 0) + 1;\nwhich should return a result 'Null'.", "createdAt": "2020-01-19T12:16:35Z", "url": "https://github.com/apache/incubator-doris/pull/2799", "merged": true, "mergeCommit": {"oid": "2a30ac2ba5a85e23238d0470f6646939480c2c7a"}, "closed": true, "closedAt": "2020-01-21T02:20:32Z", "author": {"login": "xy720"}, "timelineItems": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABb7z539AH2gAyMzY0NTI4NDk1OmQ1NTc4MmQyMjdiNWI0NGVjM2I2M2ZiNjU1OGYwYTJmZjdmMjk4ZjY=", "endCursor": "Y3Vyc29yOnYyOpPPAAABb8XmZ6gFqTM0NTYwMzc0OQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "d55782d227b5b44ec3b63fb6558f0a2ff7f298f6", "author": {"user": {"login": "xy720", "name": null}}, "url": "https://github.com/apache/incubator-doris/commit/d55782d227b5b44ec3b63fb6558f0a2ff7f298f6", "committedDate": "2020-01-19T08:44:50Z", "message": "commit 1: fix bug"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "161b28692e46a2ae84678e6cf1a153ab2379bb5a", "author": {"user": {"login": "xy720", "name": null}}, "url": "https://github.com/apache/incubator-doris/commit/161b28692e46a2ae84678e6cf1a153ab2379bb5a", "committedDate": "2020-01-19T12:00:43Z", "message": "commit 2:Filter NullLiteral before  method instead of throwing a exception"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzQ1MjY3MDA1", "url": "https://github.com/apache/incubator-doris/pull/2799#pullrequestreview-345267005", "createdAt": "2020-01-20T12:12:02Z", "commit": {"oid": "161b28692e46a2ae84678e6cf1a153ab2379bb5a"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0yMFQxMjoxMjowMlrOFfccXQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0yMFQxMjoxMjowMlrOFfccXQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2ODUxNjE4OQ==", "bodyText": "what the different between IS_NULL_LITERAL  and result instance of NullLiteral", "url": "https://github.com/apache/incubator-doris/pull/2799#discussion_r368516189", "createdAt": "2020-01-20T12:12:02Z", "author": {"login": "EmmyMiao87"}, "path": "fe/src/test/java/org/apache/doris/analysis/SqlModeTest.java", "diffHunk": "@@ -76,4 +80,34 @@ public void testPipesAsConcatMode() {\n         }\n         Assert.assertEquals(\"(('a') OR ('b')) OR ('c')\", expr.toSql());\n     }\n+\n+    @Test\n+    public void testPipesAsConcatModeNull() {\n+        // Mode Active\n+        String stmt = new String(\"SELECT ('10' || 'xy' > 1) + 2\");\n+        SqlParser parser = new SqlParser(new SqlScanner(new StringReader(stmt), SqlModeHelper.MODE_PIPES_AS_CONCAT));\n+        SelectStmt parsedStmt = null;\n+        try {\n+            parsedStmt = (SelectStmt) parser.parse().value;\n+        } catch (Exception e) {\n+            Assert.fail(e.getMessage());\n+        }\n+        Expr expr = parsedStmt.getSelectList().getItems().get(0).getExpr();\n+        if (!(expr.contains(FunctionCallExpr.class))) {\n+            Assert.fail(\"Mode not working\");\n+        }\n+\n+        analyzer = AccessTestUtil.fetchAdminAnalyzer(false);\n+        try {\n+            parsedStmt.analyze(analyzer);\n+            ExprRewriter rewriter = analyzer.getExprRewriter();\n+            rewriter.reset();\n+            parsedStmt.rewriteExprs(rewriter);\n+\n+            Expr result = parsedStmt.getSelectList().getItems().get(0).getExpr();\n+            Assert.assertEquals(Expr.IS_NULL_LITERAL.apply(result), true);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "161b28692e46a2ae84678e6cf1a153ab2379bb5a"}, "originalPosition": 48}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzQ1NjAzNzQ5", "url": "https://github.com/apache/incubator-doris/pull/2799#pullrequestreview-345603749", "createdAt": "2020-01-21T02:20:09Z", "commit": {"oid": "161b28692e46a2ae84678e6cf1a153ab2379bb5a"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3629, "cost": 1, "resetAt": "2021-10-28T17:48:14Z"}}}