{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDU1MDMzMTM5", "number": 4143, "reviewThreads": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yM1QwMjowMjowMVrOERR3XA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yNFQwMzoxMDowNFrOERrs0g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjg2NTUzOTQ4OnYy", "diffSide": "RIGHT", "path": "be/src/olap/schema_change.cpp", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yM1QwMjowMjowMVrOG16CDQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yM1QwMjowMjowMVrOG16CDQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1OTE3ODUwOQ==", "bodyText": "this will disable all linked schema in when add key column in agg table, try some better way", "url": "https://github.com/apache/incubator-doris/pull/4143#discussion_r459178509", "createdAt": "2020-07-23T02:02:01Z", "author": {"login": "yangzhg"}, "path": "be/src/olap/schema_change.cpp", "diffHunk": "@@ -2111,6 +2111,11 @@ OLAPStatus SchemaChangeHandler::_parse_request(TabletSharedPtr base_tablet,\n     for (size_t i = 0; i < new_tablet->num_columns(); ++i) {\n         ColumnMapping* column_mapping = rb_changer->get_mutable_column_mapping(i);\n         if (column_mapping->ref_column < 0) {\n+            // check agg model, add key-column operation use sc_directly to build index\n+            if (new_tablet_schema.keys_type() == AGG_KEYS && new_tablet_schema.column(i).is_key()) {\n+                *sc_directly = true;\n+                return OLAP_SUCCESS;\n+            }", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c0b1f87e752b41ef7be203e4a2e3c0f662105eeb"}, "originalPosition": 8}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjg2OTc2NTExOnYy", "diffSide": "RIGHT", "path": "be/src/olap/rowset/segment_group.cpp", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yNFQwMzowNDozN1rOG2h4RA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yNFQwMzowNDozN1rOG2h4RA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1OTgzMTM2NA==", "bodyText": "better to make this comment more readable", "url": "https://github.com/apache/incubator-doris/pull/4143#discussion_r459831364", "createdAt": "2020-07-24T03:04:37Z", "author": {"login": "yangzhg"}, "path": "be/src/olap/rowset/segment_group.cpp", "diffHunk": "@@ -268,11 +265,14 @@ OLAPStatus SegmentGroup::add_zone_maps_for_linked_schema_change(\n         WrapperField* second = WrapperField::create(column);\n         DCHECK(second != NULL) << \"failed to allocate memory for field: \" << i;\n \n-        if (schema_mapping[i].ref_column == -1) {\n+        // add column also can add zone map index", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f741397d85903adedf8c2ed10054325abf0a02a0"}, "originalPosition": 21}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjg2OTc3MjM0OnYy", "diffSide": "RIGHT", "path": "be/src/olap/rowset/segment_group.cpp", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yNFQwMzoxMDowNFrOG2h8bA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yNFQwMzoxMDowNFrOG2h8bA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1OTgzMjQyOA==", "bodyText": "if you set it to default value\uff0c in duplicated table update from 0.11 to 0.12 may cause value clumn filtered unexpected", "url": "https://github.com/apache/incubator-doris/pull/4143#discussion_r459832428", "createdAt": "2020-07-24T03:10:04Z", "author": {"login": "yangzhg"}, "path": "be/src/olap/rowset/segment_group.cpp", "diffHunk": "@@ -268,11 +265,14 @@ OLAPStatus SegmentGroup::add_zone_maps_for_linked_schema_change(\n         WrapperField* second = WrapperField::create(column);\n         DCHECK(second != NULL) << \"failed to allocate memory for field: \" << i;\n \n-        if (schema_mapping[i].ref_column == -1) {\n+        // add column also can add zone map index\n+        if (schema_mapping[i].ref_column == -1 || i >= zone_map_fields.size()) {\n             // ref_column == -1 means this is a new column.\n             // for new column, use default value to fill into column_statistics\n-            first->copy(schema_mapping[i].default_value);\n-            second->copy(schema_mapping[i].default_value);\n+            if (schema_mapping[i].default_value != nullptr) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f741397d85903adedf8c2ed10054325abf0a02a0"}, "originalPosition": 27}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1212, "cost": 1, "resetAt": "2021-11-12T09:44:50Z"}}}