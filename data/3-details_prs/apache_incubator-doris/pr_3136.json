{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0MzkwMjc2MzIw", "number": 3136, "title": "[tablet meta] Do some refactor on TabletMeta", "bodyText": "remove some functions' return value which always return OLAP_SUCCESS \noptimize some loops", "createdAt": "2020-03-18T07:53:49Z", "url": "https://github.com/apache/incubator-doris/pull/3136", "merged": true, "mergeCommit": {"oid": "c08d6e4708f66167e1199bdba6d3a4e29eca3d2c"}, "closed": true, "closedAt": "2020-03-20T07:03:22Z", "author": {"login": "acelyc111"}, "timelineItems": {"totalCount": 7, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcPWd_egFqTM3ODE5MzgzMg==", "endCursor": "Y3Vyc29yOnYyOpPPAAABcPZBz2gFqTM3ODIzMTM0Mw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzc4MTkzODMy", "url": "https://github.com/apache/incubator-doris/pull/3136#pullrequestreview-378193832", "createdAt": "2020-03-20T01:32:07Z", "commit": {"oid": "55e033199e4928f3159d5017e1ac62d4b51ea457"}, "state": "COMMENTED", "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yMFQwMTozMjowN1rOF5Firw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yMFQwMTo0MzozMFrOF5Fq_g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NTQwMzk1MQ==", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                DCHECK(store);\n          \n          \n            \n                DCHECK(store != nullptr);\n          \n      \n    \n    \n  \n\nPrefer \"var != nullptr\" for pointer compare. Only use this when the bool value", "url": "https://github.com/apache/incubator-doris/pull/3136#discussion_r395403951", "createdAt": "2020-03-20T01:32:07Z", "author": {"login": "imay"}, "path": "be/src/olap/task/engine_storage_migration_task.cpp", "diffHunk": "@@ -234,21 +225,13 @@ OLAPStatus EngineStorageMigrationTask::_storage_medium_migrate(\n }\n \n // TODO(ygl): lost some infomation here, such as cumulative layer point\n-OLAPStatus EngineStorageMigrationTask::_generate_new_header(\n+void EngineStorageMigrationTask::_generate_new_header(\n         DataDir* store, const uint64_t new_shard,\n         const TabletSharedPtr& tablet,\n         const std::vector<RowsetSharedPtr>& consistent_rowsets,\n         TabletMetaSharedPtr new_tablet_meta) {\n-    if (store == nullptr) {\n-        LOG(WARNING) << \"fail to generate new header for store is null\";\n-        return OLAP_ERR_HEADER_INIT_FAILED;\n-    }\n-    OLAPStatus res = tablet->generate_tablet_meta_copy(new_tablet_meta);\n-    if (res != OLAP_SUCCESS) {\n-        LOG(WARNING) << \"could not generate new tablet meta. \"\n-                     << \"tablet:\" << tablet->full_name();\n-        return res;\n-    }\n+    DCHECK(store);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "55e033199e4928f3159d5017e1ac62d4b51ea457"}, "originalPosition": 69}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NTQwNTc5Nw==", "bodyText": "Seems that it will be better to make argument a rvalue reference.", "url": "https://github.com/apache/incubator-doris/pull/3136#discussion_r395405797", "createdAt": "2020-03-20T01:42:02Z", "author": {"login": "imay"}, "path": "be/src/olap/snapshot_manager.cpp", "diffHunk": "@@ -558,9 +541,9 @@ OLAPStatus SnapshotManager::_convert_beta_rowsets_to_alpha(const TabletMetaShare\n     }\n     if (res == OLAP_SUCCESS && modified) {\n         if (is_incremental) {\n-            res = new_tablet_meta->revise_inc_rs_metas(new_rowset_metas);\n+            new_tablet_meta->revise_inc_rs_metas(new_rowset_metas);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "55e033199e4928f3159d5017e1ac62d4b51ea457"}, "originalPosition": 58}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NTQwNjA3OA==", "bodyText": "same with above", "url": "https://github.com/apache/incubator-doris/pull/3136#discussion_r395406078", "createdAt": "2020-03-20T01:43:30Z", "author": {"login": "imay"}, "path": "be/src/olap/snapshot_manager.cpp", "diffHunk": "@@ -558,9 +541,9 @@ OLAPStatus SnapshotManager::_convert_beta_rowsets_to_alpha(const TabletMetaShare\n     }\n     if (res == OLAP_SUCCESS && modified) {\n         if (is_incremental) {\n-            res = new_tablet_meta->revise_inc_rs_metas(new_rowset_metas);\n+            new_tablet_meta->revise_inc_rs_metas(new_rowset_metas);\n         } else {\n-            res = new_tablet_meta->revise_rs_metas(new_rowset_metas);\n+            new_tablet_meta->revise_rs_metas(new_rowset_metas);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "55e033199e4928f3159d5017e1ac62d4b51ea457"}, "originalPosition": 61}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "90e88584cfb45a56329f26b8e27595014326e238", "author": {"user": {"login": "acelyc111", "name": "Yingchun Lai"}}, "url": "https://github.com/apache/incubator-doris/commit/90e88584cfb45a56329f26b8e27595014326e238", "committedDate": "2020-03-20T02:33:22Z", "message": "[tablet meta] Do some refactor on TabletMeta"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "9942318e275b9d32ffd737f1eed181bc00cf97a2", "author": {"user": {"login": "acelyc111", "name": "Yingchun Lai"}}, "url": "https://github.com/apache/incubator-doris/commit/9942318e275b9d32ffd737f1eed181bc00cf97a2", "committedDate": "2020-03-20T02:33:22Z", "message": "add more"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "df9cf31414cd9bd503719772612c53ea1e5e1537", "author": {"user": {"login": "acelyc111", "name": "Yingchun Lai"}}, "url": "https://github.com/apache/incubator-doris/commit/df9cf31414cd9bd503719772612c53ea1e5e1537", "committedDate": "2020-03-20T02:19:48Z", "message": "Update be/src/olap/task/engine_storage_migration_task.cpp\n\nCo-Authored-By: ZHAO Chun <buaa.zhaoc@gmail.com>"}, "afterCommit": {"oid": "250b06d6267c658b781094eb521fd1c66c146270", "author": {"user": {"login": "acelyc111", "name": "Yingchun Lai"}}, "url": "https://github.com/apache/incubator-doris/commit/250b06d6267c658b781094eb521fd1c66c146270", "committedDate": "2020-03-20T02:33:22Z", "message": "Update be/src/olap/task/engine_storage_migration_task.cpp\n\nCo-Authored-By: ZHAO Chun <buaa.zhaoc@gmail.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f84a7a899ce3ff8a48eb3c7a5dc006d4a1a7ebf8", "author": {"user": {"login": "acelyc111", "name": "Yingchun Lai"}}, "url": "https://github.com/apache/incubator-doris/commit/f84a7a899ce3ff8a48eb3c7a5dc006d4a1a7ebf8", "committedDate": "2020-03-20T03:15:06Z", "message": "fix by comments"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "9298ee225e39a599056037faef4e7f34f205194d", "author": {"user": {"login": "acelyc111", "name": "Yingchun Lai"}}, "url": "https://github.com/apache/incubator-doris/commit/9298ee225e39a599056037faef4e7f34f205194d", "committedDate": "2020-03-20T02:59:36Z", "message": "rvalue"}, "afterCommit": {"oid": "f84a7a899ce3ff8a48eb3c7a5dc006d4a1a7ebf8", "author": {"user": {"login": "acelyc111", "name": "Yingchun Lai"}}, "url": "https://github.com/apache/incubator-doris/commit/f84a7a899ce3ff8a48eb3c7a5dc006d4a1a7ebf8", "committedDate": "2020-03-20T03:15:06Z", "message": "fix by comments"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzc4MjMxMzQz", "url": "https://github.com/apache/incubator-doris/pull/3136#pullrequestreview-378231343", "createdAt": "2020-03-20T04:44:33Z", "commit": {"oid": "f84a7a899ce3ff8a48eb3c7a5dc006d4a1a7ebf8"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3314, "cost": 1, "resetAt": "2021-10-28T17:48:14Z"}}}