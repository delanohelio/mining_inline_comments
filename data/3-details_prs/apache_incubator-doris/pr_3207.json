{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0Mzk0MDE5MzQ1", "number": 3207, "title": "StorageEngine: unused_rowsets use unordered_multimap", "bodyText": "Ref #3199\nusing unordered_multimap lets StorageEngine::check_rowset_id_in_unused_rowsets() O(1)", "createdAt": "2020-03-26T08:14:32Z", "url": "https://github.com/apache/incubator-doris/pull/3207", "merged": true, "mergeCommit": {"oid": "0462607d8d537afea73b0f31e31d598cfe1c04c1"}, "closed": true, "closedAt": "2020-03-27T06:30:32Z", "author": {"login": "vagetablechicken"}, "timelineItems": {"totalCount": 7, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcRXTH9AH2gAyMzk0MDE5MzQ1OmQxYzQ2OTc2OTgyNTA2ZTg4NjVlYjJmMjA0ZTdkNzZkODI2ODgwNDY=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcRqvKHgFqTM4MjYwNjMzOQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "d1c46976982506e8865eb2f204e7d76d82688046", "author": {"user": null}, "url": "https://github.com/apache/incubator-doris/commit/d1c46976982506e8865eb2f204e7d76d82688046", "committedDate": "2020-03-26T07:51:30Z", "message": "unused_rowsets use unordered_multimap"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "62e913ca3c156eefc1589cc712c2629a0b511e37", "author": {"user": null}, "url": "https://github.com/apache/incubator-doris/commit/62e913ca3c156eefc1589cc712c2629a0b511e37", "committedDate": "2020-03-26T07:59:08Z", "message": "format selection"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "29ab44da5e77fd4c413a5acd669acedcf00c3239", "author": {"user": null}, "url": "https://github.com/apache/incubator-doris/commit/29ab44da5e77fd4c413a5acd669acedcf00c3239", "committedDate": "2020-03-26T10:35:31Z", "message": "fix"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzgxOTI3ODI5", "url": "https://github.com/apache/incubator-doris/pull/3207#pullrequestreview-381927829", "createdAt": "2020-03-26T11:42:21Z", "commit": {"oid": "29ab44da5e77fd4c413a5acd669acedcf00c3239"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yNlQxMTo0MjoyMVrOF8C9tw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yNlQxMTo0MjoyMVrOF8C9tw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5ODUwNzQ0Nw==", "bodyText": "Previous, rowset_id is not unique.\nNowadays, rowset_id is unique. So you can use std::unordered_map<std::string, RowsetSharedPtr> _unused_rowsets instead, not use unique_id().", "url": "https://github.com/apache/incubator-doris/pull/3207#discussion_r398507447", "createdAt": "2020-03-26T11:42:21Z", "author": {"login": "chaoyli"}, "path": "be/src/olap/storage_engine.h", "diffHunk": "@@ -296,7 +296,9 @@ class StorageEngine {\n     static StorageEngine* _s_instance;\n \n     Mutex _gc_mutex;\n-    std::unordered_map<std::string, RowsetSharedPtr> _unused_rowsets;\n+    // map<rowset_id(str), pair<rowset_path(str),RowsetSharedPtr>>\n+    // if we use RowsetId as the key, we need custom hash func\n+    std::unordered_multimap<std::string, std::pair<std::string,RowsetSharedPtr>> _unused_rowsets;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "29ab44da5e77fd4c413a5acd669acedcf00c3239"}, "originalPosition": 7}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "194a8a2938fcc8d4ba1bec4d654887bc835a0dfd", "author": {"user": null}, "url": "https://github.com/apache/incubator-doris/commit/194a8a2938fcc8d4ba1bec4d654887bc835a0dfd", "committedDate": "2020-03-27T02:37:49Z", "message": "remove rowset_path"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c930a2e76be4140f9de7a3840d04fd403b16801f", "author": {"user": null}, "url": "https://github.com/apache/incubator-doris/commit/c930a2e76be4140f9de7a3840d04fd403b16801f", "committedDate": "2020-03-27T03:16:20Z", "message": "fix"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzgyNjA2MzM5", "url": "https://github.com/apache/incubator-doris/pull/3207#pullrequestreview-382606339", "createdAt": "2020-03-27T06:30:19Z", "commit": {"oid": "c930a2e76be4140f9de7a3840d04fd403b16801f"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3084, "cost": 1, "resetAt": "2021-10-28T17:48:14Z"}}}