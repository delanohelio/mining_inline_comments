{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTIzNzA1MTI0", "number": 4925, "reviewThreads": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0yMVQxMzo1ODo1MlrOE73A-w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0yMVQxNDoyNTo0MlrOE73JPg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzMxMjAyODExOnYy", "diffSide": "RIGHT", "path": "be/src/olap/delete_handler.cpp", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0yMVQxMzo1ODo1MlrOH3uvZA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0yMVQxMzo1ODo1MlrOH3uvZA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyODE5OTUyNA==", "bodyText": "I think we can translate it to English this time", "url": "https://github.com/apache/incubator-doris/pull/4925#discussion_r528199524", "createdAt": "2020-11-21T13:58:52Z", "author": {"login": "morningman"}, "path": "be/src/olap/delete_handler.cpp", "diffHunk": "@@ -162,27 +165,23 @@ OLAPStatus DeleteConditionHandler::check_condition_valid(\n \n     // \u68c0\u67e5\u6307\u5b9a\u7684\u5217\u662f\u4e0d\u662fkey\uff0c\u662f\u4e0d\u662ffloat\u6216double\u7c7b\u578b\n     const TabletColumn& column = schema.column(field_index);\n-\n     if ((!column.is_key() && schema.keys_type() != KeysType::DUP_KEYS)\n             || column.type() == OLAP_FIELD_TYPE_DOUBLE\n             || column.type() == OLAP_FIELD_TYPE_FLOAT) {\n         LOG(WARNING) << \"field is not key column, or storage model is not duplicate, or data type is float or double.\";\n         return OLAP_ERR_DELETE_INVALID_CONDITION;\n     }\n \n-    // \u68c0\u67e5\u5220\u9664\u6761\u4ef6\u4e2d\u6307\u5b9a\u7684\u8fc7\u6ee4\u503c\u662f\u5426\u7b26\u5408\u6bcf\u4e2a\u7c7b\u578b\u81ea\u8eab\u7684\u8981\u6c42\n-    // 1. \u5bf9\u4e8e\u6574\u6570\u7c7b\u578b(int8,int16,in32,int64,uint8,uint16,uint32,uint64)\uff0c\u68c0\u67e5\u662f\u5426\u6ea2\u51fa\n-    // 2. \u5bf9\u4e8edecimal\u7c7b\u578b\uff0c\u68c0\u67e5\u662f\u5426\u8d85\u8fc7\u5efa\u8868\u65f6\u6307\u5b9a\u7684\u7cbe\u5ea6\u548c\u6807\u5ea6\n-    // 3. \u5bf9\u4e8edate\u548cdatetime\u7c7b\u578b\uff0c\u68c0\u67e5\u6307\u5b9a\u7684\u8fc7\u6ee4\u503c\u662f\u5426\u7b26\u5408\u65e5\u671f\u683c\u5f0f\u4ee5\u53ca\u662f\u5426\u6307\u5b9a\u9519\u8bef\u7684\u503c\n-    // 4. \u5bf9\u4e8estring\u548cvarchar\u7c7b\u578b\uff0c\u68c0\u67e5\u6307\u5b9a\u7684\u8fc7\u6ee4\u503c\u662f\u5426\u8d85\u8fc7\u5efa\u8868\u65f6\u6307\u5b9a\u7684\u957f\u5ea6\n+    // \u68c0\u67e5'op'\u4e0e'operands'\u6570\u662f\u5426\u5408\u6cd5", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "edd1ef52a4f312193c1007ed35944d908e73c71c"}, "originalPosition": 110}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzMxMjA0NDg5OnYy", "diffSide": "RIGHT", "path": "be/src/olap/olap_cond.cpp", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0yMVQxNDoyMDozMlrOH3u3Hg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0yMVQxNDoyMDozMlrOH3u3Hg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyODIwMTUwMg==", "bodyText": "I think DEL_NOT_SATISFIED is more safe. Or you'd better change DCHECK to CHECK", "url": "https://github.com/apache/incubator-doris/pull/4925#discussion_r528201502", "createdAt": "2020-11-21T14:20:32Z", "author": {"login": "morningman"}, "path": "be/src/olap/olap_cond.cpp", "diffHunk": "@@ -382,28 +386,30 @@ int Cond::del_eval(const std::pair<WrapperField*, WrapperField*>& stat) const {\n             } else if (stat.first->is_null() && !stat.second->is_null()) {\n                 ret = DEL_PARTIAL_SATISFIED;\n             } else {\n+                DCHECK(false);\n                 //\u4e0d\u4f1a\u51fa\u73b0min\u4e0d\u4e3aNULL\uff0cmax\u4e3aNULL\n-                ret = DEL_NOT_SATISFIED;\n+                ret = DEL_SATISFIED;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "edd1ef52a4f312193c1007ed35944d908e73c71c"}, "originalPosition": 130}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzMxMjA0NTUxOnYy", "diffSide": "RIGHT", "path": "be/src/olap/olap_cond.cpp", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0yMVQxNDoyMDo1OVrOH3u3Yg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0yMVQxNDoyMDo1OVrOH3u3Yg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyODIwMTU3MA==", "bodyText": "Change to CHECK, or ret = DEL_NOT_SATISFIED", "url": "https://github.com/apache/incubator-doris/pull/4925#discussion_r528201570", "createdAt": "2020-11-21T14:20:59Z", "author": {"login": "morningman"}, "path": "be/src/olap/olap_cond.cpp", "diffHunk": "@@ -382,28 +386,30 @@ int Cond::del_eval(const std::pair<WrapperField*, WrapperField*>& stat) const {\n             } else if (stat.first->is_null() && !stat.second->is_null()) {\n                 ret = DEL_PARTIAL_SATISFIED;\n             } else {\n+                DCHECK(false);\n                 //\u4e0d\u4f1a\u51fa\u73b0min\u4e0d\u4e3aNULL\uff0cmax\u4e3aNULL\n-                ret = DEL_NOT_SATISFIED;\n+                ret = DEL_SATISFIED;\n             }\n         } else {\n             if (stat.first->is_null() && stat.second->is_null()) {\n                 ret = DEL_NOT_SATISFIED;\n             } else if (stat.first->is_null() && !stat.second->is_null()) {\n                 ret = DEL_PARTIAL_SATISFIED;\n             } else {\n+                DCHECK(false);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "edd1ef52a4f312193c1007ed35944d908e73c71c"}, "originalPosition": 138}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzMxMjA0OTI2OnYy", "diffSide": "RIGHT", "path": "be/src/olap/reader.cpp", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0yMVQxNDoyNTo0MlrOH3u5FQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0yMlQwNjo0MTowN1rOH30Unw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyODIwMjAwNQ==", "bodyText": "Why using DCHECK here?", "url": "https://github.com/apache/incubator-doris/pull/4925#discussion_r528202005", "createdAt": "2020-11-21T14:25:42Z", "author": {"login": "morningman"}, "path": "be/src/olap/reader.cpp", "diffHunk": "@@ -599,13 +599,12 @@ OLAPStatus Reader::_init_params(const ReaderParams& read_params) {\n \n     if (_tablet->tablet_schema().has_sequence_col()) {\n         _sequence_col_idx = _tablet->tablet_schema().sequence_col_idx();\n-        if (_sequence_col_idx != -1) {\n-            for (auto col : _return_columns) {\n-                // query has sequence col\n-                if (col == _sequence_col_idx) {\n-                    _has_sequence_col = true;\n-                    break;\n-                }\n+        DCHECK_NE(_sequence_col_idx, -1);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "edd1ef52a4f312193c1007ed35944d908e73c71c"}, "originalPosition": 196}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyODI5MDk3NQ==", "bodyText": "@morningman Because has_sequence_col()  in line 600 is inline bool has_sequence_col() const { return  _sequence_col_idx != -1; }, so _sequence_col_idx shoule always be -1 here.", "url": "https://github.com/apache/incubator-doris/pull/4925#discussion_r528290975", "createdAt": "2020-11-22T06:41:07Z", "author": {"login": "acelyc111"}, "path": "be/src/olap/reader.cpp", "diffHunk": "@@ -599,13 +599,12 @@ OLAPStatus Reader::_init_params(const ReaderParams& read_params) {\n \n     if (_tablet->tablet_schema().has_sequence_col()) {\n         _sequence_col_idx = _tablet->tablet_schema().sequence_col_idx();\n-        if (_sequence_col_idx != -1) {\n-            for (auto col : _return_columns) {\n-                // query has sequence col\n-                if (col == _sequence_col_idx) {\n-                    _has_sequence_col = true;\n-                    break;\n-                }\n+        DCHECK_NE(_sequence_col_idx, -1);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyODIwMjAwNQ=="}, "originalCommit": {"oid": "edd1ef52a4f312193c1007ed35944d908e73c71c"}, "originalPosition": 196}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 898, "cost": 1, "resetAt": "2021-11-12T09:44:50Z"}}}