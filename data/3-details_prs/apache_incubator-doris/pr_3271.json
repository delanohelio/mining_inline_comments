{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDAwMTExMzg2", "number": 3271, "title": "[Bug] Avoid compacting recently added rowset", "bodyText": "This CL fixes #3270 by skipping recently added version when performing cumulative compaction. A new config named \"cumulative_compaction_skip_window_seconds\" is added to adjust the time window.", "createdAt": "2020-04-07T08:14:17Z", "url": "https://github.com/apache/incubator-doris/pull/3271", "merged": true, "mergeCommit": {"oid": "3557b12de59a0c070f1d910153391f5b3e0aae3a"}, "closed": true, "closedAt": "2020-04-08T10:58:13Z", "author": {"login": "gaodayue"}, "timelineItems": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcVPECugFqTM4ODg5NDkyNw==", "endCursor": "Y3Vyc29yOnYyOpPPAAABcVlt-oAFqTM4OTg2NTExMQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzg4ODk0OTI3", "url": "https://github.com/apache/incubator-doris/pull/3271#pullrequestreview-388894927", "createdAt": "2020-04-07T08:27:25Z", "commit": {"oid": "64e1cb062bf9126a4988d9556038199ae88b2d4d"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wN1QwODoyNzoyNVrOGB4m6Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wN1QwODoyNzoyNVrOGB4m6Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNDYyOTIyNQ==", "bodyText": "Better to use function in util/time.h.", "url": "https://github.com/apache/incubator-doris/pull/3271#discussion_r404629225", "createdAt": "2020-04-07T08:27:25Z", "author": {"login": "imay"}, "path": "be/src/olap/rowset/rowset.cpp", "diffHunk": "@@ -65,6 +67,9 @@ void Rowset::make_visible(Version version, VersionHash version_hash) {\n     _rowset_meta->set_version(version);\n     _rowset_meta->set_version_hash(version_hash);\n     _rowset_meta->set_rowset_state(VISIBLE);\n+    // update create time to the visible time,\n+    // it's used to skip recently published version during compaction\n+    _rowset_meta->set_creation_time(time(nullptr));", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "64e1cb062bf9126a4988d9556038199ae88b2d4d"}, "originalPosition": 15}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "57befd2702af593423c1685095d3a646840c21ee", "author": {"user": {"login": "gaodayue", "name": "Dayue Gao"}}, "url": "https://github.com/apache/incubator-doris/commit/57befd2702af593423c1685095d3a646840c21ee", "committedDate": "2020-04-08T04:07:35Z", "message": "[Bug] Avoid compacting recengly added rowset"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "64e1cb062bf9126a4988d9556038199ae88b2d4d", "author": {"user": {"login": "gaodayue", "name": "Dayue Gao"}}, "url": "https://github.com/apache/incubator-doris/commit/64e1cb062bf9126a4988d9556038199ae88b2d4d", "committedDate": "2020-04-07T08:09:19Z", "message": "[Bug] Avoid compacting recengly added rowset"}, "afterCommit": {"oid": "57befd2702af593423c1685095d3a646840c21ee", "author": {"user": {"login": "gaodayue", "name": "Dayue Gao"}}, "url": "https://github.com/apache/incubator-doris/commit/57befd2702af593423c1685095d3a646840c21ee", "committedDate": "2020-04-08T04:07:35Z", "message": "[Bug] Avoid compacting recengly added rowset"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzg5ODY1MTEx", "url": "https://github.com/apache/incubator-doris/pull/3271#pullrequestreview-389865111", "createdAt": "2020-04-08T10:55:12Z", "commit": {"oid": "57befd2702af593423c1685095d3a646840c21ee"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3173, "cost": 1, "resetAt": "2021-10-28T17:48:14Z"}}}