{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTQ1OTU4OTQw", "number": 5160, "reviewThreads": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0yOFQwNzoyNzoyNVrOFJdL2w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0yOFQwNzoyNzoyNVrOFJdL2w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzQ1NDU5Njc1OnYy", "diffSide": "RIGHT", "path": "fe/fe-core/src/main/java/org/apache/doris/qe/MasterOpExecutor.java", "isResolved": true, "comments": {"totalCount": 6, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0yOFQwNzoyNzoyNVrOILzKnw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0yOFQwOTo0Mzo0OVrOIL1jjA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0OTI0MzU1MQ==", "bodyText": "isQuery rename to shouldRetry? and variable 'shouldNotRetry' in MasterOpExecutor rename to \"shouldRetry\"? I think it is more readable. and then we just need to think when need to retry", "url": "https://github.com/apache/incubator-doris/pull/5160#discussion_r549243551", "createdAt": "2020-12-28T07:27:25Z", "author": {"login": "caiconghui"}, "path": "fe/fe-core/src/main/java/org/apache/doris/qe/MasterOpExecutor.java", "diffHunk": "@@ -42,7 +42,9 @@\n     // the total time of thrift connectTime add readTime and writeTime\n     private int thriftTimeoutMs;\n \n-    public MasterOpExecutor(OriginStatement originStmt, ConnectContext ctx, RedirectStatus status) {\n+    private boolean shouldNotRetry;\n+\n+    public MasterOpExecutor(OriginStatement originStmt, ConnectContext ctx, RedirectStatus status, boolean isQuery) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "aced136906424ed2e5c02fbe2f8a53153735947a"}, "originalPosition": 7}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0OTI0NTQ3Ng==", "bodyText": "I was discussed this name with my colleague, the constructor of MasterOpExecutor expose 'shouldRetry' could lead to misuse, because could not remember the retry related to statement type when invoke new MasterOpExecutor().\nAlthough isQuery doesn't look good, but it always write collect.\nAnd shouldNotRetry means exactly that: we should not retry forward to master. shouldRetry mismatch  the case that QueryStatement timeout.", "url": "https://github.com/apache/incubator-doris/pull/5160#discussion_r549245476", "createdAt": "2020-12-28T07:36:01Z", "author": {"login": "924060929"}, "path": "fe/fe-core/src/main/java/org/apache/doris/qe/MasterOpExecutor.java", "diffHunk": "@@ -42,7 +42,9 @@\n     // the total time of thrift connectTime add readTime and writeTime\n     private int thriftTimeoutMs;\n \n-    public MasterOpExecutor(OriginStatement originStmt, ConnectContext ctx, RedirectStatus status) {\n+    private boolean shouldNotRetry;\n+\n+    public MasterOpExecutor(OriginStatement originStmt, ConnectContext ctx, RedirectStatus status, boolean isQuery) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0OTI0MzU1MQ=="}, "originalCommit": {"oid": "aced136906424ed2e5c02fbe2f8a53153735947a"}, "originalPosition": 7}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0OTI0OTg3OA==", "bodyText": "If we want retry a statement, just need it is a idempotent operation, not just query, right?", "url": "https://github.com/apache/incubator-doris/pull/5160#discussion_r549249878", "createdAt": "2020-12-28T07:53:52Z", "author": {"login": "caiconghui"}, "path": "fe/fe-core/src/main/java/org/apache/doris/qe/MasterOpExecutor.java", "diffHunk": "@@ -42,7 +42,9 @@\n     // the total time of thrift connectTime add readTime and writeTime\n     private int thriftTimeoutMs;\n \n-    public MasterOpExecutor(OriginStatement originStmt, ConnectContext ctx, RedirectStatus status) {\n+    private boolean shouldNotRetry;\n+\n+    public MasterOpExecutor(OriginStatement originStmt, ConnectContext ctx, RedirectStatus status, boolean isQuery) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0OTI0MzU1MQ=="}, "originalCommit": {"oid": "aced136906424ed2e5c02fbe2f8a53153735947a"}, "originalPosition": 7}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0OTI1MTg3MQ==", "bodyText": "yes\uff0cthe condition isQuery is conservative & convenient", "url": "https://github.com/apache/incubator-doris/pull/5160#discussion_r549251871", "createdAt": "2020-12-28T08:01:45Z", "author": {"login": "924060929"}, "path": "fe/fe-core/src/main/java/org/apache/doris/qe/MasterOpExecutor.java", "diffHunk": "@@ -42,7 +42,9 @@\n     // the total time of thrift connectTime add readTime and writeTime\n     private int thriftTimeoutMs;\n \n-    public MasterOpExecutor(OriginStatement originStmt, ConnectContext ctx, RedirectStatus status) {\n+    private boolean shouldNotRetry;\n+\n+    public MasterOpExecutor(OriginStatement originStmt, ConnectContext ctx, RedirectStatus status, boolean isQuery) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0OTI0MzU1MQ=="}, "originalCommit": {"oid": "aced136906424ed2e5c02fbe2f8a53153735947a"}, "originalPosition": 7}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0OTI1NDY5Ng==", "bodyText": "the principle is\uff1awe must ensure non-idempotent operation execute at-most-once if we has not a same label", "url": "https://github.com/apache/incubator-doris/pull/5160#discussion_r549254696", "createdAt": "2020-12-28T08:12:43Z", "author": {"login": "924060929"}, "path": "fe/fe-core/src/main/java/org/apache/doris/qe/MasterOpExecutor.java", "diffHunk": "@@ -42,7 +42,9 @@\n     // the total time of thrift connectTime add readTime and writeTime\n     private int thriftTimeoutMs;\n \n-    public MasterOpExecutor(OriginStatement originStmt, ConnectContext ctx, RedirectStatus status) {\n+    private boolean shouldNotRetry;\n+\n+    public MasterOpExecutor(OriginStatement originStmt, ConnectContext ctx, RedirectStatus status, boolean isQuery) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0OTI0MzU1MQ=="}, "originalCommit": {"oid": "aced136906424ed2e5c02fbe2f8a53153735947a"}, "originalPosition": 7}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0OTI4MjcwMA==", "bodyText": "Thank You, I see", "url": "https://github.com/apache/incubator-doris/pull/5160#discussion_r549282700", "createdAt": "2020-12-28T09:43:49Z", "author": {"login": "caiconghui"}, "path": "fe/fe-core/src/main/java/org/apache/doris/qe/MasterOpExecutor.java", "diffHunk": "@@ -42,7 +42,9 @@\n     // the total time of thrift connectTime add readTime and writeTime\n     private int thriftTimeoutMs;\n \n-    public MasterOpExecutor(OriginStatement originStmt, ConnectContext ctx, RedirectStatus status) {\n+    private boolean shouldNotRetry;\n+\n+    public MasterOpExecutor(OriginStatement originStmt, ConnectContext ctx, RedirectStatus status, boolean isQuery) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0OTI0MzU1MQ=="}, "originalCommit": {"oid": "aced136906424ed2e5c02fbe2f8a53153735947a"}, "originalPosition": 7}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 858, "cost": 1, "resetAt": "2021-11-12T09:44:50Z"}}}