{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDMxMDI2MDI3", "number": 3799, "title": "[Dynamic Partition] Use ZonedDateTime to support set timezone", "bodyText": "This CL mainly support timezone in dynamic partition:\n\nuse new Java Time API to replace Calender.\nsupport set time zone in dynamic partition parameters.", "createdAt": "2020-06-08T10:12:46Z", "url": "https://github.com/apache/incubator-doris/pull/3799", "merged": true, "mergeCommit": {"oid": "414a0a35e53648a260c1d6eee70c9c2557da2425"}, "closed": true, "closedAt": "2020-06-13T08:27:10Z", "author": {"login": "WingsGo"}, "timelineItems": {"totalCount": 9, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcpK11pAH2gAyNDMxMDI2MDI3OmIwMWU3ZWM1NWViOTQzNjAxZmNmZTU2NTAwMTlhMjM1Y2Q3YTI2NDI=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcqiq9mAFqTQyOTcyOTUwNg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "b01e7ec55eb943601fcfe5650019a235cd7a2642", "author": {"user": null}, "url": "https://github.com/apache/incubator-doris/commit/b01e7ec55eb943601fcfe5650019a235cd7a2642", "committedDate": "2020-06-08T06:54:50Z", "message": "[Dynamic Partition] Use ZonedDateTime to support set timezone\n\nThis CL mainly support timezone in dynamic partition:\n1. use new Java Time API to replace Calender.\n2. support set time zone in dynamic partition parameters."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "efe98e4129384755a443bc93b9be9018389506da", "author": {"user": null}, "url": "https://github.com/apache/incubator-doris/commit/efe98e4129384755a443bc93b9be9018389506da", "committedDate": "2020-06-08T07:01:11Z", "message": "remove file"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "95f88e6d90bd69f4e5748a004e6debc018d33d09", "author": {"user": null}, "url": "https://github.com/apache/incubator-doris/commit/95f88e6d90bd69f4e5748a004e6debc018d33d09", "committedDate": "2020-06-08T10:00:04Z", "message": "support set timezone"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "36349b2948aa7c92f0e6895b7ec2b6b1d5405c2e", "author": {"user": null}, "url": "https://github.com/apache/incubator-doris/commit/36349b2948aa7c92f0e6895b7ec2b6b1d5405c2e", "committedDate": "2020-06-08T10:21:22Z", "message": "fix"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDI3MjA0NDMy", "url": "https://github.com/apache/incubator-doris/pull/3799#pullrequestreview-427204432", "createdAt": "2020-06-09T14:23:16Z", "commit": {"oid": "36349b2948aa7c92f0e6895b7ec2b6b1d5405c2e"}, "state": "COMMENTED", "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wOVQxNDoyMzoxNlrOGhMnlA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wOVQxNDoyMzo0NVrOGhMpFQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNzQ2MjkzMg==", "bodyText": "How about finding timezone here?\nhttps://en.wikipedia.org/wiki/List_of_tz_database_time_zones", "url": "https://github.com/apache/incubator-doris/pull/3799#discussion_r437462932", "createdAt": "2020-06-09T14:23:16Z", "author": {"login": "morningman"}, "path": "docs/en/administrator-guide/dynamic-partition.md", "diffHunk": "@@ -89,6 +89,10 @@ The rules of dynamic partition are prefixed with `dynamic_partition.`:\n \n     When specified as `MONTH`, the suffix format of the dynamically created partition name is `yyyyMM`, for example, `202003`.\n \n+* `dynamic_partition.time_zone`\n+\n+    The time zone of the dynamic partition, if not filled in, defaults to the time zone of the current machine's system, such as `Asia/Shanghai`, if you want to know the supported TimeZone, you can run `TimeZone.getAvailableIDs()` in Java.", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "36349b2948aa7c92f0e6895b7ec2b6b1d5405c2e"}, "originalPosition": 6}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNzQ2MzI2Mg==", "bodyText": "Better move the time related functions to TimeUtils class", "url": "https://github.com/apache/incubator-doris/pull/3799#discussion_r437463262", "createdAt": "2020-06-09T14:23:41Z", "author": {"login": "morningman"}, "path": "fe/src/main/java/org/apache/doris/catalog/DynamicPartitionProperty.java", "diffHunk": "@@ -46,15 +48,14 @@\n     private int buckets;\n     private StartOfDate startOfWeek;\n     private StartOfDate startOfMonth;\n-    // TODO: support setting timezone.\n     private TimeZone tz = TimeUtils.getDefaultTimeZone();\n \n-\n     public DynamicPartitionProperty(Map<String, String> properties) {\n         if (properties != null && !properties.isEmpty()) {\n             this.exist = true;\n             this.enable = Boolean.parseBoolean(properties.get(ENABLE));\n             this.timeUnit = properties.get(TIME_UNIT);\n+            this.tz = TimeZone.getTimeZone(properties.getOrDefault(TIME_ZONE, ZoneId.systemDefault().toString()));", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "36349b2948aa7c92f0e6895b7ec2b6b1d5405c2e"}, "originalPosition": 34}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNzQ2MzMxNw==", "bodyText": "Why not using TimeUtils.checkTimeZoneValidAndStandardize()?", "url": "https://github.com/apache/incubator-doris/pull/3799#discussion_r437463317", "createdAt": "2020-06-09T14:23:45Z", "author": {"login": "morningman"}, "path": "fe/src/main/java/org/apache/doris/common/util/DynamicPartitionUtil.java", "diffHunk": "@@ -148,11 +151,25 @@ private static void checkStartDayOfWeek(String val) throws DdlException {\n         }\n     }\n \n+    private static void checkTimeZone(String val) throws DdlException {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "36349b2948aa7c92f0e6895b7ec2b6b1d5405c2e"}, "originalPosition": 14}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "034cbc321aa365a2088aad707440a38b558779b1", "author": {"user": {"login": "WingsGo", "name": "WangCong"}}, "url": "https://github.com/apache/incubator-doris/commit/034cbc321aa365a2088aad707440a38b558779b1", "committedDate": "2020-06-09T15:21:48Z", "message": "fix by review"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "87d0b4f2dbf71e08e139ffa116cdea294cbb3bbf", "author": {"user": {"login": "WingsGo", "name": "WangCong"}}, "url": "https://github.com/apache/incubator-doris/commit/87d0b4f2dbf71e08e139ffa116cdea294cbb3bbf", "committedDate": "2020-06-10T02:05:52Z", "message": "fix unused import"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c07afac37c6e4919b9e1cd2508014c12d2b89626", "author": {"user": {"login": "WingsGo", "name": "WangCong"}}, "url": "https://github.com/apache/incubator-doris/commit/c07afac37c6e4919b9e1cd2508014c12d2b89626", "committedDate": "2020-06-10T02:43:35Z", "message": "fix ut"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDI5NzI5NTA2", "url": "https://github.com/apache/incubator-doris/pull/3799#pullrequestreview-429729506", "createdAt": "2020-06-12T13:14:36Z", "commit": {"oid": "c07afac37c6e4919b9e1cd2508014c12d2b89626"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2482, "cost": 1, "resetAt": "2021-10-28T17:48:14Z"}}}