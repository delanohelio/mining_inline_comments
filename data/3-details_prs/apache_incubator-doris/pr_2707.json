{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0MzYwMzU2MDQ2", "number": 2707, "title": "add BE udf bitmap_or & bitmap_and", "bodyText": "1.add BE udf bitmap_or & bitmap_and\n#2534 #2535", "createdAt": "2020-01-08T09:17:43Z", "url": "https://github.com/apache/incubator-doris/pull/2707", "merged": true, "mergeCommit": {"oid": "a028c52edd7a4c671a1f546a6dd451105a238285"}, "closed": true, "closedAt": "2020-01-08T11:59:45Z", "author": {"login": "DanyBin"}, "timelineItems": {"totalCount": 5, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABb4RugIAH2gAyMzYwMzU2MDQ2OmRjOGI3Y2U4ODQxMGM3MmJlNTNlYjU1MWZkYWEwY2YzZWRmYTlhYTc=", "endCursor": "Y3Vyc29yOnYyOpPPAAABb4UFYYAFqTMzOTgxNzgyOA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "dc8b7ce88410c72be53eb551fdaa0cf3edfa9aa7", "author": {"user": null}, "url": "https://github.com/apache/incubator-doris/commit/dc8b7ce88410c72be53eb551fdaa0cf3edfa9aa7", "committedDate": "2020-01-08T09:13:52Z", "message": "add BE udf bitmap_or & bitmap_and"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzM5NzMzMDI0", "url": "https://github.com/apache/incubator-doris/pull/2707#pullrequestreview-339733024", "createdAt": "2020-01-08T09:20:54Z", "commit": {"oid": "dc8b7ce88410c72be53eb551fdaa0cf3edfa9aa7"}, "state": "DISMISSED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzM5NzM0MDA4", "url": "https://github.com/apache/incubator-doris/pull/2707#pullrequestreview-339734008", "createdAt": "2020-01-08T09:22:42Z", "commit": {"oid": "dc8b7ce88410c72be53eb551fdaa0cf3edfa9aa7"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0wOFQwOToyMjo0MlrOFbQ3iQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0wOFQwOToyNDowOFrOFbQ6JA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NDEzMjIzMw==", "bodyText": "return null when input is null.", "url": "https://github.com/apache/incubator-doris/pull/2707#discussion_r364132233", "createdAt": "2020-01-08T09:22:42Z", "author": {"login": "imay"}, "path": "be/src/exprs/bitmap_function.cpp", "diffHunk": "@@ -387,7 +387,48 @@ BigIntVal BitmapFunctions::bitmap_intersect_finalize(FunctionContext* ctx, const\n     delete src_bitmap;\n     return result;\n }\n+StringVal BitmapFunctions::bitmap_or(FunctionContext* ctx, const StringVal& src, const StringVal& dst){", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "dc8b7ce88410c72be53eb551fdaa0cf3edfa9aa7"}, "originalPosition": 4}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NDEzMjM0MQ==", "bodyText": "better to change src and dst to lhs and rhs.", "url": "https://github.com/apache/incubator-doris/pull/2707#discussion_r364132341", "createdAt": "2020-01-08T09:22:56Z", "author": {"login": "imay"}, "path": "be/src/exprs/bitmap_function.cpp", "diffHunk": "@@ -387,7 +387,48 @@ BigIntVal BitmapFunctions::bitmap_intersect_finalize(FunctionContext* ctx, const\n     delete src_bitmap;\n     return result;\n }\n+StringVal BitmapFunctions::bitmap_or(FunctionContext* ctx, const StringVal& src, const StringVal& dst){", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "dc8b7ce88410c72be53eb551fdaa0cf3edfa9aa7"}, "originalPosition": 4}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NDEzMjQ3Ng==", "bodyText": "rename src and dst to lhs and rhs", "url": "https://github.com/apache/incubator-doris/pull/2707#discussion_r364132476", "createdAt": "2020-01-08T09:23:16Z", "author": {"login": "imay"}, "path": "be/src/exprs/bitmap_function.cpp", "diffHunk": "@@ -387,7 +387,48 @@ BigIntVal BitmapFunctions::bitmap_intersect_finalize(FunctionContext* ctx, const\n     delete src_bitmap;\n     return result;\n }\n+StringVal BitmapFunctions::bitmap_or(FunctionContext* ctx, const StringVal& src, const StringVal& dst){\n+    RoaringBitmap bitmap;\n+    if (!src.is_null) {\n+        if (src.len == 0) {\n+            bitmap.merge(*reinterpret_cast<RoaringBitmap*>(src.ptr));\n+        } else {\n+            bitmap.merge(RoaringBitmap((char*)src.ptr));\n+        }\n+    }\n+\n+    if (!dst.is_null) {\n+        if (dst.len == 0) {\n+            bitmap.merge(*reinterpret_cast<RoaringBitmap*>(dst.ptr));\n+        } else {\n+            bitmap.merge(RoaringBitmap((char*)dst.ptr));\n+        }\n+    }\n \n+    StringVal result(ctx,bitmap.size());\n+    bitmap.serialize((char*)result.ptr);\n+    return result;\n+}\n+StringVal BitmapFunctions::bitmap_and(FunctionContext* ctx, const StringVal& src, const StringVal& dst){", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "dc8b7ce88410c72be53eb551fdaa0cf3edfa9aa7"}, "originalPosition": 26}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NDEzMjkwMA==", "bodyText": "input should be BITMAP.", "url": "https://github.com/apache/incubator-doris/pull/2707#discussion_r364132900", "createdAt": "2020-01-08T09:24:08Z", "author": {"login": "imay"}, "path": "gensrc/script/doris_builtins_functions.py", "diffHunk": "@@ -610,7 +610,10 @@\n         '_ZN5doris15BitmapFunctions12bitmap_countEPN9doris_udf15FunctionContextERKNS1_9StringValE'],\n     [['bitmap_empty'], 'BITMAP', [],\n         '_ZN5doris15BitmapFunctions12bitmap_emptyEPN9doris_udf15FunctionContextE'],\n-\n+    [['bitmap_or'], 'BITMAP', ['VARCHAR','VARCHAR'],", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "dc8b7ce88410c72be53eb551fdaa0cf3edfa9aa7"}, "originalPosition": 5}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a62c7694e8272c201bd56e46ba1ffa1aa68c7552", "author": {"user": null}, "url": "https://github.com/apache/incubator-doris/commit/a62c7694e8272c201bd56e46ba1ffa1aa68c7552", "committedDate": "2020-01-08T09:54:51Z", "message": "rename & modify type"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzM5ODE3ODI4", "url": "https://github.com/apache/incubator-doris/pull/2707#pullrequestreview-339817828", "createdAt": "2020-01-08T11:58:40Z", "commit": {"oid": "a62c7694e8272c201bd56e46ba1ffa1aa68c7552"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3903, "cost": 1, "resetAt": "2021-10-28T17:48:14Z"}}}