{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDg2MzM3MDEw", "number": 4597, "reviewThreads": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xNFQwNTozNzo1OVrOEi-BVQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xNFQwNjowNTo1N1rOEi-Wrw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzA1MTAzMTg5OnYy", "diffSide": "RIGHT", "path": "be/src/agent/task_worker_pool.cpp", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xNFQwNTozNzo1OVrOHREhEA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xNFQwNTo0NjoyOFrOHREqFQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NzY2MTg0MA==", "bodyText": "This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters. Learn more about bidirectional Unicode characters\n\n\n  \n\n\n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                        LOG(WARNING) << \"report task failed. status:\" << status << \", master host:\"\n          \n          \n            \n                        LOG(WARNING) << \"report task failed. status: \" << status << \", master host: \"", "url": "https://github.com/apache/incubator-doris/pull/4597#discussion_r487661840", "createdAt": "2020-09-14T05:37:59Z", "author": {"login": "acelyc111"}, "path": "be/src/agent/task_worker_pool.cpp", "diffHunk": "@@ -1007,13 +1038,18 @@ void TaskWorkerPool::_report_task_worker_thread_callback() {\n \n         if (status != DORIS_SUCCESS) {\n             DorisMetrics::instance()->report_task_requests_failed->increment(1);\n-            LOG(WARNING) << \"finish report task failed. status:\" << status << \", master host:\"\n+            LOG(WARNING) << \"report task failed. status:\" << status << \", master host:\"", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "0e1b997200a35acd28bb50956e3a221acafb5044"}, "originalPosition": 65}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NzY2NDE0OQ==", "bodyText": "The same to other places.", "url": "https://github.com/apache/incubator-doris/pull/4597#discussion_r487664149", "createdAt": "2020-09-14T05:46:28Z", "author": {"login": "acelyc111"}, "path": "be/src/agent/task_worker_pool.cpp", "diffHunk": "@@ -1007,13 +1038,18 @@ void TaskWorkerPool::_report_task_worker_thread_callback() {\n \n         if (status != DORIS_SUCCESS) {\n             DorisMetrics::instance()->report_task_requests_failed->increment(1);\n-            LOG(WARNING) << \"finish report task failed. status:\" << status << \", master host:\"\n+            LOG(WARNING) << \"report task failed. status:\" << status << \", master host:\"", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NzY2MTg0MA=="}, "originalCommit": {"oid": "0e1b997200a35acd28bb50956e3a221acafb5044"}, "originalPosition": 65}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzA1MTA3MDMyOnYy", "diffSide": "RIGHT", "path": "be/src/olap/storage_engine.cpp", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xNFQwNTo1ODozMVrOHRE3rQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xNFQwNjozMToyNFrOHRFkcw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NzY2NzYyOQ==", "bodyText": "Seems all callers pass a 'false' parameter, how about remove these code?", "url": "https://github.com/apache/incubator-doris/pull/4597#discussion_r487667629", "createdAt": "2020-09-14T05:58:31Z", "author": {"login": "acelyc111"}, "path": "be/src/olap/storage_engine.cpp", "diffHunk": "@@ -975,11 +975,17 @@ void StorageEngine::deregister_report_listener(TaskWorkerPool* listener) {\n     _report_listeners.erase(listener);\n }\n \n-void StorageEngine::notify_listeners() {\n+/// if submit_task is true, it will notify the listeners by submmiting a task.\n+/// otherwise, it just notify the thread\n+void StorageEngine::notify_listeners(bool submit_task) {\n     std::lock_guard<std::mutex> l(_report_mtx);\n     for (auto& listener : _report_listeners) {\n-        TAgentTaskRequest task;\n-        listener->submit_task(task);\n+        if (submit_task) {\n+            TAgentTaskRequest task;\n+            listener->submit_task(task);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "0e1b997200a35acd28bb50956e3a221acafb5044"}, "originalPosition": 32}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NzY3OTA5MQ==", "bodyText": "OK", "url": "https://github.com/apache/incubator-doris/pull/4597#discussion_r487679091", "createdAt": "2020-09-14T06:31:24Z", "author": {"login": "morningman"}, "path": "be/src/olap/storage_engine.cpp", "diffHunk": "@@ -975,11 +975,17 @@ void StorageEngine::deregister_report_listener(TaskWorkerPool* listener) {\n     _report_listeners.erase(listener);\n }\n \n-void StorageEngine::notify_listeners() {\n+/// if submit_task is true, it will notify the listeners by submmiting a task.\n+/// otherwise, it just notify the thread\n+void StorageEngine::notify_listeners(bool submit_task) {\n     std::lock_guard<std::mutex> l(_report_mtx);\n     for (auto& listener : _report_listeners) {\n-        TAgentTaskRequest task;\n-        listener->submit_task(task);\n+        if (submit_task) {\n+            TAgentTaskRequest task;\n+            listener->submit_task(task);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NzY2NzYyOQ=="}, "originalCommit": {"oid": "0e1b997200a35acd28bb50956e3a221acafb5044"}, "originalPosition": 32}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzA1MTA4NjU1OnYy", "diffSide": "RIGHT", "path": "be/src/agent/task_worker_pool.h", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xNFQwNjowNTo1N1rOHRFBFg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xNFQwNjozMDoxNlrOHRFikg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NzY3MDAzOA==", "bodyText": "Maybe it's not easy to keep order consistency some days later, how about use a function to get name of type?", "url": "https://github.com/apache/incubator-doris/pull/4597#discussion_r487670038", "createdAt": "2020-09-14T06:05:57Z", "author": {"login": "acelyc111"}, "path": "be/src/agent/task_worker_pool.h", "diffHunk": "@@ -43,6 +43,8 @@ class ThreadPool;\n \n class TaskWorkerPool {\n public:\n+    // You need to modify the content in TYPE_STRING at the same time,", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "0e1b997200a35acd28bb50956e3a221acafb5044"}, "originalPosition": 4}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NzY3ODYxMA==", "bodyText": "OK", "url": "https://github.com/apache/incubator-doris/pull/4597#discussion_r487678610", "createdAt": "2020-09-14T06:30:16Z", "author": {"login": "morningman"}, "path": "be/src/agent/task_worker_pool.h", "diffHunk": "@@ -43,6 +43,8 @@ class ThreadPool;\n \n class TaskWorkerPool {\n public:\n+    // You need to modify the content in TYPE_STRING at the same time,", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NzY3MDAzOA=="}, "originalCommit": {"oid": "0e1b997200a35acd28bb50956e3a221acafb5044"}, "originalPosition": 4}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1104, "cost": 1, "resetAt": "2021-11-12T09:44:50Z"}}}