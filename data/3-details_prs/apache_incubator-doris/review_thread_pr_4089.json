{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDQ4MzAzNzky", "number": 4089, "reviewThreads": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xNVQwMjozOToyNlrOEOgIpA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xNVQxNDo0ODo1NlrOEOuGLw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjgzNjQyMDIwOnYy", "diffSide": "RIGHT", "path": "fe/src/main/java/org/apache/doris/catalog/Replica.java", "isResolved": true, "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xNVQwMjozOToyNlrOGxsFaA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xNVQxNDo1NTozOVrOGyCLJg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NDc1NTY4OA==", "bodyText": "why the replica meta version been updated by ReportHandler before?\nthis is abnormal, I think using warning is better", "url": "https://github.com/apache/incubator-doris/pull/4089#discussion_r454755688", "createdAt": "2020-07-15T02:39:26Z", "author": {"login": "yangzhg"}, "path": "fe/src/main/java/org/apache/doris/catalog/Replica.java", "diffHunk": "@@ -318,12 +318,17 @@ private void updateReplicaInfo(long newVersion, long newVersionHash,\n             long lastFailedVersion, long lastFailedVersionHash, \n             long lastSuccessVersion, long lastSuccessVersionHash, \n             long newDataSize, long newRowCount) {\n-        LOG.debug(\"before update: {}\", this.toString());\n+        if (LOG.isDebugEnabled()) {\n+            LOG.debug(\"before update: {}\", this.toString());\n+        }\n \n         if (newVersion < this.version) {\n-            // yiguolei: could not find any reason why new version less than this.version should run???\n-            LOG.warn(\"replica {} on backend {}'s new version {} is lower than meta version {}\",\n-                    id, backendId, newVersion, this.version);\n+            // This case means that replica meta version has been updated by ReportHandler before", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "202b2615113a907c95bf53a28af164b621b1402d"}, "originalPosition": 13}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NDc2Njc4Ng==", "bodyText": "@yangzhg\nfor example, now, the publish version daemon send publish verison task(2 3 4 5 6) to one be, and the be finish all publish version task, its replica version is 6 now, but publish version daemon need wait other be finish all publish version to update version in fe, now the replica version in fe may be 4, I think it is the common case that be replica version higher than fe replica version, when ReportHandler sync tablet. And now publish version daemon finish txn and replica version 4 + 1 = 5, it find the newer version(5) is lower than replica version(6) in fe.\n\n  \n    \n      incubator-doris/fe/src/main/java/org/apache/doris/master/ReportHandler.java\n    \n    \n        Lines 473 to 477\n      in\n      14ac49d\n    \n    \n    \n    \n\n        \n          \n           // 1. PUSH finished in BE but failed or not yet report to FE \n        \n\n        \n          \n           // 2. repair for VERSION_INCOMPLETE finished in BE, but failed or not yet report to FE \n        \n\n        \n          \n           replica.updateVersionInfo(backendVersion, backendVersionHash, dataSize, rowCount); \n        \n\n        \n          \n           replica.setBad(false);", "url": "https://github.com/apache/incubator-doris/pull/4089#discussion_r454766786", "createdAt": "2020-07-15T03:21:38Z", "author": {"login": "caiconghui"}, "path": "fe/src/main/java/org/apache/doris/catalog/Replica.java", "diffHunk": "@@ -318,12 +318,17 @@ private void updateReplicaInfo(long newVersion, long newVersionHash,\n             long lastFailedVersion, long lastFailedVersionHash, \n             long lastSuccessVersion, long lastSuccessVersionHash, \n             long newDataSize, long newRowCount) {\n-        LOG.debug(\"before update: {}\", this.toString());\n+        if (LOG.isDebugEnabled()) {\n+            LOG.debug(\"before update: {}\", this.toString());\n+        }\n \n         if (newVersion < this.version) {\n-            // yiguolei: could not find any reason why new version less than this.version should run???\n-            LOG.warn(\"replica {} on backend {}'s new version {} is lower than meta version {}\",\n-                    id, backendId, newVersion, this.version);\n+            // This case means that replica meta version has been updated by ReportHandler before", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NDc1NTY4OA=="}, "originalCommit": {"oid": "202b2615113a907c95bf53a28af164b621b1402d"}, "originalPosition": 13}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NTExNzYwNg==", "bodyText": "Good explaination. I suggest to add this directly to the comment.", "url": "https://github.com/apache/incubator-doris/pull/4089#discussion_r455117606", "createdAt": "2020-07-15T14:55:39Z", "author": {"login": "morningman"}, "path": "fe/src/main/java/org/apache/doris/catalog/Replica.java", "diffHunk": "@@ -318,12 +318,17 @@ private void updateReplicaInfo(long newVersion, long newVersionHash,\n             long lastFailedVersion, long lastFailedVersionHash, \n             long lastSuccessVersion, long lastSuccessVersionHash, \n             long newDataSize, long newRowCount) {\n-        LOG.debug(\"before update: {}\", this.toString());\n+        if (LOG.isDebugEnabled()) {\n+            LOG.debug(\"before update: {}\", this.toString());\n+        }\n \n         if (newVersion < this.version) {\n-            // yiguolei: could not find any reason why new version less than this.version should run???\n-            LOG.warn(\"replica {} on backend {}'s new version {} is lower than meta version {}\",\n-                    id, backendId, newVersion, this.version);\n+            // This case means that replica meta version has been updated by ReportHandler before", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NDc1NTY4OA=="}, "originalCommit": {"oid": "202b2615113a907c95bf53a28af164b621b1402d"}, "originalPosition": 13}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjgzODY5MjY1OnYy", "diffSide": "RIGHT", "path": "docs/en/administrator-guide/config/fe_config.md", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xNVQxNDo0NTo0NFrOGyBnPQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xNVQxNDo0NTo0NFrOGyBnPQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NTEwODQxMw==", "bodyText": "This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters. Learn more about bidirectional Unicode characters\n\n\n  \n\n\n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            \u5f53\u4ee3\u7406\u4efb\u52a1\u7684\u521b\u5efa\u65f6\u95f4\u88ab\u8bbe\u7f6e\u7684\u65f6\u5019\uff0c\u6b64\u914d\u7f6e\u5c06\u51b3\u5b9a\u662f\u5426\u91cd\u65b0\u53d1\u9001\u4ee3\u7406\u4efb\u52a1\uff0c \u5f53\u4e14\u4ec5\u5f53\u5f53\u524d\u65f6\u95f4\u51cf\u53bb\u521b\u5efa\u65f6\u95f4\u5927\u4e8eagent_task_task_resend_wait_time_ms\u65f6\uff0cReportHandler\u53ef\u4ee5\u91cd\u65b0\u53d1\u9001\u4ee3\u7406\u4efb\u52a1\u3002    \n          \n          \n            \n            \u5f53\u4ee3\u7406\u4efb\u52a1\u7684\u521b\u5efa\u65f6\u95f4\u88ab\u8bbe\u7f6e\u7684\u65f6\u5019\uff0c\u6b64\u914d\u7f6e\u5c06\u51b3\u5b9a\u662f\u5426\u91cd\u65b0\u53d1\u9001\u4ee3\u7406\u4efb\u52a1\uff0c \u5f53\u4e14\u4ec5\u5f53\u5f53\u524d\u65f6\u95f4\u51cf\u53bb\u521b\u5efa\u65f6\u95f4\u5927\u4e8e `agent_task_task_resend_wait_time_ms` \u65f6\uff0cReportHandler\u53ef\u4ee5\u91cd\u65b0\u53d1\u9001\u4ee3\u7406\u4efb\u52a1\u3002    \n          \n      \n    \n    \n  \n\n\u5efa\u8bae\u589e\u52a0\u8bf4\u660e\u8be5\u8bbe\u7f6e\u89e3\u51b3\u7684\u95ee\u9898\u548c\u6700\u4f73\u5b9e\u8df5", "url": "https://github.com/apache/incubator-doris/pull/4089#discussion_r455108413", "createdAt": "2020-07-15T14:45:44Z", "author": {"login": "morningman"}, "path": "docs/en/administrator-guide/config/fe_config.md", "diffHunk": "@@ -110,6 +110,10 @@ There are two ways to configure FE configuration items:\n \n ## Configurations\n \n+### `agent_task_resend_wait_time_ms`\n+\n+\u5f53\u4ee3\u7406\u4efb\u52a1\u7684\u521b\u5efa\u65f6\u95f4\u88ab\u8bbe\u7f6e\u7684\u65f6\u5019\uff0c\u6b64\u914d\u7f6e\u5c06\u51b3\u5b9a\u662f\u5426\u91cd\u65b0\u53d1\u9001\u4ee3\u7406\u4efb\u52a1\uff0c \u5f53\u4e14\u4ec5\u5f53\u5f53\u524d\u65f6\u95f4\u51cf\u53bb\u521b\u5efa\u65f6\u95f4\u5927\u4e8eagent_task_task_resend_wait_time_ms\u65f6\uff0cReportHandler\u53ef\u4ee5\u91cd\u65b0\u53d1\u9001\u4ee3\u7406\u4efb\u52a1\u3002    ", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "202b2615113a907c95bf53a28af164b621b1402d"}, "originalPosition": 6}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjgzODcwNzY3OnYy", "diffSide": "RIGHT", "path": "fe/src/main/java/org/apache/doris/common/Config.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xNVQxNDo0ODo1NlrOGyBwpA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xNVQxNDo0ODo1NlrOGyBwpA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NTExMDgyMA==", "bodyText": "This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters. Learn more about bidirectional Unicode characters\n\n\n  \n\n\n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                @ConfField\n          \n          \n            \n                @ConfField (mutable = true, masterOnly = true)", "url": "https://github.com/apache/incubator-doris/pull/4089#discussion_r455110820", "createdAt": "2020-07-15T14:48:56Z", "author": {"login": "morningman"}, "path": "fe/src/main/java/org/apache/doris/common/Config.java", "diffHunk": "@@ -1117,5 +1117,13 @@\n      */\n     @ConfField\n     public static String thrift_server_type = ThriftServer.THREAD_POOL;\n+\n+    /**\n+     * This config will decide whether to resend agent task when create_time for agent_task is set,\n+     * only when current_time - create_time > agent_task_resend_wait_time_ms can ReportHandler do resend agent task\n+     */\n+    @ConfField", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "202b2615113a907c95bf53a28af164b621b1402d"}, "originalPosition": 9}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1193, "cost": 1, "resetAt": "2021-11-12T09:44:50Z"}}}