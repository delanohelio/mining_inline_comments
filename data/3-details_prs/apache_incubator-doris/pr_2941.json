{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0Mzc2OTQxNDQ3", "number": 2941, "title": "drop index when index column is dropped", "bodyText": "", "createdAt": "2020-02-19T03:16:13Z", "url": "https://github.com/apache/incubator-doris/pull/2941", "merged": true, "mergeCommit": {"oid": "ceaa7907930a590439a53b3dbbe65ea18602d341"}, "closed": true, "closedAt": "2020-02-19T09:57:28Z", "author": {"login": "yangzhg"}, "timelineItems": {"totalCount": 6, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcFt5iugFqTM2MDgyMDM2MQ==", "endCursor": "Y3Vyc29yOnYyOpPPAAABcFzgmOAFqTM2MDk3NTg1MQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzYwODIwMzYx", "url": "https://github.com/apache/incubator-doris/pull/2941#pullrequestreview-360820361", "createdAt": "2020-02-19T03:23:50Z", "commit": {"oid": "319d19cd03f724e4bf87f0bcd08cd399a42092cf"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xOVQwMzoyMzo1MVrOFrZ9vA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xOVQwMzoyNDoxMFrOFrZ-Bg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MTA1ODQ5Mg==", "bodyText": "If the column is dropped, all type of index should be dropped, so here should not add this if clause.", "url": "https://github.com/apache/incubator-doris/pull/2941#discussion_r381058492", "createdAt": "2020-02-19T03:23:51Z", "author": {"login": "kangpinghuang"}, "path": "fe/src/main/java/org/apache/doris/alter/SchemaChangeHandler.java", "diffHunk": "@@ -224,7 +225,17 @@ private void processDropColumn(DropColumnClause alterClause, OlapTable olapTable\n                 }\n             }\n         }\n-        \n+\n+        Iterator<Index> it = indexes.iterator();\n+        while(it.hasNext()){\n+            Index index = it.next();\n+            if(index.getIndexType() == IndexDef.IndexType.BITMAP", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "319d19cd03f724e4bf87f0bcd08cd399a42092cf"}, "originalPosition": 26}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MTA1ODU2Ng==", "bodyText": "add some comment for this argments.", "url": "https://github.com/apache/incubator-doris/pull/2941#discussion_r381058566", "createdAt": "2020-02-19T03:24:10Z", "author": {"login": "kangpinghuang"}, "path": "fe/src/main/java/org/apache/doris/alter/SchemaChangeHandler.java", "diffHunk": "@@ -157,7 +158,7 @@ private void processAddColumns(AddColumnsClause alterClause, OlapTable olapTable\n     }\n \n     private void processDropColumn(DropColumnClause alterClause, OlapTable olapTable,\n-                                  Map<Long, LinkedList<Column>> indexSchemaMap) throws DdlException {\n+                                  Map<Long, LinkedList<Column>> indexSchemaMap, List<Index> indexes) throws DdlException {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "319d19cd03f724e4bf87f0bcd08cd399a42092cf"}, "originalPosition": 13}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "319d19cd03f724e4bf87f0bcd08cd399a42092cf", "author": {"user": {"login": "yangzhg", "name": "Zhengguo Yang"}}, "url": "https://github.com/apache/incubator-doris/commit/319d19cd03f724e4bf87f0bcd08cd399a42092cf", "committedDate": "2020-02-19T03:15:38Z", "message": "drop index when index column is dropped"}, "afterCommit": {"oid": "aedc403f55206c0c50e75afa58643afeb803ef77", "author": {"user": {"login": "yangzhg", "name": "Zhengguo Yang"}}, "url": "https://github.com/apache/incubator-doris/commit/aedc403f55206c0c50e75afa58643afeb803ef77", "committedDate": "2020-02-19T03:28:10Z", "message": "drop index when index column is dropped"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "d6e36075a617a3da2ab203537e31a9d54fbf0ed4", "author": {"user": {"login": "yangzhg", "name": "Zhengguo Yang"}}, "url": "https://github.com/apache/incubator-doris/commit/d6e36075a617a3da2ab203537e31a9d54fbf0ed4", "committedDate": "2020-02-19T03:32:12Z", "message": "drop index when index column is dropped"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "aedc403f55206c0c50e75afa58643afeb803ef77", "author": {"user": {"login": "yangzhg", "name": "Zhengguo Yang"}}, "url": "https://github.com/apache/incubator-doris/commit/aedc403f55206c0c50e75afa58643afeb803ef77", "committedDate": "2020-02-19T03:28:10Z", "message": "drop index when index column is dropped"}, "afterCommit": {"oid": "d6e36075a617a3da2ab203537e31a9d54fbf0ed4", "author": {"user": {"login": "yangzhg", "name": "Zhengguo Yang"}}, "url": "https://github.com/apache/incubator-doris/commit/d6e36075a617a3da2ab203537e31a9d54fbf0ed4", "committedDate": "2020-02-19T03:32:12Z", "message": "drop index when index column is dropped"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzYwODgyMjg0", "url": "https://github.com/apache/incubator-doris/pull/2941#pullrequestreview-360882284", "createdAt": "2020-02-19T07:11:55Z", "commit": {"oid": "d6e36075a617a3da2ab203537e31a9d54fbf0ed4"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzYwOTc1ODUx", "url": "https://github.com/apache/incubator-doris/pull/2941#pullrequestreview-360975851", "createdAt": "2020-02-19T09:56:28Z", "commit": {"oid": "d6e36075a617a3da2ab203537e31a9d54fbf0ed4"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3819, "cost": 1, "resetAt": "2021-10-28T17:48:14Z"}}}