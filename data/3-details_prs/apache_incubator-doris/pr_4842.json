{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTE0ODMwNDMw", "number": 4842, "title": "[Bug][SQL] Fix bug that query failed when SQL contains Union and Colocate join", "bodyText": "Proposed changes\nSQL like:\nselect a join b union select c join d;\nif both a/b and c/d are colocate join, the query may failed with error like:\nfailed to get tablet. tablet_id=26846, with schema_hash=398972982, reason=tablet does not exist\nThis is because when assigning exec host for fragment, the planner failed to distinguish which scan nodes\nbelong to the certain fragment. So it may choose the wrong host for scan range.\nTypes of changes\n\n Bugfix (non-breaking change which fixes an issue)\n\nChecklist\n\n[] I have create an issue on (Fix #4841), and have described the bug/feature there in detail", "createdAt": "2020-11-03T15:55:01Z", "url": "https://github.com/apache/incubator-doris/pull/4842", "merged": true, "mergeCommit": {"oid": "bde84e4ae5d0597343e9dfb52a27e00c2d520137"}, "closed": true, "closedAt": "2020-11-05T12:57:12Z", "author": {"login": "morningman"}, "timelineItems": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdY7IbEgH2gAyNTE0ODMwNDMwOjQwNjcyM2UyZGQ1YmEzMGE1NGViYjk3YjBjODlhMmE4NWFkYWNiYTU=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdZIFuRAFqTUyMzA4MDM1Mw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "406723e2dd5ba30a54ebb97b0c89a2a85adacba5", "author": {"user": {"login": "morningman", "name": "Mingyu Chen"}}, "url": "https://github.com/apache/incubator-doris/commit/406723e2dd5ba30a54ebb97b0c89a2a85adacba5", "committedDate": "2020-11-03T15:45:01Z", "message": "[Bug][SQL] Fix bug that query failed when SQL contains Union and Colocate Join.\n\nSQL like:\n`select a join b union select c join d`;\n\nif a b is colocate join, and c d is also colocate join, the query may failed\nwith error like:\n\n`failed to get tablet. tablet_id=26846, with schema_hash=398972982, reason=tablet does not exist`"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a7c33635bb324663d805c26311cab8bbf9a97af6", "author": {"user": {"login": "morningman", "name": "Mingyu Chen"}}, "url": "https://github.com/apache/incubator-doris/commit/a7c33635bb324663d805c26311cab8bbf9a97af6", "committedDate": "2020-11-04T02:14:24Z", "message": "fix ut"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTIzMDA5MzEy", "url": "https://github.com/apache/incubator-doris/pull/4842#pullrequestreview-523009312", "createdAt": "2020-11-04T02:47:08Z", "commit": {"oid": "a7c33635bb324663d805c26311cab8bbf9a97af6"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTIzMDgwMzUz", "url": "https://github.com/apache/incubator-doris/pull/4842#pullrequestreview-523080353", "createdAt": "2020-11-04T06:50:50Z", "commit": {"oid": "a7c33635bb324663d805c26311cab8bbf9a97af6"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wNFQwNjo1MDo1MFrOHtK-cQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wNFQwNjo1MDo1MFrOHtK-cQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNzEyNzc5Mw==", "bodyText": "Maybe bucketSeqToScanRang should be a map like fragmentIdToSeqToAddressMap to solve this problem is a\nbetter understanding  way\uff1f", "url": "https://github.com/apache/incubator-doris/pull/4842#discussion_r517127793", "createdAt": "2020-11-04T06:50:50Z", "author": {"login": "HappenLee"}, "path": "fe/fe-core/src/main/java/org/apache/doris/qe/Coordinator.java", "diffHunk": "@@ -1140,17 +1141,26 @@ private long getScanRangeLength(final TScanRange scanRange) {\n \n     private void computeColocateJoinInstanceParam(PlanFragmentId fragmentId, int parallelExecInstanceNum, FragmentExecParams params) {\n         Map<Integer, TNetworkAddress> bucketSeqToAddress = fragmentIdToSeqToAddressMap.get(fragmentId);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "a7c33635bb324663d805c26311cab8bbf9a97af6"}, "originalPosition": 11}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4820, "cost": 1, "resetAt": "2021-10-28T18:00:02Z"}}}