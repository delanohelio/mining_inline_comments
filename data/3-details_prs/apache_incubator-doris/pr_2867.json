{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0MzcyODI4OTE2", "number": 2867, "title": "Fix bug that _min_percentage_of_error_disk was not initialized", "bodyText": "In StorageEngine, the member _min_percentage_of_error_disk was not\ninitialized (so it defaults to 0), which causes the process to exit\nwhenever one disk fails.\nWhat we expect is that exit the process only when the number of\nfailed disks reach a certain percentage.\nAlso, this variable should mean the maximum percentage of\nerror disks allowed, not the minimum, so change the configuration\nname to max_percentage_of_error_disk", "createdAt": "2020-02-09T13:31:16Z", "url": "https://github.com/apache/incubator-doris/pull/2867", "merged": true, "mergeCommit": {"oid": "c89d0a090c86c05cb7c957836561b18c373d6342"}, "closed": true, "closedAt": "2020-02-10T08:58:26Z", "author": {"login": "lingbin"}, "timelineItems": {"totalCount": 7, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcCok-NgH2gAyMzcyODI4OTE2OjVmZTU1ZThhNDljNDYzNmJkOGI3OTBmZjMzMjA1OTE1MDViZjMxN2I=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcC5NTZgFqTM1NTc2NzA0Ng==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "5fe55e8a49c4636bd8b790ff3320591505bf317b", "author": {"user": {"login": "lingbin", "name": "LingBin"}}, "url": "https://github.com/apache/incubator-doris/commit/5fe55e8a49c4636bd8b790ff3320591505bf317b", "committedDate": "2020-02-09T13:30:31Z", "message": "Fix bug that _min_percentage_of_error_disk was not initialized\n\nIn `StorageEngine`, the member `_min_percentage_of_error_disk` was not\ninitialized (so it defaults to 0), which causes the process to exit\nwhenever one disk fails.\n\nWhat we expect is that exit the process only when the number of\nfailed disks reach a certain percentage.\n\nAlso, this variable should mean the maximum percentage of\nerror disks allowed, not the minimum, so change the configuration\nname to `max_percentage_of_error_disk`"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzU1NjA5NTcy", "url": "https://github.com/apache/incubator-doris/pull/2867#pullrequestreview-355609572", "createdAt": "2020-02-09T14:09:13Z", "commit": {"oid": "5fe55e8a49c4636bd8b790ff3320591505bf317b"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0wOVQxNDowOToxM1rOFnVP3A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0wOVQxNDowOToxM1rOFnVP3A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3Njc4NjkwOA==", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                bool _too_many_disks_are_broken(uint32_t unused_num, uint32_t total_num);\n          \n          \n            \n                bool _check_disks_broken_percentage(uint32_t unused_num, uint32_t total_num);", "url": "https://github.com/apache/incubator-doris/pull/2867#discussion_r376786908", "createdAt": "2020-02-09T14:09:13Z", "author": {"login": "kangkaisen"}, "path": "be/src/olap/storage_engine.h", "diffHunk": "@@ -225,7 +224,7 @@ class StorageEngine {\n \n     OLAPStatus _judge_and_update_effective_cluster_id(int32_t cluster_id);\n \n-    OLAPStatus _start_bg_worker();\n+    bool _too_many_disks_are_broken(uint32_t unused_num, uint32_t total_num);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "5fe55e8a49c4636bd8b790ff3320591505bf317b"}, "originalPosition": 64}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzU1NjU0NTAy", "url": "https://github.com/apache/incubator-doris/pull/2867#pullrequestreview-355654502", "createdAt": "2020-02-10T01:20:54Z", "commit": {"oid": "5fe55e8a49c4636bd8b790ff3320591505bf317b"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xMFQwMToyMDo1NFrOFnYTUQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xMFQwMToyMDo1NFrOFnYTUQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NjgzNjk0NQ==", "bodyText": "How about set the default to 0 to make it strict, so that we won't miss the broken disks", "url": "https://github.com/apache/incubator-doris/pull/2867#discussion_r376836945", "createdAt": "2020-02-10T01:20:54Z", "author": {"login": "morningman"}, "path": "be/src/common/config.h", "diffHunk": "@@ -203,7 +203,8 @@ namespace config {\n     CONF_Int32(disk_stat_monitor_interval, \"5\");\n     CONF_Int32(unused_rowset_monitor_interval, \"30\");\n     CONF_String(storage_root_path, \"${DORIS_HOME}/storage\");\n-    CONF_Int32(min_percentage_of_error_disk, \"50\");\n+    // BE process will exit if the percentage of error disk reach this value.\n+    CONF_Int32(max_percentage_of_error_disk, \"50\");", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "5fe55e8a49c4636bd8b790ff3320591505bf317b"}, "originalPosition": 6}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "039ba38d2dd88ca532bf89c92ab88ed8b11a0301", "author": {"user": {"login": "lingbin", "name": "LingBin"}}, "url": "https://github.com/apache/incubator-doris/commit/039ba38d2dd88ca532bf89c92ab88ed8b11a0301", "committedDate": "2020-02-10T02:23:20Z", "message": "make max_percentage_of_error_disk conf default to 0"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzU1NjgxNDIz", "url": "https://github.com/apache/incubator-doris/pull/2867#pullrequestreview-355681423", "createdAt": "2020-02-10T03:59:34Z", "commit": {"oid": "039ba38d2dd88ca532bf89c92ab88ed8b11a0301"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xMFQwMzo1OTozNFrOFnZuBA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xMFQwMzo1OTozNFrOFnZuBA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3Njg2MDE2NA==", "bodyText": "_too_many_disks_on_failure()", "url": "https://github.com/apache/incubator-doris/pull/2867#discussion_r376860164", "createdAt": "2020-02-10T03:59:34Z", "author": {"login": "chaoyli"}, "path": "be/src/olap/storage_engine.h", "diffHunk": "@@ -225,7 +224,7 @@ class StorageEngine {\n \n     OLAPStatus _judge_and_update_effective_cluster_id(int32_t cluster_id);\n \n-    OLAPStatus _start_bg_worker();\n+    bool _too_many_disks_are_broken(uint32_t unused_num, uint32_t total_num);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3Njc4NjkwOA=="}, "originalCommit": {"oid": "5fe55e8a49c4636bd8b790ff3320591505bf317b"}, "originalPosition": 64}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "de867b0014b8d415e207697ec4f16bf302bafe67", "author": {"user": {"login": "lingbin", "name": "LingBin"}}, "url": "https://github.com/apache/incubator-doris/commit/de867b0014b8d415e207697ec4f16bf302bafe67", "committedDate": "2020-02-10T08:00:31Z", "message": "Change method name to `too_many_disks_are_failed()`"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzU1NzY3MDQ2", "url": "https://github.com/apache/incubator-doris/pull/2867#pullrequestreview-355767046", "createdAt": "2020-02-10T08:53:03Z", "commit": {"oid": "de867b0014b8d415e207697ec4f16bf302bafe67"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3728, "cost": 1, "resetAt": "2021-10-28T17:48:14Z"}}}