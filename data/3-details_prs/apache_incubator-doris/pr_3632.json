{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDE5ODY4NDY2", "number": 3632, "title": "Add ignore config to determine whether to continue to start be when load tablet from header failed.", "bodyText": "Add  config ignore_load_tablet_failure to determine whether to continue to start be when load tablet from header failed.\nFix #3633", "createdAt": "2020-05-19T04:24:47Z", "url": "https://github.com/apache/incubator-doris/pull/3632", "merged": true, "mergeCommit": {"oid": "6be7a6232fd52cba9c9ac32e054d3ffc76210eb0"}, "closed": true, "closedAt": "2020-05-20T01:40:51Z", "author": {"login": "yangzhg"}, "timelineItems": {"totalCount": 7, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcislxLgH2gAyNDE5ODY4NDY2OjNlMWMzYzk2ZDk3NWU0MDUxZGVkYzAzODU1MDQxMTIyY2E4MTA1Mjg=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcizRhKAFqTQxNDM3NTI3Nw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "3e1c3c96d975e4051dedc03855041122ca810528", "author": {"user": {"login": "yangzhg", "name": "Zhengguo Yang"}}, "url": "https://github.com/apache/incubator-doris/commit/3e1c3c96d975e4051dedc03855041122ca810528", "committedDate": "2020-05-19T04:16:35Z", "message": "add config to determine whether to continue to start be when load tablet from header failed."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "6261bef464ff8d79239f4dc9972fd9cfb5addc43", "author": {"user": {"login": "yangzhg", "name": "Zhengguo Yang"}}, "url": "https://github.com/apache/incubator-doris/commit/6261bef464ff8d79239f4dc9972fd9cfb5addc43", "committedDate": "2020-05-19T04:21:54Z", "message": "add docs"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDE0MTA1MzQ4", "url": "https://github.com/apache/incubator-doris/pull/3632#pullrequestreview-414105348", "createdAt": "2020-05-19T05:09:22Z", "commit": {"oid": "6261bef464ff8d79239f4dc9972fd9cfb5addc43"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xOVQwNTowOToyMlrOGXQCxQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xOVQwNTowOToyMlrOGXQCxQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNzAzMzI4NQ==", "bodyText": "There may be thousands of tablets. This time the log is very large.\nIn addition, the problematic tablet has actually been printed in the log, so there is no need to print the tablet id. Just print size is enough", "url": "https://github.com/apache/incubator-doris/pull/3632#discussion_r427033285", "createdAt": "2020-05-19T05:09:22Z", "author": {"login": "morningman"}, "path": "be/src/olap/data_dir.cpp", "diffHunk": "@@ -694,19 +694,26 @@ OLAPStatus DataDir::load() {\n     // create tablet from tablet meta and add it to tablet mgr\n     LOG(INFO) << \"begin loading tablet from meta\";\n     std::set<int64_t> tablet_ids;\n-    auto load_tablet_func = [this, &tablet_ids](int64_t tablet_id, int32_t schema_hash,\n+    std::set<int64_t> failed_tablet_ids;\n+    auto load_tablet_func = [this, &tablet_ids, &failed_tablet_ids](int64_t tablet_id, int32_t schema_hash,\n                                                 const std::string& value) -> bool {\n         OLAPStatus status = _tablet_manager->load_tablet_from_meta(this, tablet_id, schema_hash,\n                                                                    value, false, false);\n         if (status != OLAP_SUCCESS) {\n             LOG(WARNING) << \"load tablet from header failed. status:\" << status\n                          << \", tablet=\" << tablet_id << \".\" << schema_hash;\n+            failed_tablet_ids.insert(tablet_id);\n         } else {\n             tablet_ids.insert(tablet_id);\n         }\n         return true;\n     };\n     OLAPStatus load_tablet_status = TabletMetaManager::traverse_headers(_meta, load_tablet_func);\n+    if (failed_tablet_ids.size() != 0 && !config::ignore_load_tablet_failure) {\n+        std::stringstream ss;\n+        std::copy(failed_tablet_ids.begin(), failed_tablet_ids.end(), std::ostream_iterator<int64_t>(ss, \",\"));", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "6261bef464ff8d79239f4dc9972fd9cfb5addc43"}, "originalPosition": 22}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "515c930362f0f21c5fa0ca23d25efcdd03873d19", "author": {"user": {"login": "yangzhg", "name": "Zhengguo Yang"}}, "url": "https://github.com/apache/incubator-doris/commit/515c930362f0f21c5fa0ca23d25efcdd03873d19", "committedDate": "2020-05-19T06:45:32Z", "message": "remove log"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "96a4151ea56fbeac1687064528ae1a1eafadf2ae", "author": {"user": {"login": "yangzhg", "name": "Zhengguo Yang"}}, "url": "https://github.com/apache/incubator-doris/commit/96a4151ea56fbeac1687064528ae1a1eafadf2ae", "committedDate": "2020-05-19T06:46:37Z", "message": "remove log"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDE0MzE2Njcw", "url": "https://github.com/apache/incubator-doris/pull/3632#pullrequestreview-414316670", "createdAt": "2020-05-19T10:36:10Z", "commit": {"oid": "96a4151ea56fbeac1687064528ae1a1eafadf2ae"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDE0Mzc1Mjc3", "url": "https://github.com/apache/incubator-doris/pull/3632#pullrequestreview-414375277", "createdAt": "2020-05-19T12:03:47Z", "commit": {"oid": "96a4151ea56fbeac1687064528ae1a1eafadf2ae"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xOVQxMjowMzo0OFrOGXdJZA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xOVQxMjowMzo0OFrOGXdJZA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNzI0Nzk3Mg==", "bodyText": "\u52a0\u5728--\u52a0\u8f7d", "url": "https://github.com/apache/incubator-doris/pull/3632#discussion_r427247972", "createdAt": "2020-05-19T12:03:48Z", "author": {"login": "wutiangan"}, "path": "docs/zh-CN/administrator-guide/config/be_config.md", "diffHunk": "@@ -396,3 +396,8 @@ under the License.\n ### `webserver_port`\n \n ### `write_buffer_size`\n+\n+### ignore_load_tablet_failure\n+* \u7c7b\u578b\uff1a\u5e03\u5c14\n+* \u63cf\u8ff0\uff1a\u7528\u6765\u51b3\u5b9a\u5728\u6709tablet \u52a0\u5728\u5931\u8d25\u7684\u60c5\u51b5\u4e0b\u662f\u5426\u5ffd\u7565\u9519\u8bef\uff0c\u7ee7\u7eed\u542f\u52a8be", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "96a4151ea56fbeac1687064528ae1a1eafadf2ae"}, "originalPosition": 7}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2685, "cost": 1, "resetAt": "2021-10-28T17:48:14Z"}}}