{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDE3MTcxNDc2", "number": 3577, "title": "[Fix]SlotRef.tosql() is the same as the SQL returned by different sql", "bodyText": "Describe the bug\n\nselect distinct ss_sold_date_sk as sk from store_sales order by sk limit 100;\nselect distinct ss_item_sk as sk from store_sales order by sk limit 100;\nInvoke FE SelectStmt.toSql()\uff0creturn the same result\uff1a\nSELECT DISTINCT <slot 2> AS sk FROM default_cluster:tpcds.store_sales ORDER BY sk ASC LIMIT 100\nBecause label in SlotRef corresponding to distinct function is null, SQL is output in the form of slot + number. When label is null, desc.getsourceexprs() is obtained to get the column name\n\nModified effect\n\nSQL1\uff1aSELECT DISTINCT <slot 2>  ss_sold_date_sk AS sk FROM default_cluster:tpcds.store_sales ORDER BY sk ASC LIMIT 100\nSQL2\uff1aSELECT DISTINCT <slot 2>  ss_item_sk AS sk FROM default_cluster:tpcds.store_sales ORDER BY sk ASC LIMIT 100\n#3555", "createdAt": "2020-05-13T07:27:47Z", "url": "https://github.com/apache/incubator-doris/pull/3577", "merged": true, "mergeCommit": {"oid": "62f746fc87b521c98bb41631202f99bb3c92d9a2"}, "closed": true, "closedAt": "2020-05-18T02:41:16Z", "author": {"login": "marising"}, "timelineItems": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcgzbY6AH2gAyNDE3MTcxNDc2OmY5ZjNhODRlOWQ1NGNiZTBkOTdkNmQ2NWJmYzJmYTlmYTE2NmI1ODk=", "endCursor": "Y3Vyc29yOnYyOpPPAAABch10B_gFqTQxMzA3Mjk0Ng==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "f9f3a84e9d54cbe0d97d6d65bfc2fa9fa166b589", "author": {"user": {"login": "marising", "name": "HaiBo Li"}}, "url": "https://github.com/apache/incubator-doris/commit/f9f3a84e9d54cbe0d97d6d65bfc2fa9fa166b589", "committedDate": "2020-05-13T07:06:44Z", "message": "fixed bug:SlotRef.tosql() is the same as the SQL returned by different SQL"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDExODQ4NjM1", "url": "https://github.com/apache/incubator-doris/pull/3577#pullrequestreview-411848635", "createdAt": "2020-05-14T14:15:19Z", "commit": {"oid": "f9f3a84e9d54cbe0d97d6d65bfc2fa9fa166b589"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xNFQxNDoxNToxOVrOGVeXoA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xNFQxNDoxNToxOVrOGVeXoA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNTE3MDg0OA==", "bodyText": "How about return both slot id and expr. I'm afraid that slot id may be used for some tracing debug.\nAnd please fix all related unit tests after you change here.", "url": "https://github.com/apache/incubator-doris/pull/3577#discussion_r425170848", "createdAt": "2020-05-14T14:15:19Z", "author": {"login": "morningman"}, "path": "fe/src/main/java/org/apache/doris/analysis/SlotRef.java", "diffHunk": "@@ -162,6 +162,12 @@ public String toSqlImpl() {\n             return tblName.toSql() + \".\" + label + sb.toString();\n         } else if (label != null) {\n             return label + sb.toString();\n+        } else if (desc.getSourceExprs() != null) {\n+            for (Expr expr : desc.getSourceExprs()) {\n+                sb.append(expr.toSql());\n+                sb.append(\" \");\n+            }\n+            return sb.toString();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f9f3a84e9d54cbe0d97d6d65bfc2fa9fa166b589"}, "originalPosition": 9}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "4217db00d3a7fa912492d1edb2fbd9ef314bf5fc", "author": {"user": {"login": "marising", "name": "HaiBo Li"}}, "url": "https://github.com/apache/incubator-doris/commit/4217db00d3a7fa912492d1edb2fbd9ef314bf5fc", "committedDate": "2020-05-15T09:31:25Z", "message": "Tosql method returns slot index and column name"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDEzMDcyOTQ2", "url": "https://github.com/apache/incubator-doris/pull/3577#pullrequestreview-413072946", "createdAt": "2020-05-16T12:27:23Z", "commit": {"oid": "4217db00d3a7fa912492d1edb2fbd9ef314bf5fc"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2622, "cost": 1, "resetAt": "2021-10-28T17:48:14Z"}}}