{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDY3NDEzNzc0", "number": 4347, "reviewThreads": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xM1QxNDo0Mjo1OFrOEYFhYw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xM1QxNDo0NjoyOFrOEYFnjA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjkzNjkxNzQ3OnYy", "diffSide": "RIGHT", "path": "docs/zh-CN/sql-reference/sql-functions/string-functions/str_replace.md", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xM1QxNDo0Mjo1OFrOHAO01A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xNFQwMTozNjowN1rOHAkuvQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MDAwNDk0OA==", "bodyText": "In MySQL, this function named replace(), so better to name it as replace()", "url": "https://github.com/apache/incubator-doris/pull/4347#discussion_r470004948", "createdAt": "2020-08-13T14:42:58Z", "author": {"login": "morningman"}, "path": "docs/zh-CN/sql-reference/sql-functions/string-functions/str_replace.md", "diffHunk": "@@ -0,0 +1,46 @@\n+---\n+{\n+    \"title\": \"str_replace\",", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "1a15f533098eec6708121004ef835d111dc374f3"}, "originalPosition": 3}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MDM2MzgzNw==", "bodyText": "replace is a keyword has been used by sql syntax analysis.", "url": "https://github.com/apache/incubator-doris/pull/4347#discussion_r470363837", "createdAt": "2020-08-14T01:36:07Z", "author": {"login": "xinghuayu007"}, "path": "docs/zh-CN/sql-reference/sql-functions/string-functions/str_replace.md", "diffHunk": "@@ -0,0 +1,46 @@\n+---\n+{\n+    \"title\": \"str_replace\",", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MDAwNDk0OA=="}, "originalCommit": {"oid": "1a15f533098eec6708121004ef835d111dc374f3"}, "originalPosition": 3}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjkzNjkxODQ5OnYy", "diffSide": "RIGHT", "path": "docs/en/sql-reference/sql-functions/string-functions/str_replace.md", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xM1QxNDo0MzoxMlrOHAO1eg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xM1QxNDo0MzoxMlrOHAO1eg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MDAwNTExNA==", "bodyText": "This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters. Learn more about bidirectional Unicode characters\n\n\n  \n\n\n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            ##keyword\n          \n          \n            \n            ## keyword", "url": "https://github.com/apache/incubator-doris/pull/4347#discussion_r470005114", "createdAt": "2020-08-13T14:43:12Z", "author": {"login": "morningman"}, "path": "docs/en/sql-reference/sql-functions/string-functions/str_replace.md", "diffHunk": "@@ -0,0 +1,46 @@\n+---\n+{\n+    \"title\": \"str_replace\",\n+    \"language\": \"zh-CN\"\n+}\n+---\n+\n+<!--\n+Licensed to the Apache Software Foundation (ASF) under one\n+or more contributor license agreements.  See the NOTICE file\n+distributed with this work for additional information\n+regarding copyright ownership.  The ASF licenses this file\n+to you under the Apache License, Version 2.0 (the\n+\"License\"); you may not use this file except in compliance\n+with the License.  You may obtain a copy of the License at\n+\n+  http://www.apache.org/licenses/LICENSE-2.0\n+\n+Unless required by applicable law or agreed to in writing,\n+software distributed under the License is distributed on an\n+\"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n+KIND, either express or implied.  See the License for the\n+specific language governing permissions and limitations\n+under the License.\n+-->\n+\n+# str_replace\n+## description\n+### Syntax\n+\n+`VARCHAR STR_REPLACE (VARCHAR str, VARCHAR old, VARCHAR new)`\n+\n+replace all old substring with new substring in str \n+\n+## example\n+\n+```\n+mysql> select str_replace(\"http://www.baidu.com:9090\", \"9090\", \"\");\n++------------------------------------------------------+\n+| str_replace('http://www.baidu.com:9090', '9090', '') |\n++------------------------------------------------------+\n+| http://www.baidu.com:                                |\n++------------------------------------------------------+\n+```\n+##keyword", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "1a15f533098eec6708121004ef835d111dc374f3"}, "originalPosition": 45}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjkzNjkyNjk0OnYy", "diffSide": "RIGHT", "path": "be/src/exprs/string_functions.cpp", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xM1QxNDo0NTowMlrOHAO6tg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xM1QxNDo0NTowMlrOHAO6tg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MDAwNjQ1NA==", "bodyText": "Should return null if any of them is null", "url": "https://github.com/apache/incubator-doris/pull/4347#discussion_r470006454", "createdAt": "2020-08-13T14:45:02Z", "author": {"login": "morningman"}, "path": "be/src/exprs/string_functions.cpp", "diffHunk": "@@ -998,4 +998,23 @@ StringVal StringFunctions::split_part(FunctionContext* context, const StringVal&\n     int len = (find[field.val - 1] == -1 ? content.len : find[field.val - 1]) - start_pos;\n     return StringVal(content.ptr + start_pos, len);\n }\n+\n+StringVal StringFunctions::str_replace(FunctionContext *context, const StringVal &origStr, const StringVal &oldStr, const StringVal &newStr) {\n+    if (origStr.is_null || oldStr.is_null || newStr.is_null) {\n+        return origStr;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "1a15f533098eec6708121004ef835d111dc374f3"}, "originalPosition": 7}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjkzNjkzMzI0OnYy", "diffSide": "RIGHT", "path": "be/test/exprs/string_functions_test.cpp", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xM1QxNDo0NjoyOFrOHAO-sQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xM1QxNDo0NjoyOFrOHAO-sQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MDAwNzQ3Mw==", "bodyText": "Better to add more tests to test to corner case, like null, empty string, expr2 longer than expr1, Chinese char, etc...", "url": "https://github.com/apache/incubator-doris/pull/4347#discussion_r470007473", "createdAt": "2020-08-13T14:46:28Z", "author": {"login": "morningman"}, "path": "be/test/exprs/string_functions_test.cpp", "diffHunk": "@@ -494,6 +494,19 @@ TEST_F(StringFunctionsTest, rpad) {\n     ASSERT_EQ(StringVal(\"\u5475\u5475hih\"),\n               StringFunctions::rpad(ctx, StringVal(\"\u5475\u5475\"), IntVal(5), StringVal(\"hi\")));\n }\n+\n+TEST_F(StringFunctionsTest, str_replace) {\n+    ASSERT_EQ(StringVal(\"http://www.baidu.com:8080\"),\n+            StringFunctions::str_replace(ctx, StringVal(\"http://www.baidu.com:9090\"), StringVal(\"9090\"), StringVal(\"8080\")));\n+\n+    ASSERT_EQ(StringVal(\"http://www.baidu.com:9090\"),\n+        StringFunctions::str_replace(ctx, StringVal(\"http://www.baidu.com:9090\"), StringVal(\"9070\"), StringVal(\"8080\")));\n+    ASSERT_EQ(StringVal(\"http://www.baidu.com:9090\"),\n+        StringFunctions::str_replace(ctx, StringVal(\"http://www.baidu.com:9090\"), StringVal(\"\"), StringVal(\"8080\")));\n+    ASSERT_EQ(StringVal(\"http://www.baidu.com:\"),\n+        StringFunctions::str_replace(ctx, StringVal(\"http://www.baidu.com:9090\"), StringVal(\"9090\"), StringVal(\"\")));", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "1a15f533098eec6708121004ef835d111dc374f3"}, "originalPosition": 14}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1131, "cost": 1, "resetAt": "2021-11-12T09:44:50Z"}}}