{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDE0NzU1NzMw", "number": 3513, "reviewThreads": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wOFQwMzoxOTo0OVrOD6fx4Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wOVQwNDoyOTozOFrOD61M5Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjYyNjY0NjczOnYy", "diffSide": "RIGHT", "path": "be/src/exec/es/es_scroll_parser.cpp", "isResolved": true, "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wOFQwMzoxOTo0OVrOGSXmbw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wOFQwNDozNDoxOVrOGSYtJA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMTkxNDIyMw==", "bodyText": "maybe _size should be total ? currently, the _size = inner_hits.size()", "url": "https://github.com/apache/incubator-doris/pull/3513#discussion_r421914223", "createdAt": "2020-05-08T03:19:49Z", "author": {"login": "wuyunfeng"}, "path": "be/src/exec/es/es_scroll_parser.cpp", "diffHunk": "@@ -275,7 +286,32 @@ int ScrollParser::get_total() {\n Status ScrollParser::fill_tuple(const TupleDescriptor* tuple_desc, \n             Tuple* tuple, MemPool* tuple_pool, bool* line_eof, const std::map<std::string, std::string>& docvalue_context) {\n     *line_eof = true;\n+\n     if (_size <= 0 || _line_index >= _size) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "4ffb70c5d97690809bf77bf50cab49a5081a8d15"}, "originalPosition": 37}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMTkxNzc0Mg==", "bodyText": "maybe _size should be total ? currently, the _size = inner_hits.size()\n\ni don't think so.\nThis problem is mainly triggered when _size = 0 and _total > 0\u3002if use _total\uff0cparser() will return OK() and _size remain 0, the problem would not exist.", "url": "https://github.com/apache/incubator-doris/pull/3513#discussion_r421917742", "createdAt": "2020-05-08T03:34:05Z", "author": {"login": "blackfox1983"}, "path": "be/src/exec/es/es_scroll_parser.cpp", "diffHunk": "@@ -275,7 +286,32 @@ int ScrollParser::get_total() {\n Status ScrollParser::fill_tuple(const TupleDescriptor* tuple_desc, \n             Tuple* tuple, MemPool* tuple_pool, bool* line_eof, const std::map<std::string, std::string>& docvalue_context) {\n     *line_eof = true;\n+\n     if (_size <= 0 || _line_index >= _size) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMTkxNDIyMw=="}, "originalCommit": {"oid": "4ffb70c5d97690809bf77bf50cab49a5081a8d15"}, "originalPosition": 37}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMTkzMjMyNA==", "bodyText": "Maybe the concept size should keep consistent with before", "url": "https://github.com/apache/incubator-doris/pull/3513#discussion_r421932324", "createdAt": "2020-05-08T04:34:19Z", "author": {"login": "wuyunfeng"}, "path": "be/src/exec/es/es_scroll_parser.cpp", "diffHunk": "@@ -275,7 +286,32 @@ int ScrollParser::get_total() {\n Status ScrollParser::fill_tuple(const TupleDescriptor* tuple_desc, \n             Tuple* tuple, MemPool* tuple_pool, bool* line_eof, const std::map<std::string, std::string>& docvalue_context) {\n     *line_eof = true;\n+\n     if (_size <= 0 || _line_index >= _size) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMTkxNDIyMw=="}, "originalCommit": {"oid": "4ffb70c5d97690809bf77bf50cab49a5081a8d15"}, "originalPosition": 37}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjYzMDE1NTIzOnYy", "diffSide": "RIGHT", "path": "be/src/exec/es/es_scroll_parser.cpp", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wOVQwNDoyNjo1OFrOGS4ZRA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wOVQwNDoyNjo1OFrOGS4ZRA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMjQ1MTUyNA==", "bodyText": "This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters. Learn more about bidirectional Unicode characters\n\n\n  \n\n\n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                    // _fields(doc_value) is fetched from E.S.\n          \n          \n            \n                    // _fields(doc_value) is fetched from ES", "url": "https://github.com/apache/incubator-doris/pull/3513#discussion_r422451524", "createdAt": "2020-05-09T04:26:58Z", "author": {"login": "wuyunfeng"}, "path": "be/src/exec/es/es_scroll_parser.cpp", "diffHunk": "@@ -275,7 +286,32 @@ int ScrollParser::get_total() {\n Status ScrollParser::fill_tuple(const TupleDescriptor* tuple_desc, \n             Tuple* tuple, MemPool* tuple_pool, bool* line_eof, const std::map<std::string, std::string>& docvalue_context) {\n     *line_eof = true;\n+\n     if (_size <= 0 || _line_index >= _size) {\n+        // _source is fetched from E.S.\n+        if (!_use_doc_value) {\n+            return Status::OK();\n+        }\n+        \n+        // _fields(doc_value) is fetched from E.S.", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "89b5f93fc62287a7eefccc64062bf58f5199de75"}, "originalPosition": 43}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjYzMDE1NTQzOnYy", "diffSide": "RIGHT", "path": "be/src/exec/es/es_scroll_parser.cpp", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wOVQwNDoyNzozNVrOGS4ZYA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wOVQwNDoyNzozNVrOGS4ZYA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMjQ1MTU1Mg==", "bodyText": "This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters. Learn more about bidirectional Unicode characters\n\n\n  \n\n\n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                    // here is operations for `enable_doc_value_scan`.\n          \n          \n            \n                    // here is operations for `use_doc_value`.", "url": "https://github.com/apache/incubator-doris/pull/3513#discussion_r422451552", "createdAt": "2020-05-09T04:27:35Z", "author": {"login": "wuyunfeng"}, "path": "be/src/exec/es/es_scroll_parser.cpp", "diffHunk": "@@ -275,7 +286,32 @@ int ScrollParser::get_total() {\n Status ScrollParser::fill_tuple(const TupleDescriptor* tuple_desc, \n             Tuple* tuple, MemPool* tuple_pool, bool* line_eof, const std::map<std::string, std::string>& docvalue_context) {\n     *line_eof = true;\n+\n     if (_size <= 0 || _line_index >= _size) {\n+        // _source is fetched from E.S.\n+        if (!_use_doc_value) {\n+            return Status::OK();\n+        }\n+        \n+        // _fields(doc_value) is fetched from E.S.\n+        if (_total <= 0 || _line_index >= _total) {\n+            return Status::OK();\n+        }\n+       \n+       \n+        // here is operations for `enable_doc_value_scan`.", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "89b5f93fc62287a7eefccc64062bf58f5199de75"}, "originalPosition": 49}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjYzMDE1NjUzOnYy", "diffSide": "RIGHT", "path": "be/src/exec/es/es_scroll_parser.h", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wOVQwNDoyOTozOFrOGS4Z5A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wOVQwNDoyOTozOFrOGS4Z5A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMjQ1MTY4NA==", "bodyText": "maybe use doc_value_mode is more suitable\uff1f\nin future, we can use different parser for _source or doc_value mode", "url": "https://github.com/apache/incubator-doris/pull/3513#discussion_r422451684", "createdAt": "2020-05-09T04:29:38Z", "author": {"login": "wuyunfeng"}, "path": "be/src/exec/es/es_scroll_parser.h", "diffHunk": "@@ -50,5 +50,7 @@ class ScrollParser {\n \n     rapidjson::Document _document_node;\n     rapidjson::Value _inner_hits_node;\n+\n+    bool _use_doc_value;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "89b5f93fc62287a7eefccc64062bf58f5199de75"}, "originalPosition": 14}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1765, "cost": 1, "resetAt": "2021-11-12T09:44:50Z"}}}