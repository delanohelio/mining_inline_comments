{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0MzYwODI2MDEw", "number": 2718, "reviewThreads": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0xNFQwODo0MDo1OFrODXxJ-A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0xNFQwODo1MTo1OFrODXxU0Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjI2MjQ5MjA4OnYy", "diffSide": "RIGHT", "path": "fe/src/main/java/org/apache/doris/analysis/ShowTransactionStmt.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0xNFQwODo0MDo1OFrOFdPnYA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0xNFQxMzo0NToyNlrOFdX7Pw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NjIwODg2NA==", "bodyText": "analyzeWhereClause", "url": "https://github.com/apache/incubator-doris/pull/2718#discussion_r366208864", "createdAt": "2020-01-14T08:40:58Z", "author": {"login": "EmmyMiao87"}, "path": "fe/src/main/java/org/apache/doris/analysis/ShowTransactionStmt.java", "diffHunk": "@@ -0,0 +1,151 @@\n+// Licensed to the Apache Software Foundation (ASF) under one\n+// or more contributor license agreements.  See the NOTICE file\n+// distributed with this work for additional information\n+// regarding copyright ownership.  The ASF licenses this file\n+// to you under the Apache License, Version 2.0 (the\n+// \"License\"); you may not use this file except in compliance\n+// with the License.  You may obtain a copy of the License at\n+//\n+//   http://www.apache.org/licenses/LICENSE-2.0\n+//\n+// Unless required by applicable law or agreed to in writing,\n+// software distributed under the License is distributed on an\n+// \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n+// KIND, either express or implied.  See the License for the\n+// specific language governing permissions and limitations\n+// under the License.\n+\n+package org.apache.doris.analysis;\n+\n+import org.apache.doris.analysis.BinaryPredicate.Operator;\n+import org.apache.doris.catalog.Column;\n+import org.apache.doris.catalog.ScalarType;\n+import org.apache.doris.cluster.ClusterNamespace;\n+import org.apache.doris.common.AnalysisException;\n+import org.apache.doris.common.ErrorCode;\n+import org.apache.doris.common.ErrorReport;\n+import org.apache.doris.common.UserException;\n+import org.apache.doris.common.proc.TransProcDir;\n+import org.apache.doris.qe.ShowResultSetMetaData;\n+\n+import com.google.common.base.Strings;\n+\n+import org.apache.logging.log4j.LogManager;\n+import org.apache.logging.log4j.Logger;\n+\n+// syntax:\n+//      SHOW TRANSACTION  WHERE id=123\n+public class ShowTransactionStmt extends ShowStmt {\n+    private static final Logger LOG = LogManager.getLogger(ShowTransactionStmt.class);\n+\n+    private String dbName;\n+    private Expr whereClause;\n+    private long txnId;\n+\n+    public ShowTransactionStmt(String dbName, Expr whereClause) {\n+        this.dbName = dbName;\n+        this.whereClause = whereClause;\n+    }\n+\n+    public String getDbName() {\n+        return dbName;\n+    }\n+\n+    public long getTxnId() {\n+        return txnId;\n+    }\n+\n+    @Override\n+    public void analyze(Analyzer analyzer) throws AnalysisException, UserException {\n+        super.analyze(analyzer);\n+\n+        if (Strings.isNullOrEmpty(dbName)) {\n+            dbName = analyzer.getDefaultDb();\n+            if (Strings.isNullOrEmpty(dbName)) {\n+                ErrorReport.reportAnalysisException(ErrorCode.ERR_NO_DB_ERROR);\n+            }\n+        } else {\n+            dbName = ClusterNamespace.getFullName(getClusterName(), dbName);\n+        }\n+\n+        if (whereClause == null) {\n+            throw new AnalysisException(\"Missing transaction id\");\n+        }\n+\n+        analyzeSubPredicate(whereClause);\n+    }\n+\n+    private void analyzeSubPredicate(Expr subExpr) throws AnalysisException {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "cfded321a7eb17dbeebf4e098e633432d40dd43e"}, "originalPosition": 78}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NjM0NTAyMw==", "bodyText": "ok", "url": "https://github.com/apache/incubator-doris/pull/2718#discussion_r366345023", "createdAt": "2020-01-14T13:45:26Z", "author": {"login": "morningman"}, "path": "fe/src/main/java/org/apache/doris/analysis/ShowTransactionStmt.java", "diffHunk": "@@ -0,0 +1,151 @@\n+// Licensed to the Apache Software Foundation (ASF) under one\n+// or more contributor license agreements.  See the NOTICE file\n+// distributed with this work for additional information\n+// regarding copyright ownership.  The ASF licenses this file\n+// to you under the Apache License, Version 2.0 (the\n+// \"License\"); you may not use this file except in compliance\n+// with the License.  You may obtain a copy of the License at\n+//\n+//   http://www.apache.org/licenses/LICENSE-2.0\n+//\n+// Unless required by applicable law or agreed to in writing,\n+// software distributed under the License is distributed on an\n+// \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n+// KIND, either express or implied.  See the License for the\n+// specific language governing permissions and limitations\n+// under the License.\n+\n+package org.apache.doris.analysis;\n+\n+import org.apache.doris.analysis.BinaryPredicate.Operator;\n+import org.apache.doris.catalog.Column;\n+import org.apache.doris.catalog.ScalarType;\n+import org.apache.doris.cluster.ClusterNamespace;\n+import org.apache.doris.common.AnalysisException;\n+import org.apache.doris.common.ErrorCode;\n+import org.apache.doris.common.ErrorReport;\n+import org.apache.doris.common.UserException;\n+import org.apache.doris.common.proc.TransProcDir;\n+import org.apache.doris.qe.ShowResultSetMetaData;\n+\n+import com.google.common.base.Strings;\n+\n+import org.apache.logging.log4j.LogManager;\n+import org.apache.logging.log4j.Logger;\n+\n+// syntax:\n+//      SHOW TRANSACTION  WHERE id=123\n+public class ShowTransactionStmt extends ShowStmt {\n+    private static final Logger LOG = LogManager.getLogger(ShowTransactionStmt.class);\n+\n+    private String dbName;\n+    private Expr whereClause;\n+    private long txnId;\n+\n+    public ShowTransactionStmt(String dbName, Expr whereClause) {\n+        this.dbName = dbName;\n+        this.whereClause = whereClause;\n+    }\n+\n+    public String getDbName() {\n+        return dbName;\n+    }\n+\n+    public long getTxnId() {\n+        return txnId;\n+    }\n+\n+    @Override\n+    public void analyze(Analyzer analyzer) throws AnalysisException, UserException {\n+        super.analyze(analyzer);\n+\n+        if (Strings.isNullOrEmpty(dbName)) {\n+            dbName = analyzer.getDefaultDb();\n+            if (Strings.isNullOrEmpty(dbName)) {\n+                ErrorReport.reportAnalysisException(ErrorCode.ERR_NO_DB_ERROR);\n+            }\n+        } else {\n+            dbName = ClusterNamespace.getFullName(getClusterName(), dbName);\n+        }\n+\n+        if (whereClause == null) {\n+            throw new AnalysisException(\"Missing transaction id\");\n+        }\n+\n+        analyzeSubPredicate(whereClause);\n+    }\n+\n+    private void analyzeSubPredicate(Expr subExpr) throws AnalysisException {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NjIwODg2NA=="}, "originalCommit": {"oid": "cfded321a7eb17dbeebf4e098e633432d40dd43e"}, "originalPosition": 78}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjI2MjUxMTIwOnYy", "diffSide": "RIGHT", "path": "fe/src/main/java/org/apache/doris/analysis/ShowTransactionStmt.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0xNFQwODo0ODozN1rOFdPzQQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0xNFQxMzo0NTowNFrOFdX6eA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NjIxMTkwNQ==", "bodyText": "if the stmt is where 1=id?", "url": "https://github.com/apache/incubator-doris/pull/2718#discussion_r366211905", "createdAt": "2020-01-14T08:48:37Z", "author": {"login": "EmmyMiao87"}, "path": "fe/src/main/java/org/apache/doris/analysis/ShowTransactionStmt.java", "diffHunk": "@@ -0,0 +1,151 @@\n+// Licensed to the Apache Software Foundation (ASF) under one\n+// or more contributor license agreements.  See the NOTICE file\n+// distributed with this work for additional information\n+// regarding copyright ownership.  The ASF licenses this file\n+// to you under the Apache License, Version 2.0 (the\n+// \"License\"); you may not use this file except in compliance\n+// with the License.  You may obtain a copy of the License at\n+//\n+//   http://www.apache.org/licenses/LICENSE-2.0\n+//\n+// Unless required by applicable law or agreed to in writing,\n+// software distributed under the License is distributed on an\n+// \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n+// KIND, either express or implied.  See the License for the\n+// specific language governing permissions and limitations\n+// under the License.\n+\n+package org.apache.doris.analysis;\n+\n+import org.apache.doris.analysis.BinaryPredicate.Operator;\n+import org.apache.doris.catalog.Column;\n+import org.apache.doris.catalog.ScalarType;\n+import org.apache.doris.cluster.ClusterNamespace;\n+import org.apache.doris.common.AnalysisException;\n+import org.apache.doris.common.ErrorCode;\n+import org.apache.doris.common.ErrorReport;\n+import org.apache.doris.common.UserException;\n+import org.apache.doris.common.proc.TransProcDir;\n+import org.apache.doris.qe.ShowResultSetMetaData;\n+\n+import com.google.common.base.Strings;\n+\n+import org.apache.logging.log4j.LogManager;\n+import org.apache.logging.log4j.Logger;\n+\n+// syntax:\n+//      SHOW TRANSACTION  WHERE id=123\n+public class ShowTransactionStmt extends ShowStmt {\n+    private static final Logger LOG = LogManager.getLogger(ShowTransactionStmt.class);\n+\n+    private String dbName;\n+    private Expr whereClause;\n+    private long txnId;\n+\n+    public ShowTransactionStmt(String dbName, Expr whereClause) {\n+        this.dbName = dbName;\n+        this.whereClause = whereClause;\n+    }\n+\n+    public String getDbName() {\n+        return dbName;\n+    }\n+\n+    public long getTxnId() {\n+        return txnId;\n+    }\n+\n+    @Override\n+    public void analyze(Analyzer analyzer) throws AnalysisException, UserException {\n+        super.analyze(analyzer);\n+\n+        if (Strings.isNullOrEmpty(dbName)) {\n+            dbName = analyzer.getDefaultDb();\n+            if (Strings.isNullOrEmpty(dbName)) {\n+                ErrorReport.reportAnalysisException(ErrorCode.ERR_NO_DB_ERROR);\n+            }\n+        } else {\n+            dbName = ClusterNamespace.getFullName(getClusterName(), dbName);\n+        }\n+\n+        if (whereClause == null) {\n+            throw new AnalysisException(\"Missing transaction id\");\n+        }\n+\n+        analyzeSubPredicate(whereClause);\n+    }\n+\n+    private void analyzeSubPredicate(Expr subExpr) throws AnalysisException {\n+        if (subExpr == null) {\n+            return;\n+        }\n+\n+        boolean valid = true;\n+        CHECK: {\n+            if (subExpr instanceof BinaryPredicate) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "cfded321a7eb17dbeebf4e098e633432d40dd43e"}, "originalPosition": 85}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NjM0NDgyNA==", "bodyText": "Not support it~", "url": "https://github.com/apache/incubator-doris/pull/2718#discussion_r366344824", "createdAt": "2020-01-14T13:45:04Z", "author": {"login": "morningman"}, "path": "fe/src/main/java/org/apache/doris/analysis/ShowTransactionStmt.java", "diffHunk": "@@ -0,0 +1,151 @@\n+// Licensed to the Apache Software Foundation (ASF) under one\n+// or more contributor license agreements.  See the NOTICE file\n+// distributed with this work for additional information\n+// regarding copyright ownership.  The ASF licenses this file\n+// to you under the Apache License, Version 2.0 (the\n+// \"License\"); you may not use this file except in compliance\n+// with the License.  You may obtain a copy of the License at\n+//\n+//   http://www.apache.org/licenses/LICENSE-2.0\n+//\n+// Unless required by applicable law or agreed to in writing,\n+// software distributed under the License is distributed on an\n+// \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n+// KIND, either express or implied.  See the License for the\n+// specific language governing permissions and limitations\n+// under the License.\n+\n+package org.apache.doris.analysis;\n+\n+import org.apache.doris.analysis.BinaryPredicate.Operator;\n+import org.apache.doris.catalog.Column;\n+import org.apache.doris.catalog.ScalarType;\n+import org.apache.doris.cluster.ClusterNamespace;\n+import org.apache.doris.common.AnalysisException;\n+import org.apache.doris.common.ErrorCode;\n+import org.apache.doris.common.ErrorReport;\n+import org.apache.doris.common.UserException;\n+import org.apache.doris.common.proc.TransProcDir;\n+import org.apache.doris.qe.ShowResultSetMetaData;\n+\n+import com.google.common.base.Strings;\n+\n+import org.apache.logging.log4j.LogManager;\n+import org.apache.logging.log4j.Logger;\n+\n+// syntax:\n+//      SHOW TRANSACTION  WHERE id=123\n+public class ShowTransactionStmt extends ShowStmt {\n+    private static final Logger LOG = LogManager.getLogger(ShowTransactionStmt.class);\n+\n+    private String dbName;\n+    private Expr whereClause;\n+    private long txnId;\n+\n+    public ShowTransactionStmt(String dbName, Expr whereClause) {\n+        this.dbName = dbName;\n+        this.whereClause = whereClause;\n+    }\n+\n+    public String getDbName() {\n+        return dbName;\n+    }\n+\n+    public long getTxnId() {\n+        return txnId;\n+    }\n+\n+    @Override\n+    public void analyze(Analyzer analyzer) throws AnalysisException, UserException {\n+        super.analyze(analyzer);\n+\n+        if (Strings.isNullOrEmpty(dbName)) {\n+            dbName = analyzer.getDefaultDb();\n+            if (Strings.isNullOrEmpty(dbName)) {\n+                ErrorReport.reportAnalysisException(ErrorCode.ERR_NO_DB_ERROR);\n+            }\n+        } else {\n+            dbName = ClusterNamespace.getFullName(getClusterName(), dbName);\n+        }\n+\n+        if (whereClause == null) {\n+            throw new AnalysisException(\"Missing transaction id\");\n+        }\n+\n+        analyzeSubPredicate(whereClause);\n+    }\n+\n+    private void analyzeSubPredicate(Expr subExpr) throws AnalysisException {\n+        if (subExpr == null) {\n+            return;\n+        }\n+\n+        boolean valid = true;\n+        CHECK: {\n+            if (subExpr instanceof BinaryPredicate) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NjIxMTkwNQ=="}, "originalCommit": {"oid": "cfded321a7eb17dbeebf4e098e633432d40dd43e"}, "originalPosition": 85}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjI2MjUxMzAzOnYy", "diffSide": "RIGHT", "path": "fe/src/main/java/org/apache/doris/qe/StmtExecutor.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0xNFQwODo0OToyNFrOFdP0bQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0xNFQxMzo0Njo1NlrOFdX-Gw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NjIxMjIwNQ==", "bodyText": "StringBuilder.append()", "url": "https://github.com/apache/incubator-doris/pull/2718#discussion_r366212205", "createdAt": "2020-01-14T08:49:24Z", "author": {"login": "EmmyMiao87"}, "path": "fe/src/main/java/org/apache/doris/qe/StmtExecutor.java", "diffHunk": "@@ -692,37 +697,36 @@ private void handleInsertStmt() throws Exception {\n             throwable = t;\n         }\n \n-        // record insert info for show load stmt if\n-        // 1. NOT a streaming insert(deprecated)\n-        // 2. using_old_load_usage_pattern is set to true, means a label will be returned for user to show load.\n-        // 3. has filtered rows. so a label should be returned for user to show\n-        // 4. user specify a label for insert stmt\n-        if (!insertStmt.isStreaming() || Config.using_old_load_usage_pattern || filteredRows > 0 || insertStmt.isUserSpecifiedLabel()) {\n-            try {\n-                context.getCatalog().getLoadManager().recordFinishedLoadJob(\n-                        label,\n-                        insertStmt.getDb(),\n-                        insertStmt.getTargetTable().getId(),\n-                        EtlJobType.INSERT,\n-                        createTime,\n-                        throwable == null ? \"\" : throwable.getMessage(),\n-                        coord.getTrackingUrl()\n-                );\n-            } catch (MetaNotFoundException e) {\n-                LOG.warn(\"Record info of insert load with error {}\", e.getMessage(), e);\n-                context.getState().setError(\"Failed to record info of insert load job, but insert job is \"\n-                        + (throwable == null ? \"success\" : \"failed\"));\n-                return;\n-            }\n+        // Go here, which means:\n+        // 1. transaction is finished successfully (COMMITTED or VISIBLE), or\n+        // 2. transaction failed but Config.using_old_load_usage_pattern is true.\n+        // we will record the load job info for these 2 cases\n \n-            // set to OK, which means the insert load job is successfully submitted.\n-            // and user can check the job's status by label.\n-            context.getState().setOk(loadedRows, filteredRows, \"{'label':'\" + label + \"'}\");\n-        } else {\n-            // just return OK without label, which means this job is successfully done without any error.\n-            Preconditions.checkState(loadedRows > 0 && filteredRows == 0);\n-            context.getState().setOk(loadedRows, filteredRows, null);\n-        }\n+        String errMsg = \"\";\n+        try {\n+            context.getCatalog().getLoadManager().recordFinishedLoadJob(\n+                    label,\n+                    insertStmt.getDb(),\n+                    insertStmt.getTargetTable().getId(),\n+                    EtlJobType.INSERT,\n+                    createTime,\n+                    throwable == null ? \"\" : throwable.getMessage(),\n+                    coord.getTrackingUrl());\n+        } catch (MetaNotFoundException e) {\n+            LOG.warn(\"Record info of insert load with error {}\", e.getMessage(), e);\n+            errMsg = \"Record info of insert load with error \" + e.getMessage();\n+        }\n+\n+        // {'label':'my_label1', 'status':'visible', 'txnId':'123'}\n+        // {'label':'my_label1', 'status':'visible', 'txnId':'123' 'err':'error messages'}\n+        String info = \"{'label':'\" + label + \"', 'status':'\" + txnStatus.name() + \"', 'txnId':'\"", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "cfded321a7eb17dbeebf4e098e633432d40dd43e"}, "originalPosition": 104}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NjM0NTc1NQ==", "bodyText": "ok", "url": "https://github.com/apache/incubator-doris/pull/2718#discussion_r366345755", "createdAt": "2020-01-14T13:46:56Z", "author": {"login": "morningman"}, "path": "fe/src/main/java/org/apache/doris/qe/StmtExecutor.java", "diffHunk": "@@ -692,37 +697,36 @@ private void handleInsertStmt() throws Exception {\n             throwable = t;\n         }\n \n-        // record insert info for show load stmt if\n-        // 1. NOT a streaming insert(deprecated)\n-        // 2. using_old_load_usage_pattern is set to true, means a label will be returned for user to show load.\n-        // 3. has filtered rows. so a label should be returned for user to show\n-        // 4. user specify a label for insert stmt\n-        if (!insertStmt.isStreaming() || Config.using_old_load_usage_pattern || filteredRows > 0 || insertStmt.isUserSpecifiedLabel()) {\n-            try {\n-                context.getCatalog().getLoadManager().recordFinishedLoadJob(\n-                        label,\n-                        insertStmt.getDb(),\n-                        insertStmt.getTargetTable().getId(),\n-                        EtlJobType.INSERT,\n-                        createTime,\n-                        throwable == null ? \"\" : throwable.getMessage(),\n-                        coord.getTrackingUrl()\n-                );\n-            } catch (MetaNotFoundException e) {\n-                LOG.warn(\"Record info of insert load with error {}\", e.getMessage(), e);\n-                context.getState().setError(\"Failed to record info of insert load job, but insert job is \"\n-                        + (throwable == null ? \"success\" : \"failed\"));\n-                return;\n-            }\n+        // Go here, which means:\n+        // 1. transaction is finished successfully (COMMITTED or VISIBLE), or\n+        // 2. transaction failed but Config.using_old_load_usage_pattern is true.\n+        // we will record the load job info for these 2 cases\n \n-            // set to OK, which means the insert load job is successfully submitted.\n-            // and user can check the job's status by label.\n-            context.getState().setOk(loadedRows, filteredRows, \"{'label':'\" + label + \"'}\");\n-        } else {\n-            // just return OK without label, which means this job is successfully done without any error.\n-            Preconditions.checkState(loadedRows > 0 && filteredRows == 0);\n-            context.getState().setOk(loadedRows, filteredRows, null);\n-        }\n+        String errMsg = \"\";\n+        try {\n+            context.getCatalog().getLoadManager().recordFinishedLoadJob(\n+                    label,\n+                    insertStmt.getDb(),\n+                    insertStmt.getTargetTable().getId(),\n+                    EtlJobType.INSERT,\n+                    createTime,\n+                    throwable == null ? \"\" : throwable.getMessage(),\n+                    coord.getTrackingUrl());\n+        } catch (MetaNotFoundException e) {\n+            LOG.warn(\"Record info of insert load with error {}\", e.getMessage(), e);\n+            errMsg = \"Record info of insert load with error \" + e.getMessage();\n+        }\n+\n+        // {'label':'my_label1', 'status':'visible', 'txnId':'123'}\n+        // {'label':'my_label1', 'status':'visible', 'txnId':'123' 'err':'error messages'}\n+        String info = \"{'label':'\" + label + \"', 'status':'\" + txnStatus.name() + \"', 'txnId':'\"", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NjIxMjIwNQ=="}, "originalCommit": {"oid": "cfded321a7eb17dbeebf4e098e633432d40dd43e"}, "originalPosition": 104}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjI2MjUxOTg1OnYy", "diffSide": "RIGHT", "path": "fe/src/main/java/org/apache/doris/transaction/GlobalTransactionMgr.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0xNFQwODo1MTo1OFrOFdP4rA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0xNFQxMzo0ODowM1rOFdYANQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NjIxMzI5Mg==", "bodyText": "precondition?", "url": "https://github.com/apache/incubator-doris/pull/2718#discussion_r366213292", "createdAt": "2020-01-14T08:51:58Z", "author": {"login": "EmmyMiao87"}, "path": "fe/src/main/java/org/apache/doris/transaction/GlobalTransactionMgr.java", "diffHunk": "@@ -1220,6 +1214,63 @@ private void updateDBRunningTxnNum(TransactionStatus preStatus, TransactionState\n         return infos;\n     }\n     \n+    // get show info of a specified txnId\n+    public List<List<String>> getSingleTranInfo(long dbId, long txnId) throws AnalysisException {\n+        List<List<String>> infos = new ArrayList<List<String>>();\n+        readLock();\n+        try {\n+            Database db = Catalog.getInstance().getDb(dbId);\n+            if (db == null) {\n+                throw new AnalysisException(\"Database[\" + dbId + \"] does not exist\");\n+            }\n+            \n+            TransactionState txnState = idToTransactionState.get(txnId);\n+            if (txnState == null) {\n+                throw new AnalysisException(\"transaction with id \" + txnId + \" does not exist\");\n+            }\n+            \n+            if (ConnectContext.get() != null) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "cfded321a7eb17dbeebf4e098e633432d40dd43e"}, "originalPosition": 77}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NjM0NjI5Mw==", "bodyText": "This method may be called internal, not in user connection thread. So I just add a judgement here.", "url": "https://github.com/apache/incubator-doris/pull/2718#discussion_r366346293", "createdAt": "2020-01-14T13:48:03Z", "author": {"login": "morningman"}, "path": "fe/src/main/java/org/apache/doris/transaction/GlobalTransactionMgr.java", "diffHunk": "@@ -1220,6 +1214,63 @@ private void updateDBRunningTxnNum(TransactionStatus preStatus, TransactionState\n         return infos;\n     }\n     \n+    // get show info of a specified txnId\n+    public List<List<String>> getSingleTranInfo(long dbId, long txnId) throws AnalysisException {\n+        List<List<String>> infos = new ArrayList<List<String>>();\n+        readLock();\n+        try {\n+            Database db = Catalog.getInstance().getDb(dbId);\n+            if (db == null) {\n+                throw new AnalysisException(\"Database[\" + dbId + \"] does not exist\");\n+            }\n+            \n+            TransactionState txnState = idToTransactionState.get(txnId);\n+            if (txnState == null) {\n+                throw new AnalysisException(\"transaction with id \" + txnId + \" does not exist\");\n+            }\n+            \n+            if (ConnectContext.get() != null) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NjIxMzI5Mg=="}, "originalCommit": {"oid": "cfded321a7eb17dbeebf4e098e633432d40dd43e"}, "originalPosition": 77}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2320, "cost": 1, "resetAt": "2021-11-12T09:44:50Z"}}}