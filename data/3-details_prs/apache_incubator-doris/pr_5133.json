{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTQ0NjQwNTY2", "number": 5133, "title": "[Enhancement] Optimize the algorithm of selecting host for a bucket scan task when a backend not alive", "bodyText": "Proposed changes\nWhen query uses bucket join, fuction Coordinator#BucketShuffleJoinController#getExecHostPortForFragmentIDAndBucketSeq is responseful for making sure each host have average bucket to scan. That means if there are 10 buckets to scan and 5 hosts, the strategy will distributed 2 buckets to each host. The algorithm is like this:\na. use data structure buckendIdToBucketCountMap to represents how many buckets distributed to the backend\uff1b\nb. traverse every backend, find a backend which owns minimum buckets. We call it mini_backend;\nc. distribute the bucket to the  mini_backend;\nd. update  buckendIdToBucketCountMap for mini_backend;\nWhen all bakends are all alive, the algorithm is available. But when mini_backend is not alive, it will chose a replica host as final host randomly and buckendIdToBucketCountMap is not updated. This will cause the bucket scan task not load balance.\nThis patch optimize the algorithm. When the mini_backend is not alive, update buckendIdToBucketCountMap.\nRelated Issue: #5132\nTypes of changes\nWhat types of changes does your code introduce to Doris?\nPut an x in the boxes that apply\n\n Bugfix (non-breaking change which fixes an issue)\n[] New feature (non-breaking change which adds functionality)\n[] Breaking change (fix or feature that would cause existing functionality to not work as expected)\n[] Documentation Update (if none of the other choices apply)\n[] Code refactor (Modify the code structure, format the code, etc...)\n\nChecklist\nPut an x in the boxes that apply. You can also fill these out after creating the PR. If you're unsure about any of them, don't hesitate to ask. We're here to help! This is simply a reminder of what we are going to look for before merging your code.\n\n I have create an issue on (Fix #ISSUE), and have described the bug/feature there in detail\n Compiling and unit tests pass locally with my changes\n I have added tests that prove my fix is effective or that my feature works\n If this change need a document change, I have updated the document\n Any dependent changes have been merged\n\nFurther comments\nIf this is a relatively large or complex change, kick off the discussion at dev@doris.apache.org by explaining why you chose the solution you did and what alternatives you considered, etc...", "createdAt": "2020-12-23T08:15:22Z", "url": "https://github.com/apache/incubator-doris/pull/5133", "merged": true, "mergeCommit": {"oid": "1035e86e0bc568b9c54e823919aa247baf40faae"}, "closed": true, "closedAt": "2021-01-06T02:20:16Z", "author": {"login": "xinghuayu007"}, "timelineItems": {"totalCount": 52, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABc-gnhXgH2gAyNTQ0NjQwNTY2OjFhMTVmNTMzMDk4ZWVjNjcwODEyMTAwNGVmODM1ZDExMWRjMzc0ZjM=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdtV-eCAFqTU2MjI4MTc5OA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "1a15f533098eec6708121004ef835d111dc374f3", "author": {"user": null}, "url": "https://github.com/apache/incubator-doris/commit/1a15f533098eec6708121004ef835d111dc374f3", "committedDate": "2020-08-13T14:09:31Z", "message": "udf: replace function"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "7d072b9a65d555e7e710cb5140435e00a8ff7bdc", "author": {"user": null}, "url": "https://github.com/apache/incubator-doris/commit/7d072b9a65d555e7e710cb5140435e00a8ff7bdc", "committedDate": "2020-08-14T01:37:05Z", "message": "Merge remote-tracking branch 'upstream/master' into str_replace"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "391158f52190755b5fc621c31bf703835c0a7b3b", "author": {"user": null}, "url": "https://github.com/apache/incubator-doris/commit/391158f52190755b5fc621c31bf703835c0a7b3b", "committedDate": "2020-08-14T02:11:25Z", "message": "udf: replace function"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "5eb52e1e5742d2e9f7aae5ac8da81545ae5f3df2", "author": {"user": null}, "url": "https://github.com/apache/incubator-doris/commit/5eb52e1e5742d2e9f7aae5ac8da81545ae5f3df2", "committedDate": "2020-08-14T03:58:30Z", "message": "udf: replace function"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a79ea91cf36eec54a4ca54018b92a6fa4baa98cc", "author": {"user": null}, "url": "https://github.com/apache/incubator-doris/commit/a79ea91cf36eec54a4ca54018b92a6fa4baa98cc", "committedDate": "2020-08-18T02:31:52Z", "message": "Merge remote-tracking branch 'upstream/master' into str_replace"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "86f841f29fa4ee19773d6c5922465194a2887cf6", "author": {"user": null}, "url": "https://github.com/apache/incubator-doris/commit/86f841f29fa4ee19773d6c5922465194a2887cf6", "committedDate": "2020-08-18T03:56:14Z", "message": "udf: replace function"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ade1afa75c94a178a6801ba1324acf25ad8b16fe", "author": {"user": null}, "url": "https://github.com/apache/incubator-doris/commit/ade1afa75c94a178a6801ba1324acf25ad8b16fe", "committedDate": "2020-08-18T03:59:59Z", "message": "udf: replace function"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "1d95a491115064c9753694ad4d45c2f72b8d2645", "author": {"user": null}, "url": "https://github.com/apache/incubator-doris/commit/1d95a491115064c9753694ad4d45c2f72b8d2645", "committedDate": "2020-08-18T08:01:45Z", "message": "udf: replace function"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "433eb87f02cfa6740e80b0e4157d916ab5aca400", "author": {"user": null}, "url": "https://github.com/apache/incubator-doris/commit/433eb87f02cfa6740e80b0e4157d916ab5aca400", "committedDate": "2020-08-24T02:03:34Z", "message": "Merge remote-tracking branch 'upstream/master' into str_replace"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c62d239792b174fbc56ab311f0bc5337de971d96", "author": {"user": null}, "url": "https://github.com/apache/incubator-doris/commit/c62d239792b174fbc56ab311f0bc5337de971d96", "committedDate": "2020-08-25T03:17:32Z", "message": "Merge remote-tracking branch 'upstream/master' into str_replace"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "0a8db8cc4e7e72ebad4491a2cd48c758a435ba5c", "author": {"user": null}, "url": "https://github.com/apache/incubator-doris/commit/0a8db8cc4e7e72ebad4491a2cd48c758a435ba5c", "committedDate": "2020-08-25T08:21:34Z", "message": "Merge remote-tracking branch 'upstream/master' into str_replace"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "02d3f863c8556463c8dea903abdc4d21bf1eb19b", "author": {"user": null}, "url": "https://github.com/apache/incubator-doris/commit/02d3f863c8556463c8dea903abdc4d21bf1eb19b", "committedDate": "2020-09-01T01:25:42Z", "message": "Merge remote-tracking branch 'upstream/master' into str_replace"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "41da0ba0109414c47239f3fb926da48540059018", "author": {"user": null}, "url": "https://github.com/apache/incubator-doris/commit/41da0ba0109414c47239f3fb926da48540059018", "committedDate": "2020-09-08T08:25:12Z", "message": "Merge remote-tracking branch 'upstream/master' into str_replace"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "de4e523b505f0d628a16199b88d4bb5a0419fef6", "author": {"user": null}, "url": "https://github.com/apache/incubator-doris/commit/de4e523b505f0d628a16199b88d4bb5a0419fef6", "committedDate": "2020-09-11T02:42:20Z", "message": "Merge remote-tracking branch 'upstream/master' into str_replace"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a863b0dfc7f909bf1ca8ad176ef8f82b1346924f", "author": {"user": null}, "url": "https://github.com/apache/incubator-doris/commit/a863b0dfc7f909bf1ca8ad176ef8f82b1346924f", "committedDate": "2020-09-17T09:37:21Z", "message": "Merge remote-tracking branch 'upstream/master' into str_replace"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "024c422b74829efe4c4b715a014517c7eee1a80a", "author": {"user": null}, "url": "https://github.com/apache/incubator-doris/commit/024c422b74829efe4c4b715a014517c7eee1a80a", "committedDate": "2020-09-22T09:15:31Z", "message": "Merge remote-tracking branch 'upstream/master' into str_replace"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e1656c7a8bdc137261505d8b384dddb1c9bf5a72", "author": {"user": null}, "url": "https://github.com/apache/incubator-doris/commit/e1656c7a8bdc137261505d8b384dddb1c9bf5a72", "committedDate": "2020-09-23T11:48:49Z", "message": "Merge remote-tracking branch 'upstream/master' into str_replace"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "837e037057936e933fd79cbbdb432047be2bba5e", "author": {"user": null}, "url": "https://github.com/apache/incubator-doris/commit/837e037057936e933fd79cbbdb432047be2bba5e", "committedDate": "2020-09-27T06:37:32Z", "message": "Merge remote-tracking branch 'upstream/master' into str_replace"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a36d3e78136a3fefb62f2513d20773479904cb6b", "author": {"user": null}, "url": "https://github.com/apache/incubator-doris/commit/a36d3e78136a3fefb62f2513d20773479904cb6b", "committedDate": "2020-10-17T10:32:25Z", "message": "Merge remote-tracking branch 'upstream/master' into str_replace"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "43cfa2b2ca752118c43a0212cf074f09cb311a7a", "author": {"user": null}, "url": "https://github.com/apache/incubator-doris/commit/43cfa2b2ca752118c43a0212cf074f09cb311a7a", "committedDate": "2020-10-23T14:34:47Z", "message": "Merge remote-tracking branch 'upstream/master' into str_replace"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "641efb587d2e9ac9a9e9771e7648a299a66f3992", "author": {"user": null}, "url": "https://github.com/apache/incubator-doris/commit/641efb587d2e9ac9a9e9771e7648a299a66f3992", "committedDate": "2020-10-24T12:49:28Z", "message": "Merge remote-tracking branch 'upstream/master' into str_replace"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "5066131b9017910473554dfa298b16224c1977da", "author": {"user": null}, "url": "https://github.com/apache/incubator-doris/commit/5066131b9017910473554dfa298b16224c1977da", "committedDate": "2020-10-26T11:49:19Z", "message": "Merge remote-tracking branch 'upstream/master' into str_replace"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "dde044ba251c85b7f0a8a388af71331553208a05", "author": {"user": null}, "url": "https://github.com/apache/incubator-doris/commit/dde044ba251c85b7f0a8a388af71331553208a05", "committedDate": "2020-10-27T08:38:35Z", "message": "Merge remote-tracking branch 'upstream/master' into str_replace"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "8f8c8234c052720bc65e316a305a3297318bd481", "author": {"user": null}, "url": "https://github.com/apache/incubator-doris/commit/8f8c8234c052720bc65e316a305a3297318bd481", "committedDate": "2020-10-28T07:25:25Z", "message": "Merge remote-tracking branch 'upstream/master' into str_replace"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f7704ba989ab5b903e407f7b02c5a9b6c03b4588", "author": {"user": null}, "url": "https://github.com/apache/incubator-doris/commit/f7704ba989ab5b903e407f7b02c5a9b6c03b4588", "committedDate": "2020-11-01T13:04:30Z", "message": "Merge remote-tracking branch 'upstream/master' into str_replace"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "8726e7aefed64e62b1bbf6f56278274f11c8b0fa", "author": {"user": null}, "url": "https://github.com/apache/incubator-doris/commit/8726e7aefed64e62b1bbf6f56278274f11c8b0fa", "committedDate": "2020-11-04T09:31:42Z", "message": "Merge remote-tracking branch 'upstream/master' into str_replace"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "4dfc785c8a97549fb9c38b6dd8ea938d1bb50db4", "author": {"user": null}, "url": "https://github.com/apache/incubator-doris/commit/4dfc785c8a97549fb9c38b6dd8ea938d1bb50db4", "committedDate": "2020-11-06T07:45:49Z", "message": "Merge remote-tracking branch 'upstream/master' into str_replace"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "d4bd91c17af4b4954b2715c5fd93cf86b7351085", "author": {"user": null}, "url": "https://github.com/apache/incubator-doris/commit/d4bd91c17af4b4954b2715c5fd93cf86b7351085", "committedDate": "2020-11-11T02:13:02Z", "message": "Merge remote-tracking branch 'upstream/master' into str_replace"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "2eb8ddf66fb0ffbeaab0e882a5d33483180da351", "author": {"user": null}, "url": "https://github.com/apache/incubator-doris/commit/2eb8ddf66fb0ffbeaab0e882a5d33483180da351", "committedDate": "2020-11-12T02:49:53Z", "message": "Merge remote-tracking branch 'upstream/master' into str_replace"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "5aa7afc57d6cbeb2013a6e8957f214f7abc93e7f", "author": {"user": null}, "url": "https://github.com/apache/incubator-doris/commit/5aa7afc57d6cbeb2013a6e8957f214f7abc93e7f", "committedDate": "2020-11-14T11:19:03Z", "message": "Merge remote-tracking branch 'upstream/master' into str_replace"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ce251b26af3feb6aa49e5e31bee887b0441e8584", "author": {"user": null}, "url": "https://github.com/apache/incubator-doris/commit/ce251b26af3feb6aa49e5e31bee887b0441e8584", "committedDate": "2020-11-17T03:43:59Z", "message": "Merge remote-tracking branch 'upstream/master' into str_replace"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "04c58994a066d51dcaf84657d04a2d6281bf8371", "author": {"user": null}, "url": "https://github.com/apache/incubator-doris/commit/04c58994a066d51dcaf84657d04a2d6281bf8371", "committedDate": "2020-11-18T10:41:11Z", "message": "Merge remote-tracking branch 'upstream/master' into str_replace"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "2e614cf89862a62ccadf96bcc9f94034ebc3a214", "author": {"user": null}, "url": "https://github.com/apache/incubator-doris/commit/2e614cf89862a62ccadf96bcc9f94034ebc3a214", "committedDate": "2020-11-24T08:52:28Z", "message": "Merge remote-tracking branch 'upstream/master' into str_replace"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ede2e000c0fe30022d1dd417f08deb2a4e1c95da", "author": {"user": null}, "url": "https://github.com/apache/incubator-doris/commit/ede2e000c0fe30022d1dd417f08deb2a4e1c95da", "committedDate": "2020-11-25T03:23:03Z", "message": "Merge remote-tracking branch 'upstream/master' into str_replace"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "0aed91fed8b786d2e9860fc5ca0fad95b6810d75", "author": {"user": null}, "url": "https://github.com/apache/incubator-doris/commit/0aed91fed8b786d2e9860fc5ca0fad95b6810d75", "committedDate": "2020-11-26T09:50:24Z", "message": "Merge remote-tracking branch 'upstream/master' into str_replace"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "bd28b736375ece74d76527fa8319c4264356427c", "author": {"user": null}, "url": "https://github.com/apache/incubator-doris/commit/bd28b736375ece74d76527fa8319c4264356427c", "committedDate": "2020-11-30T02:30:06Z", "message": "Merge remote-tracking branch 'upstream/master' into str_replace"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e56e17d3bdd29fdb4018444609740efd2d01e6bc", "author": {"user": null}, "url": "https://github.com/apache/incubator-doris/commit/e56e17d3bdd29fdb4018444609740efd2d01e6bc", "committedDate": "2020-12-10T02:00:09Z", "message": "Merge remote-tracking branch 'upstream/master' into str_replace"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "7d5d011ec036f63ba570e4645176820ca36e6fa8", "author": {"user": null}, "url": "https://github.com/apache/incubator-doris/commit/7d5d011ec036f63ba570e4645176820ca36e6fa8", "committedDate": "2020-12-17T02:30:07Z", "message": "Merge remote-tracking branch 'upstream/master' into str_replace"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b23a76343603edb4533450dbb40404710b6c5b41", "author": {"user": null}, "url": "https://github.com/apache/incubator-doris/commit/b23a76343603edb4533450dbb40404710b6c5b41", "committedDate": "2020-12-23T02:19:12Z", "message": "Merge remote-tracking branch 'upstream/master' into str_replace"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a812808973853d14516eca79a8ffb45eaf1e8c1b", "author": {"user": null}, "url": "https://github.com/apache/incubator-doris/commit/a812808973853d14516eca79a8ffb45eaf1e8c1b", "committedDate": "2020-12-23T07:39:35Z", "message": "optimize bucket hosts select strategy"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTU4NzU3MzQ5", "url": "https://github.com/apache/incubator-doris/pull/5133#pullrequestreview-558757349", "createdAt": "2020-12-25T05:18:31Z", "commit": {"oid": "a812808973853d14516eca79a8ffb45eaf1e8c1b"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0yNVQwNToxODozMVrOILYWHw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0yNVQwNToxODozMVrOILYWHw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0ODgwNDEyNw==", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                                buckendIdToBucketCountMap.put(backendIdRef.getRef(), buckendIdToBucketCountMap.get(backendIdRef.getRef())+1);\n          \n          \n            \n                                buckendIdToBucketCountMap.put(backendIdRef.getRef(), buckendIdToBucketCountMap.get(backendIdRef.getRef()) + 1);", "url": "https://github.com/apache/incubator-doris/pull/5133#discussion_r548804127", "createdAt": "2020-12-25T05:18:31Z", "author": {"login": "caiconghui"}, "path": "fe/fe-core/src/main/java/org/apache/doris/qe/Coordinator.java", "diffHunk": "@@ -1560,14 +1560,20 @@ private void getExecHostPortForFragmentIDAndBucketSeq(TScanRangeLocations seqLoc\n                     break;\n                 }\n             }\n-\n-            buckendIdToBucketCountMap.put(buckendId, buckendIdToBucketCountMap.get(buckendId) + 1);\n             Reference<Long> backendIdRef = new Reference<Long>();\n             TNetworkAddress execHostPort = SimpleScheduler.getHost(buckendId, seqLocation.locations, idToBackend, backendIdRef);\n             if (execHostPort == null) {\n                 throw new UserException(\"there is no scanNode Backend\");\n             }\n-\n+            if (backendIdRef.getRef() != buckendId) {\n+                if (!buckendIdToBucketCountMap.containsKey(backendIdRef.getRef())) {\n+                    buckendIdToBucketCountMap.put(backendIdRef.getRef(), 1);\n+                } else {\n+                    buckendIdToBucketCountMap.put(backendIdRef.getRef(), buckendIdToBucketCountMap.get(backendIdRef.getRef())+1);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "a812808973853d14516eca79a8ffb45eaf1e8c1b"}, "originalPosition": 16}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "1950f9f9ba62084c82c39de2542c2cf9da5bd69e", "author": {"user": null}, "url": "https://github.com/apache/incubator-doris/commit/1950f9f9ba62084c82c39de2542c2cf9da5bd69e", "committedDate": "2020-12-25T07:11:03Z", "message": "format code"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTU4Nzc0NTA2", "url": "https://github.com/apache/incubator-doris/pull/5133#pullrequestreview-558774506", "createdAt": "2020-12-25T07:28:55Z", "commit": {"oid": "1950f9f9ba62084c82c39de2542c2cf9da5bd69e"}, "state": "DISMISSED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b752a168f946469abcea20840a1dc509b3d5c443", "author": {"user": null}, "url": "https://github.com/apache/incubator-doris/commit/b752a168f946469abcea20840a1dc509b3d5c443", "committedDate": "2020-12-31T02:26:40Z", "message": "fix conflict file"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "1c5bddeb847c1a96304b0e15dffa16b834b78462", "author": {"user": null}, "url": "https://github.com/apache/incubator-doris/commit/1c5bddeb847c1a96304b0e15dffa16b834b78462", "committedDate": "2020-12-31T02:34:03Z", "message": "fix conflict file"}, "afterCommit": {"oid": "233aee75d37572ccb13a910512a0ad2ffeada5d3", "author": {"user": null}, "url": "https://github.com/apache/incubator-doris/commit/233aee75d37572ccb13a910512a0ad2ffeada5d3", "committedDate": "2020-12-31T02:35:53Z", "message": "fix conflict file"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "233aee75d37572ccb13a910512a0ad2ffeada5d3", "author": {"user": null}, "url": "https://github.com/apache/incubator-doris/commit/233aee75d37572ccb13a910512a0ad2ffeada5d3", "committedDate": "2020-12-31T02:35:53Z", "message": "fix conflict file"}, "afterCommit": {"oid": "409a35930eceb4f48b80b49da6f6592aaf8265af", "author": {"user": null}, "url": "https://github.com/apache/incubator-doris/commit/409a35930eceb4f48b80b49da6f6592aaf8265af", "committedDate": "2020-12-31T02:41:23Z", "message": "fix conflict file"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "95c3421186966ef0335c6cbf835cc83f72370cea", "author": {"user": null}, "url": "https://github.com/apache/incubator-doris/commit/95c3421186966ef0335c6cbf835cc83f72370cea", "committedDate": "2020-12-31T02:43:47Z", "message": "fix conflict file"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "409a35930eceb4f48b80b49da6f6592aaf8265af", "author": {"user": null}, "url": "https://github.com/apache/incubator-doris/commit/409a35930eceb4f48b80b49da6f6592aaf8265af", "committedDate": "2020-12-31T02:41:23Z", "message": "fix conflict file"}, "afterCommit": {"oid": "95c3421186966ef0335c6cbf835cc83f72370cea", "author": {"user": null}, "url": "https://github.com/apache/incubator-doris/commit/95c3421186966ef0335c6cbf835cc83f72370cea", "committedDate": "2020-12-31T02:43:47Z", "message": "fix conflict file"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTYwNjc1Mjcy", "url": "https://github.com/apache/incubator-doris/pull/5133#pullrequestreview-560675272", "createdAt": "2021-01-03T07:49:38Z", "commit": {"oid": "95c3421186966ef0335c6cbf835cc83f72370cea"}, "state": "COMMENTED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTYwOTk4NjE4", "url": "https://github.com/apache/incubator-doris/pull/5133#pullrequestreview-560998618", "createdAt": "2021-01-04T12:38:50Z", "commit": {"oid": "95c3421186966ef0335c6cbf835cc83f72370cea"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wMS0wNFQxMjozODo1MFrOINwRBw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wMS0wNFQxMjozODo1MFrOINwRBw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1MTI5MzE5MQ==", "bodyText": "This logic isn't very simple. would better add comments here for each if-else branch meaning", "url": "https://github.com/apache/incubator-doris/pull/5133#discussion_r551293191", "createdAt": "2021-01-04T12:38:50Z", "author": {"login": "kangkaisen"}, "path": "fe/fe-core/src/main/java/org/apache/doris/qe/Coordinator.java", "diffHunk": "@@ -1560,14 +1560,20 @@ private void getExecHostPortForFragmentIDAndBucketSeq(TScanRangeLocations seqLoc\n                     break;\n                 }\n             }\n-\n-            buckendIdToBucketCountMap.put(buckendId, buckendIdToBucketCountMap.get(buckendId) + 1);\n             Reference<Long> backendIdRef = new Reference<Long>();\n             TNetworkAddress execHostPort = SimpleScheduler.getHost(buckendId, seqLocation.locations, idToBackend, backendIdRef);\n             if (execHostPort == null) {\n                 throw new UserException(\"there is no scanNode Backend\");\n             }\n-\n+            if (backendIdRef.getRef() != buckendId) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "95c3421186966ef0335c6cbf835cc83f72370cea"}, "originalPosition": 12}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ec5c64b879469cf10a6d671c8d4f6d5a2c4c5ad1", "author": {"user": null}, "url": "https://github.com/apache/incubator-doris/commit/ec5c64b879469cf10a6d671c8d4f6d5a2c4c5ad1", "committedDate": "2021-01-05T06:12:10Z", "message": "update"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTYyMjgxNzk4", "url": "https://github.com/apache/incubator-doris/pull/5133#pullrequestreview-562281798", "createdAt": "2021-01-06T02:20:04Z", "commit": {"oid": "ec5c64b879469cf10a6d671c8d4f6d5a2c4c5ad1"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4034, "cost": 1, "resetAt": "2021-10-28T18:00:02Z"}}}