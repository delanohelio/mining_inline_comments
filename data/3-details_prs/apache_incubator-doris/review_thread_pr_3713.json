{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDI0MzE5NTY0", "number": 3713, "reviewThreads": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yOFQwODozNjozNVrOEAaccQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yOFQwODozNzo0MVrOEAaeSg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjY4ODY4NzIxOnYy", "diffSide": "RIGHT", "path": "fe/src/main/java/org/apache/doris/system/Backend.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yOFQwODozNjozNVrOGbrM8A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yOFQwODozNjozNVrOGbrM8A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMTY3MjU2MA==", "bodyText": "This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters. Learn more about bidirectional Unicode characters\n\n\n  \n\n\n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                private BackendStatus backendStatus;\n          \n          \n            \n                private BackendStatus backendStatus = new BackendStatus();\n          \n      \n    \n    \n  \n\nAnd remove all constructors below.", "url": "https://github.com/apache/incubator-doris/pull/3713#discussion_r431672560", "createdAt": "2020-05-28T08:36:35Z", "author": {"login": "morningman"}, "path": "fe/src/main/java/org/apache/doris/system/Backend.java", "diffHunk": "@@ -94,6 +94,9 @@\n     // this field is set by tablet report, and just for metric monitor, no need to persist.\n     private AtomicLong tabletMaxCompactionScore = new AtomicLong(0);\n \n+    // additional backendStatus information for BE, display in JSON format\n+    private BackendStatus backendStatus;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "60cf102d6ad8422487a0dd2a122043ecfed80b4b"}, "originalPosition": 5}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjY4ODY5MTk0OnYy", "diffSide": "RIGHT", "path": "fe/src/main/java/org/apache/doris/master/ReportHandler.java", "isResolved": false, "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yOFQwODozNzo0MVrOGbrP0w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wMlQxMzowMzoyNFrOGdwj7w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMTY3MzI5OQ==", "bodyText": "Better to create a method called backend.updateStatus()  to set these infos.\nMaybe we will add more info later.", "url": "https://github.com/apache/incubator-doris/pull/3713#discussion_r431673299", "createdAt": "2020-05-28T08:37:41Z", "author": {"login": "morningman"}, "path": "fe/src/main/java/org/apache/doris/master/ReportHandler.java", "diffHunk": "@@ -247,6 +249,13 @@ private static void tabletReport(long backendId, Map<Long, TTablet> backendTable\n         LOG.info(\"backend[{}] reports {} tablet(s). report version: {}\",\n                  backendId, backendTablets.size(), backendReportVersion);\n \n+        final SystemInfoService currentSystemInfo = Catalog.getCurrentSystemInfo();\n+        Backend reportBackend = currentSystemInfo.getBackend(backendId);\n+        if (reportBackend != null) {\n+            BackendStatus backendStatus = reportBackend.getBackendStatus();\n+            backendStatus.lastTabletReportTime = TimeUtils.longToTimeString(start);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "60cf102d6ad8422487a0dd2a122043ecfed80b4b"}, "originalPosition": 23}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMTcwMjM4Mw==", "bodyText": "if we need add more info, we can just add a new Field in BackendStatus and set the field's value, and new info will be shown in show backends, why we need to set the value and update the value?I think we can just set the value, and the new value will be shown when we use show backends?", "url": "https://github.com/apache/incubator-doris/pull/3713#discussion_r431702383", "createdAt": "2020-05-28T09:27:24Z", "author": {"login": "WingsGo"}, "path": "fe/src/main/java/org/apache/doris/master/ReportHandler.java", "diffHunk": "@@ -247,6 +249,13 @@ private static void tabletReport(long backendId, Map<Long, TTablet> backendTable\n         LOG.info(\"backend[{}] reports {} tablet(s). report version: {}\",\n                  backendId, backendTablets.size(), backendReportVersion);\n \n+        final SystemInfoService currentSystemInfo = Catalog.getCurrentSystemInfo();\n+        Backend reportBackend = currentSystemInfo.getBackend(backendId);\n+        if (reportBackend != null) {\n+            BackendStatus backendStatus = reportBackend.getBackendStatus();\n+            backendStatus.lastTabletReportTime = TimeUtils.longToTimeString(start);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMTY3MzI5OQ=="}, "originalCommit": {"oid": "60cf102d6ad8422487a0dd2a122043ecfed80b4b"}, "originalPosition": 23}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMzg1NzUxOQ==", "bodyText": "It ok, not a big deal.\nOh, I suggest to set this value right after the report in done, in case some other error happens during the report process.", "url": "https://github.com/apache/incubator-doris/pull/3713#discussion_r433857519", "createdAt": "2020-06-02T13:03:24Z", "author": {"login": "morningman"}, "path": "fe/src/main/java/org/apache/doris/master/ReportHandler.java", "diffHunk": "@@ -247,6 +249,13 @@ private static void tabletReport(long backendId, Map<Long, TTablet> backendTable\n         LOG.info(\"backend[{}] reports {} tablet(s). report version: {}\",\n                  backendId, backendTablets.size(), backendReportVersion);\n \n+        final SystemInfoService currentSystemInfo = Catalog.getCurrentSystemInfo();\n+        Backend reportBackend = currentSystemInfo.getBackend(backendId);\n+        if (reportBackend != null) {\n+            BackendStatus backendStatus = reportBackend.getBackendStatus();\n+            backendStatus.lastTabletReportTime = TimeUtils.longToTimeString(start);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMTY3MzI5OQ=="}, "originalCommit": {"oid": "60cf102d6ad8422487a0dd2a122043ecfed80b4b"}, "originalPosition": 23}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1648, "cost": 1, "resetAt": "2021-11-12T09:44:50Z"}}}