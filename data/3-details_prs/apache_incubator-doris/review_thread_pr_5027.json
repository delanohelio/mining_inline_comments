{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTMyNTI0MDg2", "number": 5027, "reviewThreads": {"totalCount": 5, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0wNVQwNjo1MjozNVrOFBFxPA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0wN1QxMzo1NDozMFrOFByj9A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzM2Njg3NDIwOnYy", "diffSide": "RIGHT", "path": "fe/fe-core/src/main/java/org/apache/doris/common/Config.java", "isResolved": true, "comments": {"totalCount": 6, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0wNVQwNjo1MjozNVrOH_rNpg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0wN1QxMzoxMzoxNFrOIAmIxQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNjUzMDM0Mg==", "bodyText": "Thrift protocol doesn't have the timeout issue?", "url": "https://github.com/apache/incubator-doris/pull/5027#discussion_r536530342", "createdAt": "2020-12-05T06:52:35Z", "author": {"login": "kangkaisen"}, "path": "fe/fe-core/src/main/java/org/apache/doris/common/Config.java", "diffHunk": "@@ -1301,4 +1301,13 @@\n      */\n     @ConfField\n     public static boolean enable_alpha_rowset = false;\n+\n+    /**\n+     * This config is used to solve fe heartbeat response read_timeout problem,", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d38d9b2c831a5c85510c4ba8ebcc0b67c3c76611"}, "originalPosition": 6}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNjYyMTUwNQ==", "bodyText": "@kangkaisen for non master fe, the thread for processing request in fe thrift server is usually idle, and thrift protocol is more lightweight when we keep a long connection opened. But I am still confused that why heartbeat by http is easy to readtimout(timeout is 2 s), we just made period http request to fe server, such metric collect,  count running transaction in every db.", "url": "https://github.com/apache/incubator-doris/pull/5027#discussion_r536621505", "createdAt": "2020-12-05T09:45:44Z", "author": {"login": "caiconghui"}, "path": "fe/fe-core/src/main/java/org/apache/doris/common/Config.java", "diffHunk": "@@ -1301,4 +1301,13 @@\n      */\n     @ConfField\n     public static boolean enable_alpha_rowset = false;\n+\n+    /**\n+     * This config is used to solve fe heartbeat response read_timeout problem,", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNjUzMDM0Mg=="}, "originalCommit": {"oid": "d38d9b2c831a5c85510c4ba8ebcc0b67c3c76611"}, "originalPosition": 6}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNzE3MTI2Mg==", "bodyText": "When HTTP heartbeat read timeout, the FE server has a GC issue?\nI think HTTP and thrift protocol are both lightweight, and the heartbeat logic is very simple. So, If the http heartbeat has a timeout issue, there is no reason thrift heartbeat won't have the timeout issue.", "url": "https://github.com/apache/incubator-doris/pull/5027#discussion_r537171262", "createdAt": "2020-12-07T01:18:11Z", "author": {"login": "kangkaisen"}, "path": "fe/fe-core/src/main/java/org/apache/doris/common/Config.java", "diffHunk": "@@ -1301,4 +1301,13 @@\n      */\n     @ConfField\n     public static boolean enable_alpha_rowset = false;\n+\n+    /**\n+     * This config is used to solve fe heartbeat response read_timeout problem,", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNjUzMDM0Mg=="}, "originalCommit": {"oid": "d38d9b2c831a5c85510c4ba8ebcc0b67c3c76611"}, "originalPosition": 6}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNzI1OTExNA==", "bodyText": "There is no GC issue in fe server. All seems normal, but when non master fe run after sometimes, the read timeout problem occur, and when we restart non master fe, the read timeout issue disappear, and we are not sure that when to meet the read timeout problem again.", "url": "https://github.com/apache/incubator-doris/pull/5027#discussion_r537259114", "createdAt": "2020-12-07T06:24:57Z", "author": {"login": "caiconghui"}, "path": "fe/fe-core/src/main/java/org/apache/doris/common/Config.java", "diffHunk": "@@ -1301,4 +1301,13 @@\n      */\n     @ConfField\n     public static boolean enable_alpha_rowset = false;\n+\n+    /**\n+     * This config is used to solve fe heartbeat response read_timeout problem,", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNjUzMDM0Mg=="}, "originalCommit": {"oid": "d38d9b2c831a5c85510c4ba8ebcc0b67c3c76611"}, "originalPosition": 6}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNzI2NDM4OQ==", "bodyText": "2020-12-07 14:30:59,424 INFO 115 [RestBaseAction.handleRequest():52] receive http request. url=/api/bootstrap?\n2020-12-07 14:31:04,431 INFO 128 [RestBaseAction.handleRequest():52] receive http request. url=/api/bootstrap?\n2020-12-07 14:31:09,436 INFO 141 [RestBaseAction.handleRequest():52] receive http request. url=/api/bootstrap\n2020-12-07 14:31:14,442 INFO 148 [RestBaseAction.handleRequest():52] receive http request. url=/api/bootstrap\n2020-12-07 14:31:19,449 INFO 77 [RestBaseAction.handleRequest():52] receive http request. url=/api/bootstrap?\n2020-12-07 14:31:24,455 INFO 87 [RestBaseAction.handleRequest():52] receive http request. url=/api/bootstrap\n2020-12-07 14:31:29,461 INFO 94 [RestBaseAction.handleRequest():52] receive http request. url=/api/bootstrap?\n2020-12-07 14:31:34,466 INFO 104 [RestBaseAction.handleRequest():52] receive http request. url=/api/bootstrap?\n2020-12-07 14:31:39,472 INFO 119 [RestBaseAction.handleRequest():52] receive http request. url=/api/bootstrap?\n2020-12-07 14:31:44,477 INFO 129 [RestBaseAction.handleRequest():52] receive http request. url=/api/bootstrap?\n2020-12-07 14:31:53,897 INFO 137 [RestBaseAction.handleRequest():52] receive http request. url=/api/bootstrap?\n2020-12-07 14:31:56,540 INFO 150 [RestBaseAction.handleRequest():52] receive http request. url=/api/bootstrap?\n2020-12-07 14:32:01,545 INFO 79 [RestBaseAction.handleRequest():52] receive http request. url=/api/bootstrap?\n2020-12-07 14:32:06,550 INFO 89 [RestBaseAction.handleRequest():52] receive http request. url=/api/bootstrap?\n2020-12-07 14:32:11,556 INFO 96 [RestBaseAction.handleRequest():52] receive http request. url=/api/bootstrap\nThe heartbeat logic is so simple and no blocked logic to process,  but we find receive request has delayed somtimes  according to the log info(every 5 seconds should receive the heartbeat request)", "url": "https://github.com/apache/incubator-doris/pull/5027#discussion_r537264389", "createdAt": "2020-12-07T06:39:49Z", "author": {"login": "caiconghui"}, "path": "fe/fe-core/src/main/java/org/apache/doris/common/Config.java", "diffHunk": "@@ -1301,4 +1301,13 @@\n      */\n     @ConfField\n     public static boolean enable_alpha_rowset = false;\n+\n+    /**\n+     * This config is used to solve fe heartbeat response read_timeout problem,", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNjUzMDM0Mg=="}, "originalCommit": {"oid": "d38d9b2c831a5c85510c4ba8ebcc0b67c3c76611"}, "originalPosition": 6}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNzQ5NTc0OQ==", "bodyText": "I see. Thanks you.", "url": "https://github.com/apache/incubator-doris/pull/5027#discussion_r537495749", "createdAt": "2020-12-07T13:13:14Z", "author": {"login": "kangkaisen"}, "path": "fe/fe-core/src/main/java/org/apache/doris/common/Config.java", "diffHunk": "@@ -1301,4 +1301,13 @@\n      */\n     @ConfField\n     public static boolean enable_alpha_rowset = false;\n+\n+    /**\n+     * This config is used to solve fe heartbeat response read_timeout problem,", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNjUzMDM0Mg=="}, "originalCommit": {"oid": "d38d9b2c831a5c85510c4ba8ebcc0b67c3c76611"}, "originalPosition": 6}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzM3NDA4Mzg1OnYy", "diffSide": "RIGHT", "path": "gensrc/thrift/FrontendService.thrift", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0wN1QxMzoyNTo0N1rOIAmn7Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0wN1QxNToyNjo0MFrOIAsMdw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNzUwMzcyNQ==", "bodyText": "required field should be used very carefully,  reference here", "url": "https://github.com/apache/incubator-doris/pull/5027#discussion_r537503725", "createdAt": "2020-12-07T13:25:47Z", "author": {"login": "sduzh"}, "path": "gensrc/thrift/FrontendService.thrift", "diffHunk": "@@ -654,6 +654,25 @@ struct TSnapshotLoaderReportRequest {\n     5: optional i32 total_num\n }\n \n+enum TFrontendPingFrontendStatusCode {\n+   OK = 0,\n+   FAILED = 1\n+}\n+\n+struct TFrontendPingFrontendRequest {\n+   1: required i32 clusterId", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d38d9b2c831a5c85510c4ba8ebcc0b67c3c76611"}, "originalPosition": 10}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNzU5NDk5OQ==", "bodyText": "I think if the filed is really required and the TFrontendPingFrontendRequest is firstly constructed to use, the field used requried is ok", "url": "https://github.com/apache/incubator-doris/pull/5027#discussion_r537594999", "createdAt": "2020-12-07T15:26:40Z", "author": {"login": "caiconghui"}, "path": "gensrc/thrift/FrontendService.thrift", "diffHunk": "@@ -654,6 +654,25 @@ struct TSnapshotLoaderReportRequest {\n     5: optional i32 total_num\n }\n \n+enum TFrontendPingFrontendStatusCode {\n+   OK = 0,\n+   FAILED = 1\n+}\n+\n+struct TFrontendPingFrontendRequest {\n+   1: required i32 clusterId", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNzUwMzcyNQ=="}, "originalCommit": {"oid": "d38d9b2c831a5c85510c4ba8ebcc0b67c3c76611"}, "originalPosition": 10}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzM3NDE0MjMxOnYy", "diffSide": "RIGHT", "path": "gensrc/thrift/FrontendService.thrift", "isResolved": false, "comments": {"totalCount": 6, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0wN1QxMzozOTowN1rOIAnJ6Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0wOFQwODo1Nzo1OVrOIBOQyQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNzUxMjQyNQ==", "bodyText": "The request and response names are unmatched with the service name.", "url": "https://github.com/apache/incubator-doris/pull/5027#discussion_r537512425", "createdAt": "2020-12-07T13:39:07Z", "author": {"login": "sduzh"}, "path": "gensrc/thrift/FrontendService.thrift", "diffHunk": "@@ -689,4 +708,6 @@ service FrontendService {\n     TStreamLoadPutResult streamLoadPut(1: TStreamLoadPutRequest request)\n \n     Status.TStatus snapshotLoaderReport(1: TSnapshotLoaderReportRequest request)\n-}\n+\n+    TBootstrapResult ping(1: TFrontendPingFrontendRequest request)", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d38d9b2c831a5c85510c4ba8ebcc0b67c3c76611"}, "originalPosition": 32}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNzU5NjU3Nw==", "bodyText": "thank you for your advice, I will change it.", "url": "https://github.com/apache/incubator-doris/pull/5027#discussion_r537596577", "createdAt": "2020-12-07T15:28:34Z", "author": {"login": "caiconghui"}, "path": "gensrc/thrift/FrontendService.thrift", "diffHunk": "@@ -689,4 +708,6 @@ service FrontendService {\n     TStreamLoadPutResult streamLoadPut(1: TStreamLoadPutRequest request)\n \n     Status.TStatus snapshotLoaderReport(1: TSnapshotLoaderReportRequest request)\n-}\n+\n+    TBootstrapResult ping(1: TFrontendPingFrontendRequest request)", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNzUxMjQyNQ=="}, "originalCommit": {"oid": "d38d9b2c831a5c85510c4ba8ebcc0b67c3c76611"}, "originalPosition": 32}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzODEyNjg1NQ==", "bodyText": "If service is named as ping, why not just name the request/response as TPingRequest/TPingResponse.  I'm just curious about the naming rule of Doris, it's kind of weird for me.", "url": "https://github.com/apache/incubator-doris/pull/5027#discussion_r538126855", "createdAt": "2020-12-08T08:18:12Z", "author": {"login": "sduzh"}, "path": "gensrc/thrift/FrontendService.thrift", "diffHunk": "@@ -689,4 +708,6 @@ service FrontendService {\n     TStreamLoadPutResult streamLoadPut(1: TStreamLoadPutRequest request)\n \n     Status.TStatus snapshotLoaderReport(1: TSnapshotLoaderReportRequest request)\n-}\n+\n+    TBootstrapResult ping(1: TFrontendPingFrontendRequest request)", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNzUxMjQyNQ=="}, "originalCommit": {"oid": "d38d9b2c831a5c85510c4ba8ebcc0b67c3c76611"}, "originalPosition": 32}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzODEzMTU5Ng==", "bodyText": "Sorry to intervene, It's just my personal options, you can just ignore them all ^_^", "url": "https://github.com/apache/incubator-doris/pull/5027#discussion_r538131596", "createdAt": "2020-12-08T08:25:45Z", "author": {"login": "sduzh"}, "path": "gensrc/thrift/FrontendService.thrift", "diffHunk": "@@ -689,4 +708,6 @@ service FrontendService {\n     TStreamLoadPutResult streamLoadPut(1: TStreamLoadPutRequest request)\n \n     Status.TStatus snapshotLoaderReport(1: TSnapshotLoaderReportRequest request)\n-}\n+\n+    TBootstrapResult ping(1: TFrontendPingFrontendRequest request)", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNzUxMjQyNQ=="}, "originalCommit": {"oid": "d38d9b2c831a5c85510c4ba8ebcc0b67c3c76611"}, "originalPosition": 32}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzODE0MTY1Mw==", "bodyText": "In my option, by TFrontendPingFrontendRequest, we can know the request is sent by fe to fe, by TPingRequest is less information?", "url": "https://github.com/apache/incubator-doris/pull/5027#discussion_r538141653", "createdAt": "2020-12-08T08:40:28Z", "author": {"login": "caiconghui"}, "path": "gensrc/thrift/FrontendService.thrift", "diffHunk": "@@ -689,4 +708,6 @@ service FrontendService {\n     TStreamLoadPutResult streamLoadPut(1: TStreamLoadPutRequest request)\n \n     Status.TStatus snapshotLoaderReport(1: TSnapshotLoaderReportRequest request)\n-}\n+\n+    TBootstrapResult ping(1: TFrontendPingFrontendRequest request)", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNzUxMjQyNQ=="}, "originalCommit": {"oid": "d38d9b2c831a5c85510c4ba8ebcc0b67c3c76611"}, "originalPosition": 32}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzODE1MzE2MQ==", "bodyText": "I get what you mean, actually,   TFrontendPingFrontendRequest is like the name in\n TBrokerOperationStatus ping(1: TBrokerPingBrokerRequest request);", "url": "https://github.com/apache/incubator-doris/pull/5027#discussion_r538153161", "createdAt": "2020-12-08T08:57:59Z", "author": {"login": "caiconghui"}, "path": "gensrc/thrift/FrontendService.thrift", "diffHunk": "@@ -689,4 +708,6 @@ service FrontendService {\n     TStreamLoadPutResult streamLoadPut(1: TStreamLoadPutRequest request)\n \n     Status.TStatus snapshotLoaderReport(1: TSnapshotLoaderReportRequest request)\n-}\n+\n+    TBootstrapResult ping(1: TFrontendPingFrontendRequest request)", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNzUxMjQyNQ=="}, "originalCommit": {"oid": "d38d9b2c831a5c85510c4ba8ebcc0b67c3c76611"}, "originalPosition": 32}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzM3NDE2MTk2OnYy", "diffSide": "RIGHT", "path": "gensrc/thrift/FrontendService.thrift", "isResolved": false, "comments": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0wN1QxMzo0MzozMlrOIAnVfA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0wOFQwODo1NToyMVrOIBOJJA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNzUxNTM4OA==", "bodyText": "Is it ok to use TStatus here?", "url": "https://github.com/apache/incubator-doris/pull/5027#discussion_r537515388", "createdAt": "2020-12-07T13:43:32Z", "author": {"login": "sduzh"}, "path": "gensrc/thrift/FrontendService.thrift", "diffHunk": "@@ -654,6 +654,25 @@ struct TSnapshotLoaderReportRequest {\n     5: optional i32 total_num\n }\n \n+enum TFrontendPingFrontendStatusCode {\n+   OK = 0,\n+   FAILED = 1\n+}\n+\n+struct TFrontendPingFrontendRequest {\n+   1: required i32 clusterId\n+   2: required string token\n+}\n+\n+struct TBootstrapResult {\n+    1: required TFrontendPingFrontendStatusCode status", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d38d9b2c831a5c85510c4ba8ebcc0b67c3c76611"}, "originalPosition": 15}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNzU5NjI2Mw==", "bodyText": "TStatus is used for be, just like TBrokerOperationStatus is used for broker, so I think use new status for fe would be better", "url": "https://github.com/apache/incubator-doris/pull/5027#discussion_r537596263", "createdAt": "2020-12-07T15:28:12Z", "author": {"login": "caiconghui"}, "path": "gensrc/thrift/FrontendService.thrift", "diffHunk": "@@ -654,6 +654,25 @@ struct TSnapshotLoaderReportRequest {\n     5: optional i32 total_num\n }\n \n+enum TFrontendPingFrontendStatusCode {\n+   OK = 0,\n+   FAILED = 1\n+}\n+\n+struct TFrontendPingFrontendRequest {\n+   1: required i32 clusterId\n+   2: required string token\n+}\n+\n+struct TBootstrapResult {\n+    1: required TFrontendPingFrontendStatusCode status", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNzUxNTM4OA=="}, "originalCommit": {"oid": "d38d9b2c831a5c85510c4ba8ebcc0b67c3c76611"}, "originalPosition": 15}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzODEyNDU1NQ==", "bodyText": "Didn't find any specification that TStatus can only be used between BE and FE.\n\n  \n    \n      incubator-doris/gensrc/thrift/Status.thrift\n    \n    \n         Line 22\n      in\n      49f7eb6\n    \n    \n    \n    \n\n        \n          \n           // The TStatusCode struct is used in all FEs and BEs. In order to be able to", "url": "https://github.com/apache/incubator-doris/pull/5027#discussion_r538124555", "createdAt": "2020-12-08T08:14:14Z", "author": {"login": "sduzh"}, "path": "gensrc/thrift/FrontendService.thrift", "diffHunk": "@@ -654,6 +654,25 @@ struct TSnapshotLoaderReportRequest {\n     5: optional i32 total_num\n }\n \n+enum TFrontendPingFrontendStatusCode {\n+   OK = 0,\n+   FAILED = 1\n+}\n+\n+struct TFrontendPingFrontendRequest {\n+   1: required i32 clusterId\n+   2: required string token\n+}\n+\n+struct TBootstrapResult {\n+    1: required TFrontendPingFrontendStatusCode status", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNzUxNTM4OA=="}, "originalCommit": {"oid": "d38d9b2c831a5c85510c4ba8ebcc0b67c3c76611"}, "originalPosition": 15}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzODE1MTIwNA==", "bodyText": "Yes, I am also not sure to reuse the TStatus or just like\n\nenum TBrokerOperationStatusCode {\n    OK = 0;\n    END_OF_FILE = 301;\n    \n    // user input error\n    NOT_AUTHORIZED = 401;\n    DUPLICATE_REQUEST = 402;\n    INVALID_INPUT_OFFSET = 403; // user input offset is invalid, is large than file length\n    INVALID_INPUT_FILE_PATH = 404;\n    INVALID_ARGUMENT = 405;\n    \n    // internal server error\n    FILE_NOT_FOUND = 501;\n    TARGET_STORAGE_SERVICE_ERROR = 502; // the target storage service error\n    OPERATION_NOT_SUPPORTED = 503; // the api is not implemented\n}\n\ndefine new status struct", "url": "https://github.com/apache/incubator-doris/pull/5027#discussion_r538151204", "createdAt": "2020-12-08T08:55:21Z", "author": {"login": "caiconghui"}, "path": "gensrc/thrift/FrontendService.thrift", "diffHunk": "@@ -654,6 +654,25 @@ struct TSnapshotLoaderReportRequest {\n     5: optional i32 total_num\n }\n \n+enum TFrontendPingFrontendStatusCode {\n+   OK = 0,\n+   FAILED = 1\n+}\n+\n+struct TFrontendPingFrontendRequest {\n+   1: required i32 clusterId\n+   2: required string token\n+}\n+\n+struct TBootstrapResult {\n+    1: required TFrontendPingFrontendStatusCode status", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNzUxNTM4OA=="}, "originalCommit": {"oid": "d38d9b2c831a5c85510c4ba8ebcc0b67c3c76611"}, "originalPosition": 15}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzM3NDIxMzAwOnYy", "diffSide": "RIGHT", "path": "fe/fe-core/src/main/java/org/apache/doris/system/HeartbeatMgr.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0wN1QxMzo1NDozMFrOIAny3w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0wN1QxNToyNToxOFrOIAsH_w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNzUyMjkxMQ==", "bodyText": "Is it really necessary to keep the HTTP based codes?\ncc @kangkaisen", "url": "https://github.com/apache/incubator-doris/pull/5027#discussion_r537522911", "createdAt": "2020-12-07T13:54:30Z", "author": {"login": "sduzh"}, "path": "fe/fe-core/src/main/java/org/apache/doris/system/HeartbeatMgr.java", "diffHunk": "@@ -282,13 +276,20 @@ public HeartbeatResponse call() {\n                 // heartbeat to self\n                 if (Catalog.getCurrentCatalog().isReady()) {\n                     return new FrontendHbResponse(fe.getNodeName(), Config.query_port, Config.rpc_port,\n-                            Catalog.getCurrentCatalog().getReplayedJournalId(), System.currentTimeMillis(),\n+                            Catalog.getCurrentCatalog().getMaxJournalId(), System.currentTimeMillis(),\n                             Version.DORIS_BUILD_VERSION + \"-\" + Version.DORIS_BUILD_SHORT_HASH);\n                 } else {\n                     return new FrontendHbResponse(fe.getNodeName(), \"not ready\");\n                 }\n             }\n+            if (Config.enable_fe_heartbeat_by_thrift) {\n+                return getHeartbeatResponseByThrift();\n+            } else {\n+                return getHeartbeatResponseByHttp();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d38d9b2c831a5c85510c4ba8ebcc0b67c3c76611"}, "originalPosition": 77}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNzU5Mzg1NQ==", "bodyText": "@sduzh be compatible with older versions(0.13), and should be moved next version(0.15). if you ugrade non master fe first, the heartbeat will fail.", "url": "https://github.com/apache/incubator-doris/pull/5027#discussion_r537593855", "createdAt": "2020-12-07T15:25:18Z", "author": {"login": "caiconghui"}, "path": "fe/fe-core/src/main/java/org/apache/doris/system/HeartbeatMgr.java", "diffHunk": "@@ -282,13 +276,20 @@ public HeartbeatResponse call() {\n                 // heartbeat to self\n                 if (Catalog.getCurrentCatalog().isReady()) {\n                     return new FrontendHbResponse(fe.getNodeName(), Config.query_port, Config.rpc_port,\n-                            Catalog.getCurrentCatalog().getReplayedJournalId(), System.currentTimeMillis(),\n+                            Catalog.getCurrentCatalog().getMaxJournalId(), System.currentTimeMillis(),\n                             Version.DORIS_BUILD_VERSION + \"-\" + Version.DORIS_BUILD_SHORT_HASH);\n                 } else {\n                     return new FrontendHbResponse(fe.getNodeName(), \"not ready\");\n                 }\n             }\n+            if (Config.enable_fe_heartbeat_by_thrift) {\n+                return getHeartbeatResponseByThrift();\n+            } else {\n+                return getHeartbeatResponseByHttp();", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNzUyMjkxMQ=="}, "originalCommit": {"oid": "d38d9b2c831a5c85510c4ba8ebcc0b67c3c76611"}, "originalPosition": 77}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 940, "cost": 1, "resetAt": "2021-11-12T09:44:50Z"}}}