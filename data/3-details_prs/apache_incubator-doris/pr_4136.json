{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDU0MzcyNTY2", "number": 4136, "title": "Fixbug: json load", "bodyText": "FixBug: load a json object is failed in routine load\nfor example json-data:  {\"category\":\"11\",\"title\":\"SayingsoftheCentury\",\"price\":895,\"timestamp\":1589191587}\n\n\nadd json_root for nest json data\nfor example json-data:\n{\n\"RECORDS\":[\n{\"category\":\"11\",\"title\":\"SayingsoftheCentury\",\"price\":895,\"timestamp\":1589191587},\n{\"category\":\"22\",\"author\":\"2avc\",\"price\":895,\"timestamp\":1589191487},\n{\"category\":\"33\",\"author\":\"3avc\",\"title\":\"SayingsoftheCentury\",\"timestamp\":1589191387}\n]\n}\nRoutine load:\nCREATE ROUTINE LOAD example_db.test1 ON example_tbl\nCOLUMNS(category, author, price, timestamp, dt=from_unixtime(timestamp, '%Y%m%d'))\nPROPERTIES\n(\n\"desired_concurrent_number\"=\"3\",\n\"max_batch_interval\" = \"20\",\n\"max_batch_rows\" = \"300000\",\n\"max_batch_size\" = \"209715200\",\n\"strict_mode\" = \"false\",\n\"format\" = \"json\",\n\"jsonpaths\" = \"[\"$.category\",\"$.author\",\"$.price\",\"$.timestamp\"]\",\n\"strip_outer_array\" = \"true\",\n\"json_root\" = \"$.RECORDS\"\n)\nFROM KAFKA\n(\n\"kafka_broker_list\" = \"broker1:9092,broker2:9092,broker3:9092\",\n\"kafka_topic\" = \"my_topic\",\n\"kafka_partitions\" = \"0,1,2\",\n\"kafka_offsets\" = \"0,0,0\"\n);", "createdAt": "2020-07-21T10:40:30Z", "url": "https://github.com/apache/incubator-doris/pull/4136", "merged": true, "mergeCommit": {"oid": "fdcc223ad2b240158d5eb4bd92dad94713e11385"}, "closed": true, "closedAt": "2020-07-30T02:36:35Z", "author": {"login": "worker24h"}, "timelineItems": {"totalCount": 14, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABc3D5jrABqjM1NzA2MDM2OTM=", "endCursor": "Y3Vyc29yOnYyOpPPAAABc51xdAgFqTQ1ODAyMDYzMA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "21ba6e493b9b7c384932d57c4199ede4f000ef6c", "author": {"user": {"login": "worker24h", "name": null}}, "url": "https://github.com/apache/incubator-doris/commit/21ba6e493b9b7c384932d57c4199ede4f000ef6c", "committedDate": "2020-07-21T10:33:57Z", "message": "1) FixBug: load json is failed in routine load\n2) add `json_root` for nest json data"}, "afterCommit": {"oid": "f82c8ab6d4bcd3ffc6962781c0cb5f8858cfcc37", "author": {"user": {"login": "worker24h", "name": null}}, "url": "https://github.com/apache/incubator-doris/commit/f82c8ab6d4bcd3ffc6962781c0cb5f8858cfcc37", "committedDate": "2020-07-21T10:44:20Z", "message": "1) FixBug: load json is failed in routine load\n2) add `json_root` for nest json data"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "f82c8ab6d4bcd3ffc6962781c0cb5f8858cfcc37", "author": {"user": {"login": "worker24h", "name": null}}, "url": "https://github.com/apache/incubator-doris/commit/f82c8ab6d4bcd3ffc6962781c0cb5f8858cfcc37", "committedDate": "2020-07-21T10:44:20Z", "message": "1) FixBug: load json is failed in routine load\n2) add `json_root` for nest json data"}, "afterCommit": {"oid": "30ee9d45c70195b0e1210a3510fda0a07827cbd4", "author": {"user": {"login": "worker24h", "name": null}}, "url": "https://github.com/apache/incubator-doris/commit/30ee9d45c70195b0e1210a3510fda0a07827cbd4", "committedDate": "2020-07-21T10:45:37Z", "message": "1) FixBug: load json is failed in routine load\n2) add `json_root` for nest json data"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "30ee9d45c70195b0e1210a3510fda0a07827cbd4", "author": {"user": {"login": "worker24h", "name": null}}, "url": "https://github.com/apache/incubator-doris/commit/30ee9d45c70195b0e1210a3510fda0a07827cbd4", "committedDate": "2020-07-21T10:45:37Z", "message": "1) FixBug: load json is failed in routine load\n2) add `json_root` for nest json data"}, "afterCommit": {"oid": "1f65538bfdf6380036ae888630f4058de88dc3e8", "author": {"user": {"login": "worker24h", "name": null}}, "url": "https://github.com/apache/incubator-doris/commit/1f65538bfdf6380036ae888630f4058de88dc3e8", "committedDate": "2020-07-21T10:47:05Z", "message": "1) FixBug: load json is failed in routine load\n2) add `json_root` for nest json data"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "1f65538bfdf6380036ae888630f4058de88dc3e8", "author": {"user": {"login": "worker24h", "name": null}}, "url": "https://github.com/apache/incubator-doris/commit/1f65538bfdf6380036ae888630f4058de88dc3e8", "committedDate": "2020-07-21T10:47:05Z", "message": "1) FixBug: load json is failed in routine load\n2) add `json_root` for nest json data"}, "afterCommit": {"oid": "b3e8409a8423e9d0a86c9aa5023fbaf91ccb1057", "author": {"user": {"login": "worker24h", "name": null}}, "url": "https://github.com/apache/incubator-doris/commit/b3e8409a8423e9d0a86c9aa5023fbaf91ccb1057", "committedDate": "2020-07-22T02:13:43Z", "message": "1) FixBug: load json is failed in routine load\n2) Add `json_root` for nest json data\n3) Refactor code"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDUzMDAzNTM2", "url": "https://github.com/apache/incubator-doris/pull/4136#pullrequestreview-453003536", "createdAt": "2020-07-22T05:26:24Z", "commit": {"oid": "b3e8409a8423e9d0a86c9aa5023fbaf91ccb1057"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 6, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yMlQwNToyNjoyNFrOG1TM1A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yMlQwNTo0OTowNFrOG1ToFw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1ODU0MjI5Mg==", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                    Status st = _generater_json_paths(jsonpath, _parsed_jsonpaths);\n          \n          \n            \n                    Status st = _generate_json_paths(jsonpath, _parsed_jsonpaths);", "url": "https://github.com/apache/incubator-doris/pull/4136#discussion_r458542292", "createdAt": "2020-07-22T05:26:24Z", "author": {"login": "morningman"}, "path": "be/src/exec/json_scanner.cpp", "diffHunk": "@@ -197,30 +201,52 @@ JsonReader::~JsonReader() {\n     _close();\n }\n \n-Status JsonReader::init() {\n+Status JsonReader::init(std::string& jsonpath, std::string& json_root) {\n     // parse jsonpath\n+    if (!jsonpath.empty()) {\n+        Status st = _generater_json_paths(jsonpath, _parsed_jsonpaths);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b3e8409a8423e9d0a86c9aa5023fbaf91ccb1057"}, "originalPosition": 52}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1ODU0MjY4Ng==", "bodyText": "Why _parsed_json_root is a vector?", "url": "https://github.com/apache/incubator-doris/pull/4136#discussion_r458542686", "createdAt": "2020-07-22T05:27:50Z", "author": {"login": "morningman"}, "path": "be/src/exec/json_scanner.cpp", "diffHunk": "@@ -257,26 +283,38 @@ Status JsonReader::_parse_json_doc(bool* eof) {\n         delete[] json_str;\n         return Status::DataQualityError(str_error.str());\n     }\n+    delete[] json_str;\n \n-    if (_json_doc.IsArray() && !_strip_outer_array) {\n-        delete[] json_str;\n+    // set json root\n+    if (_parsed_json_root.size() != 0) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b3e8409a8423e9d0a86c9aa5023fbaf91ccb1057"}, "originalPosition": 124}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1ODU0MzczMQ==", "bodyText": "We only support one json root, so we can check it here, and return error if json root more than one.", "url": "https://github.com/apache/incubator-doris/pull/4136#discussion_r458543731", "createdAt": "2020-07-22T05:31:23Z", "author": {"login": "morningman"}, "path": "be/src/exec/json_scanner.cpp", "diffHunk": "@@ -197,30 +201,52 @@ JsonReader::~JsonReader() {\n     _close();\n }\n \n-Status JsonReader::init() {\n+Status JsonReader::init(std::string& jsonpath, std::string& json_root) {\n     // parse jsonpath\n+    if (!jsonpath.empty()) {\n+        Status st = _generater_json_paths(jsonpath, _parsed_jsonpaths);\n+        RETURN_IF_ERROR(st);\n+    }\n+    if (!json_root.empty()) {\n+        std::vector<JsonPath> parsed_paths;\n+        JsonFunctions::parse_json_paths(json_root, &parsed_paths);\n+        _parsed_json_root.push_back(parsed_paths);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b3e8409a8423e9d0a86c9aa5023fbaf91ccb1057"}, "originalPosition": 58}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1ODU0NjM1OQ==", "bodyText": "Can these parameters be changed to const &?", "url": "https://github.com/apache/incubator-doris/pull/4136#discussion_r458546359", "createdAt": "2020-07-22T05:39:32Z", "author": {"login": "morningman"}, "path": "be/src/exec/json_scanner.h", "diffHunk": "@@ -106,33 +105,31 @@ struct JsonPath;\n class JsonReader {\n public:\n     JsonReader(RuntimeState* state, ScannerCounter* counter, RuntimeProfile* profile, FileReader* file_reader,\n-            std::string& jsonpath, bool strip_outer_array);\n+            bool strip_outer_array);\n     ~JsonReader();\n \n-    Status init(); // must call before use\n+    Status init(std::string& jsonpath, std::string& json_root); // must call before use", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b3e8409a8423e9d0a86c9aa5023fbaf91ccb1057"}, "originalPosition": 17}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1ODU0Njk1MA==", "bodyText": "Remove this method", "url": "https://github.com/apache/incubator-doris/pull/4136#discussion_r458546950", "createdAt": "2020-07-22T05:41:18Z", "author": {"login": "morningman"}, "path": "be/src/exec/json_scanner.h", "diffHunk": "@@ -106,33 +105,31 @@ struct JsonPath;\n class JsonReader {\n public:\n     JsonReader(RuntimeState* state, ScannerCounter* counter, RuntimeProfile* profile, FileReader* file_reader,\n-            std::string& jsonpath, bool strip_outer_array);\n+            bool strip_outer_array);\n     ~JsonReader();\n \n-    Status init(); // must call before use\n+    Status init(std::string& jsonpath, std::string& json_root); // must call before use\n \n     Status read(Tuple* tuple, const std::vector<SlotDescriptor*>& slot_descs, MemPool* tuple_pool, bool* eof);\n \n private:\n+    Status (JsonReader::*_handle_json_callback)(Tuple* tuple, const std::vector<SlotDescriptor*>& slot_descs, MemPool* tuple_pool, bool* eof);\n     Status _handle_simple_json(Tuple* tuple, const std::vector<SlotDescriptor*>& slot_descs, MemPool* tuple_pool, bool* eof);\n-    Status _handle_complex_json(Tuple* tuple, const std::vector<SlotDescriptor*>& slot_descs, MemPool* tuple_pool, bool* eof);\n     Status _handle_flat_array_complex_json(Tuple* tuple, const std::vector<SlotDescriptor*>& slot_descs, MemPool* tuple_pool, bool* eof);\n     Status _handle_nested_complex_json(Tuple* tuple, const std::vector<SlotDescriptor*>& slot_descs, MemPool* tuple_pool, bool* eof);\n \n     void _fill_slot(Tuple* tuple, SlotDescriptor* slot_desc, MemPool* mem_pool, const uint8_t* value, int32_t len);\n-    void _assemble_jmap(const std::vector<SlotDescriptor*>& slot_descs);\n+    int _assemble_jmap(const std::vector<SlotDescriptor*>& slot_descs);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b3e8409a8423e9d0a86c9aa5023fbaf91ccb1057"}, "originalPosition": 30}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1ODU0OTI3MQ==", "bodyText": "change the name of _json_root. This name is easily confused with _parsed_json_root.\nMy suggestion: _final_json_doc. And add comment to explain that this is generated from _json_doc", "url": "https://github.com/apache/incubator-doris/pull/4136#discussion_r458549271", "createdAt": "2020-07-22T05:49:04Z", "author": {"login": "morningman"}, "path": "be/src/exec/json_scanner.h", "diffHunk": "@@ -144,9 +141,9 @@ class JsonReader {\n     RuntimeProfile::Counter* _bytes_read_counter;\n     RuntimeProfile::Counter* _read_timer;\n     std::vector<std::vector<JsonPath>> _parsed_jsonpaths;\n+    std::vector<std::vector<JsonPath>> _parsed_json_root;\n     rapidjson::Document _json_doc;\n-    //key: column name\n-    std::unordered_map<std::string, JsonDataInternal> _jmap;\n+    rapidjson::Value *_json_root;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b3e8409a8423e9d0a86c9aa5023fbaf91ccb1057"}, "originalPosition": 55}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "b3e8409a8423e9d0a86c9aa5023fbaf91ccb1057", "author": {"user": {"login": "worker24h", "name": null}}, "url": "https://github.com/apache/incubator-doris/commit/b3e8409a8423e9d0a86c9aa5023fbaf91ccb1057", "committedDate": "2020-07-22T02:13:43Z", "message": "1) FixBug: load json is failed in routine load\n2) Add `json_root` for nest json data\n3) Refactor code"}, "afterCommit": {"oid": "2456e8c5cf56c0d091f116f826fd0b66690d7c10", "author": {"user": {"login": "worker24h", "name": null}}, "url": "https://github.com/apache/incubator-doris/commit/2456e8c5cf56c0d091f116f826fd0b66690d7c10", "committedDate": "2020-07-29T05:53:48Z", "message": "1) FixBug: load json is failed in routine load\n2) Add `json_root` for nest json data\n3) Refactor code"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDU3NDA5NzY0", "url": "https://github.com/apache/incubator-doris/pull/4136#pullrequestreview-457409764", "createdAt": "2020-07-29T10:53:21Z", "commit": {"oid": "2456e8c5cf56c0d091f116f826fd0b66690d7c10"}, "state": "COMMENTED", "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yOVQxMDo1MzoyMVrOG4zLMA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yOVQxMTo1NzozOVrOG41GMg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MjIxMTg4OA==", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                rapidjson::Document _orinal_json_doc; // orinal json document object from parsed json string\n          \n          \n            \n                rapidjson::Document _origin_json_doc; // orinal json document object from parsed json string", "url": "https://github.com/apache/incubator-doris/pull/4136#discussion_r462211888", "createdAt": "2020-07-29T10:53:21Z", "author": {"login": "morningman"}, "path": "be/src/exec/json_scanner.h", "diffHunk": "@@ -143,10 +140,12 @@ class JsonReader {\n     bool _strip_outer_array;\n     RuntimeProfile::Counter* _bytes_read_counter;\n     RuntimeProfile::Counter* _read_timer;\n+\n     std::vector<std::vector<JsonPath>> _parsed_jsonpaths;\n-    rapidjson::Document _json_doc;\n-    //key: column name\n-    std::unordered_map<std::string, JsonDataInternal> _jmap;\n+    std::vector<JsonPath> _parsed_json_root;\n+\n+    rapidjson::Document _orinal_json_doc; // orinal json document object from parsed json string", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "2456e8c5cf56c0d091f116f826fd0b66690d7c10"}, "originalPosition": 58}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MjI0MjYzNw==", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            static const std::string HTTP_EXEC_JSONROOT  = \"json_root\";\n          \n          \n            \n            static const std::string HTTP_JSONROOT  = \"json_root\";\n          \n      \n    \n    \n  \n\nEXEC is not some kind of prfix, it is with EXEC_MEM_LIMIT.\nAlso modify HTTP_EXEC_JSONPATHS to HTTP_JSONPATHS", "url": "https://github.com/apache/incubator-doris/pull/4136#discussion_r462242637", "createdAt": "2020-07-29T11:56:17Z", "author": {"login": "morningman"}, "path": "be/src/http/http_common.h", "diffHunk": "@@ -37,6 +37,7 @@ static const std::string HTTP_STRICT_MODE = \"strict_mode\";\n static const std::string HTTP_TIMEZONE = \"timezone\";\n static const std::string HTTP_EXEC_MEM_LIMIT = \"exec_mem_limit\";\n static const std::string HTTP_EXEC_JSONPATHS  = \"jsonpaths\";\n+static const std::string HTTP_EXEC_JSONROOT  = \"json_root\";", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "2456e8c5cf56c0d091f116f826fd0b66690d7c10"}, "originalPosition": 4}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MjI0MzM3OA==", "bodyText": "Import order", "url": "https://github.com/apache/incubator-doris/pull/4136#discussion_r462243378", "createdAt": "2020-07-29T11:57:39Z", "author": {"login": "morningman"}, "path": "fe/fe-core/src/main/java/org/apache/doris/load/routineload/RoutineLoadJob.java", "diffHunk": "@@ -17,6 +17,14 @@\n \n package org.apache.doris.load.routineload;\n \n+import com.google.common.base.Joiner;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "2456e8c5cf56c0d091f116f826fd0b66690d7c10"}, "originalPosition": 4}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "2456e8c5cf56c0d091f116f826fd0b66690d7c10", "author": {"user": {"login": "worker24h", "name": null}}, "url": "https://github.com/apache/incubator-doris/commit/2456e8c5cf56c0d091f116f826fd0b66690d7c10", "committedDate": "2020-07-29T05:53:48Z", "message": "1) FixBug: load json is failed in routine load\n2) Add `json_root` for nest json data\n3) Refactor code"}, "afterCommit": {"oid": "93437d5353059476781eb72fda581f3bdf7a467a", "author": {"user": {"login": "worker24h", "name": null}}, "url": "https://github.com/apache/incubator-doris/commit/93437d5353059476781eb72fda581f3bdf7a467a", "committedDate": "2020-07-29T12:19:56Z", "message": "1) FixBug: load json is failed in routine load\n2) Add `json_root` for nest json data\n3) Refactor code"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDU3NDcyMDQz", "url": "https://github.com/apache/incubator-doris/pull/4136#pullrequestreview-457472043", "createdAt": "2020-07-29T12:29:57Z", "commit": {"oid": "93437d5353059476781eb72fda581f3bdf7a467a"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yOVQxMjoyOTo1N1rOG42KTg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yOVQxMjozMTowNlrOG42M8g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MjI2MDgxNA==", "bodyText": "What is the json_root default value? Please let others know", "url": "https://github.com/apache/incubator-doris/pull/4136#discussion_r462260814", "createdAt": "2020-07-29T12:29:57Z", "author": {"login": "imay"}, "path": "docs/en/sql-reference/sql-statements/Data Manipulation/ROUTINE LOAD.md", "diffHunk": "@@ -178,6 +178,9 @@ FROM data_source\n     8. `strip_outer_array`\n         Boolean type, true to indicate that json data starts with an array object and flattens objects in the array object, default value is false.\n \n+    9. `json_root`\n+        User specifies the JSON root node as the valid JSONPath string.", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "93437d5353059476781eb72fda581f3bdf7a467a"}, "originalPosition": 5}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MjI2MTQ5MA==", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            Status JsonReader::_generate_json_paths(const std::string& jsonpath, std::vector<std::vector<JsonPath>>& vect) {\n          \n          \n            \n            Status JsonReader::_generate_json_paths(const std::string& jsonpath, std::vector<std::vector<JsonPath>>* vect) {", "url": "https://github.com/apache/incubator-doris/pull/4136#discussion_r462261490", "createdAt": "2020-07-29T12:31:06Z", "author": {"login": "imay"}, "path": "be/src/exec/json_scanner.cpp", "diffHunk": "@@ -197,30 +201,50 @@ JsonReader::~JsonReader() {\n     _close();\n }\n \n-Status JsonReader::init() {\n+Status JsonReader::init(const std::string& jsonpath, const std::string& json_root) {\n     // parse jsonpath\n+    if (!jsonpath.empty()) {\n+        Status st = _generate_json_paths(jsonpath, _parsed_jsonpaths);\n+        RETURN_IF_ERROR(st);\n+    }\n+    if (!json_root.empty()) {\n+        JsonFunctions::parse_json_paths(json_root, &_parsed_json_root);\n+    }\n+\n+    //improve performance\n+    if (_parsed_jsonpaths.empty()) { // input is a simple json-string\n+        _handle_json_callback = &JsonReader::_handle_simple_json;\n+    } else { // input is a complex json-string and a json-path\n+        if (_strip_outer_array) {\n+            _handle_json_callback = &JsonReader::_handle_flat_array_complex_json;\n+        } else {\n+            _handle_json_callback = &JsonReader::_handle_nested_complex_json;\n+        }\n+    }\n+    return Status::OK();\n+}\n+\n+Status JsonReader::_generate_json_paths(const std::string& jsonpath, std::vector<std::vector<JsonPath>>& vect) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "93437d5353059476781eb72fda581f3bdf7a467a"}, "originalPosition": 72}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDU3NTM3MTM0", "url": "https://github.com/apache/incubator-doris/pull/4136#pullrequestreview-457537134", "createdAt": "2020-07-29T13:46:17Z", "commit": {"oid": "93437d5353059476781eb72fda581f3bdf7a467a"}, "state": "DISMISSED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "93437d5353059476781eb72fda581f3bdf7a467a", "author": {"user": {"login": "worker24h", "name": null}}, "url": "https://github.com/apache/incubator-doris/commit/93437d5353059476781eb72fda581f3bdf7a467a", "committedDate": "2020-07-29T12:19:56Z", "message": "1) FixBug: load json is failed in routine load\n2) Add `json_root` for nest json data\n3) Refactor code"}, "afterCommit": {"oid": "94600d06bb636c9449a2eecd60c0e91c8d48ab0b", "author": {"user": {"login": "worker24h", "name": null}}, "url": "https://github.com/apache/incubator-doris/commit/94600d06bb636c9449a2eecd60c0e91c8d48ab0b", "committedDate": "2020-07-30T01:47:58Z", "message": "1) FixBug: load json is failed in routine load\n2) Add `json_root` for nest json data\n3) Refactor code"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "846be0eb45bd91c760ee0274750591139795ee91", "author": {"user": {"login": "worker24h", "name": null}}, "url": "https://github.com/apache/incubator-doris/commit/846be0eb45bd91c760ee0274750591139795ee91", "committedDate": "2020-07-30T01:54:32Z", "message": "1) FixBug: load json is failed in routine load\n2) Add `json_root` for nest json data\n3) Refactor code"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "94600d06bb636c9449a2eecd60c0e91c8d48ab0b", "author": {"user": {"login": "worker24h", "name": null}}, "url": "https://github.com/apache/incubator-doris/commit/94600d06bb636c9449a2eecd60c0e91c8d48ab0b", "committedDate": "2020-07-30T01:47:58Z", "message": "1) FixBug: load json is failed in routine load\n2) Add `json_root` for nest json data\n3) Refactor code"}, "afterCommit": {"oid": "846be0eb45bd91c760ee0274750591139795ee91", "author": {"user": {"login": "worker24h", "name": null}}, "url": "https://github.com/apache/incubator-doris/commit/846be0eb45bd91c760ee0274750591139795ee91", "committedDate": "2020-07-30T01:54:32Z", "message": "1) FixBug: load json is failed in routine load\n2) Add `json_root` for nest json data\n3) Refactor code"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDU4MDIwNjMw", "url": "https://github.com/apache/incubator-doris/pull/4136#pullrequestreview-458020630", "createdAt": "2020-07-30T01:58:45Z", "commit": {"oid": "846be0eb45bd91c760ee0274750591139795ee91"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1974, "cost": 1, "resetAt": "2021-10-28T17:48:14Z"}}}