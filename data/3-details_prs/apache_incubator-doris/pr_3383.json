{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDA3NjY3Mjcz", "number": 3383, "title": "Make running profile clearer and more intuitive to improve usability (#3365)", "bodyText": "This CL mainly made the following modifications:\n\nDelete Invalid method in Running Profile Class.\nMove Memlimit Counter from blockmgr to frgment and add PeakMemUsage Counter\nFix the bug of buffer pool memlimit counter\nCall compute_time_in_profile() before pretty_print() to show the _local_time_percent without child running profile\nAdd TransferThread ThreadToken count in AveThreadToken Counter\n\nISSUE: #3365", "createdAt": "2020-04-23T04:06:42Z", "url": "https://github.com/apache/incubator-doris/pull/3383", "merged": true, "mergeCommit": {"oid": "4eb27bc7e32222d81b3a6a9b2bededb9af01d8e9"}, "closed": true, "closedAt": "2020-04-24T13:38:56Z", "author": {"login": "HappenLee"}, "timelineItems": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcaU0Q3AH2gAyNDA3NjY3MjczOmFjOWUzODkzNTM4ZmNhMTQ4NzIzMjg3ZDZmZGZkYzNkZGE1MDFlODk=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcaxnsWgFqTM5OTk1MjU2NA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "ac9e3893538fca148723287d6fdfdc3dda501e89", "author": {"user": {"login": "HappenLee", "name": "HappenLee"}}, "url": "https://github.com/apache/incubator-doris/commit/ac9e3893538fca148723287d6fdfdc3dda501e89", "committedDate": "2020-04-23T04:03:18Z", "message": "Make running profile clearer and more intuitive to improve usability (#3365)\n\nThis CL mainly made the following modifications:\n1. Delete Invalid method in Running Profile Class.\n2. Move Memlimit Counter from blockmgr to frgment and add PeakMemUsage Counter\n3. Fix the bug of buffer pool memlimit counter\n4. Call compute_time_in_profile() before pretty_print() to show the _local_time_percent without child running profile\n5. Add TransferThread ThreadToken count in AveThreadToken Counter"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzk5MjUyMjQ2", "url": "https://github.com/apache/incubator-doris/pull/3383#pullrequestreview-399252246", "createdAt": "2020-04-23T16:06:01Z", "commit": {"oid": "ac9e3893538fca148723287d6fdfdc3dda501e89"}, "state": "COMMENTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yM1QxNjowNjowMVrOGKwFFA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yM1QxNjowNzo0NVrOGKwKkw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMzkyNjY3Ng==", "bodyText": "Can you tell the side effect of this operation? Will this thread hang if there is not enough thread resource?", "url": "https://github.com/apache/incubator-doris/pull/3383#discussion_r413926676", "createdAt": "2020-04-23T16:06:01Z", "author": {"login": "imay"}, "path": "be/src/exec/olap_scan_node.cpp", "diffHunk": "@@ -1038,6 +1038,7 @@ Status OlapScanNode::normalize_binary_predicate(SlotDescriptor* slot, ColumnValu\n \n void OlapScanNode::transfer_thread(RuntimeState* state) {\n     // scanner open pushdown to scanThread\n+    state->resource_pool()->acquire_thread_token();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ac9e3893538fca148723287d6fdfdc3dda501e89"}, "originalPosition": 4}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMzkyODA4Mw==", "bodyText": "If you add profile for this memory tracker, why not _instance_mem_tracker?", "url": "https://github.com/apache/incubator-doris/pull/3383#discussion_r413928083", "createdAt": "2020-04-23T16:07:45Z", "author": {"login": "imay"}, "path": "be/src/runtime/runtime_state.cpp", "diffHunk": "@@ -226,8 +226,12 @@ Status RuntimeState::init_mem_trackers(const TUniqueId& query_id) {\n \n     // _query_mem_tracker = MemTracker::get_query_mem_tracker(\n     //         query_id, bytes_limit, _exec_env->process_mem_tracker());\n+\n+    auto mem_tracker_counter = ADD_COUNTER(&_profile, \"MemoryLimit\", TUnit::BYTES);\n+    mem_tracker_counter->set(bytes_limit);\n+\n     _query_mem_tracker.reset(\n-            new MemTracker(bytes_limit, runtime_profile()->name(), _exec_env->process_mem_tracker()));\n+            new MemTracker(&_profile, bytes_limit, runtime_profile()->name(), _exec_env->process_mem_tracker()));", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ac9e3893538fca148723287d6fdfdc3dda501e89"}, "originalPosition": 10}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "718ff99091f43a33c2026a1c5da8fd95397b6f18", "author": {"user": {"login": "HappenLee", "name": "HappenLee"}}, "url": "https://github.com/apache/incubator-doris/commit/718ff99091f43a33c2026a1c5da8fd95397b6f18", "committedDate": "2020-04-24T03:37:48Z", "message": "add some code annotation for compute_time_in_profile()\nchange profile counter to _instance_mem_tracker"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzk5OTUyNTY0", "url": "https://github.com/apache/incubator-doris/pull/3383#pullrequestreview-399952564", "createdAt": "2020-04-24T13:36:49Z", "commit": {"oid": "718ff99091f43a33c2026a1c5da8fd95397b6f18"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2851, "cost": 1, "resetAt": "2021-10-28T17:48:14Z"}}}