{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0Mzk0NTI1Mzc1", "number": 3211, "reviewThreads": {"totalCount": 6, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yN1QwMzozMzo0MlrODr6ZSQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yN1QwNjoyNTowOVrODr8DdA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjQ3MzcyMTA1OnYy", "diffSide": "RIGHT", "path": "be/src/exprs/utility_functions.cpp", "isResolved": false, "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yN1QwMzozMzo0MlrOF8iDCA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yN1QwNTo1MzozMlrOF8kBXQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5OTAxNjcxMg==", "bodyText": "why not change this?", "url": "https://github.com/apache/incubator-doris/pull/3211#discussion_r399016712", "createdAt": "2020-03-27T03:33:42Z", "author": {"login": "imay"}, "path": "be/src/exprs/utility_functions.cpp", "diffHunk": "@@ -17,27 +17,25 @@\n \n #include \"exprs/utility_functions.h\"\n \n-#include \"exprs/expr.h\"\n #include \"exprs/anyval_util.h\"\n-#include \"util/debug_util.h\"\n+#include \"exprs/expr.h\"\n #include \"runtime/tuple_row.h\"\n+#include \"util/debug_util.h\"\n \n namespace doris {\n \n-void UtilityFunctions::init() {\n-}\n+void UtilityFunctions::init() {}\n \n StringVal UtilityFunctions::version(FunctionContext* ctx) {\n     return AnyValUtil::from_string_temp(ctx, \"5.1.0\");\n }\n \n-BooleanVal UtilityFunctions::sleep(\n-        FunctionContext* ctx, const IntVal& milliseconds) {\n+BooleanVal UtilityFunctions::sleep(FunctionContext* ctx, const IntVal& milliseconds) {\n     if (milliseconds.is_null) {\n         return BooleanVal::null();\n     }\n-    usleep(milliseconds.val * 1000 * 1000);\n+    usleep(milliseconds.val * 1000 * 1000); // TODO(hw): ms * 1000 * 1000 = ns", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "788cc8ce9278cfaffd2cdb6ea15577ab6c788472"}, "originalPosition": 28}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5OTAzMzYzMQ==", "bodyText": "I'm confused about this. This usleep() use ns as its argument. Is it a mistake?\nI should change it to\nSleepFor(MonoDelta::FromMilliseconds(milliseconds.val) ?", "url": "https://github.com/apache/incubator-doris/pull/3211#discussion_r399033631", "createdAt": "2020-03-27T04:48:07Z", "author": {"login": "vagetablechicken"}, "path": "be/src/exprs/utility_functions.cpp", "diffHunk": "@@ -17,27 +17,25 @@\n \n #include \"exprs/utility_functions.h\"\n \n-#include \"exprs/expr.h\"\n #include \"exprs/anyval_util.h\"\n-#include \"util/debug_util.h\"\n+#include \"exprs/expr.h\"\n #include \"runtime/tuple_row.h\"\n+#include \"util/debug_util.h\"\n \n namespace doris {\n \n-void UtilityFunctions::init() {\n-}\n+void UtilityFunctions::init() {}\n \n StringVal UtilityFunctions::version(FunctionContext* ctx) {\n     return AnyValUtil::from_string_temp(ctx, \"5.1.0\");\n }\n \n-BooleanVal UtilityFunctions::sleep(\n-        FunctionContext* ctx, const IntVal& milliseconds) {\n+BooleanVal UtilityFunctions::sleep(FunctionContext* ctx, const IntVal& milliseconds) {\n     if (milliseconds.is_null) {\n         return BooleanVal::null();\n     }\n-    usleep(milliseconds.val * 1000 * 1000);\n+    usleep(milliseconds.val * 1000 * 1000); // TODO(hw): ms * 1000 * 1000 = ns", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5OTAxNjcxMg=="}, "originalCommit": {"oid": "788cc8ce9278cfaffd2cdb6ea15577ab6c788472"}, "originalPosition": 28}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5OTA0OTA1Mw==", "bodyText": "this function is used to support SQL select sleep(N); N is for N second. so you just change it to sleepFor(Second)", "url": "https://github.com/apache/incubator-doris/pull/3211#discussion_r399049053", "createdAt": "2020-03-27T05:53:32Z", "author": {"login": "imay"}, "path": "be/src/exprs/utility_functions.cpp", "diffHunk": "@@ -17,27 +17,25 @@\n \n #include \"exprs/utility_functions.h\"\n \n-#include \"exprs/expr.h\"\n #include \"exprs/anyval_util.h\"\n-#include \"util/debug_util.h\"\n+#include \"exprs/expr.h\"\n #include \"runtime/tuple_row.h\"\n+#include \"util/debug_util.h\"\n \n namespace doris {\n \n-void UtilityFunctions::init() {\n-}\n+void UtilityFunctions::init() {}\n \n StringVal UtilityFunctions::version(FunctionContext* ctx) {\n     return AnyValUtil::from_string_temp(ctx, \"5.1.0\");\n }\n \n-BooleanVal UtilityFunctions::sleep(\n-        FunctionContext* ctx, const IntVal& milliseconds) {\n+BooleanVal UtilityFunctions::sleep(FunctionContext* ctx, const IntVal& milliseconds) {\n     if (milliseconds.is_null) {\n         return BooleanVal::null();\n     }\n-    usleep(milliseconds.val * 1000 * 1000);\n+    usleep(milliseconds.val * 1000 * 1000); // TODO(hw): ms * 1000 * 1000 = ns", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5OTAxNjcxMg=="}, "originalCommit": {"oid": "788cc8ce9278cfaffd2cdb6ea15577ab6c788472"}, "originalPosition": 28}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjQ3Mzk5MDY5OnYy", "diffSide": "RIGHT", "path": "be/src/agent/task_worker_pool.cpp", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yN1QwNjoyNDowM1rOF8khEw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yN1QwNjoyNDowM1rOF8khEw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5OTA1NzE3MQ==", "bodyText": "use LOG(WARNING) instead", "url": "https://github.com/apache/incubator-doris/pull/3211#discussion_r399057171", "createdAt": "2020-03-27T06:24:03Z", "author": {"login": "chaoyli"}, "path": "be/src/agent/task_worker_pool.cpp", "diffHunk": "@@ -668,8 +658,8 @@ void* TaskWorkerPool::_push_worker_thread_callback(void* arg_this) {\n             error_msgs.push_back(\"push request push_type invalid.\");\n             task_status.__set_status_code(TStatusCode::ANALYSIS_ERROR);\n         } else {\n-            OLAP_LOG_WARNING(\"push failed, error_code: %d, signature: %ld\",\n-                             status, agent_task_req.signature);\n+            OLAP_LOG_WARNING(\"push failed, error_code: %d, signature: %ld\", status,", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "789510b9469e8cf7c228853e160514ca162aa354"}, "originalPosition": 252}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjQ3Mzk5MTE5OnYy", "diffSide": "RIGHT", "path": "be/src/agent/task_worker_pool.cpp", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yN1QwNjoyNDoxNlrOF8khXQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yN1QwNjoyNDoxNlrOF8khXQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5OTA1NzI0NQ==", "bodyText": "use LOG(WARNING) instead", "url": "https://github.com/apache/incubator-doris/pull/3211#discussion_r399057245", "createdAt": "2020-03-27T06:24:16Z", "author": {"login": "chaoyli"}, "path": "be/src/agent/task_worker_pool.cpp", "diffHunk": "@@ -718,11 +708,12 @@ void* TaskWorkerPool::_publish_version_worker_thread_callback(void* arg_this) {\n             if (res == OLAP_SUCCESS) {\n                 break;\n             } else {\n-                OLAP_LOG_WARNING(\"publish version error, retry. \"\n-                                 \"[transaction_id=%ld, error_tablets_size=%d]\",\n-                                 publish_version_req.transaction_id, error_tablet_ids.size());\n+                OLAP_LOG_WARNING(", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "789510b9469e8cf7c228853e160514ca162aa354"}, "originalPosition": 273}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjQ3Mzk5MTgyOnYy", "diffSide": "RIGHT", "path": "be/src/agent/task_worker_pool.cpp", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yN1QwNjoyNDozNVrOF8khvw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yN1QwNjoyNDozNVrOF8khvw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5OTA1NzM0Mw==", "bodyText": "use LOG(WARNING) instead", "url": "https://github.com/apache/incubator-doris/pull/3211#discussion_r399057343", "createdAt": "2020-03-27T06:24:35Z", "author": {"login": "chaoyli"}, "path": "be/src/agent/task_worker_pool.cpp", "diffHunk": "@@ -967,8 +956,8 @@ void* TaskWorkerPool::_storage_medium_migrate_worker_thread_callback(void* arg_t\n         EngineStorageMigrationTask engine_task(storage_medium_migrate_req);\n         OLAPStatus res = worker_pool_this->_env->storage_engine()->execute_task(&engine_task);\n         if (res != OLAP_SUCCESS) {\n-            OLAP_LOG_WARNING(\"storage media migrate failed. status: %d, signature: %ld\",\n-                             res, agent_task_req.signature);\n+            OLAP_LOG_WARNING(\"storage media migrate failed. status: %d, signature: %ld\", res,", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "789510b9469e8cf7c228853e160514ca162aa354"}, "originalPosition": 370}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjQ3Mzk5MjQyOnYy", "diffSide": "RIGHT", "path": "be/src/agent/task_worker_pool.cpp", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yN1QwNjoyNDo1M1rOF8kiEQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yN1QwNjoyNDo1M1rOF8kiEQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5OTA1NzQyNQ==", "bodyText": "use LOG(WARNING) instead", "url": "https://github.com/apache/incubator-doris/pull/3211#discussion_r399057425", "createdAt": "2020-03-27T06:24:53Z", "author": {"login": "chaoyli"}, "path": "be/src/agent/task_worker_pool.cpp", "diffHunk": "@@ -1016,20 +1005,17 @@ void* TaskWorkerPool::_check_consistency_worker_thread_callback(void* arg_this)\n         TStatus task_status;\n \n         uint32_t checksum = 0;\n-        EngineChecksumTask engine_task(check_consistency_req.tablet_id,\n-                check_consistency_req.schema_hash,\n-                check_consistency_req.version,\n-                check_consistency_req.version_hash,\n-                &checksum);\n+        EngineChecksumTask engine_task(\n+                check_consistency_req.tablet_id, check_consistency_req.schema_hash,\n+                check_consistency_req.version, check_consistency_req.version_hash, &checksum);\n         OLAPStatus res = worker_pool_this->_env->storage_engine()->execute_task(&engine_task);\n         if (res != OLAP_SUCCESS) {\n-            OLAP_LOG_WARNING(\"check consistency failed. status: %d, signature: %ld\",\n-                             res, agent_task_req.signature);\n+            OLAP_LOG_WARNING(\"check consistency failed. status: %d, signature: %ld\", res,", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "789510b9469e8cf7c228853e160514ca162aa354"}, "originalPosition": 391}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjQ3Mzk5Mjg0OnYy", "diffSide": "RIGHT", "path": "be/src/agent/task_worker_pool.cpp", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yN1QwNjoyNTowOVrOF8kiUw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yN1QwNjoyNTowOVrOF8kiUw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5OTA1NzQ5MQ==", "bodyText": "use LOG(WARNING) instead", "url": "https://github.com/apache/incubator-doris/pull/3211#discussion_r399057491", "createdAt": "2020-03-27T06:25:09Z", "author": {"login": "chaoyli"}, "path": "be/src/agent/task_worker_pool.cpp", "diffHunk": "@@ -1169,7 +1160,8 @@ void* TaskWorkerPool::_report_tablet_worker_thread_callback(void* arg_this) {\n \n         request.__set_report_version(_s_report_version);\n         OLAPStatus report_all_tablets_info_status =\n-                StorageEngine::instance()->tablet_manager()->report_all_tablets_info(&request.tablets);\n+                StorageEngine::instance()->tablet_manager()->report_all_tablets_info(\n+                        &request.tablets);\n         if (report_all_tablets_info_status != OLAP_SUCCESS) {\n             OLAP_LOG_WARNING(\"report get all tablets info failed. status: %d\",", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "789510b9469e8cf7c228853e160514ca162aa354"}, "originalPosition": 465}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1822, "cost": 1, "resetAt": "2021-11-12T09:44:50Z"}}}