{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0Mzg2MDcwMjE3", "number": 3069, "title": "Support 64 bit timestamp in from_unixtime", "bodyText": "Support 64 bit timestamp in from_unixtime\n#3104", "createdAt": "2020-03-10T11:08:51Z", "url": "https://github.com/apache/incubator-doris/pull/3069", "merged": true, "mergeCommit": {"oid": "d01b58bff6ee90078fac3102fe649bbedfc497cf"}, "closed": true, "closedAt": "2020-03-17T09:30:43Z", "author": {"login": "HangyuanLiu"}, "timelineItems": {"totalCount": 9, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcMNeXBAH2gAyMzg2MDcwMjE3OmIyMmExZWExZmEzZjc2YTk3OGFmMDNiMTliMWRhYTNmYTI0NDAyYWE=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcOfUd1AFqTM3NTg2NjI2MQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "b22a1ea1fa3f76a978af03b19b1daa3fa24402aa", "author": {"user": {"login": "HangyuanLiu", "name": null}}, "url": "https://github.com/apache/incubator-doris/commit/b22a1ea1fa3f76a978af03b19b1daa3fa24402aa", "committedDate": "2020-03-10T07:35:06Z", "message": "support timestamp to 64bit in broker load"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e320f8a78f30af1f444f37a3470894e8760a489e", "author": {"user": {"login": "HangyuanLiu", "name": null}}, "url": "https://github.com/apache/incubator-doris/commit/e320f8a78f30af1f444f37a3470894e8760a489e", "committedDate": "2020-03-10T11:02:05Z", "message": "fix"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "642337196a0b66f458bcaca824abdf782e7698a2", "author": {"user": {"login": "HangyuanLiu", "name": null}}, "url": "https://github.com/apache/incubator-doris/commit/642337196a0b66f458bcaca824abdf782e7698a2", "committedDate": "2020-03-10T11:06:23Z", "message": "fix"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "6d6f96e8a847b4b0140772578aaa398833f820ea", "author": {"user": {"login": "HangyuanLiu", "name": null}}, "url": "https://github.com/apache/incubator-doris/commit/6d6f96e8a847b4b0140772578aaa398833f820ea", "committedDate": "2020-03-10T13:40:37Z", "message": "fix parquet timestamp to 64 bit"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzcyNDI3MTY5", "url": "https://github.com/apache/incubator-doris/pull/3069#pullrequestreview-372427169", "createdAt": "2020-03-11T01:42:27Z", "commit": {"oid": "6d6f96e8a847b4b0140772578aaa398833f820ea"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xMVQwMTo0MjoyN1rOF0mn_w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xMVQwMTo0NDoxOVrOF0mpwg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MDcwMzEwMw==", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                        timestamp = ts_array->Value(_current_line_of_batch) / 1000000000; // convert to Second\n          \n          \n            \n                        timestamp = ts_array->Value(_current_line_of_batch) / 1000000000L; // convert to Second", "url": "https://github.com/apache/incubator-doris/pull/3069#discussion_r390703103", "createdAt": "2020-03-11T01:42:27Z", "author": {"login": "imay"}, "path": "be/src/exec/parquet_reader.cpp", "diffHunk": "@@ -188,30 +189,38 @@ Status ParquetReaderWrap::read_record_batch(const std::vector<SlotDescriptor*>&\n Status ParquetReaderWrap::handle_timestamp(const std::shared_ptr<arrow::TimestampArray>& ts_array, uint8_t *buf, int32_t *wbytes) {\n     const auto type = std::dynamic_pointer_cast<arrow::TimestampType>(ts_array->type());\n     // Doris only supports seconds\n-    time_t timestamp = 0;\n+    int64_t timestamp = 0;\n     switch (type->unit()) {\n         case arrow::TimeUnit::type::NANO: {// INT96\n-            timestamp = (time_t)((int64_t)ts_array->Value(_current_line_of_batch) / 1000000000); // convert to Second\n+            timestamp = ts_array->Value(_current_line_of_batch) / 1000000000; // convert to Second", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "6d6f96e8a847b4b0140772578aaa398833f820ea"}, "originalPosition": 28}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MDcwMzU1NA==", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                while(current_t > 0) {\n          \n          \n            \n                while (current_t > 0) {\n          \n      \n    \n    \n  \n\nAdd some comments about what this block is doing.", "url": "https://github.com/apache/incubator-doris/pull/3069#discussion_r390703554", "createdAt": "2020-03-11T01:44:19Z", "author": {"login": "imay"}, "path": "be/src/runtime/datetime_value.cpp", "diffHunk": "@@ -1557,13 +1557,28 @@ bool DateTimeValue::from_unixtime(int64_t timestamp, const std::string& timezone\n     if (timestamp < 0 || timestamp > 253402271999L) {\n         return false;\n     }\n+\n     boost::local_time::time_zone_ptr local_time_zone = TimezoneDatabase::find_timezone(timezone);\n     if (local_time_zone == nullptr) {\n         return false;                            \n     }\n-    boost::local_time::local_date_time lt(boost::posix_time::from_time_t(timestamp), local_time_zone);\n+\n+    int64_t current_t = timestamp;\n+    boost::posix_time::ptime time = boost::posix_time::ptime(boost::gregorian::date(1970,1,1));\n+\n+    while(current_t > 0) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "6d6f96e8a847b4b0140772578aaa398833f820ea"}, "originalPosition": 14}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "0c1b83702f6ae8f8fed87c655dafa7481b436f03", "author": {"user": {"login": "HangyuanLiu", "name": null}}, "url": "https://github.com/apache/incubator-doris/commit/0c1b83702f6ae8f8fed87c655dafa7481b436f03", "committedDate": "2020-03-13T07:33:34Z", "message": "fix format"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzc0MzgxMzg0", "url": "https://github.com/apache/incubator-doris/pull/3069#pullrequestreview-374381384", "createdAt": "2020-03-13T15:12:28Z", "commit": {"oid": "0c1b83702f6ae8f8fed87c655dafa7481b436f03"}, "state": "COMMENTED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "dd00ba6f35309f3431505de50196a24382161f96", "author": {"user": {"login": "HangyuanLiu", "name": null}}, "url": "https://github.com/apache/incubator-doris/commit/dd00ba6f35309f3431505de50196a24382161f96", "committedDate": "2020-03-14T13:46:16Z", "message": "Merge branch 'master' of https://github.com/apache/incubator-doris into output_scale"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzc1ODY2MjYx", "url": "https://github.com/apache/incubator-doris/pull/3069#pullrequestreview-375866261", "createdAt": "2020-03-17T09:30:26Z", "commit": {"oid": "dd00ba6f35309f3431505de50196a24382161f96"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3551, "cost": 1, "resetAt": "2021-10-28T17:48:14Z"}}}