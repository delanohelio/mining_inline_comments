{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDQ4MjYwMjk0", "number": 4088, "reviewThreads": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xM1QxNTo0MDoxMlrOEN4DKA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xM1QxNTo0NDozMlrOEN4LYQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjgyOTg1MjU2OnYy", "diffSide": "RIGHT", "path": "fe/src/main/java/org/apache/doris/clone/TabletScheduler.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xM1QxNTo0MDoxMlrOGwuUJA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xNlQwMTo1OTozNVrOGyXWuw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1Mzc0MzY1Mg==", "bodyText": "SchedExcepition looks so stranger...", "url": "https://github.com/apache/incubator-doris/pull/4088#discussion_r453743652", "createdAt": "2020-07-13T15:40:12Z", "author": {"login": "wuyunfeng"}, "path": "fe/src/main/java/org/apache/doris/clone/TabletScheduler.java", "diffHunk": "@@ -879,9 +880,14 @@ private void deleteReplicaInternal(TabletSchedCtx tabletCtx, Replica replica, St\n             throw new SchedException(Status.SCHEDULE_FAILED, \"set watermark txn \" + nextTxnId);\n         } else if (replica.getState() == ReplicaState.DECOMMISSION && replica.getWatermarkTxnId() != -1) {\n             long watermarkTxnId = replica.getWatermarkTxnId();\n-            if (!Catalog.getCurrentGlobalTransactionMgr().isPreviousTransactionsFinished(watermarkTxnId,\n-                    tabletCtx.getDbId(), Lists.newArrayList(tabletCtx.getTblId()))) {\n-                throw new SchedException(Status.SCHEDULE_FAILED, \"wait txn before \" + watermarkTxnId + \" to be finished\");\n+            try {\n+                if (!Catalog.getCurrentGlobalTransactionMgr().isPreviousTransactionsFinished(watermarkTxnId,\n+                        tabletCtx.getDbId(), Lists.newArrayList(tabletCtx.getTblId()))) {\n+                    throw new SchedException(Status.SCHEDULE_FAILED,", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "2aac2b9623544241e060034ce8fdc157f9a411e0"}, "originalPosition": 18}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NTQ2NDYzNQ==", "bodyText": "bear it! LOL", "url": "https://github.com/apache/incubator-doris/pull/4088#discussion_r455464635", "createdAt": "2020-07-16T01:59:35Z", "author": {"login": "morningman"}, "path": "fe/src/main/java/org/apache/doris/clone/TabletScheduler.java", "diffHunk": "@@ -879,9 +880,14 @@ private void deleteReplicaInternal(TabletSchedCtx tabletCtx, Replica replica, St\n             throw new SchedException(Status.SCHEDULE_FAILED, \"set watermark txn \" + nextTxnId);\n         } else if (replica.getState() == ReplicaState.DECOMMISSION && replica.getWatermarkTxnId() != -1) {\n             long watermarkTxnId = replica.getWatermarkTxnId();\n-            if (!Catalog.getCurrentGlobalTransactionMgr().isPreviousTransactionsFinished(watermarkTxnId,\n-                    tabletCtx.getDbId(), Lists.newArrayList(tabletCtx.getTblId()))) {\n-                throw new SchedException(Status.SCHEDULE_FAILED, \"wait txn before \" + watermarkTxnId + \" to be finished\");\n+            try {\n+                if (!Catalog.getCurrentGlobalTransactionMgr().isPreviousTransactionsFinished(watermarkTxnId,\n+                        tabletCtx.getDbId(), Lists.newArrayList(tabletCtx.getTblId()))) {\n+                    throw new SchedException(Status.SCHEDULE_FAILED,", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1Mzc0MzY1Mg=="}, "originalCommit": {"oid": "2aac2b9623544241e060034ce8fdc157f9a411e0"}, "originalPosition": 18}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjgyOTg3MzYxOnYy", "diffSide": "RIGHT", "path": "fe/src/main/java/org/apache/doris/transaction/GlobalTransactionMgr.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xM1QxNTo0NDozMlrOGwuhcQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xM1QxNTo0NDozMlrOGwuhcQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1Mzc0NzA1Nw==", "bodyText": "This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters. Learn more about bidirectional Unicode characters\n\n\n  \n\n\n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                 * check if there exists a load job before the endTransactionId have all\n          \n          \n            \n                 * Check whether a load job already exists before checking all `TransactionId` related with this load job have finished.", "url": "https://github.com/apache/incubator-doris/pull/4088#discussion_r453747057", "createdAt": "2020-07-13T15:44:32Z", "author": {"login": "wuyunfeng"}, "path": "fe/src/main/java/org/apache/doris/transaction/GlobalTransactionMgr.java", "diffHunk": "@@ -238,17 +238,25 @@ public void finishTransaction(long dbId, long transactionId, Set<Long> errorRepl\n     }\n \n     /**\n-     * check if there exists a load job before the endTransactionId have all finished\n+     * check if there exists a load job before the endTransactionId have all", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "2aac2b9623544241e060034ce8fdc157f9a411e0"}, "originalPosition": 5}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1416, "cost": 1, "resetAt": "2021-11-12T09:44:50Z"}}}