{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDI1NDU0MjQz", "number": 3734, "reviewThreads": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wMlQwMjo1Nzo0MVrOEBk9sQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wMlQwMzoxNDozOVrOEBlGQA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjcwMDg5NjQ5OnYy", "diffSide": "RIGHT", "path": "be/src/olap/base_tablet.cpp", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wMlQwMjo1Nzo0MVrOGdgd3A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wMlQwNjo0NDo1MFrOGdkIXg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMzU5MzgyMA==", "bodyText": "In what situation, _data_dir is nullptr?", "url": "https://github.com/apache/incubator-doris/pull/3734#discussion_r433593820", "createdAt": "2020-06-02T02:57:41Z", "author": {"login": "chaoyli"}, "path": "be/src/olap/base_tablet.cpp", "diffHunk": "@@ -44,11 +43,13 @@ OLAPStatus BaseTablet::set_tablet_state(TabletState state) {\n }\n \n void BaseTablet::_gen_tablet_path() {\n-    std::string path = _data_dir->path() + DATA_PREFIX;\n-    path = path_util::join_path_segments(path, std::to_string(_tablet_meta->shard_id()));\n-    path = path_util::join_path_segments(path, std::to_string(_tablet_meta->tablet_id()));\n-    path = path_util::join_path_segments(path, std::to_string(_tablet_meta->schema_hash()));\n-    _tablet_path = path;\n+    if (_data_dir != nullptr) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f9da6f48b7bb94500af41b992de247c7b8b6ccbb"}, "originalPosition": 40}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMzY1Mzg1NA==", "bodyText": "In unittest", "url": "https://github.com/apache/incubator-doris/pull/3734#discussion_r433653854", "createdAt": "2020-06-02T06:44:50Z", "author": {"login": "decster"}, "path": "be/src/olap/base_tablet.cpp", "diffHunk": "@@ -44,11 +43,13 @@ OLAPStatus BaseTablet::set_tablet_state(TabletState state) {\n }\n \n void BaseTablet::_gen_tablet_path() {\n-    std::string path = _data_dir->path() + DATA_PREFIX;\n-    path = path_util::join_path_segments(path, std::to_string(_tablet_meta->shard_id()));\n-    path = path_util::join_path_segments(path, std::to_string(_tablet_meta->tablet_id()));\n-    path = path_util::join_path_segments(path, std::to_string(_tablet_meta->schema_hash()));\n-    _tablet_path = path;\n+    if (_data_dir != nullptr) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMzU5MzgyMA=="}, "originalCommit": {"oid": "f9da6f48b7bb94500af41b992de247c7b8b6ccbb"}, "originalPosition": 40}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjcwMDkxNzU5OnYy", "diffSide": "RIGHT", "path": "be/src/olap/memory/mem_tablet_scan.h", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wMlQwMzoxMzo1OVrOGdgrfg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wMlQwNjo0NTozNVrOGdkJig==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMzU5NzMxMA==", "bodyText": "What's the use of _limit?", "url": "https://github.com/apache/incubator-doris/pull/3734#discussion_r433597310", "createdAt": "2020-06-02T03:13:59Z", "author": {"login": "chaoyli"}, "path": "be/src/olap/memory/mem_tablet_scan.h", "diffHunk": "@@ -0,0 +1,82 @@\n+// Licensed to the Apache Software Foundation (ASF) under one\n+// or more contributor license agreements.  See the NOTICE file\n+// distributed with this work for additional information\n+// regarding copyright ownership.  The ASF licenses this file\n+// to you under the Apache License, Version 2.0 (the\n+// \"License\"); you may not use this file except in compliance\n+// with the License.  You may obtain a copy of the License at\n+//\n+//   http://www.apache.org/licenses/LICENSE-2.0\n+//\n+// Unless required by applicable law or agreed to in writing,\n+// software distributed under the License is distributed on an\n+// \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n+// KIND, either express or implied.  See the License for the\n+// specific language governing permissions and limitations\n+// under the License.\n+\n+#pragma once\n+\n+#include \"olap/memory/common.h\"\n+#include \"olap/memory/row_block.h\"\n+#include \"olap/memory/schema.h\"\n+\n+namespace doris {\n+namespace memory {\n+\n+class ScanSpec {\n+public:\n+    ScanSpec(vector<std::string>&& columns, uint64_t version = UINT64_MAX,\n+             uint64_t limit = UINT64_MAX)\n+            : _version(version), _limit(limit), _columns(std::move(columns)) {}\n+\n+    uint64_t version() const { return _version; }\n+\n+    uint64_t limit() const { return _limit; }\n+\n+    const vector<std::string> columns() const { return _columns; }\n+\n+private:\n+    friend class MemTablet;\n+\n+    uint64_t _version = UINT64_MAX;\n+    uint64_t _limit = UINT64_MAX;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f9da6f48b7bb94500af41b992de247c7b8b6ccbb"}, "originalPosition": 43}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMzY1NDE1NA==", "bodyText": "For example: select * from tablet limit 10;", "url": "https://github.com/apache/incubator-doris/pull/3734#discussion_r433654154", "createdAt": "2020-06-02T06:45:35Z", "author": {"login": "decster"}, "path": "be/src/olap/memory/mem_tablet_scan.h", "diffHunk": "@@ -0,0 +1,82 @@\n+// Licensed to the Apache Software Foundation (ASF) under one\n+// or more contributor license agreements.  See the NOTICE file\n+// distributed with this work for additional information\n+// regarding copyright ownership.  The ASF licenses this file\n+// to you under the Apache License, Version 2.0 (the\n+// \"License\"); you may not use this file except in compliance\n+// with the License.  You may obtain a copy of the License at\n+//\n+//   http://www.apache.org/licenses/LICENSE-2.0\n+//\n+// Unless required by applicable law or agreed to in writing,\n+// software distributed under the License is distributed on an\n+// \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n+// KIND, either express or implied.  See the License for the\n+// specific language governing permissions and limitations\n+// under the License.\n+\n+#pragma once\n+\n+#include \"olap/memory/common.h\"\n+#include \"olap/memory/row_block.h\"\n+#include \"olap/memory/schema.h\"\n+\n+namespace doris {\n+namespace memory {\n+\n+class ScanSpec {\n+public:\n+    ScanSpec(vector<std::string>&& columns, uint64_t version = UINT64_MAX,\n+             uint64_t limit = UINT64_MAX)\n+            : _version(version), _limit(limit), _columns(std::move(columns)) {}\n+\n+    uint64_t version() const { return _version; }\n+\n+    uint64_t limit() const { return _limit; }\n+\n+    const vector<std::string> columns() const { return _columns; }\n+\n+private:\n+    friend class MemTablet;\n+\n+    uint64_t _version = UINT64_MAX;\n+    uint64_t _limit = UINT64_MAX;", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMzU5NzMxMA=="}, "originalCommit": {"oid": "f9da6f48b7bb94500af41b992de247c7b8b6ccbb"}, "originalPosition": 43}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjcwMDkxODQwOnYy", "diffSide": "RIGHT", "path": "be/src/olap/memory/mem_tablet.h", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wMlQwMzoxNDozOVrOGdgsCA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wMlQwNzoyOTo0NFrOGdlZrw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMzU5NzQ0OA==", "bodyText": "use max_version may be better.", "url": "https://github.com/apache/incubator-doris/pull/3734#discussion_r433597448", "createdAt": "2020-06-02T03:14:39Z", "author": {"login": "chaoyli"}, "path": "be/src/olap/memory/mem_tablet.h", "diffHunk": "@@ -79,6 +81,8 @@ class MemTablet : public BaseTablet {\n \n     std::mutex _write_lock;\n \n+    std::atomic<uint64_t> _latest_version;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f9da6f48b7bb94500af41b992de247c7b8b6ccbb"}, "originalPosition": 30}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMzY3NDY3MQ==", "bodyText": "OK", "url": "https://github.com/apache/incubator-doris/pull/3734#discussion_r433674671", "createdAt": "2020-06-02T07:29:44Z", "author": {"login": "decster"}, "path": "be/src/olap/memory/mem_tablet.h", "diffHunk": "@@ -79,6 +81,8 @@ class MemTablet : public BaseTablet {\n \n     std::mutex _write_lock;\n \n+    std::atomic<uint64_t> _latest_version;", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMzU5NzQ0OA=="}, "originalCommit": {"oid": "f9da6f48b7bb94500af41b992de247c7b8b6ccbb"}, "originalPosition": 30}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1419, "cost": 1, "resetAt": "2021-11-12T09:44:50Z"}}}