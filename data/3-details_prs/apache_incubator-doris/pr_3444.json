{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDExMjU4NDQ3", "number": 3444, "title": "[Bug][AuditPlugin] Fix bug that length of query stmt in audit should less than limit.", "bodyText": "Use String.getBytes().length instead of String.length() to get the real byte length of a string.\nFix: #3443\nAlso fix the typo of max_filter_ratio in audit log plugin.", "createdAt": "2020-04-30T08:42:52Z", "url": "https://github.com/apache/incubator-doris/pull/3444", "merged": true, "mergeCommit": {"oid": "8e21827505dfcf8f11a9c4e39fea0ca5e03937ef"}, "closed": true, "closedAt": "2020-05-01T13:17:11Z", "author": {"login": "morningman"}, "timelineItems": {"totalCount": 5, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcco-eMAH2gAyNDExMjU4NDQ3OjgwODI3YWExOWRjMTE2NmNiYzBiYjgzODc3NWFhZTA5ZWVlZmJiNmQ=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcc_lkcgFqTQwNDExMjg3Mw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "80827aa19dc1166cbc0bb838775aae09eeefbb6d", "author": {"user": {"login": "morningman-cmy", "name": null}}, "url": "https://github.com/apache/incubator-doris/commit/80827aa19dc1166cbc0bb838775aae09eeefbb6d", "committedDate": "2020-04-30T08:40:24Z", "message": "fix bug"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDAzMzQ1MjA4", "url": "https://github.com/apache/incubator-doris/pull/3444#pullrequestreview-403345208", "createdAt": "2020-04-30T09:18:38Z", "commit": {"oid": "80827aa19dc1166cbc0bb838775aae09eeefbb6d"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0zMFQwOToxODozOVrOGOg5VQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0zMFQwOToxODozOVrOGOg5VQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNzg3MjIxMw==", "bodyText": "Could you replace 2000 with a configuration or a static final variable?", "url": "https://github.com/apache/incubator-doris/pull/3444#discussion_r417872213", "createdAt": "2020-04-30T09:18:39Z", "author": {"login": "imay"}, "path": "fe_plugins/auditloader/src/main/java/org/apache/doris/plugin/audit/AuditLoaderPlugin.java", "diffHunk": "@@ -143,8 +143,9 @@ private void assembleAudit(AuditEvent event) {\n         auditBuffer.append(event.isQuery ? 1 : 0).append(\"\\t\");\n         auditBuffer.append(event.feIp).append(\"\\t\");\n         // trim the query to avoid too long\n-        int maxLen = Math.min(2048, event.stmt.length());\n-        String stmt = event.stmt.substring(0, maxLen).replace(\"\\t\", \" \");\n+        // use `getBytes().length` to get real byte length\n+        int maxLen = Math.min(2000, event.stmt.getBytes().length);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "80827aa19dc1166cbc0bb838775aae09eeefbb6d"}, "originalPosition": 7}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "83cbbab9911d54c2d34cdd79e04b046fa01f70db", "author": {"user": {"login": "morningman", "name": "Mingyu Chen"}}, "url": "https://github.com/apache/incubator-doris/commit/83cbbab9911d54c2d34cdd79e04b046fa01f70db", "committedDate": "2020-04-30T15:04:34Z", "message": "fix by review"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "bfb2d05921dbce632e754a79a27982c3b626e4e6", "author": {"user": {"login": "morningman", "name": "Mingyu Chen"}}, "url": "https://github.com/apache/incubator-doris/commit/bfb2d05921dbce632e754a79a27982c3b626e4e6", "committedDate": "2020-04-30T15:27:10Z", "message": "fix ut"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDA0MTEyODcz", "url": "https://github.com/apache/incubator-doris/pull/3444#pullrequestreview-404112873", "createdAt": "2020-05-01T11:01:01Z", "commit": {"oid": "bfb2d05921dbce632e754a79a27982c3b626e4e6"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2920, "cost": 1, "resetAt": "2021-10-28T17:48:14Z"}}}