{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0Mzc0MjYyMTQ0", "number": 2891, "title": "Some tiny refactor on streaming-load related code", "bodyText": "Mainly contains the following modifications:\n\nUse std::unique_ptr to replace some naked pointers\nModify some methods from member-method to local-static-function\nModify some methods do not need to be public to private\nSome formatting changes: such as wrapping lines that are too long\nRemove some useless variables\nAdd or modify some comments for easier understanding\n\nNo functional changes in this patch.", "createdAt": "2020-02-12T11:44:22Z", "url": "https://github.com/apache/incubator-doris/pull/2891", "merged": true, "mergeCommit": {"oid": "3c539aac54e6d82006c0671975bd0d46c6ec8f88"}, "closed": true, "closedAt": "2020-02-13T02:42:53Z", "author": {"login": "lingbin"}, "timelineItems": {"totalCount": 6, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcDlZH3gH2gAyMzc0MjYyMTQ0OmYzNjc5N2I5NGMzZDk4NmNmOThjNTRiZjE4YWE2YWRmNWJiZjkxY2Y=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcDxs8xAFqTM1NzkyMjcwOQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "f36797b94c3d986cf98c54bf18aa6adf5bbf91cf", "author": {"user": {"login": "lingbin", "name": "LingBin"}}, "url": "https://github.com/apache/incubator-doris/commit/f36797b94c3d986cf98c54bf18aa6adf5bbf91cf", "committedDate": "2020-02-12T12:21:47Z", "message": "Some tiny refactor on streaming-load related code\n\nMainly contains the following modifications:\n1. Use `std::unique_ptr` to replace some naked pointers\n2. Modify some methods from member-method to local-static-function\n3. Modify some methods do not need to be public to private\n4. Some formatting changes: such as wrapping lines that are too long\n5. Remove some useless variables\n6. Add or modify some comments for easier understanding\n\nNo functional changes in this patch."}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "a432f91d3a262988562bb88dc5afb19f252922d3", "author": {"user": {"login": "lingbin", "name": "LingBin"}}, "url": "https://github.com/apache/incubator-doris/commit/a432f91d3a262988562bb88dc5afb19f252922d3", "committedDate": "2020-02-12T11:39:27Z", "message": "Some tiny refactor on streaming-load related code\n\nMainly contains the following modifications:\n1. Use `std::unique_ptr` to replace some naked pointers\n2. Modify some methods from member-method to local-static-function\n3. Modify some methods do not need to be public to private\n4. Some formatting changes: such as wrapping lines that are too long\n5. Remove some useless variables\n6. Add or modify some comments for easier understanding\n\nNo functional changes in this patch."}, "afterCommit": {"oid": "f36797b94c3d986cf98c54bf18aa6adf5bbf91cf", "author": {"user": {"login": "lingbin", "name": "LingBin"}}, "url": "https://github.com/apache/incubator-doris/commit/f36797b94c3d986cf98c54bf18aa6adf5bbf91cf", "committedDate": "2020-02-12T12:21:47Z", "message": "Some tiny refactor on streaming-load related code\n\nMainly contains the following modifications:\n1. Use `std::unique_ptr` to replace some naked pointers\n2. Modify some methods from member-method to local-static-function\n3. Modify some methods do not need to be public to private\n4. Some formatting changes: such as wrapping lines that are too long\n5. Remove some useless variables\n6. Add or modify some comments for easier understanding\n\nNo functional changes in this patch."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzU3NDc2NzQ4", "url": "https://github.com/apache/incubator-doris/pull/2891#pullrequestreview-357476748", "createdAt": "2020-02-12T14:06:18Z", "commit": {"oid": "f36797b94c3d986cf98c54bf18aa6adf5bbf91cf"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xMlQxNDowNjoxOFrOFovyng==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xMlQxNDoxMzo0OFrOFowEzg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3ODI3MDM2Ng==", "bodyText": "Those on_xxx methods of FlushHandler should be public. FlushHandler is independent of MemTableFlushExecutor. Just because FlushHandler is a friend class of MemTableFlushExecutor, so that you can change it to private.", "url": "https://github.com/apache/incubator-doris/pull/2891#discussion_r378270366", "createdAt": "2020-02-12T14:06:18Z", "author": {"login": "morningman"}, "path": "be/src/olap/memtable_flush_executor.cpp", "diffHunk": "@@ -42,7 +44,7 @@ OLAPStatus FlushHandler::wait() {\n     return _last_flush_status.load();\n }\n \n-void FlushHandler::on_flush_finished(const FlushResult& res) {\n+void FlushHandler::_on_flush_finished(const FlushResult& res) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f36797b94c3d986cf98c54bf18aa6adf5bbf91cf"}, "originalPosition": 23}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3ODI3NTAyMg==", "bodyText": "Do not change this error msg, leave it as \"too many filtered rows\". It is long history, and some user may depends on this certain msg.", "url": "https://github.com/apache/incubator-doris/pull/2891#discussion_r378275022", "createdAt": "2020-02-12T14:13:48Z", "author": {"login": "morningman"}, "path": "be/src/runtime/stream_load/stream_load_executor.cpp", "diffHunk": "@@ -61,12 +61,10 @@ Status StreamLoadExecutor::execute_plan_fragment(StreamLoadContext* ctx) {\n                 ctx->number_filtered_rows = executor->runtime_state()->num_rows_load_filtered();\n                 ctx->number_unselected_rows = executor->runtime_state()->num_rows_load_unselected();\n \n-                int64_t num_selected_rows =\n-                    ctx->number_total_rows - ctx->number_unselected_rows;\n-                if ((0.0 + ctx->number_filtered_rows) / num_selected_rows > ctx->max_filter_ratio) {\n-                    status = Status::InternalError(\"too many filtered rows\");\n-                }\n-                else if(ctx->number_loaded_rows == 0){\n+                int64_t num_selected_rows = ctx->number_total_rows - ctx->number_unselected_rows;\n+                if ((double)ctx->number_filtered_rows / num_selected_rows > ctx->max_filter_ratio) {\n+                    status = Status::InternalError(\"too many rows are filtered out\");", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f36797b94c3d986cf98c54bf18aa6adf5bbf91cf"}, "originalPosition": 25}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b4f5a19136915116b048e6d42b114dd91dc9e3ac", "author": {"user": {"login": "lingbin", "name": "LingBin"}}, "url": "https://github.com/apache/incubator-doris/commit/b4f5a19136915116b048e6d42b114dd91dc9e3ac", "committedDate": "2020-02-12T15:11:14Z", "message": "Modify according by comment"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzU3OTE2MjI0", "url": "https://github.com/apache/incubator-doris/pull/2891#pullrequestreview-357916224", "createdAt": "2020-02-13T02:17:47Z", "commit": {"oid": "b4f5a19136915116b048e6d42b114dd91dc9e3ac"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzU3OTIyNzA5", "url": "https://github.com/apache/incubator-doris/pull/2891#pullrequestreview-357922709", "createdAt": "2020-02-13T02:42:18Z", "commit": {"oid": "b4f5a19136915116b048e6d42b114dd91dc9e3ac"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3763, "cost": 1, "resetAt": "2021-10-28T17:48:14Z"}}}