{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDgzNjIzMzA3", "number": 4582, "reviewThreads": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xMFQxMDozNzoxNVrOEiDjvw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xMFQxMDo0MDoyOVrOEiDntg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzA0MTQ1MzQzOnYy", "diffSide": "RIGHT", "path": "fe/fe-core/src/main/java/org/apache/doris/analysis/EnableFeatureClause.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xMFQxMDozNzoxNVrOHPtkWA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xMFQxNTo0MTo0OFrOHP6Opw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NjIzNzI3Mg==", "bodyText": "I think SEQUENCE_LOAD is better", "url": "https://github.com/apache/incubator-doris/pull/4582#discussion_r486237272", "createdAt": "2020-09-10T10:37:15Z", "author": {"login": "yangzhg"}, "path": "fe/fe-core/src/main/java/org/apache/doris/analysis/EnableFeatureClause.java", "diffHunk": "@@ -21,25 +21,35 @@\n import org.apache.doris.common.AnalysisException;\n import org.apache.doris.common.UserException;\n \n+import org.apache.doris.common.util.PrintableMap;\n import org.apache.logging.log4j.LogManager;\n import org.apache.logging.log4j.Logger;\n \n+import java.util.Map;\n+\n public class EnableFeatureClause extends AlterTableClause {\n     private static final Logger LOG = LogManager.getLogger(EnableFeatureClause.class);\n \n     public enum Features {\n         BATCH_DELETE,\n+        SEQUENCE_COLUMN,", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "98a646e6c6bddc6c2c2d344142424cffe714cf9d"}, "originalPosition": 15}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NjQ0NDcxMQ==", "bodyText": "Done", "url": "https://github.com/apache/incubator-doris/pull/4582#discussion_r486444711", "createdAt": "2020-09-10T15:41:48Z", "author": {"login": "Youngwb"}, "path": "fe/fe-core/src/main/java/org/apache/doris/analysis/EnableFeatureClause.java", "diffHunk": "@@ -21,25 +21,35 @@\n import org.apache.doris.common.AnalysisException;\n import org.apache.doris.common.UserException;\n \n+import org.apache.doris.common.util.PrintableMap;\n import org.apache.logging.log4j.LogManager;\n import org.apache.logging.log4j.Logger;\n \n+import java.util.Map;\n+\n public class EnableFeatureClause extends AlterTableClause {\n     private static final Logger LOG = LogManager.getLogger(EnableFeatureClause.class);\n \n     public enum Features {\n         BATCH_DELETE,\n+        SEQUENCE_COLUMN,", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NjIzNzI3Mg=="}, "originalCommit": {"oid": "98a646e6c6bddc6c2c2d344142424cffe714cf9d"}, "originalPosition": 15}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzA0MTQ1ODg5OnYy", "diffSide": "RIGHT", "path": "fe/fe-core/src/main/cup/sql_parser.cup", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xMFQxMDozOTowNVrOHPtnxw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xMFQxNTo0MTo1OFrOHP6PDQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NjIzODE1MQ==", "bodyText": "you may add an opt_enable_feture_properties and merge them  to KW_ENABLE KW_FEATURE STRING_LITERAL:featureName opt_enable_feture_properties", "url": "https://github.com/apache/incubator-doris/pull/4582#discussion_r486238151", "createdAt": "2020-09-10T10:39:05Z", "author": {"login": "yangzhg"}, "path": "fe/fe-core/src/main/cup/sql_parser.cup", "diffHunk": "@@ -981,6 +981,10 @@ alter_table_clause ::=\n     {:\n         RESULT = new EnableFeatureClause(featureName);\n     :}\n+    | KW_ENABLE KW_FEATURE STRING_LITERAL:featureName KW_WITH opt_properties:properties\n+    {:\n+        RESULT = new EnableFeatureClause(featureName, properties);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "98a646e6c6bddc6c2c2d344142424cffe714cf9d"}, "originalPosition": 6}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NjQ0NDgxMw==", "bodyText": "Done", "url": "https://github.com/apache/incubator-doris/pull/4582#discussion_r486444813", "createdAt": "2020-09-10T15:41:58Z", "author": {"login": "Youngwb"}, "path": "fe/fe-core/src/main/cup/sql_parser.cup", "diffHunk": "@@ -981,6 +981,10 @@ alter_table_clause ::=\n     {:\n         RESULT = new EnableFeatureClause(featureName);\n     :}\n+    | KW_ENABLE KW_FEATURE STRING_LITERAL:featureName KW_WITH opt_properties:properties\n+    {:\n+        RESULT = new EnableFeatureClause(featureName, properties);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NjIzODE1MQ=="}, "originalCommit": {"oid": "98a646e6c6bddc6c2c2d344142424cffe714cf9d"}, "originalPosition": 6}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzA0MTQ2MzU4OnYy", "diffSide": "RIGHT", "path": "fe/fe-core/src/main/java/org/apache/doris/analysis/AlterTableStmt.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xMFQxMDo0MDoyOVrOHPtqmA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xMFQxMDo1Nzo0OFrOHPuNDw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NjIzODg3Mg==", "bodyText": "batch delete only  support UNIQUE_KEYS but other may support all tables", "url": "https://github.com/apache/incubator-doris/pull/4582#discussion_r486238872", "createdAt": "2020-09-10T10:40:29Z", "author": {"login": "yangzhg"}, "path": "fe/fe-core/src/main/java/org/apache/doris/analysis/AlterTableStmt.java", "diffHunk": "@@ -79,11 +82,28 @@ public void analyze(Analyzer analyzer) throws UserException {\n     public void rewriteAlterClause(OlapTable table) throws UserException {\n         List<AlterClause> clauses = new ArrayList<>();\n         for (AlterClause alterClause : ops) {\n-            if (alterClause instanceof EnableFeatureClause\n-                    && ((EnableFeatureClause) alterClause).getFeature() == EnableFeatureClause.Features.BATCH_DELETE) {\n+            if (alterClause instanceof EnableFeatureClause) {\n+                EnableFeatureClause.Features alterFeature  = ((EnableFeatureClause) alterClause).getFeature();\n+                if (alterFeature == null || alterFeature == EnableFeatureClause.Features.UNKNOWN) {\n+                    throw new AnalysisException(\"unknown feature for alter clause\");\n+                }\n                 if (table.getKeysType() != KeysType.UNIQUE_KEYS) {\n-                    throw new AnalysisException(\"Batch delete only supported in unique tables.\");\n+                    throw new AnalysisException(\"enable feature only supported in unique tables now.\");", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "98a646e6c6bddc6c2c2d344142424cffe714cf9d"}, "originalPosition": 32}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NjI0NzY5NQ==", "bodyText": "sequence column also only support UNIQUE_KEYS, and I add \"now\" in the exception for current  implementation, i think if we have feature for other tables in the future, we can change this check", "url": "https://github.com/apache/incubator-doris/pull/4582#discussion_r486247695", "createdAt": "2020-09-10T10:57:48Z", "author": {"login": "Youngwb"}, "path": "fe/fe-core/src/main/java/org/apache/doris/analysis/AlterTableStmt.java", "diffHunk": "@@ -79,11 +82,28 @@ public void analyze(Analyzer analyzer) throws UserException {\n     public void rewriteAlterClause(OlapTable table) throws UserException {\n         List<AlterClause> clauses = new ArrayList<>();\n         for (AlterClause alterClause : ops) {\n-            if (alterClause instanceof EnableFeatureClause\n-                    && ((EnableFeatureClause) alterClause).getFeature() == EnableFeatureClause.Features.BATCH_DELETE) {\n+            if (alterClause instanceof EnableFeatureClause) {\n+                EnableFeatureClause.Features alterFeature  = ((EnableFeatureClause) alterClause).getFeature();\n+                if (alterFeature == null || alterFeature == EnableFeatureClause.Features.UNKNOWN) {\n+                    throw new AnalysisException(\"unknown feature for alter clause\");\n+                }\n                 if (table.getKeysType() != KeysType.UNIQUE_KEYS) {\n-                    throw new AnalysisException(\"Batch delete only supported in unique tables.\");\n+                    throw new AnalysisException(\"enable feature only supported in unique tables now.\");", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NjIzODg3Mg=="}, "originalCommit": {"oid": "98a646e6c6bddc6c2c2d344142424cffe714cf9d"}, "originalPosition": 32}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1098, "cost": 1, "resetAt": "2021-11-12T09:44:50Z"}}}