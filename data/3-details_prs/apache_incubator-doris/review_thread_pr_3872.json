{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDM0NDE0MTE4", "number": 3872, "reviewThreads": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xNVQxMTozODo1MlrOEFgBFg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xN1QwMjo0NzoyNlrOEGLKew==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjc0MjAyOTAyOnYy", "diffSide": "RIGHT", "path": "fe/src/main/java/org/apache/doris/qe/Coordinator.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xNVQxMTozODo1MlrOGjudGw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xNlQwNjozNToyNVrOGkNGNA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MDExNDQ1OQ==", "bodyText": "black list  --> blacklist", "url": "https://github.com/apache/incubator-doris/pull/3872#discussion_r440114459", "createdAt": "2020-06-15T11:38:52Z", "author": {"login": "wutiangan"}, "path": "fe/src/main/java/org/apache/doris/qe/Coordinator.java", "diffHunk": "@@ -1469,8 +1470,41 @@ public boolean isBackendStateHealthy() {\n             try {\n                 return BackendServiceProxy.getInstance().execPlanFragmentAsync(brpcAddress, rpcParams);\n             } catch (RpcException e) {\n-                SimpleScheduler.addToBlacklist(backend.getId());\n-                throw e;\n+                // Do not throw exception here.\n+                // return a completed future, the caller will check the result and do the cancel process.\n+                PExecPlanFragmentResult result = new PExecPlanFragmentResult();\n+                PStatus pStatus = new PStatus();\n+                pStatus.error_msgs.add(e.getMessage());\n+                // use THRIFT_RPC_ERROR so that this BE will be added to the black list later.", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ce38590182edb0771ec7166069a2467c66a07345"}, "originalPosition": 19}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MDYxNjUwMA==", "bodyText": "done", "url": "https://github.com/apache/incubator-doris/pull/3872#discussion_r440616500", "createdAt": "2020-06-16T06:35:25Z", "author": {"login": "morningman"}, "path": "fe/src/main/java/org/apache/doris/qe/Coordinator.java", "diffHunk": "@@ -1469,8 +1470,41 @@ public boolean isBackendStateHealthy() {\n             try {\n                 return BackendServiceProxy.getInstance().execPlanFragmentAsync(brpcAddress, rpcParams);\n             } catch (RpcException e) {\n-                SimpleScheduler.addToBlacklist(backend.getId());\n-                throw e;\n+                // Do not throw exception here.\n+                // return a completed future, the caller will check the result and do the cancel process.\n+                PExecPlanFragmentResult result = new PExecPlanFragmentResult();\n+                PStatus pStatus = new PStatus();\n+                pStatus.error_msgs.add(e.getMessage());\n+                // use THRIFT_RPC_ERROR so that this BE will be added to the black list later.", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MDExNDQ1OQ=="}, "originalCommit": {"oid": "ce38590182edb0771ec7166069a2467c66a07345"}, "originalPosition": 19}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjc0OTA5ODE5OnYy", "diffSide": "RIGHT", "path": "be/src/runtime/plan_fragment_executor.cpp", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xN1QwMjo0NzoyNlrOGkzvvQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xOFQxMjo1NjowNFrOGluBIw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MTI0OTcyNQ==", "bodyText": "If you have time. I think we would better use std::lock_guard and std:: mutex  instead of boost::lock_guard and boost::mutex.", "url": "https://github.com/apache/incubator-doris/pull/3872#discussion_r441249725", "createdAt": "2020-06-17T02:47:26Z", "author": {"login": "kangkaisen"}, "path": "be/src/runtime/plan_fragment_executor.cpp", "diffHunk": "@@ -323,7 +323,12 @@ Status PlanFragmentExecutor::open_internal() {\n     {\n         SCOPED_TIMER(profile()->total_time_counter());\n         collect_query_statistics();\n-        Status status = _sink->close(runtime_state(), _status);\n+        Status status;\n+        {\n+            boost::lock_guard<boost::mutex> l(_status_lock);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "5a73cc2a94f9ae88019226bd430bc97d7d823ad4"}, "originalPosition": 7}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MjIwNDQ1MQ==", "bodyText": "I will remove them in next PR", "url": "https://github.com/apache/incubator-doris/pull/3872#discussion_r442204451", "createdAt": "2020-06-18T12:56:04Z", "author": {"login": "morningman"}, "path": "be/src/runtime/plan_fragment_executor.cpp", "diffHunk": "@@ -323,7 +323,12 @@ Status PlanFragmentExecutor::open_internal() {\n     {\n         SCOPED_TIMER(profile()->total_time_counter());\n         collect_query_statistics();\n-        Status status = _sink->close(runtime_state(), _status);\n+        Status status;\n+        {\n+            boost::lock_guard<boost::mutex> l(_status_lock);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MTI0OTcyNQ=="}, "originalCommit": {"oid": "5a73cc2a94f9ae88019226bd430bc97d7d823ad4"}, "originalPosition": 7}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1512, "cost": 1, "resetAt": "2021-11-12T09:44:50Z"}}}