{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0MzczNDU1ODkw", "number": 2877, "reviewThreads": {"totalCount": 5, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xMVQxMzoyNzo0MVrODezVJQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xMVQxMzozNDo1M1rODeze4A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjMzNjI0ODY5OnYy", "diffSide": "RIGHT", "path": "fe/src/main/java/org/apache/doris/analysis/GroupByClause.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xMVQxMzoyNzo0MVrOFoI2JA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xMVQxMzoyNzo0MVrOFoI2JA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NzYzMjI5Mg==", "bodyText": "Plz add comment to this function", "url": "https://github.com/apache/incubator-doris/pull/2877#discussion_r377632292", "createdAt": "2020-02-11T13:27:41Z", "author": {"login": "morningman"}, "path": "fe/src/main/java/org/apache/doris/analysis/GroupByClause.java", "diffHunk": "@@ -202,12 +202,7 @@ public void analyze(Analyzer analyzer) throws AnalysisException {\n     }\n \n     public boolean isGroupByExtension() {\n-        if (groupingType == GroupingType.GROUP_BY ||\n-                groupingType == GroupingType.GROUPING_SETS && (groupingSetList == null || groupingSetList.size() < 2)) {\n-            return false;\n-        } else {\n-            return true;\n-        }\n+        return groupingType != GroupingType.GROUP_BY;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "fcd96a25c1740a0acd48af352d94519beb76a86b"}, "originalPosition": 10}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjMzNjI1ODc2OnYy", "diffSide": "RIGHT", "path": "fe/src/main/java/org/apache/doris/analysis/GroupingInfo.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xMVQxMzozMDozNlrOFoI8UQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xMVQxMzozMDozNlrOFoI8UQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NzYzMzg3Mw==", "bodyText": "Would add some examples for all these cases?", "url": "https://github.com/apache/incubator-doris/pull/2877#discussion_r377633873", "createdAt": "2020-02-11T13:30:36Z", "author": {"login": "morningman"}, "path": "fe/src/main/java/org/apache/doris/analysis/GroupingInfo.java", "diffHunk": "@@ -85,12 +86,11 @@ public VirtualSlotRef addGroupingSlots(List<Expr> realSlots, Analyzer analyzer)\n     // generate the bitmap that repeated node will repeat rows according to\n     public void buildRepeat(ArrayList<Expr> groupingExprs, List<ArrayList<Expr>> groupingSetList) {\n         groupingIdList = new ArrayList<>();\n-        BitSet bitSetAll = new BitSet();\n+        bitSetAll = new BitSet();\n         bitSetAll.set(0, groupingExprs.size(), true);\n-        groupingIdList.add(bitSetAll);\n         switch (groupingType) {\n             case CUBE:\n-                for (int i = 0; i < (1 << groupingExprs.size()) - 1; i++) {\n+                for (int i = 0; i < (1 << groupingExprs.size()); i++) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "fcd96a25c1740a0acd48af352d94519beb76a86b"}, "originalPosition": 19}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjMzNjI2Mzc3OnYy", "diffSide": "RIGHT", "path": "fe/src/main/java/org/apache/doris/analysis/SelectStmt.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xMVQxMzozMTo1NVrOFoI_TA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xMVQxMzozMTo1NVrOFoI_TA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NzYzNDYzNg==", "bodyText": "This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters. Learn more about bidirectional Unicode characters\n\n\n  \n\n\n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                                        \"cannot use GROUPING functions without [grouping sets|rollup|cube] a\"\n          \n          \n            \n                                        \"cannot use GROUPING functions without [grouping sets|rollup|cube] \"", "url": "https://github.com/apache/incubator-doris/pull/2877#discussion_r377634636", "createdAt": "2020-02-11T13:31:55Z", "author": {"login": "morningman"}, "path": "fe/src/main/java/org/apache/doris/analysis/SelectStmt.java", "diffHunk": "@@ -351,6 +351,14 @@ public void analyze(Analyzer analyzer) throws AnalysisException, UserException {\n         if (groupByClause != null && groupByClause.isGroupByExtension()) {\n             groupingInfo = new GroupingInfo(analyzer, groupByClause.getGroupingType());\n             groupingInfo.substituteGroupingFn(resultExprs, analyzer);\n+        } else {\n+            for (Expr expr : resultExprs) {\n+                if (checkGroupingFn(expr)) {\n+                    throw new AnalysisException(\n+                            \"cannot use GROUPING functions without [grouping sets|rollup|cube] a\"", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "fcd96a25c1740a0acd48af352d94519beb76a86b"}, "originalPosition": 8}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjMzNjI2ODcxOnYy", "diffSide": "RIGHT", "path": "gensrc/thrift/PlanNodes.thrift", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xMVQxMzozMzoxOVrOFoJCVQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xMVQxMzozMzoxOVrOFoJCVQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NzYzNTQxMw==", "bodyText": "All newly added fields should be optional, or it will cause incompatible.\nAnd name should be all_slot_ids", "url": "https://github.com/apache/incubator-doris/pull/2877#discussion_r377635413", "createdAt": "2020-02-11T13:33:19Z", "author": {"login": "morningman"}, "path": "gensrc/thrift/PlanNodes.thrift", "diffHunk": "@@ -396,6 +396,8 @@ struct TRepeatNode {\n   3: required list<i64> repeat_id_list\n   // A list of integer list, it indicates the position of the grouping virtual slot.\n   4: required list<list<i64>> grouping_list\n+  // A list of all slot\n+  5: required set<Types.TSlotId> all_slot_id", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "fcd96a25c1740a0acd48af352d94519beb76a86b"}, "originalPosition": 5}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjMzNjI3MzYwOnYy", "diffSide": "RIGHT", "path": "be/src/exec/repeat_node.cpp", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xMVQxMzozNDo1M1rOFoJFZA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xMVQxMzozNDo1M1rOFoJFZA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NzYzNjE5Ng==", "bodyText": "rename to _all_slot_ids.\nAnd tnode.repeat_node.all_slot_id should be optional, so here you need to check whether this field is set.\nSince this is a bug, you can just return ERROR if this field is not set.", "url": "https://github.com/apache/incubator-doris/pull/2877#discussion_r377636196", "createdAt": "2020-02-11T13:34:53Z", "author": {"login": "morningman"}, "path": "be/src/exec/repeat_node.cpp", "diffHunk": "@@ -30,6 +30,7 @@ RepeatNode::RepeatNode(ObjectPool* pool, const TPlanNode& tnode,\n                      const DescriptorTbl& descs)\n     : ExecNode(pool, tnode, descs),\n     _slot_id_set_list(tnode.repeat_node.slot_id_set_list),\n+    _all_slot_id(tnode.repeat_node.all_slot_id),", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "fcd96a25c1740a0acd48af352d94519beb76a86b"}, "originalPosition": 4}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2221, "cost": 1, "resetAt": "2021-11-12T09:44:50Z"}}}