{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0Mzg5Njg1MzQ4", "number": 3130, "reviewThreads": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xN1QxNDoyMDoyMVrODovbtA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xN1QxNDoyMDozNFrODovcEA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjQ0MDQ2NzcyOnYy", "diffSide": "RIGHT", "path": "fe/src/main/java/org/apache/doris/alter/AlterHandler.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xN1QxNDoyMDoyMVrOF3eZ7w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xN1QxNDoyMDoyMVrOF3eZ7w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MzcxNDE1OQ==", "bodyText": "This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters. Learn more about bidirectional Unicode characters\n\n\n  \n\n\n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                            LOG.info(\"remove history {} jobV2[{}]. created at {}\", alterJobV2.getType(),\n          \n          \n            \n                            LOG.info(\"remove history {} jobV2[{}]. finish at {}\", alterJobV2.getType(),", "url": "https://github.com/apache/incubator-doris/pull/3130#discussion_r393714159", "createdAt": "2020-03-17T14:20:21Z", "author": {"login": "morningman"}, "path": "fe/src/main/java/org/apache/doris/alter/AlterHandler.java", "diffHunk": "@@ -119,6 +121,30 @@ public AlterJobV2 getUnfinishedAlterJobV2ByJobId(long jobId) {\n         return this.alterJobsV2;\n     }\n \n+    private void clearExpireFinishedOrCancelledAlterJobs() {\n+        long curTime = System.currentTimeMillis();\n+        // clean history job\n+        Iterator<AlterJob> iter = finishedOrCancelledAlterJobs.iterator();\n+        while (iter.hasNext()) {\n+            AlterJob historyJob = iter.next();\n+            if ((curTime - historyJob.getCreateTimeMs()) / 1000 > Config.history_job_keep_max_second) {\n+                iter.remove();\n+                LOG.info(\"remove history {} job[{}]. created at {}\", historyJob.getType(),\n+                        historyJob.getTableId(), TimeUtils.longToTimeString(historyJob.getCreateTimeMs()));\n+            }\n+        }\n+    }\n+\n+    private void clearExpireFinishedOrCancelledAlterJobsV2() {\n+        for (AlterJobV2 alterJobV2 : finishedOrCancelledAlterJobsV2) {\n+            if (alterJobV2.isExpire()) {\n+                finishedOrCancelledAlterJobsV2.remove(alterJobV2);\n+                LOG.info(\"remove history {} jobV2[{}]. created at {}\", alterJobV2.getType(),", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "2db2bc4e8cc27a02d2ae1b39465c4e1705452413"}, "originalPosition": 50}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjQ0MDQ2ODY0OnYy", "diffSide": "RIGHT", "path": "fe/src/main/java/org/apache/doris/alter/AlterHandler.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xN1QxNDoyMDozNFrOF3ealA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xN1QxNDoyMDozNFrOF3ealA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MzcxNDMyNA==", "bodyText": "change to \"finish at\"?", "url": "https://github.com/apache/incubator-doris/pull/3130#discussion_r393714324", "createdAt": "2020-03-17T14:20:34Z", "author": {"login": "morningman"}, "path": "fe/src/main/java/org/apache/doris/alter/AlterHandler.java", "diffHunk": "@@ -119,6 +121,30 @@ public AlterJobV2 getUnfinishedAlterJobV2ByJobId(long jobId) {\n         return this.alterJobsV2;\n     }\n \n+    private void clearExpireFinishedOrCancelledAlterJobs() {\n+        long curTime = System.currentTimeMillis();\n+        // clean history job\n+        Iterator<AlterJob> iter = finishedOrCancelledAlterJobs.iterator();\n+        while (iter.hasNext()) {\n+            AlterJob historyJob = iter.next();\n+            if ((curTime - historyJob.getCreateTimeMs()) / 1000 > Config.history_job_keep_max_second) {\n+                iter.remove();\n+                LOG.info(\"remove history {} job[{}]. created at {}\", historyJob.getType(),", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "2db2bc4e8cc27a02d2ae1b39465c4e1705452413"}, "originalPosition": 40}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1958, "cost": 1, "resetAt": "2021-11-12T09:44:50Z"}}}