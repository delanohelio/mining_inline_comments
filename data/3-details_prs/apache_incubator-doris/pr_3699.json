{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDIzNjcxNjM1", "number": 3699, "title": "[Bug] Duplicate Key table core when predicate on metric column", "bodyText": "CREATE TABLE `query_detail` (\n  `query_id` varchar(100) NULL COMMENT \"\",\n  `start_time` datetime NULL COMMENT \"\",\n  `end_time` datetime NULL COMMENT \"\",\n  `latency` int(11) NULL COMMENT \"unit is milliseconds\",\n  `state` varchar(20) NULL COMMENT \"RUNNING/FINISHED/FAILED\",\n  `sql` varchar(1024) NULL COMMENT \"\"\n)\nDUPLICATE KEY(`query_id`)\n\nSELECT COUNT(*) FROM query_detail WHERE start_time >= '2020-05-27 14:52:16' AND start_time < '2020-05-27 14:52:31';\n\nThe above query will core because of ZoneMap only in query_id.\nUse start_time to match ZoneMap cause this core.", "createdAt": "2020-05-27T07:49:25Z", "url": "https://github.com/apache/incubator-doris/pull/3699", "merged": true, "mergeCommit": {"oid": "8f71c7a3319fd0326b06a697c4727e4ffebbe528"}, "closed": true, "closedAt": "2020-05-28T06:35:41Z", "author": {"login": "chaoyli"}, "timelineItems": {"totalCount": 5, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABclYutKgFqTQxOTE2NDY0OQ==", "endCursor": "Y3Vyc29yOnYyOpPPAAABclmAwfAFqTQxOTc2NjEyMw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDE5MTY0NjQ5", "url": "https://github.com/apache/incubator-doris/pull/3699#pullrequestreview-419164649", "createdAt": "2020-05-27T12:50:01Z", "commit": {"oid": "48f6b0079e9bf9550873323b8f9203d4cfd0421c"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yN1QxMjo1MDowMVrOGbHucg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yN1QxMjo1MDowMVrOGbHucg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMTA5MTMxNA==", "bodyText": "it cores just because of zone_maps.size() == cond_it.first  and zone_maps.at(cond_it.first) returns null ?", "url": "https://github.com/apache/incubator-doris/pull/3699#discussion_r431091314", "createdAt": "2020-05-27T12:50:01Z", "author": {"login": "yangzhg"}, "path": "be/src/olap/olap_cond.cpp", "diffHunk": "@@ -651,14 +651,10 @@ bool Conditions::delete_conditions_eval(const RowCursor& row) const {\n bool Conditions::rowset_pruning_filter(const std::vector<KeyRange>& zone_maps) const {\n     //\u901a\u8fc7\u6240\u6709\u5217\u4e0a\u7684\u5220\u9664\u6761\u4ef6\u5bf9version\u8fdb\u884c\u8fc7\u6ee4\n     for (auto& cond_it : _columns) {\n-        if (_cond_column_is_key_or_duplicate(cond_it.second) && cond_it.first > zone_maps.size()) {\n-            LOG(WARNING) << \"where condition not equal zone maps size. \"\n-                         << \"cond_id=\" << cond_it.first\n-                         << \", zone_map_size=\" << zone_maps.size();\n-            return false;\n-        }\n-        if (_cond_column_is_key_or_duplicate(cond_it.second) && !cond_it.second->eval(zone_maps.at(cond_it.first))) {\n-            return true;\n+        if (_cond_column_is_key_or_duplicate(cond_it.second)) {\n+            if (cond_it.first < zone_maps.size() && !cond_it.second->eval(zone_maps.at(cond_it.first))) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "48f6b0079e9bf9550873323b8f9203d4cfd0421c"}, "originalPosition": 13}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDE5MTcyNjEx", "url": "https://github.com/apache/incubator-doris/pull/3699#pullrequestreview-419172611", "createdAt": "2020-05-27T12:54:51Z", "commit": {"oid": "48f6b0079e9bf9550873323b8f9203d4cfd0421c"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yN1QxMjo1NDo1MVrOGbH6PQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yN1QxMjo1NDo1MVrOGbH6PQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMTA5NDMzMw==", "bodyText": "Could you please transform Cninese to English?", "url": "https://github.com/apache/incubator-doris/pull/3699#discussion_r431094333", "createdAt": "2020-05-27T12:54:51Z", "author": {"login": "EmmyMiao87"}, "path": "be/src/olap/olap_cond.cpp", "diffHunk": "@@ -651,14 +651,10 @@ bool Conditions::delete_conditions_eval(const RowCursor& row) const {\n bool Conditions::rowset_pruning_filter(const std::vector<KeyRange>& zone_maps) const {\n     //\u901a\u8fc7\u6240\u6709\u5217\u4e0a\u7684\u5220\u9664\u6761\u4ef6\u5bf9version\u8fdb\u884c\u8fc7\u6ee4", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "48f6b0079e9bf9550873323b8f9203d4cfd0421c"}, "originalPosition": 2}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDE5MTM0MTgw", "url": "https://github.com/apache/incubator-doris/pull/3699#pullrequestreview-419134180", "createdAt": "2020-05-27T12:19:26Z", "commit": {"oid": "48f6b0079e9bf9550873323b8f9203d4cfd0421c"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yN1QxMjoxOToyNlrOGbGnBw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yN1QxMjoxOToyNlrOGbGnBw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMTA3MzAzMQ==", "bodyText": "Could you please add some comment for this method. about the meaning of its return.\nAnd you can also modify Chinese comment to English.", "url": "https://github.com/apache/incubator-doris/pull/3699#discussion_r431073031", "createdAt": "2020-05-27T12:19:26Z", "author": {"login": "morningman"}, "path": "be/src/olap/olap_cond.cpp", "diffHunk": "@@ -651,14 +651,10 @@ bool Conditions::delete_conditions_eval(const RowCursor& row) const {\n bool Conditions::rowset_pruning_filter(const std::vector<KeyRange>& zone_maps) const {\n     //\u901a\u8fc7\u6240\u6709\u5217\u4e0a\u7684\u5220\u9664\u6761\u4ef6\u5bf9version\u8fdb\u884c\u8fc7\u6ee4\n     for (auto& cond_it : _columns) {\n-        if (_cond_column_is_key_or_duplicate(cond_it.second) && cond_it.first > zone_maps.size()) {\n-            LOG(WARNING) << \"where condition not equal zone maps size. \"\n-                         << \"cond_id=\" << cond_it.first\n-                         << \", zone_map_size=\" << zone_maps.size();\n-            return false;\n-        }\n-        if (_cond_column_is_key_or_duplicate(cond_it.second) && !cond_it.second->eval(zone_maps.at(cond_it.first))) {\n-            return true;\n+        if (_cond_column_is_key_or_duplicate(cond_it.second)) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "48f6b0079e9bf9550873323b8f9203d4cfd0421c"}, "originalPosition": 12}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "db558dbe889c8898155d4e9788abcebbd1b069e4", "author": {"user": {"login": "chaoyli", "name": "lichaoyong"}}, "url": "https://github.com/apache/incubator-doris/commit/db558dbe889c8898155d4e9788abcebbd1b069e4", "committedDate": "2020-05-28T01:30:02Z", "message": "Add some comment in English"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDE5NzY2MTIz", "url": "https://github.com/apache/incubator-doris/pull/3699#pullrequestreview-419766123", "createdAt": "2020-05-28T04:18:30Z", "commit": {"oid": "db558dbe889c8898155d4e9788abcebbd1b069e4"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2781, "cost": 1, "resetAt": "2021-10-28T17:48:14Z"}}}