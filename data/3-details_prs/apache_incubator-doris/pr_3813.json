{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDMxNzA1MTU0", "number": 3813, "title": "[Doris On ES] Skip function_call expr when process predicate", "bodyText": "#3801\nDo not push-down  function_call such as split_xxx when process predicate, Doris BE is responsible for processing these predicate\nAll rows in table:\n+------+------+------+------------+------------+\n| k1   | k2   | k3   | UpdateTime | ArriveTime |\n+------+------+------+------------+------------+\n| NULL | NULL | kkk1 |  123456789 |       NULL |\n| kkk1 | NULL | NULL |  123456789 |       NULL |\n| NULL | kkk2 | NULL |  123456789 |       NULL |\n+------+------+------+------------+------------+\n\nSQL 1:\nmysql> select * from (select split_part(k1, \"1\", 1) as kk from case_replay_for_milimin) t where t.kk is not null;\n+------+\n| kk   |\n+------+\n| kkk  |\n+------+\n1 row in set (0.02 sec)\n\nSQL 2:\nmysql> select * from (select split_part(k1, \"1\", 1) as kk from case_replay_for_milimin) t where t.kk > 'a';      \n+------+\n| kk   |\n+------+\n| kkk  |\n+------+\n\nSQL 3:\nmysql> select * from (select split_part(k1, \"1\", 1) as kk from case_replay_for_milimin) t where t.kk > '2';\n+------+\n| kk   |\n+------+\n| kkk  |\n+------+\n1 row in set (0.03 sec)\n\nSQL 4:\nmysql> select * from (select split_part(k1, \"1\", 1) as kk from case_replay_for_milimin) t where t.kk > 2;\nEmpty set (0.02 sec)\n\n\nSome problems\uff1a\nI do not know whether SQL 4 meets expectations when Doris filters the data.", "createdAt": "2020-06-09T10:49:37Z", "url": "https://github.com/apache/incubator-doris/pull/3813", "merged": true, "mergeCommit": {"oid": "8c608bbad55911505411151522e6a1ceb7512cc0"}, "closed": true, "closedAt": "2020-06-10T03:22:53Z", "author": {"login": "wuyunfeng"}, "timelineItems": {"totalCount": 9, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcpiTl8gH2gAyNDMxNzA1MTU0OmEyYzVjOTIwNGVlZDc5NGY0Y2FhODhiMzgyZjVjYjcwOGU0ZDhkNjc=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcpwJC5AFqTQyNzY2Njg4Ng==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "a2c5c9204eed794f4caa88b382f5cb708e4d8d67", "author": {"user": {"login": "wuyunfeng", "name": "Yunfeng,Wu"}}, "url": "https://github.com/apache/incubator-doris/commit/a2c5c9204eed794f4caa88b382f5cb708e4d8d67", "committedDate": "2020-06-09T10:15:09Z", "message": "[Doris On ES] Skip function_call expr when process predicate"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "99eac388cb0d879f9bab9da97009f672beeb3c06", "author": {"user": {"login": "wuyunfeng", "name": "Yunfeng,Wu"}}, "url": "https://github.com/apache/incubator-doris/commit/99eac388cb0d879f9bab9da97009f672beeb3c06", "committedDate": "2020-06-09T10:49:06Z", "message": "[Doris On ES] Skip function_call expr when process predicate"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDI3MDM1MzA1", "url": "https://github.com/apache/incubator-doris/pull/3813#pullrequestreview-427035305", "createdAt": "2020-06-09T11:14:12Z", "commit": {"oid": "99eac388cb0d879f9bab9da97009f672beeb3c06"}, "state": "DISMISSED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "5ae85fd0523ef36451378a49bc31811d16fb7bf3", "author": {"user": {"login": "wuyunfeng", "name": "Yunfeng,Wu"}}, "url": "https://github.com/apache/incubator-doris/commit/5ae85fd0523ef36451378a49bc31811d16fb7bf3", "committedDate": "2020-06-09T11:18:14Z", "message": "format code and delete extra comment"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDI3MDM4NDc2", "url": "https://github.com/apache/incubator-doris/pull/3813#pullrequestreview-427038476", "createdAt": "2020-06-09T11:19:00Z", "commit": {"oid": "99eac388cb0d879f9bab9da97009f672beeb3c06"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDI3MjMxNDg1", "url": "https://github.com/apache/incubator-doris/pull/3813#pullrequestreview-427231485", "createdAt": "2020-06-09T14:49:05Z", "commit": {"oid": "5ae85fd0523ef36451378a49bc31811d16fb7bf3"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDI3NjY1MTQ1", "url": "https://github.com/apache/incubator-doris/pull/3813#pullrequestreview-427665145", "createdAt": "2020-06-10T02:16:13Z", "commit": {"oid": "5ae85fd0523ef36451378a49bc31811d16fb7bf3"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xMFQwMjoxNjoxNFrOGhig4A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xMFQwMjoxNjoxNFrOGhig4A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNzgyMTY2NA==", "bodyText": "what is slot ref? add some example otherwise  it will be very confusing once this error occurs.\ne.g. slot ref(xx, xxx)", "url": "https://github.com/apache/incubator-doris/pull/3813#discussion_r437821664", "createdAt": "2020-06-10T02:16:14Z", "author": {"login": "blackfox1983"}, "path": "be/src/exec/es/es_predicate.cpp", "diffHunk": "@@ -49,6 +49,14 @@ namespace doris {\n \n using namespace std;\n \n+#define RETURN_ERROR_IF_EXPR_IS_NOT_SLOTREF(expr) \\\n+    do { \\\n+            const Expr* expr_without_cast = Expr::expr_without_cast(expr); \\\n+            if (expr_without_cast->node_type() != TExprNodeType::SLOT_REF) { \\\n+                return Status::InternalError(\"build disjuncts failed: child is not slot ref\"); \\", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "5ae85fd0523ef36451378a49bc31811d16fb7bf3"}, "originalPosition": 8}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDI3NjY1NTEz", "url": "https://github.com/apache/incubator-doris/pull/3813#pullrequestreview-427665513", "createdAt": "2020-06-10T02:17:33Z", "commit": {"oid": "5ae85fd0523ef36451378a49bc31811d16fb7bf3"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xMFQwMjoxNzozNFrOGhiiKg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xMFQwMjoxNzozNFrOGhiiKg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNzgyMTk5NA==", "bodyText": "e.... remove my name from table .... I don't want to be famous this way:(", "url": "https://github.com/apache/incubator-doris/pull/3813#discussion_r437821994", "createdAt": "2020-06-10T02:17:34Z", "author": {"login": "blackfox1983"}, "path": "be/src/exec/es/es_predicate.cpp", "diffHunk": "@@ -235,13 +243,16 @@ Status EsPredicate::build_disjuncts_list(const Expr* conjunct) {\n         if (TExprNodeType::SLOT_REF == conjunct->get_child(0)->node_type()\n             || TExprNodeType::CAST_EXPR == conjunct->get_child(0)->node_type()) {\n             expr = conjunct->get_child(1);\n+            // process such as sub-query: select * from (select split_part(k, \"_\", 1) as new_field from case_replay_for_milimin) t where t.new_field > 1;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "5ae85fd0523ef36451378a49bc31811d16fb7bf3"}, "originalPosition": 19}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDI3NjY2ODg2", "url": "https://github.com/apache/incubator-doris/pull/3813#pullrequestreview-427666886", "createdAt": "2020-06-10T02:22:18Z", "commit": {"oid": "5ae85fd0523ef36451378a49bc31811d16fb7bf3"}, "state": "COMMENTED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2512, "cost": 1, "resetAt": "2021-10-28T17:48:14Z"}}}