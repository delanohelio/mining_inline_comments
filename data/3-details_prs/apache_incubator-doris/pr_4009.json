{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDQzNTQ0MDA4", "number": 4009, "title": "[Bug]Fix some schema change not work right", "bodyText": "This CL including:\n\nFix numeric type to varchar type not work right bug\nremove convert from largeint type to double type in doc.\nchange logic check in FE to support convert decimal type to varchar type which has already been implement in BE.", "createdAt": "2020-07-02T14:12:17Z", "url": "https://github.com/apache/incubator-doris/pull/4009", "merged": true, "mergeCommit": {"oid": "d7893f0fa7c9f68a50f438080891dacff0ad1408"}, "closed": true, "closedAt": "2020-07-11T02:18:30Z", "author": {"login": "WingsGo"}, "timelineItems": {"totalCount": 12, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcw_QioAH2gAyNDQzNTQ0MDA4OjVhMjU3ZDE5YTcxOTlmMDcwNDY5YzQ5MTRjNWZmZWViZDlmMTIyMmI=", "endCursor": "Y3Vyc29yOnYyOpPPAAABczuqVzAFqTQ0Njc3MDA4Ng==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "5a257d19a7199f070469c4914c5ffeebd9f1222b", "author": {"user": {"login": "WingsGo", "name": "WangCong"}}, "url": "https://github.com/apache/incubator-doris/commit/5a257d19a7199f070469c4914c5ffeebd9f1222b", "committedDate": "2020-07-02T13:56:32Z", "message": "[Bug]Fix some schema change not work right\n\nThis CL mainly fix some schema change to varchar type not work right\nbecause forget to logic check && Add ConvertTypeResolver to add\nsupported convert type in order to avoid forget logic check"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "3c921673302388e3d109c076a5be16e2f9d7c8cd", "author": {"user": {"login": "WingsGo", "name": "WangCong"}}, "url": "https://github.com/apache/incubator-doris/commit/3c921673302388e3d109c076a5be16e2f9d7c8cd", "committedDate": "2020-07-02T14:17:14Z", "message": "fix"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "7576dbc03027d64308194cf65089ae8ece835528", "author": {"user": {"login": "WingsGo", "name": "WangCong"}}, "url": "https://github.com/apache/incubator-doris/commit/7576dbc03027d64308194cf65089ae8ece835528", "committedDate": "2020-07-02T15:51:56Z", "message": "fix"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "470247d957a302dbe18238e43f52f445935bb584", "author": {"user": {"login": "WingsGo", "name": "WangCong"}}, "url": "https://github.com/apache/incubator-doris/commit/470247d957a302dbe18238e43f52f445935bb584", "committedDate": "2020-07-02T16:04:12Z", "message": "fix"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "7d73a5895539b41b960745568d4595c1700012b8", "author": {"user": {"login": "WingsGo", "name": "WangCong"}}, "url": "https://github.com/apache/incubator-doris/commit/7d73a5895539b41b960745568d4595c1700012b8", "committedDate": "2020-07-03T02:07:38Z", "message": "fix"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "883bf90f88a5698091ea5d29f94bddbe6abd1050", "author": {"user": {"login": "WingsGo", "name": "WangCong"}}, "url": "https://github.com/apache/incubator-doris/commit/883bf90f88a5698091ea5d29f94bddbe6abd1050", "committedDate": "2020-07-03T03:28:46Z", "message": "fix"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDQyNTc5NjA1", "url": "https://github.com/apache/incubator-doris/pull/4009#pullrequestreview-442579605", "createdAt": "2020-07-04T01:18:36Z", "commit": {"oid": "883bf90f88a5698091ea5d29f94bddbe6abd1050"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wNFQwMToxODozN1rOGs5IoA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wNFQwMToxODozN1rOGs5IoA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0OTcyNjYyNA==", "bodyText": "is VARCHAR to DOUBLE and DATETIME support?", "url": "https://github.com/apache/incubator-doris/pull/4009#discussion_r449726624", "createdAt": "2020-07-04T01:18:37Z", "author": {"login": "morningman"}, "path": "be/src/olap/schema_change.cpp", "diffHunk": "@@ -194,6 +194,64 @@ ColumnMapping* RowBlockChanger::get_mutable_column_mapping(size_t column_index)\n         break; \\\n     }\n \n+struct ConvertTypeMapHash {\n+    size_t operator()(const std::pair<FieldType, FieldType>& pair) const {\n+        return (pair.first + 31) ^ pair.second;\n+    }\n+};\n+\n+class ConvertTypeResolver {\n+DECLARE_SINGLETON(ConvertTypeResolver);\n+public:\n+    bool get_convert_type_info(const FieldType from_type, const FieldType to_type) const {\n+        return _convert_type_set.find(std::make_pair(from_type, to_type)) != _convert_type_set.end();\n+    }\n+\n+    template<FieldType from_type, FieldType to_type>\n+    void add_convert_type_mapping() {\n+        _convert_type_set.emplace(std::make_pair(from_type, to_type));\n+    }\n+\n+private:\n+    typedef std::pair<FieldType, FieldType> convert_type_pair;\n+    std::unordered_set<convert_type_pair, ConvertTypeMapHash> _convert_type_set;\n+\n+    DISALLOW_COPY_AND_ASSIGN(ConvertTypeResolver);\n+};\n+\n+ConvertTypeResolver::ConvertTypeResolver() {\n+    // supported type convert should annotate in doc:\n+    // http://doris.incubator.apache.org/master/zh-CN/sql-reference/sql-statements/Data%20Definition/ALTER%20TABLE.html#description\n+    // from varchar type\n+    add_convert_type_mapping<OLAP_FIELD_TYPE_VARCHAR, OLAP_FIELD_TYPE_TINYINT>();\n+    add_convert_type_mapping<OLAP_FIELD_TYPE_VARCHAR, OLAP_FIELD_TYPE_SMALLINT>();\n+    add_convert_type_mapping<OLAP_FIELD_TYPE_VARCHAR, OLAP_FIELD_TYPE_INT>();\n+    add_convert_type_mapping<OLAP_FIELD_TYPE_VARCHAR, OLAP_FIELD_TYPE_BIGINT>();\n+    add_convert_type_mapping<OLAP_FIELD_TYPE_VARCHAR, OLAP_FIELD_TYPE_LARGEINT>();\n+    add_convert_type_mapping<OLAP_FIELD_TYPE_VARCHAR, OLAP_FIELD_TYPE_FLOAT>();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "883bf90f88a5698091ea5d29f94bddbe6abd1050"}, "originalPosition": 38}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "bc00a54fd86906d864d609b00d7c5a09737de928", "author": {"user": {"login": "WingsGo", "name": "WangCong"}}, "url": "https://github.com/apache/incubator-doris/commit/bc00a54fd86906d864d609b00d7c5a09737de928", "committedDate": "2020-07-04T01:41:00Z", "message": "fix"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDQyNjU3MDQ0", "url": "https://github.com/apache/incubator-doris/pull/4009#pullrequestreview-442657044", "createdAt": "2020-07-05T08:20:55Z", "commit": {"oid": "bc00a54fd86906d864d609b00d7c5a09737de928"}, "state": "DISMISSED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e509906b9aa1d9f1d277e9da0a86016f50bed02b", "author": {"user": {"login": "WingsGo", "name": "WangCong"}}, "url": "https://github.com/apache/incubator-doris/commit/e509906b9aa1d9f1d277e9da0a86016f50bed02b", "committedDate": "2020-07-06T12:37:29Z", "message": "format relate code"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a32e237447b85b573ff343bff265595304507fcb", "author": {"user": {"login": "WingsGo", "name": "WangCong"}}, "url": "https://github.com/apache/incubator-doris/commit/a32e237447b85b573ff343bff265595304507fcb", "committedDate": "2020-07-08T09:57:58Z", "message": "Merge branch 'master' into fix_schema_change"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDQ2NzcwMDg2", "url": "https://github.com/apache/incubator-doris/pull/4009#pullrequestreview-446770086", "createdAt": "2020-07-11T02:18:06Z", "commit": {"oid": "a32e237447b85b573ff343bff265595304507fcb"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2280, "cost": 1, "resetAt": "2021-10-28T17:48:14Z"}}}