{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDY1NDc3MTM2", "number": 4317, "reviewThreads": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xMFQxNDoxMzowMFrOEWz4LA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xMFQxNDoxMzowMFrOEWz4LA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjkyMzU0MDkyOnYy", "diffSide": "RIGHT", "path": "fe/fe-core/src/main/java/org/apache/doris/alter/MaterializedViewHandler.java", "isResolved": false, "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xMFQxNDoxMzowMFrOG-QUzQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0yNVQwMzowNTowNlrOH5haSQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NzkzMjM2NQ==", "bodyText": "Do we allowed to create mv on unique key table?\nif yes, how to create it?", "url": "https://github.com/apache/incubator-doris/pull/4317#discussion_r467932365", "createdAt": "2020-08-10T14:13:00Z", "author": {"login": "morningman"}, "path": "fe/fe-core/src/main/java/org/apache/doris/alter/MaterializedViewHandler.java", "diffHunk": "@@ -432,6 +432,9 @@ private RollupJobV2 createMaterializedViewJob(String mvName, String baseIndexNam\n         List<Column> newMVColumns = Lists.newArrayList();\n         int numOfKeys = 0;\n         if (olapTable.getKeysType().isAggregationFamily()) {\n+            if (addMVClause.getMVKeysType() != KeysType.AGG_KEYS) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "5e33cda4ee69076d60993ced55aa0b4d21654632"}, "originalPosition": 4}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2ODM2NDE0Mg==", "bodyText": "We allowed to create mv on unique key if and only if materialized view of full key column.", "url": "https://github.com/apache/incubator-doris/pull/4317#discussion_r468364142", "createdAt": "2020-08-11T06:53:45Z", "author": {"login": "EmmyMiao87"}, "path": "fe/fe-core/src/main/java/org/apache/doris/alter/MaterializedViewHandler.java", "diffHunk": "@@ -432,6 +432,9 @@ private RollupJobV2 createMaterializedViewJob(String mvName, String baseIndexNam\n         List<Column> newMVColumns = Lists.newArrayList();\n         int numOfKeys = 0;\n         if (olapTable.getKeysType().isAggregationFamily()) {\n+            if (addMVClause.getMVKeysType() != KeysType.AGG_KEYS) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NzkzMjM2NQ=="}, "originalCommit": {"oid": "5e33cda4ee69076d60993ced55aa0b4d21654632"}, "originalPosition": 4}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMDA3ODI4MQ==", "bodyText": "the unique key table has unique feature , we need mv to aggregate  such as  bitmap_union(to_bitmap(user_id)),but  it's wrong \u3002\nexample:\nCREATE TABLE t\n(\nevent_day DATE,\nuser_id INT ,\nevent_name VARCHAR(100),\naccess_timestamp BIGINT\n)\nUNIQUE KEY(event_day,user_id, event_name,access_timestamp)\nPARTITION BY RANGE(event_day) ()\nDISTRIBUTED BY HASH(user_id)\nPROPERTIES\n(\n\"dynamic_partition.enable\" = \"true\",\n\"dynamic_partition.time_unit\" = \"DAY\",\n\"dynamic_partition.end\" = \"3\",\n\"dynamic_partition.prefix\" = \"p\",\n\"dynamic_partition.buckets\" = \"8\",\n\"storage_type\"=\"column\"\n);\ncreate materialized view mv as\nselect  event_day,bitmap_union(to_bitmap(user_id))  from t group by event_day ;", "url": "https://github.com/apache/incubator-doris/pull/4317#discussion_r530078281", "createdAt": "2020-11-25T03:05:06Z", "author": {"login": "liuzhizu"}, "path": "fe/fe-core/src/main/java/org/apache/doris/alter/MaterializedViewHandler.java", "diffHunk": "@@ -432,6 +432,9 @@ private RollupJobV2 createMaterializedViewJob(String mvName, String baseIndexNam\n         List<Column> newMVColumns = Lists.newArrayList();\n         int numOfKeys = 0;\n         if (olapTable.getKeysType().isAggregationFamily()) {\n+            if (addMVClause.getMVKeysType() != KeysType.AGG_KEYS) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NzkzMjM2NQ=="}, "originalCommit": {"oid": "5e33cda4ee69076d60993ced55aa0b4d21654632"}, "originalPosition": 4}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1117, "cost": 1, "resetAt": "2021-11-12T09:44:50Z"}}}