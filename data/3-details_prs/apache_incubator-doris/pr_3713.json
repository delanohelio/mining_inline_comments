{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDI0MzE5NTY0", "number": 3713, "title": "Use BackendStatus to show BE's infomation in `show backends;`", "bodyText": "The infomation is displayed in JSON format.For example:\n{\"lastTabletReportTime\":\"2020-05-28 15:29:01\"}", "createdAt": "2020-05-28T08:06:06Z", "url": "https://github.com/apache/incubator-doris/pull/3713", "merged": true, "mergeCommit": {"oid": "a7bf006b51a28a702aeb2d331e3c7aa8014b0cbc"}, "closed": true, "closedAt": "2020-06-06T03:37:49Z", "author": {"login": "WingsGo"}, "timelineItems": {"totalCount": 9, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcloxPaAH2gAyNDI0MzE5NTY0OjYwY2YxMDJkNmFkODQyMjQ4N2EwZGQyYTEyMjA0M2VjZmVkODBiNGI=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcoUD21AFqTQyNTM4MzgzOQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "60cf102d6ad8422487a0dd2a122043ecfed80b4b", "author": {"user": null}, "url": "https://github.com/apache/incubator-doris/commit/60cf102d6ad8422487a0dd2a122043ecfed80b4b", "committedDate": "2020-05-28T07:31:16Z", "message": "Use BackendStatus to show BE's infomation in `show backends;`\n    The infomation is displayed in JSON format."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDE5ODkzOTU0", "url": "https://github.com/apache/incubator-doris/pull/3713#pullrequestreview-419893954", "createdAt": "2020-05-28T08:36:35Z", "commit": {"oid": "60cf102d6ad8422487a0dd2a122043ecfed80b4b"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yOFQwODozNjozNVrOGbrM8A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yOFQwODozNzo0MVrOGbrP0w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMTY3MjU2MA==", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                private BackendStatus backendStatus;\n          \n          \n            \n                private BackendStatus backendStatus = new BackendStatus();\n          \n      \n    \n    \n  \n\nAnd remove all constructors below.", "url": "https://github.com/apache/incubator-doris/pull/3713#discussion_r431672560", "createdAt": "2020-05-28T08:36:35Z", "author": {"login": "morningman"}, "path": "fe/src/main/java/org/apache/doris/system/Backend.java", "diffHunk": "@@ -94,6 +94,9 @@\n     // this field is set by tablet report, and just for metric monitor, no need to persist.\n     private AtomicLong tabletMaxCompactionScore = new AtomicLong(0);\n \n+    // additional backendStatus information for BE, display in JSON format\n+    private BackendStatus backendStatus;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "60cf102d6ad8422487a0dd2a122043ecfed80b4b"}, "originalPosition": 5}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMTY3MzI5OQ==", "bodyText": "Better to create a method called backend.updateStatus()  to set these infos.\nMaybe we will add more info later.", "url": "https://github.com/apache/incubator-doris/pull/3713#discussion_r431673299", "createdAt": "2020-05-28T08:37:41Z", "author": {"login": "morningman"}, "path": "fe/src/main/java/org/apache/doris/master/ReportHandler.java", "diffHunk": "@@ -247,6 +249,13 @@ private static void tabletReport(long backendId, Map<Long, TTablet> backendTable\n         LOG.info(\"backend[{}] reports {} tablet(s). report version: {}\",\n                  backendId, backendTablets.size(), backendReportVersion);\n \n+        final SystemInfoService currentSystemInfo = Catalog.getCurrentSystemInfo();\n+        Backend reportBackend = currentSystemInfo.getBackend(backendId);\n+        if (reportBackend != null) {\n+            BackendStatus backendStatus = reportBackend.getBackendStatus();\n+            backendStatus.lastTabletReportTime = TimeUtils.longToTimeString(start);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "60cf102d6ad8422487a0dd2a122043ecfed80b4b"}, "originalPosition": 23}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "32767a7900af2bb18432c5a3d5b9637bf859e51a", "author": {"user": null}, "url": "https://github.com/apache/incubator-doris/commit/32767a7900af2bb18432c5a3d5b9637bf859e51a", "committedDate": "2020-05-28T09:36:26Z", "message": "fix by review"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ec338d61290c1f91696b119919b91c0b6cd6ef3c", "author": {"user": null}, "url": "https://github.com/apache/incubator-doris/commit/ec338d61290c1f91696b119919b91c0b6cd6ef3c", "committedDate": "2020-05-28T12:24:37Z", "message": "add doc"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDIyNjUyNzYw", "url": "https://github.com/apache/incubator-doris/pull/3713#pullrequestreview-422652760", "createdAt": "2020-06-02T13:03:24Z", "commit": {"oid": "ec338d61290c1f91696b119919b91c0b6cd6ef3c"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wMlQxMzowMzoyNFrOGdwj7w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wMlQxMzowMzoyNFrOGdwj7w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMzg1NzUxOQ==", "bodyText": "It ok, not a big deal.\nOh, I suggest to set this value right after the report in done, in case some other error happens during the report process.", "url": "https://github.com/apache/incubator-doris/pull/3713#discussion_r433857519", "createdAt": "2020-06-02T13:03:24Z", "author": {"login": "morningman"}, "path": "fe/src/main/java/org/apache/doris/master/ReportHandler.java", "diffHunk": "@@ -247,6 +249,13 @@ private static void tabletReport(long backendId, Map<Long, TTablet> backendTable\n         LOG.info(\"backend[{}] reports {} tablet(s). report version: {}\",\n                  backendId, backendTablets.size(), backendReportVersion);\n \n+        final SystemInfoService currentSystemInfo = Catalog.getCurrentSystemInfo();\n+        Backend reportBackend = currentSystemInfo.getBackend(backendId);\n+        if (reportBackend != null) {\n+            BackendStatus backendStatus = reportBackend.getBackendStatus();\n+            backendStatus.lastTabletReportTime = TimeUtils.longToTimeString(start);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMTY3MzI5OQ=="}, "originalCommit": {"oid": "60cf102d6ad8422487a0dd2a122043ecfed80b4b"}, "originalPosition": 23}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "3f931fdc054f6f0d73155ad71a79bac3e3d089ce", "author": {"user": null}, "url": "https://github.com/apache/incubator-doris/commit/3f931fdc054f6f0d73155ad71a79bac3e3d089ce", "committedDate": "2020-06-03T03:52:46Z", "message": "fix by review"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e442ffad3cd14c880c94aeba8c9012d71cc0bb63", "author": {"user": null}, "url": "https://github.com/apache/incubator-doris/commit/e442ffad3cd14c880c94aeba8c9012d71cc0bb63", "committedDate": "2020-06-03T03:53:30Z", "message": "Merge branch 'add_be_status' of github.com:WingsGo/incubator-doris into add_be_status"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDI1MzcxNzIx", "url": "https://github.com/apache/incubator-doris/pull/3713#pullrequestreview-425371721", "createdAt": "2020-06-05T14:51:03Z", "commit": {"oid": "e442ffad3cd14c880c94aeba8c9012d71cc0bb63"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDI1MzgzODM5", "url": "https://github.com/apache/incubator-doris/pull/3713#pullrequestreview-425383839", "createdAt": "2020-06-05T15:05:22Z", "commit": {"oid": "e442ffad3cd14c880c94aeba8c9012d71cc0bb63"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2808, "cost": 1, "resetAt": "2021-10-28T17:48:14Z"}}}