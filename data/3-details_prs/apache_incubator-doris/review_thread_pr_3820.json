{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDMyMzQ2Mzk4", "number": 3820, "reviewThreads": {"totalCount": 6, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xMFQxNDozMTo1NlrOEEUpCQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xMlQwNDo0NTozM1rOEE7icQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjcyOTY3OTQ1OnYy", "diffSide": "RIGHT", "path": "be/src/runtime/data_stream_recvr.cc", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xMFQxNDozMTo1NlrOGh3ufg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xMFQxNTozMDoyN1rOGh6hfQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzODE2OTIxNA==", "bodyText": "This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters. Learn more about bidirectional Unicode characters\n\n\n  \n\n\n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                profile->add_child(_profile.get(), true, nullptr);\n          \n          \n            \n                _profile->add_child(_profile.get(), true, nullptr);", "url": "https://github.com/apache/incubator-doris/pull/3820#discussion_r438169214", "createdAt": "2020-06-10T14:31:56Z", "author": {"login": "wutiangan"}, "path": "be/src/runtime/data_stream_recvr.cc", "diffHunk": "@@ -360,9 +360,14 @@ DataStreamRecvr::DataStreamRecvr(\n             _row_desc(row_desc),\n             _is_merging(is_merging),\n             _num_buffered_bytes(0),\n-            _profile(profile),\n             _sub_plan_query_statistics_recvr(sub_plan_query_statistics_recvr) {\n-    _mem_tracker.reset(new MemTracker(-1, \"DataStreamRecvr\", parent_tracker));\n+    _profile.reset(new RuntimeProfile(nullptr, \"DataStreamRecvr\"));\n+    profile->add_child(_profile.get(), true, nullptr);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "61538fae25de0b1d1ad63173b75bde775cddd196"}, "originalPosition": 17}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzODIxNTAzNw==", "bodyText": "@wutiangan Hello,  The profile is the param of the method DataStreamRecvr constructed function. _profile is the unique_ptr of the RunningProile be long to the object DataStreamRecvr.\nSo they are indeed different, the suggest change may cause problem.", "url": "https://github.com/apache/incubator-doris/pull/3820#discussion_r438215037", "createdAt": "2020-06-10T15:30:27Z", "author": {"login": "HappenLee"}, "path": "be/src/runtime/data_stream_recvr.cc", "diffHunk": "@@ -360,9 +360,14 @@ DataStreamRecvr::DataStreamRecvr(\n             _row_desc(row_desc),\n             _is_merging(is_merging),\n             _num_buffered_bytes(0),\n-            _profile(profile),\n             _sub_plan_query_statistics_recvr(sub_plan_query_statistics_recvr) {\n-    _mem_tracker.reset(new MemTracker(-1, \"DataStreamRecvr\", parent_tracker));\n+    _profile.reset(new RuntimeProfile(nullptr, \"DataStreamRecvr\"));\n+    profile->add_child(_profile.get(), true, nullptr);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzODE2OTIxNA=="}, "originalCommit": {"oid": "61538fae25de0b1d1ad63173b75bde775cddd196"}, "originalPosition": 17}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjczMDEwMTI2OnYy", "diffSide": "RIGHT", "path": "be/src/runtime/buffered_block_mgr2.cc", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xMFQxNjowNDowNFrOGh79kA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xMVQwMjo1OTozN1rOGiM3jA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzODIzODYwOA==", "bodyText": "use enable_spill is better which is compatible to fe", "url": "https://github.com/apache/incubator-doris/pull/3820#discussion_r438238608", "createdAt": "2020-06-10T16:04:04Z", "author": {"login": "chaoyli"}, "path": "be/src/runtime/buffered_block_mgr2.cc", "diffHunk": "@@ -210,8 +210,7 @@ BufferedBlockMgr2::BufferedBlockMgr2(RuntimeState* state, TmpFileMgr* tmp_file_m\n     _max_block_size(block_size),\n     // Keep two writes in flight per scratch disk so the disks can stay busy.\n     _block_write_threshold(tmp_file_mgr->num_active_tmp_devices() * 2),\n-    // _disable_spill(state->query_ctx().disable_spilling),\n-    _disable_spill(false),\n+    _disable_spill(state->disable_spill()),", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "61538fae25de0b1d1ad63173b75bde775cddd196"}, "originalPosition": 6}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzODUxNTU5Ng==", "bodyText": "ok\uff0ci will change the bool var", "url": "https://github.com/apache/incubator-doris/pull/3820#discussion_r438515596", "createdAt": "2020-06-11T02:59:37Z", "author": {"login": "HappenLee"}, "path": "be/src/runtime/buffered_block_mgr2.cc", "diffHunk": "@@ -210,8 +210,7 @@ BufferedBlockMgr2::BufferedBlockMgr2(RuntimeState* state, TmpFileMgr* tmp_file_m\n     _max_block_size(block_size),\n     // Keep two writes in flight per scratch disk so the disks can stay busy.\n     _block_write_threshold(tmp_file_mgr->num_active_tmp_devices() * 2),\n-    // _disable_spill(state->query_ctx().disable_spilling),\n-    _disable_spill(false),\n+    _disable_spill(state->disable_spill()),", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzODIzODYwOA=="}, "originalCommit": {"oid": "61538fae25de0b1d1ad63173b75bde775cddd196"}, "originalPosition": 6}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjczNjA0NjE1OnYy", "diffSide": "RIGHT", "path": "gensrc/thrift/PaloInternalService.thrift", "isResolved": true, "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xMlQwNDo0MToxM1rOGi21Fw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xMlQxMTowMzo1N1rOGjAC0Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzOTIwMzA5NQ==", "bodyText": "Please add this variable to doc.", "url": "https://github.com/apache/incubator-doris/pull/3820#discussion_r439203095", "createdAt": "2020-06-12T04:41:13Z", "author": {"login": "kangkaisen"}, "path": "gensrc/thrift/PaloInternalService.thrift", "diffHunk": "@@ -136,6 +136,8 @@ struct TQueryOptions {\n   // see BE config `max_pushdown_conditions_per_column` for details\n   // if set, this will overwrite the BE config.\n   30: optional i32 max_pushdown_conditions_per_column\n+  // whether enable spilling to disk\n+  31: optional bool enable_spilling = false;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "998b576d5b802a6b740689b3ab08b66725661c79"}, "originalPosition": 5}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzOTMxNzM4Mg==", "bodyText": "The variable already in the doc\u3002\n\nI will change some detail of the doc.", "url": "https://github.com/apache/incubator-doris/pull/3820#discussion_r439317382", "createdAt": "2020-06-12T09:41:49Z", "author": {"login": "HappenLee"}, "path": "gensrc/thrift/PaloInternalService.thrift", "diffHunk": "@@ -136,6 +136,8 @@ struct TQueryOptions {\n   // see BE config `max_pushdown_conditions_per_column` for details\n   // if set, this will overwrite the BE config.\n   30: optional i32 max_pushdown_conditions_per_column\n+  // whether enable spilling to disk\n+  31: optional bool enable_spilling = false;", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzOTIwMzA5NQ=="}, "originalCommit": {"oid": "998b576d5b802a6b740689b3ab08b66725661c79"}, "originalPosition": 5}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzOTM1NDA2NQ==", "bodyText": "OK", "url": "https://github.com/apache/incubator-doris/pull/3820#discussion_r439354065", "createdAt": "2020-06-12T11:03:57Z", "author": {"login": "kangkaisen"}, "path": "gensrc/thrift/PaloInternalService.thrift", "diffHunk": "@@ -136,6 +136,8 @@ struct TQueryOptions {\n   // see BE config `max_pushdown_conditions_per_column` for details\n   // if set, this will overwrite the BE config.\n   30: optional i32 max_pushdown_conditions_per_column\n+  // whether enable spilling to disk\n+  31: optional bool enable_spilling = false;", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzOTIwMzA5NQ=="}, "originalCommit": {"oid": "998b576d5b802a6b740689b3ab08b66725661c79"}, "originalPosition": 5}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjczNjA0OTkwOnYy", "diffSide": "RIGHT", "path": "be/src/runtime/data_stream_recvr.cc", "isResolved": true, "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xMlQwNDo0Mzo1NlrOGi23fg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xMlQxMTowNToxNlrOGjAE7w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzOTIwMzcxMA==", "bodyText": "What's concrete problem will happen?", "url": "https://github.com/apache/incubator-doris/pull/3820#discussion_r439203710", "createdAt": "2020-06-12T04:43:56Z", "author": {"login": "kangkaisen"}, "path": "be/src/runtime/data_stream_recvr.cc", "diffHunk": "@@ -360,9 +360,14 @@ DataStreamRecvr::DataStreamRecvr(\n             _row_desc(row_desc),\n             _is_merging(is_merging),\n             _num_buffered_bytes(0),\n-            _profile(profile),\n             _sub_plan_query_statistics_recvr(sub_plan_query_statistics_recvr) {\n-    _mem_tracker.reset(new MemTracker(-1, \"DataStreamRecvr\", parent_tracker));\n+    _profile.reset(new RuntimeProfile(nullptr, \"DataStreamRecvr\"));\n+    profile->add_child(_profile.get(), true, nullptr);\n+\n+    // TODO: Now the parent tracker may cause problem when we need spill to disk, so we", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "998b576d5b802a6b740689b3ab08b66725661c79"}, "originalPosition": 19}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzOTMzOTY2Mg==", "bodyText": "To be honest, the problem is a little tricky. When the data to be spilled to disk which be read from the underlying EXCHANE NODE. The process is asynchronous. There are two different threads involved\n\n\nDataStreamRecv will continuously obtain the batch through RPC call and write it to the local queue. In this process, the memory consumption of the batch will be recorded in MemTracker.\n\n\nWhen we need to spill to disk, BlockMgr will try to use all the memory to speed up the query. It's going to keep calling try_ consume to get memory from MemTracker.\n\n\nOnce try_ consume failed. The SortNode will try to drop the disk. At this time, the memory usage has approached the threshold. (at this time, the memory usage does not exceed the MemTracker limit)\n\n\nIf thread switching occurs at this time, switch from the SortNode to DataStreamRecv. Because the SortNode is performing like sort and other CPU time consuming operations, it does not retrieve the data from the Exchange Node in time. DataStreamRecv writes data to the queue and records memory consumption. (memory usage exceeds MemTracker limit at this time)\n\n\nWhen the thread switches back to SortNode. The check found that MemTracker exceeded the memory limit, and the query failed.\n\n\nAlthough the queue in DataStreamRecv has memory limitation, it only records the size before Protobuffer deserialization. MemTracker records the size after deserialization. Because Protobuffer compresses the data, there is a gap of three times in my test scenario.\nAt present, My idea is to use this part of memory independently and use a running profile to record the memory usage by DataStreamRecv, so as to avoid this problem temporarily. How can we better solve the problem later? I want to have a further discussion in the community", "url": "https://github.com/apache/incubator-doris/pull/3820#discussion_r439339662", "createdAt": "2020-06-12T10:32:06Z", "author": {"login": "HappenLee"}, "path": "be/src/runtime/data_stream_recvr.cc", "diffHunk": "@@ -360,9 +360,14 @@ DataStreamRecvr::DataStreamRecvr(\n             _row_desc(row_desc),\n             _is_merging(is_merging),\n             _num_buffered_bytes(0),\n-            _profile(profile),\n             _sub_plan_query_statistics_recvr(sub_plan_query_statistics_recvr) {\n-    _mem_tracker.reset(new MemTracker(-1, \"DataStreamRecvr\", parent_tracker));\n+    _profile.reset(new RuntimeProfile(nullptr, \"DataStreamRecvr\"));\n+    profile->add_child(_profile.get(), true, nullptr);\n+\n+    // TODO: Now the parent tracker may cause problem when we need spill to disk, so we", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzOTIwMzcxMA=="}, "originalCommit": {"oid": "998b576d5b802a6b740689b3ab08b66725661c79"}, "originalPosition": 19}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzOTM1NDYwNw==", "bodyText": "The very detailed explanation, Thank you!", "url": "https://github.com/apache/incubator-doris/pull/3820#discussion_r439354607", "createdAt": "2020-06-12T11:05:16Z", "author": {"login": "kangkaisen"}, "path": "be/src/runtime/data_stream_recvr.cc", "diffHunk": "@@ -360,9 +360,14 @@ DataStreamRecvr::DataStreamRecvr(\n             _row_desc(row_desc),\n             _is_merging(is_merging),\n             _num_buffered_bytes(0),\n-            _profile(profile),\n             _sub_plan_query_statistics_recvr(sub_plan_query_statistics_recvr) {\n-    _mem_tracker.reset(new MemTracker(-1, \"DataStreamRecvr\", parent_tracker));\n+    _profile.reset(new RuntimeProfile(nullptr, \"DataStreamRecvr\"));\n+    profile->add_child(_profile.get(), true, nullptr);\n+\n+    // TODO: Now the parent tracker may cause problem when we need spill to disk, so we", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzOTIwMzcxMA=="}, "originalCommit": {"oid": "998b576d5b802a6b740689b3ab08b66725661c79"}, "originalPosition": 19}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjczNjA1MTM3OnYy", "diffSide": "RIGHT", "path": "be/src/exec/exchange_node.cpp", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xMlQwNDo0NTowM1rOGi24dw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xMlQwOTo0OTowNlrOGi-BCg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzOTIwMzk1OQ==", "bodyText": "directly remove it, not comment.", "url": "https://github.com/apache/incubator-doris/pull/3820#discussion_r439203959", "createdAt": "2020-06-12T04:45:03Z", "author": {"login": "kangkaisen"}, "path": "be/src/exec/exchange_node.cpp", "diffHunk": "@@ -110,7 +110,7 @@ Status ExchangeNode::close(RuntimeState* state) {\n     if (_stream_recvr != NULL) {\n         _stream_recvr->close();\n     }\n-    _stream_recvr.reset();\n+    // _stream_recvr.reset();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "998b576d5b802a6b740689b3ab08b66725661c79"}, "originalPosition": 5}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzOTMyMDg0Mg==", "bodyText": "ok, I will remove it", "url": "https://github.com/apache/incubator-doris/pull/3820#discussion_r439320842", "createdAt": "2020-06-12T09:49:06Z", "author": {"login": "HappenLee"}, "path": "be/src/exec/exchange_node.cpp", "diffHunk": "@@ -110,7 +110,7 @@ Status ExchangeNode::close(RuntimeState* state) {\n     if (_stream_recvr != NULL) {\n         _stream_recvr->close();\n     }\n-    _stream_recvr.reset();\n+    // _stream_recvr.reset();", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzOTIwMzk1OQ=="}, "originalCommit": {"oid": "998b576d5b802a6b740689b3ab08b66725661c79"}, "originalPosition": 5}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjczNjA1MjMzOnYy", "diffSide": "RIGHT", "path": "be/src/exec/analytic_eval_node.cpp", "isResolved": true, "comments": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xMlQwNDo0NTozM1rOGi247g==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xMlQxMToxMToyNlrOGjAPsw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzOTIwNDA3OA==", "bodyText": "would better give a better name.", "url": "https://github.com/apache/incubator-doris/pull/3820#discussion_r439204078", "createdAt": "2020-06-12T04:45:33Z", "author": {"login": "kangkaisen"}, "path": "be/src/exec/analytic_eval_node.cpp", "diffHunk": "@@ -195,9 +194,19 @@ Status AnalyticEvalNode::open(RuntimeState* state) {\n     RETURN_IF_CANCELLED(state);\n     //RETURN_IF_ERROR(QueryMaintenance(state));\n     RETURN_IF_ERROR(child(0)->open(state));\n-    // RETURN_IF_ERROR(state->block_mgr()->RegisterClient(2, mem_tracker(), state, &client_));\n-    _input_stream.reset(new BufferedTupleStream(state, child(0)->row_desc(), state->block_mgr()));\n-    RETURN_IF_ERROR(_input_stream->init(runtime_profile()));\n+    RETURN_IF_ERROR(state->block_mgr2()->register_client(2, mem_tracker(), state, &client_));\n+    _input_stream.reset(new BufferedTupleStream2(state, child(0)->row_desc(), state->block_mgr2(), client_, false, true));\n+    RETURN_IF_ERROR(_input_stream->init(id(), runtime_profile(), true));\n+\n+    bool got_read_buffer;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "998b576d5b802a6b740689b3ab08b66725661c79"}, "originalPosition": 19}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzOTMyNDczOQ==", "bodyText": "@kangkaisen Hello, I could not think of a better variable name. Could you please give me a suggestion. Thank you.", "url": "https://github.com/apache/incubator-doris/pull/3820#discussion_r439324739", "createdAt": "2020-06-12T09:57:35Z", "author": {"login": "HappenLee"}, "path": "be/src/exec/analytic_eval_node.cpp", "diffHunk": "@@ -195,9 +194,19 @@ Status AnalyticEvalNode::open(RuntimeState* state) {\n     RETURN_IF_CANCELLED(state);\n     //RETURN_IF_ERROR(QueryMaintenance(state));\n     RETURN_IF_ERROR(child(0)->open(state));\n-    // RETURN_IF_ERROR(state->block_mgr()->RegisterClient(2, mem_tracker(), state, &client_));\n-    _input_stream.reset(new BufferedTupleStream(state, child(0)->row_desc(), state->block_mgr()));\n-    RETURN_IF_ERROR(_input_stream->init(runtime_profile()));\n+    RETURN_IF_ERROR(state->block_mgr2()->register_client(2, mem_tracker(), state, &client_));\n+    _input_stream.reset(new BufferedTupleStream2(state, child(0)->row_desc(), state->block_mgr2(), client_, false, true));\n+    RETURN_IF_ERROR(_input_stream->init(id(), runtime_profile(), true));\n+\n+    bool got_read_buffer;", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzOTIwNDA3OA=="}, "originalCommit": {"oid": "998b576d5b802a6b740689b3ab08b66725661c79"}, "originalPosition": 19}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzOTM1NjAwNw==", "bodyText": "is_got_buffer or has_got_buffer?", "url": "https://github.com/apache/incubator-doris/pull/3820#discussion_r439356007", "createdAt": "2020-06-12T11:08:22Z", "author": {"login": "kangkaisen"}, "path": "be/src/exec/analytic_eval_node.cpp", "diffHunk": "@@ -195,9 +194,19 @@ Status AnalyticEvalNode::open(RuntimeState* state) {\n     RETURN_IF_CANCELLED(state);\n     //RETURN_IF_ERROR(QueryMaintenance(state));\n     RETURN_IF_ERROR(child(0)->open(state));\n-    // RETURN_IF_ERROR(state->block_mgr()->RegisterClient(2, mem_tracker(), state, &client_));\n-    _input_stream.reset(new BufferedTupleStream(state, child(0)->row_desc(), state->block_mgr()));\n-    RETURN_IF_ERROR(_input_stream->init(runtime_profile()));\n+    RETURN_IF_ERROR(state->block_mgr2()->register_client(2, mem_tracker(), state, &client_));\n+    _input_stream.reset(new BufferedTupleStream2(state, child(0)->row_desc(), state->block_mgr2(), client_, false, true));\n+    RETURN_IF_ERROR(_input_stream->init(id(), runtime_profile(), true));\n+\n+    bool got_read_buffer;", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzOTIwNDA3OA=="}, "originalCommit": {"oid": "998b576d5b802a6b740689b3ab08b66725661c79"}, "originalPosition": 19}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzOTM1NzM2Mw==", "bodyText": "ok", "url": "https://github.com/apache/incubator-doris/pull/3820#discussion_r439357363", "createdAt": "2020-06-12T11:11:26Z", "author": {"login": "HappenLee"}, "path": "be/src/exec/analytic_eval_node.cpp", "diffHunk": "@@ -195,9 +194,19 @@ Status AnalyticEvalNode::open(RuntimeState* state) {\n     RETURN_IF_CANCELLED(state);\n     //RETURN_IF_ERROR(QueryMaintenance(state));\n     RETURN_IF_ERROR(child(0)->open(state));\n-    // RETURN_IF_ERROR(state->block_mgr()->RegisterClient(2, mem_tracker(), state, &client_));\n-    _input_stream.reset(new BufferedTupleStream(state, child(0)->row_desc(), state->block_mgr()));\n-    RETURN_IF_ERROR(_input_stream->init(runtime_profile()));\n+    RETURN_IF_ERROR(state->block_mgr2()->register_client(2, mem_tracker(), state, &client_));\n+    _input_stream.reset(new BufferedTupleStream2(state, child(0)->row_desc(), state->block_mgr2(), client_, false, true));\n+    RETURN_IF_ERROR(_input_stream->init(id(), runtime_profile(), true));\n+\n+    bool got_read_buffer;", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzOTIwNDA3OA=="}, "originalCommit": {"oid": "998b576d5b802a6b740689b3ab08b66725661c79"}, "originalPosition": 19}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1495, "cost": 1, "resetAt": "2021-11-12T09:44:50Z"}}}