{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDEzNTIwMDI1", "number": 3476, "title": "[Bug] Fix bug of Partition prune of constant in predicate", "bodyText": "1. phenomenon\uff1a\nThe following two statements are the same, but a query has results and the other query has no results\nmysql> select * from (select '\u79ef\u6781' as kk1, sum(k2) from table_range where k1 = '2013-01-01' group by kk1)tt where kk1 = '\u79ef\u6781';\n+--------+-----------+\n| kk1    | sum(k2) |\n+--------+-----------+\n| \u79ef\u6781 |         1 |\n+--------+-----------+\n1 row in set (0.01 sec)\nmysql> select * from (select '\u79ef\u6781' as kk1, sum(k2) from table_range where k1 = '2013-01-01' group by kk1)tt where kk1 in ('\u79ef\u6781');\nEmpty set (0.01 sec)\n2. reason\uff1a\nIn partition prune, constant in predicate\uff08\u2018\u79ef\u6781\u2019 in \u2018\u79ef\u6781\u2019\uff09 is mistakenly considered to meet partition prune conditions, and mistakenly regarded as partition prune column. Then in partition prune , no partition is considered to meet the requirements, so it is planned to be 0 partition in query planning\n@morningman", "createdAt": "2020-05-05T13:35:17Z", "url": "https://github.com/apache/incubator-doris/pull/3476", "merged": true, "mergeCommit": {"oid": "9f224cdd8a7770045646c0da1d7723952976bacb"}, "closed": true, "closedAt": "2020-05-14T03:46:14Z", "author": {"login": "wutiangan"}, "timelineItems": {"totalCount": 7, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABceUEVpgH2gAyNDEzNTIwMDI1OmI2NDY4OTdlMjY0NGE5ZGQzOTk1YjE0OTgyYjZmZTk4YzgyODJkODY=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcg2q-EAFqTQxMDgwOTAyNg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "b646897e2644a9dd3995b14982b6fe98c8282d86", "author": {"user": {"login": "wutiangan", "name": null}}, "url": "https://github.com/apache/incubator-doris/commit/b646897e2644a9dd3995b14982b6fe98c8282d86", "committedDate": "2020-05-05T13:26:39Z", "message": "[Bug] Fix bug of Partition prune of constant in predicate"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDA1ODE2NjEx", "url": "https://github.com/apache/incubator-doris/pull/3476#pullrequestreview-405816611", "createdAt": "2020-05-05T14:00:07Z", "commit": {"oid": "b646897e2644a9dd3995b14982b6fe98c8282d86"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wNVQxNDowMDowOFrOGQq0AQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wNVQxNDowMDowOFrOGQq0AQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMDEzMTg0MQ==", "bodyText": "you can use (inPredicate.getChild(0).unwrapExpr(false) instanceof LiteralExpr)", "url": "https://github.com/apache/incubator-doris/pull/3476#discussion_r420131841", "createdAt": "2020-05-05T14:00:08Z", "author": {"login": "morningman"}, "path": "fe/src/main/java/org/apache/doris/planner/SingleNodePlanner.java", "diffHunk": "@@ -928,6 +928,14 @@ private PartitionColumnFilter createPartitionFilter(SlotDescriptor desc, List<Ex\n                 if (!inPredicate.isLiteralChildren() || inPredicate.isNotIn()) {\n                     continue;\n                 }\n+                if ((inPredicate.getChild(0) instanceof LiteralExpr)", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b646897e2644a9dd3995b14982b6fe98c8282d86"}, "originalPosition": 4}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b16daaa74cb3c54ba5a4d044ef77192bfad532a3", "author": {"user": {"login": "wutiangan", "name": null}}, "url": "https://github.com/apache/incubator-doris/commit/b16daaa74cb3c54ba5a4d044ef77192bfad532a3", "committedDate": "2020-05-09T09:26:43Z", "message": "fix review question"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a1d2058baf85c7b137ddc4a6fd94f083a19b4853", "author": {"user": {"login": "wutiangan", "name": null}}, "url": "https://github.com/apache/incubator-doris/commit/a1d2058baf85c7b137ddc4a6fd94f083a19b4853", "committedDate": "2020-05-09T12:19:55Z", "message": "adjust location"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f518c317a46a63ef516e1507eb3a6e993ded5b6e", "author": {"user": {"login": "wutiangan", "name": null}}, "url": "https://github.com/apache/incubator-doris/commit/f518c317a46a63ef516e1507eb3a6e993ded5b6e", "committedDate": "2020-05-09T12:43:46Z", "message": "adjust code style"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "9431e4c45fccac3d9eca90fdd61d49d90b7322cf", "author": {"user": {"login": "wutiangan", "name": null}}, "url": "https://github.com/apache/incubator-doris/commit/9431e4c45fccac3d9eca90fdd61d49d90b7322cf", "committedDate": "2020-05-13T04:11:58Z", "message": "adjust code location"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDEwODA5MDI2", "url": "https://github.com/apache/incubator-doris/pull/3476#pullrequestreview-410809026", "createdAt": "2020-05-13T10:53:29Z", "commit": {"oid": "9431e4c45fccac3d9eca90fdd61d49d90b7322cf"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2954, "cost": 1, "resetAt": "2021-10-28T17:48:14Z"}}}