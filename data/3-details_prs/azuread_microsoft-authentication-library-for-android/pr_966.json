{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0Mzg0NjIxMTQx", "number": 966, "title": "Fix crash on redirect when no activity available", "bodyText": "Related common PR: AzureAD/microsoft-authentication-library-common-for-android#839\nRepro for the issue:\n\nDownload a browser that doesn't support custom tabs\nSet it as the default browser\nStart an interactive request in MSAL Test App\nOnce in the browser, close the MSAL Test App\nGo back to browser to finish the authorization\n\nCurrently this results in a crash (NPE when creating custom tab response intent) as the calling activity class is NULL because the MSAL Test App was shut down and all memory was wiped.\nThis NPE was introduced with Fragment support. This entire scenario was not handled prior to Fragment support but didn't run into any NPE or crash as we were using a hard coded reference to Authorization Activity.\nTo fix the issue, I perform null checks and if we run into this scenario then we finish and return as we can't complete the interactive request as there is no interactive request in progress (in app memory), then we also log a warning as well as show a toast to the user explaining what probably happened.", "createdAt": "2020-03-06T03:54:33Z", "url": "https://github.com/AzureAD/microsoft-authentication-library-for-android/pull/966", "merged": true, "mergeCommit": {"oid": "c36d60a0041e3dad19ef382ed9a6b8a78e86cfe2"}, "closed": true, "closedAt": "2020-03-06T22:14:26Z", "author": {"login": "shahzaibj"}, "timelineItems": {"totalCount": 5, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcK34JjAH2gAyMzg0NjIxMTQxOjUyNjVkODBiMDAwZTMyMjM5ZWM2OWI5NDczZjg3M2VlZGUxNzJjODk=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcLHnkKAFqTM3MDY1ODA4Nw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "5265d80b000e32239ec69b9473f873eede172c89", "author": {"user": {"login": "shahzaibj", "name": "Shahzaib"}}, "url": "https://github.com/AzureAD/microsoft-authentication-library-for-android/commit/5265d80b000e32239ec69b9473f873eede172c89", "committedDate": "2020-03-06T03:51:26Z", "message": "Don't start activity if response intent is null"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "980cfdf42b5613fc79ff7a15e9d3ddc44f979bcc", "author": {"user": {"login": "shahzaibj", "name": "Shahzaib"}}, "url": "https://github.com/AzureAD/microsoft-authentication-library-for-android/commit/980cfdf42b5613fc79ff7a15e9d3ddc44f979bcc", "committedDate": "2020-03-06T03:52:34Z", "message": "Update submodule"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ff131e0af38a5ec59a8e80a5009245f809d7c7cc", "author": {"user": {"login": "shahzaibj", "name": "Shahzaib"}}, "url": "https://github.com/AzureAD/microsoft-authentication-library-for-android/commit/ff131e0af38a5ec59a8e80a5009245f809d7c7cc", "committedDate": "2020-03-06T21:26:36Z", "message": "Update submodule"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzcwNjU3OTM5", "url": "https://github.com/AzureAD/microsoft-authentication-library-for-android/pull/966#pullrequestreview-370657939", "createdAt": "2020-03-06T22:11:29Z", "commit": {"oid": "ff131e0af38a5ec59a8e80a5009245f809d7c7cc"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wNlQyMjoxMToyOVrOFzI_UQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wNlQyMjoxMToyOVrOFzI_UQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4OTE2ODk3Nw==", "bodyText": "We might not want to pop this toast as it will be visible (and potentially confusing) to end users.", "url": "https://github.com/AzureAD/microsoft-authentication-library-for-android/pull/966#discussion_r389168977", "createdAt": "2020-03-06T22:11:29Z", "author": {"login": "rpdome"}, "path": "msal/src/main/java/com/microsoft/identity/client/BrowserTabActivity.java", "diffHunk": "@@ -53,15 +56,21 @@\n  * </pre>\n  */\n public final class BrowserTabActivity extends Activity {\n-    //private static final String TAG = BrowserTabActivity.class.getSimpleName();\n+    private static final String TAG = BrowserTabActivity.class.getSimpleName();\n \n     @Override\n     protected void onCreate(final Bundle savedInstanceState) {\n         super.onCreate(savedInstanceState);\n         if (savedInstanceState == null\n                 && getIntent() != null\n                 && !StringUtil.isEmpty(getIntent().getDataString())) {\n-            startActivity(BrowserAuthorizationFragment.createCustomTabResponseIntent(this, getIntent().getDataString()));\n+            final Intent responseIntent = BrowserAuthorizationFragment.createCustomTabResponseIntent(this, getIntent().getDataString());\n+            if (responseIntent != null) {\n+                startActivity(responseIntent);\n+            } else {\n+                Logger.warn(TAG, \"Received NULL response intent. Unable to complete authorization.\");\n+                Toast.makeText(getApplicationContext(), \"Unable to complete authorization as there is no interactive call in progress. This can be due to closing the app while the authorization was in process.\", Toast.LENGTH_LONG).show();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ff131e0af38a5ec59a8e80a5009245f809d7c7cc"}, "originalPosition": 31}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzcwNjU4MDg3", "url": "https://github.com/AzureAD/microsoft-authentication-library-for-android/pull/966#pullrequestreview-370658087", "createdAt": "2020-03-06T22:11:48Z", "commit": {"oid": "ff131e0af38a5ec59a8e80a5009245f809d7c7cc"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1321, "cost": 1, "resetAt": "2021-11-01T11:59:11Z"}}}