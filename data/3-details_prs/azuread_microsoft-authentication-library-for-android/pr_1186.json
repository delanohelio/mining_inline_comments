{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTAxMzExODc5", "number": 1186, "title": "automating test case 832430", "bodyText": "automating test case 832430", "createdAt": "2020-10-12T05:33:33Z", "url": "https://github.com/AzureAD/microsoft-authentication-library-for-android/pull/1186", "merged": true, "mergeCommit": {"oid": "1213dd6549e5cc1eb0c32e8fcf918faf5ad5f99d"}, "closed": true, "closedAt": "2020-10-28T02:23:59Z", "author": {"login": "kkrishnareddy"}, "timelineItems": {"totalCount": 16, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdRtLmogH2gAyNTAxMzExODc5Ojc5ZGU3N2FhOWUxMmE0MDAxMzMyN2E4M2JiOWQ5MzY3M2IxNmFjNGM=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdWcpsTgH2gAyNTAxMzExODc5OjlhYTYzMDNkY2RjOWY3YmMzOTA5M2IxYTdkMmQxYmQ5MmM2MzU3MTI=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "79de77aa9e12a40013327a83bb9d93673b16ac4c", "author": {"user": {"login": "kkrishnareddy", "name": "krishna reddy kopparthy"}}, "url": "https://github.com/AzureAD/microsoft-authentication-library-for-android/commit/79de77aa9e12a40013327a83bb9d93673b16ac4c", "committedDate": "2020-10-12T05:32:21Z", "message": "automating test case 832430"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTEwODUwODY3", "url": "https://github.com/AzureAD/microsoft-authentication-library-for-android/pull/1186#pullrequestreview-510850867", "createdAt": "2020-10-16T23:52:05Z", "commit": {"oid": "79de77aa9e12a40013327a83bb9d93673b16ac4c"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xNlQyMzo1MjowNVrOHjSiSA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xNlQyMzo1MjowNVrOHjSiSA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNjc2NTg5Ng==", "bodyText": "Add license", "url": "https://github.com/AzureAD/microsoft-authentication-library-for-android/pull/1186#discussion_r506765896", "createdAt": "2020-10-16T23:52:05Z", "author": {"login": "shahzaibj"}, "path": "msalautomationapp/src/androidTest/java/com/microsoft/identity/client/msal/automationapp/testpass/broker/TestCase832430.java", "diffHunk": "@@ -0,0 +1,140 @@\n+package com.microsoft.identity.client.msal.automationapp.testpass.broker;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "79de77aa9e12a40013327a83bb9d93673b16ac4c"}, "originalPosition": 1}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "45afc7e4997f942637310793840d1efccfccd3d9", "author": {"user": {"login": "shahzaibj", "name": "Shahzaib"}}, "url": "https://github.com/AzureAD/microsoft-authentication-library-for-android/commit/45afc7e4997f942637310793840d1efccfccd3d9", "committedDate": "2020-10-16T23:53:01Z", "message": "Merge branch 'dev' into kkoppart-TestCase832430"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTExMTY1NDU3", "url": "https://github.com/AzureAD/microsoft-authentication-library-for-android/pull/1186#pullrequestreview-511165457", "createdAt": "2020-10-18T17:37:00Z", "commit": {"oid": "45afc7e4997f942637310793840d1efccfccd3d9"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xOFQxNzozNzowMFrOHjsd5A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xOFQxNzozNzowMFrOHjsd5A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNzE5MDc1Ng==", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            //https:identitydivision.visualstudio.com/DevEx/_workitems/edit/832430\n          \n          \n            \n            //https://identitydivision.visualstudio.com/DevEx/_workitems/edit/832430", "url": "https://github.com/AzureAD/microsoft-authentication-library-for-android/pull/1186#discussion_r507190756", "createdAt": "2020-10-18T17:37:00Z", "author": {"login": "shahzaibj"}, "path": "msalautomationapp/src/androidTest/java/com/microsoft/identity/client/msal/automationapp/testpass/broker/TestCase832430.java", "diffHunk": "@@ -0,0 +1,140 @@\n+package com.microsoft.identity.client.msal.automationapp.testpass.broker;\n+\n+import androidx.annotation.NonNull;\n+\n+import com.microsoft.identity.client.AcquireTokenParameters;\n+import com.microsoft.identity.client.AcquireTokenSilentParameters;\n+import com.microsoft.identity.client.IAccount;\n+import com.microsoft.identity.client.Prompt;\n+import com.microsoft.identity.client.msal.automationapp.R;\n+import com.microsoft.identity.client.msal.automationapp.interaction.InteractiveRequest;\n+import com.microsoft.identity.client.msal.automationapp.interaction.OnInteractionRequired;\n+import com.microsoft.identity.client.ui.automation.TestContext;\n+import com.microsoft.identity.client.ui.automation.broker.BrokerMicrosoftAuthenticator;\n+import com.microsoft.identity.client.ui.automation.broker.ITestBroker;\n+import com.microsoft.identity.client.ui.automation.interaction.PromptHandlerParameters;\n+import com.microsoft.identity.client.ui.automation.interaction.PromptParameter;\n+import com.microsoft.identity.client.ui.automation.interaction.microsoftsts.AadPromptHandler;\n+import com.microsoft.identity.internal.testutils.labutils.LabConfig;\n+import com.microsoft.identity.internal.testutils.labutils.LabConstants;\n+import com.microsoft.identity.internal.testutils.labutils.LabUserQuery;\n+\n+import org.junit.Test;\n+\n+import java.util.concurrent.CountDownLatch;\n+\n+//Joined AcquireToken test with MSAL and Broker\n+//https:identitydivision.visualstudio.com/DevEx/_workitems/edit/832430", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "45afc7e4997f942637310793840d1efccfccd3d9"}, "originalPosition": 27}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTExMTY1NjU1", "url": "https://github.com/AzureAD/microsoft-authentication-library-for-android/pull/1186#pullrequestreview-511165655", "createdAt": "2020-10-18T17:39:39Z", "commit": {"oid": "45afc7e4997f942637310793840d1efccfccd3d9"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xOFQxNzozOTozOVrOHjse8g==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xOFQxNzozOTozOVrOHjse8g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNzE5MTAyNg==", "bodyText": "Why true here?", "url": "https://github.com/AzureAD/microsoft-authentication-library-for-android/pull/1186#discussion_r507191026", "createdAt": "2020-10-18T17:39:39Z", "author": {"login": "shahzaibj"}, "path": "msalautomationapp/src/androidTest/java/com/microsoft/identity/client/msal/automationapp/testpass/broker/TestCase832430.java", "diffHunk": "@@ -0,0 +1,140 @@\n+package com.microsoft.identity.client.msal.automationapp.testpass.broker;\n+\n+import androidx.annotation.NonNull;\n+\n+import com.microsoft.identity.client.AcquireTokenParameters;\n+import com.microsoft.identity.client.AcquireTokenSilentParameters;\n+import com.microsoft.identity.client.IAccount;\n+import com.microsoft.identity.client.Prompt;\n+import com.microsoft.identity.client.msal.automationapp.R;\n+import com.microsoft.identity.client.msal.automationapp.interaction.InteractiveRequest;\n+import com.microsoft.identity.client.msal.automationapp.interaction.OnInteractionRequired;\n+import com.microsoft.identity.client.ui.automation.TestContext;\n+import com.microsoft.identity.client.ui.automation.broker.BrokerMicrosoftAuthenticator;\n+import com.microsoft.identity.client.ui.automation.broker.ITestBroker;\n+import com.microsoft.identity.client.ui.automation.interaction.PromptHandlerParameters;\n+import com.microsoft.identity.client.ui.automation.interaction.PromptParameter;\n+import com.microsoft.identity.client.ui.automation.interaction.microsoftsts.AadPromptHandler;\n+import com.microsoft.identity.internal.testutils.labutils.LabConfig;\n+import com.microsoft.identity.internal.testutils.labutils.LabConstants;\n+import com.microsoft.identity.internal.testutils.labutils.LabUserQuery;\n+\n+import org.junit.Test;\n+\n+import java.util.concurrent.CountDownLatch;\n+\n+//Joined AcquireToken test with MSAL and Broker\n+//https:identitydivision.visualstudio.com/DevEx/_workitems/edit/832430\n+public class TestCase832430 extends AbstractMsalBrokerTest {\n+\n+    @Test\n+    public void test_832430() throws InterruptedException {\n+        final String username = mLoginHint;\n+        final String password = LabConfig.getCurrentLabConfig().getLabUserPassword();\n+\n+        //acquiring token\n+        final CountDownLatch latch = new CountDownLatch(1);\n+\n+        final AcquireTokenParameters parameters = new AcquireTokenParameters.Builder()\n+                .startAuthorizationFromActivity(mActivity)\n+                .withLoginHint(mLoginHint)\n+                .withResource(mScopes[0])\n+                .withCallback(successfulInteractiveCallback(latch))\n+                .withPrompt(Prompt.SELECT_ACCOUNT)\n+                .build();\n+\n+        final InteractiveRequest interactiveRequest = new InteractiveRequest(\n+                mApplication,\n+                parameters,\n+                new OnInteractionRequired() {\n+                    @Override\n+                    public void handleUserInteraction() {\n+                        final PromptHandlerParameters promptHandlerParameters = PromptHandlerParameters.builder()\n+                                .prompt(PromptParameter.SELECT_ACCOUNT)\n+                                .loginHint(mLoginHint)\n+                                .sessionExpected(false)\n+                                .consentPageExpected(false)\n+                                .speedBumpExpected(false)\n+                                .broker(getBroker())\n+                                .expectingBrokerAccountChooserActivity(true)\n+                                .registerPageExpected(true)\n+                                .build();\n+\n+                        new AadPromptHandler(promptHandlerParameters)\n+                                .handlePrompt(username, password);\n+                    }\n+                }\n+        );\n+\n+        interactiveRequest.execute();\n+        latch.await();\n+\n+        final IAccount account = getAccount();\n+\n+        //acquiring token silently\n+        final CountDownLatch silentLatch = new CountDownLatch(1);\n+\n+        final AcquireTokenSilentParameters silentParameters = new AcquireTokenSilentParameters.Builder()\n+                .forAccount(account)\n+                .fromAuthority(account.getAuthority())\n+                .forceRefresh(false)\n+                .withResource(mScopes[0])\n+                .withCallback(successfulSilentCallback(silentLatch))\n+                .build();\n+\n+        mApplication.acquireTokenSilentAsync(silentParameters);\n+        silentLatch.await();\n+\n+        //forwarding time 1 day\n+        TestContext.getTestContext().getTestDevice().getSettings().forwardDeviceTimeForOneDay();\n+\n+        // acquiring token silently after expiring AT\n+        final CountDownLatch refreshTokenLatch = new CountDownLatch(1);\n+\n+        final AcquireTokenSilentParameters refreshTokenParameters = new AcquireTokenSilentParameters.Builder()\n+                .forAccount(account)\n+                .fromAuthority(account.getAuthority())\n+                .forceRefresh(true)", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "45afc7e4997f942637310793840d1efccfccd3d9"}, "originalPosition": 97}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTExMTY1ODM4", "url": "https://github.com/AzureAD/microsoft-authentication-library-for-android/pull/1186#pullrequestreview-511165838", "createdAt": "2020-10-18T17:42:21Z", "commit": {"oid": "45afc7e4997f942637310793840d1efccfccd3d9"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xOFQxNzo0MjoyMVrOHjsgOg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xOFQxNzo0MjoyMVrOHjsgOg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNzE5MTM1NA==", "bodyText": "This can be false", "url": "https://github.com/AzureAD/microsoft-authentication-library-for-android/pull/1186#discussion_r507191354", "createdAt": "2020-10-18T17:42:21Z", "author": {"login": "shahzaibj"}, "path": "msalautomationapp/src/androidTest/java/com/microsoft/identity/client/msal/automationapp/testpass/broker/TestCase832430.java", "diffHunk": "@@ -0,0 +1,140 @@\n+package com.microsoft.identity.client.msal.automationapp.testpass.broker;\n+\n+import androidx.annotation.NonNull;\n+\n+import com.microsoft.identity.client.AcquireTokenParameters;\n+import com.microsoft.identity.client.AcquireTokenSilentParameters;\n+import com.microsoft.identity.client.IAccount;\n+import com.microsoft.identity.client.Prompt;\n+import com.microsoft.identity.client.msal.automationapp.R;\n+import com.microsoft.identity.client.msal.automationapp.interaction.InteractiveRequest;\n+import com.microsoft.identity.client.msal.automationapp.interaction.OnInteractionRequired;\n+import com.microsoft.identity.client.ui.automation.TestContext;\n+import com.microsoft.identity.client.ui.automation.broker.BrokerMicrosoftAuthenticator;\n+import com.microsoft.identity.client.ui.automation.broker.ITestBroker;\n+import com.microsoft.identity.client.ui.automation.interaction.PromptHandlerParameters;\n+import com.microsoft.identity.client.ui.automation.interaction.PromptParameter;\n+import com.microsoft.identity.client.ui.automation.interaction.microsoftsts.AadPromptHandler;\n+import com.microsoft.identity.internal.testutils.labutils.LabConfig;\n+import com.microsoft.identity.internal.testutils.labutils.LabConstants;\n+import com.microsoft.identity.internal.testutils.labutils.LabUserQuery;\n+\n+import org.junit.Test;\n+\n+import java.util.concurrent.CountDownLatch;\n+\n+//Joined AcquireToken test with MSAL and Broker\n+//https:identitydivision.visualstudio.com/DevEx/_workitems/edit/832430\n+public class TestCase832430 extends AbstractMsalBrokerTest {\n+\n+    @Test\n+    public void test_832430() throws InterruptedException {\n+        final String username = mLoginHint;\n+        final String password = LabConfig.getCurrentLabConfig().getLabUserPassword();\n+\n+        //acquiring token\n+        final CountDownLatch latch = new CountDownLatch(1);\n+\n+        final AcquireTokenParameters parameters = new AcquireTokenParameters.Builder()\n+                .startAuthorizationFromActivity(mActivity)\n+                .withLoginHint(mLoginHint)\n+                .withResource(mScopes[0])\n+                .withCallback(successfulInteractiveCallback(latch))\n+                .withPrompt(Prompt.SELECT_ACCOUNT)\n+                .build();\n+\n+        final InteractiveRequest interactiveRequest = new InteractiveRequest(\n+                mApplication,\n+                parameters,\n+                new OnInteractionRequired() {\n+                    @Override\n+                    public void handleUserInteraction() {\n+                        final PromptHandlerParameters promptHandlerParameters = PromptHandlerParameters.builder()\n+                                .prompt(PromptParameter.SELECT_ACCOUNT)\n+                                .loginHint(mLoginHint)\n+                                .sessionExpected(false)\n+                                .consentPageExpected(false)\n+                                .speedBumpExpected(false)\n+                                .broker(getBroker())\n+                                .expectingBrokerAccountChooserActivity(true)", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "45afc7e4997f942637310793840d1efccfccd3d9"}, "originalPosition": 59}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTExMTY1ODY1", "url": "https://github.com/AzureAD/microsoft-authentication-library-for-android/pull/1186#pullrequestreview-511165865", "createdAt": "2020-10-18T17:42:44Z", "commit": {"oid": "45afc7e4997f942637310793840d1efccfccd3d9"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xOFQxNzo0Mjo0NFrOHjsgVw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xOFQxNzo0Mjo0NFrOHjsgVw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNzE5MTM4Mw==", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                                            .broker(getBroker())\n          \n          \n            \n                                            .broker(mBroker)", "url": "https://github.com/AzureAD/microsoft-authentication-library-for-android/pull/1186#discussion_r507191383", "createdAt": "2020-10-18T17:42:44Z", "author": {"login": "shahzaibj"}, "path": "msalautomationapp/src/androidTest/java/com/microsoft/identity/client/msal/automationapp/testpass/broker/TestCase832430.java", "diffHunk": "@@ -0,0 +1,140 @@\n+package com.microsoft.identity.client.msal.automationapp.testpass.broker;\n+\n+import androidx.annotation.NonNull;\n+\n+import com.microsoft.identity.client.AcquireTokenParameters;\n+import com.microsoft.identity.client.AcquireTokenSilentParameters;\n+import com.microsoft.identity.client.IAccount;\n+import com.microsoft.identity.client.Prompt;\n+import com.microsoft.identity.client.msal.automationapp.R;\n+import com.microsoft.identity.client.msal.automationapp.interaction.InteractiveRequest;\n+import com.microsoft.identity.client.msal.automationapp.interaction.OnInteractionRequired;\n+import com.microsoft.identity.client.ui.automation.TestContext;\n+import com.microsoft.identity.client.ui.automation.broker.BrokerMicrosoftAuthenticator;\n+import com.microsoft.identity.client.ui.automation.broker.ITestBroker;\n+import com.microsoft.identity.client.ui.automation.interaction.PromptHandlerParameters;\n+import com.microsoft.identity.client.ui.automation.interaction.PromptParameter;\n+import com.microsoft.identity.client.ui.automation.interaction.microsoftsts.AadPromptHandler;\n+import com.microsoft.identity.internal.testutils.labutils.LabConfig;\n+import com.microsoft.identity.internal.testutils.labutils.LabConstants;\n+import com.microsoft.identity.internal.testutils.labutils.LabUserQuery;\n+\n+import org.junit.Test;\n+\n+import java.util.concurrent.CountDownLatch;\n+\n+//Joined AcquireToken test with MSAL and Broker\n+//https:identitydivision.visualstudio.com/DevEx/_workitems/edit/832430\n+public class TestCase832430 extends AbstractMsalBrokerTest {\n+\n+    @Test\n+    public void test_832430() throws InterruptedException {\n+        final String username = mLoginHint;\n+        final String password = LabConfig.getCurrentLabConfig().getLabUserPassword();\n+\n+        //acquiring token\n+        final CountDownLatch latch = new CountDownLatch(1);\n+\n+        final AcquireTokenParameters parameters = new AcquireTokenParameters.Builder()\n+                .startAuthorizationFromActivity(mActivity)\n+                .withLoginHint(mLoginHint)\n+                .withResource(mScopes[0])\n+                .withCallback(successfulInteractiveCallback(latch))\n+                .withPrompt(Prompt.SELECT_ACCOUNT)\n+                .build();\n+\n+        final InteractiveRequest interactiveRequest = new InteractiveRequest(\n+                mApplication,\n+                parameters,\n+                new OnInteractionRequired() {\n+                    @Override\n+                    public void handleUserInteraction() {\n+                        final PromptHandlerParameters promptHandlerParameters = PromptHandlerParameters.builder()\n+                                .prompt(PromptParameter.SELECT_ACCOUNT)\n+                                .loginHint(mLoginHint)\n+                                .sessionExpected(false)\n+                                .consentPageExpected(false)\n+                                .speedBumpExpected(false)\n+                                .broker(getBroker())", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "45afc7e4997f942637310793840d1efccfccd3d9"}, "originalPosition": 58}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTExMTY1OTIz", "url": "https://github.com/AzureAD/microsoft-authentication-library-for-android/pull/1186#pullrequestreview-511165923", "createdAt": "2020-10-18T17:43:31Z", "commit": {"oid": "45afc7e4997f942637310793840d1efccfccd3d9"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xOFQxNzo0MzozMVrOHjsgnQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xOFQxNzo0MzozMVrOHjsgnQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNzE5MTQ1Mw==", "bodyText": "You no longer need to override this", "url": "https://github.com/AzureAD/microsoft-authentication-library-for-android/pull/1186#discussion_r507191453", "createdAt": "2020-10-18T17:43:31Z", "author": {"login": "shahzaibj"}, "path": "msalautomationapp/src/androidTest/java/com/microsoft/identity/client/msal/automationapp/testpass/broker/TestCase832430.java", "diffHunk": "@@ -0,0 +1,140 @@\n+package com.microsoft.identity.client.msal.automationapp.testpass.broker;\n+\n+import androidx.annotation.NonNull;\n+\n+import com.microsoft.identity.client.AcquireTokenParameters;\n+import com.microsoft.identity.client.AcquireTokenSilentParameters;\n+import com.microsoft.identity.client.IAccount;\n+import com.microsoft.identity.client.Prompt;\n+import com.microsoft.identity.client.msal.automationapp.R;\n+import com.microsoft.identity.client.msal.automationapp.interaction.InteractiveRequest;\n+import com.microsoft.identity.client.msal.automationapp.interaction.OnInteractionRequired;\n+import com.microsoft.identity.client.ui.automation.TestContext;\n+import com.microsoft.identity.client.ui.automation.broker.BrokerMicrosoftAuthenticator;\n+import com.microsoft.identity.client.ui.automation.broker.ITestBroker;\n+import com.microsoft.identity.client.ui.automation.interaction.PromptHandlerParameters;\n+import com.microsoft.identity.client.ui.automation.interaction.PromptParameter;\n+import com.microsoft.identity.client.ui.automation.interaction.microsoftsts.AadPromptHandler;\n+import com.microsoft.identity.internal.testutils.labutils.LabConfig;\n+import com.microsoft.identity.internal.testutils.labutils.LabConstants;\n+import com.microsoft.identity.internal.testutils.labutils.LabUserQuery;\n+\n+import org.junit.Test;\n+\n+import java.util.concurrent.CountDownLatch;\n+\n+//Joined AcquireToken test with MSAL and Broker\n+//https:identitydivision.visualstudio.com/DevEx/_workitems/edit/832430\n+public class TestCase832430 extends AbstractMsalBrokerTest {\n+\n+    @Test\n+    public void test_832430() throws InterruptedException {\n+        final String username = mLoginHint;\n+        final String password = LabConfig.getCurrentLabConfig().getLabUserPassword();\n+\n+        //acquiring token\n+        final CountDownLatch latch = new CountDownLatch(1);\n+\n+        final AcquireTokenParameters parameters = new AcquireTokenParameters.Builder()\n+                .startAuthorizationFromActivity(mActivity)\n+                .withLoginHint(mLoginHint)\n+                .withResource(mScopes[0])\n+                .withCallback(successfulInteractiveCallback(latch))\n+                .withPrompt(Prompt.SELECT_ACCOUNT)\n+                .build();\n+\n+        final InteractiveRequest interactiveRequest = new InteractiveRequest(\n+                mApplication,\n+                parameters,\n+                new OnInteractionRequired() {\n+                    @Override\n+                    public void handleUserInteraction() {\n+                        final PromptHandlerParameters promptHandlerParameters = PromptHandlerParameters.builder()\n+                                .prompt(PromptParameter.SELECT_ACCOUNT)\n+                                .loginHint(mLoginHint)\n+                                .sessionExpected(false)\n+                                .consentPageExpected(false)\n+                                .speedBumpExpected(false)\n+                                .broker(getBroker())\n+                                .expectingBrokerAccountChooserActivity(true)\n+                                .registerPageExpected(true)\n+                                .build();\n+\n+                        new AadPromptHandler(promptHandlerParameters)\n+                                .handlePrompt(username, password);\n+                    }\n+                }\n+        );\n+\n+        interactiveRequest.execute();\n+        latch.await();\n+\n+        final IAccount account = getAccount();\n+\n+        //acquiring token silently\n+        final CountDownLatch silentLatch = new CountDownLatch(1);\n+\n+        final AcquireTokenSilentParameters silentParameters = new AcquireTokenSilentParameters.Builder()\n+                .forAccount(account)\n+                .fromAuthority(account.getAuthority())\n+                .forceRefresh(false)\n+                .withResource(mScopes[0])\n+                .withCallback(successfulSilentCallback(silentLatch))\n+                .build();\n+\n+        mApplication.acquireTokenSilentAsync(silentParameters);\n+        silentLatch.await();\n+\n+        //forwarding time 1 day\n+        TestContext.getTestContext().getTestDevice().getSettings().forwardDeviceTimeForOneDay();\n+\n+        // acquiring token silently after expiring AT\n+        final CountDownLatch refreshTokenLatch = new CountDownLatch(1);\n+\n+        final AcquireTokenSilentParameters refreshTokenParameters = new AcquireTokenSilentParameters.Builder()\n+                .forAccount(account)\n+                .fromAuthority(account.getAuthority())\n+                .forceRefresh(true)\n+                .withResource(mScopes[0])\n+                .withCallback(successfulSilentCallback(refreshTokenLatch))\n+                .build();\n+\n+        mApplication.acquireTokenSilentAsync(refreshTokenParameters);\n+        refreshTokenLatch.await();\n+    }\n+\n+    @Override\n+    public LabUserQuery getLabUserQuery() {\n+        final LabUserQuery query = new LabUserQuery();\n+        query.azureEnvironment = LabConstants.AzureEnvironment.AZURE_CLOUD;\n+        query.protectionPolicy = LabConstants.ProtectionPolicy.MAM_CA;\n+        return query;\n+    }\n+\n+    @Override\n+    public String getTempUserType() {\n+        return null;\n+    }\n+\n+    @Override\n+    public String[] getScopes() {\n+        return new String[]{\"00000003-0000-0ff1-ce00-000000000000\"};\n+    }\n+\n+    @Override\n+    public String getAuthority() {\n+        return mApplication.getConfiguration().getDefaultAuthority().toString();\n+    }\n+\n+    @NonNull\n+    @Override\n+    public ITestBroker getBroker() {\n+        return new BrokerMicrosoftAuthenticator();\n+    }", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "45afc7e4997f942637310793840d1efccfccd3d9"}, "originalPosition": 133}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTExMTY1OTY3", "url": "https://github.com/AzureAD/microsoft-authentication-library-for-android/pull/1186#pullrequestreview-511165967", "createdAt": "2020-10-18T17:44:04Z", "commit": {"oid": "45afc7e4997f942637310793840d1efccfccd3d9"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xOFQxNzo0NDowNFrOHjsg2g==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xOFQxNzo0NDowNFrOHjsg2g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNzE5MTUxNA==", "bodyText": "Let's add a Thread.sleep for 30 seconds here to expire the in-memory throttling cache", "url": "https://github.com/AzureAD/microsoft-authentication-library-for-android/pull/1186#discussion_r507191514", "createdAt": "2020-10-18T17:44:04Z", "author": {"login": "shahzaibj"}, "path": "msalautomationapp/src/androidTest/java/com/microsoft/identity/client/msal/automationapp/testpass/broker/TestCase832430.java", "diffHunk": "@@ -0,0 +1,140 @@\n+package com.microsoft.identity.client.msal.automationapp.testpass.broker;\n+\n+import androidx.annotation.NonNull;\n+\n+import com.microsoft.identity.client.AcquireTokenParameters;\n+import com.microsoft.identity.client.AcquireTokenSilentParameters;\n+import com.microsoft.identity.client.IAccount;\n+import com.microsoft.identity.client.Prompt;\n+import com.microsoft.identity.client.msal.automationapp.R;\n+import com.microsoft.identity.client.msal.automationapp.interaction.InteractiveRequest;\n+import com.microsoft.identity.client.msal.automationapp.interaction.OnInteractionRequired;\n+import com.microsoft.identity.client.ui.automation.TestContext;\n+import com.microsoft.identity.client.ui.automation.broker.BrokerMicrosoftAuthenticator;\n+import com.microsoft.identity.client.ui.automation.broker.ITestBroker;\n+import com.microsoft.identity.client.ui.automation.interaction.PromptHandlerParameters;\n+import com.microsoft.identity.client.ui.automation.interaction.PromptParameter;\n+import com.microsoft.identity.client.ui.automation.interaction.microsoftsts.AadPromptHandler;\n+import com.microsoft.identity.internal.testutils.labutils.LabConfig;\n+import com.microsoft.identity.internal.testutils.labutils.LabConstants;\n+import com.microsoft.identity.internal.testutils.labutils.LabUserQuery;\n+\n+import org.junit.Test;\n+\n+import java.util.concurrent.CountDownLatch;\n+\n+//Joined AcquireToken test with MSAL and Broker\n+//https:identitydivision.visualstudio.com/DevEx/_workitems/edit/832430\n+public class TestCase832430 extends AbstractMsalBrokerTest {\n+\n+    @Test\n+    public void test_832430() throws InterruptedException {\n+        final String username = mLoginHint;\n+        final String password = LabConfig.getCurrentLabConfig().getLabUserPassword();\n+\n+        //acquiring token\n+        final CountDownLatch latch = new CountDownLatch(1);\n+\n+        final AcquireTokenParameters parameters = new AcquireTokenParameters.Builder()\n+                .startAuthorizationFromActivity(mActivity)\n+                .withLoginHint(mLoginHint)\n+                .withResource(mScopes[0])\n+                .withCallback(successfulInteractiveCallback(latch))\n+                .withPrompt(Prompt.SELECT_ACCOUNT)\n+                .build();\n+\n+        final InteractiveRequest interactiveRequest = new InteractiveRequest(\n+                mApplication,\n+                parameters,\n+                new OnInteractionRequired() {\n+                    @Override\n+                    public void handleUserInteraction() {\n+                        final PromptHandlerParameters promptHandlerParameters = PromptHandlerParameters.builder()\n+                                .prompt(PromptParameter.SELECT_ACCOUNT)\n+                                .loginHint(mLoginHint)\n+                                .sessionExpected(false)\n+                                .consentPageExpected(false)\n+                                .speedBumpExpected(false)\n+                                .broker(getBroker())\n+                                .expectingBrokerAccountChooserActivity(true)\n+                                .registerPageExpected(true)\n+                                .build();\n+\n+                        new AadPromptHandler(promptHandlerParameters)\n+                                .handlePrompt(username, password);\n+                    }\n+                }\n+        );\n+\n+        interactiveRequest.execute();\n+        latch.await();\n+\n+        final IAccount account = getAccount();\n+\n+        //acquiring token silently\n+        final CountDownLatch silentLatch = new CountDownLatch(1);\n+\n+        final AcquireTokenSilentParameters silentParameters = new AcquireTokenSilentParameters.Builder()\n+                .forAccount(account)\n+                .fromAuthority(account.getAuthority())\n+                .forceRefresh(false)\n+                .withResource(mScopes[0])\n+                .withCallback(successfulSilentCallback(silentLatch))\n+                .build();\n+\n+        mApplication.acquireTokenSilentAsync(silentParameters);\n+        silentLatch.await();\n+\n+        //forwarding time 1 day\n+        TestContext.getTestContext().getTestDevice().getSettings().forwardDeviceTimeForOneDay();\n+", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "45afc7e4997f942637310793840d1efccfccd3d9"}, "originalPosition": 90}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTExMTY1OTgx", "url": "https://github.com/AzureAD/microsoft-authentication-library-for-android/pull/1186#pullrequestreview-511165981", "createdAt": "2020-10-18T17:44:17Z", "commit": {"oid": "45afc7e4997f942637310793840d1efccfccd3d9"}, "state": "COMMENTED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "5a8d5363fb084fac4efdc6494373aaca094bbae5", "author": {"user": {"login": "kkrishnareddy", "name": "krishna reddy kopparthy"}}, "url": "https://github.com/AzureAD/microsoft-authentication-library-for-android/commit/5a8d5363fb084fac4efdc6494373aaca094bbae5", "committedDate": "2020-10-20T12:45:58Z", "message": "resolving PR commits"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "5163fb1df88a8264fa9abdea61881e1322e1788a", "author": {"user": {"login": "kkrishnareddy", "name": "krishna reddy kopparthy"}}, "url": "https://github.com/AzureAD/microsoft-authentication-library-for-android/commit/5163fb1df88a8264fa9abdea61881e1322e1788a", "committedDate": "2020-10-20T12:46:13Z", "message": "Merge branch 'kkoppart-TestCase832430' of https://github.com/AzureAD/microsoft-authentication-library-for-android into kkoppart-TestCase832430"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTEzMjc3Njgy", "url": "https://github.com/AzureAD/microsoft-authentication-library-for-android/pull/1186#pullrequestreview-513277682", "createdAt": "2020-10-21T03:18:14Z", "commit": {"oid": "5163fb1df88a8264fa9abdea61881e1322e1788a"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "eb3bdcf83d3dd1a7179f7eadda6ceb54cdc4e104", "author": {"user": {"login": "shahzaibj", "name": "Shahzaib"}}, "url": "https://github.com/AzureAD/microsoft-authentication-library-for-android/commit/eb3bdcf83d3dd1a7179f7eadda6ceb54cdc4e104", "committedDate": "2020-10-23T16:56:00Z", "message": "Merge branch 'dev' into kkoppart-TestCase832430"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "24b2d5b485a1569fd242ed4b0e4722a42d355614", "author": {"user": {"login": "shahzaibj", "name": "Shahzaib"}}, "url": "https://github.com/AzureAD/microsoft-authentication-library-for-android/commit/24b2d5b485a1569fd242ed4b0e4722a42d355614", "committedDate": "2020-10-26T21:15:05Z", "message": "Merge branch 'dev' into kkoppart-TestCase832430"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "9aa6303dcdc9f7bc39093b1a7d2d1bd92c635712", "author": {"user": {"login": "shahzaibj", "name": "Shahzaib"}}, "url": "https://github.com/AzureAD/microsoft-authentication-library-for-android/commit/9aa6303dcdc9f7bc39093b1a7d2d1bd92c635712", "committedDate": "2020-10-26T23:06:27Z", "message": "Merge branch 'dev' into kkoppart-TestCase832430"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1274, "cost": 1, "resetAt": "2021-11-01T11:59:11Z"}}}