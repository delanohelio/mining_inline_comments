{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDcxMjA3NTMy", "number": 1134, "title": "Resurrect b2c ui tests", "bodyText": "Remove Load Lab User Rule and move the logic to @Before to allow creating more dynamic lab queries (as needed in the case of parameterized tests such as the B2C Test)\nRemove ignore annot from B2C Test", "createdAt": "2020-08-20T19:51:38Z", "url": "https://github.com/AzureAD/microsoft-authentication-library-for-android/pull/1134", "merged": true, "mergeCommit": {"oid": "8d47acf551918c575e30333ab8195497c417898d"}, "closed": true, "closedAt": "2020-09-03T00:11:35Z", "author": {"login": "shahzaibj"}, "timelineItems": {"totalCount": 7, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdA1r5WgH2gAyNDcxMjA3NTMyOjM1OWE1ZDdhY2E4NjEwNDg0YTFlYjFhMGNkMjE2MzA4YzQ2ODg4Nzc=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdFE3q4gH2gAyNDcxMjA3NTMyOjRkMzVjYzc2MDBkM2EwZWIzN2Y0YTc4Y2FkMGJhNjgyZjdhYWY1MDU=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "359a5d7aca8610484a1eb1a0cd216308c4688877", "author": {"user": {"login": "shahzaibj", "name": "Shahzaib"}}, "url": "https://github.com/AzureAD/microsoft-authentication-library-for-android/commit/359a5d7aca8610484a1eb1a0cd216308c4688877", "committedDate": "2020-08-20T19:50:09Z", "message": "Resurrect b2c ui tests"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDcxOTQ2Mjk5", "url": "https://github.com/AzureAD/microsoft-authentication-library-for-android/pull/1134#pullrequestreview-471946299", "createdAt": "2020-08-20T20:03:56Z", "commit": {"oid": "359a5d7aca8610484a1eb1a0cd216308c4688877"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yMFQyMDowMzo1NlrOHERapA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yMFQyMDowMzo1NlrOHERapA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NDI0MTcwMA==", "bodyText": "\ud83d\ude1e", "url": "https://github.com/AzureAD/microsoft-authentication-library-for-android/pull/1134#discussion_r474241700", "createdAt": "2020-08-20T20:03:56Z", "author": {"login": "iambmelt"}, "path": "msalautomationapp/src/androidTest/java/com/microsoft/identity/client/msal/automationapp/AbstractMsalUiTest.java", "diffHunk": "@@ -85,35 +86,46 @@\n     public final TestRule resetAutomaticTimeRule = new ResetAutomaticTimeZoneTestRule();\n \n     @Rule(order = 3)\n-    public final TestRule loadLabUserRule = getLabUserQuery() != null\n-            ? new LoadLabUserTestRule(getLabUserQuery())\n-            : new LoadLabUserTestRule(getTempUserType());\n-\n-    @Rule(order = 4)\n     public final TestRule removeBrokersRule = new RemoveBrokersBeforeTestRule();\n \n-    @Rule(order = 5)\n+    @Rule(order = 4)\n     public ActivityTestRule<MainActivity> mActivityRule =\n             new ActivityTestRule(MainActivity.class);\n \n-    @Rule(order = 6)\n+    @Rule(order = 5)\n     public TestRule deviceEnrollmentFailureRecoveryRule = new DeviceEnrollmentFailureRecoveryRule();\n \n     @Before\n     public void setup() {\n+        loadLabUser();\n         mScopes = getScopes();\n         mBrowser = getBrowser();\n \n         // clear all cookies in the browser\n         mBrowser.clear();\n \n-        mLoginHint = ((LoadLabUserTestRule) loadLabUserRule).getLabUserUpn();\n-\n         mContext = ApplicationProvider.getApplicationContext();\n         mActivity = mActivityRule.getActivity();\n         setupPCA();\n     }\n \n+    private void loadLabUser() {\n+        if (getLabUserQuery() != null) {\n+            mLoginHint = LabUserHelper.loadUserForTest(getLabUserQuery());\n+        } else if (getTempUserType() != null) {\n+            mLoginHint = LabUserHelper.loadTempUser(getTempUserType());\n+            try {\n+                // temp user takes some time to actually being created even though it may be\n+                // returned by the LAB API. Adding a wait here before we proceed with the test.", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "359a5d7aca8610484a1eb1a0cd216308c4688877"}, "originalPosition": 65}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDcxOTQ2NDI0", "url": "https://github.com/AzureAD/microsoft-authentication-library-for-android/pull/1134#pullrequestreview-471946424", "createdAt": "2020-08-20T20:04:08Z", "commit": {"oid": "359a5d7aca8610484a1eb1a0cd216308c4688877"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDcxOTQ2NzA3", "url": "https://github.com/AzureAD/microsoft-authentication-library-for-android/pull/1134#pullrequestreview-471946707", "createdAt": "2020-08-20T20:04:36Z", "commit": {"oid": "359a5d7aca8610484a1eb1a0cd216308c4688877"}, "state": "APPROVED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yMFQyMDowNDozNlrOHERbzw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yMFQyMDowNDozNlrOHERbzw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NDI0MTk5OQ==", "bodyText": "Should we bake this into loadTempUser?", "url": "https://github.com/AzureAD/microsoft-authentication-library-for-android/pull/1134#discussion_r474241999", "createdAt": "2020-08-20T20:04:36Z", "author": {"login": "AdamBJohnsonx"}, "path": "msalautomationapp/src/androidTest/java/com/microsoft/identity/client/msal/automationapp/AbstractMsalUiTest.java", "diffHunk": "@@ -85,35 +86,46 @@\n     public final TestRule resetAutomaticTimeRule = new ResetAutomaticTimeZoneTestRule();\n \n     @Rule(order = 3)\n-    public final TestRule loadLabUserRule = getLabUserQuery() != null\n-            ? new LoadLabUserTestRule(getLabUserQuery())\n-            : new LoadLabUserTestRule(getTempUserType());\n-\n-    @Rule(order = 4)\n     public final TestRule removeBrokersRule = new RemoveBrokersBeforeTestRule();\n \n-    @Rule(order = 5)\n+    @Rule(order = 4)\n     public ActivityTestRule<MainActivity> mActivityRule =\n             new ActivityTestRule(MainActivity.class);\n \n-    @Rule(order = 6)\n+    @Rule(order = 5)\n     public TestRule deviceEnrollmentFailureRecoveryRule = new DeviceEnrollmentFailureRecoveryRule();\n \n     @Before\n     public void setup() {\n+        loadLabUser();\n         mScopes = getScopes();\n         mBrowser = getBrowser();\n \n         // clear all cookies in the browser\n         mBrowser.clear();\n \n-        mLoginHint = ((LoadLabUserTestRule) loadLabUserRule).getLabUserUpn();\n-\n         mContext = ApplicationProvider.getApplicationContext();\n         mActivity = mActivityRule.getActivity();\n         setupPCA();\n     }\n \n+    private void loadLabUser() {\n+        if (getLabUserQuery() != null) {\n+            mLoginHint = LabUserHelper.loadUserForTest(getLabUserQuery());\n+        } else if (getTempUserType() != null) {\n+            mLoginHint = LabUserHelper.loadTempUser(getTempUserType());\n+            try {\n+                // temp user takes some time to actually being created even though it may be\n+                // returned by the LAB API. Adding a wait here before we proceed with the test.\n+                Thread.sleep(TEMP_USER_WAIT_TIME);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "359a5d7aca8610484a1eb1a0cd216308c4688877"}, "originalPosition": 66}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "11896216a6a3644cd02534ccc11b99a97890c962", "author": {"user": {"login": "shahzaibj", "name": "Shahzaib"}}, "url": "https://github.com/AzureAD/microsoft-authentication-library-for-android/commit/11896216a6a3644cd02534ccc11b99a97890c962", "committedDate": "2020-09-02T23:44:56Z", "message": "Merge branch 'dev' into shahzaibj/fix-b2c-ui-test"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "8233772a9c0fb0b5a3b28983f8eb4930d34c5751", "author": {"user": {"login": "shahzaibj", "name": "Shahzaib"}}, "url": "https://github.com/AzureAD/microsoft-authentication-library-for-android/commit/8233772a9c0fb0b5a3b28983f8eb4930d34c5751", "committedDate": "2020-09-02T23:46:53Z", "message": "Resolve merge conflict"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "4d35cc7600d3a0eb37f4a78cad0ba682f7aaf505", "author": {"user": {"login": "shahzaibj", "name": "Shahzaib"}}, "url": "https://github.com/AzureAD/microsoft-authentication-library-for-android/commit/4d35cc7600d3a0eb37f4a78cad0ba682f7aaf505", "committedDate": "2020-09-02T23:47:17Z", "message": "Update submodule"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1247, "cost": 1, "resetAt": "2021-11-01T11:59:11Z"}}}