{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDE4MTY1MDk5", "number": 1044, "title": "[Docs] Document Prompt Behavior with+/out Broker", "bodyText": "Introduces new documentation covering ADAL + MSAL; how Prompt augments flows, and OpenId param equivalents\nThanks @kreedula for providing input as to structure/contents of this doc\nPreview Rendered Document Here\nBugs filed\nDuring the writing of this doc, the following issues were discovered and subsequently filed:\n\nAzureAD/ad-accounts-for-android#1294\nVSO/Engineering: PBI: 1017217", "createdAt": "2020-05-14T18:10:44Z", "url": "https://github.com/AzureAD/microsoft-authentication-library-for-android/pull/1044", "merged": true, "mergeCommit": {"oid": "a89e57755419115b5a27c1170d71a0b6b8fef767"}, "closed": true, "closedAt": "2020-05-19T21:38:47Z", "author": {"login": "iambmelt"}, "timelineItems": {"totalCount": 10, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABchRg-NgH2gAyNDE4MTY1MDk5OmMxODkyYzE5YTcyMWYyNmJiM2YwNDhhNDQ1MjZlYTE0MGYxZjNmOWI=", "endCursor": "Y3Vyc29yOnYyOpPPAAABch7xeGgH2gAyNDE4MTY1MDk5OjUxZmMzMDI3NjU1YjAzMWUwODJlNjNjNWMzYmZmYTgwNmZlYTFhNmI=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "c1892c19a721f26bb3f048a44526ea140f1f3f9b", "author": {"user": {"login": "iambmelt", "name": "Brian Melton-Grace"}}, "url": "https://github.com/AzureAD/microsoft-authentication-library-for-android/commit/c1892c19a721f26bb3f048a44526ea140f1f3f9b", "committedDate": "2020-05-14T18:09:59Z", "message": "Create prompt_behavior.md"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "4bea3dd872aee20436916d03ddc8897f961c2aa0", "author": {"user": {"login": "iambmelt", "name": "Brian Melton-Grace"}}, "url": "https://github.com/AzureAD/microsoft-authentication-library-for-android/commit/4bea3dd872aee20436916d03ddc8897f961c2aa0", "committedDate": "2020-05-14T18:11:09Z", "message": "Merge branch 'dev' into iambmelt/docs-prompt-behavior"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDEyMDY1OTcx", "url": "https://github.com/AzureAD/microsoft-authentication-library-for-android/pull/1044#pullrequestreview-412065971", "createdAt": "2020-05-14T18:13:34Z", "commit": {"oid": "4bea3dd872aee20436916d03ddc8897f961c2aa0"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xNFQxODoxMzozNFrOGVolUg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xNFQxODoxMzozNFrOGVolUg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNTMzODE5NA==", "bodyText": "File a bug", "url": "https://github.com/AzureAD/microsoft-authentication-library-for-android/pull/1044#discussion_r425338194", "createdAt": "2020-05-14T18:13:34Z", "author": {"login": "iambmelt"}, "path": "docs/prompt_behavior.md", "diffHunk": "@@ -0,0 +1,16 @@\n+# Android Prompt & PromptBehavior\n+\n+| Product | Prompt            | Embedded Behavior                                                                                                                                                                                                                                          | (Embedded) OpenId Prompt Equivalent                                                              | Sent to Broker?      | Broker Behavior                                                                                                                                                                                                                                                                                                        | (Broker) OpenId Prompt Equivalent                         |\n+|---------|-------------------|------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|--------------------------------------------------------------------------------------------------|----------------------|------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|-----------------------------------------------------------|\n+| ADAL    | `null`            | Equivalent to `Auto`                                                                                                                                                                                                                                       | (unsent)                                                                                         | N/A                  | Equivalent to `Auto`                                                                                                                                                                                                                                                                                                   | (unsent)                                                  |\n+| ADAL    | `Auto`            | Silent request is first attempted. If unsuccessful, switch to interactive.                                                                                                                                                                                 | (unsent)                                                                                         | Yes                  | Broker attempts silent request first. If `claimsChallenge` is provided, broker will skip AT in cache and use RT to acquire new tokens. If silent request fails, call will go interactive.                                                                                                                              | (unsent)                                                  |\n+| ADAL    | `Always`          | The user will be prompted for credentials even if cached tokens already exist.                                                                                                                                                                             | `login`                                                                                          | Yes, augmented       | Broker attempts silent request first. If `claimsChallenge` is provided, broker will skip AT in cache and use RT to acquire new tokens. If silent request fails, call will go interactive.                                                                                                                              | (unsent)                                                  |\n+| ADAL    | `REFRESH_SESSION` | Interactively reauthorizes the user. If cookies are available in WebView, the user will not be prompted for credentials and the UI will dismiss automatically.                                                                                             | `refresh_session`                                                                                | Yes, but unsupported | Unsupported by V2 endpoint                                                                                                                                                                                                                                                                                             | (unsent)                                                  |\n+| ADAL    | `FORCE_PROMPT`    | If no broker is installed, behaves equivalent to `Always`. If broker _is_ installed, a prompt for credentials will be shown.                                                                                                                               | `login`                                                                                          | Yes                  | Equivalent to `Always` in embedded flow.                                                                                                                                                                                                                                                                               | `login`                                                   |\n+| MSAL    | `null`            | Equivalent to `WHEN_REQUIRED`                                                                                                                                                                                                                              | (unsent)                                                                                         | N/A                  | Broker attempts silent request first. If `claimsChallenge` is provided, broker will skip AT in cache and use RT to acquire new tokens. If silent request fails, call will go interactive.                                                                                                                              | (unsent)                                                  |\n+| MSAL    | `SELECT_ACCOUNT`  | If `login_hint` is supplied, behaves as `null`/`WHEN_REQUIRED`; otherwise, sends query param `prompt=select_account` to `/authorize` endpoint. Shows a list of accounts the user can choose from to authorize.                                             | If `login_hint` is supplied, unsent <br/> If no `login_hint` is supplied, sends `select_account` | Yes                  | If `login_hint` is supplied, behaves as `null`/`WHEN_REQUIRED`; otherwise, `AccountChooserActivity` is shown. Account picker inside of ESTS/WebView is _never_ shown, as the user would have already pre-selected an account via `AccountChooserActivity`. If user selects '`Add Account`', no `prompt=login` is sent. | (unsent - account selection via `AccountChooserActivity`) |\n+| MSAL    | `LOGIN`           | Sends query param `prompt=login` to `/authorize` endpoint. The user will _always_ be prompted for credentials by the service.                                                                                                                              | `login`                                                                                          | Yes                  | Same as embedded flow.                                                                                                                                                                                                                                                                                                 | `login`                                                   |\n+| MSAL    | `CONSENT`         | Sends query param `prompt=consent` to `/authorize` endpoint. The user will be prompted to grant consent, even if it was previously granted before. `// TODO what happens for pre-authz apps?`                                                              | `consent`                                                                                        | Yes                  | BUG: User is not shown prompt for consent. <br/>Expected: User shown consent page                                                                                                                                                                                                                                      | `consent`                                                 |\n+| MSAL    | `WHEN_REQUIRED`   | If `login_hint` is supplied, no `prompt` query parameter will be sent to the `/authorize` endpoint. The user _may_ be preompted to login or grant consent as required by the service/application. If no `login_hint` is supplied, `prompt=select_account`. | If `login_hint` is supplied, unsent <br/> If no `login_hint` is supplied, sends `select_account` | N/A                  | Same as embedded flow                                                                                                                                                                                                                                                                                                  | (unsent - account selection via `AccountChooserActivity`) |\n+\n+>Note: `CONSENT` not implemented inside of broker with MSAL", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "4bea3dd872aee20436916d03ddc8897f961c2aa0"}, "originalPosition": 16}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "aa77d4bd5f749b514b899c8f22d8954636932586", "author": {"user": {"login": "iambmelt", "name": "Brian Melton-Grace"}}, "url": "https://github.com/AzureAD/microsoft-authentication-library-for-android/commit/aa77d4bd5f749b514b899c8f22d8954636932586", "committedDate": "2020-05-14T18:33:09Z", "message": "Remove notes re: bugs (they have been filed, linked, and tracked)"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDEyMTgyNTA2", "url": "https://github.com/AzureAD/microsoft-authentication-library-for-android/pull/1044#pullrequestreview-412182506", "createdAt": "2020-05-14T21:03:16Z", "commit": {"oid": "aa77d4bd5f749b514b899c8f22d8954636932586"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xNFQyMTowMzoxNlrOGVuH2Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xNFQyMTowMzoxNlrOGVuH2Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNTQyODk1Mw==", "bodyText": "Got the update from PM team: PreAuthZ apps simply ignore this param", "url": "https://github.com/AzureAD/microsoft-authentication-library-for-android/pull/1044#discussion_r425428953", "createdAt": "2020-05-14T21:03:16Z", "author": {"login": "iambmelt"}, "path": "docs/prompt_behavior.md", "diffHunk": "@@ -0,0 +1,14 @@\n+# Android Prompt & PromptBehavior\n+\n+| Product | Prompt            | Embedded Behavior                                                                                                                                                                                                                                          | (Embedded) OpenId Prompt Equivalent                                                              | Sent to Broker?      | Broker Behavior                                                                                                                                                                                                                                                                                                        | (Broker) OpenId Prompt Equivalent                         |\n+|---------|-------------------|------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|--------------------------------------------------------------------------------------------------|----------------------|------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|-----------------------------------------------------------|\n+| ADAL    | `null`            | Equivalent to `Auto`                                                                                                                                                                                                                                       | (unsent)                                                                                         | N/A                  | Equivalent to `Auto`                                                                                                                                                                                                                                                                                                   | (unsent)                                                  |\n+| ADAL    | `Auto`            | Silent request is first attempted. If unsuccessful, switch to interactive.                                                                                                                                                                                 | (unsent)                                                                                         | Yes                  | Broker attempts silent request first. If `claimsChallenge` is provided, broker will skip AT in cache and use RT to acquire new tokens. If silent request fails, call will go interactive.                                                                                                                              | (unsent)                                                  |\n+| ADAL    | `Always`          | The user will be prompted for credentials even if cached tokens already exist.                                                                                                                                                                             | `login`                                                                                          | Yes, augmented       | Broker attempts silent request first. If `claimsChallenge` is provided, broker will skip AT in cache and use RT to acquire new tokens. If silent request fails, call will go interactive.                                                                                                                              | (unsent)                                                  |\n+| ADAL    | `REFRESH_SESSION` | Interactively reauthorizes the user. If cookies are available in WebView, the user will not be prompted for credentials and the UI will dismiss automatically.                                                                                             | `refresh_session`                                                                                | Yes, but unsupported | Unsupported by V2 endpoint                                                                                                                                                                                                                                                                                             | (unsent)                                                  |\n+| ADAL    | `FORCE_PROMPT`    | If no broker is installed, behaves equivalent to `Always`. If broker _is_ installed, a prompt for credentials will be shown.                                                                                                                               | `login`                                                                                          | Yes                  | Equivalent to `Always` in embedded flow.                                                                                                                                                                                                                                                                               | `login`                                                   |\n+| MSAL    | `null`            | Equivalent to `WHEN_REQUIRED`                                                                                                                                                                                                                              | (unsent)                                                                                         | N/A                  | Broker attempts silent request first. If `claimsChallenge` is provided, broker will skip AT in cache and use RT to acquire new tokens. If silent request fails, call will go interactive.                                                                                                                              | (unsent)                                                  |\n+| MSAL    | `SELECT_ACCOUNT`  | If `login_hint` is supplied, behaves as `null`/`WHEN_REQUIRED`; otherwise, sends query param `prompt=select_account` to `/authorize` endpoint. Shows a list of accounts the user can choose from to authorize.                                             | If `login_hint` is supplied, unsent <br/> If no `login_hint` is supplied, sends `select_account` | Yes                  | If `login_hint` is supplied, behaves as `null`/`WHEN_REQUIRED`; otherwise, `AccountChooserActivity` is shown. Account picker inside of ESTS/WebView is _never_ shown, as the user would have already pre-selected an account via `AccountChooserActivity`. If user selects '`Add Account`', no `prompt=login` is sent. | (unsent - account selection via `AccountChooserActivity`) |\n+| MSAL    | `LOGIN`           | Sends query param `prompt=login` to `/authorize` endpoint. The user will _always_ be prompted for credentials by the service.                                                                                                                              | `login`                                                                                          | Yes                  | Same as embedded flow.                                                                                                                                                                                                                                                                                                 | `login`                                                   |\n+| MSAL    | `CONSENT`         | Sends query param `prompt=consent` to `/authorize` endpoint. The user will be prompted to grant consent, even if it was previously granted before. `// TODO what happens for pre-authz apps?`                                                              | `consent`                                                                                        | Yes                  |  Sends query param `prompt=consent` to `/authorize` endpoint. The user will be prompted to grant consent, even if it was previously granted before.                                                                                                                                                                                                                                      | `consent`                                                 |", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "aa77d4bd5f749b514b899c8f22d8954636932586"}, "originalPosition": 13}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "d12237313c27dc75f4c3b5a863113b49bcdd09f4", "author": {"user": {"login": "iambmelt", "name": "Brian Melton-Grace"}}, "url": "https://github.com/AzureAD/microsoft-authentication-library-for-android/commit/d12237313c27dc75f4c3b5a863113b49bcdd09f4", "committedDate": "2020-05-14T21:04:21Z", "message": "Update prompt_behavior.md"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDEyODM3MzIw", "url": "https://github.com/AzureAD/microsoft-authentication-library-for-android/pull/1044#pullrequestreview-412837320", "createdAt": "2020-05-15T17:30:36Z", "commit": {"oid": "d12237313c27dc75f4c3b5a863113b49bcdd09f4"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDEyODkxNzIw", "url": "https://github.com/AzureAD/microsoft-authentication-library-for-android/pull/1044#pullrequestreview-412891720", "createdAt": "2020-05-15T18:55:52Z", "commit": {"oid": "d12237313c27dc75f4c3b5a863113b49bcdd09f4"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xNVQxODo1NTo1MlrOGWQWEw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xNVQxODo1NTo1MlrOGWQWEw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNTk4OTY1MQ==", "bodyText": "Probable typo: preompted -> prompted", "url": "https://github.com/AzureAD/microsoft-authentication-library-for-android/pull/1044#discussion_r425989651", "createdAt": "2020-05-15T18:55:52Z", "author": {"login": "MariusVolkhart"}, "path": "docs/prompt_behavior.md", "diffHunk": "@@ -0,0 +1,14 @@\n+# Android Prompt & PromptBehavior\n+\n+| Product | Prompt            | Embedded Behavior                                                                                                                                                                                                                                          | (Embedded) OpenId Prompt Equivalent                                                              | Sent to Broker?      | Broker Behavior                                                                                                                                                                                                                                                                                                        | (Broker) OpenId Prompt Equivalent                         |\n+|---------|-------------------|------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|--------------------------------------------------------------------------------------------------|----------------------|------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|-----------------------------------------------------------|\n+| ADAL    | `null`            | Equivalent to `Auto`                                                                                                                                                                                                                                       | (unsent)                                                                                         | N/A                  | Equivalent to `Auto`                                                                                                                                                                                                                                                                                                   | (unsent)                                                  |\n+| ADAL    | `Auto`            | Silent request is first attempted. If unsuccessful, switch to interactive.                                                                                                                                                                                 | (unsent)                                                                                         | Yes                  | Broker attempts silent request first. If `claimsChallenge` is provided, broker will skip AT in cache and use RT to acquire new tokens. If silent request fails, call will go interactive.                                                                                                                              | (unsent)                                                  |\n+| ADAL    | `Always`          | The user will be prompted for credentials even if cached tokens already exist.                                                                                                                                                                             | `login`                                                                                          | Yes, augmented       | Broker attempts silent request first. If `claimsChallenge` is provided, broker will skip AT in cache and use RT to acquire new tokens. If silent request fails, call will go interactive.                                                                                                                              | (unsent)                                                  |\n+| ADAL    | `REFRESH_SESSION` | Interactively reauthorizes the user. If cookies are available in WebView, the user will not be prompted for credentials and the UI will dismiss automatically.                                                                                             | `refresh_session`                                                                                | Yes, but unsupported | Unsupported by V2 endpoint                                                                                                                                                                                                                                                                                             | (unsent)                                                  |\n+| ADAL    | `FORCE_PROMPT`    | If no broker is installed, behaves equivalent to `Always`. If broker _is_ installed, a prompt for credentials will be shown.                                                                                                                               | `login`                                                                                          | Yes                  | Equivalent to `Always` in embedded flow.                                                                                                                                                                                                                                                                               | `login`                                                   |\n+| MSAL    | `null`            | Equivalent to `WHEN_REQUIRED`                                                                                                                                                                                                                              | (unsent)                                                                                         | N/A                  | Broker attempts silent request first. If `claimsChallenge` is provided, broker will skip AT in cache and use RT to acquire new tokens. If silent request fails, call will go interactive.                                                                                                                              | (unsent)                                                  |\n+| MSAL    | `SELECT_ACCOUNT`  | If `login_hint` is supplied, behaves as `null`/`WHEN_REQUIRED`; otherwise, sends query param `prompt=select_account` to `/authorize` endpoint. Shows a list of accounts the user can choose from to authorize.                                             | If `login_hint` is supplied, unsent <br/> If no `login_hint` is supplied, sends `select_account` | Yes                  | If `login_hint` is supplied, behaves as `null`/`WHEN_REQUIRED`; otherwise, `AccountChooserActivity` is shown. Account picker inside of ESTS/WebView is _never_ shown, as the user would have already pre-selected an account via `AccountChooserActivity`. If user selects '`Add Account`', no `prompt=login` is sent. | (unsent - account selection via `AccountChooserActivity`) |\n+| MSAL    | `LOGIN`           | Sends query param `prompt=login` to `/authorize` endpoint. The user will _always_ be prompted for credentials by the service.                                                                                                                              | `login`                                                                                          | Yes                  | Same as embedded flow.                                                                                                                                                                                                                                                                                                 | `login`                                                   |\n+| MSAL    | `CONSENT`         | Sends query param `prompt=consent` to `/authorize` endpoint. The user will be prompted to grant consent, even if it was previously granted before. This param will be ignored by 1P apps, as these apps are pre-consented via M365 TOC.                                                              | `consent`                                                                                        | Yes                  |  Sends query param `prompt=consent` to `/authorize` endpoint. The user will be prompted to grant consent, even if it was previously granted before.                                                                                                                                                                                                                                      | `consent`                                                 |\n+| MSAL    | `WHEN_REQUIRED`   | If `login_hint` is supplied, no `prompt` query parameter will be sent to the `/authorize` endpoint. The user _may_ be preompted to login or grant consent as required by the service/application. If no `login_hint` is supplied, `prompt=select_account`. | If `login_hint` is supplied, unsent <br/> If no `login_hint` is supplied, sends `select_account` | N/A                  | Same as embedded flow                                                                                                                                                                                                                                                                                                  | (unsent - account selection via `AccountChooserActivity`) |", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d12237313c27dc75f4c3b5a863113b49bcdd09f4"}, "originalPosition": 14}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "7c077ed43ce1e18448c640d159df28c248caeecf", "author": {"user": {"login": "iambmelt", "name": "Brian Melton-Grace"}}, "url": "https://github.com/AzureAD/microsoft-authentication-library-for-android/commit/7c077ed43ce1e18448c640d159df28c248caeecf", "committedDate": "2020-05-16T19:07:20Z", "message": "Fix spelling error"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "51fc3027655b031e082e63c5c3bffa806fea1a6b", "author": {"user": {"login": "iambmelt", "name": "Brian Melton-Grace"}}, "url": "https://github.com/AzureAD/microsoft-authentication-library-for-android/commit/51fc3027655b031e082e63c5c3bffa806fea1a6b", "committedDate": "2020-05-16T19:24:01Z", "message": "Merge branch 'dev' into iambmelt/docs-prompt-behavior"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1336, "cost": 1, "resetAt": "2021-11-01T11:59:11Z"}}}