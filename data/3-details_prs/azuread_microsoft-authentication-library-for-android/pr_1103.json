{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDU0Nzg4NTUz", "number": 1103, "title": "DCF API-Side PR (MSAL)", "bodyText": "First pull request in MSAL for DCF, consists of api-side code (PCA fully implemented) and testing classes. Complementary to (and should be merged after) PR on Common: AzureAD/microsoft-authentication-library-common-for-android#966.\nAdded deviceCodeFlow() to PublicClientApplication in Msal\nAdded getDeviceCodeFlowCommandCallback() to PublicClientApplication in Msal\nAdded DeviceCodeFlowCallback to IPublicClientApplication in Msal\nAdded createDeviceCodeFlowCommandParameters() to CommandParametersAdapter in Msal\nAdded DeviceCodeFlowPublicAPITest to Msal\nAdded 3 shadows for the command object to Msal\nAdded single_account_dcf_test_config.json to Msal\nAdded DCF methods to LocalMsalController and BrokerMsalController in Msal", "createdAt": "2020-07-21T22:58:49Z", "url": "https://github.com/AzureAD/microsoft-authentication-library-for-android/pull/1103", "merged": true, "mergeCommit": {"oid": "a81d44327c5f5f74c89fb0097e59f8aefa65224c"}, "closed": true, "closedAt": "2020-07-27T20:18:42Z", "author": {"login": "t-fadura"}, "timelineItems": {"totalCount": 63, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABc1BWCvgH2gAyNDU0Nzg4NTUzOjk3Mzg5MmM1MGVlMjIxZmQyZGYxMjU2YmJiZDcwYmU2MmE0ZTU2ZGU=", "endCursor": "Y3Vyc29yOnYyOpPPAAABc5HhQ3AH2gAyNDU0Nzg4NTUzOjIwNTBiMDU3YTM2MDk4NGY2ZDZhYjIwMTg5NzlmOGNiMGU4OGE1YTI=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "973892c50ee221fd2df1256bbbd70be62a4e56de", "author": {"user": {"login": "t-fadura", "name": "Fadi Durah"}}, "url": "https://github.com/AzureAD/microsoft-authentication-library-for-android/commit/973892c50ee221fd2df1256bbbd70be62a4e56de", "committedDate": "2020-07-15T02:38:03Z", "message": "Preparing API side of DCF protocol"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "dc2936e0a4b8f24e3b63ee571db64fc910f832bb", "author": {"user": {"login": "t-fadura", "name": "Fadi Durah"}}, "url": "https://github.com/AzureAD/microsoft-authentication-library-for-android/commit/dc2936e0a4b8f24e3b63ee571db64fc910f832bb", "committedDate": "2020-07-20T15:02:31Z", "message": "DCF API-side testing"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "2d588b52959359cf0a4e0593829b2adf492fcccf", "author": {"user": {"login": "t-fadura", "name": "Fadi Durah"}}, "url": "https://github.com/AzureAD/microsoft-authentication-library-for-android/commit/2d588b52959359cf0a4e0593829b2adf492fcccf", "committedDate": "2020-07-21T22:53:00Z", "message": "Many fixes reflecting newer Design doc, removed static field in Command"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDUyODg5Mzkz", "url": "https://github.com/AzureAD/microsoft-authentication-library-for-android/pull/1103#pullrequestreview-452889393", "createdAt": "2020-07-21T23:06:52Z", "commit": {"oid": "2d588b52959359cf0a4e0593829b2adf492fcccf"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yMVQyMzowNjo1MlrOG1M7Cw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yMVQyMzowNjo1MlrOG1M7Cw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1ODQzOTQzNQ==", "bodyText": "typo: change deviceto to device to", "url": "https://github.com/AzureAD/microsoft-authentication-library-for-android/pull/1103#discussion_r458439435", "createdAt": "2020-07-21T23:06:52Z", "author": {"login": "shahzaibj"}, "path": "msal/src/main/java/com/microsoft/identity/client/IPublicClientApplication.java", "diffHunk": "@@ -84,6 +85,19 @@ void acquireToken(@NonNull final Activity activity,\n     @WorkerThread\n     IAuthenticationResult acquireTokenSilent(@NonNull final AcquireTokenSilentParameters acquireTokenSilentParameters) throws InterruptedException, MsalException;\n \n+    /**\n+     * Perform the Device Code Flow (DCF) protocol to allow a deviceto authenticate and get a new access token without input capability.", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "2d588b52959359cf0a4e0593829b2adf492fcccf"}, "originalPosition": 13}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDUyODkwMDY4", "url": "https://github.com/AzureAD/microsoft-authentication-library-for-android/pull/1103#pullrequestreview-452890068", "createdAt": "2020-07-21T23:08:42Z", "commit": {"oid": "2d588b52959359cf0a4e0593829b2adf492fcccf"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yMVQyMzowODo0MlrOG1M9Tw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yMVQyMzowODo0MlrOG1M9Tw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1ODQ0MDAxNQ==", "bodyText": "We may not need to document all this here, and rather it would be better to document these in the javadoc for DeviceCodeFlowCallback class and over here a simple one line definition of a callback should suffice", "url": "https://github.com/AzureAD/microsoft-authentication-library-for-android/pull/1103#discussion_r458440015", "createdAt": "2020-07-21T23:08:42Z", "author": {"login": "shahzaibj"}, "path": "msal/src/main/java/com/microsoft/identity/client/IPublicClientApplication.java", "diffHunk": "@@ -84,6 +85,19 @@ void acquireToken(@NonNull final Activity activity,\n     @WorkerThread\n     IAuthenticationResult acquireTokenSilent(@NonNull final AcquireTokenSilentParameters acquireTokenSilentParameters) throws InterruptedException, MsalException;\n \n+    /**\n+     * Perform the Device Code Flow (DCF) protocol to allow a deviceto authenticate and get a new access token without input capability.\n+     * @param scopes\n+     * @param callback The {@link DeviceCodeFlowCallback} object to receive responses from the protocol.\n+     *                 1). Receiving authentication information (user_code, verification_uri, and instruction message)\n+     *                 via {@link DeviceCodeFlowCallback#getUserCode(String, String, String)}.\n+     *                 2). Receiving a successful authnetication result containing a fresh access token\n+     *                 via {@link DeviceCodeFlowCallback#getToken(AuthenticationResult)}.\n+     *                 3). Receiving an exception detailing what went wrong in the protocol\n+     *                 via {@link DeviceCodeFlowCallback#onError(MsalException)}.\n+     */", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "2d588b52959359cf0a4e0593829b2adf492fcccf"}, "originalPosition": 22}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDUyODkwNjQ5", "url": "https://github.com/AzureAD/microsoft-authentication-library-for-android/pull/1103#pullrequestreview-452890649", "createdAt": "2020-07-21T23:10:16Z", "commit": {"oid": "2d588b52959359cf0a4e0593829b2adf492fcccf"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yMVQyMzoxMDoxNlrOG1M_bg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yMVQyMzoxMDoxNlrOG1M_bg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1ODQ0MDU1OA==", "bodyText": "nit: rename dcfCallback to dcfCommandCallback or deviceCodeFlowCommandCallback", "url": "https://github.com/AzureAD/microsoft-authentication-library-for-android/pull/1103#discussion_r458440558", "createdAt": "2020-07-21T23:10:16Z", "author": {"login": "shahzaibj"}, "path": "msal/src/main/java/com/microsoft/identity/client/PublicClientApplication.java", "diffHunk": "@@ -1618,6 +1623,49 @@ public void onError(MsalException exception) {\n         }\n     }\n \n+    public void deviceCodeFlow(@Nullable String[] scopes, @NonNull final DeviceCodeFlowCallback callback) {\n+        // Create a DeviceCodeFlowCommandParameters object that takes in the desired scopes and the callback object\n+        // Use CommandParametersAdapter\n+        final DeviceCodeFlowCommandParameters commandParameters = CommandParametersAdapter\n+                    .createDeviceCodeFlowCommandParameters(\n+                            mPublicClientConfiguration,\n+                            mPublicClientConfiguration.getOAuth2TokenCache(),\n+                            scopes);\n+\n+        // Create a CommandCallback object from the DeviceCodeFlowCallback object\n+        final DeviceCodeFlowCommandCallback dcfCallback = getDeviceCodeFlowCommandCallback(callback);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "2d588b52959359cf0a4e0593829b2adf492fcccf"}, "originalPosition": 44}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDUyODkzMTA5", "url": "https://github.com/AzureAD/microsoft-authentication-library-for-android/pull/1103#pullrequestreview-452893109", "createdAt": "2020-07-21T23:17:07Z", "commit": {"oid": "2d588b52959359cf0a4e0593829b2adf492fcccf"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yMVQyMzoxNzowN1rOG1NH8A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yMVQyMzoxNzowN1rOG1NH8A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1ODQ0MjczNg==", "bodyText": "Looking at your design doc, I see you called out that (at least for now), Device Code Flow is only supported for Local Msal and NOT supported via the Broker. Over here I see the DeviceCodeFlowCommand consuming the Default Controller by calling getDefaultController - that's contradicting what's in the design doc. getDefaultController returns the BrokerMsalController if a broker is installed on the device.\nWhat is our plan in this case? Do we let flow go over to the broker and then throw some exception indicating that the DCF is not supported? Or wouldn't it be better for the DeviceCodeFlowCommand to just consume the LocalMsalController (even if a broker is present on the device) to always use the local MSAL flow for the DeviceCodeFlowCommand ?", "url": "https://github.com/AzureAD/microsoft-authentication-library-for-android/pull/1103#discussion_r458442736", "createdAt": "2020-07-21T23:17:07Z", "author": {"login": "shahzaibj"}, "path": "msal/src/main/java/com/microsoft/identity/client/PublicClientApplication.java", "diffHunk": "@@ -1618,6 +1623,49 @@ public void onError(MsalException exception) {\n         }\n     }\n \n+    public void deviceCodeFlow(@Nullable String[] scopes, @NonNull final DeviceCodeFlowCallback callback) {\n+        // Create a DeviceCodeFlowCommandParameters object that takes in the desired scopes and the callback object\n+        // Use CommandParametersAdapter\n+        final DeviceCodeFlowCommandParameters commandParameters = CommandParametersAdapter\n+                    .createDeviceCodeFlowCommandParameters(\n+                            mPublicClientConfiguration,\n+                            mPublicClientConfiguration.getOAuth2TokenCache(),\n+                            scopes);\n+\n+        // Create a CommandCallback object from the DeviceCodeFlowCallback object\n+        final DeviceCodeFlowCommandCallback dcfCallback = getDeviceCodeFlowCommandCallback(callback);\n+\n+        // Attempt protocol\n+        try {\n+            // Create a DeviceCodeFlowCommand object\n+            // Pass the command parameters, default controller, and command callback\n+            // Telemetry with DEVICE_CODE_FLOW_CALLBACK\n+            final DeviceCodeFlowCommand deviceCodeFlowCommand = new DeviceCodeFlowCommand(\n+                    commandParameters,\n+                    MSALControllerFactory.getDefaultController(", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "2d588b52959359cf0a4e0593829b2adf492fcccf"}, "originalPosition": 53}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDUyODk0Mjgw", "url": "https://github.com/AzureAD/microsoft-authentication-library-for-android/pull/1103#pullrequestreview-452894280", "createdAt": "2020-07-21T23:20:20Z", "commit": {"oid": "2d588b52959359cf0a4e0593829b2adf492fcccf"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yMVQyMzoyMDoyMFrOG1NMAw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yMVQyMzoyMDoyMFrOG1NMAw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1ODQ0Mzc3OQ==", "bodyText": "What Authentication Schemes are actually supported over DCF?", "url": "https://github.com/AzureAD/microsoft-authentication-library-for-android/pull/1103#discussion_r458443779", "createdAt": "2020-07-21T23:20:20Z", "author": {"login": "shahzaibj"}, "path": "msal/src/main/java/com/microsoft/identity/client/internal/CommandParametersAdapter.java", "diffHunk": "@@ -193,6 +194,36 @@ public static SilentTokenCommandParameters createSilentTokenCommandParameters(\n         return commandParameters;\n     }\n \n+    public static DeviceCodeFlowCommandParameters createDeviceCodeFlowCommandParameters(\n+            @NonNull final PublicClientApplicationConfiguration configuration,\n+            @NonNull final OAuth2TokenCache tokenCache,\n+            @NonNull String[] scopes){\n+\n+        final AbstractAuthenticationScheme authenticationScheme = AuthenticationSchemeFactory.createScheme(\n+                configuration.getAppContext(),\n+                null", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "2d588b52959359cf0a4e0593829b2adf492fcccf"}, "originalPosition": 19}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDUyODk0ODAz", "url": "https://github.com/AzureAD/microsoft-authentication-library-for-android/pull/1103#pullrequestreview-452894803", "createdAt": "2020-07-21T23:21:58Z", "commit": {"oid": "2d588b52959359cf0a4e0593829b2adf492fcccf"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yMVQyMzoyMTo1OFrOG1NN7A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yMVQyMzoyMTo1OFrOG1NN7A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1ODQ0NDI2OA==", "bodyText": "Would be good to have an empty line above this", "url": "https://github.com/AzureAD/microsoft-authentication-library-for-android/pull/1103#discussion_r458444268", "createdAt": "2020-07-21T23:21:58Z", "author": {"login": "shahzaibj"}, "path": "msal/src/test/java/com/microsoft/identity/client/e2e/shadows/ShadowDeviceCodeFlowCommandSuccessful.java", "diffHunk": "@@ -0,0 +1,80 @@\n+// Copyright (c) Microsoft Corporation.\n+// All rights reserved.\n+//\n+// This code is licensed under the MIT License.\n+//\n+// Permission is hereby granted, free of charge, to any person obtaining a copy\n+// of this software and associated documentation files(the \"Software\"), to deal\n+// in the Software without restriction, including without limitation the rights\n+// to use, copy, modify, merge, publish, distribute, sublicense, and / or sell\n+// copies of the Software, and to permit persons to whom the Software is\n+// furnished to do so, subject to the following conditions :\n+//\n+// The above copyright notice and this permission notice shall be included in\n+// all copies or substantial portions of the Software.\n+//\n+// THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n+// IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n+// FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n+// AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n+// LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n+// OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\n+// THE SOFTWARE.\n+package com.microsoft.identity.client.e2e.shadows;\n+\n+import com.microsoft.identity.common.internal.cache.CacheRecord;\n+import com.microsoft.identity.common.internal.cache.ICacheRecord;\n+import com.microsoft.identity.common.internal.commands.DeviceCodeFlowCommand;\n+import com.microsoft.identity.common.internal.commands.DeviceCodeFlowCommandCallback;\n+import com.microsoft.identity.common.internal.dto.AccountRecord;\n+import com.microsoft.identity.common.internal.request.SdkType;\n+import com.microsoft.identity.common.internal.result.AcquireTokenResult;\n+import com.microsoft.identity.common.internal.result.ILocalAuthenticationResult;\n+import com.microsoft.identity.common.internal.result.LocalAuthenticationResult;\n+\n+import org.robolectric.annotation.Implementation;\n+import org.robolectric.annotation.Implements;\n+import org.robolectric.annotation.RealObject;\n+\n+import java.util.ArrayList;\n+import java.util.List;\n+\n+/**\n+ * Shadow class that simulates Device Code Flow successfully returning an acquire token result object.\n+ */\n+@Implements(DeviceCodeFlowCommand.class)\n+public class ShadowDeviceCodeFlowCommandSuccessful {\n+    @RealObject", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "2d588b52959359cf0a4e0593829b2adf492fcccf"}, "originalPosition": 47}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDUyODk0OTc3", "url": "https://github.com/AzureAD/microsoft-authentication-library-for-android/pull/1103#pullrequestreview-452894977", "createdAt": "2020-07-21T23:22:32Z", "commit": {"oid": "2d588b52959359cf0a4e0593829b2adf492fcccf"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yMVQyMzoyMjozMlrOG1NOig==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yMVQyMzoyMjozMlrOG1NOig==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1ODQ0NDQyNg==", "bodyText": "nit: add final here and everywhere as applicable", "url": "https://github.com/AzureAD/microsoft-authentication-library-for-android/pull/1103#discussion_r458444426", "createdAt": "2020-07-21T23:22:32Z", "author": {"login": "shahzaibj"}, "path": "msal/src/test/java/com/microsoft/identity/client/e2e/shadows/ShadowDeviceCodeFlowCommandSuccessful.java", "diffHunk": "@@ -0,0 +1,80 @@\n+// Copyright (c) Microsoft Corporation.\n+// All rights reserved.\n+//\n+// This code is licensed under the MIT License.\n+//\n+// Permission is hereby granted, free of charge, to any person obtaining a copy\n+// of this software and associated documentation files(the \"Software\"), to deal\n+// in the Software without restriction, including without limitation the rights\n+// to use, copy, modify, merge, publish, distribute, sublicense, and / or sell\n+// copies of the Software, and to permit persons to whom the Software is\n+// furnished to do so, subject to the following conditions :\n+//\n+// The above copyright notice and this permission notice shall be included in\n+// all copies or substantial portions of the Software.\n+//\n+// THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n+// IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n+// FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n+// AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n+// LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n+// OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\n+// THE SOFTWARE.\n+package com.microsoft.identity.client.e2e.shadows;\n+\n+import com.microsoft.identity.common.internal.cache.CacheRecord;\n+import com.microsoft.identity.common.internal.cache.ICacheRecord;\n+import com.microsoft.identity.common.internal.commands.DeviceCodeFlowCommand;\n+import com.microsoft.identity.common.internal.commands.DeviceCodeFlowCommandCallback;\n+import com.microsoft.identity.common.internal.dto.AccountRecord;\n+import com.microsoft.identity.common.internal.request.SdkType;\n+import com.microsoft.identity.common.internal.result.AcquireTokenResult;\n+import com.microsoft.identity.common.internal.result.ILocalAuthenticationResult;\n+import com.microsoft.identity.common.internal.result.LocalAuthenticationResult;\n+\n+import org.robolectric.annotation.Implementation;\n+import org.robolectric.annotation.Implements;\n+import org.robolectric.annotation.RealObject;\n+\n+import java.util.ArrayList;\n+import java.util.List;\n+\n+/**\n+ * Shadow class that simulates Device Code Flow successfully returning an acquire token result object.\n+ */\n+@Implements(DeviceCodeFlowCommand.class)\n+public class ShadowDeviceCodeFlowCommandSuccessful {\n+    @RealObject\n+    private DeviceCodeFlowCommand mDeviceCodeFlowCommand;\n+\n+    @Implementation\n+    public AcquireTokenResult execute() {\n+        DeviceCodeFlowCommandCallback callback = (DeviceCodeFlowCommandCallback) mDeviceCodeFlowCommand.getCallback();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "2d588b52959359cf0a4e0593829b2adf492fcccf"}, "originalPosition": 52}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDUyODk1MTE5", "url": "https://github.com/AzureAD/microsoft-authentication-library-for-android/pull/1103#pullrequestreview-452895119", "createdAt": "2020-07-21T23:23:01Z", "commit": {"oid": "2d588b52959359cf0a4e0593829b2adf492fcccf"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yMVQyMzoyMzowMVrOG1NO_Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yMVQyMzoyMzowMVrOG1NO_Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1ODQ0NDU0MQ==", "bodyText": "nit: rename to localAuthResult or localAuthenticationResult", "url": "https://github.com/AzureAD/microsoft-authentication-library-for-android/pull/1103#discussion_r458444541", "createdAt": "2020-07-21T23:23:01Z", "author": {"login": "shahzaibj"}, "path": "msal/src/test/java/com/microsoft/identity/client/e2e/shadows/ShadowDeviceCodeFlowCommandSuccessful.java", "diffHunk": "@@ -0,0 +1,80 @@\n+// Copyright (c) Microsoft Corporation.\n+// All rights reserved.\n+//\n+// This code is licensed under the MIT License.\n+//\n+// Permission is hereby granted, free of charge, to any person obtaining a copy\n+// of this software and associated documentation files(the \"Software\"), to deal\n+// in the Software without restriction, including without limitation the rights\n+// to use, copy, modify, merge, publish, distribute, sublicense, and / or sell\n+// copies of the Software, and to permit persons to whom the Software is\n+// furnished to do so, subject to the following conditions :\n+//\n+// The above copyright notice and this permission notice shall be included in\n+// all copies or substantial portions of the Software.\n+//\n+// THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n+// IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n+// FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n+// AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n+// LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n+// OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\n+// THE SOFTWARE.\n+package com.microsoft.identity.client.e2e.shadows;\n+\n+import com.microsoft.identity.common.internal.cache.CacheRecord;\n+import com.microsoft.identity.common.internal.cache.ICacheRecord;\n+import com.microsoft.identity.common.internal.commands.DeviceCodeFlowCommand;\n+import com.microsoft.identity.common.internal.commands.DeviceCodeFlowCommandCallback;\n+import com.microsoft.identity.common.internal.dto.AccountRecord;\n+import com.microsoft.identity.common.internal.request.SdkType;\n+import com.microsoft.identity.common.internal.result.AcquireTokenResult;\n+import com.microsoft.identity.common.internal.result.ILocalAuthenticationResult;\n+import com.microsoft.identity.common.internal.result.LocalAuthenticationResult;\n+\n+import org.robolectric.annotation.Implementation;\n+import org.robolectric.annotation.Implements;\n+import org.robolectric.annotation.RealObject;\n+\n+import java.util.ArrayList;\n+import java.util.List;\n+\n+/**\n+ * Shadow class that simulates Device Code Flow successfully returning an acquire token result object.\n+ */\n+@Implements(DeviceCodeFlowCommand.class)\n+public class ShadowDeviceCodeFlowCommandSuccessful {\n+    @RealObject\n+    private DeviceCodeFlowCommand mDeviceCodeFlowCommand;\n+\n+    @Implementation\n+    public AcquireTokenResult execute() {\n+        DeviceCodeFlowCommandCallback callback = (DeviceCodeFlowCommandCallback) mDeviceCodeFlowCommand.getCallback();\n+        callback.getUserCode(\n+                \"https://login.microsoftonline.com/common/oauth2/deviceauth\",\n+                \"ABCDEFGH\",\n+                \"Follow these instructions to authenticate.\");\n+\n+        // Create parameters for dummy authentication result\n+        CacheRecord cRecord = new CacheRecord();\n+        cRecord.setAccount(new AccountRecord());\n+        cRecord.getAccount().setHomeAccountId(\"abcd\");\n+        cRecord.getAccount().setLocalAccountId(\"abcd\");\n+        List<ICacheRecord> list = new ArrayList<>();\n+        list.add(cRecord);\n+\n+        // Create dummy authentication result\n+        ILocalAuthenticationResult localAuth = new LocalAuthenticationResult(", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "2d588b52959359cf0a4e0593829b2adf492fcccf"}, "originalPosition": 67}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDUyODk1MjMy", "url": "https://github.com/AzureAD/microsoft-authentication-library-for-android/pull/1103#pullrequestreview-452895232", "createdAt": "2020-07-21T23:23:23Z", "commit": {"oid": "2d588b52959359cf0a4e0593829b2adf492fcccf"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yMVQyMzoyMzoyM1rOG1NPbg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yMVQyMzoyMzoyM1rOG1NPbg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1ODQ0NDY1NA==", "bodyText": "nit: rename to tokenResult or acquireTokenResult", "url": "https://github.com/AzureAD/microsoft-authentication-library-for-android/pull/1103#discussion_r458444654", "createdAt": "2020-07-21T23:23:23Z", "author": {"login": "shahzaibj"}, "path": "msal/src/test/java/com/microsoft/identity/client/e2e/shadows/ShadowDeviceCodeFlowCommandSuccessful.java", "diffHunk": "@@ -0,0 +1,80 @@\n+// Copyright (c) Microsoft Corporation.\n+// All rights reserved.\n+//\n+// This code is licensed under the MIT License.\n+//\n+// Permission is hereby granted, free of charge, to any person obtaining a copy\n+// of this software and associated documentation files(the \"Software\"), to deal\n+// in the Software without restriction, including without limitation the rights\n+// to use, copy, modify, merge, publish, distribute, sublicense, and / or sell\n+// copies of the Software, and to permit persons to whom the Software is\n+// furnished to do so, subject to the following conditions :\n+//\n+// The above copyright notice and this permission notice shall be included in\n+// all copies or substantial portions of the Software.\n+//\n+// THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n+// IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n+// FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n+// AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n+// LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n+// OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\n+// THE SOFTWARE.\n+package com.microsoft.identity.client.e2e.shadows;\n+\n+import com.microsoft.identity.common.internal.cache.CacheRecord;\n+import com.microsoft.identity.common.internal.cache.ICacheRecord;\n+import com.microsoft.identity.common.internal.commands.DeviceCodeFlowCommand;\n+import com.microsoft.identity.common.internal.commands.DeviceCodeFlowCommandCallback;\n+import com.microsoft.identity.common.internal.dto.AccountRecord;\n+import com.microsoft.identity.common.internal.request.SdkType;\n+import com.microsoft.identity.common.internal.result.AcquireTokenResult;\n+import com.microsoft.identity.common.internal.result.ILocalAuthenticationResult;\n+import com.microsoft.identity.common.internal.result.LocalAuthenticationResult;\n+\n+import org.robolectric.annotation.Implementation;\n+import org.robolectric.annotation.Implements;\n+import org.robolectric.annotation.RealObject;\n+\n+import java.util.ArrayList;\n+import java.util.List;\n+\n+/**\n+ * Shadow class that simulates Device Code Flow successfully returning an acquire token result object.\n+ */\n+@Implements(DeviceCodeFlowCommand.class)\n+public class ShadowDeviceCodeFlowCommandSuccessful {\n+    @RealObject\n+    private DeviceCodeFlowCommand mDeviceCodeFlowCommand;\n+\n+    @Implementation\n+    public AcquireTokenResult execute() {\n+        DeviceCodeFlowCommandCallback callback = (DeviceCodeFlowCommandCallback) mDeviceCodeFlowCommand.getCallback();\n+        callback.getUserCode(\n+                \"https://login.microsoftonline.com/common/oauth2/deviceauth\",\n+                \"ABCDEFGH\",\n+                \"Follow these instructions to authenticate.\");\n+\n+        // Create parameters for dummy authentication result\n+        CacheRecord cRecord = new CacheRecord();\n+        cRecord.setAccount(new AccountRecord());\n+        cRecord.getAccount().setHomeAccountId(\"abcd\");\n+        cRecord.getAccount().setLocalAccountId(\"abcd\");\n+        List<ICacheRecord> list = new ArrayList<>();\n+        list.add(cRecord);\n+\n+        // Create dummy authentication result\n+        ILocalAuthenticationResult localAuth = new LocalAuthenticationResult(\n+                cRecord,\n+                list,\n+                SdkType.MSAL,\n+                false\n+        );\n+\n+        // Create dummy token result\n+        AcquireTokenResult acqResult = new AcquireTokenResult();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "2d588b52959359cf0a4e0593829b2adf492fcccf"}, "originalPosition": 75}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDUyODk1MzIy", "url": "https://github.com/AzureAD/microsoft-authentication-library-for-android/pull/1103#pullrequestreview-452895322", "createdAt": "2020-07-21T23:23:40Z", "commit": {"oid": "2d588b52959359cf0a4e0593829b2adf492fcccf"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yMVQyMzoyMzo0MFrOG1NPwA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yMVQyMzoyMzo0MFrOG1NPwA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1ODQ0NDczNg==", "bodyText": "nit: rename to cacheRecord", "url": "https://github.com/AzureAD/microsoft-authentication-library-for-android/pull/1103#discussion_r458444736", "createdAt": "2020-07-21T23:23:40Z", "author": {"login": "shahzaibj"}, "path": "msal/src/test/java/com/microsoft/identity/client/e2e/shadows/ShadowDeviceCodeFlowCommandSuccessful.java", "diffHunk": "@@ -0,0 +1,80 @@\n+// Copyright (c) Microsoft Corporation.\n+// All rights reserved.\n+//\n+// This code is licensed under the MIT License.\n+//\n+// Permission is hereby granted, free of charge, to any person obtaining a copy\n+// of this software and associated documentation files(the \"Software\"), to deal\n+// in the Software without restriction, including without limitation the rights\n+// to use, copy, modify, merge, publish, distribute, sublicense, and / or sell\n+// copies of the Software, and to permit persons to whom the Software is\n+// furnished to do so, subject to the following conditions :\n+//\n+// The above copyright notice and this permission notice shall be included in\n+// all copies or substantial portions of the Software.\n+//\n+// THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n+// IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n+// FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n+// AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n+// LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n+// OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\n+// THE SOFTWARE.\n+package com.microsoft.identity.client.e2e.shadows;\n+\n+import com.microsoft.identity.common.internal.cache.CacheRecord;\n+import com.microsoft.identity.common.internal.cache.ICacheRecord;\n+import com.microsoft.identity.common.internal.commands.DeviceCodeFlowCommand;\n+import com.microsoft.identity.common.internal.commands.DeviceCodeFlowCommandCallback;\n+import com.microsoft.identity.common.internal.dto.AccountRecord;\n+import com.microsoft.identity.common.internal.request.SdkType;\n+import com.microsoft.identity.common.internal.result.AcquireTokenResult;\n+import com.microsoft.identity.common.internal.result.ILocalAuthenticationResult;\n+import com.microsoft.identity.common.internal.result.LocalAuthenticationResult;\n+\n+import org.robolectric.annotation.Implementation;\n+import org.robolectric.annotation.Implements;\n+import org.robolectric.annotation.RealObject;\n+\n+import java.util.ArrayList;\n+import java.util.List;\n+\n+/**\n+ * Shadow class that simulates Device Code Flow successfully returning an acquire token result object.\n+ */\n+@Implements(DeviceCodeFlowCommand.class)\n+public class ShadowDeviceCodeFlowCommandSuccessful {\n+    @RealObject\n+    private DeviceCodeFlowCommand mDeviceCodeFlowCommand;\n+\n+    @Implementation\n+    public AcquireTokenResult execute() {\n+        DeviceCodeFlowCommandCallback callback = (DeviceCodeFlowCommandCallback) mDeviceCodeFlowCommand.getCallback();\n+        callback.getUserCode(\n+                \"https://login.microsoftonline.com/common/oauth2/deviceauth\",\n+                \"ABCDEFGH\",\n+                \"Follow these instructions to authenticate.\");\n+\n+        // Create parameters for dummy authentication result\n+        CacheRecord cRecord = new CacheRecord();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "2d588b52959359cf0a4e0593829b2adf492fcccf"}, "originalPosition": 59}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDUyODk1NDI1", "url": "https://github.com/AzureAD/microsoft-authentication-library-for-android/pull/1103#pullrequestreview-452895425", "createdAt": "2020-07-21T23:23:58Z", "commit": {"oid": "2d588b52959359cf0a4e0593829b2adf492fcccf"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yMVQyMzoyMzo1OFrOG1NQFA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yMVQyMzoyMzo1OFrOG1NQFA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1ODQ0NDgyMA==", "bodyText": "nit: rename to cacheRecordList", "url": "https://github.com/AzureAD/microsoft-authentication-library-for-android/pull/1103#discussion_r458444820", "createdAt": "2020-07-21T23:23:58Z", "author": {"login": "shahzaibj"}, "path": "msal/src/test/java/com/microsoft/identity/client/e2e/shadows/ShadowDeviceCodeFlowCommandSuccessful.java", "diffHunk": "@@ -0,0 +1,80 @@\n+// Copyright (c) Microsoft Corporation.\n+// All rights reserved.\n+//\n+// This code is licensed under the MIT License.\n+//\n+// Permission is hereby granted, free of charge, to any person obtaining a copy\n+// of this software and associated documentation files(the \"Software\"), to deal\n+// in the Software without restriction, including without limitation the rights\n+// to use, copy, modify, merge, publish, distribute, sublicense, and / or sell\n+// copies of the Software, and to permit persons to whom the Software is\n+// furnished to do so, subject to the following conditions :\n+//\n+// The above copyright notice and this permission notice shall be included in\n+// all copies or substantial portions of the Software.\n+//\n+// THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n+// IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n+// FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n+// AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n+// LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n+// OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\n+// THE SOFTWARE.\n+package com.microsoft.identity.client.e2e.shadows;\n+\n+import com.microsoft.identity.common.internal.cache.CacheRecord;\n+import com.microsoft.identity.common.internal.cache.ICacheRecord;\n+import com.microsoft.identity.common.internal.commands.DeviceCodeFlowCommand;\n+import com.microsoft.identity.common.internal.commands.DeviceCodeFlowCommandCallback;\n+import com.microsoft.identity.common.internal.dto.AccountRecord;\n+import com.microsoft.identity.common.internal.request.SdkType;\n+import com.microsoft.identity.common.internal.result.AcquireTokenResult;\n+import com.microsoft.identity.common.internal.result.ILocalAuthenticationResult;\n+import com.microsoft.identity.common.internal.result.LocalAuthenticationResult;\n+\n+import org.robolectric.annotation.Implementation;\n+import org.robolectric.annotation.Implements;\n+import org.robolectric.annotation.RealObject;\n+\n+import java.util.ArrayList;\n+import java.util.List;\n+\n+/**\n+ * Shadow class that simulates Device Code Flow successfully returning an acquire token result object.\n+ */\n+@Implements(DeviceCodeFlowCommand.class)\n+public class ShadowDeviceCodeFlowCommandSuccessful {\n+    @RealObject\n+    private DeviceCodeFlowCommand mDeviceCodeFlowCommand;\n+\n+    @Implementation\n+    public AcquireTokenResult execute() {\n+        DeviceCodeFlowCommandCallback callback = (DeviceCodeFlowCommandCallback) mDeviceCodeFlowCommand.getCallback();\n+        callback.getUserCode(\n+                \"https://login.microsoftonline.com/common/oauth2/deviceauth\",\n+                \"ABCDEFGH\",\n+                \"Follow these instructions to authenticate.\");\n+\n+        // Create parameters for dummy authentication result\n+        CacheRecord cRecord = new CacheRecord();\n+        cRecord.setAccount(new AccountRecord());\n+        cRecord.getAccount().setHomeAccountId(\"abcd\");\n+        cRecord.getAccount().setLocalAccountId(\"abcd\");\n+        List<ICacheRecord> list = new ArrayList<>();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "2d588b52959359cf0a4e0593829b2adf492fcccf"}, "originalPosition": 63}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDUyODk1NTc2", "url": "https://github.com/AzureAD/microsoft-authentication-library-for-android/pull/1103#pullrequestreview-452895576", "createdAt": "2020-07-21T23:24:21Z", "commit": {"oid": "2d588b52959359cf0a4e0593829b2adf492fcccf"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yMVQyMzoyNDoyMVrOG1NQlQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yMVQyMzoyNDoyMVrOG1NQlQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1ODQ0NDk0OQ==", "bodyText": "nit: final here and everywhere as needed", "url": "https://github.com/AzureAD/microsoft-authentication-library-for-android/pull/1103#discussion_r458444949", "createdAt": "2020-07-21T23:24:21Z", "author": {"login": "shahzaibj"}, "path": "msal/src/test/java/com/microsoft/identity/client/e2e/shadows/ShadowDeviceCodeFlowCommandTokenError.java", "diffHunk": "@@ -0,0 +1,50 @@\n+// Copyright (c) Microsoft Corporation.\n+// All rights reserved.\n+//\n+// This code is licensed under the MIT License.\n+//\n+// Permission is hereby granted, free of charge, to any person obtaining a copy\n+// of this software and associated documentation files(the \"Software\"), to deal\n+// in the Software without restriction, including without limitation the rights\n+// to use, copy, modify, merge, publish, distribute, sublicense, and / or sell\n+// copies of the Software, and to permit persons to whom the Software is\n+// furnished to do so, subject to the following conditions :\n+//\n+// The above copyright notice and this permission notice shall be included in\n+// all copies or substantial portions of the Software.\n+//\n+// THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n+// IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n+// FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n+// AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n+// LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n+// OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\n+// THE SOFTWARE.\n+package com.microsoft.identity.client.e2e.shadows;\n+\n+import com.microsoft.identity.client.exception.MsalServiceException;\n+import com.microsoft.identity.common.internal.commands.DeviceCodeFlowCommand;\n+import com.microsoft.identity.common.internal.commands.DeviceCodeFlowCommandCallback;\n+import com.microsoft.identity.common.internal.result.AcquireTokenResult;\n+\n+import org.robolectric.annotation.Implements;\n+import org.robolectric.annotation.RealObject;\n+\n+/**\n+ * Shadow class that simulates Device Code Flow failing due to an error in the token polling phase.\n+ */\n+@Implements(DeviceCodeFlowCommand.class)\n+public class ShadowDeviceCodeFlowCommandTokenError {\n+    @RealObject\n+    private DeviceCodeFlowCommand mDeviceCodeFlowCommand;\n+\n+    public AcquireTokenResult execute() throws Exception {\n+        DeviceCodeFlowCommandCallback callback = (DeviceCodeFlowCommandCallback) mDeviceCodeFlowCommand.getCallback();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "2d588b52959359cf0a4e0593829b2adf492fcccf"}, "originalPosition": 42}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDUyODk1ODkz", "url": "https://github.com/AzureAD/microsoft-authentication-library-for-android/pull/1103#pullrequestreview-452895893", "createdAt": "2020-07-21T23:25:13Z", "commit": {"oid": "2d588b52959359cf0a4e0593829b2adf492fcccf"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yMVQyMzoyNToxM1rOG1NR0A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yMVQyMzoyNToxM1rOG1NR0A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1ODQ0NTI2NA==", "bodyText": "userCode?", "url": "https://github.com/AzureAD/microsoft-authentication-library-for-android/pull/1103#discussion_r458445264", "createdAt": "2020-07-21T23:25:13Z", "author": {"login": "shahzaibj"}, "path": "msal/src/test/java/com/microsoft/identity/client/e2e/tests/mocked/DeviceCodeFlowAPITest.java", "diffHunk": "@@ -0,0 +1,154 @@\n+// Copyright (c) Microsoft Corporation.\n+// All rights reserved.\n+//\n+// This code is licensed under the MIT License.\n+//\n+// Permission is hereby granted, free of charge, to any person obtaining a copy\n+// of this software and associated documentation files(the \"Software\"), to deal\n+// in the Software without restriction, including without limitation the rights\n+// to use, copy, modify, merge, publish, distribute, sublicense, and / or sell\n+// copies of the Software, and to permit persons to whom the Software is\n+// furnished to do so, subject to the following conditions :\n+//\n+// The above copyright notice and this permission notice shall be included in\n+// all copies or substantial portions of the Software.\n+//\n+// THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n+// IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n+// FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n+// AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n+// LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n+// OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\n+// THE SOFTWARE.\n+package com.microsoft.identity.client.e2e.tests.mocked;\n+\n+import androidx.annotation.NonNull;\n+\n+import com.microsoft.identity.client.AuthenticationResult;\n+import com.microsoft.identity.client.IPublicClientApplication;\n+import com.microsoft.identity.client.e2e.shadows.ShadowDeviceCodeFlowCommandAuthError;\n+import com.microsoft.identity.client.e2e.shadows.ShadowDeviceCodeFlowCommandSuccessful;\n+import com.microsoft.identity.client.e2e.shadows.ShadowDeviceCodeFlowCommandTokenError;\n+import com.microsoft.identity.client.e2e.shadows.ShadowHttpRequestForMockedTest;\n+import com.microsoft.identity.client.e2e.shadows.ShadowMsalUtils;\n+import com.microsoft.identity.client.e2e.tests.PublicClientApplicationAbstractTest;\n+import com.microsoft.identity.client.e2e.utils.RoboTestUtils;\n+import com.microsoft.identity.client.exception.MsalException;\n+\n+import org.junit.Assert;\n+import org.junit.Before;\n+import org.junit.Test;\n+import org.junit.runner.RunWith;\n+import org.robolectric.RobolectricTestRunner;\n+import org.robolectric.annotation.Config;\n+\n+import static com.microsoft.identity.internal.testutils.TestConstants.Configurations.SINGLE_ACCOUNT_DCF_TEST_CONFIG_FILE_PATH;\n+\n+/**\n+ * Testing class for the device code flow protocol. Currently only supporting testing for the API-side\n+ * of the protocol. Will be extended to test individual aspects of the flow.\n+ */\n+@RunWith(RobolectricTestRunner.class)\n+@Config(shadows = {ShadowMsalUtils.class, ShadowHttpRequestForMockedTest.class})\n+public class DeviceCodeFlowAPITest extends PublicClientApplicationAbstractTest {\n+\n+    private static Boolean uCode;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "2d588b52959359cf0a4e0593829b2adf492fcccf"}, "originalPosition": 55}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDUyODk2MDc0", "url": "https://github.com/AzureAD/microsoft-authentication-library-for-android/pull/1103#pullrequestreview-452896074", "createdAt": "2020-07-21T23:25:44Z", "commit": {"oid": "2d588b52959359cf0a4e0593829b2adf492fcccf"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yMVQyMzoyNTo0NVrOG1NShg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yMVQyMzoyNTo0NVrOG1NShg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1ODQ0NTQ0Ng==", "bodyText": "nit: rename user_code to userCode", "url": "https://github.com/AzureAD/microsoft-authentication-library-for-android/pull/1103#discussion_r458445446", "createdAt": "2020-07-21T23:25:45Z", "author": {"login": "shahzaibj"}, "path": "msal/src/test/java/com/microsoft/identity/client/e2e/tests/mocked/DeviceCodeFlowAPITest.java", "diffHunk": "@@ -0,0 +1,154 @@\n+// Copyright (c) Microsoft Corporation.\n+// All rights reserved.\n+//\n+// This code is licensed under the MIT License.\n+//\n+// Permission is hereby granted, free of charge, to any person obtaining a copy\n+// of this software and associated documentation files(the \"Software\"), to deal\n+// in the Software without restriction, including without limitation the rights\n+// to use, copy, modify, merge, publish, distribute, sublicense, and / or sell\n+// copies of the Software, and to permit persons to whom the Software is\n+// furnished to do so, subject to the following conditions :\n+//\n+// The above copyright notice and this permission notice shall be included in\n+// all copies or substantial portions of the Software.\n+//\n+// THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n+// IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n+// FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n+// AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n+// LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n+// OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\n+// THE SOFTWARE.\n+package com.microsoft.identity.client.e2e.tests.mocked;\n+\n+import androidx.annotation.NonNull;\n+\n+import com.microsoft.identity.client.AuthenticationResult;\n+import com.microsoft.identity.client.IPublicClientApplication;\n+import com.microsoft.identity.client.e2e.shadows.ShadowDeviceCodeFlowCommandAuthError;\n+import com.microsoft.identity.client.e2e.shadows.ShadowDeviceCodeFlowCommandSuccessful;\n+import com.microsoft.identity.client.e2e.shadows.ShadowDeviceCodeFlowCommandTokenError;\n+import com.microsoft.identity.client.e2e.shadows.ShadowHttpRequestForMockedTest;\n+import com.microsoft.identity.client.e2e.shadows.ShadowMsalUtils;\n+import com.microsoft.identity.client.e2e.tests.PublicClientApplicationAbstractTest;\n+import com.microsoft.identity.client.e2e.utils.RoboTestUtils;\n+import com.microsoft.identity.client.exception.MsalException;\n+\n+import org.junit.Assert;\n+import org.junit.Before;\n+import org.junit.Test;\n+import org.junit.runner.RunWith;\n+import org.robolectric.RobolectricTestRunner;\n+import org.robolectric.annotation.Config;\n+\n+import static com.microsoft.identity.internal.testutils.TestConstants.Configurations.SINGLE_ACCOUNT_DCF_TEST_CONFIG_FILE_PATH;\n+\n+/**\n+ * Testing class for the device code flow protocol. Currently only supporting testing for the API-side\n+ * of the protocol. Will be extended to test individual aspects of the flow.\n+ */\n+@RunWith(RobolectricTestRunner.class)\n+@Config(shadows = {ShadowMsalUtils.class, ShadowHttpRequestForMockedTest.class})\n+public class DeviceCodeFlowAPITest extends PublicClientApplicationAbstractTest {\n+\n+    private static Boolean uCode;\n+\n+    @Before\n+    public void setup() {\n+        super.setup();\n+        uCode = false;\n+    }\n+\n+    @Override\n+    public String getConfigFilePath() {\n+        return SINGLE_ACCOUNT_DCF_TEST_CONFIG_FILE_PATH;\n+    }\n+\n+    @Test\n+    @Config(shadows = {ShadowDeviceCodeFlowCommandAuthError.class})\n+    public void testDeviceCodeFlowAuthFailure() {\n+        String[] scope = {\"user.read\"};\n+        mApplication.deviceCodeFlow(scope, new IPublicClientApplication.DeviceCodeFlowCallback() {\n+            @Override\n+            public void getUserCode(@NonNull String vUri, @NonNull String user_code, @NonNull String message) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "2d588b52959359cf0a4e0593829b2adf492fcccf"}, "originalPosition": 74}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDUyODk2MjY2", "url": "https://github.com/AzureAD/microsoft-authentication-library-for-android/pull/1103#pullrequestreview-452896266", "createdAt": "2020-07-21T23:26:19Z", "commit": {"oid": "2d588b52959359cf0a4e0593829b2adf492fcccf"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yMVQyMzoyNjoxOVrOG1NTLw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yMVQyMzoyNjoxOVrOG1NTLw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1ODQ0NTYxNQ==", "bodyText": "Does this have to be static?", "url": "https://github.com/AzureAD/microsoft-authentication-library-for-android/pull/1103#discussion_r458445615", "createdAt": "2020-07-21T23:26:19Z", "author": {"login": "shahzaibj"}, "path": "msal/src/test/java/com/microsoft/identity/client/e2e/tests/mocked/DeviceCodeFlowAPITest.java", "diffHunk": "@@ -0,0 +1,154 @@\n+// Copyright (c) Microsoft Corporation.\n+// All rights reserved.\n+//\n+// This code is licensed under the MIT License.\n+//\n+// Permission is hereby granted, free of charge, to any person obtaining a copy\n+// of this software and associated documentation files(the \"Software\"), to deal\n+// in the Software without restriction, including without limitation the rights\n+// to use, copy, modify, merge, publish, distribute, sublicense, and / or sell\n+// copies of the Software, and to permit persons to whom the Software is\n+// furnished to do so, subject to the following conditions :\n+//\n+// The above copyright notice and this permission notice shall be included in\n+// all copies or substantial portions of the Software.\n+//\n+// THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n+// IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n+// FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n+// AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n+// LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n+// OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\n+// THE SOFTWARE.\n+package com.microsoft.identity.client.e2e.tests.mocked;\n+\n+import androidx.annotation.NonNull;\n+\n+import com.microsoft.identity.client.AuthenticationResult;\n+import com.microsoft.identity.client.IPublicClientApplication;\n+import com.microsoft.identity.client.e2e.shadows.ShadowDeviceCodeFlowCommandAuthError;\n+import com.microsoft.identity.client.e2e.shadows.ShadowDeviceCodeFlowCommandSuccessful;\n+import com.microsoft.identity.client.e2e.shadows.ShadowDeviceCodeFlowCommandTokenError;\n+import com.microsoft.identity.client.e2e.shadows.ShadowHttpRequestForMockedTest;\n+import com.microsoft.identity.client.e2e.shadows.ShadowMsalUtils;\n+import com.microsoft.identity.client.e2e.tests.PublicClientApplicationAbstractTest;\n+import com.microsoft.identity.client.e2e.utils.RoboTestUtils;\n+import com.microsoft.identity.client.exception.MsalException;\n+\n+import org.junit.Assert;\n+import org.junit.Before;\n+import org.junit.Test;\n+import org.junit.runner.RunWith;\n+import org.robolectric.RobolectricTestRunner;\n+import org.robolectric.annotation.Config;\n+\n+import static com.microsoft.identity.internal.testutils.TestConstants.Configurations.SINGLE_ACCOUNT_DCF_TEST_CONFIG_FILE_PATH;\n+\n+/**\n+ * Testing class for the device code flow protocol. Currently only supporting testing for the API-side\n+ * of the protocol. Will be extended to test individual aspects of the flow.\n+ */\n+@RunWith(RobolectricTestRunner.class)\n+@Config(shadows = {ShadowMsalUtils.class, ShadowHttpRequestForMockedTest.class})\n+public class DeviceCodeFlowAPITest extends PublicClientApplicationAbstractTest {\n+\n+    private static Boolean uCode;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "2d588b52959359cf0a4e0593829b2adf492fcccf"}, "originalPosition": 55}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDUyODk2NDA1", "url": "https://github.com/AzureAD/microsoft-authentication-library-for-android/pull/1103#pullrequestreview-452896405", "createdAt": "2020-07-21T23:26:40Z", "commit": {"oid": "2d588b52959359cf0a4e0593829b2adf492fcccf"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yMVQyMzoyNjo0MFrOG1NTpg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yMVQyMzoyNjo0MFrOG1NTpg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1ODQ0NTczNA==", "bodyText": "Can this be a primitive?", "url": "https://github.com/AzureAD/microsoft-authentication-library-for-android/pull/1103#discussion_r458445734", "createdAt": "2020-07-21T23:26:40Z", "author": {"login": "shahzaibj"}, "path": "msal/src/test/java/com/microsoft/identity/client/e2e/tests/mocked/DeviceCodeFlowAPITest.java", "diffHunk": "@@ -0,0 +1,154 @@\n+// Copyright (c) Microsoft Corporation.\n+// All rights reserved.\n+//\n+// This code is licensed under the MIT License.\n+//\n+// Permission is hereby granted, free of charge, to any person obtaining a copy\n+// of this software and associated documentation files(the \"Software\"), to deal\n+// in the Software without restriction, including without limitation the rights\n+// to use, copy, modify, merge, publish, distribute, sublicense, and / or sell\n+// copies of the Software, and to permit persons to whom the Software is\n+// furnished to do so, subject to the following conditions :\n+//\n+// The above copyright notice and this permission notice shall be included in\n+// all copies or substantial portions of the Software.\n+//\n+// THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n+// IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n+// FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n+// AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n+// LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n+// OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\n+// THE SOFTWARE.\n+package com.microsoft.identity.client.e2e.tests.mocked;\n+\n+import androidx.annotation.NonNull;\n+\n+import com.microsoft.identity.client.AuthenticationResult;\n+import com.microsoft.identity.client.IPublicClientApplication;\n+import com.microsoft.identity.client.e2e.shadows.ShadowDeviceCodeFlowCommandAuthError;\n+import com.microsoft.identity.client.e2e.shadows.ShadowDeviceCodeFlowCommandSuccessful;\n+import com.microsoft.identity.client.e2e.shadows.ShadowDeviceCodeFlowCommandTokenError;\n+import com.microsoft.identity.client.e2e.shadows.ShadowHttpRequestForMockedTest;\n+import com.microsoft.identity.client.e2e.shadows.ShadowMsalUtils;\n+import com.microsoft.identity.client.e2e.tests.PublicClientApplicationAbstractTest;\n+import com.microsoft.identity.client.e2e.utils.RoboTestUtils;\n+import com.microsoft.identity.client.exception.MsalException;\n+\n+import org.junit.Assert;\n+import org.junit.Before;\n+import org.junit.Test;\n+import org.junit.runner.RunWith;\n+import org.robolectric.RobolectricTestRunner;\n+import org.robolectric.annotation.Config;\n+\n+import static com.microsoft.identity.internal.testutils.TestConstants.Configurations.SINGLE_ACCOUNT_DCF_TEST_CONFIG_FILE_PATH;\n+\n+/**\n+ * Testing class for the device code flow protocol. Currently only supporting testing for the API-side\n+ * of the protocol. Will be extended to test individual aspects of the flow.\n+ */\n+@RunWith(RobolectricTestRunner.class)\n+@Config(shadows = {ShadowMsalUtils.class, ShadowHttpRequestForMockedTest.class})\n+public class DeviceCodeFlowAPITest extends PublicClientApplicationAbstractTest {\n+\n+    private static Boolean uCode;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "2d588b52959359cf0a4e0593829b2adf492fcccf"}, "originalPosition": 55}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDUyODk2NTg5", "url": "https://github.com/AzureAD/microsoft-authentication-library-for-android/pull/1103#pullrequestreview-452896589", "createdAt": "2020-07-21T23:27:12Z", "commit": {"oid": "2d588b52959359cf0a4e0593829b2adf492fcccf"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yMVQyMzoyNzoxMlrOG1NUVA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yMVQyMzoyNzoxMlrOG1NUVA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1ODQ0NTkwOA==", "bodyText": "Is this needed? (booleans are false by default)", "url": "https://github.com/AzureAD/microsoft-authentication-library-for-android/pull/1103#discussion_r458445908", "createdAt": "2020-07-21T23:27:12Z", "author": {"login": "shahzaibj"}, "path": "msal/src/test/java/com/microsoft/identity/client/e2e/tests/mocked/DeviceCodeFlowAPITest.java", "diffHunk": "@@ -0,0 +1,154 @@\n+// Copyright (c) Microsoft Corporation.\n+// All rights reserved.\n+//\n+// This code is licensed under the MIT License.\n+//\n+// Permission is hereby granted, free of charge, to any person obtaining a copy\n+// of this software and associated documentation files(the \"Software\"), to deal\n+// in the Software without restriction, including without limitation the rights\n+// to use, copy, modify, merge, publish, distribute, sublicense, and / or sell\n+// copies of the Software, and to permit persons to whom the Software is\n+// furnished to do so, subject to the following conditions :\n+//\n+// The above copyright notice and this permission notice shall be included in\n+// all copies or substantial portions of the Software.\n+//\n+// THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n+// IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n+// FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n+// AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n+// LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n+// OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\n+// THE SOFTWARE.\n+package com.microsoft.identity.client.e2e.tests.mocked;\n+\n+import androidx.annotation.NonNull;\n+\n+import com.microsoft.identity.client.AuthenticationResult;\n+import com.microsoft.identity.client.IPublicClientApplication;\n+import com.microsoft.identity.client.e2e.shadows.ShadowDeviceCodeFlowCommandAuthError;\n+import com.microsoft.identity.client.e2e.shadows.ShadowDeviceCodeFlowCommandSuccessful;\n+import com.microsoft.identity.client.e2e.shadows.ShadowDeviceCodeFlowCommandTokenError;\n+import com.microsoft.identity.client.e2e.shadows.ShadowHttpRequestForMockedTest;\n+import com.microsoft.identity.client.e2e.shadows.ShadowMsalUtils;\n+import com.microsoft.identity.client.e2e.tests.PublicClientApplicationAbstractTest;\n+import com.microsoft.identity.client.e2e.utils.RoboTestUtils;\n+import com.microsoft.identity.client.exception.MsalException;\n+\n+import org.junit.Assert;\n+import org.junit.Before;\n+import org.junit.Test;\n+import org.junit.runner.RunWith;\n+import org.robolectric.RobolectricTestRunner;\n+import org.robolectric.annotation.Config;\n+\n+import static com.microsoft.identity.internal.testutils.TestConstants.Configurations.SINGLE_ACCOUNT_DCF_TEST_CONFIG_FILE_PATH;\n+\n+/**\n+ * Testing class for the device code flow protocol. Currently only supporting testing for the API-side\n+ * of the protocol. Will be extended to test individual aspects of the flow.\n+ */\n+@RunWith(RobolectricTestRunner.class)\n+@Config(shadows = {ShadowMsalUtils.class, ShadowHttpRequestForMockedTest.class})\n+public class DeviceCodeFlowAPITest extends PublicClientApplicationAbstractTest {\n+\n+    private static Boolean uCode;\n+\n+    @Before\n+    public void setup() {\n+        super.setup();\n+        uCode = false;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "2d588b52959359cf0a4e0593829b2adf492fcccf"}, "originalPosition": 60}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDUyODk2NzYz", "url": "https://github.com/AzureAD/microsoft-authentication-library-for-android/pull/1103#pullrequestreview-452896763", "createdAt": "2020-07-21T23:27:43Z", "commit": {"oid": "2d588b52959359cf0a4e0593829b2adf492fcccf"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yMVQyMzoyNzo0M1rOG1NVBw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yMVQyMzoyNzo0M1rOG1NVBw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1ODQ0NjA4Nw==", "bodyText": "nit: rename user_code to userCode", "url": "https://github.com/AzureAD/microsoft-authentication-library-for-android/pull/1103#discussion_r458446087", "createdAt": "2020-07-21T23:27:43Z", "author": {"login": "shahzaibj"}, "path": "msal/src/test/java/com/microsoft/identity/client/e2e/tests/mocked/DeviceCodeFlowAPITest.java", "diffHunk": "@@ -0,0 +1,154 @@\n+// Copyright (c) Microsoft Corporation.\n+// All rights reserved.\n+//\n+// This code is licensed under the MIT License.\n+//\n+// Permission is hereby granted, free of charge, to any person obtaining a copy\n+// of this software and associated documentation files(the \"Software\"), to deal\n+// in the Software without restriction, including without limitation the rights\n+// to use, copy, modify, merge, publish, distribute, sublicense, and / or sell\n+// copies of the Software, and to permit persons to whom the Software is\n+// furnished to do so, subject to the following conditions :\n+//\n+// The above copyright notice and this permission notice shall be included in\n+// all copies or substantial portions of the Software.\n+//\n+// THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n+// IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n+// FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n+// AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n+// LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n+// OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\n+// THE SOFTWARE.\n+package com.microsoft.identity.client.e2e.tests.mocked;\n+\n+import androidx.annotation.NonNull;\n+\n+import com.microsoft.identity.client.AuthenticationResult;\n+import com.microsoft.identity.client.IPublicClientApplication;\n+import com.microsoft.identity.client.e2e.shadows.ShadowDeviceCodeFlowCommandAuthError;\n+import com.microsoft.identity.client.e2e.shadows.ShadowDeviceCodeFlowCommandSuccessful;\n+import com.microsoft.identity.client.e2e.shadows.ShadowDeviceCodeFlowCommandTokenError;\n+import com.microsoft.identity.client.e2e.shadows.ShadowHttpRequestForMockedTest;\n+import com.microsoft.identity.client.e2e.shadows.ShadowMsalUtils;\n+import com.microsoft.identity.client.e2e.tests.PublicClientApplicationAbstractTest;\n+import com.microsoft.identity.client.e2e.utils.RoboTestUtils;\n+import com.microsoft.identity.client.exception.MsalException;\n+\n+import org.junit.Assert;\n+import org.junit.Before;\n+import org.junit.Test;\n+import org.junit.runner.RunWith;\n+import org.robolectric.RobolectricTestRunner;\n+import org.robolectric.annotation.Config;\n+\n+import static com.microsoft.identity.internal.testutils.TestConstants.Configurations.SINGLE_ACCOUNT_DCF_TEST_CONFIG_FILE_PATH;\n+\n+/**\n+ * Testing class for the device code flow protocol. Currently only supporting testing for the API-side\n+ * of the protocol. Will be extended to test individual aspects of the flow.\n+ */\n+@RunWith(RobolectricTestRunner.class)\n+@Config(shadows = {ShadowMsalUtils.class, ShadowHttpRequestForMockedTest.class})\n+public class DeviceCodeFlowAPITest extends PublicClientApplicationAbstractTest {\n+\n+    private static Boolean uCode;\n+\n+    @Before\n+    public void setup() {\n+        super.setup();\n+        uCode = false;\n+    }\n+\n+    @Override\n+    public String getConfigFilePath() {\n+        return SINGLE_ACCOUNT_DCF_TEST_CONFIG_FILE_PATH;\n+    }\n+\n+    @Test\n+    @Config(shadows = {ShadowDeviceCodeFlowCommandAuthError.class})\n+    public void testDeviceCodeFlowAuthFailure() {\n+        String[] scope = {\"user.read\"};\n+        mApplication.deviceCodeFlow(scope, new IPublicClientApplication.DeviceCodeFlowCallback() {\n+            @Override\n+            public void getUserCode(@NonNull String vUri, @NonNull String user_code, @NonNull String message) {\n+                // This shouldn't run if authorization step fails\n+                Assert.fail();\n+            }\n+            @Override\n+            public void getToken(AuthenticationResult authResult) {\n+                // This shouldn't run if authorization step fails\n+                Assert.fail();\n+            }\n+            @Override\n+            public void onError(MsalException error) {\n+                // Handle exception when authorization fails\n+                Assert.assertFalse(uCode);\n+                Assert.assertTrue(error.getErrorCode().equals(\"invalid_scope\"));\n+            }\n+        });\n+\n+        RoboTestUtils.flushScheduler();\n+    }\n+\n+    @Test\n+    @Config(shadows = {ShadowDeviceCodeFlowCommandTokenError.class})\n+    public void testDeviceCodeFlowTokenFailure() {\n+        String[] scope = {\"user.read\"};\n+        mApplication.deviceCodeFlow(scope, new IPublicClientApplication.DeviceCodeFlowCallback() {\n+            @Override\n+            public void getUserCode(@NonNull String vUri, @NonNull String user_code, @NonNull String message) {\n+                // Assert that the protocol returns the user_code and others after successful authorization\n+                Assert.assertNotNull(vUri);\n+                Assert.assertNotNull(user_code);\n+                Assert.assertNotNull(message);\n+\n+                Assert.assertFalse(uCode);\n+                uCode = true;\n+            }\n+            @Override\n+            public void getToken(AuthenticationResult authResult) {\n+                // This shouldn't run\n+                Assert.fail();\n+            }\n+            @Override\n+            public void onError(MsalException error) {\n+                // Handle Exception\n+                Assert.assertTrue(uCode);\n+                Assert.assertTrue(error.getErrorCode().equals(\"expired_token\"));\n+            }\n+        });\n+\n+        RoboTestUtils.flushScheduler();\n+    }\n+\n+    @Test\n+    @Config(shadows = {ShadowDeviceCodeFlowCommandSuccessful.class})\n+    public void testDeviceCodeFlowSuccess() {\n+        String[] scope = {\"user.read\"};\n+        mApplication.deviceCodeFlow(scope, new IPublicClientApplication.DeviceCodeFlowCallback() {\n+            @Override\n+            public void getUserCode(@NonNull String vUri, @NonNull String user_code, @NonNull String message) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "2d588b52959359cf0a4e0593829b2adf492fcccf"}, "originalPosition": 131}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDUyODk2ODQ2", "url": "https://github.com/AzureAD/microsoft-authentication-library-for-android/pull/1103#pullrequestreview-452896846", "createdAt": "2020-07-21T23:27:57Z", "commit": {"oid": "2d588b52959359cf0a4e0593829b2adf492fcccf"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yMVQyMzoyNzo1N1rOG1NVUw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yMVQyMzoyNzo1N1rOG1NVUw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1ODQ0NjE2Mw==", "bodyText": "Add new line at end of file", "url": "https://github.com/AzureAD/microsoft-authentication-library-for-android/pull/1103#discussion_r458446163", "createdAt": "2020-07-21T23:27:57Z", "author": {"login": "shahzaibj"}, "path": "msal/src/test/res/raw/single_account_dcf_test_config.json", "diffHunk": "@@ -0,0 +1,12 @@\n+{\n+  \"client_id\": \"d335d85e-5aa7-4f03-8c2f-81b2699f30a6\",\n+  \"authorization_user_agent\": \"DEFAULT\",\n+  \"redirect_uri\": \"msauth://com.onmicrosoft.fadiorgorg/1wIqXSqBj7w%2Bh11ZifsnqwgyKrY%3D\",\n+  \"account_mode\" : \"SINGLE\",\n+  \"authorities\": [\n+    {\n+      \"type\": \"AAD\",\n+      \"authority_url\": \"https://login.microsoftonline.com/2d94acaa-ef23-4d35-9678-8995364ac965\"\n+    }\n+  ]\n+}", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "2d588b52959359cf0a4e0593829b2adf492fcccf"}, "originalPosition": 12}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDUyODk3NjI1", "url": "https://github.com/AzureAD/microsoft-authentication-library-for-android/pull/1103#pullrequestreview-452897625", "createdAt": "2020-07-21T23:30:07Z", "commit": {"oid": "2d588b52959359cf0a4e0593829b2adf492fcccf"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yMVQyMzozMDowOFrOG1NYGg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yMVQyMzozMDowOFrOG1NYGg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1ODQ0Njg3NA==", "bodyText": "Doesn't seem like it returns anything so I think a name that start with get is not suitable. How about onUserCodeReceived?", "url": "https://github.com/AzureAD/microsoft-authentication-library-for-android/pull/1103#discussion_r458446874", "createdAt": "2020-07-21T23:30:08Z", "author": {"login": "shahzaibj"}, "path": "msal/src/main/java/com/microsoft/identity/client/IPublicClientApplication.java", "diffHunk": "@@ -162,4 +176,29 @@ void acquireToken(@NonNull final Activity activity,\n         void onError(final MsalException exception);\n     }\n \n+    interface DeviceCodeFlowCallback{\n+        /**\n+         * Called to display verification uri, user code, and instruction message during device code flow.\n+         *\n+         * @param vUri verification uri\n+         * @param userCode user code\n+         * @param message instruction message\n+         */\n+        void getUserCode(@NonNull String vUri, @NonNull String userCode, @NonNull String message);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "2d588b52959359cf0a4e0593829b2adf492fcccf"}, "originalPosition": 40}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDUyODk3NzI2", "url": "https://github.com/AzureAD/microsoft-authentication-library-for-android/pull/1103#pullrequestreview-452897726", "createdAt": "2020-07-21T23:30:22Z", "commit": {"oid": "2d588b52959359cf0a4e0593829b2adf492fcccf"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yMVQyMzozMDoyM1rOG1NYfQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yMVQyMzozMDoyM1rOG1NYfQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1ODQ0Njk3Mw==", "bodyText": "Doesn't seem like it returns anything so I think a name that start with get is not suitable. How about onTokenReceived?", "url": "https://github.com/AzureAD/microsoft-authentication-library-for-android/pull/1103#discussion_r458446973", "createdAt": "2020-07-21T23:30:23Z", "author": {"login": "shahzaibj"}, "path": "msal/src/main/java/com/microsoft/identity/client/IPublicClientApplication.java", "diffHunk": "@@ -162,4 +176,29 @@ void acquireToken(@NonNull final Activity activity,\n         void onError(final MsalException exception);\n     }\n \n+    interface DeviceCodeFlowCallback{\n+        /**\n+         * Called to display verification uri, user code, and instruction message during device code flow.\n+         *\n+         * @param vUri verification uri\n+         * @param userCode user code\n+         * @param message instruction message\n+         */\n+        void getUserCode(@NonNull String vUri, @NonNull String userCode, @NonNull String message);\n+\n+        /**\n+         * Called once succeed and pass the result object.\n+         *\n+         * @param authResult the authentication result\n+         */\n+        void getToken(AuthenticationResult authResult);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "2d588b52959359cf0a4e0593829b2adf492fcccf"}, "originalPosition": 47}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDUyODk3OTAw", "url": "https://github.com/AzureAD/microsoft-authentication-library-for-android/pull/1103#pullrequestreview-452897900", "createdAt": "2020-07-21T23:30:53Z", "commit": {"oid": "2d588b52959359cf0a4e0593829b2adf492fcccf"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yMVQyMzozMDo1M1rOG1NZIg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yMVQyMzozMDo1M1rOG1NZIg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1ODQ0NzEzOA==", "bodyText": "The class itself should have some javadoc", "url": "https://github.com/AzureAD/microsoft-authentication-library-for-android/pull/1103#discussion_r458447138", "createdAt": "2020-07-21T23:30:53Z", "author": {"login": "shahzaibj"}, "path": "msal/src/main/java/com/microsoft/identity/client/IPublicClientApplication.java", "diffHunk": "@@ -162,4 +176,29 @@ void acquireToken(@NonNull final Activity activity,\n         void onError(final MsalException exception);\n     }\n \n+    interface DeviceCodeFlowCallback{", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "2d588b52959359cf0a4e0593829b2adf492fcccf"}, "originalPosition": 32}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDUyODk4MDc0", "url": "https://github.com/AzureAD/microsoft-authentication-library-for-android/pull/1103#pullrequestreview-452898074", "createdAt": "2020-07-21T23:31:24Z", "commit": {"oid": "2d588b52959359cf0a4e0593829b2adf492fcccf"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yMVQyMzozMToyNFrOG1NZxA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yMVQyMzozMToyNFrOG1NZxA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1ODQ0NzMwMA==", "bodyText": "need space between DeviceCodeFlowCallback and {", "url": "https://github.com/AzureAD/microsoft-authentication-library-for-android/pull/1103#discussion_r458447300", "createdAt": "2020-07-21T23:31:24Z", "author": {"login": "shahzaibj"}, "path": "msal/src/main/java/com/microsoft/identity/client/IPublicClientApplication.java", "diffHunk": "@@ -162,4 +176,29 @@ void acquireToken(@NonNull final Activity activity,\n         void onError(final MsalException exception);\n     }\n \n+    interface DeviceCodeFlowCallback{", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "2d588b52959359cf0a4e0593829b2adf492fcccf"}, "originalPosition": 32}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDUyODk4ODU1", "url": "https://github.com/AzureAD/microsoft-authentication-library-for-android/pull/1103#pullrequestreview-452898855", "createdAt": "2020-07-21T23:33:39Z", "commit": {"oid": "2d588b52959359cf0a4e0593829b2adf492fcccf"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yMVQyMzozMzozOVrOG1NcaA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yMVQyMzozMzozOVrOG1NcaA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1ODQ0Nzk3Ng==", "bodyText": "nit: change Called to Invoked", "url": "https://github.com/AzureAD/microsoft-authentication-library-for-android/pull/1103#discussion_r458447976", "createdAt": "2020-07-21T23:33:39Z", "author": {"login": "shahzaibj"}, "path": "msal/src/main/java/com/microsoft/identity/client/IPublicClientApplication.java", "diffHunk": "@@ -162,4 +176,29 @@ void acquireToken(@NonNull final Activity activity,\n         void onError(final MsalException exception);\n     }\n \n+    interface DeviceCodeFlowCallback{\n+        /**\n+         * Called to display verification uri, user code, and instruction message during device code flow.", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "2d588b52959359cf0a4e0593829b2adf492fcccf"}, "originalPosition": 34}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDUyODk4OTI0", "url": "https://github.com/AzureAD/microsoft-authentication-library-for-android/pull/1103#pullrequestreview-452898924", "createdAt": "2020-07-21T23:33:51Z", "commit": {"oid": "2d588b52959359cf0a4e0593829b2adf492fcccf"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yMVQyMzozMzo1MVrOG1Ncpw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yMVQyMzozMzo1MVrOG1Ncpw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1ODQ0ODAzOQ==", "bodyText": "nit: change Called to Invoked", "url": "https://github.com/AzureAD/microsoft-authentication-library-for-android/pull/1103#discussion_r458448039", "createdAt": "2020-07-21T23:33:51Z", "author": {"login": "shahzaibj"}, "path": "msal/src/main/java/com/microsoft/identity/client/IPublicClientApplication.java", "diffHunk": "@@ -162,4 +176,29 @@ void acquireToken(@NonNull final Activity activity,\n         void onError(final MsalException exception);\n     }\n \n+    interface DeviceCodeFlowCallback{\n+        /**\n+         * Called to display verification uri, user code, and instruction message during device code flow.\n+         *\n+         * @param vUri verification uri\n+         * @param userCode user code\n+         * @param message instruction message\n+         */\n+        void getUserCode(@NonNull String vUri, @NonNull String userCode, @NonNull String message);\n+\n+        /**\n+         * Called once succeed and pass the result object.", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "2d588b52959359cf0a4e0593829b2adf492fcccf"}, "originalPosition": 43}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDUyODk5MjA1", "url": "https://github.com/AzureAD/microsoft-authentication-library-for-android/pull/1103#pullrequestreview-452899205", "createdAt": "2020-07-21T23:34:36Z", "commit": {"oid": "2d588b52959359cf0a4e0593829b2adf492fcccf"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "7b2d25c84930e11abb603d5725e9960880c712b7", "author": {"user": {"login": "t-fadura", "name": "Fadi Durah"}}, "url": "https://github.com/AzureAD/microsoft-authentication-library-for-android/commit/7b2d25c84930e11abb603d5725e9960880c712b7", "committedDate": "2020-07-22T12:37:49Z", "message": "Address suggestions from PR"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "fb58f4a82aa5c3ee0c166152eac3293c7b93731d", "author": {"user": {"login": "t-fadura", "name": "Fadi Durah"}}, "url": "https://github.com/AzureAD/microsoft-authentication-library-for-android/commit/fb58f4a82aa5c3ee0c166152eac3293c7b93731d", "committedDate": "2020-07-22T14:21:22Z", "message": "deviceCodeFlow() always uses LocalMsalController()"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDUzMzY3NDM5", "url": "https://github.com/AzureAD/microsoft-authentication-library-for-android/pull/1103#pullrequestreview-453367439", "createdAt": "2020-07-22T14:22:25Z", "commit": {"oid": "fb58f4a82aa5c3ee0c166152eac3293c7b93731d"}, "state": "COMMENTED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDUzNDcxNDc1", "url": "https://github.com/AzureAD/microsoft-authentication-library-for-android/pull/1103#pullrequestreview-453471475", "createdAt": "2020-07-22T16:12:42Z", "commit": {"oid": "fb58f4a82aa5c3ee0c166152eac3293c7b93731d"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yMlQxNjoxMjo0MlrOG1pt7Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yMlQxNjoxMjo0MlrOG1pt7Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1ODkxMTIxMw==", "bodyText": "How about rephrase as follows:\n\nPerform the Device Code Flow (DCF) protocol to allow a device without input capability to authenticate and get a new access token.", "url": "https://github.com/AzureAD/microsoft-authentication-library-for-android/pull/1103#discussion_r458911213", "createdAt": "2020-07-22T16:12:42Z", "author": {"login": "shahzaibj"}, "path": "msal/src/main/java/com/microsoft/identity/client/IPublicClientApplication.java", "diffHunk": "@@ -84,6 +86,13 @@ void acquireToken(@NonNull final Activity activity,\n     @WorkerThread\n     IAuthenticationResult acquireTokenSilent(@NonNull final AcquireTokenSilentParameters acquireTokenSilentParameters) throws InterruptedException, MsalException;\n \n+    /**\n+     * Perform the Device Code Flow (DCF) protocol to allow a device to authenticate and get a new access token without input capability.", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "fb58f4a82aa5c3ee0c166152eac3293c7b93731d"}, "originalPosition": 17}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDUzNDcyMTk1", "url": "https://github.com/AzureAD/microsoft-authentication-library-for-android/pull/1103#pullrequestreview-453472195", "createdAt": "2020-07-22T16:13:33Z", "commit": {"oid": "fb58f4a82aa5c3ee0c166152eac3293c7b93731d"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yMlQxNjoxMzozM1rOG1pwPg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yMlQxNjoxMzozM1rOG1pwPg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1ODkxMTgwNg==", "bodyText": "Not quite sure why the last two String have underlines here", "url": "https://github.com/AzureAD/microsoft-authentication-library-for-android/pull/1103#discussion_r458911806", "createdAt": "2020-07-22T16:13:33Z", "author": {"login": "shahzaibj"}, "path": "msal/src/main/java/com/microsoft/identity/client/IPublicClientApplication.java", "diffHunk": "@@ -162,4 +171,39 @@ void acquireToken(@NonNull final Activity activity,\n         void onError(final MsalException exception);\n     }\n \n+    /**\n+     * Callback object used in Device Code Flow.\n+     * This callback provides the following methods for communicating with the protocol.\n+     *                 1). Receiving authentication information (user_code, verification_uri, and instruction message)\n+     *                 via {@link DeviceCodeFlowCallback#onUserCodeReceived(String, String, String)}.", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "fb58f4a82aa5c3ee0c166152eac3293c7b93731d"}, "originalPosition": 34}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDUzNDc0MzY3", "url": "https://github.com/AzureAD/microsoft-authentication-library-for-android/pull/1103#pullrequestreview-453474367", "createdAt": "2020-07-22T16:16:16Z", "commit": {"oid": "fb58f4a82aa5c3ee0c166152eac3293c7b93731d"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yMlQxNjoxNjoxN1rOG1p3Lw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yMlQxNjoxNjoxN1rOG1p3Lw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1ODkxMzU4Mw==", "bodyText": "How about rephrase as:\n\nInvoked once token is received and passes the {@link AuthenticationResult} object", "url": "https://github.com/AzureAD/microsoft-authentication-library-for-android/pull/1103#discussion_r458913583", "createdAt": "2020-07-22T16:16:17Z", "author": {"login": "shahzaibj"}, "path": "msal/src/main/java/com/microsoft/identity/client/IPublicClientApplication.java", "diffHunk": "@@ -162,4 +171,39 @@ void acquireToken(@NonNull final Activity activity,\n         void onError(final MsalException exception);\n     }\n \n+    /**\n+     * Callback object used in Device Code Flow.\n+     * This callback provides the following methods for communicating with the protocol.\n+     *                 1). Receiving authentication information (user_code, verification_uri, and instruction message)\n+     *                 via {@link DeviceCodeFlowCallback#onUserCodeReceived(String, String, String)}.\n+     *                 2). Receiving a successful authnetication result containing a fresh access token\n+     *                 via {@link DeviceCodeFlowCallback#onTokenReceived(AuthenticationResult)}.\n+     *                 3). Receiving an exception detailing what went wrong in the protocol\n+     *                 via {@link DeviceCodeFlowCallback#onError(MsalServiceException)}.\n+     */\n+    interface DeviceCodeFlowCallback {\n+        /**\n+         * Invoked to display verification uri, user code, and instruction message during device code flow.\n+         *\n+         * @param vUri verification uri\n+         * @param userCode user code\n+         * @param message instruction message\n+         */\n+        void onUserCodeReceived(@NonNull String vUri, @NonNull String userCode, @NonNull String message);\n+\n+        /**\n+         * Invoked once succeed and pass the result object.", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "fb58f4a82aa5c3ee0c166152eac3293c7b93731d"}, "originalPosition": 51}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDUzNDc0OTc4", "url": "https://github.com/AzureAD/microsoft-authentication-library-for-android/pull/1103#pullrequestreview-453474978", "createdAt": "2020-07-22T16:17:02Z", "commit": {"oid": "fb58f4a82aa5c3ee0c166152eac3293c7b93731d"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yMlQxNjoxNzowMlrOG1p5AA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yMlQxNjoxNzowMlrOG1p5AA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1ODkxNDA0OA==", "bodyText": "How about rephrase as:\n\nInvoked if an error is encountered during the device code flow and passes the Exception object", "url": "https://github.com/AzureAD/microsoft-authentication-library-for-android/pull/1103#discussion_r458914048", "createdAt": "2020-07-22T16:17:02Z", "author": {"login": "shahzaibj"}, "path": "msal/src/main/java/com/microsoft/identity/client/IPublicClientApplication.java", "diffHunk": "@@ -162,4 +171,39 @@ void acquireToken(@NonNull final Activity activity,\n         void onError(final MsalException exception);\n     }\n \n+    /**\n+     * Callback object used in Device Code Flow.\n+     * This callback provides the following methods for communicating with the protocol.\n+     *                 1). Receiving authentication information (user_code, verification_uri, and instruction message)\n+     *                 via {@link DeviceCodeFlowCallback#onUserCodeReceived(String, String, String)}.\n+     *                 2). Receiving a successful authnetication result containing a fresh access token\n+     *                 via {@link DeviceCodeFlowCallback#onTokenReceived(AuthenticationResult)}.\n+     *                 3). Receiving an exception detailing what went wrong in the protocol\n+     *                 via {@link DeviceCodeFlowCallback#onError(MsalServiceException)}.\n+     */\n+    interface DeviceCodeFlowCallback {\n+        /**\n+         * Invoked to display verification uri, user code, and instruction message during device code flow.\n+         *\n+         * @param vUri verification uri\n+         * @param userCode user code\n+         * @param message instruction message\n+         */\n+        void onUserCodeReceived(@NonNull String vUri, @NonNull String userCode, @NonNull String message);\n+\n+        /**\n+         * Invoked once succeed and pass the result object.\n+         *\n+         * @param authResult the authentication result\n+         */\n+        void onTokenReceived(AuthenticationResult authResult);\n+\n+        /**\n+         * Invoked once exception thrown.", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "fb58f4a82aa5c3ee0c166152eac3293c7b93731d"}, "originalPosition": 58}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDUzNDc1Nzk1", "url": "https://github.com/AzureAD/microsoft-authentication-library-for-android/pull/1103#pullrequestreview-453475795", "createdAt": "2020-07-22T16:17:44Z", "commit": {"oid": "fb58f4a82aa5c3ee0c166152eac3293c7b93731d"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yMlQxNjoxNzo0NFrOG1p6yw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yMlQxNjoxNzo0NFrOG1p6yw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1ODkxNDUwNw==", "bodyText": "Can we get other types of Exceptions here? How about any MsalException?", "url": "https://github.com/AzureAD/microsoft-authentication-library-for-android/pull/1103#discussion_r458914507", "createdAt": "2020-07-22T16:17:44Z", "author": {"login": "shahzaibj"}, "path": "msal/src/main/java/com/microsoft/identity/client/IPublicClientApplication.java", "diffHunk": "@@ -162,4 +171,39 @@ void acquireToken(@NonNull final Activity activity,\n         void onError(final MsalException exception);\n     }\n \n+    /**\n+     * Callback object used in Device Code Flow.\n+     * This callback provides the following methods for communicating with the protocol.\n+     *                 1). Receiving authentication information (user_code, verification_uri, and instruction message)\n+     *                 via {@link DeviceCodeFlowCallback#onUserCodeReceived(String, String, String)}.\n+     *                 2). Receiving a successful authnetication result containing a fresh access token\n+     *                 via {@link DeviceCodeFlowCallback#onTokenReceived(AuthenticationResult)}.\n+     *                 3). Receiving an exception detailing what went wrong in the protocol\n+     *                 via {@link DeviceCodeFlowCallback#onError(MsalServiceException)}.\n+     */\n+    interface DeviceCodeFlowCallback {\n+        /**\n+         * Invoked to display verification uri, user code, and instruction message during device code flow.\n+         *\n+         * @param vUri verification uri\n+         * @param userCode user code\n+         * @param message instruction message\n+         */\n+        void onUserCodeReceived(@NonNull String vUri, @NonNull String userCode, @NonNull String message);\n+\n+        /**\n+         * Invoked once succeed and pass the result object.\n+         *\n+         * @param authResult the authentication result\n+         */\n+        void onTokenReceived(AuthenticationResult authResult);\n+\n+        /**\n+         * Invoked once exception thrown.\n+         *\n+         * @param error error exception\n+         */\n+        void onError(MsalServiceException error);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "fb58f4a82aa5c3ee0c166152eac3293c7b93731d"}, "originalPosition": 62}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDUzNDc3OTgx", "url": "https://github.com/AzureAD/microsoft-authentication-library-for-android/pull/1103#pullrequestreview-453477981", "createdAt": "2020-07-22T16:19:07Z", "commit": {"oid": "fb58f4a82aa5c3ee0c166152eac3293c7b93731d"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yMlQxNjoxOTowN1rOG1p-cg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yMlQxNjoxOTowN1rOG1p-cg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1ODkxNTQ0Mg==", "bodyText": "Can you remind me why we need a new thread here? CommandDispatcher should be spinning up its own threads any way so I believe there shouldn't be any HTTP request that is made on the main thread.", "url": "https://github.com/AzureAD/microsoft-authentication-library-for-android/pull/1103#discussion_r458915442", "createdAt": "2020-07-22T16:19:07Z", "author": {"login": "shahzaibj"}, "path": "msal/src/main/java/com/microsoft/identity/client/PublicClientApplication.java", "diffHunk": "@@ -1618,6 +1624,38 @@ public void onError(MsalException exception) {\n         }\n     }\n \n+    public void deviceCodeFlow(@Nullable String[] scopes, @NonNull final DeviceCodeFlowCallback callback) {\n+        // Create a DeviceCodeFlowCommandParameters object that takes in the desired scopes and the callback object\n+        // Use CommandParametersAdapter\n+        final DeviceCodeFlowCommandParameters commandParameters = CommandParametersAdapter\n+                    .createDeviceCodeFlowCommandParameters(\n+                            mPublicClientConfiguration,\n+                            mPublicClientConfiguration.getOAuth2TokenCache(),\n+                            scopes);\n+\n+        // Create a CommandCallback object from the DeviceCodeFlowCallback object\n+        final DeviceCodeFlowCommandCallback deviceCodeFlowCommandCallback = getDeviceCodeFlowCommandCallback(callback);\n+\n+        // Create a DeviceCodeFlowCommand object\n+        // Pass the command parameters, default controller, and command callback\n+        // Telemetry with DEVICE_CODE_FLOW_CALLBACK\n+        final DeviceCodeFlowCommand deviceCodeFlowCommand = new DeviceCodeFlowCommand(\n+                commandParameters,\n+                new LocalMSALController(),\n+                deviceCodeFlowCommandCallback,\n+                PublicApiId.DEVICE_CODE_FLOW_WITH_CALLBACK\n+        );\n+\n+        // Run the command we created above in a separate thread to allow running HTTP Requests\n+        Thread thread = new Thread(new Runnable(){\n+            @Override\n+            public void run(){\n+                CommandDispatcher.submitSilent(deviceCodeFlowCommand);\n+            }\n+        });\n+        thread.start();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "fb58f4a82aa5c3ee0c166152eac3293c7b93731d"}, "originalPosition": 66}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDUzNDc4OTQz", "url": "https://github.com/AzureAD/microsoft-authentication-library-for-android/pull/1103#pullrequestreview-453478943", "createdAt": "2020-07-22T16:19:43Z", "commit": {"oid": "fb58f4a82aa5c3ee0c166152eac3293c7b93731d"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yMlQxNjoxOTo0M1rOG1qAAg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yMlQxNjoxOTo0M1rOG1qAAg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1ODkxNTg0Mg==", "bodyText": "Why can't we get any generic MsalException?", "url": "https://github.com/AzureAD/microsoft-authentication-library-for-android/pull/1103#discussion_r458915842", "createdAt": "2020-07-22T16:19:43Z", "author": {"login": "shahzaibj"}, "path": "msal/src/main/java/com/microsoft/identity/client/PublicClientApplication.java", "diffHunk": "@@ -1689,6 +1727,38 @@ public void onCancel() {\n         };\n     }\n \n+    protected DeviceCodeFlowCommandCallback getDeviceCodeFlowCommandCallback(@NonNull final DeviceCodeFlowCallback callback) {\n+        return new DeviceCodeFlowCommandCallback<LocalAuthenticationResult, MsalServiceException>() {\n+            @Override\n+            public void getUserCode(@NonNull String vUri, @NonNull String userCode, @NonNull String message){\n+                callback.onUserCodeReceived(vUri, userCode, message);\n+            }\n+\n+            @Override\n+            public void onTaskCompleted(LocalAuthenticationResult tokenResult) {\n+                // Convert tokenResult to an AuthenticationResult object\n+                IAuthenticationResult convertedResult = AuthenticationResultAdapter.adapt(\n+                        tokenResult);\n+\n+                // Type cast the interface object\n+                AuthenticationResult authResult = (AuthenticationResult) convertedResult;\n+\n+                callback.onTokenReceived(authResult);\n+            }\n+\n+            @Override\n+            public void onError(MsalServiceException msalError) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "fb58f4a82aa5c3ee0c166152eac3293c7b93731d"}, "originalPosition": 96}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDUzNDgyMjk5", "url": "https://github.com/AzureAD/microsoft-authentication-library-for-android/pull/1103#pullrequestreview-453482299", "createdAt": "2020-07-22T16:22:18Z", "commit": {"oid": "fb58f4a82aa5c3ee0c166152eac3293c7b93731d"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yMlQxNjoyMjoxOFrOG1qIGw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yMlQxNjoyMjoxOFrOG1qIGw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1ODkxNzkxNQ==", "bodyText": "Would be good to have an extra line above this", "url": "https://github.com/AzureAD/microsoft-authentication-library-for-android/pull/1103#discussion_r458917915", "createdAt": "2020-07-22T16:22:18Z", "author": {"login": "shahzaibj"}, "path": "msal/src/test/java/com/microsoft/identity/client/e2e/shadows/ShadowDeviceCodeFlowCommandAuthError.java", "diffHunk": "@@ -0,0 +1,39 @@\n+// Copyright (c) Microsoft Corporation.\n+// All rights reserved.\n+//\n+// This code is licensed under the MIT License.\n+//\n+// Permission is hereby granted, free of charge, to any person obtaining a copy\n+// of this software and associated documentation files(the \"Software\"), to deal\n+// in the Software without restriction, including without limitation the rights\n+// to use, copy, modify, merge, publish, distribute, sublicense, and / or sell\n+// copies of the Software, and to permit persons to whom the Software is\n+// furnished to do so, subject to the following conditions :\n+//\n+// The above copyright notice and this permission notice shall be included in\n+// all copies or substantial portions of the Software.\n+//\n+// THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n+// IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n+// FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n+// AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n+// LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n+// OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\n+// THE SOFTWARE.\n+package com.microsoft.identity.client.e2e.shadows;\n+\n+import com.microsoft.identity.client.exception.MsalServiceException;\n+import com.microsoft.identity.common.internal.commands.DeviceCodeFlowCommand;\n+import com.microsoft.identity.common.internal.result.AcquireTokenResult;\n+\n+import org.robolectric.annotation.Implements;\n+\n+/**\n+ * Shadow class that simulates Device Code Flow failing due to an error in the authorization phase.\n+ */\n+@Implements(DeviceCodeFlowCommand.class)\n+public class ShadowDeviceCodeFlowCommandAuthError {\n+    public AcquireTokenResult execute() throws Exception {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "fb58f4a82aa5c3ee0c166152eac3293c7b93731d"}, "originalPosition": 36}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDUzNDgzNjUw", "url": "https://github.com/AzureAD/microsoft-authentication-library-for-android/pull/1103#pullrequestreview-453483650", "createdAt": "2020-07-22T16:23:59Z", "commit": {"oid": "fb58f4a82aa5c3ee0c166152eac3293c7b93731d"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yMlQxNjoyMzo1OVrOG1qO1Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yMlQxNjoyMzo1OVrOG1qO1Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1ODkxOTYzNw==", "bodyText": "I'm not clear on what this variable is/does....does it determine if user code has been received? If yes, then can we rename to mUserCodeReceived?", "url": "https://github.com/AzureAD/microsoft-authentication-library-for-android/pull/1103#discussion_r458919637", "createdAt": "2020-07-22T16:23:59Z", "author": {"login": "shahzaibj"}, "path": "msal/src/test/java/com/microsoft/identity/client/e2e/tests/mocked/DeviceCodeFlowAPITest.java", "diffHunk": "@@ -0,0 +1,153 @@\n+// Copyright (c) Microsoft Corporation.\n+// All rights reserved.\n+//\n+// This code is licensed under the MIT License.\n+//\n+// Permission is hereby granted, free of charge, to any person obtaining a copy\n+// of this software and associated documentation files(the \"Software\"), to deal\n+// in the Software without restriction, including without limitation the rights\n+// to use, copy, modify, merge, publish, distribute, sublicense, and / or sell\n+// copies of the Software, and to permit persons to whom the Software is\n+// furnished to do so, subject to the following conditions :\n+//\n+// The above copyright notice and this permission notice shall be included in\n+// all copies or substantial portions of the Software.\n+//\n+// THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n+// IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n+// FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n+// AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n+// LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n+// OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\n+// THE SOFTWARE.\n+package com.microsoft.identity.client.e2e.tests.mocked;\n+\n+import androidx.annotation.NonNull;\n+\n+import com.microsoft.identity.client.AuthenticationResult;\n+import com.microsoft.identity.client.IPublicClientApplication;\n+import com.microsoft.identity.client.e2e.shadows.ShadowDeviceCodeFlowCommandAuthError;\n+import com.microsoft.identity.client.e2e.shadows.ShadowDeviceCodeFlowCommandSuccessful;\n+import com.microsoft.identity.client.e2e.shadows.ShadowDeviceCodeFlowCommandTokenError;\n+import com.microsoft.identity.client.e2e.shadows.ShadowHttpRequestForMockedTest;\n+import com.microsoft.identity.client.e2e.shadows.ShadowMsalUtils;\n+import com.microsoft.identity.client.e2e.tests.PublicClientApplicationAbstractTest;\n+import com.microsoft.identity.client.e2e.utils.RoboTestUtils;\n+import com.microsoft.identity.client.exception.MsalServiceException;\n+\n+import org.junit.Assert;\n+import org.junit.Before;\n+import org.junit.Test;\n+import org.junit.runner.RunWith;\n+import org.robolectric.RobolectricTestRunner;\n+import org.robolectric.annotation.Config;\n+\n+import static com.microsoft.identity.internal.testutils.TestConstants.Configurations.SINGLE_ACCOUNT_DCF_TEST_CONFIG_FILE_PATH;\n+\n+/**\n+ * Testing class for the device code flow protocol. Currently only supporting testing for the API-side\n+ * of the protocol. Will be extended to test individual aspects of the flow.\n+ */\n+@RunWith(RobolectricTestRunner.class)\n+@Config(shadows = {ShadowMsalUtils.class, ShadowHttpRequestForMockedTest.class})\n+public class DeviceCodeFlowAPITest extends PublicClientApplicationAbstractTest {\n+\n+    private boolean mUserCodeBoolean;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "fb58f4a82aa5c3ee0c166152eac3293c7b93731d"}, "originalPosition": 55}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDUzNDg1MTc0", "url": "https://github.com/AzureAD/microsoft-authentication-library-for-android/pull/1103#pullrequestreview-453485174", "createdAt": "2020-07-22T16:25:48Z", "commit": {"oid": "fb58f4a82aa5c3ee0c166152eac3293c7b93731d"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yMlQxNjoyNTo0OFrOG1qWKA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yMlQxNjoyNTo0OFrOG1qWKA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1ODkyMTUxMg==", "bodyText": "Can we use something that is already existing in the LAB?", "url": "https://github.com/AzureAD/microsoft-authentication-library-for-android/pull/1103#discussion_r458921512", "createdAt": "2020-07-22T16:25:48Z", "author": {"login": "shahzaibj"}, "path": "msal/src/test/res/raw/single_account_dcf_test_config.json", "diffHunk": "@@ -0,0 +1,12 @@\n+{\n+  \"client_id\": \"d335d85e-5aa7-4f03-8c2f-81b2699f30a6\",\n+  \"authorization_user_agent\": \"DEFAULT\",\n+  \"redirect_uri\": \"msauth://com.onmicrosoft.fadiorgorg/1wIqXSqBj7w%2Bh11ZifsnqwgyKrY%3D\",", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "fb58f4a82aa5c3ee0c166152eac3293c7b93731d"}, "originalPosition": 4}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDUzNDg3Mzcw", "url": "https://github.com/AzureAD/microsoft-authentication-library-for-android/pull/1103#pullrequestreview-453487370", "createdAt": "2020-07-22T16:28:24Z", "commit": {"oid": "fb58f4a82aa5c3ee0c166152eac3293c7b93731d"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yMlQxNjoyODoyNFrOG1qeYw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yMlQxNjoyODoyNFrOG1qeYw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1ODkyMzYxOQ==", "bodyText": "Do we actually know if PoP is supported over DCF? Or is there a plan to support in the future?", "url": "https://github.com/AzureAD/microsoft-authentication-library-for-android/pull/1103#discussion_r458923619", "createdAt": "2020-07-22T16:28:24Z", "author": {"login": "shahzaibj"}, "path": "msal/src/main/java/com/microsoft/identity/client/internal/CommandParametersAdapter.java", "diffHunk": "@@ -193,6 +195,33 @@ public static SilentTokenCommandParameters createSilentTokenCommandParameters(\n         return commandParameters;\n     }\n \n+    public static DeviceCodeFlowCommandParameters createDeviceCodeFlowCommandParameters(\n+            @NonNull final PublicClientApplicationConfiguration configuration,\n+            @NonNull final OAuth2TokenCache tokenCache,\n+            @NonNull String[] scopes){\n+\n+        final AbstractAuthenticationScheme authenticationScheme = new BearerAuthenticationSchemeInternal();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "fb58f4a82aa5c3ee0c166152eac3293c7b93731d"}, "originalPosition": 20}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e03ef8aef229b6117ac2e211f1dbacbbf861aaa7", "author": {"user": {"login": "t-fadura", "name": "Fadi Durah"}}, "url": "https://github.com/AzureAD/microsoft-authentication-library-for-android/commit/e03ef8aef229b6117ac2e211f1dbacbbf861aaa7", "committedDate": "2020-07-22T17:04:03Z", "message": "More fixes according to suggestions"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDUzNTE3OTE5", "url": "https://github.com/AzureAD/microsoft-authentication-library-for-android/pull/1103#pullrequestreview-453517919", "createdAt": "2020-07-22T17:07:40Z", "commit": {"oid": "e03ef8aef229b6117ac2e211f1dbacbbf861aaa7"}, "state": "COMMENTED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDUzNTIxMjU5", "url": "https://github.com/AzureAD/microsoft-authentication-library-for-android/pull/1103#pullrequestreview-453521259", "createdAt": "2020-07-22T17:12:05Z", "commit": {"oid": "e03ef8aef229b6117ac2e211f1dbacbbf861aaa7"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yMlQxNzoxMjowNlrOG1sL8Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yMlQxNzoxMjowNlrOG1sL8Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1ODk1MTY2NQ==", "bodyText": "When will these be declared in BaseController? These would need the @override annotation when that happens. I suggest opening a PR for common now to take care of that and then add the annotation here so that we don't have to open a separate PR later to address the annotation.", "url": "https://github.com/AzureAD/microsoft-authentication-library-for-android/pull/1103#discussion_r458951665", "createdAt": "2020-07-22T17:12:06Z", "author": {"login": "shahzaibj"}, "path": "msal/src/main/java/com/microsoft/identity/client/internal/controllers/BrokerMsalController.java", "diffHunk": "@@ -555,6 +557,16 @@ public void putValueInSuccessEvent(ApiEndEvent event, Boolean result) {\n                 });\n     }\n \n+    // Placeholder methods to avoid inheritance error (these methods will be declared in BaseController)\n+    // Also why the @Override annotation is missing\n+    public AuthorizationResult deviceCodeFlowAuthRequest(DeviceCodeFlowCommandParameters parameters) throws ClientException {\n+        throw new ClientException(\"deviceCodeFlowAuthRequest() not supported in BrokerMsalController\");\n+    }\n+\n+    public AcquireTokenResult acquireDeviceCodeFlowToken(AuthorizationResult authorizationResult) throws ClientException {\n+        throw new ClientException(\"deviceCodeFlowAuthRequest() not supported in BrokerMsalController\");\n+    }", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "e03ef8aef229b6117ac2e211f1dbacbbf861aaa7"}, "originalPosition": 28}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDUzNTIyMjI5", "url": "https://github.com/AzureAD/microsoft-authentication-library-for-android/pull/1103#pullrequestreview-453522229", "createdAt": "2020-07-22T17:13:20Z", "commit": {"oid": "e03ef8aef229b6117ac2e211f1dbacbbf861aaa7"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yMlQxNzoxMzoyMFrOG1sOrQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yMlQxNzoxMzoyMFrOG1sOrQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1ODk1MjM2NQ==", "bodyText": "Same feedback as given above for BrokerMsalController", "url": "https://github.com/AzureAD/microsoft-authentication-library-for-android/pull/1103#discussion_r458952365", "createdAt": "2020-07-22T17:13:20Z", "author": {"login": "shahzaibj"}, "path": "msal/src/main/java/com/microsoft/identity/client/internal/controllers/LocalMSALController.java", "diffHunk": "@@ -457,4 +458,15 @@ public boolean getDeviceMode(CommandParameters parameters) throws Exception {\n     public boolean removeCurrentAccount(RemoveAccountCommandParameters parameters) throws Exception {\n         return removeAccount(parameters);\n     }\n+\n+    // Placeholder methods to avoid inheritance error (these methods will be declared in BaseController)\n+    // Also why the @Override annotation is missing\n+    public AuthorizationResult deviceCodeFlowAuthRequest(DeviceCodeFlowCommandParameters parameters) throws Exception {\n+        // TODO: Placeholder to avoid inheritance error. Will be implemented after Command/Controller level PR in Common\n+        return null;\n+    }\n+    public AcquireTokenResult acquireDeviceCodeFlowToken(AuthorizationResult authorizationResult) throws Exception {\n+        // TODO: Placeholder to avoid inheritance error. Will be implemented after Command/Controller level PR in Common\n+        return null;\n+    }", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "e03ef8aef229b6117ac2e211f1dbacbbf861aaa7"}, "originalPosition": 22}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDUzNjU3NzQ2", "url": "https://github.com/AzureAD/microsoft-authentication-library-for-android/pull/1103#pullrequestreview-453657746", "createdAt": "2020-07-22T20:25:20Z", "commit": {"oid": "e03ef8aef229b6117ac2e211f1dbacbbf861aaa7"}, "state": "COMMENTED", "comments": {"totalCount": 7, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yMlQyMDoyNToyMFrOG1y58g==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yMlQyMDo0NDo0NFrOG1zh_Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1OTA2MTc0Ng==", "bodyText": "nit: NonNull final", "url": "https://github.com/AzureAD/microsoft-authentication-library-for-android/pull/1103#discussion_r459061746", "createdAt": "2020-07-22T20:25:20Z", "author": {"login": "rpdome"}, "path": "msal/src/main/java/com/microsoft/identity/client/IPublicClientApplication.java", "diffHunk": "@@ -162,4 +170,39 @@ void acquireToken(@NonNull final Activity activity,\n         void onError(final MsalException exception);\n     }\n \n+    /**\n+     * Callback object used in Device Code Flow.\n+     * This callback provides the following methods for communicating with the protocol.\n+     *                 1). Receiving authentication information (user_code, verification_uri, and instruction message)\n+     *                 via {@link DeviceCodeFlowCallback#onUserCodeReceived(String, String, String)}.\n+     *                 2). Receiving a successful authentication result containing a fresh access token\n+     *                 via {@link DeviceCodeFlowCallback#onTokenReceived(AuthenticationResult)}.\n+     *                 3). Receiving an exception detailing what went wrong in the protocol\n+     *                 via {@link DeviceCodeFlowCallback#onError(MsalException)}.\n+     */\n+    interface DeviceCodeFlowCallback {\n+        /**\n+         * Invoked to display verification uri, user code, and instruction message during device code flow.\n+         *\n+         * @param vUri verification uri\n+         * @param userCode user code\n+         * @param message instruction message\n+         */\n+        void onUserCodeReceived(@NonNull String vUri, @NonNull String userCode, @NonNull String message);\n+\n+        /**\n+         * Invoked once token is received and passes the {@link AuthenticationResult} object.\n+         *\n+         * @param authResult the authentication result\n+         */\n+        void onTokenReceived(AuthenticationResult authResult);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "e03ef8aef229b6117ac2e211f1dbacbbf861aaa7"}, "originalPosition": 51}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1OTA2MTkzMQ==", "bodyText": "nit: NonNull final", "url": "https://github.com/AzureAD/microsoft-authentication-library-for-android/pull/1103#discussion_r459061931", "createdAt": "2020-07-22T20:25:41Z", "author": {"login": "rpdome"}, "path": "msal/src/main/java/com/microsoft/identity/client/IPublicClientApplication.java", "diffHunk": "@@ -162,4 +170,39 @@ void acquireToken(@NonNull final Activity activity,\n         void onError(final MsalException exception);\n     }\n \n+    /**\n+     * Callback object used in Device Code Flow.\n+     * This callback provides the following methods for communicating with the protocol.\n+     *                 1). Receiving authentication information (user_code, verification_uri, and instruction message)\n+     *                 via {@link DeviceCodeFlowCallback#onUserCodeReceived(String, String, String)}.\n+     *                 2). Receiving a successful authentication result containing a fresh access token\n+     *                 via {@link DeviceCodeFlowCallback#onTokenReceived(AuthenticationResult)}.\n+     *                 3). Receiving an exception detailing what went wrong in the protocol\n+     *                 via {@link DeviceCodeFlowCallback#onError(MsalException)}.\n+     */\n+    interface DeviceCodeFlowCallback {\n+        /**\n+         * Invoked to display verification uri, user code, and instruction message during device code flow.\n+         *\n+         * @param vUri verification uri\n+         * @param userCode user code\n+         * @param message instruction message\n+         */\n+        void onUserCodeReceived(@NonNull String vUri, @NonNull String userCode, @NonNull String message);\n+\n+        /**\n+         * Invoked once token is received and passes the {@link AuthenticationResult} object.\n+         *\n+         * @param authResult the authentication result\n+         */\n+        void onTokenReceived(AuthenticationResult authResult);\n+\n+        /**\n+         * Invoked if an error is encountered during the device code flow and passes the exception object.\n+         *\n+         * @param error error exception\n+         */\n+        void onError(MsalException error);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "e03ef8aef229b6117ac2e211f1dbacbbf861aaa7"}, "originalPosition": 58}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1OTA2MzYzNg==", "bodyText": "nit: final", "url": "https://github.com/AzureAD/microsoft-authentication-library-for-android/pull/1103#discussion_r459063636", "createdAt": "2020-07-22T20:29:01Z", "author": {"login": "rpdome"}, "path": "msal/src/main/java/com/microsoft/identity/client/PublicClientApplication.java", "diffHunk": "@@ -1689,6 +1720,38 @@ public void onCancel() {\n         };\n     }\n \n+    protected DeviceCodeFlowCommandCallback getDeviceCodeFlowCommandCallback(@NonNull final DeviceCodeFlowCallback callback) {\n+        return new DeviceCodeFlowCommandCallback<LocalAuthenticationResult, MsalException>() {\n+            @Override\n+            public void onUserCodeReceived(@NonNull String vUri, @NonNull String userCode, @NonNull String message){\n+                callback.onUserCodeReceived(vUri, userCode, message);\n+            }\n+\n+            @Override\n+            public void onTaskCompleted(LocalAuthenticationResult tokenResult) {\n+                // Convert tokenResult to an AuthenticationResult object\n+                IAuthenticationResult convertedResult = AuthenticationResultAdapter.adapt(", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "e03ef8aef229b6117ac2e211f1dbacbbf861aaa7"}, "originalPosition": 79}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1OTA2MzcwNQ==", "bodyText": "nit: final", "url": "https://github.com/AzureAD/microsoft-authentication-library-for-android/pull/1103#discussion_r459063705", "createdAt": "2020-07-22T20:29:11Z", "author": {"login": "rpdome"}, "path": "msal/src/main/java/com/microsoft/identity/client/PublicClientApplication.java", "diffHunk": "@@ -1689,6 +1720,38 @@ public void onCancel() {\n         };\n     }\n \n+    protected DeviceCodeFlowCommandCallback getDeviceCodeFlowCommandCallback(@NonNull final DeviceCodeFlowCallback callback) {\n+        return new DeviceCodeFlowCommandCallback<LocalAuthenticationResult, MsalException>() {\n+            @Override\n+            public void onUserCodeReceived(@NonNull String vUri, @NonNull String userCode, @NonNull String message){\n+                callback.onUserCodeReceived(vUri, userCode, message);\n+            }\n+\n+            @Override\n+            public void onTaskCompleted(LocalAuthenticationResult tokenResult) {\n+                // Convert tokenResult to an AuthenticationResult object\n+                IAuthenticationResult convertedResult = AuthenticationResultAdapter.adapt(\n+                        tokenResult);\n+\n+                // Type cast the interface object\n+                AuthenticationResult authResult = (AuthenticationResult) convertedResult;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "e03ef8aef229b6117ac2e211f1dbacbbf861aaa7"}, "originalPosition": 83}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1OTA2NDEyMA==", "bodyText": "nit: Add a comment that this does not support brokered authentication.", "url": "https://github.com/AzureAD/microsoft-authentication-library-for-android/pull/1103#discussion_r459064120", "createdAt": "2020-07-22T20:29:55Z", "author": {"login": "rpdome"}, "path": "msal/src/main/java/com/microsoft/identity/client/IPublicClientApplication.java", "diffHunk": "@@ -84,6 +85,13 @@ void acquireToken(@NonNull final Activity activity,\n     @WorkerThread\n     IAuthenticationResult acquireTokenSilent(@NonNull final AcquireTokenSilentParameters acquireTokenSilentParameters) throws InterruptedException, MsalException;\n \n+    /**", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "e03ef8aef229b6117ac2e211f1dbacbbf861aaa7"}, "originalPosition": 12}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1OTA2OTIzMg==", "bodyText": "I guess I don't have enough context to answer this question. I agree with what you describe (that it should work, but I think we won't know for sure until we test it e2e.\nWe could add a comment (i.e. TODO here) and have that as a separate PR/ work item.", "url": "https://github.com/AzureAD/microsoft-authentication-library-for-android/pull/1103#discussion_r459069232", "createdAt": "2020-07-22T20:39:35Z", "author": {"login": "rpdome"}, "path": "msal/src/main/java/com/microsoft/identity/client/internal/CommandParametersAdapter.java", "diffHunk": "@@ -193,6 +195,33 @@ public static SilentTokenCommandParameters createSilentTokenCommandParameters(\n         return commandParameters;\n     }\n \n+    public static DeviceCodeFlowCommandParameters createDeviceCodeFlowCommandParameters(\n+            @NonNull final PublicClientApplicationConfiguration configuration,\n+            @NonNull final OAuth2TokenCache tokenCache,\n+            @NonNull String[] scopes){\n+\n+        final AbstractAuthenticationScheme authenticationScheme = new BearerAuthenticationSchemeInternal();", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1ODkyMzYxOQ=="}, "originalCommit": {"oid": "fb58f4a82aa5c3ee0c166152eac3293c7b93731d"}, "originalPosition": 20}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1OTA3MTk5Nw==", "bodyText": "+1. Should be declared in BaseController", "url": "https://github.com/AzureAD/microsoft-authentication-library-for-android/pull/1103#discussion_r459071997", "createdAt": "2020-07-22T20:44:44Z", "author": {"login": "rpdome"}, "path": "msal/src/main/java/com/microsoft/identity/client/internal/controllers/LocalMSALController.java", "diffHunk": "@@ -457,4 +458,15 @@ public boolean getDeviceMode(CommandParameters parameters) throws Exception {\n     public boolean removeCurrentAccount(RemoveAccountCommandParameters parameters) throws Exception {\n         return removeAccount(parameters);\n     }\n+\n+    // Placeholder methods to avoid inheritance error (these methods will be declared in BaseController)\n+    // Also why the @Override annotation is missing\n+    public AuthorizationResult deviceCodeFlowAuthRequest(DeviceCodeFlowCommandParameters parameters) throws Exception {\n+        // TODO: Placeholder to avoid inheritance error. Will be implemented after Command/Controller level PR in Common\n+        return null;\n+    }\n+    public AcquireTokenResult acquireDeviceCodeFlowToken(AuthorizationResult authorizationResult) throws Exception {\n+        // TODO: Placeholder to avoid inheritance error. Will be implemented after Command/Controller level PR in Common\n+        return null;\n+    }", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1ODk1MjM2NQ=="}, "originalCommit": {"oid": "e03ef8aef229b6117ac2e211f1dbacbbf861aaa7"}, "originalPosition": 22}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a191ae5f9ef9825c64ba2fe1cb04bf57264eedb9", "author": {"user": {"login": "t-fadura", "name": "Fadi Durah"}}, "url": "https://github.com/AzureAD/microsoft-authentication-library-for-android/commit/a191ae5f9ef9825c64ba2fe1cb04bf57264eedb9", "committedDate": "2020-07-23T12:21:41Z", "message": "Minor fixes"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a7d9a2cbe91c2b24b92d10f188071b16dd12c666", "author": {"user": {"login": "t-fadura", "name": "Fadi Durah"}}, "url": "https://github.com/AzureAD/microsoft-authentication-library-for-android/commit/a7d9a2cbe91c2b24b92d10f188071b16dd12c666", "committedDate": "2020-07-23T15:11:27Z", "message": "updated internal common module"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "0160efd7172b279d86d79e42e2b58254ed175884", "author": {"user": {"login": "t-fadura", "name": "Fadi Durah"}}, "url": "https://github.com/AzureAD/microsoft-authentication-library-for-android/commit/0160efd7172b279d86d79e42e2b58254ed175884", "committedDate": "2020-07-23T18:43:47Z", "message": "Added @Override annotation, added helper methods in LocalMsalController"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDU0NTQ0MzE5", "url": "https://github.com/AzureAD/microsoft-authentication-library-for-android/pull/1103#pullrequestreview-454544319", "createdAt": "2020-07-23T22:44:47Z", "commit": {"oid": "0160efd7172b279d86d79e42e2b58254ed175884"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yM1QyMjo0NDo0N1rOG2eDvg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yM1QyMjo0NDo0N1rOG2eDvg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1OTc2ODc2Ng==", "bodyText": "The formatting of this javadoc looks like it might be chewed up by the code formatter :/\nCan you do actrl + alt + l on this and confirm it won't get munged? If it doesn't all good, otherwise you might want to use some <p> or <li> tags to keep it formatted properly if/when formatter is run", "url": "https://github.com/AzureAD/microsoft-authentication-library-for-android/pull/1103#discussion_r459768766", "createdAt": "2020-07-23T22:44:47Z", "author": {"login": "iambmelt"}, "path": "msal/src/main/java/com/microsoft/identity/client/IPublicClientApplication.java", "diffHunk": "@@ -162,4 +171,39 @@ void acquireToken(@NonNull final Activity activity,\n         void onError(final MsalException exception);\n     }\n \n+    /**\n+     * Callback object used in Device Code Flow.\n+     * This callback provides the following methods for communicating with the protocol.\n+     *                 1). Receiving authentication information (user_code, verification_uri, and instruction message)", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "0160efd7172b279d86d79e42e2b58254ed175884"}, "originalPosition": 30}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDU0NTQ0NTQ1", "url": "https://github.com/AzureAD/microsoft-authentication-library-for-android/pull/1103#pullrequestreview-454544545", "createdAt": "2020-07-23T22:45:21Z", "commit": {"oid": "0160efd7172b279d86d79e42e2b58254ed175884"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yM1QyMjo0NToyMVrOG2eEnA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yM1QyMjo0NToyMVrOG2eEnA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1OTc2ODk4OA==", "bodyText": "Excellent javadocs here \ud83d\udc4d", "url": "https://github.com/AzureAD/microsoft-authentication-library-for-android/pull/1103#discussion_r459768988", "createdAt": "2020-07-23T22:45:21Z", "author": {"login": "iambmelt"}, "path": "msal/src/main/java/com/microsoft/identity/client/IPublicClientApplication.java", "diffHunk": "@@ -162,4 +171,39 @@ void acquireToken(@NonNull final Activity activity,\n         void onError(final MsalException exception);\n     }\n \n+    /**\n+     * Callback object used in Device Code Flow.\n+     * This callback provides the following methods for communicating with the protocol.\n+     *                 1). Receiving authentication information (user_code, verification_uri, and instruction message)\n+     *                 via {@link DeviceCodeFlowCallback#onUserCodeReceived(String, String, String)}.\n+     *                 2). Receiving a successful authentication result containing a fresh access token\n+     *                 via {@link DeviceCodeFlowCallback#onTokenReceived(AuthenticationResult)}.\n+     *                 3). Receiving an exception detailing what went wrong in the protocol\n+     *                 via {@link DeviceCodeFlowCallback#onError(MsalException)}.\n+     */\n+    interface DeviceCodeFlowCallback {\n+        /**\n+         * Invoked to display verification uri, user code, and instruction message during device code flow.\n+         *\n+         * @param vUri verification uri\n+         * @param userCode user code\n+         * @param message instruction message\n+         */\n+        void onUserCodeReceived(@NonNull String vUri, @NonNull String userCode, @NonNull String message);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "0160efd7172b279d86d79e42e2b58254ed175884"}, "originalPosition": 45}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDU0NTUyNDQx", "url": "https://github.com/AzureAD/microsoft-authentication-library-for-android/pull/1103#pullrequestreview-454552441", "createdAt": "2020-07-23T23:06:15Z", "commit": {"oid": "0160efd7172b279d86d79e42e2b58254ed175884"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yM1QyMzowNjoxNVrOG2efHw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yM1QyMzowNjoxNVrOG2efHw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1OTc3NTc3NQ==", "bodyText": "Should we call this something like acquireTokenWithDeviceCode()? This seems to be the naming that .NET used\n/cc @jennyf19", "url": "https://github.com/AzureAD/microsoft-authentication-library-for-android/pull/1103#discussion_r459775775", "createdAt": "2020-07-23T23:06:15Z", "author": {"login": "iambmelt"}, "path": "msal/src/main/java/com/microsoft/identity/client/IPublicClientApplication.java", "diffHunk": "@@ -84,6 +85,14 @@ void acquireToken(@NonNull final Activity activity,\n     @WorkerThread\n     IAuthenticationResult acquireTokenSilent(@NonNull final AcquireTokenSilentParameters acquireTokenSilentParameters) throws InterruptedException, MsalException;\n \n+    /**\n+     * Perform the Device Code Flow (DCF) protocol to allow a device without input capability to authenticate and get a new access token.\n+     * Currently, flow is only supported in local MSAL. No Broker support.\n+     * @param scopes the desired access scopes\n+     * @param callback callback object used to communicate with the API throughout the protocol\n+     */\n+    void deviceCodeFlow(@Nullable String[] scopes, @NonNull final DeviceCodeFlowCallback callback);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "0160efd7172b279d86d79e42e2b58254ed175884"}, "originalPosition": 18}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "8b1b5640b97cd7a2465d842e04b56a6d55458da1", "author": {"user": {"login": "t-fadura", "name": "Fadi Durah"}}, "url": "https://github.com/AzureAD/microsoft-authentication-library-for-android/commit/8b1b5640b97cd7a2465d842e04b56a6d55458da1", "committedDate": "2020-07-24T12:06:00Z", "message": "renamed api method"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDU0ODM1Njc0", "url": "https://github.com/AzureAD/microsoft-authentication-library-for-android/pull/1103#pullrequestreview-454835674", "createdAt": "2020-07-24T12:10:14Z", "commit": {"oid": "8b1b5640b97cd7a2465d842e04b56a6d55458da1"}, "state": "COMMENTED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b26dd13ea284e411e9cea42a96752b0c5ec95483", "author": {"user": {"login": "t-fadura", "name": "Fadi Durah"}}, "url": "https://github.com/AzureAD/microsoft-authentication-library-for-android/commit/b26dd13ea284e411e9cea42a96752b0c5ec95483", "committedDate": "2020-07-25T16:14:14Z", "message": "updated internal common"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDU1OTcxNTc1", "url": "https://github.com/AzureAD/microsoft-authentication-library-for-android/pull/1103#pullrequestreview-455971575", "createdAt": "2020-07-27T17:04:26Z", "commit": {"oid": "b26dd13ea284e411e9cea42a96752b0c5ec95483"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yN1QxNzowNDoyNlrOG3rhqw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yN1QxNzowNDoyNlrOG3rhqw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MTAzNzk5NQ==", "bodyText": "should this return MsalServiceException instead? Also may be this should go in the ExceptionAdapter class?", "url": "https://github.com/AzureAD/microsoft-authentication-library-for-android/pull/1103#discussion_r461037995", "createdAt": "2020-07-27T17:04:26Z", "author": {"login": "shahzaibj"}, "path": "msal/src/main/java/com/microsoft/identity/client/internal/controllers/LocalMSALController.java", "diffHunk": "@@ -457,4 +461,35 @@ public boolean getDeviceMode(CommandParameters parameters) throws Exception {\n     public boolean removeCurrentAccount(RemoveAccountCommandParameters parameters) throws Exception {\n         return removeAccount(parameters);\n     }\n+\n+    @Override\n+    public AuthorizationResult deviceCodeFlowAuthRequest(final DeviceCodeFlowCommandParameters parameters) throws Exception {\n+        // TODO: Placeholder to avoid inheritance error. Will be implemented after Command/Controller level PR in Common\n+        return null;\n+    }\n+\n+    @Override\n+    public AcquireTokenResult acquireDeviceCodeFlowToken(final AuthorizationResult authorizationResult, DeviceCodeFlowCommandParameters commandParameters) throws Exception {\n+        // TODO: Placeholder to avoid inheritance error. Will be implemented after Command/Controller level PR in Common\n+        return null;\n+    }\n+\n+    /**\n+     * Helper method to check if a result object is valid (was a success). If not, an exception will be generated and thrown.\n+     * @param result result object to be checked\n+     * @throws MsalServiceException MsalServiceException object reflecting error code returned by the result\n+     */\n+    private void validateServiceResult(@NonNull IResult result) throws MsalServiceException {\n+        //TODO: Will be implemented after Command/Controller level PR in Common\n+    }\n+\n+    /**\n+     * Given an error response object, create a serviceException object using the predefined error codes.\n+     * @param response error response object to be checked\n+     * @return an exception object\n+     */\n+    private ServiceException createServiceExceptionFromErrorResponse(IErrorResponse response) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b26dd13ea284e411e9cea42a96752b0c5ec95483"}, "originalPosition": 56}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDU1OTczOTY1", "url": "https://github.com/AzureAD/microsoft-authentication-library-for-android/pull/1103#pullrequestreview-455973965", "createdAt": "2020-07-27T17:07:45Z", "commit": {"oid": "b26dd13ea284e411e9cea42a96752b0c5ec95483"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDU2MDQ3MDQ0", "url": "https://github.com/AzureAD/microsoft-authentication-library-for-android/pull/1103#pullrequestreview-456047044", "createdAt": "2020-07-27T18:51:05Z", "commit": {"oid": "b26dd13ea284e411e9cea42a96752b0c5ec95483"}, "state": "APPROVED", "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yN1QxODo1MTowNVrOG3vONQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yN1QxOTowMTozN1rOG3vkqA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MTA5ODU0OQ==", "bodyText": "super minor nit: put a link to the device code flow protocol here.", "url": "https://github.com/AzureAD/microsoft-authentication-library-for-android/pull/1103#discussion_r461098549", "createdAt": "2020-07-27T18:51:05Z", "author": {"login": "rpdome"}, "path": "msal/src/main/java/com/microsoft/identity/client/IPublicClientApplication.java", "diffHunk": "@@ -162,4 +171,39 @@ void acquireToken(@NonNull final Activity activity,\n         void onError(final MsalException exception);\n     }\n \n+    /**\n+     * Callback object used in Device Code Flow.\n+     * This callback provides the following methods for communicating with the protocol.\n+     * 1). Receiving authentication information (user_code, verification_uri, and instruction message)\n+     * via {@link DeviceCodeFlowCallback#onUserCodeReceived(String, String, String)}.\n+     * 2). Receiving a successful authentication result containing a fresh access token\n+     * via {@link DeviceCodeFlowCallback#onTokenReceived(AuthenticationResult)}.\n+     * 3). Receiving an exception detailing what went wrong in the protocol\n+     * via {@link DeviceCodeFlowCallback#onError(MsalException)}.\n+     */\n+    interface DeviceCodeFlowCallback {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b26dd13ea284e411e9cea42a96752b0c5ec95483"}, "originalPosition": 37}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MTEwMjg4Nw==", "bodyText": "I'd suggest renaming it to be DCF-specific. (You can even remove it for now, since this is not really required in this PR).", "url": "https://github.com/AzureAD/microsoft-authentication-library-for-android/pull/1103#discussion_r461102887", "createdAt": "2020-07-27T18:58:58Z", "author": {"login": "rpdome"}, "path": "msal/src/main/java/com/microsoft/identity/client/internal/controllers/LocalMSALController.java", "diffHunk": "@@ -457,4 +461,35 @@ public boolean getDeviceMode(CommandParameters parameters) throws Exception {\n     public boolean removeCurrentAccount(RemoveAccountCommandParameters parameters) throws Exception {\n         return removeAccount(parameters);\n     }\n+\n+    @Override\n+    public AuthorizationResult deviceCodeFlowAuthRequest(final DeviceCodeFlowCommandParameters parameters) throws Exception {\n+        // TODO: Placeholder to avoid inheritance error. Will be implemented after Command/Controller level PR in Common\n+        return null;\n+    }\n+\n+    @Override\n+    public AcquireTokenResult acquireDeviceCodeFlowToken(final AuthorizationResult authorizationResult, DeviceCodeFlowCommandParameters commandParameters) throws Exception {\n+        // TODO: Placeholder to avoid inheritance error. Will be implemented after Command/Controller level PR in Common\n+        return null;\n+    }\n+\n+    /**\n+     * Helper method to check if a result object is valid (was a success). If not, an exception will be generated and thrown.\n+     * @param result result object to be checked\n+     * @throws MsalServiceException MsalServiceException object reflecting error code returned by the result\n+     */\n+    private void validateServiceResult(@NonNull IResult result) throws MsalServiceException {\n+        //TODO: Will be implemented after Command/Controller level PR in Common\n+    }\n+\n+    /**\n+     * Given an error response object, create a serviceException object using the predefined error codes.\n+     * @param response error response object to be checked\n+     * @return an exception object\n+     */\n+    private ServiceException createServiceExceptionFromErrorResponse(IErrorResponse response) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MTAzNzk5NQ=="}, "originalCommit": {"oid": "b26dd13ea284e411e9cea42a96752b0c5ec95483"}, "originalPosition": 56}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MTEwNDI5Ng==", "bodyText": "Yes, DCF has to be turned on. If no one has started the thread, let's create a work item and we can pick that up later.", "url": "https://github.com/AzureAD/microsoft-authentication-library-for-android/pull/1103#discussion_r461104296", "createdAt": "2020-07-27T19:01:37Z", "author": {"login": "rpdome"}, "path": "msal/src/test/res/raw/single_account_dcf_test_config.json", "diffHunk": "@@ -0,0 +1,12 @@\n+{\n+  \"client_id\": \"d335d85e-5aa7-4f03-8c2f-81b2699f30a6\",\n+  \"authorization_user_agent\": \"DEFAULT\",\n+  \"redirect_uri\": \"msauth://com.onmicrosoft.fadiorgorg/1wIqXSqBj7w%2Bh11ZifsnqwgyKrY%3D\",", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1ODkyMTUxMg=="}, "originalCommit": {"oid": "fb58f4a82aa5c3ee0c166152eac3293c7b93731d"}, "originalPosition": 4}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "bb20b265d66ff829a23d48e38599fa7edfff1f8a", "author": {"user": {"login": "t-fadura", "name": "Fadi Durah"}}, "url": "https://github.com/AzureAD/microsoft-authentication-library-for-android/commit/bb20b265d66ff829a23d48e38599fa7edfff1f8a", "committedDate": "2020-07-27T19:38:07Z", "message": "Removed empty private methods in LocalMsalController"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "5ac0fc099596d4e19732d99bca61a87eebf35ad3", "author": {"user": {"login": "t-fadura", "name": "Fadi Durah"}}, "url": "https://github.com/AzureAD/microsoft-authentication-library-for-android/commit/5ac0fc099596d4e19732d99bca61a87eebf35ad3", "committedDate": "2020-07-27T20:00:30Z", "message": "updated internal"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "2050b057a360984f6d6ab2018979f8cb0e88a5a2", "author": {"user": {"login": "t-fadura", "name": "Fadi Durah"}}, "url": "https://github.com/AzureAD/microsoft-authentication-library-for-android/commit/2050b057a360984f6d6ab2018979f8cb0e88a5a2", "committedDate": "2020-07-27T20:05:26Z", "message": "Merge branch 'dev' into t-fadura/dcf-main"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1230, "cost": 1, "resetAt": "2021-11-01T11:59:11Z"}}}