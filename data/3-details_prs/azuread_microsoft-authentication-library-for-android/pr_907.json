{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0MzY4ODM4MjAy", "number": 907, "title": "First Draft, AT PoP Docs (Preview)", "bodyText": "Uploads 1-Pager for AT/PoP integration -- this is a preview feature", "createdAt": "2020-01-30T00:52:34Z", "url": "https://github.com/AzureAD/microsoft-authentication-library-for-android/pull/907", "merged": true, "mergeCommit": {"oid": "6db8ec284475138d38705aa6167b82badbce6007"}, "closed": true, "closedAt": "2020-01-31T17:21:14Z", "author": {"login": "iambmelt"}, "timelineItems": {"totalCount": 8, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABb_PuIHgH2gAyMzY4ODM4MjAyOjM0YWVkYzJkYzIxZGYxNmNjMDZlYjYwNzRlYjExZTQzYTdlYmZjZGI=", "endCursor": "Y3Vyc29yOnYyOpPPAAABb_yeCMgH2gAyMzY4ODM4MjAyOmFmYmU1YzkyMWYxOWI5OTAwZWJhNDlhNGI2ZThjZDc1NTNiMzY4ZjI=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "34aedc2dc21df16cc06eb6074eb11e43a7ebfcdb", "author": {"user": {"login": "iambmelt", "name": "Brian Melton-Grace"}}, "url": "https://github.com/AzureAD/microsoft-authentication-library-for-android/commit/34aedc2dc21df16cc06eb6074eb11e43a7ebfcdb", "committedDate": "2020-01-30T00:51:07Z", "message": "First Draft, AT PoP"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzUwNTI1OTY3", "url": "https://github.com/AzureAD/microsoft-authentication-library-for-android/pull/907#pullrequestreview-350525967", "createdAt": "2020-01-30T00:57:41Z", "commit": {"oid": "34aedc2dc21df16cc06eb6074eb11e43a7ebfcdb"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0zMFQwMDo1Nzo0MVrOFjcijQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0zMFQwMDo1Nzo0MVrOFjcijQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MjcxMjA3Nw==", "bodyText": "minus any", "url": "https://github.com/AzureAD/microsoft-authentication-library-for-android/pull/907#discussion_r372712077", "createdAt": "2020-01-30T00:57:41Z", "author": {"login": "iambmelt"}, "path": "docs/access_token-pop.md", "diffHunk": "@@ -0,0 +1,99 @@\n+# (Preview) MSAL Android: Requesting Proof of Possession Protected Access Tokens\n+\n+## What is a PoP/AT?\n+To understand the purpose and benefits offered by PoP, it is important to understand the security posture of a standard Bearer token.\n+\n+A standard access token from Azure Active Directory (AAD) is a Bearer token in JWT format corresponding to [RFC-7523](https://tools.ietf.org/html/rfc7523). These tokens can be used by anyone possessing the token to access the audience (`aud`) described in the JWT. Because a Bearer token may be used by anyone in possession of it, it is possible that malicious actors may replay tokens that have been leaked by resources or intercepted over the wire from break-and-inspect proxies against a resource to access protected systems or data.\n+\n+Proof of Possession (PoP) increases the security posture of these tokens embedding them inside of a JWT envelope and signing (binding) that JWT with RSA key material. The key material is generated on the device which was originally issued the tokens and never leaves it. The resulting JWT is called the Signed HTTP Request (SHR). This binding renders the access token unusable without a recent proof for the target resource endpoint.\n+\n+## How long is a PoP/AT valid?\n+By default, Bearer access tokens issued by AAD have a 1 hour validity. The validity of the Signed HTTP Request may be shorter, depending on the resource middleware configuration.\n+\n+When an SHR is created by the client, a timestamp (`ts`) claim is embedded in the JWT. The resource middleware will, upon receipt of the token, inspect its signature and timestamp to ensure integrity (anti-tamper protection) and validity (non-expiry). By default, the SAL middleware honors a 5 minute validity period meaning that once an SHR been signed by the client it may be used for 5 minutes before the resource will require a newly signed access token.\n+\n+## Can I continue to use Bearer flows in my application?\n+Yes! PoP and Bearer flows may be used interchangeably with MSAL and with supported broker versions **so long as the targeted resource supports it**.\n+\n+## Which devices support PoP?\n+MSAL supports PoP on Android devices running Android 4.3 Jelly Bean (API 18) or higher.\n+\n+## Configure MSAL for use with PoP\n+In order to use PoP with MSAL, the `minimum_required_broker_protocol_version` must be `\"4.0\"`. If you application only makes use of Bearer flows, `\"3.0\"` will work.\n+\n+`app_config.json`\n+```json\n+{\n+  \"client_id\" : \"4b0db8c2-9f26-4417-8bde-3f0e3656f8e0\",\n+  \"redirect_uri\" : \"msauth://com.microsoft.identity.client.sample.local/1wIqXSqBj7w%2Bh11ZifsnqwgyKrY%3D\",\n+  \"broker_redirect_uri_registered\": true,\n+  \"minimum_required_broker_protocol_version\" : \"4.0\",\n+  \"authorities\" : [\n+    {\n+      \"type\": \"AAD\",\n+      \"audience\": {\n+        \"type\": \"AzureADandPersonalMicrosoftAccount\"\n+      },\n+      \"default\": true\n+    }\n+  ]\n+}\n+```\n+\n+### Supply Necessary Parameters to `AcquireToken` & `AcquireTokenSilent`\n+In order to use PoP, additional arguments are required when creating your `AcquireTokenParameters` and `AcquireTokenSilentParameters`.\n+\n+In the below example, additional parameters are provided via `withAuthenticationScheme()`.\n+\n+```java\n+AcquireTokenParameters parameters = new AcquireTokenParameters.Builder()\n+         .startAuthorizationFromActivity(activity)\n+         .withScopes(...)\n+         .withLoginHint(....)\n+         .withPrompt(...)\n+         .withCallback(...)\n+         .withAuthenticationScheme(\n+             PoPAuthenticationScheme.builder()\n+                 .withMethod(HttpMethod.GET) // The HTTP method used to request the resource\n+                 .withUrl(url) // The URL of the resource server\n+                 .build()\n+         ).build()\n+\n+AuthenticationResultFuture result = pca.acquireToken(parameters);\n+```\n+\n+## Using the resulting Signed HTTP Request\n+>Note: The following methods are a _subset_ of those provided via MSAL's `AuthenticationResult`. For a complete look at the methods and accessors provided on this class, consult the javadoc available via GitHub.\n+\n+#### Get the fully formed `Authorization` header\n+```java\n+@Override\n+public void onSuccess(final IAuthenticationResult authenticationResult) {\n+    // The below value contains both the SHR and the auth scheme as a prefix\n+    // ex: PoP eyJhbGciOiJSU(...)\n+    final String authorizationHeader = authenticationResult.getAuthorizationHeader();\n+}\n+```\n+\n+#### Get the SHR\n+```java\n+@Override\n+public void onSuccess(final IAuthenticationResult authenticationResult) {\n+    // Uses the existing MSAL method, this method returns the SHR minus and scheme-prefix.", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "34aedc2dc21df16cc06eb6074eb11e43a7ebfcdb"}, "originalPosition": 82}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzUwNTI2NzEw", "url": "https://github.com/AzureAD/microsoft-authentication-library-for-android/pull/907#pullrequestreview-350526710", "createdAt": "2020-01-30T01:00:07Z", "commit": {"oid": "34aedc2dc21df16cc06eb6074eb11e43a7ebfcdb"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0zMFQwMTowMDowN1rOFjck-Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0zMFQwMTowMDowN1rOFjck-Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MjcxMjY5Nw==", "bodyText": "variable name is wrong (thx @shahzaibj)", "url": "https://github.com/AzureAD/microsoft-authentication-library-for-android/pull/907#discussion_r372712697", "createdAt": "2020-01-30T01:00:07Z", "author": {"login": "iambmelt"}, "path": "docs/access_token-pop.md", "diffHunk": "@@ -0,0 +1,99 @@\n+# (Preview) MSAL Android: Requesting Proof of Possession Protected Access Tokens\n+\n+## What is a PoP/AT?\n+To understand the purpose and benefits offered by PoP, it is important to understand the security posture of a standard Bearer token.\n+\n+A standard access token from Azure Active Directory (AAD) is a Bearer token in JWT format corresponding to [RFC-7523](https://tools.ietf.org/html/rfc7523). These tokens can be used by anyone possessing the token to access the audience (`aud`) described in the JWT. Because a Bearer token may be used by anyone in possession of it, it is possible that malicious actors may replay tokens that have been leaked by resources or intercepted over the wire from break-and-inspect proxies against a resource to access protected systems or data.\n+\n+Proof of Possession (PoP) increases the security posture of these tokens embedding them inside of a JWT envelope and signing (binding) that JWT with RSA key material. The key material is generated on the device which was originally issued the tokens and never leaves it. The resulting JWT is called the Signed HTTP Request (SHR). This binding renders the access token unusable without a recent proof for the target resource endpoint.\n+\n+## How long is a PoP/AT valid?\n+By default, Bearer access tokens issued by AAD have a 1 hour validity. The validity of the Signed HTTP Request may be shorter, depending on the resource middleware configuration.\n+\n+When an SHR is created by the client, a timestamp (`ts`) claim is embedded in the JWT. The resource middleware will, upon receipt of the token, inspect its signature and timestamp to ensure integrity (anti-tamper protection) and validity (non-expiry). By default, the SAL middleware honors a 5 minute validity period meaning that once an SHR been signed by the client it may be used for 5 minutes before the resource will require a newly signed access token.\n+\n+## Can I continue to use Bearer flows in my application?\n+Yes! PoP and Bearer flows may be used interchangeably with MSAL and with supported broker versions **so long as the targeted resource supports it**.\n+\n+## Which devices support PoP?\n+MSAL supports PoP on Android devices running Android 4.3 Jelly Bean (API 18) or higher.\n+\n+## Configure MSAL for use with PoP\n+In order to use PoP with MSAL, the `minimum_required_broker_protocol_version` must be `\"4.0\"`. If you application only makes use of Bearer flows, `\"3.0\"` will work.\n+\n+`app_config.json`\n+```json\n+{\n+  \"client_id\" : \"4b0db8c2-9f26-4417-8bde-3f0e3656f8e0\",\n+  \"redirect_uri\" : \"msauth://com.microsoft.identity.client.sample.local/1wIqXSqBj7w%2Bh11ZifsnqwgyKrY%3D\",\n+  \"broker_redirect_uri_registered\": true,\n+  \"minimum_required_broker_protocol_version\" : \"4.0\",\n+  \"authorities\" : [\n+    {\n+      \"type\": \"AAD\",\n+      \"audience\": {\n+        \"type\": \"AzureADandPersonalMicrosoftAccount\"\n+      },\n+      \"default\": true\n+    }\n+  ]\n+}\n+```\n+\n+### Supply Necessary Parameters to `AcquireToken` & `AcquireTokenSilent`\n+In order to use PoP, additional arguments are required when creating your `AcquireTokenParameters` and `AcquireTokenSilentParameters`.\n+\n+In the below example, additional parameters are provided via `withAuthenticationScheme()`.\n+\n+```java\n+AcquireTokenParameters parameters = new AcquireTokenParameters.Builder()\n+         .startAuthorizationFromActivity(activity)\n+         .withScopes(...)\n+         .withLoginHint(....)\n+         .withPrompt(...)\n+         .withCallback(...)\n+         .withAuthenticationScheme(\n+             PoPAuthenticationScheme.builder()\n+                 .withMethod(HttpMethod.GET) // The HTTP method used to request the resource\n+                 .withUrl(url) // The URL of the resource server\n+                 .build()\n+         ).build()\n+\n+AuthenticationResultFuture result = pca.acquireToken(parameters);\n+```\n+\n+## Using the resulting Signed HTTP Request\n+>Note: The following methods are a _subset_ of those provided via MSAL's `AuthenticationResult`. For a complete look at the methods and accessors provided on this class, consult the javadoc available via GitHub.\n+\n+#### Get the fully formed `Authorization` header\n+```java\n+@Override\n+public void onSuccess(final IAuthenticationResult authenticationResult) {\n+    // The below value contains both the SHR and the auth scheme as a prefix\n+    // ex: PoP eyJhbGciOiJSU(...)\n+    final String authorizationHeader = authenticationResult.getAuthorizationHeader();\n+}\n+```\n+\n+#### Get the SHR\n+```java\n+@Override\n+public void onSuccess(final IAuthenticationResult authenticationResult) {\n+    // Uses the existing MSAL method, this method returns the SHR minus and scheme-prefix.\n+    final String shr = authenticationResult.getAccessToken();\n+}\n+```\n+\n+#### Get the auth scheme\n+```java\n+@Override\n+public void onSuccess(final IAuthenticationResult authenticationResult) {\n+    // Returns \"Bearer\", \"pop\", or whichever scheme was used to acquire this token\n+    // Note that authentication scheme prefixes are case insensitive\n+    final String shr = authenticationResult.getAuthenticationScheme();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "34aedc2dc21df16cc06eb6074eb11e43a7ebfcdb"}, "originalPosition": 93}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ffbce7315819aca55e3af0e362cca84445d4163f", "author": {"user": {"login": "iambmelt", "name": "Brian Melton-Grace"}}, "url": "https://github.com/AzureAD/microsoft-authentication-library-for-android/commit/ffbce7315819aca55e3af0e362cca84445d4163f", "committedDate": "2020-01-30T01:01:47Z", "message": "Update access_token-pop.md"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzUwNTI3NjE3", "url": "https://github.com/AzureAD/microsoft-authentication-library-for-android/pull/907#pullrequestreview-350527617", "createdAt": "2020-01-30T01:02:59Z", "commit": {"oid": "ffbce7315819aca55e3af0e362cca84445d4163f"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzUwNTQxMTUw", "url": "https://github.com/AzureAD/microsoft-authentication-library-for-android/pull/907#pullrequestreview-350541150", "createdAt": "2020-01-30T01:52:28Z", "commit": {"oid": "ffbce7315819aca55e3af0e362cca84445d4163f"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0zMFQwMTo1MjoyOFrOFjdVIA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0zMFQwMTo1MjoyOFrOFjdVIA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MjcyNTAyNA==", "bodyText": "Do you think if we should call out that the one we expose in AcquireTokenResult is not going to match this 5 minute value (and they shouldn't rely on that - instead, they should always be calling MSAL to get a newly-minted token instead of caching it)", "url": "https://github.com/AzureAD/microsoft-authentication-library-for-android/pull/907#discussion_r372725024", "createdAt": "2020-01-30T01:52:28Z", "author": {"login": "rpdome"}, "path": "docs/access_token-pop.md", "diffHunk": "@@ -0,0 +1,99 @@\n+# (Preview) MSAL Android: Requesting Proof of Possession Protected Access Tokens\n+\n+## What is a PoP/AT?\n+To understand the purpose and benefits offered by PoP, it is important to understand the security posture of a standard Bearer token.\n+\n+A standard access token from Azure Active Directory (AAD) is a Bearer token in JWT format corresponding to [RFC-7523](https://tools.ietf.org/html/rfc7523). These tokens can be used by anyone possessing the token to access the audience (`aud`) described in the JWT. Because a Bearer token may be used by anyone in possession of it, it is possible that malicious actors may replay tokens that have been leaked by resources or intercepted over the wire from break-and-inspect proxies against a resource to access protected systems or data.\n+\n+Proof of Possession (PoP) increases the security posture of these tokens embedding them inside of a JWT envelope and signing (binding) that JWT with RSA key material. The key material is generated on the device which was originally issued the tokens and never leaves it. The resulting JWT is called the Signed HTTP Request (SHR). This binding renders the access token unusable without a recent proof for the target resource endpoint.\n+\n+## How long is a PoP/AT valid?\n+By default, Bearer access tokens issued by AAD have a 1 hour validity. The validity of the Signed HTTP Request may be shorter, depending on the resource middleware configuration.\n+\n+When an SHR is created by the client, a timestamp (`ts`) claim is embedded in the JWT. The resource middleware will, upon receipt of the token, inspect its signature and timestamp to ensure integrity (anti-tamper protection) and validity (non-expiry). By default, the SAL middleware honors a 5 minute validity period meaning that once an SHR been signed by the client it may be used for 5 minutes before the resource will require a newly signed access token.", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ffbce7315819aca55e3af0e362cca84445d4163f"}, "originalPosition": 13}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzUwNTQxODM4", "url": "https://github.com/AzureAD/microsoft-authentication-library-for-android/pull/907#pullrequestreview-350541838", "createdAt": "2020-01-30T01:55:20Z", "commit": {"oid": "ffbce7315819aca55e3af0e362cca84445d4163f"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "afbe5c921f19b9900eba49a4b6e8cd7553b368f2", "author": {"user": {"login": "iambmelt", "name": "Brian Melton-Grace"}}, "url": "https://github.com/AzureAD/microsoft-authentication-library-for-android/commit/afbe5c921f19b9900eba49a4b6e8cd7553b368f2", "committedDate": "2020-01-31T17:20:13Z", "message": "Update access_token-pop.md"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1311, "cost": 1, "resetAt": "2021-11-01T11:59:11Z"}}}