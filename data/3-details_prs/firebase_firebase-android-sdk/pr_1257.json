{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0Mzc3NDk2NTg5", "number": 1257, "title": "Make FIAM correctly fetch on first open", "bodyText": "", "createdAt": "2020-02-20T01:01:36Z", "url": "https://github.com/firebase/firebase-android-sdk/pull/1257", "merged": true, "mergeCommit": {"oid": "c7343d690b5c3315d9a5a8d7e5cb0e4435348310"}, "closed": true, "closedAt": "2020-02-27T01:34:57Z", "author": {"login": "JasonAHeron"}, "timelineItems": {"totalCount": 18, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcIOhhrABqjMwNzU2ODc4MjQ=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcIQo-ngH2gAyMzc3NDk2NTg5OjlmZTllMjQxYTY2YmNkYWZiODI5ZDY3Yzg3MWMzZWExYTlmN2FmN2Q=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "5ce17a56d80325c3d916c6b19ad188f50bdaef58", "author": {"user": {"login": "JasonAHeron", "name": "Jason Heron"}}, "url": "https://github.com/firebase/firebase-android-sdk/commit/5ce17a56d80325c3d916c6b19ad188f50bdaef58", "committedDate": "2020-02-26T20:03:47Z", "message": "make it async"}, "afterCommit": {"oid": "8cb335910d1ce084eee287b34e8fd7794b849183", "author": {"user": {"login": "JasonAHeron", "name": "Jason Heron"}}, "url": "https://github.com/firebase/firebase-android-sdk/commit/8cb335910d1ce084eee287b34e8fd7794b849183", "committedDate": "2020-02-26T22:32:09Z", "message": "make it async"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzYyMzAzMzMx", "url": "https://github.com/firebase/firebase-android-sdk/pull/1257#pullrequestreview-362303331", "createdAt": "2020-02-20T23:17:09Z", "commit": {"oid": "222fb10370829260f27d5eb3a38d632a8469c627"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yMFQyMzoxNzowOVrOFsmgvQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yNlQyMzozODo1NFrOFvAWDw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MjMxMjYzNw==", "bodyText": "can we name this something else? From the code, its hard to understand whether displayMessage is being called on this listener or the object level one.", "url": "https://github.com/firebase/firebase-android-sdk/pull/1257#discussion_r382312637", "createdAt": "2020-02-20T23:17:09Z", "author": {"login": "prakhar1989"}, "path": "firebase-inappmessaging/src/main/java/com/google/firebase/inappmessaging/FirebaseInAppMessaging.java", "diffHunk": "@@ -162,21 +164,29 @@ public boolean areMessagesSuppressed() {\n   }\n \n   private void initializeFiam() {\n-    Disposable unusedSubscription =\n-        inAppMessageStreamManager\n-            .createFirebaseInAppMessageStream()\n-            .subscribe(\n-                triggeredInAppMessage ->\n-                    listener\n-                        .doOnSuccess(\n-                            listener -> {\n-                              listener.displayMessage(\n-                                  triggeredInAppMessage.getInAppMessage(),\n-                                  displayCallbacksFactory.generateDisplayCallback(\n-                                      triggeredInAppMessage.getInAppMessage(),\n-                                      triggeredInAppMessage.getTriggeringEvent()));\n-                            })\n-                        .subscribe());\n+    FirebaseInstanceId.getInstance()\n+        .getInstanceId()\n+        .addOnSuccessListener(\n+            new OnSuccessListener<InstanceIdResult>() {\n+              @Override\n+              public void onSuccess(InstanceIdResult instanceIdResult) {\n+                Disposable unusedSubscription =\n+                    inAppMessageStreamManager\n+                        .createFirebaseInAppMessageStream()\n+                        .subscribe(\n+                            triggeredInAppMessage ->\n+                                listener\n+                                    .doOnSuccess(\n+                                        listener -> {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "222fb10370829260f27d5eb3a38d632a8469c627"}, "originalPosition": 61}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NDgyODMyNg==", "bodyText": "why do we need this method?", "url": "https://github.com/firebase/firebase-android-sdk/pull/1257#discussion_r384828326", "createdAt": "2020-02-26T23:24:27Z", "author": {"login": "prakhar1989"}, "path": "firebase-inappmessaging/src/main/java/com/google/firebase/inappmessaging/FirebaseInAppMessaging.java", "diffHunk": "@@ -161,53 +163,33 @@ public boolean areMessagesSuppressed() {\n     return areMessagesSuppressed;\n   }\n \n-  private void initializeFiam() {\n-    Disposable unusedSubscription =\n-        inAppMessageStreamManager\n-            .createFirebaseInAppMessageStream()\n-            .subscribe(\n-                triggeredInAppMessage ->\n-                    listener\n-                        .doOnSuccess(\n-                            listener -> {\n-                              listener.displayMessage(\n-                                  triggeredInAppMessage.getInAppMessage(),\n-                                  displayCallbacksFactory.generateDisplayCallback(\n-                                      triggeredInAppMessage.getInAppMessage(),\n-                                      triggeredInAppMessage.getTriggeringEvent()));\n-                            })\n-                        .subscribe());\n-  }\n-\n   /*\n    * Called to set a new message display component for FIAM SDK. This is the method used\n    * by both the default FIAM display SDK or any app wanting to customize the message\n    * display.\n    */\n   @Keep\n   public void setMessageDisplayComponent(@NonNull FirebaseInAppMessagingDisplay messageDisplay) {\n-    Logging.logi(\"Setting display event listener\");\n-    this.listener = Maybe.just(messageDisplay);\n+    Logging.logi(\"Setting display event component\");\n+    this.fiamDisplay = messageDisplay;\n   }\n \n   /**\n-   * Unregisters a listener to in app message display events.\n+   * Unregisters a fiamDisplay to in app message display events.\n    *\n    * @hide\n    */\n   @Keep\n   @KeepForSdk\n   public void clearDisplayListener() {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b646d51c282812f047adde06925264fe32bb9fb5"}, "originalPosition": 106}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NDgzMzAzOQ==", "bodyText": "should this be task to single? http://reactivex.io/RxJava/3.x/javadoc/io/reactivex/rxjava3/core/Single.html", "url": "https://github.com/firebase/firebase-android-sdk/pull/1257#discussion_r384833039", "createdAt": "2020-02-26T23:38:54Z", "author": {"login": "prakhar1989"}, "path": "firebase-inappmessaging/src/main/java/com/google/firebase/inappmessaging/internal/InAppMessageStreamManager.java", "diffHunk": "@@ -233,7 +234,7 @@ private boolean shouldIgnoreCache(String event) {\n \n               Function<CampaignImpressionList, Maybe<FetchEligibleCampaignsResponse>> serviceFetch =\n                   impressions ->\n-                      Maybe.fromCallable(() -> apiClient.getFiams(impressions))\n+                      taskToMaybe(apiClient.getFiams(impressions))", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b646d51c282812f047adde06925264fe32bb9fb5"}, "originalPosition": 13}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "7e76835e0c9e5a81377d173900b1d693e8a2745a", "author": {"user": {"login": "JasonAHeron", "name": "Jason Heron"}}, "url": "https://github.com/firebase/firebase-android-sdk/commit/7e76835e0c9e5a81377d173900b1d693e8a2745a", "committedDate": "2020-02-26T23:59:39Z", "message": "kk"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "24da475aae314a3183bddc9cd9a5c85db46032aa", "author": {"user": {"login": "JasonAHeron", "name": "Jason Heron"}}, "url": "https://github.com/firebase/firebase-android-sdk/commit/24da475aae314a3183bddc9cd9a5c85db46032aa", "committedDate": "2020-02-26T23:59:39Z", "message": "derpawalrus"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "991e98834afa065e0416d191f1d8885543133485", "author": {"user": {"login": "JasonAHeron", "name": "Jason Heron"}}, "url": "https://github.com/firebase/firebase-android-sdk/commit/991e98834afa065e0416d191f1d8885543133485", "committedDate": "2020-02-26T23:59:39Z", "message": "cleanitup"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "9d1ba00ea26ba3478328723e81f79d3811abde80", "author": {"user": {"login": "JasonAHeron", "name": "Jason Heron"}}, "url": "https://github.com/firebase/firebase-android-sdk/commit/9d1ba00ea26ba3478328723e81f79d3811abde80", "committedDate": "2020-02-26T23:59:39Z", "message": "remove absolute garbage"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "684adc31aaa656912c30cb35473327bbe1d62f62", "author": {"user": {"login": "JasonAHeron", "name": "Jason Heron"}}, "url": "https://github.com/firebase/firebase-android-sdk/commit/684adc31aaa656912c30cb35473327bbe1d62f62", "committedDate": "2020-02-26T23:59:39Z", "message": "wow its not broken"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "4a82d6e22848c794978c07a5fe1b40457b3ea3a1", "author": {"user": {"login": "JasonAHeron", "name": "Jason Heron"}}, "url": "https://github.com/firebase/firebase-android-sdk/commit/4a82d6e22848c794978c07a5fe1b40457b3ea3a1", "committedDate": "2020-02-26T23:59:39Z", "message": "cleaning"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "2d66dd0afe070c28ec3aefa6c83810d69426163d", "author": {"user": {"login": "JasonAHeron", "name": "Jason Heron"}}, "url": "https://github.com/firebase/firebase-android-sdk/commit/2d66dd0afe070c28ec3aefa6c83810d69426163d", "committedDate": "2020-02-26T23:59:39Z", "message": "fix test"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "964f8e3da426affec84496b662b6869984454279", "author": {"user": {"login": "JasonAHeron", "name": "Jason Heron"}}, "url": "https://github.com/firebase/firebase-android-sdk/commit/964f8e3da426affec84496b662b6869984454279", "committedDate": "2020-02-26T23:59:39Z", "message": "format"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "50479c09450e0b058c50174fc404fe00937008cd", "author": {"user": {"login": "JasonAHeron", "name": "Jason Heron"}}, "url": "https://github.com/firebase/firebase-android-sdk/commit/50479c09450e0b058c50174fc404fe00937008cd", "committedDate": "2020-02-26T23:59:39Z", "message": "kk"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "0006128f4accb7b0c5363aa597d492aa27daa12a", "author": {"user": {"login": "JasonAHeron", "name": "Jason Heron"}}, "url": "https://github.com/firebase/firebase-android-sdk/commit/0006128f4accb7b0c5363aa597d492aa27daa12a", "committedDate": "2020-02-26T23:59:39Z", "message": "make it async"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "348df76b1c305324fb208a1c9d8b5377ab90917d", "author": {"user": {"login": "JasonAHeron", "name": "Jason Heron"}}, "url": "https://github.com/firebase/firebase-android-sdk/commit/348df76b1c305324fb208a1c9d8b5377ab90917d", "committedDate": "2020-02-26T23:59:39Z", "message": "format"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "0c847975e98b6686773779fc214f4ba6a7dec4b8", "author": {"user": {"login": "JasonAHeron", "name": "Jason Heron"}}, "url": "https://github.com/firebase/firebase-android-sdk/commit/0c847975e98b6686773779fc214f4ba6a7dec4b8", "committedDate": "2020-02-26T23:59:39Z", "message": "tests"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a728b28d68ec6244f19a9ea613c5902920350e78", "author": {"user": {"login": "JasonAHeron", "name": "Jason Heron"}}, "url": "https://github.com/firebase/firebase-android-sdk/commit/a728b28d68ec6244f19a9ea613c5902920350e78", "committedDate": "2020-02-26T23:59:39Z", "message": "ahhhhhhhh"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "b646d51c282812f047adde06925264fe32bb9fb5", "author": {"user": {"login": "JasonAHeron", "name": "Jason Heron"}}, "url": "https://github.com/firebase/firebase-android-sdk/commit/b646d51c282812f047adde06925264fe32bb9fb5", "committedDate": "2020-02-26T23:21:49Z", "message": "ahhhhhhhh"}, "afterCommit": {"oid": "a728b28d68ec6244f19a9ea613c5902920350e78", "author": {"user": {"login": "JasonAHeron", "name": "Jason Heron"}}, "url": "https://github.com/firebase/firebase-android-sdk/commit/a728b28d68ec6244f19a9ea613c5902920350e78", "committedDate": "2020-02-26T23:59:39Z", "message": "ahhhhhhhh"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzY1MzMyODI2", "url": "https://github.com/firebase/firebase-android-sdk/pull/1257#pullrequestreview-365332826", "createdAt": "2020-02-27T00:05:17Z", "commit": {"oid": "a728b28d68ec6244f19a9ea613c5902920350e78"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "9fe9e241a66bcdafb829d67c871c3ea1a9f7af7d", "author": {"user": {"login": "JasonAHeron", "name": "Jason Heron"}}, "url": "https://github.com/firebase/firebase-android-sdk/commit/9fe9e241a66bcdafb829d67c871c3ea1a9f7af7d", "committedDate": "2020-02-27T01:00:43Z", "message": "DID IT!!"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2077, "cost": 1, "resetAt": "2021-11-01T14:20:25Z"}}}