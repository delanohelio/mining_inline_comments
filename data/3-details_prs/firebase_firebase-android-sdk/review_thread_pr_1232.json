{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0MzczOTIwNTc4", "number": 1232, "reviewThreads": {"totalCount": 6, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xMVQyMjoyODoxOFrODe_AXw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xMlQyMToyMTowOVrODfVinA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjMzODE2MTU5OnYy", "diffSide": "RIGHT", "path": "firebase-inappmessaging/src/main/java/com/google/firebase/inappmessaging/internal/InAppMessageStreamManager.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xMVQyMjoyODoxOFrOFobfcA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xMVQyMjoyODoxOFrOFobfcA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NzkzNzc3Ng==", "bodyText": "Lets do Already impression campaign / experiment appropriately... Also, lets move this log line generation to a function.", "url": "https://github.com/firebase/firebase-android-sdk/pull/1232#discussion_r377937776", "createdAt": "2020-02-11T22:28:18Z", "author": {"login": "prakhar1989"}, "path": "firebase-inappmessaging/src/main/java/com/google/firebase/inappmessaging/internal/InAppMessageStreamManager.java", "diffHunk": "@@ -197,7 +197,14 @@ private boolean shouldIgnoreCache(String event) {\n                                       Logging.logi(\n                                           String.format(\n                                               \"Already impressed %s ? : %s\",", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "493f82d1d940f813b979ece5ffd2e55d192d4587"}, "originalPosition": 3}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjMzODc4NzMzOnYy", "diffSide": "RIGHT", "path": "firebase-inappmessaging/src/main/java/com/google/firebase/inappmessaging/model/ProtoMarshallerClient.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xMlQwNDoyMToyMFrOFohYQg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xMlQxNzo0NjowOVrOFo4ZOQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3ODAzNDI0Mg==", "bodyText": "boolean primitive cannot be null", "url": "https://github.com/firebase/firebase-android-sdk/pull/1232#discussion_r378034242", "createdAt": "2020-02-12T04:21:20Z", "author": {"login": "PromanSEW"}, "path": "firebase-inappmessaging/src/main/java/com/google/firebase/inappmessaging/model/ProtoMarshallerClient.java", "diffHunk": "@@ -207,11 +208,14 @@ private static Text decode(MessagesProto.Text in) {\n   /** Tranform {@link MessagesProto.Content} proto to an {@link InAppMessage} value object */\n   public static InAppMessage decode(\n       @Nonnull MessagesProto.Content in,\n-      String campaignId,\n-      String campaignName,\n-      boolean isTestMessage,\n+      @NonNull String campaignId,\n+      @NonNull String campaignName,\n+      @NonNull boolean isTestMessage,", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "3369f3bb7ab976f83475ebb7dcec28a203ea8480"}, "originalPosition": 26}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3ODQxMTMyMQ==", "bodyText": "Thanks!", "url": "https://github.com/firebase/firebase-android-sdk/pull/1232#discussion_r378411321", "createdAt": "2020-02-12T17:46:09Z", "author": {"login": "JasonAHeron"}, "path": "firebase-inappmessaging/src/main/java/com/google/firebase/inappmessaging/model/ProtoMarshallerClient.java", "diffHunk": "@@ -207,11 +208,14 @@ private static Text decode(MessagesProto.Text in) {\n   /** Tranform {@link MessagesProto.Content} proto to an {@link InAppMessage} value object */\n   public static InAppMessage decode(\n       @Nonnull MessagesProto.Content in,\n-      String campaignId,\n-      String campaignName,\n-      boolean isTestMessage,\n+      @NonNull String campaignId,\n+      @NonNull String campaignName,\n+      @NonNull boolean isTestMessage,", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3ODAzNDI0Mg=="}, "originalCommit": {"oid": "3369f3bb7ab976f83475ebb7dcec28a203ea8480"}, "originalPosition": 26}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjM0MTg0MzM1OnYy", "diffSide": "RIGHT", "path": "firebase-inappmessaging/src/main/java/com/google/firebase/inappmessaging/internal/DisplayCallbacksImpl.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xMlQyMToxNzozN1rOFo-3qA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xMlQyMToxNzozN1rOFo-3qA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3ODUxNzQxNg==", "bodyText": "nit: add a space after \":\"", "url": "https://github.com/firebase/firebase-android-sdk/pull/1232#discussion_r378517416", "createdAt": "2020-02-12T21:17:37Z", "author": {"login": "prakhar1989"}, "path": "firebase-inappmessaging/src/main/java/com/google/firebase/inappmessaging/internal/DisplayCallbacksImpl.java", "diffHunk": "@@ -224,9 +224,9 @@ private void logActionNotTaken(String action) {\n   }\n \n   private Completable logToImpressionStore() {\n-    Logging.logd(\"Attempting to record: message impression in impression store\");\n-    String campaignId = inAppMessage.getCampaignId();\n-\n+    String campaignId = inAppMessage.getCampaignMetadata().getCampaignId();\n+    Logging.logd(\n+        \"Attempting to record message impression in impression store for id:\" + campaignId);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "4eca1c012dbeb5dd10c3210cbdbb43ebb24bf3e9"}, "originalPosition": 18}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjM0MTg0ODk3OnYy", "diffSide": "RIGHT", "path": "firebase-inappmessaging/src/main/java/com/google/firebase/inappmessaging/internal/ImpressionStorageClient.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xMlQyMToxOToyN1rOFo-7Lg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xMlQyMTo0ODowN1rOFo_wew==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3ODUxODMxOA==", "bodyText": "nit: In experimental payload case, this is technically an experimentId, right? Should add that as a comment / clarification and / or rename this variable?", "url": "https://github.com/firebase/firebase-android-sdk/pull/1232#discussion_r378518318", "createdAt": "2020-02-12T21:19:27Z", "author": {"login": "prakhar1989"}, "path": "firebase-inappmessaging/src/main/java/com/google/firebase/inappmessaging/internal/ImpressionStorageClient.java", "diffHunk": "@@ -84,7 +85,11 @@ private void clearInMemCache() {\n   }\n \n   /** Returns {@code Single.just(true)} if the campaign has been impressed */\n-  public Single<Boolean> isImpressed(String campaignId) {\n+  public Single<Boolean> isImpressed(CampaignProto.ThickContent content) {\n+    String campaignId =", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "4eca1c012dbeb5dd10c3210cbdbb43ebb24bf3e9"}, "originalPosition": 14}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3ODUzMTk2Mw==", "bodyText": "Yeah, throughout the rest of the code we call this a campaignId and basically what it really is is a unique message identifier. In reality it should probably just be ID. it doesn't even matter that it's a campaignId or an experimentId just that it uniquely identifies this message. so I've just left it was campaignId.", "url": "https://github.com/firebase/firebase-android-sdk/pull/1232#discussion_r378531963", "createdAt": "2020-02-12T21:48:07Z", "author": {"login": "JasonAHeron"}, "path": "firebase-inappmessaging/src/main/java/com/google/firebase/inappmessaging/internal/ImpressionStorageClient.java", "diffHunk": "@@ -84,7 +85,11 @@ private void clearInMemCache() {\n   }\n \n   /** Returns {@code Single.just(true)} if the campaign has been impressed */\n-  public Single<Boolean> isImpressed(String campaignId) {\n+  public Single<Boolean> isImpressed(CampaignProto.ThickContent content) {\n+    String campaignId =", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3ODUxODMxOA=="}, "originalCommit": {"oid": "4eca1c012dbeb5dd10c3210cbdbb43ebb24bf3e9"}, "originalPosition": 14}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjM0MTg1MDMxOnYy", "diffSide": "RIGHT", "path": "firebase-inappmessaging/src/main/java/com/google/firebase/inappmessaging/internal/InAppMessageStreamManager.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xMlQyMToxOTo1NVrOFo-8Cg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xMlQyMToxOTo1NVrOFo-8Cg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3ODUxODUzOA==", "bodyText": "s/campaign/experiment?", "url": "https://github.com/firebase/firebase-android-sdk/pull/1232#discussion_r378518538", "createdAt": "2020-02-12T21:19:55Z", "author": {"login": "prakhar1989"}, "path": "firebase-inappmessaging/src/main/java/com/google/firebase/inappmessaging/internal/InAppMessageStreamManager.java", "diffHunk": "@@ -288,6 +282,20 @@ private boolean shouldIgnoreCache(String event) {\n     return Maybe.just(content);\n   }\n \n+  private static void logImpressionStatus(ThickContent content, Boolean isImpressed) {\n+    if (content.getPayloadCase().equals(ThickContent.PayloadCase.VANILLA_PAYLOAD)) {\n+      Logging.logi(\n+          String.format(\n+              \"Already impressed campaign %s ? : %s\",\n+              content.getVanillaPayload().getCampaignName(), isImpressed));\n+    } else if (content.getPayloadCase().equals(ThickContent.PayloadCase.EXPERIMENTAL_PAYLOAD)) {\n+      Logging.logi(\n+          String.format(\n+              \"Already impressed campaign %s ? : %s\",", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "4eca1c012dbeb5dd10c3210cbdbb43ebb24bf3e9"}, "originalPosition": 35}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjM0MTg1MzcyOnYy", "diffSide": "RIGHT", "path": "firebase-inappmessaging/src/test/java/com/google/firebase/inappmessaging/internal/InAppMessageStreamManagerTest.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xMlQyMToyMTowOVrOFo--Jg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xMlQyMToyMTowOVrOFo--Jg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3ODUxOTA3OA==", "bodyText": "why did we change this? The more specific it is, the better. I'd vote for bringing this back.", "url": "https://github.com/firebase/firebase-android-sdk/pull/1232#discussion_r378519078", "createdAt": "2020-02-12T21:21:09Z", "author": {"login": "prakhar1989"}, "path": "firebase-inappmessaging/src/test/java/com/google/firebase/inappmessaging/internal/InAppMessageStreamManagerTest.java", "diffHunk": "@@ -560,7 +559,7 @@ public void stream_onCacheWriteFailure_AbsorbsError() {\n \n   @Test\n   public void stream_whenCampaignImpressed_filtersCampaign() {\n-    when(impressionStorageClient.isImpressed(anyString())).thenReturn(Single.just(true));\n+    when(impressionStorageClient.isImpressed(any())).thenReturn(Single.just(true));", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "4eca1c012dbeb5dd10c3210cbdbb43ebb24bf3e9"}, "originalPosition": 22}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 767, "cost": 1, "resetAt": "2021-11-12T18:49:56Z"}}}