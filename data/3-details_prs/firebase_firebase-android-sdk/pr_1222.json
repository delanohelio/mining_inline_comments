{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0MzcyNDk4ODYz", "number": 1222, "title": "Make server timestamp methods static, rename ServerTimestamps", "bodyText": "", "createdAt": "2020-02-07T16:35:34Z", "url": "https://github.com/firebase/firebase-android-sdk/pull/1222", "merged": true, "mergeCommit": {"oid": "4864c6a38ae049fbc00922e9a81249080299f909"}, "closed": true, "closedAt": "2020-02-07T18:38:29Z", "author": {"login": "wilhuff"}, "timelineItems": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcCB-yagH2gAyMzcyNDk4ODYzOmRlM2M5NDQxZWY1MDk3MzVmZjI3NTQ4MjNjYjA1YjNhMmE4Y2FmNjA=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcCDkQjgH2gAyMzcyNDk4ODYzOjU3MzE0ZmU4OTEyZmJlZTRlNjU0NGJhMTRhOWVkODVlYWU4YmM1YmE=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "de3c9441ef509735ff2754823cb05b3a2a8caf60", "author": {"user": {"login": "wilhuff", "name": "Gil"}}, "url": "https://github.com/firebase/firebase-android-sdk/commit/de3c9441ef509735ff2754823cb05b3a2a8caf60", "committedDate": "2020-02-07T16:32:25Z", "message": "Make ServerTimestampValue methods static"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f4f26c45881194d5e3aa3daba8187e3961fed7e9", "author": {"user": {"login": "wilhuff", "name": "Gil"}}, "url": "https://github.com/firebase/firebase-android-sdk/commit/f4f26c45881194d5e3aa3daba8187e3961fed7e9", "committedDate": "2020-02-07T16:33:54Z", "message": "format"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzU1MzEwODk2", "url": "https://github.com/firebase/firebase-android-sdk/pull/1222#pullrequestreview-355310896", "createdAt": "2020-02-07T17:18:55Z", "commit": {"oid": "f4f26c45881194d5e3aa3daba8187e3961fed7e9"}, "state": "APPROVED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0wN1QxNzoxODo1NVrOFnETRg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0wN1QxNzoyMDoyOFrOFnEV-Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NjUwOTI1NA==", "bodyText": "The Java style guide suggests to use braces even for one line statements: https://engdoc.corp.google.com/eng/doc/devguide/java/style/index.md?cl=head#s4.1-braces", "url": "https://github.com/firebase/firebase-android-sdk/pull/1222#discussion_r376509254", "createdAt": "2020-02-07T17:18:55Z", "author": {"login": "schmidt-sebastian"}, "path": "firebase-firestore/src/main/java/com/google/firebase/firestore/UserDataWriter.java", "diffHunk": "@@ -90,14 +92,14 @@ Object convertValue(Value value) {\n     return result;\n   }\n \n-  private Object convertServerTimestamp(ServerTimestampValue value) {\n+  private Object convertServerTimestamp(Value serverTimestampValue) {\n     switch (serverTimestampBehavior) {\n       case PREVIOUS:\n-        return value.getPreviousValue() == null ? null : convertValue(value.getPreviousValue());\n+        Value previousValue = getPreviousValue(serverTimestampValue);\n+        if (previousValue == null) return null;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f4f26c45881194d5e3aa3daba8187e3961fed7e9"}, "originalPosition": 38}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NjUwOTk0NQ==", "bodyText": ":) Much better.", "url": "https://github.com/firebase/firebase-android-sdk/pull/1222#discussion_r376509945", "createdAt": "2020-02-07T17:20:28Z", "author": {"login": "schmidt-sebastian"}, "path": "firebase-firestore/src/main/java/com/google/firebase/firestore/UserDataWriter.java", "diffHunk": "@@ -90,14 +92,14 @@ Object convertValue(Value value) {\n     return result;\n   }\n \n-  private Object convertServerTimestamp(ServerTimestampValue value) {\n+  private Object convertServerTimestamp(Value serverTimestampValue) {\n     switch (serverTimestampBehavior) {\n       case PREVIOUS:\n-        return value.getPreviousValue() == null ? null : convertValue(value.getPreviousValue());\n+        Value previousValue = getPreviousValue(serverTimestampValue);\n+        if (previousValue == null) return null;\n+        return convertValue(previousValue);\n       case ESTIMATE:\n-        return !timestampsInSnapshots\n-            ? value.getLocalWriteTime().toDate()\n-            : value.getLocalWriteTime();\n+        return convertTimestamp(getLocalWriteTime(serverTimestampValue));", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f4f26c45881194d5e3aa3daba8187e3961fed7e9"}, "originalPosition": 44}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "57314fe8912fbee4e6544ba14a9ed85eae8bc5ba", "author": {"user": {"login": "wilhuff", "name": "Gil"}}, "url": "https://github.com/firebase/firebase-android-sdk/commit/57314fe8912fbee4e6544ba14a9ed85eae8bc5ba", "committedDate": "2020-02-07T18:23:15Z", "message": "Feedback"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2034, "cost": 1, "resetAt": "2021-11-01T14:20:25Z"}}}