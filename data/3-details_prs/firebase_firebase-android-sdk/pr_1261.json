{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0Mzc3ODkxMDM4", "number": 1261, "title": "Add captured logs to Crashlytics reports", "bodyText": "", "createdAt": "2020-02-20T17:43:46Z", "url": "https://github.com/firebase/firebase-android-sdk/pull/1261", "merged": true, "mergeCommit": {"oid": "eba680f3150a02fecc6dd09723ca9703a0be2bed"}, "closed": true, "closedAt": "2020-02-21T18:16:21Z", "author": {"login": "mrwillis21"}, "timelineItems": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcGOyTzgH2gAyMzc3ODkxMDM4OjU0NjgxYTUzYjUxM2UzY2ZkODY5M2FhN2Q2ZTI0MWY5MjAwNGE4NDc=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcGhrR1AFqTM2MjcyMTUyNw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "54681a53b513e3cfd8693aa7d6e241f92004a847", "author": {"user": {"login": "mrwillis21", "name": "Matt Willis"}}, "url": "https://github.com/firebase/firebase-android-sdk/commit/54681a53b513e3cfd8693aa7d6e241f92004a847", "committedDate": "2020-02-20T17:43:15Z", "message": "Add captured logs to Crashlytics reports"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzYyMjY5MTgz", "url": "https://github.com/firebase/firebase-android-sdk/pull/1261#pullrequestreview-362269183", "createdAt": "2020-02-20T22:07:19Z", "commit": {"oid": "54681a53b513e3cfd8693aa7d6e241f92004a847"}, "state": "COMMENTED", "comments": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yMFQyMjowNzoxOVrOFsk0tw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yMFQyMjoxMTo1NVrOFsk8iA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MjI4NDk4Mw==", "bodyText": "This makes sense, but I want to talk out a naming thing that is going on here: You designed this manager as a \"listener\" as events. onBeginSession, onFatalEvent, onEndSession all make sense to me as lifecycle events because they're outside of the operation of this collaborator, and crashlytics is acting as listener of them. onLog (and to some degree,onNonFatalEvent) are a little different because the user explicitly calls it, right? In this case, we're not listening to a log occuring, we're listening to the app logging the information. I find it a little weird that onLog results in logging, but \ud83e\udd37\u200d\u2642 I can't really think of a different way to name this.", "url": "https://github.com/firebase/firebase-android-sdk/pull/1261#discussion_r382284983", "createdAt": "2020-02-20T22:07:19Z", "author": {"login": "jakeouellette"}, "path": "firebase-crashlytics/src/main/java/com/google/firebase/crashlytics/internal/common/FirebaseCrashlyticsReportManager.java", "diffHunk": "@@ -75,6 +80,11 @@ public void onNonFatalEvent(Throwable event, Thread thread) {\n     onEvent(event, thread, EVENT_TYPE_LOGGED, false);\n   }\n \n+  @Override\n+  public void onLog(long timestamp, String log) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "54681a53b513e3cfd8693aa7d6e241f92004a847"}, "originalPosition": 37}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MjI4NTYxNQ==", "bodyText": "out of curiosity, what's the threading model of the method this code is in? is it always on a single thread?", "url": "https://github.com/firebase/firebase-android-sdk/pull/1261#discussion_r382285615", "createdAt": "2020-02-20T22:08:46Z", "author": {"login": "jakeouellette"}, "path": "firebase-crashlytics/src/main/java/com/google/firebase/crashlytics/internal/common/FirebaseCrashlyticsReportManager.java", "diffHunk": "@@ -99,19 +109,31 @@ private void onEvent(\n       Throwable event, Thread thread, String eventType, boolean includeAllThreads) {\n     final long timestamp = currentTimeProvider.getCurrentTimeMillis() / 1000;\n \n-    final CrashlyticsReport.Session.Event capturedEvent =\n-        dataCapture.captureEventData(\n-            event,\n-            thread,\n-            eventType,\n-            timestamp,\n-            EVENT_THREAD_IMPORTANCE,\n-            MAX_CHAINED_EXCEPTION_DEPTH,\n-            includeAllThreads);\n-\n     final boolean isHighPriority = eventType.equals(EVENT_TYPE_CRASH);\n \n-    reportPersistence.persistEvent(capturedEvent, currentSessionId, isHighPriority);\n+    CrashlyticsReport.Session.Event.Builder eventBuilder =\n+        dataCapture\n+            .captureEventData(\n+                event,\n+                thread,\n+                eventType,\n+                timestamp,\n+                EVENT_THREAD_IMPORTANCE,\n+                MAX_CHAINED_EXCEPTION_DEPTH,\n+                includeAllThreads)\n+            .toBuilder();\n+\n+    final String content = logFileManager.getLogString();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "54681a53b513e3cfd8693aa7d6e241f92004a847"}, "originalPosition": 73}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MjI4NjI2Mg==", "bodyText": "I'm not sure I understand why this is null", "url": "https://github.com/firebase/firebase-android-sdk/pull/1261#discussion_r382286262", "createdAt": "2020-02-20T22:10:15Z", "author": {"login": "jakeouellette"}, "path": "firebase-crashlytics/src/main/java/com/google/firebase/crashlytics/internal/log/LogFileManager.java", "diffHunk": "@@ -142,6 +146,11 @@ public void writeToLog(long timestamp, String msg) {}\n       return null;\n     }\n \n+    @Override\n+    public String getLogAsString() {\n+      return null;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "54681a53b513e3cfd8693aa7d6e241f92004a847"}, "originalPosition": 17}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MjI4Njk4NA==", "bodyText": "Can we add a comment as to why this is a TODO?", "url": "https://github.com/firebase/firebase-android-sdk/pull/1261#discussion_r382286984", "createdAt": "2020-02-20T22:11:55Z", "author": {"login": "jakeouellette"}, "path": "firebase-crashlytics/src/main/java/com/google/firebase/crashlytics/internal/model/CrashlyticsReport.java", "diffHunk": "@@ -84,6 +84,13 @@ public static Builder builder() {\n   @NonNull\n   public abstract Session getSession();\n \n+  // TODO", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "54681a53b513e3cfd8693aa7d6e241f92004a847"}, "originalPosition": 4}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "7d45c71ad8b58b5cccd8221804f080ee26e55954", "author": {"user": {"login": "mrwillis21", "name": "Matt Willis"}}, "url": "https://github.com/firebase/firebase-android-sdk/commit/7d45c71ad8b58b5cccd8221804f080ee26e55954", "committedDate": "2020-02-20T23:03:28Z", "message": "Feedback"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzYyNzIxNTI3", "url": "https://github.com/firebase/firebase-android-sdk/pull/1261#pullrequestreview-362721527", "createdAt": "2020-02-21T15:43:46Z", "commit": {"oid": "7d45c71ad8b58b5cccd8221804f080ee26e55954"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2083, "cost": 1, "resetAt": "2021-11-01T14:20:25Z"}}}