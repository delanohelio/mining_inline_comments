{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDE5NzkzOTUx", "number": 1571, "reviewThreads": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xOFQyMzo0NDo1MFrOD9lpDg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xOFQyMzo1MTozOFrOD9lt7w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjY1OTA2NDQ2OnYy", "diffSide": "RIGHT", "path": "firebase-installations/src/main/java/com/google/firebase/installations/FirebaseInstallations.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xOFQyMzo0NDo1MFrOGXLA_w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xOFQyMzo0NDo1MFrOGXLA_w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNjk1MDkxMQ==", "bodyText": "please add a comment here, example:\n/** FID of this FirebaseInstallations instance. Cached after the first successful read from local storage. */", "url": "https://github.com/firebase/firebase-android-sdk/pull/1571#discussion_r426950911", "createdAt": "2020-05-18T23:44:50Z", "author": {"login": "andirayo"}, "path": "firebase-installations/src/main/java/com/google/firebase/installations/FirebaseInstallations.java", "diffHunk": "@@ -68,6 +68,8 @@\n   private final ExecutorService backgroundExecutor;\n   private final ExecutorService networkExecutor;\n \n+  private String cachedFid = null;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "1d8aa168d4ce54e3c7e4dfe595a3361bdb088d4f"}, "originalPosition": 4}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjY1OTA2OTQ3OnYy", "diffSide": "RIGHT", "path": "firebase-installations/src/main/java/com/google/firebase/installations/FirebaseInstallations.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xOFQyMzo0NzoyOFrOGXLD9A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xOFQyMzo0NzoyOFrOGXLD9A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNjk1MTY2OA==", "bodyText": "Do this as first line of #doGetId().", "url": "https://github.com/firebase/firebase-android-sdk/pull/1571#discussion_r426951668", "createdAt": "2020-05-18T23:47:28Z", "author": {"login": "andirayo"}, "path": "firebase-installations/src/main/java/com/google/firebase/installations/FirebaseInstallations.java", "diffHunk": "@@ -215,7 +217,11 @@ String getName() {\n   public Task<String> getId() {\n     preConditionChecks();\n     TaskCompletionSource<String> taskCompletionSource = new TaskCompletionSource<>();\n-    taskCompletionSource.trySetResult(doGetId());\n+    if (cachedFid != null) {\n+      taskCompletionSource.trySetResult(cachedFid);\n+    } else {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "1d8aa168d4ce54e3c7e4dfe595a3361bdb088d4f"}, "originalPosition": 16}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjY1OTA3NTY4OnYy", "diffSide": "RIGHT", "path": "firebase-installations/src/main/java/com/google/firebase/installations/FirebaseInstallations.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xOFQyMzo1MDo0OFrOGXLHyA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xOFQyMzo1MDo0OFrOGXLHyA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNjk1MjY0OA==", "bodyText": "I recommend to remove this and only set cachedFid when you successfully read from SharedPrefs.\nYour solution is probably better because 1 less read of SharedPrefs, but potentially more error cases.", "url": "https://github.com/firebase/firebase-android-sdk/pull/1571#discussion_r426952648", "createdAt": "2020-05-18T23:50:48Z", "author": {"login": "andirayo"}, "path": "firebase-installations/src/main/java/com/google/firebase/installations/FirebaseInstallations.java", "diffHunk": "@@ -454,6 +460,7 @@ private PersistedInstallationEntry registerFidWithServer(PersistedInstallationEn\n \n     switch (response.getResponseCode()) {\n       case OK:\n+        cachedFid = response.getFid();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "1d8aa168d4ce54e3c7e4dfe595a3361bdb088d4f"}, "originalPosition": 26}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjY1OTA3Njk1OnYy", "diffSide": "RIGHT", "path": "firebase-installations/src/main/java/com/google/firebase/installations/FirebaseInstallations.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xOFQyMzo1MTozOFrOGXLIqA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xOFQyMzo1MTozOFrOGXLIqA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNjk1Mjg3Mg==", "bodyText": "I recommend making this the first line of this method.\nThat way, if something goes wrong somewhere we have made sure to clear the cache.\nWorst case we have 1 unnecessary disk read.", "url": "https://github.com/firebase/firebase-android-sdk/pull/1571#discussion_r426952872", "createdAt": "2020-05-18T23:51:38Z", "author": {"login": "andirayo"}, "path": "firebase-installations/src/main/java/com/google/firebase/installations/FirebaseInstallations.java", "diffHunk": "@@ -519,7 +527,7 @@ private Void deleteFirebaseInstallationId() throws FirebaseInstallationsExceptio\n             \"Failed to delete a Firebase Installation.\", Status.BAD_CONFIG);\n       }\n     }\n-\n+    cachedFid = null;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "1d8aa168d4ce54e3c7e4dfe595a3361bdb088d4f"}, "originalPosition": 43}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1369, "cost": 1, "resetAt": "2021-11-12T18:49:56Z"}}}