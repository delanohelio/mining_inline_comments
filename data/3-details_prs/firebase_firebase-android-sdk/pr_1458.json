{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDAyODkwNjY2", "number": 1458, "title": "Removing try-with-resources", "bodyText": "try-with-resources desugaring in google3 is incorrect. This causes copybara import to google3 fail. Raised a bug with Gms core. Meanwhile, removing try-with-resources from FIS SDK.", "createdAt": "2020-04-13T23:31:29Z", "url": "https://github.com/firebase/firebase-android-sdk/pull/1458", "merged": true, "mergeCommit": {"oid": "a2b9104b38d38524baf40d91b2e2825bda34c49c"}, "closed": true, "closedAt": "2020-04-14T18:05:04Z", "author": {"login": "ankitaj224"}, "timelineItems": {"totalCount": 23, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcBun1cgH2gAyNDAyODkwNjY2OjQyODNhMmJiM2I0NDM0NTEwZTA2MWEwZDljNGIwODA1OTU2NThjMmE=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcXnXAZAFqTM5MzE2MjI4MA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "4283a2bb3b4434510e061a0d9c4b080595658c2a", "author": {"user": {"login": "ankitaj224", "name": "Ankita"}}, "url": "https://github.com/firebase/firebase-android-sdk/commit/4283a2bb3b4434510e061a0d9c4b080595658c2a", "committedDate": "2020-02-06T17:59:09Z", "message": "Dropping guava and appcompat dependency from FIS SDK."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "984884cd6f9a90a8172d0957bd13e68e3f06db2f", "author": {"user": {"login": "ankitaj224", "name": "Ankita"}}, "url": "https://github.com/firebase/firebase-android-sdk/commit/984884cd6f9a90a8172d0957bd13e68e3f06db2f", "committedDate": "2020-02-06T18:16:08Z", "message": "Merge branch 'master' of github.com:firebase/firebase-android-sdk"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a82387701d2549bb5fc3b5dc2530a83ed0680d02", "author": {"user": {"login": "ankitaj224", "name": "Ankita"}}, "url": "https://github.com/firebase/firebase-android-sdk/commit/a82387701d2549bb5fc3b5dc2530a83ed0680d02", "committedDate": "2020-02-11T18:58:16Z", "message": "Merge branch 'master' of github.com:firebase/firebase-android-sdk"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "afcb14c913c8dedd87faf6b71fdc7dd4384a6c39", "author": {"user": {"login": "ankitaj224", "name": "Ankita"}}, "url": "https://github.com/firebase/firebase-android-sdk/commit/afcb14c913c8dedd87faf6b71fdc7dd4384a6c39", "committedDate": "2020-02-13T23:37:48Z", "message": "Merge branch 'master' of github.com:firebase/firebase-android-sdk"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "5574e30b8e3f6c9d09bfca149a6f7853c4141d25", "author": {"user": {"login": "ankitaj224", "name": "Ankita"}}, "url": "https://github.com/firebase/firebase-android-sdk/commit/5574e30b8e3f6c9d09bfca149a6f7853c4141d25", "committedDate": "2020-03-05T16:49:33Z", "message": "Merge branch 'master' of github.com:firebase/firebase-android-sdk"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a5dd4dc54f2b7941ffe4b5cd76b6c8ab5764f7a1", "author": {"user": {"login": "ankitaj224", "name": "Ankita"}}, "url": "https://github.com/firebase/firebase-android-sdk/commit/a5dd4dc54f2b7941ffe4b5cd76b6c8ab5764f7a1", "committedDate": "2020-03-09T16:31:08Z", "message": "Merge branch 'master' of github.com:firebase/firebase-android-sdk"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "45312e68fe8516dc4d48a2bfdb422f5023c1241b", "author": {"user": {"login": "ankitaj224", "name": "Ankita"}}, "url": "https://github.com/firebase/firebase-android-sdk/commit/45312e68fe8516dc4d48a2bfdb422f5023c1241b", "committedDate": "2020-03-10T18:13:59Z", "message": "Merge branch 'master' of github.com:firebase/firebase-android-sdk"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f0be4fa07222c687044f66d8cb2859e156611896", "author": {"user": {"login": "ankitaj224", "name": "Ankita"}}, "url": "https://github.com/firebase/firebase-android-sdk/commit/f0be4fa07222c687044f66d8cb2859e156611896", "committedDate": "2020-03-10T21:55:48Z", "message": "Merge branch 'master' of github.com:firebase/firebase-android-sdk"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ac0397ba816265b24da3eca4645761a37d4b46b6", "author": {"user": {"login": "ankitaj224", "name": "Ankita"}}, "url": "https://github.com/firebase/firebase-android-sdk/commit/ac0397ba816265b24da3eca4645761a37d4b46b6", "committedDate": "2020-03-11T18:14:18Z", "message": "Merge branch 'master' of github.com:firebase/firebase-android-sdk"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "8f6b46e3346cad5d3a4128ad1316e9e0831c0a2b", "author": {"user": {"login": "ankitaj224", "name": "Ankita"}}, "url": "https://github.com/firebase/firebase-android-sdk/commit/8f6b46e3346cad5d3a4128ad1316e9e0831c0a2b", "committedDate": "2020-03-12T19:40:52Z", "message": "Merge branch 'master' of github.com:firebase/firebase-android-sdk"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "686a998ab40a6c855d81b30f7686ef20aef1713c", "author": {"user": {"login": "ankitaj224", "name": "Ankita"}}, "url": "https://github.com/firebase/firebase-android-sdk/commit/686a998ab40a6c855d81b30f7686ef20aef1713c", "committedDate": "2020-03-16T17:31:01Z", "message": "Merge branch 'master' of github.com:firebase/firebase-android-sdk"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "3bf7c24892fc6d66b4b33cb943ac2fe9e3e11598", "author": {"user": {"login": "ankitaj224", "name": "Ankita"}}, "url": "https://github.com/firebase/firebase-android-sdk/commit/3bf7c24892fc6d66b4b33cb943ac2fe9e3e11598", "committedDate": "2020-03-18T21:05:27Z", "message": "Merge branch 'master' of github.com:firebase/firebase-android-sdk"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "07ff7ddc966270c28df8d123ef95e63a9f058494", "author": {"user": {"login": "ankitaj224", "name": "Ankita"}}, "url": "https://github.com/firebase/firebase-android-sdk/commit/07ff7ddc966270c28df8d123ef95e63a9f058494", "committedDate": "2020-03-30T21:58:00Z", "message": "Merge branch 'master' of github.com:firebase/firebase-android-sdk"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f982f2d752d3567a1164b6f3bb00a1dfc601ab91", "author": {"user": {"login": "ankitaj224", "name": "Ankita"}}, "url": "https://github.com/firebase/firebase-android-sdk/commit/f982f2d752d3567a1164b6f3bb00a1dfc601ab91", "committedDate": "2020-03-31T22:05:19Z", "message": "Merge branch 'master' of github.com:firebase/firebase-android-sdk"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "672526aca799c55e7f83aaa0f08c7e698be388ed", "author": {"user": {"login": "ankitaj224", "name": "Ankita"}}, "url": "https://github.com/firebase/firebase-android-sdk/commit/672526aca799c55e7f83aaa0f08c7e698be388ed", "committedDate": "2020-04-05T05:34:09Z", "message": "Merge branch 'master' of github.com:firebase/firebase-android-sdk"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "1adf4a2621f9367521f806ea893770921713e49f", "author": {"user": {"login": "ankitaj224", "name": "Ankita"}}, "url": "https://github.com/firebase/firebase-android-sdk/commit/1adf4a2621f9367521f806ea893770921713e49f", "committedDate": "2020-04-07T20:56:39Z", "message": "Merge branch 'master' of github.com:firebase/firebase-android-sdk"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "4435ed00d6c6d59ae1dd2442e034c75873bf8ed8", "author": {"user": {"login": "ankitaj224", "name": "Ankita"}}, "url": "https://github.com/firebase/firebase-android-sdk/commit/4435ed00d6c6d59ae1dd2442e034c75873bf8ed8", "committedDate": "2020-04-10T21:22:37Z", "message": "Merge branch 'master' of github.com:firebase/firebase-android-sdk"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "99f1f827dac599f04bd69eea5a49c1596eadf49a", "author": {"user": {"login": "ankitaj224", "name": "Ankita"}}, "url": "https://github.com/firebase/firebase-android-sdk/commit/99f1f827dac599f04bd69eea5a49c1596eadf49a", "committedDate": "2020-04-13T22:51:18Z", "message": "Merge branch 'master' of github.com:firebase/firebase-android-sdk"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "1b123ce745f7555a47c5f6288f7e882db1a47b6d", "author": {"user": {"login": "ankitaj224", "name": "Ankita"}}, "url": "https://github.com/firebase/firebase-android-sdk/commit/1b123ce745f7555a47c5f6288f7e882db1a47b6d", "committedDate": "2020-04-13T23:30:07Z", "message": "Removing try-with-resources"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzkyNTM5NjIw", "url": "https://github.com/firebase/firebase-android-sdk/pull/1458#pullrequestreview-392539620", "createdAt": "2020-04-14T01:14:50Z", "commit": {"oid": "1b123ce745f7555a47c5f6288f7e882db1a47b6d"}, "state": "COMMENTED", "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0xNFQwMToxNDo1MFrOGE6p_g==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0xNFQwMToxNzowMVrOGE6sEA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNzgwODUxMA==", "bodyText": "2 Questions:\na) Do we want to catch the IOExceptions here?\nThought process is this:\nIf an IOException is thrown during closing, do we really want to interrupt the normal process of FIS?\nb) If your answer to (a) is \"no\", could you please add a comment explaining your decision?", "url": "https://github.com/firebase/firebase-android-sdk/pull/1458#discussion_r407808510", "createdAt": "2020-04-14T01:14:50Z", "author": {"login": "andirayo"}, "path": "firebase-installations/src/main/java/com/google/firebase/installations/remote/FirebaseInstallationServiceClient.java", "diffHunk": "@@ -205,13 +205,16 @@ private void writeFIDCreateRequestBodyToOutputStream(\n \n   private static void writeRequestBodyToOutputStream(URLConnection urlConnection, byte[] jsonBytes)\n       throws IOException {\n-    try (OutputStream outputStream = urlConnection.getOutputStream()) {\n-      if (outputStream == null) {\n-        throw new IOException(\"Cannot send request to FIS servers. No OutputStream available.\");\n-      }\n-      try (GZIPOutputStream gzipOutputStream = new GZIPOutputStream(outputStream)) {\n-        gzipOutputStream.write(jsonBytes);\n-      }\n+    OutputStream outputStream = urlConnection.getOutputStream();\n+    if (outputStream == null) {\n+      throw new IOException(\"Cannot send request to FIS servers. No OutputStream available.\");\n+    }\n+    GZIPOutputStream gzipOutputStream = new GZIPOutputStream(outputStream);\n+    try {\n+      gzipOutputStream.write(jsonBytes);\n+    } finally {\n+      gzipOutputStream.close();\n+      outputStream.close();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "1b123ce745f7555a47c5f6288f7e882db1a47b6d"}, "originalPosition": 20}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNzgwODg1Mw==", "bodyText": "This can throw an IOException, yeah?\nNot sure, but I think you should do the following:\nBuffered reader = null;\ntry {\n reader = new BufferedReader(new InputStreamReader(conn.getErrorStream(), UTF_8));", "url": "https://github.com/firebase/firebase-android-sdk/pull/1458#discussion_r407808853", "createdAt": "2020-04-14T01:16:18Z", "author": {"login": "andirayo"}, "path": "firebase-installations/src/main/java/com/google/firebase/installations/remote/FirebaseInstallationServiceClient.java", "diffHunk": "@@ -525,8 +528,8 @@ private static void logFisCommunicationError(HttpURLConnection conn) {\n   // Read the error message from the response.\n   @Nullable\n   private static String readErrorResponse(HttpURLConnection conn) {\n-    try (BufferedReader reader =\n-        new BufferedReader(new InputStreamReader(conn.getErrorStream(), UTF_8))) {\n+    BufferedReader reader = new BufferedReader(new InputStreamReader(conn.getErrorStream(), UTF_8));", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "1b123ce745f7555a47c5f6288f7e882db1a47b6d"}, "originalPosition": 30}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNzgwOTA0MA==", "bodyText": "I recommend pulling the if-clause around the try-clause.", "url": "https://github.com/firebase/firebase-android-sdk/pull/1458#discussion_r407809040", "createdAt": "2020-04-14T01:17:01Z", "author": {"login": "andirayo"}, "path": "firebase-installations/src/main/java/com/google/firebase/installations/remote/FirebaseInstallationServiceClient.java", "diffHunk": "@@ -536,6 +539,14 @@ private static String readErrorResponse(HttpURLConnection conn) {\n           conn.getResponseCode(), conn.getResponseMessage(), response);\n     } catch (IOException ignored) {\n       return null;\n+    } finally {\n+      try {\n+        if (reader != null) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "1b123ce745f7555a47c5f6288f7e882db1a47b6d"}, "originalPosition": 41}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ba699db7773bf149c9d1bba7f1b94092e6878454", "author": {"user": {"login": "ankitaj224", "name": "Ankita"}}, "url": "https://github.com/firebase/firebase-android-sdk/commit/ba699db7773bf149c9d1bba7f1b94092e6878454", "committedDate": "2020-04-14T17:20:59Z", "message": "Merge branch 'master' of github.com:firebase/firebase-android-sdk into fixTry"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "d7a81975fe28d521138a8a4905c7b7f7ad775bb3", "author": {"user": {"login": "ankitaj224", "name": "Ankita"}}, "url": "https://github.com/firebase/firebase-android-sdk/commit/d7a81975fe28d521138a8a4905c7b7f7ad775bb3", "committedDate": "2020-04-14T17:45:53Z", "message": "Fix for Rayo's comments"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzkzMTYyMjgw", "url": "https://github.com/firebase/firebase-android-sdk/pull/1458#pullrequestreview-393162280", "createdAt": "2020-04-14T17:53:06Z", "commit": {"oid": "d7a81975fe28d521138a8a4905c7b7f7ad775bb3"}, "state": "APPROVED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0xNFQxNzo1MzowNlrOGFaQCA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0xNFQxNzo1NTozOVrOGFaWVQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwODMyNjE1Mg==", "bodyText": "Probably an unrelated question, feel free to just acknowledge:\nCan this ever be NULL, similar to outputStream above?\nProbably not, huh?", "url": "https://github.com/firebase/firebase-android-sdk/pull/1458#discussion_r408326152", "createdAt": "2020-04-14T17:53:06Z", "author": {"login": "andirayo"}, "path": "firebase-installations/src/main/java/com/google/firebase/installations/remote/FirebaseInstallationServiceClient.java", "diffHunk": "@@ -205,12 +205,19 @@ private void writeFIDCreateRequestBodyToOutputStream(\n \n   private static void writeRequestBodyToOutputStream(URLConnection urlConnection, byte[] jsonBytes)\n       throws IOException {\n-    try (OutputStream outputStream = urlConnection.getOutputStream()) {\n-      if (outputStream == null) {\n-        throw new IOException(\"Cannot send request to FIS servers. No OutputStream available.\");\n-      }\n-      try (GZIPOutputStream gzipOutputStream = new GZIPOutputStream(outputStream)) {\n-        gzipOutputStream.write(jsonBytes);\n+    OutputStream outputStream = urlConnection.getOutputStream();\n+    if (outputStream == null) {\n+      throw new IOException(\"Cannot send request to FIS servers. No OutputStream available.\");\n+    }\n+    GZIPOutputStream gzipOutputStream = new GZIPOutputStream(outputStream);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d7a81975fe28d521138a8a4905c7b7f7ad775bb3"}, "originalPosition": 14}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwODMyNzc2NQ==", "bodyText": "nice!", "url": "https://github.com/firebase/firebase-android-sdk/pull/1458#discussion_r408327765", "createdAt": "2020-04-14T17:55:39Z", "author": {"login": "andirayo"}, "path": "firebase-installations/src/main/java/com/google/firebase/installations/remote/FirebaseInstallationServiceClient.java", "diffHunk": "@@ -525,8 +532,12 @@ private static void logFisCommunicationError(HttpURLConnection conn) {\n   // Read the error message from the response.\n   @Nullable\n   private static String readErrorResponse(HttpURLConnection conn) {\n-    try (BufferedReader reader =\n-        new BufferedReader(new InputStreamReader(conn.getErrorStream(), UTF_8))) {\n+    InputStream errorStream = conn.getErrorStream();\n+    if (errorStream == null) {\n+      return null;\n+    }", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d7a81975fe28d521138a8a4905c7b7f7ad775bb3"}, "originalPosition": 35}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2612, "cost": 1, "resetAt": "2021-11-01T14:20:25Z"}}}