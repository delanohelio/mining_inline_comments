{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTMzOTM3NzUz", "number": 2236, "title": "Delete model", "bodyText": "", "createdAt": "2020-12-07T20:45:22Z", "url": "https://github.com/firebase/firebase-android-sdk/pull/2236", "merged": true, "mergeCommit": {"oid": "c75caee190f99e9e2d5e60d6ba93eb4e7b750d79"}, "closed": true, "closedAt": "2020-12-14T17:56:34Z", "author": {"login": "annzimmer"}, "timelineItems": {"totalCount": 8, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdj7gUWgH2gAyNTMzOTM3NzUzOmU4ZWI5YjlkYzg4MDY5MmQwNDBmYzUyMDE2ZmI1ZDBiYmU2ZTRiMzU=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdlPR84gFqTU1MDYwNjE2Nw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "e8eb9b9dc880692d040fc52016fb5d0bbe6e4b35", "author": {"user": {"login": "annzimmer", "name": "Ann Z"}}, "url": "https://github.com/firebase/firebase-android-sdk/commit/e8eb9b9dc880692d040fc52016fb5d0bbe6e4b35", "committedDate": "2020-12-07T20:24:17Z", "message": "Reviewer suggested changes."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "3b30492c1b1a4a56ac4fec0da7c73d621155678c", "author": {"user": {"login": "annzimmer", "name": "Ann Z"}}, "url": "https://github.com/firebase/firebase-android-sdk/commit/3b30492c1b1a4a56ac4fec0da7c73d621155678c", "committedDate": "2020-12-07T20:28:50Z", "message": "Add code for custom model deletion from a device."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f18a918759eaadb8abe258587f26722295a0ddfd", "author": {"user": {"login": "annzimmer", "name": "Ann Z"}}, "url": "https://github.com/firebase/firebase-android-sdk/commit/f18a918759eaadb8abe258587f26722295a0ddfd", "committedDate": "2020-12-07T21:38:06Z", "message": "Add code for custom model deletion from a device."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTQ2NTg3Mjk2", "url": "https://github.com/firebase/firebase-android-sdk/pull/2236#pullrequestreview-546587296", "createdAt": "2020-12-07T22:21:17Z", "commit": {"oid": "f18a918759eaadb8abe258587f26722295a0ddfd"}, "state": "COMMENTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0wN1QyMjoyMToxOFrOIA9aWw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0wN1QyMjoyMjoyNlrOIA9dZQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNzg3NzA4Mw==", "bodyText": "In case the app crashes, or the phone dies, after models have been deleted but before their details have been removed from sharedPreferences, what would happen?", "url": "https://github.com/firebase/firebase-android-sdk/pull/2236#discussion_r537877083", "createdAt": "2020-12-07T22:21:18Z", "author": {"login": "rlazo"}, "path": "firebase-ml-modeldownloader/src/main/java/com/google/firebase/ml/modeldownloader/FirebaseModelDownloader.java", "diffHunk": "@@ -187,7 +192,16 @@ public static FirebaseModelDownloader getInstance(@NonNull FirebaseApp app) {\n    */\n   @NonNull\n   public Task<Void> deleteDownloadedModel(@NonNull String modelName) {\n-    throw new UnsupportedOperationException(\"Not yet implemented.\");\n+\n+    TaskCompletionSource<Void> taskCompletionSource = new TaskCompletionSource<>();\n+    executor.execute(\n+        () -> {\n+          // remove all files associated with this model and then clean up model references.\n+          fileManager.deleteAllModels(modelName);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f18a918759eaadb8abe258587f26722295a0ddfd"}, "originalPosition": 50}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNzg3Nzg2MQ==", "bodyText": "Intentional?", "url": "https://github.com/firebase/firebase-android-sdk/pull/2236#discussion_r537877861", "createdAt": "2020-12-07T22:22:26Z", "author": {"login": "rlazo"}, "path": "firebase-ml-modeldownloader/src/main/java/com/google/firebase/ml/modeldownloader/internal/ModelFileManager.java", "diffHunk": "@@ -118,6 +126,21 @@ private int getLatestCachedModelVersion(@NonNull File modelDir) {\n   @Nullable\n   File getModelFileDestination(@NonNull CustomModel model) throws Exception {\n     File destFolder = getDirImpl(model.getName());\n+    if (!destFolder.exists()) {\n+      Log.d(TAG, \"model folder does not exist, creating one: \" + destFolder.getAbsolutePath());\n+      if (!destFolder.mkdirs()) {\n+        System.out.println(\"Failed to create model folder\" + destFolder);\n+        //        throw new FirebaseMLException(", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f18a918759eaadb8abe258587f26722295a0ddfd"}, "originalPosition": 38}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "734a39745d3bf8c7fedadba93ec94c3384cadbad", "author": {"user": {"login": "annzimmer", "name": "Ann Z"}}, "url": "https://github.com/firebase/firebase-android-sdk/commit/734a39745d3bf8c7fedadba93ec94c3384cadbad", "committedDate": "2020-12-08T19:42:16Z", "message": "Update getFile so it checks if the file exists before returning."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "319ec2954421ec44d422847b4d0f14bc805e8d93", "author": {"user": {"login": "annzimmer", "name": "Ann Z"}}, "url": "https://github.com/firebase/firebase-android-sdk/commit/319ec2954421ec44d422847b4d0f14bc805e8d93", "committedDate": "2020-12-11T15:40:04Z", "message": "Adding logging todo."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "fd19c30437a38a1ffd7afabd53c6676740b263ab", "author": {"user": {"login": "annzimmer", "name": "Ann Z"}}, "url": "https://github.com/firebase/firebase-android-sdk/commit/fd19c30437a38a1ffd7afabd53c6676740b263ab", "committedDate": "2020-12-11T15:44:48Z", "message": "Adding logging todo."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTUwNjA2MTY3", "url": "https://github.com/firebase/firebase-android-sdk/pull/2236#pullrequestreview-550606167", "createdAt": "2020-12-11T22:00:37Z", "commit": {"oid": "fd19c30437a38a1ffd7afabd53c6676740b263ab"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2341, "cost": 1, "resetAt": "2021-11-01T14:20:25Z"}}}