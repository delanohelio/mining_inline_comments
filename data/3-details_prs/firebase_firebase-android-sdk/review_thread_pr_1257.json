{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0Mzc3NDk2NTg5", "number": 1257, "reviewThreads": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yMFQyMzoxNzowOVrODhtkiw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yNlQyMzozODo1NFrODjSFEQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjM2Njc2MjM1OnYy", "diffSide": "RIGHT", "path": "firebase-inappmessaging/src/main/java/com/google/firebase/inappmessaging/FirebaseInAppMessaging.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yMFQyMzoxNzowOVrOFsmgvQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yMFQyMzoxNzowOVrOFsmgvQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MjMxMjYzNw==", "bodyText": "can we name this something else? From the code, its hard to understand whether displayMessage is being called on this listener or the object level one.", "url": "https://github.com/firebase/firebase-android-sdk/pull/1257#discussion_r382312637", "createdAt": "2020-02-20T23:17:09Z", "author": {"login": "prakhar1989"}, "path": "firebase-inappmessaging/src/main/java/com/google/firebase/inappmessaging/FirebaseInAppMessaging.java", "diffHunk": "@@ -162,21 +164,29 @@ public boolean areMessagesSuppressed() {\n   }\n \n   private void initializeFiam() {\n-    Disposable unusedSubscription =\n-        inAppMessageStreamManager\n-            .createFirebaseInAppMessageStream()\n-            .subscribe(\n-                triggeredInAppMessage ->\n-                    listener\n-                        .doOnSuccess(\n-                            listener -> {\n-                              listener.displayMessage(\n-                                  triggeredInAppMessage.getInAppMessage(),\n-                                  displayCallbacksFactory.generateDisplayCallback(\n-                                      triggeredInAppMessage.getInAppMessage(),\n-                                      triggeredInAppMessage.getTriggeringEvent()));\n-                            })\n-                        .subscribe());\n+    FirebaseInstanceId.getInstance()\n+        .getInstanceId()\n+        .addOnSuccessListener(\n+            new OnSuccessListener<InstanceIdResult>() {\n+              @Override\n+              public void onSuccess(InstanceIdResult instanceIdResult) {\n+                Disposable unusedSubscription =\n+                    inAppMessageStreamManager\n+                        .createFirebaseInAppMessageStream()\n+                        .subscribe(\n+                            triggeredInAppMessage ->\n+                                listener\n+                                    .doOnSuccess(\n+                                        listener -> {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "222fb10370829260f27d5eb3a38d632a8469c627"}, "originalPosition": 61}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjM4MzE5ODg0OnYy", "diffSide": "RIGHT", "path": "firebase-inappmessaging/src/main/java/com/google/firebase/inappmessaging/FirebaseInAppMessaging.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yNlQyMzoyNDoyN1rOFvADpg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yNlQyMzoyNDoyN1rOFvADpg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NDgyODMyNg==", "bodyText": "why do we need this method?", "url": "https://github.com/firebase/firebase-android-sdk/pull/1257#discussion_r384828326", "createdAt": "2020-02-26T23:24:27Z", "author": {"login": "prakhar1989"}, "path": "firebase-inappmessaging/src/main/java/com/google/firebase/inappmessaging/FirebaseInAppMessaging.java", "diffHunk": "@@ -161,53 +163,33 @@ public boolean areMessagesSuppressed() {\n     return areMessagesSuppressed;\n   }\n \n-  private void initializeFiam() {\n-    Disposable unusedSubscription =\n-        inAppMessageStreamManager\n-            .createFirebaseInAppMessageStream()\n-            .subscribe(\n-                triggeredInAppMessage ->\n-                    listener\n-                        .doOnSuccess(\n-                            listener -> {\n-                              listener.displayMessage(\n-                                  triggeredInAppMessage.getInAppMessage(),\n-                                  displayCallbacksFactory.generateDisplayCallback(\n-                                      triggeredInAppMessage.getInAppMessage(),\n-                                      triggeredInAppMessage.getTriggeringEvent()));\n-                            })\n-                        .subscribe());\n-  }\n-\n   /*\n    * Called to set a new message display component for FIAM SDK. This is the method used\n    * by both the default FIAM display SDK or any app wanting to customize the message\n    * display.\n    */\n   @Keep\n   public void setMessageDisplayComponent(@NonNull FirebaseInAppMessagingDisplay messageDisplay) {\n-    Logging.logi(\"Setting display event listener\");\n-    this.listener = Maybe.just(messageDisplay);\n+    Logging.logi(\"Setting display event component\");\n+    this.fiamDisplay = messageDisplay;\n   }\n \n   /**\n-   * Unregisters a listener to in app message display events.\n+   * Unregisters a fiamDisplay to in app message display events.\n    *\n    * @hide\n    */\n   @Keep\n   @KeepForSdk\n   public void clearDisplayListener() {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b646d51c282812f047adde06925264fe32bb9fb5"}, "originalPosition": 106}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjM4MzIyOTYxOnYy", "diffSide": "RIGHT", "path": "firebase-inappmessaging/src/main/java/com/google/firebase/inappmessaging/internal/InAppMessageStreamManager.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yNlQyMzozODo1NFrOFvAWDw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yNlQyMzo1ODo1N1rOFvAvIA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NDgzMzAzOQ==", "bodyText": "should this be task to single? http://reactivex.io/RxJava/3.x/javadoc/io/reactivex/rxjava3/core/Single.html", "url": "https://github.com/firebase/firebase-android-sdk/pull/1257#discussion_r384833039", "createdAt": "2020-02-26T23:38:54Z", "author": {"login": "prakhar1989"}, "path": "firebase-inappmessaging/src/main/java/com/google/firebase/inappmessaging/internal/InAppMessageStreamManager.java", "diffHunk": "@@ -233,7 +234,7 @@ private boolean shouldIgnoreCache(String event) {\n \n               Function<CampaignImpressionList, Maybe<FetchEligibleCampaignsResponse>> serviceFetch =\n                   impressions ->\n-                      Maybe.fromCallable(() -> apiClient.getFiams(impressions))\n+                      taskToMaybe(apiClient.getFiams(impressions))", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b646d51c282812f047adde06925264fe32bb9fb5"}, "originalPosition": 13}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NDgzOTQ1Ng==", "bodyText": "next cl", "url": "https://github.com/firebase/firebase-android-sdk/pull/1257#discussion_r384839456", "createdAt": "2020-02-26T23:58:57Z", "author": {"login": "JasonAHeron"}, "path": "firebase-inappmessaging/src/main/java/com/google/firebase/inappmessaging/internal/InAppMessageStreamManager.java", "diffHunk": "@@ -233,7 +234,7 @@ private boolean shouldIgnoreCache(String event) {\n \n               Function<CampaignImpressionList, Maybe<FetchEligibleCampaignsResponse>> serviceFetch =\n                   impressions ->\n-                      Maybe.fromCallable(() -> apiClient.getFiams(impressions))\n+                      taskToMaybe(apiClient.getFiams(impressions))", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NDgzMzAzOQ=="}, "originalCommit": {"oid": "b646d51c282812f047adde06925264fe32bb9fb5"}, "originalPosition": 13}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 782, "cost": 1, "resetAt": "2021-11-12T18:49:56Z"}}}