{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0MzczOTIwNTc4", "number": 1232, "title": "Improve impression logging for experimental campaigns", "bodyText": "", "createdAt": "2020-02-11T22:25:03Z", "url": "https://github.com/firebase/firebase-android-sdk/pull/1232", "merged": true, "mergeCommit": {"oid": "dbf2967f8038801d676899c8bfc2dace753c8f77"}, "closed": true, "closedAt": "2020-02-12T22:28:39Z", "author": {"login": "JasonAHeron"}, "timelineItems": {"totalCount": 13, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcDZaaiAH2gAyMzczOTIwNTc4OjQ5M2Y4MmQxZDk0MGY4MTNiOTc5ZWNlNWZmZDJlNTVkMTkyZDQ1ODc=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcDuBqLAFqTM1NzgzMzg1Ng==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "493f82d1d940f813b979ece5ffd2e55d192d4587", "author": {"user": {"login": "JasonAHeron", "name": "Jason Heron"}}, "url": "https://github.com/firebase/firebase-android-sdk/commit/493f82d1d940f813b979ece5ffd2e55d192d4587", "committedDate": "2020-02-11T22:24:20Z", "message": "Improve logging for experimental campaigns"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzU3MDQzOTk0", "url": "https://github.com/firebase/firebase-android-sdk/pull/1232#pullrequestreview-357043994", "createdAt": "2020-02-11T22:28:18Z", "commit": {"oid": "493f82d1d940f813b979ece5ffd2e55d192d4587"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xMVQyMjoyODoxOFrOFobfcA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xMVQyMjoyODoxOFrOFobfcA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NzkzNzc3Ng==", "bodyText": "Lets do Already impression campaign / experiment appropriately... Also, lets move this log line generation to a function.", "url": "https://github.com/firebase/firebase-android-sdk/pull/1232#discussion_r377937776", "createdAt": "2020-02-11T22:28:18Z", "author": {"login": "prakhar1989"}, "path": "firebase-inappmessaging/src/main/java/com/google/firebase/inappmessaging/internal/InAppMessageStreamManager.java", "diffHunk": "@@ -197,7 +197,14 @@ private boolean shouldIgnoreCache(String event) {\n                                       Logging.logi(\n                                           String.format(\n                                               \"Already impressed %s ? : %s\",", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "493f82d1d940f813b979ece5ffd2e55d192d4587"}, "originalPosition": 3}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "517eb31346fe612eb9260878da93fdd4d87a82b4", "author": {"user": {"login": "JasonAHeron", "name": "Jason Heron"}}, "url": "https://github.com/firebase/firebase-android-sdk/commit/517eb31346fe612eb9260878da93fdd4d87a82b4", "committedDate": "2020-02-12T00:03:08Z", "message": "Also make everything good"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "982a18088d956ce57be3301fa1d2f14640106326", "author": {"user": {"login": "JasonAHeron", "name": "Jason Heron"}}, "url": "https://github.com/firebase/firebase-android-sdk/commit/982a18088d956ce57be3301fa1d2f14640106326", "committedDate": "2020-02-12T00:09:50Z", "message": "fight the formatter"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "3369f3bb7ab976f83475ebb7dcec28a203ea8480", "author": {"user": {"login": "JasonAHeron", "name": "Jason Heron"}}, "url": "https://github.com/firebase/firebase-android-sdk/commit/3369f3bb7ab976f83475ebb7dcec28a203ea8480", "committedDate": "2020-02-12T00:48:29Z", "message": "make it better"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzU3MTgwOTU0", "url": "https://github.com/firebase/firebase-android-sdk/pull/1232#pullrequestreview-357180954", "createdAt": "2020-02-12T04:21:20Z", "commit": {"oid": "3369f3bb7ab976f83475ebb7dcec28a203ea8480"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xMlQwNDoyMToyMFrOFohYQg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xMlQwNDoyMToyMFrOFohYQg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3ODAzNDI0Mg==", "bodyText": "boolean primitive cannot be null", "url": "https://github.com/firebase/firebase-android-sdk/pull/1232#discussion_r378034242", "createdAt": "2020-02-12T04:21:20Z", "author": {"login": "PromanSEW"}, "path": "firebase-inappmessaging/src/main/java/com/google/firebase/inappmessaging/model/ProtoMarshallerClient.java", "diffHunk": "@@ -207,11 +208,14 @@ private static Text decode(MessagesProto.Text in) {\n   /** Tranform {@link MessagesProto.Content} proto to an {@link InAppMessage} value object */\n   public static InAppMessage decode(\n       @Nonnull MessagesProto.Content in,\n-      String campaignId,\n-      String campaignName,\n-      boolean isTestMessage,\n+      @NonNull String campaignId,\n+      @NonNull String campaignName,\n+      @NonNull boolean isTestMessage,", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "3369f3bb7ab976f83475ebb7dcec28a203ea8480"}, "originalPosition": 26}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "87d07a184480d324a17b4a2da25f385b2c0f45df", "author": {"user": {"login": "JasonAHeron", "name": "Jason Heron"}}, "url": "https://github.com/firebase/firebase-android-sdk/commit/87d07a184480d324a17b4a2da25f385b2c0f45df", "committedDate": "2020-02-12T17:49:12Z", "message": "be less dumb"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "04901c68b7c38fa8b65cad14454da178868cf1e7", "author": {"user": {"login": "JasonAHeron", "name": "Jason Heron"}}, "url": "https://github.com/firebase/firebase-android-sdk/commit/04901c68b7c38fa8b65cad14454da178868cf1e7", "committedDate": "2020-02-12T19:35:59Z", "message": "fix the tests"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "89b5f2f9573387118c88aafd777597422e7e1dc0", "author": {"user": {"login": "JasonAHeron", "name": "Jason Heron"}}, "url": "https://github.com/firebase/firebase-android-sdk/commit/89b5f2f9573387118c88aafd777597422e7e1dc0", "committedDate": "2020-02-12T20:27:43Z", "message": "cant be null"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "4eca1c012dbeb5dd10c3210cbdbb43ebb24bf3e9", "author": {"user": {"login": "JasonAHeron", "name": "Jason Heron"}}, "url": "https://github.com/firebase/firebase-android-sdk/commit/4eca1c012dbeb5dd10c3210cbdbb43ebb24bf3e9", "committedDate": "2020-02-12T20:47:20Z", "message": "format"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzU3NzkzNjI0", "url": "https://github.com/firebase/firebase-android-sdk/pull/1232#pullrequestreview-357793624", "createdAt": "2020-02-12T21:17:37Z", "commit": {"oid": "4eca1c012dbeb5dd10c3210cbdbb43ebb24bf3e9"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xMlQyMToxNzozN1rOFo-3qA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xMlQyMToyMTowOVrOFo--Jg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3ODUxNzQxNg==", "bodyText": "nit: add a space after \":\"", "url": "https://github.com/firebase/firebase-android-sdk/pull/1232#discussion_r378517416", "createdAt": "2020-02-12T21:17:37Z", "author": {"login": "prakhar1989"}, "path": "firebase-inappmessaging/src/main/java/com/google/firebase/inappmessaging/internal/DisplayCallbacksImpl.java", "diffHunk": "@@ -224,9 +224,9 @@ private void logActionNotTaken(String action) {\n   }\n \n   private Completable logToImpressionStore() {\n-    Logging.logd(\"Attempting to record: message impression in impression store\");\n-    String campaignId = inAppMessage.getCampaignId();\n-\n+    String campaignId = inAppMessage.getCampaignMetadata().getCampaignId();\n+    Logging.logd(\n+        \"Attempting to record message impression in impression store for id:\" + campaignId);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "4eca1c012dbeb5dd10c3210cbdbb43ebb24bf3e9"}, "originalPosition": 18}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3ODUxODMxOA==", "bodyText": "nit: In experimental payload case, this is technically an experimentId, right? Should add that as a comment / clarification and / or rename this variable?", "url": "https://github.com/firebase/firebase-android-sdk/pull/1232#discussion_r378518318", "createdAt": "2020-02-12T21:19:27Z", "author": {"login": "prakhar1989"}, "path": "firebase-inappmessaging/src/main/java/com/google/firebase/inappmessaging/internal/ImpressionStorageClient.java", "diffHunk": "@@ -84,7 +85,11 @@ private void clearInMemCache() {\n   }\n \n   /** Returns {@code Single.just(true)} if the campaign has been impressed */\n-  public Single<Boolean> isImpressed(String campaignId) {\n+  public Single<Boolean> isImpressed(CampaignProto.ThickContent content) {\n+    String campaignId =", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "4eca1c012dbeb5dd10c3210cbdbb43ebb24bf3e9"}, "originalPosition": 14}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3ODUxODUzOA==", "bodyText": "s/campaign/experiment?", "url": "https://github.com/firebase/firebase-android-sdk/pull/1232#discussion_r378518538", "createdAt": "2020-02-12T21:19:55Z", "author": {"login": "prakhar1989"}, "path": "firebase-inappmessaging/src/main/java/com/google/firebase/inappmessaging/internal/InAppMessageStreamManager.java", "diffHunk": "@@ -288,6 +282,20 @@ private boolean shouldIgnoreCache(String event) {\n     return Maybe.just(content);\n   }\n \n+  private static void logImpressionStatus(ThickContent content, Boolean isImpressed) {\n+    if (content.getPayloadCase().equals(ThickContent.PayloadCase.VANILLA_PAYLOAD)) {\n+      Logging.logi(\n+          String.format(\n+              \"Already impressed campaign %s ? : %s\",\n+              content.getVanillaPayload().getCampaignName(), isImpressed));\n+    } else if (content.getPayloadCase().equals(ThickContent.PayloadCase.EXPERIMENTAL_PAYLOAD)) {\n+      Logging.logi(\n+          String.format(\n+              \"Already impressed campaign %s ? : %s\",", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "4eca1c012dbeb5dd10c3210cbdbb43ebb24bf3e9"}, "originalPosition": 35}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3ODUxOTA3OA==", "bodyText": "why did we change this? The more specific it is, the better. I'd vote for bringing this back.", "url": "https://github.com/firebase/firebase-android-sdk/pull/1232#discussion_r378519078", "createdAt": "2020-02-12T21:21:09Z", "author": {"login": "prakhar1989"}, "path": "firebase-inappmessaging/src/test/java/com/google/firebase/inappmessaging/internal/InAppMessageStreamManagerTest.java", "diffHunk": "@@ -560,7 +559,7 @@ public void stream_onCacheWriteFailure_AbsorbsError() {\n \n   @Test\n   public void stream_whenCampaignImpressed_filtersCampaign() {\n-    when(impressionStorageClient.isImpressed(anyString())).thenReturn(Single.just(true));\n+    when(impressionStorageClient.isImpressed(any())).thenReturn(Single.just(true));", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "4eca1c012dbeb5dd10c3210cbdbb43ebb24bf3e9"}, "originalPosition": 22}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "d348ac0de2322170ceec80a78987fde6c3a1699a", "author": {"user": {"login": "JasonAHeron", "name": "Jason Heron"}}, "url": "https://github.com/firebase/firebase-android-sdk/commit/d348ac0de2322170ceec80a78987fde6c3a1699a", "committedDate": "2020-02-12T21:50:01Z", "message": "k"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzU3ODMzODU2", "url": "https://github.com/firebase/firebase-android-sdk/pull/1232#pullrequestreview-357833856", "createdAt": "2020-02-12T22:25:18Z", "commit": {"oid": "d348ac0de2322170ceec80a78987fde6c3a1699a"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2049, "cost": 1, "resetAt": "2021-11-01T14:20:25Z"}}}