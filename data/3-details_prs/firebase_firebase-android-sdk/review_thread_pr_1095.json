{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0MzYwMTEzNjUz", "number": 1095, "reviewThreads": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0wN1QxODozMzowOVrODWVROA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0wN1QxODozNjoyN1rODWVUdg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjI0NzQzNzM2OnYy", "diffSide": "RIGHT", "path": "firebase-installations/src/main/java/com/google/firebase/installations/local/IidStore.java", "isResolved": true, "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0wN1QxODozMzoxMFrOFbCANA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0wN1QyMzoxMzo0NFrOFbIo_Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2Mzg4ODY5Mg==", "bodyText": "There is also version 2: which works exactly the same as 1:", "url": "https://github.com/firebase/firebase-android-sdk/pull/1095#discussion_r363888692", "createdAt": "2020-01-07T18:33:10Z", "author": {"login": "andirayo"}, "path": "firebase-installations/src/main/java/com/google/firebase/installations/local/IidStore.java", "diffHunk": "@@ -38,17 +40,79 @@\n   private static final String IID_SHARED_PREFS_NAME = \"com.google.android.gms.appid\";\n   private static final String STORE_KEY_PUB = \"|S||P|\";\n   private static final String STORE_KEY_ID = \"|S|id\";\n+  private static final String STORE_KEY_TOKEN = \"|T|\";\n+  private static final String DEFAULT_SCOPE = \"|*\";\n+  private static final String JSON_TOKEN_KEY = \"token\";\n+  private static final String JSON_ENCODED_PREFIX = \"{\";\n \n   @GuardedBy(\"iidPrefs\")\n   private final SharedPreferences iidPrefs;\n \n+  private final String defaultSenderId;\n+\n   public IidStore() {\n     // Different FirebaseApp in the same Android application should have the same application\n     // context and same dir path. We only read existing Iids for the default firebase application.\n     iidPrefs =\n         FirebaseApp.getInstance()\n             .getApplicationContext()\n             .getSharedPreferences(IID_SHARED_PREFS_NAME, Context.MODE_PRIVATE);\n+\n+    defaultSenderId = getDefaultSenderId(FirebaseApp.getInstance());\n+  }\n+\n+  private static String getDefaultSenderId(FirebaseApp app) {\n+    // Check for an explicit sender id\n+    String senderId = app.getOptions().getGcmSenderId();\n+    if (senderId != null) {\n+      return senderId;\n+    }\n+    String appId = app.getOptions().getApplicationId();\n+    if (!appId.startsWith(\"1:\")) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "e22c3ca409e497aa547e3a50e34aa9cded6248ed"}, "originalPosition": 41}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2Mzg5MDU2OQ==", "bodyText": "if (!appId.startsWith(\"1:\") && !appId.startsWith(\"2:\")) {", "url": "https://github.com/firebase/firebase-android-sdk/pull/1095#discussion_r363890569", "createdAt": "2020-01-07T18:37:44Z", "author": {"login": "andirayo"}, "path": "firebase-installations/src/main/java/com/google/firebase/installations/local/IidStore.java", "diffHunk": "@@ -38,17 +40,79 @@\n   private static final String IID_SHARED_PREFS_NAME = \"com.google.android.gms.appid\";\n   private static final String STORE_KEY_PUB = \"|S||P|\";\n   private static final String STORE_KEY_ID = \"|S|id\";\n+  private static final String STORE_KEY_TOKEN = \"|T|\";\n+  private static final String DEFAULT_SCOPE = \"|*\";\n+  private static final String JSON_TOKEN_KEY = \"token\";\n+  private static final String JSON_ENCODED_PREFIX = \"{\";\n \n   @GuardedBy(\"iidPrefs\")\n   private final SharedPreferences iidPrefs;\n \n+  private final String defaultSenderId;\n+\n   public IidStore() {\n     // Different FirebaseApp in the same Android application should have the same application\n     // context and same dir path. We only read existing Iids for the default firebase application.\n     iidPrefs =\n         FirebaseApp.getInstance()\n             .getApplicationContext()\n             .getSharedPreferences(IID_SHARED_PREFS_NAME, Context.MODE_PRIVATE);\n+\n+    defaultSenderId = getDefaultSenderId(FirebaseApp.getInstance());\n+  }\n+\n+  private static String getDefaultSenderId(FirebaseApp app) {\n+    // Check for an explicit sender id\n+    String senderId = app.getOptions().getGcmSenderId();\n+    if (senderId != null) {\n+      return senderId;\n+    }\n+    String appId = app.getOptions().getApplicationId();\n+    if (!appId.startsWith(\"1:\")) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2Mzg4ODY5Mg=="}, "originalCommit": {"oid": "e22c3ca409e497aa547e3a50e34aa9cded6248ed"}, "originalPosition": 41}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2Mzk5NzQzNw==", "bodyText": "Done.", "url": "https://github.com/firebase/firebase-android-sdk/pull/1095#discussion_r363997437", "createdAt": "2020-01-07T23:13:44Z", "author": {"login": "ankitaj224"}, "path": "firebase-installations/src/main/java/com/google/firebase/installations/local/IidStore.java", "diffHunk": "@@ -38,17 +40,79 @@\n   private static final String IID_SHARED_PREFS_NAME = \"com.google.android.gms.appid\";\n   private static final String STORE_KEY_PUB = \"|S||P|\";\n   private static final String STORE_KEY_ID = \"|S|id\";\n+  private static final String STORE_KEY_TOKEN = \"|T|\";\n+  private static final String DEFAULT_SCOPE = \"|*\";\n+  private static final String JSON_TOKEN_KEY = \"token\";\n+  private static final String JSON_ENCODED_PREFIX = \"{\";\n \n   @GuardedBy(\"iidPrefs\")\n   private final SharedPreferences iidPrefs;\n \n+  private final String defaultSenderId;\n+\n   public IidStore() {\n     // Different FirebaseApp in the same Android application should have the same application\n     // context and same dir path. We only read existing Iids for the default firebase application.\n     iidPrefs =\n         FirebaseApp.getInstance()\n             .getApplicationContext()\n             .getSharedPreferences(IID_SHARED_PREFS_NAME, Context.MODE_PRIVATE);\n+\n+    defaultSenderId = getDefaultSenderId(FirebaseApp.getInstance());\n+  }\n+\n+  private static String getDefaultSenderId(FirebaseApp app) {\n+    // Check for an explicit sender id\n+    String senderId = app.getOptions().getGcmSenderId();\n+    if (senderId != null) {\n+      return senderId;\n+    }\n+    String appId = app.getOptions().getApplicationId();\n+    if (!appId.startsWith(\"1:\")) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2Mzg4ODY5Mg=="}, "originalCommit": {"oid": "e22c3ca409e497aa547e3a50e34aa9cded6248ed"}, "originalPosition": 41}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjI0NzQ0MTc0OnYy", "diffSide": "RIGHT", "path": "firebase-installations/src/main/java/com/google/firebase/installations/local/IidStore.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0wN1QxODozNTowMlrOFbCDHQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0wN1QyMzoxNDowM1rOFbIpYQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2Mzg4OTQzNw==", "bodyText": "I don't understand the purpose of this comments.\nI recommend replacing it with this:\n\"If applicationId does not contain a (GMP-)App-ID, it contains a Sender identifier\"", "url": "https://github.com/firebase/firebase-android-sdk/pull/1095#discussion_r363889437", "createdAt": "2020-01-07T18:35:02Z", "author": {"login": "andirayo"}, "path": "firebase-installations/src/main/java/com/google/firebase/installations/local/IidStore.java", "diffHunk": "@@ -38,17 +40,79 @@\n   private static final String IID_SHARED_PREFS_NAME = \"com.google.android.gms.appid\";\n   private static final String STORE_KEY_PUB = \"|S||P|\";\n   private static final String STORE_KEY_ID = \"|S|id\";\n+  private static final String STORE_KEY_TOKEN = \"|T|\";\n+  private static final String DEFAULT_SCOPE = \"|*\";\n+  private static final String JSON_TOKEN_KEY = \"token\";\n+  private static final String JSON_ENCODED_PREFIX = \"{\";\n \n   @GuardedBy(\"iidPrefs\")\n   private final SharedPreferences iidPrefs;\n \n+  private final String defaultSenderId;\n+\n   public IidStore() {\n     // Different FirebaseApp in the same Android application should have the same application\n     // context and same dir path. We only read existing Iids for the default firebase application.\n     iidPrefs =\n         FirebaseApp.getInstance()\n             .getApplicationContext()\n             .getSharedPreferences(IID_SHARED_PREFS_NAME, Context.MODE_PRIVATE);\n+\n+    defaultSenderId = getDefaultSenderId(FirebaseApp.getInstance());\n+  }\n+\n+  private static String getDefaultSenderId(FirebaseApp app) {\n+    // Check for an explicit sender id\n+    String senderId = app.getOptions().getGcmSenderId();\n+    if (senderId != null) {\n+      return senderId;\n+    }\n+    String appId = app.getOptions().getApplicationId();\n+    if (!appId.startsWith(\"1:\")) {\n+      // Not v1, server should be updated to accept the full app ID now", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "e22c3ca409e497aa547e3a50e34aa9cded6248ed"}, "originalPosition": 42}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2Mzk5NzUzNw==", "bodyText": "Done.", "url": "https://github.com/firebase/firebase-android-sdk/pull/1095#discussion_r363997537", "createdAt": "2020-01-07T23:14:03Z", "author": {"login": "ankitaj224"}, "path": "firebase-installations/src/main/java/com/google/firebase/installations/local/IidStore.java", "diffHunk": "@@ -38,17 +40,79 @@\n   private static final String IID_SHARED_PREFS_NAME = \"com.google.android.gms.appid\";\n   private static final String STORE_KEY_PUB = \"|S||P|\";\n   private static final String STORE_KEY_ID = \"|S|id\";\n+  private static final String STORE_KEY_TOKEN = \"|T|\";\n+  private static final String DEFAULT_SCOPE = \"|*\";\n+  private static final String JSON_TOKEN_KEY = \"token\";\n+  private static final String JSON_ENCODED_PREFIX = \"{\";\n \n   @GuardedBy(\"iidPrefs\")\n   private final SharedPreferences iidPrefs;\n \n+  private final String defaultSenderId;\n+\n   public IidStore() {\n     // Different FirebaseApp in the same Android application should have the same application\n     // context and same dir path. We only read existing Iids for the default firebase application.\n     iidPrefs =\n         FirebaseApp.getInstance()\n             .getApplicationContext()\n             .getSharedPreferences(IID_SHARED_PREFS_NAME, Context.MODE_PRIVATE);\n+\n+    defaultSenderId = getDefaultSenderId(FirebaseApp.getInstance());\n+  }\n+\n+  private static String getDefaultSenderId(FirebaseApp app) {\n+    // Check for an explicit sender id\n+    String senderId = app.getOptions().getGcmSenderId();\n+    if (senderId != null) {\n+      return senderId;\n+    }\n+    String appId = app.getOptions().getApplicationId();\n+    if (!appId.startsWith(\"1:\")) {\n+      // Not v1, server should be updated to accept the full app ID now", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2Mzg4OTQzNw=="}, "originalCommit": {"oid": "e22c3ca409e497aa547e3a50e34aa9cded6248ed"}, "originalPosition": 42}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjI0NzQ0NTY2OnYy", "diffSide": "RIGHT", "path": "firebase-installations/src/main/java/com/google/firebase/installations/local/IidStore.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0wN1QxODozNjoyN1rOFbCFmQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0wN1QyMzoxMzo1M1rOFbIpKQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2Mzg5MDA3Mw==", "bodyText": "if method #split, splits all parts, then the result should contain exactly 4 parts...\nif (parts.length != 4)", "url": "https://github.com/firebase/firebase-android-sdk/pull/1095#discussion_r363890073", "createdAt": "2020-01-07T18:36:27Z", "author": {"login": "andirayo"}, "path": "firebase-installations/src/main/java/com/google/firebase/installations/local/IidStore.java", "diffHunk": "@@ -38,17 +40,79 @@\n   private static final String IID_SHARED_PREFS_NAME = \"com.google.android.gms.appid\";\n   private static final String STORE_KEY_PUB = \"|S||P|\";\n   private static final String STORE_KEY_ID = \"|S|id\";\n+  private static final String STORE_KEY_TOKEN = \"|T|\";\n+  private static final String DEFAULT_SCOPE = \"|*\";\n+  private static final String JSON_TOKEN_KEY = \"token\";\n+  private static final String JSON_ENCODED_PREFIX = \"{\";\n \n   @GuardedBy(\"iidPrefs\")\n   private final SharedPreferences iidPrefs;\n \n+  private final String defaultSenderId;\n+\n   public IidStore() {\n     // Different FirebaseApp in the same Android application should have the same application\n     // context and same dir path. We only read existing Iids for the default firebase application.\n     iidPrefs =\n         FirebaseApp.getInstance()\n             .getApplicationContext()\n             .getSharedPreferences(IID_SHARED_PREFS_NAME, Context.MODE_PRIVATE);\n+\n+    defaultSenderId = getDefaultSenderId(FirebaseApp.getInstance());\n+  }\n+\n+  private static String getDefaultSenderId(FirebaseApp app) {\n+    // Check for an explicit sender id\n+    String senderId = app.getOptions().getGcmSenderId();\n+    if (senderId != null) {\n+      return senderId;\n+    }\n+    String appId = app.getOptions().getApplicationId();\n+    if (!appId.startsWith(\"1:\")) {\n+      // Not v1, server should be updated to accept the full app ID now\n+      return appId;\n+    }\n+    // For v1 app IDs, fall back to parsing the project number out\n+    @SuppressWarnings(\"StringSplitter\")\n+    String[] parts = appId.split(\":\");\n+    if (parts.length < 2) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "e22c3ca409e497aa547e3a50e34aa9cded6248ed"}, "originalPosition": 48}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2Mzk5NzQ4MQ==", "bodyText": "Done.", "url": "https://github.com/firebase/firebase-android-sdk/pull/1095#discussion_r363997481", "createdAt": "2020-01-07T23:13:53Z", "author": {"login": "ankitaj224"}, "path": "firebase-installations/src/main/java/com/google/firebase/installations/local/IidStore.java", "diffHunk": "@@ -38,17 +40,79 @@\n   private static final String IID_SHARED_PREFS_NAME = \"com.google.android.gms.appid\";\n   private static final String STORE_KEY_PUB = \"|S||P|\";\n   private static final String STORE_KEY_ID = \"|S|id\";\n+  private static final String STORE_KEY_TOKEN = \"|T|\";\n+  private static final String DEFAULT_SCOPE = \"|*\";\n+  private static final String JSON_TOKEN_KEY = \"token\";\n+  private static final String JSON_ENCODED_PREFIX = \"{\";\n \n   @GuardedBy(\"iidPrefs\")\n   private final SharedPreferences iidPrefs;\n \n+  private final String defaultSenderId;\n+\n   public IidStore() {\n     // Different FirebaseApp in the same Android application should have the same application\n     // context and same dir path. We only read existing Iids for the default firebase application.\n     iidPrefs =\n         FirebaseApp.getInstance()\n             .getApplicationContext()\n             .getSharedPreferences(IID_SHARED_PREFS_NAME, Context.MODE_PRIVATE);\n+\n+    defaultSenderId = getDefaultSenderId(FirebaseApp.getInstance());\n+  }\n+\n+  private static String getDefaultSenderId(FirebaseApp app) {\n+    // Check for an explicit sender id\n+    String senderId = app.getOptions().getGcmSenderId();\n+    if (senderId != null) {\n+      return senderId;\n+    }\n+    String appId = app.getOptions().getApplicationId();\n+    if (!appId.startsWith(\"1:\")) {\n+      // Not v1, server should be updated to accept the full app ID now\n+      return appId;\n+    }\n+    // For v1 app IDs, fall back to parsing the project number out\n+    @SuppressWarnings(\"StringSplitter\")\n+    String[] parts = appId.split(\":\");\n+    if (parts.length < 2) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2Mzg5MDA3Mw=="}, "originalCommit": {"oid": "e22c3ca409e497aa547e3a50e34aa9cded6248ed"}, "originalPosition": 48}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 888, "cost": 1, "resetAt": "2021-11-12T18:49:56Z"}}}