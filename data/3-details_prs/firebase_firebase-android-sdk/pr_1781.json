{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDUxNDk4MDM3", "number": 1781, "title": "Improve action click browser handling for FIAM and implement dismiss listener", "bodyText": "This should solve some of the issues brought up in #1603", "createdAt": "2020-07-17T22:09:55Z", "url": "https://github.com/firebase/firebase-android-sdk/pull/1781", "merged": true, "mergeCommit": {"oid": "96b07e33615ce7e37eb11a8e72fe85e7ef05a4ac"}, "closed": true, "closedAt": "2020-08-10T21:19:35Z", "author": {"login": "JasonAHeron"}, "timelineItems": {"totalCount": 8, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABc5armNgBqjM1OTU2MzUzNTA=", "endCursor": "Y3Vyc29yOnYyOpPPAAABc8W-cHgBqjM2MzA5NTc2MDQ=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "51b1189caf3df7139e3d67110809c29bf1a70a2b", "author": {"user": {"login": "JasonAHeron", "name": "Jason Heron"}}, "url": "https://github.com/firebase/firebase-android-sdk/commit/51b1189caf3df7139e3d67110809c29bf1a70a2b", "committedDate": "2020-07-28T00:18:46Z", "message": "heal eye stab wound"}, "afterCommit": {"oid": "5699a96df74e490f60574569d0ebf8c11ee3f67c", "author": {"user": {"login": "JasonAHeron", "name": "Jason Heron"}}, "url": "https://github.com/firebase/firebase-android-sdk/commit/5699a96df74e490f60574569d0ebf8c11ee3f67c", "committedDate": "2020-07-28T18:24:43Z", "message": "heal eye stab wound"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDUxODMzODc3", "url": "https://github.com/firebase/firebase-android-sdk/pull/1781#pullrequestreview-451833877", "createdAt": "2020-07-20T17:57:05Z", "commit": {"oid": "6be6b1cbfbb6e372bf96b228222557f9fdf64bc0"}, "state": "APPROVED", "comments": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yMFQxNzo1NzowNVrOG0ZKXQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yMFQxODoyNjo0MFrOG0aJ-w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NzU5MTM4OQ==", "bodyText": "Can we add some documentation for our future selves about why we need to check for custom tabs?", "url": "https://github.com/firebase/firebase-android-sdk/pull/1781#discussion_r457591389", "createdAt": "2020-07-20T17:57:05Z", "author": {"login": "prakhar1989"}, "path": "firebase-inappmessaging-display/src/main/java/com/google/firebase/inappmessaging/display/FirebaseInAppMessagingDisplay.java", "diffHunk": "@@ -535,4 +547,32 @@ private void notifyFiamDismiss() {\n       fiamListener.onFiamDismiss();\n     }\n   }\n+\n+  private void launchUriIntent(Activity activity, Uri uri) {\n+    if (supportsCustomTabs(activity)) {\n+      CustomTabsIntent customTabsIntent = new CustomTabsIntent.Builder().build();\n+      Intent intent = customTabsIntent.intent;\n+      intent.addFlags(Intent.FLAG_ACTIVITY_NO_HISTORY);\n+      intent.addFlags(Intent.FLAG_ACTIVITY_NEW_TASK);\n+      customTabsIntent.launchUrl(activity, uri);\n+    } else {\n+      Intent browserIntent = new Intent(Intent.ACTION_VIEW, uri);\n+      ResolveInfo info = activity.getPackageManager().resolveActivity(browserIntent, 0);\n+      browserIntent.addFlags(Intent.FLAG_ACTIVITY_NO_HISTORY);\n+      browserIntent.addFlags(Intent.FLAG_ACTIVITY_NEW_TASK);\n+      if (info != null) {\n+        activity.startActivity(browserIntent);\n+      } else {\n+        Logging.loge(\"Device cannot resolve intent for: \" + Intent.ACTION_VIEW);\n+      }\n+    }\n+  }\n+\n+  private boolean supportsCustomTabs(Activity activity) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "6be6b1cbfbb6e372bf96b228222557f9fdf64bc0"}, "originalPosition": 87}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NzU5MjI1OA==", "bodyText": "Some documentation for the if/else branches", "url": "https://github.com/firebase/firebase-android-sdk/pull/1781#discussion_r457592258", "createdAt": "2020-07-20T17:58:35Z", "author": {"login": "prakhar1989"}, "path": "firebase-inappmessaging-display/src/main/java/com/google/firebase/inappmessaging/display/FirebaseInAppMessagingDisplay.java", "diffHunk": "@@ -535,4 +547,32 @@ private void notifyFiamDismiss() {\n       fiamListener.onFiamDismiss();\n     }\n   }\n+\n+  private void launchUriIntent(Activity activity, Uri uri) {\n+    if (supportsCustomTabs(activity)) {\n+      CustomTabsIntent customTabsIntent = new CustomTabsIntent.Builder().build();\n+      Intent intent = customTabsIntent.intent;\n+      intent.addFlags(Intent.FLAG_ACTIVITY_NO_HISTORY);\n+      intent.addFlags(Intent.FLAG_ACTIVITY_NEW_TASK);\n+      customTabsIntent.launchUrl(activity, uri);\n+    } else {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "6be6b1cbfbb6e372bf96b228222557f9fdf64bc0"}, "originalPosition": 74}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NzU5Mjk0Ng==", "bodyText": "Worth adding a log here: \"Calling callback for action\"?", "url": "https://github.com/firebase/firebase-android-sdk/pull/1781#discussion_r457592946", "createdAt": "2020-07-20T17:59:46Z", "author": {"login": "prakhar1989"}, "path": "firebase-inappmessaging-display/src/main/java/com/google/firebase/inappmessaging/display/FirebaseInAppMessagingDisplay.java", "diffHunk": "@@ -332,8 +328,24 @@ public void onClick(View v) {\n                 callbacks = null;\n               }\n             };\n+      } else if (action != null && TextUtils.isEmpty(action.getActionUrl())) {\n+        // If the message has an action but no action url, attempt to call developer callback\n+        Logging.logi(\"No action url found for action. Callback will be called if present\");\n+        actionListener =\n+            new View.OnClickListener() {\n+              @Override\n+              public void onClick(View v) {\n+                if (callbacks != null) {\n+                  callbacks.messageClicked(action);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "6be6b1cbfbb6e372bf96b228222557f9fdf64bc0"}, "originalPosition": 48}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NzYwNzY3NQ==", "bodyText": "replace i.e with e.g since there are other ways to dismiss as well? (eg. hitting the back button)?", "url": "https://github.com/firebase/firebase-android-sdk/pull/1781#discussion_r457607675", "createdAt": "2020-07-20T18:26:40Z", "author": {"login": "prakhar1989"}, "path": "firebase-inappmessaging/src/main/java/com/google/firebase/inappmessaging/FirebaseInAppMessagingDismissListener.java", "diffHunk": "@@ -0,0 +1,24 @@\n+// Copyright 2020 Google LLC\n+//\n+// Licensed under the Apache License, Version 2.0 (the \"License\");\n+// you may not use this file except in compliance with the License.\n+// You may obtain a copy of the License at\n+//\n+//      http://www.apache.org/licenses/LICENSE-2.0\n+//\n+// Unless required by applicable law or agreed to in writing, software\n+// distributed under the License is distributed on an \"AS IS\" BASIS,\n+// WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+// See the License for the specific language governing permissions and\n+// limitations under the License.\n+\n+package com.google.firebase.inappmessaging;\n+\n+import androidx.annotation.NonNull;\n+import com.google.firebase.inappmessaging.model.InAppMessage;\n+\n+public interface FirebaseInAppMessagingDismissListener {\n+\n+  // Triggered when a message is dismissed (ie: \"x\" button, in the modal view)", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "6be6b1cbfbb6e372bf96b228222557f9fdf64bc0"}, "originalPosition": 22}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e542d5301da86f039f764687bdf9cd6413d46e0a", "author": {"user": {"login": "JasonAHeron", "name": "Jason Heron"}}, "url": "https://github.com/firebase/firebase-android-sdk/commit/e542d5301da86f039f764687bdf9cd6413d46e0a", "committedDate": "2020-08-06T21:42:01Z", "message": "improve click behavior and add dismiss listener"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "8b1e379159b8beb3611389c73d11fb7109f98c1c", "author": {"user": {"login": "JasonAHeron", "name": "Jason Heron"}}, "url": "https://github.com/firebase/firebase-android-sdk/commit/8b1e379159b8beb3611389c73d11fb7109f98c1c", "committedDate": "2020-08-06T21:42:01Z", "message": "stab self in eye"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "86ce62f3d4face367af17fa09e7cdc662c1802fe", "author": {"user": {"login": "JasonAHeron", "name": "Jason Heron"}}, "url": "https://github.com/firebase/firebase-android-sdk/commit/86ce62f3d4face367af17fa09e7cdc662c1802fe", "committedDate": "2020-08-06T21:42:01Z", "message": "heal eye stab wound"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "d3b3b3aa10974ad20d0b5049f8e3046e01927bdd", "author": {"user": {"login": "JasonAHeron", "name": "Jason Heron"}}, "url": "https://github.com/firebase/firebase-android-sdk/commit/d3b3b3aa10974ad20d0b5049f8e3046e01927bdd", "committedDate": "2020-08-06T21:42:01Z", "message": "go back to the old version because the new one kills everything"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f2b6f9a027a30080fe3af03018d3c7139d41e7b3", "author": {"user": {"login": "JasonAHeron", "name": "Jason Heron"}}, "url": "https://github.com/firebase/firebase-android-sdk/commit/f2b6f9a027a30080fe3af03018d3c7139d41e7b3", "committedDate": "2020-08-06T21:47:28Z", "message": "address review comments"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "81789250501b2784c6808423b54ad33ad974a7df", "author": {"user": {"login": "JasonAHeron", "name": "Jason Heron"}}, "url": "https://github.com/firebase/firebase-android-sdk/commit/81789250501b2784c6808423b54ad33ad974a7df", "committedDate": "2020-07-29T18:52:00Z", "message": "go back to the old version because the new one kills everything"}, "afterCommit": {"oid": "f2b6f9a027a30080fe3af03018d3c7139d41e7b3", "author": {"user": {"login": "JasonAHeron", "name": "Jason Heron"}}, "url": "https://github.com/firebase/firebase-android-sdk/commit/f2b6f9a027a30080fe3af03018d3c7139d41e7b3", "committedDate": "2020-08-06T21:47:28Z", "message": "address review comments"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2587, "cost": 1, "resetAt": "2021-11-01T14:20:25Z"}}}