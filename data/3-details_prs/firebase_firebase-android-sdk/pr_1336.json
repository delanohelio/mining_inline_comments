{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0Mzg2MzI3MzU3", "number": 1336, "title": "Consolidate remaining 'core' classes into 'internal/common'", "bodyText": "", "createdAt": "2020-03-10T19:39:54Z", "url": "https://github.com/firebase/firebase-android-sdk/pull/1336", "merged": true, "mergeCommit": {"oid": "5440af41f0d15ff1358038dc31fcd1d4eac0a89c"}, "closed": true, "closedAt": "2020-03-10T20:39:34Z", "author": {"login": "mrwillis21"}, "timelineItems": {"totalCount": 6, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcMXn2ZgH2gAyMzg2MzI3MzU3OjgwZGU5ZWUxMGE1MWI0NzE2MDQ5NTJhNWZiZGY3OTE3MzQ0ZDgzYjU=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcMYIUhgH2gAyMzg2MzI3MzU3OjcxYjZiY2E0ZTFjZWY0NmQ1NGUxZDg1M2Y5Y2E4ZWE3ZjY1MTdjZDY=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "80de9ee10a51b471604952a5fbdf7917344d83b5", "author": {"user": {"login": "mrwillis21", "name": "Matt Willis"}}, "url": "https://github.com/firebase/firebase-android-sdk/commit/80de9ee10a51b471604952a5fbdf7917344d83b5", "committedDate": "2020-03-10T19:24:31Z", "message": "Move remaining 'core' classes to internal/common"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "5610b7116de356bdab5e273ee904b12c80ea8db5", "author": {"user": {"login": "mrwillis21", "name": "Matt Willis"}}, "url": "https://github.com/firebase/firebase-android-sdk/commit/5610b7116de356bdab5e273ee904b12c80ea8db5", "committedDate": "2020-03-10T19:35:58Z", "message": "Reduce unnecessary class visibility"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c8ac55919cdd7b41e6b6fc932db60d69b7351504", "author": {"user": {"login": "mrwillis21", "name": "Matt Willis"}}, "url": "https://github.com/firebase/firebase-android-sdk/commit/c8ac55919cdd7b41e6b6fc932db60d69b7351504", "committedDate": "2020-03-10T19:38:19Z", "message": "Formatting"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzcyMjY5MzM2", "url": "https://github.com/firebase/firebase-android-sdk/pull/1336#pullrequestreview-372269336", "createdAt": "2020-03-10T19:46:16Z", "commit": {"oid": "c8ac55919cdd7b41e6b6fc932db60d69b7351504"}, "state": "APPROVED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xMFQxOTo0NjoxNlrOF0eaVw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xMFQxOTo0NjoxNlrOF0eaVw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MDU2ODUzNQ==", "bodyText": "Thread.sleep behaviors are not ideal in tests because it can slow your overall test suite. Are there any alternative ways we could do this (e.g., abstract / mock more systems, or loop and check for state existing within some time bounds, and exit early if state becomes present?", "url": "https://github.com/firebase/firebase-android-sdk/pull/1336#discussion_r390568535", "createdAt": "2020-03-10T19:46:16Z", "author": {"login": "jakeouellette"}, "path": "firebase-crashlytics/src/androidTest/java/com/google/firebase/crashlytics/internal/common/CommonUtilsTest.java", "diffHunk": "@@ -288,6 +295,71 @@ public void testResolveBuildId_bothIds() throws Exception {\n         });\n   }\n \n+  public void testCapFileCount() throws Exception {\n+    final Context context = getContext();\n+\n+    final File testDir = new File(context.getFilesDir(), \"trim_test\");\n+    testDir.mkdirs();\n+    // make sure the directory is empty. Doesn't recurse into subdirs, but that's OK since\n+    // we're only using this directory for this test and we won't create any subdirs.\n+    for (File f : testDir.listFiles()) {\n+      if (f.isFile()) {\n+        f.delete();\n+      }\n+    }\n+\n+    final int maxFiles = 4;\n+    // create a bunch of non-cls files that don't match the capFileCount\n+    for (int i = 0; i < maxFiles + 2; ++i) {\n+      new File(testDir, \"whatever\" + i + \".blah\").createNewFile();\n+    }\n+    assertEquals(maxFiles + 2, testDir.listFiles().length);\n+    final FilenameFilter clsFilter = CrashlyticsController.SESSION_FILE_FILTER;\n+    // This should have no effect - nothing matches the filter yet\n+    Utils.capFileCount(\n+        testDir, clsFilter, maxFiles, CrashlyticsController.SMALLEST_FILE_NAME_FIRST);\n+    assertEquals(maxFiles + 2, testDir.listFiles().length);\n+\n+    // create two groups of empty crash files. The first set will be deleted after the 2nd\n+    // is created and trim is invoked.\n+    final Set<File> oldFiles = new HashSet<File>();\n+    for (int i = 0; i < maxFiles; ++i) {\n+      oldFiles.add(createEmptyClsFile(testDir));\n+\n+      // This should have no effect - we're not over the limit\n+      Utils.capFileCount(\n+          testDir, clsFilter, maxFiles, CrashlyticsController.SMALLEST_FILE_NAME_FIRST);\n+      assertEquals(oldFiles.size(), testDir.listFiles(clsFilter).length);\n+    }\n+    // The filesystem only has 1sec precision, so we need to sleep long enough that\n+    // the timestamps in the 2nd set of files are later than the ones in the first.\n+    Thread.sleep(1500);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c8ac55919cdd7b41e6b6fc932db60d69b7351504"}, "originalPosition": 58}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzcyMjczMzkx", "url": "https://github.com/firebase/firebase-android-sdk/pull/1336#pullrequestreview-372273391", "createdAt": "2020-03-10T19:52:37Z", "commit": {"oid": "c8ac55919cdd7b41e6b6fc932db60d69b7351504"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "71b6bca4e1cef46d54e1d853f9ca8ea7f6517cd6", "author": {"user": {"login": "mrwillis21", "name": "Matt Willis"}}, "url": "https://github.com/firebase/firebase-android-sdk/commit/71b6bca4e1cef46d54e1d853f9ca8ea7f6517cd6", "committedDate": "2020-03-10T19:59:59Z", "message": "Fix test"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2161, "cost": 1, "resetAt": "2021-11-01T14:20:25Z"}}}