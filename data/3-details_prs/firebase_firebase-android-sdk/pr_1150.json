{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0MzY1NTcxMTA1", "number": 1150, "title": "Add an ObjectValue builder", "bodyText": "This PR is meant to pave the way for a mutable ObjectValue that is based on a Value.Builder. It proves that we only need set() and delete() (and not equals() and compareTo()) on the mutable type since most parts of the code still deal with immutable ObjectValues.\nThis is meant for an feature branch until we finish the Proto conversion as ObjectValue.Builder().set() is somewhat inefficient for nested field updates.", "createdAt": "2020-01-21T23:03:18Z", "url": "https://github.com/firebase/firebase-android-sdk/pull/1150", "merged": true, "mergeCommit": {"oid": "baa0a89e21810de151d15b16ab725748649c165c"}, "closed": true, "closedAt": "2020-01-23T00:15:11Z", "author": {"login": "schmidt-sebastian"}, "timelineItems": {"totalCount": 5, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABb8pVHAgH2gAyMzY1NTcxMTA1OjU1MGE4MzE1MDJlODg0MzU1ZTJkMzEyODE3ZGM4ZGVmZTA4NGZhNGU=", "endCursor": "Y3Vyc29yOnYyOpPPAAABb8-StUAFqTM0Njk3NDMwMw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "550a831502e884355e2d312817dc8defe084fa4e", "author": {"user": {"login": "schmidt-sebastian", "name": "Sebastian Schmidt"}}, "url": "https://github.com/firebase/firebase-android-sdk/commit/550a831502e884355e2d312817dc8defe084fa4e", "committedDate": "2020-01-21T22:59:33Z", "message": "Add an ObjectValue builder"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzQ2ODA4Nzk0", "url": "https://github.com/firebase/firebase-android-sdk/pull/1150#pullrequestreview-346808794", "createdAt": "2020-01-22T18:32:03Z", "commit": {"oid": "550a831502e884355e2d312817dc8defe084fa4e"}, "state": "COMMENTED", "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0yMlQxODozMjowNFrOFgmisw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0yMlQxODozNjowNlrOFgmqlw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2OTczMDIyNw==", "bodyText": "This is pretty verbose. How about ObjectValue.newBuilder()?", "url": "https://github.com/firebase/firebase-android-sdk/pull/1150#discussion_r369730227", "createdAt": "2020-01-22T18:32:04Z", "author": {"login": "wilhuff"}, "path": "firebase-firestore/src/main/java/com/google/firebase/firestore/UserDataConverter.java", "diffHunk": "@@ -117,7 +117,7 @@ public ParsedUpdateData parseUpdateData(Map<String, Object> data) {\n \n     ParseAccumulator accumulator = new ParseAccumulator(UserData.Source.Update);\n     ParseContext context = accumulator.rootContext();\n-    ObjectValue updateData = ObjectValue.emptyObject();\n+    ObjectValue.Builder updateData = ObjectValue.Builder.emptyBuilder();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "550a831502e884355e2d312817dc8defe084fa4e"}, "originalPosition": 5}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2OTczMTE4Nw==", "bodyText": "Trailing .build() here seems wrong.", "url": "https://github.com/firebase/firebase-android-sdk/pull/1150#discussion_r369731187", "createdAt": "2020-01-22T18:34:03Z", "author": {"login": "wilhuff"}, "path": "firebase-firestore/src/main/java/com/google/firebase/firestore/model/mutation/TransformMutation.java", "diffHunk": "@@ -227,11 +228,12 @@ private ObjectValue transformObject(ObjectValue objectValue, List<FieldValue> tr\n     hardAssert(\n         transformResults.size() == fieldTransforms.size(), \"Transform results length mismatch.\");\n \n+    ObjectValue.Builder builder = objectValue.toBuilder();\n     for (int i = 0; i < fieldTransforms.size(); i++) {\n       FieldTransform fieldTransform = fieldTransforms.get(i);\n       FieldPath fieldPath = fieldTransform.getFieldPath();\n-      objectValue = objectValue.set(fieldPath, transformResults.get(i));\n+      builder.set(fieldPath, transformResults.get(i)).build();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "550a831502e884355e2d312817dc8defe084fa4e"}, "originalPosition": 36}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2OTczMjI0Nw==", "bodyText": "The caller doesn't necessarily have to pass an empty object, do they? Seems like empty could be objectValue, as it is below.", "url": "https://github.com/firebase/firebase-android-sdk/pull/1150#discussion_r369732247", "createdAt": "2020-01-22T18:36:06Z", "author": {"login": "wilhuff"}, "path": "firebase-firestore/src/test/java/com/google/firebase/firestore/model/FieldValueTest.java", "diffHunk": "@@ -356,4 +374,12 @@ public void testValueOrdering() {\n         .addEqualityGroup(wrapObject(map(\"foo\", \"0\")))\n         .testCompare();\n   }\n+\n+  private ObjectValue setField(ObjectValue empty, String a, FieldValue mod) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "550a831502e884355e2d312817dc8defe084fa4e"}, "originalPosition": 142}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b48b1408b8f933dc80aac2464d51bf77ac3c8144", "author": {"user": {"login": "schmidt-sebastian", "name": "Sebastian Schmidt"}}, "url": "https://github.com/firebase/firebase-android-sdk/commit/b48b1408b8f933dc80aac2464d51bf77ac3c8144", "committedDate": "2020-01-22T23:18:51Z", "message": "Review feedback"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "4025ada23f348a27c9d243623d496e5dbfcdc2fb", "author": {"user": {"login": "schmidt-sebastian", "name": "Sebastian Schmidt"}}, "url": "https://github.com/firebase/firebase-android-sdk/commit/4025ada23f348a27c9d243623d496e5dbfcdc2fb", "committedDate": "2020-01-22T23:21:52Z", "message": "Renames"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzQ2OTc0MzAz", "url": "https://github.com/firebase/firebase-android-sdk/pull/1150#pullrequestreview-346974303", "createdAt": "2020-01-22T23:24:56Z", "commit": {"oid": "4025ada23f348a27c9d243623d496e5dbfcdc2fb"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2256, "cost": 1, "resetAt": "2021-11-01T14:20:25Z"}}}