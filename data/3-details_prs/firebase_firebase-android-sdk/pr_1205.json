{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0MzcxNTQyNTk3", "number": 1205, "title": "Migrate transforms to use Values", "bodyText": "", "createdAt": "2020-02-05T19:21:27Z", "url": "https://github.com/firebase/firebase-android-sdk/pull/1205", "merged": true, "mergeCommit": {"oid": "91b40a5c78d12cd29542f81a9d614b3444d8c8ea"}, "closed": true, "closedAt": "2020-02-06T01:55:53Z", "author": {"login": "schmidt-sebastian"}, "timelineItems": {"totalCount": 14, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcA5eb_gH2gAyMzcxNTQyNTk3OjE2MDIwNjJjMjc2M2FiYWYyYTc3YTRmZDIwNjdhZTI2ZTZjOTY5NjU=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcBg1FWgH2gAyMzcxNTQyNTk3OmFhN2IzZWM3ODI1MzcxMDc2OTNjZTk4ZDQwNTE5MDM5N2U4YzYxMGY=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "1602062c2763abaf2a77a4fd2067ae26e6c96965", "author": {"user": {"login": "schmidt-sebastian", "name": "Sebastian Schmidt"}}, "url": "https://github.com/firebase/firebase-android-sdk/commit/1602062c2763abaf2a77a4fd2067ae26e6c96965", "committedDate": "2020-02-04T04:03:55Z", "message": "Protobuf-backed FieldValues"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "804a1b7a9d0304f13a394b2f46054f2409c52b37", "author": {"user": {"login": "schmidt-sebastian", "name": "Sebastian Schmidt"}}, "url": "https://github.com/firebase/firebase-android-sdk/commit/804a1b7a9d0304f13a394b2f46054f2409c52b37", "committedDate": "2020-02-04T21:39:54Z", "message": "Merge branch 'mrschmidt/rewritefieldvalue' into mrschmidt/final"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "3d5d7c2570b34f0797602f6dd46e407232b3bf8b", "author": {"user": {"login": "schmidt-sebastian", "name": "Sebastian Schmidt"}}, "url": "https://github.com/firebase/firebase-android-sdk/commit/3d5d7c2570b34f0797602f6dd46e407232b3bf8b", "committedDate": "2020-02-04T23:44:07Z", "message": "Merge branch 'mrschmidt/rewritefieldvalue' into mrschmidt/final"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "120ca33e5a7299151357ae0e70c8b23acfe6b9b9", "author": {"user": {"login": "schmidt-sebastian", "name": "Sebastian Schmidt"}}, "url": "https://github.com/firebase/firebase-android-sdk/commit/120ca33e5a7299151357ae0e70c8b23acfe6b9b9", "committedDate": "2020-02-05T19:01:41Z", "message": "Feedback"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "82c0095659aa83194049693f1336af2864ce5287", "author": {"user": {"login": "schmidt-sebastian", "name": "Sebastian Schmidt"}}, "url": "https://github.com/firebase/firebase-android-sdk/commit/82c0095659aa83194049693f1336af2864ce5287", "committedDate": "2020-02-05T19:03:43Z", "message": "Update test-only variable"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "98953a323513bbc0ef685ab9ca1ee9b9d98ee091", "author": {"user": {"login": "schmidt-sebastian", "name": "Sebastian Schmidt"}}, "url": "https://github.com/firebase/firebase-android-sdk/commit/98953a323513bbc0ef685ab9ca1ee9b9d98ee091", "committedDate": "2020-02-05T19:34:33Z", "message": "Add ProtoValues.contains()"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "940a268825130e3c4c7609d8975d7c428f071f32", "author": {"user": {"login": "schmidt-sebastian", "name": "Sebastian Schmidt"}}, "url": "https://github.com/firebase/firebase-android-sdk/commit/940a268825130e3c4c7609d8975d7c428f071f32", "committedDate": "2020-02-05T19:42:37Z", "message": "Migrate ArrayTransforms to use Values"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "801a1e693393b9f084ad6aaa20fb2e9c319aa30a", "author": {"user": {"login": "schmidt-sebastian", "name": "Sebastian Schmidt"}}, "url": "https://github.com/firebase/firebase-android-sdk/commit/801a1e693393b9f084ad6aaa20fb2e9c319aa30a", "committedDate": "2020-02-05T19:20:46Z", "message": "Migrate ArrayTransforms to use Values"}, "afterCommit": {"oid": "940a268825130e3c4c7609d8975d7c428f071f32", "author": {"user": {"login": "schmidt-sebastian", "name": "Sebastian Schmidt"}}, "url": "https://github.com/firebase/firebase-android-sdk/commit/940a268825130e3c4c7609d8975d7c428f071f32", "committedDate": "2020-02-05T19:42:37Z", "message": "Migrate ArrayTransforms to use Values"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "7ea5b3737b23638bb99bcb032893674414c18895", "author": {"user": {"login": "schmidt-sebastian", "name": "Sebastian Schmidt"}}, "url": "https://github.com/firebase/firebase-android-sdk/commit/7ea5b3737b23638bb99bcb032893674414c18895", "committedDate": "2020-02-05T20:21:48Z", "message": "Migrate TransformResult to use Value"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzU0MTI0NDc2", "url": "https://github.com/firebase/firebase-android-sdk/pull/1205#pullrequestreview-354124476", "createdAt": "2020-02-06T00:00:05Z", "commit": {"oid": "7ea5b3737b23638bb99bcb032893674414c18895"}, "state": "APPROVED", "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0wNlQwMDowMDowNlrOFmLUwQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0wNlQwMDowODo1MVrOFmLeUg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NTU3NTc0NQ==", "bodyText": "It seems like this should go the other way: call ObjectValue.getFieldProto(path) here and then have getField above wrap the result of getFieldProto.", "url": "https://github.com/firebase/firebase-android-sdk/pull/1205#discussion_r375575745", "createdAt": "2020-02-06T00:00:06Z", "author": {"login": "wilhuff"}, "path": "firebase-firestore/src/main/java/com/google/firebase/firestore/model/Document.java", "diffHunk": "@@ -66,6 +67,11 @@ public ObjectValue getData() {\n     return objectValue.get(path);\n   }\n \n+  public @Nullable Value getFieldProto(FieldPath path) {\n+    FieldValue fieldValue = getField(path);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "7ea5b3737b23638bb99bcb032893674414c18895"}, "originalPosition": 13}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NTU3NjY3Nw==", "bodyText": "These could be in ProtoValues along with isNumber and isArray.", "url": "https://github.com/firebase/firebase-android-sdk/pull/1205#discussion_r375576677", "createdAt": "2020-02-06T00:03:22Z", "author": {"login": "wilhuff"}, "path": "firebase-firestore/src/main/java/com/google/firebase/firestore/model/mutation/NumericIncrementTransformOperation.java", "diffHunk": "@@ -120,4 +121,12 @@ private long operandAsLong() {\n               + operand.getClass().getCanonicalName());\n     }\n   }\n+\n+  private boolean isInteger(@Nullable Value value) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "7ea5b3737b23638bb99bcb032893674414c18895"}, "originalPosition": 71}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NTU3ODE5NA==", "bodyText": "Having Values in the production code would again benefit this code, making it less verbose to do this everywhere we do it.", "url": "https://github.com/firebase/firebase-android-sdk/pull/1205#discussion_r375578194", "createdAt": "2020-02-06T00:08:51Z", "author": {"login": "wilhuff"}, "path": "firebase-firestore/src/main/java/com/google/firebase/firestore/model/mutation/NumericIncrementTransformOperation.java", "diffHunk": "@@ -37,29 +39,28 @@ public NumericIncrementTransformOperation(NumberValue operand) {\n   }\n \n   @Override\n-  public FieldValue applyToLocalView(@Nullable FieldValue previousValue, Timestamp localWriteTime) {\n-    NumberValue baseValue = computeBaseValue(previousValue);\n+  public Value applyToLocalView(@Nullable Value previousValue, Timestamp localWriteTime) {\n+    Value baseValue = computeBaseValue(previousValue);\n \n     // Return an integer value only if the previous value and the operand is an integer.\n-    if (baseValue instanceof IntegerValue && operand instanceof IntegerValue) {\n-      long sum = safeIncrement(((IntegerValue) baseValue).getIntegerValue(), operandAsLong());\n-      return IntegerValue.valueOf(sum);\n-    } else if (baseValue instanceof IntegerValue) {\n-      double sum = ((IntegerValue) baseValue).getIntegerValue() + operandAsDouble();\n-      return DoubleValue.valueOf(sum);\n+    if (isInteger(baseValue) && operand instanceof IntegerValue) {\n+      long sum = safeIncrement(baseValue.getIntegerValue(), operandAsLong());\n+      return Value.newBuilder().setIntegerValue(sum).build();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "7ea5b3737b23638bb99bcb032893674414c18895"}, "originalPosition": 27}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "13e01c89451b123d4bfee2e51e6adef782f1b102", "author": {"user": {"login": "schmidt-sebastian", "name": "Sebastian Schmidt"}}, "url": "https://github.com/firebase/firebase-android-sdk/commit/13e01c89451b123d4bfee2e51e6adef782f1b102", "committedDate": "2020-02-06T00:56:21Z", "message": "Review"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzU0MTU4NDY4", "url": "https://github.com/firebase/firebase-android-sdk/pull/1205#pullrequestreview-354158468", "createdAt": "2020-02-06T01:50:49Z", "commit": {"oid": "13e01c89451b123d4bfee2e51e6adef782f1b102"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "baf650e876d47b345418466f40e36f3b97912801", "author": {"user": {"login": "schmidt-sebastian", "name": "Sebastian Schmidt"}}, "url": "https://github.com/firebase/firebase-android-sdk/commit/baf650e876d47b345418466f40e36f3b97912801", "committedDate": "2020-02-06T01:54:45Z", "message": "Merge branch 'mrschmidt/rewritefieldvalue' into mrschmidt/final"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "aa7b3ec782537107693ce98d405190397e8c610f", "author": {"user": {"login": "schmidt-sebastian", "name": "Sebastian Schmidt"}}, "url": "https://github.com/firebase/firebase-android-sdk/commit/aa7b3ec782537107693ce98d405190397e8c610f", "committedDate": "2020-02-06T01:54:57Z", "message": "Merge branch 'mrschmidt/final' into mrschmidt/migratevalues"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2299, "cost": 1, "resetAt": "2021-11-01T14:20:25Z"}}}