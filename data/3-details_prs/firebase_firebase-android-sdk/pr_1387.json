{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0MzkzMjQwMTM3", "number": 1387, "title": "Clean up error handling for report persistence", "bodyText": "Ensure data written to disk is cleaned up properly when\nread/write/serialization errors occur.", "createdAt": "2020-03-24T20:30:24Z", "url": "https://github.com/firebase/firebase-android-sdk/pull/1387", "merged": true, "mergeCommit": {"oid": "b878917aba9b656fa61d7fe1207b9c538622e30f"}, "closed": true, "closedAt": "2020-03-24T22:14:08Z", "author": {"login": "mrwillis21"}, "timelineItems": {"totalCount": 7, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcQ4aBxgH2gAyMzkzMjQwMTM3OmIwZjE5Njk2YTBmNTY4ZWQ4Yzg0ZDZiZDEwNmZjZjdlYTc5MmY0ODQ=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcQ6CJ1gH2gAyMzkzMjQwMTM3OjA1MmZjMzM4ODdkOTc1MDc4YWQ3NWI1NjM3YWRmZmI5ZDdkMzUyM2Y=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "b0f19696a0f568ed8c84d6bd106fcf7ea792f484", "author": {"user": {"login": "mrwillis21", "name": "Matt Willis"}}, "url": "https://github.com/firebase/firebase-android-sdk/commit/b0f19696a0f568ed8c84d6bd106fcf7ea792f484", "committedDate": "2020-03-24T19:51:59Z", "message": "Clean up error handling for report persistence\n\nEnsure data written to disk is cleaned up properly when\nread/write/serialization errors occur."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzgwNjc2OTUz", "url": "https://github.com/firebase/firebase-android-sdk/pull/1387#pullrequestreview-380676953", "createdAt": "2020-03-24T20:37:08Z", "commit": {"oid": "b0f19696a0f568ed8c84d6bd106fcf7ea792f484"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yNFQyMDozNzowOFrOF7CGtQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yNFQyMDozNzowOFrOF7CGtQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NzQ0NDc4OQ==", "bodyText": "What do you think about making some of this output logged as errors, since they are basically logging failed asserts?", "url": "https://github.com/firebase/firebase-android-sdk/pull/1387#discussion_r397444789", "createdAt": "2020-03-24T20:37:08Z", "author": {"login": "mrichards"}, "path": "firebase-crashlytics/src/main/java/com/google/firebase/crashlytics/internal/common/CrashlyticsUncaughtExceptionHandler.java", "diffHunk": "@@ -46,7 +46,13 @@ public CrashlyticsUncaughtExceptionHandler(\n   public void uncaughtException(Thread thread, Throwable ex) {\n     isHandlingException.set(true);\n     try {\n-      crashListener.onUncaughtException(settingsDataProvider, thread, ex);\n+      if (thread == null) {\n+        Logger.getLogger().d(\"Could not handle uncaught exception; null thread\");", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b0f19696a0f568ed8c84d6bd106fcf7ea792f484"}, "originalPosition": 6}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzgwNjkzMTU2", "url": "https://github.com/firebase/firebase-android-sdk/pull/1387#pullrequestreview-380693156", "createdAt": "2020-03-24T21:01:19Z", "commit": {"oid": "b0f19696a0f568ed8c84d6bd106fcf7ea792f484"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yNFQyMTowMToxOVrOF7C62A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yNFQyMTowMToxOVrOF7C62A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NzQ1ODEzNg==", "bodyText": "This is a lot cleaner! \ud83d\ude0d", "url": "https://github.com/firebase/firebase-android-sdk/pull/1387#discussion_r397458136", "createdAt": "2020-03-24T21:01:19Z", "author": {"login": "mrichards"}, "path": "firebase-crashlytics/src/main/java/com/google/firebase/crashlytics/internal/persistence/CrashlyticsReportPersistence.java", "diffHunk": "@@ -169,66 +184,52 @@ public void deleteFinalizedReport(String sessionId) {\n     }\n   }\n \n-  public void finalizeSessionWithNativeEvent(\n-      String sessionId, CrashlyticsReport.FilesPayload build) {\n-    final File outputDirectory = prepareDirectory(nativeReportsDirectory);\n-\n-    File sessionFile = new File(getSessionDirectoryById(sessionId), REPORT_FILE_NAME);\n-\n-    if (!sessionFile.exists()) {\n-      return;\n-    }\n-\n-    String textFile = readTextFile(sessionFile);\n-\n-    if (textFile == null) {\n-      return;\n-    }\n-\n-    CrashlyticsReport report = TRANSFORM.reportFromJson(textFile);\n-\n-    // In the unlikely event the open non-native report has been cleaned up,\n-    // we no longer can retrieve the relevant context about the session.\n-    if (report == null) {\n-      return;\n-    }\n-\n-    report = report.withNdkPayload(build);\n-\n-    writeTextFile(new File(outputDirectory, sessionId), TRANSFORM.reportToJson(report));\n-  }\n-\n-  // TODO: Deal with potential runtime exceptions\n-  public void finalizeReports(String currentSessionId, long sessionEndTime) {\n-    // TODO: Need to implement procedure to skip finalizing the current session when this is\n-    //  called on app start, but keep the current session when called at crash time. Currently\n-    //  this only works when called at app start.\n-    List<File> sessionDirectories = capAndGetOpenSessions(currentSessionId);\n+  /**", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b0f19696a0f568ed8c84d6bd106fcf7ea792f484"}, "originalPosition": 163}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzgwNjk0NzE3", "url": "https://github.com/firebase/firebase-android-sdk/pull/1387#pullrequestreview-380694717", "createdAt": "2020-03-24T21:03:37Z", "commit": {"oid": "b0f19696a0f568ed8c84d6bd106fcf7ea792f484"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c715a88939d6c94fea7081d921740febe07d8a35", "author": {"user": {"login": "mrwillis21", "name": "Matt Willis"}}, "url": "https://github.com/firebase/firebase-android-sdk/commit/c715a88939d6c94fea7081d921740febe07d8a35", "committedDate": "2020-03-24T21:24:54Z", "message": "Change log level in appropriate places"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "8f6eaafed74d85615afc81be0eeb7b3cd524ad52", "author": {"user": {"login": "mrwillis21", "name": "Matt Willis"}}, "url": "https://github.com/firebase/firebase-android-sdk/commit/8f6eaafed74d85615afc81be0eeb7b3cd524ad52", "committedDate": "2020-03-24T21:25:25Z", "message": "Update encoders versioning for appropriate dependency"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "052fc33887d975078ad75b5637adffb9d7d3523f", "author": {"user": {"login": "mrwillis21", "name": "Matt Willis"}}, "url": "https://github.com/firebase/firebase-android-sdk/commit/052fc33887d975078ad75b5637adffb9d7d3523f", "committedDate": "2020-03-24T21:45:43Z", "message": "Fix nullability for nonfatals & clean up logging calls"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2716, "cost": 1, "resetAt": "2021-11-01T14:20:25Z"}}}