{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDAwNDkxOTYy", "number": 1434, "title": "Update crashlytics global data collection", "bodyText": "", "createdAt": "2020-04-07T20:41:46Z", "url": "https://github.com/firebase/firebase-android-sdk/pull/1434", "merged": true, "mergeCommit": {"oid": "ed3ff88ccc0821ed91f1b912669478105098f2c7"}, "closed": true, "closedAt": "2020-07-31T17:31:16Z", "author": {"login": "VinayGuthal"}, "timelineItems": {"totalCount": 16, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcVZfzDgH2gAyNDAwNDkxOTYyOjdlYjFiNDRkYTY3ODk1MzEyODZjMjhjODg0ZmUzM2E5YWQyY2MzZWY=", "endCursor": "Y3Vyc29yOnYyOpPPAAABc7ZIBQAFqTQ2MDM2MDA2Mw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "7eb1b44da6789531286c28c884fe33a9ad2cc3ef", "author": {"user": {"login": "VinayGuthal", "name": "Vinay Guthal"}}, "url": "https://github.com/firebase/firebase-android-sdk/commit/7eb1b44da6789531286c28c884fe33a9ad2cc3ef", "committedDate": "2020-04-07T20:40:51Z", "message": "fix tests"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "89cb018ed15a418c410197dd96324d2887838053", "author": {"user": {"login": "VinayGuthal", "name": "Vinay Guthal"}}, "url": "https://github.com/firebase/firebase-android-sdk/commit/89cb018ed15a418c410197dd96324d2887838053", "committedDate": "2020-04-07T20:43:04Z", "message": "add tests"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c29b8422be45e8bb4bf6b03215057a648f51b5e5", "author": {"user": {"login": "VinayGuthal", "name": "Vinay Guthal"}}, "url": "https://github.com/firebase/firebase-android-sdk/commit/c29b8422be45e8bb4bf6b03215057a648f51b5e5", "committedDate": "2020-04-08T22:45:27Z", "message": "add tests for crashlytics api change"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "811732ee779167657c839d16851cb64c33a8ec10", "author": {"user": {"login": "VinayGuthal", "name": "Vinay Guthal"}}, "url": "https://github.com/firebase/firebase-android-sdk/commit/811732ee779167657c839d16851cb64c33a8ec10", "committedDate": "2020-04-09T15:45:57Z", "message": "add api txt"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "09da19b9810e032140f4088c09ad7955a8dae4af", "author": {"user": {"login": "VinayGuthal", "name": "Vinay Guthal"}}, "url": "https://github.com/firebase/firebase-android-sdk/commit/09da19b9810e032140f4088c09ad7955a8dae4af", "committedDate": "2020-04-09T16:27:25Z", "message": "crashlytics test"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzk0NzM1MDAw", "url": "https://github.com/firebase/firebase-android-sdk/pull/1434#pullrequestreview-394735000", "createdAt": "2020-04-16T15:12:59Z", "commit": {"oid": "09da19b9810e032140f4088c09ad7955a8dae4af"}, "state": "COMMENTED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzk1NzI1OTA2", "url": "https://github.com/firebase/firebase-android-sdk/pull/1434#pullrequestreview-395725906", "createdAt": "2020-04-17T19:41:55Z", "commit": {"oid": "09da19b9810e032140f4088c09ad7955a8dae4af"}, "state": "COMMENTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0xN1QxOTo0MTo1NVrOGHa16g==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0xN1QxOTo0Mjo0M1rOGHa3WQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMDQzMzAwMg==", "bodyText": "We can help our future selves by adding some comments here :)", "url": "https://github.com/firebase/firebase-android-sdk/pull/1434#discussion_r410433002", "createdAt": "2020-04-17T19:41:55Z", "author": {"login": "ashwinraghav"}, "path": "firebase-crashlytics/src/main/java/com/google/firebase/crashlytics/internal/common/DataCollectionArbiter.java", "diffHunk": "@@ -107,13 +116,29 @@ public boolean isAutomaticDataCollectionEnabled() {\n   }\n \n   @SuppressLint({\"CommitPrefEdits\", \"ApplySharedPref\"})\n-  public void setCrashlyticsDataCollectionEnabled(boolean enabled) {\n-    crashlyticsDataCollectionEnabled = enabled;\n-    crashlyticsDataCollectionExplicitlySet = true;\n-    sharedPreferences.edit().putBoolean(FIREBASE_CRASHLYTICS_COLLECTION_ENABLED, enabled).commit();\n+  public synchronized void setCrashlyticsDataCollectionEnabled(Boolean enabled) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "09da19b9810e032140f4088c09ad7955a8dae4af"}, "originalPosition": 67}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMDQzMzM2OQ==", "bodyText": "Can you split this up into separate tests that express the conditions they check?", "url": "https://github.com/firebase/firebase-android-sdk/pull/1434#discussion_r410433369", "createdAt": "2020-04-17T19:42:43Z", "author": {"login": "ashwinraghav"}, "path": "firebase-crashlytics/src/androidTest/java/com/google/firebase/crashlytics/internal/common/CrashlyticsControllerTest.java", "diffHunk": "@@ -842,6 +842,21 @@ public void testUploadDisabledThenEnabled() throws Exception {\n     Task<Void> task = controller.submitAllReports(1.0f, testSettingsDataProvider.getAppSettings());\n \n     arbiter.setCrashlyticsDataCollectionEnabled(true);\n+    assertTrue(arbiter.isAutomaticDataCollectionEnabled());\n+\n+    when(mockEditor.putBoolean(PREFS_KEY, false)).thenReturn(mockEditor);\n+    when(mockPrefs.getBoolean(PREFS_KEY, true)).thenReturn(false);\n+    arbiter.setCrashlyticsDataCollectionEnabled(false);\n+    assertFalse(arbiter.isAutomaticDataCollectionEnabled());\n+\n+    when(mockPrefs.contains(PREFS_KEY)).thenReturn(false);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "09da19b9810e032140f4088c09ad7955a8dae4af"}, "originalPosition": 11}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDM2NzYwMTY3", "url": "https://github.com/firebase/firebase-android-sdk/pull/1434#pullrequestreview-436760167", "createdAt": "2020-06-24T15:26:51Z", "commit": {"oid": "09da19b9810e032140f4088c09ad7955a8dae4af"}, "state": "COMMENTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yNFQxNToyNjo1MVrOGoXapA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yNFQxNTozOTo0OFrOGoX99Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NDk3OTg3Ng==", "bodyText": "What is this method synchronizing that was missed before?", "url": "https://github.com/firebase/firebase-android-sdk/pull/1434#discussion_r444979876", "createdAt": "2020-06-24T15:26:51Z", "author": {"login": "mrwillis21"}, "path": "firebase-crashlytics/src/main/java/com/google/firebase/crashlytics/internal/common/DataCollectionArbiter.java", "diffHunk": "@@ -107,13 +116,29 @@ public boolean isAutomaticDataCollectionEnabled() {\n   }\n \n   @SuppressLint({\"CommitPrefEdits\", \"ApplySharedPref\"})\n-  public void setCrashlyticsDataCollectionEnabled(boolean enabled) {\n-    crashlyticsDataCollectionEnabled = enabled;\n-    crashlyticsDataCollectionExplicitlySet = true;\n-    sharedPreferences.edit().putBoolean(FIREBASE_CRASHLYTICS_COLLECTION_ENABLED, enabled).commit();\n+  public synchronized void setCrashlyticsDataCollectionEnabled(Boolean enabled) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "09da19b9810e032140f4088c09ad7955a8dae4af"}, "originalPosition": 67}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NDk4ODkxNw==", "bodyText": "Question: this setting, conceptually, should be \"clear the shared preferences setting, then reset the values based on the manifest\". Is there any way we could consolidate that second part with the same conceptual code (i.e. setting the values based on the manifest) in the constructor, and make a method out of it? That would 1) make this method simpler and more compact, and 2) make sure that both times (on construction and also here) we set the values the same way.", "url": "https://github.com/firebase/firebase-android-sdk/pull/1434#discussion_r444988917", "createdAt": "2020-06-24T15:39:48Z", "author": {"login": "mrwillis21"}, "path": "firebase-crashlytics/src/main/java/com/google/firebase/crashlytics/internal/common/DataCollectionArbiter.java", "diffHunk": "@@ -107,13 +116,29 @@ public boolean isAutomaticDataCollectionEnabled() {\n   }\n \n   @SuppressLint({\"CommitPrefEdits\", \"ApplySharedPref\"})\n-  public void setCrashlyticsDataCollectionEnabled(boolean enabled) {\n-    crashlyticsDataCollectionEnabled = enabled;\n-    crashlyticsDataCollectionExplicitlySet = true;\n-    sharedPreferences.edit().putBoolean(FIREBASE_CRASHLYTICS_COLLECTION_ENABLED, enabled).commit();\n+  public synchronized void setCrashlyticsDataCollectionEnabled(Boolean enabled) {\n+    if (enabled == null) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "09da19b9810e032140f4088c09ad7955a8dae4af"}, "originalPosition": 68}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ffb1c7770400ee23a6c4a4dcdb4630cae23411cc", "author": {"user": {"login": "VinayGuthal", "name": "Vinay Guthal"}}, "url": "https://github.com/firebase/firebase-android-sdk/commit/ffb1c7770400ee23a6c4a4dcdb4630cae23411cc", "committedDate": "2020-07-27T17:55:25Z", "message": "Merge branch 'master' into update_crash_api"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "d6ea27371fe46cdab2b99dd9a47675b3d6b5d0bc", "author": {"user": {"login": "VinayGuthal", "name": "Vinay Guthal"}}, "url": "https://github.com/firebase/firebase-android-sdk/commit/d6ea27371fe46cdab2b99dd9a47675b3d6b5d0bc", "committedDate": "2020-07-27T18:16:43Z", "message": "make constructor change"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "48deb6958771e01a1396125416e45aae3857a419", "author": {"user": {"login": "VinayGuthal", "name": "Vinay Guthal"}}, "url": "https://github.com/firebase/firebase-android-sdk/commit/48deb6958771e01a1396125416e45aae3857a419", "committedDate": "2020-07-27T18:34:41Z", "message": "use enabled"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "4f2068b9f5c348df1d86d115f022cca39ce9f257", "author": {"user": {"login": "mrwillis21", "name": "Matt Willis"}}, "url": "https://github.com/firebase/firebase-android-sdk/commit/4f2068b9f5c348df1d86d115f022cca39ce9f257", "committedDate": "2020-07-30T20:25:09Z", "message": "Refactor and clarify DataCollectionArbiter"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e29abd61c3908ba18cbb5c4397d67e89864c2401", "author": {"user": {"login": "mrwillis21", "name": "Matt Willis"}}, "url": "https://github.com/firebase/firebase-android-sdk/commit/e29abd61c3908ba18cbb5c4397d67e89864c2401", "committedDate": "2020-07-30T20:37:11Z", "message": "Better group related methods"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDU5MzI1NDA0", "url": "https://github.com/firebase/firebase-android-sdk/pull/1434#pullrequestreview-459325404", "createdAt": "2020-07-31T17:02:42Z", "commit": {"oid": "e29abd61c3908ba18cbb5c4397d67e89864c2401"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDYwMzU3NDYz", "url": "https://github.com/firebase/firebase-android-sdk/pull/1434#pullrequestreview-460357463", "createdAt": "2020-08-03T21:37:10Z", "commit": {"oid": "e29abd61c3908ba18cbb5c4397d67e89864c2401"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0wM1QyMTozNzoxMFrOG7JieQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0wM1QyMTozNzoxMFrOG7JieQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NDY3NTQ0OQ==", "bodyText": "Suggest replacing line 468 with:\n\"* Allows you to enable or disable the automatic data collection configuration in Crashlytics.\"", "url": "https://github.com/firebase/firebase-android-sdk/pull/1434#discussion_r464675449", "createdAt": "2020-08-03T21:37:10Z", "author": {"login": "cbonnie"}, "path": "firebase-crashlytics/src/main/java/com/google/firebase/crashlytics/FirebaseCrashlytics.java", "diffHunk": "@@ -463,4 +463,23 @@ public boolean didCrashOnPreviousExecution() {\n   public void setCrashlyticsCollectionEnabled(boolean enabled) {\n     core.setCrashlyticsCollectionEnabled(enabled);\n   }\n+\n+  /**\n+   * Enables/disables/clears automatic data collection config by Crashlytics.", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "e29abd61c3908ba18cbb5c4397d67e89864c2401"}, "originalPosition": 6}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDYwMzYwMDYz", "url": "https://github.com/firebase/firebase-android-sdk/pull/1434#pullrequestreview-460360063", "createdAt": "2020-08-03T21:42:03Z", "commit": {"oid": "e29abd61c3908ba18cbb5c4397d67e89864c2401"}, "state": "COMMENTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0wM1QyMTo0MjowNFrOG7Jqeg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0wM1QyMTo0MzoxOVrOG7JsRA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NDY3NzQ5OA==", "bodyText": "Suggest replacing lines 470 and 471 with:\n\"* If not set, defaults to True. When set to False, disables automatic collection by overriding the data collections settings in the AndroidManifest.xml, as well as any Firebase-wide automatic data collection settings. When set to null, clears the Crashlytics data collection configuration (in this case, enabling data collection becomes dependent on other settings).\"", "url": "https://github.com/firebase/firebase-android-sdk/pull/1434#discussion_r464677498", "createdAt": "2020-08-03T21:42:04Z", "author": {"login": "cbonnie"}, "path": "firebase-crashlytics/src/main/java/com/google/firebase/crashlytics/FirebaseCrashlytics.java", "diffHunk": "@@ -463,4 +463,23 @@ public boolean didCrashOnPreviousExecution() {\n   public void setCrashlyticsCollectionEnabled(boolean enabled) {\n     core.setCrashlyticsCollectionEnabled(enabled);\n   }\n+\n+  /**\n+   * Enables/disables/clears automatic data collection config by Crashlytics.\n+   *\n+   * <p>If this is set, it overrides the data collection settings provided by the Android Manifest,", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "e29abd61c3908ba18cbb5c4397d67e89864c2401"}, "originalPosition": 8}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NDY3Nzk1Ng==", "bodyText": "Suggest replacing line 479 with:\n\"@param Determines whether to enable or disable automatic data collection. If set to null, clears the Crashlytics data collection configuration.\"", "url": "https://github.com/firebase/firebase-android-sdk/pull/1434#discussion_r464677956", "createdAt": "2020-08-03T21:43:19Z", "author": {"login": "cbonnie"}, "path": "firebase-crashlytics/src/main/java/com/google/firebase/crashlytics/FirebaseCrashlytics.java", "diffHunk": "@@ -463,4 +463,23 @@ public boolean didCrashOnPreviousExecution() {\n   public void setCrashlyticsCollectionEnabled(boolean enabled) {\n     core.setCrashlyticsCollectionEnabled(enabled);\n   }\n+\n+  /**\n+   * Enables/disables/clears automatic data collection config by Crashlytics.\n+   *\n+   * <p>If this is set, it overrides the data collection settings provided by the Android Manifest,\n+   * as well as any Firebase-wide automatic data collection settings.\n+   *\n+   * <p>If automatic data collection is disabled for Crashlytics, crash reports are stored on the\n+   * device. To check for reports, use the {@link #checkForUnsentReports()} method. Use {@link\n+   * #sendUnsentReports()} to upload existing reports even when automatic data collection is\n+   * disabled. Use {@link #deleteUnsentReports()} to delete any reports stored on the device without\n+   * sending them to Crashlytics.\n+   *\n+   * @param enabled whether to enable automatic data collection. The value of null would clear the", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "e29abd61c3908ba18cbb5c4397d67e89864c2401"}, "originalPosition": 17}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2600, "cost": 1, "resetAt": "2021-11-01T14:20:25Z"}}}