{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0Mzg5NTQyMjg4", "number": 1355, "reviewThreads": {"totalCount": 13, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xNlQyMzozMjowMFrODoiRQg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xN1QxNzowNjozMFrODoz3Gw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjQzODMxMTA2OnYy", "diffSide": "RIGHT", "path": "firebase-installations/src/main/java/com/google/firebase/installations/FirebaseInstallations.java", "isResolved": true, "comments": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xNlQyMzozMjowMFrOF3JPiw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xN1QwMDoyMTowNFrOF3KByg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MzM2NzQzNQ==", "bodyText": "please give this a better name", "url": "https://github.com/firebase/firebase-android-sdk/pull/1355#discussion_r393367435", "createdAt": "2020-03-16T23:32:00Z", "author": {"login": "fredquintana"}, "path": "firebase-installations/src/main/java/com/google/firebase/installations/FirebaseInstallations.java", "diffHunk": "@@ -307,7 +310,11 @@ private final void doRegistrationInternal(boolean forceRefresh) {\n     }\n \n     triggerOnStateReached(prefs);\n+    networkExecutor.execute(() -> run(forceRefresh));\n+  }\n \n+  private void run(boolean forceRefresh) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d264161c3e01d178549e29de6ac55d6363c4e5c9"}, "originalPosition": 31}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MzM2OTEwNw==", "bodyText": "+1\nHow about this:\n#sendRequestToFirebaseInstallationsServerApi\n#syncWithFirebaseInstallationsServerApi\n#updateLocalAuthToken", "url": "https://github.com/firebase/firebase-android-sdk/pull/1355#discussion_r393369107", "createdAt": "2020-03-16T23:38:05Z", "author": {"login": "andirayo"}, "path": "firebase-installations/src/main/java/com/google/firebase/installations/FirebaseInstallations.java", "diffHunk": "@@ -307,7 +310,11 @@ private final void doRegistrationInternal(boolean forceRefresh) {\n     }\n \n     triggerOnStateReached(prefs);\n+    networkExecutor.execute(() -> run(forceRefresh));\n+  }\n \n+  private void run(boolean forceRefresh) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MzM2NzQzNQ=="}, "originalCommit": {"oid": "d264161c3e01d178549e29de6ac55d6363c4e5c9"}, "originalPosition": 31}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MzM3MTA0OA==", "bodyText": "Updated this. PTAL.", "url": "https://github.com/firebase/firebase-android-sdk/pull/1355#discussion_r393371048", "createdAt": "2020-03-16T23:45:10Z", "author": {"login": "ankitaj224"}, "path": "firebase-installations/src/main/java/com/google/firebase/installations/FirebaseInstallations.java", "diffHunk": "@@ -307,7 +310,11 @@ private final void doRegistrationInternal(boolean forceRefresh) {\n     }\n \n     triggerOnStateReached(prefs);\n+    networkExecutor.execute(() -> run(forceRefresh));\n+  }\n \n+  private void run(boolean forceRefresh) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MzM2NzQzNQ=="}, "originalCommit": {"oid": "d264161c3e01d178549e29de6ac55d6363c4e5c9"}, "originalPosition": 31}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MzM4MDI5OA==", "bodyText": "If possible I would recommend to always start a method name with a verb.\nAlso please remove the \"fis\" prefix:\na) \"fis\" is not a public term (so rather use \"firebaseInstallations\")\nb) it's noise (we are in a class that is called FirebaseInstallations)\nIf you prefer your current name over the suggested ones, then I recommend to update it like this:\n#sendNetworkCall\n#makeNetworkCall", "url": "https://github.com/firebase/firebase-android-sdk/pull/1355#discussion_r393380298", "createdAt": "2020-03-17T00:21:04Z", "author": {"login": "andirayo"}, "path": "firebase-installations/src/main/java/com/google/firebase/installations/FirebaseInstallations.java", "diffHunk": "@@ -307,7 +310,11 @@ private final void doRegistrationInternal(boolean forceRefresh) {\n     }\n \n     triggerOnStateReached(prefs);\n+    networkExecutor.execute(() -> run(forceRefresh));\n+  }\n \n+  private void run(boolean forceRefresh) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MzM2NzQzNQ=="}, "originalCommit": {"oid": "d264161c3e01d178549e29de6ac55d6363c4e5c9"}, "originalPosition": 31}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjQzODMxNzU4OnYy", "diffSide": "RIGHT", "path": "firebase-installations/gradle.properties", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xNlQyMzozNTo0NFrOF3JTgw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xNlQyMzo0MzoyOVrOF3JbwA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MzM2ODQ1MQ==", "bodyText": "I am not about the meaning of these, but does this have to be v16.0.1?\nlatestReleasedVersion=16.0.1", "url": "https://github.com/firebase/firebase-android-sdk/pull/1355#discussion_r393368451", "createdAt": "2020-03-16T23:35:44Z", "author": {"login": "andirayo"}, "path": "firebase-installations/gradle.properties", "diffHunk": "@@ -1,2 +1,2 @@\n-version=16.0.1\n+version=16.0.2\n latestReleasedVersion=16.0.0", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d264161c3e01d178549e29de6ac55d6363c4e5c9"}, "originalPosition": 3}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MzM3MDU2MA==", "bodyText": "Good catch. I am not sure about the variable either but seems right to update it.", "url": "https://github.com/firebase/firebase-android-sdk/pull/1355#discussion_r393370560", "createdAt": "2020-03-16T23:43:29Z", "author": {"login": "ankitaj224"}, "path": "firebase-installations/gradle.properties", "diffHunk": "@@ -1,2 +1,2 @@\n-version=16.0.1\n+version=16.0.2\n latestReleasedVersion=16.0.0", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MzM2ODQ1MQ=="}, "originalCommit": {"oid": "d264161c3e01d178549e29de6ac55d6363c4e5c9"}, "originalPosition": 3}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjQzODMxOTAzOnYy", "diffSide": "RIGHT", "path": "firebase-installations/src/main/java/com/google/firebase/installations/FirebaseInstallations.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xNlQyMzozNjoyNlrOF3JUWQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xNlQyMzo0Nzo0NFrOF3JgUA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MzM2ODY2NQ==", "bodyText": "just realized, we need to be a little careful, here.\nIf the subsequent call has a different value for \"forceRefresh\" then we need to be sure that it gets enqueued, otherwise the flag value can get lost.", "url": "https://github.com/firebase/firebase-android-sdk/pull/1355#discussion_r393368665", "createdAt": "2020-03-16T23:36:26Z", "author": {"login": "fredquintana"}, "path": "firebase-installations/src/main/java/com/google/firebase/installations/FirebaseInstallations.java", "diffHunk": "@@ -307,7 +310,11 @@ private final void doRegistrationInternal(boolean forceRefresh) {\n     }\n \n     triggerOnStateReached(prefs);\n+    networkExecutor.execute(() -> run(forceRefresh));", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d264161c3e01d178549e29de6ac55d6363c4e5c9"}, "originalPosition": 28}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MzM3MTcyOA==", "bodyText": "the force refresh values come from the main thread and will be added on to the network executor. I dont see how the flag gets lost/ overwritten.\n@fredquintana wdyt can go wrong?", "url": "https://github.com/firebase/firebase-android-sdk/pull/1355#discussion_r393371728", "createdAt": "2020-03-16T23:47:44Z", "author": {"login": "ankitaj224"}, "path": "firebase-installations/src/main/java/com/google/firebase/installations/FirebaseInstallations.java", "diffHunk": "@@ -307,7 +310,11 @@ private final void doRegistrationInternal(boolean forceRefresh) {\n     }\n \n     triggerOnStateReached(prefs);\n+    networkExecutor.execute(() -> run(forceRefresh));", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MzM2ODY2NQ=="}, "originalCommit": {"oid": "d264161c3e01d178549e29de6ac55d6363c4e5c9"}, "originalPosition": 28}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjQzODMyNzM3OnYy", "diffSide": "RIGHT", "path": "firebase-installations/src/main/java/com/google/firebase/installations/FirebaseInstallations.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xNlQyMzo0MToyMFrOF3JZiw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xN1QwMDowNToyM1rOF3JzCw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MzM2OTk5NQ==", "bodyText": "Please cluster both the ExecutorServices below each other.", "url": "https://github.com/firebase/firebase-android-sdk/pull/1355#discussion_r393369995", "createdAt": "2020-03-16T23:41:20Z", "author": {"login": "andirayo"}, "path": "firebase-installations/src/main/java/com/google/firebase/installations/FirebaseInstallations.java", "diffHunk": "@@ -66,6 +67,7 @@\n   private final IidStore iidStore;\n   private final RandomFidGenerator fidGenerator;\n   private final Object lock = new Object();\n+  private final ExecutorService networkExecutor;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d264161c3e01d178549e29de6ac55d6363c4e5c9"}, "originalPosition": 12}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MzM3NjUyMw==", "bodyText": "Done", "url": "https://github.com/firebase/firebase-android-sdk/pull/1355#discussion_r393376523", "createdAt": "2020-03-17T00:05:23Z", "author": {"login": "ankitaj224"}, "path": "firebase-installations/src/main/java/com/google/firebase/installations/FirebaseInstallations.java", "diffHunk": "@@ -66,6 +67,7 @@\n   private final IidStore iidStore;\n   private final RandomFidGenerator fidGenerator;\n   private final Object lock = new Object();\n+  private final ExecutorService networkExecutor;", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MzM2OTk5NQ=="}, "originalCommit": {"oid": "d264161c3e01d178549e29de6ac55d6363c4e5c9"}, "originalPosition": 12}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjQzODMyNzY4OnYy", "diffSide": "RIGHT", "path": "firebase-installations/src/main/java/com/google/firebase/installations/FirebaseInstallations.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xNlQyMzo0MTozMlrOF3JZug==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xN1QwMDowNToxNFrOF3Jy6w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MzM3MDA0Mg==", "bodyText": "How about changing the name of the existing threadpool?\nprivate final ExecutorService backgroundExecutor;", "url": "https://github.com/firebase/firebase-android-sdk/pull/1355#discussion_r393370042", "createdAt": "2020-03-16T23:41:32Z", "author": {"login": "andirayo"}, "path": "firebase-installations/src/main/java/com/google/firebase/installations/FirebaseInstallations.java", "diffHunk": "@@ -66,6 +67,7 @@\n   private final IidStore iidStore;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d264161c3e01d178549e29de6ac55d6363c4e5c9"}, "originalPosition": 9}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MzM3NjQ5MQ==", "bodyText": "Done.", "url": "https://github.com/firebase/firebase-android-sdk/pull/1355#discussion_r393376491", "createdAt": "2020-03-17T00:05:14Z", "author": {"login": "ankitaj224"}, "path": "firebase-installations/src/main/java/com/google/firebase/installations/FirebaseInstallations.java", "diffHunk": "@@ -66,6 +67,7 @@\n   private final IidStore iidStore;", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MzM3MDA0Mg=="}, "originalCommit": {"oid": "d264161c3e01d178549e29de6ac55d6363c4e5c9"}, "originalPosition": 9}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjQzODMzMDc2OnYy", "diffSide": "RIGHT", "path": "firebase-installations/src/main/java/com/google/firebase/installations/FirebaseInstallations.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xNlQyMzo0MzoyNVrOF3JbpA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xN1QwMDowNDo1N1rOF3JymQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MzM3MDUzMg==", "bodyText": "Q1: Why is this not injected like all the other variables and created by the other constructor method?\nQ2: Is there a reason that we have different ways how backgroundExecutor and networkExecutor are initialized?", "url": "https://github.com/firebase/firebase-android-sdk/pull/1355#discussion_r393370532", "createdAt": "2020-03-16T23:43:25Z", "author": {"login": "andirayo"}, "path": "firebase-installations/src/main/java/com/google/firebase/installations/FirebaseInstallations.java", "diffHunk": "@@ -124,6 +126,7 @@ public Thread newThread(Runnable r) {\n     this.utils = utils;\n     this.iidStore = iidStore;\n     this.fidGenerator = fidGenerator;\n+    this.networkExecutor = Executors.newSingleThreadExecutor();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d264161c3e01d178549e29de6ac55d6363c4e5c9"}, "originalPosition": 20}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MzM3NjQwOQ==", "bodyText": "Q2: Idea was to simplify the creation but changed it now to replicate the backgroundExecutor. Reasoning: we had a bug reported by some internal team that checks for thread tags and has whitelisted only firebase-installations-executor.\nQ1: The network executor is an impl detail specific to FIS. Adding multiple executors in the constructor could lead to the confusion. I dont see how we can benefit from initializing through injection.", "url": "https://github.com/firebase/firebase-android-sdk/pull/1355#discussion_r393376409", "createdAt": "2020-03-17T00:04:57Z", "author": {"login": "ankitaj224"}, "path": "firebase-installations/src/main/java/com/google/firebase/installations/FirebaseInstallations.java", "diffHunk": "@@ -124,6 +126,7 @@ public Thread newThread(Runnable r) {\n     this.utils = utils;\n     this.iidStore = iidStore;\n     this.fidGenerator = fidGenerator;\n+    this.networkExecutor = Executors.newSingleThreadExecutor();", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MzM3MDUzMg=="}, "originalCommit": {"oid": "d264161c3e01d178549e29de6ac55d6363c4e5c9"}, "originalPosition": 20}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjQzODQ3NDE2OnYy", "diffSide": "RIGHT", "path": "firebase-installations/src/main/java/com/google/firebase/installations/FirebaseInstallations.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xN1QwMToxMTo1OVrOF3KyOg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xN1QxNjo1OTozM1rOF3lgKw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MzM5MjY5OA==", "bodyText": "Executors.newCachedThreadPool() would be good here.\nIf you choose to explicitly create it, please document the constants.", "url": "https://github.com/firebase/firebase-android-sdk/pull/1355#discussion_r393392698", "createdAt": "2020-03-17T01:11:59Z", "author": {"login": "fredquintana"}, "path": "firebase-installations/src/main/java/com/google/firebase/installations/FirebaseInstallations.java", "diffHunk": "@@ -119,11 +120,14 @@ public Thread newThread(Runnable r) {\n       RandomFidGenerator fidGenerator) {\n     this.firebaseApp = firebaseApp;\n     this.serviceClient = serviceClient;\n-    this.executor = executor;\n     this.persistedInstallation = persistedInstallation;\n     this.utils = utils;\n     this.iidStore = iidStore;\n     this.fidGenerator = fidGenerator;\n+    this.backgroundExecutor = backgroundExecutor;\n+    this.networkExecutor =\n+        new ThreadPoolExecutor(\n+            1, 1, 0L, TimeUnit.MILLISECONDS, new LinkedBlockingQueue<>(), threadFactory);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "90736ac91ea635d5c02f7acc77edcf0b963d0dd6"}, "originalPosition": 43}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MzgzMDQ0Mw==", "bodyText": "As mentioned earlier, reason for explicitly creating is some 1p apps restrict creating unnamed thread pools. We got the ThreadFactory created in FIS whitelisted.\nRefer to b/148952570\nI documented the constants.", "url": "https://github.com/firebase/firebase-android-sdk/pull/1355#discussion_r393830443", "createdAt": "2020-03-17T16:59:33Z", "author": {"login": "ankitaj224"}, "path": "firebase-installations/src/main/java/com/google/firebase/installations/FirebaseInstallations.java", "diffHunk": "@@ -119,11 +120,14 @@ public Thread newThread(Runnable r) {\n       RandomFidGenerator fidGenerator) {\n     this.firebaseApp = firebaseApp;\n     this.serviceClient = serviceClient;\n-    this.executor = executor;\n     this.persistedInstallation = persistedInstallation;\n     this.utils = utils;\n     this.iidStore = iidStore;\n     this.fidGenerator = fidGenerator;\n+    this.backgroundExecutor = backgroundExecutor;\n+    this.networkExecutor =\n+        new ThreadPoolExecutor(\n+            1, 1, 0L, TimeUnit.MILLISECONDS, new LinkedBlockingQueue<>(), threadFactory);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MzM5MjY5OA=="}, "originalCommit": {"oid": "90736ac91ea635d5c02f7acc77edcf0b963d0dd6"}, "originalPosition": 43}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjQzODQ3OTE5OnYy", "diffSide": "RIGHT", "path": "firebase-installations/src/main/java/com/google/firebase/installations/FirebaseInstallations.java", "isResolved": true, "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xN1QwMToxNToxM1rOF3K1MA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xN1QxNjo1NjozOVrOF3lYkA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MzM5MzQ1Ng==", "bodyText": "I think fis is redundant here. How about \"doNetworkCall\".", "url": "https://github.com/firebase/firebase-android-sdk/pull/1355#discussion_r393393456", "createdAt": "2020-03-17T01:15:13Z", "author": {"login": "fredquintana"}, "path": "firebase-installations/src/main/java/com/google/firebase/installations/FirebaseInstallations.java", "diffHunk": "@@ -307,7 +311,13 @@ private final void doRegistrationInternal(boolean forceRefresh) {\n     }\n \n     triggerOnStateReached(prefs);\n+    // Execute network calls (CreateInstallations or GenerateAuthToken) to the FIS Servers on\n+    // a separate executor i.e networkExecutor\n+    networkExecutor.execute(() -> fisNetworkCall(forceRefresh));\n+  }\n \n+  private void fisNetworkCall(boolean forceRefresh) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "90736ac91ea635d5c02f7acc77edcf0b963d0dd6"}, "originalPosition": 86}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MzM5OTkwNg==", "bodyText": "+1.\nI already made suggestions in the other thread (see below).\nBut #doNetWorkCall sounds totally reasonable.\n#sendNetworkCall\n#makeNetworkCall\n#sendRequestToFirebaseInstallationsServerApi\n#syncWithFirebaseInstallationsServerApi\n#updateLocalAuthToken", "url": "https://github.com/firebase/firebase-android-sdk/pull/1355#discussion_r393399906", "createdAt": "2020-03-17T01:42:41Z", "author": {"login": "andirayo"}, "path": "firebase-installations/src/main/java/com/google/firebase/installations/FirebaseInstallations.java", "diffHunk": "@@ -307,7 +311,13 @@ private final void doRegistrationInternal(boolean forceRefresh) {\n     }\n \n     triggerOnStateReached(prefs);\n+    // Execute network calls (CreateInstallations or GenerateAuthToken) to the FIS Servers on\n+    // a separate executor i.e networkExecutor\n+    networkExecutor.execute(() -> fisNetworkCall(forceRefresh));\n+  }\n \n+  private void fisNetworkCall(boolean forceRefresh) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MzM5MzQ1Ng=="}, "originalCommit": {"oid": "90736ac91ea635d5c02f7acc77edcf0b963d0dd6"}, "originalPosition": 86}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MzgyODQ5Ng==", "bodyText": "Done.", "url": "https://github.com/firebase/firebase-android-sdk/pull/1355#discussion_r393828496", "createdAt": "2020-03-17T16:56:39Z", "author": {"login": "ankitaj224"}, "path": "firebase-installations/src/main/java/com/google/firebase/installations/FirebaseInstallations.java", "diffHunk": "@@ -307,7 +311,13 @@ private final void doRegistrationInternal(boolean forceRefresh) {\n     }\n \n     triggerOnStateReached(prefs);\n+    // Execute network calls (CreateInstallations or GenerateAuthToken) to the FIS Servers on\n+    // a separate executor i.e networkExecutor\n+    networkExecutor.execute(() -> fisNetworkCall(forceRefresh));\n+  }\n \n+  private void fisNetworkCall(boolean forceRefresh) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MzM5MzQ1Ng=="}, "originalCommit": {"oid": "90736ac91ea635d5c02f7acc77edcf0b963d0dd6"}, "originalPosition": 86}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjQzODUxODI0OnYy", "diffSide": "RIGHT", "path": "firebase-installations/src/main/java/com/google/firebase/installations/FirebaseInstallations.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xN1QwMTo0MToyOFrOF3LNGw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xN1QxNjo1ODoxM1rOF3lcjQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MzM5OTU3OQ==", "bodyText": "Do I read this correctly?\n0L Milliseconds is the timeout time?\nQuestions and Notes:\n\nCan we use the same numbers that we use for the backgroundExecutor?\nPlease create constants and use them for both executors\nWhy is the core pool size different to the other executor?", "url": "https://github.com/firebase/firebase-android-sdk/pull/1355#discussion_r393399579", "createdAt": "2020-03-17T01:41:28Z", "author": {"login": "andirayo"}, "path": "firebase-installations/src/main/java/com/google/firebase/installations/FirebaseInstallations.java", "diffHunk": "@@ -119,11 +120,14 @@ public Thread newThread(Runnable r) {\n       RandomFidGenerator fidGenerator) {\n     this.firebaseApp = firebaseApp;\n     this.serviceClient = serviceClient;\n-    this.executor = executor;\n     this.persistedInstallation = persistedInstallation;\n     this.utils = utils;\n     this.iidStore = iidStore;\n     this.fidGenerator = fidGenerator;\n+    this.backgroundExecutor = backgroundExecutor;\n+    this.networkExecutor =\n+        new ThreadPoolExecutor(\n+            1, 1, 0L, TimeUnit.MILLISECONDS, new LinkedBlockingQueue<>(), threadFactory);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "90736ac91ea635d5c02f7acc77edcf0b963d0dd6"}, "originalPosition": 43}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MzgyOTUxNw==", "bodyText": "0L is the keep alive time - when the number of threads is greater than the core, this is the maximum time that excess idle threads will wait for new tasks before terminating.\nCreated constants that are shared between the two executors.", "url": "https://github.com/firebase/firebase-android-sdk/pull/1355#discussion_r393829517", "createdAt": "2020-03-17T16:58:13Z", "author": {"login": "ankitaj224"}, "path": "firebase-installations/src/main/java/com/google/firebase/installations/FirebaseInstallations.java", "diffHunk": "@@ -119,11 +120,14 @@ public Thread newThread(Runnable r) {\n       RandomFidGenerator fidGenerator) {\n     this.firebaseApp = firebaseApp;\n     this.serviceClient = serviceClient;\n-    this.executor = executor;\n     this.persistedInstallation = persistedInstallation;\n     this.utils = utils;\n     this.iidStore = iidStore;\n     this.fidGenerator = fidGenerator;\n+    this.backgroundExecutor = backgroundExecutor;\n+    this.networkExecutor =\n+        new ThreadPoolExecutor(\n+            1, 1, 0L, TimeUnit.MILLISECONDS, new LinkedBlockingQueue<>(), threadFactory);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MzM5OTU3OQ=="}, "originalCommit": {"oid": "90736ac91ea635d5c02f7acc77edcf0b963d0dd6"}, "originalPosition": 43}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjQ0MTE4NDQyOnYy", "diffSide": "RIGHT", "path": "firebase-installations/src/main/java/com/google/firebase/installations/FirebaseInstallations.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xN1QxNzowNDowOVrOF3lsGQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xN1QxNzowNDowOVrOF3lsGQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MzgzMzQ5Nw==", "bodyText": "did you intend this to be KEEP_ALIVE_TIME_IN_SECONDS?", "url": "https://github.com/firebase/firebase-android-sdk/pull/1355#discussion_r393833497", "createdAt": "2020-03-17T17:04:09Z", "author": {"login": "fredquintana"}, "path": "firebase-installations/src/main/java/com/google/firebase/installations/FirebaseInstallations.java", "diffHunk": "@@ -119,11 +122,19 @@ public Thread newThread(Runnable r) {\n       RandomFidGenerator fidGenerator) {\n     this.firebaseApp = firebaseApp;\n     this.serviceClient = serviceClient;\n-    this.executor = executor;\n     this.persistedInstallation = persistedInstallation;\n     this.utils = utils;\n     this.iidStore = iidStore;\n     this.fidGenerator = fidGenerator;\n+    this.backgroundExecutor = backgroundExecutor;\n+    this.networkExecutor =\n+        new ThreadPoolExecutor(\n+            /* corePoolSize= */ CORE_POOL_SIZE,\n+            /* maximumPoolSize= */ MAXIMUM_POOL_SIZE,\n+            /* keepAliveTime= */ 0L,", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "bc31cf7c03ea6a9fd69b6196ebc10adf9a248c9d"}, "originalPosition": 70}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjQ0MTE4NTM2OnYy", "diffSide": "RIGHT", "path": "firebase-installations/src/main/java/com/google/firebase/installations/FirebaseInstallations.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xN1QxNzowNDoyNFrOF3lsqA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xN1QxNzowNDoyNFrOF3lsqA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MzgzMzY0MA==", "bodyText": "change to SECONDS", "url": "https://github.com/firebase/firebase-android-sdk/pull/1355#discussion_r393833640", "createdAt": "2020-03-17T17:04:24Z", "author": {"login": "fredquintana"}, "path": "firebase-installations/src/main/java/com/google/firebase/installations/FirebaseInstallations.java", "diffHunk": "@@ -119,11 +122,19 @@ public Thread newThread(Runnable r) {\n       RandomFidGenerator fidGenerator) {\n     this.firebaseApp = firebaseApp;\n     this.serviceClient = serviceClient;\n-    this.executor = executor;\n     this.persistedInstallation = persistedInstallation;\n     this.utils = utils;\n     this.iidStore = iidStore;\n     this.fidGenerator = fidGenerator;\n+    this.backgroundExecutor = backgroundExecutor;\n+    this.networkExecutor =\n+        new ThreadPoolExecutor(\n+            /* corePoolSize= */ CORE_POOL_SIZE,\n+            /* maximumPoolSize= */ MAXIMUM_POOL_SIZE,\n+            /* keepAliveTime= */ 0L,\n+            TimeUnit.MILLISECONDS,", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "bc31cf7c03ea6a9fd69b6196ebc10adf9a248c9d"}, "originalPosition": 71}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjQ0MTE5MTgxOnYy", "diffSide": "RIGHT", "path": "firebase-installations/src/main/java/com/google/firebase/installations/FirebaseInstallations.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xN1QxNzowNjowOFrOF3lxCg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xN1QxNzowNjowOFrOF3lxCg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MzgzNDc2Mg==", "bodyText": "No comments needed since you are using constants that explain the purpose of the parameters.", "url": "https://github.com/firebase/firebase-android-sdk/pull/1355#discussion_r393834762", "createdAt": "2020-03-17T17:06:08Z", "author": {"login": "andirayo"}, "path": "firebase-installations/src/main/java/com/google/firebase/installations/FirebaseInstallations.java", "diffHunk": "@@ -94,12 +97,12 @@ public Thread newThread(Runnable r) {\n       @Nullable HeartBeatInfo heartbeatInfo) {\n     this(\n         new ThreadPoolExecutor(\n-            /* corePoolSize= */ 0,\n-            /* maximumPoolSize= */ 1,\n-            /* keepAliveTime= */ 30L,\n+            /* corePoolSize= */ CORE_POOL_SIZE,\n+            /* maximumPoolSize= */ MAXIMUM_POOL_SIZE,\n+            /* keepAliveTime= */ KEEP_ALIVE_TIME_IN_SECONDS,\n             TimeUnit.SECONDS,\n             /* workQueue= */ new LinkedBlockingQueue<>(),\n-            /* threadFactory= */ threadFactory),\n+            /* threadFactory= */ THREAD_FACTORY),", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "bc31cf7c03ea6a9fd69b6196ebc10adf9a248c9d"}, "originalPosition": 43}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjQ0MTE5MzIzOnYy", "diffSide": "RIGHT", "path": "firebase-installations/src/main/java/com/google/firebase/installations/FirebaseInstallations.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xN1QxNzowNjozMFrOF3lx_g==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xN1QxNzowNjozMFrOF3lx_g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MzgzNTAwNg==", "bodyText": "No comments needed since you are using constants that explain the purpose of the parameters.", "url": "https://github.com/firebase/firebase-android-sdk/pull/1355#discussion_r393835006", "createdAt": "2020-03-17T17:06:30Z", "author": {"login": "andirayo"}, "path": "firebase-installations/src/main/java/com/google/firebase/installations/FirebaseInstallations.java", "diffHunk": "@@ -119,11 +122,19 @@ public Thread newThread(Runnable r) {\n       RandomFidGenerator fidGenerator) {\n     this.firebaseApp = firebaseApp;\n     this.serviceClient = serviceClient;\n-    this.executor = executor;\n     this.persistedInstallation = persistedInstallation;\n     this.utils = utils;\n     this.iidStore = iidStore;\n     this.fidGenerator = fidGenerator;\n+    this.backgroundExecutor = backgroundExecutor;\n+    this.networkExecutor =\n+        new ThreadPoolExecutor(\n+            /* corePoolSize= */ CORE_POOL_SIZE,\n+            /* maximumPoolSize= */ MAXIMUM_POOL_SIZE,\n+            /* keepAliveTime= */ 0L,\n+            TimeUnit.MILLISECONDS,\n+            /* workQueue= */ new LinkedBlockingQueue<>(),\n+            /* threadFactory= */ THREAD_FACTORY);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "bc31cf7c03ea6a9fd69b6196ebc10adf9a248c9d"}, "originalPosition": 73}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 883, "cost": 1, "resetAt": "2021-11-12T18:49:56Z"}}}