{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDMxMzAwNTYw", "number": 1628, "title": "Refetch token if attempt was invalidated", "bodyText": "Port of firebase/firebase-js-sdk#3184", "createdAt": "2020-06-08T17:53:14Z", "url": "https://github.com/firebase/firebase-android-sdk/pull/1628", "merged": true, "mergeCommit": {"oid": "58e83e68d0693efdd51cb2109e29dc3983e4bb25"}, "closed": true, "closedAt": "2020-06-08T19:44:28Z", "author": {"login": "schmidt-sebastian"}, "timelineItems": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcpUQBrgH2gAyNDMxMzAwNTYwOmU0NmI2MmQ0MGU1MzBhYzViOTY5MDA0NTY2YWExNDZkYzUzNmFiMDg=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcpVwzCgFqTQyNjU2MTM1Mg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "e46b62d40e530ac5b969004566aa146dc536ab08", "author": {"user": {"login": "schmidt-sebastian", "name": "Sebastian Schmidt"}}, "url": "https://github.com/firebase/firebase-android-sdk/commit/e46b62d40e530ac5b969004566aa146dc536ab08", "committedDate": "2020-06-08T17:52:35Z", "message": "Refetch token if attempt was invalidated"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "d0413428e03b33a04cdf91013a16dfa37e45ab5c", "author": {"user": {"login": "schmidt-sebastian", "name": "Sebastian Schmidt"}}, "url": "https://github.com/firebase/firebase-android-sdk/commit/d0413428e03b33a04cdf91013a16dfa37e45ab5c", "committedDate": "2020-06-08T18:45:10Z", "message": "Udpate changelog"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDI2NTYxMzUy", "url": "https://github.com/firebase/firebase-android-sdk/pull/1628#pullrequestreview-426561352", "createdAt": "2020-06-08T19:38:07Z", "commit": {"oid": "d0413428e03b33a04cdf91013a16dfa37e45ab5c"}, "state": "APPROVED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wOFQxOTozODowOFrOGgtnYA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wOFQxOTozODowOFrOGgtnYA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNjk1NDk3Ng==", "bodyText": "General observation: it seems a little unfortunate that getToken and getResult().getToken() look so similar while having a very different effect. In general, I'd expect a get-prefixed function to be a simple getter, so it might be better to rename getToken to something like fetchToken to better convey its semantics. Of course, this is absolutely out of scope for this PR.", "url": "https://github.com/firebase/firebase-android-sdk/pull/1628#discussion_r436954976", "createdAt": "2020-06-08T19:38:08Z", "author": {"login": "var-const"}, "path": "firebase-firestore/src/main/java/com/google/firebase/firestore/auth/FirebaseAuthCredentialsProvider.java", "diffHunk": "@@ -85,19 +88,21 @@ public FirebaseAuthCredentialsProvider(InternalAuthProvider authProvider) {\n     // Take note of the current value of the tokenCounter so that this method can fail (with a\n     // FirebaseFirestoreException) if there is a token change while the request is outstanding.\n     final int savedCounter = tokenCounter;\n-    return res.continueWith(\n+    return res.continueWithTask(\n+        Executors.DIRECT_EXECUTOR,\n         task -> {\n           synchronized (this) {\n             // Cancel the request since the token changed while the request was outstanding so the\n             // response is potentially for a previous user (which user, we can't be sure).\n             if (savedCounter != tokenCounter) {\n-              throw new FirebaseFirestoreException(\n-                  \"getToken aborted due to token change\", Code.ABORTED);\n+              Logger.debug(LOG_TAG, \"getToken aborted due to token change\");\n+              return getToken();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d0413428e03b33a04cdf91013a16dfa37e45ab5c"}, "originalPosition": 41}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2529, "cost": 1, "resetAt": "2021-11-01T14:20:25Z"}}}