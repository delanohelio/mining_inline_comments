{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0MzY4NjgyNDQz", "number": 1171, "title": "Add test to verify canonical IDs are stable", "bodyText": "There is a risk in the Protobuf FieldValue rewrite, so let's add a test to make sure we don't break the IDs.", "createdAt": "2020-01-29T17:36:46Z", "url": "https://github.com/firebase/firebase-android-sdk/pull/1171", "merged": true, "mergeCommit": {"oid": "71781845f5e54fe34d335f3e043bed6ec96bf3a6"}, "closed": true, "closedAt": "2020-01-31T21:55:35Z", "author": {"login": "schmidt-sebastian"}, "timelineItems": {"totalCount": 11, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABb_JfkTgH2gAyMzY4NjgyNDQzOmUzY2JhN2NiZjg3NzYzNWZiZmU0MDkwMjg1MzU2ZWEzZDhhMjA5NWQ=", "endCursor": "Y3Vyc29yOnYyOpPPAAABb_1s0kgFqTM1MTc3NzIyNQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "e3cba7cbf877635fbfe4090285356ea3d8a2095d", "author": {"user": {"login": "schmidt-sebastian", "name": "Sebastian Schmidt"}}, "url": "https://github.com/firebase/firebase-android-sdk/commit/e3cba7cbf877635fbfe4090285356ea3d8a2095d", "committedDate": "2020-01-29T17:35:47Z", "message": "Add test to verify canonical IDs are stable"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "eb022d4bc15e6da3a3db0be15f82d8e695292d96", "author": {"user": {"login": "schmidt-sebastian", "name": "Sebastian Schmidt"}}, "url": "https://github.com/firebase/firebase-android-sdk/commit/eb022d4bc15e6da3a3db0be15f82d8e695292d96", "committedDate": "2020-01-29T17:39:56Z", "message": "Add test for upper bound"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzUwMzE1MjY0", "url": "https://github.com/firebase/firebase-android-sdk/pull/1171#pullrequestreview-350315264", "createdAt": "2020-01-29T18:06:57Z", "commit": {"oid": "eb022d4bc15e6da3a3db0be15f82d8e695292d96"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0yOVQxODowNjo1OFrOFjSSuA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0yOVQxODowNjo1OFrOFjSSuA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MjU0NDE4NA==", "bodyText": "Consider adding an assertion helper instead. Something like\nprivate void assertCanonicalId(String canonicalId, Query query) {\n  assertEquals(canonicalId, query.getCanonicalId());\n}\nThese end up being about the same size at the call site but are easier to step through/debug/see exactly what failed just from exception line numbers.", "url": "https://github.com/firebase/firebase-android-sdk/pull/1171#discussion_r372544184", "createdAt": "2020-01-29T18:06:58Z", "author": {"login": "wilhuff"}, "path": "firebase-firestore/src/test/java/com/google/firebase/firestore/core/QueryTest.java", "diffHunk": "@@ -553,4 +559,62 @@ public void testMatchesAllDocuments() {\n     query = baseQuery.endAt(new Bound(Collections.emptyList(), true));\n     assertFalse(query.matchesAllDocuments());\n   }\n+\n+  @Test\n+  public void testCanonicalIdsAreStable() {\n+    // This test aims to ensure that we do not break canonical IDs, as they are used as keys in\n+    // the TargetCache.\n+\n+    Query baseQuery = Query.atPath(ResourcePath.fromString(\"collection\"));\n+\n+    Map<Query, String> queryToCanoncialIdMap = new LinkedHashMap<>();\n+    queryToCanoncialIdMap.put(baseQuery, \"collection|f:|ob:__name__asc|lt:LIMIT_TO_FIRST\");", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "eb022d4bc15e6da3a3db0be15f82d8e695292d96"}, "originalPosition": 36}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ef9206f95ed6dbbe447883a397d89e46d7b6f753", "author": {"user": {"login": "schmidt-sebastian", "name": "Sebastian Schmidt"}}, "url": "https://github.com/firebase/firebase-android-sdk/commit/ef9206f95ed6dbbe447883a397d89e46d7b6f753", "committedDate": "2020-01-29T19:45:49Z", "message": "Add test helper"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "63cb1feeb0fa94f9fe3655266cac5e8311be3c09", "author": {"user": {"login": "schmidt-sebastian", "name": "Sebastian Schmidt"}}, "url": "https://github.com/firebase/firebase-android-sdk/commit/63cb1feeb0fa94f9fe3655266cac5e8311be3c09", "committedDate": "2020-01-29T21:43:03Z", "message": "Add test for reference value"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c09a0ba802d283cb73aa25cae1500e3099e42ccf", "author": {"user": {"login": "schmidt-sebastian", "name": "Sebastian Schmidt"}}, "url": "https://github.com/firebase/firebase-android-sdk/commit/c09a0ba802d283cb73aa25cae1500e3099e42ccf", "committedDate": "2020-01-29T22:52:29Z", "message": "Add Timestamp"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c5d125753eb568785c7ca4d4777f57ad79496679", "author": {"user": {"login": "schmidt-sebastian", "name": "Sebastian Schmidt"}}, "url": "https://github.com/firebase/firebase-android-sdk/commit/c5d125753eb568785c7ca4d4777f57ad79496679", "committedDate": "2020-01-30T01:40:18Z", "message": "Update QueryTest.java"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "7e66bd1d600c02a4dfda6c17ba243acbfe4cec41", "author": {"user": {"login": "schmidt-sebastian", "name": "Sebastian Schmidt"}}, "url": "https://github.com/firebase/firebase-android-sdk/commit/7e66bd1d600c02a4dfda6c17ba243acbfe4cec41", "committedDate": "2020-01-30T01:42:42Z", "message": "Use different values for GeoPoint and Timestamp"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzUwODc5ODM1", "url": "https://github.com/firebase/firebase-android-sdk/pull/1171#pullrequestreview-350879835", "createdAt": "2020-01-30T14:49:39Z", "commit": {"oid": "7e66bd1d600c02a4dfda6c17ba243acbfe4cec41"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0zMFQxNDo0OTo0MFrOFjtp3g==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0zMFQxNDo0OTo0MFrOFjtp3g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3Mjk5MjQ3OA==", "bodyText": "Thanks for adding this test!\nIt's the Target's canonical ID that is used in Target cache. Query canonical ID is only used in SpecTestCase and I have a TODO to remove it all together.\nCan you test Target.getCanonicalId() instead? Thanks!", "url": "https://github.com/firebase/firebase-android-sdk/pull/1171#discussion_r372992478", "createdAt": "2020-01-30T14:49:40Z", "author": {"login": "wu-hui"}, "path": "firebase-firestore/src/test/java/com/google/firebase/firestore/core/QueryTest.java", "diffHunk": "@@ -553,4 +558,67 @@ public void testMatchesAllDocuments() {\n     query = baseQuery.endAt(new Bound(Collections.emptyList(), true));\n     assertFalse(query.matchesAllDocuments());\n   }\n+\n+  @Test\n+  public void testCanonicalIdsAreStable() {\n+    // This test aims to ensure that we do not break canonical IDs, as they are used as keys in", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "7e66bd1d600c02a4dfda6c17ba243acbfe4cec41"}, "originalPosition": 27}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "6655a44d8442a36a0e3bc2155a5fd17b8dc2aa76", "author": {"user": {"login": "schmidt-sebastian", "name": "Sebastian Schmidt"}}, "url": "https://github.com/firebase/firebase-android-sdk/commit/6655a44d8442a36a0e3bc2155a5fd17b8dc2aa76", "committedDate": "2020-01-31T18:22:12Z", "message": "Use Target"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzUxNzc3MjI1", "url": "https://github.com/firebase/firebase-android-sdk/pull/1171#pullrequestreview-351777225", "createdAt": "2020-01-31T21:06:05Z", "commit": {"oid": "6655a44d8442a36a0e3bc2155a5fd17b8dc2aa76"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2276, "cost": 1, "resetAt": "2021-11-01T14:20:25Z"}}}