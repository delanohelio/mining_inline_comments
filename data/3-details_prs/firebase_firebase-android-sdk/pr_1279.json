{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0Mzc5NzQ1MzM2", "number": 1279, "title": "Add upload variant switch to ReportUploader", "bodyText": "", "createdAt": "2020-02-25T18:57:57Z", "url": "https://github.com/firebase/firebase-android-sdk/pull/1279", "merged": true, "mergeCommit": {"oid": "c400fb695be556b305f99f6bd50dce4cf6317f91"}, "closed": true, "closedAt": "2020-02-25T20:05:15Z", "author": {"login": "mrwillis21"}, "timelineItems": {"totalCount": 9, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcH1v3QAH2gAyMzc5NzQ1MzM2OjYxMDI4ODY1ZDlmZmMwNjNjZTcyMWQyZjE0N2U0NjgxZTBiOWZjMzE=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcH3nckgFqTM2NDQwMjczMg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "61028865d9ffc063ce721d2f147e4681e0b9fc31", "author": {"user": {"login": "mrwillis21", "name": "Matt Willis"}}, "url": "https://github.com/firebase/firebase-android-sdk/commit/61028865d9ffc063ce721d2f147e4681e0b9fc31", "committedDate": "2020-02-25T17:40:48Z", "message": "Add upload variant switch to ReportUploader"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzY0Mzg3OTAx", "url": "https://github.com/firebase/firebase-android-sdk/pull/1279#pullrequestreview-364387901", "createdAt": "2020-02-25T19:29:02Z", "commit": {"oid": "61028865d9ffc063ce721d2f147e4681e0b9fc31"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yNVQxOToyOTowM1rOFuSOqA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yNVQxOToyOTowM1rOFuSOqA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NDA3NzQ4MA==", "bodyText": "What is the purpose of this .substring(0, 35)?", "url": "https://github.com/firebase/firebase-android-sdk/pull/1279#discussion_r384077480", "createdAt": "2020-02-25T19:29:03Z", "author": {"login": "jakeouellette"}, "path": "firebase-crashlytics/src/androidTest/java/com/google/firebase/crashlytics/core/TestNativeReportFilesProvider.java", "diffHunk": "@@ -0,0 +1,63 @@\n+// Copyright 2020 Google LLC\n+//\n+// Licensed under the Apache License, Version 2.0 (the \"License\");\n+// you may not use this file except in compliance with the License.\n+// You may obtain a copy of the License at\n+//\n+//      http://www.apache.org/licenses/LICENSE-2.0\n+//\n+// Unless required by applicable law or agreed to in writing, software\n+// distributed under the License is distributed on an \"AS IS\" BASIS,\n+// WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+// See the License for the specific language governing permissions and\n+// limitations under the License.\n+\n+package com.google.firebase.crashlytics.core;\n+\n+import android.content.Context;\n+import com.google.firebase.crashlytics.internal.report.ReportUploader;\n+import java.io.File;\n+import java.io.IOException;\n+import java.util.UUID;\n+\n+public class TestNativeReportFilesProvider implements ReportUploader.ReportFilesProvider {\n+  private final File validFiles;\n+\n+  public TestNativeReportFilesProvider(Context context) {\n+    final File filesDir = context.getFilesDir();\n+    recursiveDelete(filesDir);\n+\n+    File rootFolder = new File(context.getFilesDir(), UUID.randomUUID().toString());\n+    rootFolder.mkdirs();\n+\n+    validFiles = new File(rootFolder, UUID.randomUUID().toString());\n+    validFiles.mkdirs();\n+  }\n+\n+  @Override\n+  public File[] getCompleteSessionFiles() {\n+    return new File[0];\n+  }\n+\n+  @Override\n+  public File[] getNativeReportFiles() {\n+    return validFiles.listFiles();\n+  }\n+\n+  private static String createRandomSessionId() {\n+    return UUID.randomUUID().toString().substring(0, 35);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "61028865d9ffc063ce721d2f147e4681e0b9fc31"}, "originalPosition": 48}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzY0Mzg4OTMy", "url": "https://github.com/firebase/firebase-android-sdk/pull/1279#pullrequestreview-364388932", "createdAt": "2020-02-25T19:30:35Z", "commit": {"oid": "61028865d9ffc063ce721d2f147e4681e0b9fc31"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yNVQxOTozMDozNVrOFuSRxw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yNVQxOTozMDozNVrOFuSRxw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NDA3ODI3OQ==", "bodyText": "CrashlyticsReportPersistence has this operation too. Should we make a util class?", "url": "https://github.com/firebase/firebase-android-sdk/pull/1279#discussion_r384078279", "createdAt": "2020-02-25T19:30:35Z", "author": {"login": "jakeouellette"}, "path": "firebase-crashlytics/src/androidTest/java/com/google/firebase/crashlytics/core/TestNativeReportFilesProvider.java", "diffHunk": "@@ -0,0 +1,63 @@\n+// Copyright 2020 Google LLC\n+//\n+// Licensed under the Apache License, Version 2.0 (the \"License\");\n+// you may not use this file except in compliance with the License.\n+// You may obtain a copy of the License at\n+//\n+//      http://www.apache.org/licenses/LICENSE-2.0\n+//\n+// Unless required by applicable law or agreed to in writing, software\n+// distributed under the License is distributed on an \"AS IS\" BASIS,\n+// WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+// See the License for the specific language governing permissions and\n+// limitations under the License.\n+\n+package com.google.firebase.crashlytics.core;\n+\n+import android.content.Context;\n+import com.google.firebase.crashlytics.internal.report.ReportUploader;\n+import java.io.File;\n+import java.io.IOException;\n+import java.util.UUID;\n+\n+public class TestNativeReportFilesProvider implements ReportUploader.ReportFilesProvider {\n+  private final File validFiles;\n+\n+  public TestNativeReportFilesProvider(Context context) {\n+    final File filesDir = context.getFilesDir();\n+    recursiveDelete(filesDir);\n+\n+    File rootFolder = new File(context.getFilesDir(), UUID.randomUUID().toString());\n+    rootFolder.mkdirs();\n+\n+    validFiles = new File(rootFolder, UUID.randomUUID().toString());\n+    validFiles.mkdirs();\n+  }\n+\n+  @Override\n+  public File[] getCompleteSessionFiles() {\n+    return new File[0];\n+  }\n+\n+  @Override\n+  public File[] getNativeReportFiles() {\n+    return validFiles.listFiles();\n+  }\n+\n+  private static String createRandomSessionId() {\n+    return UUID.randomUUID().toString().substring(0, 35);\n+  }\n+\n+  private static void recursiveDelete(File file) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "61028865d9ffc063ce721d2f147e4681e0b9fc31"}, "originalPosition": 51}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzY0Mzg5Mzk5", "url": "https://github.com/firebase/firebase-android-sdk/pull/1279#pullrequestreview-364389399", "createdAt": "2020-02-25T19:31:12Z", "commit": {"oid": "61028865d9ffc063ce721d2f147e4681e0b9fc31"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yNVQxOTozMToxMlrOFuSTRw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yNVQxOTozMToxMlrOFuSTRw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NDA3ODY2Mw==", "bodyText": "should we document what \"legacy\" means / changes?", "url": "https://github.com/firebase/firebase-android-sdk/pull/1279#discussion_r384078663", "createdAt": "2020-02-25T19:31:12Z", "author": {"login": "jakeouellette"}, "path": "firebase-crashlytics/src/main/java/com/google/firebase/crashlytics/core/CrashlyticsController.java", "diffHunk": "@@ -105,6 +105,8 @@\n   static final String FIREBASE_APPLICATION_EXCEPTION = \"_ae\";\n   static final String FIREBASE_ANALYTICS_ORIGIN_CRASHLYTICS = \"clx\";\n \n+  static final int REPORT_UPLOAD_VARIANT_LEGACY = 1;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "61028865d9ffc063ce721d2f147e4681e0b9fc31"}, "originalPosition": 4}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzY0Mzg5ODE1", "url": "https://github.com/firebase/firebase-android-sdk/pull/1279#pullrequestreview-364389815", "createdAt": "2020-02-25T19:31:46Z", "commit": {"oid": "61028865d9ffc063ce721d2f147e4681e0b9fc31"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yNVQxOTozMTo0N1rOFuSUlA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yNVQxOTozMTo0N1rOFuSUlA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NDA3ODk5Ng==", "bodyText": "Worth a TODO?", "url": "https://github.com/firebase/firebase-android-sdk/pull/1279#discussion_r384078996", "createdAt": "2020-02-25T19:31:47Z", "author": {"login": "jakeouellette"}, "path": "firebase-crashlytics/src/main/java/com/google/firebase/crashlytics/internal/report/ReportUploader.java", "diffHunk": "@@ -96,14 +99,21 @@ public boolean uploadReport(Report report, boolean dataCollectionToken) {\n       final CreateReportRequest requestData =\n           new CreateReportRequest(organizationId, googleAppId, report);\n \n-      final boolean sent = createReportCall.invoke(requestData, dataCollectionToken);\n+      boolean sent;\n+      // For now, send native reports to reports endpoint regardless of the setting.", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "61028865d9ffc063ce721d2f147e4681e0b9fc31"}, "originalPosition": 30}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzY0MzkyMTI4", "url": "https://github.com/firebase/firebase-android-sdk/pull/1279#pullrequestreview-364392128", "createdAt": "2020-02-25T19:35:22Z", "commit": {"oid": "61028865d9ffc063ce721d2f147e4681e0b9fc31"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yNVQxOTozNToyM1rOFuSbjw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yNVQxOTozNToyM1rOFuSbjw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NDA4MDc4Mw==", "bodyText": "If it didn't actually send, should we change the name of this bool to shouldDeleteReport or something similar?", "url": "https://github.com/firebase/firebase-android-sdk/pull/1279#discussion_r384080783", "createdAt": "2020-02-25T19:35:23Z", "author": {"login": "jakeouellette"}, "path": "firebase-crashlytics/src/main/java/com/google/firebase/crashlytics/internal/report/ReportUploader.java", "diffHunk": "@@ -96,14 +99,21 @@ public boolean uploadReport(Report report, boolean dataCollectionToken) {\n       final CreateReportRequest requestData =\n           new CreateReportRequest(organizationId, googleAppId, report);\n \n-      final boolean sent = createReportCall.invoke(requestData, dataCollectionToken);\n+      boolean sent;\n+      // For now, send native reports to reports endpoint regardless of the setting.\n+      if (isUsingReportsEndpoint || report.getType() == Report.Type.NATIVE) {\n+        sent = createReportCall.invoke(requestData, dataCollectionToken);\n \n-      Logger.getLogger()\n-          .i(\n-              Logger.TAG,\n-              \"Crashlytics report upload \"\n-                  + (sent ? \"complete: \" : \"FAILED: \")\n-                  + report.getIdentifier());\n+        Logger.getLogger()\n+            .i(\n+                Logger.TAG,\n+                \"Crashlytics report upload \"\n+                    + (sent ? \"complete: \" : \"FAILED: \")\n+                    + report.getIdentifier());\n+      } else {\n+        Logger.getLogger().d(Logger.TAG, \"Send to reports endpoint disabled. Removing report.\");\n+        sent = true;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "61028865d9ffc063ce721d2f147e4681e0b9fc31"}, "originalPosition": 48}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzY0MzkyMzMy", "url": "https://github.com/firebase/firebase-android-sdk/pull/1279#pullrequestreview-364392332", "createdAt": "2020-02-25T19:35:40Z", "commit": {"oid": "61028865d9ffc063ce721d2f147e4681e0b9fc31"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "1188357c18016ec75592052d3e3e89850357fe8c", "author": {"user": {"login": "mrwillis21", "name": "Matt Willis"}}, "url": "https://github.com/firebase/firebase-android-sdk/commit/1188357c18016ec75592052d3e3e89850357fe8c", "committedDate": "2020-02-25T19:49:44Z", "message": "Feedback"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzY0NDAyNzMy", "url": "https://github.com/firebase/firebase-android-sdk/pull/1279#pullrequestreview-364402732", "createdAt": "2020-02-25T19:51:25Z", "commit": {"oid": "1188357c18016ec75592052d3e3e89850357fe8c"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2095, "cost": 1, "resetAt": "2021-11-01T14:20:25Z"}}}