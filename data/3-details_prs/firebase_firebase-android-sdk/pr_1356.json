{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0Mzg5ODIzNzQy", "number": 1356, "title": "Crashlytics ndk datatransport", "bodyText": "Add datatransport connection for NDK", "createdAt": "2020-03-17T13:04:31Z", "url": "https://github.com/firebase/firebase-android-sdk/pull/1356", "merged": true, "mergeCommit": {"oid": "3f5146f6908b46e9db917e2af5e555f25b045973"}, "closed": true, "closedAt": "2020-03-19T21:03:22Z", "author": {"login": "jakeouellette"}, "timelineItems": {"totalCount": 35, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcOiZztgBqjMxMzcyMzMxNTE=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcPSSVmAFqTM3ODA4NTI1OQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "1f40e4a948935fd33e9a98045125153544693905", "author": {"user": {"login": "jakeouellette", "name": "Jake Ouellette"}}, "url": "https://github.com/firebase/firebase-android-sdk/commit/1f40e4a948935fd33e9a98045125153544693905", "committedDate": "2020-03-17T13:02:50Z", "message": "Refactor datatransport abstractions to support polymorphic handling of session parts\n\nWIP\n\nWork in progress, adding metadata to reports"}, "afterCommit": {"oid": "fed40829cf9bca2740f51bb012d56a7f6e6345cb", "author": {"user": {"login": "jakeouellette", "name": "Jake Ouellette"}}, "url": "https://github.com/firebase/firebase-android-sdk/commit/fed40829cf9bca2740f51bb012d56a7f6e6345cb", "committedDate": "2020-03-17T13:05:44Z", "message": "Refactor datatransport abstractions to support polymorphic handling of session parts"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "fed40829cf9bca2740f51bb012d56a7f6e6345cb", "author": {"user": {"login": "jakeouellette", "name": "Jake Ouellette"}}, "url": "https://github.com/firebase/firebase-android-sdk/commit/fed40829cf9bca2740f51bb012d56a7f6e6345cb", "committedDate": "2020-03-17T13:05:44Z", "message": "Refactor datatransport abstractions to support polymorphic handling of session parts"}, "afterCommit": {"oid": "15f091c2982ae62be7028eb2b81413bb7f90e285", "author": {"user": {"login": "jakeouellette", "name": "Jake Ouellette"}}, "url": "https://github.com/firebase/firebase-android-sdk/commit/15f091c2982ae62be7028eb2b81413bb7f90e285", "committedDate": "2020-03-17T13:07:25Z", "message": "Refactor datatransport abstractions to support polymorphic handling of session parts"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzc2MDQyMDM2", "url": "https://github.com/firebase/firebase-android-sdk/pull/1356#pullrequestreview-376042036", "createdAt": "2020-03-17T13:39:41Z", "commit": {"oid": "15f091c2982ae62be7028eb2b81413bb7f90e285"}, "state": "COMMENTED", "comments": {"totalCount": 7, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xN1QxMzozOTo0MVrOF3cqnA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xN1QxNDozNToxNVrOF3fF6A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MzY4NTY2MA==", "bodyText": "Shouldn't we reuse getStream here?", "url": "https://github.com/firebase/firebase-android-sdk/pull/1356#discussion_r393685660", "createdAt": "2020-03-17T13:39:41Z", "author": {"login": "mrwillis21"}, "path": "firebase-crashlytics/src/main/java/com/google/firebase/crashlytics/internal/common/FileBackedNativeSessionFile.java", "diffHunk": "@@ -0,0 +1,77 @@\n+// Copyright 2020 Google LLC\n+//\n+// Licensed under the Apache License, Version 2.0 (the \"License\");\n+// you may not use this file except in compliance with the License.\n+// You may obtain a copy of the License at\n+//\n+//      http://www.apache.org/licenses/LICENSE-2.0\n+//\n+// Unless required by applicable law or agreed to in writing, software\n+// distributed under the License is distributed on an \"AS IS\" BASIS,\n+// WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+// See the License for the specific language governing permissions and\n+// limitations under the License.\n+\n+package com.google.firebase.crashlytics.internal.common;\n+\n+import com.google.firebase.crashlytics.internal.model.CrashlyticsReport;\n+import java.io.ByteArrayOutputStream;\n+import java.io.File;\n+import java.io.FileInputStream;\n+import java.io.FileNotFoundException;\n+import java.io.IOException;\n+import java.io.InputStream;\n+import java.nio.charset.Charset;\n+\n+/** A {@link NativeSessionFile} backed by a {@link File} currently on disk. */\n+class FileBackedNativeSessionFile implements NativeSessionFile {\n+  private static final Charset UTF_8 = Charset.forName(\"UTF-8\");\n+\n+  private final File f;\n+  private final String name;\n+\n+  FileBackedNativeSessionFile(String name, File f) {\n+    this.name = name;\n+    this.f = f;\n+  }\n+\n+  public String getName() {\n+    return this.name;\n+  }\n+\n+  @Override\n+  public InputStream getStream() {\n+    try {\n+      return new FileInputStream(f);\n+    } catch (FileNotFoundException f) {\n+      return null;\n+    }\n+  }\n+\n+  @Override\n+  public CrashlyticsReport.FilesPayload.File asFilePayload() {\n+    byte[] bytes = asBytes();\n+    return bytes != null\n+        ? CrashlyticsReport.FilesPayload.File.builder()\n+            .setContents(asBytes())\n+            .setFilename(name)\n+            .build()\n+        : null;\n+  }\n+\n+  private byte[] asBytes() {\n+    final byte[] readBuffer = new byte[8192];\n+    final ByteArrayOutputStream bos = new ByteArrayOutputStream();\n+    try (InputStream stream = new FileInputStream(f)) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "15f091c2982ae62be7028eb2b81413bb7f90e285"}, "originalPosition": 65}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MzY4NTk4OQ==", "bodyText": "Why not just return bos.toByteArray()?", "url": "https://github.com/firebase/firebase-android-sdk/pull/1356#discussion_r393685989", "createdAt": "2020-03-17T13:40:13Z", "author": {"login": "mrwillis21"}, "path": "firebase-crashlytics/src/main/java/com/google/firebase/crashlytics/internal/common/FileBackedNativeSessionFile.java", "diffHunk": "@@ -0,0 +1,77 @@\n+// Copyright 2020 Google LLC\n+//\n+// Licensed under the Apache License, Version 2.0 (the \"License\");\n+// you may not use this file except in compliance with the License.\n+// You may obtain a copy of the License at\n+//\n+//      http://www.apache.org/licenses/LICENSE-2.0\n+//\n+// Unless required by applicable law or agreed to in writing, software\n+// distributed under the License is distributed on an \"AS IS\" BASIS,\n+// WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+// See the License for the specific language governing permissions and\n+// limitations under the License.\n+\n+package com.google.firebase.crashlytics.internal.common;\n+\n+import com.google.firebase.crashlytics.internal.model.CrashlyticsReport;\n+import java.io.ByteArrayOutputStream;\n+import java.io.File;\n+import java.io.FileInputStream;\n+import java.io.FileNotFoundException;\n+import java.io.IOException;\n+import java.io.InputStream;\n+import java.nio.charset.Charset;\n+\n+/** A {@link NativeSessionFile} backed by a {@link File} currently on disk. */\n+class FileBackedNativeSessionFile implements NativeSessionFile {\n+  private static final Charset UTF_8 = Charset.forName(\"UTF-8\");\n+\n+  private final File f;\n+  private final String name;\n+\n+  FileBackedNativeSessionFile(String name, File f) {\n+    this.name = name;\n+    this.f = f;\n+  }\n+\n+  public String getName() {\n+    return this.name;\n+  }\n+\n+  @Override\n+  public InputStream getStream() {\n+    try {\n+      return new FileInputStream(f);\n+    } catch (FileNotFoundException f) {\n+      return null;\n+    }\n+  }\n+\n+  @Override\n+  public CrashlyticsReport.FilesPayload.File asFilePayload() {\n+    byte[] bytes = asBytes();\n+    return bytes != null\n+        ? CrashlyticsReport.FilesPayload.File.builder()\n+            .setContents(asBytes())\n+            .setFilename(name)\n+            .build()\n+        : null;\n+  }\n+\n+  private byte[] asBytes() {\n+    final byte[] readBuffer = new byte[8192];\n+    final ByteArrayOutputStream bos = new ByteArrayOutputStream();\n+    try (InputStream stream = new FileInputStream(f)) {\n+      int read;\n+      while ((read = stream.read(readBuffer)) > 0) {\n+        bos.write(readBuffer, 0, read);\n+      }\n+      return new String(bos.toByteArray(), UTF_8).getBytes();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "15f091c2982ae62be7028eb2b81413bb7f90e285"}, "originalPosition": 70}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MzY4OTU0Mw==", "bodyText": "Shouldn't we keep the serialization method separate from this API? I.e. rather than have this class know how to serialize itself to a FilesPayload, shouldn't we have a FilesPayloadSerializer? What if we wanted to add other serialization methods later?", "url": "https://github.com/firebase/firebase-android-sdk/pull/1356#discussion_r393689543", "createdAt": "2020-03-17T13:45:27Z", "author": {"login": "mrwillis21"}, "path": "firebase-crashlytics/src/main/java/com/google/firebase/crashlytics/internal/common/NativeSessionFile.java", "diffHunk": "@@ -0,0 +1,40 @@\n+// Copyright 2020 Google LLC\n+//\n+// Licensed under the Apache License, Version 2.0 (the \"License\");\n+// you may not use this file except in compliance with the License.\n+// You may obtain a copy of the License at\n+//\n+//      http://www.apache.org/licenses/LICENSE-2.0\n+//\n+// Unless required by applicable law or agreed to in writing, software\n+// distributed under the License is distributed on an \"AS IS\" BASIS,\n+// WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+// See the License for the specific language governing permissions and\n+// limitations under the License.\n+\n+package com.google.firebase.crashlytics.internal.common;\n+\n+import androidx.annotation.NonNull;\n+import androidx.annotation.Nullable;\n+import com.google.firebase.crashlytics.internal.model.CrashlyticsReport;\n+import java.io.InputStream;\n+\n+/**\n+ * An abstraction of a \"File\" resource sent to the Crashlytics backend when an NDK Crash has\n+ * occurred.\n+ */\n+interface NativeSessionFile {\n+  /** Shortname of the file, e.g., \"logs\" */\n+  @NonNull\n+  String getName();\n+\n+  /** Representation of the NativeSessionFile as a stream */\n+  @Nullable\n+  InputStream getStream();\n+\n+  /**\n+   * Representation of the NativeSessionFile as {@link CrashlyticsReport.FilesPayload.File} object.\n+   */\n+  @Nullable\n+  CrashlyticsReport.FilesPayload.File asFilePayload();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "15f091c2982ae62be7028eb2b81413bb7f90e285"}, "originalPosition": 39}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MzcyMzY2Nw==", "bodyText": "We should probably use 8192 here, as above.", "url": "https://github.com/firebase/firebase-android-sdk/pull/1356#discussion_r393723667", "createdAt": "2020-03-17T14:32:58Z", "author": {"login": "mrwillis21"}, "path": "firebase-crashlytics/src/main/java/com/google/firebase/crashlytics/internal/common/NativeSessionFileGzipper.java", "diffHunk": "@@ -0,0 +1,69 @@\n+// Copyright 2020 Google LLC\n+//\n+// Licensed under the Apache License, Version 2.0 (the \"License\");\n+// you may not use this file except in compliance with the License.\n+// You may obtain a copy of the License at\n+//\n+//      http://www.apache.org/licenses/LICENSE-2.0\n+//\n+// Unless required by applicable law or agreed to in writing, software\n+// distributed under the License is distributed on an \"AS IS\" BASIS,\n+// WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+// See the License for the specific language governing permissions and\n+// limitations under the License.\n+\n+package com.google.firebase.crashlytics.internal.common;\n+\n+import androidx.annotation.NonNull;\n+import androidx.annotation.Nullable;\n+import java.io.File;\n+import java.io.FileOutputStream;\n+import java.io.IOException;\n+import java.io.InputStream;\n+import java.util.List;\n+import java.util.zip.GZIPOutputStream;\n+\n+/** Copies {@link NativeSessionFile} into gzipped files within a provided path. */\n+class NativeSessionFileGzipper {\n+\n+  static void processNativeSessions(File nativeSessionDirectory, List<NativeSessionFile> streams)\n+      throws IOException {\n+\n+    for (NativeSessionFile stream : streams) {\n+      InputStream inputStream = null;\n+      try {\n+        inputStream = stream.getStream();\n+        if (inputStream == null) {\n+          continue;\n+        }\n+        gzipInputStream(inputStream, new File(nativeSessionDirectory, stream.getName()));\n+      } catch (Exception e) {\n+        // Skip invalid files.\n+      } finally {\n+        CommonUtils.closeQuietly(inputStream);\n+      }\n+    }\n+  }\n+\n+  private static void gzipInputStream(@Nullable InputStream input, @NonNull File output)\n+      throws IOException {\n+    if (input == null) {\n+      return;\n+    }\n+    byte[] buffer = new byte[1024];", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "15f091c2982ae62be7028eb2b81413bb7f90e285"}, "originalPosition": 53}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MzcyNDIxNQ==", "bodyText": "Minor stylistic request: Can we call this finalizeSessionWithNativeEvent, passing the session ID and the native files?", "url": "https://github.com/firebase/firebase-android-sdk/pull/1356#discussion_r393724215", "createdAt": "2020-03-17T14:33:38Z", "author": {"login": "mrwillis21"}, "path": "firebase-crashlytics/src/main/java/com/google/firebase/crashlytics/internal/common/SessionReportingCoordinator.java", "diffHunk": "@@ -130,6 +132,27 @@ public void persistNonFatalEvent(Throwable event, Thread thread, long timestamp)\n     persistEvent(event, thread, EVENT_TYPE_LOGGED, timestamp, false);\n   }\n \n+  public void finalizeNativeEvent(", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "15f091c2982ae62be7028eb2b81413bb7f90e285"}, "originalPosition": 18}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MzcyNDk4NQ==", "bodyText": "Same as above, can we call this finalizeSessionWithNativeEvent(sessionID, reportData, filesPayload)", "url": "https://github.com/firebase/firebase-android-sdk/pull/1356#discussion_r393724985", "createdAt": "2020-03-17T14:34:38Z", "author": {"login": "mrwillis21"}, "path": "firebase-crashlytics/src/main/java/com/google/firebase/crashlytics/internal/common/SessionReportingCoordinator.java", "diffHunk": "@@ -130,6 +132,27 @@ public void persistNonFatalEvent(Throwable event, Thread thread, long timestamp)\n     persistEvent(event, thread, EVENT_TYPE_LOGGED, timestamp, false);\n   }\n \n+  public void finalizeNativeEvent(\n+      @NonNull List<NativeSessionFile> nativeSessionFiles, String sessionId) {\n+    try {\n+      FilesPayload.Builder filesPayloadBuilder = FilesPayload.builder();\n+      ArrayList<FilesPayload.File> nativeFiles = new ArrayList<>();\n+      for (NativeSessionFile nativeSessionFile : nativeSessionFiles) {\n+        FilesPayload.File filePayload = nativeSessionFile.asFilePayload();\n+        if (filePayload != null) {\n+          nativeFiles.add(filePayload);\n+        }\n+      }\n+\n+      filesPayloadBuilder.setFiles(ImmutableList.from(nativeFiles));\n+\n+      reportPersistence.finalizeNativeEvent(", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "15f091c2982ae62be7028eb2b81413bb7f90e285"}, "originalPosition": 32}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MzcyNTQxNg==", "bodyText": "Is there any concern that we might have a situation where this is null, but session is as well?", "url": "https://github.com/firebase/firebase-android-sdk/pull/1356#discussion_r393725416", "createdAt": "2020-03-17T14:35:15Z", "author": {"login": "mrwillis21"}, "path": "firebase-crashlytics/src/main/java/com/google/firebase/crashlytics/internal/model/CrashlyticsReport.java", "diffHunk": "@@ -98,6 +97,10 @@ public static Builder builder() {\n    */\n   @NonNull\n   public CrashlyticsReport withEvents(@NonNull ImmutableList<Event> events) {\n+    if (this.getNdkPayload() != null) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "15f091c2982ae62be7028eb2b81413bb7f90e285"}, "originalPosition": 20}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "5e9fe74c3e0bcab6777b1845ceca47341b1a49e6", "author": {"user": {"login": "jakeouellette", "name": "Jake Ouellette"}}, "url": "https://github.com/firebase/firebase-android-sdk/commit/5e9fe74c3e0bcab6777b1845ceca47341b1a49e6", "committedDate": "2020-03-17T19:05:20Z", "message": "Add tests"}, "afterCommit": {"oid": "2d6252b863a367b7696a5f7e7aac03c4b0f03be5", "author": {"user": {"login": "jakeouellette", "name": "Jake Ouellette"}}, "url": "https://github.com/firebase/firebase-android-sdk/commit/2d6252b863a367b7696a5f7e7aac03c4b0f03be5", "committedDate": "2020-03-17T19:05:51Z", "message": "Add tests"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "13a9d6f012c60c70208d7a3aff2c945b4fff5036", "author": {"user": {"login": "jakeouellette", "name": "Jake Ouellette"}}, "url": "https://github.com/firebase/firebase-android-sdk/commit/13a9d6f012c60c70208d7a3aff2c945b4fff5036", "committedDate": "2020-03-17T20:56:53Z", "message": "Interleave native and non-native high priority sessions"}, "afterCommit": {"oid": "8139b0aa148b9068b7c86f7ff9f05827f3eccf6e", "author": {"user": {"login": "jakeouellette", "name": "Jake Ouellette"}}, "url": "https://github.com/firebase/firebase-android-sdk/commit/8139b0aa148b9068b7c86f7ff9f05827f3eccf6e", "committedDate": "2020-03-17T20:57:31Z", "message": "Interleave native and non-native high priority sessions"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "54ab6545c4bf0a2a52d2a79630b0b7ec9b6f79de", "author": {"user": {"login": "mrwillis21", "name": "Matt Willis"}}, "url": "https://github.com/firebase/firebase-android-sdk/commit/54ab6545c4bf0a2a52d2a79630b0b7ec9b6f79de", "committedDate": "2020-03-18T15:11:25Z", "message": "Add FilesPayload for NDK reports"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "3a1d179ddb49d2bb937bf1e25a25c266a08530fb", "author": {"user": {"login": "mrwillis21", "name": "Matt Willis"}}, "url": "https://github.com/firebase/firebase-android-sdk/commit/3a1d179ddb49d2bb937bf1e25a25c266a08530fb", "committedDate": "2020-03-18T15:11:25Z", "message": "WIP"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "9d5bc027f5675fca6cdca5d7c933095ebc009210", "author": {"user": {"login": "mrwillis21", "name": "Matt Willis"}}, "url": "https://github.com/firebase/firebase-android-sdk/commit/9d5bc027f5675fca6cdca5d7c933095ebc009210", "committedDate": "2020-03-18T15:11:25Z", "message": "Implement strategy pattern for native sessions"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "aae16420f4f23782c14ee9298ec073ce07a08cb3", "author": {"user": {"login": "mrwillis21", "name": "Matt Willis"}}, "url": "https://github.com/firebase/firebase-android-sdk/commit/aae16420f4f23782c14ee9298ec073ce07a08cb3", "committedDate": "2020-03-18T15:11:25Z", "message": "Prep for next iteration"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "84c793c03e316968bd20c0c09ae984338ff6cdb9", "author": {"user": {"login": "jakeouellette", "name": "Jake Ouellette"}}, "url": "https://github.com/firebase/firebase-android-sdk/commit/84c793c03e316968bd20c0c09ae984338ff6cdb9", "committedDate": "2020-03-18T15:11:25Z", "message": "Refactor datatransport abstractions to support polymorphic handling of session parts"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "70be19a14f940cc469e4fcb9e19be047204680b0", "author": {"user": {"login": "jakeouellette", "name": "Jake Ouellette"}}, "url": "https://github.com/firebase/firebase-android-sdk/commit/70be19a14f940cc469e4fcb9e19be047204680b0", "committedDate": "2020-03-18T15:11:25Z", "message": "Address feedback"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "867e464beb19b6fad67b7f0dd45fbf07cf388f1b", "author": {"user": {"login": "jakeouellette", "name": "Jake Ouellette"}}, "url": "https://github.com/firebase/firebase-android-sdk/commit/867e464beb19b6fad67b7f0dd45fbf07cf388f1b", "committedDate": "2020-03-18T15:11:25Z", "message": "style"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "89e196ed14647c69ed38df9a7eb3baef8dfac3c0", "author": {"user": {"login": "jakeouellette", "name": "Jake Ouellette"}}, "url": "https://github.com/firebase/firebase-android-sdk/commit/89e196ed14647c69ed38df9a7eb3baef8dfac3c0", "committedDate": "2020-03-18T15:11:25Z", "message": "remove UTF-8"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "8371820f3cf15b02ce3d71055630c9b08a206d63", "author": {"user": {"login": "jakeouellette", "name": "Jake Ouellette"}}, "url": "https://github.com/firebase/firebase-android-sdk/commit/8371820f3cf15b02ce3d71055630c9b08a206d63", "committedDate": "2020-03-18T15:11:25Z", "message": "Add test classes"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "7a76a10228271a0ae57044d552b6d7938ef5dc85", "author": {"user": {"login": "jakeouellette", "name": "Jake Ouellette"}}, "url": "https://github.com/firebase/firebase-android-sdk/commit/7a76a10228271a0ae57044d552b6d7938ef5dc85", "committedDate": "2020-03-18T15:11:25Z", "message": "Add tests"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "745cd569d9c476b9c98b785c632d74f5e8119c08", "author": {"user": {"login": "jakeouellette", "name": "Jake Ouellette"}}, "url": "https://github.com/firebase/firebase-android-sdk/commit/745cd569d9c476b9c98b785c632d74f5e8119c08", "committedDate": "2020-03-18T15:11:25Z", "message": "Add tests and serialization of ndkpayload"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "1d1610639ce521e790fa38d1154c550fe0c8a7d1", "author": {"user": {"login": "mrwillis21", "name": "Matt Willis"}}, "url": "https://github.com/firebase/firebase-android-sdk/commit/1d1610639ce521e790fa38d1154c550fe0c8a7d1", "committedDate": "2020-03-18T15:11:25Z", "message": "Add settings field for NDK sessions through DataTransport"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "d533e8bcc1d0dca81ec95d5fb186db242e922d52", "author": {"user": {"login": "jakeouellette", "name": "Jake Ouellette"}}, "url": "https://github.com/firebase/firebase-android-sdk/commit/d533e8bcc1d0dca81ec95d5fb186db242e922d52", "committedDate": "2020-03-18T15:11:25Z", "message": "Wire up settings to send procedure"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a924bb24db040740ae866a957ae5f7cdb7d89c4b", "author": {"user": {"login": "jakeouellette", "name": "Jake Ouellette"}}, "url": "https://github.com/firebase/firebase-android-sdk/commit/a924bb24db040740ae866a957ae5f7cdb7d89c4b", "committedDate": "2020-03-18T15:11:25Z", "message": "Interleave native and non-native high priority sessions"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "fcc5426d6d4e030e940021096132a12fef460b35", "author": {"user": {"login": "jakeouellette", "name": "Jake Ouellette"}}, "url": "https://github.com/firebase/firebase-android-sdk/commit/fcc5426d6d4e030e940021096132a12fef460b35", "committedDate": "2020-03-18T15:11:25Z", "message": "Add session ID abstraction to facilitate deleting NDK reports"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "9af8374b9f2fc127e914bd446356b807b5fe2e73", "author": {"user": {"login": "jakeouellette", "name": "Jake Ouellette"}}, "url": "https://github.com/firebase/firebase-android-sdk/commit/9af8374b9f2fc127e914bd446356b807b5fe2e73", "committedDate": "2020-03-17T21:31:26Z", "message": "Add session ID abstraction to facilitate deleting NDK reports"}, "afterCommit": {"oid": "fcc5426d6d4e030e940021096132a12fef460b35", "author": {"user": {"login": "jakeouellette", "name": "Jake Ouellette"}}, "url": "https://github.com/firebase/firebase-android-sdk/commit/fcc5426d6d4e030e940021096132a12fef460b35", "committedDate": "2020-03-18T15:11:25Z", "message": "Add session ID abstraction to facilitate deleting NDK reports"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "1796c160b784f9bcdf3aee34f283f83c235b83a8", "author": {"user": {"login": "jakeouellette", "name": "Jake Ouellette"}}, "url": "https://github.com/firebase/firebase-android-sdk/commit/1796c160b784f9bcdf3aee34f283f83c235b83a8", "committedDate": "2020-03-18T17:27:49Z", "message": "Add tests for session coordinator and report persistence"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "bcacb59e53266a695a4589d587fd02caa381e82f", "author": {"user": {"login": "mrwillis21", "name": "Matt Willis"}}, "url": "https://github.com/firebase/firebase-android-sdk/commit/bcacb59e53266a695a4589d587fd02caa381e82f", "committedDate": "2020-03-18T17:30:22Z", "message": "Make Firebase session ID for native sessions"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "56a4eeb2a96517c01f25c15ab61f892407124b6d", "author": {"user": {"login": "mrwillis21", "name": "Matt Willis"}}, "url": "https://github.com/firebase/firebase-android-sdk/commit/56a4eeb2a96517c01f25c15ab61f892407124b6d", "committedDate": "2020-03-18T19:30:28Z", "message": "Add support for sending/deleting native crashes based on the settings values"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzc3MTc3Mzg2", "url": "https://github.com/firebase/firebase-android-sdk/pull/1356#pullrequestreview-377177386", "createdAt": "2020-03-18T19:37:19Z", "commit": {"oid": "56a4eeb2a96517c01f25c15ab61f892407124b6d"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xOFQxOTozNzoxOVrOF4UFpw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xOFQxOTozNzoxOVrOF4UFpw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NDU5MzcwMw==", "bodyText": "Add a test here?", "url": "https://github.com/firebase/firebase-android-sdk/pull/1356#discussion_r394593703", "createdAt": "2020-03-18T19:37:19Z", "author": {"login": "mrwillis21"}, "path": "firebase-crashlytics/src/main/java/com/google/firebase/crashlytics/internal/common/DataTransportState.java", "diffHunk": "@@ -0,0 +1,46 @@\n+// Copyright 2020 Google LLC\n+//\n+// Licensed under the Apache License, Version 2.0 (the \"License\");\n+// you may not use this file except in compliance with the License.\n+// You may obtain a copy of the License at\n+//\n+//      http://www.apache.org/licenses/LICENSE-2.0\n+//\n+// Unless required by applicable law or agreed to in writing, software\n+// distributed under the License is distributed on an \"AS IS\" BASIS,\n+// WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+// See the License for the specific language governing permissions and\n+// limitations under the License.\n+\n+package com.google.firebase.crashlytics.internal.common;\n+\n+import com.google.firebase.crashlytics.internal.settings.model.AppSettingsData;\n+\n+public enum DataTransportState {\n+  NONE,\n+  JAVA_ONLY,\n+  ALL;\n+\n+  // Used to determine whether to upload reports through the legacy reports endpoint\n+  static final int REPORT_UPLOAD_VARIANT_LEGACY = 1;\n+  // Used to determine whether to upload reports through the new DataTransport API.\n+  static final int REPORT_UPLOAD_VARIANT_DATATRANSPORT = 2;\n+\n+  static DataTransportState getState(boolean dataTransportState, boolean dataTransportNativeState) {\n+    if (!dataTransportState) {\n+      return NONE;\n+    }\n+    if (!dataTransportNativeState) {\n+      return JAVA_ONLY;\n+    }\n+    return ALL;\n+  }\n+\n+  static DataTransportState getState(AppSettingsData appSettingsData) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "56a4eeb2a96517c01f25c15ab61f892407124b6d"}, "originalPosition": 39}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "75257bfd39dd76c03ef92ade5d44d212fd7e6df2", "author": {"user": {"login": "mrwillis21", "name": "Matt Willis"}}, "url": "https://github.com/firebase/firebase-android-sdk/commit/75257bfd39dd76c03ef92ade5d44d212fd7e6df2", "committedDate": "2020-03-18T19:56:48Z", "message": "Cleanup"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "21313d7ab286e22f474715cde5d957068b3f5899", "author": {"user": {"login": "jakeouellette", "name": "Jake Ouellette"}}, "url": "https://github.com/firebase/firebase-android-sdk/commit/21313d7ab286e22f474715cde5d957068b3f5899", "committedDate": "2020-03-18T19:57:35Z", "message": "Remove undone testS"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "9173669d33fc89a5ebabe9777b69d681b031188d", "author": {"user": {"login": "mrwillis21", "name": "Matt Willis"}}, "url": "https://github.com/firebase/firebase-android-sdk/commit/9173669d33fc89a5ebabe9777b69d681b031188d", "committedDate": "2020-03-18T20:59:00Z", "message": "Cleanup"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "3d231e27995766513f71a266ba4d38ca65251a03", "author": {"user": {"login": "jakeouellette", "name": "Jake Ouellette"}}, "url": "https://github.com/firebase/firebase-android-sdk/commit/3d231e27995766513f71a266ba4d38ca65251a03", "committedDate": "2020-03-18T21:25:32Z", "message": "Base ndk sessions on non-ndk sessions"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "365d77322c64e6d307c1733ff6300ab5166ed11c", "author": {"user": {"login": "jakeouellette", "name": "Jake Ouellette"}}, "url": "https://github.com/firebase/firebase-android-sdk/commit/365d77322c64e6d307c1733ff6300ab5166ed11c", "committedDate": "2020-03-19T15:46:20Z", "message": "Update paths to allow firelog to go to a different filename.\n\n- Update logs to prevent confusion around whether logs were sent"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "cba4bff7bd8abcc9cd7bbb8b0a5bcff469a8cbde", "author": {"user": {"login": "jakeouellette", "name": "Jake Ouellette"}}, "url": "https://github.com/firebase/firebase-android-sdk/commit/cba4bff7bd8abcc9cd7bbb8b0a5bcff469a8cbde", "committedDate": "2020-03-19T19:57:26Z", "message": "Make try { } catches less wide"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "8d54a9cf35e9e75e2a19b22331267b82645cac95", "author": {"user": {"login": "mrwillis21", "name": "Matt Willis"}}, "url": "https://github.com/firebase/firebase-android-sdk/commit/8d54a9cf35e9e75e2a19b22331267b82645cac95", "committedDate": "2020-03-19T20:01:13Z", "message": "Remove old withUserId method"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f2f3db36fd62ec519a5b87692d3aaf1385ddf89d", "author": {"user": {"login": "mrwillis21", "name": "Matt Willis"}}, "url": "https://github.com/firebase/firebase-android-sdk/commit/f2f3db36fd62ec519a5b87692d3aaf1385ddf89d", "committedDate": "2020-03-19T20:11:14Z", "message": "Add null check for withSessionEndFields"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "5c3f488a98c848755e2995af1489d6bbe9c663d6", "author": {"user": {"login": "mrwillis21", "name": "Matt Willis"}}, "url": "https://github.com/firebase/firebase-android-sdk/commit/5c3f488a98c848755e2995af1489d6bbe9c663d6", "committedDate": "2020-03-19T20:45:38Z", "message": "Replace builder with simpler create method"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzc4MDg1MjU5", "url": "https://github.com/firebase/firebase-android-sdk/pull/1356#pullrequestreview-378085259", "createdAt": "2020-03-19T20:53:16Z", "commit": {"oid": "5c3f488a98c848755e2995af1489d6bbe9c663d6"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2703, "cost": 1, "resetAt": "2021-11-01T14:20:25Z"}}}