{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDAyODkwNjY2", "number": 1458, "reviewThreads": {"totalCount": 5, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0xNFQwMToxNDo1MFrODxcVhw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0xNFQxNzo1NTozOVrODxwjIw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjUzMTcxMDc5OnYy", "diffSide": "RIGHT", "path": "firebase-installations/src/main/java/com/google/firebase/installations/remote/FirebaseInstallationServiceClient.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0xNFQwMToxNDo1MFrOGE6p_g==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0xNFQxNzozODoyNVrOGFZrxw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNzgwODUxMA==", "bodyText": "2 Questions:\na) Do we want to catch the IOExceptions here?\nThought process is this:\nIf an IOException is thrown during closing, do we really want to interrupt the normal process of FIS?\nb) If your answer to (a) is \"no\", could you please add a comment explaining your decision?", "url": "https://github.com/firebase/firebase-android-sdk/pull/1458#discussion_r407808510", "createdAt": "2020-04-14T01:14:50Z", "author": {"login": "andirayo"}, "path": "firebase-installations/src/main/java/com/google/firebase/installations/remote/FirebaseInstallationServiceClient.java", "diffHunk": "@@ -205,13 +205,16 @@ private void writeFIDCreateRequestBodyToOutputStream(\n \n   private static void writeRequestBodyToOutputStream(URLConnection urlConnection, byte[] jsonBytes)\n       throws IOException {\n-    try (OutputStream outputStream = urlConnection.getOutputStream()) {\n-      if (outputStream == null) {\n-        throw new IOException(\"Cannot send request to FIS servers. No OutputStream available.\");\n-      }\n-      try (GZIPOutputStream gzipOutputStream = new GZIPOutputStream(outputStream)) {\n-        gzipOutputStream.write(jsonBytes);\n-      }\n+    OutputStream outputStream = urlConnection.getOutputStream();\n+    if (outputStream == null) {\n+      throw new IOException(\"Cannot send request to FIS servers. No OutputStream available.\");\n+    }\n+    GZIPOutputStream gzipOutputStream = new GZIPOutputStream(outputStream);\n+    try {\n+      gzipOutputStream.write(jsonBytes);\n+    } finally {\n+      gzipOutputStream.close();\n+      outputStream.close();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "1b123ce745f7555a47c5f6288f7e882db1a47b6d"}, "originalPosition": 20}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwODMxNjg3MQ==", "bodyText": "Caught the exception. But, I hate these checks and code. It was so much cleaner and easy to maintain before.", "url": "https://github.com/firebase/firebase-android-sdk/pull/1458#discussion_r408316871", "createdAt": "2020-04-14T17:38:25Z", "author": {"login": "ankitaj224"}, "path": "firebase-installations/src/main/java/com/google/firebase/installations/remote/FirebaseInstallationServiceClient.java", "diffHunk": "@@ -205,13 +205,16 @@ private void writeFIDCreateRequestBodyToOutputStream(\n \n   private static void writeRequestBodyToOutputStream(URLConnection urlConnection, byte[] jsonBytes)\n       throws IOException {\n-    try (OutputStream outputStream = urlConnection.getOutputStream()) {\n-      if (outputStream == null) {\n-        throw new IOException(\"Cannot send request to FIS servers. No OutputStream available.\");\n-      }\n-      try (GZIPOutputStream gzipOutputStream = new GZIPOutputStream(outputStream)) {\n-        gzipOutputStream.write(jsonBytes);\n-      }\n+    OutputStream outputStream = urlConnection.getOutputStream();\n+    if (outputStream == null) {\n+      throw new IOException(\"Cannot send request to FIS servers. No OutputStream available.\");\n+    }\n+    GZIPOutputStream gzipOutputStream = new GZIPOutputStream(outputStream);\n+    try {\n+      gzipOutputStream.write(jsonBytes);\n+    } finally {\n+      gzipOutputStream.close();\n+      outputStream.close();", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNzgwODUxMA=="}, "originalCommit": {"oid": "1b123ce745f7555a47c5f6288f7e882db1a47b6d"}, "originalPosition": 20}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjUzMTcxMzAzOnYy", "diffSide": "RIGHT", "path": "firebase-installations/src/main/java/com/google/firebase/installations/remote/FirebaseInstallationServiceClient.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0xNFQwMToxNjoxOFrOGE6rVQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0xNFQxNzo0OTowOFrOGFaGKg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNzgwODg1Mw==", "bodyText": "This can throw an IOException, yeah?\nNot sure, but I think you should do the following:\nBuffered reader = null;\ntry {\n reader = new BufferedReader(new InputStreamReader(conn.getErrorStream(), UTF_8));", "url": "https://github.com/firebase/firebase-android-sdk/pull/1458#discussion_r407808853", "createdAt": "2020-04-14T01:16:18Z", "author": {"login": "andirayo"}, "path": "firebase-installations/src/main/java/com/google/firebase/installations/remote/FirebaseInstallationServiceClient.java", "diffHunk": "@@ -525,8 +528,8 @@ private static void logFisCommunicationError(HttpURLConnection conn) {\n   // Read the error message from the response.\n   @Nullable\n   private static String readErrorResponse(HttpURLConnection conn) {\n-    try (BufferedReader reader =\n-        new BufferedReader(new InputStreamReader(conn.getErrorStream(), UTF_8))) {\n+    BufferedReader reader = new BufferedReader(new InputStreamReader(conn.getErrorStream(), UTF_8));", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "1b123ce745f7555a47c5f6288f7e882db1a47b6d"}, "originalPosition": 30}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwODMyMzYyNg==", "bodyText": "Buffer reader creation can't. It could throw null pointer exception which is handled. PTAL.", "url": "https://github.com/firebase/firebase-android-sdk/pull/1458#discussion_r408323626", "createdAt": "2020-04-14T17:49:08Z", "author": {"login": "ankitaj224"}, "path": "firebase-installations/src/main/java/com/google/firebase/installations/remote/FirebaseInstallationServiceClient.java", "diffHunk": "@@ -525,8 +528,8 @@ private static void logFisCommunicationError(HttpURLConnection conn) {\n   // Read the error message from the response.\n   @Nullable\n   private static String readErrorResponse(HttpURLConnection conn) {\n-    try (BufferedReader reader =\n-        new BufferedReader(new InputStreamReader(conn.getErrorStream(), UTF_8))) {\n+    BufferedReader reader = new BufferedReader(new InputStreamReader(conn.getErrorStream(), UTF_8));", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNzgwODg1Mw=="}, "originalCommit": {"oid": "1b123ce745f7555a47c5f6288f7e882db1a47b6d"}, "originalPosition": 30}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjUzMTcxNDI0OnYy", "diffSide": "RIGHT", "path": "firebase-installations/src/main/java/com/google/firebase/installations/remote/FirebaseInstallationServiceClient.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0xNFQwMToxNzowMVrOGE6sEA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0xNFQwMToxNzowMVrOGE6sEA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNzgwOTA0MA==", "bodyText": "I recommend pulling the if-clause around the try-clause.", "url": "https://github.com/firebase/firebase-android-sdk/pull/1458#discussion_r407809040", "createdAt": "2020-04-14T01:17:01Z", "author": {"login": "andirayo"}, "path": "firebase-installations/src/main/java/com/google/firebase/installations/remote/FirebaseInstallationServiceClient.java", "diffHunk": "@@ -536,6 +539,14 @@ private static String readErrorResponse(HttpURLConnection conn) {\n           conn.getResponseCode(), conn.getResponseMessage(), response);\n     } catch (IOException ignored) {\n       return null;\n+    } finally {\n+      try {\n+        if (reader != null) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "1b123ce745f7555a47c5f6288f7e882db1a47b6d"}, "originalPosition": 41}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjUzNTAxMjYxOnYy", "diffSide": "RIGHT", "path": "firebase-installations/src/main/java/com/google/firebase/installations/remote/FirebaseInstallationServiceClient.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0xNFQxNzo1MzowNlrOGFaQCA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0xNFQxODowMzoxOFrOGFapEw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwODMyNjE1Mg==", "bodyText": "Probably an unrelated question, feel free to just acknowledge:\nCan this ever be NULL, similar to outputStream above?\nProbably not, huh?", "url": "https://github.com/firebase/firebase-android-sdk/pull/1458#discussion_r408326152", "createdAt": "2020-04-14T17:53:06Z", "author": {"login": "andirayo"}, "path": "firebase-installations/src/main/java/com/google/firebase/installations/remote/FirebaseInstallationServiceClient.java", "diffHunk": "@@ -205,12 +205,19 @@ private void writeFIDCreateRequestBodyToOutputStream(\n \n   private static void writeRequestBodyToOutputStream(URLConnection urlConnection, byte[] jsonBytes)\n       throws IOException {\n-    try (OutputStream outputStream = urlConnection.getOutputStream()) {\n-      if (outputStream == null) {\n-        throw new IOException(\"Cannot send request to FIS servers. No OutputStream available.\");\n-      }\n-      try (GZIPOutputStream gzipOutputStream = new GZIPOutputStream(outputStream)) {\n-        gzipOutputStream.write(jsonBytes);\n+    OutputStream outputStream = urlConnection.getOutputStream();\n+    if (outputStream == null) {\n+      throw new IOException(\"Cannot send request to FIS servers. No OutputStream available.\");\n+    }\n+    GZIPOutputStream gzipOutputStream = new GZIPOutputStream(outputStream);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d7a81975fe28d521138a8a4905c7b7f7ad775bb3"}, "originalPosition": 14}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwODMzMjU2Mw==", "bodyText": "It cant be null. I validated that. It throw NPE or returns a valid GzipOutputStream.", "url": "https://github.com/firebase/firebase-android-sdk/pull/1458#discussion_r408332563", "createdAt": "2020-04-14T18:03:18Z", "author": {"login": "ankitaj224"}, "path": "firebase-installations/src/main/java/com/google/firebase/installations/remote/FirebaseInstallationServiceClient.java", "diffHunk": "@@ -205,12 +205,19 @@ private void writeFIDCreateRequestBodyToOutputStream(\n \n   private static void writeRequestBodyToOutputStream(URLConnection urlConnection, byte[] jsonBytes)\n       throws IOException {\n-    try (OutputStream outputStream = urlConnection.getOutputStream()) {\n-      if (outputStream == null) {\n-        throw new IOException(\"Cannot send request to FIS servers. No OutputStream available.\");\n-      }\n-      try (GZIPOutputStream gzipOutputStream = new GZIPOutputStream(outputStream)) {\n-        gzipOutputStream.write(jsonBytes);\n+    OutputStream outputStream = urlConnection.getOutputStream();\n+    if (outputStream == null) {\n+      throw new IOException(\"Cannot send request to FIS servers. No OutputStream available.\");\n+    }\n+    GZIPOutputStream gzipOutputStream = new GZIPOutputStream(outputStream);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwODMyNjE1Mg=="}, "originalCommit": {"oid": "d7a81975fe28d521138a8a4905c7b7f7ad775bb3"}, "originalPosition": 14}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjUzNTAyMjQzOnYy", "diffSide": "RIGHT", "path": "firebase-installations/src/main/java/com/google/firebase/installations/remote/FirebaseInstallationServiceClient.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0xNFQxNzo1NTozOVrOGFaWVQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0xNFQxNzo1NTozOVrOGFaWVQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwODMyNzc2NQ==", "bodyText": "nice!", "url": "https://github.com/firebase/firebase-android-sdk/pull/1458#discussion_r408327765", "createdAt": "2020-04-14T17:55:39Z", "author": {"login": "andirayo"}, "path": "firebase-installations/src/main/java/com/google/firebase/installations/remote/FirebaseInstallationServiceClient.java", "diffHunk": "@@ -525,8 +532,12 @@ private static void logFisCommunicationError(HttpURLConnection conn) {\n   // Read the error message from the response.\n   @Nullable\n   private static String readErrorResponse(HttpURLConnection conn) {\n-    try (BufferedReader reader =\n-        new BufferedReader(new InputStreamReader(conn.getErrorStream(), UTF_8))) {\n+    InputStream errorStream = conn.getErrorStream();\n+    if (errorStream == null) {\n+      return null;\n+    }", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d7a81975fe28d521138a8a4905c7b7f7ad775bb3"}, "originalPosition": 35}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1297, "cost": 1, "resetAt": "2021-11-12T18:49:56Z"}}}