{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTMzOTM3NzUz", "number": 2236, "reviewThreads": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0wN1QyMjoyMToxOFrOFCBCSQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0wN1QyMjoyMjoyNlrOFCBEgg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzM3NjU4NDQxOnYy", "diffSide": "RIGHT", "path": "firebase-ml-modeldownloader/src/main/java/com/google/firebase/ml/modeldownloader/FirebaseModelDownloader.java", "isResolved": true, "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0wN1QyMjoyMToxOFrOIA9aWw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0wOVQwMjoyNTo1NVrOIB_Q6g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNzg3NzA4Mw==", "bodyText": "In case the app crashes, or the phone dies, after models have been deleted but before their details have been removed from sharedPreferences, what would happen?", "url": "https://github.com/firebase/firebase-android-sdk/pull/2236#discussion_r537877083", "createdAt": "2020-12-07T22:21:18Z", "author": {"login": "rlazo"}, "path": "firebase-ml-modeldownloader/src/main/java/com/google/firebase/ml/modeldownloader/FirebaseModelDownloader.java", "diffHunk": "@@ -187,7 +192,16 @@ public static FirebaseModelDownloader getInstance(@NonNull FirebaseApp app) {\n    */\n   @NonNull\n   public Task<Void> deleteDownloadedModel(@NonNull String modelName) {\n-    throw new UnsupportedOperationException(\"Not yet implemented.\");\n+\n+    TaskCompletionSource<Void> taskCompletionSource = new TaskCompletionSource<>();\n+    executor.execute(\n+        () -> {\n+          // remove all files associated with this model and then clean up model references.\n+          fileManager.deleteAllModels(modelName);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f18a918759eaadb8abe258587f26722295a0ddfd"}, "originalPosition": 50}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzODgyNDI2NQ==", "bodyText": "The model would be listed but when they tried to get the file it would return null... I think this is acceptable. I did update the getFile to handle this case a little more cleanly. If you can think of a better solution. I'm open to suggestions. I've also made a bug b/175144342 to add a start-up routine that will check that models with filePaths actually point to files and will clean them up if they don't.", "url": "https://github.com/firebase/firebase-android-sdk/pull/2236#discussion_r538824265", "createdAt": "2020-12-08T21:34:34Z", "author": {"login": "annzimmer"}, "path": "firebase-ml-modeldownloader/src/main/java/com/google/firebase/ml/modeldownloader/FirebaseModelDownloader.java", "diffHunk": "@@ -187,7 +192,16 @@ public static FirebaseModelDownloader getInstance(@NonNull FirebaseApp app) {\n    */\n   @NonNull\n   public Task<Void> deleteDownloadedModel(@NonNull String modelName) {\n-    throw new UnsupportedOperationException(\"Not yet implemented.\");\n+\n+    TaskCompletionSource<Void> taskCompletionSource = new TaskCompletionSource<>();\n+    executor.execute(\n+        () -> {\n+          // remove all files associated with this model and then clean up model references.\n+          fileManager.deleteAllModels(modelName);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNzg3NzA4Mw=="}, "originalCommit": {"oid": "f18a918759eaadb8abe258587f26722295a0ddfd"}, "originalPosition": 50}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzODk1NjAxMA==", "bodyText": "LGTM", "url": "https://github.com/firebase/firebase-android-sdk/pull/2236#discussion_r538956010", "createdAt": "2020-12-09T02:25:55Z", "author": {"login": "rlazo"}, "path": "firebase-ml-modeldownloader/src/main/java/com/google/firebase/ml/modeldownloader/FirebaseModelDownloader.java", "diffHunk": "@@ -187,7 +192,16 @@ public static FirebaseModelDownloader getInstance(@NonNull FirebaseApp app) {\n    */\n   @NonNull\n   public Task<Void> deleteDownloadedModel(@NonNull String modelName) {\n-    throw new UnsupportedOperationException(\"Not yet implemented.\");\n+\n+    TaskCompletionSource<Void> taskCompletionSource = new TaskCompletionSource<>();\n+    executor.execute(\n+        () -> {\n+          // remove all files associated with this model and then clean up model references.\n+          fileManager.deleteAllModels(modelName);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNzg3NzA4Mw=="}, "originalCommit": {"oid": "f18a918759eaadb8abe258587f26722295a0ddfd"}, "originalPosition": 50}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzM3NjU5MDEwOnYy", "diffSide": "RIGHT", "path": "firebase-ml-modeldownloader/src/main/java/com/google/firebase/ml/modeldownloader/internal/ModelFileManager.java", "isResolved": false, "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0wN1QyMjoyMjoyNlrOIA9dZQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0wOVQwMjoyNjo0NFrOIB_SLA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNzg3Nzg2MQ==", "bodyText": "Intentional?", "url": "https://github.com/firebase/firebase-android-sdk/pull/2236#discussion_r537877861", "createdAt": "2020-12-07T22:22:26Z", "author": {"login": "rlazo"}, "path": "firebase-ml-modeldownloader/src/main/java/com/google/firebase/ml/modeldownloader/internal/ModelFileManager.java", "diffHunk": "@@ -118,6 +126,21 @@ private int getLatestCachedModelVersion(@NonNull File modelDir) {\n   @Nullable\n   File getModelFileDestination(@NonNull CustomModel model) throws Exception {\n     File destFolder = getDirImpl(model.getName());\n+    if (!destFolder.exists()) {\n+      Log.d(TAG, \"model folder does not exist, creating one: \" + destFolder.getAbsolutePath());\n+      if (!destFolder.mkdirs()) {\n+        System.out.println(\"Failed to create model folder\" + destFolder);\n+        //        throw new FirebaseMLException(", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f18a918759eaadb8abe258587f26722295a0ddfd"}, "originalPosition": 38}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzODgyNDMyMA==", "bodyText": "yes - the logging which will be the commented out lines is currently being tested. Almost there.", "url": "https://github.com/firebase/firebase-android-sdk/pull/2236#discussion_r538824320", "createdAt": "2020-12-08T21:34:39Z", "author": {"login": "annzimmer"}, "path": "firebase-ml-modeldownloader/src/main/java/com/google/firebase/ml/modeldownloader/internal/ModelFileManager.java", "diffHunk": "@@ -118,6 +126,21 @@ private int getLatestCachedModelVersion(@NonNull File modelDir) {\n   @Nullable\n   File getModelFileDestination(@NonNull CustomModel model) throws Exception {\n     File destFolder = getDirImpl(model.getName());\n+    if (!destFolder.exists()) {\n+      Log.d(TAG, \"model folder does not exist, creating one: \" + destFolder.getAbsolutePath());\n+      if (!destFolder.mkdirs()) {\n+        System.out.println(\"Failed to create model folder\" + destFolder);\n+        //        throw new FirebaseMLException(", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNzg3Nzg2MQ=="}, "originalCommit": {"oid": "f18a918759eaadb8abe258587f26722295a0ddfd"}, "originalPosition": 38}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzODk1NjMzMg==", "bodyText": "Sure. Ping me when they're done so I can do a last review before granting approval. Thanks!", "url": "https://github.com/firebase/firebase-android-sdk/pull/2236#discussion_r538956332", "createdAt": "2020-12-09T02:26:44Z", "author": {"login": "rlazo"}, "path": "firebase-ml-modeldownloader/src/main/java/com/google/firebase/ml/modeldownloader/internal/ModelFileManager.java", "diffHunk": "@@ -118,6 +126,21 @@ private int getLatestCachedModelVersion(@NonNull File modelDir) {\n   @Nullable\n   File getModelFileDestination(@NonNull CustomModel model) throws Exception {\n     File destFolder = getDirImpl(model.getName());\n+    if (!destFolder.exists()) {\n+      Log.d(TAG, \"model folder does not exist, creating one: \" + destFolder.getAbsolutePath());\n+      if (!destFolder.mkdirs()) {\n+        System.out.println(\"Failed to create model folder\" + destFolder);\n+        //        throw new FirebaseMLException(", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNzg3Nzg2MQ=="}, "originalCommit": {"oid": "f18a918759eaadb8abe258587f26722295a0ddfd"}, "originalPosition": 38}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1027, "cost": 1, "resetAt": "2021-11-12T18:49:56Z"}}}