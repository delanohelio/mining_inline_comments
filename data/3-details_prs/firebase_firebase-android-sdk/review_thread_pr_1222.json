{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0MzcyNDk4ODYz", "number": 1222, "reviewThreads": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0wN1QxNzoxODo1NVrODeF8qg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0wN1QxNzoyMDoyOFrODeF-SQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjMyODgxMzIyOnYy", "diffSide": "RIGHT", "path": "firebase-firestore/src/main/java/com/google/firebase/firestore/UserDataWriter.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0wN1QxNzoxODo1NVrOFnETRg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0wN1QxODoyMjoxMFrOFnF95A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NjUwOTI1NA==", "bodyText": "The Java style guide suggests to use braces even for one line statements: https://engdoc.corp.google.com/eng/doc/devguide/java/style/index.md?cl=head#s4.1-braces", "url": "https://github.com/firebase/firebase-android-sdk/pull/1222#discussion_r376509254", "createdAt": "2020-02-07T17:18:55Z", "author": {"login": "schmidt-sebastian"}, "path": "firebase-firestore/src/main/java/com/google/firebase/firestore/UserDataWriter.java", "diffHunk": "@@ -90,14 +92,14 @@ Object convertValue(Value value) {\n     return result;\n   }\n \n-  private Object convertServerTimestamp(ServerTimestampValue value) {\n+  private Object convertServerTimestamp(Value serverTimestampValue) {\n     switch (serverTimestampBehavior) {\n       case PREVIOUS:\n-        return value.getPreviousValue() == null ? null : convertValue(value.getPreviousValue());\n+        Value previousValue = getPreviousValue(serverTimestampValue);\n+        if (previousValue == null) return null;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f4f26c45881194d5e3aa3daba8187e3961fed7e9"}, "originalPosition": 38}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NjUzNjU0OA==", "bodyText": "Fixed. It's lame that Java and C++ don't align on this point.", "url": "https://github.com/firebase/firebase-android-sdk/pull/1222#discussion_r376536548", "createdAt": "2020-02-07T18:22:10Z", "author": {"login": "wilhuff"}, "path": "firebase-firestore/src/main/java/com/google/firebase/firestore/UserDataWriter.java", "diffHunk": "@@ -90,14 +92,14 @@ Object convertValue(Value value) {\n     return result;\n   }\n \n-  private Object convertServerTimestamp(ServerTimestampValue value) {\n+  private Object convertServerTimestamp(Value serverTimestampValue) {\n     switch (serverTimestampBehavior) {\n       case PREVIOUS:\n-        return value.getPreviousValue() == null ? null : convertValue(value.getPreviousValue());\n+        Value previousValue = getPreviousValue(serverTimestampValue);\n+        if (previousValue == null) return null;", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NjUwOTI1NA=="}, "originalCommit": {"oid": "f4f26c45881194d5e3aa3daba8187e3961fed7e9"}, "originalPosition": 38}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjMyODgxNzM3OnYy", "diffSide": "RIGHT", "path": "firebase-firestore/src/main/java/com/google/firebase/firestore/UserDataWriter.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0wN1QxNzoyMDoyOFrOFnEV-Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0wN1QxNzoyMDoyOFrOFnEV-Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NjUwOTk0NQ==", "bodyText": ":) Much better.", "url": "https://github.com/firebase/firebase-android-sdk/pull/1222#discussion_r376509945", "createdAt": "2020-02-07T17:20:28Z", "author": {"login": "schmidt-sebastian"}, "path": "firebase-firestore/src/main/java/com/google/firebase/firestore/UserDataWriter.java", "diffHunk": "@@ -90,14 +92,14 @@ Object convertValue(Value value) {\n     return result;\n   }\n \n-  private Object convertServerTimestamp(ServerTimestampValue value) {\n+  private Object convertServerTimestamp(Value serverTimestampValue) {\n     switch (serverTimestampBehavior) {\n       case PREVIOUS:\n-        return value.getPreviousValue() == null ? null : convertValue(value.getPreviousValue());\n+        Value previousValue = getPreviousValue(serverTimestampValue);\n+        if (previousValue == null) return null;\n+        return convertValue(previousValue);\n       case ESTIMATE:\n-        return !timestampsInSnapshots\n-            ? value.getLocalWriteTime().toDate()\n-            : value.getLocalWriteTime();\n+        return convertTimestamp(getLocalWriteTime(serverTimestampValue));", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f4f26c45881194d5e3aa3daba8187e3961fed7e9"}, "originalPosition": 44}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 753, "cost": 1, "resetAt": "2021-11-12T18:49:56Z"}}}