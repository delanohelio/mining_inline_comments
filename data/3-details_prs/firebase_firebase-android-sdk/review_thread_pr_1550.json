{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDE2Mzg1NzAx", "number": 1550, "reviewThreads": {"totalCount": 5, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xMlQxNzozMzo1NVrOD7wTiA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xMlQxOToyMDo0OFrOD7yqrQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjYzOTg0MDA4OnYy", "diffSide": "RIGHT", "path": "firebase-inappmessaging-display/src/main/java/com/google/firebase/inappmessaging/display/FirebaseInAppMessagingDisplay.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xMlQxNzozMzo1NVrOGURivQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xMlQxNzozMzo1NVrOGURivQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMzkxMjEyNQ==", "bodyText": "Can we add some comments on why we need to bind when this condition is true?", "url": "https://github.com/firebase/firebase-android-sdk/pull/1550#discussion_r423912125", "createdAt": "2020-05-12T17:33:55Z", "author": {"login": "prakhar1989"}, "path": "firebase-inappmessaging-display/src/main/java/com/google/firebase/inappmessaging/display/FirebaseInAppMessagingDisplay.java", "diffHunk": "@@ -236,11 +221,42 @@ public void onActivityDestroyed(Activity activity) {\n   @Override\n   public void onActivityResumed(Activity activity) {\n     super.onActivityResumed(activity);\n+    bindFiamToActivity(activity);\n+  }\n+\n+  private void bindFiamToActivity(Activity activity) {\n+    if (!currentActivityName.equals(activity.getLocalClassName())) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "9cc749c622e5bb4320a41a7139e7f84f033987a6"}, "originalPosition": 63}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjYzOTg0NDk2OnYy", "diffSide": "RIGHT", "path": "firebase-inappmessaging-display/src/main/java/com/google/firebase/inappmessaging/display/FirebaseInAppMessagingDisplay.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xMlQxNzozNTowOVrOGURl0A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xMlQxNzozNTowOVrOGURl0A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMzkxMjkxMg==", "bodyText": "Should we set this to null and add @Nullable annotation on this variable? I think an empty name can be error prone", "url": "https://github.com/firebase/firebase-android-sdk/pull/1550#discussion_r423912912", "createdAt": "2020-05-12T17:35:09Z", "author": {"login": "prakhar1989"}, "path": "firebase-inappmessaging-display/src/main/java/com/google/firebase/inappmessaging/display/FirebaseInAppMessagingDisplay.java", "diffHunk": "@@ -236,11 +221,42 @@ public void onActivityDestroyed(Activity activity) {\n   @Override\n   public void onActivityResumed(Activity activity) {\n     super.onActivityResumed(activity);\n+    bindFiamToActivity(activity);\n+  }\n+\n+  private void bindFiamToActivity(Activity activity) {\n+    if (!currentActivityName.equals(activity.getLocalClassName())) {\n+      Logging.logi(\"Binding to activity: \" + activity.getLocalClassName());\n+      headlessInAppMessaging.setMessageDisplayComponent(\n+          (iam, cb) -> {\n+            // When we are in the middle of showing a message, we ignore other notifications these\n+            // messages will be fired when the corresponding events happen the next time.\n+            if (inAppMessage != null || headlessInAppMessaging.areMessagesSuppressed()) {\n+              Logging.logd(\"Active FIAM exists. Skipping trigger\");\n+              return;\n+            }\n+            inAppMessage = iam;\n+            callbacks = cb;\n+            showActiveFiam(activity);\n+          });\n+      // set the current activity to be the one passed in\n+      currentActivityName = activity.getLocalClassName();\n+    }\n     if (inAppMessage != null) {\n       showActiveFiam(activity);\n     }\n   }\n \n+  private void unbindFiamFromActivity(Activity activity) {\n+    if (currentActivityName.equals(activity.getLocalClassName())) {\n+      Logging.logi(\"Unbinding from activity: \" + activity.getLocalClassName());\n+      headlessInAppMessaging.clearDisplayListener();\n+      imageLoader.cancelTag(activity.getClass());\n+      removeDisplayedFiam(activity);\n+      currentActivityName = \"\";", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "9cc749c622e5bb4320a41a7139e7f84f033987a6"}, "originalPosition": 91}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjYzOTg0NTkzOnYy", "diffSide": "RIGHT", "path": "firebase-inappmessaging-display/src/main/java/com/google/firebase/inappmessaging/display/FirebaseInAppMessagingDisplay.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xMlQxNzozNToyNlrOGURmdw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xMlQxNzozNToyNlrOGURmdw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMzkxMzA3OQ==", "bodyText": "nice ;)", "url": "https://github.com/firebase/firebase-android-sdk/pull/1550#discussion_r423913079", "createdAt": "2020-05-12T17:35:26Z", "author": {"login": "prakhar1989"}, "path": "firebase-inappmessaging-display/src/main/java/com/google/firebase/inappmessaging/display/FirebaseInAppMessagingDisplay.java", "diffHunk": "@@ -318,8 +334,7 @@ public void onClick(View v) {\n \n     Map<Action, View.OnClickListener> actionListeners = new HashMap<>();\n     // If the message has an action, but not an action url, we dismiss when the action\n-    // button is\n-    // clicked;\n+    // button is clicked", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "9cc749c622e5bb4320a41a7139e7f84f033987a6"}, "originalPosition": 104}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjY0MDIyMjY2OnYy", "diffSide": "RIGHT", "path": "firebase-inappmessaging-display/src/main/java/com/google/firebase/inappmessaging/display/FirebaseInAppMessagingDisplay.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xMlQxOToxOTo0NFrOGUVZBQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xMlQxOToxOTo0NFrOGUVZBQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMzk3NTE3Mw==", "bodyText": "why do we need to bind from activity onstart and onresume? can't we just limit it to one place onResume?", "url": "https://github.com/firebase/firebase-android-sdk/pull/1550#discussion_r423975173", "createdAt": "2020-05-12T19:19:44Z", "author": {"login": "eldhosembabu"}, "path": "firebase-inappmessaging-display/src/main/java/com/google/firebase/inappmessaging/display/FirebaseInAppMessagingDisplay.java", "diffHunk": "@@ -182,19 +184,7 @@ public void clearFiamListener() {\n   @Override\n   public void onActivityStarted(final Activity activity) {\n     super.onActivityStarted(activity);\n-    // Register FIAM listener with the headless sdk.\n-    headlessInAppMessaging.setMessageDisplayComponent(\n-        (iam, cb) -> {\n-          // When we are in the middle of showing a message, we ignore other notifications these\n-          // messages will be fired when the corresponding events happen the next time.\n-          if (inAppMessage != null || headlessInAppMessaging.areMessagesSuppressed()) {\n-            Logging.logd(\"Active FIAM exists. Skipping trigger\");\n-            return;\n-          }\n-          inAppMessage = iam;\n-          callbacks = cb;\n-          showActiveFiam(activity);\n-        });\n+    bindFiamToActivity(activity);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b8aaa5508c1108a273009cae0a22b92c4a8856c2"}, "originalPosition": 26}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjY0MDIyNzAxOnYy", "diffSide": "RIGHT", "path": "firebase-inappmessaging-display/src/main/java/com/google/firebase/inappmessaging/display/FirebaseInAppMessagingDisplay.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xMlQxOToyMDo0OFrOGUVbsw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xMlQxOToyMDo0OFrOGUVbsw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMzk3NTg1OQ==", "bodyText": "Similar to bind call, can we limit the unbind to a single place rather than having in onPause and onDestroy?", "url": "https://github.com/firebase/firebase-android-sdk/pull/1550#discussion_r423975859", "createdAt": "2020-05-12T19:20:48Z", "author": {"login": "eldhosembabu"}, "path": "firebase-inappmessaging-display/src/main/java/com/google/firebase/inappmessaging/display/FirebaseInAppMessagingDisplay.java", "diffHunk": "@@ -205,10 +195,7 @@ public void onActivityStarted(final Activity activity) {\n   @Keep\n   @Override\n   public void onActivityPaused(Activity activity) {\n-    // clear all state scoped to activity and dismiss fiam\n-    headlessInAppMessaging.clearDisplayListener();\n-    imageLoader.cancelTag(activity.getClass());\n-    removeDisplayedFiam(activity);\n+    unbindFiamFromActivity(activity);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b8aaa5508c1108a273009cae0a22b92c4a8856c2"}, "originalPosition": 38}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1354, "cost": 1, "resetAt": "2021-11-12T18:49:56Z"}}}