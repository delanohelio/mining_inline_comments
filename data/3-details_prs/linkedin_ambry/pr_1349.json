{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0MzU5MDc4ODIy", "number": 1349, "title": "Make writable partition selection account for partitions with more than 3 replicas", "bodyText": "Currently, selecting writable partition for PUT operation only picks partitions with highest local replica count. This will become a problem when \"move replica\" is rolled out. In the intermediate state of \"move replica\", particular partition may have 6 replicas and if we stick with current logic. All the write traffic will be routed to this particular partition. Hence, this PR we make changes to allow partition selection to pick partitions with replicas count >= min replica count(specified in\nClusterMapConfig). In most cases, min replica count = 3.", "createdAt": "2020-01-03T18:25:53Z", "url": "https://github.com/linkedin/ambry/pull/1349", "merged": true, "mergeCommit": {"oid": "fcdfca8ff172886c10db52557af507297fbd8a30"}, "closed": true, "closedAt": "2020-01-23T23:55:18Z", "author": {"login": "jsjtzyy"}, "timelineItems": {"totalCount": 6, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABb2ymabgH2gAyMzU5MDc4ODIyOmFjOGU4NWI2NzJiMDg4YzIxMDJmODc2YjdhMjczYmNlMDU5NmVkNzI=", "endCursor": "Y3Vyc29yOnYyOpPPAAABb9SecNgH2gAyMzU5MDc4ODIyOmYxYWMwNWY0NzlhODgyNDUxMzYxOWRmMDgyZWE5MmI3OGQ2NjZhM2I=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "ac8e85b672b088c2102f876b7a273bce0596ed72", "author": {"user": {"login": "jsjtzyy", "name": "Yingyi Zhang"}}, "url": "https://github.com/linkedin/ambry/commit/ac8e85b672b088c2102f876b7a273bce0596ed72", "committedDate": "2020-01-03T18:24:03Z", "message": "WIP: Make writable partiton selection account for partitions with more than 3 replicas\n\nCurrently, selecting writable partiton for PUT operation only picks\npartitions with highest local replica count. This will become a problem\nwhen \"move replica\" is rolled out. In the intermediate state of \"move\nreplica\", particular partion may have 6 replicas and if we stick with\ncurrent logic. All the write traffic will be routed to this particular\npartition. Hence, this PR we make changes to allow partition selection\nto pick partitons with replicas count >= min replica count(specified in\nClusterMapConfig). In most cases, min replica count = 3."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b7a4a403394f7691448d8eb94af52467fd256b6d", "author": {"user": {"login": "jsjtzyy", "name": "Yingyi Zhang"}}, "url": "https://github.com/linkedin/ambry/commit/b7a4a403394f7691448d8eb94af52467fd256b6d", "committedDate": "2020-01-03T20:07:20Z", "message": "fixed test failure"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "5f926287785dac067a6ad09522c6a89c6a343e7f", "author": {"user": {"login": "jsjtzyy", "name": "Yingyi Zhang"}}, "url": "https://github.com/linkedin/ambry/commit/5f926287785dac067a6ad09522c6a89c6a343e7f", "committedDate": "2020-01-03T23:36:00Z", "message": "minor fix for integration test failure"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "1f6310164af708b4e9ecedababec72c5c73a603e", "author": {"user": {"login": "jsjtzyy", "name": "Yingyi Zhang"}}, "url": "https://github.com/linkedin/ambry/commit/1f6310164af708b4e9ecedababec72c5c73a603e", "committedDate": "2020-01-04T18:16:52Z", "message": "added one more unit test"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzQ3NjU1NzY2", "url": "https://github.com/linkedin/ambry/pull/1349#pullrequestreview-347655766", "createdAt": "2020-01-23T22:37:51Z", "commit": {"oid": "1f6310164af708b4e9ecedababec72c5c73a603e"}, "state": "APPROVED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0yM1QyMjozNzo1MVrOFhO8_w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0yM1QyMjozNzo1MVrOFhO8_w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MDM5MjMxOQ==", "bodyText": "Minor: might need formatting.", "url": "https://github.com/linkedin/ambry/pull/1349#discussion_r370392319", "createdAt": "2020-01-23T22:37:51Z", "author": {"login": "lightningrob"}, "path": "ambry-api/src/main/java/com.github.ambry/config/ClusterMapConfig.java", "diffHunk": "@@ -261,5 +269,6 @@ public ClusterMapConfig(VerifiableProperties verifiableProperties) {\n         verifiableProperties.getLongInRange(\"clustermap.replica.catchup.acceptable.lag.bytes\", 0L, 0L, Long.MAX_VALUE);\n     clustermapReplicaCatchupTarget =\n         verifiableProperties.getIntInRange(\"clustermap.replica.catchup.target\", 0, 0, Integer.MAX_VALUE);\n+    clustermapWritablePartitionMinReplicaCount = verifiableProperties.getIntInRange(\"clustermap.writable.partition.min.replica.count\", 3, 0, Integer.MAX_VALUE);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "1f6310164af708b4e9ecedababec72c5c73a603e"}, "originalPosition": 19}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f1ac05f479a8824513619df082ea92b78d666a3b", "author": {"user": {"login": "jsjtzyy", "name": "Yingyi Zhang"}}, "url": "https://github.com/linkedin/ambry/commit/f1ac05f479a8824513619df082ea92b78d666a3b", "committedDate": "2020-01-23T22:55:51Z", "message": "comment"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1525, "cost": 1, "resetAt": "2021-11-01T16:19:10Z"}}}