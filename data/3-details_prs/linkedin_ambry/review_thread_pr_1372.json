{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0MzcxMDMwMjk5", "number": 1372, "reviewThreads": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0wN1QwMToyODo1OVrODd4uAQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0wN1QwMTozNTozNVrODd4yDA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjMyNjY0NTc3OnYy", "diffSide": "RIGHT", "path": "ambry-rest/src/main/java/com.github.ambry.rest/NettyResponseChannel.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0wN1QwMToyODo1OVrOFmvxjQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0wN1QwMToyODo1OVrOFmvxjQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NjE3Mjk0MQ==", "bodyText": "\"; method=\" and say uri=request.getUri() to match the other key value pairs", "url": "https://github.com/linkedin/ambry/pull/1372#discussion_r376172941", "createdAt": "2020-02-07T01:28:59Z", "author": {"login": "cgtz"}, "path": "ambry-rest/src/main/java/com.github.ambry.rest/NettyResponseChannel.java", "diffHunk": "@@ -369,10 +369,37 @@ private void evaluatePerformanceAndUpdateMetrics() {\n         .checkThresholds(requestPerfToCheck))) {\n       // this means either response is 5xx or request missed one of thresholds, the request should be unsatisfied\n       restRequestMetricsTracker.markUnsatisfied();\n+      logUnsatisfiedRequest(requestPerfToCheck);\n     }\n     restRequestMetricsTracker.recordMetrics();\n   }\n \n+  /**\n+   * Log unsatisfied request (print out request/response info and performance indices)\n+   * @param requestPerfToCheck the performance indices associated with this request.\n+   */\n+  private void logUnsatisfiedRequest(Map<PerformanceIndex, Long> requestPerfToCheck) {\n+    StringBuilder sb = new StringBuilder();\n+    sb.append(\"Unsatisfied request: \").append(request.getUri()).append(\"  method=\").append(request.getRestMethod());", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f3a26286a7117a62c71f7cd04cc5333d7ee500e1"}, "originalPosition": 15}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjMyNjY1NjEyOnYy", "diffSide": "RIGHT", "path": "ambry-rest/src/main/java/com.github.ambry.rest/NettyResponseChannel.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0wN1QwMTozNTozNVrOFmv3kA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0wN1QwMTozNTozNVrOFmv3kA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NjE3NDQ4MA==", "bodyText": "change \": \" to \"=\" to match other key value pairs", "url": "https://github.com/linkedin/ambry/pull/1372#discussion_r376174480", "createdAt": "2020-02-07T01:35:35Z", "author": {"login": "cgtz"}, "path": "ambry-rest/src/main/java/com.github.ambry.rest/NettyResponseChannel.java", "diffHunk": "@@ -369,10 +369,37 @@ private void evaluatePerformanceAndUpdateMetrics() {\n         .checkThresholds(requestPerfToCheck))) {\n       // this means either response is 5xx or request missed one of thresholds, the request should be unsatisfied\n       restRequestMetricsTracker.markUnsatisfied();\n+      logUnsatisfiedRequest(requestPerfToCheck);\n     }\n     restRequestMetricsTracker.recordMetrics();\n   }\n \n+  /**\n+   * Log unsatisfied request (print out request/response info and performance indices)\n+   * @param requestPerfToCheck the performance indices associated with this request.\n+   */\n+  private void logUnsatisfiedRequest(Map<PerformanceIndex, Long> requestPerfToCheck) {\n+    StringBuilder sb = new StringBuilder();\n+    sb.append(\"Unsatisfied request: \").append(request.getUri()).append(\"  method=\").append(request.getRestMethod());\n+    if (request.getRestMethod() == RestMethod.POST) {\n+      sb.append(\"; location=\").append((String) getHeader(RestUtils.Headers.LOCATION));\n+    }\n+    sb.append(\"; status=\").append(responseStatus.getStatusCode());\n+    Object blobSize = getHeader(RestUtils.Headers.BLOB_SIZE);\n+    if (blobSize != null) {\n+      sb.append(\"; blob size=\").append((String) blobSize);\n+    }\n+    for (Map.Entry<PerformanceIndex, Long> entry : requestPerfToCheck.entrySet()) {\n+      sb.append(\"; \").append(entry.getKey().toString()).append(\": \").append(entry.getValue());", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f3a26286a7117a62c71f7cd04cc5333d7ee500e1"}, "originalPosition": 25}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1682, "cost": 1, "resetAt": "2021-11-12T20:44:06Z"}}}