{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDE0OTU2MTI1", "number": 1513, "title": "Return lifeVersion from get request", "bodyText": "Returning life version in the get request. LifeVersion is a piece of information that would further verify the success of an undelete operation. Since for now undelete doesn't return the lifeVersion, we should expose a way to get the lifeVersion before and after undelete. There is no better way than a get.\nI plan in the closed source code, to not return lifeVersion when the client is not internal client. And maybe we should return the revised lifeVersion to the client in an undelete response.", "createdAt": "2020-05-07T22:42:34Z", "url": "https://github.com/linkedin/ambry/pull/1513", "merged": true, "mergeCommit": {"oid": "36b2d5b6aa4265ec3a7b450dc633059160ac68d3"}, "closed": true, "closedAt": "2020-05-19T00:18:47Z", "author": {"login": "justinlin-linkedin"}, "timelineItems": {"totalCount": 8, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcgT4kzgFqTQwOTQxNTQ3NA==", "endCursor": "Y3Vyc29yOnYyOpPPAAABcinzJKAFqTQxMzk4NTQzMw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDA5NDE1NDc0", "url": "https://github.com/linkedin/ambry/pull/1513#pullrequestreview-409415474", "createdAt": "2020-05-11T18:18:02Z", "commit": {"oid": "f140c3064b2af292ec9f42a87c397d2adc42949e"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xMVQxODoxODowMlrOGTn4pA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xMVQxODoyMDozMVrOGTn9yw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMzIyOTYwNA==", "bodyText": "It seems like in most places, setLifeVersion is called right after new BlobInfo. Instead of adding a new setter, one alternative could be making the BlobInfo.lifeVersion final and adding a new constructor that takes life version as an argument.", "url": "https://github.com/linkedin/ambry/pull/1513#discussion_r423229604", "createdAt": "2020-05-11T18:18:02Z", "author": {"login": "cgtz"}, "path": "ambry-router/src/main/java/com/github/ambry/router/GetBlobInfoOperation.java", "diffHunk": "@@ -353,9 +353,9 @@ private void handleBody(InputStream payload, MessageMetadata messageMetadata, Me\n     ByteBuffer userMetadata = MessageFormatRecord.deserializeUserMetadata(payload);\n     if (encryptionKey == null) {\n       // if blob is not encrypted, move the state to Complete\n-      operationResult =\n-          new GetBlobResultInternal(new GetBlobResult(new BlobInfo(serverBlobProperties, userMetadata.array()), null),\n-              null);\n+      BlobInfo blobInfo = new BlobInfo(serverBlobProperties, userMetadata.array());", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f140c3064b2af292ec9f42a87c397d2adc42949e"}, "originalPosition": 7}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMzIzMDkyMw==", "bodyText": "just save life version instead of the entire messageInfo?", "url": "https://github.com/linkedin/ambry/pull/1513#discussion_r423230923", "createdAt": "2020-05-11T18:20:31Z", "author": {"login": "cgtz"}, "path": "ambry-router/src/main/java/com/github/ambry/router/GetBlobOperation.java", "diffHunk": "@@ -1100,6 +1100,7 @@ private RouterException buildChunkException(String message, RouterErrorCode erro\n     private BlobType blobType;\n     private List<CompositeBlobInfo.ChunkMetadata> chunkMetadataList;\n     private BlobProperties serverBlobProperties;\n+    private MessageInfo serverMessageInfo;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f140c3064b2af292ec9f42a87c397d2adc42949e"}, "originalPosition": 13}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "f140c3064b2af292ec9f42a87c397d2adc42949e", "author": {"user": {"login": "justinlin-linkedin", "name": "Justin Lin"}}, "url": "https://github.com/linkedin/ambry/commit/f140c3064b2af292ec9f42a87c397d2adc42949e", "committedDate": "2020-05-07T22:32:23Z", "message": "Return lifeVersion from get request"}, "afterCommit": {"oid": "d120aa91729fefbab590f72b74641764785e6ed3", "author": {"user": {"login": "justinlin-linkedin", "name": "Justin Lin"}}, "url": "https://github.com/linkedin/ambry/commit/d120aa91729fefbab590f72b74641764785e6ed3", "committedDate": "2020-05-11T19:00:44Z", "message": "Address comments"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDEwNTUxNDg1", "url": "https://github.com/linkedin/ambry/pull/1513#pullrequestreview-410551485", "createdAt": "2020-05-13T02:47:14Z", "commit": {"oid": "d120aa91729fefbab590f72b74641764785e6ed3"}, "state": "APPROVED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xM1QwMjo0NzoxNFrOGUfntQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xM1QwMjo0NzoxNFrOGUfntQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNDE0Mjc3Mw==", "bodyText": "creat -> create (also line 34)", "url": "https://github.com/linkedin/ambry/pull/1513#discussion_r424142773", "createdAt": "2020-05-13T02:47:14Z", "author": {"login": "cgtz"}, "path": "ambry-api/src/main/java/com/github/ambry/messageformat/BlobInfo.java", "diffHunk": "@@ -14,26 +14,44 @@\n package com.github.ambry.messageformat;\n \n /**\n- * A BlobInfo class that contains both the blob property and the usermetadata for the blob\n+ * A BlobInfo class that contains both the blob property, the usermetadata and the lifeVersion for the blob.\n  */\n public class BlobInfo {\n-\n   private BlobProperties blobProperties;\n-\n   private byte[] userMetadata;\n-\n   private short lifeVersion;\n \n+  /**\n+   * Constructor to creat a {@link BlobInfo}.", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d120aa91729fefbab590f72b74641764785e6ed3"}, "originalPosition": 16}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f19b67e9e2db19fa05809a3de72df44c8a07dd59", "author": {"user": {"login": "justinlin-linkedin", "name": "Justin Lin"}}, "url": "https://github.com/linkedin/ambry/commit/f19b67e9e2db19fa05809a3de72df44c8a07dd59", "committedDate": "2020-05-13T17:32:34Z", "message": "Return lifeVersion from get request"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "dd8cdf3855afca3818ea7624631847abd0e263e8", "author": {"user": {"login": "justinlin-linkedin", "name": "Justin Lin"}}, "url": "https://github.com/linkedin/ambry/commit/dd8cdf3855afca3818ea7624631847abd0e263e8", "committedDate": "2020-05-13T17:32:34Z", "message": "Address comments"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "d120aa91729fefbab590f72b74641764785e6ed3", "author": {"user": {"login": "justinlin-linkedin", "name": "Justin Lin"}}, "url": "https://github.com/linkedin/ambry/commit/d120aa91729fefbab590f72b74641764785e6ed3", "committedDate": "2020-05-11T19:00:44Z", "message": "Address comments"}, "afterCommit": {"oid": "dd8cdf3855afca3818ea7624631847abd0e263e8", "author": {"user": {"login": "justinlin-linkedin", "name": "Justin Lin"}}, "url": "https://github.com/linkedin/ambry/commit/dd8cdf3855afca3818ea7624631847abd0e263e8", "committedDate": "2020-05-13T17:32:34Z", "message": "Address comments"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "0b65a9e8ce644b65ed67df7b7fe2b5334a8406af", "author": {"user": {"login": "justinlin-linkedin", "name": "Justin Lin"}}, "url": "https://github.com/linkedin/ambry/commit/0b65a9e8ce644b65ed67df7b7fe2b5334a8406af", "committedDate": "2020-05-13T18:40:25Z", "message": "Address comments"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDEzOTg1NDMz", "url": "https://github.com/linkedin/ambry/pull/1513#pullrequestreview-413985433", "createdAt": "2020-05-18T22:41:40Z", "commit": {"oid": "0b65a9e8ce644b65ed67df7b7fe2b5334a8406af"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1472, "cost": 1, "resetAt": "2021-11-01T16:19:10Z"}}}