{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDI3OTI5NzA1", "number": 1549, "title": "Optimizations for BlobStoreStats", "bodyText": "There seem to be a couple hot spots for stats collection. The main one\nis querying the full index for each put index entry in\nupdateExpiryTimeForAllPuts. I do not have a way of reducing the number\nof index lookups here yet, but I am trying to find a couple places where\nwe can improve things along the way:\nIn this commit, I get rid of one intermediate list of valid index\nentries and instead directly update the map instead of iterating an\nextra time and allocating an extra ~40k item list.", "createdAt": "2020-06-04T15:45:26Z", "url": "https://github.com/linkedin/ambry/pull/1549", "merged": true, "mergeCommit": {"oid": "9a85610c91128dd89e7ee0d025d1f4a33a531fdd"}, "closed": true, "closedAt": "2020-06-09T22:02:38Z", "author": {"login": "cgtz"}, "timelineItems": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcn_9bxgH2gAyNDI3OTI5NzA1OjQ0YmJkZDBjNzVmYTU3MzRjYTVlNzIwYWVhMzA2YzE5Y2YwOTczZDI=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcpsYdbgFqTQyNzU3NTUyOA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "44bbdd0c75fa5734ca5e720aea306c19cf0973d2", "author": {"user": {"login": "cgtz", "name": "Casey Getz"}}, "url": "https://github.com/linkedin/ambry/commit/44bbdd0c75fa5734ca5e720aea306c19cf0973d2", "committedDate": "2020-06-04T15:40:15Z", "message": "Optimizations for BlobStoreStats\n\nThere seem to be a couple hot spots for stats collection. The main one\nis querying the full index for each put index entry in\nupdateExpiryTimeForAllPuts. I do not have a way of reducing the number\nof index lookups here yet, but I am trying to find a couple places where\nwe can improve things along the way:\n\nIn this commit, I get rid of one intermediate list of valid index\nentries and instead directly update the map instead of iterating an\nextra time and allocating an extra ~40k item list."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDI0NTg5MjU5", "url": "https://github.com/linkedin/ambry/pull/1549#pullrequestreview-424589259", "createdAt": "2020-06-04T15:47:41Z", "commit": {"oid": "44bbdd0c75fa5734ca5e720aea306c19cf0973d2"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wNFQxNTo0Nzo0MVrOGfMeKA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wNFQxNTo0Nzo0MVrOGfMeKA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNTM2MzM2OA==", "bodyText": "I added a new interface instead of using Consumer<IndexEntry> or ThrowingConsumer<IndexEntry> since these some of these methods need to throw StoreException specifically unless many method signatures are changed", "url": "https://github.com/linkedin/ambry/pull/1549#discussion_r435363368", "createdAt": "2020-06-04T15:47:41Z", "author": {"login": "cgtz"}, "path": "ambry-store/src/main/java/com/github/ambry/store/BlobStoreStats.java", "diffHunk": "@@ -1130,4 +1116,16 @@ void cancel() {\n       cancelled = true;\n     }\n   }\n+\n+  /**\n+   * An action to take on a single {@link IndexEntry}\n+   */\n+  @FunctionalInterface\n+  private interface IndexEntryAction {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "44bbdd0c75fa5734ca5e720aea306c19cf0973d2"}, "originalPosition": 205}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDI2NjY1Mzgz", "url": "https://github.com/linkedin/ambry/pull/1549#pullrequestreview-426665383", "createdAt": "2020-06-08T22:29:10Z", "commit": {"oid": "44bbdd0c75fa5734ca5e720aea306c19cf0973d2"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDI3NTc1NTI4", "url": "https://github.com/linkedin/ambry/pull/1549#pullrequestreview-427575528", "createdAt": "2020-06-09T21:59:31Z", "commit": {"oid": "44bbdd0c75fa5734ca5e720aea306c19cf0973d2"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1102, "cost": 1, "resetAt": "2021-11-01T16:19:10Z"}}}