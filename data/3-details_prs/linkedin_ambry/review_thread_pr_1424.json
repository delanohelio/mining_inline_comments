{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0Mzg3NTgzOTEx", "number": 1424, "reviewThreads": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xM1QxNjo1NDowMVrODn58bA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xM1QyMjoyODowM1rODoALxQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjQzMTcwNDEyOnYy", "diffSide": "RIGHT", "path": "ambry-protocol/src/main/java/com.github.ambry.protocol/MessageInfoAndMetdataListSerde.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xM1QxNjo1NDowMVrOF2LQZw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xM1QxNjo1NDowMVrOF2LQZw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MjM1MTg0Nw==", "bodyText": "Short.BYTES?", "url": "https://github.com/linkedin/ambry/pull/1424#discussion_r392351847", "createdAt": "2020-03-13T16:54:01Z", "author": {"login": "zzmao"}, "path": "ambry-protocol/src/main/java/com.github.ambry.protocol/MessageInfoAndMetdataListSerde.java", "diffHunk": "@@ -116,6 +122,10 @@ int getMessageInfoAndMetadataListSize() {\n         // operationTime\n         size += Long.BYTES;\n       }\n+      if (version >= VERSION_6) {\n+        // lifeVersion\n+        size += 2;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "4af963c394634dca38913558503de227665401f3"}, "originalPosition": 37}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjQzMTcwNTQyOnYy", "diffSide": "RIGHT", "path": "ambry-protocol/src/main/java/com.github.ambry.protocol/MessageInfoAndMetdataListSerde.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xM1QxNjo1NDoyMVrOF2LRKw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xM1QxNjo1NDoyMVrOF2LRKw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MjM1MjA0Mw==", "bodyText": "Change all +=1 ->  += Byte.Bytes?", "url": "https://github.com/linkedin/ambry/pull/1424#discussion_r392352043", "createdAt": "2020-03-13T16:54:21Z", "author": {"login": "zzmao"}, "path": "ambry-protocol/src/main/java/com.github.ambry.protocol/MessageInfoAndMetdataListSerde.java", "diffHunk": "@@ -93,13 +95,17 @@ int getMessageInfoAndMetadataListSize() {\n       size += Long.BYTES;\n       // whether deleted\n       size += 1;\n-      if (version < VERSION_1 || version > VERSION_5) {\n+      if (version < VERSION_1 || version > VERSION_MAX) {\n         throw new IllegalArgumentException(\"Unknown version in MessageInfoList \" + version);\n       }\n       if (version >= VERSION_5) {\n         // whether ttl updated\n         size += 1;\n       }\n+      if (version >= VERSION_6) {\n+        // whether undelete\n+        size += 1;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "4af963c394634dca38913558503de227665401f3"}, "originalPosition": 26}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjQzMjcyNjQ1OnYy", "diffSide": "RIGHT", "path": "ambry-protocol/src/main/java/com.github.ambry.protocol/MessageInfoAndMetdataListSerde.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xM1QyMjoyODowM1rOF2VHDw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xM1QyMjo0MTo0NlrOF2VUTw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MjUxMzI5NQ==", "bodyText": "Probably not related to your change. Just wonder why this check is not performed at the beginning of this method as  opposed to doing it in the whole loop.", "url": "https://github.com/linkedin/ambry/pull/1424#discussion_r392513295", "createdAt": "2020-03-13T22:28:03Z", "author": {"login": "jsjtzyy"}, "path": "ambry-protocol/src/main/java/com.github.ambry.protocol/MessageInfoAndMetdataListSerde.java", "diffHunk": "@@ -146,12 +156,15 @@ void serializeMessageInfoAndMetadataList(ByteBuffer outputBuffer) {\n         outputBuffer.putLong(messageInfo.getSize());\n         outputBuffer.putLong(messageInfo.getExpirationTimeInMs());\n         outputBuffer.put(messageInfo.isDeleted() ? UPDATED : (byte) ~UPDATED);\n-        if (version < VERSION_1 || version > VERSION_5) {\n+        if (version < VERSION_1 || version > VERSION_MAX) {\n           throw new IllegalArgumentException(\"Unknown version in MessageInfoList \" + version);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "2830e13c7ca6e6e023c65b1b946934f7666f52da"}, "originalPosition": 55}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MjUxNjY4Nw==", "bodyText": "I didn't notice that, I suppose checking at the beginning of the method makes more sense. I will update.", "url": "https://github.com/linkedin/ambry/pull/1424#discussion_r392516687", "createdAt": "2020-03-13T22:41:46Z", "author": {"login": "justinlin-linkedin"}, "path": "ambry-protocol/src/main/java/com.github.ambry.protocol/MessageInfoAndMetdataListSerde.java", "diffHunk": "@@ -146,12 +156,15 @@ void serializeMessageInfoAndMetadataList(ByteBuffer outputBuffer) {\n         outputBuffer.putLong(messageInfo.getSize());\n         outputBuffer.putLong(messageInfo.getExpirationTimeInMs());\n         outputBuffer.put(messageInfo.isDeleted() ? UPDATED : (byte) ~UPDATED);\n-        if (version < VERSION_1 || version > VERSION_5) {\n+        if (version < VERSION_1 || version > VERSION_MAX) {\n           throw new IllegalArgumentException(\"Unknown version in MessageInfoList \" + version);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MjUxMzI5NQ=="}, "originalCommit": {"oid": "2830e13c7ca6e6e023c65b1b946934f7666f52da"}, "originalPosition": 55}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1419, "cost": 1, "resetAt": "2021-11-12T20:44:06Z"}}}