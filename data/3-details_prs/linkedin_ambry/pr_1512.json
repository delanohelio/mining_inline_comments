{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDE0OTQ5ODY0", "number": 1512, "title": "Adding config to specify the type of replication model to be used for inter colo replication", "bodyText": "Adding config to specify the type of replication to be used for inter colo replication. It has two values - \"all-to-all\"(current model) or \"leader-based\" with default value is \"all-to-all\". If set to \"leader-based\", inter colo replication will be limited to the leaders(as elected by Helix) of the partition of each datacenter. If set to \"all-to-all\", inter colo replication will be in an all-to-all fashion, i.e. each replica talks to all other replicas irrespective of their state. Intra colo replication will continue as all-to-all fashion in both the models.", "createdAt": "2020-05-07T22:23:14Z", "url": "https://github.com/linkedin/ambry/pull/1512", "merged": true, "mergeCommit": {"oid": "59082390cd9513ba39f193c9b1edfca7624b97a5"}, "closed": true, "closedAt": "2020-05-14T02:40:38Z", "author": {"login": "Arun-LinkedIn"}, "timelineItems": {"totalCount": 9, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcfEyfLAH2gAyNDE0OTQ5ODY0OmYzNzAyOTFjNDA5MzdkM2Q1ODZlYmI3ODIwY2YwYTRlMjUyYjMwNGI=", "endCursor": "Y3Vyc29yOnYyOpPPAAABchCmXfAH2gAyNDE0OTQ5ODY0Ojc2MzkwMWIwMGZjNmUyMWNjNTk3Mjk2YWEyOWNhYjQzYjQ2NTA5MDU=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "f370291c40937d3d586ebb7820cf0a4e252b304b", "author": {"user": {"login": "Arun-LinkedIn", "name": "Arun Sai Bhima"}}, "url": "https://github.com/linkedin/ambry/commit/f370291c40937d3d586ebb7820cf0a4e252b304b", "committedDate": "2020-05-07T22:12:30Z", "message": "Leader based replication changes - Adding config to determine the type of replication to be used (all-to-all vs leader-based)"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDA4MDA5OTUx", "url": "https://github.com/linkedin/ambry/pull/1512#pullrequestreview-408009951", "createdAt": "2020-05-08T05:46:35Z", "commit": {"oid": "f370291c40937d3d586ebb7820cf0a4e252b304b"}, "state": "COMMENTED", "comments": {"totalCount": 7, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wOFQwNTo0NjozNVrOGSZ24g==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wOFQxNjo0MzoyMVrOGSr9uw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMTk1MTIwMg==", "bodyText": "Can we call this either \"replication.model.across.datacenters\"? (Also, please double check if this config is needed on source node. I feel it is not required by source node)", "url": "https://github.com/linkedin/ambry/pull/1512#discussion_r421951202", "createdAt": "2020-05-08T05:46:35Z", "author": {"login": "jsjtzyy"}, "path": "ambry-api/src/main/java/com/github/ambry/config/ReplicationConfig.java", "diffHunk": "@@ -181,6 +181,17 @@\n   @Default(\"\")\n   public final Set<String> replicationVcrRecoveryPartitions;\n \n+  /**\n+   * To specify the type of replication to be used for inter colo replication.\n+   * It has two values - \"all-to-all\" or \"leader-based\". Default value is \"all-to-all\".\n+   * If set to \"leader-based\", inter colo replication between will be limited to the leaders(as elected by Helix) of the partition of each datacenter.\n+   * If set to \"all-to-all\", inter colo replication will be in an all-to-all fashion, i.e. each replica talks to all other replicas irrespective of their state.\n+   * Intra colo replication will continue as all-to-all fashion in both the models.\n+   */\n+  @Config(\"replication.inter.colo.datacenter.model\")", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f370291c40937d3d586ebb7820cf0a4e252b304b"}, "originalPosition": 11}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMTk1MTkyMg==", "bodyText": "Usually this variable name should be exact same with the config string.", "url": "https://github.com/linkedin/ambry/pull/1512#discussion_r421951922", "createdAt": "2020-05-08T05:49:05Z", "author": {"login": "jsjtzyy"}, "path": "ambry-api/src/main/java/com/github/ambry/config/ReplicationConfig.java", "diffHunk": "@@ -181,6 +181,17 @@\n   @Default(\"\")\n   public final Set<String> replicationVcrRecoveryPartitions;\n \n+  /**\n+   * To specify the type of replication to be used for inter colo replication.\n+   * It has two values - \"all-to-all\" or \"leader-based\". Default value is \"all-to-all\".\n+   * If set to \"leader-based\", inter colo replication between will be limited to the leaders(as elected by Helix) of the partition of each datacenter.\n+   * If set to \"all-to-all\", inter colo replication will be in an all-to-all fashion, i.e. each replica talks to all other replicas irrespective of their state.\n+   * Intra colo replication will continue as all-to-all fashion in both the models.\n+   */\n+  @Config(\"replication.inter.colo.datacenter.model\")\n+  @Default(\"all-to-all\")\n+  public final String replicationModelForInterColoDatacenters;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f370291c40937d3d586ebb7820cf0a4e252b304b"}, "originalPosition": 13}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMTk1NTk1Nw==", "bodyText": "minor: let's use equalsIgnoreCase here", "url": "https://github.com/linkedin/ambry/pull/1512#discussion_r421955957", "createdAt": "2020-05-08T06:02:25Z", "author": {"login": "jsjtzyy"}, "path": "ambry-replication/src/main/java/com/github/ambry/replication/ReplicationEngine.java", "diffHunk": "@@ -121,6 +122,8 @@ public ReplicationEngine(ReplicationConfig replicationConfig, ClusterMapConfig c\n     this.storeManager = storeManager;\n     replicaSyncUpManager = clusterParticipant == null ? null : clusterParticipant.getReplicaSyncUpManager();\n     peerLeaderReplicasByPartition = new ConcurrentHashMap<>();\n+    replicationModelType = replicationConfig.replicationModelForInterColoDatacenters.equals(\"leader-based\")", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f370291c40937d3d586ebb7820cf0a4e252b304b"}, "originalPosition": 12}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMjI0MTA1Ng==", "bodyText": "nit: The model used for cross-colo replication", "url": "https://github.com/linkedin/ambry/pull/1512#discussion_r422241056", "createdAt": "2020-05-08T16:29:49Z", "author": {"login": "jsjtzyy"}, "path": "ambry-api/src/main/java/com/github/ambry/replication/ReplicationModelType.java", "diffHunk": "@@ -0,0 +1,24 @@\n+/**\n+ * Copyright 2019 LinkedIn Corp. All rights reserved.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ * http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ */\n+\n+package com.github.ambry.replication;\n+\n+/**\n+ * The type of replication used for inter-data centers", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f370291c40937d3d586ebb7820cf0a4e252b304b"}, "originalPosition": 18}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMjI0MjE4NA==", "bodyText": "nit: format this file", "url": "https://github.com/linkedin/ambry/pull/1512#discussion_r422242184", "createdAt": "2020-05-08T16:32:11Z", "author": {"login": "jsjtzyy"}, "path": "ambry-replication/src/main/java/com/github/ambry/replication/ReplicationManager.java", "diffHunk": "@@ -254,6 +254,14 @@ private void updatePartitionInfoMaps(List<RemoteReplicaInfo> remoteReplicaInfos,\n     return Collections.unmodifiableMap(peerLeaderReplicasByPartition);\n   }\n \n+  /**\n+   * Get a replication model type being used for inter colo replication\n+   * @return replication model type {@link ReplicationEngine#replicationModelType}\n+   */\n+  ReplicationModelType  getReplicationModelType(){", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f370291c40937d3d586ebb7820cf0a4e252b304b"}, "originalPosition": 8}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMjI0NDM5Mw==", "bodyText": "minor: to make the naming consistent, how about renaming this test to replicationTypeFromConfigTest?", "url": "https://github.com/linkedin/ambry/pull/1512#discussion_r422244393", "createdAt": "2020-05-08T16:36:31Z", "author": {"login": "jsjtzyy"}, "path": "ambry-replication/src/test/java/com/github/ambry/replication/ReplicationTest.java", "diffHunk": "@@ -171,6 +171,38 @@ public ReplicationTest(short requestVersion, short responseVersion) throws Excep\n     replicationConfig = new ReplicationConfig(verifiableProperties);\n   }\n \n+  /**\n+   * Tests replication model is correct obtained from properties\n+   * @throws Exception\n+   */\n+  @Test\n+  public void verifyReplicationTypeFromConfig() throws Exception {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f370291c40937d3d586ebb7820cf0a4e252b304b"}, "originalPosition": 9}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMjI0Nzg2Nw==", "bodyText": "nit:  is correctly obtained", "url": "https://github.com/linkedin/ambry/pull/1512#discussion_r422247867", "createdAt": "2020-05-08T16:43:21Z", "author": {"login": "jsjtzyy"}, "path": "ambry-replication/src/test/java/com/github/ambry/replication/ReplicationTest.java", "diffHunk": "@@ -171,6 +171,38 @@ public ReplicationTest(short requestVersion, short responseVersion) throws Excep\n     replicationConfig = new ReplicationConfig(verifiableProperties);\n   }\n \n+  /**\n+   * Tests replication model is correct obtained from properties", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f370291c40937d3d586ebb7820cf0a4e252b304b"}, "originalPosition": 5}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "d2a9d148f849f444eb8505828607374d64add82c", "author": {"user": {"login": "Arun-LinkedIn", "name": "Arun Sai Bhima"}}, "url": "https://github.com/linkedin/ambry/commit/d2a9d148f849f444eb8505828607374d64add82c", "committedDate": "2020-05-11T05:00:53Z", "message": "Addressing review comments for having naming conventions consistent"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDA5MzI1MTM0", "url": "https://github.com/linkedin/ambry/pull/1512#pullrequestreview-409325134", "createdAt": "2020-05-11T16:17:41Z", "commit": {"oid": "d2a9d148f849f444eb8505828607374d64add82c"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDA5NTk1NDM0", "url": "https://github.com/linkedin/ambry/pull/1512#pullrequestreview-409595434", "createdAt": "2020-05-11T23:17:33Z", "commit": {"oid": "d2a9d148f849f444eb8505828607374d64add82c"}, "state": "COMMENTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xMVQyMzoxNzozM1rOGTwosQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xMVQyMzoxODowMVrOGTwpaQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMzM3Mjk3Nw==", "bodyText": "nit: I suggest create a static string variable for this one\npublic static final String DEFAULT_REPLICATION_MODEL_ACROSS_DATACENTRS = ReplicationModelType.ALL_TO_ALL.toString().toLowerCase();\n\n@Config(\"replication.model.across.datacenters\")\n@Default(DEFAULT_REPLICATION_MODEL_ACROSS_DATACENTERS)\npublic final String replicationModelAcrossDatacenters;", "url": "https://github.com/linkedin/ambry/pull/1512#discussion_r423372977", "createdAt": "2020-05-11T23:17:33Z", "author": {"login": "justinlin-linkedin"}, "path": "ambry-api/src/main/java/com/github/ambry/config/ReplicationConfig.java", "diffHunk": "@@ -181,6 +181,17 @@\n   @Default(\"\")\n   public final Set<String> replicationVcrRecoveryPartitions;\n \n+  /**\n+   * To specify the type of replication to be used for inter colo replication.\n+   * It has two values - \"all-to-all\" or \"leader-based\". Default value is \"all-to-all\".\n+   * If set to \"leader-based\", inter colo replication between will be limited to the leaders(as elected by Helix) of the partition of each datacenter.\n+   * If set to \"all-to-all\", inter colo replication will be in an all-to-all fashion, i.e. each replica talks to all other replicas irrespective of their state.\n+   * Intra colo replication will continue as all-to-all fashion in both the models.\n+   */\n+  @Config(\"replication.model.across.datacenters\")\n+  @Default(\"all-to-all\")", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d2a9d148f849f444eb8505828607374d64add82c"}, "originalPosition": 12}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMzM3MzE2MQ==", "bodyText": "the year should be 2020.", "url": "https://github.com/linkedin/ambry/pull/1512#discussion_r423373161", "createdAt": "2020-05-11T23:18:01Z", "author": {"login": "justinlin-linkedin"}, "path": "ambry-api/src/main/java/com/github/ambry/replication/ReplicationModelType.java", "diffHunk": "@@ -0,0 +1,24 @@\n+/**\n+ * Copyright 2019 LinkedIn Corp. All rights reserved.", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d2a9d148f849f444eb8505828607374d64add82c"}, "originalPosition": 2}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "eaf9a3e136da53e068d364548dbd9ffa3326a3b7", "author": {"user": {"login": "Arun-LinkedIn", "name": "Arun Sai Bhima"}}, "url": "https://github.com/linkedin/ambry/commit/eaf9a3e136da53e068d364548dbd9ffa3326a3b7", "committedDate": "2020-05-12T04:39:58Z", "message": "Define static string constants for config name"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b2e0611800354feae8dc2b5f1e34459a945eeae5", "author": {"user": {"login": "Arun-LinkedIn", "name": "Arun Sai Bhima"}}, "url": "https://github.com/linkedin/ambry/commit/b2e0611800354feae8dc2b5f1e34459a945eeae5", "committedDate": "2020-05-14T00:37:42Z", "message": "Update the config values of \"replication.model.across.datacenters\" to \"ALL_TO_ALL\" and \"LEADER_BASED\" to map to ReplicationModelType enum names"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDExMzkxNjU2", "url": "https://github.com/linkedin/ambry/pull/1512#pullrequestreview-411391656", "createdAt": "2020-05-14T00:42:48Z", "commit": {"oid": "b2e0611800354feae8dc2b5f1e34459a945eeae5"}, "state": "APPROVED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xNFQwMDo0Mjo0OFrOGVIRnw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xNFQwMDo0Mjo0OFrOGVIRnw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNDgwODg2Mw==", "bodyText": "nit: please update comment to reflect latest change. It should be \"ALL_TO_ALL\" and \"LEADER_BASED\".", "url": "https://github.com/linkedin/ambry/pull/1512#discussion_r424808863", "createdAt": "2020-05-14T00:42:48Z", "author": {"login": "justinlin-linkedin"}, "path": "ambry-api/src/main/java/com/github/ambry/config/ReplicationConfig.java", "diffHunk": "@@ -181,6 +182,17 @@\n   @Default(\"\")\n   public final Set<String> replicationVcrRecoveryPartitions;\n \n+  /**\n+   * To specify the type of replication to be used for inter colo replication.\n+   * It has two values - \"all-to-all\" or \"leader-based\". Default value is \"all-to-all\".", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b2e0611800354feae8dc2b5f1e34459a945eeae5"}, "originalPosition": 14}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "763901b00fc6e21cc597296aa29cab43b4650905", "author": {"user": {"login": "Arun-LinkedIn", "name": "Arun Sai Bhima"}}, "url": "https://github.com/linkedin/ambry/commit/763901b00fc6e21cc597296aa29cab43b4650905", "committedDate": "2020-05-14T00:47:18Z", "message": "Updating the comment section to reflect the correct values"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1470, "cost": 1, "resetAt": "2021-11-01T16:19:10Z"}}}