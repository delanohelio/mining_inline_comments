{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0Mzg3NTgzOTEx", "number": 1424, "title": "Add new version to MessageInfoAndMetadataListSerDe to delivery lifeVersion on wire", "bodyText": "currently we don't serialize lifeVersion in message info at GetResponse and ReplicaMetadataRespone.\nThis PR adds a new version to MessageInfoAndMetadataListSerDe class to pass lifeVersion on wire.\nAfter this is merged, we have to first deploy it to all the frontend so the frontend can deserialize newer version. Then we have to deploy to all server, so server can deserialize newer version.\nThen we can push a new PR to write message info with newer version from ambryserver.", "createdAt": "2020-03-13T04:21:30Z", "url": "https://github.com/linkedin/ambry/pull/1424", "merged": true, "mergeCommit": {"oid": "82de6992d50cb2efdb4ebd635f8738ad7fafb78a"}, "closed": true, "closedAt": "2020-03-14T00:04:08Z", "author": {"login": "justinlin-linkedin"}, "timelineItems": {"totalCount": 6, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcNTSeAAFqTM3NDQ2MDg3Mw==", "endCursor": "Y3Vyc29yOnYyOpPPAAABcNYSXogBqjMxMjg1MTcwMDY=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzc0NDYwODcz", "url": "https://github.com/linkedin/ambry/pull/1424#pullrequestreview-374460873", "createdAt": "2020-03-13T16:54:01Z", "commit": {"oid": "4af963c394634dca38913558503de227665401f3"}, "state": "COMMENTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xM1QxNjo1NDowMVrOF2LQZw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xM1QxNjo1NDoyMVrOF2LRKw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MjM1MTg0Nw==", "bodyText": "Short.BYTES?", "url": "https://github.com/linkedin/ambry/pull/1424#discussion_r392351847", "createdAt": "2020-03-13T16:54:01Z", "author": {"login": "zzmao"}, "path": "ambry-protocol/src/main/java/com.github.ambry.protocol/MessageInfoAndMetdataListSerde.java", "diffHunk": "@@ -116,6 +122,10 @@ int getMessageInfoAndMetadataListSize() {\n         // operationTime\n         size += Long.BYTES;\n       }\n+      if (version >= VERSION_6) {\n+        // lifeVersion\n+        size += 2;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "4af963c394634dca38913558503de227665401f3"}, "originalPosition": 37}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MjM1MjA0Mw==", "bodyText": "Change all +=1 ->  += Byte.Bytes?", "url": "https://github.com/linkedin/ambry/pull/1424#discussion_r392352043", "createdAt": "2020-03-13T16:54:21Z", "author": {"login": "zzmao"}, "path": "ambry-protocol/src/main/java/com.github.ambry.protocol/MessageInfoAndMetdataListSerde.java", "diffHunk": "@@ -93,13 +95,17 @@ int getMessageInfoAndMetadataListSize() {\n       size += Long.BYTES;\n       // whether deleted\n       size += 1;\n-      if (version < VERSION_1 || version > VERSION_5) {\n+      if (version < VERSION_1 || version > VERSION_MAX) {\n         throw new IllegalArgumentException(\"Unknown version in MessageInfoList \" + version);\n       }\n       if (version >= VERSION_5) {\n         // whether ttl updated\n         size += 1;\n       }\n+      if (version >= VERSION_6) {\n+        // whether undelete\n+        size += 1;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "4af963c394634dca38913558503de227665401f3"}, "originalPosition": 26}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzc0NDczMDYy", "url": "https://github.com/linkedin/ambry/pull/1424#pullrequestreview-374473062", "createdAt": "2020-03-13T17:10:58Z", "commit": {"oid": "2830e13c7ca6e6e023c65b1b946934f7666f52da"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzc0NjUxNzI2", "url": "https://github.com/linkedin/ambry/pull/1424#pullrequestreview-374651726", "createdAt": "2020-03-13T22:28:03Z", "commit": {"oid": "2830e13c7ca6e6e023c65b1b946934f7666f52da"}, "state": "APPROVED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xM1QyMjoyODowM1rOF2VHDw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xM1QyMjoyODowM1rOF2VHDw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MjUxMzI5NQ==", "bodyText": "Probably not related to your change. Just wonder why this check is not performed at the beginning of this method as  opposed to doing it in the whole loop.", "url": "https://github.com/linkedin/ambry/pull/1424#discussion_r392513295", "createdAt": "2020-03-13T22:28:03Z", "author": {"login": "jsjtzyy"}, "path": "ambry-protocol/src/main/java/com.github.ambry.protocol/MessageInfoAndMetdataListSerde.java", "diffHunk": "@@ -146,12 +156,15 @@ void serializeMessageInfoAndMetadataList(ByteBuffer outputBuffer) {\n         outputBuffer.putLong(messageInfo.getSize());\n         outputBuffer.putLong(messageInfo.getExpirationTimeInMs());\n         outputBuffer.put(messageInfo.isDeleted() ? UPDATED : (byte) ~UPDATED);\n-        if (version < VERSION_1 || version > VERSION_5) {\n+        if (version < VERSION_1 || version > VERSION_MAX) {\n           throw new IllegalArgumentException(\"Unknown version in MessageInfoList \" + version);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "2830e13c7ca6e6e023c65b1b946934f7666f52da"}, "originalPosition": 55}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "3bb66166a6455bdf945c25781d98e0a7a23e6933", "author": {"user": {"login": "justinlin-linkedin", "name": "Justin Lin"}}, "url": "https://github.com/linkedin/ambry/commit/3bb66166a6455bdf945c25781d98e0a7a23e6933", "committedDate": "2020-03-13T22:42:06Z", "message": "Add new version to MessageInfoAndMetadataListSerDe to delivery lifeVersion on wire"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c6f6bfa27e2454925c61b9aa91acd5c11c5dab2c", "author": {"user": {"login": "justinlin-linkedin", "name": "Justin Lin"}}, "url": "https://github.com/linkedin/ambry/commit/c6f6bfa27e2454925c61b9aa91acd5c11c5dab2c", "committedDate": "2020-03-13T22:42:06Z", "message": "Address comments and more tests"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "2830e13c7ca6e6e023c65b1b946934f7666f52da", "author": {"user": {"login": "justinlin-linkedin", "name": "Justin Lin"}}, "url": "https://github.com/linkedin/ambry/commit/2830e13c7ca6e6e023c65b1b946934f7666f52da", "committedDate": "2020-03-13T17:05:22Z", "message": "Address comments and more tests"}, "afterCommit": {"oid": "c6f6bfa27e2454925c61b9aa91acd5c11c5dab2c", "author": {"user": {"login": "justinlin-linkedin", "name": "Justin Lin"}}, "url": "https://github.com/linkedin/ambry/commit/c6f6bfa27e2454925c61b9aa91acd5c11c5dab2c", "committedDate": "2020-03-13T22:42:06Z", "message": "Address comments and more tests"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1297, "cost": 1, "resetAt": "2021-11-01T16:19:10Z"}}}