{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTM0NTk3NDg3", "number": 1719, "title": "[Content Encoding] Support serialize for new version of blobProperty", "bodyText": "Support serialize for version4 of blobProperty and fix the issue when field is null but after deserialize it's empty.", "createdAt": "2020-12-08T17:11:52Z", "url": "https://github.com/linkedin/ambry/pull/1719", "merged": true, "mergeCommit": {"oid": "0e62e5d9abf4de0a249d0cde8ab6d1548f1398e2"}, "closed": true, "closedAt": "2020-12-10T18:05:26Z", "author": {"login": "SophieGuo410"}, "timelineItems": {"totalCount": 10, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdkN9eGgBqjQwODYwMjE4MTM=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdk3BSxAFqTU0OTQ1MDkwMw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "b0316cb47aab91bac0deaa82aff11c1ea155b78f", "author": {"user": {"login": "SophieGuo410", "name": "sopguo"}}, "url": "https://github.com/linkedin/ambry/commit/b0316cb47aab91bac0deaa82aff11c1ea155b78f", "committedDate": "2020-12-08T17:08:19Z", "message": "[Content Encoding] Support serialize for new version of blobProperty"}, "afterCommit": {"oid": "d5c293d96e50114e95e02bd120e67695a07eee3c", "author": {"user": {"login": "SophieGuo410", "name": "sopguo"}}, "url": "https://github.com/linkedin/ambry/commit/d5c293d96e50114e95e02bd120e67695a07eee3c", "committedDate": "2020-12-08T17:54:10Z", "message": "[Content Encoding] Support serialize for new version of blobProperty"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "d5c293d96e50114e95e02bd120e67695a07eee3c", "author": {"user": {"login": "SophieGuo410", "name": "sopguo"}}, "url": "https://github.com/linkedin/ambry/commit/d5c293d96e50114e95e02bd120e67695a07eee3c", "committedDate": "2020-12-08T17:54:10Z", "message": "[Content Encoding] Support serialize for new version of blobProperty"}, "afterCommit": {"oid": "1f916b2ad457f7c08df827f47f821259382fba63", "author": {"user": {"login": "SophieGuo410", "name": "sopguo"}}, "url": "https://github.com/linkedin/ambry/commit/1f916b2ad457f7c08df827f47f821259382fba63", "committedDate": "2020-12-08T17:54:54Z", "message": "[Content Encoding] Support serialize for new version of blobProperty"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "1f916b2ad457f7c08df827f47f821259382fba63", "author": {"user": {"login": "SophieGuo410", "name": "sopguo"}}, "url": "https://github.com/linkedin/ambry/commit/1f916b2ad457f7c08df827f47f821259382fba63", "committedDate": "2020-12-08T17:54:54Z", "message": "[Content Encoding] Support serialize for new version of blobProperty"}, "afterCommit": {"oid": "849812bbf5865dee433d22fd75258df62422d2f4", "author": {"user": {"login": "SophieGuo410", "name": "sopguo"}}, "url": "https://github.com/linkedin/ambry/commit/849812bbf5865dee433d22fd75258df62422d2f4", "committedDate": "2020-12-08T18:48:05Z", "message": "[Content Encoding] Support serialize for new version of blobProperty"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "849812bbf5865dee433d22fd75258df62422d2f4", "author": {"user": {"login": "SophieGuo410", "name": "sopguo"}}, "url": "https://github.com/linkedin/ambry/commit/849812bbf5865dee433d22fd75258df62422d2f4", "committedDate": "2020-12-08T18:48:05Z", "message": "[Content Encoding] Support serialize for new version of blobProperty"}, "afterCommit": {"oid": "fc0e92595f96542d4d06098a01e284f300a5aadf", "author": {"user": {"login": "SophieGuo410", "name": "sopguo"}}, "url": "https://github.com/linkedin/ambry/commit/fc0e92595f96542d4d06098a01e284f300a5aadf", "committedDate": "2020-12-10T04:55:16Z", "message": "[Content Encoding] Support serialize for new version of blobProperty"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "cfcaefda601834d9c9f7fcc4a5465c3427c40407", "author": {"user": {"login": "SophieGuo410", "name": "sopguo"}}, "url": "https://github.com/linkedin/ambry/commit/cfcaefda601834d9c9f7fcc4a5465c3427c40407", "committedDate": "2020-12-10T05:46:31Z", "message": "[Content Encoding] Support serialize for new version of blobProperty"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "fc0e92595f96542d4d06098a01e284f300a5aadf", "author": {"user": {"login": "SophieGuo410", "name": "sopguo"}}, "url": "https://github.com/linkedin/ambry/commit/fc0e92595f96542d4d06098a01e284f300a5aadf", "committedDate": "2020-12-10T04:55:16Z", "message": "[Content Encoding] Support serialize for new version of blobProperty"}, "afterCommit": {"oid": "cfcaefda601834d9c9f7fcc4a5465c3427c40407", "author": {"user": {"login": "SophieGuo410", "name": "sopguo"}}, "url": "https://github.com/linkedin/ambry/commit/cfcaefda601834d9c9f7fcc4a5465c3427c40407", "committedDate": "2020-12-10T05:46:31Z", "message": "[Content Encoding] Support serialize for new version of blobProperty"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTQ4ODgwMDA4", "url": "https://github.com/linkedin/ambry/pull/1719#pullrequestreview-548880008", "createdAt": "2020-12-10T06:09:48Z", "commit": {"oid": "cfcaefda601834d9c9f7fcc4a5465c3427c40407"}, "state": "COMMENTED", "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xMFQwNjowOTo0OFrOIC3T6w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xMFQwNjoxMzoyN1rOIC3fHA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzOTg3NDI4Mw==", "bodyText": "minor: looks like we don't have unit test that version = 4 but either contentEncoding or filename is null.", "url": "https://github.com/linkedin/ambry/pull/1719#discussion_r539874283", "createdAt": "2020-12-10T06:09:48Z", "author": {"login": "jsjtzyy"}, "path": "ambry-messageformat/src/main/java/com/github/ambry/messageformat/BlobPropertiesSerDe.java", "diffHunk": "@@ -60,22 +62,22 @@ public static BlobProperties getBlobPropertiesFromStream(DataInputStream stream)\n     short accountId = version > VERSION_1 ? stream.readShort() : Account.UNKNOWN_ACCOUNT_ID;\n     short containerId = version > VERSION_1 ? stream.readShort() : Container.UNKNOWN_CONTAINER_ID;\n     boolean isEncrypted = version > VERSION_2 && stream.readByte() == (byte) 1;\n-    String contentEncoding = version > VERSION_3 ? Utils.readIntString(stream) : null;\n-    String filename = version > VERSION_3 ? Utils.readIntString(stream) : null;\n+    String contentEncoding = version > VERSION_3 ? Utils.readNullableIntString(stream) : null;\n+    String filename = version > VERSION_3 ? Utils.readNullableIntString(stream) : null;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "cfcaefda601834d9c9f7fcc4a5465c3427c40407"}, "originalPosition": 18}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzOTg3NTgxOA==", "bodyText": "nit: java doc", "url": "https://github.com/linkedin/ambry/pull/1719#discussion_r539875818", "createdAt": "2020-12-10T06:11:45Z", "author": {"login": "jsjtzyy"}, "path": "ambry-utils/src/main/java/com/github/ambry/utils/Utils.java", "diffHunk": "@@ -149,6 +149,15 @@ public static String readIntString(DataInputStream input) throws IOException {\n     return readIntString(input, StandardCharsets.UTF_8);\n   }\n \n+  public static String readNullableIntString(DataInputStream input) throws IOException {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "cfcaefda601834d9c9f7fcc4a5465c3427c40407"}, "originalPosition": 4}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzOTg3NzE0OA==", "bodyText": "return tmp.isEmpty() ? null : tmp;", "url": "https://github.com/linkedin/ambry/pull/1719#discussion_r539877148", "createdAt": "2020-12-10T06:13:27Z", "author": {"login": "jsjtzyy"}, "path": "ambry-utils/src/main/java/com/github/ambry/utils/Utils.java", "diffHunk": "@@ -149,6 +149,15 @@ public static String readIntString(DataInputStream input) throws IOException {\n     return readIntString(input, StandardCharsets.UTF_8);\n   }\n \n+  public static String readNullableIntString(DataInputStream input) throws IOException {\n+    String tmp = readIntString(input, StandardCharsets.UTF_8);\n+    if (tmp.length() == 0) {\n+      return null;\n+    } else {\n+      return tmp;\n+    }", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "cfcaefda601834d9c9f7fcc4a5465c3427c40407"}, "originalPosition": 10}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "9469f2e5c8bedc9e39c646cb61874c2abcc6136b", "author": {"user": {"login": "SophieGuo410", "name": "sopguo"}}, "url": "https://github.com/linkedin/ambry/commit/9469f2e5c8bedc9e39c646cb61874c2abcc6136b", "committedDate": "2020-12-10T07:19:27Z", "message": "Address Yingyi's comments"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTQ5NDMwNzEy", "url": "https://github.com/linkedin/ambry/pull/1719#pullrequestreview-549430712", "createdAt": "2020-12-10T17:23:00Z", "commit": {"oid": "9469f2e5c8bedc9e39c646cb61874c2abcc6136b"}, "state": "APPROVED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xMFQxNzoyMzowMFrOIDUoog==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xMFQxNzoyMzowMFrOIDUoog==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MDM1NDcyMg==", "bodyText": "is this println intended?", "url": "https://github.com/linkedin/ambry/pull/1719#discussion_r540354722", "createdAt": "2020-12-10T17:23:00Z", "author": {"login": "cgtz"}, "path": "ambry-messageformat/src/test/java/com/github/ambry/messageformat/BlobPropertiesTest.java", "diffHunk": "@@ -84,10 +84,19 @@ public void basicTest() throws IOException {\n     String filenameToExpect = filename;\n \n     BlobProperties blobProperties = new BlobProperties(blobSize, serviceId, null, null, false, Utils.Infinite_Time,\n+        SystemTime.getInstance().milliseconds(), accountId, containerId, isEncrypted, externalAssetTag, null, null);\n+    System.out.println(blobProperties.toString()); // Provide example of BlobProperties.toString()", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "9469f2e5c8bedc9e39c646cb61874c2abcc6136b"}, "originalPosition": 5}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTQ5NDUwOTAz", "url": "https://github.com/linkedin/ambry/pull/1719#pullrequestreview-549450903", "createdAt": "2020-12-10T17:44:42Z", "commit": {"oid": "9469f2e5c8bedc9e39c646cb61874c2abcc6136b"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1039, "cost": 1, "resetAt": "2021-11-01T16:19:10Z"}}}