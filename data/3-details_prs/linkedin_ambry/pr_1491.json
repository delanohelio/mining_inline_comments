{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDEwMjg4ODIw", "number": 1491, "title": "Fix a MessageSievingInputStream test failure", "bodyText": "This PR is to fix this issue #1489.\nThe root cause for this failure is we create a corrupted data stream for message info 2, and sometimes the header version is valid since it's all a random number. When the header version is valid, it will might fail because of StoreKey is not valid. Since when the header version is valid, the entire header bytes are valid, and store key is the item following the header, and it will fail.\nIn this PR, we start verifying the header's sanity after reading the header out. This will make header invalid even if the header version is valid.", "createdAt": "2020-04-28T18:33:45Z", "url": "https://github.com/linkedin/ambry/pull/1491", "merged": true, "mergeCommit": {"oid": "865d5bfd4787fadf17afa7a9cf1cb8d2272d2714"}, "closed": true, "closedAt": "2020-04-30T17:14:48Z", "author": {"login": "justinlin-linkedin"}, "timelineItems": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABccHI5ggH2gAyNDEwMjg4ODIwOjljNjJkMWI4MDg5YzFjMTk5OWIwZjQ1NzM4NDgyZDRlOWM0Mjg2MzE=", "endCursor": "Y3Vyc29yOnYyOpPPAAABccwTisgFqTQwMzcxNzk3Nw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "9c62d1b8089c1c1999b0f45738482d4e9c428631", "author": {"user": {"login": "justinlin-linkedin", "name": "Justin Lin"}}, "url": "https://github.com/linkedin/ambry/commit/9c62d1b8089c1c1999b0f45738482d4e9c428631", "committedDate": "2020-04-28T17:15:01Z", "message": "WIP"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a143578f0aa86d83c26c8bb50700c9e4028d664c", "author": {"user": {"login": "justinlin-linkedin", "name": "Justin Lin"}}, "url": "https://github.com/linkedin/ambry/commit/a143578f0aa86d83c26c8bb50700c9e4028d664c", "committedDate": "2020-04-28T18:23:58Z", "message": "Fix a MessageSievingInputStream test failure"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDAzMTM1OTE1", "url": "https://github.com/linkedin/ambry/pull/1491#pullrequestreview-403135915", "createdAt": "2020-04-30T00:50:02Z", "commit": {"oid": "a143578f0aa86d83c26c8bb50700c9e4028d664c"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDAzNzE3OTc3", "url": "https://github.com/linkedin/ambry/pull/1491#pullrequestreview-403717977", "createdAt": "2020-04-30T17:12:21Z", "commit": {"oid": "a143578f0aa86d83c26c8bb50700c9e4028d664c"}, "state": "APPROVED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0zMFQxNzoxMjoyMVrOGOyonw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0zMFQxNzoxMjoyMVrOGOyonw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxODE2Mjg0Nw==", "bodyText": "minor: we have lots of redundant calculation of the offset in read method, suggest simplifying them.", "url": "https://github.com/linkedin/ambry/pull/1491#discussion_r418162847", "createdAt": "2020-04-30T17:12:21Z", "author": {"login": "jsjtzyy"}, "path": "ambry-messageformat/src/test/java/com/github/ambry/messageformat/MessageSievingInputStreamTest.java", "diffHunk": "@@ -581,6 +618,10 @@ private void testInValidDeletedAndExpiredBlobs(short blobVersion, BlobType blobT\n         (int) messageFormatStream1.getSize() + (int) messageFormatStream2.getSize()\n             + (int) messageFormatStream3.getSize() + (int) messageFormatStream4.getSize(),\n         (int) messageFormatStream5.getSize());\n+    corruptStream6.read(totalMessageStreamContent,\n+        (int) messageFormatStream1.getSize() + (int) messageFormatStream2.getSize()\n+            + (int) messageFormatStream3.getSize() + (int) messageFormatStream4.getSize()\n+            + (int) messageFormatStream5.getSize(), (int) messageFormatStream6.getSize());", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "a143578f0aa86d83c26c8bb50700c9e4028d664c"}, "originalPosition": 76}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1432, "cost": 1, "resetAt": "2021-11-01T16:19:10Z"}}}