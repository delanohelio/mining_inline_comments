{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDM4MzI2NzA3", "number": 1574, "title": "Mute ERROR message caused by replication of deprecated container and change log level", "bodyText": "", "createdAt": "2020-06-23T05:25:24Z", "url": "https://github.com/linkedin/ambry/pull/1574", "merged": true, "mergeCommit": {"oid": "486c8d39874306260d988ed0b818f27d6e0b20c3"}, "closed": true, "closedAt": "2020-06-24T17:38:43Z", "author": {"login": "SophieGuo410"}, "timelineItems": {"totalCount": 6, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABct-hA_gH2gAyNDM4MzI2NzA3OjU5YWJiNDBlZmFkMWMzZDg1ZTI1MWFjYTNiNzU3Yjc4NzMwZDI1ZDk=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcudnwOAFqTQzNjg2NDk1Mg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "59abb40efad1c3d85e251aca3b757b78730d25d9", "author": {"user": null}, "url": "https://github.com/linkedin/ambry/commit/59abb40efad1c3d85e251aca3b757b78730d25d9", "committedDate": "2020-06-23T05:22:51Z", "message": "Mute exception caused by replication of deprecated container"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDM1OTI4NTky", "url": "https://github.com/linkedin/ambry/pull/1574#pullrequestreview-435928592", "createdAt": "2020-06-23T15:59:08Z", "commit": {"oid": "59abb40efad1c3d85e251aca3b757b78730d25d9"}, "state": "APPROVED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yM1QxNTo1OTowOFrOGnwBlw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yM1QxNTo1OTowOFrOGnwBlw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NDMzNDQ4Nw==", "bodyText": "Is there a unit test for this?", "url": "https://github.com/linkedin/ambry/pull/1574#discussion_r444334487", "createdAt": "2020-06-23T15:59:08Z", "author": {"login": "jsjtzyy"}, "path": "ambry-replication/src/main/java/com/github/ambry/replication/ReplicaThread.java", "diffHunk": "@@ -741,6 +741,10 @@ private void processReplicaMetadataResponse(Set<MessageInfo> missingRemoteStoreM\n       } else {\n         // the key is present in the local store. Mark it for deletion if it is deleted in the remote store and not\n         // deleted yet locally\n+        // if the blob is from deprecated container, then nothing needs to be done.\n+        if (skipPredicate != null && skipPredicate.test(messageInfo)) {\n+          continue;\n+        }", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "59abb40efad1c3d85e251aca3b757b78730d25d9"}, "originalPosition": 7}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "3832b94286df7ed5d9538c280b788a162f5a21e6", "author": {"user": null}, "url": "https://github.com/linkedin/ambry/commit/3832b94286df7ed5d9538c280b788a162f5a21e6", "committedDate": "2020-06-23T23:37:09Z", "message": "increase test coverage"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDM2MzE2MTg0", "url": "https://github.com/linkedin/ambry/pull/1574#pullrequestreview-436316184", "createdAt": "2020-06-24T04:30:20Z", "commit": {"oid": "3832b94286df7ed5d9538c280b788a162f5a21e6"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yNFQwNDozMDoyMFrOGoCjMw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yNFQwNDozMDoyMFrOGoCjMw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NDYzODAwMw==", "bodyText": "I still can't wrap my head around the exception findKey throws. How does it happen?\nIf we are here at line 745, then the local key is not missing from the local store. But if we move on to findKey, it throws an exception about not able to find it? Does this mean the key is compacted between?", "url": "https://github.com/linkedin/ambry/pull/1574#discussion_r444638003", "createdAt": "2020-06-24T04:30:20Z", "author": {"login": "justinlin-linkedin"}, "path": "ambry-replication/src/main/java/com/github/ambry/replication/ReplicaThread.java", "diffHunk": "@@ -741,6 +741,10 @@ private void processReplicaMetadataResponse(Set<MessageInfo> missingRemoteStoreM\n       } else {\n         // the key is present in the local store. Mark it for deletion if it is deleted in the remote store and not\n         // deleted yet locally\n+        // if the blob is from deprecated container, then nothing needs to be done.\n+        if (skipPredicate != null && skipPredicate.test(messageInfo)) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "3832b94286df7ed5d9538c280b788a162f5a21e6"}, "originalPosition": 14}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDM2MzE1Mzgy", "url": "https://github.com/linkedin/ambry/pull/1574#pullrequestreview-436315382", "createdAt": "2020-06-24T04:27:28Z", "commit": {"oid": "3832b94286df7ed5d9538c280b788a162f5a21e6"}, "state": "APPROVED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yNFQwNDoyNzoyOVrOGoCgtQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yNFQwNDozMTozMFrOGoCkJw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NDYzNzM2NQ==", "bodyText": "can be removed", "url": "https://github.com/linkedin/ambry/pull/1574#discussion_r444637365", "createdAt": "2020-06-24T04:27:29Z", "author": {"login": "jsjtzyy"}, "path": "ambry-replication/src/test/java/com/github/ambry/replication/ReplicationTest.java", "diffHunk": "@@ -108,6 +108,7 @@\n import org.junit.Test;\n import org.junit.runner.RunWith;\n import org.junit.runners.Parameterized;\n+import org.mockito.Mock;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "3832b94286df7ed5d9538c280b788a162f5a21e6"}, "originalPosition": 4}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NDYzODI0Nw==", "bodyText": "minor:  checkSet is never used, consider removing it?  (Also, format this file please)", "url": "https://github.com/linkedin/ambry/pull/1574#discussion_r444638247", "createdAt": "2020-06-24T04:31:30Z", "author": {"login": "jsjtzyy"}, "path": "ambry-replication/src/test/java/com/github/ambry/replication/ReplicationTest.java", "diffHunk": "@@ -1417,6 +1418,9 @@ public void blockDeprecatedContainerReplicationTest() throws Exception {\n       }\n       Set<MessageInfo> remoteMissingStoreKeys = replicaThread.getMissingStoreMessages(replicaMetadataResponseInfo, remoteNode, remoteReplicaInfo);\n       assertEquals(\"All DELETE_IN_PROGRESS blobs qualified with retention time should be skipped during replication\", 0, remoteMissingStoreKeys.size());\n+      Map<StoreKey, StoreKey> remoteKeyToLocalKeyMap = replicaThread.batchConvertReplicaMetadataResponseKeys(response);\n+      replicaThread.processReplicaMetadataResponse(remoteMissingStoreKeys, replicaMetadataResponseInfo, remoteReplicaInfo,\n+          remoteNode, remoteKeyToLocalKeyMap);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "3832b94286df7ed5d9538c280b788a162f5a21e6"}, "originalPosition": 14}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDM2ODY0OTUy", "url": "https://github.com/linkedin/ambry/pull/1574#pullrequestreview-436864952", "createdAt": "2020-06-24T17:37:16Z", "commit": {"oid": "3832b94286df7ed5d9538c280b788a162f5a21e6"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1156, "cost": 1, "resetAt": "2021-11-01T16:19:10Z"}}}