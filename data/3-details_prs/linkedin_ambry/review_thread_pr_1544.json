{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDI2MTI3Njc4", "number": 1544, "reviewThreads": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wMlQwOTowMjowOVrOEBqF-A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wNVQxNzoyMzo1M1rOEDCTqQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjcwMTczNjg4OnYy", "diffSide": "RIGHT", "path": "ambry-clustermap/src/main/java/com/github/ambry/clustermap/HelixBootstrapUpgradeUtil.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wMlQwOTowMjowOVrOGdooCg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wM1QwNToxMzo0MlrOGeMS9w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMzcyNzQ5OA==", "bodyText": "Minor: formating, info(\"[{}] Instance {} already present in Helix...\",", "url": "https://github.com/linkedin/ambry/pull/1544#discussion_r433727498", "createdAt": "2020-06-02T09:02:09Z", "author": {"login": "xuhao417347761"}, "path": "ambry-clustermap/src/main/java/com/github/ambry/clustermap/HelixBootstrapUpgradeUtil.java", "diffHunk": "@@ -863,22 +877,30 @@ private void addUpdateInstances(String dcName, Map<String, Set<String>> partitio\n             // the appropriate instanceConfig that is constructed with the correct values from both).\n             // For now, only bootstrapping cluster is allowed to directly change InstanceConfig\n             dcAdmin.setInstanceConfig(clusterName, instanceName, instanceConfigFromStatic);\n+          } else {\n+            info(", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "a6a1a6a2d59b0d62ae145b09f1cc18745fa6298e"}, "originalPosition": 151}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNDMxMTkyNw==", "bodyText": "Actually it has been formatted by intellij, as I did option+cmd+L.", "url": "https://github.com/linkedin/ambry/pull/1544#discussion_r434311927", "createdAt": "2020-06-03T05:13:42Z", "author": {"login": "jsjtzyy"}, "path": "ambry-clustermap/src/main/java/com/github/ambry/clustermap/HelixBootstrapUpgradeUtil.java", "diffHunk": "@@ -863,22 +877,30 @@ private void addUpdateInstances(String dcName, Map<String, Set<String>> partitio\n             // the appropriate instanceConfig that is constructed with the correct values from both).\n             // For now, only bootstrapping cluster is allowed to directly change InstanceConfig\n             dcAdmin.setInstanceConfig(clusterName, instanceName, instanceConfigFromStatic);\n+          } else {\n+            info(", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMzcyNzQ5OA=="}, "originalCommit": {"oid": "a6a1a6a2d59b0d62ae145b09f1cc18745fa6298e"}, "originalPosition": 151}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjcwMTc2MjEzOnYy", "diffSide": "RIGHT", "path": "ambry-clustermap/src/main/java/com/github/ambry/clustermap/HelixBootstrapUpgradeUtil.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wMlQwOTowODo0MVrOGdo3mg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wM1QwNToxMTozNVrOGeMQww==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMzczMTQ4Mg==", "bodyText": "The ZNRecordSerializer, HelixZkClient and ZKHelixAdmin are deprecated. Maybe add a to-do to update in the future?", "url": "https://github.com/linkedin/ambry/pull/1544#discussion_r433731482", "createdAt": "2020-06-02T09:08:41Z", "author": {"login": "xuhao417347761"}, "path": "ambry-clustermap/src/main/java/com/github/ambry/clustermap/HelixBootstrapUpgradeUtil.java", "diffHunk": "@@ -464,8 +465,21 @@ private HelixBootstrapUpgradeUtil(String hardwareLayoutPath, String partitionLay\n         throw new IllegalArgumentException(\n             entry.getKey() + \" has invalid number of ZK endpoints: \" + zkConnectStrs.size());\n       }\n-      HelixAdmin admin = helixAdminFactory.getHelixAdmin(zkConnectStrs.get(0));\n+      HelixAdmin admin;\n+      RealmAwareZkClient zkClient = null;\n+      if (helixAdminFactory == null) {\n+        RealmAwareZkClient.RealmAwareZkClientConfig clientConfig =\n+            new RealmAwareZkClient.RealmAwareZkClientConfig().setConnectInitTimeout(30 * 1000L)\n+                .setZkSerializer(new ZNRecordSerializer());", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "a6a1a6a2d59b0d62ae145b09f1cc18745fa6298e"}, "originalPosition": 133}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNDMxMTM2Mw==", "bodyText": "sure, will do", "url": "https://github.com/linkedin/ambry/pull/1544#discussion_r434311363", "createdAt": "2020-06-03T05:11:35Z", "author": {"login": "jsjtzyy"}, "path": "ambry-clustermap/src/main/java/com/github/ambry/clustermap/HelixBootstrapUpgradeUtil.java", "diffHunk": "@@ -464,8 +465,21 @@ private HelixBootstrapUpgradeUtil(String hardwareLayoutPath, String partitionLay\n         throw new IllegalArgumentException(\n             entry.getKey() + \" has invalid number of ZK endpoints: \" + zkConnectStrs.size());\n       }\n-      HelixAdmin admin = helixAdminFactory.getHelixAdmin(zkConnectStrs.get(0));\n+      HelixAdmin admin;\n+      RealmAwareZkClient zkClient = null;\n+      if (helixAdminFactory == null) {\n+        RealmAwareZkClient.RealmAwareZkClientConfig clientConfig =\n+            new RealmAwareZkClient.RealmAwareZkClientConfig().setConnectInitTimeout(30 * 1000L)\n+                .setZkSerializer(new ZNRecordSerializer());", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMzczMTQ4Mg=="}, "originalCommit": {"oid": "a6a1a6a2d59b0d62ae145b09f1cc18745fa6298e"}, "originalPosition": 133}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjcxNjE4OTg1OnYy", "diffSide": "RIGHT", "path": "ambry-tools/src/main/java/com/github/ambry/clustermap/HelixVcrPopulateTool.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wNVQxNzoyMzo1M1rOGf27jw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wNVQxNzoyMzo1M1rOGf27jw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNjA1OTAyMw==", "bodyText": "@ankagrawal this minor change should help us get rid of the warning messages we saw when building a new VCR cluster.", "url": "https://github.com/linkedin/ambry/pull/1544#discussion_r436059023", "createdAt": "2020-06-05T17:23:53Z", "author": {"login": "jsjtzyy"}, "path": "ambry-tools/src/main/java/com/github/ambry/clustermap/HelixVcrPopulateTool.java", "diffHunk": "@@ -145,7 +146,7 @@ public static void main(String[] args) {\n   static void createCluster(String destZkString, String destClusterName) {\n     HelixZkClient destZkClient = getHelixZkClient(destZkString);\n     HelixAdmin destAdmin = new ZKHelixAdmin(destZkClient);\n-    if (destAdmin.getClusters().contains(destClusterName)) {\n+    if (ZKUtil.isClusterSetup(destClusterName, destZkClient)) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c2f5e4183bd85771ccf61ff8b08c43bc73ba6773"}, "originalPosition": 13}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1212, "cost": 1, "resetAt": "2021-11-12T20:44:06Z"}}}