{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDM0OTM4MjMx", "number": 1565, "title": "Fix incorrect variable assignment in DynamicClusterChangeHandler", "bodyText": "PR1522 mistakenly assigned getStoppedReplicas() from dataNodeConfig to\nsealedReplicas variable. This PR fixed it and added debug log.", "createdAt": "2020-06-16T02:42:11Z", "url": "https://github.com/linkedin/ambry/pull/1565", "merged": true, "mergeCommit": {"oid": "1cabc1fe98a9c59de4fde6984998fe4ec94699a8"}, "closed": true, "closedAt": "2020-06-16T17:10:00Z", "author": {"login": "jsjtzyy"}, "timelineItems": {"totalCount": 5, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcrr60DgH2gAyNDM0OTM4MjMxOjYxNTI0NTI5MGE1MmEwNTRjODc4ZTE3NmExNWUwNjYwZTZiODgyMjM=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcr30q2AFqTQzMTY4MzcyOA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "615245290a52a054c878e176a15e0660e6b88223", "author": {"user": {"login": "jsjtzyy", "name": "Yingyi Zhang"}}, "url": "https://github.com/linkedin/ambry/commit/615245290a52a054c878e176a15e0660e6b88223", "committedDate": "2020-06-16T02:34:59Z", "message": "Fix a bug in variable assigment in DynamicClusterChangeHandler\n\nPR1522 mistakenly assigned getStoppedReplicas() from dataNodeConfig to\nsealedReplicas variable. This PR fixed it and added debug log."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDMxMTIxNDI1", "url": "https://github.com/linkedin/ambry/pull/1565#pullrequestreview-431121425", "createdAt": "2020-06-16T02:43:04Z", "commit": {"oid": "615245290a52a054c878e176a15e0660e6b88223"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xNlQwMjo0MzowNFrOGkJR9A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xNlQwMjo0MzowNFrOGkJR9A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MDU1Mzk3Mg==", "bodyText": "This change comes from formatting file. No logic change.", "url": "https://github.com/linkedin/ambry/pull/1565#discussion_r440553972", "createdAt": "2020-06-16T02:43:04Z", "author": {"login": "jsjtzyy"}, "path": "ambry-clustermap/src/main/java/com/github/ambry/clustermap/DynamicClusterChangeHandler.java", "diffHunk": "@@ -356,8 +358,8 @@ private void addOrUpdateInstanceInfos(Iterable<DataNodeConfig> dataNodeConfigs)\n               new AmbryPartition(Long.parseLong(partitionName), replicaConfig.getPartitionClass(),\n                   helixClusterManagerCallback);\n           // Ensure only one AmbryPartition instance exists for specific partition.\n-          mappedPartition =\n-              clusterChangeHandlerCallback.addPartitionIfAbsent(mappedPartition, replicaConfig.getReplicaCapacityInBytes());\n+          mappedPartition = clusterChangeHandlerCallback.addPartitionIfAbsent(mappedPartition,\n+              replicaConfig.getReplicaCapacityInBytes());", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "615245290a52a054c878e176a15e0660e6b88223"}, "originalPosition": 29}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDMxMTIxNDk2", "url": "https://github.com/linkedin/ambry/pull/1565#pullrequestreview-431121496", "createdAt": "2020-06-16T02:43:19Z", "commit": {"oid": "615245290a52a054c878e176a15e0660e6b88223"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xNlQwMjo0MzoxOVrOGkJSKg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xNlQwMjo0MzoxOVrOGkJSKg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MDU1NDAyNg==", "bodyText": "same here", "url": "https://github.com/linkedin/ambry/pull/1565#discussion_r440554026", "createdAt": "2020-06-16T02:43:19Z", "author": {"login": "jsjtzyy"}, "path": "ambry-clustermap/src/main/java/com/github/ambry/clustermap/DynamicClusterChangeHandler.java", "diffHunk": "@@ -472,8 +474,8 @@ private void updateReplicaStateAndOverrideIfNeeded(AmbryReplica replica, Collect\n       DataNodeConfig.DiskConfig diskConfig = diskEntry.getValue();\n \n       // Create disk\n-      AmbryDisk disk =\n-          new AmbryDisk(clusterMapConfig, datanode, mountPath, diskConfig.getState(), diskConfig.getDiskCapacityInBytes());\n+      AmbryDisk disk = new AmbryDisk(clusterMapConfig, datanode, mountPath, diskConfig.getState(),\n+          diskConfig.getDiskCapacityInBytes());", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "615245290a52a054c878e176a15e0660e6b88223"}, "originalPosition": 40}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDMxMTIxNTU1", "url": "https://github.com/linkedin/ambry/pull/1565#pullrequestreview-431121555", "createdAt": "2020-06-16T02:43:33Z", "commit": {"oid": "615245290a52a054c878e176a15e0660e6b88223"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xNlQwMjo0MzozM1rOGkJSag==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xNlQwMjo0MzozM1rOGkJSag==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MDU1NDA5MA==", "bodyText": "same here, no production code change", "url": "https://github.com/linkedin/ambry/pull/1565#discussion_r440554090", "createdAt": "2020-06-16T02:43:33Z", "author": {"login": "jsjtzyy"}, "path": "ambry-clustermap/src/main/java/com/github/ambry/clustermap/DynamicClusterChangeHandler.java", "diffHunk": "@@ -485,9 +487,10 @@ private void updateReplicaStateAndOverrideIfNeeded(AmbryReplica replica, Collect\n             new AmbryPartition(Long.parseLong(partitionName), replicaConfig.getPartitionClass(),\n                 helixClusterManagerCallback);\n         // Ensure only one AmbryPartition instance exists for specific partition.\n-        mappedPartition =\n-            clusterChangeHandlerCallback.addPartitionIfAbsent(mappedPartition, replicaConfig.getReplicaCapacityInBytes());\n-        ensurePartitionAbsenceOnNodeAndValidateCapacity(mappedPartition, datanode, replicaConfig.getReplicaCapacityInBytes());\n+        mappedPartition = clusterChangeHandlerCallback.addPartitionIfAbsent(mappedPartition,\n+            replicaConfig.getReplicaCapacityInBytes());\n+        ensurePartitionAbsenceOnNodeAndValidateCapacity(mappedPartition, datanode,\n+            replicaConfig.getReplicaCapacityInBytes());", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "615245290a52a054c878e176a15e0660e6b88223"}, "originalPosition": 54}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDMxNjgzNzI4", "url": "https://github.com/linkedin/ambry/pull/1565#pullrequestreview-431683728", "createdAt": "2020-06-16T16:27:08Z", "commit": {"oid": "615245290a52a054c878e176a15e0660e6b88223"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1138, "cost": 1, "resetAt": "2021-11-01T16:19:10Z"}}}