{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0Mzg1NzI2NDQ3", "number": 1420, "title": "Refactor test utils into ambry-test-utils subproj", "bodyText": "There are many test utilities that are shared across many subprojects\nand even dependended on when writing tests for wrappers that extend open\nsource Ambry (like AmbryLI for LinkedIn). Generally, depending on test\nartifacts across projects is not a great practice (issues handling\ntransitive dependencies with non-standard classifiers), so this project\nmoves the test utilities used across repos into an ambry-test-utils\nsubproject.\nFor now, this targets moving only the test dependencies that are\ndepended on by LinkedIn internal projects to ambry-test-utils. Going\nforward, we can simplify our test dependencies within the open source\nrepo by moving more classes into ambry-test-utils.\nFor tests that still depend on other subprojects' tests, this commit\nswitches from using source sets to a configuration based approach. This\nensures that test classes are always built after their dependencies are\ncompiled and ensures that transitive dependencies are placed on the\nclasspath at runtime.\nSee https://softnoise.wordpress.com/2014/09/07/gradle-sub-project-test-dependencies-in-multi-project-builds/\nReviewer notes:\n\nTo test this, I published to ~/local-repo using ./gradlew -Dmaven.repo.local=$HOME/local-repo publishToMavenLocal.\nI then added the ambry libraries as external dependencies in AmbryLI. See https://rb.corp.linkedin.com/r/2003587/ for reference.\nMost of the actual changes in the diff are either from the new way of declaring test dependencies\nin build.gradle or from moving the getRandomString method from UtilsTest to TestUtils.", "createdAt": "2020-03-09T17:42:31Z", "url": "https://github.com/linkedin/ambry/pull/1420", "merged": true, "mergeCommit": {"oid": "6ccde66053678c0c16f067969d5b7eb1040dc396"}, "closed": true, "closedAt": "2020-03-12T00:06:13Z", "author": {"login": "cgtz"}, "timelineItems": {"totalCount": 7, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcMfD2RABqjMxMTcyNDExODA=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcMwP6kAFqTM3MzIwNDI2Ng==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "7eb8f40279b08ff18083a8ce5531cefc6d2eaf45", "author": {"user": {"login": "cgtz", "name": "Casey Getz"}}, "url": "https://github.com/linkedin/ambry/commit/7eb8f40279b08ff18083a8ce5531cefc6d2eaf45", "committedDate": "2020-03-09T17:41:27Z", "message": "Refactor test utils into ambry-test-utils subproj\n\nThere are many test utilities that are shared across many subprojects\nand even dependended on when writing tests for wrappers that extend open\nsource Ambry (like AmbryLI for LinkedIn). Generally, depending on test\nartifacts across projects is not a great practice (issues handling\ntransitive dependencies with non-standard classifiers), so this project\nmoves the test utilities used across repos into an ambry-test-utils\nsubproject.\n\nFor now, this targets moving only the test dependencies that are\ndepended on by LinkedIn internal projects to ambry-test-utils. Going\nforward, we can simplify our test dependencies within the open source\nrepo by moving more classes into ambry-test-utils."}, "afterCommit": {"oid": "24ccc3021af95d593236689fbc0d4ac00fd8607e", "author": {"user": {"login": "cgtz", "name": "Casey Getz"}}, "url": "https://github.com/linkedin/ambry/commit/24ccc3021af95d593236689fbc0d4ac00fd8607e", "committedDate": "2020-03-11T03:58:57Z", "message": "Refactor test utils into ambry-test-utils subproj\n\nThere are many test utilities that are shared across many subprojects\nand even dependended on when writing tests for wrappers that extend open\nsource Ambry (like AmbryLI for LinkedIn). Generally, depending on test\nartifacts across projects is not a great practice (issues handling\ntransitive dependencies with non-standard classifiers), so this project\nmoves the test utilities used across repos into an ambry-test-utils\nsubproject.\n\nFor now, this targets moving only the test dependencies that are\ndepended on by LinkedIn internal projects to ambry-test-utils. Going\nforward, we can simplify our test dependencies within the open source\nrepo by moving more classes into ambry-test-utils.\n\nFor tests that still depend on other subprojects' tests, this commit\nswitches from using source sets to a configuration based approach. This\nensures that test classes are always built after their dependencies are\ncompiled. See https://softnoise.wordpress.com/2014/09/07/gradle-sub-project-test-dependencies-in-multi-project-builds/"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "24ccc3021af95d593236689fbc0d4ac00fd8607e", "author": {"user": {"login": "cgtz", "name": "Casey Getz"}}, "url": "https://github.com/linkedin/ambry/commit/24ccc3021af95d593236689fbc0d4ac00fd8607e", "committedDate": "2020-03-11T03:58:57Z", "message": "Refactor test utils into ambry-test-utils subproj\n\nThere are many test utilities that are shared across many subprojects\nand even dependended on when writing tests for wrappers that extend open\nsource Ambry (like AmbryLI for LinkedIn). Generally, depending on test\nartifacts across projects is not a great practice (issues handling\ntransitive dependencies with non-standard classifiers), so this project\nmoves the test utilities used across repos into an ambry-test-utils\nsubproject.\n\nFor now, this targets moving only the test dependencies that are\ndepended on by LinkedIn internal projects to ambry-test-utils. Going\nforward, we can simplify our test dependencies within the open source\nrepo by moving more classes into ambry-test-utils.\n\nFor tests that still depend on other subprojects' tests, this commit\nswitches from using source sets to a configuration based approach. This\nensures that test classes are always built after their dependencies are\ncompiled. See https://softnoise.wordpress.com/2014/09/07/gradle-sub-project-test-dependencies-in-multi-project-builds/"}, "afterCommit": {"oid": "7f84ad21cd47f3df0877fc26046a90aa6db81c8b", "author": {"user": {"login": "cgtz", "name": "Casey Getz"}}, "url": "https://github.com/linkedin/ambry/commit/7f84ad21cd47f3df0877fc26046a90aa6db81c8b", "committedDate": "2020-03-11T17:36:21Z", "message": "Refactor test utils into ambry-test-utils subproj\n\nThere are many test utilities that are shared across many subprojects\nand even dependended on when writing tests for wrappers that extend open\nsource Ambry (like AmbryLI for LinkedIn). Generally, depending on test\nartifacts across projects is not a great practice (issues handling\ntransitive dependencies with non-standard classifiers), so this project\nmoves the test utilities used across repos into an ambry-test-utils\nsubproject.\n\nFor now, this targets moving only the test dependencies that are\ndepended on by LinkedIn internal projects to ambry-test-utils. Going\nforward, we can simplify our test dependencies within the open source\nrepo by moving more classes into ambry-test-utils.\n\nFor tests that still depend on other subprojects' tests, this commit\nswitches from using source sets to a configuration based approach. This\nensures that test classes are always built after their dependencies are\ncompiled. See https://softnoise.wordpress.com/2014/09/07/gradle-sub-project-test-dependencies-in-multi-project-builds/"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzczMDExNzQw", "url": "https://github.com/linkedin/ambry/pull/1420#pullrequestreview-373011740", "createdAt": "2020-03-11T18:17:10Z", "commit": {"oid": "7f84ad21cd47f3df0877fc26046a90aa6db81c8b"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xMVQxODoxNzoxMFrOF1DOfg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xMVQxODoxNzoxMFrOF1DOfg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MTE3MTcxMA==", "bodyText": "The diff looks weird in the class, but the change I made is to change the package-private classes below InMemoryRouter in this file into private static inner classes, since they are not used anywhere outside of InMemoryRouter", "url": "https://github.com/linkedin/ambry/pull/1420#discussion_r391171710", "createdAt": "2020-03-11T18:17:10Z", "author": {"login": "cgtz"}, "path": "ambry-test-utils/src/main/java/com/github/ambry/router/InMemoryRouter.java", "diffHunk": "@@ -391,195 +398,175 @@ protected static void completeOperation(FutureResult futureResult, Callback call\n       callback.onCompletion(operationResult, exception);\n     }\n   }\n-}\n-\n-/**\n- * Thread to read the post data async and store it.\n- */\n-class InMemoryBlobPoster implements Runnable {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "7f84ad21cd47f3df0877fc26046a90aa6db81c8b"}, "originalPosition": 65}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "d12046925dd156ffede8b8691475064ca7330615", "author": {"user": {"login": "cgtz", "name": "Casey Getz"}}, "url": "https://github.com/linkedin/ambry/commit/d12046925dd156ffede8b8691475064ca7330615", "committedDate": "2020-03-11T18:20:27Z", "message": "Refactor test utils into ambry-test-utils subproj\n\nThere are many test utilities that are shared across many subprojects\nand even dependended on when writing tests for wrappers that extend open\nsource Ambry (like AmbryLI for LinkedIn). Generally, depending on test\nartifacts across projects is not a great practice (issues handling\ntransitive dependencies with non-standard classifiers), so this project\nmoves the test utilities used across repos into an ambry-test-utils\nsubproject.\n\nFor now, this targets moving only the test dependencies that are\ndepended on by LinkedIn internal projects to ambry-test-utils. Going\nforward, we can simplify our test dependencies within the open source\nrepo by moving more classes into ambry-test-utils.\n\nFor tests that still depend on other subprojects' tests, this commit\nswitches from using source sets to a configuration based approach. This\nensures that test classes are always built after their dependencies are\ncompiled. See https://softnoise.wordpress.com/2014/09/07/gradle-sub-project-test-dependencies-in-multi-project-builds/"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "7f84ad21cd47f3df0877fc26046a90aa6db81c8b", "author": {"user": {"login": "cgtz", "name": "Casey Getz"}}, "url": "https://github.com/linkedin/ambry/commit/7f84ad21cd47f3df0877fc26046a90aa6db81c8b", "committedDate": "2020-03-11T17:36:21Z", "message": "Refactor test utils into ambry-test-utils subproj\n\nThere are many test utilities that are shared across many subprojects\nand even dependended on when writing tests for wrappers that extend open\nsource Ambry (like AmbryLI for LinkedIn). Generally, depending on test\nartifacts across projects is not a great practice (issues handling\ntransitive dependencies with non-standard classifiers), so this project\nmoves the test utilities used across repos into an ambry-test-utils\nsubproject.\n\nFor now, this targets moving only the test dependencies that are\ndepended on by LinkedIn internal projects to ambry-test-utils. Going\nforward, we can simplify our test dependencies within the open source\nrepo by moving more classes into ambry-test-utils.\n\nFor tests that still depend on other subprojects' tests, this commit\nswitches from using source sets to a configuration based approach. This\nensures that test classes are always built after their dependencies are\ncompiled. See https://softnoise.wordpress.com/2014/09/07/gradle-sub-project-test-dependencies-in-multi-project-builds/"}, "afterCommit": {"oid": "d12046925dd156ffede8b8691475064ca7330615", "author": {"user": {"login": "cgtz", "name": "Casey Getz"}}, "url": "https://github.com/linkedin/ambry/commit/d12046925dd156ffede8b8691475064ca7330615", "committedDate": "2020-03-11T18:20:27Z", "message": "Refactor test utils into ambry-test-utils subproj\n\nThere are many test utilities that are shared across many subprojects\nand even dependended on when writing tests for wrappers that extend open\nsource Ambry (like AmbryLI for LinkedIn). Generally, depending on test\nartifacts across projects is not a great practice (issues handling\ntransitive dependencies with non-standard classifiers), so this project\nmoves the test utilities used across repos into an ambry-test-utils\nsubproject.\n\nFor now, this targets moving only the test dependencies that are\ndepended on by LinkedIn internal projects to ambry-test-utils. Going\nforward, we can simplify our test dependencies within the open source\nrepo by moving more classes into ambry-test-utils.\n\nFor tests that still depend on other subprojects' tests, this commit\nswitches from using source sets to a configuration based approach. This\nensures that test classes are always built after their dependencies are\ncompiled. See https://softnoise.wordpress.com/2014/09/07/gradle-sub-project-test-dependencies-in-multi-project-builds/"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzczMTMxNDY0", "url": "https://github.com/linkedin/ambry/pull/1420#pullrequestreview-373131464", "createdAt": "2020-03-11T21:16:41Z", "commit": {"oid": "d12046925dd156ffede8b8691475064ca7330615"}, "state": "APPROVED", "comments": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xMVQyMToxNjo0MVrOF1JaBw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xMVQyMToyNTozM1rOF1JqWg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MTI3Mjk2Nw==", "bodyText": "Why static import in this class?", "url": "https://github.com/linkedin/ambry/pull/1420#discussion_r391272967", "createdAt": "2020-03-11T21:16:41Z", "author": {"login": "lightningrob"}, "path": "ambry-clustermap/src/test/java/com.github.ambry.clustermap/ClusterMapUtilsTest.java", "diffHunk": "@@ -26,6 +25,7 @@\n import org.junit.Test;\n import org.mockito.Mockito;\n \n+import static com.github.ambry.utils.TestUtils.*;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d12046925dd156ffede8b8691475064ca7330615"}, "originalPosition": 12}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MTI3NTY0Mg==", "bodyText": "javadoc", "url": "https://github.com/linkedin/ambry/pull/1420#discussion_r391275642", "createdAt": "2020-03-11T21:22:18Z", "author": {"login": "lightningrob"}, "path": "ambry-test-utils/src/main/java/com/github/ambry/router/InMemoryRouter.java", "diffHunk": "@@ -376,6 +375,14 @@ private boolean handlePrechecks(FutureResult futureResult, Callback callback) {\n     return continueOp;\n   }\n \n+  private void checkBlobId(String blobId) throws RouterException {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d12046925dd156ffede8b8691475064ca7330615"}, "originalPosition": 45}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MTI3Njg1NQ==", "bodyText": "Is this needed, or even correct?  Nearly all our javadocs have the two star convention.", "url": "https://github.com/linkedin/ambry/pull/1420#discussion_r391276855", "createdAt": "2020-03-11T21:24:58Z", "author": {"login": "lightningrob"}, "path": "ambry-test-utils/src/main/java/com/github/ambry/utils/HelixControllerManager.java", "diffHunk": "@@ -1,4 +1,4 @@\n-/**\n+/*", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d12046925dd156ffede8b8691475064ca7330615"}, "originalPosition": 2}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MTI3NzE0Ng==", "bodyText": "javadoc", "url": "https://github.com/linkedin/ambry/pull/1420#discussion_r391277146", "createdAt": "2020-03-11T21:25:33Z", "author": {"login": "lightningrob"}, "path": "ambry-test-utils/src/main/java/com/github/ambry/utils/TestUtils.java", "diffHunk": "@@ -232,6 +233,14 @@ public static String getRandomKey(int size) {\n     return sb.toString();\n   }\n \n+  public static String getRandomString(int length) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d12046925dd156ffede8b8691475064ca7330615"}, "originalPosition": 18}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzczMjA0MjY2", "url": "https://github.com/linkedin/ambry/pull/1420#pullrequestreview-373204266", "createdAt": "2020-03-12T00:06:00Z", "commit": {"oid": "d12046925dd156ffede8b8691475064ca7330615"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1678, "cost": 1, "resetAt": "2021-11-01T16:19:10Z"}}}