{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTAwODcwMDE1", "number": 1654, "title": "Small changes for test resilience and exception logging", "bodyText": "", "createdAt": "2020-10-09T23:55:22Z", "url": "https://github.com/linkedin/ambry/pull/1654", "merged": true, "mergeCommit": {"oid": "d63382be933f2228884dd26ad7969fec66bf5435"}, "closed": true, "closedAt": "2020-10-13T00:18:50Z", "author": {"login": "lightningrob"}, "timelineItems": {"totalCount": 6, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdQ_VwCAH2gAyNTAwODcwMDE1OjU1NGQ4ZTQ5OWViZTYxM2U4YjhmMGU3MjAyZGUzNTYxYmJkNzk2Yjc=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdR8Aq3gFqTUwNjk2MTU5NQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "554d8e499ebe613e8b8f0e7202de3561bbd796b7", "author": {"user": {"login": "shipkit-org", "name": "shipkit.org automated bot"}}, "url": "https://github.com/linkedin/ambry/commit/554d8e499ebe613e8b8f0e7202de3561bbd796b7", "committedDate": "2020-10-10T00:07:48Z", "message": "Small changes for test resilience and exception logging"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "e58eb5f34fecddfa9dc50c391132ae805bad9ea4", "author": {"user": {"login": "shipkit-org", "name": "shipkit.org automated bot"}}, "url": "https://github.com/linkedin/ambry/commit/e58eb5f34fecddfa9dc50c391132ae805bad9ea4", "committedDate": "2020-10-09T23:48:54Z", "message": "Small changes for test resilience and exception logging"}, "afterCommit": {"oid": "554d8e499ebe613e8b8f0e7202de3561bbd796b7", "author": {"user": {"login": "shipkit-org", "name": "shipkit.org automated bot"}}, "url": "https://github.com/linkedin/ambry/commit/554d8e499ebe613e8b8f0e7202de3561bbd796b7", "committedDate": "2020-10-10T00:07:48Z", "message": "Small changes for test resilience and exception logging"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTA2NzcxNTA2", "url": "https://github.com/linkedin/ambry/pull/1654#pullrequestreview-506771506", "createdAt": "2020-10-12T16:41:53Z", "commit": {"oid": "554d8e499ebe613e8b8f0e7202de3561bbd796b7"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xMlQxNjo0MTo1M1rOHgF7bg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xMlQxNjo0MTo1M1rOHgF7bg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMzQxMzYxNA==", "bodyText": "There might be an edge case where local store was started when exchanging metadata and sending get request but it became unavailable on receiving blobs.  If we look at line 1106 ~ line 1111, we probably get an incorrect partitionResponseInfoIndex in subsequent iteration because we skip directly here without updating partitionResponseInfoIndex. What do you think?", "url": "https://github.com/linkedin/ambry/pull/1654#discussion_r503413614", "createdAt": "2020-10-12T16:41:53Z", "author": {"login": "jsjtzyy"}, "path": "ambry-replication/src/main/java/com/github/ambry/replication/ReplicaThread.java", "diffHunk": "@@ -1097,6 +1097,12 @@ private void writeMessagesToLocalStoreAndAdvanceTokens(List<ExchangeMetadataResp\n     for (int i = 0; i < exchangeMetadataResponseList.size(); i++) {\n       ExchangeMetadataResponse exchangeMetadataResponse = exchangeMetadataResponseList.get(i);\n       RemoteReplicaInfo remoteReplicaInfo = replicasToReplicatePerNode.get(i);\n+      if (!remoteReplicaInfo.getLocalStore().isStarted()) {\n+        logger.debug(\"Store for {} is stopped, dropping metadata response.\",\n+            remoteReplicaInfo.getReplicaId().getPartitionId().toPathString());\n+        continue;\n+      }", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "554d8e499ebe613e8b8f0e7202de3561bbd796b7"}, "originalPosition": 8}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTA2ODAwNzcz", "url": "https://github.com/linkedin/ambry/pull/1654#pullrequestreview-506800773", "createdAt": "2020-10-12T17:31:29Z", "commit": {"oid": "554d8e499ebe613e8b8f0e7202de3561bbd796b7"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "3e9150cc886123c35df378f936dbb00c4c852045", "author": {"user": {"login": "shipkit-org", "name": "shipkit.org automated bot"}}, "url": "https://github.com/linkedin/ambry/commit/3e9150cc886123c35df378f936dbb00c4c852045", "committedDate": "2020-10-12T22:47:08Z", "message": "Address review feedback"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTA2OTYxNTk1", "url": "https://github.com/linkedin/ambry/pull/1654#pullrequestreview-506961595", "createdAt": "2020-10-12T22:48:59Z", "commit": {"oid": "3e9150cc886123c35df378f936dbb00c4c852045"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 935, "cost": 1, "resetAt": "2021-11-01T16:19:10Z"}}}