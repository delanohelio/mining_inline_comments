{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDk3MTQ1OTE3", "number": 1642, "title": "Return copy of Set references in ExchangeMetadataResponse get methods to avoid concurrentModificationException", "bodyText": "Due to multiple replica threads referencing same references of ExchangeMetadataResponse Set collection, modification of set by one thread while iterating over it in another thread is resulting in concurrentModificationException. Return copy of set references in get() methods to avoid it.", "createdAt": "2020-10-02T21:35:10Z", "url": "https://github.com/linkedin/ambry/pull/1642", "merged": true, "mergeCommit": {"oid": "ae113e1a50e5f71b7517252dec3aa57276c2b344"}, "closed": true, "closedAt": "2020-10-05T18:37:26Z", "author": {"login": "Arun-LinkedIn"}, "timelineItems": {"totalCount": 5, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdOsxVWgH2gAyNDk3MTQ1OTE3OjQzYzliMDQ3OGE0ZDczYTljZGE4OWI3MjgzYzg4OGFiZTE1YTkxMzE=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdPoNZUAFqTUwMjMxOTQ1NQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "43c9b0478a4d73a9cda89b7283c888abe15a9131", "author": {"user": {"login": "Arun-LinkedIn", "name": "Arun Sai Bhima"}}, "url": "https://github.com/linkedin/ambry/commit/43c9b0478a4d73a9cda89b7283c888abe15a9131", "committedDate": "2020-10-02T21:21:53Z", "message": "Return copy of Set references in ExchangeMetadataResponse class to avoid concurrent modification exception."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTAxNDc1Mjg3", "url": "https://github.com/linkedin/ambry/pull/1642#pullrequestreview-501475287", "createdAt": "2020-10-02T22:16:07Z", "commit": {"oid": "43c9b0478a4d73a9cda89b7283c888abe15a9131"}, "state": "APPROVED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wMlQyMjoxNjowN1rOHb88Qg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wMlQyMjoxNjowN1rOHb88Qg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5OTA3MjA2Ng==", "bodyText": "I was under the impression the stream way to collect to set is deep copy, so this should be ok (better to confirm it)", "url": "https://github.com/linkedin/ambry/pull/1642#discussion_r499072066", "createdAt": "2020-10-02T22:16:07Z", "author": {"login": "jsjtzyy"}, "path": "ambry-replication/src/main/java/com/github/ambry/replication/ReplicaThread.java", "diffHunk": "@@ -1629,7 +1630,7 @@ synchronized boolean isEmpty() {\n     }\n \n     /**\n-     *  get the keys corresponding to the missing messages in local store\n+     *  Get the keys corresponding to the missing messages in local store\n      */\n     Set<StoreKey> getMissingStoreKeys() {\n       return missingStoreMessages == null ? Collections.emptySet()", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "43c9b0478a4d73a9cda89b7283c888abe15a9131"}, "originalPosition": 44}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTAyMjQ3NzY3", "url": "https://github.com/linkedin/ambry/pull/1642#pullrequestreview-502247767", "createdAt": "2020-10-05T16:57:13Z", "commit": {"oid": "43c9b0478a4d73a9cda89b7283c888abe15a9131"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wNVQxNjo1NzoxM1rOHclzVQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wNVQxNjo1NzoxM1rOHclzVQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5OTc0MTUyNQ==", "bodyText": "Should this method be synchronized too? It seems like missingStoreMessages can be mutated and using a stream is just like iterating through it and subject to a ConcurrentModificationException.", "url": "https://github.com/linkedin/ambry/pull/1642#discussion_r499741525", "createdAt": "2020-10-05T16:57:13Z", "author": {"login": "cgtz"}, "path": "ambry-replication/src/main/java/com/github/ambry/replication/ReplicaThread.java", "diffHunk": "@@ -1629,7 +1630,7 @@ synchronized boolean isEmpty() {\n     }\n \n     /**\n-     *  get the keys corresponding to the missing messages in local store\n+     *  Get the keys corresponding to the missing messages in local store\n      */\n     Set<StoreKey> getMissingStoreKeys() {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "43c9b0478a4d73a9cda89b7283c888abe15a9131"}, "originalPosition": 43}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "74421fab61b0256a38eef36416deb9933a7d4d37", "author": {"user": {"login": "Arun-LinkedIn", "name": "Arun Sai Bhima"}}, "url": "https://github.com/linkedin/ambry/commit/74421fab61b0256a38eef36416deb9933a7d4d37", "committedDate": "2020-10-05T17:23:37Z", "message": "Address casey's comment to synchronize getMissingStoreKeys() method"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTAyMzE5NDU1", "url": "https://github.com/linkedin/ambry/pull/1642#pullrequestreview-502319455", "createdAt": "2020-10-05T18:36:56Z", "commit": {"oid": "74421fab61b0256a38eef36416deb9933a7d4d37"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1285, "cost": 1, "resetAt": "2021-11-01T16:19:10Z"}}}