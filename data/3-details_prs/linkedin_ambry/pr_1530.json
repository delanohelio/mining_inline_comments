{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDIxNTc3OTcx", "number": 1530, "title": "Fix a test failure where delete request arrives after undelete", "bodyText": "This should fix an ambry-server integration test failure in the RouterTest, where a delete is acknowledged by the notification system, but actually one of the delete requests is handled after undelete.\nThis is the link to the test failure #1526\nThis is what happened.\n\nRouter issues a delete operation, which sends three delete requests to three hosts\nTwo hosts responds and at the same time, third host replicates delete from first two\nAll three hosts has delete so the notification system is acknowledged.\nRouter issues a undelete operation, which sends undelets request to third host\nAfter undelete, somehow the delete request from previous delete operation just arrives at the third host. This would mark blob deleted.\n\nAnd that's how we get a Blob_Deleted after undelete.\nThe fix is pretty simple, change the delete parallelism to 2 so we don't have a dangling delete request.", "createdAt": "2020-05-21T20:48:02Z", "url": "https://github.com/linkedin/ambry/pull/1530", "merged": true, "mergeCommit": {"oid": "0387d91c66b64cb034cbf3fc083d67ba3349ed84"}, "closed": true, "closedAt": "2020-05-27T20:31:05Z", "author": {"login": "justinlin-linkedin"}, "timelineItems": {"totalCount": 10, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcjrLUpgFqTQxNjY1MTEyMA==", "endCursor": "Y3Vyc29yOnYyOpPPAAABclfLk_gFqTQxOTU3ODQ2NA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDE2NjUxMTIw", "url": "https://github.com/linkedin/ambry/pull/1530#pullrequestreview-416651120", "createdAt": "2020-05-22T05:10:21Z", "commit": {"oid": "0397ca77ae14999cd477ea8127319ecfed7f9c3c"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yMlQwNToxMDoyMVrOGZK1zg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yMlQwNToxMDoyMVrOGZK1zg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyOTA0NTE5OA==", "bodyText": "not needed?", "url": "https://github.com/linkedin/ambry/pull/1530#discussion_r429045198", "createdAt": "2020-05-22T05:10:21Z", "author": {"login": "zzmao"}, "path": "ambry-server/src/integration-test/java/com/github/ambry/server/RouterServerTestFramework.java", "diffHunk": "@@ -141,6 +142,7 @@ void checkOperationChains(List<OperationChain> opChains) throws Exception {\n         partitionCount.put(partitionId, count + 1);\n       }\n     }\n+    /*", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "0397ca77ae14999cd477ea8127319ecfed7f9c3c"}, "originalPosition": 23}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "16c79897804e5e87f912770cb83795c2f97aa67e", "author": {"user": {"login": "justinlin-linkedin", "name": "Justin Lin"}}, "url": "https://github.com/linkedin/ambry/commit/16c79897804e5e87f912770cb83795c2f97aa67e", "committedDate": "2020-05-22T17:05:56Z", "message": "Remove comments"}, "afterCommit": {"oid": "9c3595197c995bc55a125d5bdf31bbfe840a04ff", "author": {"user": {"login": "justinlin-linkedin", "name": "Justin Lin"}}, "url": "https://github.com/linkedin/ambry/commit/9c3595197c995bc55a125d5bdf31bbfe840a04ff", "committedDate": "2020-05-22T19:55:39Z", "message": "Remove comments"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "9c3595197c995bc55a125d5bdf31bbfe840a04ff", "author": {"user": {"login": "justinlin-linkedin", "name": "Justin Lin"}}, "url": "https://github.com/linkedin/ambry/commit/9c3595197c995bc55a125d5bdf31bbfe840a04ff", "committedDate": "2020-05-22T19:55:39Z", "message": "Remove comments"}, "afterCommit": {"oid": "c8cff50f32801c33b560fe160252263c9bb88e6d", "author": {"user": {"login": "justinlin-linkedin", "name": "Justin Lin"}}, "url": "https://github.com/linkedin/ambry/commit/c8cff50f32801c33b560fe160252263c9bb88e6d", "committedDate": "2020-05-25T20:24:45Z", "message": "Remove comments"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "efe79e8b52ae713a32097813ce5012e59ba56888", "author": {"user": {"login": "justinlin-linkedin", "name": "Justin Lin"}}, "url": "https://github.com/linkedin/ambry/commit/efe79e8b52ae713a32097813ce5012e59ba56888", "committedDate": "2020-05-26T22:53:09Z", "message": "Fix a test failure where delete request arrives after undelete"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ab5f7337a60be98b84b178467d8d36f0bf811151", "author": {"user": {"login": "justinlin-linkedin", "name": "Justin Lin"}}, "url": "https://github.com/linkedin/ambry/commit/ab5f7337a60be98b84b178467d8d36f0bf811151", "committedDate": "2020-05-26T22:53:09Z", "message": "Remove comments"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "1ff32a9211812f6b1b0dd05836270162dae40c78", "author": {"user": {"login": "justinlin-linkedin", "name": "Justin Lin"}}, "url": "https://github.com/linkedin/ambry/commit/1ff32a9211812f6b1b0dd05836270162dae40c78", "committedDate": "2020-05-27T17:27:53Z", "message": "Change the delete parallelism to 2"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "c8cff50f32801c33b560fe160252263c9bb88e6d", "author": {"user": {"login": "justinlin-linkedin", "name": "Justin Lin"}}, "url": "https://github.com/linkedin/ambry/commit/c8cff50f32801c33b560fe160252263c9bb88e6d", "committedDate": "2020-05-25T20:24:45Z", "message": "Remove comments"}, "afterCommit": {"oid": "1ff32a9211812f6b1b0dd05836270162dae40c78", "author": {"user": {"login": "justinlin-linkedin", "name": "Justin Lin"}}, "url": "https://github.com/linkedin/ambry/commit/1ff32a9211812f6b1b0dd05836270162dae40c78", "committedDate": "2020-05-27T17:27:53Z", "message": "Change the delete parallelism to 2"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "9eaa5dc2afa6db6f8021037a5efe47a079b999a9", "author": {"user": {"login": "justinlin-linkedin", "name": "Justin Lin"}}, "url": "https://github.com/linkedin/ambry/commit/9eaa5dc2afa6db6f8021037a5efe47a079b999a9", "committedDate": "2020-05-27T17:52:35Z", "message": "Comments"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDE5NDg2MTE2", "url": "https://github.com/linkedin/ambry/pull/1530#pullrequestreview-419486116", "createdAt": "2020-05-27T18:10:34Z", "commit": {"oid": "9eaa5dc2afa6db6f8021037a5efe47a079b999a9"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDE5NTc4NDY0", "url": "https://github.com/linkedin/ambry/pull/1530#pullrequestreview-419578464", "createdAt": "2020-05-27T20:20:59Z", "commit": {"oid": "9eaa5dc2afa6db6f8021037a5efe47a079b999a9"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1505, "cost": 1, "resetAt": "2021-11-01T16:19:10Z"}}}