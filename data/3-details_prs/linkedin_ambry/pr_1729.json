{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTQxMzM5Mzky", "number": 1729, "title": "[StorageQuota] Add more metrics and fix a statsheader copy bug.", "bodyText": "This PR\n\nAdd more metrics to AccountStatsMySqlStore\nFix a StatsHeader copy constructor bug\nAdd support for mysql aggregation task in HelixClusterWideAggregationTaskTool.", "createdAt": "2020-12-16T17:52:27Z", "url": "https://github.com/linkedin/ambry/pull/1729", "merged": true, "mergeCommit": {"oid": "138707582307979288ef80f7e2a18b6b9f429bf4"}, "closed": true, "closedAt": "2020-12-17T23:31:18Z", "author": {"login": "justinlin-linkedin"}, "timelineItems": {"totalCount": 8, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdm4yBsgFqTU1NDIwMjEwMw==", "endCursor": "Y3Vyc29yOnYyOpPPAAABdnK08vABqjQxMjcyMTYwNDk=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTU0MjAyMTAz", "url": "https://github.com/linkedin/ambry/pull/1729#pullrequestreview-554202103", "createdAt": "2020-12-17T00:55:25Z", "commit": {"oid": "f2c1dd183ad1c557c52fd40fa2a69bc5ba159d66"}, "state": "APPROVED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xN1QwMDo1NToyNlrOIHfviQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xN1QwMDo1NToyNlrOIHfviQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NDczMTAxNw==", "bodyText": "Minor: I am not entirely sure what will happen if the report is not found as this report may be PartitionClass report which is temporarily not supported by mysql.", "url": "https://github.com/linkedin/ambry/pull/1729#discussion_r544731017", "createdAt": "2020-12-17T00:55:26Z", "author": {"login": "jsjtzyy"}, "path": "ambry-tools/src/main/java/com/github/ambry/clustermap/HelixClusterWideAggregationTool.java", "diffHunk": "@@ -167,8 +172,9 @@ public static void main(String[] args) throws Exception {\n               String jobId = statsType.toString().toLowerCase() + (isRecurrentWorkflow ? RECURRENT_JOB_SUFFIX\n                   : ONE_TIME_JOB_SUFFIX);\n               String taskId = statsType.toString().toLowerCase() + TASK_SUFFIX;\n-              String aggregationCommand =\n-                  String.format(\"%s_%s\", HelixHealthReportAggregatorTask.TASK_COMMAND_PREFIX, reportName);\n+              String aggregationCommand = String.format(\"%s_%s\",\n+                  config.isMysql ? MySqlReportAggregatorTask.TASK_COMMAND_PREFIX", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f2c1dd183ad1c557c52fd40fa2a69bc5ba159d66"}, "originalPosition": 26}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTU0MjE0OTQ2", "url": "https://github.com/linkedin/ambry/pull/1729#pullrequestreview-554214946", "createdAt": "2020-12-17T01:30:05Z", "commit": {"oid": "f2c1dd183ad1c557c52fd40fa2a69bc5ba159d66"}, "state": "COMMENTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xN1QwMTozMDowNVrOIHgh3w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xN1QwMTozMDoyMFrOIHgiOQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NDc0MzkwMw==", "bodyText": "why not logger.info(\"Aggregating stats from {} hosts\", statsWrappers.size());", "url": "https://github.com/linkedin/ambry/pull/1729#discussion_r544743903", "createdAt": "2020-12-17T01:30:05Z", "author": {"login": "zzmao"}, "path": "ambry-clustermap/src/main/java/com/github/ambry/clustermap/MySqlReportAggregatorTask.java", "diffHunk": "@@ -87,6 +87,7 @@ public TaskResult run() {\n         statsWrappers.put(instanceName,\n             accountStatsStore.queryStatsOf(clusterMapConfig.clusterMapClusterName, instanceName));\n       }\n+      logger.info(String.format(\"Aggregating stats from %d hosts\", statsWrappers.size()));", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f2c1dd183ad1c557c52fd40fa2a69bc5ba159d66"}, "originalPosition": 4}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NDc0Mzk5Mw==", "bodyText": "same here, why not use {}", "url": "https://github.com/linkedin/ambry/pull/1729#discussion_r544743993", "createdAt": "2020-12-17T01:30:20Z", "author": {"login": "zzmao"}, "path": "ambry-clustermap/src/main/java/com/github/ambry/clustermap/MySqlReportAggregatorTask.java", "diffHunk": "@@ -99,6 +100,7 @@ public TaskResult run() {\n         String recordedMonthValue = accountStatsStore.queryRecordedMonth(clusterMapConfig.clusterMapClusterName);\n         if (recordedMonthValue == null || recordedMonthValue.isEmpty() || !currentMonthValue.equals(\n             recordedMonthValue)) {\n+          logger.info(\"Taking snapshot of aggregated stats for month \" + currentMonthValue);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f2c1dd183ad1c557c52fd40fa2a69bc5ba159d66"}, "originalPosition": 12}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTU0MjQ2ODAy", "url": "https://github.com/linkedin/ambry/pull/1729#pullrequestreview-554246802", "createdAt": "2020-12-17T03:04:17Z", "commit": {"oid": "f2c1dd183ad1c557c52fd40fa2a69bc5ba159d66"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xN1QwMzowNDoxOFrOIHiitQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xN1QwMzowNDoxOFrOIHiitQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NDc3Njg4NQ==", "bodyText": "Time to remove Helix from the class name?  (Unless that will break something.)", "url": "https://github.com/linkedin/ambry/pull/1729#discussion_r544776885", "createdAt": "2020-12-17T03:04:18Z", "author": {"login": "lightningrob"}, "path": "ambry-tools/src/main/java/com/github/ambry/clustermap/HelixClusterWideAggregationTool.java", "diffHunk": "@@ -108,6 +108,10 @@\n     @Default(\"false\")\n     final boolean deleteSpecifiedWorkflow;\n \n+    @Config(\"is.mysql\")\n+    @Default(\"false\")\n+    final boolean isMysql;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f2c1dd183ad1c557c52fd40fa2a69bc5ba159d66"}, "originalPosition": 6}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTU0MjQ3Mzg5", "url": "https://github.com/linkedin/ambry/pull/1729#pullrequestreview-554247389", "createdAt": "2020-12-17T03:06:15Z", "commit": {"oid": "f2c1dd183ad1c557c52fd40fa2a69bc5ba159d66"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "29653d1c7082281b135a8eaa1686ce93981af22c", "author": {"user": {"login": "justinlin-linkedin", "name": "Justin Lin"}}, "url": "https://github.com/linkedin/ambry/commit/29653d1c7082281b135a8eaa1686ce93981af22c", "committedDate": "2020-12-17T21:53:57Z", "message": "[StorageQuota] Add mysql support in HelixClusterWideAggregtionTool"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "cd2c18d49b9a506d5a8086e861e9d0cf28927d56", "author": {"user": {"login": "justinlin-linkedin", "name": "Justin Lin"}}, "url": "https://github.com/linkedin/ambry/commit/cd2c18d49b9a506d5a8086e861e9d0cf28927d56", "committedDate": "2020-12-17T21:53:57Z", "message": "More metrics"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "64857dea177ab8e56cd9e5d173584eef24f5c308", "author": {"user": {"login": "justinlin-linkedin", "name": "Justin Lin"}}, "url": "https://github.com/linkedin/ambry/commit/64857dea177ab8e56cd9e5d173584eef24f5c308", "committedDate": "2020-12-17T21:53:57Z", "message": "Comments"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "f2c1dd183ad1c557c52fd40fa2a69bc5ba159d66", "author": {"user": {"login": "justinlin-linkedin", "name": "Justin Lin"}}, "url": "https://github.com/linkedin/ambry/commit/f2c1dd183ad1c557c52fd40fa2a69bc5ba159d66", "committedDate": "2020-12-16T05:50:41Z", "message": "More metrics"}, "afterCommit": {"oid": "64857dea177ab8e56cd9e5d173584eef24f5c308", "author": {"user": {"login": "justinlin-linkedin", "name": "Justin Lin"}}, "url": "https://github.com/linkedin/ambry/commit/64857dea177ab8e56cd9e5d173584eef24f5c308", "committedDate": "2020-12-17T21:53:57Z", "message": "Comments"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1057, "cost": 1, "resetAt": "2021-11-01T16:19:10Z"}}}