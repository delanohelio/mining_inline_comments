{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0Mzc1NTg3NjAx", "number": 1387, "reviewThreads": {"totalCount": 5, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xNVQxOTowNTozOFrODgLDIw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xOVQyMTo0MDoxOVrODhO1eQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjM1MDYyMDUxOnYy", "diffSide": "RIGHT", "path": "gradle/git-push.sh", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xNVQxOTowNTozOFrOFqQL-g==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xOFQyMTo1NDoyM1rOFrT2AA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3OTg0OTcyMg==", "bodyText": "this should be linkedin/ambry", "url": "https://github.com/linkedin/ambry/pull/1387#discussion_r379849722", "createdAt": "2020-02-15T19:05:38Z", "author": {"login": "cgtz"}, "path": "gradle/git-push.sh", "diffHunk": "@@ -0,0 +1,11 @@\n+#!/bin/sh\n+\n+#Git push is implemented in the script to make sure we are not leaking GH key to the output\n+#Expects 'GIT_SECRET' env variable to be in format: user:github_access_token, \n+#for example: mockitoguy:qq43234xc23x23d24d\n+\n+echo \"Running git push without output for security. If it fails make sure that GIT_SECRET env variable is set.\"\n+git push --quiet https://$GIT_SECRET@github.com/mockitoguy/ambry.git --tags > /dev/null 2>&1", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "97551763f8e633e1b2657a736ff43bdce9d43ef1"}, "originalPosition": 8}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MDk1ODIwOA==", "bodyText": "Fixed! Nice catch!", "url": "https://github.com/linkedin/ambry/pull/1387#discussion_r380958208", "createdAt": "2020-02-18T21:54:23Z", "author": {"login": "mockitoguy"}, "path": "gradle/git-push.sh", "diffHunk": "@@ -0,0 +1,11 @@\n+#!/bin/sh\n+\n+#Git push is implemented in the script to make sure we are not leaking GH key to the output\n+#Expects 'GIT_SECRET' env variable to be in format: user:github_access_token, \n+#for example: mockitoguy:qq43234xc23x23d24d\n+\n+echo \"Running git push without output for security. If it fails make sure that GIT_SECRET env variable is set.\"\n+git push --quiet https://$GIT_SECRET@github.com/mockitoguy/ambry.git --tags > /dev/null 2>&1", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3OTg0OTcyMg=="}, "originalCommit": {"oid": "97551763f8e633e1b2657a736ff43bdce9d43ef1"}, "originalPosition": 8}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjM1MDYyMDk0OnYy", "diffSide": "RIGHT", "path": "gradle/ci-release.gradle", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xNVQxOTowNjoxNlrOFqQMKw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xOFQyMTo1NDoxMFrOFrT1jw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3OTg0OTc3MQ==", "bodyText": "add newlines at the end of the newly added files", "url": "https://github.com/linkedin/ambry/pull/1387#discussion_r379849771", "createdAt": "2020-02-15T19:06:16Z", "author": {"login": "cgtz"}, "path": "gradle/ci-release.gradle", "diffHunk": "@@ -0,0 +1,37 @@\n+task bintrayUploadAll {\n+    description = \"Runs 'bintrayUpload' tasks from all projects\"\n+    mustRunAfter \"gitPush\" //git push is easier to rollback so we run it first\n+}\n+\n+allprojects {\n+    tasks.matching { it.name == \"bintrayUpload\" }.all {\n+        bintrayUploadAll.dependsOn it\n+    }\n+}\n+\n+task ciPerformRelease {\n+    description = \"Performs the release, intended to be ran on CI\"\n+    dependsOn \"gitTag\", \"gitPush\", \"bintrayUploadAll\"    \n+}\n+\n+task gitTag {\n+    description = \"Creates annotated tag 'v$version'\"\n+\n+    doLast {\n+        println \"Setting Git user and email to Travis CI\"\n+        exec { commandLine \"git\", \"config\", \"user.email\", \"travis@travis-ci.org\" }\n+        exec { commandLine \"git\", \"config\", \"user.name\", \"Travis CI\" }\n+        println \"Creating tag v$version\"\n+        exec { commandLine \"git\", \"tag\", \"-a\", \"-m\", \"Release $version\", \"v$version\" }\n+        println \"Created tag v$version\"\n+    }\n+}\n+\n+task gitPush(type: Exec) {\n+    description = \"Pushes tags by running 'git push --tags'. Hides secret key from git push output.\"\n+    mustRunAfter \"gitTag\" //tag first, push later\n+    \n+    doFirst { println \"Pushing tag v$version\" }\n+    commandLine \"./gradle/git-push.sh\", \"v$version\"\n+    doLast { println \"Pushed tag v$version\" }\n+}", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "97551763f8e633e1b2657a736ff43bdce9d43ef1"}, "originalPosition": 37}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MDk1ODA5NQ==", "bodyText": "Fixed!", "url": "https://github.com/linkedin/ambry/pull/1387#discussion_r380958095", "createdAt": "2020-02-18T21:54:10Z", "author": {"login": "mockitoguy"}, "path": "gradle/ci-release.gradle", "diffHunk": "@@ -0,0 +1,37 @@\n+task bintrayUploadAll {\n+    description = \"Runs 'bintrayUpload' tasks from all projects\"\n+    mustRunAfter \"gitPush\" //git push is easier to rollback so we run it first\n+}\n+\n+allprojects {\n+    tasks.matching { it.name == \"bintrayUpload\" }.all {\n+        bintrayUploadAll.dependsOn it\n+    }\n+}\n+\n+task ciPerformRelease {\n+    description = \"Performs the release, intended to be ran on CI\"\n+    dependsOn \"gitTag\", \"gitPush\", \"bintrayUploadAll\"    \n+}\n+\n+task gitTag {\n+    description = \"Creates annotated tag 'v$version'\"\n+\n+    doLast {\n+        println \"Setting Git user and email to Travis CI\"\n+        exec { commandLine \"git\", \"config\", \"user.email\", \"travis@travis-ci.org\" }\n+        exec { commandLine \"git\", \"config\", \"user.name\", \"Travis CI\" }\n+        println \"Creating tag v$version\"\n+        exec { commandLine \"git\", \"tag\", \"-a\", \"-m\", \"Release $version\", \"v$version\" }\n+        println \"Created tag v$version\"\n+    }\n+}\n+\n+task gitPush(type: Exec) {\n+    description = \"Pushes tags by running 'git push --tags'. Hides secret key from git push output.\"\n+    mustRunAfter \"gitTag\" //tag first, push later\n+    \n+    doFirst { println \"Pushing tag v$version\" }\n+    commandLine \"./gradle/git-push.sh\", \"v$version\"\n+    doLast { println \"Pushed tag v$version\" }\n+}", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3OTg0OTc3MQ=="}, "originalCommit": {"oid": "97551763f8e633e1b2657a736ff43bdce9d43ef1"}, "originalPosition": 37}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjM1MDYzMDg0OnYy", "diffSide": "RIGHT", "path": "build.gradle", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xNVQxOToyOToyM1rOFqQRNg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xOFQyMTo1NDowMFrOFrT1TA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3OTg1MTA2Mg==", "bodyText": "some extra spaces here", "url": "https://github.com/linkedin/ambry/pull/1387#discussion_r379851062", "createdAt": "2020-02-15T19:29:23Z", "author": {"login": "cgtz"}, "path": "build.gradle", "diffHunk": "@@ -11,23 +11,22 @@\n buildscript {\n     repositories {\n         mavenCentral()\n+        mavenLocal()\n     }\n     apply from: file('gradle/buildscript.gradle'), to: buildscript\n }\n \n-plugins {\n-    id 'org.shipkit.java' version '2.2.5' apply false\n-}\n-if (!project.hasProperty('disableShipkit')) {\n-    apply plugin: 'org.shipkit.java'\n-}\n+apply plugin: 'org.shipkit.shipkit-auto-version'\n+println \"Building version $version\"\n \n apply from: file('gradle/license.gradle')\n apply from: file('gradle/environment.gradle')\n apply from: file(\"gradle/dependency-versions.gradle\")\n+apply from: file(\"gradle/ci-release.gradle\")\n \n-allprojects {\n+allprojects {    ", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "97551763f8e633e1b2657a736ff43bdce9d43ef1"}, "originalPosition": 24}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MDk1ODAyOA==", "bodyText": "Fixed!", "url": "https://github.com/linkedin/ambry/pull/1387#discussion_r380958028", "createdAt": "2020-02-18T21:54:00Z", "author": {"login": "mockitoguy"}, "path": "build.gradle", "diffHunk": "@@ -11,23 +11,22 @@\n buildscript {\n     repositories {\n         mavenCentral()\n+        mavenLocal()\n     }\n     apply from: file('gradle/buildscript.gradle'), to: buildscript\n }\n \n-plugins {\n-    id 'org.shipkit.java' version '2.2.5' apply false\n-}\n-if (!project.hasProperty('disableShipkit')) {\n-    apply plugin: 'org.shipkit.java'\n-}\n+apply plugin: 'org.shipkit.shipkit-auto-version'\n+println \"Building version $version\"\n \n apply from: file('gradle/license.gradle')\n apply from: file('gradle/environment.gradle')\n apply from: file(\"gradle/dependency-versions.gradle\")\n+apply from: file(\"gradle/ci-release.gradle\")\n \n-allprojects {\n+allprojects {    ", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3OTg1MTA2Mg=="}, "originalCommit": {"oid": "97551763f8e633e1b2657a736ff43bdce9d43ef1"}, "originalPosition": 24}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjM1MDcwNzU1OnYy", "diffSide": "RIGHT", "path": ".travis.yml", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xNVQyMjo0NToxOFrOFqQ3sg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xOFQyMTo1Mzo0MFrOFrT0uw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3OTg2MDkxNA==", "bodyText": "It seems like travis-ci reorganized the docs lately, so this link should be https://docs.travis-ci.com/user/job-lifecycle/#skipping-the-installation-phase\nThe docs also suggest install: skip", "url": "https://github.com/linkedin/ambry/pull/1387#discussion_r379860914", "createdAt": "2020-02-15T22:45:18Z", "author": {"login": "cgtz"}, "path": ".travis.yml", "diffHunk": "@@ -15,11 +15,12 @@ addons:\n     packages:\n       - oracle-java8-installer\n       - oracle-java8-unlimited-jce-policy\n-#don't build tags\n branches:\n-  except:\n+  except: # don't build tags\n     - /^v\\d/\n+install:\n+ - true # skips unnecessary ./gradlew assemble (https://docs.travis-ci.com/user/customizing-the-build/#Skipping-the-Installation-Step) ", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "97551763f8e633e1b2657a736ff43bdce9d43ef1"}, "originalPosition": 10}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MDk1Nzg4Mw==", "bodyText": "Fixed! Great feedback!", "url": "https://github.com/linkedin/ambry/pull/1387#discussion_r380957883", "createdAt": "2020-02-18T21:53:40Z", "author": {"login": "mockitoguy"}, "path": ".travis.yml", "diffHunk": "@@ -15,11 +15,12 @@ addons:\n     packages:\n       - oracle-java8-installer\n       - oracle-java8-unlimited-jce-policy\n-#don't build tags\n branches:\n-  except:\n+  except: # don't build tags\n     - /^v\\d/\n+install:\n+ - true # skips unnecessary ./gradlew assemble (https://docs.travis-ci.com/user/customizing-the-build/#Skipping-the-Installation-Step) ", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3OTg2MDkxNA=="}, "originalCommit": {"oid": "97551763f8e633e1b2657a736ff43bdce9d43ef1"}, "originalPosition": 10}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjM2MTcyNjY1OnYy", "diffSide": "RIGHT", "path": "travis-build.sh", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xOVQyMTo0MDoxOVrOFr4nGw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xOVQyMTo0MDoxOVrOFr4nGw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MTU2MDYwMw==", "bodyText": "Could you remove the -i option from this command? Since we have logging enabled for our tests, this can produce a ton of output.\nI think it should be okay to use -i on lines 10 and 17 though.", "url": "https://github.com/linkedin/ambry/pull/1387#discussion_r381560603", "createdAt": "2020-02-19T21:40:19Z", "author": {"login": "cgtz"}, "path": "travis-build.sh", "diffHunk": "@@ -0,0 +1,18 @@\n+#!/bin/sh\n+\n+# exit when any command fails\n+set -e\n+\n+echo \"Building and testing artifacts, and creating pom files\"\n+./gradlew -s -i --scan build publishToMavenLocal codeCoverageReport", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "08e5d1049bc8586bfda62d18292162cde25a70a3"}, "originalPosition": 7}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1716, "cost": 1, "resetAt": "2021-11-12T20:44:06Z"}}}