{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDUzOTgwMDk0", "number": 1593, "reviewThreads": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yMVQwNDoyMTozOVrOEQdRbA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yMVQwNDoyMTozOVrOEQdRbA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjg1NjkyMjY4OnYy", "diffSide": "RIGHT", "path": "ambry-replication/src/main/java/com/github/ambry/replication/ReplicaThread.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yMVQwNDoyMTozOVrOG0njzw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yMVQwNDoyMTozOVrOG0njzw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NzgyNzI3OQ==", "bodyText": "If we move this to handling no progress replicas code block (line 438 ~470), we might be able to re-use batchConvertReplicaMetadataResponseKeys without creating a new method.\nIt seems the one minor change would suffice: change argument of batchConvertReplicaMetadataResponseKeys from ReplicaMetadataResponse to List<ExchangeMetadataResponse>", "url": "https://github.com/linkedin/ambry/pull/1593#discussion_r457827279", "createdAt": "2020-07-21T04:21:39Z", "author": {"login": "jsjtzyy"}, "path": "ambry-replication/src/main/java/com/github/ambry/replication/ReplicaThread.java", "diffHunk": "@@ -708,6 +708,13 @@ void fixMissingStoreKeys(ConnectedChannel connectedChannel, List<RemoteReplicaIn\n       GetResponse getResponse =\n           getMessagesForMissingKeys(connectedChannel, exchangeMetadataResponseList, replicasToReplicatePerNode,\n               remoteNode, remoteColoGetRequestForStandby);\n+      if (remoteColoGetRequestForStandby) {\n+        // If we are fetching missing keys for standby replicas (timed out waiting for their keys to arrive from leaders)\n+        // during leader-based replication, convert (and cache) received keys in the GET response. This is needed as the\n+        // StoreKeyConverter would have cleared these keys from its cache as it is replicating with other replicas before\n+        // time out happened for these standby replicas.\n+        batchConvertGetResponseKeys(getResponse);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "8b69b7a9a61b4560a66f2981246ab708a9db2ee4"}, "originalPosition": 9}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1326, "cost": 1, "resetAt": "2021-11-12T20:44:06Z"}}}