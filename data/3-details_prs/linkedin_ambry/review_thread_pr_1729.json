{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTQxMzM5Mzky", "number": 1729, "reviewThreads": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xN1QwMDo1NToyNlrOFGd-Qg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xN1QwMzowNDoxOFrOFGf_UQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzQyMzI2ODUwOnYy", "diffSide": "RIGHT", "path": "ambry-tools/src/main/java/com/github/ambry/clustermap/HelixClusterWideAggregationTool.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xN1QwMDo1NToyNlrOIHfviQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xN1QwMTowMzo1NVrOIHf8XA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NDczMTAxNw==", "bodyText": "Minor: I am not entirely sure what will happen if the report is not found as this report may be PartitionClass report which is temporarily not supported by mysql.", "url": "https://github.com/linkedin/ambry/pull/1729#discussion_r544731017", "createdAt": "2020-12-17T00:55:26Z", "author": {"login": "jsjtzyy"}, "path": "ambry-tools/src/main/java/com/github/ambry/clustermap/HelixClusterWideAggregationTool.java", "diffHunk": "@@ -167,8 +172,9 @@ public static void main(String[] args) throws Exception {\n               String jobId = statsType.toString().toLowerCase() + (isRecurrentWorkflow ? RECURRENT_JOB_SUFFIX\n                   : ONE_TIME_JOB_SUFFIX);\n               String taskId = statsType.toString().toLowerCase() + TASK_SUFFIX;\n-              String aggregationCommand =\n-                  String.format(\"%s_%s\", HelixHealthReportAggregatorTask.TASK_COMMAND_PREFIX, reportName);\n+              String aggregationCommand = String.format(\"%s_%s\",\n+                  config.isMysql ? MySqlReportAggregatorTask.TASK_COMMAND_PREFIX", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f2c1dd183ad1c557c52fd40fa2a69bc5ba159d66"}, "originalPosition": 26}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NDczNDMwMA==", "bodyText": "I won't worry too much about it, it's a cli tool. If we make a mistake, we can always revert it.", "url": "https://github.com/linkedin/ambry/pull/1729#discussion_r544734300", "createdAt": "2020-12-17T01:03:55Z", "author": {"login": "justinlin-linkedin"}, "path": "ambry-tools/src/main/java/com/github/ambry/clustermap/HelixClusterWideAggregationTool.java", "diffHunk": "@@ -167,8 +172,9 @@ public static void main(String[] args) throws Exception {\n               String jobId = statsType.toString().toLowerCase() + (isRecurrentWorkflow ? RECURRENT_JOB_SUFFIX\n                   : ONE_TIME_JOB_SUFFIX);\n               String taskId = statsType.toString().toLowerCase() + TASK_SUFFIX;\n-              String aggregationCommand =\n-                  String.format(\"%s_%s\", HelixHealthReportAggregatorTask.TASK_COMMAND_PREFIX, reportName);\n+              String aggregationCommand = String.format(\"%s_%s\",\n+                  config.isMysql ? MySqlReportAggregatorTask.TASK_COMMAND_PREFIX", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NDczMTAxNw=="}, "originalCommit": {"oid": "f2c1dd183ad1c557c52fd40fa2a69bc5ba159d66"}, "originalPosition": 26}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzQyMzM1OTk3OnYy", "diffSide": "RIGHT", "path": "ambry-clustermap/src/main/java/com/github/ambry/clustermap/MySqlReportAggregatorTask.java", "isResolved": false, "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xN1QwMTozMDowNVrOIHgh3w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xN1QwMzowMDo1OVrOIHietw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NDc0MzkwMw==", "bodyText": "why not logger.info(\"Aggregating stats from {} hosts\", statsWrappers.size());", "url": "https://github.com/linkedin/ambry/pull/1729#discussion_r544743903", "createdAt": "2020-12-17T01:30:05Z", "author": {"login": "zzmao"}, "path": "ambry-clustermap/src/main/java/com/github/ambry/clustermap/MySqlReportAggregatorTask.java", "diffHunk": "@@ -87,6 +87,7 @@ public TaskResult run() {\n         statsWrappers.put(instanceName,\n             accountStatsStore.queryStatsOf(clusterMapConfig.clusterMapClusterName, instanceName));\n       }\n+      logger.info(String.format(\"Aggregating stats from %d hosts\", statsWrappers.size()));", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f2c1dd183ad1c557c52fd40fa2a69bc5ba159d66"}, "originalPosition": 4}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NDc1NjI1Ng==", "bodyText": "does it matter? is one better than the other?", "url": "https://github.com/linkedin/ambry/pull/1729#discussion_r544756256", "createdAt": "2020-12-17T02:04:47Z", "author": {"login": "justinlin-linkedin"}, "path": "ambry-clustermap/src/main/java/com/github/ambry/clustermap/MySqlReportAggregatorTask.java", "diffHunk": "@@ -87,6 +87,7 @@ public TaskResult run() {\n         statsWrappers.put(instanceName,\n             accountStatsStore.queryStatsOf(clusterMapConfig.clusterMapClusterName, instanceName));\n       }\n+      logger.info(String.format(\"Aggregating stats from %d hosts\", statsWrappers.size()));", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NDc0MzkwMw=="}, "originalCommit": {"oid": "f2c1dd183ad1c557c52fd40fa2a69bc5ba159d66"}, "originalPosition": 4}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NDc3NTg2Mw==", "bodyText": "String.format is generally redundant inside logger calls.", "url": "https://github.com/linkedin/ambry/pull/1729#discussion_r544775863", "createdAt": "2020-12-17T03:00:59Z", "author": {"login": "lightningrob"}, "path": "ambry-clustermap/src/main/java/com/github/ambry/clustermap/MySqlReportAggregatorTask.java", "diffHunk": "@@ -87,6 +87,7 @@ public TaskResult run() {\n         statsWrappers.put(instanceName,\n             accountStatsStore.queryStatsOf(clusterMapConfig.clusterMapClusterName, instanceName));\n       }\n+      logger.info(String.format(\"Aggregating stats from %d hosts\", statsWrappers.size()));", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NDc0MzkwMw=="}, "originalCommit": {"oid": "f2c1dd183ad1c557c52fd40fa2a69bc5ba159d66"}, "originalPosition": 4}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzQyMzM2MDYyOnYy", "diffSide": "RIGHT", "path": "ambry-clustermap/src/main/java/com/github/ambry/clustermap/MySqlReportAggregatorTask.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xN1QwMTozMDoyMFrOIHgiOQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xN1QwMTozMDoyMFrOIHgiOQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NDc0Mzk5Mw==", "bodyText": "same here, why not use {}", "url": "https://github.com/linkedin/ambry/pull/1729#discussion_r544743993", "createdAt": "2020-12-17T01:30:20Z", "author": {"login": "zzmao"}, "path": "ambry-clustermap/src/main/java/com/github/ambry/clustermap/MySqlReportAggregatorTask.java", "diffHunk": "@@ -99,6 +100,7 @@ public TaskResult run() {\n         String recordedMonthValue = accountStatsStore.queryRecordedMonth(clusterMapConfig.clusterMapClusterName);\n         if (recordedMonthValue == null || recordedMonthValue.isEmpty() || !currentMonthValue.equals(\n             recordedMonthValue)) {\n+          logger.info(\"Taking snapshot of aggregated stats for month \" + currentMonthValue);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f2c1dd183ad1c557c52fd40fa2a69bc5ba159d66"}, "originalPosition": 12}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzQyMzU5ODg5OnYy", "diffSide": "RIGHT", "path": "ambry-tools/src/main/java/com/github/ambry/clustermap/HelixClusterWideAggregationTool.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xN1QwMzowNDoxOFrOIHiitQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xN1QyMToyOTozOFrOIIJgzg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NDc3Njg4NQ==", "bodyText": "Time to remove Helix from the class name?  (Unless that will break something.)", "url": "https://github.com/linkedin/ambry/pull/1729#discussion_r544776885", "createdAt": "2020-12-17T03:04:18Z", "author": {"login": "lightningrob"}, "path": "ambry-tools/src/main/java/com/github/ambry/clustermap/HelixClusterWideAggregationTool.java", "diffHunk": "@@ -108,6 +108,10 @@\n     @Default(\"false\")\n     final boolean deleteSpecifiedWorkflow;\n \n+    @Config(\"is.mysql\")\n+    @Default(\"false\")\n+    final boolean isMysql;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f2c1dd183ad1c557c52fd40fa2a69bc5ba159d66"}, "originalPosition": 6}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NTQxNTM3NA==", "bodyText": "Helix in the name is fine. Although we start to read the container storage reports from mysql, but this tool will instruct helix to execute these tasks.", "url": "https://github.com/linkedin/ambry/pull/1729#discussion_r545415374", "createdAt": "2020-12-17T21:29:38Z", "author": {"login": "justinlin-linkedin"}, "path": "ambry-tools/src/main/java/com/github/ambry/clustermap/HelixClusterWideAggregationTool.java", "diffHunk": "@@ -108,6 +108,10 @@\n     @Default(\"false\")\n     final boolean deleteSpecifiedWorkflow;\n \n+    @Config(\"is.mysql\")\n+    @Default(\"false\")\n+    final boolean isMysql;", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NDc3Njg4NQ=="}, "originalCommit": {"oid": "f2c1dd183ad1c557c52fd40fa2a69bc5ba159d66"}, "originalPosition": 6}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1182, "cost": 1, "resetAt": "2021-11-12T20:44:06Z"}}}