{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDYwMDM5MTA0", "number": 3445, "title": "docs: add sample for setting timeout and retry settings", "bodyText": "Adds an example for how to set custom timeout and retry settings for the Spanner client.", "createdAt": "2020-07-31T11:05:06Z", "url": "https://github.com/GoogleCloudPlatform/java-docs-samples/pull/3445", "merged": true, "mergeCommit": {"oid": "3cf228329b307145fad38314b6bea7b66abd2d5c"}, "closed": true, "closedAt": "2020-08-01T23:21:09Z", "author": {"login": "olavloite"}, "timelineItems": {"totalCount": 6, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABc6SAuDAH2gAyNDYwMDM5MTA0OjFhYTllZmQzNGQ0NTRhZjU5NmU1MGQ2ZTA0ZDIyYzAxNWVhMTFiYTM=", "endCursor": "Y3Vyc29yOnYyOpPPAAABc6xUKwAFqTQ1OTYwOTIyMA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "1aa9efd34d454af596e50d6e04d22c015ea11ba3", "author": {"user": {"login": "olavloite", "name": "Knut Olav L\u00f8ite"}}, "url": "https://github.com/GoogleCloudPlatform/java-docs-samples/commit/1aa9efd34d454af596e50d6e04d22c015ea11ba3", "committedDate": "2020-07-31T10:52:46Z", "message": "docs: add sample for setting timeout and retry settings"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "55e7bd0d3a9c3acb6b83ed6f29bdf9d394b301d4", "author": {"user": {"login": "olavloite", "name": "Knut Olav L\u00f8ite"}}, "url": "https://github.com/GoogleCloudPlatform/java-docs-samples/commit/55e7bd0d3a9c3acb6b83ed6f29bdf9d394b301d4", "committedDate": "2020-07-31T10:54:30Z", "message": "fix: move start tag"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDU5MzAzNTcw", "url": "https://github.com/GoogleCloudPlatform/java-docs-samples/pull/3445#pullrequestreview-459303570", "createdAt": "2020-07-31T16:26:43Z", "commit": {"oid": "55e7bd0d3a9c3acb6b83ed6f29bdf9d394b301d4"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0zMVQxNjoyNjo0M1rOG6OjCQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0zMVQxNjoyNjo0M1rOG6OjCQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MzcwODkzNw==", "bodyText": "This just looks weird, it took me a while to understand what was going on.  I'm not sure how you fix it, but, I wonder if the .setProjectId(projectId) shouldn't be the first thing in this group, or, if you should do all the options on the SpannerOptions.Builder builder = line(s).", "url": "https://github.com/GoogleCloudPlatform/java-docs-samples/pull/3445#discussion_r463708937", "createdAt": "2020-07-31T16:26:43Z", "author": {"login": "lesv"}, "path": "spanner/cloud-client/src/main/java/com/example/spanner/CustomTimeoutAndRetrySettingsExample.java", "diffHunk": "@@ -0,0 +1,86 @@\n+/*\n+ * Copyright 2020 Google Inc.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ * http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package com.example.spanner;\n+\n+//[START spanner_set_custom_timeout_and_retry]\n+import com.google.api.gax.retrying.RetrySettings;\n+import com.google.api.gax.rpc.StatusCode.Code;\n+import com.google.cloud.spanner.DatabaseClient;\n+import com.google.cloud.spanner.DatabaseId;\n+import com.google.cloud.spanner.Spanner;\n+import com.google.cloud.spanner.SpannerOptions;\n+import com.google.cloud.spanner.Statement;\n+import com.google.cloud.spanner.TransactionContext;\n+import com.google.cloud.spanner.TransactionRunner.TransactionCallable;\n+import org.threeten.bp.Duration;\n+\n+class CustomTimeoutAndRetrySettingsExample {\n+\n+  static void executeSqlWithCustomTimeoutAndRetrySettings() {\n+    // TODO(developer): Replace these variables before running the sample.\n+    String projectId = \"my-project\";\n+    String instanceId = \"my-instance\";\n+    String databaseId = \"my-database\";\n+\n+    executeSqlWithCustomTimeoutAndRetrySettings(projectId, instanceId, databaseId);\n+  }\n+\n+  // Create a Spanner client with custom ExecuteSql timeout and retry settings.\n+  static void executeSqlWithCustomTimeoutAndRetrySettings(\n+      String projectId, String instanceId, String databaseId) {\n+    SpannerOptions.Builder builder = SpannerOptions.newBuilder().setProjectId(projectId);\n+    // Set custom timeout and retry settings for the ExecuteSql RPC.\n+    builder\n+        .getSpannerStubSettingsBuilder()\n+        .executeSqlSettings()\n+        // Configure which errors should be retried.\n+        .setRetryableCodes(Code.DEADLINE_EXCEEDED, Code.UNAVAILABLE)\n+        .setRetrySettings(\n+            RetrySettings.newBuilder()\n+                // Configure retry delay settings.\n+                .setInitialRetryDelay(Duration.ofMillis(500))\n+                .setMaxRetryDelay(Duration.ofSeconds(64))\n+                .setRetryDelayMultiplier(1.5)\n+\n+                // Configure RPC and total timeout settings.\n+                .setInitialRpcTimeout(Duration.ofSeconds(60))\n+                .setMaxRpcTimeout(Duration.ofSeconds(60))\n+                .setRpcTimeoutMultiplier(1.0)\n+                .setTotalTimeout(Duration.ofSeconds(60))\n+                .build());", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "55e7bd0d3a9c3acb6b83ed6f29bdf9d394b301d4"}, "originalPosition": 64}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDU5MzA4MjU0", "url": "https://github.com/GoogleCloudPlatform/java-docs-samples/pull/3445#pullrequestreview-459308254", "createdAt": "2020-07-31T16:34:21Z", "commit": {"oid": "55e7bd0d3a9c3acb6b83ed6f29bdf9d394b301d4"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "4b6f85c9911ab98792a62f7d9d46003919237948", "author": {"user": {"login": "olavloite", "name": "Knut Olav L\u00f8ite"}}, "url": "https://github.com/GoogleCloudPlatform/java-docs-samples/commit/4b6f85c9911ab98792a62f7d9d46003919237948", "committedDate": "2020-08-01T13:56:01Z", "message": "docs: explain why retry settings use a separate chain"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDU5NjA5MjIw", "url": "https://github.com/GoogleCloudPlatform/java-docs-samples/pull/3445#pullrequestreview-459609220", "createdAt": "2020-08-01T23:21:04Z", "commit": {"oid": "4b6f85c9911ab98792a62f7d9d46003919237948"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 511, "cost": 1, "resetAt": "2021-11-01T14:20:25Z"}}}