{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0Mzk5ODAwMjU4", "number": 2576, "title": "Add AfterClass method to cleanup DLP Triggers and Templates", "bodyText": "Fixes #2572\n\nIt's a good idea to open an issue first for discussion.\n\n\n Tests pass\n Appropriate changes to README are included in PR\n API's need to be enabled to test (tell us)\n Environment Variables need to be set (ask us to set them)", "createdAt": "2020-04-06T17:41:00Z", "url": "https://github.com/GoogleCloudPlatform/java-docs-samples/pull/2576", "merged": true, "mergeCommit": {"oid": "5ece9184553872051f6f23f56fc51b68a8e109c5"}, "closed": true, "closedAt": "2020-04-06T20:55:37Z", "author": {"login": "shubha-rajan"}, "timelineItems": {"totalCount": 6, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcVCRvogH2gAyMzk5ODAwMjU4OmZhZGE4MWIwZmI0MzA5NzYwNjYxZTZkNzBiNDU0ZjBlMTNkM2MzNDI=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcVEXs4AH2gAyMzk5ODAwMjU4OjhhZGQwZDY1Y2NhNmE0NTNhOTgwMzQ2ZDZiZDJlODBlNzY0MzQxMGQ=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "fada81b0fb4309760661e6d70b454f0e13d3c342", "author": {"user": {"login": "shubha-rajan", "name": "Shubha Rajan"}}, "url": "https://github.com/GoogleCloudPlatform/java-docs-samples/commit/fada81b0fb4309760661e6d70b454f0e13d3c342", "committedDate": "2020-04-06T17:37:41Z", "message": "add AfterClass method to cleanup job triggers and templates"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzg4NDg3MjIw", "url": "https://github.com/GoogleCloudPlatform/java-docs-samples/pull/2576#pullrequestreview-388487220", "createdAt": "2020-04-06T17:56:21Z", "commit": {"oid": "fada81b0fb4309760661e6d70b454f0e13d3c342"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wNlQxNzo1NjoyMVrOGBjZuA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wNlQxNzo1NjoyMVrOGBjZuA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNDI4MTc4NA==", "bodyText": "This might be a bit too aggressive as your deleting all existing templates, some might actually be in use by another test running at the same time.", "url": "https://github.com/GoogleCloudPlatform/java-docs-samples/pull/2576#discussion_r404281784", "createdAt": "2020-04-06T17:56:21Z", "author": {"login": "lesv"}, "path": "dlp/src/test/java/dlp/snippets/TemplatesTests.java", "diffHunk": "@@ -88,6 +92,24 @@ public void setUp() {\n     System.setOut(new PrintStream(bout));\n   }\n \n+  @AfterClass\n+  public static void cleanupTemplates() throws IOException {\n+    try (DlpServiceClient dlpServiceClient = DlpServiceClient.create()) {\n+      ListInspectTemplatesRequest listInspectTemplatesRequest =\n+          ListInspectTemplatesRequest.newBuilder()\n+              .setParent(ProjectName.of(PROJECT_ID).toString())\n+              .setPageSize(1)\n+              .build();\n+      ListInspectTemplatesPagedResponse response = dlpServiceClient\n+          .listInspectTemplates(listInspectTemplatesRequest);\n+      for (InspectTemplate template : response.getPage().getResponse().getInspectTemplatesList()) {\n+        DeleteInspectTemplateRequest deleteInspectTemplateRequest =\n+            DeleteInspectTemplateRequest.newBuilder().setName(template.getName()).build();\n+        dlpServiceClient.deleteInspectTemplate(deleteInspectTemplateRequest);\n+      }\n+    }\n+  }", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "fada81b0fb4309760661e6d70b454f0e13d3c342"}, "originalPosition": 42}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzg4NDg3NTgx", "url": "https://github.com/GoogleCloudPlatform/java-docs-samples/pull/2576#pullrequestreview-388487581", "createdAt": "2020-04-06T17:56:49Z", "commit": {"oid": "fada81b0fb4309760661e6d70b454f0e13d3c342"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wNlQxNzo1Njo0OVrOGBja0w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wNlQxNzo1Njo0OVrOGBja0w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNDI4MjA2Nw==", "bodyText": "Ideally, you'll just clean up the ones you've created for testing.", "url": "https://github.com/GoogleCloudPlatform/java-docs-samples/pull/2576#discussion_r404282067", "createdAt": "2020-04-06T17:56:49Z", "author": {"login": "lesv"}, "path": "dlp/src/test/java/dlp/snippets/TriggersTests.java", "diffHunk": "@@ -104,12 +107,34 @@ public void setUp() {\n     System.setOut(new PrintStream(bout));\n   }\n \n+  @AfterClass()\n+  public static void cleanupTriggers() throws IOException {\n+    try (DlpServiceClient dlpServiceClient = DlpServiceClient.create()) {\n+      // List all job triggers\n+      ListJobTriggersRequest listJobTriggersRequest =\n+          ListJobTriggersRequest.newBuilder()\n+              .setParent(ProjectName.of(PROJECT_ID).toString())\n+              .build();\n+      DlpServiceClient.ListJobTriggersPagedResponse response =\n+          dlpServiceClient.listJobTriggers(listJobTriggersRequest);\n+\n+      // Loop through the response and delete each trigger\n+      for (JobTrigger trigger : response.getPage().getValues()) {\n+        DeleteJobTriggerRequest deleteJobTriggerRequest =\n+            DeleteJobTriggerRequest.newBuilder().setName(trigger.getName()).build();\n+        dlpServiceClient.deleteJobTrigger(deleteJobTriggerRequest);\n+      }\n+    }\n+  }", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "fada81b0fb4309760661e6d70b454f0e13d3c342"}, "originalPosition": 42}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "4ad5984ab452dfcab3eb3944f86aa97765d96cc7", "author": {"user": {"login": "shubha-rajan", "name": "Shubha Rajan"}}, "url": "https://github.com/GoogleCloudPlatform/java-docs-samples/commit/4ad5984ab452dfcab3eb3944f86aa97765d96cc7", "committedDate": "2020-04-06T18:13:20Z", "message": "delete only the jobs created in the tests"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzg4NTA1NzYw", "url": "https://github.com/GoogleCloudPlatform/java-docs-samples/pull/2576#pullrequestreview-388505760", "createdAt": "2020-04-06T18:21:55Z", "commit": {"oid": "4ad5984ab452dfcab3eb3944f86aa97765d96cc7"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "8add0d65cca6a453a980346d6bd2e80e7643410d", "author": {"user": {"login": "shubha-rajan", "name": "Shubha Rajan"}}, "url": "https://github.com/GoogleCloudPlatform/java-docs-samples/commit/8add0d65cca6a453a980346d6bd2e80e7643410d", "committedDate": "2020-04-06T20:04:00Z", "message": "Merge branch 'master' into cleanup-triggers"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 902, "cost": 1, "resetAt": "2021-11-01T14:20:25Z"}}}