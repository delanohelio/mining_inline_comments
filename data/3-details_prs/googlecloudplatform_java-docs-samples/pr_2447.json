{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0MzkxMjM2MTQz", "number": 2447, "title": "Fix Flaky DLP tests", "bodyText": "Fixes: #2302, #2303, #2317\nThe tests keep timing out, so I followed the pattern implemented in the corresponding python samples to create a job and immediately cancel it.", "createdAt": "2020-03-19T21:02:58Z", "url": "https://github.com/GoogleCloudPlatform/java-docs-samples/pull/2447", "merged": true, "mergeCommit": {"oid": "5275013f6dd5a146d70f104a84a165313770659e"}, "closed": true, "closedAt": "2020-03-20T23:29:07Z", "author": {"login": "shubha-rajan"}, "timelineItems": {"totalCount": 6, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcPSeprgH2gAyMzkxMjM2MTQzOmExODQ2YjBlYjU0ZmJlZjNhNGQzMzM5Zjc5OWZiMmIxM2YyNmVjNjI=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcPn2FTgH2gAyMzkxMjM2MTQzOjRiYTQzY2IwNGJiNWJiNTliZDk5YzgyMWEyNGEwMDMxM2M4ZWQ0OTU=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "a1846b0eb54fbef3a4d3339f799fb2b13f26ec62", "author": {"user": {"login": "shubha-rajan", "name": "Shubha Rajan"}}, "url": "https://github.com/GoogleCloudPlatform/java-docs-samples/commit/a1846b0eb54fbef3a4d3339f799fb2b13f26ec62", "committedDate": "2020-03-19T21:06:43Z", "message": "modified tests to cancel job"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "f0a1d6c8aa9d6bcf277d766cdb5df2d3092501be", "author": {"user": {"login": "shubha-rajan", "name": "Shubha Rajan"}}, "url": "https://github.com/GoogleCloudPlatform/java-docs-samples/commit/f0a1d6c8aa9d6bcf277d766cdb5df2d3092501be", "committedDate": "2020-03-19T20:49:32Z", "message": "modified tests to cancel job"}, "afterCommit": {"oid": "a1846b0eb54fbef3a4d3339f799fb2b13f26ec62", "author": {"user": {"login": "shubha-rajan", "name": "Shubha Rajan"}}, "url": "https://github.com/GoogleCloudPlatform/java-docs-samples/commit/a1846b0eb54fbef3a4d3339f799fb2b13f26ec62", "committedDate": "2020-03-19T21:06:43Z", "message": "modified tests to cancel job"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzc4MTAzODE2", "url": "https://github.com/GoogleCloudPlatform/java-docs-samples/pull/2447#pullrequestreview-378103816", "createdAt": "2020-03-19T21:23:14Z", "commit": {"oid": "f0a1d6c8aa9d6bcf277d766cdb5df2d3092501be"}, "state": "APPROVED", "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xOVQyMToyMzozNlrOF5A5HA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xOVQyMToyNDoxMFrOF5A6Kw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NTMyNzc3Mg==", "bodyText": "Fine if it works, but I'd bet these things can't happen right after the other.  (some hysteresis).\n(and it would be a flaky test again)", "url": "https://github.com/GoogleCloudPlatform/java-docs-samples/pull/2447#discussion_r395327772", "createdAt": "2020-03-19T21:23:36Z", "author": {"login": "lesv"}, "path": "dlp/src/test/java/dlp/snippets/InspectTests.java", "diffHunk": "@@ -103,8 +105,13 @@ public void testInspectGcsFile() throws InterruptedException, ExecutionException\n     InspectGcsFile.inspectGcsFile(PROJECT_ID, GCS_PATH, TOPIC_ID, SUBSCRIPTION_ID);\n \n     String output = bout.toString();\n-    assertThat(output, containsString(\"Info type: PHONE_NUMBER\"));\n-    assertThat(output, containsString(\"Info type: EMAIL_ADDRESS\"));\n+    assertThat(output, containsString(\"Job created: \"));\n+\n+    String jobId = output.split(\"Job created: \")[1].split(\"\\n\")[0];\n+    CancelDlpJobRequest request = CancelDlpJobRequest.newBuilder().setName(jobId).build();\n+    try (DlpServiceClient client = DlpServiceClient.create()) {\n+      client.cancelDlpJob(request);\n+    }", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "a1846b0eb54fbef3a4d3339f799fb2b13f26ec62"}, "originalPosition": 21}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NTMyNzkyMw==", "bodyText": "Fine if it works, but I'd bet these things can't happen right after the other.  (some hysteresis).\n(and it would be a flaky test again)", "url": "https://github.com/GoogleCloudPlatform/java-docs-samples/pull/2447#discussion_r395327923", "createdAt": "2020-03-19T21:23:54Z", "author": {"login": "lesv"}, "path": "dlp/src/test/java/dlp/snippets/InspectTests.java", "diffHunk": "@@ -114,8 +121,13 @@ public void testInspectDatastoreEntity()\n         PROJECT_ID, datastoreNamespace, datastoreKind, TOPIC_ID, SUBSCRIPTION_ID);\n \n     String output = bout.toString();\n-    assertThat(output, containsString(\"Info type: PHONE_NUMBER\"));\n-    assertThat(output, containsString(\"Info type: EMAIL_ADDRESS\"));\n+    assertThat(output, containsString(\"Job created: \"));\n+\n+    String jobId = output.split(\"Job created: \")[1].split(\"\\n\")[0];\n+    CancelDlpJobRequest request = CancelDlpJobRequest.newBuilder().setName(jobId).build();\n+    try (DlpServiceClient client = DlpServiceClient.create()) {\n+      client.cancelDlpJob(request);\n+    }", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "a1846b0eb54fbef3a4d3339f799fb2b13f26ec62"}, "originalPosition": 37}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NTMyODA0Mw==", "bodyText": "Fine if it works, but I'd bet these things can't happen right after the other.  (some hysteresis).\n(and it would be a flaky test again)", "url": "https://github.com/GoogleCloudPlatform/java-docs-samples/pull/2447#discussion_r395328043", "createdAt": "2020-03-19T21:24:10Z", "author": {"login": "lesv"}, "path": "dlp/src/test/java/dlp/snippets/InspectTests.java", "diffHunk": "@@ -125,6 +137,12 @@ public void testInspectBigQueryTable()\n         PROJECT_ID, DATASET_ID, TABLE_ID, TOPIC_ID, SUBSCRIPTION_ID);\n \n     String output = bout.toString();\n-    assertThat(output, containsString(\"Info type: PHONE_NUMBER\"));\n+    assertThat(output, containsString(\"Job created: \"));\n+\n+    String jobId = output.split(\"Job created: \")[1].split(\"\\n\")[0];\n+    CancelDlpJobRequest request = CancelDlpJobRequest.newBuilder().setName(jobId).build();\n+    try (DlpServiceClient client = DlpServiceClient.create()) {\n+      client.cancelDlpJob(request);\n+    }", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "a1846b0eb54fbef3a4d3339f799fb2b13f26ec62"}, "originalPosition": 52}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "1d9a26e61663ba5c5f517b1c700cd445916fb754", "author": {"user": {"login": "shubha-rajan", "name": "Shubha Rajan"}}, "url": "https://github.com/GoogleCloudPlatform/java-docs-samples/commit/1d9a26e61663ba5c5f517b1c700cd445916fb754", "committedDate": "2020-03-19T23:40:19Z", "message": "added delay to tests"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ff5af0ac9159aa93278e5e040d571c913dd557ab", "author": {"user": {"login": "shubha-rajan", "name": "Shubha Rajan"}}, "url": "https://github.com/GoogleCloudPlatform/java-docs-samples/commit/ff5af0ac9159aa93278e5e040d571c913dd557ab", "committedDate": "2020-03-20T06:40:40Z", "message": "added comment"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "4ba43cb04bb5bb59bd99c821a24a00313c8ed495", "author": {"user": {"login": "shubha-rajan", "name": "Shubha Rajan"}}, "url": "https://github.com/GoogleCloudPlatform/java-docs-samples/commit/4ba43cb04bb5bb59bd99c821a24a00313c8ed495", "committedDate": "2020-03-20T22:00:19Z", "message": "Merge branch 'master' into fix-flaky-tests"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 945, "cost": 1, "resetAt": "2021-11-01T14:20:25Z"}}}