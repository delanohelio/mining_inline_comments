{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0MzkxMzI5NzI1", "number": 2450, "title": "[WIP] Add Firebase samples", "bodyText": "Do not merge until:\n\n Firebase Remote Config: b/151857384 is fixed (found a workaround! \ud83d\ude42)\n\ud83d\udeabFirebase Analytics: is tested on GCF itself (will move into a separate PR)\n Firebase Reactive sample: is added", "createdAt": "2020-03-20T03:13:55Z", "url": "https://github.com/GoogleCloudPlatform/java-docs-samples/pull/2450", "merged": true, "mergeCommit": {"oid": "1d8afbea482db3c4cb6ec58826a3b322afc0e987"}, "closed": true, "closedAt": "2020-03-27T00:43:46Z", "author": {"login": "ace-n"}, "timelineItems": {"totalCount": 21, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcQ8o4vABqjMxNjIwNjYzMjU=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcRlnx-AH2gAyMzkxMzI5NzI1OmI3MTk2MGIwMjU4OGMzMGYyMWVhM2M4MWZlZWVhMWY4YWViODk4M2E=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "8bc3088b59308f6feaaffb01215f2f0c39b9ea8f", "author": {"user": {"login": "ace-n", "name": "Ace Nassri"}}, "url": "https://github.com/GoogleCloudPlatform/java-docs-samples/commit/8bc3088b59308f6feaaffb01215f2f0c39b9ea8f", "committedDate": "2020-03-20T03:15:15Z", "message": "Fix checkstyle typo"}, "afterCommit": {"oid": "93babc1637173a1f7bf9dc0b5dcf72c327e2c8b2", "author": {"user": {"login": "ace-n", "name": "Ace Nassri"}}, "url": "https://github.com/GoogleCloudPlatform/java-docs-samples/commit/93babc1637173a1f7bf9dc0b5dcf72c327e2c8b2", "committedDate": "2020-03-24T23:31:57Z", "message": "Add firestore reactive sample"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "5248f16fee5f1cba7b6725f9b94219d0568f83bb", "author": {"user": {"login": "ace-n", "name": "Ace Nassri"}}, "url": "https://github.com/GoogleCloudPlatform/java-docs-samples/commit/5248f16fee5f1cba7b6725f9b94219d0568f83bb", "committedDate": "2020-03-25T00:49:22Z", "message": "Add Firebase samples"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "d1ed6debabd25d255cbf88eb73a04cf42215df5a", "author": {"user": {"login": "ace-n", "name": "Ace Nassri"}}, "url": "https://github.com/GoogleCloudPlatform/java-docs-samples/commit/d1ed6debabd25d255cbf88eb73a04cf42215df5a", "committedDate": "2020-03-25T00:49:22Z", "message": "Fix checkstyle typo"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "d2822a7fcb7d5977c763efa0366830cbe16f9d25", "author": {"user": {"login": "ace-n", "name": "Ace Nassri"}}, "url": "https://github.com/GoogleCloudPlatform/java-docs-samples/commit/d2822a7fcb7d5977c763efa0366830cbe16f9d25", "committedDate": "2020-03-25T00:49:22Z", "message": "Add firestore reactive sample"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "93babc1637173a1f7bf9dc0b5dcf72c327e2c8b2", "author": {"user": {"login": "ace-n", "name": "Ace Nassri"}}, "url": "https://github.com/GoogleCloudPlatform/java-docs-samples/commit/93babc1637173a1f7bf9dc0b5dcf72c327e2c8b2", "committedDate": "2020-03-24T23:31:57Z", "message": "Add firestore reactive sample"}, "afterCommit": {"oid": "d2822a7fcb7d5977c763efa0366830cbe16f9d25", "author": {"user": {"login": "ace-n", "name": "Ace Nassri"}}, "url": "https://github.com/GoogleCloudPlatform/java-docs-samples/commit/d2822a7fcb7d5977c763efa0366830cbe16f9d25", "committedDate": "2020-03-25T00:49:22Z", "message": "Add firestore reactive sample"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzgxMTI4MjE1", "url": "https://github.com/GoogleCloudPlatform/java-docs-samples/pull/2450#pullrequestreview-381128215", "createdAt": "2020-03-25T13:08:15Z", "commit": {"oid": "d2822a7fcb7d5977c763efa0366830cbe16f9d25"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yNVQxMzowODoxNVrOF7aIiQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yNVQxMzowODoxNVrOF7aIiQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NzgzODQ3Mw==", "bodyText": "MakeUpperCaseRTDB implies Realtime Database (RTDB) but I see Firestore here.  Not sure if just the comment is wrong or something else needs to change.", "url": "https://github.com/GoogleCloudPlatform/java-docs-samples/pull/2450#discussion_r397838473", "createdAt": "2020-03-25T13:08:15Z", "author": {"login": "samtstern"}, "path": "functions/snippets/pom.xml", "diffHunk": "@@ -52,6 +52,13 @@\n       <version>3.4.2</version>\n     </dependency>\n \n+    <!-- Required for com.example.functions.MakeUpperCaseRTDB -->", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d2822a7fcb7d5977c763efa0366830cbe16f9d25"}, "originalPosition": 4}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzgxMTI4ODM1", "url": "https://github.com/GoogleCloudPlatform/java-docs-samples/pull/2450#pullrequestreview-381128835", "createdAt": "2020-03-25T13:09:04Z", "commit": {"oid": "d2822a7fcb7d5977c763efa0366830cbe16f9d25"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yNVQxMzowOTowNVrOF7aKhQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yNVQxMzowOTowNVrOF7aKhQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NzgzODk4MQ==", "bodyText": "I think this START tag has the wrong name.  Maybe s/auth/analytics?", "url": "https://github.com/GoogleCloudPlatform/java-docs-samples/pull/2450#discussion_r397838981", "createdAt": "2020-03-25T13:09:05Z", "author": {"login": "samtstern"}, "path": "functions/snippets/src/main/java/com/example/functions/FirebaseAnalytics.java", "diffHunk": "@@ -0,0 +1,59 @@\n+/*\n+ * Copyright 2020 Google LLC\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ * http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package com.example.functions;\n+\n+// [START functions_firebase_auth]", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d2822a7fcb7d5977c763efa0366830cbe16f9d25"}, "originalPosition": 19}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzgxMTI5MzQ5", "url": "https://github.com/GoogleCloudPlatform/java-docs-samples/pull/2450#pullrequestreview-381129349", "createdAt": "2020-03-25T13:09:45Z", "commit": {"oid": "d2822a7fcb7d5977c763efa0366830cbe16f9d25"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yNVQxMzowOTo0NVrOF7aMGg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yNVQxMzowOTo0NVrOF7aMGg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NzgzOTM4Ng==", "bodyText": "Snippet name says rtdb but example shows remote config.", "url": "https://github.com/GoogleCloudPlatform/java-docs-samples/pull/2450#discussion_r397839386", "createdAt": "2020-03-25T13:09:45Z", "author": {"login": "samtstern"}, "path": "functions/snippets/src/main/java/com/example/functions/FirebaseRemoteConfig.java", "diffHunk": "@@ -0,0 +1,54 @@\n+/*\n+ * Copyright 2020 Google LLC\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ * http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package com.example.functions;\n+\n+// [START functions_firebase_rtdb]", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d2822a7fcb7d5977c763efa0366830cbe16f9d25"}, "originalPosition": 19}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "8b9a46b40929499cfafb59e2cde53e26ad52e6a0", "author": {"user": {"login": "ace-n", "name": "Ace Nassri"}}, "url": "https://github.com/GoogleCloudPlatform/java-docs-samples/commit/8b9a46b40929499cfafb59e2cde53e26ad52e6a0", "committedDate": "2020-03-25T22:06:26Z", "message": "Fix bad region tags + follow DRIFT test naming convention"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "89d823030a4844226dc40420cc662889eb429aa9", "author": {"user": {"login": "ace-n", "name": "Ace Nassri"}}, "url": "https://github.com/GoogleCloudPlatform/java-docs-samples/commit/89d823030a4844226dc40420cc662889eb429aa9", "committedDate": "2020-03-25T22:08:28Z", "message": "Merge branch 'master' into gcf-firebase"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzgxNTc0NTk2", "url": "https://github.com/GoogleCloudPlatform/java-docs-samples/pull/2450#pullrequestreview-381574596", "createdAt": "2020-03-25T22:12:16Z", "commit": {"oid": "89d823030a4844226dc40420cc662889eb429aa9"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yNVQyMjoxMjoxNlrOF7wUdA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yNVQyMjoxMjoxNlrOF7wUdA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5ODIwMTk3Mg==", "bodyText": "Why do you bother with this?  Don't bother catching or even the try if you aren't going to do something useful with it.  It will automatically propagate to the parent.", "url": "https://github.com/GoogleCloudPlatform/java-docs-samples/pull/2450#discussion_r398201972", "createdAt": "2020-03-25T22:12:16Z", "author": {"login": "lesv"}, "path": "functions/snippets/src/main/java/com/example/functions/FirebaseFirestoreReactive.java", "diffHunk": "@@ -0,0 +1,75 @@\n+/*\n+ * Copyright 2020 Google LLC\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ * http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package com.example.functions;\n+\n+// [START functions_firebase_reactive]\n+import com.google.api.client.json.Json;\n+import com.google.cloud.firestore.DocumentReference;\n+import com.google.cloud.firestore.Firestore;\n+import com.google.cloud.firestore.FirestoreOptions;\n+import com.google.cloud.firestore.SetOptions;\n+import com.google.cloud.functions.BackgroundFunction;\n+import com.google.cloud.functions.Context;\n+import com.google.cloud.functions.RawBackgroundFunction;\n+import com.google.cloud.logging.LoggingHandler;\n+import com.google.gson.Gson;\n+import com.google.gson.JsonObject;\n+import java.io.IOException;\n+import java.util.ArrayList;\n+import java.util.HashMap;\n+import java.util.Map;\n+import java.util.concurrent.ExecutionException;\n+import java.util.logging.Logger;\n+import org.apache.commons.lang3.concurrent.ConcurrentException;\n+\n+public class FirebaseFirestoreReactive implements RawBackgroundFunction {\n+\n+  // Use GSON (https://github.com/google/gson) to parse JSON content.\n+  private Gson gsonParser = new Gson();\n+\n+  private static final Logger LOGGER = Logger.getLogger(FirebaseFirestoreReactive.class.getName());\n+  private static final Firestore firestore = FirestoreOptions.getDefaultInstance().getService();\n+\n+  @Override\n+  public void accept(String json, Context context) throws RuntimeException {\n+    // Get the recently-written value\n+    JsonObject body = gsonParser.fromJson(json, JsonObject.class);\n+    JsonObject fields = body.getAsJsonObject(\"value\").getAsJsonObject(\"fields\");\n+    if (!fields.has(\"original\")) {\n+      return;\n+    }\n+\n+    // Convert recently-written value to ALL CAPS\n+    String currentValue = fields.getAsJsonObject(\"original\").get(\"stringValue\").getAsString();\n+    String newValue = currentValue.toUpperCase();\n+\n+    // Update Firestore DB with ALL CAPS value\n+    Map<String, String> newFields = new HashMap<>();\n+    newFields.put(\"original\", newValue);\n+\n+    String affectedDoc = context.resource().split(\"/documents/\")[1].replace(\"\\\"\", \"\");\n+\n+    LOGGER.info(String.format(\"Replacing value: %s --> %s\", currentValue, newValue));\n+    try {\n+      firestore.document(affectedDoc).set(newFields, SetOptions.merge()).get();\n+    } catch (Exception e) {\n+      throw new RuntimeException(e);\n+    }", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "89d823030a4844226dc40420cc662889eb429aa9"}, "originalPosition": 71}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "d908b2d7d5b3e64d03327d54a7b310aef2198729", "author": {"user": {"login": "ace-n", "name": "Ace Nassri"}}, "url": "https://github.com/GoogleCloudPlatform/java-docs-samples/commit/d908b2d7d5b3e64d03327d54a7b310aef2198729", "committedDate": "2020-03-25T22:21:46Z", "message": "Make exception handler more specific"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b8791c1c28a258ad276565ec3444e3b48527bc24", "author": {"user": {"login": "ace-n", "name": "Ace Nassri"}}, "url": "https://github.com/GoogleCloudPlatform/java-docs-samples/commit/b8791c1c28a258ad276565ec3444e3b48527bc24", "committedDate": "2020-03-26T20:46:35Z", "message": "Remove broken analytics sample"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b99e606eb2f520b3295a5d84181889103ac816c7", "author": {"user": {"login": "ace-n", "name": "Ace Nassri"}}, "url": "https://github.com/GoogleCloudPlatform/java-docs-samples/commit/b99e606eb2f520b3295a5d84181889103ac816c7", "committedDate": "2020-03-26T21:29:04Z", "message": "Merge branch 'master' into gcf-firebase"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "9f9d0a74a325fa2979b84925f8445ab19b8e56d2", "author": {"user": {"login": "ace-n", "name": "Ace Nassri"}}, "url": "https://github.com/GoogleCloudPlatform/java-docs-samples/commit/9f9d0a74a325fa2979b84925f8445ab19b8e56d2", "committedDate": "2020-03-26T22:06:23Z", "message": "Fix tests + rm unused imports"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzgyNDU3NzUx", "url": "https://github.com/GoogleCloudPlatform/java-docs-samples/pull/2450#pullrequestreview-382457751", "createdAt": "2020-03-26T22:12:21Z", "commit": {"oid": "9f9d0a74a325fa2979b84925f8445ab19b8e56d2"}, "state": "APPROVED", "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yNlQyMjoxMjoyMVrOF8cYoA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yNlQyMjoxMzoyNlrOF8caaw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5ODkyMzkzNg==", "bodyText": "Sortof ok, but better to just comment that these might occur and let them propoage.", "url": "https://github.com/GoogleCloudPlatform/java-docs-samples/pull/2450#discussion_r398923936", "createdAt": "2020-03-26T22:12:21Z", "author": {"login": "lesv"}, "path": "functions/snippets/src/main/java/com/example/functions/FirebaseFirestoreReactive.java", "diffHunk": "@@ -0,0 +1,69 @@\n+/*\n+ * Copyright 2020 Google LLC\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ * http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package com.example.functions;\n+\n+// [START functions_firebase_reactive]\n+\n+import com.google.cloud.firestore.Firestore;\n+import com.google.cloud.firestore.FirestoreOptions;\n+import com.google.cloud.firestore.SetOptions;\n+import com.google.cloud.functions.Context;\n+import com.google.cloud.functions.RawBackgroundFunction;\n+import com.google.gson.Gson;\n+import com.google.gson.JsonObject;\n+import java.util.HashMap;\n+import java.util.Map;\n+import java.util.concurrent.ExecutionException;\n+import java.util.logging.Logger;\n+\n+public class FirebaseFirestoreReactive implements RawBackgroundFunction {\n+\n+  // Use GSON (https://github.com/google/gson) to parse JSON content.\n+  private Gson gsonParser = new Gson();\n+\n+  private static final Logger LOGGER = Logger.getLogger(FirebaseFirestoreReactive.class.getName());\n+  private static final Firestore firestore = FirestoreOptions.getDefaultInstance().getService();\n+\n+  @Override\n+  public void accept(String json, Context context) throws RuntimeException {\n+    // Get the recently-written value\n+    JsonObject body = gsonParser.fromJson(json, JsonObject.class);\n+    JsonObject fields = body.getAsJsonObject(\"value\").getAsJsonObject(\"fields\");\n+    if (!fields.has(\"original\")) {\n+      return;\n+    }\n+\n+    // Convert recently-written value to ALL CAPS\n+    String currentValue = fields.getAsJsonObject(\"original\").get(\"stringValue\").getAsString();\n+    String newValue = currentValue.toUpperCase();\n+\n+    // Update Firestore DB with ALL CAPS value\n+    Map<String, String> newFields = new HashMap<>();\n+    newFields.put(\"original\", newValue);\n+\n+    String affectedDoc = context.resource().split(\"/documents/\")[1].replace(\"\\\"\", \"\");\n+\n+    LOGGER.info(String.format(\"Replacing value: %s --> %s\", currentValue, newValue));\n+    try {\n+      firestore.document(affectedDoc).set(newFields, SetOptions.merge()).get();\n+    } catch (ExecutionException | InterruptedException e) {\n+      throw new RuntimeException(e);\n+    }", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "9f9d0a74a325fa2979b84925f8445ab19b8e56d2"}, "originalPosition": 65}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5ODkyNDE1OA==", "bodyText": "Normally, you'd check between these, or use an operator that checks / skips if null.", "url": "https://github.com/GoogleCloudPlatform/java-docs-samples/pull/2450#discussion_r398924158", "createdAt": "2020-03-26T22:12:55Z", "author": {"login": "lesv"}, "path": "functions/snippets/src/main/java/com/example/functions/FirebaseFirestoreReactive.java", "diffHunk": "@@ -0,0 +1,69 @@\n+/*\n+ * Copyright 2020 Google LLC\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ * http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package com.example.functions;\n+\n+// [START functions_firebase_reactive]\n+\n+import com.google.cloud.firestore.Firestore;\n+import com.google.cloud.firestore.FirestoreOptions;\n+import com.google.cloud.firestore.SetOptions;\n+import com.google.cloud.functions.Context;\n+import com.google.cloud.functions.RawBackgroundFunction;\n+import com.google.gson.Gson;\n+import com.google.gson.JsonObject;\n+import java.util.HashMap;\n+import java.util.Map;\n+import java.util.concurrent.ExecutionException;\n+import java.util.logging.Logger;\n+\n+public class FirebaseFirestoreReactive implements RawBackgroundFunction {\n+\n+  // Use GSON (https://github.com/google/gson) to parse JSON content.\n+  private Gson gsonParser = new Gson();\n+\n+  private static final Logger LOGGER = Logger.getLogger(FirebaseFirestoreReactive.class.getName());\n+  private static final Firestore firestore = FirestoreOptions.getDefaultInstance().getService();\n+\n+  @Override\n+  public void accept(String json, Context context) throws RuntimeException {\n+    // Get the recently-written value\n+    JsonObject body = gsonParser.fromJson(json, JsonObject.class);\n+    JsonObject fields = body.getAsJsonObject(\"value\").getAsJsonObject(\"fields\");", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "9f9d0a74a325fa2979b84925f8445ab19b8e56d2"}, "originalPosition": 45}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5ODkyNDM5NQ==", "bodyText": "Same issue, if 'original' isn't present, then you'll get an error getting 'stringValue'", "url": "https://github.com/GoogleCloudPlatform/java-docs-samples/pull/2450#discussion_r398924395", "createdAt": "2020-03-26T22:13:26Z", "author": {"login": "lesv"}, "path": "functions/snippets/src/main/java/com/example/functions/FirebaseFirestoreReactive.java", "diffHunk": "@@ -0,0 +1,69 @@\n+/*\n+ * Copyright 2020 Google LLC\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ * http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package com.example.functions;\n+\n+// [START functions_firebase_reactive]\n+\n+import com.google.cloud.firestore.Firestore;\n+import com.google.cloud.firestore.FirestoreOptions;\n+import com.google.cloud.firestore.SetOptions;\n+import com.google.cloud.functions.Context;\n+import com.google.cloud.functions.RawBackgroundFunction;\n+import com.google.gson.Gson;\n+import com.google.gson.JsonObject;\n+import java.util.HashMap;\n+import java.util.Map;\n+import java.util.concurrent.ExecutionException;\n+import java.util.logging.Logger;\n+\n+public class FirebaseFirestoreReactive implements RawBackgroundFunction {\n+\n+  // Use GSON (https://github.com/google/gson) to parse JSON content.\n+  private Gson gsonParser = new Gson();\n+\n+  private static final Logger LOGGER = Logger.getLogger(FirebaseFirestoreReactive.class.getName());\n+  private static final Firestore firestore = FirestoreOptions.getDefaultInstance().getService();\n+\n+  @Override\n+  public void accept(String json, Context context) throws RuntimeException {\n+    // Get the recently-written value\n+    JsonObject body = gsonParser.fromJson(json, JsonObject.class);\n+    JsonObject fields = body.getAsJsonObject(\"value\").getAsJsonObject(\"fields\");\n+    if (!fields.has(\"original\")) {\n+      return;\n+    }\n+\n+    // Convert recently-written value to ALL CAPS\n+    String currentValue = fields.getAsJsonObject(\"original\").get(\"stringValue\").getAsString();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "9f9d0a74a325fa2979b84925f8445ab19b8e56d2"}, "originalPosition": 51}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a5e31d297f8cf13742b88f79edcdee352dc9cbdb", "author": {"user": {"login": "ace-n", "name": "Ace Nassri"}}, "url": "https://github.com/GoogleCloudPlatform/java-docs-samples/commit/a5e31d297f8cf13742b88f79edcdee352dc9cbdb", "committedDate": "2020-03-26T22:55:12Z", "message": "Improve exception handling for firebase reactive sample"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c5355a2cf8daf56a4f2e9776c313e52fe8ff1f05", "author": {"user": {"login": "ace-n", "name": "Ace Nassri"}}, "url": "https://github.com/GoogleCloudPlatform/java-docs-samples/commit/c5355a2cf8daf56a4f2e9776c313e52fe8ff1f05", "committedDate": "2020-03-27T00:14:28Z", "message": "Revert \"Improve exception handling for firebase reactive sample\"\n\nThis reverts commit a5e31d297f8cf13742b88f79edcdee352dc9cbdb."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "01696088b59ad23cdc8705600a9c31a20d3667bd", "author": {"user": {"login": "ace-n", "name": "Ace Nassri"}}, "url": "https://github.com/GoogleCloudPlatform/java-docs-samples/commit/01696088b59ad23cdc8705600a9c31a20d3667bd", "committedDate": "2020-03-27T00:28:30Z", "message": "Exception handling take 2"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "df1c623cf76f41d3651c1dd87dd94f86dcb31a7f", "author": {"user": {"login": "ace-n", "name": "Ace Nassri"}}, "url": "https://github.com/GoogleCloudPlatform/java-docs-samples/commit/df1c623cf76f41d3651c1dd87dd94f86dcb31a7f", "committedDate": "2020-03-27T00:31:48Z", "message": "fix style"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b71960b02588c30f21ea3c81feeea1f8aeb8983a", "author": {"user": {"login": "ace-n", "name": "Ace Nassri"}}, "url": "https://github.com/GoogleCloudPlatform/java-docs-samples/commit/b71960b02588c30f21ea3c81feeea1f8aeb8983a", "committedDate": "2020-03-27T00:32:44Z", "message": "Merge branch 'master' into gcf-firebase"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 949, "cost": 1, "resetAt": "2021-11-01T14:20:25Z"}}}