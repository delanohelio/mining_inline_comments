{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTAyNzIzOTQy", "number": 3993, "title": "samples: added cleanup option", "bodyText": "Fixes #3836\n\n Please merge this PR for me once it is approved.", "createdAt": "2020-10-13T19:15:50Z", "url": "https://github.com/GoogleCloudPlatform/java-docs-samples/pull/3993", "merged": true, "mergeCommit": {"oid": "33f9b6a0e3d5a088ea1c16da14c337660da77e7a"}, "closed": true, "closedAt": "2020-10-13T21:10:06Z", "author": {"login": "munkhuushmgl"}, "timelineItems": {"totalCount": 5, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdSNhpDgH2gAyNTAyNzIzOTQyOmZkMjY3ZDkwNmY0YWMyMmRiY2IxZmI3NjA5MjUzN2NhZTdjNTZlNzI=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdSPIeHAH2gAyNTAyNzIzOTQyOjE0MGJjYjVlYTVlNTZhOTgzMGZlZWExMmQxYTk0Y2ZmODUwNGE3ZGM=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "fd267d906f4ac22dbcb1fb76092537cae7c56e72", "author": {"user": {"login": "munkhuushmgl", "name": "Mike"}}, "url": "https://github.com/GoogleCloudPlatform/java-docs-samples/commit/fd267d906f4ac22dbcb1fb76092537cae7c56e72", "committedDate": "2020-10-13T19:13:23Z", "message": "samples: added cleanup option"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "6d2cabaf9e38eceb852055c0fcf1ff7ef3c971f2", "author": {"user": {"login": "munkhuushmgl", "name": "Mike"}}, "url": "https://github.com/GoogleCloudPlatform/java-docs-samples/commit/6d2cabaf9e38eceb852055c0fcf1ff7ef3c971f2", "committedDate": "2020-10-13T20:34:45Z", "message": "removed the main"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTA3ODE5NDcx", "url": "https://github.com/GoogleCloudPlatform/java-docs-samples/pull/3993#pullrequestreview-507819471", "createdAt": "2020-10-13T20:52:07Z", "commit": {"oid": "6d2cabaf9e38eceb852055c0fcf1ff7ef3c971f2"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xM1QyMDo1MjowN1rOHg5DQw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xM1QyMDo1MjowN1rOHg5DQw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNDI1MTIwMw==", "bodyText": "Do you mean for this to be here?", "url": "https://github.com/GoogleCloudPlatform/java-docs-samples/pull/3993#discussion_r504251203", "createdAt": "2020-10-13T20:52:07Z", "author": {"login": "lesv"}, "path": "iot/api-client/end-to-end-example/src/test/java/com/example/cloud/iot/endtoend/CloudiotPubsubExampleServerTest.java", "diffHunk": "@@ -80,6 +95,37 @@ public void testConfigTurnOn() throws GeneralSecurityException, IOException, JSO\n     CloudiotPubsubExampleServer.deleteRegistry(CLOUD_REGION, PROJECT_ID, REGISTRY_ID);\n   }\n \n+  private void deleteUnusedOldRegistries(String projectId, String region)\n+      throws IOException, GeneralSecurityException {\n+    // Clean 50 oldest registries with testing prefix in the project.\n+    System.out.println(\"The maximum number of registries is about to exceed.\");\n+    System.out.println(\"Deleting the oldest 50 registries with IoT Test prefix\");\n+\n+    // Gather all the registries into temp list\n+    List<DeviceRegistry> registries = CleanUpHelper.getRegisteries(PROJECT_ID, CLOUD_REGION);\n+\n+    // Filter all registries with prefix.\n+    // since the list is already sorted by currentMillis suffix,\n+    // first 50 will be the oldest.\n+    List<DeviceRegistry> filteredRegistries = new ArrayList<>();\n+\n+    for (int i = 0; i < registries.size(); i++) {\n+      DeviceRegistry registry = registries.get(i);\n+      if (registry.getName().contains(\"test-registry-\")\n+          || registry.getName().contains(\"java-reg-\")) {\n+        filteredRegistries.add(registry);\n+      }\n+    }\n+\n+    // Delete the 50 oldest registries\n+    for (DeviceRegistry registry : filteredRegistries) {\n+      CleanUpHelper.clearRegistry(CLOUD_REGION, PROJECT_ID, registry.getId());\n+    }\n+    //      if()\n+    //      CleanUpHelper.clearRegistry();\n+    //    }", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "6d2cabaf9e38eceb852055c0fcf1ff7ef3c971f2"}, "originalPosition": 68}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTA3ODE5OTY1", "url": "https://github.com/GoogleCloudPlatform/java-docs-samples/pull/3993#pullrequestreview-507819965", "createdAt": "2020-10-13T20:52:51Z", "commit": {"oid": "6d2cabaf9e38eceb852055c0fcf1ff7ef3c971f2"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "140bcb5ea5e56a9830feea12d1a94cff8504a7dc", "author": {"user": {"login": "munkhuushmgl", "name": "Mike"}}, "url": "https://github.com/GoogleCloudPlatform/java-docs-samples/commit/140bcb5ea5e56a9830feea12d1a94cff8504a7dc", "committedDate": "2020-10-13T21:05:42Z", "message": "removed commented out code"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 457, "cost": 1, "resetAt": "2021-11-01T14:20:25Z"}}}