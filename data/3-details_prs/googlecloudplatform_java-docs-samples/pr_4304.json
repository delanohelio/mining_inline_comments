{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTI2ODA5MDMx", "number": 4304, "title": "Refactor Storage Transfer Service samples", "bodyText": "This is a refactor to address several issues with the transfer service samples.\nThe main issue is that the samples were not copy-paste runnable. For samples that are meant to exist on a docs page like these (These sample exist on https://cloud.google.com/storage-transfer/docs/create-manage-transfer-program#java), someone reading that page should be able to copy and paste the samples into their environment and run them. That wasn't possible to do with these samples because they used several utility methods which are in the sample package but do not appear on the docs page. If someone copy and pasted them into their own environment, they'd see a bunch of NoSuchMethod errors. The only way for a user reading these samples from the docs page to use them would be to click the \"see in github\" button and find the utility classes in github and copy them, or to depend on the samples package in Maven. Neither of these are good experiences.\nThis refactor addresses this issue by stopping the use of these utility methods in the samples and instead implementing the functionality within the samples themselves. This makes the code longer and a little messier, but it's much more useful to someone reading it from the docs page, which is the primary target audience. The utility methods are still in the package just in case anyone does have a dependency on it and is using them, and also because they are still useful for tests.\nAdditionally, this addresses the following:\n\nAdds comments explaining what each argument is and giving an example\nGets rid of the structure of a main(String[] args) method that passes in parameters to a sample method. This is extraneous and not conducive to the samples that are meant to exist on a docs page. It would work for samples that are meant to be checked out and run locally, but since these samples exist on a docs page we should optimize them for that. To that end, this also deletes the readme file with instructions for running locally.\nAdds region tags for internal tracking\nGives the samples more descriptive names that describe the operation they do\nSwitches from using a custom timestamp string format to using an epoch timestamp long. Java developers are accustomed to using Date objects which are backed by such longs, and shouldn't have to manually write a translation from whatever date format their own code uses to our format in order to use our API\n\nFixes: #3706 #4018", "createdAt": "2020-11-24T21:54:20Z", "url": "https://github.com/GoogleCloudPlatform/java-docs-samples/pull/4304", "merged": true, "mergeCommit": {"oid": "124dff3e9c94470b0cdd7567132dc67c8a880326"}, "closed": true, "closedAt": "2020-12-09T23:31:15Z", "author": {"login": "JesseLovelace"}, "timelineItems": {"totalCount": 15, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdfwnlXAH2gAyNTI2ODA5MDMxOmViYmVkZTE0ODAyZWZkM2JjZmY0YmJkNDYwYmM1ODA0MTM0OGQzNTI=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdknYEpAFqTU0ODcwMDUwMA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "ebbede14802efd3bcff4bbd460bc58041348d352", "author": {"user": {"login": "JesseLovelace", "name": null}}, "url": "https://github.com/GoogleCloudPlatform/java-docs-samples/commit/ebbede14802efd3bcff4bbd460bc58041348d352", "committedDate": "2020-11-24T21:27:34Z", "message": "Refactor Storage Transfer Service samples"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f7d8f6dab097de24e2bdafa026749cdd635e3bf5", "author": {"user": {"login": "JesseLovelace", "name": null}}, "url": "https://github.com/GoogleCloudPlatform/java-docs-samples/commit/f7d8f6dab097de24e2bdafa026749cdd635e3bf5", "committedDate": "2020-11-24T21:42:43Z", "message": "Refactor Storage Transfer Service samples"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "67a7fcd179f0cab841dd98930779eb263076b788", "author": {"user": {"login": "JesseLovelace", "name": null}}, "url": "https://github.com/GoogleCloudPlatform/java-docs-samples/commit/67a7fcd179f0cab841dd98930779eb263076b788", "committedDate": "2020-11-24T21:42:56Z", "message": "Merge branch 'refactorstssamples' of github.com:GoogleCloudPlatform/java-docs-samples into refactorstssamples"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTM4MDQ2MTE2", "url": "https://github.com/GoogleCloudPlatform/java-docs-samples/pull/4304#pullrequestreview-538046116", "createdAt": "2020-11-24T23:23:25Z", "commit": {"oid": "67a7fcd179f0cab841dd98930779eb263076b788"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0yNFQyMzoyMzoyNVrOH5cgIw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0yNFQyMzoyNzoxN1rOH5cvCQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyOTk5Nzg1OQ==", "bodyText": "Is this utility class still needed?\nIf removed, you can close out: #3706", "url": "https://github.com/GoogleCloudPlatform/java-docs-samples/pull/4304#discussion_r529997859", "createdAt": "2020-11-24T23:23:25Z", "author": {"login": "frankyn"}, "path": "storage/storage-transfer/src/test/java/com/google/cloud/storage/storagetransfer/samples/test/TransferJobUtilsTest.java", "diffHunk": "@@ -21,11 +21,9 @@\n import com.google.api.services.storagetransfer.v1.model.Date;\n import com.google.api.services.storagetransfer.v1.model.TimeOfDay;\n import com.google.cloud.storage.storagetransfer.samples.TransferJobUtils;\n-import java.util.Random;\n import org.junit.Test;\n \n public class TransferJobUtilsTest {\n-  private Random rand = new Random();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "67a7fcd179f0cab841dd98930779eb263076b788"}, "originalPosition": 8}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMDAwMTY3Mw==", "bodyText": "This PR will fix: #4018", "url": "https://github.com/GoogleCloudPlatform/java-docs-samples/pull/4304#discussion_r530001673", "createdAt": "2020-11-24T23:27:17Z", "author": {"login": "frankyn"}, "path": "storage/storage-transfer/pom.xml", "diffHunk": "@@ -43,7 +43,7 @@\n     <dependency>\n       <groupId>com.google.apis</groupId>\n       <artifactId>google-api-services-storagetransfer</artifactId>\n-      <version>v1-rev20200924-1.30.10</version>\n+      <version>v1-rev20201027-1.30.10</version>", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "67a7fcd179f0cab841dd98930779eb263076b788"}, "originalPosition": 5}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "63556eb64bd1a7dbfc6c05037c3683a3605ff188", "author": {"user": {"login": "JesseLovelace", "name": null}}, "url": "https://github.com/GoogleCloudPlatform/java-docs-samples/commit/63556eb64bd1a7dbfc6c05037c3683a3605ff188", "committedDate": "2020-12-04T00:06:49Z", "message": "move utils to test package"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "5f0f3a7cb9d95ae8e9546954b5059ef8a0d0a458", "author": {"user": {"login": "JesseLovelace", "name": null}}, "url": "https://github.com/GoogleCloudPlatform/java-docs-samples/commit/5f0f3a7cb9d95ae8e9546954b5059ef8a0d0a458", "committedDate": "2020-12-04T00:07:24Z", "message": "Merge branch 'master' into refactorstssamples"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "2fda23c3bdc9111c1b2c57b5362b980fcdb1f807", "author": {"user": {"login": "JesseLovelace", "name": null}}, "url": "https://github.com/GoogleCloudPlatform/java-docs-samples/commit/2fda23c3bdc9111c1b2c57b5362b980fcdb1f807", "committedDate": "2020-12-09T00:02:47Z", "message": "fix linting issues"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "866a949d973cb20f21c2d9f7482802945bc53276", "author": {"user": {"login": "JesseLovelace", "name": null}}, "url": "https://github.com/GoogleCloudPlatform/java-docs-samples/commit/866a949d973cb20f21c2d9f7482802945bc53276", "committedDate": "2020-12-09T00:03:18Z", "message": "Merge branch 'refactorstssamples' of github.com:GoogleCloudPlatform/java-docs-samples into refactorstssamples"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "04f4a4a2f680732a107a9e656e9a790e76f21d22", "author": {"user": {"login": "JesseLovelace", "name": null}}, "url": "https://github.com/GoogleCloudPlatform/java-docs-samples/commit/04f4a4a2f680732a107a9e656e9a790e76f21d22", "committedDate": "2020-12-09T00:06:40Z", "message": "Merge remote-tracking branch 'origin/master' into refactorstssamples"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "dc54f459a56e7d9bbfcca98a22ec50e4bca90b70", "author": {"user": {"login": "JesseLovelace", "name": null}}, "url": "https://github.com/GoogleCloudPlatform/java-docs-samples/commit/dc54f459a56e7d9bbfcca98a22ec50e4bca90b70", "committedDate": "2020-12-09T00:16:55Z", "message": "Fix import issue after merge"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTQ3NzQyOTA0", "url": "https://github.com/GoogleCloudPlatform/java-docs-samples/pull/4304#pullrequestreview-547742904", "createdAt": "2020-12-09T00:24:05Z", "commit": {"oid": "dc54f459a56e7d9bbfcca98a22ec50e4bca90b70"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0wOVQwMDoyNDowNVrOIB8dQw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0wOVQwMDoyNDowNVrOIB8dQw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzODkxMDAxOQ==", "bodyText": "Newline", "url": "https://github.com/GoogleCloudPlatform/java-docs-samples/pull/4304#discussion_r538910019", "createdAt": "2020-12-09T00:24:05Z", "author": {"login": "frankyn"}, "path": "storage/storage-transfer/src/main/java/com/google/cloud/storage/storagetransfer/samples/TransferToNearline.java", "diffHunk": "@@ -0,0 +1,108 @@\n+/*\n+ * Copyright 2020 Google Inc.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ * http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package com.google.cloud.storage.storagetransfer.samples;\n+\n+// [START storagetransfer_transfer_to_nearline]\n+import com.google.api.client.googleapis.util.Utils;\n+import com.google.api.services.storagetransfer.v1.Storagetransfer;\n+import com.google.api.services.storagetransfer.v1.StoragetransferScopes;\n+import com.google.api.services.storagetransfer.v1.model.Date;\n+import com.google.api.services.storagetransfer.v1.model.GcsData;\n+import com.google.api.services.storagetransfer.v1.model.ObjectConditions;\n+import com.google.api.services.storagetransfer.v1.model.Schedule;\n+import com.google.api.services.storagetransfer.v1.model.TimeOfDay;\n+import com.google.api.services.storagetransfer.v1.model.TransferJob;\n+import com.google.api.services.storagetransfer.v1.model.TransferOptions;\n+import com.google.api.services.storagetransfer.v1.model.TransferSpec;\n+import com.google.auth.http.HttpCredentialsAdapter;\n+import com.google.auth.oauth2.GoogleCredentials;\n+import java.io.IOException;\n+import java.util.Calendar;\n+\n+public class TransferToNearline {\n+  /** Creates a one-off transfer job that transfers objects in a standard GCS bucket that are more\n+   *  than 30 days old to a Nearline GCS bucket.\n+   */\n+  public static void transferToNearline(String projectId,\n+      String jobDescription,\n+      String gcsSourceBucket,\n+      String gcsNearlineSinkBucket,\n+      long startDateTime) throws IOException {\n+\n+    // Your Google Cloud Project ID\n+    // String projectId = \"your-project-id\";\n+\n+    // A short description of this job\n+    // String jobDescription = \"Sample transfer job of old objects to a Nearline GCS bucket.\";\n+\n+    // The name of the source GCS bucket to transfer data from\n+    // String gcsSourceBucket = \"your-gcs-source-bucket\";\n+\n+    // The name of the Nearline GCS bucket to transfer old objects to\n+    // String gcsSinkBucket = \"your-nearline-gcs-bucket\";\n+\n+    // What day and time in UTC to start the transfer, expressed as an epoch date timestamp.\n+    // If this is in the past relative to when the job is created, it will run the next day.\n+    // long startDateTime =\n+    //     new SimpleDateFormat(\"yyyy-MM-dd HH:mm:ss\").parse(\"2000-01-01 00:00:00\").getTime();\n+\n+    // Parse epoch timestamp into the model classes\n+    Calendar startCalendar = Calendar.getInstance();\n+    startCalendar.setTimeInMillis(startDateTime);\n+    // Note that this is a Date from the model class package, not a java.util.Date\n+    Date date = new Date()\n+        .setYear(startCalendar.get(Calendar.YEAR))\n+        .setMonth(startCalendar.get(Calendar.MONTH) + 1)\n+        .setDay(startCalendar.get(Calendar.DAY_OF_MONTH));\n+    TimeOfDay time = new TimeOfDay()\n+        .setHours(startCalendar.get(Calendar.HOUR_OF_DAY))\n+        .setMinutes(startCalendar.get(Calendar.MINUTE))\n+        .setSeconds(startCalendar.get(Calendar.SECOND));\n+\n+    TransferJob transferJob =\n+        new TransferJob()\n+            .setDescription(jobDescription)\n+            .setProjectId(projectId)\n+            .setTransferSpec(\n+                new TransferSpec()\n+                    .setGcsDataSource(new GcsData().setBucketName(gcsSourceBucket))\n+                    .setGcsDataSink(new GcsData().setBucketName(gcsNearlineSinkBucket))\n+                    .setObjectConditions(\n+                        new ObjectConditions()\n+                            .setMinTimeElapsedSinceLastModification(\"2592000s\" /* 30 days */))\n+                    .setTransferOptions(\n+                        new TransferOptions().setDeleteObjectsFromSourceAfterTransfer(true)))\n+            .setSchedule(new Schedule().setScheduleStartDate(date).setStartTimeOfDay(time))\n+            .setStatus(\"ENABLED\");\n+\n+    // Create a Transfer Service client\n+    GoogleCredentials credential = GoogleCredentials.getApplicationDefault();\n+    if (credential.createScopedRequired()) {\n+      credential = credential.createScoped(StoragetransferScopes.all());\n+    }\n+    Storagetransfer storageTransfer = new Storagetransfer.Builder(Utils.getDefaultTransport(),\n+        Utils.getDefaultJsonFactory(), new HttpCredentialsAdapter(credential))\n+        .build();\n+\n+    // Create the transfer job\n+    TransferJob response = storageTransfer.transferJobs().create(transferJob).execute();\n+\n+    System.out.println(\"Created transfer job from standard bucket to Nearline bucket:\");\n+    System.out.println(response.toPrettyString());\n+  }\n+}\n+// [END storagetransfer_transfer_to_nearline]", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "dc54f459a56e7d9bbfcca98a22ec50e4bca90b70"}, "originalPosition": 108}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "5e316737b0fc387f324d00d5833a7f4df96845b5", "author": {"user": {"login": "JesseLovelace", "name": null}}, "url": "https://github.com/GoogleCloudPlatform/java-docs-samples/commit/5e316737b0fc387f324d00d5833a7f4df96845b5", "committedDate": "2020-12-09T00:34:51Z", "message": "Add newline and fix util issues"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTQ3NzQ3ODQ1", "url": "https://github.com/GoogleCloudPlatform/java-docs-samples/pull/4304#pullrequestreview-547747845", "createdAt": "2020-12-09T00:37:16Z", "commit": {"oid": "5e316737b0fc387f324d00d5833a7f4df96845b5"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTQ4Njk5MTc3", "url": "https://github.com/GoogleCloudPlatform/java-docs-samples/pull/4304#pullrequestreview-548699177", "createdAt": "2020-12-09T23:28:12Z", "commit": {"oid": "5e316737b0fc387f324d00d5833a7f4df96845b5"}, "state": "COMMENTED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTQ4NzAwNTAw", "url": "https://github.com/GoogleCloudPlatform/java-docs-samples/pull/4304#pullrequestreview-548700500", "createdAt": "2020-12-09T23:31:06Z", "commit": {"oid": "5e316737b0fc387f324d00d5833a7f4df96845b5"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 415, "cost": 1, "resetAt": "2021-11-01T14:20:25Z"}}}