{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDI3NTEzMzU2", "number": 3049, "title": "Fix DLP inspect tests to fail on timeout", "bodyText": "Update DLP inspect tests to fail properly, instead of timing out after 15 minutes and passing.\nAlso remove some broken code that tried to cancel early.\nFixes internal bug b/158026949\n\n I have followed Sample Format Guide\n pom.xml parent set to latest shared-configuration\n Appropriate changes to README are included in PR\n API's need to be enabled to test (tell us)\n Environment Variables need to be set (ask us to set them)\n Tests pass (mvn -P lint clean verify)\n\n(Note- Checkstyle passing is required; Spotbugs, ErrorProne, PMD, etc. ERROR's are advisory only)\n\n\n Please merge this PR for me once it is approved.", "createdAt": "2020-06-04T00:02:42Z", "url": "https://github.com/GoogleCloudPlatform/java-docs-samples/pull/3049", "merged": true, "mergeCommit": {"oid": "512c17421bc22f4525ff9ca1e9c4d8241e99d1a4"}, "closed": true, "closedAt": "2020-06-04T23:40:17Z", "author": {"login": "sushicw"}, "timelineItems": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcoAs0AAFqTQyNDYyNTYwOA==", "endCursor": "Y3Vyc29yOnYyOpPPAAABcoEGFRgBqjM0MDg2MDQ4MDM=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDI0NjI1NjA4", "url": "https://github.com/GoogleCloudPlatform/java-docs-samples/pull/3049#pullrequestreview-424625608", "createdAt": "2020-06-04T16:28:50Z", "commit": {"oid": "0f58e94bc1c87d79a0a3959ae90f689cfb218cac"}, "state": "APPROVED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wNFQxNjoyODo1MVrOGfOI3A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wNFQxNjozMDoxNVrOGfOMkQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNTM5MDY4NA==", "bodyText": "It's actually best to throw the most specific exceptions so that users understand and can mitigate what's going on.  That said, in a test, this is less important.", "url": "https://github.com/GoogleCloudPlatform/java-docs-samples/pull/3049#discussion_r435390684", "createdAt": "2020-06-04T16:28:51Z", "author": {"login": "lesv"}, "path": "dlp/src/test/java/dlp/snippets/InspectTests.java", "diffHunk": "@@ -124,60 +122,30 @@ public void testInspectImageFile() {\n   }\n \n   @Test\n-  public void testInspectGcsFile() throws InterruptedException, ExecutionException, IOException {\n-\n+  public void testInspectGcsFile() throws Exception {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "0f58e94bc1c87d79a0a3959ae90f689cfb218cac"}, "originalPosition": 17}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNTM5MTYzMw==", "bodyText": "Why did you reduce the throws here?", "url": "https://github.com/GoogleCloudPlatform/java-docs-samples/pull/3049#discussion_r435391633", "createdAt": "2020-06-04T16:30:15Z", "author": {"login": "lesv"}, "path": "dlp/src/test/java/dlp/snippets/InspectTests.java", "diffHunk": "@@ -124,60 +122,30 @@ public void testInspectImageFile() {\n   }\n \n   @Test\n-  public void testInspectGcsFile() throws InterruptedException, ExecutionException, IOException {\n-\n+  public void testInspectGcsFile() throws Exception {\n     InspectGcsFile.inspectGcsFile(PROJECT_ID, GCS_PATH, TOPIC_ID, SUBSCRIPTION_ID);\n-    // Await job creation\n-    TimeUnit.SECONDS.sleep(3);\n \n     String output = bout.toString();\n-    assertThat(output, containsString(\"Job created: \"));\n-\n-    // Cancelling the job early to conserve quota\n-    String jobId = output.split(\"Job created: \")[1].split(\"\\n\")[0];\n-    CancelDlpJobRequest request = CancelDlpJobRequest.newBuilder().setName(jobId).build();\n-    try (DlpServiceClient client = DlpServiceClient.create()) {\n-      client.cancelDlpJob(request);\n-    }\n+    assertThat(output, containsString(\"Job status: DONE\"));\n   }\n \n   @Test\n-  public void testInspectDatastoreEntity()\n-      throws InterruptedException, ExecutionException, IOException {\n+  public void testInspectDatastoreEntity() throws Exception {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "0f58e94bc1c87d79a0a3959ae90f689cfb218cac"}, "originalPosition": 37}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDI0NjMzODY3", "url": "https://github.com/GoogleCloudPlatform/java-docs-samples/pull/3049#pullrequestreview-424633867", "createdAt": "2020-06-04T16:38:56Z", "commit": {"oid": "0f58e94bc1c87d79a0a3959ae90f689cfb218cac"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "33a67014907bad01b0faaca615e2bcba8b6d350a", "author": {"user": {"login": "sushicw", "name": "Chris Wilson"}}, "url": "https://github.com/GoogleCloudPlatform/java-docs-samples/commit/33a67014907bad01b0faaca615e2bcba8b6d350a", "committedDate": "2020-06-04T20:28:59Z", "message": "Fix inspect tests"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "0f58e94bc1c87d79a0a3959ae90f689cfb218cac", "author": {"user": {"login": "sushicw", "name": "Chris Wilson"}}, "url": "https://github.com/GoogleCloudPlatform/java-docs-samples/commit/0f58e94bc1c87d79a0a3959ae90f689cfb218cac", "committedDate": "2020-06-03T23:55:17Z", "message": "Fix inspect tests"}, "afterCommit": {"oid": "33a67014907bad01b0faaca615e2bcba8b6d350a", "author": {"user": {"login": "sushicw", "name": "Chris Wilson"}}, "url": "https://github.com/GoogleCloudPlatform/java-docs-samples/commit/33a67014907bad01b0faaca615e2bcba8b6d350a", "committedDate": "2020-06-04T20:28:59Z", "message": "Fix inspect tests"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 694, "cost": 1, "resetAt": "2021-11-01T14:20:25Z"}}}