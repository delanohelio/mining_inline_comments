{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDcxNzkyMDY3", "number": 3588, "title": "samples(test): refactor automl test", "bodyText": "Fixes #3550\nLooks like in setup, ListOperations that had a very long list of operations to list which making a test to wait for 10-15min, Then, sometimes it fails with a internal error.\n\n Please merge this PR for me once it is approved.", "createdAt": "2020-08-21T18:38:59Z", "url": "https://github.com/GoogleCloudPlatform/java-docs-samples/pull/3588", "merged": true, "mergeCommit": {"oid": "bfef2c5f9812fd54f363d4a75599febf3d8b322f"}, "closed": true, "closedAt": "2020-08-22T00:06:06Z", "author": {"login": "munkhuushmgl"}, "timelineItems": {"totalCount": 7, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdBJM-wgH2gAyNDcxNzkyMDY3OjhmNDY1YzZlNGM5OGY5YWVhZmQ5YjU5ODg5NzI4OTMyYzAzZDYwOGU=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdBN5B4gFqTQ3Mjg3MTcwOQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "8f465c6e4c98f9aeafd9b59889728932c03d608e", "author": {"user": {"login": "munkhuushmgl", "name": "Mike"}}, "url": "https://github.com/GoogleCloudPlatform/java-docs-samples/commit/8f465c6e4c98f9aeafd9b59889728932c03d608e", "committedDate": "2020-08-21T18:34:29Z", "message": "samples(test): refactor automl test"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDcyNzc1MDg2", "url": "https://github.com/GoogleCloudPlatform/java-docs-samples/pull/3588#pullrequestreview-472775086", "createdAt": "2020-08-21T19:39:47Z", "commit": {"oid": "8f465c6e4c98f9aeafd9b59889728932c03d608e"}, "state": "APPROVED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yMVQxOTozOTo0N1rOHE5r9A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yMVQxOTozOTo0N1rOHE5r9A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NDkwMTQ5Mg==", "bodyText": "Should this have a counter of some kind to limit to 3-5m?  It should finish, but just in case?", "url": "https://github.com/GoogleCloudPlatform/java-docs-samples/pull/3588#discussion_r474901492", "createdAt": "2020-08-21T19:39:47Z", "author": {"login": "lesv"}, "path": "automl/cloud-client/src/test/java/com/example/automl/GetOperationStatusTest.java", "diffHunk": "@@ -49,29 +64,50 @@ public static void checkRequirements() {\n   }\n \n   @Before\n-  public void setUp() throws IOException {\n+  public void setUp() throws IOException, ExecutionException, InterruptedException {\n     bout = new ByteArrayOutputStream();\n     out = new PrintStream(bout);\n     System.setOut(out);\n \n-    ListOperationStatus.listOperationStatus(PROJECT_ID);\n-    String got = bout.toString();\n-    operationId = got.split(\"\\n\")[1].split(\":\")[1].trim();\n-    assertThat(got).contains(\"Operation details:\");\n+    // start a export data into dataset and cancel it before it finishes.\n+    try (AutoMlClient client = AutoMlClient.create()) {\n+      // Get the complete path of the dataset.\n+      DatasetName datasetFullId = DatasetName.of(PROJECT_ID, \"us-central1\", DATASET_ID);\n+\n+      GcsDestination gcsSource =\n+          GcsDestination.newBuilder().setOutputUriPrefix(GCS_OUTPUT_PREFIX).build();\n+\n+      OutputConfig outputConfig = OutputConfig.newBuilder().setGcsDestination(gcsSource).build();\n+\n+      // Start the export job\n+      OperationFuture<Empty, OperationMetadata> operation =\n+          client.exportDataAsync(datasetFullId, outputConfig);\n+\n+      operationFullName = operation.getName();\n+    }\n \n     bout = new ByteArrayOutputStream();\n     out = new PrintStream(bout);\n     System.setOut(out);\n   }\n \n   @After\n-  public void tearDown() {\n+  public void tearDown() throws IOException, InterruptedException {\n+    // delete the cancelled operation\n+    try (AutoMlClient client = AutoMlClient.create()) {\n+      // wait for the operation to be cancelled\n+      while (!client.getOperationsClient().getOperation(operationFullName).getDone()) {\n+        Thread.sleep(1000);\n+      }", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "8f465c6e4c98f9aeafd9b59889728932c03d608e"}, "originalPosition": 78}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "0c076d51014c0233f002562c1276ac8a25627d8c", "author": {"user": {"login": "munkhuushmgl", "name": "Mike"}}, "url": "https://github.com/GoogleCloudPlatform/java-docs-samples/commit/0c076d51014c0233f002562c1276ac8a25627d8c", "committedDate": "2020-08-21T21:30:17Z", "message": "added 3 min timeout on test"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c939369b4629a46ddc31ce66a55f069318a0c210", "author": {"user": {"login": "munkhuushmgl", "name": "Mike"}}, "url": "https://github.com/GoogleCloudPlatform/java-docs-samples/commit/c939369b4629a46ddc31ce66a55f069318a0c210", "committedDate": "2020-08-21T23:13:27Z", "message": "removed unncessary while loop"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "20c086d83c8fb8b7032061fb8c75f5b3c2d15e22", "author": {"user": {"login": "munkhuushmgl", "name": "Mike"}}, "url": "https://github.com/GoogleCloudPlatform/java-docs-samples/commit/20c086d83c8fb8b7032061fb8c75f5b3c2d15e22", "committedDate": "2020-08-21T23:41:52Z", "message": "added await"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "4efea654f4f91d4f69932a94f104717b5baf4cef", "author": {"user": {"login": "munkhuushmgl", "name": "Mike"}}, "url": "https://github.com/GoogleCloudPlatform/java-docs-samples/commit/4efea654f4f91d4f69932a94f104717b5baf4cef", "committedDate": "2020-08-21T23:45:54Z", "message": "fixed thel in"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDcyODcxNzA5", "url": "https://github.com/GoogleCloudPlatform/java-docs-samples/pull/3588#pullrequestreview-472871709", "createdAt": "2020-08-22T00:02:13Z", "commit": {"oid": "4efea654f4f91d4f69932a94f104717b5baf4cef"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 501, "cost": 1, "resetAt": "2021-11-01T14:20:25Z"}}}