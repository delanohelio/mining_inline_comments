{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0Mzc3OTYxNzQ0", "number": 3710, "title": "Added proper tab completion for /nation", "bodyText": "Description:\n\nThis pull request adds proper /nation tab complete support. Some more important changes are the returning of an Collections.emptyList() instead of null if there are no valid tab completes. null simply returns online players, and can lead to irrelevant results.\nAdditionally, the names of nations will only be returned if the player is not typing any valid sub commands. For example, typing  /nation e will only return sub commands such as enemylist, If /nation ev is typed, nation names will be returned such as an example nation called Everett. This reduces clutter and reduces the times where all nation names are checked.\nThis pull request also adds more methods to NameUtil.java. These methods are used for getting the resident names of a player's town or nation, and getting the town names of a player's nation. These method names are currently long and hard to read. They will be used by other Towny commands such as /town rank add <resident>, which should only return the residents of that player's town.\nMore specific changes include the support of /n ally add -[nation] or /n ally add [nation], where the - at the beginning still returns a nation name\n\nNew Nodes/Commands/ConfigOptions:\n\n\nRelevant Towny Issue ticket:\n\n\n\n I have tested this pull request for defects on a server.\n\n\nBy making this pull request, I represent that I have the right to waive copyright and related rights to my contribution, and agree that all copyright and related rights in my contributions are waived, and I acknowledge that the TownyAdvanced organization has the copyright to use and modify my contribution under the Towny License for perpetuity.", "createdAt": "2020-02-20T20:37:35Z", "url": "https://github.com/TownyAdvanced/Towny/pull/3710", "merged": true, "mergeCommit": {"oid": "d2d72dc5560783fa609666aa0138bc168e6df0ed"}, "closed": true, "closedAt": "2020-02-21T14:12:47Z", "author": {"login": "stzups"}, "timelineItems": {"totalCount": 10, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcGQ-zBAH2gAyMzc3OTYxNzQ0OjExZWExYmE4MjU2NDk3MjkxNmE5MjZjZmQyOTk1ZDdmOTZjODE5Zjc=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcGUt12AH2gAyMzc3OTYxNzQ0OjcxNTRkY2NjZWQ5MzU0YzdmYzQxOTEwYTA4OGI4NmRlYzdkNTFlNDA=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "11ea1ba82564972916a926cfd2995d7f96c819f7", "author": {"user": {"login": "stzups", "name": null}}, "url": "https://github.com/TownyAdvanced/Towny/commit/11ea1ba82564972916a926cfd2995d7f96c819f7", "committedDate": "2020-02-20T20:16:42Z", "message": "Added proper tab completion for /nation"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "202c0e6584096a036b9cf6468cc4450f1812b726", "author": {"user": {"login": "stzups", "name": null}}, "url": "https://github.com/TownyAdvanced/Towny/commit/202c0e6584096a036b9cf6468cc4450f1812b726", "committedDate": "2020-02-20T21:32:35Z", "message": "Made nationEnemyTabCompletes and nationAllyTabCompletes static"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzYyMjkzMjYz", "url": "https://github.com/TownyAdvanced/Towny/pull/3710#pullrequestreview-362293263", "createdAt": "2020-02-20T22:53:59Z", "commit": {"oid": "202c0e6584096a036b9cf6468cc4450f1812b726"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yMFQyMjo1NDowMFrOFsmAow==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yMFQyMjo1NDowMFrOFsmAow==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MjMwNDQxOQ==", "bodyText": "The rank will have to return a list of players in the nation", "url": "https://github.com/TownyAdvanced/Towny/pull/3710#discussion_r382304419", "createdAt": "2020-02-20T22:54:00Z", "author": {"login": "LlmDl"}, "path": "src/com/palmergames/bukkit/towny/command/NationCommand.java", "diffHunk": "@@ -188,43 +204,110 @@\n \t@Override\r\n \tpublic List<String> onTabComplete(CommandSender sender, Command command, String alias, String[] args) {\r\n \r\n-\t\tif (args.length == 1) {\r\n-\t\t\tList<String> nationNames = NameUtil.getNationNames();\r\n-\t\t\tnationNames.addAll(nationTabCompletes);\r\n-\t\t\treturn NameUtil.filterByStart(nationNames, args[0]);\r\n-\t\t}\r\n-\r\n-\t\tif (args.length == 2) {\r\n-\t\t\tswitch (args[0].toLowerCase()) {\r\n-\t\t\t\tcase \"set\":\r\n-\t\t\t\t\treturn NameUtil.filterByStart(nationSetTabCompletes, args[1]);\r\n-\t\t\t\tcase \"rank\":\r\n-\t\t\t\tcase \"ally\":\r\n-\t\t\t\tcase \"enemy\":\r\n-\t\t\t\t\treturn NameUtil.filterByStart(new ArrayList<>(Arrays.asList(\r\n-\t\t\t\t\t\t\"add\",\r\n-\t\t\t\t\t\t\"remove\"\r\n-\t\t\t\t\t)), args[1]);\r\n-\t\t\t\tcase \"kick\":\r\n-\t\t\t\tcase \"add\":\r\n-\t\t\t\t\treturn NameUtil.getTownNamesStartingWith(args[1]);\r\n-\t\t\t\tcase \"toggle\":\r\n-\t\t\t\t\treturn NameUtil.filterByStart(nationToggleTabCompletes, args[1]);\r\n-\t\t\t\tcase \"join\":\r\n-\t\t\t\t\treturn NameUtil.getNationNamesStartingWith(args[1]);\r\n-\r\n+\t\tif (sender instanceof Player) {\r\n+\t\t\tPlayer player = (Player) sender;\r\n+\t\t\tswitch (args.length) {\r\n+\t\t\t\tcase 1:\r\n+\t\t\t\t\t// Only suggest nation names in tab complete if the player is not typing a valid sub command. This reduces clutter and the unnecessary checking of all nation names for tab completion\r\n+\t\t\t\t\tList<String> nationNames = NameUtil.filterByStart(nationTabCompletes, args[0]);\r\n+\t\t\t\t\tif (nationNames.size() > 0) {\r\n+\t\t\t\t\t\treturn nationNames;\r\n+\t\t\t\t\t} else {\r\n+\t\t\t\t\t\treturn NameUtil.getNationNamesStartingWith(args[0]);\r\n+\t\t\t\t\t}\r\n+\t\t\t\tcase 2:\r\n+\t\t\t\t\tswitch (args[0].toLowerCase()) {\r\n+\t\t\t\t\t\tcase \"set\":\r\n+\t\t\t\t\t\t\treturn NameUtil.filterByStart(nationSetTabCompletes, args[1]);\r\n+\t\t\t\t\t\tcase \"rank\":\r", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "202c0e6584096a036b9cf6468cc4450f1812b726"}, "originalPosition": 89}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzYyMjk0MDI0", "url": "https://github.com/TownyAdvanced/Towny/pull/3710#pullrequestreview-362294024", "createdAt": "2020-02-20T22:55:37Z", "commit": {"oid": "202c0e6584096a036b9cf6468cc4450f1812b726"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yMFQyMjo1NTozN1rOFsmDBA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yMFQyMjo1NTozN1rOFsmDBA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MjMwNTAyOA==", "bodyText": "Not sure what the king bit here is for, /n set king is a command but I don't think /n king is.", "url": "https://github.com/TownyAdvanced/Towny/pull/3710#discussion_r382305028", "createdAt": "2020-02-20T22:55:37Z", "author": {"login": "LlmDl"}, "path": "src/com/palmergames/bukkit/towny/command/NationCommand.java", "diffHunk": "@@ -188,43 +204,110 @@\n \t@Override\r\n \tpublic List<String> onTabComplete(CommandSender sender, Command command, String alias, String[] args) {\r\n \r\n-\t\tif (args.length == 1) {\r\n-\t\t\tList<String> nationNames = NameUtil.getNationNames();\r\n-\t\t\tnationNames.addAll(nationTabCompletes);\r\n-\t\t\treturn NameUtil.filterByStart(nationNames, args[0]);\r\n-\t\t}\r\n-\r\n-\t\tif (args.length == 2) {\r\n-\t\t\tswitch (args[0].toLowerCase()) {\r\n-\t\t\t\tcase \"set\":\r\n-\t\t\t\t\treturn NameUtil.filterByStart(nationSetTabCompletes, args[1]);\r\n-\t\t\t\tcase \"rank\":\r\n-\t\t\t\tcase \"ally\":\r\n-\t\t\t\tcase \"enemy\":\r\n-\t\t\t\t\treturn NameUtil.filterByStart(new ArrayList<>(Arrays.asList(\r\n-\t\t\t\t\t\t\"add\",\r\n-\t\t\t\t\t\t\"remove\"\r\n-\t\t\t\t\t)), args[1]);\r\n-\t\t\t\tcase \"kick\":\r\n-\t\t\t\tcase \"add\":\r\n-\t\t\t\t\treturn NameUtil.getTownNamesStartingWith(args[1]);\r\n-\t\t\t\tcase \"toggle\":\r\n-\t\t\t\t\treturn NameUtil.filterByStart(nationToggleTabCompletes, args[1]);\r\n-\t\t\t\tcase \"join\":\r\n-\t\t\t\t\treturn NameUtil.getNationNamesStartingWith(args[1]);\r\n-\r\n+\t\tif (sender instanceof Player) {\r\n+\t\t\tPlayer player = (Player) sender;\r\n+\t\t\tswitch (args.length) {\r\n+\t\t\t\tcase 1:\r\n+\t\t\t\t\t// Only suggest nation names in tab complete if the player is not typing a valid sub command. This reduces clutter and the unnecessary checking of all nation names for tab completion\r\n+\t\t\t\t\tList<String> nationNames = NameUtil.filterByStart(nationTabCompletes, args[0]);\r\n+\t\t\t\t\tif (nationNames.size() > 0) {\r\n+\t\t\t\t\t\treturn nationNames;\r\n+\t\t\t\t\t} else {\r\n+\t\t\t\t\t\treturn NameUtil.getNationNamesStartingWith(args[0]);\r\n+\t\t\t\t\t}\r\n+\t\t\t\tcase 2:\r\n+\t\t\t\t\tswitch (args[0].toLowerCase()) {\r\n+\t\t\t\t\t\tcase \"set\":\r\n+\t\t\t\t\t\t\treturn NameUtil.filterByStart(nationSetTabCompletes, args[1]);\r\n+\t\t\t\t\t\tcase \"rank\":\r\n+\t\t\t\t\t\tcase \"enemy\":\r\n+\t\t\t\t\t\t\treturn NameUtil.filterByStart(nationEnemyTabCompletes, args[1]);\r\n+\t\t\t\t\t\tcase \"ally\":\r\n+\t\t\t\t\t\t\treturn NameUtil.filterByStart(nationAllyTabCompletes, args[1]);\r\n+\t\t\t\t\t\tcase \"toggle\":\r\n+\t\t\t\t\t\t\treturn NameUtil.filterByStart(nationToggleTabCompletes, args[1]);\r\n+\t\t\t\t\t\tcase \"king\":\r", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "202c0e6584096a036b9cf6468cc4450f1812b726"}, "originalPosition": 96}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzYyMjk0Njk4", "url": "https://github.com/TownyAdvanced/Towny/pull/3710#pullrequestreview-362294698", "createdAt": "2020-02-20T22:57:02Z", "commit": {"oid": "202c0e6584096a036b9cf6468cc4450f1812b726"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yMFQyMjo1NzowMlrOFsmE9Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yMFQyMjo1NzowMlrOFsmE9Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MjMwNTUyNQ==", "bodyText": "I believe this one you're handling the admin ability to make a nation for a capital, this command has already been removed (and will be off the commands wikipage after we put out the  next release build.)", "url": "https://github.com/TownyAdvanced/Towny/pull/3710#discussion_r382305525", "createdAt": "2020-02-20T22:57:02Z", "author": {"login": "LlmDl"}, "path": "src/com/palmergames/bukkit/towny/command/NationCommand.java", "diffHunk": "@@ -188,43 +204,110 @@\n \t@Override\r\n \tpublic List<String> onTabComplete(CommandSender sender, Command command, String alias, String[] args) {\r\n \r\n-\t\tif (args.length == 1) {\r\n-\t\t\tList<String> nationNames = NameUtil.getNationNames();\r\n-\t\t\tnationNames.addAll(nationTabCompletes);\r\n-\t\t\treturn NameUtil.filterByStart(nationNames, args[0]);\r\n-\t\t}\r\n-\r\n-\t\tif (args.length == 2) {\r\n-\t\t\tswitch (args[0].toLowerCase()) {\r\n-\t\t\t\tcase \"set\":\r\n-\t\t\t\t\treturn NameUtil.filterByStart(nationSetTabCompletes, args[1]);\r\n-\t\t\t\tcase \"rank\":\r\n-\t\t\t\tcase \"ally\":\r\n-\t\t\t\tcase \"enemy\":\r\n-\t\t\t\t\treturn NameUtil.filterByStart(new ArrayList<>(Arrays.asList(\r\n-\t\t\t\t\t\t\"add\",\r\n-\t\t\t\t\t\t\"remove\"\r\n-\t\t\t\t\t)), args[1]);\r\n-\t\t\t\tcase \"kick\":\r\n-\t\t\t\tcase \"add\":\r\n-\t\t\t\t\treturn NameUtil.getTownNamesStartingWith(args[1]);\r\n-\t\t\t\tcase \"toggle\":\r\n-\t\t\t\t\treturn NameUtil.filterByStart(nationToggleTabCompletes, args[1]);\r\n-\t\t\t\tcase \"join\":\r\n-\t\t\t\t\treturn NameUtil.getNationNamesStartingWith(args[1]);\r\n-\r\n+\t\tif (sender instanceof Player) {\r\n+\t\t\tPlayer player = (Player) sender;\r\n+\t\t\tswitch (args.length) {\r\n+\t\t\t\tcase 1:\r\n+\t\t\t\t\t// Only suggest nation names in tab complete if the player is not typing a valid sub command. This reduces clutter and the unnecessary checking of all nation names for tab completion\r\n+\t\t\t\t\tList<String> nationNames = NameUtil.filterByStart(nationTabCompletes, args[0]);\r\n+\t\t\t\t\tif (nationNames.size() > 0) {\r\n+\t\t\t\t\t\treturn nationNames;\r\n+\t\t\t\t\t} else {\r\n+\t\t\t\t\t\treturn NameUtil.getNationNamesStartingWith(args[0]);\r\n+\t\t\t\t\t}\r\n+\t\t\t\tcase 2:\r\n+\t\t\t\t\tswitch (args[0].toLowerCase()) {\r\n+\t\t\t\t\t\tcase \"set\":\r\n+\t\t\t\t\t\t\treturn NameUtil.filterByStart(nationSetTabCompletes, args[1]);\r\n+\t\t\t\t\t\tcase \"rank\":\r\n+\t\t\t\t\t\tcase \"enemy\":\r\n+\t\t\t\t\t\t\treturn NameUtil.filterByStart(nationEnemyTabCompletes, args[1]);\r\n+\t\t\t\t\t\tcase \"ally\":\r\n+\t\t\t\t\t\t\treturn NameUtil.filterByStart(nationAllyTabCompletes, args[1]);\r\n+\t\t\t\t\t\tcase \"toggle\":\r\n+\t\t\t\t\t\t\treturn NameUtil.filterByStart(nationToggleTabCompletes, args[1]);\r\n+\t\t\t\t\t\tcase \"king\":\r\n+\t\t\t\t\t\t\treturn NameUtil.filterByStart(new ArrayList<>(Collections.singletonList(\"?\")), args[1]);\r\n+\t\t\t\t\t}\r\n \t\t\t}\r\n-\t\t}\r\n \r\n-\t\tif (args.length == 3) {\r\n-\t\t\tswitch (args[1].toLowerCase()) {\r\n-\t\t\t\tcase \"remove\":\r\n-\t\t\t\tcase \"add\":\r\n-\t\t\t\t\treturn NameUtil.getNationNamesStartingWith(args[2]);\r\n+\t\t\tif (args.length > 1) {\r\n+\t\t\t\tswitch (args[0].toLowerCase()) {\r\n+\t\t\t\t\tcase \"townlist\":\r\n+\t\t\t\t\tcase \"allylist\":\r\n+\t\t\t\t\tcase \"enemylist\":\r\n+\t\t\t\t\tcase \"join\":\r\n+\t\t\t\t\tcase \"delete\":\r\n+\t\t\t\t\tcase \"spawn\":\r\n+\t\t\t\t\t\treturn NameUtil.getNationNamesStartingWith(args[1]);\r\n+\t\t\t\t\tcase \"new\":\r", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "202c0e6584096a036b9cf6468cc4450f1812b726"}, "originalPosition": 116}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzYyMjk1Nzg2", "url": "https://github.com/TownyAdvanced/Towny/pull/3710#pullrequestreview-362295786", "createdAt": "2020-02-20T22:59:08Z", "commit": {"oid": "202c0e6584096a036b9cf6468cc4450f1812b726"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yMFQyMjo1OTowOFrOFsmIag==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yMFQyMjo1OTowOFrOFsmIag==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MjMwNjQxMA==", "bodyText": "The original command was neutral, and someone thought this wasn't quite clear enough and changed it to peaceful. Both should be available.", "url": "https://github.com/TownyAdvanced/Towny/pull/3710#discussion_r382306410", "createdAt": "2020-02-20T22:59:08Z", "author": {"login": "LlmDl"}, "path": "src/com/palmergames/bukkit/towny/command/NationCommand.java", "diffHunk": "@@ -110,10 +111,25 @@\n \t\t\"tag\"\r\n \t));\r\n \t\r\n-\tpublic static final List<String> nationToggleTabCompletes = new ArrayList<>(Arrays.asList(\r\n-\t\t\"neutral\",\r\n+\tstatic final List<String> nationToggleTabCompletes = new ArrayList<>(Arrays.asList(\r\n+\t\t\"peaceful\",\r", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "202c0e6584096a036b9cf6468cc4450f1812b726"}, "originalPosition": 24}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "81ed8008c196d3f1cf50591e0eab7e41583b63c5", "author": {"user": {"login": "stzups", "name": null}}, "url": "https://github.com/TownyAdvanced/Towny/commit/81ed8008c196d3f1cf50591e0eab7e41583b63c5", "committedDate": "2020-02-20T23:34:36Z", "message": "Removed tab completion for /new, added neutral /n toggle tab completes but not the help page"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "0c3b731c971887308041560cea5bb0b82b26c9cb", "author": {"user": {"login": "stzups", "name": null}}, "url": "https://github.com/TownyAdvanced/Towny/commit/0c3b731c971887308041560cea5bb0b82b26c9cb", "committedDate": "2020-02-21T00:22:43Z", "message": "Made NationCommand tab complete more readable, made tab completions better"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "711da404e12d59708424aa824ac1c69a242aa35d", "author": {"user": {"login": "stzups", "name": null}}, "url": "https://github.com/TownyAdvanced/Towny/commit/711da404e12d59708424aa824ac1c69a242aa35d", "committedDate": "2020-02-21T00:33:20Z", "message": "/n enemy remove only returns nation's current enemies"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "7154dccced9354c7fc41910a088b86dec7d51e40", "author": {"user": {"login": "stzups", "name": null}}, "url": "https://github.com/TownyAdvanced/Towny/commit/7154dccced9354c7fc41910a088b86dec7d51e40", "committedDate": "2020-02-21T00:37:48Z", "message": "Added comments"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3227, "cost": 1, "resetAt": "2021-11-02T12:20:56Z"}}}