{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTIxMTMzMjg3", "number": 4442, "title": "Added config node  GTOWN_SETTINGS_OUTLAW_TELEPORT_WORLD - sets world \u2026", "bodyText": "\u2026where outlaws will be teleported if the other options fail.\nCheck if players have townyadmin perms before teleporting them away from a town they are admin in.\nOptionally teleport outlaws to the global_town_settings.outlaw_teleport_world spawn rather than the world the town is in.\nFix typo in config node global_town_settings.allow_outlaws_to_enter_town\nSigned-off-by: Momshroom Momshroom@gmail.com\n\nDescription:\n\nCheck if players have townyadmin perms before teleporting them away from a town they are admin in.\nOptionally teleport outlaws to the global_town_settings.outlaw_teleport_world spawn rather than the world the town is in.\nFix typo in config node global_town_settings.allow_outlaws_to_enter_town description\n\nNew Nodes/Commands/ConfigOptions:\n\nglobal_town_settings.outlaw_teleport_world\n\nRelevant Towny Issue ticket:\n\n\n\n[ x] I have tested this pull request for defects on a server.\n\n\nBy making this pull request, I represent that I have the right to waive copyright and related rights to my contribution, and agree that all copyright and related rights in my contributions are waived, and I acknowledge that the TownyAdvanced organization has the copyright to use and modify my contribution under the Towny License for perpetuity.", "createdAt": "2020-11-15T02:31:59Z", "url": "https://github.com/TownyAdvanced/Towny/pull/4442", "merged": true, "mergeCommit": {"oid": "d679e53c9beff5dd4f4aac0f7e8bf2e3dde11bc4"}, "closed": true, "closedAt": "2020-11-17T22:20:23Z", "author": {"login": "Momshroom"}, "timelineItems": {"totalCount": 8, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdcm1pLAH2gAyNTIxMTMzMjg3OjMxZWFiZjAxMThiZjdhOGYyMGYzMTE3M2FlMWVhZjUyYWZhYmE4OWE=", "endCursor": "Y3Vyc29yOnYyOpPPAAABddewAzAFqTUzMjczNzQyNw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "31eabf0118bf7a8f20f31173ae1eaf52afaba89a", "author": {"user": {"login": "Momshroom", "name": null}}, "url": "https://github.com/TownyAdvanced/Towny/commit/31eabf0118bf7a8f20f31173ae1eaf52afaba89a", "committedDate": "2020-11-15T02:22:06Z", "message": "Added config node  GTOWN_SETTINGS_OUTLAW_TELEPORT_WORLD - sets world where outlaws will be teleported if the other options fail.\nCheck if players have townyadmin perms before teleporting them away from a town they are admin in.\nOptionally teleport outlaws to the global_town_settings.outlaw_teleport_world spawn rather than the world the town is in.\n\nSigned-off-by: Momshroom <Momshroom@gmail.com>"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTMwODA3MjI1", "url": "https://github.com/TownyAdvanced/Towny/pull/4442#pullrequestreview-530807225", "createdAt": "2020-11-15T15:08:26Z", "commit": {"oid": "31eabf0118bf7a8f20f31173ae1eaf52afaba89a"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xNVQxNTowODoyNlrOHzgdWQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xNVQxNTowODo0OFrOHzgdhg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMzc3MTIyNQ==", "bodyText": "I would move the isAdmin() test up to be in front of line 788. If this is an admin we need to bail out earlier.", "url": "https://github.com/TownyAdvanced/Towny/pull/4442#discussion_r523771225", "createdAt": "2020-11-15T15:08:26Z", "author": {"login": "LlmDl"}, "path": "src/com/palmergames/bukkit/towny/listeners/TownyPlayerListener.java", "diffHunk": "@@ -790,7 +792,7 @@ public void onOutlawEnterTown(PlayerEnterTownEvent event) throws NotRegisteredEx\n \t\t\tif (TownySettings.doTownsGetWarnedOnOutlaw()) {\n \t\t\t\tTownyMessaging.sendPrefixedTownMessage(town, Translation.of(\"msg_outlaw_town_notify\", outlaw.getFormattedName()));\n \t\t\t}\n-\t\t\tif (TownySettings.canOutlawsEnterTowns()) {\n+\t\t\tif (TownySettings.canOutlawsEnterTowns() || TownyUniverse.getInstance().getPermissionSource().isTownyAdmin(event.getPlayer())) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "31eabf0118bf7a8f20f31173ae1eaf52afaba89a"}, "originalPosition": 21}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMzc3MTI3MA==", "bodyText": "Whitespacing change, please revert.", "url": "https://github.com/TownyAdvanced/Towny/pull/4442#discussion_r523771270", "createdAt": "2020-11-15T15:08:48Z", "author": {"login": "LlmDl"}, "path": "src/com/palmergames/bukkit/towny/listeners/TownyPlayerListener.java", "diffHunk": "@@ -585,6 +586,7 @@ public void onPlayerMove(PlayerMoveEvent event) {\n \t\tLocation from;\n \t\tPlayerCache cache = plugin.getCache(player);\n \t\tResident resident = null;\n+", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "31eabf0118bf7a8f20f31173ae1eaf52afaba89a"}, "originalPosition": 12}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "8551a831d3ddf08dc6d29bc97809fc7742783137", "author": {"user": {"login": "Momshroom", "name": null}}, "url": "https://github.com/TownyAdvanced/Towny/commit/8551a831d3ddf08dc6d29bc97809fc7742783137", "committedDate": "2020-11-17T02:10:27Z", "message": "Added new permission node: towny.outlaw.tpbypass as a child of towny.admin\nChanged the onOutlawEnterTown method to check for this  perm rather than just the generic townyadmin perm so that mods could be given just this perm.\n\nSigned-off-by: Momshroom <Momshroom@gmail.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "6ec9e96e6e33754e0807fa0380a67c1d4f759dce", "author": {"user": {"login": "Momshroom", "name": null}}, "url": "https://github.com/TownyAdvanced/Towny/commit/6ec9e96e6e33754e0807fa0380a67c1d4f759dce", "committedDate": "2020-11-17T02:50:24Z", "message": "Adding a generic townyadmin perm check in line 791 so admins are not announced on servers that announce outlaws in towns.\nFixed whitespace addition as requested.\n\nSigned-off-by: Momshroom <Momshroom@gmail.com>"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTMyMzA4MjU5", "url": "https://github.com/TownyAdvanced/Towny/pull/4442#pullrequestreview-532308259", "createdAt": "2020-11-17T12:23:07Z", "commit": {"oid": "6ec9e96e6e33754e0807fa0380a67c1d4f759dce"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xN1QxMjoyMzowOFrOH0yYxw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xN1QxMjoyNjo1MlrOH0yhJA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNTExMzU0Mw==", "bodyText": "Any admin node should start with the towny.admin.{foo}\nI would suggest towny.admin.outlaw.teleportbypass, which can be added to the PermissionNodes.java underneath the towny.admin.nation_zone permission node.", "url": "https://github.com/TownyAdvanced/Towny/pull/4442#discussion_r525113543", "createdAt": "2020-11-17T12:23:08Z", "author": {"login": "LlmDl"}, "path": "resources/plugin.yml", "diffHunk": "@@ -59,11 +59,16 @@ permissions:\n             towny.claimed.*: true\n             towny.admin.nation_zone: true\n             towny.admin.spawn: true\n+            towny.outlaw.tpbypass: true", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "6ec9e96e6e33754e0807fa0380a67c1d4f759dce"}, "originalPosition": 4}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNTExNTAzNQ==", "bodyText": "Replace this with TOWNY_ADMIN_OUTLAW_TELEPORT_BYPASS(\"towny.admin.outlaw.teleportbypass\"), added to line 10, below the admin nation zone node.", "url": "https://github.com/TownyAdvanced/Towny/pull/4442#discussion_r525115035", "createdAt": "2020-11-17T12:25:41Z", "author": {"login": "LlmDl"}, "path": "src/com/palmergames/bukkit/towny/permissions/PermissionNodes.java", "diffHunk": "@@ -378,6 +378,7 @@\n \tTOWNY_CHAT_SPY(\"towny.chat.spy\"),\r\n \t\r\n \tTOWNY_OUTLAW_JAILER(\"towny.outlaw.jailer\"),\r\n+\tTOWNY_OUTLAW_TPBYPASS(\"towny.outlaw.tpbypass\"),\r", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "6ec9e96e6e33754e0807fa0380a67c1d4f759dce"}, "originalPosition": 4}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNTExNTY4NA==", "bodyText": "This isTownyAdmin() test should happen earlier, before the outlaw variable is declared.\nAdd a //comment mentioning that this is to keep towns from knowing an admin might be spying on them.", "url": "https://github.com/TownyAdvanced/Towny/pull/4442#discussion_r525115684", "createdAt": "2020-11-17T12:26:52Z", "author": {"login": "LlmDl"}, "path": "src/com/palmergames/bukkit/towny/listeners/TownyPlayerListener.java", "diffHunk": "@@ -787,10 +788,11 @@ public void onOutlawEnterTown(PlayerEnterTownEvent event) throws NotRegisteredEx\n \t\tTown town = event.getEnteredtown();\n \t\t\n \t\tif (town.hasOutlaw(outlaw)) {\n-\t\t\tif (TownySettings.doTownsGetWarnedOnOutlaw()) {\n+\t\t\tif (TownySettings.doTownsGetWarnedOnOutlaw() && !TownyUniverse.getInstance().getPermissionSource().isTownyAdmin(event.getPlayer())) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "6ec9e96e6e33754e0807fa0380a67c1d4f759dce"}, "originalPosition": 13}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "20fb94bb006469b7fefef55814054c83b419abb2", "author": {"user": {"login": "Momshroom", "name": null}}, "url": "https://github.com/TownyAdvanced/Towny/commit/20fb94bb006469b7fefef55814054c83b419abb2", "committedDate": "2020-11-17T16:27:48Z", "message": "Making requested changes:\nChanged permission node name to towny.admin.teleport_bypass,\nChanged checked node to TOWNY_ADMIN_OUTLAW_TELEPORT_BYPASS\nAdded requested comment in TownyPlayerListener and changed to use new node name.\n\nSigned-off-by: Momshroom <Momshroom@gmail.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "6cf0a77b6cf4e7f1ea7975ea4c4e477ad036d01e", "author": {"user": {"login": "Momshroom", "name": null}}, "url": "https://github.com/TownyAdvanced/Towny/commit/6cf0a77b6cf4e7f1ea7975ea4c4e477ad036d01e", "committedDate": "2020-11-17T19:13:42Z", "message": "Making requested change:\nFixed comment referencing the old permission node.\nAlso, fixed permission node name in non-child node section of plugin.yml\n\nSigned-off-by: Momshroom <Momshroom@gmail.com>"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTMyNzM3NDI3", "url": "https://github.com/TownyAdvanced/Towny/pull/4442#pullrequestreview-532737427", "createdAt": "2020-11-17T19:30:39Z", "commit": {"oid": "6cf0a77b6cf4e7f1ea7975ea4c4e477ad036d01e"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4220, "cost": 1, "resetAt": "2021-11-01T16:37:27Z"}}}