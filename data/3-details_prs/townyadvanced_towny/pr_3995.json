{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDE1NzM0MTM2", "number": 3995, "title": "add a pre plot change type event", "bodyText": "Description:\nThis PR aims to add a cancellable pre event for the PlotChangeTypeEvent\n\n\n I have tested this pull request for defects on a server.\n\n\nBy making this pull request, I represent that I have the right to waive copyright and related rights to my contribution, and agree that all copyright and related rights in my contributions are waived, and I acknowledge that the TownyAdvanced organization has the copyright to use and modify my contribution under the Towny License for perpetuity.", "createdAt": "2020-05-10T15:07:27Z", "url": "https://github.com/TownyAdvanced/Towny/pull/3995", "merged": true, "mergeCommit": {"oid": "6044e1c5be658e2cc7bb501cc506e1fca5b12c14"}, "closed": true, "closedAt": "2020-05-14T21:49:01Z", "author": {"login": "Rebstew"}, "timelineItems": {"totalCount": 7, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcf8dGAgH2gAyNDE1NzM0MTM2OmU0ODA0MWMxZjY0OThjNDZlYTE2YTMxYzc4YjlkMWFjNWIyZjVlMGM=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcgQDfQgFqTQwOTE5NDAyNQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "e48041c1f6498c46ea16a31c78b9d1ac5b2f5e0c", "author": {"user": {"login": "Rebstew", "name": "Steven Rebstew"}}, "url": "https://github.com/TownyAdvanced/Towny/commit/e48041c1f6498c46ea16a31c78b9d1ac5b2f5e0c", "committedDate": "2020-05-10T15:03:49Z", "message": "add a pre plot change type event"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDA4NzcxNjg4", "url": "https://github.com/TownyAdvanced/Towny/pull/3995#pullrequestreview-408771688", "createdAt": "2020-05-10T18:51:22Z", "commit": {"oid": "e48041c1f6498c46ea16a31c78b9d1ac5b2f5e0c"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 5, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xMFQxODo1MToyMlrOGTGmdA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xMFQxODo1MzozM1rOGTGnaw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMjY4NDI3Ng==", "bodyText": "The wilds plot type is not actually wilderness. TownBlocks that don't exist at all are wilderness. getOldType() will probably never return null as TownBlocks always have a type, even if it is the default RESIDENTIAL type.", "url": "https://github.com/TownyAdvanced/Towny/pull/3995#discussion_r422684276", "createdAt": "2020-05-10T18:51:22Z", "author": {"login": "LlmDl"}, "path": "src/com/palmergames/bukkit/towny/event/PlotPreChangeTypeEvent.java", "diffHunk": "@@ -0,0 +1,73 @@\n+package com.palmergames.bukkit.towny.event;\n+\n+import com.palmergames.bukkit.towny.object.TownBlock;\n+import com.palmergames.bukkit.towny.object.TownBlockType;\n+import org.bukkit.Bukkit;\n+import org.bukkit.event.Cancellable;\n+import org.bukkit.event.Event;\n+import org.bukkit.event.HandlerList;\n+\n+public class PlotPreChangeTypeEvent extends Event implements Cancellable {\n+    public static final HandlerList handlers = new HandlerList();\n+    private TownBlockType oldType;\n+    private TownBlockType newType;\n+    private TownBlock townBlock;\n+\tprivate String cancelMessage = \"Sorry this event was cancelled\";\n+\tprivate boolean isCancelled = false;\n+\n+    @Override\n+    public HandlerList getHandlers() {\n+        return handlers;\n+    }\n+\n+    public static HandlerList getHandlerList() {\n+        return handlers;\n+    }\n+\n+    /**\n+\t * Changes a plot's TownBlockType\n+\t * \n+     * @param oldType- Old Type\n+     * @param newType - New Type\n+\t * @param townBlock - Plot to target\n+     */\n+    public PlotPreChangeTypeEvent(TownBlockType oldType, TownBlockType newType, TownBlock townBlock) {\n+    \tsuper(!Bukkit.getServer().isPrimaryThread());\n+        this.newType = newType;\n+        this.oldType = oldType;\n+        this.townBlock = townBlock;\n+    }\n+\n+    public TownBlockType getNewType() {\n+        return newType;\n+    }\n+\n+    public TownBlockType getOldType() {\n+        if (oldType == null) {\n+            return TownBlockType.WILDS; // Considering the further fact we know null is wilderness if there is no old type, it has to have been wilderness.", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "e48041c1f6498c46ea16a31c78b9d1ac5b2f5e0c"}, "originalPosition": 47}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMjY4NDM1Mw==", "bodyText": "This could just return townBlock.getType().", "url": "https://github.com/TownyAdvanced/Towny/pull/3995#discussion_r422684353", "createdAt": "2020-05-10T18:52:11Z", "author": {"login": "LlmDl"}, "path": "src/com/palmergames/bukkit/towny/event/PlotPreChangeTypeEvent.java", "diffHunk": "@@ -0,0 +1,73 @@\n+package com.palmergames.bukkit.towny.event;\n+\n+import com.palmergames.bukkit.towny.object.TownBlock;\n+import com.palmergames.bukkit.towny.object.TownBlockType;\n+import org.bukkit.Bukkit;\n+import org.bukkit.event.Cancellable;\n+import org.bukkit.event.Event;\n+import org.bukkit.event.HandlerList;\n+\n+public class PlotPreChangeTypeEvent extends Event implements Cancellable {\n+    public static final HandlerList handlers = new HandlerList();\n+    private TownBlockType oldType;\n+    private TownBlockType newType;\n+    private TownBlock townBlock;\n+\tprivate String cancelMessage = \"Sorry this event was cancelled\";\n+\tprivate boolean isCancelled = false;\n+\n+    @Override\n+    public HandlerList getHandlers() {\n+        return handlers;\n+    }\n+\n+    public static HandlerList getHandlerList() {\n+        return handlers;\n+    }\n+\n+    /**\n+\t * Changes a plot's TownBlockType\n+\t * \n+     * @param oldType- Old Type\n+     * @param newType - New Type\n+\t * @param townBlock - Plot to target\n+     */\n+    public PlotPreChangeTypeEvent(TownBlockType oldType, TownBlockType newType, TownBlock townBlock) {\n+    \tsuper(!Bukkit.getServer().isPrimaryThread());\n+        this.newType = newType;\n+        this.oldType = oldType;\n+        this.townBlock = townBlock;\n+    }\n+\n+    public TownBlockType getNewType() {\n+        return newType;\n+    }\n+\n+    public TownBlockType getOldType() {\n+        if (oldType == null) {\n+            return TownBlockType.WILDS; // Considering the further fact we know null is wilderness if there is no old type, it has to have been wilderness.", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMjY4NDI3Ng=="}, "originalCommit": {"oid": "e48041c1f6498c46ea16a31c78b9d1ac5b2f5e0c"}, "originalPosition": 47}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMjY4NDM2NQ==", "bodyText": "You can drop the oldType from this.", "url": "https://github.com/TownyAdvanced/Towny/pull/3995#discussion_r422684365", "createdAt": "2020-05-10T18:52:26Z", "author": {"login": "LlmDl"}, "path": "src/com/palmergames/bukkit/towny/event/PlotPreChangeTypeEvent.java", "diffHunk": "@@ -0,0 +1,73 @@\n+package com.palmergames.bukkit.towny.event;\n+\n+import com.palmergames.bukkit.towny.object.TownBlock;\n+import com.palmergames.bukkit.towny.object.TownBlockType;\n+import org.bukkit.Bukkit;\n+import org.bukkit.event.Cancellable;\n+import org.bukkit.event.Event;\n+import org.bukkit.event.HandlerList;\n+\n+public class PlotPreChangeTypeEvent extends Event implements Cancellable {\n+    public static final HandlerList handlers = new HandlerList();\n+    private TownBlockType oldType;\n+    private TownBlockType newType;\n+    private TownBlock townBlock;\n+\tprivate String cancelMessage = \"Sorry this event was cancelled\";\n+\tprivate boolean isCancelled = false;\n+\n+    @Override\n+    public HandlerList getHandlers() {\n+        return handlers;\n+    }\n+\n+    public static HandlerList getHandlerList() {\n+        return handlers;\n+    }\n+\n+    /**\n+\t * Changes a plot's TownBlockType\n+\t * \n+     * @param oldType- Old Type\n+     * @param newType - New Type\n+\t * @param townBlock - Plot to target\n+     */\n+    public PlotPreChangeTypeEvent(TownBlockType oldType, TownBlockType newType, TownBlock townBlock) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "e48041c1f6498c46ea16a31c78b9d1ac5b2f5e0c"}, "originalPosition": 34}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMjY4NDQ2Mw==", "bodyText": "Doesn't need oldType, as this can be gotten via the TownBlock in the event.", "url": "https://github.com/TownyAdvanced/Towny/pull/3995#discussion_r422684463", "createdAt": "2020-05-10T18:53:00Z", "author": {"login": "LlmDl"}, "path": "src/com/palmergames/bukkit/towny/command/PlotCommand.java", "diffHunk": "@@ -701,11 +702,28 @@ public boolean parsePlotCommand(Player player, String[] split) throws TownyExcep\n \t\t\t\t\t\t} \r\n \r\n \t\t\t\t\t\tWorldCoord worldCoord = new WorldCoord(world, Coord.parseCoord(player));\r\n+\t\t\t\t\t\t\r\n+\t\t\t\t\t\ttry {\r\n+\t\t\t\t\t\t\tTownBlock blockAtCoord = worldCoord.getTownBlock();\r\n+\t\t\t\t\t\t\tTownBlockType paramType = TownBlockType.lookup(split[0]);\r\n \r\n-\t\t\t\t\t\tsetPlotType(resident, worldCoord, split[0]);\r\n+\t\t\t\t\t\t\tif (paramType == null)\r\n+\t\t\t\t\t\t\t\tthrow new TownyException(TownySettings.getLangString(\"msg_err_not_block_type\"));\r\n+\t\t\t\t\t\t\t\r\n+\t\t\t\t\t\t\tPlotPreChangeTypeEvent preEvent = new PlotPreChangeTypeEvent(blockAtCoord.getType(), paramType, blockAtCoord);\r", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "e48041c1f6498c46ea16a31c78b9d1ac5b2f5e0c"}, "originalPosition": 21}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMjY4NDUyMw==", "bodyText": "Please change variables to townBlock and townBlockType, for readability.", "url": "https://github.com/TownyAdvanced/Towny/pull/3995#discussion_r422684523", "createdAt": "2020-05-10T18:53:33Z", "author": {"login": "LlmDl"}, "path": "src/com/palmergames/bukkit/towny/command/PlotCommand.java", "diffHunk": "@@ -701,11 +702,28 @@ public boolean parsePlotCommand(Player player, String[] split) throws TownyExcep\n \t\t\t\t\t\t} \r\n \r\n \t\t\t\t\t\tWorldCoord worldCoord = new WorldCoord(world, Coord.parseCoord(player));\r\n+\t\t\t\t\t\t\r\n+\t\t\t\t\t\ttry {\r\n+\t\t\t\t\t\t\tTownBlock blockAtCoord = worldCoord.getTownBlock();\r\n+\t\t\t\t\t\t\tTownBlockType paramType = TownBlockType.lookup(split[0]);\r", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "e48041c1f6498c46ea16a31c78b9d1ac5b2f5e0c"}, "originalPosition": 15}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "65983e57677c39da6b55e9ab453df383f07ee1c7", "author": {"user": {"login": "Rebstew", "name": "Steven Rebstew"}}, "url": "https://github.com/TownyAdvanced/Towny/commit/65983e57677c39da6b55e9ab453df383f07ee1c7", "committedDate": "2020-05-11T12:11:15Z", "message": "add a plot pre change type event"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDA5MTU2OTY4", "url": "https://github.com/TownyAdvanced/Towny/pull/3995#pullrequestreview-409156968", "createdAt": "2020-05-11T13:12:10Z", "commit": {"oid": "65983e57677c39da6b55e9ab453df383f07ee1c7"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xMVQxMzoxMjoxMFrOGTblUQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xMVQxMzoxMjoxMFrOGTblUQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMzAyODA0OQ==", "bodyText": "I missed it before but it's probably a good idea to pass along the resident or player who is changing the plot type, to make the event more usable. After that's done I think this will be ready to go.", "url": "https://github.com/TownyAdvanced/Towny/pull/3995#discussion_r423028049", "createdAt": "2020-05-11T13:12:10Z", "author": {"login": "LlmDl"}, "path": "src/com/palmergames/bukkit/towny/command/PlotCommand.java", "diffHunk": "@@ -698,14 +699,28 @@ public boolean parsePlotCommand(Player player, String[] split) throws TownyExcep\n \t\t\t\t\t\t\t\t}\r\n \t\t\t\t\t\t\t\treturn true;\r\n \t\t\t\t\t\t\t}\r\n-\t\t\t\t\t\t} \r\n-\r\n-\t\t\t\t\t\tWorldCoord worldCoord = new WorldCoord(world, Coord.parseCoord(player));\r\n+\t\t\t\t\t\t}\r\n+\t\t\t\t\t\t\r\n+\t\t\t\t\t\ttry {\r\n+\t\t\t\t\t\t\tTownBlockType townBlockType = TownBlockType.lookup(split[0]);\r\n \r\n-\t\t\t\t\t\tsetPlotType(resident, worldCoord, split[0]);\r\n+\t\t\t\t\t\t\tif (townBlockType == null)\r\n+\t\t\t\t\t\t\t\tthrow new TownyException(TownySettings.getLangString(\"msg_err_not_block_type\"));\r\n+\t\t\t\t\t\t\t\r\n+\t\t\t\t\t\t\tPlotPreChangeTypeEvent preEvent = new PlotPreChangeTypeEvent(townBlockType, townBlock);\r", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "65983e57677c39da6b55e9ab453df383f07ee1c7"}, "originalPosition": 24}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f7ce85f6bed0c4bedfdf007d243d5de3b31e1eb1", "author": {"user": {"login": "Rebstew", "name": "Steven Rebstew"}}, "url": "https://github.com/TownyAdvanced/Towny/commit/f7ce85f6bed0c4bedfdf007d243d5de3b31e1eb1", "committedDate": "2020-05-11T13:40:50Z", "message": "add a plot pre change type event"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a8fee60e79148ab567d157484a4a961d0c634086", "author": {"user": {"login": "Rebstew", "name": "Steven Rebstew"}}, "url": "https://github.com/TownyAdvanced/Towny/commit/a8fee60e79148ab567d157484a4a961d0c634086", "committedDate": "2020-05-11T13:44:44Z", "message": "add a plot pre change type event"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDA5MTk0MDI1", "url": "https://github.com/TownyAdvanced/Towny/pull/3995#pullrequestreview-409194025", "createdAt": "2020-05-11T13:53:57Z", "commit": {"oid": "a8fee60e79148ab567d157484a4a961d0c634086"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3214, "cost": 1, "resetAt": "2021-11-02T12:20:56Z"}}}