{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDAyMjE2Nzgz", "number": 3900, "title": "Adds confirmation for setting plot types to outposts.", "bodyText": "Description:\n\nAdds confirmation for setting a plot type to an outpost.\n\nRelevant Towny Issue ticket:\n\nCloses #3731\n\n\n I have tested this pull request for defects on a server.\n\n\nBy making this pull request, I represent that I have the right to waive copyright and related rights to my contribution, and agree that all copyright and related rights in my contributions are waived, and I acknowledge that the TownyAdvanced organization has the copyright to use and modify my contribution under the Towny License for perpetuity.", "createdAt": "2020-04-11T16:50:31Z", "url": "https://github.com/TownyAdvanced/Towny/pull/3900", "merged": true, "mergeCommit": {"oid": "6e97bb572d12360a91947269358d7dc468358f04"}, "closed": true, "closedAt": "2020-04-14T10:58:55Z", "author": null, "timelineItems": {"totalCount": 9, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcWokhxgH2gAyNDAyMjE2NzgzOmUyZjAxYTRlMDZkZjAxM2YyNDUwMjhlYjQyOTBjNzgwODA0MjA3ZmE=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcXhXM6gFqTM5MjgxOTI4Mg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "e2f01a4e06df013f245028eb4290c780804207fa", "author": {"user": null}, "url": "https://github.com/TownyAdvanced/Towny/commit/e2f01a4e06df013f245028eb4290c780804207fa", "committedDate": "2020-04-11T16:48:31Z", "message": "Adds confirmation for setting plot types to outposts."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzkxODEzMjk4", "url": "https://github.com/TownyAdvanced/Towny/pull/3900#pullrequestreview-391813298", "createdAt": "2020-04-12T01:33:00Z", "commit": {"oid": "e2f01a4e06df013f245028eb4290c780804207fa"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0xMlQwMTozMzowMFrOGERV3A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0xMlQwMTozMzowMFrOGERV3A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNzEzMTYxMg==", "bodyText": "This lang string can be changed to the generic msg_confirm_purchase string and all the lang file changes can be reverted.", "url": "https://github.com/TownyAdvanced/Towny/pull/3900#discussion_r407131612", "createdAt": "2020-04-12T01:33:00Z", "author": {"login": "LlmDl"}, "path": "src/com/palmergames/bukkit/towny/command/PlotCommand.java", "diffHunk": "@@ -656,12 +656,29 @@ public boolean parsePlotCommand(Player player, String[] split) throws TownyExcep\n \t\t\t\t\t\t\t\t if (OutpostUtil.OutpostTests(town, resident, townyWorld, key, isAdmin, true)) {\r\n \t\t\t\t\t\t\t\t\t if (TownySettings.isUsingEconomy() && !town.getAccount().pay(TownySettings.getOutpostCost(), String.format(\"Plot Set Outpost\"))) \r\n \t\t\t\t\t\t\t\t\t\t throw new TownyException(TownySettings.getLangString(\"msg_err_cannot_afford_to_set_outpost\"));\r\n-\r\n-\t\t\t\t\t\t\t\t\t TownyMessaging.sendMessage(player, String.format(TownySettings.getLangString(\"msg_plot_set_cost\"), TownyEconomyHandler.getFormattedBalance(TownySettings.getOutpostCost()), TownySettings.getLangString(\"outpost\")));\r\n-\t\t\t\t\t\t\t\t\t townBlock.setOutpost(true);\r\n-\t\t\t\t\t\t\t\t\t town.addOutpostSpawn(player.getLocation());\r\n-\t\t\t\t\t\t\t\t\t townyUniverse.getDataSource().saveTown(town);\r\n-\t\t\t\t\t\t\t\t\t townyUniverse.getDataSource().saveTownBlock(townBlock);\r\n+\t\t\t\t\t\t\t\t\t \r\n+\t\t\t\t\t\t\t\t\t // Create a confirmation for setting outpost.\r\n+\t\t\t\t\t\t\t\t\t Confirmation confirmation = new Confirmation(() -> {\r\n+\t\t\t\t\t\t\t\t\t\t townBlock.setOutpost(true);\r\n+\t\t\t\t\t\t\t\t\t\t \r\n+\t\t\t\t\t\t\t\t\t\t try {\r\n+\t\t\t\t\t\t\t\t\t\t\t town.addOutpostSpawn(player.getLocation());\r\n+\t\t\t\t\t\t\t\t\t\t } catch (TownyException e) {\r\n+\t\t\t\t\t\t\t\t\t\t\t TownyMessaging.sendErrorMsg(e.getMessage());\r\n+\t\t\t\t\t\t\t\t\t\t\t return;\r\n+\t\t\t\t\t\t\t\t\t\t }\r\n+\t\t\t\t\t\t\t\t\t\t \r\n+\t\t\t\t\t\t\t\t\t\t townyUniverse.getDataSource().saveTown(town);\r\n+\t\t\t\t\t\t\t\t\t\t townyUniverse.getDataSource().saveTownBlock(townBlock);\r\n+\t\t\t\t\t\t\t\t\t\t TownyMessaging.sendMessage(player, String.format(TownySettings.getLangString(\"msg_plot_set_cost\"), TownyEconomyHandler.getFormattedBalance(TownySettings.getOutpostCost()), TownySettings.getLangString(\"outpost\")));\r\n+\t\t\t\t\t\t\t\t\t });\r\n+\t\t\t\t\t\t\t\t\t // Set title.\r\n+\t\t\t\t\t\t\t\t\t String title = String.format(TownySettings.getLangString(\"msg_warn_outpost_cost\"), TownyEconomyHandler.getFormattedBalance(TownySettings.getOutpostCost()));\r", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "e2f01a4e06df013f245028eb4290c780804207fa"}, "originalPosition": 27}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "de437ed2e2e3651907c76bb5cf67a4747634c238", "author": {"user": null}, "url": "https://github.com/TownyAdvanced/Towny/commit/de437ed2e2e3651907c76bb5cf67a4747634c238", "committedDate": "2020-04-12T18:13:36Z", "message": "Revert lang changes."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f68bec392637e281244e3eada3a744a1746dbac8", "author": {"user": null}, "url": "https://github.com/TownyAdvanced/Towny/commit/f68bec392637e281244e3eada3a744a1746dbac8", "committedDate": "2020-04-12T18:15:33Z", "message": "Merge branch 'master' into feature/outpost-confirmation\n\n# Conflicts:\n#\tresources/chinese.yml"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "7afc85b1aa5283f62eed6026dc20936160cda328", "author": {"user": null}, "url": "https://github.com/TownyAdvanced/Towny/commit/7afc85b1aa5283f62eed6026dc20936160cda328", "committedDate": "2020-04-12T18:16:01Z", "message": "Fix merge issues."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "abf6d8eca2da691a56c5953fec7ab1444689482b", "author": {"user": null}, "url": "https://github.com/TownyAdvanced/Towny/commit/abf6d8eca2da691a56c5953fec7ab1444689482b", "committedDate": "2020-04-12T18:17:57Z", "message": "fix the other lang files."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "3214cb06eda1cfce0cb858c4db9e4d471cb1ba7c", "author": {"user": {"login": "LlmDl", "name": null}}, "url": "https://github.com/TownyAdvanced/Towny/commit/3214cb06eda1cfce0cb858c4db9e4d471cb1ba7c", "committedDate": "2020-04-14T10:49:55Z", "message": "Fix players being charged before they confirm/cancel the confirmation."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "9fef0e7719e5405989cbb9606f7ead8aa5369d44", "author": {"user": {"login": "LlmDl", "name": null}}, "url": "https://github.com/TownyAdvanced/Towny/commit/9fef0e7719e5405989cbb9606f7ead8aa5369d44", "committedDate": "2020-04-14T10:55:43Z", "message": "Add forgotten check to see if economy is being used."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzkyODE5Mjgy", "url": "https://github.com/TownyAdvanced/Towny/pull/3900#pullrequestreview-392819282", "createdAt": "2020-04-14T10:58:33Z", "commit": {"oid": "9fef0e7719e5405989cbb9606f7ead8aa5369d44"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4274, "cost": 1, "resetAt": "2021-11-01T16:37:27Z"}}}