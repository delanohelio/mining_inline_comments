{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDY2OTk2MDcw", "number": 4261, "reviewThreads": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xM1QxOTozMjoyN1rOEYNIkg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xN1QwMTowMjowMFrOEY3B_A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjkzODE2NDY2OnYy", "diffSide": "RIGHT", "path": "src/com/palmergames/bukkit/towny/object/Nation.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xM1QxOTozMjoyN1rOHAap8g==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xM1QxOTozMjoyN1rOHAap8g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MDE5ODc3MA==", "bodyText": "Please wrap in {} for readability", "url": "https://github.com/TownyAdvanced/Towny/pull/4261#discussion_r470198770", "createdAt": "2020-08-13T19:32:27Z", "author": {"login": "silverwolfg11"}, "path": "src/com/palmergames/bukkit/towny/object/Nation.java", "diffHunk": "@@ -193,13 +200,35 @@ public void setCapital(Town capital) {\n \t\t} catch (Exception e) {\n \t\t\t// Dummy catch to prevent errors on startup when setting nation.\n \t\t}\n-\t\t//TownyUniverse.getInstance().getDataSource().saveNation(this);\n \t}\n \n \tpublic Town getCapital() {\n \n \t\treturn capital;\n \t}\n+\t\n+\t/**\n+\t * Finds the town in the nation with the most residents and makes it the capital.\n+\t * \n+\t * @return whether it successfully set a capital.\n+\t */\n+\tprivate boolean findNewCapital() {\n+\t\t\n+\t\tint numResidents = 0;\n+\t\tTown tempCapital = null;\n+\t\tfor (Town newCapital : getTowns())", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "69b9c3a75766d0a95ff48aa2d07a76e7442306e9"}, "originalPosition": 80}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjkzODE2OTgzOnYy", "diffSide": "RIGHT", "path": "src/com/palmergames/bukkit/towny/object/Town.java", "isResolved": true, "comments": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xM1QxOTozNDowMlrOHAatMw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xM1QyMTowNjoyOFrOHAdr8Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MDE5OTYwMw==", "bodyText": "I don't really see a necessity in making a separate method just to throw an exception. Maybe just make the setMayor(...) method return a boolean indicating success and then handle the result in the loading areas.", "url": "https://github.com/TownyAdvanced/Towny/pull/4261#discussion_r470199603", "createdAt": "2020-08-13T19:34:02Z", "author": {"login": "silverwolfg11"}, "path": "src/com/palmergames/bukkit/towny/object/Town.java", "diffHunk": "@@ -129,13 +131,32 @@ public double getTaxes() {\n \t\treturn taxes == -1 ? TownySettings.getTownDefaultTax() : taxes;\n \t}\n \n-\tpublic void setMayor(Resident mayor) throws TownyException {\n+\t/**\n+\t * Sets a resident to become mayor. Used only in database loading.\n+\t * \n+\t * @param mayor - Town Resident to make into mayor.\n+\t * @throws TownyException - When given mayor is not a resident.\n+\t */\n+\tpublic void forceSetMayor(Resident mayor) throws TownyException {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "69b9c3a75766d0a95ff48aa2d07a76e7442306e9"}, "originalPosition": 20}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MDIwMTg1Ng==", "bodyText": "I find it's a lot easier to have a brute-force method that we know will work, especially for loading things.", "url": "https://github.com/TownyAdvanced/Towny/pull/4261#discussion_r470201856", "createdAt": "2020-08-13T19:38:23Z", "author": {"login": "LlmDl"}, "path": "src/com/palmergames/bukkit/towny/object/Town.java", "diffHunk": "@@ -129,13 +131,32 @@ public double getTaxes() {\n \t\treturn taxes == -1 ? TownySettings.getTownDefaultTax() : taxes;\n \t}\n \n-\tpublic void setMayor(Resident mayor) throws TownyException {\n+\t/**\n+\t * Sets a resident to become mayor. Used only in database loading.\n+\t * \n+\t * @param mayor - Town Resident to make into mayor.\n+\t * @throws TownyException - When given mayor is not a resident.\n+\t */\n+\tpublic void forceSetMayor(Resident mayor) throws TownyException {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MDE5OTYwMw=="}, "originalCommit": {"oid": "69b9c3a75766d0a95ff48aa2d07a76e7442306e9"}, "originalPosition": 20}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MDIwNDcyMw==", "bodyText": "I mean both methods do the same thing. The only difference is that one throws an exception for one specific check, while the other just black-holes it. I'm just personally against the design practice of creating one slightly-different method that's only supposed to be in like 1-2 specific places.", "url": "https://github.com/TownyAdvanced/Towny/pull/4261#discussion_r470204723", "createdAt": "2020-08-13T19:44:07Z", "author": {"login": "silverwolfg11"}, "path": "src/com/palmergames/bukkit/towny/object/Town.java", "diffHunk": "@@ -129,13 +131,32 @@ public double getTaxes() {\n \t\treturn taxes == -1 ? TownySettings.getTownDefaultTax() : taxes;\n \t}\n \n-\tpublic void setMayor(Resident mayor) throws TownyException {\n+\t/**\n+\t * Sets a resident to become mayor. Used only in database loading.\n+\t * \n+\t * @param mayor - Town Resident to make into mayor.\n+\t * @throws TownyException - When given mayor is not a resident.\n+\t */\n+\tpublic void forceSetMayor(Resident mayor) throws TownyException {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MDE5OTYwMw=="}, "originalCommit": {"oid": "69b9c3a75766d0a95ff48aa2d07a76e7442306e9"}, "originalPosition": 20}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MDI0ODQzMw==", "bodyText": "Looked over this again. The force one is for loading only, has an exception that is caught if Towny needs to rethink who should be mayor/if a mayor is possible at all.\nThe second one doesn't throw an exception on purpose, one part of the update was making it so that during runtime the setMayor() will never throw an exception, making for less headaches.", "url": "https://github.com/TownyAdvanced/Towny/pull/4261#discussion_r470248433", "createdAt": "2020-08-13T21:06:28Z", "author": {"login": "LlmDl"}, "path": "src/com/palmergames/bukkit/towny/object/Town.java", "diffHunk": "@@ -129,13 +131,32 @@ public double getTaxes() {\n \t\treturn taxes == -1 ? TownySettings.getTownDefaultTax() : taxes;\n \t}\n \n-\tpublic void setMayor(Resident mayor) throws TownyException {\n+\t/**\n+\t * Sets a resident to become mayor. Used only in database loading.\n+\t * \n+\t * @param mayor - Town Resident to make into mayor.\n+\t * @throws TownyException - When given mayor is not a resident.\n+\t */\n+\tpublic void forceSetMayor(Resident mayor) throws TownyException {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MDE5OTYwMw=="}, "originalCommit": {"oid": "69b9c3a75766d0a95ff48aa2d07a76e7442306e9"}, "originalPosition": 20}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjk0NTAyOTA4OnYy", "diffSide": "RIGHT", "path": "src/com/palmergames/bukkit/towny/object/Nation.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xN1QwMTowMjowMFrOHBW3Vg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xN1QwMToxNzowMlrOHBXA1A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MTE4NTIzOA==", "bodyText": "Doesn't this need a return statement since otherwise it will continue to findNewCapital?", "url": "https://github.com/TownyAdvanced/Towny/pull/4261#discussion_r471185238", "createdAt": "2020-08-17T01:02:00Z", "author": {"login": "silverwolfg11"}, "path": "src/com/palmergames/bukkit/towny/object/Nation.java", "diffHunk": "@@ -171,20 +168,30 @@ public boolean hasTown(Town town) {\n \t\treturn towns.contains(town);\n \t}\n \n-\tpublic void addTown(Town town) throws AlreadyRegisteredException {\n+\tpublic void addTown(Town town) {\n+\t\ttowns.add(town);\n+\t}\n \n-\t\tif (hasTown(town))\n-\t\t\tthrow new AlreadyRegisteredException();\n-\t\telse if (town.hasNation())\n-\t\t\tthrow new AlreadyRegisteredException();\n-\t\telse {\n-\t\t\ttowns.add(town);\n-\t\t\ttown.setNation(this);\n-\t\t\t\n-\t\t\tBukkitTools.getPluginManager().callEvent(new NationAddTownEvent(town, this));\n+\t/**\n+\t * Only to be called from the loading methods.\n+\t * \n+\t * @param capital - Town to make capital.\n+\t * @throws EmptyNationException Thrown when no capital can be set.\n+\t */\n+\tpublic void forceSetCapital(Town capital) throws EmptyNationException {\n+\n+\t\tif (towns.isEmpty())\n+\t\t\tthrow new EmptyNationException(this);\n+\t\t\n+\t\ttry {\n+\t\t\tif (capital.getNation().equals(this))\n+\t\t\t\tsetCapital(capital);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "69e14cbe3cfa300ced80f27a400cf2e34e0d6447"}, "originalPosition": 48}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MTE4NzY2OA==", "bodyText": "Good catch.", "url": "https://github.com/TownyAdvanced/Towny/pull/4261#discussion_r471187668", "createdAt": "2020-08-17T01:17:02Z", "author": {"login": "LlmDl"}, "path": "src/com/palmergames/bukkit/towny/object/Nation.java", "diffHunk": "@@ -171,20 +168,30 @@ public boolean hasTown(Town town) {\n \t\treturn towns.contains(town);\n \t}\n \n-\tpublic void addTown(Town town) throws AlreadyRegisteredException {\n+\tpublic void addTown(Town town) {\n+\t\ttowns.add(town);\n+\t}\n \n-\t\tif (hasTown(town))\n-\t\t\tthrow new AlreadyRegisteredException();\n-\t\telse if (town.hasNation())\n-\t\t\tthrow new AlreadyRegisteredException();\n-\t\telse {\n-\t\t\ttowns.add(town);\n-\t\t\ttown.setNation(this);\n-\t\t\t\n-\t\t\tBukkitTools.getPluginManager().callEvent(new NationAddTownEvent(town, this));\n+\t/**\n+\t * Only to be called from the loading methods.\n+\t * \n+\t * @param capital - Town to make capital.\n+\t * @throws EmptyNationException Thrown when no capital can be set.\n+\t */\n+\tpublic void forceSetCapital(Town capital) throws EmptyNationException {\n+\n+\t\tif (towns.isEmpty())\n+\t\t\tthrow new EmptyNationException(this);\n+\t\t\n+\t\ttry {\n+\t\t\tif (capital.getNation().equals(this))\n+\t\t\t\tsetCapital(capital);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MTE4NTIzOA=="}, "originalCommit": {"oid": "69e14cbe3cfa300ced80f27a400cf2e34e0d6447"}, "originalPosition": 48}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1214, "cost": 1, "resetAt": "2021-11-13T14:23:39Z"}}}