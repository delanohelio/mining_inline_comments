{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTE3NDI5MzE4", "number": 4428, "reviewThreads": {"totalCount": 9, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wOVQxMDo1NToyNFrOE2tZNw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wOVQxMTozNzo0NVrOE2uV-A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzI1ODAyMjk1OnYy", "diffSide": "RIGHT", "path": "src/com/palmergames/bukkit/towny/listeners/TownyPlayerListener.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wOVQxMDo1NToyNFrOHvpK8Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wOVQxODo0NTozMVrOHv8gew==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxOTcxOTY2NQ==", "bodyText": "you don't actually need the .replace(), instead use\nTownyMessaging.sendPrefixedTownMessage(town, Translation.of(\"msg_outlaw_town_notify\", outlaw.getName()));", "url": "https://github.com/TownyAdvanced/Towny/pull/4428#discussion_r519719665", "createdAt": "2020-11-09T10:55:24Z", "author": {"login": "LlmDl"}, "path": "src/com/palmergames/bukkit/towny/listeners/TownyPlayerListener.java", "diffHunk": "@@ -771,23 +776,80 @@ public void onPlayerChangePlotEvent(PlayerChangePlotEvent event) {\n \t\t}\t\t\n \t}\n \t\n-\t/*\n+\t/**\n \t * onOutlawEnterTown\n-\t * - Shows message to outlaws entering towns in which they are considered an outlaw.\n-\t */\n+\t * - Handles outlaws entering a town they are outlawed in.\n+\t **/\n \t@EventHandler(priority = EventPriority.NORMAL)\n \tpublic void onOutlawEnterTown(PlayerEnterTownEvent event) throws NotRegisteredException {\n-\t\t\n-\t\tPlayer player = event.getPlayer();\t\t\n-\t\tWorldCoord to = event.getTo();\n-\t\tResident resident = TownyUniverse.getInstance().getDataSource().getResident(player.getName());\n \n-\t\tif (to.getTownBlock().getTown().hasOutlaw(resident))\n-\t\t\tTownyMessaging.sendMsg(player, Translation.of(\"msg_you_are_an_outlaw_in_this_town\", to.getTownBlock().getTown()));\n+\t\tResident outlaw = TownyUniverse.getInstance().getDataSource().getResident(event.getPlayer().getName());\n+\t\tTown town = event.getEnteredtown();\n+\t\tTownBlock location = event.getTo().getTownBlock();\n+\t\t\n+\t\tString[] split = new String[0];\n+\t\tlong cooldown = TownySettings.getOutlawKickCooldown();\n+\t\t\n+\t\t// If this resident is an outlaw in this town\n+\t\tif (location.getTown().hasOutlaw(outlaw)) {\n+\t\t\tif (!TownySettings.canOutlawsEnterTowns()) {\n+\t\t\t\t// Are towns warned when there is an outlaw entering?\n+\t\t\t\tif (TownySettings.doTownsGetWarnedOnOutlaw()) {\n+\t\t\t\t\tTownyMessaging.sendPrefixedTownMessage(town, Translation.of(\"msg_outlaw_town_notify\").replace(\"%s\", outlaw.getName()));", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "9332c8953c50d02ffee7de167866da19c3481228"}, "originalPosition": 63}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMDAzNjQ3NQ==", "bodyText": "Done \ud83d\udc4d\ud83c\udffc", "url": "https://github.com/TownyAdvanced/Towny/pull/4428#discussion_r520036475", "createdAt": "2020-11-09T18:45:31Z", "author": {"login": "GNosii"}, "path": "src/com/palmergames/bukkit/towny/listeners/TownyPlayerListener.java", "diffHunk": "@@ -771,23 +776,80 @@ public void onPlayerChangePlotEvent(PlayerChangePlotEvent event) {\n \t\t}\t\t\n \t}\n \t\n-\t/*\n+\t/**\n \t * onOutlawEnterTown\n-\t * - Shows message to outlaws entering towns in which they are considered an outlaw.\n-\t */\n+\t * - Handles outlaws entering a town they are outlawed in.\n+\t **/\n \t@EventHandler(priority = EventPriority.NORMAL)\n \tpublic void onOutlawEnterTown(PlayerEnterTownEvent event) throws NotRegisteredException {\n-\t\t\n-\t\tPlayer player = event.getPlayer();\t\t\n-\t\tWorldCoord to = event.getTo();\n-\t\tResident resident = TownyUniverse.getInstance().getDataSource().getResident(player.getName());\n \n-\t\tif (to.getTownBlock().getTown().hasOutlaw(resident))\n-\t\t\tTownyMessaging.sendMsg(player, Translation.of(\"msg_you_are_an_outlaw_in_this_town\", to.getTownBlock().getTown()));\n+\t\tResident outlaw = TownyUniverse.getInstance().getDataSource().getResident(event.getPlayer().getName());\n+\t\tTown town = event.getEnteredtown();\n+\t\tTownBlock location = event.getTo().getTownBlock();\n+\t\t\n+\t\tString[] split = new String[0];\n+\t\tlong cooldown = TownySettings.getOutlawKickCooldown();\n+\t\t\n+\t\t// If this resident is an outlaw in this town\n+\t\tif (location.getTown().hasOutlaw(outlaw)) {\n+\t\t\tif (!TownySettings.canOutlawsEnterTowns()) {\n+\t\t\t\t// Are towns warned when there is an outlaw entering?\n+\t\t\t\tif (TownySettings.doTownsGetWarnedOnOutlaw()) {\n+\t\t\t\t\tTownyMessaging.sendPrefixedTownMessage(town, Translation.of(\"msg_outlaw_town_notify\").replace(\"%s\", outlaw.getName()));", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxOTcxOTY2NQ=="}, "originalCommit": {"oid": "9332c8953c50d02ffee7de167866da19c3481228"}, "originalPosition": 63}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzI1ODAzMTk1OnYy", "diffSide": "RIGHT", "path": "src/com/palmergames/bukkit/towny/listeners/TownyPlayerListener.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wOVQxMDo1Nzo1M1rOHvpQgA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wOVQxODoxNTozN1rOHv7dPw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxOTcyMTA4OA==", "bodyText": "Same as above, changing the language string to only use %s and not %c, as well as making sure they're in the right order. Instead of cooldown use TownySettings.getOutlawKickCooldown().", "url": "https://github.com/TownyAdvanced/Towny/pull/4428#discussion_r519721088", "createdAt": "2020-11-09T10:57:53Z", "author": {"login": "LlmDl"}, "path": "src/com/palmergames/bukkit/towny/listeners/TownyPlayerListener.java", "diffHunk": "@@ -771,23 +776,80 @@ public void onPlayerChangePlotEvent(PlayerChangePlotEvent event) {\n \t\t}\t\t\n \t}\n \t\n-\t/*\n+\t/**\n \t * onOutlawEnterTown\n-\t * - Shows message to outlaws entering towns in which they are considered an outlaw.\n-\t */\n+\t * - Handles outlaws entering a town they are outlawed in.\n+\t **/\n \t@EventHandler(priority = EventPriority.NORMAL)\n \tpublic void onOutlawEnterTown(PlayerEnterTownEvent event) throws NotRegisteredException {\n-\t\t\n-\t\tPlayer player = event.getPlayer();\t\t\n-\t\tWorldCoord to = event.getTo();\n-\t\tResident resident = TownyUniverse.getInstance().getDataSource().getResident(player.getName());\n \n-\t\tif (to.getTownBlock().getTown().hasOutlaw(resident))\n-\t\t\tTownyMessaging.sendMsg(player, Translation.of(\"msg_you_are_an_outlaw_in_this_town\", to.getTownBlock().getTown()));\n+\t\tResident outlaw = TownyUniverse.getInstance().getDataSource().getResident(event.getPlayer().getName());\n+\t\tTown town = event.getEnteredtown();\n+\t\tTownBlock location = event.getTo().getTownBlock();\n+\t\t\n+\t\tString[] split = new String[0];\n+\t\tlong cooldown = TownySettings.getOutlawKickCooldown();\n+\t\t\n+\t\t// If this resident is an outlaw in this town\n+\t\tif (location.getTown().hasOutlaw(outlaw)) {\n+\t\t\tif (!TownySettings.canOutlawsEnterTowns()) {\n+\t\t\t\t// Are towns warned when there is an outlaw entering?\n+\t\t\t\tif (TownySettings.doTownsGetWarnedOnOutlaw()) {\n+\t\t\t\t\tTownyMessaging.sendPrefixedTownMessage(town, Translation.of(\"msg_outlaw_town_notify\").replace(\"%s\", outlaw.getName()));\n+\t\t\t\t}\n+\t\t\t\t// Cooldown messages\n+\t\t\t\tif (cooldown < 1) {\n+\t\t\t\t\tTownyMessaging.sendMsg(outlaw, Translation.of(\"msg_outlaw_kick\", town));\n+\t\t\t\t} else {\n+\t\t\t\t\tTownyMessaging.sendMsg(outlaw, Translation.of(\"msg_outlaw_kick_cooldown\").replace(\"%c\", TimeMgmt.formatCountdownTime(cooldown)).replace(\"%s\", town.getFormattedName()));", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "9332c8953c50d02ffee7de167866da19c3481228"}, "originalPosition": 69}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMDAxOTI2Mw==", "bodyText": "This was replaced by TownyMessaging.sendMsg(outlaw, Translation.of(\"msg_outlaw_kick_cooldown\", town.getFormattedName(), TimeMgmt.formatCountdownTime(TownySettings.getOutlawKickCooldown()))); on the latest commit.", "url": "https://github.com/TownyAdvanced/Towny/pull/4428#discussion_r520019263", "createdAt": "2020-11-09T18:15:37Z", "author": {"login": "GNosii"}, "path": "src/com/palmergames/bukkit/towny/listeners/TownyPlayerListener.java", "diffHunk": "@@ -771,23 +776,80 @@ public void onPlayerChangePlotEvent(PlayerChangePlotEvent event) {\n \t\t}\t\t\n \t}\n \t\n-\t/*\n+\t/**\n \t * onOutlawEnterTown\n-\t * - Shows message to outlaws entering towns in which they are considered an outlaw.\n-\t */\n+\t * - Handles outlaws entering a town they are outlawed in.\n+\t **/\n \t@EventHandler(priority = EventPriority.NORMAL)\n \tpublic void onOutlawEnterTown(PlayerEnterTownEvent event) throws NotRegisteredException {\n-\t\t\n-\t\tPlayer player = event.getPlayer();\t\t\n-\t\tWorldCoord to = event.getTo();\n-\t\tResident resident = TownyUniverse.getInstance().getDataSource().getResident(player.getName());\n \n-\t\tif (to.getTownBlock().getTown().hasOutlaw(resident))\n-\t\t\tTownyMessaging.sendMsg(player, Translation.of(\"msg_you_are_an_outlaw_in_this_town\", to.getTownBlock().getTown()));\n+\t\tResident outlaw = TownyUniverse.getInstance().getDataSource().getResident(event.getPlayer().getName());\n+\t\tTown town = event.getEnteredtown();\n+\t\tTownBlock location = event.getTo().getTownBlock();\n+\t\t\n+\t\tString[] split = new String[0];\n+\t\tlong cooldown = TownySettings.getOutlawKickCooldown();\n+\t\t\n+\t\t// If this resident is an outlaw in this town\n+\t\tif (location.getTown().hasOutlaw(outlaw)) {\n+\t\t\tif (!TownySettings.canOutlawsEnterTowns()) {\n+\t\t\t\t// Are towns warned when there is an outlaw entering?\n+\t\t\t\tif (TownySettings.doTownsGetWarnedOnOutlaw()) {\n+\t\t\t\t\tTownyMessaging.sendPrefixedTownMessage(town, Translation.of(\"msg_outlaw_town_notify\").replace(\"%s\", outlaw.getName()));\n+\t\t\t\t}\n+\t\t\t\t// Cooldown messages\n+\t\t\t\tif (cooldown < 1) {\n+\t\t\t\t\tTownyMessaging.sendMsg(outlaw, Translation.of(\"msg_outlaw_kick\", town));\n+\t\t\t\t} else {\n+\t\t\t\t\tTownyMessaging.sendMsg(outlaw, Translation.of(\"msg_outlaw_kick_cooldown\").replace(\"%c\", TimeMgmt.formatCountdownTime(cooldown)).replace(\"%s\", town.getFormattedName()));", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxOTcyMTA4OA=="}, "originalCommit": {"oid": "9332c8953c50d02ffee7de167866da19c3481228"}, "originalPosition": 69}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzI1ODEzMTg2OnYy", "diffSide": "RIGHT", "path": "src/com/palmergames/bukkit/towny/listeners/TownyPlayerListener.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wOVQxMToyNDo0N1rOHvqMbw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wOVQxODo0Mjo1N1rOHv8aiQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxOTczNjQzMQ==", "bodyText": "I believe this can be simplified to:\n\t\tif (TownyAPI.getInstance().getTown(player.getLocation()) != null && TownyAPI.getInstance().getTown(player.getLocation()) == town && town.hasOutlaw(player.getName())) {\n\t\t\tspawnLoc = town.getWorld().getSpawnLocation();\n\t\t\tif (player.getBedSpawnLocation() != null) \n\t\t\t\tspawnLoc = player.getBedSpawnLocation();\n\t\t\tif (outlaw.hasTown() && TownyAPI.getInstance().getTownSpawnLocation(player) != null)\n\t\t\t\tspawnLoc = TownyAPI.getInstance().getTownSpawnLocation(player);\n\n\t\t\tTownyMessaging.sendMsg(outlaw, Translation.of(\"msg_outlaw_kicked\", town));\n\t\t\tPaperLib.teleportAsync(player, spawnLoc, TeleportCause.PLUGIN);\n\t\t}", "url": "https://github.com/TownyAdvanced/Towny/pull/4428#discussion_r519736431", "createdAt": "2020-11-09T11:24:47Z", "author": {"login": "LlmDl"}, "path": "src/com/palmergames/bukkit/towny/listeners/TownyPlayerListener.java", "diffHunk": "@@ -771,23 +776,80 @@ public void onPlayerChangePlotEvent(PlayerChangePlotEvent event) {\n \t\t}\t\t\n \t}\n \t\n-\t/*\n+\t/**\n \t * onOutlawEnterTown\n-\t * - Shows message to outlaws entering towns in which they are considered an outlaw.\n-\t */\n+\t * - Handles outlaws entering a town they are outlawed in.\n+\t **/\n \t@EventHandler(priority = EventPriority.NORMAL)\n \tpublic void onOutlawEnterTown(PlayerEnterTownEvent event) throws NotRegisteredException {\n-\t\t\n-\t\tPlayer player = event.getPlayer();\t\t\n-\t\tWorldCoord to = event.getTo();\n-\t\tResident resident = TownyUniverse.getInstance().getDataSource().getResident(player.getName());\n \n-\t\tif (to.getTownBlock().getTown().hasOutlaw(resident))\n-\t\t\tTownyMessaging.sendMsg(player, Translation.of(\"msg_you_are_an_outlaw_in_this_town\", to.getTownBlock().getTown()));\n+\t\tResident outlaw = TownyUniverse.getInstance().getDataSource().getResident(event.getPlayer().getName());\n+\t\tTown town = event.getEnteredtown();\n+\t\tTownBlock location = event.getTo().getTownBlock();\n+\t\t\n+\t\tString[] split = new String[0];\n+\t\tlong cooldown = TownySettings.getOutlawKickCooldown();\n+\t\t\n+\t\t// If this resident is an outlaw in this town\n+\t\tif (location.getTown().hasOutlaw(outlaw)) {\n+\t\t\tif (!TownySettings.canOutlawsEnterTowns()) {\n+\t\t\t\t// Are towns warned when there is an outlaw entering?\n+\t\t\t\tif (TownySettings.doTownsGetWarnedOnOutlaw()) {\n+\t\t\t\t\tTownyMessaging.sendPrefixedTownMessage(town, Translation.of(\"msg_outlaw_town_notify\").replace(\"%s\", outlaw.getName()));\n+\t\t\t\t}\n+\t\t\t\t// Cooldown messages\n+\t\t\t\tif (cooldown < 1) {\n+\t\t\t\t\tTownyMessaging.sendMsg(outlaw, Translation.of(\"msg_outlaw_kick\", town));\n+\t\t\t\t} else {\n+\t\t\t\t\tTownyMessaging.sendMsg(outlaw, Translation.of(\"msg_outlaw_kick_cooldown\").replace(\"%c\", TimeMgmt.formatCountdownTime(cooldown)).replace(\"%s\", town.getFormattedName()));\n+\t\t\t\t}\n+\t\t\t\t\n+\t\t\t\tnew BukkitRunnable() {\n+\t\t\t\t\t@Override\n+\t\t\t\t\tpublic void run() {\n+\t\t\t\t\t\t\n+\t\t\t\t\t\tif (town.hasOutlaw(outlaw)) {\n+\t\t\t\t\t\t\t\n+\t\t\t\t\t\t\tPlayer player = outlaw.getPlayer();\n+\t\t\t\t\t\t\t\n+\t\t\t\t\t\t\t// Outlaw has/doesn't have a town.\n+\t\t\t\t\t\t\tif (!outlaw.hasTown()) {\n+\t\t\t\t\t\t\t\tif (player.getBedSpawnLocation() == null) { \n+\t\t\t\t\t\t\t\t\tplayer.teleport(town.getWorld().getSpawnLocation());\n+\t\t\t\t\t\t\t\t} else {\n+\t\t\t\t\t\t\t\t\tplayer.teleport(player.getBedLocation());\n+\t\t\t\t\t\t\t\t}\n+\t\t\t\t\t\t\t} else if (outlaw.hasTown()) {\n+\t\t\t\t\t\t\t\ttry {\n+\t\t\t\t\t\t\t\t\tif (outlaw.getTown().hasSpawn()) {\n+\t\t\t\t\t\t\t\t\t\ttry {\n+\t\t\t\t\t\t\t\t\t\t\tSpawnUtil.sendToTownySpawn(player, split, outlaw.getTown(), Translation.of(\"msg_err_cant_afford_tp\"), false, false, SpawnType.TOWN);\n+\t\t\t\t\t\t\t\t\t\t} catch(TownyException exception) {\n+\t\t\t\t\t\t\t\t\t\t\tplayer.teleport(town.getWorld().getSpawnLocation());\n+\t\t\t\t\t\t\t\t\t\t}\n+\t\t\t\t\t\t\t\t\t} else {\n+\t\t\t\t\t\t\t\t\t\ttry {\n+\t\t\t\t\t\t\t\t\t\t\tSpawnUtil.sendToTownySpawn(player, split, outlaw, Translation.of(\"msg_err_cant_afford_tp\"), false, false, SpawnType.RESIDENT);\n+\t\t\t\t\t\t\t\t\t\t} catch(TownyException exception) {\n+\t\t\t\t\t\t\t\t\t\t\tplayer.teleport(town.getWorld().getSpawnLocation());\n+\t\t\t\t\t\t\t\t\t\t}\n+\t\t\t\t\t\t\t\t\t}\n+\t\t\t\t\t\t\t\t} catch (NotRegisteredException e) {\n+\t\t\t\t\t\t\t\t\tplayer.teleport(town.getWorld().getSpawnLocation());\n+\t\t\t\t\t\t\t\t}\n+\t\t\t\t\t\t\t\tTownyMessaging.sendMsg(outlaw, Translation.of(\"msg_outlaw_kicked\", town));\n+\t\t\t\t\t\t\t}\n+\t\t\t\t\t\t}", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "9332c8953c50d02ffee7de167866da19c3481228"}, "originalPosition": 107}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMDAzNDk1Mw==", "bodyText": "Does work, implemented it in the latest commit", "url": "https://github.com/TownyAdvanced/Towny/pull/4428#discussion_r520034953", "createdAt": "2020-11-09T18:42:57Z", "author": {"login": "GNosii"}, "path": "src/com/palmergames/bukkit/towny/listeners/TownyPlayerListener.java", "diffHunk": "@@ -771,23 +776,80 @@ public void onPlayerChangePlotEvent(PlayerChangePlotEvent event) {\n \t\t}\t\t\n \t}\n \t\n-\t/*\n+\t/**\n \t * onOutlawEnterTown\n-\t * - Shows message to outlaws entering towns in which they are considered an outlaw.\n-\t */\n+\t * - Handles outlaws entering a town they are outlawed in.\n+\t **/\n \t@EventHandler(priority = EventPriority.NORMAL)\n \tpublic void onOutlawEnterTown(PlayerEnterTownEvent event) throws NotRegisteredException {\n-\t\t\n-\t\tPlayer player = event.getPlayer();\t\t\n-\t\tWorldCoord to = event.getTo();\n-\t\tResident resident = TownyUniverse.getInstance().getDataSource().getResident(player.getName());\n \n-\t\tif (to.getTownBlock().getTown().hasOutlaw(resident))\n-\t\t\tTownyMessaging.sendMsg(player, Translation.of(\"msg_you_are_an_outlaw_in_this_town\", to.getTownBlock().getTown()));\n+\t\tResident outlaw = TownyUniverse.getInstance().getDataSource().getResident(event.getPlayer().getName());\n+\t\tTown town = event.getEnteredtown();\n+\t\tTownBlock location = event.getTo().getTownBlock();\n+\t\t\n+\t\tString[] split = new String[0];\n+\t\tlong cooldown = TownySettings.getOutlawKickCooldown();\n+\t\t\n+\t\t// If this resident is an outlaw in this town\n+\t\tif (location.getTown().hasOutlaw(outlaw)) {\n+\t\t\tif (!TownySettings.canOutlawsEnterTowns()) {\n+\t\t\t\t// Are towns warned when there is an outlaw entering?\n+\t\t\t\tif (TownySettings.doTownsGetWarnedOnOutlaw()) {\n+\t\t\t\t\tTownyMessaging.sendPrefixedTownMessage(town, Translation.of(\"msg_outlaw_town_notify\").replace(\"%s\", outlaw.getName()));\n+\t\t\t\t}\n+\t\t\t\t// Cooldown messages\n+\t\t\t\tif (cooldown < 1) {\n+\t\t\t\t\tTownyMessaging.sendMsg(outlaw, Translation.of(\"msg_outlaw_kick\", town));\n+\t\t\t\t} else {\n+\t\t\t\t\tTownyMessaging.sendMsg(outlaw, Translation.of(\"msg_outlaw_kick_cooldown\").replace(\"%c\", TimeMgmt.formatCountdownTime(cooldown)).replace(\"%s\", town.getFormattedName()));\n+\t\t\t\t}\n+\t\t\t\t\n+\t\t\t\tnew BukkitRunnable() {\n+\t\t\t\t\t@Override\n+\t\t\t\t\tpublic void run() {\n+\t\t\t\t\t\t\n+\t\t\t\t\t\tif (town.hasOutlaw(outlaw)) {\n+\t\t\t\t\t\t\t\n+\t\t\t\t\t\t\tPlayer player = outlaw.getPlayer();\n+\t\t\t\t\t\t\t\n+\t\t\t\t\t\t\t// Outlaw has/doesn't have a town.\n+\t\t\t\t\t\t\tif (!outlaw.hasTown()) {\n+\t\t\t\t\t\t\t\tif (player.getBedSpawnLocation() == null) { \n+\t\t\t\t\t\t\t\t\tplayer.teleport(town.getWorld().getSpawnLocation());\n+\t\t\t\t\t\t\t\t} else {\n+\t\t\t\t\t\t\t\t\tplayer.teleport(player.getBedLocation());\n+\t\t\t\t\t\t\t\t}\n+\t\t\t\t\t\t\t} else if (outlaw.hasTown()) {\n+\t\t\t\t\t\t\t\ttry {\n+\t\t\t\t\t\t\t\t\tif (outlaw.getTown().hasSpawn()) {\n+\t\t\t\t\t\t\t\t\t\ttry {\n+\t\t\t\t\t\t\t\t\t\t\tSpawnUtil.sendToTownySpawn(player, split, outlaw.getTown(), Translation.of(\"msg_err_cant_afford_tp\"), false, false, SpawnType.TOWN);\n+\t\t\t\t\t\t\t\t\t\t} catch(TownyException exception) {\n+\t\t\t\t\t\t\t\t\t\t\tplayer.teleport(town.getWorld().getSpawnLocation());\n+\t\t\t\t\t\t\t\t\t\t}\n+\t\t\t\t\t\t\t\t\t} else {\n+\t\t\t\t\t\t\t\t\t\ttry {\n+\t\t\t\t\t\t\t\t\t\t\tSpawnUtil.sendToTownySpawn(player, split, outlaw, Translation.of(\"msg_err_cant_afford_tp\"), false, false, SpawnType.RESIDENT);\n+\t\t\t\t\t\t\t\t\t\t} catch(TownyException exception) {\n+\t\t\t\t\t\t\t\t\t\t\tplayer.teleport(town.getWorld().getSpawnLocation());\n+\t\t\t\t\t\t\t\t\t\t}\n+\t\t\t\t\t\t\t\t\t}\n+\t\t\t\t\t\t\t\t} catch (NotRegisteredException e) {\n+\t\t\t\t\t\t\t\t\tplayer.teleport(town.getWorld().getSpawnLocation());\n+\t\t\t\t\t\t\t\t}\n+\t\t\t\t\t\t\t\tTownyMessaging.sendMsg(outlaw, Translation.of(\"msg_outlaw_kicked\", town));\n+\t\t\t\t\t\t\t}\n+\t\t\t\t\t\t}", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxOTczNjQzMQ=="}, "originalCommit": {"oid": "9332c8953c50d02ffee7de167866da19c3481228"}, "originalPosition": 107}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzI1ODE1MTYxOnYy", "diffSide": "RIGHT", "path": "src/com/palmergames/bukkit/towny/listeners/TownyPlayerListener.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wOVQxMTozMDoxMVrOHvqYXQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wOVQxODoxMjowOVrOHv7VlA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxOTczOTQ4NQ==", "bodyText": "I would probably put this at the top after line 794, ie:\n\t\t/*\n\t\t * Town does consider the player an outlaw.\n\t\t */\n\t\tif (event.getTo().getTownBlock().getTown().hasOutlaw(outlaw)) {\n\t\t\t\n\t\t\t// Outlaws are allowed to roam in all towns freely.\n\t\t\tif (TownySettings.canOutlawsEnterTowns()) {\n\t\t\t\tTownyMessaging.sendMsg(outlaw, Translation.of(\"msg_you_are_an_outlaw_in_this_town\", town));\n\t\t\t\n\t\t\t// Outlaws are teleported away if they spend too long in a town who has outlawed them.\n\t\t\t} else {\n\t\t\t\t// All of the new code.\n\t\t\t}\n\t\t}", "url": "https://github.com/TownyAdvanced/Towny/pull/4428#discussion_r519739485", "createdAt": "2020-11-09T11:30:11Z", "author": {"login": "LlmDl"}, "path": "src/com/palmergames/bukkit/towny/listeners/TownyPlayerListener.java", "diffHunk": "@@ -771,23 +776,80 @@ public void onPlayerChangePlotEvent(PlayerChangePlotEvent event) {\n \t\t}\t\t\n \t}\n \t\n-\t/*\n+\t/**\n \t * onOutlawEnterTown\n-\t * - Shows message to outlaws entering towns in which they are considered an outlaw.\n-\t */\n+\t * - Handles outlaws entering a town they are outlawed in.\n+\t **/\n \t@EventHandler(priority = EventPriority.NORMAL)\n \tpublic void onOutlawEnterTown(PlayerEnterTownEvent event) throws NotRegisteredException {\n-\t\t\n-\t\tPlayer player = event.getPlayer();\t\t\n-\t\tWorldCoord to = event.getTo();\n-\t\tResident resident = TownyUniverse.getInstance().getDataSource().getResident(player.getName());\n \n-\t\tif (to.getTownBlock().getTown().hasOutlaw(resident))\n-\t\t\tTownyMessaging.sendMsg(player, Translation.of(\"msg_you_are_an_outlaw_in_this_town\", to.getTownBlock().getTown()));\n+\t\tResident outlaw = TownyUniverse.getInstance().getDataSource().getResident(event.getPlayer().getName());\n+\t\tTown town = event.getEnteredtown();\n+\t\tTownBlock location = event.getTo().getTownBlock();\n+\t\t\n+\t\tString[] split = new String[0];\n+\t\tlong cooldown = TownySettings.getOutlawKickCooldown();\n+\t\t\n+\t\t// If this resident is an outlaw in this town\n+\t\tif (location.getTown().hasOutlaw(outlaw)) {\n+\t\t\tif (!TownySettings.canOutlawsEnterTowns()) {\n+\t\t\t\t// Are towns warned when there is an outlaw entering?\n+\t\t\t\tif (TownySettings.doTownsGetWarnedOnOutlaw()) {\n+\t\t\t\t\tTownyMessaging.sendPrefixedTownMessage(town, Translation.of(\"msg_outlaw_town_notify\").replace(\"%s\", outlaw.getName()));\n+\t\t\t\t}\n+\t\t\t\t// Cooldown messages\n+\t\t\t\tif (cooldown < 1) {\n+\t\t\t\t\tTownyMessaging.sendMsg(outlaw, Translation.of(\"msg_outlaw_kick\", town));\n+\t\t\t\t} else {\n+\t\t\t\t\tTownyMessaging.sendMsg(outlaw, Translation.of(\"msg_outlaw_kick_cooldown\").replace(\"%c\", TimeMgmt.formatCountdownTime(cooldown)).replace(\"%s\", town.getFormattedName()));\n+\t\t\t\t}\n+\t\t\t\t\n+\t\t\t\tnew BukkitRunnable() {\n+\t\t\t\t\t@Override\n+\t\t\t\t\tpublic void run() {\n+\t\t\t\t\t\t\n+\t\t\t\t\t\tif (town.hasOutlaw(outlaw)) {\n+\t\t\t\t\t\t\t\n+\t\t\t\t\t\t\tPlayer player = outlaw.getPlayer();\n+\t\t\t\t\t\t\t\n+\t\t\t\t\t\t\t// Outlaw has/doesn't have a town.\n+\t\t\t\t\t\t\tif (!outlaw.hasTown()) {\n+\t\t\t\t\t\t\t\tif (player.getBedSpawnLocation() == null) { \n+\t\t\t\t\t\t\t\t\tplayer.teleport(town.getWorld().getSpawnLocation());\n+\t\t\t\t\t\t\t\t} else {\n+\t\t\t\t\t\t\t\t\tplayer.teleport(player.getBedLocation());\n+\t\t\t\t\t\t\t\t}\n+\t\t\t\t\t\t\t} else if (outlaw.hasTown()) {\n+\t\t\t\t\t\t\t\ttry {\n+\t\t\t\t\t\t\t\t\tif (outlaw.getTown().hasSpawn()) {\n+\t\t\t\t\t\t\t\t\t\ttry {\n+\t\t\t\t\t\t\t\t\t\t\tSpawnUtil.sendToTownySpawn(player, split, outlaw.getTown(), Translation.of(\"msg_err_cant_afford_tp\"), false, false, SpawnType.TOWN);\n+\t\t\t\t\t\t\t\t\t\t} catch(TownyException exception) {\n+\t\t\t\t\t\t\t\t\t\t\tplayer.teleport(town.getWorld().getSpawnLocation());\n+\t\t\t\t\t\t\t\t\t\t}\n+\t\t\t\t\t\t\t\t\t} else {\n+\t\t\t\t\t\t\t\t\t\ttry {\n+\t\t\t\t\t\t\t\t\t\t\tSpawnUtil.sendToTownySpawn(player, split, outlaw, Translation.of(\"msg_err_cant_afford_tp\"), false, false, SpawnType.RESIDENT);\n+\t\t\t\t\t\t\t\t\t\t} catch(TownyException exception) {\n+\t\t\t\t\t\t\t\t\t\t\tplayer.teleport(town.getWorld().getSpawnLocation());\n+\t\t\t\t\t\t\t\t\t\t}\n+\t\t\t\t\t\t\t\t\t}\n+\t\t\t\t\t\t\t\t} catch (NotRegisteredException e) {\n+\t\t\t\t\t\t\t\t\tplayer.teleport(town.getWorld().getSpawnLocation());\n+\t\t\t\t\t\t\t\t}\n+\t\t\t\t\t\t\t\tTownyMessaging.sendMsg(outlaw, Translation.of(\"msg_outlaw_kicked\", town));\n+\t\t\t\t\t\t\t}\n+\t\t\t\t\t\t}\n+\t\t\t\t\t}\n+\t\t\t\t}.runTaskLater(plugin, cooldown * 20);\n+\t\t\t}\n+\t\t\telse {\n+\t\t\t\tTownyMessaging.sendMsg(outlaw, Translation.of(\"msg_you_are_an_outlaw_in_this_town\", town));\n+\t\t\t}", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "9332c8953c50d02ffee7de167866da19c3481228"}, "originalPosition": 113}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMDAxNzMwMA==", "bodyText": "Added this way of handling this on the latest commit.", "url": "https://github.com/TownyAdvanced/Towny/pull/4428#discussion_r520017300", "createdAt": "2020-11-09T18:12:09Z", "author": {"login": "GNosii"}, "path": "src/com/palmergames/bukkit/towny/listeners/TownyPlayerListener.java", "diffHunk": "@@ -771,23 +776,80 @@ public void onPlayerChangePlotEvent(PlayerChangePlotEvent event) {\n \t\t}\t\t\n \t}\n \t\n-\t/*\n+\t/**\n \t * onOutlawEnterTown\n-\t * - Shows message to outlaws entering towns in which they are considered an outlaw.\n-\t */\n+\t * - Handles outlaws entering a town they are outlawed in.\n+\t **/\n \t@EventHandler(priority = EventPriority.NORMAL)\n \tpublic void onOutlawEnterTown(PlayerEnterTownEvent event) throws NotRegisteredException {\n-\t\t\n-\t\tPlayer player = event.getPlayer();\t\t\n-\t\tWorldCoord to = event.getTo();\n-\t\tResident resident = TownyUniverse.getInstance().getDataSource().getResident(player.getName());\n \n-\t\tif (to.getTownBlock().getTown().hasOutlaw(resident))\n-\t\t\tTownyMessaging.sendMsg(player, Translation.of(\"msg_you_are_an_outlaw_in_this_town\", to.getTownBlock().getTown()));\n+\t\tResident outlaw = TownyUniverse.getInstance().getDataSource().getResident(event.getPlayer().getName());\n+\t\tTown town = event.getEnteredtown();\n+\t\tTownBlock location = event.getTo().getTownBlock();\n+\t\t\n+\t\tString[] split = new String[0];\n+\t\tlong cooldown = TownySettings.getOutlawKickCooldown();\n+\t\t\n+\t\t// If this resident is an outlaw in this town\n+\t\tif (location.getTown().hasOutlaw(outlaw)) {\n+\t\t\tif (!TownySettings.canOutlawsEnterTowns()) {\n+\t\t\t\t// Are towns warned when there is an outlaw entering?\n+\t\t\t\tif (TownySettings.doTownsGetWarnedOnOutlaw()) {\n+\t\t\t\t\tTownyMessaging.sendPrefixedTownMessage(town, Translation.of(\"msg_outlaw_town_notify\").replace(\"%s\", outlaw.getName()));\n+\t\t\t\t}\n+\t\t\t\t// Cooldown messages\n+\t\t\t\tif (cooldown < 1) {\n+\t\t\t\t\tTownyMessaging.sendMsg(outlaw, Translation.of(\"msg_outlaw_kick\", town));\n+\t\t\t\t} else {\n+\t\t\t\t\tTownyMessaging.sendMsg(outlaw, Translation.of(\"msg_outlaw_kick_cooldown\").replace(\"%c\", TimeMgmt.formatCountdownTime(cooldown)).replace(\"%s\", town.getFormattedName()));\n+\t\t\t\t}\n+\t\t\t\t\n+\t\t\t\tnew BukkitRunnable() {\n+\t\t\t\t\t@Override\n+\t\t\t\t\tpublic void run() {\n+\t\t\t\t\t\t\n+\t\t\t\t\t\tif (town.hasOutlaw(outlaw)) {\n+\t\t\t\t\t\t\t\n+\t\t\t\t\t\t\tPlayer player = outlaw.getPlayer();\n+\t\t\t\t\t\t\t\n+\t\t\t\t\t\t\t// Outlaw has/doesn't have a town.\n+\t\t\t\t\t\t\tif (!outlaw.hasTown()) {\n+\t\t\t\t\t\t\t\tif (player.getBedSpawnLocation() == null) { \n+\t\t\t\t\t\t\t\t\tplayer.teleport(town.getWorld().getSpawnLocation());\n+\t\t\t\t\t\t\t\t} else {\n+\t\t\t\t\t\t\t\t\tplayer.teleport(player.getBedLocation());\n+\t\t\t\t\t\t\t\t}\n+\t\t\t\t\t\t\t} else if (outlaw.hasTown()) {\n+\t\t\t\t\t\t\t\ttry {\n+\t\t\t\t\t\t\t\t\tif (outlaw.getTown().hasSpawn()) {\n+\t\t\t\t\t\t\t\t\t\ttry {\n+\t\t\t\t\t\t\t\t\t\t\tSpawnUtil.sendToTownySpawn(player, split, outlaw.getTown(), Translation.of(\"msg_err_cant_afford_tp\"), false, false, SpawnType.TOWN);\n+\t\t\t\t\t\t\t\t\t\t} catch(TownyException exception) {\n+\t\t\t\t\t\t\t\t\t\t\tplayer.teleport(town.getWorld().getSpawnLocation());\n+\t\t\t\t\t\t\t\t\t\t}\n+\t\t\t\t\t\t\t\t\t} else {\n+\t\t\t\t\t\t\t\t\t\ttry {\n+\t\t\t\t\t\t\t\t\t\t\tSpawnUtil.sendToTownySpawn(player, split, outlaw, Translation.of(\"msg_err_cant_afford_tp\"), false, false, SpawnType.RESIDENT);\n+\t\t\t\t\t\t\t\t\t\t} catch(TownyException exception) {\n+\t\t\t\t\t\t\t\t\t\t\tplayer.teleport(town.getWorld().getSpawnLocation());\n+\t\t\t\t\t\t\t\t\t\t}\n+\t\t\t\t\t\t\t\t\t}\n+\t\t\t\t\t\t\t\t} catch (NotRegisteredException e) {\n+\t\t\t\t\t\t\t\t\tplayer.teleport(town.getWorld().getSpawnLocation());\n+\t\t\t\t\t\t\t\t}\n+\t\t\t\t\t\t\t\tTownyMessaging.sendMsg(outlaw, Translation.of(\"msg_outlaw_kicked\", town));\n+\t\t\t\t\t\t\t}\n+\t\t\t\t\t\t}\n+\t\t\t\t\t}\n+\t\t\t\t}.runTaskLater(plugin, cooldown * 20);\n+\t\t\t}\n+\t\t\telse {\n+\t\t\t\tTownyMessaging.sendMsg(outlaw, Translation.of(\"msg_you_are_an_outlaw_in_this_town\", town));\n+\t\t\t}", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxOTczOTQ4NQ=="}, "originalCommit": {"oid": "9332c8953c50d02ffee7de167866da19c3481228"}, "originalPosition": 113}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzI1ODE1MjUwOnYy", "diffSide": "RIGHT", "path": "src/com/palmergames/bukkit/towny/listeners/TownyPlayerListener.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wOVQxMTozMDoyNlrOHvqY3w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wOVQxODo0MzoxOFrOHv8bUg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxOTczOTYxNQ==", "bodyText": "Remove whitespacing changes.", "url": "https://github.com/TownyAdvanced/Towny/pull/4428#discussion_r519739615", "createdAt": "2020-11-09T11:30:26Z", "author": {"login": "LlmDl"}, "path": "src/com/palmergames/bukkit/towny/listeners/TownyPlayerListener.java", "diffHunk": "@@ -771,23 +776,80 @@ public void onPlayerChangePlotEvent(PlayerChangePlotEvent event) {\n \t\t}\t\t\n \t}\n \t\n-\t/*\n+\t/**\n \t * onOutlawEnterTown\n-\t * - Shows message to outlaws entering towns in which they are considered an outlaw.\n-\t */\n+\t * - Handles outlaws entering a town they are outlawed in.\n+\t **/\n \t@EventHandler(priority = EventPriority.NORMAL)\n \tpublic void onOutlawEnterTown(PlayerEnterTownEvent event) throws NotRegisteredException {\n-\t\t\n-\t\tPlayer player = event.getPlayer();\t\t\n-\t\tWorldCoord to = event.getTo();\n-\t\tResident resident = TownyUniverse.getInstance().getDataSource().getResident(player.getName());\n \n-\t\tif (to.getTownBlock().getTown().hasOutlaw(resident))\n-\t\t\tTownyMessaging.sendMsg(player, Translation.of(\"msg_you_are_an_outlaw_in_this_town\", to.getTownBlock().getTown()));\n+\t\tResident outlaw = TownyUniverse.getInstance().getDataSource().getResident(event.getPlayer().getName());\n+\t\tTown town = event.getEnteredtown();\n+\t\tTownBlock location = event.getTo().getTownBlock();\n+\t\t\n+\t\tString[] split = new String[0];\n+\t\tlong cooldown = TownySettings.getOutlawKickCooldown();\n+\t\t\n+\t\t// If this resident is an outlaw in this town\n+\t\tif (location.getTown().hasOutlaw(outlaw)) {\n+\t\t\tif (!TownySettings.canOutlawsEnterTowns()) {\n+\t\t\t\t// Are towns warned when there is an outlaw entering?\n+\t\t\t\tif (TownySettings.doTownsGetWarnedOnOutlaw()) {\n+\t\t\t\t\tTownyMessaging.sendPrefixedTownMessage(town, Translation.of(\"msg_outlaw_town_notify\").replace(\"%s\", outlaw.getName()));\n+\t\t\t\t}\n+\t\t\t\t// Cooldown messages\n+\t\t\t\tif (cooldown < 1) {\n+\t\t\t\t\tTownyMessaging.sendMsg(outlaw, Translation.of(\"msg_outlaw_kick\", town));\n+\t\t\t\t} else {\n+\t\t\t\t\tTownyMessaging.sendMsg(outlaw, Translation.of(\"msg_outlaw_kick_cooldown\").replace(\"%c\", TimeMgmt.formatCountdownTime(cooldown)).replace(\"%s\", town.getFormattedName()));\n+\t\t\t\t}\n+\t\t\t\t\n+\t\t\t\tnew BukkitRunnable() {\n+\t\t\t\t\t@Override\n+\t\t\t\t\tpublic void run() {\n+\t\t\t\t\t\t\n+\t\t\t\t\t\tif (town.hasOutlaw(outlaw)) {\n+\t\t\t\t\t\t\t\n+\t\t\t\t\t\t\tPlayer player = outlaw.getPlayer();\n+\t\t\t\t\t\t\t\n+\t\t\t\t\t\t\t// Outlaw has/doesn't have a town.\n+\t\t\t\t\t\t\tif (!outlaw.hasTown()) {\n+\t\t\t\t\t\t\t\tif (player.getBedSpawnLocation() == null) { \n+\t\t\t\t\t\t\t\t\tplayer.teleport(town.getWorld().getSpawnLocation());\n+\t\t\t\t\t\t\t\t} else {\n+\t\t\t\t\t\t\t\t\tplayer.teleport(player.getBedLocation());\n+\t\t\t\t\t\t\t\t}\n+\t\t\t\t\t\t\t} else if (outlaw.hasTown()) {\n+\t\t\t\t\t\t\t\ttry {\n+\t\t\t\t\t\t\t\t\tif (outlaw.getTown().hasSpawn()) {\n+\t\t\t\t\t\t\t\t\t\ttry {\n+\t\t\t\t\t\t\t\t\t\t\tSpawnUtil.sendToTownySpawn(player, split, outlaw.getTown(), Translation.of(\"msg_err_cant_afford_tp\"), false, false, SpawnType.TOWN);\n+\t\t\t\t\t\t\t\t\t\t} catch(TownyException exception) {\n+\t\t\t\t\t\t\t\t\t\t\tplayer.teleport(town.getWorld().getSpawnLocation());\n+\t\t\t\t\t\t\t\t\t\t}\n+\t\t\t\t\t\t\t\t\t} else {\n+\t\t\t\t\t\t\t\t\t\ttry {\n+\t\t\t\t\t\t\t\t\t\t\tSpawnUtil.sendToTownySpawn(player, split, outlaw, Translation.of(\"msg_err_cant_afford_tp\"), false, false, SpawnType.RESIDENT);\n+\t\t\t\t\t\t\t\t\t\t} catch(TownyException exception) {\n+\t\t\t\t\t\t\t\t\t\t\tplayer.teleport(town.getWorld().getSpawnLocation());\n+\t\t\t\t\t\t\t\t\t\t}\n+\t\t\t\t\t\t\t\t\t}\n+\t\t\t\t\t\t\t\t} catch (NotRegisteredException e) {\n+\t\t\t\t\t\t\t\t\tplayer.teleport(town.getWorld().getSpawnLocation());\n+\t\t\t\t\t\t\t\t}\n+\t\t\t\t\t\t\t\tTownyMessaging.sendMsg(outlaw, Translation.of(\"msg_outlaw_kicked\", town));\n+\t\t\t\t\t\t\t}\n+\t\t\t\t\t\t}\n+\t\t\t\t\t}\n+\t\t\t\t}.runTaskLater(plugin, cooldown * 20);\n+\t\t\t}\n+\t\t\telse {\n+\t\t\t\tTownyMessaging.sendMsg(outlaw, Translation.of(\"msg_you_are_an_outlaw_in_this_town\", town));\n+\t\t\t}\n+\t\t}\n \t}\n-\n-\n-\t/**\n+\t\t\n+\t\t/**", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "9332c8953c50d02ffee7de167866da19c3481228"}, "originalPosition": 120}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMDAzNTE1NA==", "bodyText": "done.", "url": "https://github.com/TownyAdvanced/Towny/pull/4428#discussion_r520035154", "createdAt": "2020-11-09T18:43:18Z", "author": {"login": "GNosii"}, "path": "src/com/palmergames/bukkit/towny/listeners/TownyPlayerListener.java", "diffHunk": "@@ -771,23 +776,80 @@ public void onPlayerChangePlotEvent(PlayerChangePlotEvent event) {\n \t\t}\t\t\n \t}\n \t\n-\t/*\n+\t/**\n \t * onOutlawEnterTown\n-\t * - Shows message to outlaws entering towns in which they are considered an outlaw.\n-\t */\n+\t * - Handles outlaws entering a town they are outlawed in.\n+\t **/\n \t@EventHandler(priority = EventPriority.NORMAL)\n \tpublic void onOutlawEnterTown(PlayerEnterTownEvent event) throws NotRegisteredException {\n-\t\t\n-\t\tPlayer player = event.getPlayer();\t\t\n-\t\tWorldCoord to = event.getTo();\n-\t\tResident resident = TownyUniverse.getInstance().getDataSource().getResident(player.getName());\n \n-\t\tif (to.getTownBlock().getTown().hasOutlaw(resident))\n-\t\t\tTownyMessaging.sendMsg(player, Translation.of(\"msg_you_are_an_outlaw_in_this_town\", to.getTownBlock().getTown()));\n+\t\tResident outlaw = TownyUniverse.getInstance().getDataSource().getResident(event.getPlayer().getName());\n+\t\tTown town = event.getEnteredtown();\n+\t\tTownBlock location = event.getTo().getTownBlock();\n+\t\t\n+\t\tString[] split = new String[0];\n+\t\tlong cooldown = TownySettings.getOutlawKickCooldown();\n+\t\t\n+\t\t// If this resident is an outlaw in this town\n+\t\tif (location.getTown().hasOutlaw(outlaw)) {\n+\t\t\tif (!TownySettings.canOutlawsEnterTowns()) {\n+\t\t\t\t// Are towns warned when there is an outlaw entering?\n+\t\t\t\tif (TownySettings.doTownsGetWarnedOnOutlaw()) {\n+\t\t\t\t\tTownyMessaging.sendPrefixedTownMessage(town, Translation.of(\"msg_outlaw_town_notify\").replace(\"%s\", outlaw.getName()));\n+\t\t\t\t}\n+\t\t\t\t// Cooldown messages\n+\t\t\t\tif (cooldown < 1) {\n+\t\t\t\t\tTownyMessaging.sendMsg(outlaw, Translation.of(\"msg_outlaw_kick\", town));\n+\t\t\t\t} else {\n+\t\t\t\t\tTownyMessaging.sendMsg(outlaw, Translation.of(\"msg_outlaw_kick_cooldown\").replace(\"%c\", TimeMgmt.formatCountdownTime(cooldown)).replace(\"%s\", town.getFormattedName()));\n+\t\t\t\t}\n+\t\t\t\t\n+\t\t\t\tnew BukkitRunnable() {\n+\t\t\t\t\t@Override\n+\t\t\t\t\tpublic void run() {\n+\t\t\t\t\t\t\n+\t\t\t\t\t\tif (town.hasOutlaw(outlaw)) {\n+\t\t\t\t\t\t\t\n+\t\t\t\t\t\t\tPlayer player = outlaw.getPlayer();\n+\t\t\t\t\t\t\t\n+\t\t\t\t\t\t\t// Outlaw has/doesn't have a town.\n+\t\t\t\t\t\t\tif (!outlaw.hasTown()) {\n+\t\t\t\t\t\t\t\tif (player.getBedSpawnLocation() == null) { \n+\t\t\t\t\t\t\t\t\tplayer.teleport(town.getWorld().getSpawnLocation());\n+\t\t\t\t\t\t\t\t} else {\n+\t\t\t\t\t\t\t\t\tplayer.teleport(player.getBedLocation());\n+\t\t\t\t\t\t\t\t}\n+\t\t\t\t\t\t\t} else if (outlaw.hasTown()) {\n+\t\t\t\t\t\t\t\ttry {\n+\t\t\t\t\t\t\t\t\tif (outlaw.getTown().hasSpawn()) {\n+\t\t\t\t\t\t\t\t\t\ttry {\n+\t\t\t\t\t\t\t\t\t\t\tSpawnUtil.sendToTownySpawn(player, split, outlaw.getTown(), Translation.of(\"msg_err_cant_afford_tp\"), false, false, SpawnType.TOWN);\n+\t\t\t\t\t\t\t\t\t\t} catch(TownyException exception) {\n+\t\t\t\t\t\t\t\t\t\t\tplayer.teleport(town.getWorld().getSpawnLocation());\n+\t\t\t\t\t\t\t\t\t\t}\n+\t\t\t\t\t\t\t\t\t} else {\n+\t\t\t\t\t\t\t\t\t\ttry {\n+\t\t\t\t\t\t\t\t\t\t\tSpawnUtil.sendToTownySpawn(player, split, outlaw, Translation.of(\"msg_err_cant_afford_tp\"), false, false, SpawnType.RESIDENT);\n+\t\t\t\t\t\t\t\t\t\t} catch(TownyException exception) {\n+\t\t\t\t\t\t\t\t\t\t\tplayer.teleport(town.getWorld().getSpawnLocation());\n+\t\t\t\t\t\t\t\t\t\t}\n+\t\t\t\t\t\t\t\t\t}\n+\t\t\t\t\t\t\t\t} catch (NotRegisteredException e) {\n+\t\t\t\t\t\t\t\t\tplayer.teleport(town.getWorld().getSpawnLocation());\n+\t\t\t\t\t\t\t\t}\n+\t\t\t\t\t\t\t\tTownyMessaging.sendMsg(outlaw, Translation.of(\"msg_outlaw_kicked\", town));\n+\t\t\t\t\t\t\t}\n+\t\t\t\t\t\t}\n+\t\t\t\t\t}\n+\t\t\t\t}.runTaskLater(plugin, cooldown * 20);\n+\t\t\t}\n+\t\t\telse {\n+\t\t\t\tTownyMessaging.sendMsg(outlaw, Translation.of(\"msg_you_are_an_outlaw_in_this_town\", town));\n+\t\t\t}\n+\t\t}\n \t}\n-\n-\n-\t/**\n+\t\t\n+\t\t/**", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxOTczOTYxNQ=="}, "originalCommit": {"oid": "9332c8953c50d02ffee7de167866da19c3481228"}, "originalPosition": 120}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzI1ODE1MzExOnYy", "diffSide": "RIGHT", "path": "src/com/palmergames/bukkit/towny/listeners/TownyPlayerListener.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wOVQxMTozMDo0MFrOHvqZUQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wOVQxODo0MzozMVrOHv8b0Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxOTczOTcyOQ==", "bodyText": "Remove whitespacing change.", "url": "https://github.com/TownyAdvanced/Towny/pull/4428#discussion_r519739729", "createdAt": "2020-11-09T11:30:40Z", "author": {"login": "LlmDl"}, "path": "src/com/palmergames/bukkit/towny/listeners/TownyPlayerListener.java", "diffHunk": "@@ -1063,3 +1125,4 @@ public void onAdminToolUseOnEntities(PlayerInteractEntityEvent event) {\n \t\n \t\n }\n+", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "9332c8953c50d02ffee7de167866da19c3481228"}, "originalPosition": 128}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMDAzNTI4MQ==", "bodyText": "Done", "url": "https://github.com/TownyAdvanced/Towny/pull/4428#discussion_r520035281", "createdAt": "2020-11-09T18:43:31Z", "author": {"login": "GNosii"}, "path": "src/com/palmergames/bukkit/towny/listeners/TownyPlayerListener.java", "diffHunk": "@@ -1063,3 +1125,4 @@ public void onAdminToolUseOnEntities(PlayerInteractEntityEvent event) {\n \t\n \t\n }\n+", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxOTczOTcyOQ=="}, "originalCommit": {"oid": "9332c8953c50d02ffee7de167866da19c3481228"}, "originalPosition": 128}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzI1ODE2MzQzOnYy", "diffSide": "RIGHT", "path": "src/com/palmergames/bukkit/towny/listeners/TownyPlayerListener.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wOVQxMTozMzoyOVrOHvqfYw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wOVQxODoxMDoxM1rOHv7Q7g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxOTc0MTI4Mw==", "bodyText": "This doesn't need to be there, as the message is shown below when they get teleported which will be right away if the cooldown is 0.", "url": "https://github.com/TownyAdvanced/Towny/pull/4428#discussion_r519741283", "createdAt": "2020-11-09T11:33:29Z", "author": {"login": "LlmDl"}, "path": "src/com/palmergames/bukkit/towny/listeners/TownyPlayerListener.java", "diffHunk": "@@ -771,23 +776,80 @@ public void onPlayerChangePlotEvent(PlayerChangePlotEvent event) {\n \t\t}\t\t\n \t}\n \t\n-\t/*\n+\t/**\n \t * onOutlawEnterTown\n-\t * - Shows message to outlaws entering towns in which they are considered an outlaw.\n-\t */\n+\t * - Handles outlaws entering a town they are outlawed in.\n+\t **/\n \t@EventHandler(priority = EventPriority.NORMAL)\n \tpublic void onOutlawEnterTown(PlayerEnterTownEvent event) throws NotRegisteredException {\n-\t\t\n-\t\tPlayer player = event.getPlayer();\t\t\n-\t\tWorldCoord to = event.getTo();\n-\t\tResident resident = TownyUniverse.getInstance().getDataSource().getResident(player.getName());\n \n-\t\tif (to.getTownBlock().getTown().hasOutlaw(resident))\n-\t\t\tTownyMessaging.sendMsg(player, Translation.of(\"msg_you_are_an_outlaw_in_this_town\", to.getTownBlock().getTown()));\n+\t\tResident outlaw = TownyUniverse.getInstance().getDataSource().getResident(event.getPlayer().getName());\n+\t\tTown town = event.getEnteredtown();\n+\t\tTownBlock location = event.getTo().getTownBlock();\n+\t\t\n+\t\tString[] split = new String[0];\n+\t\tlong cooldown = TownySettings.getOutlawKickCooldown();\n+\t\t\n+\t\t// If this resident is an outlaw in this town\n+\t\tif (location.getTown().hasOutlaw(outlaw)) {\n+\t\t\tif (!TownySettings.canOutlawsEnterTowns()) {\n+\t\t\t\t// Are towns warned when there is an outlaw entering?\n+\t\t\t\tif (TownySettings.doTownsGetWarnedOnOutlaw()) {\n+\t\t\t\t\tTownyMessaging.sendPrefixedTownMessage(town, Translation.of(\"msg_outlaw_town_notify\").replace(\"%s\", outlaw.getName()));\n+\t\t\t\t}\n+\t\t\t\t// Cooldown messages\n+\t\t\t\tif (cooldown < 1) {\n+\t\t\t\t\tTownyMessaging.sendMsg(outlaw, Translation.of(\"msg_outlaw_kick\", town));\n+\t\t\t\t} else {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "9332c8953c50d02ffee7de167866da19c3481228"}, "originalPosition": 68}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMDAxNjExMA==", "bodyText": "Deleted this on the latest commit", "url": "https://github.com/TownyAdvanced/Towny/pull/4428#discussion_r520016110", "createdAt": "2020-11-09T18:10:13Z", "author": {"login": "GNosii"}, "path": "src/com/palmergames/bukkit/towny/listeners/TownyPlayerListener.java", "diffHunk": "@@ -771,23 +776,80 @@ public void onPlayerChangePlotEvent(PlayerChangePlotEvent event) {\n \t\t}\t\t\n \t}\n \t\n-\t/*\n+\t/**\n \t * onOutlawEnterTown\n-\t * - Shows message to outlaws entering towns in which they are considered an outlaw.\n-\t */\n+\t * - Handles outlaws entering a town they are outlawed in.\n+\t **/\n \t@EventHandler(priority = EventPriority.NORMAL)\n \tpublic void onOutlawEnterTown(PlayerEnterTownEvent event) throws NotRegisteredException {\n-\t\t\n-\t\tPlayer player = event.getPlayer();\t\t\n-\t\tWorldCoord to = event.getTo();\n-\t\tResident resident = TownyUniverse.getInstance().getDataSource().getResident(player.getName());\n \n-\t\tif (to.getTownBlock().getTown().hasOutlaw(resident))\n-\t\t\tTownyMessaging.sendMsg(player, Translation.of(\"msg_you_are_an_outlaw_in_this_town\", to.getTownBlock().getTown()));\n+\t\tResident outlaw = TownyUniverse.getInstance().getDataSource().getResident(event.getPlayer().getName());\n+\t\tTown town = event.getEnteredtown();\n+\t\tTownBlock location = event.getTo().getTownBlock();\n+\t\t\n+\t\tString[] split = new String[0];\n+\t\tlong cooldown = TownySettings.getOutlawKickCooldown();\n+\t\t\n+\t\t// If this resident is an outlaw in this town\n+\t\tif (location.getTown().hasOutlaw(outlaw)) {\n+\t\t\tif (!TownySettings.canOutlawsEnterTowns()) {\n+\t\t\t\t// Are towns warned when there is an outlaw entering?\n+\t\t\t\tif (TownySettings.doTownsGetWarnedOnOutlaw()) {\n+\t\t\t\t\tTownyMessaging.sendPrefixedTownMessage(town, Translation.of(\"msg_outlaw_town_notify\").replace(\"%s\", outlaw.getName()));\n+\t\t\t\t}\n+\t\t\t\t// Cooldown messages\n+\t\t\t\tif (cooldown < 1) {\n+\t\t\t\t\tTownyMessaging.sendMsg(outlaw, Translation.of(\"msg_outlaw_kick\", town));\n+\t\t\t\t} else {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxOTc0MTI4Mw=="}, "originalCommit": {"oid": "9332c8953c50d02ffee7de167866da19c3481228"}, "originalPosition": 68}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzI1ODE2OTE3OnYy", "diffSide": "RIGHT", "path": "src/com/palmergames/bukkit/towny/listeners/TownyPlayerListener.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wOVQxMTozNTowNlrOHvqi1w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wOVQxODowOTo0M1rOHv7PyA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxOTc0MjE2Nw==", "bodyText": "Instead of cooldown use TownySettings.getOutlawKickCooldown().", "url": "https://github.com/TownyAdvanced/Towny/pull/4428#discussion_r519742167", "createdAt": "2020-11-09T11:35:06Z", "author": {"login": "LlmDl"}, "path": "src/com/palmergames/bukkit/towny/listeners/TownyPlayerListener.java", "diffHunk": "@@ -771,23 +776,80 @@ public void onPlayerChangePlotEvent(PlayerChangePlotEvent event) {\n \t\t}\t\t\n \t}\n \t\n-\t/*\n+\t/**\n \t * onOutlawEnterTown\n-\t * - Shows message to outlaws entering towns in which they are considered an outlaw.\n-\t */\n+\t * - Handles outlaws entering a town they are outlawed in.\n+\t **/\n \t@EventHandler(priority = EventPriority.NORMAL)\n \tpublic void onOutlawEnterTown(PlayerEnterTownEvent event) throws NotRegisteredException {\n-\t\t\n-\t\tPlayer player = event.getPlayer();\t\t\n-\t\tWorldCoord to = event.getTo();\n-\t\tResident resident = TownyUniverse.getInstance().getDataSource().getResident(player.getName());\n \n-\t\tif (to.getTownBlock().getTown().hasOutlaw(resident))\n-\t\t\tTownyMessaging.sendMsg(player, Translation.of(\"msg_you_are_an_outlaw_in_this_town\", to.getTownBlock().getTown()));\n+\t\tResident outlaw = TownyUniverse.getInstance().getDataSource().getResident(event.getPlayer().getName());\n+\t\tTown town = event.getEnteredtown();\n+\t\tTownBlock location = event.getTo().getTownBlock();\n+\t\t\n+\t\tString[] split = new String[0];\n+\t\tlong cooldown = TownySettings.getOutlawKickCooldown();\n+\t\t\n+\t\t// If this resident is an outlaw in this town\n+\t\tif (location.getTown().hasOutlaw(outlaw)) {\n+\t\t\tif (!TownySettings.canOutlawsEnterTowns()) {\n+\t\t\t\t// Are towns warned when there is an outlaw entering?\n+\t\t\t\tif (TownySettings.doTownsGetWarnedOnOutlaw()) {\n+\t\t\t\t\tTownyMessaging.sendPrefixedTownMessage(town, Translation.of(\"msg_outlaw_town_notify\").replace(\"%s\", outlaw.getName()));\n+\t\t\t\t}\n+\t\t\t\t// Cooldown messages\n+\t\t\t\tif (cooldown < 1) {\n+\t\t\t\t\tTownyMessaging.sendMsg(outlaw, Translation.of(\"msg_outlaw_kick\", town));\n+\t\t\t\t} else {\n+\t\t\t\t\tTownyMessaging.sendMsg(outlaw, Translation.of(\"msg_outlaw_kick_cooldown\").replace(\"%c\", TimeMgmt.formatCountdownTime(cooldown)).replace(\"%s\", town.getFormattedName()));\n+\t\t\t\t}\n+\t\t\t\t\n+\t\t\t\tnew BukkitRunnable() {\n+\t\t\t\t\t@Override\n+\t\t\t\t\tpublic void run() {\n+\t\t\t\t\t\t\n+\t\t\t\t\t\tif (town.hasOutlaw(outlaw)) {\n+\t\t\t\t\t\t\t\n+\t\t\t\t\t\t\tPlayer player = outlaw.getPlayer();\n+\t\t\t\t\t\t\t\n+\t\t\t\t\t\t\t// Outlaw has/doesn't have a town.\n+\t\t\t\t\t\t\tif (!outlaw.hasTown()) {\n+\t\t\t\t\t\t\t\tif (player.getBedSpawnLocation() == null) { \n+\t\t\t\t\t\t\t\t\tplayer.teleport(town.getWorld().getSpawnLocation());\n+\t\t\t\t\t\t\t\t} else {\n+\t\t\t\t\t\t\t\t\tplayer.teleport(player.getBedLocation());\n+\t\t\t\t\t\t\t\t}\n+\t\t\t\t\t\t\t} else if (outlaw.hasTown()) {\n+\t\t\t\t\t\t\t\ttry {\n+\t\t\t\t\t\t\t\t\tif (outlaw.getTown().hasSpawn()) {\n+\t\t\t\t\t\t\t\t\t\ttry {\n+\t\t\t\t\t\t\t\t\t\t\tSpawnUtil.sendToTownySpawn(player, split, outlaw.getTown(), Translation.of(\"msg_err_cant_afford_tp\"), false, false, SpawnType.TOWN);\n+\t\t\t\t\t\t\t\t\t\t} catch(TownyException exception) {\n+\t\t\t\t\t\t\t\t\t\t\tplayer.teleport(town.getWorld().getSpawnLocation());\n+\t\t\t\t\t\t\t\t\t\t}\n+\t\t\t\t\t\t\t\t\t} else {\n+\t\t\t\t\t\t\t\t\t\ttry {\n+\t\t\t\t\t\t\t\t\t\t\tSpawnUtil.sendToTownySpawn(player, split, outlaw, Translation.of(\"msg_err_cant_afford_tp\"), false, false, SpawnType.RESIDENT);\n+\t\t\t\t\t\t\t\t\t\t} catch(TownyException exception) {\n+\t\t\t\t\t\t\t\t\t\t\tplayer.teleport(town.getWorld().getSpawnLocation());\n+\t\t\t\t\t\t\t\t\t\t}\n+\t\t\t\t\t\t\t\t\t}\n+\t\t\t\t\t\t\t\t} catch (NotRegisteredException e) {\n+\t\t\t\t\t\t\t\t\tplayer.teleport(town.getWorld().getSpawnLocation());\n+\t\t\t\t\t\t\t\t}\n+\t\t\t\t\t\t\t\tTownyMessaging.sendMsg(outlaw, Translation.of(\"msg_outlaw_kicked\", town));\n+\t\t\t\t\t\t\t}\n+\t\t\t\t\t\t}\n+\t\t\t\t\t}\n+\t\t\t\t}.runTaskLater(plugin, cooldown * 20);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "9332c8953c50d02ffee7de167866da19c3481228"}, "originalPosition": 109}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMDAxNTgxNg==", "bodyText": "Changed on latest commit", "url": "https://github.com/TownyAdvanced/Towny/pull/4428#discussion_r520015816", "createdAt": "2020-11-09T18:09:43Z", "author": {"login": "GNosii"}, "path": "src/com/palmergames/bukkit/towny/listeners/TownyPlayerListener.java", "diffHunk": "@@ -771,23 +776,80 @@ public void onPlayerChangePlotEvent(PlayerChangePlotEvent event) {\n \t\t}\t\t\n \t}\n \t\n-\t/*\n+\t/**\n \t * onOutlawEnterTown\n-\t * - Shows message to outlaws entering towns in which they are considered an outlaw.\n-\t */\n+\t * - Handles outlaws entering a town they are outlawed in.\n+\t **/\n \t@EventHandler(priority = EventPriority.NORMAL)\n \tpublic void onOutlawEnterTown(PlayerEnterTownEvent event) throws NotRegisteredException {\n-\t\t\n-\t\tPlayer player = event.getPlayer();\t\t\n-\t\tWorldCoord to = event.getTo();\n-\t\tResident resident = TownyUniverse.getInstance().getDataSource().getResident(player.getName());\n \n-\t\tif (to.getTownBlock().getTown().hasOutlaw(resident))\n-\t\t\tTownyMessaging.sendMsg(player, Translation.of(\"msg_you_are_an_outlaw_in_this_town\", to.getTownBlock().getTown()));\n+\t\tResident outlaw = TownyUniverse.getInstance().getDataSource().getResident(event.getPlayer().getName());\n+\t\tTown town = event.getEnteredtown();\n+\t\tTownBlock location = event.getTo().getTownBlock();\n+\t\t\n+\t\tString[] split = new String[0];\n+\t\tlong cooldown = TownySettings.getOutlawKickCooldown();\n+\t\t\n+\t\t// If this resident is an outlaw in this town\n+\t\tif (location.getTown().hasOutlaw(outlaw)) {\n+\t\t\tif (!TownySettings.canOutlawsEnterTowns()) {\n+\t\t\t\t// Are towns warned when there is an outlaw entering?\n+\t\t\t\tif (TownySettings.doTownsGetWarnedOnOutlaw()) {\n+\t\t\t\t\tTownyMessaging.sendPrefixedTownMessage(town, Translation.of(\"msg_outlaw_town_notify\").replace(\"%s\", outlaw.getName()));\n+\t\t\t\t}\n+\t\t\t\t// Cooldown messages\n+\t\t\t\tif (cooldown < 1) {\n+\t\t\t\t\tTownyMessaging.sendMsg(outlaw, Translation.of(\"msg_outlaw_kick\", town));\n+\t\t\t\t} else {\n+\t\t\t\t\tTownyMessaging.sendMsg(outlaw, Translation.of(\"msg_outlaw_kick_cooldown\").replace(\"%c\", TimeMgmt.formatCountdownTime(cooldown)).replace(\"%s\", town.getFormattedName()));\n+\t\t\t\t}\n+\t\t\t\t\n+\t\t\t\tnew BukkitRunnable() {\n+\t\t\t\t\t@Override\n+\t\t\t\t\tpublic void run() {\n+\t\t\t\t\t\t\n+\t\t\t\t\t\tif (town.hasOutlaw(outlaw)) {\n+\t\t\t\t\t\t\t\n+\t\t\t\t\t\t\tPlayer player = outlaw.getPlayer();\n+\t\t\t\t\t\t\t\n+\t\t\t\t\t\t\t// Outlaw has/doesn't have a town.\n+\t\t\t\t\t\t\tif (!outlaw.hasTown()) {\n+\t\t\t\t\t\t\t\tif (player.getBedSpawnLocation() == null) { \n+\t\t\t\t\t\t\t\t\tplayer.teleport(town.getWorld().getSpawnLocation());\n+\t\t\t\t\t\t\t\t} else {\n+\t\t\t\t\t\t\t\t\tplayer.teleport(player.getBedLocation());\n+\t\t\t\t\t\t\t\t}\n+\t\t\t\t\t\t\t} else if (outlaw.hasTown()) {\n+\t\t\t\t\t\t\t\ttry {\n+\t\t\t\t\t\t\t\t\tif (outlaw.getTown().hasSpawn()) {\n+\t\t\t\t\t\t\t\t\t\ttry {\n+\t\t\t\t\t\t\t\t\t\t\tSpawnUtil.sendToTownySpawn(player, split, outlaw.getTown(), Translation.of(\"msg_err_cant_afford_tp\"), false, false, SpawnType.TOWN);\n+\t\t\t\t\t\t\t\t\t\t} catch(TownyException exception) {\n+\t\t\t\t\t\t\t\t\t\t\tplayer.teleport(town.getWorld().getSpawnLocation());\n+\t\t\t\t\t\t\t\t\t\t}\n+\t\t\t\t\t\t\t\t\t} else {\n+\t\t\t\t\t\t\t\t\t\ttry {\n+\t\t\t\t\t\t\t\t\t\t\tSpawnUtil.sendToTownySpawn(player, split, outlaw, Translation.of(\"msg_err_cant_afford_tp\"), false, false, SpawnType.RESIDENT);\n+\t\t\t\t\t\t\t\t\t\t} catch(TownyException exception) {\n+\t\t\t\t\t\t\t\t\t\t\tplayer.teleport(town.getWorld().getSpawnLocation());\n+\t\t\t\t\t\t\t\t\t\t}\n+\t\t\t\t\t\t\t\t\t}\n+\t\t\t\t\t\t\t\t} catch (NotRegisteredException e) {\n+\t\t\t\t\t\t\t\t\tplayer.teleport(town.getWorld().getSpawnLocation());\n+\t\t\t\t\t\t\t\t}\n+\t\t\t\t\t\t\t\tTownyMessaging.sendMsg(outlaw, Translation.of(\"msg_outlaw_kicked\", town));\n+\t\t\t\t\t\t\t}\n+\t\t\t\t\t\t}\n+\t\t\t\t\t}\n+\t\t\t\t}.runTaskLater(plugin, cooldown * 20);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxOTc0MjE2Nw=="}, "originalCommit": {"oid": "9332c8953c50d02ffee7de167866da19c3481228"}, "originalPosition": 109}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzI1ODE3ODQ4OnYy", "diffSide": "RIGHT", "path": "src/com/palmergames/bukkit/towny/listeners/TownyPlayerListener.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wOVQxMTozNzo0NVrOHvqoaA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wOVQxODo0NjoyMlrOHv8iRA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxOTc0MzU5Mg==", "bodyText": "All three of these variables won't be needed after the above changes are made.", "url": "https://github.com/TownyAdvanced/Towny/pull/4428#discussion_r519743592", "createdAt": "2020-11-09T11:37:45Z", "author": {"login": "LlmDl"}, "path": "src/com/palmergames/bukkit/towny/listeners/TownyPlayerListener.java", "diffHunk": "@@ -771,23 +776,80 @@ public void onPlayerChangePlotEvent(PlayerChangePlotEvent event) {\n \t\t}\t\t\n \t}\n \t\n-\t/*\n+\t/**\n \t * onOutlawEnterTown\n-\t * - Shows message to outlaws entering towns in which they are considered an outlaw.\n-\t */\n+\t * - Handles outlaws entering a town they are outlawed in.\n+\t **/\n \t@EventHandler(priority = EventPriority.NORMAL)\n \tpublic void onOutlawEnterTown(PlayerEnterTownEvent event) throws NotRegisteredException {\n-\t\t\n-\t\tPlayer player = event.getPlayer();\t\t\n-\t\tWorldCoord to = event.getTo();\n-\t\tResident resident = TownyUniverse.getInstance().getDataSource().getResident(player.getName());\n \n-\t\tif (to.getTownBlock().getTown().hasOutlaw(resident))\n-\t\t\tTownyMessaging.sendMsg(player, Translation.of(\"msg_you_are_an_outlaw_in_this_town\", to.getTownBlock().getTown()));\n+\t\tResident outlaw = TownyUniverse.getInstance().getDataSource().getResident(event.getPlayer().getName());\n+\t\tTown town = event.getEnteredtown();\n+\t\tTownBlock location = event.getTo().getTownBlock();\n+\t\t\n+\t\tString[] split = new String[0];\n+\t\tlong cooldown = TownySettings.getOutlawKickCooldown();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "9332c8953c50d02ffee7de167866da19c3481228"}, "originalPosition": 56}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMDAzNjkzMg==", "bodyText": "Changes were made, variables were removed", "url": "https://github.com/TownyAdvanced/Towny/pull/4428#discussion_r520036932", "createdAt": "2020-11-09T18:46:22Z", "author": {"login": "GNosii"}, "path": "src/com/palmergames/bukkit/towny/listeners/TownyPlayerListener.java", "diffHunk": "@@ -771,23 +776,80 @@ public void onPlayerChangePlotEvent(PlayerChangePlotEvent event) {\n \t\t}\t\t\n \t}\n \t\n-\t/*\n+\t/**\n \t * onOutlawEnterTown\n-\t * - Shows message to outlaws entering towns in which they are considered an outlaw.\n-\t */\n+\t * - Handles outlaws entering a town they are outlawed in.\n+\t **/\n \t@EventHandler(priority = EventPriority.NORMAL)\n \tpublic void onOutlawEnterTown(PlayerEnterTownEvent event) throws NotRegisteredException {\n-\t\t\n-\t\tPlayer player = event.getPlayer();\t\t\n-\t\tWorldCoord to = event.getTo();\n-\t\tResident resident = TownyUniverse.getInstance().getDataSource().getResident(player.getName());\n \n-\t\tif (to.getTownBlock().getTown().hasOutlaw(resident))\n-\t\t\tTownyMessaging.sendMsg(player, Translation.of(\"msg_you_are_an_outlaw_in_this_town\", to.getTownBlock().getTown()));\n+\t\tResident outlaw = TownyUniverse.getInstance().getDataSource().getResident(event.getPlayer().getName());\n+\t\tTown town = event.getEnteredtown();\n+\t\tTownBlock location = event.getTo().getTownBlock();\n+\t\t\n+\t\tString[] split = new String[0];\n+\t\tlong cooldown = TownySettings.getOutlawKickCooldown();", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxOTc0MzU5Mg=="}, "originalCommit": {"oid": "9332c8953c50d02ffee7de167866da19c3481228"}, "originalPosition": 56}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1235, "cost": 1, "resetAt": "2021-11-13T14:23:39Z"}}}