{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTI4MTUwMjI5", "number": 4472, "title": "SiegeWar Permission fix up", "bodyText": "Description:\n\n\n\nRemoves nearly all SW changes to Towny's permissions package.\n\n\nCreates SiegeWarPermissionUtil\n\nHolds the two methods which may or may not be needed in the end.\n\n\n\nCreates SiegeWarPermissionNodes enum.\n\nAll new SW nodes (except the Town toggle peaceful node which will be\nput into Towny proper.)\n\n\n\nRemoves PermissionSource.has(Resident, Node).\n\nReplaced calls with the correct PermissionSource.testPermission(Player, String).\n\n\n\nRemoved called to PermissionSource.has(Player, String).\n\nReplaced calls with the correct PermissionSource.testPermission(Player, String).\n\n\n\nRemoved wildcard imports as they were found.\n\n\n\nNew Nodes/Commands/ConfigOptions:\n\n\nRelevant Towny Issue ticket:\n\n\n\n I have tested this pull request for defects on a server.\n\n\nBy making this pull request, I represent that I have the right to waive copyright and related rights to my contribution, and agree that all copyright and related rights in my contributions are waived, and I acknowledge that the TownyAdvanced organization has the copyright to use and modify my contribution under the Towny License for perpetuity.", "createdAt": "2020-11-26T15:36:06Z", "url": "https://github.com/TownyAdvanced/Towny/pull/4472", "merged": true, "mergeCommit": {"oid": "5ab08ce6057c4054825f7307c4a0688b7dee8deb"}, "closed": true, "closedAt": "2020-11-26T17:51:57Z", "author": {"login": "LlmDl"}, "timelineItems": {"totalCount": 6, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdgVuCNAH2gAyNTI4MTUwMjI5OmVkYThlZDQ1ZjZhZDc3NDg3N2U2ZjA1NWU1ODE1M2NkMTQ0OWIyZGM=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdgWszyAFqTUzOTQ5MDEwMA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "eda8ed45f6ad774877e6f055e58153cd1449b2dc", "author": {"user": {"login": "LlmDl", "name": null}}, "url": "https://github.com/TownyAdvanced/Towny/commit/eda8ed45f6ad774877e6f055e58153cd1449b2dc", "committedDate": "2020-11-26T16:41:06Z", "message": "Permission fix up\n\n- Removes nearly all SW changes to Towny's permissions package.\n\n- Creates SiegeWarPermissionUtil\n  - Holds the two methods which may or may not be needed in the end.\n- Creates SiegeWarPermissionNodes enum.\n  - All new SW nodes (except the Town toggle peaceful node which will be\nput into Towny proper.)\n- Removes PermissionSource.has(Resident, Node)\n  - Replaced calls with the correct PermissionSource.has(Player, String)\n- Removed called to PermissionSource.testPermission().\n  - Replaced calls with the correct PermissionSource.has(Player, String)\n- Removed wildcard imports as they were found."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "8ff4c358df50cb3e830c397645ebf322db484380", "author": {"user": {"login": "LlmDl", "name": null}}, "url": "https://github.com/TownyAdvanced/Towny/commit/8ff4c358df50cb3e830c397645ebf322db484380", "committedDate": "2020-11-26T16:41:06Z", "message": "- Missed wildcard import."}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "6cec7955c7b06dcf3df81d3cf249a2f1aac0c66c", "author": {"user": {"login": "LlmDl", "name": null}}, "url": "https://github.com/TownyAdvanced/Towny/commit/6cec7955c7b06dcf3df81d3cf249a2f1aac0c66c", "committedDate": "2020-11-26T16:11:32Z", "message": "- Switch incorrect use of has() for testPermission()"}, "afterCommit": {"oid": "8ff4c358df50cb3e830c397645ebf322db484380", "author": {"user": {"login": "LlmDl", "name": null}}, "url": "https://github.com/TownyAdvanced/Towny/commit/8ff4c358df50cb3e830c397645ebf322db484380", "committedDate": "2020-11-26T16:41:06Z", "message": "- Missed wildcard import."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTM5NDI5NTk0", "url": "https://github.com/TownyAdvanced/Towny/pull/4472#pullrequestreview-539429594", "createdAt": "2020-11-26T15:58:54Z", "commit": {"oid": "26815aaa2438a81da9d1e4a32d81bfe6582fef74"}, "state": "COMMENTED", "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0yNlQxNTo1ODo1NFrOH6g9QQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0yNlQxNzowMDo1MlrOH6i1Qw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMTExOTQyNQ==", "bodyText": "If TownPeacefulnessUtil is going to stay in Towny, shouldn't the associated permission stay under Towny as well?", "url": "https://github.com/TownyAdvanced/Towny/pull/4472#discussion_r531119425", "createdAt": "2020-11-26T15:58:54Z", "author": {"login": "docwhomc"}, "path": "src/com/palmergames/bukkit/towny/utils/TownPeacefulnessUtil.java", "diffHunk": "@@ -89,7 +97,7 @@ public static void punishPeacefulPlayersInActiveSiegeZones() {\n \t\t\t\t\tcontinue;\n \n \t\t\t\t//Dont apply if player has the immunity perm\n-\t\t\t\tif (TownyUniverse.getInstance().getPermissionSource().testPermission(player, PermissionNodes.TOWNY_SIEGE_WAR_IMMUNE_TO_WAR_NAUSEA.getNode()))\n+\t\t\t\tif (TownyUniverse.getInstance().getPermissionSource().has(player, SiegeWarPermissionNodes.TOWNY_SIEGE_WAR_IMMUNE_TO_WAR_NAUSEA.getNode()))", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "26815aaa2438a81da9d1e4a32d81bfe6582fef74"}, "originalPosition": 27}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMTEzOTY0Nw==", "bodyText": "This call to PermissionSource#has(Player, String) used to be a call to PermissionSource#testPermission(Player, String).", "url": "https://github.com/TownyAdvanced/Towny/pull/4472#discussion_r531139647", "createdAt": "2020-11-26T16:38:17Z", "author": {"login": "docwhomc"}, "path": "src/com/palmergames/bukkit/towny/command/TownyAdminCommand.java", "diffHunk": "@@ -1527,7 +1528,7 @@ public void adminSet(String[] split) throws TownyException {\n \t\t\t}\r\n \r\n \t\t} else if (split[0].equalsIgnoreCase(\"siegeimmunities\")) {\r\n-\t\t\tif (!townyUniverse.getPermissionSource().testPermission(player, PermissionNodes.TOWNY_COMMAND_TOWNYADMIN_SET_SIEGEIMMUNITIES.getNode(split[0].toLowerCase())))\r\n+\t\t\tif (!townyUniverse.getPermissionSource().has(player, SiegeWarPermissionNodes.TOWNY_COMMAND_TOWNYADMIN_SET_SIEGEIMMUNITIES.getNode(split[0].toLowerCase())))\r", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "26815aaa2438a81da9d1e4a32d81bfe6582fef74"}, "originalPosition": 13}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMTE1MDE0Nw==", "bodyText": "What are these used for?", "url": "https://github.com/TownyAdvanced/Towny/pull/4472#discussion_r531150147", "createdAt": "2020-11-26T17:00:52Z", "author": {"login": "docwhomc"}, "path": "src/com/palmergames/bukkit/towny/war/siegewar/enums/SiegeWarPermissionNodes.java", "diffHunk": "@@ -0,0 +1,56 @@\n+package com.palmergames.bukkit.towny.war.siegewar.enums;\r\n+\r\n+public enum SiegeWarPermissionNodes {\r\n+\r\n+\tTOWNY_NATION_SIEGE_POINTS(\"towny.nation.siege.points\"),\r\n+\tTOWNY_NATION_SIEGE_LEADERSHIP(\"towny.nation.siege.leadership\"),\r\n+\tTOWNY_NATION_SIEGE_ATTACK(\"towny.nation.siege.attack\"),\r\n+\tTOWNY_NATION_SIEGE_ABANDON(\"towny.nation.siege.abandon\"),\r\n+\tTOWNY_NATION_SIEGE_INVADE(\"towny.nation.siege.invade\"),\r\n+\tTOWNY_NATION_SIEGE_PLUNDER(\"towny.nation.siege.plunder\"),\r\n+\tTOWNY_TOWN_SIEGE_POINTS(\"towny.town.siege.points\"),\r\n+\tTOWNY_TOWN_SIEGE_SURRENDER(\"towny.town.siege.surrender\"),\r\n+\tTOWNY_COMMAND_TOWNYADMIN_SET_SIEGEIMMUNITIES(\"towny.command.townyadmin.set.siegeimmunities\"),\r\n+\t// Siegewar related war sickness immunities\r\n+\tTOWNY_SIEGE_WAR_IMMUNE_TO_WAR_NAUSEA(\"towny.siege.war.immune.to.war.nausea\"),\r\n+\tTOWNY_SIEGE_WAR_IMMUNE_TO_BATTLE_FATIGUE(\"towny.siege.war.immune.to.battle.fatigue\");\r\n+\t\r\n+\tprivate String value;\r\n+\r\n+\t/**\r\n+\t * Constructor\r\n+\t * \r\n+\t * @param permission - Permission.\r\n+\t */\r\n+\tSiegeWarPermissionNodes(String permission) {\r\n+\r\n+\t\tthis.value = permission;\r\n+\t}\r\n+\r\n+\t/**\r\n+\t * Retrieves the permission node\r\n+\t * \r\n+\t * @return The permission node\r\n+\t */\r\n+\tpublic String getNode() {\r\n+\r\n+\t\treturn value;\r\n+\t}\r\n+\r\n+\t/**\r\n+\t * Retrieves the permission node\r\n+\t * replacing the character *\r\n+\t * \r\n+\t * @param replace - String\r\n+\t * @return The permission node\r\n+\t */\r\n+\tpublic String getNode(String replace) {\r\n+\r\n+\t\treturn value.replace(\"*\", replace);\r\n+\t}\r\n+\r\n+\tpublic String getNode(int replace) {\r\n+\r\n+\t\treturn value.replace(\"*\", replace + \"\");\r\n+\t}\r\n+}\r", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "8ff4c358df50cb3e830c397645ebf322db484380"}, "originalPosition": 56}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTM5NDg2MDU4", "url": "https://github.com/TownyAdvanced/Towny/pull/4472#pullrequestreview-539486058", "createdAt": "2020-11-26T17:39:43Z", "commit": {"oid": "8ff4c358df50cb3e830c397645ebf322db484380"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0yNlQxNzozOTo0M1rOH6jz6A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0yNlQxNzozOTo0M1rOH6jz6A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMTE2NjE4NA==", "bodyText": "If TownPeacefulnessUtil is going to stay in Towny, shouldn't the associated permission stay under Towny as well?\n\n[See previous comment on pre-force push version of code.]", "url": "https://github.com/TownyAdvanced/Towny/pull/4472#discussion_r531166184", "createdAt": "2020-11-26T17:39:43Z", "author": {"login": "docwhomc"}, "path": "src/com/palmergames/bukkit/towny/utils/TownPeacefulnessUtil.java", "diffHunk": "@@ -89,7 +97,7 @@ public static void punishPeacefulPlayersInActiveSiegeZones() {\n \t\t\t\t\tcontinue;\n \n \t\t\t\t//Dont apply if player has the immunity perm\n-\t\t\t\tif (TownyUniverse.getInstance().getPermissionSource().testPermission(player, PermissionNodes.TOWNY_SIEGE_WAR_IMMUNE_TO_WAR_NAUSEA.getNode()))\n+\t\t\t\tif (TownyUniverse.getInstance().getPermissionSource().testPermission(player, SiegeWarPermissionNodes.TOWNY_SIEGE_WAR_IMMUNE_TO_WAR_NAUSEA.getNode()))", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "8ff4c358df50cb3e830c397645ebf322db484380"}, "originalPosition": 27}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTM5NDkwMTAw", "url": "https://github.com/TownyAdvanced/Towny/pull/4472#pullrequestreview-539490100", "createdAt": "2020-11-26T17:49:40Z", "commit": {"oid": "8ff4c358df50cb3e830c397645ebf322db484380"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4226, "cost": 1, "resetAt": "2021-11-01T16:37:27Z"}}}