{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0MzkxMjc0NDcz", "number": 3802, "reviewThreads": {"totalCount": 7, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yMFQxOTo1NDoxOFrODp_zww==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yMVQwMDoyNzoxNFrODqC79A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjQ1MzYzNjUxOnYy", "diffSide": "RIGHT", "path": "src/com/palmergames/bukkit/towny/command/InviteCommand.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yMFQxOTo1NDoxOFrOF5hYCQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yMFQxOTo1NDoxOFrOF5hYCQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NTg1OTk3Nw==", "bodyText": "Should probably be this if the casting isn't needed to work. Have you tested this?\n\t\t\t} else { // So it's not from the sender, then it's from the receiver so\n\t\t\t\toutput = Colors.Blue + invite.getSender().getName() + Colors.Gray + \" - \" + Colors.Green + name;\n\t\t\t\tif (invite.getReceiver() instanceof Resident) {\n\t\t\t\t\tobject = TownySettings.getLangString(\"town_sing\");\n\t\t\t\t}\n\t\t\t\tif (invite.getReceiver() instanceof Town || invite.getReceiver() instanceof Nation) {\n\t\t\t\t\tobject = TownySettings.getLangString(\"nation_sing\");\n\t\t\t\t}\n\t\t\t}", "url": "https://github.com/TownyAdvanced/Towny/pull/3802#discussion_r395859977", "createdAt": "2020-03-20T19:54:18Z", "author": {"login": "LlmDl"}, "path": "src/com/palmergames/bukkit/towny/command/InviteCommand.java", "diffHunk": "@@ -309,15 +309,15 @@ public static void sendInviteList(Player player, List<Invite> list, int page, bo\n \t\t\t\t}\n \t\t\t} else { // So it's not from the sender, then it's from the receiver so\n \t\t\t\tif (invite.getReceiver() instanceof Resident) {\n-\t\t\t\t\toutput = Colors.Blue + ((Town) invite.getSender()).getName() + Colors.Gray + \" - \" + Colors.Green + name;\n+\t\t\t\t\toutput = Colors.Blue + invite.getSender().getName() + Colors.Gray + \" - \" + Colors.Green + name;\n \t\t\t\t\tobject = TownySettings.getLangString(\"town_sing\");\n \t\t\t\t}\n \t\t\t\tif (invite.getReceiver() instanceof Town) {\n-\t\t\t\t\toutput = Colors.Blue + ((Nation) invite.getSender()).getName() + Colors.Gray + \" - \" + Colors.Green + name;\n+\t\t\t\t\toutput = Colors.Blue + invite.getSender().getName() + Colors.Gray + \" - \" + Colors.Green + name;\n \t\t\t\t\tobject = TownySettings.getLangString(\"nation_sing\");\n \t\t\t\t}\n \t\t\t\tif (invite.getReceiver() instanceof Nation) {\n-\t\t\t\t\toutput = Colors.Blue + ((Nation) invite.getSender()).getName() + Colors.Gray + \" - \" + Colors.Green + name;\n+\t\t\t\t\toutput = Colors.Blue + invite.getSender().getName() + Colors.Gray + \" - \" + Colors.Green + name;\n \t\t\t\t\tobject = TownySettings.getLangString(\"nation_sing\");\n \t\t\t\t}", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "6f49d1ccc3b5683d7652931083b44052ddb0942d"}, "originalPosition": 17}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjQ1MzYzOTIzOnYy", "diffSide": "RIGHT", "path": "src/com/palmergames/bukkit/towny/db/TownySQLSource.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yMFQxOTo1NToyNlrOF5hZ9w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yM1QxNzoyNzoxOVrOF6QJkA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NTg2MDQ3MQ==", "bodyText": "This \\ wasn't doing anything?", "url": "https://github.com/TownyAdvanced/Towny/pull/3802#discussion_r395860471", "createdAt": "2020-03-20T19:55:26Z", "author": {"login": "LlmDl"}, "path": "src/com/palmergames/bukkit/towny/db/TownySQLSource.java", "diffHunk": "@@ -435,7 +435,7 @@ public boolean QueueDeleteDB(String tb_name, HashMap<String, Object> args) {\n                 Map.Entry<String, Object> me = i.next();\n                 wherecode.append(\"`\").append(me.getKey()).append(\"` = \");\n                 if (me.getValue() instanceof String)\n-                    wherecode.append(\"'\").append(((String) me.getValue()).replace(\"'\", \"\\''\")).append(\"'\");\n+                    wherecode.append(\"'\").append(((String) me.getValue()).replace(\"'\", \"''\")).append(\"'\");", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "6f49d1ccc3b5683d7652931083b44052ddb0942d"}, "originalPosition": 5}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NjYyNjMyMA==", "bodyText": "You only need to escape ' when you are using it in a Character definition, this is a String definition, e.g. you need to escape like this: '\\'' to get the Character ' , but in a String you need to escape like this: \"\\\"\" to get a \".", "url": "https://github.com/TownyAdvanced/Towny/pull/3802#discussion_r396626320", "createdAt": "2020-03-23T17:27:19Z", "author": {"login": "Articdive"}, "path": "src/com/palmergames/bukkit/towny/db/TownySQLSource.java", "diffHunk": "@@ -435,7 +435,7 @@ public boolean QueueDeleteDB(String tb_name, HashMap<String, Object> args) {\n                 Map.Entry<String, Object> me = i.next();\n                 wherecode.append(\"`\").append(me.getKey()).append(\"` = \");\n                 if (me.getValue() instanceof String)\n-                    wherecode.append(\"'\").append(((String) me.getValue()).replace(\"'\", \"\\''\")).append(\"'\");\n+                    wherecode.append(\"'\").append(((String) me.getValue()).replace(\"'\", \"''\")).append(\"'\");", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NTg2MDQ3MQ=="}, "originalCommit": {"oid": "6f49d1ccc3b5683d7652931083b44052ddb0942d"}, "originalPosition": 5}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjQ1MzY3MTEzOnYy", "diffSide": "RIGHT", "path": "src/com/palmergames/bukkit/towny/regen/PlotBlockData.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yMFQyMDowNjo0OVrOF5huCw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yMVQwMDoxNDoyNFrOF5mOqA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NTg2NTYxMQ==", "bodyText": "Wondering if this needs the ints to keep whole numbers. Have you tested the regeneration of blocks?", "url": "https://github.com/TownyAdvanced/Towny/pull/3802#discussion_r395865611", "createdAt": "2020-03-20T20:06:49Z", "author": {"login": "LlmDl"}, "path": "src/com/palmergames/bukkit/towny/regen/PlotBlockData.java", "diffHunk": "@@ -122,8 +122,8 @@ public boolean restoreNextBlock() {\n \t\twhile (reverse > 0) {\r\n \t\t\treverse--; //regen bottom up to stand a better chance of restoring tree's and plants.\r\n \t\t\ty = height - (reverse % height);\r\n-\t\t\tx = (int) (reverse / height) % size;\r\n-\t\t\tz = ((int) (reverse / height) / size) % size;\r\n+\t\t\tx = (reverse / height) % size;\r\n+\t\t\tz = (reverse / height / size) % size;\r", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "6f49d1ccc3b5683d7652931083b44052ddb0942d"}, "originalPosition": 7}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NTkzOTQ5Ng==", "bodyText": "This is fine since modulus cannot return anything but an integer.\nThese statements are essentially\n(int / int) % int)", "url": "https://github.com/TownyAdvanced/Towny/pull/3802#discussion_r395939496", "createdAt": "2020-03-21T00:14:24Z", "author": {"login": "silverwolfg11"}, "path": "src/com/palmergames/bukkit/towny/regen/PlotBlockData.java", "diffHunk": "@@ -122,8 +122,8 @@ public boolean restoreNextBlock() {\n \t\twhile (reverse > 0) {\r\n \t\t\treverse--; //regen bottom up to stand a better chance of restoring tree's and plants.\r\n \t\t\ty = height - (reverse % height);\r\n-\t\t\tx = (int) (reverse / height) % size;\r\n-\t\t\tz = ((int) (reverse / height) / size) % size;\r\n+\t\t\tx = (reverse / height) % size;\r\n+\t\t\tz = (reverse / height / size) % size;\r", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NTg2NTYxMQ=="}, "originalCommit": {"oid": "6f49d1ccc3b5683d7652931083b44052ddb0942d"}, "originalPosition": 7}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjQ1MzY3Mjg1OnYy", "diffSide": "RIGHT", "path": "src/com/palmergames/bukkit/towny/utils/CombatUtil.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yMFQyMDowNzozNlrOF5hvNA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yM1QxNzozMzozNVrOF6QbLg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NTg2NTkwOA==", "bodyText": "Was this tested?", "url": "https://github.com/TownyAdvanced/Towny/pull/3802#discussion_r395865908", "createdAt": "2020-03-20T20:07:36Z", "author": {"login": "LlmDl"}, "path": "src/com/palmergames/bukkit/towny/utils/CombatUtil.java", "diffHunk": "@@ -138,7 +138,7 @@ public static boolean preventDamageCall(Towny plugin, TownyWorld world, Entity a\n \t\t\t * The target is in a TownBlock and...\n \t\t\t * the target is a tame wolf and we are not it's owner\n \t\t\t */\n-\t\t\tif ((defendingPlayer != null) || ((defenderTB != null) && ((defendingEntity instanceof Wolf) && ((Wolf) defendingEntity).isTamed() && !((Wolf) defendingEntity).getOwner().equals((AnimalTamer) attackingEntity)))) {\n+\t\t\tif ((defendingPlayer != null) || ((defenderTB != null) && ((defendingEntity instanceof Wolf) && ((Wolf) defendingEntity).isTamed() && !((Wolf) defendingEntity).getOwner().equals(attackingEntity)))) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "6f49d1ccc3b5683d7652931083b44052ddb0942d"}, "originalPosition": 5}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NjYzMDgzMA==", "bodyText": "The Object stays the same, the equals call does an == anyway, since OfflinePlayer does not nor do any of the interfaces of Player override equals().", "url": "https://github.com/TownyAdvanced/Towny/pull/3802#discussion_r396630830", "createdAt": "2020-03-23T17:33:35Z", "author": {"login": "Articdive"}, "path": "src/com/palmergames/bukkit/towny/utils/CombatUtil.java", "diffHunk": "@@ -138,7 +138,7 @@ public static boolean preventDamageCall(Towny plugin, TownyWorld world, Entity a\n \t\t\t * The target is in a TownBlock and...\n \t\t\t * the target is a tame wolf and we are not it's owner\n \t\t\t */\n-\t\t\tif ((defendingPlayer != null) || ((defenderTB != null) && ((defendingEntity instanceof Wolf) && ((Wolf) defendingEntity).isTamed() && !((Wolf) defendingEntity).getOwner().equals((AnimalTamer) attackingEntity)))) {\n+\t\t\tif ((defendingPlayer != null) || ((defenderTB != null) && ((defendingEntity instanceof Wolf) && ((Wolf) defendingEntity).isTamed() && !((Wolf) defendingEntity).getOwner().equals(attackingEntity)))) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NTg2NTkwOA=="}, "originalCommit": {"oid": "6f49d1ccc3b5683d7652931083b44052ddb0942d"}, "originalPosition": 5}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjQ1MzY3NDg3OnYy", "diffSide": "RIGHT", "path": "src/com/palmergames/util/TimeMgmt.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yMFQyMDowODoyOVrOF5hwfQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yMVQwMDoxMDo0MlrOF5mMVw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NTg2NjIzNw==", "bodyText": "I'm assuming this was an IDE thing?", "url": "https://github.com/TownyAdvanced/Towny/pull/3802#discussion_r395866237", "createdAt": "2020-03-20T20:08:29Z", "author": {"login": "LlmDl"}, "path": "src/com/palmergames/util/TimeMgmt.java", "diffHunk": "@@ -52,12 +52,12 @@ public static String formatCountdownTime(long l) {\n \r\n \t\tString out = \"\";\r\n \t\tif (l >= 3600) {\r\n-\t\t\tint h = (int) Math.floor(l / 3600);\r\n+\t\t\tint h = (int) Math.floor(l / 3600.0);\r\n \t\t\tout = h + TownySettings.getLangString(\"msg_hours\");\r\n \t\t\tl -= h * 3600;\r\n \t\t}\r\n \t\tif (l >= 60) {\r\n-\t\t\tint m = (int) Math.floor(l / 60);\r\n+\t\t\tint m = (int) Math.floor(l / 60.0);\r", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "6f49d1ccc3b5683d7652931083b44052ddb0942d"}, "originalPosition": 11}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NTkzODkwMw==", "bodyText": "Math.floor() in this context isn't necessary at all. Doing something like (int) (l / 60) will automatically truncate the int which is basically flooring it.\nTo prove this, here's a little simple, but seemingly infinite test code:\nfor (long l = 0; l < Long.MAX_VALUE; ++l) {\n    int f = (int) Math.floor(l / 3600.0);\n    int t = (int) (l / 3600);\n    if (f != t) {\n        System.out.println(\"Comparison Inequality\");\n        break;\n    }\n}\nhint: it doesn't output anything.", "url": "https://github.com/TownyAdvanced/Towny/pull/3802#discussion_r395938903", "createdAt": "2020-03-21T00:10:42Z", "author": {"login": "silverwolfg11"}, "path": "src/com/palmergames/util/TimeMgmt.java", "diffHunk": "@@ -52,12 +52,12 @@ public static String formatCountdownTime(long l) {\n \r\n \t\tString out = \"\";\r\n \t\tif (l >= 3600) {\r\n-\t\t\tint h = (int) Math.floor(l / 3600);\r\n+\t\t\tint h = (int) Math.floor(l / 3600.0);\r\n \t\t\tout = h + TownySettings.getLangString(\"msg_hours\");\r\n \t\t\tl -= h * 3600;\r\n \t\t}\r\n \t\tif (l >= 60) {\r\n-\t\t\tint m = (int) Math.floor(l / 60);\r\n+\t\t\tint m = (int) Math.floor(l / 60.0);\r", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NTg2NjIzNw=="}, "originalCommit": {"oid": "6f49d1ccc3b5683d7652931083b44052ddb0942d"}, "originalPosition": 11}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjQ1NDE0ODIwOnYy", "diffSide": "RIGHT", "path": "src/com/palmergames/bukkit/towny/command/NationCommand.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yMVQwMDoyNjoxMVrOF5mVYw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yMVQwMDoyNjoxMVrOF5mVYw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NTk0MTIxOQ==", "bodyText": "I know this was out of scope, but can be replaced with iMax = Math.min(page *10, nations.size());\nSame for TownCommand.", "url": "https://github.com/TownyAdvanced/Towny/pull/3802#discussion_r395941219", "createdAt": "2020-03-21T00:26:11Z", "author": {"login": "silverwolfg11"}, "path": "src/com/palmergames/bukkit/towny/command/NationCommand.java", "diffHunk": "@@ -1250,7 +1250,7 @@ public void sendList(CommandSender sender, List<Nation> nations, int page, int t\n \t\tif ((page * 10) > nations.size()) {\r\n \t\t\tiMax = nations.size();\r\n \t\t}\r", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "6f49d1ccc3b5683d7652931083b44052ddb0942d"}, "originalPosition": 3}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjQ1NDE0OTAwOnYy", "diffSide": "RIGHT", "path": "src/com/palmergames/bukkit/towny/command/NationCommand.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yMVQwMDoyNzoxNFrOF5mV3g==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yM1QxNzozOTowMVrOF6Qo_Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NTk0MTM0Mg==", "bodyText": "For micro-performance, you could set the initial capacity to iMax - (10*page) + 10", "url": "https://github.com/TownyAdvanced/Towny/pull/3802#discussion_r395941342", "createdAt": "2020-03-21T00:27:14Z", "author": {"login": "silverwolfg11"}, "path": "src/com/palmergames/bukkit/towny/command/NationCommand.java", "diffHunk": "@@ -1250,7 +1250,7 @@ public void sendList(CommandSender sender, List<Nation> nations, int page, int t\n \t\tif ((page * 10) > nations.size()) {\r\n \t\t\tiMax = nations.size();\r\n \t\t}\r\n-\t\tList<String> nationsordered = new ArrayList();\r\n+\t\tList<String> nationsordered = new ArrayList<>();\r", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "6f49d1ccc3b5683d7652931083b44052ddb0942d"}, "originalPosition": 5}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NjYzNDM2NQ==", "bodyText": "Can't we set the initialCapacity to 10?\niMax = page*10 (it can at most be this),\ncapacity = iMax - (10*page) + 10\ncapacity = (10*page) - (10*page) + 10\ncapacity = 10.\nIn the general case, this might be quicker than always subtracting for the edge case of there being less than 10 towns (then iMax would be < page*10 and not = page*10).", "url": "https://github.com/TownyAdvanced/Towny/pull/3802#discussion_r396634365", "createdAt": "2020-03-23T17:39:01Z", "author": {"login": "Articdive"}, "path": "src/com/palmergames/bukkit/towny/command/NationCommand.java", "diffHunk": "@@ -1250,7 +1250,7 @@ public void sendList(CommandSender sender, List<Nation> nations, int page, int t\n \t\tif ((page * 10) > nations.size()) {\r\n \t\t\tiMax = nations.size();\r\n \t\t}\r\n-\t\tList<String> nationsordered = new ArrayList();\r\n+\t\tList<String> nationsordered = new ArrayList<>();\r", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NTk0MTM0Mg=="}, "originalCommit": {"oid": "6f49d1ccc3b5683d7652931083b44052ddb0942d"}, "originalPosition": 5}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1249, "cost": 1, "resetAt": "2021-11-13T14:23:39Z"}}}