{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTMxMzU0Mzc3", "number": 4517, "title": "Api/generic toggle events", "bodyText": "Description:\n\nAdds:\nNationToggleEvent\nNationToggleNeutralEvent\nNationToggleOpenEvent\nNationTogglePublicEvent\nNationToggleUnknownEvent\n\nTownToggleEvent\nTownToggleExplosionEvent\nTownToggleFireEvent\nTownToggleMobsEvent\nTownToggleOpenEvent\nTownTogglePVPEvent\nTownTogglePublicEvent\nTownToggleTaxPercentEvent\nTownToggleUnknownEvent\n\n\nThese events fire after all other Towny-side decisions are made on\nwhether the action is allowed by the sender.\nAdds bonus TownToggleUnknownEvent & NationToggleUnknownEvent which is\nfired when a subcommand we dont recognize is used.\n\nDefaults to cancelled but is fired to allow another plugin to be\nable to see the args used in order to simulate their having a proper /t\ntoggle command.\n\n\nSwitches help menus over to using the newer HelpMenu object.\nGeneral commenting.\nFix the new javadocs.\n\n\nNew Nodes/Commands/ConfigOptions:\n\n\nRelevant Towny Issue ticket:\n\nWorks towards closing #4515 and many similar event requirements.\n\n\n I have tested this pull request for defects on a server.\n\n\nBy making this pull request, I represent that I have the right to waive copyright and related rights to my contribution, and agree that all copyright and related rights in my contributions are waived, and I acknowledge that the TownyAdvanced organization has the copyright to use and modify my contribution under the Towny License for perpetuity.", "createdAt": "2020-12-02T23:31:12Z", "url": "https://github.com/TownyAdvanced/Towny/pull/4517", "merged": true, "mergeCommit": {"oid": "5ab25ab07639834f0a0104502d4f5f3591bb3891"}, "closed": true, "closedAt": "2020-12-06T14:57:41Z", "author": {"login": "LlmDl"}, "timelineItems": {"totalCount": 11, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdjQ3TIAFqTU0NTY0MDc0Ng==", "endCursor": "Y3Vyc29yOnYyOpPPAAABdjhShcgBqjQwNzY2MjQyMzg=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTQ1NjQwNzQ2", "url": "https://github.com/TownyAdvanced/Towny/pull/4517#pullrequestreview-545640746", "createdAt": "2020-12-05T18:41:36Z", "commit": {"oid": "bc074310f55d5e2d8f411fbb860389a11bb8be48"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0wNVQxODo0MTozNlrOH_-5zA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0wNVQxODo0MzowM1rOH_-9yw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNjg1Mjk0MA==", "bodyText": "Replace with @param sender {@link CommandSender} running the command.", "url": "https://github.com/TownyAdvanced/Towny/pull/4517#discussion_r536852940", "createdAt": "2020-12-05T18:41:36Z", "author": {"login": "TheFlagCourier"}, "path": "src/com/palmergames/bukkit/towny/event/town/toggle/TownPreToggleEvent.java", "diffHunk": "@@ -0,0 +1,97 @@\n+package com.palmergames.bukkit.towny.event.town.toggle;\r\n+\r\n+import org.bukkit.Bukkit;\r\n+import org.bukkit.command.CommandSender;\r\n+import org.bukkit.entity.Player;\r\n+import org.bukkit.event.Cancellable;\r\n+import org.bukkit.event.Event;\r\n+import org.bukkit.event.HandlerList;\r\n+import org.jetbrains.annotations.Nullable;\r\n+\r\n+import com.palmergames.bukkit.towny.TownyUniverse;\r\n+import com.palmergames.bukkit.towny.exceptions.NotRegisteredException;\r\n+import com.palmergames.bukkit.towny.object.Resident;\r\n+import com.palmergames.bukkit.towny.object.Town;\r\n+import com.palmergames.bukkit.towny.object.Translation;\r\n+\r\n+public abstract class TownPreToggleEvent extends Event implements Cancellable {\r\n+\r\n+\tprivate static final HandlerList handlers = new HandlerList();\r\n+\tprivate Player player = null;\r\n+\tprivate final Town town;\r\n+\tprivate final CommandSender sender;\r\n+\tprivate final boolean isAdminAction;\r\n+\tprivate boolean isCancelled = false;\r\n+\tprivate String cancellationMsg = Translation.of(\"msg_err_command_disable\");\r\n+\t\r\n+\t/**\r\n+\t * A generic cancellable event thrown when a player uses the /town toggle {args} command.\r\n+\t * \r\n+\t * @param player Player who has run the command.\r", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "bc074310f55d5e2d8f411fbb860389a11bb8be48"}, "originalPosition": 30}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNjg1Mzk2Mw==", "bodyText": "Same as before, replace with reference to sender instead of player", "url": "https://github.com/TownyAdvanced/Towny/pull/4517#discussion_r536853963", "createdAt": "2020-12-05T18:43:03Z", "author": {"login": "TheFlagCourier"}, "path": "src/com/palmergames/bukkit/towny/event/town/toggle/TownToggleEvent.java", "diffHunk": "@@ -0,0 +1,76 @@\n+package com.palmergames.bukkit.towny.event.town.toggle;\r\n+\r\n+import org.bukkit.Bukkit;\r\n+import org.bukkit.command.CommandSender;\r\n+import org.bukkit.entity.Player;\r\n+import org.bukkit.event.Event;\r\n+import org.bukkit.event.HandlerList;\r\n+import org.jetbrains.annotations.Nullable;\r\n+\r\n+import com.palmergames.bukkit.towny.TownyUniverse;\r\n+import com.palmergames.bukkit.towny.exceptions.NotRegisteredException;\r\n+import com.palmergames.bukkit.towny.object.Resident;\r\n+import com.palmergames.bukkit.towny.object.Town;\r\n+\r\n+public abstract class TownToggleEvent extends Event {\r\n+\r\n+\tprivate static final HandlerList handlers = new HandlerList();\r\n+\tprivate Player player = null;\r\n+\tprivate final Town town;\r\n+\tprivate final CommandSender sender;\r\n+\tprivate final boolean isAdminAction;\r\n+\t\r\n+\t/**\r\n+\t * A generic cancellable event thrown when a player uses the /town toggle {args} command.\r\n+\t * \r\n+\t * @param player Player who has run the command.\r", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "bc074310f55d5e2d8f411fbb860389a11bb8be48"}, "originalPosition": 26}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTQ1NjkyODcy", "url": "https://github.com/TownyAdvanced/Towny/pull/4517#pullrequestreview-545692872", "createdAt": "2020-12-06T10:49:17Z", "commit": {"oid": "fdd3bf36127ce2595ed59000e0e20a33c8e85873"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "91d264bc250fe7cc380a5ceb759c9427273bbf9f", "author": {"user": {"login": "LlmDl", "name": null}}, "url": "https://github.com/TownyAdvanced/Towny/commit/91d264bc250fe7cc380a5ceb759c9427273bbf9f", "committedDate": "2020-12-06T13:47:02Z", "message": "Initial setup of new events.\n\n- Currently throws an NPE on startup, but I have other things to do atm."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "4f85a75821f3267c35cdb454bc7cc0f56053b0ec", "author": {"user": {"login": "LlmDl", "name": null}}, "url": "https://github.com/TownyAdvanced/Towny/commit/4f85a75821f3267c35cdb454bc7cc0f56053b0ec", "committedDate": "2020-12-06T13:47:02Z", "message": "Typo"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a1b038b1b2e5f93916b148a42e686a2adc60fb7c", "author": {"user": {"login": "LlmDl", "name": null}}, "url": "https://github.com/TownyAdvanced/Towny/commit/a1b038b1b2e5f93916b148a42e686a2adc60fb7c", "committedDate": "2020-12-06T13:47:32Z", "message": "Adds NationGenericToggleEvent and TownGenericToggleEvents\n\n- Fixes missing \"static\" on two other recent events."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c207f741467b2c6270e0bbd1bfe58832a693bf7e", "author": {"user": {"login": "LlmDl", "name": null}}, "url": "https://github.com/TownyAdvanced/Towny/commit/c207f741467b2c6270e0bbd1bfe58832a693bf7e", "committedDate": "2020-12-06T13:48:05Z", "message": "Big change over to using abstract toggle and pretoggle events for towns\nand nations, as well as an preEvent and event for each toggle command."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a38741cbb4606c547efda6d7a08ebc15714a87cf", "author": {"user": {"login": "LlmDl", "name": null}}, "url": "https://github.com/TownyAdvanced/Towny/commit/a38741cbb4606c547efda6d7a08ebc15714a87cf", "committedDate": "2020-12-06T13:48:05Z", "message": "Redo using CommandSender instead of Player, include boolean indicating\nit is an admin action."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "42074e1c6ac8f3ed81997075151e57e0d9250619", "author": {"user": {"login": "LlmDl", "name": null}}, "url": "https://github.com/TownyAdvanced/Towny/commit/42074e1c6ac8f3ed81997075151e57e0d9250619", "committedDate": "2020-12-06T13:49:23Z", "message": "Lets just redo it again then shall we.\n\n- Scraps multiple events for one cancellable event per-toggle.\n- These events fire after all other Towny-side decisions are made on\nwhether the action is allowed by the sender.\n- Adds bonus TownToggleCustomEvent & NationToggleCustomEvent which is\nfired when a subcommand we dont recognize is used.\n  - Defaults to cancelled but is fired to allow another plugin to be\nable to see the args used in order to simulate their having a proper /t\ntoggle command.\n- Switches help menus over to using the newer HelpMenu object.\n- General commenting.\n- Fix the new javadocs."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "5fdc05f732cf8e1f133779194368ff06d32ec03d", "author": {"user": {"login": "LlmDl", "name": null}}, "url": "https://github.com/TownyAdvanced/Towny/commit/5fdc05f732cf8e1f133779194368ff06d32ec03d", "committedDate": "2020-12-06T13:49:23Z", "message": "Clean up toggling pvp tests."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "826bf48f9b5f8619ebfcdd12ba0c17bf99aadb58", "author": {"user": {"login": "LlmDl", "name": null}}, "url": "https://github.com/TownyAdvanced/Towny/commit/826bf48f9b5f8619ebfcdd12ba0c17bf99aadb58", "committedDate": "2020-12-06T13:51:22Z", "message": "Change togglecustomevents to toggleunknownevents & rebase."}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "fdd3bf36127ce2595ed59000e0e20a33c8e85873", "author": {"user": {"login": "LlmDl", "name": null}}, "url": "https://github.com/TownyAdvanced/Towny/commit/fdd3bf36127ce2595ed59000e0e20a33c8e85873", "committedDate": "2020-12-06T01:21:10Z", "message": "Clean up toggling pvp tests."}, "afterCommit": {"oid": "826bf48f9b5f8619ebfcdd12ba0c17bf99aadb58", "author": {"user": {"login": "LlmDl", "name": null}}, "url": "https://github.com/TownyAdvanced/Towny/commit/826bf48f9b5f8619ebfcdd12ba0c17bf99aadb58", "committedDate": "2020-12-06T13:51:22Z", "message": "Change togglecustomevents to toggleunknownevents & rebase."}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4144, "cost": 1, "resetAt": "2021-11-01T16:37:27Z"}}}