{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTMxODM3NzA2", "number": 4518, "title": "Cleanup Town Ruin code - Javadoc and other changes.", "bodyText": "Description:\n\nCleans up the Town Ruin feature introduced in https://github.com/TownyAdvanced/Towny/releases/tag/0.96.5.1. Made the Javadoc plugin stop spitting warnings, and my IDE / linter happy.\nFixes/Cleans:\n\nAdded missing Javadoc parameters\nMask implied constructors since these are utility classes.\nMethodized setMayor(), as it was duplicated between both methods (Removes TODO statement.) Also removed duplicate (inaccurate) inline comment for one of the callers.\nCollapsed exceptions with identical catches into singular statement.\nCollapsed if/if else statements with common output.\nAdded a null-check in OnPlayerLogin task where isRuined() is called.\n\n\nNew Nodes/Commands/ConfigOptions:\n\nN/A - No additions relevant to server operators.\n\nRelevant Towny Issue ticket:\n\nCleans up after #4123 (original PR) and #4498 (actual implementation)\n\n\n I have tested this pull request for defects on a server.\n\n\nBy making this pull request, I represent that I have the right to waive copyright and related rights to my contribution, and agree that all copyright and related rights in my contributions are waived, and I acknowledge that the TownyAdvanced organization has the copyright to use and modify my contribution under the Towny License for perpetuity.", "createdAt": "2020-12-03T14:52:56Z", "url": "https://github.com/TownyAdvanced/Towny/pull/4518", "merged": true, "mergeCommit": {"oid": "188c5cc4a4b953c105adacf7517e086da4e6580a"}, "closed": true, "closedAt": "2020-12-06T15:12:37Z", "author": {"login": "TheFlagCourier"}, "timelineItems": {"totalCount": 5, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdilQ0TgFqTU0NDEwMjI3Ng==", "endCursor": "Y3Vyc29yOnYyOpPPAAABdiwSdcABqjQwNzA5NzQ4Nzc=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTQ0MTAyMjc2", "url": "https://github.com/TownyAdvanced/Towny/pull/4518#pullrequestreview-544102276", "createdAt": "2020-12-03T15:48:53Z", "commit": {"oid": "9c1f072cd0cfa7f9b5b1dbba29a2037fad0be412"}, "state": "COMMENTED", "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0wM1QxNTo0ODo1M1rOH-jXow==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0wM1QxNTo1NToxNVrOH-julQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNTM1MzI1MQ==", "bodyText": "If I'm not mistaken this will result in the msg_reclaim_available message being show in situations where getTownsRuinsReclaimEnabled is not true...", "url": "https://github.com/TownyAdvanced/Towny/pull/4518#discussion_r535353251", "createdAt": "2020-12-03T15:48:53Z", "author": {"login": "LlmDl"}, "path": "src/com/palmergames/bukkit/towny/TownyFormatter.java", "diffHunk": "@@ -378,11 +378,12 @@ private static void getRanks(Town town, List<String> ranklist) {\n \r\n \t\tif (town.isRuined()) {\r\n \t\t\tout.add(Translation.of(\"msg_time_remaining_before_full_removal\", TownRuinSettings.getTownRuinsMaxDurationHours() - TownRuinUtil.getTimeSinceRuining(town)));\r\n-\t\t\tif (TownRuinSettings.getTownRuinsReclaimEnabled()) {\r\n-\t\t\t\tif (TownRuinUtil.getTimeSinceRuining(town) < TownRuinSettings.getTownRuinsMinDurationHours())\r\n-\t\t\t\t\tout.add(Translation.of(\"msg_time_until_reclaim_available\", TownRuinSettings.getTownRuinsMinDurationHours() - TownRuinUtil.getTimeSinceRuining(town)));\r\n-\t\t\t\telse \r\n-\t\t\t\t\tout.add(Translation.of(\"msg_reclaim_available\"));\r\n+\t\t\tif (TownRuinSettings.getTownRuinsReclaimEnabled()\r\n+\t\t\t\t\t&& TownRuinUtil.getTimeSinceRuining(town) < TownRuinSettings.getTownRuinsMinDurationHours()) {\r\n+\t\t\t\tout.add(Translation.of(\"msg_time_until_reclaim_available\", TownRuinSettings.getTownRuinsMinDurationHours() - TownRuinUtil.getTimeSinceRuining(town)));\r\n+\t\t\t}\r\n+\t\t\telse {\r\n+\t\t\t\tout.add(Translation.of(\"msg_reclaim_available\"));\r", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "9c1f072cd0cfa7f9b5b1dbba29a2037fad0be412"}, "originalPosition": 14}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNTM1NTIwOA==", "bodyText": "Because the getTown() is hidden behind a hasTown() we know we can ignore this.", "url": "https://github.com/TownyAdvanced/Towny/pull/4518#discussion_r535355208", "createdAt": "2020-12-03T15:50:38Z", "author": {"login": "LlmDl"}, "path": "src/com/palmergames/bukkit/towny/war/common/townruin/TownRuinUtil.java", "diffHunk": "@@ -47,7 +50,9 @@ public static boolean isPlayersTownRuined(Player player) {\n \t\t\tif(resident.hasTown() && resident.getTown().isRuined())\n \t\t\t\treturn true;\n \t\t\t\n-\t\t} catch (NotRegisteredException ignored) {}\n+\t\t} catch (NotRegisteredException ignored) {\n+\t\t\t// Ignored - Maybe add to a debug logger later?", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "9c1f072cd0cfa7f9b5b1dbba29a2037fad0be412"}, "originalPosition": 16}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNTM1OTEyNQ==", "bodyText": "Please re-add the TODO: on this, so that it gets dealt with later on.", "url": "https://github.com/TownyAdvanced/Towny/pull/4518#discussion_r535359125", "createdAt": "2020-12-03T15:55:15Z", "author": {"login": "LlmDl"}, "path": "src/com/palmergames/bukkit/towny/war/common/townruin/TownRuinUtil.java", "diffHunk": "@@ -160,10 +157,17 @@ public static void processRuinedTownReclaimRequest(Player player, Towny plugin)\n \t\t\tBukkit.getPluginManager().callEvent(event);\n \n \t\t\tTownyMessaging.sendGlobalMessage(Translation.of(\"msg_town_reclaimed\", resident.getName(), town.getName()));\n-\t\t} catch (TownyException e) {\n+\t\t} catch (TownyException | EconomyException e) {\n \t\t\tTownyMessaging.sendErrorMsg(player,e.getMessage());\n-\t\t} catch (EconomyException ex) {\n-\t\t\tTownyMessaging.sendErrorMsg(player,ex.getMessage());\n+\t\t}\n+\t}\n+\n+\tprivate static void setMayor(Towny plugin, Town town, String name) {\n+\t\ttry {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "9c1f072cd0cfa7f9b5b1dbba29a2037fad0be412"}, "originalPosition": 82}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTQ0MTU5MzM4", "url": "https://github.com/TownyAdvanced/Towny/pull/4518#pullrequestreview-544159338", "createdAt": "2020-12-03T16:40:04Z", "commit": {"oid": "cda64d79e357f32a42d79ea749a682a11cd0475b"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0wM1QxNjo0MDowNVrOH-l5qg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0wM1QxNjo0MDowNVrOH-l5qg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNTM5NDczMA==", "bodyText": "This can be replaced by the master branch entirely now.", "url": "https://github.com/TownyAdvanced/Towny/pull/4518#discussion_r535394730", "createdAt": "2020-12-03T16:40:05Z", "author": {"login": "LlmDl"}, "path": "src/com/palmergames/bukkit/towny/TownyFormatter.java", "diffHunk": "@@ -378,11 +378,13 @@ private static void getRanks(Town town, List<String> ranklist) {\n \r\n \t\tif (town.isRuined()) {\r\n \t\t\tout.add(Translation.of(\"msg_time_remaining_before_full_removal\", TownRuinSettings.getTownRuinsMaxDurationHours() - TownRuinUtil.getTimeSinceRuining(town)));\r\n-\t\t\tif (TownRuinSettings.getTownRuinsReclaimEnabled()) {\r\n-\t\t\t\tif (TownRuinUtil.getTimeSinceRuining(town) < TownRuinSettings.getTownRuinsMinDurationHours())\r\n+\t\t\tif (TownRuinSettings.getTownRuinsReclaimEnabled()){\r\n+\t\t\t\tif (TownRuinUtil.getTimeSinceRuining(town) < TownRuinSettings.getTownRuinsMinDurationHours()) {\r\n \t\t\t\t\tout.add(Translation.of(\"msg_time_until_reclaim_available\", TownRuinSettings.getTownRuinsMinDurationHours() - TownRuinUtil.getTimeSinceRuining(town)));\r\n-\t\t\t\telse \r\n+\t\t\t\t}\r\n+\t\t\t\telse {\r\n \t\t\t\t\tout.add(Translation.of(\"msg_reclaim_available\"));\r\n+\t\t\t\t}\r", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "cda64d79e357f32a42d79ea749a682a11cd0475b"}, "originalPosition": 13}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "cda64d79e357f32a42d79ea749a682a11cd0475b", "author": {"user": {"login": "TheFlagCourier", "name": "FlagCourier"}}, "url": "https://github.com/TownyAdvanced/Towny/commit/cda64d79e357f32a42d79ea749a682a11cd0475b", "committedDate": "2020-12-03T16:33:30Z", "message": "Make requested changes: Restore TODO, re-nest a conditional.\n\nHuman error on my part, nesting that if statement.\n\nAlso restored the TODO attached to `setMayor()`'s old implementation."}, "afterCommit": {"oid": "865d497fe249ae4b25e5fbed6ff964abb0bd6709", "author": {"user": {"login": "TheFlagCourier", "name": "FlagCourier"}}, "url": "https://github.com/TownyAdvanced/Towny/commit/865d497fe249ae4b25e5fbed6ff964abb0bd6709", "committedDate": "2020-12-03T16:52:58Z", "message": "Cleanup Town Ruin Code, amended.\n\nUnwraps previous commits to not even touch TownyFormatter.\n\nPrevious commits: Cleanup Town Ruin Code, amended.\nMade the Javadoc plugin and my IDE linter happy.\n\nFixes/Cleans:\n- Added missing Javadoc parameters\n- Methodized setMayor(), as it was duplicated between both methods (~~Removes TODO statement.~~) Also removed duplicate (inaccurate) inline comment for one of the callers.\n- Collapsed exceptions with identical output\n- Collapsed if() statement with common output.\n- Added a null-check in OnPlayerLogin task where isRuined() is called."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "704cf358362d5f0fef362433abfdb56042ab124f", "author": {"user": {"login": "TheFlagCourier", "name": "FlagCourier"}}, "url": "https://github.com/TownyAdvanced/Towny/commit/704cf358362d5f0fef362433abfdb56042ab124f", "committedDate": "2020-12-04T04:44:21Z", "message": "Cleanup Town Ruin Code, amended.\n\nUnwraps previous commits to not even touch TownyFormatter.\n\nPrevious commits: Cleanup Town Ruin Code, amended.\nMade the Javadoc plugin and my IDE linter happy.\n\nFixes/Cleans:\n- Added missing Javadoc parameters\n- Methodized setMayor(), as it was duplicated between both methods (~~Removes TODO statement.~~) Also removed duplicate (inaccurate) inline comment for one of the callers.\n- Collapsed exceptions with identical output\n- Collapsed if() statement with common output.\n- Added a null-check in OnPlayerLogin task where isRuined() is called."}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "1b2a8352fb21269a290da7db42a94ab66ca9ff3a", "author": {"user": {"login": "TheFlagCourier", "name": "FlagCourier"}}, "url": "https://github.com/TownyAdvanced/Towny/commit/1b2a8352fb21269a290da7db42a94ab66ca9ff3a", "committedDate": "2020-12-04T04:44:45Z", "message": "Merge remote-tracking branch 'origin/cleanup/TownRuin' into cleanup/TownRuin"}, "afterCommit": {"oid": "704cf358362d5f0fef362433abfdb56042ab124f", "author": {"user": {"login": "TheFlagCourier", "name": "FlagCourier"}}, "url": "https://github.com/TownyAdvanced/Towny/commit/704cf358362d5f0fef362433abfdb56042ab124f", "committedDate": "2020-12-04T04:44:21Z", "message": "Cleanup Town Ruin Code, amended.\n\nUnwraps previous commits to not even touch TownyFormatter.\n\nPrevious commits: Cleanup Town Ruin Code, amended.\nMade the Javadoc plugin and my IDE linter happy.\n\nFixes/Cleans:\n- Added missing Javadoc parameters\n- Methodized setMayor(), as it was duplicated between both methods (~~Removes TODO statement.~~) Also removed duplicate (inaccurate) inline comment for one of the callers.\n- Collapsed exceptions with identical output\n- Collapsed if() statement with common output.\n- Added a null-check in OnPlayerLogin task where isRuined() is called."}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4146, "cost": 1, "resetAt": "2021-11-01T16:37:27Z"}}}