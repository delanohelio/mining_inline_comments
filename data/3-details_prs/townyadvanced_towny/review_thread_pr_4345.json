{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDk0MjcyOTA5", "number": 4345, "reviewThreads": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yOFQxNzoxNjoyMFrOEoL0Sg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yOFQxNzoxNjoyMFrOEoL0Sg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzEwNTcyMTA2OnYy", "diffSide": "RIGHT", "path": "src/com/palmergames/bukkit/towny/listeners/TownyEntityListener.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yOFQxNzoxNjoyMFrOHZILPQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yOFQxNzo0ODowMlrOHZJRWw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NjExMDM5Nw==", "bodyText": "I would cancel and do event.getEntity().remove() this way the same checks aren't being done every 5 ticks.", "url": "https://github.com/TownyAdvanced/Towny/pull/4345#discussion_r496110397", "createdAt": "2020-09-28T17:16:20Z", "author": {"login": "creatorfromhell"}, "path": "src/com/palmergames/bukkit/towny/listeners/TownyEntityListener.java", "diffHunk": "@@ -375,6 +378,39 @@ public void onEntityDamageByEntityEvent(EntityDamageByEntityEvent event) {\n \t\t\t\r\n \t}\r\n \r\n+\t/**\r\n+\t * Handles dragon fireball's cloud damage to players.\r\n+\t * \r\n+\t * @param event AreaEffectCloudApplyEvent\r\n+\t */\r\n+\t@EventHandler(priority = EventPriority.HIGH, ignoreCancelled = true)\r\n+\tpublic void onDragonFireBallCloudDamage(AreaEffectCloudApplyEvent event) {\r\n+\t\tif (!TownyAPI.getInstance().isTownyWorld(event.getEntity().getWorld()))\r\n+\t\t\treturn;\r\n+\t\t\r\n+\t\tif (!event.getEntity().getBasePotionData().getType().equals(PotionType.UNCRAFTABLE))\r\n+\t\t\treturn;\r\n+\r\n+\t\tif (!(event.getEntity().getSource() instanceof Player) || !(event.getEntity().getSource() instanceof DragonFireball))\r\n+\t\t\treturn;\r\n+\r\n+\t\tList<LivingEntity> entities = event.getAffectedEntities();\r\n+\r\n+\t\tTownyWorld townyWorld = null;\r\n+\t\ttry {\r\n+\t\t\ttownyWorld = TownyUniverse.getInstance().getDataSource().getWorld(event.getEntity().getWorld().getName());\r\n+\t\t} catch (NotRegisteredException e) {\r\n+\t\t\t// Failed to fetch a world\r\n+\t\t\treturn;\r\n+\t\t}\r\n+\t\t\r\n+\t\tfor (LivingEntity entity : entities) {\r\n+\t\t\tTownBlock townBlock = TownyAPI.getInstance().getTownBlock(entity.getLocation());\r\n+\t\t\tif (CombatUtil.preventPvP(townyWorld, townBlock)) {\r\n+\t\t\t\tevent.setCancelled(true);\r", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b6942303fa1c2ef69d023fa57d7465ac4d4d0491"}, "originalPosition": 57}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NjEyODM0Nw==", "bodyText": "Yeah, not all entities might be immune from the cloud though, some could be in a PVP-enabled area.", "url": "https://github.com/TownyAdvanced/Towny/pull/4345#discussion_r496128347", "createdAt": "2020-09-28T17:48:02Z", "author": {"login": "LlmDl"}, "path": "src/com/palmergames/bukkit/towny/listeners/TownyEntityListener.java", "diffHunk": "@@ -375,6 +378,39 @@ public void onEntityDamageByEntityEvent(EntityDamageByEntityEvent event) {\n \t\t\t\r\n \t}\r\n \r\n+\t/**\r\n+\t * Handles dragon fireball's cloud damage to players.\r\n+\t * \r\n+\t * @param event AreaEffectCloudApplyEvent\r\n+\t */\r\n+\t@EventHandler(priority = EventPriority.HIGH, ignoreCancelled = true)\r\n+\tpublic void onDragonFireBallCloudDamage(AreaEffectCloudApplyEvent event) {\r\n+\t\tif (!TownyAPI.getInstance().isTownyWorld(event.getEntity().getWorld()))\r\n+\t\t\treturn;\r\n+\t\t\r\n+\t\tif (!event.getEntity().getBasePotionData().getType().equals(PotionType.UNCRAFTABLE))\r\n+\t\t\treturn;\r\n+\r\n+\t\tif (!(event.getEntity().getSource() instanceof Player) || !(event.getEntity().getSource() instanceof DragonFireball))\r\n+\t\t\treturn;\r\n+\r\n+\t\tList<LivingEntity> entities = event.getAffectedEntities();\r\n+\r\n+\t\tTownyWorld townyWorld = null;\r\n+\t\ttry {\r\n+\t\t\ttownyWorld = TownyUniverse.getInstance().getDataSource().getWorld(event.getEntity().getWorld().getName());\r\n+\t\t} catch (NotRegisteredException e) {\r\n+\t\t\t// Failed to fetch a world\r\n+\t\t\treturn;\r\n+\t\t}\r\n+\t\t\r\n+\t\tfor (LivingEntity entity : entities) {\r\n+\t\t\tTownBlock townBlock = TownyAPI.getInstance().getTownBlock(entity.getLocation());\r\n+\t\t\tif (CombatUtil.preventPvP(townyWorld, townBlock)) {\r\n+\t\t\t\tevent.setCancelled(true);\r", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NjExMDM5Nw=="}, "originalCommit": {"oid": "b6942303fa1c2ef69d023fa57d7465ac4d4d0491"}, "originalPosition": 57}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1223, "cost": 1, "resetAt": "2021-11-13T14:23:39Z"}}}