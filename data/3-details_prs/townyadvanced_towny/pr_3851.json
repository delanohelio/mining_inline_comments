{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0Mzk1OTg2NzY0", "number": 3851, "title": "make reload more specific", "bodyText": "Description:\n\nReload now is done by:\n/ta reload <database|perms|config|lang|all>\nLanguage files are included.\n\n\n I have tested this pull request for defects on a server.\n\n\nBy making this pull request, I represent that I have the right to waive copyright and related rights to my contribution, and agree that all copyright and related rights in my contributions are waived, and I acknowledge that the TownyAdvanced organization has the copyright to use and modify my contribution under the Towny License for perpetuity.", "createdAt": "2020-03-31T00:34:26Z", "url": "https://github.com/TownyAdvanced/Towny/pull/3851", "merged": true, "mergeCommit": {"oid": "dcfe5b05edc5595cbabc160de709483b6fb1e7e6"}, "closed": true, "closedAt": "2020-04-02T17:28:12Z", "author": null, "timelineItems": {"totalCount": 13, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcS3_S7AH2gAyMzk1OTg2NzY0OjZkZDMyMjlhZWNiNTk5NmFlNjFiY2IxMjYyMGE5ZjBlMDlmNjY0MTk=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcTvjglAH2gAyMzk1OTg2NzY0OmI0M2UyNzA1MTA5MTdhNDE3NTY1MzVhMWM1ODliNmI1YmMzNzM0YjI=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "6dd3229aecb5996ae61bcb12620a9f0e09f66419", "author": {"user": null}, "url": "https://github.com/TownyAdvanced/Towny/commit/6dd3229aecb5996ae61bcb12620a9f0e09f66419", "committedDate": "2020-03-31T00:30:38Z", "message": "make reload more versatile."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "64f43bd526cdc03837c529dee42de00fb9b5911f", "author": {"user": null}, "url": "https://github.com/TownyAdvanced/Towny/commit/64f43bd526cdc03837c529dee42de00fb9b5911f", "committedDate": "2020-03-31T00:32:29Z", "message": "add lang label"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzg0MzM5MTg2", "url": "https://github.com/TownyAdvanced/Towny/pull/3851#pullrequestreview-384339186", "createdAt": "2020-03-31T01:15:33Z", "commit": {"oid": "64f43bd526cdc03837c529dee42de00fb9b5911f"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 6, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0zMVQwMToxNTozNFrOF-B2Rg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0zMVQwMToyMjowOVrOF-B8yw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMDU4NjMxMA==", "bodyText": "Should be Whether or not to reset the config.yml.", "url": "https://github.com/TownyAdvanced/Towny/pull/3851#discussion_r400586310", "createdAt": "2020-03-31T01:15:34Z", "author": {"login": "LlmDl"}, "path": "src/com/palmergames/bukkit/towny/command/TownyAdminCommand.java", "diffHunk": "@@ -1444,24 +1471,61 @@ public String nextNpcName() throws TownyException {\n \t\t\t\tthrow new TownyException(TownySettings.getLangString(\"msg_err_too_many_npc\"));\r\n \t\t} while (true);\r\n \t}\r\n+\t\r\n+\tpublic void reloadLangs() {\r\n+\t\tString rootFolder = TownyUniverse.getInstance().getRootFolder();\r\n+\t\ttry {\r\n+\t\t\tTownySettings.loadLanguage(rootFolder + File.separator + \"settings\", \"english.yml\");\r\n+\t\t} catch (IOException e) {\r\n+\t\t\tTownyMessaging.sendErrorMsg(sender, TownySettings.getLangString(\"msg_reload_error\"));\r\n+\t\t\te.printStackTrace();\r\n+\t\t}\r\n+\t\t\r\n+\t\tTownyMessaging.sendMsg(sender, TownySettings.getLangString(\"msg_reloaded_lang\"));\r\n+\t}\r\n+\t\r\n+\tpublic void reloadPerms() {\r\n+\t\tString rootFolder = TownyUniverse.getInstance().getRootFolder();\r\n+\t\tTownyPerms.loadPerms(rootFolder + File.separator + \"settings\", \"townyperms.yml\");\r\n+\t\tTownyMessaging.sendMsg(sender, TownySettings.getLangString(\"msg_reloaded_perms\"));\r\n+\t}\r\n \r\n-\tpublic void reloadTowny(Boolean reset) {\r\n+\t/**\r\n+\t * Reloads only the config\r\n+\t */\r\n+\tpublic void reloadConfig() {\r\n+\t\ttry {\r\n+\t\t\tString rootFolder = TownyUniverse.getInstance().getRootFolder();\r\n+\t\t\tTownySettings.loadConfig(rootFolder + File.separator + \"settings\" + File.separator + \"config.yml\", plugin.getVersion());\r\n+\t\t} catch (IOException e) {\r\n+\t\t\tTownyMessaging.sendErrorMsg(sender, TownySettings.getLangString(\"msg_reload_error\"));\r\n+\t\t\te.printStackTrace();\r\n+\t\t\treturn;\r\n+\t\t}\r\n+\t\t\r\n+\t\tTownyMessaging.sendMsg(sender, TownySettings.getLangString(\"msg_reloaded_config\"));\r\n+\t}\r\n \r\n+\t/**\r\n+\t * Reloads both the database and the config. Used with a database reload command.\r\n+\t * \r\n+\t * @param reset Whether or not to reset the database.\r", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "64f43bd526cdc03837c529dee42de00fb9b5911f"}, "originalPosition": 101}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMDU4NjQ2Mw==", "bodyText": "Should have a second language string saying the config.yml was reset to default.", "url": "https://github.com/TownyAdvanced/Towny/pull/3851#discussion_r400586463", "createdAt": "2020-03-31T01:16:14Z", "author": {"login": "LlmDl"}, "path": "src/com/palmergames/bukkit/towny/command/TownyAdminCommand.java", "diffHunk": "@@ -1444,24 +1471,61 @@ public String nextNpcName() throws TownyException {\n \t\t\t\tthrow new TownyException(TownySettings.getLangString(\"msg_err_too_many_npc\"));\r\n \t\t} while (true);\r\n \t}\r\n+\t\r\n+\tpublic void reloadLangs() {\r\n+\t\tString rootFolder = TownyUniverse.getInstance().getRootFolder();\r\n+\t\ttry {\r\n+\t\t\tTownySettings.loadLanguage(rootFolder + File.separator + \"settings\", \"english.yml\");\r\n+\t\t} catch (IOException e) {\r\n+\t\t\tTownyMessaging.sendErrorMsg(sender, TownySettings.getLangString(\"msg_reload_error\"));\r\n+\t\t\te.printStackTrace();\r\n+\t\t}\r\n+\t\t\r\n+\t\tTownyMessaging.sendMsg(sender, TownySettings.getLangString(\"msg_reloaded_lang\"));\r\n+\t}\r\n+\t\r\n+\tpublic void reloadPerms() {\r\n+\t\tString rootFolder = TownyUniverse.getInstance().getRootFolder();\r\n+\t\tTownyPerms.loadPerms(rootFolder + File.separator + \"settings\", \"townyperms.yml\");\r\n+\t\tTownyMessaging.sendMsg(sender, TownySettings.getLangString(\"msg_reloaded_perms\"));\r\n+\t}\r\n \r\n-\tpublic void reloadTowny(Boolean reset) {\r\n+\t/**\r\n+\t * Reloads only the config\r\n+\t */\r\n+\tpublic void reloadConfig() {\r\n+\t\ttry {\r\n+\t\t\tString rootFolder = TownyUniverse.getInstance().getRootFolder();\r\n+\t\t\tTownySettings.loadConfig(rootFolder + File.separator + \"settings\" + File.separator + \"config.yml\", plugin.getVersion());\r\n+\t\t} catch (IOException e) {\r\n+\t\t\tTownyMessaging.sendErrorMsg(sender, TownySettings.getLangString(\"msg_reload_error\"));\r\n+\t\t\te.printStackTrace();\r\n+\t\t\treturn;\r\n+\t\t}\r\n+\t\t\r\n+\t\tTownyMessaging.sendMsg(sender, TownySettings.getLangString(\"msg_reloaded_config\"));\r\n+\t}\r\n \r\n+\t/**\r\n+\t * Reloads both the database and the config. Used with a database reload command.\r\n+\t * \r\n+\t * @param reset Whether or not to reset the database.\r\n+\t */\r\n+\tpublic void reloadDatabase(Boolean reset) {\r\n \t\tif (reset) {\r\n \t\t\tTownyUniverse.getInstance().getDataSource().deleteFile(plugin.getConfigPath());\r\n \t\t}\r\n \t\tif (plugin.load()) {\r\n-\t\t\t\r\n+\r\n \t\t\t// Register all child permissions for ranks\r\n \t\t\tTownyPerms.registerPermissionNodes();\r\n-\t\t\t\r\n+\r\n \t\t\t// Update permissions for all online players\r\n \t\t\tTownyPerms.updateOnlinePerms();\r\n-\t\t\t\r\n+\r\n \t\t}\r\n \r\n-\t\tTownyMessaging.sendMsg(sender, TownySettings.getLangString(\"msg_reloaded\"));\r\n-\t\t// TownyMessaging.sendMsg(TownySettings.getLangString(\"msg_reloaded\"));\r\n+\t\tTownyMessaging.sendMsg(sender, TownySettings.getLangString(\"msg_reloaded_db\"));\r", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "64f43bd526cdc03837c529dee42de00fb9b5911f"}, "originalPosition": 122}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMDU4NjY2Mw==", "bodyText": "I'd add an alias for townyperms as well here.", "url": "https://github.com/TownyAdvanced/Towny/pull/3851#discussion_r400586663", "createdAt": "2020-03-31T01:17:05Z", "author": {"login": "LlmDl"}, "path": "src/com/palmergames/bukkit/towny/command/TownyAdminCommand.java", "diffHunk": "@@ -237,6 +238,9 @@ public boolean onCommand(CommandSender sender, Command cmd, String commandLabel,\n \tpublic List<String> onTabComplete(CommandSender sender, Command command, String alias, String[] args) {\r\n \t\t\r\n \t\tswitch (args[0].toLowerCase()) {\r\n+\t\t\tcase \"reload\":\r\n+\t\t\t\tif (args.length > 1)\r\n+\t\t\t\t\treturn NameUtil.filterByStart(Arrays.asList(\"database\", \"db\", \"config\", \"perms\", \"permissions\", \"language\", \"lang\"), args[1]);\r", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "64f43bd526cdc03837c529dee42de00fb9b5911f"}, "originalPosition": 14}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMDU4NzE3OQ==", "bodyText": "The subcommands should be broken down into 5 options, one subcommand per line the fourth \"\" is actually meant for translatable help descriptions explaining what each does. Add on an \"all\" option.", "url": "https://github.com/TownyAdvanced/Towny/pull/3851#discussion_r400587179", "createdAt": "2020-03-31T01:18:53Z", "author": {"login": "LlmDl"}, "path": "src/com/palmergames/bukkit/towny/command/TownyAdminCommand.java", "diffHunk": "@@ -455,12 +459,35 @@ public boolean parseTownyAdminCommand(String[] split) throws TownyException {\n \t\t\t\tgiveBonus(StringMgmt.remFirstArg(split));\r\n \r\n \t\t\t} else if (split[0].equalsIgnoreCase(\"reload\")) {\r\n-\r\n-\t\t\t\treloadTowny(false);\r\n-\r\n+\t\t\t\tif (split.length == 2) {\r\n+\t\t\t\t\tswitch (split[1]) {\r\n+\t\t\t\t\t\tcase \"db\":\r\n+\t\t\t\t\t\tcase \"database\":\r\n+\t\t\t\t\t\t\treloadDatabase(false);\r\n+\t\t\t\t\t\t\tbreak;\r\n+\t\t\t\t\t\tcase \"config\":\r\n+\t\t\t\t\t\t\treloadConfig();\r\n+\t\t\t\t\t\t\tbreak;\r\n+\t\t\t\t\t\tcase \"perms\":\r\n+\t\t\t\t\t\tcase \"permissions\":\r\n+\t\t\t\t\t\t\treloadPerms();\r\n+\t\t\t\t\t\t\tbreak;\r\n+\t\t\t\t\t\tcase \"language\":\r\n+\t\t\t\t\t\tcase \"lang\":\r\n+\t\t\t\t\t\t\treloadLangs();\r\n+\t\t\t\t\t\t\tbreak;\r\n+\t\t\t\t\t\tdefault:\r\n+\t\t\t\t\t\t\tplayer.sendMessage(ChatTools.formatTitle(\"/ta reload\"));\r\n+\t\t\t\t\t\t\tplayer.sendMessage(ChatTools.formatCommand(\"\", \"/ta reload\", \"<database|config|perms|lang>\", \"\"));\r\n+\t\t\t\t\t}\r\n+\t\t\t\t} else {\r\n+\t\t\t\t\tplayer.sendMessage(ChatTools.formatTitle(\"/ta reload\"));\r\n+\t\t\t\t\tplayer.sendMessage(ChatTools.formatCommand(\"\", \"/ta reload\", \"<database|config|perms|lang>\", \"\"));\r", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "64f43bd526cdc03837c529dee42de00fb9b5911f"}, "originalPosition": 48}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMDU4NzM1MQ==", "bodyText": "Switch needs an \"all\" option for reloading everything all at once.", "url": "https://github.com/TownyAdvanced/Towny/pull/3851#discussion_r400587351", "createdAt": "2020-03-31T01:19:31Z", "author": {"login": "LlmDl"}, "path": "src/com/palmergames/bukkit/towny/command/TownyAdminCommand.java", "diffHunk": "@@ -455,12 +459,35 @@ public boolean parseTownyAdminCommand(String[] split) throws TownyException {\n \t\t\t\tgiveBonus(StringMgmt.remFirstArg(split));\r\n \r\n \t\t\t} else if (split[0].equalsIgnoreCase(\"reload\")) {\r\n-\r\n-\t\t\t\treloadTowny(false);\r\n-\r\n+\t\t\t\tif (split.length == 2) {\r\n+\t\t\t\t\tswitch (split[1]) {\r", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "64f43bd526cdc03837c529dee42de00fb9b5911f"}, "originalPosition": 26}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMDU4Nzk3OQ==", "bodyText": "Reset is supposed to only reset the config.", "url": "https://github.com/TownyAdvanced/Towny/pull/3851#discussion_r400587979", "createdAt": "2020-03-31T01:22:09Z", "author": {"login": "LlmDl"}, "path": "src/com/palmergames/bukkit/towny/command/TownyAdminCommand.java", "diffHunk": "@@ -455,12 +459,35 @@ public boolean parseTownyAdminCommand(String[] split) throws TownyException {\n \t\t\t\tgiveBonus(StringMgmt.remFirstArg(split));\r\n \r\n \t\t\t} else if (split[0].equalsIgnoreCase(\"reload\")) {\r\n-\r\n-\t\t\t\treloadTowny(false);\r\n-\r\n+\t\t\t\tif (split.length == 2) {\r\n+\t\t\t\t\tswitch (split[1]) {\r\n+\t\t\t\t\t\tcase \"db\":\r\n+\t\t\t\t\t\tcase \"database\":\r\n+\t\t\t\t\t\t\treloadDatabase(false);\r\n+\t\t\t\t\t\t\tbreak;\r\n+\t\t\t\t\t\tcase \"config\":\r\n+\t\t\t\t\t\t\treloadConfig();\r\n+\t\t\t\t\t\t\tbreak;\r\n+\t\t\t\t\t\tcase \"perms\":\r\n+\t\t\t\t\t\tcase \"permissions\":\r\n+\t\t\t\t\t\t\treloadPerms();\r\n+\t\t\t\t\t\t\tbreak;\r\n+\t\t\t\t\t\tcase \"language\":\r\n+\t\t\t\t\t\tcase \"lang\":\r\n+\t\t\t\t\t\t\treloadLangs();\r\n+\t\t\t\t\t\t\tbreak;\r\n+\t\t\t\t\t\tdefault:\r\n+\t\t\t\t\t\t\tplayer.sendMessage(ChatTools.formatTitle(\"/ta reload\"));\r\n+\t\t\t\t\t\t\tplayer.sendMessage(ChatTools.formatCommand(\"\", \"/ta reload\", \"<database|config|perms|lang>\", \"\"));\r\n+\t\t\t\t\t}\r\n+\t\t\t\t} else {\r\n+\t\t\t\t\tplayer.sendMessage(ChatTools.formatTitle(\"/ta reload\"));\r\n+\t\t\t\t\tplayer.sendMessage(ChatTools.formatCommand(\"\", \"/ta reload\", \"<database|config|perms|lang>\", \"\"));\r\n+\t\t\t\t\treturn false;\r\n+\t\t\t\t}\r\n \t\t\t} else if (split[0].equalsIgnoreCase(\"reset\")) {\r\n \r\n-\t\t\t\treloadTowny(true);\r\n+\t\t\t\treloadDatabase(true);\r", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "64f43bd526cdc03837c529dee42de00fb9b5911f"}, "originalPosition": 54}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "3931a20a04e12937c6729bff000df4ff07d10932", "author": {"user": null}, "url": "https://github.com/TownyAdvanced/Towny/commit/3931a20a04e12937c6729bff000df4ff07d10932", "committedDate": "2020-03-31T01:42:36Z", "message": "Fixed formatting and added \"all\" subcommand."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b50c232411f1a59f116462716f5202e8865978c5", "author": {"user": null}, "url": "https://github.com/TownyAdvanced/Towny/commit/b50c232411f1a59f116462716f5202e8865978c5", "committedDate": "2020-03-31T01:43:07Z", "message": "Merge branch 'master' into refactor/reload"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "3d5df7c35ad3f1ba299200d3100c9007c9f71786", "author": {"user": null}, "url": "https://github.com/TownyAdvanced/Towny/commit/3d5df7c35ad3f1ba299200d3100c9007c9f71786", "committedDate": "2020-03-31T01:45:22Z", "message": "fix typo"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e1bec5d10e49f4ea92eb59f35c4deefc39bef11e", "author": {"user": null}, "url": "https://github.com/TownyAdvanced/Towny/commit/e1bec5d10e49f4ea92eb59f35c4deefc39bef11e", "committedDate": "2020-03-31T01:46:49Z", "message": "add \"all\" autocomplete."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzg0NDk2OTA4", "url": "https://github.com/TownyAdvanced/Towny/pull/3851#pullrequestreview-384496908", "createdAt": "2020-03-31T08:12:23Z", "commit": {"oid": "e1bec5d10e49f4ea92eb59f35c4deefc39bef11e"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzg1MDEwMzgx", "url": "https://github.com/TownyAdvanced/Towny/pull/3851#pullrequestreview-385010381", "createdAt": "2020-03-31T18:47:51Z", "commit": {"oid": "e1bec5d10e49f4ea92eb59f35c4deefc39bef11e"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c6bac2a6d4c83edc1d89b470bc7faf4c1faf05d7", "author": {"user": null}, "url": "https://github.com/TownyAdvanced/Towny/commit/c6bac2a6d4c83edc1d89b470bc7faf4c1faf05d7", "committedDate": "2020-03-31T20:09:42Z", "message": "Fix some errors, and make lang load with config."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "1b28ebcd466d9b4b372c7e0b4b49fa33d914091b", "author": {"user": null}, "url": "https://github.com/TownyAdvanced/Towny/commit/1b28ebcd466d9b4b372c7e0b4b49fa33d914091b", "committedDate": "2020-03-31T20:37:08Z", "message": "remove some redundancy"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzg1MDkyNzA4", "url": "https://github.com/TownyAdvanced/Towny/pull/3851#pullrequestreview-385092708", "createdAt": "2020-03-31T20:48:11Z", "commit": {"oid": "1b28ebcd466d9b4b372c7e0b4b49fa33d914091b"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b43e270510917a41756535a1c589b6b5bc3734b2", "author": {"user": null}, "url": "https://github.com/TownyAdvanced/Towny/commit/b43e270510917a41756535a1c589b6b5bc3734b2", "committedDate": "2020-04-02T17:14:58Z", "message": "Merge branch 'master' into refactor/reload\n\n# Conflicts:\n#\tresources/pt-br.yml"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4256, "cost": 1, "resetAt": "2021-11-01T16:37:27Z"}}}