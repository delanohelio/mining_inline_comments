{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTE3MDMyMDkz", "number": 4420, "reviewThreads": {"totalCount": 5, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xNVQwMTo0NToyMlrOE5ET9w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xNVQwNTo1MjoxOVrOE5IanA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzI4Mjc0OTM1OnYy", "diffSide": "RIGHT", "path": "src/com/palmergames/bukkit/towny/event/actions/TownyExplosionDamagesEntityEvent.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xNVQwMTo0NToyMlrOHzVtVw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xNVQwMTo0NToyMlrOHzVtVw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMzU5NTA5NQ==", "bodyText": "I feel like canExplode should be renamed because it's actual value dictates whether the event is cancelled, so it's really more can't explode than can. Either that or the value should be inverted so canExplode returns false if the event should be cancelled.", "url": "https://github.com/TownyAdvanced/Towny/pull/4420#discussion_r523595095", "createdAt": "2020-11-15T01:45:22Z", "author": {"login": "silverwolfg11"}, "path": "src/com/palmergames/bukkit/towny/event/actions/TownyExplosionDamagesEntityEvent.java", "diffHunk": "@@ -0,0 +1,91 @@\n+package com.palmergames.bukkit.towny.event.actions;\r\n+\r\n+import org.bukkit.Location;\r\n+import org.bukkit.entity.Entity;\r\n+import org.bukkit.event.Cancellable;\r\n+import org.bukkit.event.Event;\r\n+import org.bukkit.event.HandlerList;\r\n+import org.bukkit.event.entity.EntityDamageEvent.DamageCause;\r\n+\r\n+/**\r\n+ * Part of the API which lets Towny's war and other plugins modify Towny's\r\n+ * plot-permission-decision outcomes.\r\n+ * \r\n+ * TownyExplosionDamagesEntityEvents are thrown when an explosion \r\n+ * occurs in a Towny world, causing damage to an entity.\r\n+ * \r\n+ * <br> - When an entity explosion, block explosion or lightning damages an entity.\r\n+ * <br> - When an explosion would damage a Hanging entity.\r\n+ * <br> - When a pig is zapped by lightning.\r\n+ * <br> - When an explosion would damage a Vehicle.\r\n+ * \r\n+ * @param location - Location of the entity being damaged.\r\n+ * @param entity - Entity getting exploded.\r\n+ * @param cause - DamageCause.\r\n+ * @param canExplode - Whether Towny will cancel this already.\r\n+ * \r\n+ * @author LlmDl\r\n+ */\r\n+public class TownyExplosionDamagesEntityEvent extends Event implements Cancellable {\r\n+\r\n+\tprivate static final HandlerList handlers = new HandlerList();\r\n+\tprivate final Location location;\r\n+\tprivate final Entity entity;\r\n+\tprivate final DamageCause cause;\r\n+\tprivate boolean canExplode;\r\n+\r\n+\t/**\r\n+\t * Event thrown when an explosion damages an entity. \r\n+\t * Use ignorecancelled = true in order to filter out explosions Towny will already have stopped.\r\n+\t * \r\n+\t * @param location - Location of the entity being damaged.\r\n+\t * @param harmedEntity - Entity getting exploded.\r\n+\t * @param cause - DamageCause.\r\n+\t * @param canExplode - Whether Towny will cancel this already.\r", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "6cff46713fe5d48676356e1ea041fff89663698f"}, "originalPosition": 44}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzI4Mjc2MTU1OnYy", "diffSide": "RIGHT", "path": "src/com/palmergames/bukkit/towny/event/executors/TownyActionEventExecutor.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xNVQwMTo0NzoxM1rOHzV2ng==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xNVQwMTo0NzoxM1rOHzV2ng==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMzU5NzQ3MA==", "bodyText": "This should be an else if otherwise if isExpl is off, then it will override isForceExpl", "url": "https://github.com/TownyAdvanced/Towny/pull/4420#discussion_r523597470", "createdAt": "2020-11-15T01:47:13Z", "author": {"login": "silverwolfg11"}, "path": "src/com/palmergames/bukkit/towny/event/executors/TownyActionEventExecutor.java", "diffHunk": "@@ -66,6 +77,50 @@ private static boolean isAllowedAction(Player player, Location loc, Material mat\n \r\n \t\treturn !event.isCancelled();\r\n \t}\r\n+\t\r\n+\t/**\r\n+\t * Towny's primary internal test to determine if something can explode\r\n+\t * at the given location, based on Towny's plot permissions.\r\n+\t * \r\n+\t * @param loc - Location being tested.\r\n+\t * @return true if the explosion is allowed.\r\n+\t */\r\n+\tprivate static boolean isAllowedExplosion(Location loc) {\r\n+\t\tboolean canExplode = false;\r\n+\t\tTownyWorld world = TownyAPI.getInstance().getTownyWorld(loc.getWorld().getName());\r\n+\t\tif (world == null)\r\n+\t\t\tcanExplode = false;\r\n+\t\telse {\r\n+\t\t\r\n+\t\t\tif (TownyAPI.getInstance().isWilderness(loc)) {\r\n+\t\t\t\t/*\r\n+\t\t\t\t * Handle occasions in the wilderness first.\r\n+\t\t\t\t */\r\n+\t\t\t\tif (world.isForceExpl() || world.isExpl())\r\n+\t\t\t\t\tcanExplode = true;\r\n+\t\t\t\tif (!world.isExpl())\r", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "6cff46713fe5d48676356e1ea041fff89663698f"}, "originalPosition": 56}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzI4Mjc3MTE2OnYy", "diffSide": "RIGHT", "path": "src/com/palmergames/bukkit/towny/event/executors/TownyActionEventExecutor.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xNVQwMTo0ODo1MFrOHzV9yA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xNVQwMjo1MToyOVrOHzaQrQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMzU5OTMwNA==", "bodyText": "If town explosions are enabled, do all townblocks in the town force toggle the explosion perm for the townblock?", "url": "https://github.com/TownyAdvanced/Towny/pull/4420#discussion_r523599304", "createdAt": "2020-11-15T01:48:50Z", "author": {"login": "silverwolfg11"}, "path": "src/com/palmergames/bukkit/towny/event/executors/TownyActionEventExecutor.java", "diffHunk": "@@ -66,6 +77,50 @@ private static boolean isAllowedAction(Player player, Location loc, Material mat\n \r\n \t\treturn !event.isCancelled();\r\n \t}\r\n+\t\r\n+\t/**\r\n+\t * Towny's primary internal test to determine if something can explode\r\n+\t * at the given location, based on Towny's plot permissions.\r\n+\t * \r\n+\t * @param loc - Location being tested.\r\n+\t * @return true if the explosion is allowed.\r\n+\t */\r\n+\tprivate static boolean isAllowedExplosion(Location loc) {\r\n+\t\tboolean canExplode = false;\r\n+\t\tTownyWorld world = TownyAPI.getInstance().getTownyWorld(loc.getWorld().getName());\r\n+\t\tif (world == null)\r\n+\t\t\tcanExplode = false;\r\n+\t\telse {\r\n+\t\t\r\n+\t\t\tif (TownyAPI.getInstance().isWilderness(loc)) {\r\n+\t\t\t\t/*\r\n+\t\t\t\t * Handle occasions in the wilderness first.\r\n+\t\t\t\t */\r\n+\t\t\t\tif (world.isForceExpl() || world.isExpl())\r\n+\t\t\t\t\tcanExplode = true;\r\n+\t\t\t\tif (!world.isExpl())\r\n+\t\t\t\t\tcanExplode = false;\t\t\t\r\n+\t\t\t} else {\r\n+\t\t\t\t/*\r\n+\t\t\t\t * Must be inside of a town.\r\n+\t\t\t\t */\r\n+\t\t\t\tcanExplode = TownyAPI.getInstance().getTownBlock(loc).getPermissions().explosion;\t\t\t\r", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "6cff46713fe5d48676356e1ea041fff89663698f"}, "originalPosition": 62}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMzY2OTY3Nw==", "bodyText": "Town explosions enabling should enable them on all non-changed townblocks. So it will be a per-plot setting.", "url": "https://github.com/TownyAdvanced/Towny/pull/4420#discussion_r523669677", "createdAt": "2020-11-15T02:51:29Z", "author": {"login": "LlmDl"}, "path": "src/com/palmergames/bukkit/towny/event/executors/TownyActionEventExecutor.java", "diffHunk": "@@ -66,6 +77,50 @@ private static boolean isAllowedAction(Player player, Location loc, Material mat\n \r\n \t\treturn !event.isCancelled();\r\n \t}\r\n+\t\r\n+\t/**\r\n+\t * Towny's primary internal test to determine if something can explode\r\n+\t * at the given location, based on Towny's plot permissions.\r\n+\t * \r\n+\t * @param loc - Location being tested.\r\n+\t * @return true if the explosion is allowed.\r\n+\t */\r\n+\tprivate static boolean isAllowedExplosion(Location loc) {\r\n+\t\tboolean canExplode = false;\r\n+\t\tTownyWorld world = TownyAPI.getInstance().getTownyWorld(loc.getWorld().getName());\r\n+\t\tif (world == null)\r\n+\t\t\tcanExplode = false;\r\n+\t\telse {\r\n+\t\t\r\n+\t\t\tif (TownyAPI.getInstance().isWilderness(loc)) {\r\n+\t\t\t\t/*\r\n+\t\t\t\t * Handle occasions in the wilderness first.\r\n+\t\t\t\t */\r\n+\t\t\t\tif (world.isForceExpl() || world.isExpl())\r\n+\t\t\t\t\tcanExplode = true;\r\n+\t\t\t\tif (!world.isExpl())\r\n+\t\t\t\t\tcanExplode = false;\t\t\t\r\n+\t\t\t} else {\r\n+\t\t\t\t/*\r\n+\t\t\t\t * Must be inside of a town.\r\n+\t\t\t\t */\r\n+\t\t\t\tcanExplode = TownyAPI.getInstance().getTownBlock(loc).getPermissions().explosion;\t\t\t\r", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMzU5OTMwNA=="}, "originalCommit": {"oid": "6cff46713fe5d48676356e1ea041fff89663698f"}, "originalPosition": 62}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzI4MjgxMzc1OnYy", "diffSide": "RIGHT", "path": "src/com/palmergames/bukkit/towny/event/actions/TownyExplodingBlockEvent.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xNVQwMTo1NTozMlrOHzWcgA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xNVQwMTo1NTozMlrOHzWcgA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMzYwNzE2OA==", "bodyText": "Nitpick, but maybe should be called Blocks event instead of Block event since it's more than one block.", "url": "https://github.com/TownyAdvanced/Towny/pull/4420#discussion_r523607168", "createdAt": "2020-11-15T01:55:32Z", "author": {"login": "silverwolfg11"}, "path": "src/com/palmergames/bukkit/towny/event/actions/TownyExplodingBlockEvent.java", "diffHunk": "@@ -0,0 +1,150 @@\n+package com.palmergames.bukkit.towny.event.actions;\r\n+\r\n+import java.util.ArrayList;\r\n+import java.util.List;\r\n+\r\n+import org.bukkit.Material;\r\n+import org.bukkit.block.Block;\r\n+import org.bukkit.entity.Entity;\r\n+import org.bukkit.event.Event;\r\n+import org.bukkit.event.HandlerList;\r\n+import org.jetbrains.annotations.Nullable;\r\n+\r\n+/**\r\n+ * Part of the API which lets Towny's war and other plugins modify Towny's\r\n+ * plot-permission-decision outcomes.\r\n+ * \r\n+ * TownyExplodingBlockEvents are thrown when an explosion occurs \r\n+ * in a Towny world, causing block damage.\r\n+ * \r\n+ * <br> - When a bed/respawn anchor explodes causing block damage.\r\n+ * <br> - When a an entity explodes causing block damage.\r\n+ * \r\n+ * @param vanillaBlockList - List of Blocks which were involved in the original explosion.\r\n+ * @param townyFilteredList - List of Blocks Towny has already filtered, these blocks will explode unless {@link #setBlockList(List)} is used.\r\n+ * @param mat - Material which caused the block explosion or null if it is an entity explosion.\r\n+ * @param entity - Entity which caused the entity explosion or null if it is a block explosion. \r\n+ * \r\n+ * @author LlmDl\r\n+ */\r\n+public class TownyExplodingBlockEvent extends Event {\r\n+\r\n+\tprivate static final HandlerList handlers = new HandlerList();\r\n+\tprivate final List<Block> vanillaBlockList;\r\n+\tprivate final List<Block> filteredBlockList;\r\n+\tprivate final Material material;\r\n+\tprivate final Entity entity;\r\n+\tprivate List<Block> blockList = new ArrayList<Block>();\r\n+\tprivate boolean isChanged = false;\r\n+\r\n+\t/**\r\n+\t * Event thrown when blocks are exploded by a block or entity.\r\n+\t * \r\n+\t * @param vanillaBlockList - List of Blocks which were involved in the original explosion.\r\n+\t * @param townyFilteredList - List of Blocks Towny has already filtered, these blocks will explode unless {@link #setBlockList(List)} is used.\r\n+\t * @param mat - Material which caused the block explosion or null if it is an entity explosion.\r\n+\t * @param entity - Entity which caused the entity explosion or null if it is a block explosion. \r\n+\t */\r\n+\tpublic TownyExplodingBlockEvent(List<Block> vanillaBlockList, List<Block> townyFilteredList, Material mat, Entity entity) {\r", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "6cff46713fe5d48676356e1ea041fff89663698f"}, "originalPosition": 48}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzI4MzQyMTcyOnYy", "diffSide": "RIGHT", "path": "src/com/palmergames/bukkit/towny/event/actions/TownyExplosionDamagesEntityEvent.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xNVQwNTo1MjoxOVrOHzc2KA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xNVQwNTo1MjoxOVrOHzc2KA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMzcxMjA0MA==", "bodyText": "Mismatched paramater", "url": "https://github.com/TownyAdvanced/Towny/pull/4420#discussion_r523712040", "createdAt": "2020-11-15T05:52:19Z", "author": {"login": "silverwolfg11"}, "path": "src/com/palmergames/bukkit/towny/event/actions/TownyExplosionDamagesEntityEvent.java", "diffHunk": "@@ -0,0 +1,91 @@\n+package com.palmergames.bukkit.towny.event.actions;\r\n+\r\n+import org.bukkit.Location;\r\n+import org.bukkit.entity.Entity;\r\n+import org.bukkit.event.Cancellable;\r\n+import org.bukkit.event.Event;\r\n+import org.bukkit.event.HandlerList;\r\n+import org.bukkit.event.entity.EntityDamageEvent.DamageCause;\r\n+\r\n+/**\r\n+ * Part of the API which lets Towny's war and other plugins modify Towny's\r\n+ * plot-permission-decision outcomes.\r\n+ * \r\n+ * TownyExplosionDamagesEntityEvents are thrown when an explosion \r\n+ * occurs in a Towny world, causing damage to an entity.\r\n+ * \r\n+ * <br> - When an entity explosion, block explosion or lightning damages an entity.\r\n+ * <br> - When an explosion would damage a Hanging entity.\r\n+ * <br> - When a pig is zapped by lightning.\r\n+ * <br> - When an explosion would damage a Vehicle.\r\n+ * \r\n+ * @param location - Location of the entity being damaged.\r\n+ * @param entity - Entity getting exploded.\r\n+ * @param cause - DamageCause.\r\n+ * @param canExplode - Whether Towny will cancel this already.\r", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "27422350c8573a4839f25da19ca5e79acaad0f44"}, "originalPosition": 25}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1232, "cost": 1, "resetAt": "2021-11-13T14:23:39Z"}}}