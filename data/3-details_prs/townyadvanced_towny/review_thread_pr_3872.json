{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0Mzk4NDYxNzEw", "number": 3872, "reviewThreads": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wNFQxMToxNTowMVrODurmzg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wNFQxMToxNTowMVrODurmzg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjUwMjc1NTM0OnYy", "diffSide": "RIGHT", "path": "src/com/palmergames/bukkit/towny/utils/SpawnUtil.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wNFQxMToxNTowMVrOGAxIVQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wNFQxMToxNTowMVrOGAxIVQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMzQ1ODEzMw==", "bodyText": "This still doesn't work when the player is going to an outpost.", "url": "https://github.com/TownyAdvanced/Towny/pull/3872#discussion_r403458133", "createdAt": "2020-04-04T11:15:01Z", "author": {"login": "LlmDl"}, "path": "src/com/palmergames/bukkit/towny/utils/SpawnUtil.java", "diffHunk": "@@ -349,40 +351,72 @@ else if (town != null)\n \t\t\t}\r\n \t\t}\r\n \t\t\r\n-\t\t// Used later to make sure the chunk we teleport to is loaded.\r\n-\t\tCompletableFuture<Chunk> chunkFuture = PaperLib.getChunkAtAsync(spawnLoc);\r\n-\t\t\r\n-\t\t// Legacy code (non-paper sync)\r\n-\t\t//Chunk chunk = spawnLoc.getChunk();\r\n+\t\tif (!sendSpawnEvent(player, spawnType, townyObject)) {\r\n+\t\t\treturn;\r\n+\t\t}\r\n \r\n-\t\tLocation finalSpawnLoc = spawnLoc;\r\n-\t\tchunkFuture.thenAccept((chunk -> {\r\n-\t\t\t// If an Admin or Essentials teleport isn't being used, use our own.\r\n-\t\t\tif (isTownyAdmin) {\r\n-\t\t\t\tif (player.getVehicle() != null)\r\n-\t\t\t\t\tplayer.getVehicle().eject();\r\n-\t\t\t\tplayer.teleport(finalSpawnLoc, TeleportCause.COMMAND);\r\n-\t\t\t\treturn;\r\n-\t\t\t}\r\n+\t\t// If an Admin or Essentials teleport isn't being used, use our own.\r\n+\t\tif (isTownyAdmin) {\r\n+\t\t\tif (player.getVehicle() != null)\r\n+\t\t\t\tplayer.getVehicle().eject();\r\n+\t\t\tPaperLib.teleportAsync(player, spawnLoc, TeleportCause.COMMAND);\r\n+\t\t\treturn;\r\n+\t\t}\r\n \r\n \t\t\tif (!usingESS) {\r\n \t\t\t\tif (TownyTimerHandler.isTeleportWarmupRunning()) {\r\n \t\t\t\t\t// Use teleport warmup\r\n \t\t\t\t\tplayer.sendMessage(String.format(TownySettings.getLangString(\"msg_town_spawn_warmup\"),\r\n \t\t\t\t\t\tTownySettings.getTeleportWarmupTime()));\r\n-\t\t\t\t\tTownyAPI.getInstance().requestTeleport(player, finalSpawnLoc);\r\n-\t\t\t\t} else {\r\n-\t\t\t\t\t// Don't use teleport warmup\r\n-\t\t\t\t\tif (player.getVehicle() != null)\r\n-\t\t\t\t\t\tplayer.getVehicle().eject();\r\n-\t\t\t\t\tplayer.teleport(finalSpawnLoc, TeleportCause.COMMAND);\r\n-\t\t\t\t\tif (TownySettings.getSpawnCooldownTime() > 0)\r\n-\t\t\t\t\t\tCooldownTimerTask.addCooldownTimer(resident.getName(), CooldownType.TELEPORT);\r\n-\t\t\t\t}\r\n+\t\t\t\tTownyAPI.getInstance().requestTeleport(player, spawnLoc);\r\n+\t\t\t} else {\r\n+\t\t\t\t// Don't use teleport warmup\r\n+\t\t\t\tif (player.getVehicle() != null)\r\n+\t\t\t\t\tplayer.getVehicle().eject();\r\n+\t\t\t\tPaperLib.teleportAsync(player, spawnLoc, TeleportCause.COMMAND);\r\n+\t\t\t\tif (TownySettings.getSpawnCooldownTime() > 0)\r\n+\t\t\t\t\tCooldownTimerTask.addCooldownTimer(resident.getName(), CooldownType.TELEPORT);\r\n \t\t\t}\r\n-\t\t}));\r\n+\t\t}\r\n+\t}\r\n+\t\r\n+\tpublic static boolean sendSpawnEvent(Player player, SpawnType type, TownyObject object) {\r\n+\t\tswitch (type) {\r\n+\t\t\tcase TOWN:\r\n+\t\t\t\tTown town = (Town)object;\r\n+\t\t\t\tLocation to;\r\n+\t\t\t\ttry {\r\n+\t\t\t\t\tto = town.getSpawn();\r", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "16ed583ad2a69fdf847442287a0ef99cee008fd6"}, "originalPosition": 76}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1264, "cost": 1, "resetAt": "2021-11-13T14:23:39Z"}}}