{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDg2MTY4NjA0", "number": 4311, "title": "added a maximum price for claiming town blocks", "bodyText": "I hope this is working. Please forgive me If I\u00b4m doing something wrong...I\u00b4ve never worked with github before\n\nDescription:\nAdded a config value for the maximum price for a town block\n\nNew Nodes/Commands/ConfigOptions:\neconomy.new_expand.max_price_claim_townblock\n\nRelevant Towny Issue ticket:\n\n\n\n I have tested this pull request for defects on a server.\n\n\nBy making this pull request, I represent that I have the right to waive copyright and related rights to my contribution, and agree that all copyright and related rights in my contributions are waived, and I acknowledge that the TownyAdvanced organization has the copyright to use and modify my contribution under the Towny License for perpetuity.", "createdAt": "2020-09-13T11:32:29Z", "url": "https://github.com/TownyAdvanced/Towny/pull/4311", "merged": true, "mergeCommit": {"oid": "f8a6912cf121d9ef07581b5b23bf1f12dc6240d7"}, "closed": true, "closedAt": "2020-09-18T12:05:01Z", "author": {"login": "the-codeboy"}, "timelineItems": {"totalCount": 15, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdIcte3gH2gAyNDg2MTY4NjA0Ojg2NDBmOGY4MGIwZWUzMmZhMDk5NTgzYzIwZTgyOGM2MDU4NDZmNzY=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdJqRp5gFqTQ5MDI1NjEzNA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "8640f8f80b0ee32fa099583c20e828c605846f76", "author": {"user": null}, "url": "https://github.com/TownyAdvanced/Towny/commit/8640f8f80b0ee32fa099583c20e828c605846f76", "committedDate": "2020-09-13T11:15:39Z", "message": "added a maximum price for claiming town blocks\n\nI hope this is working. Please forgive me If I\u00b4m doing something wrong...I\u00b4ve never worked with github before"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "20a83161a57efde22f073ae00e705797d6c2e707", "author": {"user": null}, "url": "https://github.com/TownyAdvanced/Towny/commit/20a83161a57efde22f073ae00e705797d6c2e707", "committedDate": "2020-09-13T11:27:19Z", "message": "added a maximum price for claiming town blocks\n\nI hope this is working. Please forgive me If I\u00b4m doing something wrong...I\u00b4ve never worked with github before"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDg3MzE4MzAw", "url": "https://github.com/TownyAdvanced/Towny/pull/4311#pullrequestreview-487318300", "createdAt": "2020-09-13T15:48:04Z", "commit": {"oid": "20a83161a57efde22f073ae00e705797d6c2e707"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xM1QxNTo0ODowNFrOHQ9ZQA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xM1QxNTo1MjoxNlrOHQ9a_g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NzU0NTE1Mg==", "bodyText": "Please add a \"\", below the \"-1.0\", line so that the new whitespacing is maintained.", "url": "https://github.com/TownyAdvanced/Towny/pull/4311#discussion_r487545152", "createdAt": "2020-09-13T15:48:04Z", "author": {"login": "LlmDl"}, "path": "src/com/palmergames/bukkit/config/ConfigNodes.java", "diffHunk": "@@ -1358,6 +1358,10 @@\n \t\t\t\"economy.new_expand.price_claim_townblock_increase\",\r\n \t\t\t\"1.0\",\r\n \t\t\t\"# How much every additionally claimed townblock increases in cost. Set to 1 to deactivate this. 1.3 means +30% to every bonus claim block cost.\"),\r\n+\tECO_MAX_PRICE_CLAIM_TOWNBLOCK(\r\n+\t\t\t\"economy.new_expand.max_price_claim_townblock\",\r\n+\t\t\t\"-1.0\",\r", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "20a83161a57efde22f073ae00e705797d6c2e707"}, "originalPosition": 6}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NzU0NTU5OA==", "bodyText": "If you could fix the spacing so there are spaces before and after the =, !=, ?, : and so forth, that would make this look like the rest of the code.", "url": "https://github.com/TownyAdvanced/Towny/pull/4311#discussion_r487545598", "createdAt": "2020-09-13T15:52:16Z", "author": {"login": "LlmDl"}, "path": "src/com/palmergames/bukkit/towny/object/Town.java", "diffHunk": "@@ -418,7 +418,9 @@ public double getBonusBlockCost() {\n \t}\n \t\n \tpublic double getTownBlockCost() {\n-\t\treturn (Math.pow(TownySettings.getClaimPriceIncreaseValue(), getTownBlocks().size()) * TownySettings.getClaimPrice());\n+\t\tdouble price=(Math.pow(TownySettings.getClaimPriceIncreaseValue(), getTownBlocks().size()) * TownySettings.getClaimPrice());\n+\t\tdouble maxprice=TownySettings.getMaxClaimPrice();\n+\t\treturn (maxprice!=-1?Math.min(price, maxprice):price);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "20a83161a57efde22f073ae00e705797d6c2e707"}, "originalPosition": 7}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c26c53c8ec82792b076e7869409fd8d656fcded4", "author": {"user": null}, "url": "https://github.com/TownyAdvanced/Towny/commit/c26c53c8ec82792b076e7869409fd8d656fcded4", "committedDate": "2020-09-13T16:04:15Z", "message": "added spaces"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDg3MzE5Nzgw", "url": "https://github.com/TownyAdvanced/Towny/pull/4311#pullrequestreview-487319780", "createdAt": "2020-09-13T16:09:08Z", "commit": {"oid": "c26c53c8ec82792b076e7869409fd8d656fcded4"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDg3MzIxNjA4", "url": "https://github.com/TownyAdvanced/Towny/pull/4311#pullrequestreview-487321608", "createdAt": "2020-09-13T16:32:09Z", "commit": {"oid": "c26c53c8ec82792b076e7869409fd8d656fcded4"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "412d546e56a4cd11b80dbf696fb1ef97180a5f8f", "author": {"user": null}, "url": "https://github.com/TownyAdvanced/Towny/commit/412d546e56a4cd11b80dbf696fb1ef97180a5f8f", "committedDate": "2020-09-13T16:37:26Z", "message": "fixed problem in getTownBlockCostN"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "bed706196c3d8816b213e15b1e246968d5aa1b76", "author": {"user": null}, "url": "https://github.com/TownyAdvanced/Towny/commit/bed706196c3d8816b213e15b1e246968d5aa1b76", "committedDate": "2020-09-13T16:40:20Z", "message": "Update Town.java"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDg3MzIyNDA5", "url": "https://github.com/TownyAdvanced/Towny/pull/4311#pullrequestreview-487322409", "createdAt": "2020-09-13T16:43:40Z", "commit": {"oid": "412d546e56a4cd11b80dbf696fb1ef97180a5f8f"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xM1QxNjo0Mzo0MFrOHQ9vng==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xM1QxNjo0Mzo0MFrOHQ9vng==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NzU1MDg3OA==", "bodyText": "If you could use some { }'s and indent the while I think this will be good to go.", "url": "https://github.com/TownyAdvanced/Towny/pull/4311#discussion_r487550878", "createdAt": "2020-09-13T16:43:40Z", "author": {"login": "LlmDl"}, "path": "src/com/palmergames/bukkit/towny/object/Town.java", "diffHunk": "@@ -434,6 +434,9 @@ public double getTownBlockCostN(int inputN) throws TownyException {\n \t\tdouble nextprice = getTownBlockCost();\n \t\tint i = 1;\n \t\tdouble cost = nextprice;\n+\t\tif(TownySettings.getMaxClaimPrice() != -1)\n+\t\t\tcost *=  inputN;\n+\t\telse ", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "412d546e56a4cd11b80dbf696fb1ef97180a5f8f"}, "originalPosition": 6}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "7ad75d1799e0a89960b9254e5ed922acb55cacdc", "author": {"user": null}, "url": "https://github.com/TownyAdvanced/Towny/commit/7ad75d1799e0a89960b9254e5ed922acb55cacdc", "committedDate": "2020-09-13T18:06:32Z", "message": "Update Town.java"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDg3NjgxMjE0", "url": "https://github.com/TownyAdvanced/Towny/pull/4311#pullrequestreview-487681214", "createdAt": "2020-09-14T12:00:08Z", "commit": {"oid": "7ad75d1799e0a89960b9254e5ed922acb55cacdc"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDg4OTgzMTIx", "url": "https://github.com/TownyAdvanced/Towny/pull/4311#pullrequestreview-488983121", "createdAt": "2020-09-15T19:04:45Z", "commit": {"oid": "7ad75d1799e0a89960b9254e5ed922acb55cacdc"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xNVQxOTowNDo0NVrOHSQKYg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xNVQxOTowNDo0NVrOHSQKYg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4ODkwMTIxOA==", "bodyText": "This change has some logic errors regarding to the max price. Since the conditional is first thing in the loop, that means that the loop will always be checking the previous iteration's value of next price. This provides the opportunity for the previous iteration's nextprice to be above max price and not be adjusted.\nAlso resetting the nextprice to maxprice causes some issues as well because it will fail the conditional since nextprice will be equal to maxprice and not greater than maxprice. That means it will take the else branch and force a recalculation which could be greater than the maxprice.\nThere are quite a few ways to go about fixing this, so it's up to you for whatever approach you want to take. Just make sure to validate that cost will never add a value that is greater than maxprice if it exists.", "url": "https://github.com/TownyAdvanced/Towny/pull/4311#discussion_r488901218", "createdAt": "2020-09-15T19:04:45Z", "author": {"login": "silverwolfg11"}, "path": "src/com/palmergames/bukkit/towny/object/Town.java", "diffHunk": "@@ -432,8 +434,13 @@ public double getTownBlockCostN(int inputN) throws TownyException {\n \t\tdouble nextprice = getTownBlockCost();\n \t\tint i = 1;\n \t\tdouble cost = nextprice;\n+\t\tboolean hasmaxprice = TownySettings.getMaxClaimPrice() != -1;\n+\t\tdouble maxprice = TownySettings.getMaxClaimPrice();\n \t\twhile (i < inputN){\n-\t\t\tnextprice = Math.round(Math.pow(TownySettings.getClaimPriceIncreaseValue() , getTownBlocks().size()+i) * TownySettings.getClaimPrice());\t\t\t\n+\t\t\tif(hasmaxprice && nextprice > maxprice)\n+\t\t\t\tnextprice=maxprice;\n+\t\t\telse\n+\t\t\t\tnextprice = Math.round(Math.pow(TownySettings.getClaimPriceIncreaseValue() , getTownBlocks().size()+i) * TownySettings.getClaimPrice());", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "7ad75d1799e0a89960b9254e5ed922acb55cacdc"}, "originalPosition": 22}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "dd89ca4bf19397578240b215e7e5f5903e351602", "author": {"user": null}, "url": "https://github.com/TownyAdvanced/Towny/commit/dd89ca4bf19397578240b215e7e5f5903e351602", "committedDate": "2020-09-15T20:06:08Z", "message": "Update Town.java"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "8f68dd379bfb422fd61caa538676029b81a1004c", "author": {"user": null}, "url": "https://github.com/TownyAdvanced/Towny/commit/8f68dd379bfb422fd61caa538676029b81a1004c", "committedDate": "2020-09-15T20:09:40Z", "message": "Update Town.java"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDkwMjU2MTM0", "url": "https://github.com/TownyAdvanced/Towny/pull/4311#pullrequestreview-490256134", "createdAt": "2020-09-17T05:37:51Z", "commit": {"oid": "8f68dd379bfb422fd61caa538676029b81a1004c"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4183, "cost": 1, "resetAt": "2021-11-01T16:37:27Z"}}}