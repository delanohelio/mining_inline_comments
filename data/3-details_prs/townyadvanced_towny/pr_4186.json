{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDUyMTkyMTk1", "number": 4186, "title": "Metadata Improvements", "bodyText": "Description:\n\nPreviously it was hard to get a specific customdatafield from the metadata which is often what plugins wanted to do. This PR changes the internal set to a map keyed by the customdatafield key and offers new granular methods to fetch metadata.\nThe customdatafield object was not changed in order to retain legacy compatibility, however I'm like 95% sure this PR will break legacy metadata compatibility because it changes getMetadata() to a collection rather than a set, so oh well.\n\n\n I have tested this pull request for defects on a server.\n\n\nBy making this pull request, I represent that I have the right to waive copyright and related rights to my contribution, and agree that all copyright and related rights in my contributions are waived, and I acknowledge that the TownyAdvanced organization has the copyright to use and modify my contribution under the Towny License for perpetuity.", "createdAt": "2020-07-18T23:02:00Z", "url": "https://github.com/TownyAdvanced/Towny/pull/4186", "merged": true, "mergeCommit": {"oid": "787245cb483d07339c5f970b55448a317e812546"}, "closed": true, "closedAt": "2020-07-23T12:21:30Z", "author": {"login": "silverwolfg11"}, "timelineItems": {"totalCount": 5, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABc2QkvKAH2gAyNDUyMTkyMTk1OjgxNzU1YmJhNmFlMjJhNGQ3MjliZWE3NDg4NzkxOTBmYjM2MzJjYmM=", "endCursor": "Y3Vyc29yOnYyOpPPAAABc3fbSpgH2gAyNDUyMTkyMTk1Ojc2MmFmMzVjMDFmMTMzM2JiMWNlZWY5YjVhNDNjMmI4NzMyNTk0ZGI=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "81755bba6ae22a4d729bea748879190fb3632cbc", "author": {"user": {"login": "silverwolfg11", "name": null}}, "url": "https://github.com/TownyAdvanced/Towny/commit/81755bba6ae22a4d729bea748879190fb3632cbc", "committedDate": "2020-07-18T22:56:36Z", "message": "Metadata now  uses a map and other improvements."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDUxMDkzOTU5", "url": "https://github.com/TownyAdvanced/Towny/pull/4186#pullrequestreview-451093959", "createdAt": "2020-07-19T02:34:27Z", "commit": {"oid": "81755bba6ae22a4d729bea748879190fb3632cbc"}, "state": "COMMENTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xOVQwMjozNDoyN1rOGzr60g==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xOVQwMjozNjowOFrOGzr7UA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1Njg1MDEzMA==", "bodyText": "Even though when I originally did this I set this to null as the default, I think we're better of making it non-null:\nprivate Map<String, CustomDataField<?>> metadata = new HastMap<>();", "url": "https://github.com/TownyAdvanced/Towny/pull/4186#discussion_r456850130", "createdAt": "2020-07-19T02:34:27Z", "author": null, "path": "src/com/palmergames/bukkit/towny/object/TownyObject.java", "diffHunk": "@@ -4,13 +4,16 @@\n \n import java.util.ArrayList;\n import java.util.Arrays;\n-import java.util.HashSet;\n+import java.util.Collection;\n+import java.util.Collections;\n+import java.util.HashMap;\n import java.util.List;\n+import java.util.Map;\n \n public abstract class TownyObject implements Nameable {\n \tprivate String name;\n-\n-\tprivate HashSet<CustomDataField<?>> metadata = null;\n+\t\n+\tprivate Map<String, CustomDataField<?>> metadata = null;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "81755bba6ae22a4d729bea748879190fb3632cbc"}, "originalPosition": 16}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1Njg1MDI1Ng==", "bodyText": "Unless this method is being used externally, it may not need to be here.", "url": "https://github.com/TownyAdvanced/Towny/pull/4186#discussion_r456850256", "createdAt": "2020-07-19T02:36:08Z", "author": null, "path": "src/com/palmergames/bukkit/towny/object/TownyObject.java", "diffHunk": "@@ -50,38 +53,57 @@ public String toString() {\n \t}\n \n \tpublic void addMetaData(CustomDataField<?> md) {\n-\t\tif (getMetadata() == null)\n-\t\t\tmetadata = new HashSet<>();\n-\n-\t\tgetMetadata().add(md);\n+\t\tif (metadata == null)\n+\t\t\tmetadata = new HashMap<>();\n+\t\t\n+\t\tmetadata.put(md.getKey(), md);\n \t}\n \n \tpublic void removeMetaData(CustomDataField<?> md) {\n \t\tif (!hasMeta())\n \t\t\treturn;\n-\n-\t\tgetMetadata().remove(md);\n-\n-\t\tif (getMetadata().size() == 0)\n+\t\t\n+\t\tmetadata.remove(md.getKey());\n+\t\t\n+\t\tif (metadata.isEmpty())\n \t\t\tthis.metadata = null;\n \t}\n+\t\n+\tpublic Collection<CustomDataField<?>> getMetadata() {\n+\t\tif (metadata == null || metadata.isEmpty())\n+\t\t\treturn Collections.emptyList();\n+\t\t\n+\t\treturn Collections.unmodifiableCollection(metadata.values());\n+\t}\n \n-\tpublic HashSet<CustomDataField<?>> getMetadata() {\n-\t\treturn metadata;\n+\tpublic Map<String, CustomDataField<?>> getMetaMap() {\n+\t\tif (metadata == null)\n+\t\t\treturn Collections.emptyMap();\n+\n+\t\treturn Collections.unmodifiableMap(metadata);\n+\t}", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "81755bba6ae22a4d729bea748879190fb3632cbc"}, "originalPosition": 62}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ed9f7ae9116411c8e9967c51591e63e7d3ad2f20", "author": {"user": {"login": "silverwolfg11", "name": null}}, "url": "https://github.com/TownyAdvanced/Towny/commit/ed9f7ae9116411c8e9967c51591e63e7d3ad2f20", "committedDate": "2020-07-21T21:47:49Z", "message": "Remove unused metamap method."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e78acf95905c334d1b35d89660b135eab0a53cf5", "author": {"user": {"login": "silverwolfg11", "name": null}}, "url": "https://github.com/TownyAdvanced/Towny/commit/e78acf95905c334d1b35d89660b135eab0a53cf5", "committedDate": "2020-07-21T21:52:35Z", "message": "Fix hasMeta check"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "762af35c01f1333bb1ceef9b5a43c2b8732594db", "author": {"user": {"login": "silverwolfg11", "name": null}}, "url": "https://github.com/TownyAdvanced/Towny/commit/762af35c01f1333bb1ceef9b5a43c2b8732594db", "committedDate": "2020-07-22T18:48:47Z", "message": "Add some missing override annotations."}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4164, "cost": 1, "resetAt": "2021-11-01T16:37:27Z"}}}