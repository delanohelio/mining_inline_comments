{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0Mzk1OTg2NzY0", "number": 3851, "reviewThreads": {"totalCount": 6, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0zMVQwMToxNTozNFrODs6P-g==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0zMVQwMToyMjowOVrODs6ULQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjQ4NDE4Mjk4OnYy", "diffSide": "RIGHT", "path": "src/com/palmergames/bukkit/towny/command/TownyAdminCommand.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0zMVQwMToxNTozNFrOF-B2Rg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0zMVQwMToxNTozNFrOF-B2Rg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMDU4NjMxMA==", "bodyText": "Should be Whether or not to reset the config.yml.", "url": "https://github.com/TownyAdvanced/Towny/pull/3851#discussion_r400586310", "createdAt": "2020-03-31T01:15:34Z", "author": {"login": "LlmDl"}, "path": "src/com/palmergames/bukkit/towny/command/TownyAdminCommand.java", "diffHunk": "@@ -1444,24 +1471,61 @@ public String nextNpcName() throws TownyException {\n \t\t\t\tthrow new TownyException(TownySettings.getLangString(\"msg_err_too_many_npc\"));\r\n \t\t} while (true);\r\n \t}\r\n+\t\r\n+\tpublic void reloadLangs() {\r\n+\t\tString rootFolder = TownyUniverse.getInstance().getRootFolder();\r\n+\t\ttry {\r\n+\t\t\tTownySettings.loadLanguage(rootFolder + File.separator + \"settings\", \"english.yml\");\r\n+\t\t} catch (IOException e) {\r\n+\t\t\tTownyMessaging.sendErrorMsg(sender, TownySettings.getLangString(\"msg_reload_error\"));\r\n+\t\t\te.printStackTrace();\r\n+\t\t}\r\n+\t\t\r\n+\t\tTownyMessaging.sendMsg(sender, TownySettings.getLangString(\"msg_reloaded_lang\"));\r\n+\t}\r\n+\t\r\n+\tpublic void reloadPerms() {\r\n+\t\tString rootFolder = TownyUniverse.getInstance().getRootFolder();\r\n+\t\tTownyPerms.loadPerms(rootFolder + File.separator + \"settings\", \"townyperms.yml\");\r\n+\t\tTownyMessaging.sendMsg(sender, TownySettings.getLangString(\"msg_reloaded_perms\"));\r\n+\t}\r\n \r\n-\tpublic void reloadTowny(Boolean reset) {\r\n+\t/**\r\n+\t * Reloads only the config\r\n+\t */\r\n+\tpublic void reloadConfig() {\r\n+\t\ttry {\r\n+\t\t\tString rootFolder = TownyUniverse.getInstance().getRootFolder();\r\n+\t\t\tTownySettings.loadConfig(rootFolder + File.separator + \"settings\" + File.separator + \"config.yml\", plugin.getVersion());\r\n+\t\t} catch (IOException e) {\r\n+\t\t\tTownyMessaging.sendErrorMsg(sender, TownySettings.getLangString(\"msg_reload_error\"));\r\n+\t\t\te.printStackTrace();\r\n+\t\t\treturn;\r\n+\t\t}\r\n+\t\t\r\n+\t\tTownyMessaging.sendMsg(sender, TownySettings.getLangString(\"msg_reloaded_config\"));\r\n+\t}\r\n \r\n+\t/**\r\n+\t * Reloads both the database and the config. Used with a database reload command.\r\n+\t * \r\n+\t * @param reset Whether or not to reset the database.\r", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "64f43bd526cdc03837c529dee42de00fb9b5911f"}, "originalPosition": 101}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjQ4NDE4Mzk2OnYy", "diffSide": "RIGHT", "path": "src/com/palmergames/bukkit/towny/command/TownyAdminCommand.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0zMVQwMToxNjoxNFrOF-B23w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0zMVQwMToxNjoxNFrOF-B23w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMDU4NjQ2Mw==", "bodyText": "Should have a second language string saying the config.yml was reset to default.", "url": "https://github.com/TownyAdvanced/Towny/pull/3851#discussion_r400586463", "createdAt": "2020-03-31T01:16:14Z", "author": {"login": "LlmDl"}, "path": "src/com/palmergames/bukkit/towny/command/TownyAdminCommand.java", "diffHunk": "@@ -1444,24 +1471,61 @@ public String nextNpcName() throws TownyException {\n \t\t\t\tthrow new TownyException(TownySettings.getLangString(\"msg_err_too_many_npc\"));\r\n \t\t} while (true);\r\n \t}\r\n+\t\r\n+\tpublic void reloadLangs() {\r\n+\t\tString rootFolder = TownyUniverse.getInstance().getRootFolder();\r\n+\t\ttry {\r\n+\t\t\tTownySettings.loadLanguage(rootFolder + File.separator + \"settings\", \"english.yml\");\r\n+\t\t} catch (IOException e) {\r\n+\t\t\tTownyMessaging.sendErrorMsg(sender, TownySettings.getLangString(\"msg_reload_error\"));\r\n+\t\t\te.printStackTrace();\r\n+\t\t}\r\n+\t\t\r\n+\t\tTownyMessaging.sendMsg(sender, TownySettings.getLangString(\"msg_reloaded_lang\"));\r\n+\t}\r\n+\t\r\n+\tpublic void reloadPerms() {\r\n+\t\tString rootFolder = TownyUniverse.getInstance().getRootFolder();\r\n+\t\tTownyPerms.loadPerms(rootFolder + File.separator + \"settings\", \"townyperms.yml\");\r\n+\t\tTownyMessaging.sendMsg(sender, TownySettings.getLangString(\"msg_reloaded_perms\"));\r\n+\t}\r\n \r\n-\tpublic void reloadTowny(Boolean reset) {\r\n+\t/**\r\n+\t * Reloads only the config\r\n+\t */\r\n+\tpublic void reloadConfig() {\r\n+\t\ttry {\r\n+\t\t\tString rootFolder = TownyUniverse.getInstance().getRootFolder();\r\n+\t\t\tTownySettings.loadConfig(rootFolder + File.separator + \"settings\" + File.separator + \"config.yml\", plugin.getVersion());\r\n+\t\t} catch (IOException e) {\r\n+\t\t\tTownyMessaging.sendErrorMsg(sender, TownySettings.getLangString(\"msg_reload_error\"));\r\n+\t\t\te.printStackTrace();\r\n+\t\t\treturn;\r\n+\t\t}\r\n+\t\t\r\n+\t\tTownyMessaging.sendMsg(sender, TownySettings.getLangString(\"msg_reloaded_config\"));\r\n+\t}\r\n \r\n+\t/**\r\n+\t * Reloads both the database and the config. Used with a database reload command.\r\n+\t * \r\n+\t * @param reset Whether or not to reset the database.\r\n+\t */\r\n+\tpublic void reloadDatabase(Boolean reset) {\r\n \t\tif (reset) {\r\n \t\t\tTownyUniverse.getInstance().getDataSource().deleteFile(plugin.getConfigPath());\r\n \t\t}\r\n \t\tif (plugin.load()) {\r\n-\t\t\t\r\n+\r\n \t\t\t// Register all child permissions for ranks\r\n \t\t\tTownyPerms.registerPermissionNodes();\r\n-\t\t\t\r\n+\r\n \t\t\t// Update permissions for all online players\r\n \t\t\tTownyPerms.updateOnlinePerms();\r\n-\t\t\t\r\n+\r\n \t\t}\r\n \r\n-\t\tTownyMessaging.sendMsg(sender, TownySettings.getLangString(\"msg_reloaded\"));\r\n-\t\t// TownyMessaging.sendMsg(TownySettings.getLangString(\"msg_reloaded\"));\r\n+\t\tTownyMessaging.sendMsg(sender, TownySettings.getLangString(\"msg_reloaded_db\"));\r", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "64f43bd526cdc03837c529dee42de00fb9b5911f"}, "originalPosition": 122}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjQ4NDE4NTIyOnYy", "diffSide": "RIGHT", "path": "src/com/palmergames/bukkit/towny/command/TownyAdminCommand.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0zMVQwMToxNzowNVrOF-B3pw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0zMVQwMToxNzowNVrOF-B3pw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMDU4NjY2Mw==", "bodyText": "I'd add an alias for townyperms as well here.", "url": "https://github.com/TownyAdvanced/Towny/pull/3851#discussion_r400586663", "createdAt": "2020-03-31T01:17:05Z", "author": {"login": "LlmDl"}, "path": "src/com/palmergames/bukkit/towny/command/TownyAdminCommand.java", "diffHunk": "@@ -237,6 +238,9 @@ public boolean onCommand(CommandSender sender, Command cmd, String commandLabel,\n \tpublic List<String> onTabComplete(CommandSender sender, Command command, String alias, String[] args) {\r\n \t\t\r\n \t\tswitch (args[0].toLowerCase()) {\r\n+\t\t\tcase \"reload\":\r\n+\t\t\t\tif (args.length > 1)\r\n+\t\t\t\t\treturn NameUtil.filterByStart(Arrays.asList(\"database\", \"db\", \"config\", \"perms\", \"permissions\", \"language\", \"lang\"), args[1]);\r", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "64f43bd526cdc03837c529dee42de00fb9b5911f"}, "originalPosition": 14}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjQ4NDE4ODY5OnYy", "diffSide": "RIGHT", "path": "src/com/palmergames/bukkit/towny/command/TownyAdminCommand.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0zMVQwMToxODo1M1rOF-B5qw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0zMVQwMToxODo1M1rOF-B5qw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMDU4NzE3OQ==", "bodyText": "The subcommands should be broken down into 5 options, one subcommand per line the fourth \"\" is actually meant for translatable help descriptions explaining what each does. Add on an \"all\" option.", "url": "https://github.com/TownyAdvanced/Towny/pull/3851#discussion_r400587179", "createdAt": "2020-03-31T01:18:53Z", "author": {"login": "LlmDl"}, "path": "src/com/palmergames/bukkit/towny/command/TownyAdminCommand.java", "diffHunk": "@@ -455,12 +459,35 @@ public boolean parseTownyAdminCommand(String[] split) throws TownyException {\n \t\t\t\tgiveBonus(StringMgmt.remFirstArg(split));\r\n \r\n \t\t\t} else if (split[0].equalsIgnoreCase(\"reload\")) {\r\n-\r\n-\t\t\t\treloadTowny(false);\r\n-\r\n+\t\t\t\tif (split.length == 2) {\r\n+\t\t\t\t\tswitch (split[1]) {\r\n+\t\t\t\t\t\tcase \"db\":\r\n+\t\t\t\t\t\tcase \"database\":\r\n+\t\t\t\t\t\t\treloadDatabase(false);\r\n+\t\t\t\t\t\t\tbreak;\r\n+\t\t\t\t\t\tcase \"config\":\r\n+\t\t\t\t\t\t\treloadConfig();\r\n+\t\t\t\t\t\t\tbreak;\r\n+\t\t\t\t\t\tcase \"perms\":\r\n+\t\t\t\t\t\tcase \"permissions\":\r\n+\t\t\t\t\t\t\treloadPerms();\r\n+\t\t\t\t\t\t\tbreak;\r\n+\t\t\t\t\t\tcase \"language\":\r\n+\t\t\t\t\t\tcase \"lang\":\r\n+\t\t\t\t\t\t\treloadLangs();\r\n+\t\t\t\t\t\t\tbreak;\r\n+\t\t\t\t\t\tdefault:\r\n+\t\t\t\t\t\t\tplayer.sendMessage(ChatTools.formatTitle(\"/ta reload\"));\r\n+\t\t\t\t\t\t\tplayer.sendMessage(ChatTools.formatCommand(\"\", \"/ta reload\", \"<database|config|perms|lang>\", \"\"));\r\n+\t\t\t\t\t}\r\n+\t\t\t\t} else {\r\n+\t\t\t\t\tplayer.sendMessage(ChatTools.formatTitle(\"/ta reload\"));\r\n+\t\t\t\t\tplayer.sendMessage(ChatTools.formatCommand(\"\", \"/ta reload\", \"<database|config|perms|lang>\", \"\"));\r", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "64f43bd526cdc03837c529dee42de00fb9b5911f"}, "originalPosition": 48}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjQ4NDE4OTc4OnYy", "diffSide": "RIGHT", "path": "src/com/palmergames/bukkit/towny/command/TownyAdminCommand.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0zMVQwMToxOTozMVrOF-B6Vw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0zMVQwMToxOTozMVrOF-B6Vw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMDU4NzM1MQ==", "bodyText": "Switch needs an \"all\" option for reloading everything all at once.", "url": "https://github.com/TownyAdvanced/Towny/pull/3851#discussion_r400587351", "createdAt": "2020-03-31T01:19:31Z", "author": {"login": "LlmDl"}, "path": "src/com/palmergames/bukkit/towny/command/TownyAdminCommand.java", "diffHunk": "@@ -455,12 +459,35 @@ public boolean parseTownyAdminCommand(String[] split) throws TownyException {\n \t\t\t\tgiveBonus(StringMgmt.remFirstArg(split));\r\n \r\n \t\t\t} else if (split[0].equalsIgnoreCase(\"reload\")) {\r\n-\r\n-\t\t\t\treloadTowny(false);\r\n-\r\n+\t\t\t\tif (split.length == 2) {\r\n+\t\t\t\t\tswitch (split[1]) {\r", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "64f43bd526cdc03837c529dee42de00fb9b5911f"}, "originalPosition": 26}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjQ4NDE5MzczOnYy", "diffSide": "RIGHT", "path": "src/com/palmergames/bukkit/towny/command/TownyAdminCommand.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0zMVQwMToyMjowOVrOF-B8yw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0zMVQwMToyMjowOVrOF-B8yw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMDU4Nzk3OQ==", "bodyText": "Reset is supposed to only reset the config.", "url": "https://github.com/TownyAdvanced/Towny/pull/3851#discussion_r400587979", "createdAt": "2020-03-31T01:22:09Z", "author": {"login": "LlmDl"}, "path": "src/com/palmergames/bukkit/towny/command/TownyAdminCommand.java", "diffHunk": "@@ -455,12 +459,35 @@ public boolean parseTownyAdminCommand(String[] split) throws TownyException {\n \t\t\t\tgiveBonus(StringMgmt.remFirstArg(split));\r\n \r\n \t\t\t} else if (split[0].equalsIgnoreCase(\"reload\")) {\r\n-\r\n-\t\t\t\treloadTowny(false);\r\n-\r\n+\t\t\t\tif (split.length == 2) {\r\n+\t\t\t\t\tswitch (split[1]) {\r\n+\t\t\t\t\t\tcase \"db\":\r\n+\t\t\t\t\t\tcase \"database\":\r\n+\t\t\t\t\t\t\treloadDatabase(false);\r\n+\t\t\t\t\t\t\tbreak;\r\n+\t\t\t\t\t\tcase \"config\":\r\n+\t\t\t\t\t\t\treloadConfig();\r\n+\t\t\t\t\t\t\tbreak;\r\n+\t\t\t\t\t\tcase \"perms\":\r\n+\t\t\t\t\t\tcase \"permissions\":\r\n+\t\t\t\t\t\t\treloadPerms();\r\n+\t\t\t\t\t\t\tbreak;\r\n+\t\t\t\t\t\tcase \"language\":\r\n+\t\t\t\t\t\tcase \"lang\":\r\n+\t\t\t\t\t\t\treloadLangs();\r\n+\t\t\t\t\t\t\tbreak;\r\n+\t\t\t\t\t\tdefault:\r\n+\t\t\t\t\t\t\tplayer.sendMessage(ChatTools.formatTitle(\"/ta reload\"));\r\n+\t\t\t\t\t\t\tplayer.sendMessage(ChatTools.formatCommand(\"\", \"/ta reload\", \"<database|config|perms|lang>\", \"\"));\r\n+\t\t\t\t\t}\r\n+\t\t\t\t} else {\r\n+\t\t\t\t\tplayer.sendMessage(ChatTools.formatTitle(\"/ta reload\"));\r\n+\t\t\t\t\tplayer.sendMessage(ChatTools.formatCommand(\"\", \"/ta reload\", \"<database|config|perms|lang>\", \"\"));\r\n+\t\t\t\t\treturn false;\r\n+\t\t\t\t}\r\n \t\t\t} else if (split[0].equalsIgnoreCase(\"reset\")) {\r\n \r\n-\t\t\t\treloadTowny(true);\r\n+\t\t\t\treloadDatabase(true);\r", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "64f43bd526cdc03837c529dee42de00fb9b5911f"}, "originalPosition": 54}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1258, "cost": 1, "resetAt": "2021-11-13T14:23:39Z"}}}