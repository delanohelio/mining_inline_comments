{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0Mzk4OTEwNDQy", "number": 3877, "title": "Hotfix/save queue", "bodyText": "Description:\n\n\nTowny currently is just disregarding anything in the save queue on shutdown and clearing it. This may be the cause for data loss especially when saving large chunks of data.\nCredit to @silverwolfg11 for finding this major bug.\n\n\n I have tested this pull request for defects on a server.\n\n\nBy making this pull request, I represent that I have the right to waive copyright and related rights to my contribution, and agree that all copyright and related rights in my contributions are waived, and I acknowledge that the TownyAdvanced organization has the copyright to use and modify my contribution under the Towny License for perpetuity.", "createdAt": "2020-04-05T05:18:07Z", "url": "https://github.com/TownyAdvanced/Towny/pull/3877", "merged": true, "mergeCommit": {"oid": "b654dca3b4b34d51ffeed8581760b87010ca185b"}, "closed": true, "closedAt": "2020-04-08T11:17:31Z", "author": null, "timelineItems": {"totalCount": 6, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcUFPfogH2gAyMzk4OTEwNDQyOjM2ZGU2ODY4OTk2NTA5ZjQ0ZDA1YWIyYmZmZTBmMDdlOWQ4NmYwNzA=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcVEZtyAH2gAyMzk4OTEwNDQyOjcxNTg3YmNiMmRhZTEyMmU1ZTc4MGNmZDA5ZmYyYjAyMDkwYzVjNDA=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "36de6868996509f44d05ab2bffe0f07e9d86f070", "author": {"user": null}, "url": "https://github.com/TownyAdvanced/Towny/commit/36de6868996509f44d05ab2bffe0f07e9d86f070", "committedDate": "2020-04-03T18:31:01Z", "message": "Shade in paperlib for async chunk loading."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a2a201e502c010b8f078ed0e45b35d3da8aaa67e", "author": {"user": null}, "url": "https://github.com/TownyAdvanced/Towny/commit/a2a201e502c010b8f078ed0e45b35d3da8aaa67e", "committedDate": "2020-04-04T03:37:21Z", "message": "Merge remote-tracking branch 'origin/master'"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e58883e989335f9de67f3d9b0c2e6e36ab7e09c9", "author": {"user": null}, "url": "https://github.com/TownyAdvanced/Towny/commit/e58883e989335f9de67f3d9b0c2e6e36ab7e09c9", "committedDate": "2020-04-05T05:14:42Z", "message": "actually save everything in the queue on shutdown."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzg3ODEzMTg3", "url": "https://github.com/TownyAdvanced/Towny/pull/3877#pullrequestreview-387813187", "createdAt": "2020-04-05T12:23:38Z", "commit": {"oid": "e58883e989335f9de67f3d9b0c2e6e36ab7e09c9"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wNVQxMjoyMzozOFrOGA_j5Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wNVQxMjoyMzozOFrOGA_j5Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMzY5NDU2NQ==", "bodyText": "looks like it needs a little\n\t\t\tbufferedWriter.close();\n\t\t\tosw.close();\n\nno?", "url": "https://github.com/TownyAdvanced/Towny/pull/3877#discussion_r403694565", "createdAt": "2020-04-05T12:23:38Z", "author": {"login": "LlmDl"}, "path": "src/com/palmergames/util/FileMgmt.java", "diffHunk": "@@ -227,12 +228,10 @@ public static void stringToFile(String source, String FileName) {\n \t */\n \tpublic static void stringToFile(String source, File file) {\n \n-\t\ttry {\n-\t\t\tOutputStreamWriter out = new OutputStreamWriter(new FileOutputStream(file), StandardCharsets.UTF_8);\n-\n-\t\t\tout.write(source);\n-\t\t\tout.close();\n-\n+\t\ttry (OutputStreamWriter osw = new OutputStreamWriter(new FileOutputStream(file), StandardCharsets.UTF_8);\n+\t\t\t BufferedWriter bufferedWriter = new BufferedWriter(osw)) {\n+\t\t\t\n+\t\t\tbufferedWriter.write(source);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "e58883e989335f9de67f3d9b0c2e6e36ab7e09c9"}, "originalPosition": 21}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzg4NTQ1NDYw", "url": "https://github.com/TownyAdvanced/Towny/pull/3877#pullrequestreview-388545460", "createdAt": "2020-04-06T19:18:07Z", "commit": {"oid": "e58883e989335f9de67f3d9b0c2e6e36ab7e09c9"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wNlQxOToxODowN1rOGBmTvA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wNlQxOToxODowN1rOGBmTvA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNDMyOTQwNA==", "bodyText": "Redundant since you're using try-with-resources anyway and they will be closed on scope exit.", "url": "https://github.com/TownyAdvanced/Towny/pull/3877#discussion_r404329404", "createdAt": "2020-04-06T19:18:07Z", "author": {"login": "silverwolfg11"}, "path": "src/com/palmergames/util/FileMgmt.java", "diffHunk": "@@ -247,18 +246,16 @@ public static void stringToFile(String source, File file) {\n \t */\n \tpublic static boolean listToFile(List<String> source, String targetLocation) {\n \n-\t\ttry {\n-\n-\t\t\tFile file = new File(targetLocation);\n-\t\t\tOutputStreamWriter out = new OutputStreamWriter(new FileOutputStream(file), StandardCharsets.UTF_8);\n-\n+\t\tFile file = new File(targetLocation);\n+\t\ttry(OutputStreamWriter osw = new OutputStreamWriter(new FileOutputStream(file), StandardCharsets.UTF_8);\n+\t\t\tBufferedWriter bufferedWriter = new BufferedWriter(osw)) {\n+\t\t\t\n \t\t\tfor (String aSource : source) {\n-\n-\t\t\t\tout.write(aSource + System.getProperty(\"line.separator\"));\n-\n+\t\t\t\tbufferedWriter.write(aSource + System.getProperty(\"line.separator\"));\n \t\t\t}\n \n-\t\t\tout.close();\n+\t\t\tbufferedWriter.close();\n+\t\t\tosw.close();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "e58883e989335f9de67f3d9b0c2e6e36ab7e09c9"}, "originalPosition": 47}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "71587bcb2dae122e5e780cfd09ff2b02090c5c40", "author": {"user": null}, "url": "https://github.com/TownyAdvanced/Towny/commit/71587bcb2dae122e5e780cfd09ff2b02090c5c40", "committedDate": "2020-04-06T20:06:12Z", "message": "Remove redundancy"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4269, "cost": 1, "resetAt": "2021-11-01T16:37:27Z"}}}