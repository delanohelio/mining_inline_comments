{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDUyMTkyMTk1", "number": 4186, "reviewThreads": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xOVQwMjozNDoyN1rOEPzx3w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xOVQwMjozNjowOFrOEPzyUg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjg1MDEyNDQ3OnYy", "diffSide": "RIGHT", "path": "src/com/palmergames/bukkit/towny/object/TownyObject.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xOVQwMjozNDoyN1rOGzr60g==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yMVQyMDo1NDoyMlrOG1JYyw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1Njg1MDEzMA==", "bodyText": "Even though when I originally did this I set this to null as the default, I think we're better of making it non-null:\nprivate Map<String, CustomDataField<?>> metadata = new HastMap<>();", "url": "https://github.com/TownyAdvanced/Towny/pull/4186#discussion_r456850130", "createdAt": "2020-07-19T02:34:27Z", "author": null, "path": "src/com/palmergames/bukkit/towny/object/TownyObject.java", "diffHunk": "@@ -4,13 +4,16 @@\n \n import java.util.ArrayList;\n import java.util.Arrays;\n-import java.util.HashSet;\n+import java.util.Collection;\n+import java.util.Collections;\n+import java.util.HashMap;\n import java.util.List;\n+import java.util.Map;\n \n public abstract class TownyObject implements Nameable {\n \tprivate String name;\n-\n-\tprivate HashSet<CustomDataField<?>> metadata = null;\n+\t\n+\tprivate Map<String, CustomDataField<?>> metadata = null;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "81755bba6ae22a4d729bea748879190fb3632cbc"}, "originalPosition": 16}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1ODM4MTUxNQ==", "bodyText": "Reason I kept it null is for lazy-loading. I don't think the majority of TownyObjects will have metadata so I rather not create new objects for all of them if they're not going to be used.", "url": "https://github.com/TownyAdvanced/Towny/pull/4186#discussion_r458381515", "createdAt": "2020-07-21T20:54:22Z", "author": {"login": "silverwolfg11"}, "path": "src/com/palmergames/bukkit/towny/object/TownyObject.java", "diffHunk": "@@ -4,13 +4,16 @@\n \n import java.util.ArrayList;\n import java.util.Arrays;\n-import java.util.HashSet;\n+import java.util.Collection;\n+import java.util.Collections;\n+import java.util.HashMap;\n import java.util.List;\n+import java.util.Map;\n \n public abstract class TownyObject implements Nameable {\n \tprivate String name;\n-\n-\tprivate HashSet<CustomDataField<?>> metadata = null;\n+\t\n+\tprivate Map<String, CustomDataField<?>> metadata = null;", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1Njg1MDEzMA=="}, "originalCommit": {"oid": "81755bba6ae22a4d729bea748879190fb3632cbc"}, "originalPosition": 16}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjg1MDEyNTYyOnYy", "diffSide": "RIGHT", "path": "src/com/palmergames/bukkit/towny/object/TownyObject.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xOVQwMjozNjowOFrOGzr7UA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xOVQwMjozNjowOFrOGzr7UA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1Njg1MDI1Ng==", "bodyText": "Unless this method is being used externally, it may not need to be here.", "url": "https://github.com/TownyAdvanced/Towny/pull/4186#discussion_r456850256", "createdAt": "2020-07-19T02:36:08Z", "author": null, "path": "src/com/palmergames/bukkit/towny/object/TownyObject.java", "diffHunk": "@@ -50,38 +53,57 @@ public String toString() {\n \t}\n \n \tpublic void addMetaData(CustomDataField<?> md) {\n-\t\tif (getMetadata() == null)\n-\t\t\tmetadata = new HashSet<>();\n-\n-\t\tgetMetadata().add(md);\n+\t\tif (metadata == null)\n+\t\t\tmetadata = new HashMap<>();\n+\t\t\n+\t\tmetadata.put(md.getKey(), md);\n \t}\n \n \tpublic void removeMetaData(CustomDataField<?> md) {\n \t\tif (!hasMeta())\n \t\t\treturn;\n-\n-\t\tgetMetadata().remove(md);\n-\n-\t\tif (getMetadata().size() == 0)\n+\t\t\n+\t\tmetadata.remove(md.getKey());\n+\t\t\n+\t\tif (metadata.isEmpty())\n \t\t\tthis.metadata = null;\n \t}\n+\t\n+\tpublic Collection<CustomDataField<?>> getMetadata() {\n+\t\tif (metadata == null || metadata.isEmpty())\n+\t\t\treturn Collections.emptyList();\n+\t\t\n+\t\treturn Collections.unmodifiableCollection(metadata.values());\n+\t}\n \n-\tpublic HashSet<CustomDataField<?>> getMetadata() {\n-\t\treturn metadata;\n+\tpublic Map<String, CustomDataField<?>> getMetaMap() {\n+\t\tif (metadata == null)\n+\t\t\treturn Collections.emptyMap();\n+\n+\t\treturn Collections.unmodifiableMap(metadata);\n+\t}", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "81755bba6ae22a4d729bea748879190fb3632cbc"}, "originalPosition": 62}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1209, "cost": 1, "resetAt": "2021-11-13T14:23:39Z"}}}