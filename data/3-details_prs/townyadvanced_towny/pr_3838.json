{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0Mzk1MTA1NjI4", "number": 3838, "title": "Branch will remove TownBlockLists saving/loading, remove TownBlocks from TownyWorld, add TownBlocks to Town and TownyUniverse.", "bodyText": "Description:\n\nThis Branch will accomplish a number of things, most importantly:\n\nStop saving and loading townblocklists (towny\\data\\townblocks.txt\n\nTownblocks are loaded from the towny\\data\\townblocks folder directly and stored in their Towns primarily, with a seconday map being held in TownyUniverse as a fallback.\n\n\nRemove townblocks from the TownyWorlds, where they were in far to large a group to reasonably save them.\nHopefully solve the issue of disappearing townblocks.\n\n\nNew Nodes/Commands/ConfigOptions:\n\nNone.\n\nRelevant Towny Issue ticket:\n\nAll of the tickets in the Disappearing Townblocks project.\n#3783 #3796 #3813 #3821 #3844\n\n\n I have tested this pull request for defects on a server.\n\n\nBy making this pull request, I represent that I have the right to waive copyright and related rights to my contribution, and agree that all copyright and related rights in my contributions are waived, and I acknowledge that the TownyAdvanced organization has the copyright to use and modify my contribution under the Towny License for perpetuity.", "createdAt": "2020-03-28T14:48:49Z", "url": "https://github.com/TownyAdvanced/Towny/pull/3838", "merged": true, "mergeCommit": {"oid": "a7a65999221a49e160c85f0661d7b576770c35be"}, "closed": true, "closedAt": "2020-04-02T13:57:02Z", "author": {"login": "LlmDl"}, "timelineItems": {"totalCount": 17, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcQKh7ngH2gAyMzk1MTA1NjI4OmE4MTUyYzAzOWFhMDc2OGQ2OWFlNDk2MDg5ZTA4NjVmN2Q5MzU5MWY=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcTrUNTAH2gAyMzk1MTA1NjI4OjlkYWRkNzc1OGFiMTFjZDJkZjFlMDkzZjFkOGM2NzFiMjljNzBhOTU=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "a8152c039aa0768d69ae496089e0865f7d93591f", "author": {"user": {"login": "LlmDl", "name": null}}, "url": "https://github.com/TownyAdvanced/Towny/commit/a8152c039aa0768d69ae496089e0865f7d93591f", "committedDate": "2020-03-22T14:24:59Z", "message": "Replace most TownyWorld#getTownBlock(Coord coord) calls with\nTownyAPI.getInstance().getTownBlock(location)."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "9e20007f1f3480124055393d688cf8931c1188dc", "author": {"user": {"login": "LlmDl", "name": null}}, "url": "https://github.com/TownyAdvanced/Towny/commit/9e20007f1f3480124055393d688cf8931c1188dc", "committedDate": "2020-03-22T19:55:53Z", "message": "Townblocks.txt no longer used.\n\nTowny parses the entire towny\\data\\townblocks\\ folder to create a\nConcurrentHashMap in TownyUniverse (probably just temporary for now.)\n\nTowny then loads individual TownBlocks from that list, and stores them\nin the towns.\n\nSaving the townblocklist is now done on a per-town basis, only doing the\nfull batch on saveAll()."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "963c6da52fb389c549964aa8f9d4362e91c507fa", "author": {"user": {"login": "LlmDl", "name": null}}, "url": "https://github.com/TownyAdvanced/Towny/commit/963c6da52fb389c549964aa8f9d4362e91c507fa", "committedDate": "2020-03-25T22:14:24Z", "message": "TownBlocks_Update Commit #3\n\nContinuing on with removing TownBlockLists, ending TownBlocks being\ntracked per-TownyWorld, adding TownBlocks being tracked per-Town.\n\n- Add TownyAPI.isWilderness(WorldCoord worldCoord) method.\n- Flesh out methods in TownyUniverse for maintaining the global\ntownblocks hashmap.\n- Remove all traces of saveTownBlockList() and saveTownBlockList(Town\ntown).\n- Remove extra townblock removal methods from TownyDatabaseHandler\n(removeOneOfManyTownBlocks(), removeManyTownBlocks())\n- Remove deprecated methods used to update ancient Towny databases that\nstill stored TownBlocks in the town and resident files.\n  - (utilLoadTownBlocks(), utilLoadTownBlockTypeData(),\nutilSaveTownBlocks()\n- Replaced the Town's List<TownBlock> with ConcurrentHashMap<WorldCoord,\nTownBlock>.\n- Removed TownyWorld's ConcurrentHashMap<Coord, TownBlock> townBlocks,\nwith all methods forwarding to TownyUniverse or otherwise handling\nthings."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b9ba51e153f76c931815264833d21488e64596ec", "author": {"user": {"login": "LlmDl", "name": null}}, "url": "https://github.com/TownyAdvanced/Towny/commit/b9ba51e153f76c931815264833d21488e64596ec", "committedDate": "2020-03-25T23:02:28Z", "message": "Small cleanup."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "329c9511ab7fbb77b6daedf1f730939037c6d411", "author": {"user": {"login": "LlmDl", "name": null}}, "url": "https://github.com/TownyAdvanced/Towny/commit/329c9511ab7fbb77b6daedf1f730939037c6d411", "committedDate": "2020-03-25T23:54:31Z", "message": "Merge remote-tracking branch 'origin/master' into\ndatabase/townblocks_update\n\nConflicts:\n\tsrc/com/palmergames/bukkit/towny/command/TownCommand.java\n\tsrc/com/palmergames/bukkit/towny/db/TownyFlatFileSource.java\n\tsrc/com/palmergames/bukkit/towny/object/TownyWorld.java"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e382495910e7a79276c20c09289f92f0a6b7bea2", "author": {"user": {"login": "LlmDl", "name": null}}, "url": "https://github.com/TownyAdvanced/Towny/commit/e382495910e7a79276c20c09289f92f0a6b7bea2", "committedDate": "2020-03-27T01:53:43Z", "message": "Merge remote-tracking branch 'origin/master' into database/townblocks_update"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "06dbd8ae6f6ee7d6a53fb381700f56e7bc099ee7", "author": {"user": {"login": "LlmDl", "name": null}}, "url": "https://github.com/TownyAdvanced/Towny/commit/06dbd8ae6f6ee7d6a53fb381700f56e7bc099ee7", "committedDate": "2020-03-27T02:58:28Z", "message": "- Fix setting homeblock for Towns on load."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "50e130f38622cd89b94cfc53ad06471de897a1b8", "author": {"user": {"login": "LlmDl", "name": null}}, "url": "https://github.com/TownyAdvanced/Towny/commit/50e130f38622cd89b94cfc53ad06471de897a1b8", "committedDate": "2020-03-27T23:23:21Z", "message": "- Moved a bit of code around in ChunkNotification.\n- Removed Town and TownyUniverse newTownBlock() methods.\n- Added addTownBlock() to TownyUniverse for populating the TownyUniverse\ntownBlocks ConcurrentHashMap.\n- Added townBlocks CHM to TownyUniverse.clearAll() to fix /ta reload.\n- Alter TownCommand.newTown() to reflect change to making new\nTownBlocks, sorted out needless setting of the homeblock.\n- Call TownyUniverse.removeTownBlock() directly from\nDataSource.removeTownBlock(), to begin removal of TownBlocks from towns\nand then the database.\n- Alter Flatfile & SQLSource loadTownBlockList(), we now create a new\nTownBlock object with a null town and then add it to the TownyUniverse\ntownBlock CHM.\n  - Town is taken care of later on in the loading process when each\nTownBlock is loaded.\n- Bit of reodering in the Town object for manipulating the Town\ntownBlock CHM.\n- TownClaimTask has had it's townClaim slightly simplified."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "9c9e63cc71b87b5ccd184ddd8084792fe4ccdc35", "author": {"user": {"login": "LlmDl", "name": null}}, "url": "https://github.com/TownyAdvanced/Towny/commit/9c9e63cc71b87b5ccd184ddd8084792fe4ccdc35", "committedDate": "2020-03-28T14:33:33Z", "message": "- Further testing accomplished successfully.\n- Minor changes to things, mainly moving more TownBlock lookup calls\nfrom pointing to TownyWorld, via the API/TownyUniverse."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "36726fd32c3f8a1dfae6e6a185bf8ad49feaf9c0", "author": {"user": {"login": "LlmDl", "name": null}}, "url": "https://github.com/TownyAdvanced/Towny/commit/36726fd32c3f8a1dfae6e6a185bf8ad49feaf9c0", "committedDate": "2020-03-28T17:36:44Z", "message": "- Load only townblock files from the townblocks dir.\n- On deletion of a townblock file, try to move it to\ntowny\\data\\townblocks\\worldname\\deleted\\townname\\\n  - Should make it easier to recover town's townblocks if something does\ngo wrong."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "463420c7b41cf21babd9e43aab0e264f2a08e5da", "author": {"user": {"login": "LlmDl", "name": null}}, "url": "https://github.com/TownyAdvanced/Towny/commit/463420c7b41cf21babd9e43aab0e264f2a08e5da", "committedDate": "2020-03-28T20:51:07Z", "message": "Fix loading of homeblocks in non-primary worlds."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "7607bebbfae018841feb74f14b9e7e41d014984d", "author": {"user": {"login": "LlmDl", "name": null}}, "url": "https://github.com/TownyAdvanced/Towny/commit/7607bebbfae018841feb74f14b9e7e41d014984d", "committedDate": "2020-03-28T20:53:24Z", "message": "Fix error when invalid world is loaded by townblock."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzg1MDE0OTc1", "url": "https://github.com/TownyAdvanced/Towny/pull/3838#pullrequestreview-385014975", "createdAt": "2020-03-31T18:54:07Z", "commit": {"oid": "7607bebbfae018841feb74f14b9e7e41d014984d"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0zMVQxODo1NDowN1rOF-jr1g==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0zMVQxODo1NDowN1rOF-jr1g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMTE0MDY5NA==", "bodyText": "Isn't the new WorldCoord() redundant as WorldCoord.parseWorldCoord(location) will already return a new world coord object.", "url": "https://github.com/TownyAdvanced/Towny/pull/3838#discussion_r401140694", "createdAt": "2020-03-31T18:54:07Z", "author": {"login": "silverwolfg11"}, "path": "src/com/palmergames/bukkit/towny/TownyAPI.java", "diffHunk": "@@ -216,22 +199,24 @@ public boolean isWilderness(Block block) {\n      * @return true if the {@link Location} is in the wilderness, false otherwise.\n      */\n     public boolean isWilderness(Location location) {\n-        WorldCoord worldCoord;\n-        \n-        try {\n-            worldCoord = new WorldCoord(townyUniverse.getDataSource().getWorld(location.getWorld().getName()).getName(), Coord.parseCoord(location));\n-        } catch (NotRegisteredException e) {\n-            // No record so must be Wilderness\n-            return true;\n-        }\n+        return isWilderness(new WorldCoord(WorldCoord.parseWorldCoord(location)));", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "7607bebbfae018841feb74f14b9e7e41d014984d"}, "originalPosition": 47}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzg1MDE2MDk2", "url": "https://github.com/TownyAdvanced/Towny/pull/3838#pullrequestreview-385016096", "createdAt": "2020-03-31T18:55:33Z", "commit": {"oid": "7607bebbfae018841feb74f14b9e7e41d014984d"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0zMVQxODo1NTozNFrOF-jvVg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0zMVQxODo1NTozNFrOF-jvVg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMTE0MTU5MA==", "bodyText": "Same as above.", "url": "https://github.com/TownyAdvanced/Towny/pull/3838#discussion_r401141590", "createdAt": "2020-03-31T18:55:34Z", "author": {"login": "silverwolfg11"}, "path": "src/com/palmergames/bukkit/towny/TownyAPI.java", "diffHunk": "@@ -272,7 +256,7 @@ public String getTownName(Location location) {\n      */\n     public UUID getTownUUID(Location location) {\n         try {\n-            WorldCoord worldCoord = new WorldCoord(townyUniverse.getDataSource().getWorld(location.getWorld().getName()).getName(), Coord.parseCoord(location));\n+            WorldCoord worldCoord = new WorldCoord(WorldCoord.parseWorldCoord(location));", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "7607bebbfae018841feb74f14b9e7e41d014984d"}, "originalPosition": 92}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ac3e4e0b3f8f65adceb7129f129bb7ccd65a04ef", "author": {"user": {"login": "LlmDl", "name": null}}, "url": "https://github.com/TownyAdvanced/Towny/commit/ac3e4e0b3f8f65adceb7129f129bb7ccd65a04ef", "committedDate": "2020-03-31T20:28:34Z", "message": "- Fix a couple redundant new WorldCoord's."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "fab063b6f4a77aa79b450327d2c82df65f3ae8a5", "author": {"user": {"login": "LlmDl", "name": null}}, "url": "https://github.com/TownyAdvanced/Towny/commit/fab063b6f4a77aa79b450327d2c82df65f3ae8a5", "committedDate": "2020-04-02T12:14:46Z", "message": "Fix SQL saveAllTownBlocks() returning false preventing conversion from\nflatfile to mysql."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "9dadd7758ab11cd2df1e093f1d8c671b29c70a95", "author": {"user": {"login": "LlmDl", "name": null}}, "url": "https://github.com/TownyAdvanced/Towny/commit/9dadd7758ab11cd2df1e093f1d8c671b29c70a95", "committedDate": "2020-04-02T12:18:38Z", "message": "Revert \"Fix SQL saveAllTownBlocks() returning false preventing conversion from flatfile to mysql.\"\n\nThis reverts commit fab063b6f4a77aa79b450327d2c82df65f3ae8a5."}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4253, "cost": 1, "resetAt": "2021-11-01T16:37:27Z"}}}