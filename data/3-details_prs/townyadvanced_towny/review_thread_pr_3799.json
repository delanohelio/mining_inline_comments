{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0MzkxMTM2Nzg5", "number": 3799, "reviewThreads": {"totalCount": 8, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yMlQyMToyNzo0OFrODqMPGQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yM1QxMjo0MzoxN1rODqXEQw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjQ1NTY3MjU3OnYy", "diffSide": "RIGHT", "path": "src/com/palmergames/bukkit/towny/object/Town.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yMlQyMToyNzo0OFrOF5ypUg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yMlQyMjowMDo0MVrOF5y11w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NjE0MjkzMA==", "bodyText": "Is there a particular reason for this deprecation, It seems more intuitive to use Town.getWorld() as opposed to Town.getHomeBlockWorld(), they also essentially do the same thing.", "url": "https://github.com/TownyAdvanced/Towny/pull/3799#discussion_r396142930", "createdAt": "2020-03-22T21:27:48Z", "author": null, "path": "src/com/palmergames/bukkit/towny/object/Town.java", "diffHunk": "@@ -1483,4 +1485,13 @@ public boolean pay(double amount, String reason) throws EconomyException {\n \tpublic boolean collect(double amount, String reason) throws EconomyException {\n \t\treturn getAccount().collect(amount, reason);\n \t}\n+\t\n+\t/**\n+\t * @deprecated As of 0.96.0.1, please use {@link Town#getHomeblockWorld()} instead.\n+\t */\n+\t@Deprecated\n+\tpublic TownyWorld getWorld() {\n+\t\treturn getHomeblockWorld();\n+\t}\n+\t", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "3336b54483a8dedc9e7648856c154851152b10c1"}, "originalPosition": 65}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NjE0NjEzNQ==", "bodyText": "Because the code that uses it is specifically asking for the HomeBlockWorld.", "url": "https://github.com/TownyAdvanced/Towny/pull/3799#discussion_r396146135", "createdAt": "2020-03-22T22:00:41Z", "author": {"login": "LlmDl"}, "path": "src/com/palmergames/bukkit/towny/object/Town.java", "diffHunk": "@@ -1483,4 +1485,13 @@ public boolean pay(double amount, String reason) throws EconomyException {\n \tpublic boolean collect(double amount, String reason) throws EconomyException {\n \t\treturn getAccount().collect(amount, reason);\n \t}\n+\t\n+\t/**\n+\t * @deprecated As of 0.96.0.1, please use {@link Town#getHomeblockWorld()} instead.\n+\t */\n+\t@Deprecated\n+\tpublic TownyWorld getWorld() {\n+\t\treturn getHomeblockWorld();\n+\t}\n+\t", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NjE0MjkzMA=="}, "originalCommit": {"oid": "3336b54483a8dedc9e7648856c154851152b10c1"}, "originalPosition": 65}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjQ1NTY4MTIzOnYy", "diffSide": "RIGHT", "path": "src/com/palmergames/bukkit/towny/db/TownyFlatFileSource.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yMlQyMTozOTo1M1rOF5yt5w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yMlQyMTozOTo1M1rOF5yt5w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NjE0NDEwMw==", "bodyText": "Taking into consideration runtime, you're going through every loaded town for !townyWorld.hasTown(town), one recommendation to solve this problem would be using a HashMap<String, Town> in TownyWorld to store towns as the fetch runtime for this data structure is O(1) which is much faster than .contains() which hasTown()uses", "url": "https://github.com/TownyAdvanced/Towny/pull/3799#discussion_r396144103", "createdAt": "2020-03-22T21:39:53Z", "author": null, "path": "src/com/palmergames/bukkit/towny/db/TownyFlatFileSource.java", "diffHunk": "@@ -1521,6 +1505,9 @@ public boolean loadTownBlocks() {\n \t\t\t\t\t\ttry {\n \t\t\t\t\t\t\tTown town = getTown(line.trim());\n \t\t\t\t\t\t\ttownBlock.setTown(town);\n+\t\t\t\t\t\t\tTownyWorld townyWorld = townBlock.getWorld();\n+\t\t\t\t\t\t\tif (townyWorld != null && !townyWorld.hasTown(town))\n+\t\t\t\t\t\t\t\ttownyWorld.addTown(town);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "3336b54483a8dedc9e7648856c154851152b10c1"}, "originalPosition": 36}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjQ1NTY4MjAyOnYy", "diffSide": "RIGHT", "path": "src/com/palmergames/bukkit/towny/db/TownySQLSource.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yMlQyMTo0MTowOFrOF5yuYQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yMlQyMTo0MTowOFrOF5yuYQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NjE0NDIyNQ==", "bodyText": "Same comment as above: runtime inefficiency.", "url": "https://github.com/TownyAdvanced/Towny/pull/3799#discussion_r396144225", "createdAt": "2020-03-22T21:41:08Z", "author": null, "path": "src/com/palmergames/bukkit/towny/db/TownySQLSource.java", "diffHunk": "@@ -1474,6 +1459,9 @@ public boolean loadTownBlocks() {\n                         try {\n                             Town town = getTown(line.trim());\n                             townBlock.setTown(town);\n+                            TownyWorld townyWorld = townBlock.getWorld();\n+                            if (townyWorld != null && !townyWorld.hasTown(town))\n+                            \ttownyWorld.addTown(town);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "3336b54483a8dedc9e7648856c154851152b10c1"}, "originalPosition": 35}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjQ1NzQzMDM0OnYy", "diffSide": "RIGHT", "path": "src/com/palmergames/bukkit/towny/object/TownyWorld.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yM1QxMjozODo0OFrOF6DgwA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yM1QxMjozODo0OFrOF6DgwA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NjQxOTI2NA==", "bodyText": "This should be simplified to return towns.containsKey(name);", "url": "https://github.com/TownyAdvanced/Towny/pull/3799#discussion_r396419264", "createdAt": "2020-03-23T12:38:48Z", "author": null, "path": "src/com/palmergames/bukkit/towny/object/TownyWorld.java", "diffHunk": "@@ -70,23 +72,23 @@ public boolean hasTowns() {\n \r\n \tpublic boolean hasTown(String name) {\r\n \r\n-\t\tfor (Town town : towns)\r\n-\t\t\tif (town.getName().equalsIgnoreCase(name))\r\n+\t\tfor (Map.Entry<String, Town> mapElement : towns.entrySet())\r\n+\t\t\tif (mapElement.getKey().equalsIgnoreCase(name))\r\n \t\t\t\treturn true;\r\n \t\treturn false;\r", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "693414d1377db1c6cfd05efbfd2b36e10ed9b04e"}, "originalPosition": 34}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjQ1NzQ0NDUyOnYy", "diffSide": "RIGHT", "path": "src/com/palmergames/bukkit/towny/object/TownyWorld.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yM1QxMjo0MjozM1rOF6DpZQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yM1QxMjo0MjozM1rOF6DpZQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NjQyMTQ3Nw==", "bodyText": "This should be changed to for (Town town : getTowns.values()) as the key in the Map.Entry is never used.", "url": "https://github.com/TownyAdvanced/Towny/pull/3799#discussion_r396421477", "createdAt": "2020-03-23T12:42:33Z", "author": null, "path": "src/com/palmergames/bukkit/towny/object/TownyWorld.java", "diffHunk": "@@ -645,21 +647,22 @@ public int getMinDistanceFromOtherTowns(Coord key) {\n \tpublic int getMinDistanceFromOtherTowns(Coord key, Town homeTown) {\r\n \r\n \t\tdouble min = Integer.MAX_VALUE;\r\n-\t\tfor (Town town : getTowns())\r\n+\t\tfor (Map.Entry<String, Town> mapElement : getTowns().entrySet()) {\r", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "693414d1377db1c6cfd05efbfd2b36e10ed9b04e"}, "originalPosition": 67}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjQ1NzQ0NTc3OnYy", "diffSide": "RIGHT", "path": "src/com/palmergames/bukkit/towny/object/TownyWorld.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yM1QxMjo0Mjo1NFrOF6DqEg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yM1QxMjo0Mjo1NFrOF6DqEg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NjQyMTY1MA==", "bodyText": "same issue as above", "url": "https://github.com/TownyAdvanced/Towny/pull/3799#discussion_r396421650", "createdAt": "2020-03-23T12:42:54Z", "author": null, "path": "src/com/palmergames/bukkit/towny/object/TownyWorld.java", "diffHunk": "@@ -684,7 +687,8 @@ public int getMinDistanceFromOtherTownsPlots(Coord key) {\n \tpublic int getMinDistanceFromOtherTownsPlots(Coord key, Town homeTown) {\r\n \r\n \t\tdouble min = Integer.MAX_VALUE;\r\n-\t\tfor (Town town : getTowns())\r\n+\t\tfor (Map.Entry<String, Town> mapElement : getTowns().entrySet()) {\r", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "693414d1377db1c6cfd05efbfd2b36e10ed9b04e"}, "originalPosition": 93}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjQ1NzQ0NjIzOnYy", "diffSide": "RIGHT", "path": "src/com/palmergames/bukkit/towny/object/TownyWorld.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yM1QxMjo0MzowNFrOF6DqbA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yM1QxMjo0MzowNFrOF6DqbA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NjQyMTc0MA==", "bodyText": "same issue as above", "url": "https://github.com/TownyAdvanced/Towny/pull/3799#discussion_r396421740", "createdAt": "2020-03-23T12:43:04Z", "author": null, "path": "src/com/palmergames/bukkit/towny/object/TownyWorld.java", "diffHunk": "@@ -715,7 +719,8 @@ public int getMinDistanceFromOtherTownsPlots(Coord key, Town homeTown) {\n \tpublic Town getClosestTownFromCoord(Coord key, Town nearestTown) {\r\n \t\t\r\n \t\tdouble min = Integer.MAX_VALUE;\r\n-\t\tfor (Town town : getTowns()) {\r\n+\t\tfor (Map.Entry<String, Town> mapElement : getTowns().entrySet()) {\r", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "693414d1377db1c6cfd05efbfd2b36e10ed9b04e"}, "originalPosition": 112}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjQ1NzQ0NzA3OnYy", "diffSide": "RIGHT", "path": "src/com/palmergames/bukkit/towny/object/TownyWorld.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yM1QxMjo0MzoxN1rOF6Dq4w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yM1QxMjo0MzoxN1rOF6Dq4w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NjQyMTg1OQ==", "bodyText": "same issue as above", "url": "https://github.com/TownyAdvanced/Towny/pull/3799#discussion_r396421859", "createdAt": "2020-03-23T12:43:17Z", "author": null, "path": "src/com/palmergames/bukkit/towny/object/TownyWorld.java", "diffHunk": "@@ -740,7 +745,8 @@ public Town getClosestTownFromCoord(Coord key, Town nearestTown) {\n \tpublic Town getClosestTownWithNationFromCoord(Coord key, Town nearestTown) {\r\n \t\t\r\n \t\tdouble min = Integer.MAX_VALUE;\r\n-\t\tfor (Town town : getTowns()) {\r\n+\t\tfor (Map.Entry<String, Town> mapElement : getTowns().entrySet()) {\r", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "693414d1377db1c6cfd05efbfd2b36e10ed9b04e"}, "originalPosition": 122}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1248, "cost": 1, "resetAt": "2021-11-13T14:23:39Z"}}}