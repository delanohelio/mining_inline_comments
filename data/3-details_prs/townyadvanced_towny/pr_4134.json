{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDQ0MTMxMTE5", "number": 4134, "title": "1.16.1: Add Respawn Anchor Integration", "bodyText": "Description:\n\nThis makes towny respect respawn anchors precedence on player respawn, instead of defaulting to the town spawn. This also makes sure that the server is running at least 1.16.1, if not the behavior is unchanged, so it doesn't break compatibility.\n\nNew Nodes/Commands/ConfigOptions:\n\nglobal_town_settings.respawn_anchor_higher_precendence -  defaults to  'true'\nWhen this is true, players will respawn to respawn anchors on death rather than their own town. 1.16+ only.\n\nRelevant Towny Issue ticket:\n\nCloses #4132\n\n\n I have tested this pull request for defects on a server.\n\n\nBy making this pull request, I represent that I have the right to waive copyright and related rights to my contribution, and agree that all copyright and related rights in my contributions are waived, and I acknowledge that the TownyAdvanced organization has the copyright to use and modify my contribution under the Towny License for perpetuity.", "createdAt": "2020-07-03T16:29:24Z", "url": "https://github.com/TownyAdvanced/Towny/pull/4134", "merged": true, "mergeCommit": {"oid": "d8dcf755cbdc704c7c935f28f0171a27aff6a650"}, "closed": true, "closedAt": "2020-07-03T22:12:32Z", "author": null, "timelineItems": {"totalCount": 5, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcxV-qGgH2gAyNDQ0MTMxMTE5OjU4MjJjMjQ1Y2Y3NDE1ZGJjYjQyZTM0ODZhMmY5NDMxNWUwYTEwNDQ=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcxa4KjgH2gAyNDQ0MTMxMTE5OjEzYTkyMmM1NzRhOGI4MDU5Njc5Y2MwMjE2YTJhMzdkNWVmNjVjYTg=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "5822c245cf7415dbcb42e3486a2f94315e0a1044", "author": {"user": null}, "url": "https://github.com/TownyAdvanced/Towny/commit/5822c245cf7415dbcb42e3486a2f94315e0a1044", "committedDate": "2020-07-03T16:24:49Z", "message": "Add respawn anchor precedence."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDQyNTU4NzUz", "url": "https://github.com/TownyAdvanced/Towny/pull/4134#pullrequestreview-442558753", "createdAt": "2020-07-03T21:00:37Z", "commit": {"oid": "5822c245cf7415dbcb42e3486a2f94315e0a1044"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wM1QyMTowMDozN1rOGs3sPw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wM1QyMTowMDozN1rOGs3sPw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0OTcwMjk3NQ==", "bodyText": "Remove debug message.", "url": "https://github.com/TownyAdvanced/Towny/pull/4134#discussion_r449702975", "createdAt": "2020-07-03T21:00:37Z", "author": {"login": "LlmDl"}, "path": "src/com/palmergames/bukkit/towny/listeners/TownyPlayerListener.java", "diffHunk": "@@ -156,8 +156,15 @@ public void onPlayerRespawn(PlayerRespawnEvent event) {\n \t\t\n \t\tPlayer player = event.getPlayer();\n \t\t\n-\t\tif (!TownySettings.isTownRespawning())\n+\t\tif (!TownySettings.isTownRespawning()) {\n \t\t\treturn;\n+\t\t}\n+\t\t\n+\t\t// If respawn anchors have higher precedence than town spawns, use them instead.\n+\t\tif (Towny.is116Plus() && event.isAnchorSpawn() && TownySettings.isRespawnAnchorHigherPrecedence()) {\n+\t\t\tTownyMessaging.sendErrorMsg(\"got here\");", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "5822c245cf7415dbcb42e3486a2f94315e0a1044"}, "originalPosition": 11}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f191b871b0ab209fd3f68ab9ad29e072a930b9c0", "author": {"user": null}, "url": "https://github.com/TownyAdvanced/Towny/commit/f191b871b0ab209fd3f68ab9ad29e072a930b9c0", "committedDate": "2020-07-03T22:01:08Z", "message": "Remove debug message."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDQyNTY3MTk4", "url": "https://github.com/TownyAdvanced/Towny/pull/4134#pullrequestreview-442567198", "createdAt": "2020-07-03T22:05:17Z", "commit": {"oid": "f191b871b0ab209fd3f68ab9ad29e072a930b9c0"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wM1QyMjowNToxN1rOGs4Mjw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wM1QyMjowNToxN1rOGs4Mjw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0OTcxMTI0Nw==", "bodyText": "Just caught this one. This will broadcast an error message any time its run on non-1.16+, right? If so, it will have to be removed as well.", "url": "https://github.com/TownyAdvanced/Towny/pull/4134#discussion_r449711247", "createdAt": "2020-07-03T22:05:17Z", "author": {"login": "LlmDl"}, "path": "src/com/palmergames/bukkit/towny/Towny.java", "diffHunk": "@@ -851,4 +852,16 @@ else if (Bukkit.getServer().getName().equalsIgnoreCase(\"craftbukkit\")) {\n \t\t\n \t\tmetrics.addCustomChart(new Metrics.SimplePie(\"resident_uuids_stored\", () -> TownySettings.getUUIDPercent()));\n \t}\n+\t\n+\tpublic static boolean is116Plus() {\n+\t\tString verString = Bukkit.getBukkitVersion();\n+\t\tverString = verString.replace(\"-R0.1-SNAPSHOT\", \"\");\n+\t\t\n+\t\tVersion ver = new Version(verString);\n+\t\tVersion required = new Version(\"1.16.1\");\n+\t\t\n+\t\tTownyMessaging.sendErrorMsg(ver.compareTo(required) + \"\");", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f191b871b0ab209fd3f68ab9ad29e072a930b9c0"}, "originalPosition": 20}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "13a922c574a8b8059679cc0216a2a37d5ef65ca8", "author": {"user": null}, "url": "https://github.com/TownyAdvanced/Towny/commit/13a922c574a8b8059679cc0216a2a37d5ef65ca8", "committedDate": "2020-07-03T22:07:15Z", "message": "Remove other debug message."}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3220, "cost": 1, "resetAt": "2021-11-02T12:20:56Z"}}}