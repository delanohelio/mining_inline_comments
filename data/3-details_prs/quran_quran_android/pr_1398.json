{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDQ1NDcyNDg4", "number": 1398, "title": "Support Reordering Of Translations. Fixes #1179", "bodyText": "Contributing fully re-orderable translations using new action menu in settings in response to Issue #1179\n\nNew version and database migration to add 'Display Order' column to local translation information\nNew Action Bar menu on long-press:\n\nMove up\nMove down\nExisting delete button\n\n\nChanges instantly show in text view:\n\nTranslation list sorted according to user-defined order\nTexts below Ayah are sorted according to user-defined order\n\n\nBy default, new downloads are added at bottom of list of translations\n\nTested with:\n\nAnrdoid 9\nGalaxy S8\nAndroid Studio 4", "createdAt": "2020-07-07T15:01:41Z", "url": "https://github.com/quran/quran_android/pull/1398", "merged": true, "mergeCommit": {"oid": "604b9bf451792f7ce88b76a26f99c1af04f8b592"}, "closed": true, "closedAt": "2020-09-29T05:51:05Z", "author": {"login": "papasmile"}, "timelineItems": {"totalCount": 11, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcynbeOABqjM1MjA5NzUzMTA=", "endCursor": "Y3Vyc29yOnYyOpPPAAABc4E4DOgFqTQ1NDkyMDg0OA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "6e2c6b2495d6a9ad7d172ec45a254ecb64821ea4", "author": {"user": {"login": "papasmile", "name": null}}, "url": "https://github.com/quran/quran_android/commit/6e2c6b2495d6a9ad7d172ec45a254ecb64821ea4", "committedDate": "2020-07-07T14:51:28Z", "message": "Support Reordering Of Translations. Fixes #1179"}, "afterCommit": {"oid": "aa72ffa817b3db14cdc8b873c4a6bf3298fe55c0", "author": {"user": {"login": "papasmile", "name": null}}, "url": "https://github.com/quran/quran_android/commit/aa72ffa817b3db14cdc8b873c4a6bf3298fe55c0", "committedDate": "2020-07-07T15:17:52Z", "message": "Support Reordering Of Translations. Fixes #1179"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "4b6c4a923b250e179bbf0462c07c1b25a69d2562", "author": {"user": {"login": "papasmile", "name": null}}, "url": "https://github.com/quran/quran_android/commit/4b6c4a923b250e179bbf0462c07c1b25a69d2562", "committedDate": "2020-07-08T15:28:59Z", "message": "Support Reordering Of Translations. Fixes #1179"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "aa72ffa817b3db14cdc8b873c4a6bf3298fe55c0", "author": {"user": {"login": "papasmile", "name": null}}, "url": "https://github.com/quran/quran_android/commit/aa72ffa817b3db14cdc8b873c4a6bf3298fe55c0", "committedDate": "2020-07-07T15:17:52Z", "message": "Support Reordering Of Translations. Fixes #1179"}, "afterCommit": {"oid": "4b6c4a923b250e179bbf0462c07c1b25a69d2562", "author": {"user": {"login": "papasmile", "name": null}}, "url": "https://github.com/quran/quran_android/commit/4b6c4a923b250e179bbf0462c07c1b25a69d2562", "committedDate": "2020-07-08T15:28:59Z", "message": "Support Reordering Of Translations. Fixes #1179"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDQ1MjY2NjY2", "url": "https://github.com/quran/quran_android/pull/1398#pullrequestreview-445266666", "createdAt": "2020-07-09T03:30:01Z", "commit": {"oid": "4b6c4a923b250e179bbf0462c07c1b25a69d2562"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 6, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wOVQwMzozMDowMVrOGvAcdA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wOVQwMzo1Mjo0OVrOGvAv9g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MTk0MzU0MA==", "bodyText": "Please revert these changes. (Most probably you used them to test an upgrade?).", "url": "https://github.com/quran/quran_android/pull/1398#discussion_r451943540", "createdAt": "2020-07-09T03:30:01Z", "author": {"login": "ozbek"}, "path": "app/build.gradle", "diffHunk": "@@ -17,8 +17,8 @@ android {\n   defaultConfig {\n     minSdkVersion deps.android.build.minSdkVersion\n     targetSdkVersion deps.android.build.targetSdkVersion\n-    versionCode 3010\n-    versionName \"3.0.1\"\n+    versionCode 3100", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "4b6c4a923b250e179bbf0462c07c1b25a69d2562"}, "originalPosition": 6}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MTk0MzczMg==", "bodyText": "Please, consider closing this cursor.", "url": "https://github.com/quran/quran_android/pull/1398#discussion_r451943732", "createdAt": "2020-07-09T03:30:48Z", "author": {"login": "ozbek"}, "path": "app/src/main/java/com/quran/labs/androidquran/database/TranslationsDBAdapter.java", "diffHunk": "@@ -105,11 +106,31 @@ public void deleteTranslationByFile(String filename) {\n   public boolean writeTranslationUpdates(List<TranslationItem> updates) {\n     boolean result = true;\n     db.beginTransaction();\n+\n     try {\n       for (int i = 0, updatesSize = updates.size(); i < updatesSize; i++) {\n         TranslationItem item = updates.get(i);\n         if (item.exists()) {\n+          int displayOrder = 0;\n+\n           final Translation translation = item.getTranslation();\n+\n+          if (item.getDisplayOrder() > -1) {\n+            displayOrder = item.getDisplayOrder();\n+          } else {\n+            // get next highest display order\n+            Cursor cursor = db.query(", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "4b6c4a923b250e179bbf0462c07c1b25a69d2562"}, "originalPosition": 30}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MTk0NDE3Nw==", "bodyText": "I am not entirely sure if db.endTransaction() auto-closes previous cursors, but you may need to close this cursor as well.", "url": "https://github.com/quran/quran_android/pull/1398#discussion_r451944177", "createdAt": "2020-07-09T03:32:46Z", "author": {"login": "ozbek"}, "path": "app/src/main/java/com/quran/labs/androidquran/database/TranslationsDBHelper.java", "diffHunk": "@@ -69,6 +73,34 @@ public void onUpgrade(SQLiteDatabase db, int oldVersion, int newVersion) {\n         db.endTransaction();\n       }\n     }\n+    if (oldVersion < 5) {\n+      // Add display order column and add arbitrary order to existing translations\n+      db.beginTransaction();\n+      try {\n+        db.execSQL(\"ALTER TABLE \"\n+            + TranslationsTable.TABLE_NAME\n+            + \" ADD COLUMN \"\n+            + TranslationsTable.DISPLAY_ORDER\n+            + \" integer not null default -1\"\n+        );\n+        Cursor translations = db.query(", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "4b6c4a923b250e179bbf0462c07c1b25a69d2562"}, "originalPosition": 43}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MTk0NTcwMQ==", "bodyText": "Why do you need an activity here? It is generally a bad idea to have a reference to an activity.\nThere should be a better way of achieving your goal. Maybe replace with an interface?", "url": "https://github.com/quran/quran_android/pull/1398#discussion_r451945701", "createdAt": "2020-07-09T03:39:47Z", "author": {"login": "ozbek"}, "path": "app/src/main/java/com/quran/labs/androidquran/ui/adapter/TranslationsAdapter.java", "diffHunk": "@@ -26,12 +30,23 @@\n \n   private final UnicastSubject<TranslationRowData> onClickDownloadSubject = UnicastSubject.create();\n   private final UnicastSubject<TranslationRowData> onClickRemoveSubject = UnicastSubject.create();\n+  private final UnicastSubject<TranslationRowData> onClickRankUpSubject = UnicastSubject.create();\n+  private final UnicastSubject<TranslationRowData> onClickRankDownSubject = UnicastSubject.create();\n+\n+  private final AppCompatActivity activity;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "4b6c4a923b250e179bbf0462c07c1b25a69d2562"}, "originalPosition": 28}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MTk0NTk5Nw==", "bodyText": "Please consider following the existing coding style.", "url": "https://github.com/quran/quran_android/pull/1398#discussion_r451945997", "createdAt": "2020-07-09T03:41:08Z", "author": {"login": "ozbek"}, "path": "app/src/main/java/com/quran/labs/androidquran/ui/adapter/TranslationsAdapter.java", "diffHunk": "@@ -152,19 +219,75 @@ ImageView getRightImage() {\n       return rightImage;\n     }\n \n-    final View.OnClickListener removeListener = v -> {\n-      TranslationItem item = (TranslationItem) translations.get(getAdapterPosition());\n-      onClickRemoveSubject.onNext(item);\n+    final View.OnLongClickListener actionMenuListener = v -> {\n+      if (actionMode != null) {\n+        actionMode.finish();\n+        selectionListener.clearSelection();\n+      } else if (activity != null) {\n+        selectionListener.handleSelection(item);\n+        actionMode = activity.startSupportActionMode(new ModeCallback());\n+      }\n+      return true;\n     };\n \n     @Override\n     public void onClick(View v) {\n-      TranslationItem item = (TranslationItem) translations.get(getAdapterPosition());\n-      if (item.exists() && !item.needsUpgrade()) {\n-        onClickRemoveSubject.onNext(item);\n-      } else {\n+      if (actionMode != null) {\n+        actionMode.finish();\n+      }\n+      selectionListener.clearSelection();\n+      if (!item.exists() || item.needsUpgrade()) {\n         onClickDownloadSubject.onNext(item);\n       }\n     }\n   }\n+\n+  private class ModeCallback implements ActionMode.Callback  {\n+    @Override\n+    public boolean onCreateActionMode ( ActionMode mode, Menu menu )", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "4b6c4a923b250e179bbf0462c07c1b25a69d2562"}, "originalPosition": 200}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MTk0ODUzNA==", "bodyText": "Out of curiosity, what does \"dtm\" stand for? :)", "url": "https://github.com/quran/quran_android/pull/1398#discussion_r451948534", "createdAt": "2020-07-09T03:52:49Z", "author": {"login": "ozbek"}, "path": "app/src/main/res/values/strings.xml", "diffHunk": "@@ -237,6 +237,10 @@\n   <string name=\"export_data_error\">Error exporting data</string>\n   <string name=\"exported_data\">Data exported to %1$s</string>\n \n+  <string name=\"dtm_move_up\">Move Up</string>", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "4b6c4a923b250e179bbf0462c07c1b25a69d2562"}, "originalPosition": 4}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b8ac99ea08874409a515136a6a585af0883a12b9", "author": {"user": {"login": "papasmile", "name": null}}, "url": "https://github.com/quran/quran_android/commit/b8ac99ea08874409a515136a6a585af0883a12b9", "committedDate": "2020-07-16T13:18:46Z", "message": "cleanup"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "25dd8898ba5eff35e2a2d855644145f6f8e7e624", "author": {"user": {"login": "papasmile", "name": null}}, "url": "https://github.com/quran/quran_android/commit/25dd8898ba5eff35e2a2d855644145f6f8e7e624", "committedDate": "2020-07-17T13:02:43Z", "message": "Initialize Cursor"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDUyODk5MDE5", "url": "https://github.com/quran/quran_android/pull/1398#pullrequestreview-452899019", "createdAt": "2020-07-21T23:34:03Z", "commit": {"oid": "25dd8898ba5eff35e2a2d855644145f6f8e7e624"}, "state": "COMMENTED", "comments": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yMVQyMzozNDowM1rOG1NdBQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yMVQyMzozOTowMlrOG1NjPw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1ODQ0ODEzMw==", "bodyText": "do we really expect these to be nullable? because if not, we can simplify things here", "url": "https://github.com/quran/quran_android/pull/1398#discussion_r458448133", "createdAt": "2020-07-21T23:34:03Z", "author": {"login": "ahmedre"}, "path": "app/src/main/java/com/quran/labs/androidquran/common/LocalTransationDiplaySort.kt", "diffHunk": "@@ -0,0 +1,8 @@\n+package com.quran.labs.androidquran.common\n+\n+class LocalTransationDiplaySort : Comparator<LocalTranslation> {\n+  override fun compare(p0: LocalTranslation?, p1: LocalTranslation?): Int {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "25dd8898ba5eff35e2a2d855644145f6f8e7e624"}, "originalPosition": 4}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1ODQ0ODUyNQ==", "bodyText": "similarly, can these actually be nullable?", "url": "https://github.com/quran/quran_android/pull/1398#discussion_r458448525", "createdAt": "2020-07-21T23:35:15Z", "author": {"login": "ahmedre"}, "path": "app/src/main/java/com/quran/labs/androidquran/dao/translation/TranslationItemDiplaySort.kt", "diffHunk": "@@ -0,0 +1,8 @@\n+package com.quran.labs.androidquran.dao.translation\n+\n+class TranslationItemDiplaySort : Comparator<TranslationItem> {\n+  override fun compare(p0: TranslationItem?, p1: TranslationItem?): Int {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "25dd8898ba5eff35e2a2d855644145f6f8e7e624"}, "originalPosition": 4}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1ODQ0ODc0Mw==", "bodyText": "you should do this in a try / finally because if an exception is thrown due to the query, we will leak the cursor", "url": "https://github.com/quran/quran_android/pull/1398#discussion_r458448743", "createdAt": "2020-07-21T23:35:59Z", "author": {"login": "ahmedre"}, "path": "app/src/main/java/com/quran/labs/androidquran/database/TranslationsDBAdapter.java", "diffHunk": "@@ -105,11 +106,31 @@ public void deleteTranslationByFile(String filename) {\n   public boolean writeTranslationUpdates(List<TranslationItem> updates) {\n     boolean result = true;\n     db.beginTransaction();\n+\n     try {\n       for (int i = 0, updatesSize = updates.size(); i < updatesSize; i++) {\n         TranslationItem item = updates.get(i);\n         if (item.exists()) {\n+          int displayOrder = 0;\n+\n           final Translation translation = item.getTranslation();\n+\n+          if (item.getDisplayOrder() > -1) {\n+            displayOrder = item.getDisplayOrder();\n+          } else {\n+            // get next highest display order\n+            Cursor cursor = db.query(", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MTk0MzczMg=="}, "originalCommit": {"oid": "4b6c4a923b250e179bbf0462c07c1b25a69d2562"}, "originalPosition": 30}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1ODQ0OTcyNw==", "bodyText": "+1 - also, as a hack, can we just use the row id as the value here so we don't have to do an upload loop?\ni.e. something like\nUPDATE translations SET display_order = id", "url": "https://github.com/quran/quran_android/pull/1398#discussion_r458449727", "createdAt": "2020-07-21T23:39:02Z", "author": {"login": "ahmedre"}, "path": "app/src/main/java/com/quran/labs/androidquran/database/TranslationsDBHelper.java", "diffHunk": "@@ -69,6 +73,34 @@ public void onUpgrade(SQLiteDatabase db, int oldVersion, int newVersion) {\n         db.endTransaction();\n       }\n     }\n+    if (oldVersion < 5) {\n+      // Add display order column and add arbitrary order to existing translations\n+      db.beginTransaction();\n+      try {\n+        db.execSQL(\"ALTER TABLE \"\n+            + TranslationsTable.TABLE_NAME\n+            + \" ADD COLUMN \"\n+            + TranslationsTable.DISPLAY_ORDER\n+            + \" integer not null default -1\"\n+        );\n+        Cursor translations = db.query(", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MTk0NDE3Nw=="}, "originalCommit": {"oid": "4b6c4a923b250e179bbf0462c07c1b25a69d2562"}, "originalPosition": 43}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b7f5aca29ad808af53827e29e12b533d481f54d6", "author": {"user": {"login": "papasmile", "name": null}}, "url": "https://github.com/quran/quran_android/commit/b7f5aca29ad808af53827e29e12b533d481f54d6", "committedDate": "2020-07-23T15:27:36Z", "message": "cleanup and multi-move"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDU0NzEyOTU4", "url": "https://github.com/quran/quran_android/pull/1398#pullrequestreview-454712958", "createdAt": "2020-07-24T08:25:00Z", "commit": {"oid": "b7f5aca29ad808af53827e29e12b533d481f54d6"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yNFQwODoyNTowMFrOG2nJdA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yNFQwODoyNTowMFrOG2nJdA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1OTkxNzY4NA==", "bodyText": "Who ate the s? :)", "url": "https://github.com/quran/quran_android/pull/1398#discussion_r459917684", "createdAt": "2020-07-24T08:25:00Z", "author": {"login": "ozbek"}, "path": "app/src/main/java/com/quran/labs/androidquran/common/LocalTransationDiplaySort.kt", "diffHunk": "@@ -0,0 +1,7 @@\n+package com.quran.labs.androidquran.common\n+\n+class LocalTransationDiplaySort : Comparator<LocalTranslation> {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b7f5aca29ad808af53827e29e12b533d481f54d6"}, "originalPosition": 3}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "604b9bf451792f7ce88b76a26f99c1af04f8b592", "author": {"user": {"login": "papasmile", "name": null}}, "url": "https://github.com/quran/quran_android/commit/604b9bf451792f7ce88b76a26f99c1af04f8b592", "committedDate": "2020-07-24T13:24:54Z", "message": "spelling"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDU0OTIwODQ4", "url": "https://github.com/quran/quran_android/pull/1398#pullrequestreview-454920848", "createdAt": "2020-07-24T14:13:45Z", "commit": {"oid": "604b9bf451792f7ce88b76a26f99c1af04f8b592"}, "state": "COMMENTED", "comments": {"totalCount": 5, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yNFQxNDoxMzo0NlrOG2w-Ow==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yNFQxNDoyNDoxMlrOG2xYgA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MDA3ODY1MQ==", "bodyText": "sorry to nitpick, the try/catch should be before the cursor assignment even - so like:\nCursor cursor = null;\ntry {\n  cursor = ..\n} finally {\n  DatabasUtils.closeCursor(cursor);\n}", "url": "https://github.com/quran/quran_android/pull/1398#discussion_r460078651", "createdAt": "2020-07-24T14:13:46Z", "author": {"login": "ahmedre"}, "path": "app/src/main/java/com/quran/labs/androidquran/database/TranslationsDBAdapter.java", "diffHunk": "@@ -105,11 +106,31 @@ public void deleteTranslationByFile(String filename) {\n   public boolean writeTranslationUpdates(List<TranslationItem> updates) {\n     boolean result = true;\n     db.beginTransaction();\n+\n     try {\n       for (int i = 0, updatesSize = updates.size(); i < updatesSize; i++) {\n         TranslationItem item = updates.get(i);\n         if (item.exists()) {\n+          int displayOrder = 0;\n+\n           final Translation translation = item.getTranslation();\n+\n+          if (item.getDisplayOrder() > -1) {\n+            displayOrder = item.getDisplayOrder();\n+          } else {\n+            // get next highest display order\n+            Cursor cursor = db.query(", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MTk0MzczMg=="}, "originalCommit": {"oid": "4b6c4a923b250e179bbf0462c07c1b25a69d2562"}, "originalPosition": 30}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MDA3ODgwOQ==", "bodyText": "see comment below - try should move up though", "url": "https://github.com/quran/quran_android/pull/1398#discussion_r460078809", "createdAt": "2020-07-24T14:14:01Z", "author": {"login": "ahmedre"}, "path": "app/src/main/java/com/quran/labs/androidquran/database/TranslationsDBAdapter.java", "diffHunk": "@@ -72,23 +72,27 @@ public long getLastWriteTime() {\n         null, null, null, null, null,\n         TranslationsTable.ID + \" ASC\");\n     if (cursor != null) {\n-      while (cursor.moveToNext()) {\n-        int id = cursor.getInt(0);\n-        String name = cursor.getString(1);\n-        String translator = cursor.getString(2);\n-        String translatorForeign = cursor.getString(3);\n-        String filename = cursor.getString(4);\n-        String url = cursor.getString(5);\n-        String languageCode = cursor.getString(6);\n-        int version = cursor.getInt(7);\n-        int minimumVersion = cursor.getInt(8);\n-\n-        if (quranFileUtils.hasTranslation(context, filename)) {\n-          items.add(new LocalTranslation(id, filename, name, translator,\n-              translatorForeign, url, languageCode, version, minimumVersion));\n+      try {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "604b9bf451792f7ce88b76a26f99c1af04f8b592"}, "originalPosition": 18}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MDA4MTI4OA==", "bodyText": "question - why do we have to do this? why not assume that the result from sortDownloadedItems() is the sort ordering - so basically when you choose item 3 and move up, you just swap positions 2 and 3 without having to do these loops.", "url": "https://github.com/quran/quran_android/pull/1398#discussion_r460081288", "createdAt": "2020-07-24T14:17:51Z", "author": {"login": "ahmedre"}, "path": "app/src/main/java/com/quran/labs/androidquran/ui/TranslationManagerActivity.java", "diffHunk": "@@ -330,6 +356,86 @@ private void removeItem(final TranslationRowData translationRowData) {\n     builder.show();\n   }\n \n+  private List<TranslationItem> sortedDownloadedItems() {\n+    final ArrayList<TranslationItem> result = new ArrayList<>();\n+    for (TranslationItem item : allItems) {\n+      if (item.exists()) result.add(item);\n+    }\n+    Collections.sort(result, new TranslationItemDisplaySort ());\n+    return result;\n+  }\n+\n+  private void rankDownItem(TranslationRowData targetRow) {\n+    TranslationItem targetItem = (TranslationItem) targetRow;\n+    List<TranslationItem> sortedDownloads = sortedDownloadedItems();\n+    if (sortedDownloads.indexOf(targetItem) + 1 < sortedDownloads.size()) { // ignore last item in list\n+      TranslationItem updatedItem = targetItem.withDisplayOrder(targetItem.getDisplayOrder() + 1);\n+      ArrayList<TranslationItem> toUpdate = new ArrayList<>();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "604b9bf451792f7ce88b76a26f99c1af04f8b592"}, "originalPosition": 135}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MDA4MTU4Nw==", "bodyText": "same here", "url": "https://github.com/quran/quran_android/pull/1398#discussion_r460081587", "createdAt": "2020-07-24T14:18:17Z", "author": {"login": "ahmedre"}, "path": "app/src/main/java/com/quran/labs/androidquran/ui/TranslationManagerActivity.java", "diffHunk": "@@ -330,6 +356,86 @@ private void removeItem(final TranslationRowData translationRowData) {\n     builder.show();\n   }\n \n+  private List<TranslationItem> sortedDownloadedItems() {\n+    final ArrayList<TranslationItem> result = new ArrayList<>();\n+    for (TranslationItem item : allItems) {\n+      if (item.exists()) result.add(item);\n+    }\n+    Collections.sort(result, new TranslationItemDisplaySort ());\n+    return result;\n+  }\n+\n+  private void rankDownItem(TranslationRowData targetRow) {\n+    TranslationItem targetItem = (TranslationItem) targetRow;\n+    List<TranslationItem> sortedDownloads = sortedDownloadedItems();\n+    if (sortedDownloads.indexOf(targetItem) + 1 < sortedDownloads.size()) { // ignore last item in list\n+      TranslationItem updatedItem = targetItem.withDisplayOrder(targetItem.getDisplayOrder() + 1);\n+      ArrayList<TranslationItem> toUpdate = new ArrayList<>();\n+      toUpdate.add(updatedItem);\n+      TranslationItem swapItem = null;\n+      for(TranslationItem translationItem : sortedDownloads){\n+        if (translationItem.getDisplayOrder() == updatedItem.getDisplayOrder()) {\n+          swapItem = translationItem;\n+          break;\n+        }\n+      }\n+      if (swapItem != null) { // swap item order\n+        if (swapItem.getDisplayOrder() > 0) {\n+          toUpdate.add(swapItem.withDisplayOrder(swapItem.getDisplayOrder() - 1));\n+        }\n+      } else { // shift item order for higher items\n+        for (TranslationItem translationItem : sortedDownloads) {\n+          if (translationItem.getDisplayOrder() > -1 && translationItem.getDisplayOrder() < updatedItem.getDisplayOrder()) {\n+            toUpdate.add(translationItem.withDisplayOrder(translationItem.getDisplayOrder() + 1));\n+          }\n+        }\n+      }\n+      if (!toUpdate.isEmpty()) {\n+        if (selectionListener != null) selectionListener.handleSelection(updatedItem);\n+        for(TranslationItem toUpdateItem : toUpdate){\n+          updateTranslationItem(toUpdateItem);\n+        }\n+        generateListItems();\n+      }\n+    }\n+  }\n+\n+  private void rankUpItem(TranslationRowData targetRow) {\n+    TranslationItem targetItem = (TranslationItem) targetRow;\n+    List<TranslationItem> sortedDownloads = sortedDownloadedItems();\n+    if (sortedDownloads.indexOf(targetItem) > 0) { // ignore first item in list\n+      ArrayList<TranslationItem> toUpdate  = new ArrayList<>();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "604b9bf451792f7ce88b76a26f99c1af04f8b592"}, "originalPosition": 169}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MDA4NTM3Ng==", "bodyText": "this is expensive because every move is a database query when it doesn't need to be. we should just update when action mode is closed.", "url": "https://github.com/quran/quran_android/pull/1398#discussion_r460085376", "createdAt": "2020-07-24T14:24:12Z", "author": {"login": "ahmedre"}, "path": "app/src/main/java/com/quran/labs/androidquran/ui/TranslationManagerActivity.java", "diffHunk": "@@ -330,6 +356,86 @@ private void removeItem(final TranslationRowData translationRowData) {\n     builder.show();\n   }\n \n+  private List<TranslationItem> sortedDownloadedItems() {\n+    final ArrayList<TranslationItem> result = new ArrayList<>();\n+    for (TranslationItem item : allItems) {\n+      if (item.exists()) result.add(item);\n+    }\n+    Collections.sort(result, new TranslationItemDisplaySort ());\n+    return result;\n+  }\n+\n+  private void rankDownItem(TranslationRowData targetRow) {\n+    TranslationItem targetItem = (TranslationItem) targetRow;\n+    List<TranslationItem> sortedDownloads = sortedDownloadedItems();\n+    if (sortedDownloads.indexOf(targetItem) + 1 < sortedDownloads.size()) { // ignore last item in list\n+      TranslationItem updatedItem = targetItem.withDisplayOrder(targetItem.getDisplayOrder() + 1);\n+      ArrayList<TranslationItem> toUpdate = new ArrayList<>();\n+      toUpdate.add(updatedItem);\n+      TranslationItem swapItem = null;\n+      for(TranslationItem translationItem : sortedDownloads){\n+        if (translationItem.getDisplayOrder() == updatedItem.getDisplayOrder()) {\n+          swapItem = translationItem;\n+          break;\n+        }\n+      }\n+      if (swapItem != null) { // swap item order\n+        if (swapItem.getDisplayOrder() > 0) {\n+          toUpdate.add(swapItem.withDisplayOrder(swapItem.getDisplayOrder() - 1));\n+        }\n+      } else { // shift item order for higher items\n+        for (TranslationItem translationItem : sortedDownloads) {\n+          if (translationItem.getDisplayOrder() > -1 && translationItem.getDisplayOrder() < updatedItem.getDisplayOrder()) {\n+            toUpdate.add(translationItem.withDisplayOrder(translationItem.getDisplayOrder() + 1));\n+          }\n+        }\n+      }\n+      if (!toUpdate.isEmpty()) {\n+        if (selectionListener != null) selectionListener.handleSelection(updatedItem);\n+        for(TranslationItem toUpdateItem : toUpdate){\n+          updateTranslationItem(toUpdateItem);\n+        }\n+        generateListItems();\n+      }", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "604b9bf451792f7ce88b76a26f99c1af04f8b592"}, "originalPosition": 161}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3022, "cost": 1, "resetAt": "2021-11-01T16:37:27Z"}}}